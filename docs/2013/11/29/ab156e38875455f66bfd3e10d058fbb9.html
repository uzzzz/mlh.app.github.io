<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>【比特币】自己动手编译比特币客户端-开心乐源的专栏(关于互联 关于安全) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="【比特币】自己动手编译比特币客户端-开心乐源的专栏(关于互联 关于安全)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wuzh1230/article/details/17020689 https://github.com/imharrywu/fastcoin本帖只谈技术实现，首先我们自己来编译一个比特币客户端吧， 技术讨论QQ群，161928517，欢迎大家入伙(注明：csdn)。 &nbsp; 2014.7.18更新: 静态编译的第三方依赖和MINGW64工具链以及v0.9.1的官方源代码： https://github.com/imharrywu/fastcoin &nbsp; 本文遇到的问题大部分是使用动态库构建的时候遇到的，仅仅作为一个备份，大家可以直接迁出上面的代码或者直接跳到本文的最后看《自动脚本》 本地化的travis构建脚本 不带任何qt-style风格的qt界面库构建出来的比特币satoshi客户端 ======================================================================================================================= &nbsp; &nbsp; &nbsp; &nbsp; 先看一下最后编出来的带qt前端的客户端版本截图，会有测试版本提示 (使用tag的源代码编译正式版本) &nbsp; &nbsp; (建议：备份您之前安装的%APPDATA%bitcoin目录)。 &nbsp; 参考github上的描述文件 https://github.com/bitcoin/bitcoin/blob/master/doc/build-msw.md &nbsp; 1) 签出代码 GitHub上的官方源代码 &nbsp; git clone https://github.com/bitcoin/bitcoin.git &nbsp; 也可以从csdn的code上签出本文的整个项目组 &nbsp; &nbsp; git clone git://code.csdn.net/wuzh1230/bitcoin.git &nbsp; 提示： &nbsp; &lt;1&gt;已经包含了预编译的依赖库在3rd目录下； &lt;2&gt;已经包含了ming32工具链，请修改msys/1.0/etc/fstab。 &lt;3&gt;文章遇到的问题大多是使用动态库构造的时候遇到的，建议大家用--enable-static构造所有的依赖，直接跳到最后一节《自动脚本》。 &nbsp; &nbsp; 2) 下载依赖包 Libraries you need to download separately and build: name default path download ---------------------------------------------------- OpenSSL \openssl-1.0.1c-mgw http://www.openssl.org/source/ Berkeley DB \db-4.8.30.NC-mgw http://www.oracle.com/technology/software/products/berkeley-db/index.html Boost \boost-1.50.0-mgw http://www.boost.org/users/download/ miniupnpc \miniupnpc-1.6-mgw http://miniupnp.tuxfamily.org/files/ &nbsp; 3) 编译依赖包 &nbsp; 3.1) OpenSSL &nbsp; cd /c/openssl-1.0.1c-mgw ./config make 未发现问题，如有任何问题，欢迎讨论。 3.2) Berkeley DB cd /c/db-4.8.30.NC-mgw/build_unix sh ../dist/configure --enable-mingw --enable-cxx --disable-replication make 注意：卸载mingw安装包中pthread组件，否则，BDB会尝试构建repmgr模块（repmgr_posix.c需要posix支持，mingw32不支持）。 注意：2014.4.19更新，在用i686-w64-ming32编译的时候发现，repmgr模块还依赖iostream标准头文件，可以考虑直接--disable-replication，而不必删除编译器的pthread组件。sh ../dist/configure --enable-mingw --enable-cxx --disable-replication 3.3) Boost downloaded boost jam 3.1.18 cd \boost-1.50.0-mgw (0) 修改一个类的dll导出修饰 boost\program_options\detail\config_file.hpp, 参考最好的注意事项 (1) 准备bjam.exe，考虑到boost对mingw的支持不是很好，折中的办法是用vc++的命令行构建一个bjam（比如：bootstrap.bat vc9）；然后用这个b2.exe构建mingw版本的boost。 (2）执行 b2 --prefix=/d/workspace/temp install toolset=gcc link=shared variant=release runtime-link=shared threading=multi --without-mpi --without-python --without-wave --without-graph --without-graph_parallel 3.4) MiniUPnPc cd /c/miniupnpc-1.6-mgw make -f Makefile.mingw mkdir miniupnpc cp *.h miniupnpc/ （1）修改一个miniupnpc.def里面的LIBRARY指定的库名称为空的问题； （2）修改一个Makefile.mingw的del命令； （3）添加-Wl,前缀给-enable-stdcall-fixup选项 （4）可以考虑使用最新的版本，1.9.20140401版本，已经修复了上面提到的3个问题 3.5) libpng &nbsp; &nbsp; &nbsp; &nbsp; 编译png编码库(libpng下载地址)支持二维码生成 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ./configure --prefix=/usr/local/libpng-1.6.10 &amp;&amp; make &amp;&amp; make install &nbsp; &nbsp; &nbsp; 3.6) qrencode &nbsp; &nbsp; &nbsp; &nbsp; 二维码编码库(&nbsp;下载QREncode地址)，需要png和pkg-config支持，下载一个lite版本解压到mingw目录下 &nbsp; &nbsp; ./configure --prefix=/usr/local/qrencode-3.4.3 png_CFLAGS=&quot;-I/usr/local/libpng-1.6.10/include&quot; png_LIBS=&quot;-L/usr/local/libpng-1.6.10/lib -lpng16&quot; &amp;&amp; make &amp;&amp; make install &nbsp; 3.7) zlib &nbsp; $ make -f win32/Makefile.gcc install \ SHARED_MODE=1 \ DESTDIR=/usr/local/zlib-1.2.8/ \ BINARY_PATH=bin \ INCLUDE_PATH=include \ LIBRARY_PATH=lib &nbsp; &nbsp; &nbsp; 3.8) protobuf &nbsp; $ ./configure --prefix=/usr/local/protobuf-2.5.0 \ CPPFLAGS=-I/usr/local/zlib-1.2.8/include\ LDFLAGS=-L/usr/local/zlib-1.2.8/lib \ LIBS=-lz &nbsp; &nbsp; 4) 编译bitcoin客户端 &nbsp; &nbsp; 编译脚本samplebuild.sh的代码，请修改DEPEND_HOME变量 &nbsp; export DEPEND_HOME=/d/cifs/try/buildbtc/csdn/bitcoin/3rd ./configure \ --disable-tests \ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \ --with-miniupnpc=yes \ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \ LDFLAGS=&quot;-L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot;&nbsp; &nbsp; &nbsp; 4.1) 解决::UnRegisterSleepEx()错误 添加&nbsp;-D_WIN32_WINNT=0x0601&nbsp;-DWINVER=0x0601&nbsp; &nbsp; 4.2) 解决WSAPOLLFD未定义 参考：http://sourceforge.net/p/mingw/bugs/1980/&nbsp; &nbsp; 在mingw的winsock2.h里面的第912行附近添加 &nbsp; typedef struct pollfd { SOCKET fd; short events; short revents; } WSAPOLLFD, *PWSAPOLLFD, *LPWSAPOLLFD; &nbsp; 4.3) 解决boost连接问题 &nbsp; 参考这个comment &nbsp; 4.3.1) boost_program_options 查看src/m4/ax_boost_program_options.m4的第74行附近： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.so.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.dylib.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.a.*$;\1;&#39;` ; do 修改为： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.so.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.dylib.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dll.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.dll\.a.*$;\1;&#39;` ; do &nbsp; 4.3.2) boost_chrono 查看src/m4/ax_boost_chrono.m4的第81行附近： for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_chrono.*\)\.so.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.dylib.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.a.*$;\1;&#39;` ; do 修改为： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.dll.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_chrono.*\)\.so.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.dylib.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.dll\.a.*$;\1;&#39;` ; do &nbsp; 4.4) 修复bitcoin构建时的库依赖顺序 libbitcoin_wallet.a依赖于boost的filesystem,但是在src/Makefile.am里面boost_libs设置在libbitcoin_wallet.a之前，但是如果--disable-wallet编译不发现问题。 &nbsp; 参考：https://github.com/bitcoin/bitcoin/commit/d696820b45d9b6be1c21a65f2c8ed3b260938cb7 &nbsp; &nbsp; 5) 编译核心模块bitcoind sh autogen.sh &amp;&amp; sh samplebuild.sh &amp;&amp; make &nbsp; &nbsp; &nbsp; $ make &nbsp; &nbsp; ...//很多输出 &nbsp; CXXLD &nbsp;bitcoind.exe &nbsp; CXX &nbsp; &nbsp;bitcoin-cli.o &nbsp; CXXLD &nbsp;bitcoin-cli.exe make[3]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[2]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[1]: Entering directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master&#39; make[1]: Nothing to be done for `all-am&#39;. make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master&#39; &nbsp; 运行命令行版本的bitcoin的client，看看帮助提示: &nbsp; &nbsp; $ ./bitcoin-cli.exe --help Bitcoin RPC client version v0.8.2-820-gf65dc44-dirty-beta Usage: bitcoin-cli [options] &lt;command&gt; [params] Send command to Bitcoin server bitcoin-cli [options] help List commands bitcoin-cli [options] help &lt;command&gt; Get help for a command Options: -? This help message -conf=&lt;file&gt; Specify configuration file (default: bitcoin.conf) -datadir=&lt;dir&gt; Specify data directory -testnet Use the test network -rpcconnect=&lt;ip&gt; Send commands to node running on &lt;ip&gt; (default: 127.0.0 .1) -rpcwait Wait for RPC server to start -rpcuser=&lt;user&gt; Username for JSON-RPC connections -rpcpassword=&lt;pw&gt; Password for JSON-RPC connections -rpcport=&lt;port&gt; Connect to JSON-RPC on &lt;port&gt; (default: 8332 or testnet : 18332) SSL options: (see the Bitcoin Wiki for SSL setup instructions) -rpcssl Use OpenSSL (https) for JSON-RPC conn ections &nbsp; 6) 编译qt前端 &nbsp; 如何使用Ming32构建Qt，参考这个文章。 &nbsp; 构建好以后放到3rd目录下备用。 &nbsp; 另外下载google的protocbuf工具编译后，放到3rd目录下。 &nbsp; 楼主会在git上push所有的需要的lib和工具到3rd目录，包括打包用的makensis工具。 &nbsp; 好了吧，开始配置带qt前端的bticoin。 &nbsp; 示例脚本：samplebuild.sh &nbsp; export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46 export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd export PATH=$PATH:$MAKENSIS_HOME ./configure \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \ --with-miniupnpc=yes \ --with-qt-incdir=${QT_INC_HOME} \ --with-qt-libdir=${QT_LIB_HOME} \ --with-qt-bindir=${QT_BIN_HOME} \ --with-qt-plugindir=${QT_PLUGIN_HOME} \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \ LDFLAGS=&quot;-L${PROTOC_LIB_HOME}-L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot;&nbsp; &nbsp; 楼主没有打算使用pkg_config。有兴趣的同学可以试试。 &nbsp; 如果需要二维码支持，请使用这个sh samplebuild.sh &nbsp; export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46 export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins export QR_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/include export QR_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/lib export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd export PATH=$PATH:$MAKENSIS_HOME ./configure \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \ --with-miniupnpc=yes \ --with-qt-incdir=${QT_INC_HOME} \ --with-qt-libdir=${QT_LIB_HOME} \ --with-qt-bindir=${QT_BIN_HOME} \ --with-qt-plugindir=${QT_PLUGIN_HOME} \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ QR_LIBS=&quot;-lqrencode&quot; \ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${QR_INC_HOME} -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${PROTOC_LIB_HOME} -L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot; &nbsp; 然后再来一个make吧(mingw32-make可能会有CreateProcess失败的提示，linux和windows的路径的问题） &nbsp; 耐心的等待吧，时间还好，比qt4的构建时间短多了。&nbsp; &nbsp; 运行make deploy可以生成一个安装包，前提是你配置了了makensis打包软件。 并且需要修改一下share/setup.nsi里面的几个linux路径为windows路径, 主要是File指令后面的参数。 &nbsp; &nbsp; &nbsp; 安装吧，安装完成以后需要添加几个依赖的dll到安装目录，boost, miniupnpc, berkeley db, protocbuf， 以及mingw的crt等。 &nbsp; Done! &nbsp; 7) 注意事项 1) boost 1) GCC 4.8 warns of ignored attribute in declaration &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Ticket #8725&nbsp;(closed Bugs: fixed) 2)&nbsp;MINGW构建boost失败 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Ticket #6350: mingw.jam &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;boost官方网站表示cygwin和mingw的支持程度是不一样的 3) 导出common_config_file_iterator &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;https://github.com/boostorg/program_options/commit/4ae33ce15e5b6345e6eefa19466fdf7cd28a7bbd 2) MiniUPNPc 建议使用最新的1.9版本以上，已经修复以下几个1.6版本的问题： 1) 修改Makefile.mingw 这个是patch文件, 添加del 命令定义，添加-Wl,前缀 需要修改-enable-stdcall-fixup为-Wl,-enable-stdcall-fixup: 否则-enable-stdcall-fixup的-e会被理解成windows上可执行文件的入口指令，这应该是编译器的一个bug。 谢谢&nbsp;steking1&nbsp;同学的提醒 &nbsp; --- D:/cifs/lab/tarballs/Makefile.mingw 周二 四月 19 04:05:38 2011 +++ D:/cifs/lab/tarballs/Makefile.mingw.fixed 周二 二月 25 10:44:20 2014 @@ -8,6 +8,7 @@ CC = gcc #CFLAGS = -Wall -g -DDEBUG -D_WIN32_WINNT=0X501 CFLAGS = -Wall -Os -DNDEBUG -D_WIN32_WINNT=0X501 LDLIBS = -lws2_32 -liphlpapi +DEL = rm -rf # -lwsock32 # -liphlpapi is used for GetBestRoute() PYTHON=\utils\python25\python @@ -23,11 +24,11 @@ init: echo init &gt; init clean: - del upnpc testminixml *.o - del dll\*.o - del *.exe - del miniupnpc.dll - del libminiupnpc.a + $(DEL) upnpc testminixml *.o + $(DEL) dll\*.o + $(DEL) *.exe + $(DEL) miniupnpc.dll + $(DEL) libminiupnpc.a libminiupnpc.a: $(OBJS) $(AR) cr $@ $? @@ -58,10 +59,10 @@ upnpc.o: $(CC) $(CFLAGS) -c -o dll/$@ $&lt; upnpc-static: upnpc.o libminiupnpc.a - $(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS) + $(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS) upnpc-shared: dll/upnpc.o miniupnpc.lib - $(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS) + $(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS) wingenminiupnpcstrings: wingenminiupnpcstrings.o 2) 从DLL生成导入lib库的时候出错 dllwrap -k --driver-name gcc \ --def miniupnpc.def \ --output-def miniupnpc.dll.def \ --implib miniupnpc.lib -o miniupnpc.dll \ dll/miniwget.o dll/minixml.o dll/igd_desc_parse.o dll/minisoap.o dll/min iupnpc.o dll/upnpreplyparse.o dll/upnpcommands.o dll/upnperrors.o dll/connecthos tport.o dll/portlistingparse.o dll/receivedata.o -lws2_32 -liphlpapi D:\cifs\mingw32\bin\dlltool: Syntax error in def file miniupnpc.def:5 D:\cifs\mingw32\bin\dlltool: Syntax error in def file miniupnpc.def:5 看看def文件的前面5行，dlltool工具不允许空的library指令，修改一下，在第一行LIBRARY指令后面添加一下库的名字miniupnpc: &nbsp; LIBRARY miniupnpc ; miniupnpc library EXPORTS ; miniupnpc &nbsp; 3) BerkeleyDB 可以考虑直接禁用repmgr模块 --disable-replication,因为这个模块依赖依赖posix的一些系统api，mingw支持不好。 &nbsp; # Replication can be disabled. if test &quot;$db_cv_build_replication&quot; = &quot;yes&quot;; then AC_DEFINE(HAVE_REPLICATION) AH_TEMPLATE(HAVE_REPLICATION, [Define to 1 if building replication support.]) ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS \$(REP_OBJS)&quot; # If we&#39;re building replication and detected POSIX threads, build the # replication manager. AH_TEMPLATE(HAVE_REPLICATION_THREADS, [Define to 1 if building the Berkeley DB replication framework.]) if test &quot;$ac_cv_header_pthread_h&quot; = yes; then AC_DEFINE(HAVE_REPLICATION_THREADS) # Solaris requires the socket and nsl libraries to build the # replication manager. Don&#39;t add nsl regardless of the OS, # it causes RPC to fail on AIX 4.3.3. case &quot;$host_os&quot; in solaris*) AC_HAVE_LIBRARY(nsl, LIBSO_LIBS=&quot;$LIBSO_LIBS -lnsl&quot;) AC_HAVE_LIBRARY(socket, LIBSO_LIBS=&quot;$LIBSO_LIBS -lsocket&quot;);; esac ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS \$(REPMGR_OBJS)&quot; else ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS repmgr_stub${o}&quot; fi else ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS rep_stub${o} repmgr_stub${o}&quot; fi 4) mingw32在linux交叉编译openssl http://www.blogcompiler.com/2011/12/21/openssl-for-windows/ http://www.wagner.pp.ru/~vitus/articles/openssl-mingw.html &nbsp; 5) 自动脚本 for windows native building with mingw64, with GUI, used for client # 1) zlib make install -f win32/Makefile.gcc \ DESTDIR=/usr/local/zlib-1.2.8/ \ INCLUDE_PATH=include \ LIBRARY_PATH=lib \ BINARY_PATH=bin # 2) libpng ./configure --prefix=/usr/local/libpng-1.6.9 \ --enable-shared=no \ --enable-static=yes # 3) qrencode ./configure --prefix=/usr/local/qrencode-3.4.3 \ --enable-shared=no \ --enable-static=yes \ png_CFLAGS=&quot;-I/usr/local/libpng-1.6.9/include&quot; \ png_LIBS=&quot;-L/usr/local/libpng-1.6.9/lib -lpng16&quot; # 4) protobuf ./configure --prefix=/usr/local/protobuf-2.5.0 \ --enable-static=yes \ --enable-shared=no # 5) BerkeleyDB cd build_unix &amp;&amp; sh ../dist/configure \ --enable-mingw \ --enable-cxx \ --disable-replication # 6) miniupnpc make -f Makefile.mingw &amp;&amp; mkdir miniupnpc &amp;&amp; cp *.h miniupnpc # 7) OpenSSL ./config \ no-shared \ no-threads \ no-asm \ no-zlib \ --prefix=/usr/local/ssl \ &amp;&amp; make &amp;&amp; make install # 8) Boost b2 install --prefix=/usr/local/boost-1.53 \ toolset=gcc \ link=shared \ variant=release \ runtime-link=shared \ threading=multi \ --without-mpi \ --without-python \ --without-wave \ --without-graph \ --without-graph_parallel # 9) qt4 configure.exe \ -I &quot;/usr/local/ssl/include&quot; \ -L &quot;/usr/local/ssl/lib&quot; \ -l ssl \ -l crypto \ -release \ -opensource \ -confirm-license \ -static \ -no-ltcg \ -no-fast \ -exceptions \ -accessibility \ -stl \ -no-sql-sqlite \ -no-qt3support \ -no-opengl \ -no-openvg \ -platform win32-g++ \ -no-system-proxies \ -qt-zlib \ -no-gif \ -qt-libpng \ -no-libmng \ -no-libtiff \ -qt-libjpeg \ -no-dsp \ -no-vcproj \ -no-incredibuild-xge \ -plugin-manifests \ -qmake \ -process -nomake demos -nomake examples -nomake tools \ -no-rtti \ -no-mmx \ -no-3dnow \ -no-sse \ -no-sse2 \ -openssl \ -no-dbus \ -no-phonon -no-phonon-backend \ -no-multimedia -no-audio-backend \ -no-webkit \ -no-script -no-scripttools -no-declarative \ -arch windows \ -no-style-plastique \ -no-style-windowsxp -no-style-windowsvista \ -no-style-cleanlooks -no-style-cde \ -no-style-motif \ -no-native-gestures \ -saveconfig csdnbuild # 10) export DEPEND_HOME=/usr/local export MAKENSIS_HOME=${DEPEND_HOME}/nsis-2.46 export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/include export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/lib export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.55 export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.55/include/boost-1_55 export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.55/lib export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.9/include export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.9/lib export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib export QT_BIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/bin export QT_INC_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/include export QT_LIB_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/lib export QT_PLUGIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins export QT_CODECS_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins/codecs export SSL_INC_HOME=${DEPEND_HOME}/ssl/include export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib export PATH=${PATH}:${MAKENSIS_HOME} ./configure \ --enable-wallet \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${BOOST_TOP_HOME}&quot; \ --with-qrencode=yes \ --with-miniupnpc=yes \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ --with-cli=yes \ --with-daemon=yes \ --with-gui=qt4 \ --with-qt-incdir=${QT_INC_HOME} \ --with-qt-libdir=${QT_LIB_HOME} \ --with-qt-bindir=${QT_BIN_HOME} \ --with-qt-plugindir=${QT_PLUGIN_HOME} \ CPPFLAGS=&quot;-w -g -O0 -I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}&quot; \ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${QT_CODECS_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}&quot; &nbsp; for linux native building with gcc, without gui, used for mining and service. # 1) Boost ./b2 install --prefix=/root/harrywu/build/3rd/boost toolset=gcc variant=release link=static threading=multi runtime-link=static --without-graph --without-graph_parallel --without-mpi --without-python --without-regex --without-wave # 2) BerkeleyDB cd build_unix &amp;&amp; ../dist/configure --prefix=/root/harrywu/build/3rd/bdb48 --enable-static=yes --enable-shared=no --enable-cxx --disable-replication --disable-debug # 3) miniupnpc make DESTDIR=/root/harrywu/build/3rd/miniupnpc-1.9.0 INSTALLPREFIX= install # 4) protobuf ./configure --prefix=/root/harrywu/build/3rd/protobuf-2.5.0 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz # 5) qrencode ./configure --prefix=/root/harrywu/build/3rd/qrencode-3.4.3 --enable-shared=no --enable-static=yes png_CFLAGS=-I/root/harrywu/build/3rd/libpng-1.6.10/ png_LIBS=-L/root/harrywu/build/3rd/libpng-1.6.10/lib/ -lpng16 # 6) ssl ./config no-threads no-shared no-zlib no-asm --prefix=/root/harrywu/build/3rd/ssl # 7) zlib ./configure --prefix=/root/harrywu/build/3rd/zlib-1.2.8 --static # 8) libpng ./configure --prefix=/root/harrywu/build/3rd/libpng-1.6.10 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz # 9) qt missing # 10) Bitcoin export DEPEND_HOME=/root/harrywu/build/3rd export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/include export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/lib export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.53 export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.53/include/boost-1_55 export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.53/lib export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.10/include export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.10/lib export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib export SSL_INC_HOME=${DEPEND_HOME}/ssl/include export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib ./configure \ --enable-wallet \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${BOOST_TOP_HOME}&quot; \ --with-qrencode=yes \ --with-miniupnpc=yes \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ --with-cli=yes \ --with-daemon=yes \ --with-gui=no \ CPPFLAGS=&quot;-I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}&quot; \ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}&quot; \ LIBS=&quot;-lrt -ldl&quot; &nbsp; &nbsp; &nbsp; 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wuzh1230/article/details/17020689 https://github.com/imharrywu/fastcoin本帖只谈技术实现，首先我们自己来编译一个比特币客户端吧， 技术讨论QQ群，161928517，欢迎大家入伙(注明：csdn)。 &nbsp; 2014.7.18更新: 静态编译的第三方依赖和MINGW64工具链以及v0.9.1的官方源代码： https://github.com/imharrywu/fastcoin &nbsp; 本文遇到的问题大部分是使用动态库构建的时候遇到的，仅仅作为一个备份，大家可以直接迁出上面的代码或者直接跳到本文的最后看《自动脚本》 本地化的travis构建脚本 不带任何qt-style风格的qt界面库构建出来的比特币satoshi客户端 ======================================================================================================================= &nbsp; &nbsp; &nbsp; &nbsp; 先看一下最后编出来的带qt前端的客户端版本截图，会有测试版本提示 (使用tag的源代码编译正式版本) &nbsp; &nbsp; (建议：备份您之前安装的%APPDATA%bitcoin目录)。 &nbsp; 参考github上的描述文件 https://github.com/bitcoin/bitcoin/blob/master/doc/build-msw.md &nbsp; 1) 签出代码 GitHub上的官方源代码 &nbsp; git clone https://github.com/bitcoin/bitcoin.git &nbsp; 也可以从csdn的code上签出本文的整个项目组 &nbsp; &nbsp; git clone git://code.csdn.net/wuzh1230/bitcoin.git &nbsp; 提示： &nbsp; &lt;1&gt;已经包含了预编译的依赖库在3rd目录下； &lt;2&gt;已经包含了ming32工具链，请修改msys/1.0/etc/fstab。 &lt;3&gt;文章遇到的问题大多是使用动态库构造的时候遇到的，建议大家用--enable-static构造所有的依赖，直接跳到最后一节《自动脚本》。 &nbsp; &nbsp; 2) 下载依赖包 Libraries you need to download separately and build: name default path download ---------------------------------------------------- OpenSSL \openssl-1.0.1c-mgw http://www.openssl.org/source/ Berkeley DB \db-4.8.30.NC-mgw http://www.oracle.com/technology/software/products/berkeley-db/index.html Boost \boost-1.50.0-mgw http://www.boost.org/users/download/ miniupnpc \miniupnpc-1.6-mgw http://miniupnp.tuxfamily.org/files/ &nbsp; 3) 编译依赖包 &nbsp; 3.1) OpenSSL &nbsp; cd /c/openssl-1.0.1c-mgw ./config make 未发现问题，如有任何问题，欢迎讨论。 3.2) Berkeley DB cd /c/db-4.8.30.NC-mgw/build_unix sh ../dist/configure --enable-mingw --enable-cxx --disable-replication make 注意：卸载mingw安装包中pthread组件，否则，BDB会尝试构建repmgr模块（repmgr_posix.c需要posix支持，mingw32不支持）。 注意：2014.4.19更新，在用i686-w64-ming32编译的时候发现，repmgr模块还依赖iostream标准头文件，可以考虑直接--disable-replication，而不必删除编译器的pthread组件。sh ../dist/configure --enable-mingw --enable-cxx --disable-replication 3.3) Boost downloaded boost jam 3.1.18 cd \boost-1.50.0-mgw (0) 修改一个类的dll导出修饰 boost\program_options\detail\config_file.hpp, 参考最好的注意事项 (1) 准备bjam.exe，考虑到boost对mingw的支持不是很好，折中的办法是用vc++的命令行构建一个bjam（比如：bootstrap.bat vc9）；然后用这个b2.exe构建mingw版本的boost。 (2）执行 b2 --prefix=/d/workspace/temp install toolset=gcc link=shared variant=release runtime-link=shared threading=multi --without-mpi --without-python --without-wave --without-graph --without-graph_parallel 3.4) MiniUPnPc cd /c/miniupnpc-1.6-mgw make -f Makefile.mingw mkdir miniupnpc cp *.h miniupnpc/ （1）修改一个miniupnpc.def里面的LIBRARY指定的库名称为空的问题； （2）修改一个Makefile.mingw的del命令； （3）添加-Wl,前缀给-enable-stdcall-fixup选项 （4）可以考虑使用最新的版本，1.9.20140401版本，已经修复了上面提到的3个问题 3.5) libpng &nbsp; &nbsp; &nbsp; &nbsp; 编译png编码库(libpng下载地址)支持二维码生成 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ./configure --prefix=/usr/local/libpng-1.6.10 &amp;&amp; make &amp;&amp; make install &nbsp; &nbsp; &nbsp; 3.6) qrencode &nbsp; &nbsp; &nbsp; &nbsp; 二维码编码库(&nbsp;下载QREncode地址)，需要png和pkg-config支持，下载一个lite版本解压到mingw目录下 &nbsp; &nbsp; ./configure --prefix=/usr/local/qrencode-3.4.3 png_CFLAGS=&quot;-I/usr/local/libpng-1.6.10/include&quot; png_LIBS=&quot;-L/usr/local/libpng-1.6.10/lib -lpng16&quot; &amp;&amp; make &amp;&amp; make install &nbsp; 3.7) zlib &nbsp; $ make -f win32/Makefile.gcc install \ SHARED_MODE=1 \ DESTDIR=/usr/local/zlib-1.2.8/ \ BINARY_PATH=bin \ INCLUDE_PATH=include \ LIBRARY_PATH=lib &nbsp; &nbsp; &nbsp; 3.8) protobuf &nbsp; $ ./configure --prefix=/usr/local/protobuf-2.5.0 \ CPPFLAGS=-I/usr/local/zlib-1.2.8/include\ LDFLAGS=-L/usr/local/zlib-1.2.8/lib \ LIBS=-lz &nbsp; &nbsp; 4) 编译bitcoin客户端 &nbsp; &nbsp; 编译脚本samplebuild.sh的代码，请修改DEPEND_HOME变量 &nbsp; export DEPEND_HOME=/d/cifs/try/buildbtc/csdn/bitcoin/3rd ./configure \ --disable-tests \ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \ --with-miniupnpc=yes \ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \ LDFLAGS=&quot;-L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot;&nbsp; &nbsp; &nbsp; 4.1) 解决::UnRegisterSleepEx()错误 添加&nbsp;-D_WIN32_WINNT=0x0601&nbsp;-DWINVER=0x0601&nbsp; &nbsp; 4.2) 解决WSAPOLLFD未定义 参考：http://sourceforge.net/p/mingw/bugs/1980/&nbsp; &nbsp; 在mingw的winsock2.h里面的第912行附近添加 &nbsp; typedef struct pollfd { SOCKET fd; short events; short revents; } WSAPOLLFD, *PWSAPOLLFD, *LPWSAPOLLFD; &nbsp; 4.3) 解决boost连接问题 &nbsp; 参考这个comment &nbsp; 4.3.1) boost_program_options 查看src/m4/ax_boost_program_options.m4的第74行附近： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.so.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.dylib.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.a.*$;\1;&#39;` ; do 修改为： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.so.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.dylib.*$;\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dll.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_program_options.*\)\.dll\.a.*$;\1;&#39;` ; do &nbsp; 4.3.2) boost_chrono 查看src/m4/ax_boost_chrono.m4的第81行附近： for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_chrono.*\)\.so.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.dylib.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.a.*$;\1;&#39;` ; do 修改为： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.dll.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\(boost_chrono.*\)\.so.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.dylib.*$;\1;&#39; -e &#39;s;^lib\(boost_chrono.*\)\.dll\.a.*$;\1;&#39;` ; do &nbsp; 4.4) 修复bitcoin构建时的库依赖顺序 libbitcoin_wallet.a依赖于boost的filesystem,但是在src/Makefile.am里面boost_libs设置在libbitcoin_wallet.a之前，但是如果--disable-wallet编译不发现问题。 &nbsp; 参考：https://github.com/bitcoin/bitcoin/commit/d696820b45d9b6be1c21a65f2c8ed3b260938cb7 &nbsp; &nbsp; 5) 编译核心模块bitcoind sh autogen.sh &amp;&amp; sh samplebuild.sh &amp;&amp; make &nbsp; &nbsp; &nbsp; $ make &nbsp; &nbsp; ...//很多输出 &nbsp; CXXLD &nbsp;bitcoind.exe &nbsp; CXX &nbsp; &nbsp;bitcoin-cli.o &nbsp; CXXLD &nbsp;bitcoin-cli.exe make[3]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[2]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[1]: Entering directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master&#39; make[1]: Nothing to be done for `all-am&#39;. make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master&#39; &nbsp; 运行命令行版本的bitcoin的client，看看帮助提示: &nbsp; &nbsp; $ ./bitcoin-cli.exe --help Bitcoin RPC client version v0.8.2-820-gf65dc44-dirty-beta Usage: bitcoin-cli [options] &lt;command&gt; [params] Send command to Bitcoin server bitcoin-cli [options] help List commands bitcoin-cli [options] help &lt;command&gt; Get help for a command Options: -? This help message -conf=&lt;file&gt; Specify configuration file (default: bitcoin.conf) -datadir=&lt;dir&gt; Specify data directory -testnet Use the test network -rpcconnect=&lt;ip&gt; Send commands to node running on &lt;ip&gt; (default: 127.0.0 .1) -rpcwait Wait for RPC server to start -rpcuser=&lt;user&gt; Username for JSON-RPC connections -rpcpassword=&lt;pw&gt; Password for JSON-RPC connections -rpcport=&lt;port&gt; Connect to JSON-RPC on &lt;port&gt; (default: 8332 or testnet : 18332) SSL options: (see the Bitcoin Wiki for SSL setup instructions) -rpcssl Use OpenSSL (https) for JSON-RPC conn ections &nbsp; 6) 编译qt前端 &nbsp; 如何使用Ming32构建Qt，参考这个文章。 &nbsp; 构建好以后放到3rd目录下备用。 &nbsp; 另外下载google的protocbuf工具编译后，放到3rd目录下。 &nbsp; 楼主会在git上push所有的需要的lib和工具到3rd目录，包括打包用的makensis工具。 &nbsp; 好了吧，开始配置带qt前端的bticoin。 &nbsp; 示例脚本：samplebuild.sh &nbsp; export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46 export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd export PATH=$PATH:$MAKENSIS_HOME ./configure \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \ --with-miniupnpc=yes \ --with-qt-incdir=${QT_INC_HOME} \ --with-qt-libdir=${QT_LIB_HOME} \ --with-qt-bindir=${QT_BIN_HOME} \ --with-qt-plugindir=${QT_PLUGIN_HOME} \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \ LDFLAGS=&quot;-L${PROTOC_LIB_HOME}-L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot;&nbsp; &nbsp; 楼主没有打算使用pkg_config。有兴趣的同学可以试试。 &nbsp; 如果需要二维码支持，请使用这个sh samplebuild.sh &nbsp; export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46 export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins export QR_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/include export QR_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/lib export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd export PATH=$PATH:$MAKENSIS_HOME ./configure \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \ --with-miniupnpc=yes \ --with-qt-incdir=${QT_INC_HOME} \ --with-qt-libdir=${QT_LIB_HOME} \ --with-qt-bindir=${QT_BIN_HOME} \ --with-qt-plugindir=${QT_PLUGIN_HOME} \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ QR_LIBS=&quot;-lqrencode&quot; \ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${QR_INC_HOME} -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${PROTOC_LIB_HOME} -L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot; &nbsp; 然后再来一个make吧(mingw32-make可能会有CreateProcess失败的提示，linux和windows的路径的问题） &nbsp; 耐心的等待吧，时间还好，比qt4的构建时间短多了。&nbsp; &nbsp; 运行make deploy可以生成一个安装包，前提是你配置了了makensis打包软件。 并且需要修改一下share/setup.nsi里面的几个linux路径为windows路径, 主要是File指令后面的参数。 &nbsp; &nbsp; &nbsp; 安装吧，安装完成以后需要添加几个依赖的dll到安装目录，boost, miniupnpc, berkeley db, protocbuf， 以及mingw的crt等。 &nbsp; Done! &nbsp; 7) 注意事项 1) boost 1) GCC 4.8 warns of ignored attribute in declaration &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Ticket #8725&nbsp;(closed Bugs: fixed) 2)&nbsp;MINGW构建boost失败 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Ticket #6350: mingw.jam &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;boost官方网站表示cygwin和mingw的支持程度是不一样的 3) 导出common_config_file_iterator &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;https://github.com/boostorg/program_options/commit/4ae33ce15e5b6345e6eefa19466fdf7cd28a7bbd 2) MiniUPNPc 建议使用最新的1.9版本以上，已经修复以下几个1.6版本的问题： 1) 修改Makefile.mingw 这个是patch文件, 添加del 命令定义，添加-Wl,前缀 需要修改-enable-stdcall-fixup为-Wl,-enable-stdcall-fixup: 否则-enable-stdcall-fixup的-e会被理解成windows上可执行文件的入口指令，这应该是编译器的一个bug。 谢谢&nbsp;steking1&nbsp;同学的提醒 &nbsp; --- D:/cifs/lab/tarballs/Makefile.mingw 周二 四月 19 04:05:38 2011 +++ D:/cifs/lab/tarballs/Makefile.mingw.fixed 周二 二月 25 10:44:20 2014 @@ -8,6 +8,7 @@ CC = gcc #CFLAGS = -Wall -g -DDEBUG -D_WIN32_WINNT=0X501 CFLAGS = -Wall -Os -DNDEBUG -D_WIN32_WINNT=0X501 LDLIBS = -lws2_32 -liphlpapi +DEL = rm -rf # -lwsock32 # -liphlpapi is used for GetBestRoute() PYTHON=\utils\python25\python @@ -23,11 +24,11 @@ init: echo init &gt; init clean: - del upnpc testminixml *.o - del dll\*.o - del *.exe - del miniupnpc.dll - del libminiupnpc.a + $(DEL) upnpc testminixml *.o + $(DEL) dll\*.o + $(DEL) *.exe + $(DEL) miniupnpc.dll + $(DEL) libminiupnpc.a libminiupnpc.a: $(OBJS) $(AR) cr $@ $? @@ -58,10 +59,10 @@ upnpc.o: $(CC) $(CFLAGS) -c -o dll/$@ $&lt; upnpc-static: upnpc.o libminiupnpc.a - $(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS) + $(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS) upnpc-shared: dll/upnpc.o miniupnpc.lib - $(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS) + $(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS) wingenminiupnpcstrings: wingenminiupnpcstrings.o 2) 从DLL生成导入lib库的时候出错 dllwrap -k --driver-name gcc \ --def miniupnpc.def \ --output-def miniupnpc.dll.def \ --implib miniupnpc.lib -o miniupnpc.dll \ dll/miniwget.o dll/minixml.o dll/igd_desc_parse.o dll/minisoap.o dll/min iupnpc.o dll/upnpreplyparse.o dll/upnpcommands.o dll/upnperrors.o dll/connecthos tport.o dll/portlistingparse.o dll/receivedata.o -lws2_32 -liphlpapi D:\cifs\mingw32\bin\dlltool: Syntax error in def file miniupnpc.def:5 D:\cifs\mingw32\bin\dlltool: Syntax error in def file miniupnpc.def:5 看看def文件的前面5行，dlltool工具不允许空的library指令，修改一下，在第一行LIBRARY指令后面添加一下库的名字miniupnpc: &nbsp; LIBRARY miniupnpc ; miniupnpc library EXPORTS ; miniupnpc &nbsp; 3) BerkeleyDB 可以考虑直接禁用repmgr模块 --disable-replication,因为这个模块依赖依赖posix的一些系统api，mingw支持不好。 &nbsp; # Replication can be disabled. if test &quot;$db_cv_build_replication&quot; = &quot;yes&quot;; then AC_DEFINE(HAVE_REPLICATION) AH_TEMPLATE(HAVE_REPLICATION, [Define to 1 if building replication support.]) ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS \$(REP_OBJS)&quot; # If we&#39;re building replication and detected POSIX threads, build the # replication manager. AH_TEMPLATE(HAVE_REPLICATION_THREADS, [Define to 1 if building the Berkeley DB replication framework.]) if test &quot;$ac_cv_header_pthread_h&quot; = yes; then AC_DEFINE(HAVE_REPLICATION_THREADS) # Solaris requires the socket and nsl libraries to build the # replication manager. Don&#39;t add nsl regardless of the OS, # it causes RPC to fail on AIX 4.3.3. case &quot;$host_os&quot; in solaris*) AC_HAVE_LIBRARY(nsl, LIBSO_LIBS=&quot;$LIBSO_LIBS -lnsl&quot;) AC_HAVE_LIBRARY(socket, LIBSO_LIBS=&quot;$LIBSO_LIBS -lsocket&quot;);; esac ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS \$(REPMGR_OBJS)&quot; else ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS repmgr_stub${o}&quot; fi else ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS rep_stub${o} repmgr_stub${o}&quot; fi 4) mingw32在linux交叉编译openssl http://www.blogcompiler.com/2011/12/21/openssl-for-windows/ http://www.wagner.pp.ru/~vitus/articles/openssl-mingw.html &nbsp; 5) 自动脚本 for windows native building with mingw64, with GUI, used for client # 1) zlib make install -f win32/Makefile.gcc \ DESTDIR=/usr/local/zlib-1.2.8/ \ INCLUDE_PATH=include \ LIBRARY_PATH=lib \ BINARY_PATH=bin # 2) libpng ./configure --prefix=/usr/local/libpng-1.6.9 \ --enable-shared=no \ --enable-static=yes # 3) qrencode ./configure --prefix=/usr/local/qrencode-3.4.3 \ --enable-shared=no \ --enable-static=yes \ png_CFLAGS=&quot;-I/usr/local/libpng-1.6.9/include&quot; \ png_LIBS=&quot;-L/usr/local/libpng-1.6.9/lib -lpng16&quot; # 4) protobuf ./configure --prefix=/usr/local/protobuf-2.5.0 \ --enable-static=yes \ --enable-shared=no # 5) BerkeleyDB cd build_unix &amp;&amp; sh ../dist/configure \ --enable-mingw \ --enable-cxx \ --disable-replication # 6) miniupnpc make -f Makefile.mingw &amp;&amp; mkdir miniupnpc &amp;&amp; cp *.h miniupnpc # 7) OpenSSL ./config \ no-shared \ no-threads \ no-asm \ no-zlib \ --prefix=/usr/local/ssl \ &amp;&amp; make &amp;&amp; make install # 8) Boost b2 install --prefix=/usr/local/boost-1.53 \ toolset=gcc \ link=shared \ variant=release \ runtime-link=shared \ threading=multi \ --without-mpi \ --without-python \ --without-wave \ --without-graph \ --without-graph_parallel # 9) qt4 configure.exe \ -I &quot;/usr/local/ssl/include&quot; \ -L &quot;/usr/local/ssl/lib&quot; \ -l ssl \ -l crypto \ -release \ -opensource \ -confirm-license \ -static \ -no-ltcg \ -no-fast \ -exceptions \ -accessibility \ -stl \ -no-sql-sqlite \ -no-qt3support \ -no-opengl \ -no-openvg \ -platform win32-g++ \ -no-system-proxies \ -qt-zlib \ -no-gif \ -qt-libpng \ -no-libmng \ -no-libtiff \ -qt-libjpeg \ -no-dsp \ -no-vcproj \ -no-incredibuild-xge \ -plugin-manifests \ -qmake \ -process -nomake demos -nomake examples -nomake tools \ -no-rtti \ -no-mmx \ -no-3dnow \ -no-sse \ -no-sse2 \ -openssl \ -no-dbus \ -no-phonon -no-phonon-backend \ -no-multimedia -no-audio-backend \ -no-webkit \ -no-script -no-scripttools -no-declarative \ -arch windows \ -no-style-plastique \ -no-style-windowsxp -no-style-windowsvista \ -no-style-cleanlooks -no-style-cde \ -no-style-motif \ -no-native-gestures \ -saveconfig csdnbuild # 10) export DEPEND_HOME=/usr/local export MAKENSIS_HOME=${DEPEND_HOME}/nsis-2.46 export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/include export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/lib export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.55 export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.55/include/boost-1_55 export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.55/lib export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.9/include export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.9/lib export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib export QT_BIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/bin export QT_INC_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/include export QT_LIB_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/lib export QT_PLUGIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins export QT_CODECS_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins/codecs export SSL_INC_HOME=${DEPEND_HOME}/ssl/include export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib export PATH=${PATH}:${MAKENSIS_HOME} ./configure \ --enable-wallet \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${BOOST_TOP_HOME}&quot; \ --with-qrencode=yes \ --with-miniupnpc=yes \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ --with-cli=yes \ --with-daemon=yes \ --with-gui=qt4 \ --with-qt-incdir=${QT_INC_HOME} \ --with-qt-libdir=${QT_LIB_HOME} \ --with-qt-bindir=${QT_BIN_HOME} \ --with-qt-plugindir=${QT_PLUGIN_HOME} \ CPPFLAGS=&quot;-w -g -O0 -I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}&quot; \ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${QT_CODECS_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}&quot; &nbsp; for linux native building with gcc, without gui, used for mining and service. # 1) Boost ./b2 install --prefix=/root/harrywu/build/3rd/boost toolset=gcc variant=release link=static threading=multi runtime-link=static --without-graph --without-graph_parallel --without-mpi --without-python --without-regex --without-wave # 2) BerkeleyDB cd build_unix &amp;&amp; ../dist/configure --prefix=/root/harrywu/build/3rd/bdb48 --enable-static=yes --enable-shared=no --enable-cxx --disable-replication --disable-debug # 3) miniupnpc make DESTDIR=/root/harrywu/build/3rd/miniupnpc-1.9.0 INSTALLPREFIX= install # 4) protobuf ./configure --prefix=/root/harrywu/build/3rd/protobuf-2.5.0 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz # 5) qrencode ./configure --prefix=/root/harrywu/build/3rd/qrencode-3.4.3 --enable-shared=no --enable-static=yes png_CFLAGS=-I/root/harrywu/build/3rd/libpng-1.6.10/ png_LIBS=-L/root/harrywu/build/3rd/libpng-1.6.10/lib/ -lpng16 # 6) ssl ./config no-threads no-shared no-zlib no-asm --prefix=/root/harrywu/build/3rd/ssl # 7) zlib ./configure --prefix=/root/harrywu/build/3rd/zlib-1.2.8 --static # 8) libpng ./configure --prefix=/root/harrywu/build/3rd/libpng-1.6.10 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz # 9) qt missing # 10) Bitcoin export DEPEND_HOME=/root/harrywu/build/3rd export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/include export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/lib export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.53 export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.53/include/boost-1_55 export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.53/lib export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.10/include export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.10/lib export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib export SSL_INC_HOME=${DEPEND_HOME}/ssl/include export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib ./configure \ --enable-wallet \ --disable-tests \ --disable-ipv6 \ --disable-ccache \ --with-boost=&quot;${BOOST_TOP_HOME}&quot; \ --with-qrencode=yes \ --with-miniupnpc=yes \ --with-protoc-bindir=${PROTOC_BIN_HOME} \ --with-cli=yes \ --with-daemon=yes \ --with-gui=no \ CPPFLAGS=&quot;-I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}&quot; \ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}&quot; \ LIBS=&quot;-lrt -ldl&quot; &nbsp; &nbsp; &nbsp; 阅读更多" />
<link rel="canonical" href="https://mlh.app/2013/11/29/ab156e38875455f66bfd3e10d058fbb9.html" />
<meta property="og:url" content="https://mlh.app/2013/11/29/ab156e38875455f66bfd3e10d058fbb9.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-11-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wuzh1230/article/details/17020689 https://github.com/imharrywu/fastcoin本帖只谈技术实现，首先我们自己来编译一个比特币客户端吧， 技术讨论QQ群，161928517，欢迎大家入伙(注明：csdn)。 &nbsp; 2014.7.18更新: 静态编译的第三方依赖和MINGW64工具链以及v0.9.1的官方源代码： https://github.com/imharrywu/fastcoin &nbsp; 本文遇到的问题大部分是使用动态库构建的时候遇到的，仅仅作为一个备份，大家可以直接迁出上面的代码或者直接跳到本文的最后看《自动脚本》 本地化的travis构建脚本 不带任何qt-style风格的qt界面库构建出来的比特币satoshi客户端 ======================================================================================================================= &nbsp; &nbsp; &nbsp; &nbsp; 先看一下最后编出来的带qt前端的客户端版本截图，会有测试版本提示 (使用tag的源代码编译正式版本) &nbsp; &nbsp; (建议：备份您之前安装的%APPDATA%bitcoin目录)。 &nbsp; 参考github上的描述文件 https://github.com/bitcoin/bitcoin/blob/master/doc/build-msw.md &nbsp; 1) 签出代码 GitHub上的官方源代码 &nbsp; git clone https://github.com/bitcoin/bitcoin.git &nbsp; 也可以从csdn的code上签出本文的整个项目组 &nbsp; &nbsp; git clone git://code.csdn.net/wuzh1230/bitcoin.git &nbsp; 提示： &nbsp; &lt;1&gt;已经包含了预编译的依赖库在3rd目录下； &lt;2&gt;已经包含了ming32工具链，请修改msys/1.0/etc/fstab。 &lt;3&gt;文章遇到的问题大多是使用动态库构造的时候遇到的，建议大家用--enable-static构造所有的依赖，直接跳到最后一节《自动脚本》。 &nbsp; &nbsp; 2) 下载依赖包 Libraries you need to download separately and build: name default path download ---------------------------------------------------- OpenSSL \\openssl-1.0.1c-mgw http://www.openssl.org/source/ Berkeley DB \\db-4.8.30.NC-mgw http://www.oracle.com/technology/software/products/berkeley-db/index.html Boost \\boost-1.50.0-mgw http://www.boost.org/users/download/ miniupnpc \\miniupnpc-1.6-mgw http://miniupnp.tuxfamily.org/files/ &nbsp; 3) 编译依赖包 &nbsp; 3.1) OpenSSL &nbsp; cd /c/openssl-1.0.1c-mgw ./config make 未发现问题，如有任何问题，欢迎讨论。 3.2) Berkeley DB cd /c/db-4.8.30.NC-mgw/build_unix sh ../dist/configure --enable-mingw --enable-cxx --disable-replication make 注意：卸载mingw安装包中pthread组件，否则，BDB会尝试构建repmgr模块（repmgr_posix.c需要posix支持，mingw32不支持）。 注意：2014.4.19更新，在用i686-w64-ming32编译的时候发现，repmgr模块还依赖iostream标准头文件，可以考虑直接--disable-replication，而不必删除编译器的pthread组件。sh ../dist/configure --enable-mingw --enable-cxx --disable-replication 3.3) Boost downloaded boost jam 3.1.18 cd \\boost-1.50.0-mgw (0) 修改一个类的dll导出修饰 boost\\program_options\\detail\\config_file.hpp, 参考最好的注意事项 (1) 准备bjam.exe，考虑到boost对mingw的支持不是很好，折中的办法是用vc++的命令行构建一个bjam（比如：bootstrap.bat vc9）；然后用这个b2.exe构建mingw版本的boost。 (2）执行 b2 --prefix=/d/workspace/temp install toolset=gcc link=shared variant=release runtime-link=shared threading=multi --without-mpi --without-python --without-wave --without-graph --without-graph_parallel 3.4) MiniUPnPc cd /c/miniupnpc-1.6-mgw make -f Makefile.mingw mkdir miniupnpc cp *.h miniupnpc/ （1）修改一个miniupnpc.def里面的LIBRARY指定的库名称为空的问题； （2）修改一个Makefile.mingw的del命令； （3）添加-Wl,前缀给-enable-stdcall-fixup选项 （4）可以考虑使用最新的版本，1.9.20140401版本，已经修复了上面提到的3个问题 3.5) libpng &nbsp; &nbsp; &nbsp; &nbsp; 编译png编码库(libpng下载地址)支持二维码生成 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ./configure --prefix=/usr/local/libpng-1.6.10 &amp;&amp; make &amp;&amp; make install &nbsp; &nbsp; &nbsp; 3.6) qrencode &nbsp; &nbsp; &nbsp; &nbsp; 二维码编码库(&nbsp;下载QREncode地址)，需要png和pkg-config支持，下载一个lite版本解压到mingw目录下 &nbsp; &nbsp; ./configure --prefix=/usr/local/qrencode-3.4.3 png_CFLAGS=&quot;-I/usr/local/libpng-1.6.10/include&quot; png_LIBS=&quot;-L/usr/local/libpng-1.6.10/lib -lpng16&quot; &amp;&amp; make &amp;&amp; make install &nbsp; 3.7) zlib &nbsp; $ make -f win32/Makefile.gcc install \\ SHARED_MODE=1 \\ DESTDIR=/usr/local/zlib-1.2.8/ \\ BINARY_PATH=bin \\ INCLUDE_PATH=include \\ LIBRARY_PATH=lib &nbsp; &nbsp; &nbsp; 3.8) protobuf &nbsp; $ ./configure --prefix=/usr/local/protobuf-2.5.0 \\ CPPFLAGS=-I/usr/local/zlib-1.2.8/include\\ LDFLAGS=-L/usr/local/zlib-1.2.8/lib \\ LIBS=-lz &nbsp; &nbsp; 4) 编译bitcoin客户端 &nbsp; &nbsp; 编译脚本samplebuild.sh的代码，请修改DEPEND_HOME变量 &nbsp; export DEPEND_HOME=/d/cifs/try/buildbtc/csdn/bitcoin/3rd ./configure \\ --disable-tests \\ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \\ --with-miniupnpc=yes \\ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \\ LDFLAGS=&quot;-L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot;&nbsp; &nbsp; &nbsp; 4.1) 解决::UnRegisterSleepEx()错误 添加&nbsp;-D_WIN32_WINNT=0x0601&nbsp;-DWINVER=0x0601&nbsp; &nbsp; 4.2) 解决WSAPOLLFD未定义 参考：http://sourceforge.net/p/mingw/bugs/1980/&nbsp; &nbsp; 在mingw的winsock2.h里面的第912行附近添加 &nbsp; typedef struct pollfd { SOCKET fd; short events; short revents; } WSAPOLLFD, *PWSAPOLLFD, *LPWSAPOLLFD; &nbsp; 4.3) 解决boost连接问题 &nbsp; 参考这个comment &nbsp; 4.3.1) boost_program_options 查看src/m4/ax_boost_program_options.m4的第74行附近： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_program_options.*\\)\\.so.*$;\\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_program_options.*\\)\\.dylib.*$;\\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_program_options.*\\)\\.a.*$;\\1;&#39;` ; do 修改为： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_program_options.*\\)\\.so.*$;\\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_program_options.*\\)\\.dylib.*$;\\1;&#39;` `ls $BOOSTLIBDIR/libboost_program_options*.dll.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_program_options.*\\)\\.dll\\.a.*$;\\1;&#39;` ; do &nbsp; 4.3.2) boost_chrono 查看src/m4/ax_boost_chrono.m4的第81行附近： for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_chrono.*\\)\\.so.*$;\\1;&#39; -e &#39;s;^lib\\(boost_chrono.*\\)\\.dylib.*$;\\1;&#39; -e &#39;s;^lib\\(boost_chrono.*\\)\\.a.*$;\\1;&#39;` ; do 修改为： &nbsp; for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.dll.a* 2&gt;/dev/null | sed &#39;s,.*/,,&#39; | sed -e &#39;s;^lib\\(boost_chrono.*\\)\\.so.*$;\\1;&#39; -e &#39;s;^lib\\(boost_chrono.*\\)\\.dylib.*$;\\1;&#39; -e &#39;s;^lib\\(boost_chrono.*\\)\\.dll\\.a.*$;\\1;&#39;` ; do &nbsp; 4.4) 修复bitcoin构建时的库依赖顺序 libbitcoin_wallet.a依赖于boost的filesystem,但是在src/Makefile.am里面boost_libs设置在libbitcoin_wallet.a之前，但是如果--disable-wallet编译不发现问题。 &nbsp; 参考：https://github.com/bitcoin/bitcoin/commit/d696820b45d9b6be1c21a65f2c8ed3b260938cb7 &nbsp; &nbsp; 5) 编译核心模块bitcoind sh autogen.sh &amp;&amp; sh samplebuild.sh &amp;&amp; make &nbsp; &nbsp; &nbsp; $ make &nbsp; &nbsp; ...//很多输出 &nbsp; CXXLD &nbsp;bitcoind.exe &nbsp; CXX &nbsp; &nbsp;bitcoin-cli.o &nbsp; CXXLD &nbsp;bitcoin-cli.exe make[3]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[2]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src&#39; make[1]: Entering directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master&#39; make[1]: Nothing to be done for `all-am&#39;. make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master&#39; &nbsp; 运行命令行版本的bitcoin的client，看看帮助提示: &nbsp; &nbsp; $ ./bitcoin-cli.exe --help Bitcoin RPC client version v0.8.2-820-gf65dc44-dirty-beta Usage: bitcoin-cli [options] &lt;command&gt; [params] Send command to Bitcoin server bitcoin-cli [options] help List commands bitcoin-cli [options] help &lt;command&gt; Get help for a command Options: -? This help message -conf=&lt;file&gt; Specify configuration file (default: bitcoin.conf) -datadir=&lt;dir&gt; Specify data directory -testnet Use the test network -rpcconnect=&lt;ip&gt; Send commands to node running on &lt;ip&gt; (default: 127.0.0 .1) -rpcwait Wait for RPC server to start -rpcuser=&lt;user&gt; Username for JSON-RPC connections -rpcpassword=&lt;pw&gt; Password for JSON-RPC connections -rpcport=&lt;port&gt; Connect to JSON-RPC on &lt;port&gt; (default: 8332 or testnet : 18332) SSL options: (see the Bitcoin Wiki for SSL setup instructions) -rpcssl Use OpenSSL (https) for JSON-RPC conn ections &nbsp; 6) 编译qt前端 &nbsp; 如何使用Ming32构建Qt，参考这个文章。 &nbsp; 构建好以后放到3rd目录下备用。 &nbsp; 另外下载google的protocbuf工具编译后，放到3rd目录下。 &nbsp; 楼主会在git上push所有的需要的lib和工具到3rd目录，包括打包用的makensis工具。 &nbsp; 好了吧，开始配置带qt前端的bticoin。 &nbsp; 示例脚本：samplebuild.sh &nbsp; export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46 export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd export PATH=$PATH:$MAKENSIS_HOME ./configure \\ --disable-tests \\ --disable-ipv6 \\ --disable-ccache \\ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \\ --with-miniupnpc=yes \\ --with-qt-incdir=${QT_INC_HOME} \\ --with-qt-libdir=${QT_LIB_HOME} \\ --with-qt-bindir=${QT_BIN_HOME} \\ --with-qt-plugindir=${QT_PLUGIN_HOME} \\ --with-protoc-bindir=${PROTOC_BIN_HOME} \\ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \\ LDFLAGS=&quot;-L${PROTOC_LIB_HOME}-L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot;&nbsp; &nbsp; 楼主没有打算使用pkg_config。有兴趣的同学可以试试。 &nbsp; 如果需要二维码支持，请使用这个sh samplebuild.sh &nbsp; export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46 export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins export QR_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/include export QR_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/lib export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd export PATH=$PATH:$MAKENSIS_HOME ./configure \\ --disable-tests \\ --disable-ipv6 \\ --disable-ccache \\ --with-boost=&quot;${DEPEND_HOME}/boost-1.50.0-mgw&quot; \\ --with-miniupnpc=yes \\ --with-qt-incdir=${QT_INC_HOME} \\ --with-qt-libdir=${QT_LIB_HOME} \\ --with-qt-bindir=${QT_BIN_HOME} \\ --with-qt-plugindir=${QT_PLUGIN_HOME} \\ --with-protoc-bindir=${PROTOC_BIN_HOME} \\ QR_LIBS=&quot;-lqrencode&quot; \\ CPPFLAGS=&quot;-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${QR_INC_HOME} -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50&quot; \\ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${PROTOC_LIB_HOME} -L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib&quot; &nbsp; 然后再来一个make吧(mingw32-make可能会有CreateProcess失败的提示，linux和windows的路径的问题） &nbsp; 耐心的等待吧，时间还好，比qt4的构建时间短多了。&nbsp; &nbsp; 运行make deploy可以生成一个安装包，前提是你配置了了makensis打包软件。 并且需要修改一下share/setup.nsi里面的几个linux路径为windows路径, 主要是File指令后面的参数。 &nbsp; &nbsp; &nbsp; 安装吧，安装完成以后需要添加几个依赖的dll到安装目录，boost, miniupnpc, berkeley db, protocbuf， 以及mingw的crt等。 &nbsp; Done! &nbsp; 7) 注意事项 1) boost 1) GCC 4.8 warns of ignored attribute in declaration &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Ticket #8725&nbsp;(closed Bugs: fixed) 2)&nbsp;MINGW构建boost失败 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Ticket #6350: mingw.jam &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;boost官方网站表示cygwin和mingw的支持程度是不一样的 3) 导出common_config_file_iterator &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;https://github.com/boostorg/program_options/commit/4ae33ce15e5b6345e6eefa19466fdf7cd28a7bbd 2) MiniUPNPc 建议使用最新的1.9版本以上，已经修复以下几个1.6版本的问题： 1) 修改Makefile.mingw 这个是patch文件, 添加del 命令定义，添加-Wl,前缀 需要修改-enable-stdcall-fixup为-Wl,-enable-stdcall-fixup: 否则-enable-stdcall-fixup的-e会被理解成windows上可执行文件的入口指令，这应该是编译器的一个bug。 谢谢&nbsp;steking1&nbsp;同学的提醒 &nbsp; --- D:/cifs/lab/tarballs/Makefile.mingw 周二 四月 19 04:05:38 2011 +++ D:/cifs/lab/tarballs/Makefile.mingw.fixed 周二 二月 25 10:44:20 2014 @@ -8,6 +8,7 @@ CC = gcc #CFLAGS = -Wall -g -DDEBUG -D_WIN32_WINNT=0X501 CFLAGS = -Wall -Os -DNDEBUG -D_WIN32_WINNT=0X501 LDLIBS = -lws2_32 -liphlpapi +DEL = rm -rf # -lwsock32 # -liphlpapi is used for GetBestRoute() PYTHON=\\utils\\python25\\python @@ -23,11 +24,11 @@ init: echo init &gt; init clean: - del upnpc testminixml *.o - del dll\\*.o - del *.exe - del miniupnpc.dll - del libminiupnpc.a + $(DEL) upnpc testminixml *.o + $(DEL) dll\\*.o + $(DEL) *.exe + $(DEL) miniupnpc.dll + $(DEL) libminiupnpc.a libminiupnpc.a: $(OBJS) $(AR) cr $@ $? @@ -58,10 +59,10 @@ upnpc.o: $(CC) $(CFLAGS) -c -o dll/$@ $&lt; upnpc-static: upnpc.o libminiupnpc.a - $(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS) + $(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS) upnpc-shared: dll/upnpc.o miniupnpc.lib - $(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS) + $(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS) wingenminiupnpcstrings: wingenminiupnpcstrings.o 2) 从DLL生成导入lib库的时候出错 dllwrap -k --driver-name gcc \\ --def miniupnpc.def \\ --output-def miniupnpc.dll.def \\ --implib miniupnpc.lib -o miniupnpc.dll \\ dll/miniwget.o dll/minixml.o dll/igd_desc_parse.o dll/minisoap.o dll/min iupnpc.o dll/upnpreplyparse.o dll/upnpcommands.o dll/upnperrors.o dll/connecthos tport.o dll/portlistingparse.o dll/receivedata.o -lws2_32 -liphlpapi D:\\cifs\\mingw32\\bin\\dlltool: Syntax error in def file miniupnpc.def:5 D:\\cifs\\mingw32\\bin\\dlltool: Syntax error in def file miniupnpc.def:5 看看def文件的前面5行，dlltool工具不允许空的library指令，修改一下，在第一行LIBRARY指令后面添加一下库的名字miniupnpc: &nbsp; LIBRARY miniupnpc ; miniupnpc library EXPORTS ; miniupnpc &nbsp; 3) BerkeleyDB 可以考虑直接禁用repmgr模块 --disable-replication,因为这个模块依赖依赖posix的一些系统api，mingw支持不好。 &nbsp; # Replication can be disabled. if test &quot;$db_cv_build_replication&quot; = &quot;yes&quot;; then AC_DEFINE(HAVE_REPLICATION) AH_TEMPLATE(HAVE_REPLICATION, [Define to 1 if building replication support.]) ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS \\$(REP_OBJS)&quot; # If we&#39;re building replication and detected POSIX threads, build the # replication manager. AH_TEMPLATE(HAVE_REPLICATION_THREADS, [Define to 1 if building the Berkeley DB replication framework.]) if test &quot;$ac_cv_header_pthread_h&quot; = yes; then AC_DEFINE(HAVE_REPLICATION_THREADS) # Solaris requires the socket and nsl libraries to build the # replication manager. Don&#39;t add nsl regardless of the OS, # it causes RPC to fail on AIX 4.3.3. case &quot;$host_os&quot; in solaris*) AC_HAVE_LIBRARY(nsl, LIBSO_LIBS=&quot;$LIBSO_LIBS -lnsl&quot;) AC_HAVE_LIBRARY(socket, LIBSO_LIBS=&quot;$LIBSO_LIBS -lsocket&quot;);; esac ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS \\$(REPMGR_OBJS)&quot; else ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS repmgr_stub${o}&quot; fi else ADDITIONAL_OBJS=&quot;$ADDITIONAL_OBJS rep_stub${o} repmgr_stub${o}&quot; fi 4) mingw32在linux交叉编译openssl http://www.blogcompiler.com/2011/12/21/openssl-for-windows/ http://www.wagner.pp.ru/~vitus/articles/openssl-mingw.html &nbsp; 5) 自动脚本 for windows native building with mingw64, with GUI, used for client # 1) zlib make install -f win32/Makefile.gcc \\ DESTDIR=/usr/local/zlib-1.2.8/ \\ INCLUDE_PATH=include \\ LIBRARY_PATH=lib \\ BINARY_PATH=bin # 2) libpng ./configure --prefix=/usr/local/libpng-1.6.9 \\ --enable-shared=no \\ --enable-static=yes # 3) qrencode ./configure --prefix=/usr/local/qrencode-3.4.3 \\ --enable-shared=no \\ --enable-static=yes \\ png_CFLAGS=&quot;-I/usr/local/libpng-1.6.9/include&quot; \\ png_LIBS=&quot;-L/usr/local/libpng-1.6.9/lib -lpng16&quot; # 4) protobuf ./configure --prefix=/usr/local/protobuf-2.5.0 \\ --enable-static=yes \\ --enable-shared=no # 5) BerkeleyDB cd build_unix &amp;&amp; sh ../dist/configure \\ --enable-mingw \\ --enable-cxx \\ --disable-replication # 6) miniupnpc make -f Makefile.mingw &amp;&amp; mkdir miniupnpc &amp;&amp; cp *.h miniupnpc # 7) OpenSSL ./config \\ no-shared \\ no-threads \\ no-asm \\ no-zlib \\ --prefix=/usr/local/ssl \\ &amp;&amp; make &amp;&amp; make install # 8) Boost b2 install --prefix=/usr/local/boost-1.53 \\ toolset=gcc \\ link=shared \\ variant=release \\ runtime-link=shared \\ threading=multi \\ --without-mpi \\ --without-python \\ --without-wave \\ --without-graph \\ --without-graph_parallel # 9) qt4 configure.exe \\ -I &quot;/usr/local/ssl/include&quot; \\ -L &quot;/usr/local/ssl/lib&quot; \\ -l ssl \\ -l crypto \\ -release \\ -opensource \\ -confirm-license \\ -static \\ -no-ltcg \\ -no-fast \\ -exceptions \\ -accessibility \\ -stl \\ -no-sql-sqlite \\ -no-qt3support \\ -no-opengl \\ -no-openvg \\ -platform win32-g++ \\ -no-system-proxies \\ -qt-zlib \\ -no-gif \\ -qt-libpng \\ -no-libmng \\ -no-libtiff \\ -qt-libjpeg \\ -no-dsp \\ -no-vcproj \\ -no-incredibuild-xge \\ -plugin-manifests \\ -qmake \\ -process -nomake demos -nomake examples -nomake tools \\ -no-rtti \\ -no-mmx \\ -no-3dnow \\ -no-sse \\ -no-sse2 \\ -openssl \\ -no-dbus \\ -no-phonon -no-phonon-backend \\ -no-multimedia -no-audio-backend \\ -no-webkit \\ -no-script -no-scripttools -no-declarative \\ -arch windows \\ -no-style-plastique \\ -no-style-windowsxp -no-style-windowsvista \\ -no-style-cleanlooks -no-style-cde \\ -no-style-motif \\ -no-native-gestures \\ -saveconfig csdnbuild # 10) export DEPEND_HOME=/usr/local export MAKENSIS_HOME=${DEPEND_HOME}/nsis-2.46 export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/include export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/lib export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.55 export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.55/include/boost-1_55 export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.55/lib export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.9/include export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.9/lib export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib export QT_BIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/bin export QT_INC_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/include export QT_LIB_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/lib export QT_PLUGIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins export QT_CODECS_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins/codecs export SSL_INC_HOME=${DEPEND_HOME}/ssl/include export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib export PATH=${PATH}:${MAKENSIS_HOME} ./configure \\ --enable-wallet \\ --disable-tests \\ --disable-ipv6 \\ --disable-ccache \\ --with-boost=&quot;${BOOST_TOP_HOME}&quot; \\ --with-qrencode=yes \\ --with-miniupnpc=yes \\ --with-protoc-bindir=${PROTOC_BIN_HOME} \\ --with-cli=yes \\ --with-daemon=yes \\ --with-gui=qt4 \\ --with-qt-incdir=${QT_INC_HOME} \\ --with-qt-libdir=${QT_LIB_HOME} \\ --with-qt-bindir=${QT_BIN_HOME} \\ --with-qt-plugindir=${QT_PLUGIN_HOME} \\ CPPFLAGS=&quot;-w -g -O0 -I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}&quot; \\ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${QT_CODECS_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}&quot; &nbsp; for linux native building with gcc, without gui, used for mining and service. # 1) Boost ./b2 install --prefix=/root/harrywu/build/3rd/boost toolset=gcc variant=release link=static threading=multi runtime-link=static --without-graph --without-graph_parallel --without-mpi --without-python --without-regex --without-wave # 2) BerkeleyDB cd build_unix &amp;&amp; ../dist/configure --prefix=/root/harrywu/build/3rd/bdb48 --enable-static=yes --enable-shared=no --enable-cxx --disable-replication --disable-debug # 3) miniupnpc make DESTDIR=/root/harrywu/build/3rd/miniupnpc-1.9.0 INSTALLPREFIX= install # 4) protobuf ./configure --prefix=/root/harrywu/build/3rd/protobuf-2.5.0 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz # 5) qrencode ./configure --prefix=/root/harrywu/build/3rd/qrencode-3.4.3 --enable-shared=no --enable-static=yes png_CFLAGS=-I/root/harrywu/build/3rd/libpng-1.6.10/ png_LIBS=-L/root/harrywu/build/3rd/libpng-1.6.10/lib/ -lpng16 # 6) ssl ./config no-threads no-shared no-zlib no-asm --prefix=/root/harrywu/build/3rd/ssl # 7) zlib ./configure --prefix=/root/harrywu/build/3rd/zlib-1.2.8 --static # 8) libpng ./configure --prefix=/root/harrywu/build/3rd/libpng-1.6.10 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz # 9) qt missing # 10) Bitcoin export DEPEND_HOME=/root/harrywu/build/3rd export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/include export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/lib export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.53 export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.53/include/boost-1_55 export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.53/lib export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.10/include export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.10/lib export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib export SSL_INC_HOME=${DEPEND_HOME}/ssl/include export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib ./configure \\ --enable-wallet \\ --disable-tests \\ --disable-ipv6 \\ --disable-ccache \\ --with-boost=&quot;${BOOST_TOP_HOME}&quot; \\ --with-qrencode=yes \\ --with-miniupnpc=yes \\ --with-protoc-bindir=${PROTOC_BIN_HOME} \\ --with-cli=yes \\ --with-daemon=yes \\ --with-gui=no \\ CPPFLAGS=&quot;-I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}&quot; \\ LDFLAGS=&quot;-L${QR_LIB_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}&quot; \\ LIBS=&quot;-lrt -ldl&quot; &nbsp; &nbsp; &nbsp; 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2013/11/29/ab156e38875455f66bfd3e10d058fbb9.html","headline":"【比特币】自己动手编译比特币客户端-开心乐源的专栏(关于互联 关于安全)","dateModified":"2013-11-29T00:00:00+08:00","datePublished":"2013-11-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2013/11/29/ab156e38875455f66bfd3e10d058fbb9.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>【比特币】自己动手编译比特币客户端-开心乐源的专栏(关于互联 关于安全)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wuzh1230/article/details/17020689 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-7f5a1a725b.css"> 
 <div class="htmledit_views"> 
  <p><a href="https://github.com/imharrywu/fastcoin" rel="nofollow">https://github.com/imharrywu/fastcoin</a>本帖只谈技术实现，首先我们自己来编译一个比特币客户端吧， 技术讨论QQ群，<strong>161928517</strong>，<em>欢迎大家入伙(注明：csdn)</em>。</p> 
  <p>&nbsp;</p> 
  <p><strong>2014.7.18更新:</strong></p> 
  <p>静态编译的第三方依赖和MINGW64工具链以及v0.9.1的官方源代码：</p> 
  <p><a href="https://github.com/imharrywu/fastcoin" rel="nofollow">https://github.com/imharrywu/fastcoin</a></p> 
  <p>&nbsp;</p> 
  <p>本文遇到的问题大部分是使用动态库构建的时候遇到的，仅仅作为一个备份，大家可以直接迁出上面的代码或者直接跳到本文的最后看《自动脚本》</p> 
  <p><a href="https://github.com/imharrywu/fastcoin/blob/fastcoin/travis.sh" rel="nofollow">本地化的travis构建脚本</a></p> 
  <p>不带任何qt-style风格的qt界面库构建出来的比特币satoshi客户端</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20140718170816578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFjb2Rl/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"></p> 
  <p>=======================================================================================================================</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>先看一下最后编出来的带qt前端的客户端版本截图，会有测试版本提示 (使用tag的源代码编译正式版本)</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>(<strong>建议：备份您之前安装的%APPDATA%bitcoin目录</strong>)。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20140113113654156"></p> 
  <p>&nbsp;</p> 
  <p>参考github上的描述文件</p> 
  <p><a href="https://github.com/bitcoin/bitcoin/blob/master/doc/build-msw.md" rel="nofollow">https://github.com/bitcoin/bitcoin/blob/master/doc/build-msw.md</a></p> 
  <p>&nbsp;</p> 
  <h1>1) 签出代码</h1> 
  <p>GitHub上的官方源代码</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">git clone https://github.com/bitcoin/bitcoin.git</code></pre> 
  <p>&nbsp;</p> 
  <p>也可以从csdn的code上签出本文的整个项目组</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">git clone git://code.csdn.net/wuzh1230/bitcoin.git</code></pre> 
  <p>&nbsp;</p> 
  <p><strong>提示：</strong></p> 
  <p>&nbsp;</p> 
  <p>&lt;1&gt;已经包含了预编译的依赖库在3rd目录下；</p> 
  <p>&lt;2&gt;已经包含了ming32工具链，<strong>请修改msys/1.0/etc/fstab</strong>。</p> 
  <p>&lt;3&gt;文章遇到的问题大多是使用动态库构造的时候遇到的，建议大家用<em><strong>--enable-static</strong></em>构造所有的依赖，直接跳到最后一节<strong>《自动脚本》</strong>。</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h1>2) 下载依赖包</h1> 
  <p>Libraries you need to download separately and build:</p> 
  <pre class="has">
<code>name            default path               download
----------------------------------------------------
OpenSSL         \openssl-1.0.1c-mgw        http://www.openssl.org/source/
Berkeley DB     \db-4.8.30.NC-mgw          http://www.oracle.com/technology/software/products/berkeley-db/index.html
Boost           \boost-1.50.0-mgw          http://www.boost.org/users/download/
miniupnpc       \miniupnpc-1.6-mgw         http://miniupnp.tuxfamily.org/files/</code></pre> 
  <p>&nbsp;</p> 
  <h1>3) 编译依赖包</h1> 
  <p>&nbsp;</p> 
  <h2 style="margin-left:0px;">3.1) OpenSSL</h2> 
  <p>&nbsp;</p> 
  <pre class="has">
<code>cd /c/openssl-1.0.1c-mgw
./config
make
</code></pre> 
  <pre class="has">
<code class="language-html">未发现问题，如有任何问题，欢迎讨论。</code></pre> 
  <h2 style="margin-left:0px;"><br><br><br><br><br><br><br> 3.2) Berkeley DB</h2> 
  <pre class="has">
<code>cd /c/db-4.8.30.NC-mgw/build_unix
sh ../dist/configure --enable-mingw --enable-cxx --disable-replication
make
</code></pre> 
  <pre class="has">
<code>注意：卸载mingw安装包中pthread组件，否则，BDB会尝试构建repmgr模块（repmgr_posix.c需要posix支持，mingw32不支持）。</code></pre> 
  <pre class="has">
<code class="language-html">注意：2014.4.19更新，在用i686-w64-ming32编译的时候发现，repmgr模块还依赖iostream标准头文件，可以考虑直接--disable-replication，而不必删除编译器的pthread组件。sh ../dist/configure --enable-mingw --enable-cxx --disable-replication </code></pre> 
  <h2 style="margin-left:0px;">3.3) Boost</h2> 
  <pre class="has">
<code>downloaded boost jam 3.1.18
cd \boost-1.50.0-mgw</code></pre> 
  <pre>
<code>(0) 修改一个类的dll导出修饰 boost\program_options\detail\config_file.hpp, 参考最好的<strong>注意事项</strong></code></pre> 
  <pre>
<code>(1) 准备bjam.exe，考虑到boost对mingw的支持不是很好，折中的办法是用vc++的命令行构建一个bjam（比如：<strong>bootstrap.bat vc9</strong>）；然后用这个b2.exe构建mingw版本的boost。</code></pre> 
  <pre class="has">
<code class="language-html">(2）执行 b2 --prefix=/d/workspace/temp install toolset=gcc link=shared variant=release runtime-link=shared threading=multi --without-mpi --without-python --without-wave --without-graph --without-graph_parallel</code></pre> 
  <h2 style="margin-left:0px;">3.4) MiniUPnPc</h2> 
  <pre class="has">
<code>cd /c/miniupnpc-1.6-mgw
make -f Makefile.mingw
mkdir miniupnpc
cp *.h miniupnpc/</code></pre> 
  <pre class="has">
<code>（1）修改一个miniupnpc.def里面的LIBRARY指定的库名称为空的问题；</code></pre> 
  <pre class="has">
<code>（2）修改一个Makefile.mingw的del命令；</code></pre> 
  <pre class="has">
<code class="language-html">（3）添加-Wl,前缀给-enable-stdcall-fixup选项</code></pre> 
  <pre class="has">
<code class="language-html">（4）可以考虑使用最新的版本，1.9.20140401版本，已经修复了上面提到的3个问题</code></pre> 
  <h2>3.5) libpng</h2> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; 编译png编码库(<a href="http://downloads.sourceforge.net/project/libpng/libpng16/1.6.10/libpng-1.6.10.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Flibpng%2Ffiles%2Flibpng16%2F1.6.10%2F&amp;ts=1397966177&amp;use_mirror=jaist" rel="nofollow"><strong>libpng下载地址</strong></a>)支持二维码生成</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p> 
  <pre class="has">
<code class="language-plain">./configure --prefix=/usr/local/libpng-1.6.10 &amp;&amp; make &amp;&amp; make install</code></pre> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h2>3.6) qrencode</h2> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; 二维码编码库(&nbsp;<a href="http://fukuchi.org/works/qrencode/qrencode-3.4.3.tar.bz2" rel="nofollow"><strong>下载QREncode地址</strong></a>)，需要png和pkg-config支持，下载一个<strong><a href="http://sourceforge.net/projects/pkgconfiglite/" rel="nofollow">lite版本</a></strong>解压到mingw目录下</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">./configure --prefix=/usr/local/qrencode-3.4.3 png_CFLAGS="-I/usr/local/libpng-1.6.10/include" png_LIBS="-L/usr/local/libpng-1.6.10/lib -lpng16" &amp;&amp; make &amp;&amp; make install</code></pre> 
  <p>&nbsp;</p> 
  <h2>3.7) zlib</h2> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">$ make -f win32/Makefile.gcc install \
                SHARED_MODE=1 \
                DESTDIR=/usr/local/zlib-1.2.8/ \
                BINARY_PATH=bin \
                INCLUDE_PATH=include \
                LIBRARY_PATH=lib</code></pre> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h2>3.8) protobuf</h2> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">$ ./configure --prefix=/usr/local/protobuf-2.5.0 \
            CPPFLAGS=-I/usr/local/zlib-1.2.8/include\
            LDFLAGS=-L/usr/local/zlib-1.2.8/lib \
            LIBS=-lz</code></pre> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h1>4) 编译bitcoin客户端</h1> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>编译脚本samplebuild.sh的代码，<strong>请修改DEPEND_HOME变量</strong></p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">export DEPEND_HOME=/d/cifs/try/buildbtc/csdn/bitcoin/3rd
./configure \
--disable-tests \
--with-boost="${DEPEND_HOME}/boost-1.50.0-mgw" \
--with-miniupnpc=yes \
CPPFLAGS="-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50" \
LDFLAGS="-L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib"&nbsp;
</code></pre> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h2>4.1) 解决::UnRegisterSleepEx()错误</h2> 
  <p>添加&nbsp;-D<strong>_WIN32_WINNT=0x0601&nbsp;</strong>-D<strong>WINVER=0x0601&nbsp;</strong></p> 
  <p>&nbsp;</p> 
  <h2>4.2) 解决WSAPOLLFD未定义</h2> 
  <p>参考：<a href="http://sourceforge.net/p/mingw/bugs/1980/" rel="nofollow">http://sourceforge.net/p/mingw/bugs/1980/&nbsp;</a></p> 
  <p>&nbsp;</p> 
  <p>在mingw的winsock2.h里面的第912行附近添加</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-cpp">typedef struct pollfd {
  SOCKET fd;
  short  events;
  short  revents;
} WSAPOLLFD, *PWSAPOLLFD, *LPWSAPOLLFD;
</code></pre> 
  <p>&nbsp;</p> 
  <h2>4.3) 解决boost连接问题</h2> 
  <p>&nbsp;</p> 
  <p><strong><em>参考这个<a href="https://github.com/bitcoin/bitcoin/commit/2fb65108f3965fbf6795635f3b0803c69cb8e2c2#commitcomment-4869056" rel="nofollow">comment</a></em></strong></p> 
  <p>&nbsp;</p> 
  <p>4.3.1) <strong>boost_program_options</strong></p> 
  <p>查看src/m4/ax_boost_program_options.m4的第74行附近：</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_program_options.*\)\.so.*$;\1;'` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_program_options.*\)\.dylib.*$;\1;'` `ls $BOOSTLIBDIR/libboost_program_options*.a* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_program_options.*\)\.a.*$;\1;'` ; do</code></pre> 
  <p>修改为：</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">for libextension in `ls $BOOSTLIBDIR/libboost_program_options*.so* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_program_options.*\)\.so.*$;\1;'` `ls $BOOSTLIBDIR/libboost_program_options*.dylib* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_program_options.*\)\.dylib.*$;\1;'` `ls $BOOSTLIBDIR/libboost_program_options*.dll.a* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_program_options.*\)\.dll\.a.*$;\1;'` ; do</code></pre> 
  <p>&nbsp;</p> 
  <p>4.3.2) <strong>boost_chrono</strong></p> 
  <p>查看src/m4/ax_boost_chrono.m4的第81行附近：</p> 
  <pre class="has">
<code class="language-plain">for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.a* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_chrono.*\)\.so.*$;\1;' -e 's;^lib\(boost_chrono.*\)\.dylib.*$;\1;' -e 's;^lib\(boost_chrono.*\)\.a.*$;\1;'` ; do</code></pre> 
  <p>修改为：</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">for libextension in `ls $BOOSTLIBDIR/libboost_chrono*.so* $BOOSTLIBDIR/libboost_chrono*.dylib* $BOOSTLIBDIR/libboost_chrono*.dll.a* 2&gt;/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_chrono.*\)\.so.*$;\1;' -e 's;^lib\(boost_chrono.*\)\.dylib.*$;\1;' -e 's;^lib\(boost_chrono.*\)\.dll\.a.*$;\1;'` ; do</code></pre> 
  <p>&nbsp;</p> 
  <h2>4.4) 修复bitcoin构建时的库依赖顺序</h2> 
  <p>libbitcoin_wallet.a依赖于boost的filesystem,但是在src/Makefile.am里面boost_libs设置在libbitcoin_wallet.a之前，但是如果--disable-wallet编译不发现问题。</p> 
  <p>&nbsp;</p> 
  <p>参考：<a href="https://github.com/bitcoin/bitcoin/commit/d696820b45d9b6be1c21a65f2c8ed3b260938cb7" rel="nofollow">https://github.com/bitcoin/bitcoin/commit/d696820b45d9b6be1c21a65f2c8ed3b260938cb7</a></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h1>5) 编译核心模块bitcoind</h1> 
  <p><strong><em>sh autogen.sh &amp;&amp; sh samplebuild.sh &amp;&amp; make</em></strong></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">$ make &nbsp;
&nbsp; ...//很多输出
&nbsp; CXXLD &nbsp;bitcoind.exe
&nbsp; CXX &nbsp; &nbsp;bitcoin-cli.o
&nbsp; CXXLD &nbsp;bitcoin-cli.exe
make[3]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src'
make[2]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src'
make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master/src'
make[1]: Entering directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master'
make[1]: Nothing to be done for `all-am'.
make[1]: Leaving directory `/d/cifs/try/buildbtc/csdn/bitcoin/bitcoin-master'
</code></pre> 
  <p>&nbsp;</p> 
  <p>运行<strong>命令行版本的bitcoin的client</strong>，看看帮助提示:</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">$ ./bitcoin-cli.exe --help
Bitcoin RPC client version v0.8.2-820-gf65dc44-dirty-beta

Usage:
  bitcoin-cli [options] &lt;command&gt; [params]  Send command to Bitcoin server
  bitcoin-cli [options] help                List commands
  bitcoin-cli [options] help &lt;command&gt;      Get help for a command

Options:
  -?                     This help message
  -conf=&lt;file&gt;           Specify configuration file (default: bitcoin.conf)
  -datadir=&lt;dir&gt;         Specify data directory
  -testnet               Use the test network
  -rpcconnect=&lt;ip&gt;       Send commands to node running on &lt;ip&gt; (default: 127.0.0
.1)
  -rpcwait               Wait for RPC server to start
  -rpcuser=&lt;user&gt;        Username for JSON-RPC connections
  -rpcpassword=&lt;pw&gt;      Password for JSON-RPC connections
  -rpcport=&lt;port&gt;        Connect to JSON-RPC on &lt;port&gt; (default: 8332 or testnet
: 18332)

SSL options: (see the Bitcoin Wiki for SSL setup instructions)
  -rpcssl                                  Use OpenSSL (https) for JSON-RPC conn
ections</code></pre> 
  <p>&nbsp;</p> 
  <h1>6) 编译qt前端</h1> 
  <p>&nbsp;</p> 
  <p>如何使用<a href="http://blog.csdn.net/hacode/article/details/18002163" rel="nofollow"><strong>Ming32构建Qt</strong></a>，参考这个文章。</p> 
  <p>&nbsp;</p> 
  <p>构建好以后放到3rd目录下备用。</p> 
  <p>&nbsp;</p> 
  <p>另外下载google的protocbuf工具编译后，放到3rd目录下。</p> 
  <p>&nbsp;</p> 
  <p>楼主会在git上push所有的需要的lib和工具到3rd目录，包括打包用的<strong><em>makensis</em></strong>工具。</p> 
  <p>&nbsp;</p> 
  <p>好了吧，开始配置带qt前端的bticoin。</p> 
  <p>&nbsp;</p> 
  <p>示例脚本：<em><strong>samplebuild.sh</strong></em></p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46


export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin
export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include
export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib


export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin
export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib
export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include
export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins


export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs


export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd


export PATH=$PATH:$MAKENSIS_HOME


./configure \
--disable-tests \
--disable-ipv6 \
--disable-ccache \
--with-boost="${DEPEND_HOME}/boost-1.50.0-mgw" \
--with-miniupnpc=yes \
--with-qt-incdir=${QT_INC_HOME} \
--with-qt-libdir=${QT_LIB_HOME} \
--with-qt-bindir=${QT_BIN_HOME} \
--with-qt-plugindir=${QT_PLUGIN_HOME} \
--with-protoc-bindir=${PROTOC_BIN_HOME} \
CPPFLAGS="-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50" \
LDFLAGS="-L${PROTOC_LIB_HOME}-L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib"&nbsp;
</code></pre> 
  <p>&nbsp;</p> 
  <p>楼主没有打算使用pkg_config。有兴趣的同学可以试试。</p> 
  <p>&nbsp;</p> 
  <p>如果需要二维码支持，请使用这个<strong><em>sh samplebuild.sh</em></strong></p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">export MAKENSIS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/nsis-2.46

export PROTOC_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/bin
export PROTOC_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/include
export PROTOC_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/google-protoc-2.5-mgw/lib

export QT_BIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/bin
export QT_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/lib
export QT_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/include
export QT_PLUGIN_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins

export QR_INC_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/include
export QR_LIB_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qrencode-3.4.3/lib

export LANG_CODECS_HOME=/d/cifs/lab/csdn/bitcoin/3rd/qt-4.8.5-mingw32-4.8.1/plugins/codecs

export DEPEND_HOME=/d/cifs/lab/csdn/bitcoin/3rd

export PATH=$PATH:$MAKENSIS_HOME

./configure \
--disable-tests \
--disable-ipv6 \
--disable-ccache \
--with-boost="${DEPEND_HOME}/boost-1.50.0-mgw" \
--with-miniupnpc=yes \
--with-qt-incdir=${QT_INC_HOME} \
--with-qt-libdir=${QT_LIB_HOME} \
--with-qt-bindir=${QT_BIN_HOME} \
--with-qt-plugindir=${QT_PLUGIN_HOME} \
--with-protoc-bindir=${PROTOC_BIN_HOME} \
QR_LIBS="-lqrencode" \
CPPFLAGS="-D_WIN32_WINNT=0x0601 -DWINVER=0x0601 -w -g -O0 -I${QR_INC_HOME} -I${PROTOC_INC_HOME} -I${DEPEND_HOME}/db-4.8.30.NC-mgw/include -I${DEPEND_HOME}/miniupnpc-1.6-mgw/include -I${DEPEND_HOME}/openssl-1.0.1c-mgw/include -I${DEPEND_HOME}/boost-1.50.0-mgw/include/boost-1_50" \
LDFLAGS="-L${QR_LIB_HOME} -L${PROTOC_LIB_HOME} -L${LANG_CODECS_HOME} -L${DEPEND_HOME}/db-4.8.30.NC-mgw/lib -L${DEPEND_HOME}/miniupnpc-1.6-mgw/lib -L${DEPEND_HOME}/openssl-1.0.1c-mgw/lib"</code></pre> 
  <p>&nbsp;</p> 
  <p>然后再来一个<strong><em>make</em></strong>吧(mingw32-make可能会有CreateProcess失败的提示，linux和windows的路径的问题）</p> 
  <p>&nbsp;</p> 
  <p>耐心的等待吧，时间还好，比qt4的构建时间短多了。&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>运行make deploy可以生成一个安装包，前提是你配置了了makensis打包软件。</p> 
  <p>并且需要修改一下share/setup.nsi里面的几个linux路径为windows路径, 主要是File指令后面的参数。</p> 
  <p>&nbsp;</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20140113113214125"></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>安装吧，安装完成以后需要添加几个依赖的dll到安装目录，boost, miniupnpc, berkeley db, protocbuf， 以及mingw的crt等。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20140113113349375"></p> 
  <p>&nbsp;</p> 
  <p><strong>Done!</strong></p> 
  <p>&nbsp;</p> 
  <h1>7) 注意事项</h1> 
  <h2>1) boost</h2> 
  <p>1) GCC 4.8 warns of ignored attribute in declaration</p> 
  <p>&nbsp;</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<a href="https://svn.boost.org/trac/boost/ticket/8725" rel="nofollow">Ticket #8725&nbsp;(closed Bugs: fixed)</a></p> 
  <p>2)<strong>&nbsp;</strong>MINGW构建boost失败</p> 
  <p><strong>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<a href="https://svn.boost.org/trac/boost/attachment/ticket/6350/mingw.jam" rel="nofollow">Ticket #6350: mingw.jam</a></strong></p> 
  <p><strong>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<a href="http://www.boost.org/doc/libs/1_46_0/more/getting_started/windows.html" rel="nofollow">boost官方网站表示cygwin和mingw的支持程度是不一样的</a></strong></p> 
  <p>3) 导出common_config_file_iterator</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<a href="https://github.com/boostorg/program_options/commit/4ae33ce15e5b6345e6eefa19466fdf7cd28a7bbd" rel="nofollow">https://github.com/boostorg/program_options/commit/4ae33ce15e5b6345e6eefa19466fdf7cd28a7bbd</a></p> 
  <h2>2) MiniUPNPc</h2> 
  <p><strong><em>建议使用最新的1.9版本以上，已经修复以下几个1.6版本的问题：</em></strong></p> 
  <p>1) 修改<strong>Makefile.mingw</strong></p> 
  <p>这个是patch文件, 添加<strong>del 命令</strong>定义，添加<strong>-Wl,</strong>前缀</p> 
  <p>需要修改<strong>-enable-stdcall-fixup</strong>为<strong>-Wl,-enable-stdcall-fixup</strong>:</p> 
  <p>否则<strong>-enable-stdcall-fixup</strong>的<strong>-e</strong>会被理解成windows上可执行文件的入口指令，这应该是编译器的一个bug。</p> 
  <p>谢谢&nbsp;<strong>steking1&nbsp;</strong>同学的提醒</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">--- D:/cifs/lab/tarballs/Makefile.mingw	周二 四月 19 04:05:38 2011
+++ D:/cifs/lab/tarballs/Makefile.mingw.fixed	周二 二月 25 10:44:20 2014
@@ -8,6 +8,7 @@ CC = gcc
 #CFLAGS = -Wall -g -DDEBUG -D_WIN32_WINNT=0X501
 CFLAGS = -Wall -Os -DNDEBUG -D_WIN32_WINNT=0X501
 LDLIBS = -lws2_32 -liphlpapi
+DEL    = rm -rf
 # -lwsock32
 # -liphlpapi is used for GetBestRoute()
 PYTHON=\utils\python25\python
@@ -23,11 +24,11 @@ init:
 	echo init &gt; init
 
 clean:
-	del upnpc testminixml *.o
-	del dll\*.o
-	del *.exe
-	del miniupnpc.dll
-	del libminiupnpc.a
+	$(DEL) upnpc testminixml *.o
+	$(DEL) dll\*.o
+	$(DEL) *.exe
+	$(DEL) miniupnpc.dll
+	$(DEL) libminiupnpc.a
 
 libminiupnpc.a:	$(OBJS)
 	$(AR) cr $@ $?
@@ -58,10 +59,10 @@ upnpc.o:
 	$(CC) $(CFLAGS) -c -o dll/$@ $&lt;
 
 upnpc-static:	upnpc.o libminiupnpc.a
-	$(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS)
+	$(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS)
 
 upnpc-shared:	dll/upnpc.o miniupnpc.lib
-	$(CC) -enable-stdcall-fixup -o $@ $^ $(LDLIBS)
+	$(CC) -Wl,-enable-stdcall-fixup -o $@ $^ $(LDLIBS)
 
 wingenminiupnpcstrings:	wingenminiupnpcstrings.o
 
</code></pre> 
  <p>2) 从DLL生成导入lib库的时候出错</p> 
  <pre class="has">
<code class="language-plain">dllwrap -k --driver-name gcc \
        --def miniupnpc.def \
        --output-def miniupnpc.dll.def \
        --implib miniupnpc.lib -o miniupnpc.dll \
        dll/miniwget.o dll/minixml.o dll/igd_desc_parse.o dll/minisoap.o dll/min
iupnpc.o dll/upnpreplyparse.o dll/upnpcommands.o dll/upnperrors.o dll/connecthos
tport.o dll/portlistingparse.o dll/receivedata.o -lws2_32 -liphlpapi
D:\cifs\mingw32\bin\dlltool: Syntax error in def file miniupnpc.def:5
D:\cifs\mingw32\bin\dlltool: Syntax error in def file miniupnpc.def:5</code></pre> 
  <p>看看def文件的前面5行，<em>dlltool工具不允许空的library指令</em>，修改一下，在第一行<strong>LIBRARY</strong>指令后面添加一下库的名字<strong>miniupnpc</strong>:</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain">LIBRARY miniupnpc
; miniupnpc library


EXPORTS
; miniupnpc
</code></pre> 
  <p>&nbsp;</p> 
  <h2>3) BerkeleyDB</h2> 
  <p>可以考虑直接禁用repmgr模块 <strong>--disable-replication,</strong>因为这个模块依赖依赖posix的一些系统api，mingw支持不好。</p> 
  <p>&nbsp;</p> 
  <pre class="has">
<code class="language-plain"># Replication can be disabled.
if test "$db_cv_build_replication" = "yes"; then
	AC_DEFINE(HAVE_REPLICATION)
	AH_TEMPLATE(HAVE_REPLICATION,
	    [Define to 1 if building replication support.])
	ADDITIONAL_OBJS="$ADDITIONAL_OBJS \$(REP_OBJS)"

	# If we're building replication and detected POSIX threads, build the
	# replication manager.
	AH_TEMPLATE(HAVE_REPLICATION_THREADS,
	    [Define to 1 if building the Berkeley DB replication framework.])

	if test "$ac_cv_header_pthread_h" = yes; then
		AC_DEFINE(HAVE_REPLICATION_THREADS)

		# Solaris requires the socket and nsl libraries to build the
		# replication manager.  Don't add nsl regardless of the OS,
		# it causes RPC to fail on AIX 4.3.3.
		case "$host_os" in
		solaris*)
			AC_HAVE_LIBRARY(nsl, LIBSO_LIBS="$LIBSO_LIBS -lnsl")
			AC_HAVE_LIBRARY(socket,
			    LIBSO_LIBS="$LIBSO_LIBS -lsocket");;
		esac
		ADDITIONAL_OBJS="$ADDITIONAL_OBJS \$(REPMGR_OBJS)"
	else
		ADDITIONAL_OBJS="$ADDITIONAL_OBJS repmgr_stub${o}"
	fi
else
	ADDITIONAL_OBJS="$ADDITIONAL_OBJS rep_stub${o} repmgr_stub${o}"
fi</code></pre> 
  <h2>4) mingw32在linux交叉编译openssl</h2> 
  <p><a href="http://www.blogcompiler.com/2011/12/21/openssl-for-windows/" rel="nofollow">http://www.blogcompiler.com/2011/12/21/openssl-for-windows/</a></p> 
  <p><a href="http://www.wagner.pp.ru/~vitus/articles/openssl-mingw.html" rel="nofollow">http://www.wagner.pp.ru/~vitus/articles/openssl-mingw.html</a></p> 
  <p>&nbsp;</p> 
  <h2>5) 自动脚本</h2> 
  <p>for windows native building with mingw64, with GUI, used for client</p> 
  <pre class="has">
<code class="language-cpp"># 1) zlib
make install -f win32/Makefile.gcc \
DESTDIR=/usr/local/zlib-1.2.8/ \
INCLUDE_PATH=include \
LIBRARY_PATH=lib \
BINARY_PATH=bin


# 2) libpng
./configure --prefix=/usr/local/libpng-1.6.9 \
--enable-shared=no \
--enable-static=yes


# 3) qrencode 
./configure --prefix=/usr/local/qrencode-3.4.3 \
--enable-shared=no \
--enable-static=yes \
png_CFLAGS="-I/usr/local/libpng-1.6.9/include" \
png_LIBS="-L/usr/local/libpng-1.6.9/lib -lpng16"


# 4) protobuf
./configure --prefix=/usr/local/protobuf-2.5.0 \
--enable-static=yes \
--enable-shared=no


# 5) BerkeleyDB
cd build_unix &amp;&amp; sh ../dist/configure \
--enable-mingw \
--enable-cxx \
--disable-replication


# 6) miniupnpc
make -f Makefile.mingw &amp;&amp; mkdir miniupnpc &amp;&amp; cp *.h miniupnpc 


# 7) OpenSSL
./config \
no-shared \
no-threads \
no-asm \
no-zlib \
--prefix=/usr/local/ssl \
&amp;&amp; make &amp;&amp; make install


# 8) Boost
b2 install --prefix=/usr/local/boost-1.53 \
toolset=gcc \
link=shared \
variant=release \
runtime-link=shared \
threading=multi \
--without-mpi \
--without-python \
--without-wave \
--without-graph \
--without-graph_parallel 

# 9) qt4
configure.exe \
    -I "/usr/local/ssl/include" \
    -L "/usr/local/ssl/lib" \
    -l ssl \
    -l crypto \
    -release \
    -opensource \
    -confirm-license \
    -static \
    -no-ltcg \
    -no-fast \
    -exceptions \
    -accessibility \
    -stl \
    -no-sql-sqlite \
    -no-qt3support \
    -no-opengl \
    -no-openvg \
    -platform win32-g++ \
    -no-system-proxies \
    -qt-zlib \
    -no-gif \
    -qt-libpng \
    -no-libmng \
    -no-libtiff \
    -qt-libjpeg \
    -no-dsp \
    -no-vcproj \
    -no-incredibuild-xge \
    -plugin-manifests \
    -qmake \
    -process -nomake demos -nomake examples -nomake tools \
    -no-rtti \
    -no-mmx \
    -no-3dnow \
    -no-sse \
    -no-sse2 \
    -openssl \
    -no-dbus \
    -no-phonon -no-phonon-backend \
    -no-multimedia -no-audio-backend \
    -no-webkit \
    -no-script -no-scripttools -no-declarative \
    -arch windows \
    -no-style-plastique \
    -no-style-windowsxp -no-style-windowsvista \
    -no-style-cleanlooks -no-style-cde \
    -no-style-motif \
    -no-native-gestures \
    -saveconfig csdnbuild    




# 10)
export DEPEND_HOME=/usr/local
export MAKENSIS_HOME=${DEPEND_HOME}/nsis-2.46
export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/include
export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB.4.8/lib
export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.55
export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.55/include/boost-1_55
export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.55/lib
export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.9/include
export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.9/lib
export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include
export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib
export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin
export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include
export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib
export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include
export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib
export QT_BIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/bin
export QT_INC_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/include
export QT_LIB_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/lib
export QT_PLUGIN_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins
export QT_CODECS_HOME=${DEPEND_HOME}/qt-4.8.5-mingw32-4.8.1/plugins/codecs
export SSL_INC_HOME=${DEPEND_HOME}/ssl/include
export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib
export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include
export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib
export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include
export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib
export PATH=${PATH}:${MAKENSIS_HOME}
./configure \
    --enable-wallet \
    --disable-tests \
    --disable-ipv6 \
    --disable-ccache \
    --with-boost="${BOOST_TOP_HOME}" \
    --with-qrencode=yes \
    --with-miniupnpc=yes \
    --with-protoc-bindir=${PROTOC_BIN_HOME} \
    --with-cli=yes \
    --with-daemon=yes \
    --with-gui=qt4 \
    --with-qt-incdir=${QT_INC_HOME} \
    --with-qt-libdir=${QT_LIB_HOME} \
    --with-qt-bindir=${QT_BIN_HOME} \
    --with-qt-plugindir=${QT_PLUGIN_HOME} \
    CPPFLAGS="-w -g -O0 -I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}" \
    LDFLAGS="-L${QR_LIB_HOME} -L${QT_CODECS_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}" 
</code></pre> 
  <p>&nbsp;</p> 
  <p>for linux native building with gcc, without gui, used for mining and service.</p> 
  <pre class="has">
<code class="language-cpp"># 1) Boost
./b2 install --prefix=/root/harrywu/build/3rd/boost toolset=gcc variant=release link=static threading=multi runtime-link=static --without-graph --without-graph_parallel --without-mpi --without-python --without-regex --without-wave


# 2) BerkeleyDB
cd build_unix &amp;&amp; ../dist/configure --prefix=/root/harrywu/build/3rd/bdb48 --enable-static=yes --enable-shared=no --enable-cxx --disable-replication --disable-debug


# 3) miniupnpc
make DESTDIR=/root/harrywu/build/3rd/miniupnpc-1.9.0 INSTALLPREFIX= install


# 4) protobuf
./configure --prefix=/root/harrywu/build/3rd/protobuf-2.5.0 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz


# 5) qrencode
./configure --prefix=/root/harrywu/build/3rd/qrencode-3.4.3 --enable-shared=no --enable-static=yes png_CFLAGS=-I/root/harrywu/build/3rd/libpng-1.6.10/ png_LIBS=-L/root/harrywu/build/3rd/libpng-1.6.10/lib/ -lpng16


# 6) ssl
./config no-threads no-shared no-zlib no-asm --prefix=/root/harrywu/build/3rd/ssl


# 7) zlib
./configure --prefix=/root/harrywu/build/3rd/zlib-1.2.8 --static


# 8) libpng
./configure --prefix=/root/harrywu/build/3rd/libpng-1.6.10 --enable-shared=no --enable-static=yes CPPFLAGS=-I/root/harrywu/build/3rd/zlib-1.2.8/include/ LDFLAGS=-L/root/harrywu/build/3rd/zlib-1.2.8/lib LIBS=-lz


# 9) qt missing


# 10) Bitcoin
export DEPEND_HOME=/root/harrywu/build/3rd
export BDB_INC_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/include
export BDB_LIB_HOME=${DEPEND_HOME}/BerkeleyDB-4.8.0/lib
export BOOST_TOP_HOME=${DEPEND_HOME}/boost-1.53
export BOOST_INC_HOME=${DEPEND_HOME}/boost-1.53/include/boost-1_55
export BOOST_LIB_HOME=${DEPEND_HOME}/boost-1.53/lib
export PNG_INC_HOME=${DEPEND_HOME}/libpng-1.6.10/include
export PNG_LIB_HOME=${DEPEND_HOME}/libpng-1.6.10/lib
export MINIUPNPC_INC_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/include
export MINIUPNPC_LIB_HOME=${DEPEND_HOME}/miniupnpc-1.9.0/lib
export PROTOC_BIN_HOME=${DEPEND_HOME}/protobuf-2.5.0/bin
export PROTOC_INC_HOME=${DEPEND_HOME}/protobuf-2.5.0/include
export PROTOC_LIB_HOME=${DEPEND_HOME}/protobuf-2.5.0/lib
export QR_INC_HOME=${DEPEND_HOME}/qrencode-3.4.3/include
export QR_LIB_HOME=${DEPEND_HOME}/qrencode-3.4.3/lib
export SSL_INC_HOME=${DEPEND_HOME}/ssl/include
export SSL_LIB_HOME=${DEPEND_HOME}/ssl/lib
export CRYPTO_INC_HOME=${DEPEND_HOME}/ssl/include
export CRYPTO_LIB_HOME=${DEPEND_HOME}/ssl/lib
export ZLIB_INC_HOME=${DEPEND_HOME}/zlib-1.2.8/include
export ZLIB_LIB_HOME=${DEPEND_HOME}/zlib-1.2.8/lib
./configure \
    --enable-wallet \
    --disable-tests \
    --disable-ipv6 \
    --disable-ccache \
    --with-boost="${BOOST_TOP_HOME}" \
    --with-qrencode=yes \
    --with-miniupnpc=yes \
    --with-protoc-bindir=${PROTOC_BIN_HOME} \
    --with-cli=yes \
    --with-daemon=yes \
    --with-gui=no \
    CPPFLAGS="-I${QR_INC_HOME} -I${PNG_INC_HOME} -I${PROTOC_INC_HOME} -I${SSL_INC_HOME} -I${CRYPTO_INC_HOME} -I${BDB_INC_HOME} -I${MINIUPNPC_INC_HOME} -I${BOOST_INC_HOME} -I${ZLIB_INC_HOME}" \
    LDFLAGS="-L${QR_LIB_HOME} -L${PNG_LIB_HOME} -L${PROTOC_LIB_HOME} -L${SSL_LIB_HOME} -L${CRYPTO_LIB_HOME} -L${BDB_LIB_HOME} -L${MINIUPNPC_LIB_HOME} -L${ZLIB_LIB_HOME}" \
LIBS="-lrt -ldl"
</code></pre> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/hacode/article/details/17020689,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/hacode/article/details/17020689,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

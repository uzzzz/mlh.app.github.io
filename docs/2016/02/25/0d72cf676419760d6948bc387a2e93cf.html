<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>SkLearn 对上证50成分股聚类 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="SkLearn 对上证50成分股聚类" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1. 为什么要对股票进行聚类 1.1 投资组合优化理论 股票聚类的基本原因就是从股市中选取一部股票进行投资。哪怕是上证50对一般的投资模型来说50条股票也太多了。 按照投资组合优化理论选取标准为： （1）资产数越多越好 （2）资产之间相关系数越低越好 以期望收益E来衡量证券收益，以收益的方差 δ2 表示投资风险 　　 minδ2(rp)=∑∑wiwjcov(ri,rj) 　　 E(rp)=∑wiri 　　式中： 　　 rp ——组合收益； 　　 ri 、 rj ——第i种、第j种资产的收益； 　　 wi 、 wj ——资产i和资产j在组合中的权重； 　　 δ2(rp) ——组合收益的方差即组合的总体风险； 　　 cov(r,rj) ——两种资产之间的协方差。 举个极端的例子：（以后再详细说吧，搞一个简单的例子） 有n个不相关的资产，其收益率都是r，风险都是v，优化后的投资比例应该是均分（还用优化吗……） 那资产组合的 收益：R = r 风险：V = v/n 1.2 聚类 聚类定义就不说了，经过对股票交易数据聚类后，可以将其分为几个类别，然后从每个类别中选一个样本，最后组成的样本可使样本之间的相关系数降至最低。 这样保证在一定的风险下使收益更高。 这里采用sklearn中affinity_propagation算法进行聚类。 2. 读取上证50成分股 dict_stock = {} def ReadStocks(stock_file): print &#39;read_stocks...&#39; f = open(stock_file, &#39;r&#39;) for line in f.readlines(): # str_line = str(line) item = line.strip().split(&#39; &#39;) dict_stock[item[0]] = item[1] f.close() 3. 读取股票交易数据 用QSTK API获取股票交易数据。 之前的文件已经介绍过了，这里提2点： （1）验证股票代码是否正确，移除异常股票，不然QSTK会报错 db = DataAccess.DataAccess(&#39;Yahoo&#39;) ls_all_syms = db.get_all_symbols() ls_bad_syms = list(set(ls_stock_code) - set(ls_all_syms)) print &#39;Bad Stock Code : &#39;, ls_bad_syms for sym in ls_bad_syms: ls_stock_code.remove(sym) （2）对获取的数据进行清理，不然SKLearn会报错 # Filling the data for NAN for s_key in ls_keys: dict_data[s_key] = dict_data[s_key].fillna(method=&#39;ffill&#39;) dict_data[s_key] = dict_data[s_key].fillna(method=&#39;bfill&#39;) dict_data[s_key] = dict_data[s_key].fillna(1.0) 4. 聚类 4.1 载入数据 open = stock_data[&#39;open&#39;] close = stock_data[&#39;close&#39;] var = close - open open, close, var的数据类型都是pandas DataFrame类型。 print type(open) &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; print open.iloc[:3, 1:3] 600837.SS 600000.SS 2015-01-02 16:00:00 24.06 15.69 2015-01-05 16:00:00 23.82 15.94 2015-01-06 16:00:00 23.30 16.00 关于pandas的使用参考下： 十分钟搞定pandas 4.2 sklearn 聚类 from sklearn import covariance, cluster x = var/var.std(0) edge_model = covariance.GraphLassoCV() edge_model.fit(x) centers, labels = cluster.affinity_propagation(edge_model.covariance_) 结果输出 n_labels = labels.max() print &#39;Centers : \n&#39;, &#39;, &#39;.join( np.array(dict_stock.values())[centers] ) for i in range(n_labels + 1): print(&#39;Cluster %i: %s&#39; % ((i + 1), &#39;, &#39;.join([dict_stock[key] for key in var.columns[labels == i]]))) 5. 聚类因子选择 这里比较了几种因子的聚类结果 （1）x = var*vol*10e-9/var.std(0) Covariance : 1.26342386383e-04 海螺水泥, 东方明珠, 中国平安, 中国交建, 中航动力, 包钢股份, 民生银行, 青岛海尔 Cluster 1: 大秦铁路, 海螺水泥, 贵州茅台, 华泰证券, 中国太保, 伊利股份, 中国石油, 中国神华 Cluster 2: 东方明珠, 保利地产, 特变电工 Cluster 3: 中国交建, 广汇能源 Cluster 4: 海通证券, 浦发银行, 招商证券, 兴业银行, 中信银行, 中国中车, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 中信证券, 招商银行, 交通银行, 包钢股份, 工商银行, 民生银行 Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 Cluster 6: 海油工程, 中航动力, 东方证券, 华夏银行, 国电南瑞, 上汽集团 Cluster 7: 北方稀土, 国金证券, 青岛海尔 Cluster 8: 中国中铁, 中国人寿, 中国重工, 中国铁建, 中国联通, 中国建筑 （2）x = var*np.sqrt(vol*10e-8)/(var.std(0)*np.log2(close)) Covariance : 1.16200812467e-04 海螺水泥, 东方明珠, 中国平安, 光大银行, 中航动力, 包钢股份, 民生银行, 青岛海尔 Cluster 1: 大秦铁路, 海螺水泥, 华泰证券, 中国太保, 伊利股份, 中国石油, 中信证券, 中国神华 Cluster 2: 东方明珠, 保利地产, 特变电工 Cluster 3: 中国交建, 广汇能源, 中国铁建, 包钢股份 Cluster 4: 浦发银行, 兴业银行, 贵州茅台, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 招商银行, 交通银行, 华夏银行, 工商银行, 民生银行 Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 Cluster 6: 海通证券, 招商证券, 海油工程, 中航动力, 东方证券, 国电南瑞, 上汽集团 Cluster 7: 北方稀土, 国金证券, 青岛海尔 Cluster 8: 中国中铁, 中国人寿, 中国中车, 中国重工, 中国联通, 中国建筑 （3）x = var/var.std(0) Covariance : 2.42169315704e-04 Cluster 1: 中国中车 Cluster 2: 海油工程, 中国重工, 中航动力, 中国船舶 Cluster 3: 东方明珠, 广汇能源, 特变电工, 国电南瑞 Cluster 4: 北方稀土, 贵州茅台, 伊利股份, 北京银行, 康美药业, 华夏银行, 上汽集团, 青岛海尔 Cluster 5: 中国中铁, 中国交建, 中国铁建, 中国联通, 中国建筑 Cluster 6: 海通证券, 招商证券, 中国人寿, 华泰证券, 中国太保, 中信证券, 方正证券 Cluster 7: 包钢股份, 国金证券 Cluster 8: 东方证券 Cluster 9: 大秦铁路, 浦发银行, 海螺水泥, 兴业银行, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 中国石油, 保利地产, 上港集团, 招商银行, 交通银行, 中国神华, 工商银行, 民生银行 阅读更多" />
<meta property="og:description" content="1. 为什么要对股票进行聚类 1.1 投资组合优化理论 股票聚类的基本原因就是从股市中选取一部股票进行投资。哪怕是上证50对一般的投资模型来说50条股票也太多了。 按照投资组合优化理论选取标准为： （1）资产数越多越好 （2）资产之间相关系数越低越好 以期望收益E来衡量证券收益，以收益的方差 δ2 表示投资风险 　　 minδ2(rp)=∑∑wiwjcov(ri,rj) 　　 E(rp)=∑wiri 　　式中： 　　 rp ——组合收益； 　　 ri 、 rj ——第i种、第j种资产的收益； 　　 wi 、 wj ——资产i和资产j在组合中的权重； 　　 δ2(rp) ——组合收益的方差即组合的总体风险； 　　 cov(r,rj) ——两种资产之间的协方差。 举个极端的例子：（以后再详细说吧，搞一个简单的例子） 有n个不相关的资产，其收益率都是r，风险都是v，优化后的投资比例应该是均分（还用优化吗……） 那资产组合的 收益：R = r 风险：V = v/n 1.2 聚类 聚类定义就不说了，经过对股票交易数据聚类后，可以将其分为几个类别，然后从每个类别中选一个样本，最后组成的样本可使样本之间的相关系数降至最低。 这样保证在一定的风险下使收益更高。 这里采用sklearn中affinity_propagation算法进行聚类。 2. 读取上证50成分股 dict_stock = {} def ReadStocks(stock_file): print &#39;read_stocks...&#39; f = open(stock_file, &#39;r&#39;) for line in f.readlines(): # str_line = str(line) item = line.strip().split(&#39; &#39;) dict_stock[item[0]] = item[1] f.close() 3. 读取股票交易数据 用QSTK API获取股票交易数据。 之前的文件已经介绍过了，这里提2点： （1）验证股票代码是否正确，移除异常股票，不然QSTK会报错 db = DataAccess.DataAccess(&#39;Yahoo&#39;) ls_all_syms = db.get_all_symbols() ls_bad_syms = list(set(ls_stock_code) - set(ls_all_syms)) print &#39;Bad Stock Code : &#39;, ls_bad_syms for sym in ls_bad_syms: ls_stock_code.remove(sym) （2）对获取的数据进行清理，不然SKLearn会报错 # Filling the data for NAN for s_key in ls_keys: dict_data[s_key] = dict_data[s_key].fillna(method=&#39;ffill&#39;) dict_data[s_key] = dict_data[s_key].fillna(method=&#39;bfill&#39;) dict_data[s_key] = dict_data[s_key].fillna(1.0) 4. 聚类 4.1 载入数据 open = stock_data[&#39;open&#39;] close = stock_data[&#39;close&#39;] var = close - open open, close, var的数据类型都是pandas DataFrame类型。 print type(open) &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; print open.iloc[:3, 1:3] 600837.SS 600000.SS 2015-01-02 16:00:00 24.06 15.69 2015-01-05 16:00:00 23.82 15.94 2015-01-06 16:00:00 23.30 16.00 关于pandas的使用参考下： 十分钟搞定pandas 4.2 sklearn 聚类 from sklearn import covariance, cluster x = var/var.std(0) edge_model = covariance.GraphLassoCV() edge_model.fit(x) centers, labels = cluster.affinity_propagation(edge_model.covariance_) 结果输出 n_labels = labels.max() print &#39;Centers : \n&#39;, &#39;, &#39;.join( np.array(dict_stock.values())[centers] ) for i in range(n_labels + 1): print(&#39;Cluster %i: %s&#39; % ((i + 1), &#39;, &#39;.join([dict_stock[key] for key in var.columns[labels == i]]))) 5. 聚类因子选择 这里比较了几种因子的聚类结果 （1）x = var*vol*10e-9/var.std(0) Covariance : 1.26342386383e-04 海螺水泥, 东方明珠, 中国平安, 中国交建, 中航动力, 包钢股份, 民生银行, 青岛海尔 Cluster 1: 大秦铁路, 海螺水泥, 贵州茅台, 华泰证券, 中国太保, 伊利股份, 中国石油, 中国神华 Cluster 2: 东方明珠, 保利地产, 特变电工 Cluster 3: 中国交建, 广汇能源 Cluster 4: 海通证券, 浦发银行, 招商证券, 兴业银行, 中信银行, 中国中车, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 中信证券, 招商银行, 交通银行, 包钢股份, 工商银行, 民生银行 Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 Cluster 6: 海油工程, 中航动力, 东方证券, 华夏银行, 国电南瑞, 上汽集团 Cluster 7: 北方稀土, 国金证券, 青岛海尔 Cluster 8: 中国中铁, 中国人寿, 中国重工, 中国铁建, 中国联通, 中国建筑 （2）x = var*np.sqrt(vol*10e-8)/(var.std(0)*np.log2(close)) Covariance : 1.16200812467e-04 海螺水泥, 东方明珠, 中国平安, 光大银行, 中航动力, 包钢股份, 民生银行, 青岛海尔 Cluster 1: 大秦铁路, 海螺水泥, 华泰证券, 中国太保, 伊利股份, 中国石油, 中信证券, 中国神华 Cluster 2: 东方明珠, 保利地产, 特变电工 Cluster 3: 中国交建, 广汇能源, 中国铁建, 包钢股份 Cluster 4: 浦发银行, 兴业银行, 贵州茅台, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 招商银行, 交通银行, 华夏银行, 工商银行, 民生银行 Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 Cluster 6: 海通证券, 招商证券, 海油工程, 中航动力, 东方证券, 国电南瑞, 上汽集团 Cluster 7: 北方稀土, 国金证券, 青岛海尔 Cluster 8: 中国中铁, 中国人寿, 中国中车, 中国重工, 中国联通, 中国建筑 （3）x = var/var.std(0) Covariance : 2.42169315704e-04 Cluster 1: 中国中车 Cluster 2: 海油工程, 中国重工, 中航动力, 中国船舶 Cluster 3: 东方明珠, 广汇能源, 特变电工, 国电南瑞 Cluster 4: 北方稀土, 贵州茅台, 伊利股份, 北京银行, 康美药业, 华夏银行, 上汽集团, 青岛海尔 Cluster 5: 中国中铁, 中国交建, 中国铁建, 中国联通, 中国建筑 Cluster 6: 海通证券, 招商证券, 中国人寿, 华泰证券, 中国太保, 中信证券, 方正证券 Cluster 7: 包钢股份, 国金证券 Cluster 8: 东方证券 Cluster 9: 大秦铁路, 浦发银行, 海螺水泥, 兴业银行, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 中国石油, 保利地产, 上港集团, 招商银行, 交通银行, 中国神华, 工商银行, 民生银行 阅读更多" />
<link rel="canonical" href="https://mlh.app/2016/02/25/0d72cf676419760d6948bc387a2e93cf.html" />
<meta property="og:url" content="https://mlh.app/2016/02/25/0d72cf676419760d6948bc387a2e93cf.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-25T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1. 为什么要对股票进行聚类 1.1 投资组合优化理论 股票聚类的基本原因就是从股市中选取一部股票进行投资。哪怕是上证50对一般的投资模型来说50条股票也太多了。 按照投资组合优化理论选取标准为： （1）资产数越多越好 （2）资产之间相关系数越低越好 以期望收益E来衡量证券收益，以收益的方差 δ2 表示投资风险 　　 minδ2(rp)=∑∑wiwjcov(ri,rj) 　　 E(rp)=∑wiri 　　式中： 　　 rp ——组合收益； 　　 ri 、 rj ——第i种、第j种资产的收益； 　　 wi 、 wj ——资产i和资产j在组合中的权重； 　　 δ2(rp) ——组合收益的方差即组合的总体风险； 　　 cov(r,rj) ——两种资产之间的协方差。 举个极端的例子：（以后再详细说吧，搞一个简单的例子） 有n个不相关的资产，其收益率都是r，风险都是v，优化后的投资比例应该是均分（还用优化吗……） 那资产组合的 收益：R = r 风险：V = v/n 1.2 聚类 聚类定义就不说了，经过对股票交易数据聚类后，可以将其分为几个类别，然后从每个类别中选一个样本，最后组成的样本可使样本之间的相关系数降至最低。 这样保证在一定的风险下使收益更高。 这里采用sklearn中affinity_propagation算法进行聚类。 2. 读取上证50成分股 dict_stock = {} def ReadStocks(stock_file): print &#39;read_stocks...&#39; f = open(stock_file, &#39;r&#39;) for line in f.readlines(): # str_line = str(line) item = line.strip().split(&#39; &#39;) dict_stock[item[0]] = item[1] f.close() 3. 读取股票交易数据 用QSTK API获取股票交易数据。 之前的文件已经介绍过了，这里提2点： （1）验证股票代码是否正确，移除异常股票，不然QSTK会报错 db = DataAccess.DataAccess(&#39;Yahoo&#39;) ls_all_syms = db.get_all_symbols() ls_bad_syms = list(set(ls_stock_code) - set(ls_all_syms)) print &#39;Bad Stock Code : &#39;, ls_bad_syms for sym in ls_bad_syms: ls_stock_code.remove(sym) （2）对获取的数据进行清理，不然SKLearn会报错 # Filling the data for NAN for s_key in ls_keys: dict_data[s_key] = dict_data[s_key].fillna(method=&#39;ffill&#39;) dict_data[s_key] = dict_data[s_key].fillna(method=&#39;bfill&#39;) dict_data[s_key] = dict_data[s_key].fillna(1.0) 4. 聚类 4.1 载入数据 open = stock_data[&#39;open&#39;] close = stock_data[&#39;close&#39;] var = close - open open, close, var的数据类型都是pandas DataFrame类型。 print type(open) &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; print open.iloc[:3, 1:3] 600837.SS 600000.SS 2015-01-02 16:00:00 24.06 15.69 2015-01-05 16:00:00 23.82 15.94 2015-01-06 16:00:00 23.30 16.00 关于pandas的使用参考下： 十分钟搞定pandas 4.2 sklearn 聚类 from sklearn import covariance, cluster x = var/var.std(0) edge_model = covariance.GraphLassoCV() edge_model.fit(x) centers, labels = cluster.affinity_propagation(edge_model.covariance_) 结果输出 n_labels = labels.max() print &#39;Centers : \\n&#39;, &#39;, &#39;.join( np.array(dict_stock.values())[centers] ) for i in range(n_labels + 1): print(&#39;Cluster %i: %s&#39; % ((i + 1), &#39;, &#39;.join([dict_stock[key] for key in var.columns[labels == i]]))) 5. 聚类因子选择 这里比较了几种因子的聚类结果 （1）x = var*vol*10e-9/var.std(0) Covariance : 1.26342386383e-04 海螺水泥, 东方明珠, 中国平安, 中国交建, 中航动力, 包钢股份, 民生银行, 青岛海尔 Cluster 1: 大秦铁路, 海螺水泥, 贵州茅台, 华泰证券, 中国太保, 伊利股份, 中国石油, 中国神华 Cluster 2: 东方明珠, 保利地产, 特变电工 Cluster 3: 中国交建, 广汇能源 Cluster 4: 海通证券, 浦发银行, 招商证券, 兴业银行, 中信银行, 中国中车, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 中信证券, 招商银行, 交通银行, 包钢股份, 工商银行, 民生银行 Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 Cluster 6: 海油工程, 中航动力, 东方证券, 华夏银行, 国电南瑞, 上汽集团 Cluster 7: 北方稀土, 国金证券, 青岛海尔 Cluster 8: 中国中铁, 中国人寿, 中国重工, 中国铁建, 中国联通, 中国建筑 （2）x = var*np.sqrt(vol*10e-8)/(var.std(0)*np.log2(close)) Covariance : 1.16200812467e-04 海螺水泥, 东方明珠, 中国平安, 光大银行, 中航动力, 包钢股份, 民生银行, 青岛海尔 Cluster 1: 大秦铁路, 海螺水泥, 华泰证券, 中国太保, 伊利股份, 中国石油, 中信证券, 中国神华 Cluster 2: 东方明珠, 保利地产, 特变电工 Cluster 3: 中国交建, 广汇能源, 中国铁建, 包钢股份 Cluster 4: 浦发银行, 兴业银行, 贵州茅台, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 招商银行, 交通银行, 华夏银行, 工商银行, 民生银行 Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 Cluster 6: 海通证券, 招商证券, 海油工程, 中航动力, 东方证券, 国电南瑞, 上汽集团 Cluster 7: 北方稀土, 国金证券, 青岛海尔 Cluster 8: 中国中铁, 中国人寿, 中国中车, 中国重工, 中国联通, 中国建筑 （3）x = var/var.std(0) Covariance : 2.42169315704e-04 Cluster 1: 中国中车 Cluster 2: 海油工程, 中国重工, 中航动力, 中国船舶 Cluster 3: 东方明珠, 广汇能源, 特变电工, 国电南瑞 Cluster 4: 北方稀土, 贵州茅台, 伊利股份, 北京银行, 康美药业, 华夏银行, 上汽集团, 青岛海尔 Cluster 5: 中国中铁, 中国交建, 中国铁建, 中国联通, 中国建筑 Cluster 6: 海通证券, 招商证券, 中国人寿, 华泰证券, 中国太保, 中信证券, 方正证券 Cluster 7: 包钢股份, 国金证券 Cluster 8: 东方证券 Cluster 9: 大秦铁路, 浦发银行, 海螺水泥, 兴业银行, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 中国石油, 保利地产, 上港集团, 招商银行, 交通银行, 中国神华, 工商银行, 民生银行 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2016/02/25/0d72cf676419760d6948bc387a2e93cf.html","headline":"SkLearn 对上证50成分股聚类","dateModified":"2016-02-25T00:00:00+08:00","datePublished":"2016-02-25T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2016/02/25/0d72cf676419760d6948bc387a2e93cf.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>SkLearn 对上证50成分股聚类</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h1 id="1-为什么要对股票进行聚类">1. 为什么要对股票进行聚类</h1> 
  <h2 id="11-投资组合优化理论">1.1 投资组合优化理论</h2> 
  <p>股票聚类的基本原因就是从股市中选取一部股票进行投资。哪怕是上证50对一般的投资模型来说50条股票也太多了。 <br> 按照投资组合优化理论选取标准为： <br> （1）资产数越多越好 <br> （2）资产之间相关系数越低越好</p> 
  <p>以期望收益E来衡量证券收益，以收益的方差<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-1-Frame" class="MathJax">
    <nobr>
     <span style="width: 1.083em; display: inline-block;" id="MathJax-Span-1" class="math"><span style="display: inline-block; position: relative; width: 0.882em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.289em, 1000em, 2.544em, -0.46em); top: -2.369em; left: 0em;"><span id="MathJax-Span-2" class="mrow"><span id="MathJax-Span-3" class="msubsup"><span style="display: inline-block; position: relative; width: 0.901em; height: 0px;"><span style="position: absolute; clip: rect(1.597em, 1000em, 2.655em, -0.46em); top: -2.479em; left: 0em;"><span id="MathJax-Span-4" class="texatom"><span id="MathJax-Span-5" class="mrow"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-6" class="mo">δ</span></span></span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.868em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Main;" id="MathJax-Span-7" class="mn">2</span><span style="display: inline-block; width: 0px; height: 2.424em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.252em; vertical-align: -0.079em;"></span></span>
    </nobr></span><script id="MathJax-Element-1" type="math/tex">δ^2</script>表示投资风险 <br> 　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-2-Frame" class="MathJax">
    <nobr>
     <span style="width: 17.683em; display: inline-block;" id="MathJax-Span-8" class="math"><span style="display: inline-block; position: relative; width: 14.601em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.62em, 1000em, 3.159em, -0.471em); top: -2.7em; left: 0em;"><span id="MathJax-Span-9" class="mrow"><span style="font-family: MathJax_Main;" id="MathJax-Span-10" class="mo">min</span><span style="padding-left: 0.167em;" id="MathJax-Span-11" class="msubsup"><span style="display: inline-block; position: relative; width: 0.954em; height: 0px;"><span style="position: absolute; clip: rect(1.597em, 1000em, 2.655em, -0.46em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-12" class="mi">δ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.868em; left: 0.493em;"><span style="font-size: 70.7%; font-family: MathJax_Main;" id="MathJax-Span-13" class="mn">2</span><span style="display: inline-block; width: 0px; height: 2.424em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-14" class="mo">(</span><span id="MathJax-Span-15" class="msubsup"><span style="display: inline-block; position: relative; width: 0.901em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-16" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-17" class="mi">p</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-18" class="mo">)</span><span style="font-family: MathJax_Main; padding-left: 0.278em;" id="MathJax-Span-19" class="mo">=</span><span style="font-family: MathJax_Size1; vertical-align: 0em; padding-left: 0.278em;" id="MathJax-Span-20" class="mo">∑</span><span style="font-family: MathJax_Size1; vertical-align: 0em; padding-left: 0.167em;" id="MathJax-Span-21" class="mo">∑</span><span style="padding-left: 0.167em;" id="MathJax-Span-22" class="msubsup"><span style="display: inline-block; position: relative; width: 1.012em; height: 0px;"><span style="position: absolute; clip: rect(1.871em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-23" class="mi">w</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.716em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-24" class="mi">i</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span id="MathJax-Span-25" class="msubsup"><span style="display: inline-block; position: relative; width: 1.122em; height: 0px;"><span style="position: absolute; clip: rect(1.871em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-26" class="mi">w</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.716em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-27" class="mi">j</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-28" class="mi">c</span><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-29" class="mi">o</span><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-30" class="mi">v</span><span style="font-family: MathJax_Main;" id="MathJax-Span-31" class="mo">(</span><span id="MathJax-Span-32" class="msubsup"><span style="display: inline-block; position: relative; width: 0.736em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-33" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-34" class="mi">i</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-35" class="mo">,</span><span style="padding-left: 0.167em;" id="MathJax-Span-36" class="msubsup"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-37" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-38" class="mi">j</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-39" class="mo">)</span></span><span style="display: inline-block; width: 0px; height: 2.7em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.596em; vertical-align: -0.423em;"></span></span>
    </nobr></span><script id="MathJax-Element-2" type="math/tex">\min\delta^2(r_p)=\sum\sum w_iw_jcov(r_i,r_j)</script></p> 
  <p>　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-3-Frame" class="MathJax">
    <nobr>
     <span style="width: 8.15em; display: inline-block;" id="MathJax-Span-40" class="math"><span style="display: inline-block; position: relative; width: 6.722em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.784em, 1000em, 3.152em, -0.465em); top: -2.7em; left: 0em;"><span id="MathJax-Span-41" class="mrow"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-42" class="mi">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-43" class="mo">(</span><span id="MathJax-Span-44" class="msubsup"><span style="display: inline-block; position: relative; width: 0.901em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-45" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-46" class="mi">p</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-47" class="mo">)</span><span style="font-family: MathJax_Main; padding-left: 0.278em;" id="MathJax-Span-48" class="mo">=</span><span style="font-family: MathJax_Size1; vertical-align: 0em; padding-left: 0.278em;" id="MathJax-Span-49" class="mo">∑</span><span style="padding-left: 0.167em;" id="MathJax-Span-50" class="msubsup"><span style="display: inline-block; position: relative; width: 1.012em; height: 0px;"><span style="position: absolute; clip: rect(1.871em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-51" class="mi">w</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.716em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-52" class="mi">i</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span id="MathJax-Span-53" class="msubsup"><span style="display: inline-block; position: relative; width: 0.736em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-54" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-55" class="mi">i</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.7em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.388em; vertical-align: -0.414em;"></span></span>
    </nobr></span><script id="MathJax-Element-3" type="math/tex">E(r_p)=\sum w_ir_i</script></p> 
  <p>　　式中： <br> 　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-4-Frame" class="MathJax">
    <nobr>
     <span style="width: 1.083em; display: inline-block;" id="MathJax-Span-56" class="math"><span style="display: inline-block; position: relative; width: 0.882em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.762em, 1000em, 2.822em, -0.475em); top: -2.369em; left: 0em;"><span id="MathJax-Span-57" class="mrow"><span id="MathJax-Span-58" class="msubsup"><span style="display: inline-block; position: relative; width: 0.901em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-59" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-60" class="mi">p</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.016em; vertical-align: -0.414em;"></span></span>
    </nobr></span><script id="MathJax-Element-4" type="math/tex">r_p</script>——组合收益；</p> 
  <p>　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-5-Frame" class="MathJax">
    <nobr>
     <span style="width: 0.883em; display: inline-block;" id="MathJax-Span-61" class="math"><span style="display: inline-block; position: relative; width: 0.716em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.762em, 1000em, 2.692em, -0.475em); top: -2.369em; left: 0em;"><span id="MathJax-Span-62" class="mrow"><span id="MathJax-Span-63" class="msubsup"><span style="display: inline-block; position: relative; width: 0.736em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-64" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-65" class="mi">i</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 0.859em; vertical-align: -0.258em;"></span></span>
    </nobr></span><script id="MathJax-Element-5" type="math/tex">r_i</script>、<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-6-Frame" class="MathJax">
    <nobr>
     <span style="width: 1.017em; display: inline-block;" id="MathJax-Span-66" class="math"><span style="display: inline-block; position: relative; width: 0.826em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.762em, 1000em, 2.829em, -0.475em); top: -2.369em; left: 0em;"><span id="MathJax-Span-67" class="mrow"><span id="MathJax-Span-68" class="msubsup"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-69" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-70" class="mi">j</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.024em; vertical-align: -0.423em;"></span></span>
    </nobr></span><script id="MathJax-Element-6" type="math/tex">r_j</script>——第i种、第j种资产的收益；</p> 
  <p>　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-7-Frame" class="MathJax">
    <nobr>
     <span style="width: 1.217em; display: inline-block;" id="MathJax-Span-71" class="math"><span style="display: inline-block; position: relative; width: 0.992em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.761em, 1000em, 2.692em, -0.475em); top: -2.369em; left: 0em;"><span id="MathJax-Span-72" class="mrow"><span id="MathJax-Span-73" class="msubsup"><span style="display: inline-block; position: relative; width: 1.012em; height: 0px;"><span style="position: absolute; clip: rect(1.871em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-74" class="mi">w</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.716em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-75" class="mi">i</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 0.86em; vertical-align: -0.258em;"></span></span>
    </nobr></span><script id="MathJax-Element-7" type="math/tex">w_i</script>、<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-8-Frame" class="MathJax">
    <nobr>
     <span style="width: 1.35em; display: inline-block;" id="MathJax-Span-76" class="math"><span style="display: inline-block; position: relative; width: 1.102em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.761em, 1000em, 2.829em, -0.475em); top: -2.369em; left: 0em;"><span id="MathJax-Span-77" class="mrow"><span id="MathJax-Span-78" class="msubsup"><span style="display: inline-block; position: relative; width: 1.122em; height: 0px;"><span style="position: absolute; clip: rect(1.871em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-79" class="mi">w</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.716em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-80" class="mi">j</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.025em; vertical-align: -0.423em;"></span></span>
    </nobr></span><script id="MathJax-Element-8" type="math/tex">w_j</script>——资产i和资产j在组合中的权重；</p> 
  <p>　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-9-Frame" class="MathJax">
    <nobr>
     <span style="width: 3.083em; display: inline-block;" id="MathJax-Span-81" class="math"><span style="display: inline-block; position: relative; width: 2.534em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.564em, 1000em, 3.097em, -0.46em); top: -2.645em; left: 0em;"><span id="MathJax-Span-82" class="mrow"><span id="MathJax-Span-83" class="msubsup"><span style="display: inline-block; position: relative; width: 0.901em; height: 0px;"><span style="position: absolute; clip: rect(1.597em, 1000em, 2.655em, -0.46em); top: -2.479em; left: 0em;"><span id="MathJax-Span-84" class="texatom"><span id="MathJax-Span-85" class="mrow"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-86" class="mo">δ</span></span></span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.868em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Main;" id="MathJax-Span-87" class="mn">2</span><span style="display: inline-block; width: 0px; height: 2.424em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-88" class="mo">(</span><span id="MathJax-Span-89" class="msubsup"><span style="display: inline-block; position: relative; width: 0.901em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-90" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-91" class="mi">p</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-92" class="mo">)</span></span><span style="display: inline-block; width: 0px; height: 2.645em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.588em; vertical-align: -0.414em;"></span></span>
    </nobr></span><script id="MathJax-Element-9" type="math/tex">δ^2(r_p)</script>——组合收益的方差即组合的总体风险；</p> 
  <p>　　<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-10-Frame" class="MathJax">
    <nobr>
     <span style="width: 4.75em; display: inline-block;" id="MathJax-Span-93" class="math"><span style="display: inline-block; position: relative; width: 3.912em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.729em, 1000em, 3.104em, -0.462em); top: -2.645em; left: 0em;"><span id="MathJax-Span-94" class="mrow"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-95" class="mi">c</span><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-96" class="mi">o</span><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-97" class="mi">v</span><span style="font-family: MathJax_Main;" id="MathJax-Span-98" class="mo">(</span><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-99" class="mi">r</span><span style="font-family: MathJax_Main;" id="MathJax-Span-100" class="mo">,</span><span style="padding-left: 0.167em;" id="MathJax-Span-101" class="msubsup"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(1.872em, 1000em, 2.656em, -0.475em); top: -2.479em; left: 0em;"><span style="font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-102" class="mi">r</span><span style="display: inline-block; width: 0px; height: 2.479em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.441em;"><span style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;" id="MathJax-Span-103" class="mi">j</span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span></span><span style="font-family: MathJax_Main;" id="MathJax-Span-104" class="mo">)</span></span><span style="display: inline-block; width: 0px; height: 2.645em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.397em; vertical-align: -0.423em;"></span></span>
    </nobr></span><script id="MathJax-Element-10" type="math/tex">cov(r,r_j)</script>——两种资产之间的协方差。 <br> 举个极端的例子：（以后再详细说吧，搞一个简单的例子） <br> 有n个不相关的资产，其收益率都是r，风险都是v，优化后的投资比例应该是均分（还用优化吗……） <br> 那资产组合的 <br> 收益：R = r <br> 风险：V = v/n</p> 
  <h2 id="12-聚类">1.2 聚类</h2> 
  <p>聚类定义就不说了，经过对股票交易数据聚类后，可以将其分为几个类别，然后从每个类别中选一个样本，最后组成的样本可使样本之间的相关系数降至最低。 <br> 这样保证在一定的风险下使收益更高。 <br> 这里采用sklearn中affinity_propagation算法进行聚类。</p> 
  <hr> 
  <h1 id="2-读取上证50成分股">2. 读取上证50成分股</h1> 
  <pre class="prettyprint"><code class=" hljs python">dict_stock = {}

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ReadStocks</span><span class="hljs-params">(stock_file)</span>:</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">'read_stocks...'</span>

    f = open(stock_file, <span class="hljs-string">'r'</span>)
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f.readlines():
        <span class="hljs-comment"># str_line = str(line)</span>
        item = line.strip().split(<span class="hljs-string">' '</span>)
        dict_stock[item[<span class="hljs-number">0</span>]] = item[<span class="hljs-number">1</span>]

    f.close()</code></pre> 
  <hr> 
  <h1 id="3-读取股票交易数据">3. 读取股票交易数据</h1> 
  <p>用QSTK API获取股票交易数据。 <br> 之前的文件已经介绍过了，这里提2点： <br> （1）验证股票代码是否正确，移除异常股票，不然QSTK会报错</p> 
  <pre class="prettyprint"><code class=" hljs oxygene">    db = DataAccess.DataAccess(<span class="hljs-string">'Yahoo'</span>)

    ls_all_syms = db.get_all_symbols()
    ls_bad_syms = list(<span class="hljs-keyword">set</span>(ls_stock_code) - <span class="hljs-keyword">set</span>(ls_all_syms))
    print <span class="hljs-string">'Bad Stock Code : '</span>, ls_bad_syms

    <span class="hljs-keyword">for</span> sym <span class="hljs-keyword">in</span> ls_bad_syms:
        ls_stock_code.<span class="hljs-keyword">remove</span>(sym)</code></pre> 
  <p>（2）对获取的数据进行清理，不然SKLearn会报错</p> 
  <pre class="prettyprint"><code class=" hljs oxygene">    # Filling the data <span class="hljs-keyword">for</span> NAN
    <span class="hljs-keyword">for</span> s_key <span class="hljs-keyword">in</span> ls_keys:
        dict_data[s_key] = dict_data[s_key].fillna(<span class="hljs-function"><span class="hljs-keyword">method</span>='<span class="hljs-title">ffill</span>') <span class="hljs-title">dict_data</span>[<span class="hljs-title">s_key</span>] = <span class="hljs-title">dict_data</span>[<span class="hljs-title">s_key</span>].<span class="hljs-title">fillna</span><span class="hljs-params">(<span class="hljs-keyword">method</span>=<span class="hljs-string">'bfill'</span>)</span> <span class="hljs-title">dict_data</span>[<span class="hljs-title">s_key</span>] = <span class="hljs-title">dict_data</span>[<span class="hljs-title">s_key</span>].<span class="hljs-title">fillna</span><span class="hljs-params">(1.0)</span></span></code></pre> 
  <hr> 
  <h1 id="4-聚类">4. 聚类</h1> 
  <h2 id="41-载入数据">4.1 载入数据</h2> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">    <span class="hljs-built_in">open</span> = stock_data[<span class="hljs-string">'open'</span>]
    <span class="hljs-built_in">close</span> = stock_data[<span class="hljs-string">'close'</span>]
    var =  <span class="hljs-built_in">close</span> - <span class="hljs-built_in">open</span></code></pre> 
  <p>open, close, var的数据类型都是pandas DataFrame类型。</p> 
  <pre class="prettyprint"><code class=" hljs ocaml">print <span class="hljs-class"><span class="hljs-keyword">type</span>(</span><span class="hljs-keyword">open</span>)
&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">'pandas.core.frame.DataFrame'</span>&gt;

print <span class="hljs-keyword">open</span>.iloc[:<span class="hljs-number">3</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>]

                     <span class="hljs-number">600837.</span>SS  <span class="hljs-number">600000.</span>SS
<span class="hljs-number">2015</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">16</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>      <span class="hljs-number">24.06</span>      <span class="hljs-number">15.69</span>
<span class="hljs-number">2015</span>-<span class="hljs-number">01</span>-<span class="hljs-number">05</span> <span class="hljs-number">16</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>      <span class="hljs-number">23.82</span>      <span class="hljs-number">15.94</span>
<span class="hljs-number">2015</span>-<span class="hljs-number">01</span>-<span class="hljs-number">06</span> <span class="hljs-number">16</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>      <span class="hljs-number">23.30</span>      <span class="hljs-number">16.00</span></code></pre> 
  <p>关于pandas的使用参考下： <br> <a href="http://blog.csdn.net/matrix_laboratory/article/details/50704160" rel="nofollow">十分钟搞定pandas</a> </p> 
  <h1 id="42-sklearn-聚类">4.2 sklearn 聚类</h1> 
  <pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> covariance, cluster

    x = var/var.std(<span class="hljs-number">0</span>)
    edge_model = covariance.GraphLassoCV()
    edge_model.fit(x)
    centers, labels = cluster.affinity_propagation(edge_model.covariance_)</code></pre> 
  <p>结果输出</p> 
  <pre class="prettyprint"><code class=" hljs oxygene">    n_labels = labels.max()
    print <span class="hljs-string">'Centers : \n'</span>, <span class="hljs-string">', '</span>.<span class="hljs-keyword">join</span>( np.<span class="hljs-keyword">array</span>(dict_stock.values())[centers] )

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n_labels + <span class="hljs-number">1</span>):
        print(<span class="hljs-string">'Cluster %i: %s'</span> %
              ((i + <span class="hljs-number">1</span>), <span class="hljs-string">', '</span>.<span class="hljs-keyword">join</span>([dict_stock[key]
                                   <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">var</span>.columns[labels == i]])))</code></pre> 
  <h1 id="5-聚类因子选择">5. 聚类因子选择</h1> 
  <p>这里比较了几种因子的聚类结果 <br> （1）x = var*vol*10e-9/var.std(0)</p> 
  <blockquote> 
   <p>Covariance : 1.26342386383e-04 <br> 海螺水泥, 东方明珠, 中国平安, 中国交建, 中航动力, 包钢股份, 民生银行, 青岛海尔 <br> Cluster 1: 大秦铁路, 海螺水泥, 贵州茅台, 华泰证券, 中国太保, 伊利股份, 中国石油, 中国神华 <br> Cluster 2: 东方明珠, 保利地产, 特变电工 <br> Cluster 3: 中国交建, 广汇能源 <br> Cluster 4: 海通证券, 浦发银行, 招商证券, 兴业银行, 中信银行, 中国中车, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 中信证券, 招商银行, 交通银行, 包钢股份, 工商银行, 民生银行 <br> Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 <br> Cluster 6: 海油工程, 中航动力, 东方证券, 华夏银行, 国电南瑞, 上汽集团 <br> Cluster 7: 北方稀土, 国金证券, 青岛海尔 <br> Cluster 8: 中国中铁, 中国人寿, 中国重工, 中国铁建, 中国联通, 中国建筑 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160226142354099" alt="这里写图片描述" title=""></p> 
  </blockquote> 
  <p>（2）x = var*np.sqrt(vol*10e-8)/(var.std(0)*np.log2(close))</p> 
  <blockquote> 
   <p>Covariance : 1.16200812467e-04 <br> 海螺水泥, 东方明珠, 中国平安, 光大银行, 中航动力, 包钢股份, 民生银行, 青岛海尔 <br> Cluster 1: 大秦铁路, 海螺水泥, 华泰证券, 中国太保, 伊利股份, 中国石油, 中信证券, 中国神华 <br> Cluster 2: 东方明珠, 保利地产, 特变电工 <br> Cluster 3: 中国交建, 广汇能源, 中国铁建, 包钢股份 <br> Cluster 4: 浦发银行, 兴业银行, 贵州茅台, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 北京银行, 招商银行, 交通银行, 华夏银行, 工商银行, 民生银行 <br> Cluster 5: 上港集团, 康美药业, 方正证券, 中国船舶 <br> Cluster 6: 海通证券, 招商证券, 海油工程, 中航动力, 东方证券, 国电南瑞, 上汽集团 <br> Cluster 7: 北方稀土, 国金证券, 青岛海尔 <br> Cluster 8: 中国中铁, 中国人寿, 中国中车, 中国重工, 中国联通, 中国建筑 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160226180541421" alt="这里写图片描述" title=""></p> 
  </blockquote> 
  <p>（3）x = var/var.std(0)</p> 
  <blockquote> 
   <p>Covariance : 2.42169315704e-04 <br> Cluster 1: 中国中车 <br> Cluster 2: 海油工程, 中国重工, 中航动力, 中国船舶 <br> Cluster 3: 东方明珠, 广汇能源, 特变电工, 国电南瑞 <br> Cluster 4: 北方稀土, 贵州茅台, 伊利股份, 北京银行, 康美药业, 华夏银行, 上汽集团, 青岛海尔 <br> Cluster 5: 中国中铁, 中国交建, 中国铁建, 中国联通, 中国建筑 <br> Cluster 6: 海通证券, 招商证券, 中国人寿, 华泰证券, 中国太保, 中信证券, 方正证券 <br> Cluster 7: 包钢股份, 国金证券 <br> Cluster 8: 东方证券 <br> Cluster 9: 大秦铁路, 浦发银行, 海螺水泥, 兴业银行, 中信银行, 中国银行, 光大银行, 农业银行, 中国石化, 中国石油, 保利地产, 上港集团, 招商银行, 交通银行, 中国神华, 工商银行, 民生银行 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160226142414252" alt="这里写图片描述" title=""></p> 
  </blockquote> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/matrix_laboratory/article/details/50738917,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/matrix_laboratory/article/details/50738917,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

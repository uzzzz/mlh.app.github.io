<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>支付宝支付开发—当面付条码支付和扫码支付 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="支付宝支付开发—当面付条码支付和扫码支付" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为方倍工作室原创文章，未经授权不得转载。 https://blog.csdn.net/txw1958/article/details/52330990 关键字：支付宝 当面付 条码支付 扫码支付 二维码支付 订单查询 退款 作者：方倍工作室 本文介绍支付宝中当面付下属的条码支付、扫码支付、订单查询、退款申请的集成开发过程。 &nbsp; 本文分为以下五个部分： 条码支付和扫码支付介绍 申请应用 密钥生成及配置 API及SDK集成 条码支付、扫码支付、订单查询、退款申请 &nbsp; 一、条码支付及二维码支付介绍 1. 条码支付 条码支付是支付宝给到线下传统行业的一种收款方式。商家使用扫码枪等条码识别设备扫描用户支付宝钱包上的条码/二维码，完成收款。用户仅需出示付款码，所有收款操作由商家端完成。其使用场景如下： 业务流程： 使用步骤： 用户登陆支付宝钱包，点击首页“付款”，进入付款码界面； 收银员在商家收银系统操作生成订单，用户确认支付金额； 用户出示钱包的“付款码”，收银员用扫码设备来扫描用户手机上的条码/二维码后，商家收银系统提交支付； 付款成功后商家收银系统会拿到支付成功或者失败的结果。 2. 扫码支付 扫码支付，指用户打开支付宝钱包中的“扫一扫”功能，扫描商家展示在某收银场景下的二维码并进行支付的模式。该模式适用于线下实体店支付、面对面支付等场景。 其使用场景如下： 业务流程： 使用步骤： 用户登陆支付宝钱包，点击首页“付款-扫码付”，进入扫一扫界面； 收银员在商家收银系统操作生成支付宝订单，用户确认支付金额，并生成二维码； 用户使用钱包的“扫码付”，扫收银员提供的二维码，确认支付； 用户付款后商家收银系统会拿到支付成功或者失败的结果。 &nbsp; 二、接口申请 企业在申请企业支付宝之后，进行功能申请并签约，然后在蚂蚁金服开放平台中申请应用如下（详细过程就略了） 然后在功能列表中，申请当面付这一功能，申请成功后如下。 这样，我们就有了当面付的权限了。 &nbsp; &nbsp; 三、密钥生成 在支付宝当面付的接口中，使用了非对称加密算法，商户自己的公钥和私钥需要自己使用OpenSSL手动生成。对这些概念比较陌生的话，请先自行先了解一下密码学的相关知识。OpenSSL也可以从方倍工作室博客中找到。 下载支付宝官方提供的密钥生成工具OpenSSL，然后执行以下命令就可以生成公钥和私钥。 其中 genrsa -out rsa_private_key.pem 1024 是用于生成RSA私钥，执行后在程序目录中生成一个文件rsa_private_key.pem，其内容如下 -----BEGIN RSA PRIVATE KEY----- MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b 3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTITasd hHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiJOxW02rxSQIDAQAB AoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVN JgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCz cEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQ qVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/H nGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3123 T/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34 g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHY OznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4 UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK7 7NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM= -----END RSA PRIVATE KEY----- 命令 rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem 是用于生成RSA公钥，执行后在程序目录中生成一个文件rsa_public_key.pem，其内容如下 -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyffRONGd8Q/1kRh1cpsSRi360 DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRb12345 LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrl123 zus0WcJiJOxW02rxSQIDAQAB -----END PUBLIC KEY----- 生成的这个RSA公钥，需要填写到应用中去，填写地址如下所示。私钥不需要填到配置中，到时候配置到代码中。 &nbsp;特别注意，密钥要去掉注释部分，且转换成一行字符，否则回车换行也成为密钥的一部分，将导致无法正常加解密。 &nbsp;同时，可以点击 “查看支付宝公钥”，将支付宝的公钥复制保存下来，后面的程序中将需要用到。 &nbsp; 四、密钥生成API与密钥配置 公共参数 请求地址： 环境 HTTPS请求地址 正式环境 https://openapi.alipay.com/gateway.do 公共请求参数： 参数 类型 是否必填 最大长度 描述 app_id String 是 32 支付宝分配给开发者的应用ID method String 是 128 接口名称 format String 否 40 仅支持JSON charset String 是 10 请求使用的编码格式，如utf-8,gbk,gb2312等 sign_type String 是 10 商户生成签名字符串所使用的签名算法类型，目前支持RSA sign String 是 256 商户请求参数的签名串，详见签名 timestamp String 是 19 发送请求的时间，格式&quot;yyyy-MM-dd HH:mm:ss&quot; version String 是 3 调用的接口版本，固定为：1.0 notify_url String 否 256 支付宝服务器主动通知商户服务器里指定的页面http/https路径。 app_auth_token String 否 40 详见应用授权概述 biz_content String 是 - 请求参数的集合，最大长度不限，除公共参数外所有请求参数都必须放在这个参数中传递，具体参照各产品快速接入文档 请求参数 参数 类型 是否必填 最大长度 描述 out_trade_no String 必须 64 商户订单号,64个字符以内、可包含字母、数字、下划线；需保证在商户端不重复 scene String 必须 32 支付场景 条码支付，取值：bar_code 声波支付，取值：wave_code auth_code String 必须 32 支付授权码 seller_id String 可选 28 如果该值为空，则默认为商户签约账号对应的支付宝用户ID total_amount Price 可选 11 订单总金额，单位为元， discountable_amount Price 可选 11 参与优惠计算的金额，单位为元 undiscountable_amount Price 可选 11 不参与优惠计算的金额，单位为元 subject String 必须 256 订单标题 body String 可选 128 订单描述 goods_detail GoodsDetail [] 可选 - 订单包含的商品列表信息，Json格式，其它说明详见商品明细说明 operator_id String 可选 28 商户操作员编号 store_id String 可选 32 商户门店编号 terminal_id String 可选 32 商户机具终端编号 alipay_store_id String 可选 32 支付宝的店铺编号 extend_params ExtendParams 可选 - 业务扩展参数 timeout_express String 可选 6 该笔订单允许的最晚付款时间，逾期将关闭交易。 royalty_info RoyaltyInfo 可选 - 描述分账信息，Json格式，其它说明详见分账说明 sub_merchant SubMerchant 可选 - 二级商户信息,当前只对特殊银行机构特定场景下使用此字段 公共响应参数 参数 类型 是否必填 最大长度 描述 code String 是 - 网关返回码,详见文档 msg String 是 - 网关返回码描述,详见文档 sub_code String 否 - 业务返回码,详见文档 sub_msg String 否 - 业务返回码描述,详见文档 sign String 是 - 签名,详见文档 响应参数 参数 类型 是否必填 最大长度 描述 trade_no String 必填 64 支付宝交易号 out_trade_no String 必填 64 商户订单号 buyer_logon_id String 必填 100 买家支付宝账号 total_amount Price 必填 11 交易金额 receipt_amount String 必填 11 实收金额 buyer_pay_amount Price 选填 11 买家付款的金额 point_amount Price 选填 11 使用积分宝付款的金额 invoice_amount Price 选填 11 交易中可给用户开具发票的金额 gmt_payment Date 必填 32 交易支付时间 fund_bill_list TradeFundBill [] 必填 - 交易支付使用的资金渠道 card_balance Price 选填 11 支付宝卡余额 store_name String 选填 512 发生支付交易的商户门店名称 buyer_user_id String 必填 28 买家在支付宝的用户id discount_goods_detail String 必填 - 本次交易支付所使用的单品券优惠的商品优惠信息 &nbsp; 系统中配置如下 &lt;?php $config = array ( //支付宝公钥 &#39;alipay_public_key&#39; =&gt; &quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOasdfiUeJHkrIvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632qJBVHf8sxHi/fEsraprwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUrCmZYI/FCEa3/cNMW0QIDA123&quot;, //商户私钥 &#39;merchant_private_key&#39; =&gt; &quot;MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiasdfW02rxSQIDAQABAoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVNJgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCzcEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQqVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/HnGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3raqT/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHYOznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK77NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM=&quot;, //编码格式 &#39;charset&#39; =&gt; &quot;UTF-8&quot;, //支付宝网关 &#39;gatewayUrl&#39; =&gt; &quot;https://openapi.alipay.com/gateway.do&quot;, //应用ID &#39;app_id&#39; =&gt; &quot;2016061501500000&quot;, //异步通知地址,只有扫码支付预下单可用 &#39;notify_url&#39; =&gt; &quot;http://www.fangbei.org/alipay/notify.html&quot;, //最大查询重试次数 &#39;MaxQueryRetry&#39; =&gt; &quot;10&quot;, //查询间隔 &#39;QueryDuration&#39; =&gt; &quot;3&quot; ); 其中支付宝公钥就是在前面中复制保存的，直接复制到程序中即可，而商户私钥是之前OpenSSL中生成的私钥。APPID是该服务的id号。 而这个异步通知将会接收扫码支付结果的通知。 &nbsp; &nbsp; 五、条码支付、扫码支付、订单查询、退款申请 1. 条码支付 条码支付的参数配置如下 // (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线， // 需保证商户系统端不能重复，建议通过数据库sequence生成， $outTradeNo = &quot;barpay&quot; . date(&#39;Ymdhis&#39;) . mt_rand(100, 1000); $subject = &quot;方倍工作室-支付宝-当面付-扫码支付&quot;; $totalAmount = 1.21; // (必填) 订单总金额，单位为元，不能超过1亿元 // (必填) 付款条码，用户支付宝钱包手机app点击“付款”产生的付款条码 $authCode = $_POST[&#39;auth_code&#39;]; //28开头18位数字 // 支付超时，线下扫码交易定义为5分钟 $timeExpress = &quot;5m&quot;; // 创建请求builder，设置请求参数 $barPayRequestBuilder = new AlipayTradePayContentBuilder(); $barPayRequestBuilder-&gt;setOutTradeNo($outTradeNo); $barPayRequestBuilder-&gt;setTotalAmount($totalAmount); $barPayRequestBuilder-&gt;setAuthCode($authCode); $barPayRequestBuilder-&gt;setTimeExpress($timeExpress); $barPayRequestBuilder-&gt;setSubject($subject); // 调用barPay方法获取当面付应答 $barPay = new AlipayTradeService($config); $barPayResult = $barPay-&gt;barPay($barPayRequestBuilder); switch ($barPayResult-&gt;getTradeStatus()) { case &quot;SUCCESS&quot;: echo &quot;支付宝支付成功:&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($barPayResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝支付失败!!!&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if (!empty($barPayResult-&gt;getResponse())) { print_r($barPayResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if (!empty($barPayResult-&gt;getResponse())) { print_r($barPayResult-&gt;getResponse()); } break; default: echo &quot;不支持的交易状态，交易返回异常!!!&quot;; break; } return; } 程序监测，最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016123150150asdf&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.pay&amp;timestamp=2016-08-26+17%3A14%3A52&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=EMVoBAhPkW6B1m%2BoXytdbUpIxnIAq73asdfasdfasdfYy4OcJQ2UiVTXWttw0y%2B7UEXHWILY8fYRDoNrJWSjBATrAqbGCLpPc4YBQSwtPCb%2F76d65dMQEyrEnk2sgcqhxCiJNKRoQjgAQmBQdHneerU7SwSNJ%2FfF%2F025yltZk5lzQ%3D 发送的json数据如下： { &quot;scene&quot;:&quot;bar_code&quot;, &quot;out_trade_no&quot;:&quot;barpay20160826051452680&quot;, &quot;total_amount&quot;:0.01, &quot;auth_code&quot;:&quot;123743098312323535&quot;, &quot;timeout_express&quot;:&quot;5m&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot; } 接收到的数据如下 { &quot;alipay_trade_pay_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot;, &quot;buyer_pay_amount&quot;:&quot;1.21&quot;, &quot;buyer_user_id&quot;:&quot;2088002312008751&quot;, &quot;fund_bill_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;gmt_payment&quot;:&quot;2016-08-26 17:14:59&quot;, &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;barpay20160826051452680&quot;, &quot;point_amount&quot;:&quot;0.00&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750244100034&quot; }, &quot;sign&quot;:&quot;pEDeMwh6x73t9LmWrZpGnVb1npnKtasdf6+8MDUTurNPVWXR1JHT+x3cRt2G4SDNHzxkJTzSpUXjNylsWisRTnQJJzqRP5XMujxmaAHP/d5xXeyWasDag5Cj7yGD7t80buDAsdE4eoqQ6ox7KzJ6LwKcphOX13tI+Ukt1dGCQS5o=&quot; } &nbsp; 2. 扫码支付 扫码支付的参数配置如下 // (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线， // 需保证商户系统端不能重复，建议通过数据库sequence生成， $outTradeNo = &quot;qrpay&quot;.date(&#39;Ymdhis&#39;).mt_rand(100,1000); $subject = &quot;方倍工作室-支付宝-当面付-扫码支付&quot;; $totalAmount = &quot;1.01&quot;; // 支付超时，线下扫码交易定义为5分钟 $timeExpress = &quot;5m&quot;; // 创建请求builder，设置请求参数 $qrPayRequestBuilder = new AlipayTradePrecreateContentBuilder(); $qrPayRequestBuilder-&gt;setOutTradeNo($outTradeNo); $qrPayRequestBuilder-&gt;setTotalAmount($totalAmount); $qrPayRequestBuilder-&gt;setTimeExpress($timeExpress); $qrPayRequestBuilder-&gt;setSubject($subject); // 调用qrPay方法获取当面付应答 $qrPay = new AlipayTradeService($config); $qrPayResult = $qrPay-&gt;qrPay($qrPayRequestBuilder); // 根据状态值进行业务处理 switch ($qrPayResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝创建订单二维码成功:&quot;.&quot;&lt;br&gt;---------------------------------------&lt;br&gt;&quot;; $response = $qrPayResult-&gt;getResponse(); $qrcode = $qrPay-&gt;create_erweima($response-&gt;qr_code); echo $qrcode; print_r($response); break; case &quot;FAILED&quot;: echo &quot;支付宝创建订单二维码失败!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($qrPayResult-&gt;getResponse())){ print_r($qrPayResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($qrPayResult-&gt;getResponse())){ print_r($qrPayResult-&gt;getResponse()); } break; default: echo &quot;不支持的返回状态，创建订单二维码返回异常!!!&quot;; break; } 生成的提交请求URL如下 https://openapi.alipay.com/gateway.do?app_id=2016061501501234&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.precreate&amp;timestamp=2016-08-26+17%3A38%3A13&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=http%3A%2F%2F123.daoqidata.com%2Fweixin%2Frawpost.php&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=ayYiJRZ63RomVEt8Ayz58Uiyv3y5IrbbXasdf16zNHkT%2Fu11U7ISUYWCXjrwrwCo2Oq2tdo%2FjtuhrBbDp5ULnTmuBBUktQDCCF53PF5yiUDGikxUPFYugeUrTg3gw4DqxOiNKM6ZB6MI0n%2F9M78a%2FnasdftZ4WthyHIl%2B%2FozSyT4%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;total_amount&quot;:&quot;1.01&quot;, &quot;timeout_express&quot;:&quot;5m&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot; } 返回的数据如下： { &quot;alipay_trade_precreate_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;qr_code&quot;:&quot;https://qr.alipay.com/bax00885xbhszseo9l7p404d&quot; }, &quot;sign&quot;:&quot;VfNTGo2WMZ+2CE1L05lNYWtFn4inHXO/tUaBZIBHN4fPlXnCvyc9IhS8S7wa3FYw23G30luEPEHkZWobnfpUjILonmExZVElHv3ylINz+Q2mQ5M8Sb/d61YPvf4Bgy1OvlrT4D3H/i3judmzEDBrOyFN9kB9vSkKaYC+b6L41Zw=&quot; } 其中的https://qr.alipay.com/bax00885xbhszseo9l7p404d 就是二维码链接地址，使用接口将其成二维码后如下所示。 当支付宝用户扫码的时候，接口通知将收到如下数据 { &quot;notify_id&quot;:&quot;4c2c04c3cc50e978d44212febe7c3f0lse&quot;, &quot;seller_email&quot;:&quot;pay***@fangbei.org&quot;, &quot;notify_type&quot;:&quot;trade_status_sync&quot;, &quot;sign&quot;:&quot;R0iRdYmSQ0+zuSUGLzkutHasdfhoOp+CcKojVBCMa1uji3rqQFe5XeHoJB1nMBCApE3zXPKhXMdLis109ngPbGy+NUEBR7YZjYuR/hXq3WXeYfZ8aiWLvloZHrF7dQWxDho/VHYexaLeqvRi/03m0HxrwhZKUOu1eS9wMgZOlqQ=&quot;, &quot;trade_no&quot;:&quot;2016082621001004750241229810&quot;, &quot;buyer_id&quot;:&quot;2088002364008751&quot;, &quot;app_id&quot;:&quot;2016061501500000&quot;, &quot;gmt_create&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826062009757&quot;, &quot;seller_id&quot;:&quot;2088421202724253&quot;, &quot;notify_time&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot;, &quot;trade_status&quot;:&quot;WAIT_BUYER_PAY&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;sign_type&quot;:&quot;RSA&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot; } 当用户输入密码付款成功之后，将收到如下数据 { &quot;fund_bill_list&quot;:&quot;[{&quot;amount&quot;:&quot;0.01&quot;,&quot;fundChannel&quot;:&quot;ALIPAYACCOUNT&quot;}]&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot;, &quot;trade_no&quot;:&quot;2016082621001004750241229810&quot;, &quot;gmt_create&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;notify_type&quot;:&quot;trade_status_sync&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826062009757&quot;, &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;seller_id&quot;:&quot;2088421202724253&quot;, &quot;notify_time&quot;:&quot;2016-08-26 18:20:50&quot;, &quot;trade_status&quot;:&quot;TRADE_SUCCESS&quot;, &quot;gmt_payment&quot;:&quot;2016-08-26 18:20:50&quot;, &quot;seller_email&quot;:&quot;pay***@fangbei.org&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;buyer_id&quot;:&quot;2088002364008751&quot;, &quot;app_id&quot;:&quot;2016061501500000&quot;, &quot;notify_id&quot;:&quot;56f97611ee609f46384b188b409e75else&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot;, &quot;sign_type&quot;:&quot;RSA&quot;, &quot;buyer_pay_amount&quot;:&quot;0.01&quot;, &quot;sign&quot;:&quot;nf/KJryACk0utqlNrnuYMiSnYw6HsxqpJPk2O5MhCZ+wZUVQbrD3sq5POO3GU7LSRoSiUUIO4JEYEL12Ek2+w3lTcLS9WEi60sYowPOcJEYGmVfNZbVR6+k7yO5au2WIkM3MKsxm2XxIB9xPMmRDACGhvqZ2BXUAQujkPk1FT0s=&quot;, &quot;point_amount&quot;:&quot;0.00&quot; } &nbsp; 3. 订单查询 订单查询的参数配置如下 ////获取商户订单号 $out_trade_no = trim($_POST[&#39;out_trade_no&#39;]); //第三方应用授权令牌,商户授权系统商开发模式下使用 $appAuthToken = &quot;&quot;;//根据真实值填写 //构造查询业务请求参数对象 $queryContentBuilder = new AlipayTradeQueryContentBuilder(); $queryContentBuilder-&gt;setOutTradeNo($out_trade_no); $queryContentBuilder-&gt;setAppAuthToken($appAuthToken); //初始化类对象，调用queryTradeResult方法获取查询应答 $queryResponse = new AlipayTradeService($config); $queryResult = $queryResponse-&gt;queryTradeResult($queryContentBuilder); //根据查询返回结果状态进行业务处理 switch ($queryResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝查询交易成功:&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($queryResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝查询交易失败或者交易已关闭!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($queryResult-&gt;getResponse())){ print_r($queryResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($queryResult-&gt;getResponse())){ print_r($queryResult-&gt;getResponse()); } break; default: echo &quot;不支持的查询状态，交易返回异常!!!&quot;; break; } 最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.query&amp;timestamp=2016-08-26+18%3A27%3A07&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=eIuYJtes95asdf3X9eXbQzBa%2FCvm5QgQ0ToUsS8MSkCjhZACYpnU7ZT5MuD31lPZPFHVEjCKsdWiq4tuNtJPFPxirg7pkTiT09C%2Bz8PsUA844Y7hjkkX%2B4CVZcGtO11m3Ap0JECrtZW8hhJTE9bPY1v43X2BSL5Cp3Ulpac1FsM%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot; } 接收到的数据如下 { &quot;alipay_trade_query_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;132***@qq.com&quot;, &quot;buyer_pay_amount&quot;:&quot;1.01&quot;, &quot;buyer_user_id&quot;:&quot;2088002364008751&quot;, &quot;fund_bill_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;point_amount&quot;:&quot;0.00&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;send_pay_date&quot;:&quot;2016-08-26 17:38:58&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750239053830&quot;, &quot;trade_status&quot;:&quot;TRADE_SUCCESS&quot; }, &quot;sign&quot;:&quot;E2MxjdAhW/EqRFNkZgy/Y//dA5Cmb54Hnqa0cjBz+ZcFTULi1lvFms93onP7cpVK/fI7YxbkZTKBPk29o4aeWKXlSYCrT92domAyqahzYCA7/5A3Msc/awALYrFOdWyJJdlncWdFRN9hx52iVRIjxvLJ0hIMVIQqEDavG28HPbo=&quot; } &nbsp; 4. 订单退款 订单退款的参数配置如下 $out_trade_no = trim($_POST[&#39;out_trade_no&#39;]); $refund_amount = trim($_POST[&#39;refund_amount&#39;]); $out_request_no = trim($_POST[&#39;out_request_no&#39;]); //第三方应用授权令牌,商户授权系统商开发模式下使用 $appAuthToken = &quot;&quot;;//根据真实值填写 //创建退款请求builder,设置参数 $refundRequestBuilder = new AlipayTradeRefundContentBuilder(); $refundRequestBuilder-&gt;setOutTradeNo($out_trade_no); $refundRequestBuilder-&gt;setRefundAmount($refund_amount); $refundRequestBuilder-&gt;setOutRequestNo($out_request_no); $refundRequestBuilder-&gt;setAppAuthToken($appAuthToken); //初始化类对象,调用refund获取退款应答 $refundResponse = new AlipayTradeService($config); $refundResult = $refundResponse-&gt;refund($refundRequestBuilder); //根据交易状态进行处理 switch ($refundResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝退款成功:&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($refundResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝退款失败!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($refundResult-&gt;getResponse())){ print_r($refundResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($refundResult-&gt;getResponse())){ print_r($refundResult-&gt;getResponse()); } break; default: echo &quot;不支持的交易状态，交易返回异常!!!&quot;; break; } 最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.refund&amp;timestamp=2016-08-26+18%3A47%3A35&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=Y1c5qWglAQ0tasdfiEtqFnIJRQMn%2Fl9vMla1xgXKcExercJopMyS2rPOHaw%2F2PJEOKJC7r9qAfDGkNq4LHzXhBrD8sxLPqImPS6aWcW9p8s%2FzC2oQCJnLfaPx6lh8veHarj4WzDayeZLA48ttoQLjuMGPrITgOXYjHHyUKdBqSs%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;refund_amount&quot;:&quot;0.01&quot;, &quot;out_request_no&quot;:&quot;1&quot; } 接收到的数据如下 { &quot;alipay_trade_refund_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;123***@qq.com&quot;, &quot;buyer_user_id&quot;:&quot;2088002364008751&quot;, &quot;fund_change&quot;:&quot;Y&quot;, &quot;gmt_refund_pay&quot;:&quot;2016-08-26 18:47:41&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;refund_detail_item_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;refund_fee&quot;:&quot;0.01&quot;, &quot;send_back_fee&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750239053830&quot; }, &quot;sign&quot;:&quot;YDNSMpX5y0rQEs0ZbfNxRFVIp8hf0W30OR74cMtwKVPO2BYee6TQC+pbnwESSZ2XSGLozTyy7o+SIa07L+FMhDv/PTt6QX1mVgQv7RhzoDkls0zDRS/5/fy9Oyj01XS1wb8Od/93iNLZDkd2yw9g0He6qGYlpcXutkmwuASd7BM=&quot; } &nbsp; &nbsp;&nbsp; 阅读更多" />
<meta property="og:description" content="版权声明：本文为方倍工作室原创文章，未经授权不得转载。 https://blog.csdn.net/txw1958/article/details/52330990 关键字：支付宝 当面付 条码支付 扫码支付 二维码支付 订单查询 退款 作者：方倍工作室 本文介绍支付宝中当面付下属的条码支付、扫码支付、订单查询、退款申请的集成开发过程。 &nbsp; 本文分为以下五个部分： 条码支付和扫码支付介绍 申请应用 密钥生成及配置 API及SDK集成 条码支付、扫码支付、订单查询、退款申请 &nbsp; 一、条码支付及二维码支付介绍 1. 条码支付 条码支付是支付宝给到线下传统行业的一种收款方式。商家使用扫码枪等条码识别设备扫描用户支付宝钱包上的条码/二维码，完成收款。用户仅需出示付款码，所有收款操作由商家端完成。其使用场景如下： 业务流程： 使用步骤： 用户登陆支付宝钱包，点击首页“付款”，进入付款码界面； 收银员在商家收银系统操作生成订单，用户确认支付金额； 用户出示钱包的“付款码”，收银员用扫码设备来扫描用户手机上的条码/二维码后，商家收银系统提交支付； 付款成功后商家收银系统会拿到支付成功或者失败的结果。 2. 扫码支付 扫码支付，指用户打开支付宝钱包中的“扫一扫”功能，扫描商家展示在某收银场景下的二维码并进行支付的模式。该模式适用于线下实体店支付、面对面支付等场景。 其使用场景如下： 业务流程： 使用步骤： 用户登陆支付宝钱包，点击首页“付款-扫码付”，进入扫一扫界面； 收银员在商家收银系统操作生成支付宝订单，用户确认支付金额，并生成二维码； 用户使用钱包的“扫码付”，扫收银员提供的二维码，确认支付； 用户付款后商家收银系统会拿到支付成功或者失败的结果。 &nbsp; 二、接口申请 企业在申请企业支付宝之后，进行功能申请并签约，然后在蚂蚁金服开放平台中申请应用如下（详细过程就略了） 然后在功能列表中，申请当面付这一功能，申请成功后如下。 这样，我们就有了当面付的权限了。 &nbsp; &nbsp; 三、密钥生成 在支付宝当面付的接口中，使用了非对称加密算法，商户自己的公钥和私钥需要自己使用OpenSSL手动生成。对这些概念比较陌生的话，请先自行先了解一下密码学的相关知识。OpenSSL也可以从方倍工作室博客中找到。 下载支付宝官方提供的密钥生成工具OpenSSL，然后执行以下命令就可以生成公钥和私钥。 其中 genrsa -out rsa_private_key.pem 1024 是用于生成RSA私钥，执行后在程序目录中生成一个文件rsa_private_key.pem，其内容如下 -----BEGIN RSA PRIVATE KEY----- MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b 3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTITasd hHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiJOxW02rxSQIDAQAB AoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVN JgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCz cEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQ qVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/H nGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3123 T/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34 g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHY OznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4 UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK7 7NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM= -----END RSA PRIVATE KEY----- 命令 rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem 是用于生成RSA公钥，执行后在程序目录中生成一个文件rsa_public_key.pem，其内容如下 -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyffRONGd8Q/1kRh1cpsSRi360 DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRb12345 LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrl123 zus0WcJiJOxW02rxSQIDAQAB -----END PUBLIC KEY----- 生成的这个RSA公钥，需要填写到应用中去，填写地址如下所示。私钥不需要填到配置中，到时候配置到代码中。 &nbsp;特别注意，密钥要去掉注释部分，且转换成一行字符，否则回车换行也成为密钥的一部分，将导致无法正常加解密。 &nbsp;同时，可以点击 “查看支付宝公钥”，将支付宝的公钥复制保存下来，后面的程序中将需要用到。 &nbsp; 四、密钥生成API与密钥配置 公共参数 请求地址： 环境 HTTPS请求地址 正式环境 https://openapi.alipay.com/gateway.do 公共请求参数： 参数 类型 是否必填 最大长度 描述 app_id String 是 32 支付宝分配给开发者的应用ID method String 是 128 接口名称 format String 否 40 仅支持JSON charset String 是 10 请求使用的编码格式，如utf-8,gbk,gb2312等 sign_type String 是 10 商户生成签名字符串所使用的签名算法类型，目前支持RSA sign String 是 256 商户请求参数的签名串，详见签名 timestamp String 是 19 发送请求的时间，格式&quot;yyyy-MM-dd HH:mm:ss&quot; version String 是 3 调用的接口版本，固定为：1.0 notify_url String 否 256 支付宝服务器主动通知商户服务器里指定的页面http/https路径。 app_auth_token String 否 40 详见应用授权概述 biz_content String 是 - 请求参数的集合，最大长度不限，除公共参数外所有请求参数都必须放在这个参数中传递，具体参照各产品快速接入文档 请求参数 参数 类型 是否必填 最大长度 描述 out_trade_no String 必须 64 商户订单号,64个字符以内、可包含字母、数字、下划线；需保证在商户端不重复 scene String 必须 32 支付场景 条码支付，取值：bar_code 声波支付，取值：wave_code auth_code String 必须 32 支付授权码 seller_id String 可选 28 如果该值为空，则默认为商户签约账号对应的支付宝用户ID total_amount Price 可选 11 订单总金额，单位为元， discountable_amount Price 可选 11 参与优惠计算的金额，单位为元 undiscountable_amount Price 可选 11 不参与优惠计算的金额，单位为元 subject String 必须 256 订单标题 body String 可选 128 订单描述 goods_detail GoodsDetail [] 可选 - 订单包含的商品列表信息，Json格式，其它说明详见商品明细说明 operator_id String 可选 28 商户操作员编号 store_id String 可选 32 商户门店编号 terminal_id String 可选 32 商户机具终端编号 alipay_store_id String 可选 32 支付宝的店铺编号 extend_params ExtendParams 可选 - 业务扩展参数 timeout_express String 可选 6 该笔订单允许的最晚付款时间，逾期将关闭交易。 royalty_info RoyaltyInfo 可选 - 描述分账信息，Json格式，其它说明详见分账说明 sub_merchant SubMerchant 可选 - 二级商户信息,当前只对特殊银行机构特定场景下使用此字段 公共响应参数 参数 类型 是否必填 最大长度 描述 code String 是 - 网关返回码,详见文档 msg String 是 - 网关返回码描述,详见文档 sub_code String 否 - 业务返回码,详见文档 sub_msg String 否 - 业务返回码描述,详见文档 sign String 是 - 签名,详见文档 响应参数 参数 类型 是否必填 最大长度 描述 trade_no String 必填 64 支付宝交易号 out_trade_no String 必填 64 商户订单号 buyer_logon_id String 必填 100 买家支付宝账号 total_amount Price 必填 11 交易金额 receipt_amount String 必填 11 实收金额 buyer_pay_amount Price 选填 11 买家付款的金额 point_amount Price 选填 11 使用积分宝付款的金额 invoice_amount Price 选填 11 交易中可给用户开具发票的金额 gmt_payment Date 必填 32 交易支付时间 fund_bill_list TradeFundBill [] 必填 - 交易支付使用的资金渠道 card_balance Price 选填 11 支付宝卡余额 store_name String 选填 512 发生支付交易的商户门店名称 buyer_user_id String 必填 28 买家在支付宝的用户id discount_goods_detail String 必填 - 本次交易支付所使用的单品券优惠的商品优惠信息 &nbsp; 系统中配置如下 &lt;?php $config = array ( //支付宝公钥 &#39;alipay_public_key&#39; =&gt; &quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOasdfiUeJHkrIvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632qJBVHf8sxHi/fEsraprwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUrCmZYI/FCEa3/cNMW0QIDA123&quot;, //商户私钥 &#39;merchant_private_key&#39; =&gt; &quot;MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiasdfW02rxSQIDAQABAoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVNJgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCzcEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQqVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/HnGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3raqT/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHYOznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK77NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM=&quot;, //编码格式 &#39;charset&#39; =&gt; &quot;UTF-8&quot;, //支付宝网关 &#39;gatewayUrl&#39; =&gt; &quot;https://openapi.alipay.com/gateway.do&quot;, //应用ID &#39;app_id&#39; =&gt; &quot;2016061501500000&quot;, //异步通知地址,只有扫码支付预下单可用 &#39;notify_url&#39; =&gt; &quot;http://www.fangbei.org/alipay/notify.html&quot;, //最大查询重试次数 &#39;MaxQueryRetry&#39; =&gt; &quot;10&quot;, //查询间隔 &#39;QueryDuration&#39; =&gt; &quot;3&quot; ); 其中支付宝公钥就是在前面中复制保存的，直接复制到程序中即可，而商户私钥是之前OpenSSL中生成的私钥。APPID是该服务的id号。 而这个异步通知将会接收扫码支付结果的通知。 &nbsp; &nbsp; 五、条码支付、扫码支付、订单查询、退款申请 1. 条码支付 条码支付的参数配置如下 // (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线， // 需保证商户系统端不能重复，建议通过数据库sequence生成， $outTradeNo = &quot;barpay&quot; . date(&#39;Ymdhis&#39;) . mt_rand(100, 1000); $subject = &quot;方倍工作室-支付宝-当面付-扫码支付&quot;; $totalAmount = 1.21; // (必填) 订单总金额，单位为元，不能超过1亿元 // (必填) 付款条码，用户支付宝钱包手机app点击“付款”产生的付款条码 $authCode = $_POST[&#39;auth_code&#39;]; //28开头18位数字 // 支付超时，线下扫码交易定义为5分钟 $timeExpress = &quot;5m&quot;; // 创建请求builder，设置请求参数 $barPayRequestBuilder = new AlipayTradePayContentBuilder(); $barPayRequestBuilder-&gt;setOutTradeNo($outTradeNo); $barPayRequestBuilder-&gt;setTotalAmount($totalAmount); $barPayRequestBuilder-&gt;setAuthCode($authCode); $barPayRequestBuilder-&gt;setTimeExpress($timeExpress); $barPayRequestBuilder-&gt;setSubject($subject); // 调用barPay方法获取当面付应答 $barPay = new AlipayTradeService($config); $barPayResult = $barPay-&gt;barPay($barPayRequestBuilder); switch ($barPayResult-&gt;getTradeStatus()) { case &quot;SUCCESS&quot;: echo &quot;支付宝支付成功:&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($barPayResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝支付失败!!!&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if (!empty($barPayResult-&gt;getResponse())) { print_r($barPayResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if (!empty($barPayResult-&gt;getResponse())) { print_r($barPayResult-&gt;getResponse()); } break; default: echo &quot;不支持的交易状态，交易返回异常!!!&quot;; break; } return; } 程序监测，最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016123150150asdf&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.pay&amp;timestamp=2016-08-26+17%3A14%3A52&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=EMVoBAhPkW6B1m%2BoXytdbUpIxnIAq73asdfasdfasdfYy4OcJQ2UiVTXWttw0y%2B7UEXHWILY8fYRDoNrJWSjBATrAqbGCLpPc4YBQSwtPCb%2F76d65dMQEyrEnk2sgcqhxCiJNKRoQjgAQmBQdHneerU7SwSNJ%2FfF%2F025yltZk5lzQ%3D 发送的json数据如下： { &quot;scene&quot;:&quot;bar_code&quot;, &quot;out_trade_no&quot;:&quot;barpay20160826051452680&quot;, &quot;total_amount&quot;:0.01, &quot;auth_code&quot;:&quot;123743098312323535&quot;, &quot;timeout_express&quot;:&quot;5m&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot; } 接收到的数据如下 { &quot;alipay_trade_pay_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot;, &quot;buyer_pay_amount&quot;:&quot;1.21&quot;, &quot;buyer_user_id&quot;:&quot;2088002312008751&quot;, &quot;fund_bill_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;gmt_payment&quot;:&quot;2016-08-26 17:14:59&quot;, &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;barpay20160826051452680&quot;, &quot;point_amount&quot;:&quot;0.00&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750244100034&quot; }, &quot;sign&quot;:&quot;pEDeMwh6x73t9LmWrZpGnVb1npnKtasdf6+8MDUTurNPVWXR1JHT+x3cRt2G4SDNHzxkJTzSpUXjNylsWisRTnQJJzqRP5XMujxmaAHP/d5xXeyWasDag5Cj7yGD7t80buDAsdE4eoqQ6ox7KzJ6LwKcphOX13tI+Ukt1dGCQS5o=&quot; } &nbsp; 2. 扫码支付 扫码支付的参数配置如下 // (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线， // 需保证商户系统端不能重复，建议通过数据库sequence生成， $outTradeNo = &quot;qrpay&quot;.date(&#39;Ymdhis&#39;).mt_rand(100,1000); $subject = &quot;方倍工作室-支付宝-当面付-扫码支付&quot;; $totalAmount = &quot;1.01&quot;; // 支付超时，线下扫码交易定义为5分钟 $timeExpress = &quot;5m&quot;; // 创建请求builder，设置请求参数 $qrPayRequestBuilder = new AlipayTradePrecreateContentBuilder(); $qrPayRequestBuilder-&gt;setOutTradeNo($outTradeNo); $qrPayRequestBuilder-&gt;setTotalAmount($totalAmount); $qrPayRequestBuilder-&gt;setTimeExpress($timeExpress); $qrPayRequestBuilder-&gt;setSubject($subject); // 调用qrPay方法获取当面付应答 $qrPay = new AlipayTradeService($config); $qrPayResult = $qrPay-&gt;qrPay($qrPayRequestBuilder); // 根据状态值进行业务处理 switch ($qrPayResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝创建订单二维码成功:&quot;.&quot;&lt;br&gt;---------------------------------------&lt;br&gt;&quot;; $response = $qrPayResult-&gt;getResponse(); $qrcode = $qrPay-&gt;create_erweima($response-&gt;qr_code); echo $qrcode; print_r($response); break; case &quot;FAILED&quot;: echo &quot;支付宝创建订单二维码失败!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($qrPayResult-&gt;getResponse())){ print_r($qrPayResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($qrPayResult-&gt;getResponse())){ print_r($qrPayResult-&gt;getResponse()); } break; default: echo &quot;不支持的返回状态，创建订单二维码返回异常!!!&quot;; break; } 生成的提交请求URL如下 https://openapi.alipay.com/gateway.do?app_id=2016061501501234&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.precreate&amp;timestamp=2016-08-26+17%3A38%3A13&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=http%3A%2F%2F123.daoqidata.com%2Fweixin%2Frawpost.php&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=ayYiJRZ63RomVEt8Ayz58Uiyv3y5IrbbXasdf16zNHkT%2Fu11U7ISUYWCXjrwrwCo2Oq2tdo%2FjtuhrBbDp5ULnTmuBBUktQDCCF53PF5yiUDGikxUPFYugeUrTg3gw4DqxOiNKM6ZB6MI0n%2F9M78a%2FnasdftZ4WthyHIl%2B%2FozSyT4%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;total_amount&quot;:&quot;1.01&quot;, &quot;timeout_express&quot;:&quot;5m&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot; } 返回的数据如下： { &quot;alipay_trade_precreate_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;qr_code&quot;:&quot;https://qr.alipay.com/bax00885xbhszseo9l7p404d&quot; }, &quot;sign&quot;:&quot;VfNTGo2WMZ+2CE1L05lNYWtFn4inHXO/tUaBZIBHN4fPlXnCvyc9IhS8S7wa3FYw23G30luEPEHkZWobnfpUjILonmExZVElHv3ylINz+Q2mQ5M8Sb/d61YPvf4Bgy1OvlrT4D3H/i3judmzEDBrOyFN9kB9vSkKaYC+b6L41Zw=&quot; } 其中的https://qr.alipay.com/bax00885xbhszseo9l7p404d 就是二维码链接地址，使用接口将其成二维码后如下所示。 当支付宝用户扫码的时候，接口通知将收到如下数据 { &quot;notify_id&quot;:&quot;4c2c04c3cc50e978d44212febe7c3f0lse&quot;, &quot;seller_email&quot;:&quot;pay***@fangbei.org&quot;, &quot;notify_type&quot;:&quot;trade_status_sync&quot;, &quot;sign&quot;:&quot;R0iRdYmSQ0+zuSUGLzkutHasdfhoOp+CcKojVBCMa1uji3rqQFe5XeHoJB1nMBCApE3zXPKhXMdLis109ngPbGy+NUEBR7YZjYuR/hXq3WXeYfZ8aiWLvloZHrF7dQWxDho/VHYexaLeqvRi/03m0HxrwhZKUOu1eS9wMgZOlqQ=&quot;, &quot;trade_no&quot;:&quot;2016082621001004750241229810&quot;, &quot;buyer_id&quot;:&quot;2088002364008751&quot;, &quot;app_id&quot;:&quot;2016061501500000&quot;, &quot;gmt_create&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826062009757&quot;, &quot;seller_id&quot;:&quot;2088421202724253&quot;, &quot;notify_time&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot;, &quot;trade_status&quot;:&quot;WAIT_BUYER_PAY&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;sign_type&quot;:&quot;RSA&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot; } 当用户输入密码付款成功之后，将收到如下数据 { &quot;fund_bill_list&quot;:&quot;[{&quot;amount&quot;:&quot;0.01&quot;,&quot;fundChannel&quot;:&quot;ALIPAYACCOUNT&quot;}]&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot;, &quot;trade_no&quot;:&quot;2016082621001004750241229810&quot;, &quot;gmt_create&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;notify_type&quot;:&quot;trade_status_sync&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826062009757&quot;, &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;seller_id&quot;:&quot;2088421202724253&quot;, &quot;notify_time&quot;:&quot;2016-08-26 18:20:50&quot;, &quot;trade_status&quot;:&quot;TRADE_SUCCESS&quot;, &quot;gmt_payment&quot;:&quot;2016-08-26 18:20:50&quot;, &quot;seller_email&quot;:&quot;pay***@fangbei.org&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;buyer_id&quot;:&quot;2088002364008751&quot;, &quot;app_id&quot;:&quot;2016061501500000&quot;, &quot;notify_id&quot;:&quot;56f97611ee609f46384b188b409e75else&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot;, &quot;sign_type&quot;:&quot;RSA&quot;, &quot;buyer_pay_amount&quot;:&quot;0.01&quot;, &quot;sign&quot;:&quot;nf/KJryACk0utqlNrnuYMiSnYw6HsxqpJPk2O5MhCZ+wZUVQbrD3sq5POO3GU7LSRoSiUUIO4JEYEL12Ek2+w3lTcLS9WEi60sYowPOcJEYGmVfNZbVR6+k7yO5au2WIkM3MKsxm2XxIB9xPMmRDACGhvqZ2BXUAQujkPk1FT0s=&quot;, &quot;point_amount&quot;:&quot;0.00&quot; } &nbsp; 3. 订单查询 订单查询的参数配置如下 ////获取商户订单号 $out_trade_no = trim($_POST[&#39;out_trade_no&#39;]); //第三方应用授权令牌,商户授权系统商开发模式下使用 $appAuthToken = &quot;&quot;;//根据真实值填写 //构造查询业务请求参数对象 $queryContentBuilder = new AlipayTradeQueryContentBuilder(); $queryContentBuilder-&gt;setOutTradeNo($out_trade_no); $queryContentBuilder-&gt;setAppAuthToken($appAuthToken); //初始化类对象，调用queryTradeResult方法获取查询应答 $queryResponse = new AlipayTradeService($config); $queryResult = $queryResponse-&gt;queryTradeResult($queryContentBuilder); //根据查询返回结果状态进行业务处理 switch ($queryResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝查询交易成功:&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($queryResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝查询交易失败或者交易已关闭!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($queryResult-&gt;getResponse())){ print_r($queryResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($queryResult-&gt;getResponse())){ print_r($queryResult-&gt;getResponse()); } break; default: echo &quot;不支持的查询状态，交易返回异常!!!&quot;; break; } 最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.query&amp;timestamp=2016-08-26+18%3A27%3A07&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=eIuYJtes95asdf3X9eXbQzBa%2FCvm5QgQ0ToUsS8MSkCjhZACYpnU7ZT5MuD31lPZPFHVEjCKsdWiq4tuNtJPFPxirg7pkTiT09C%2Bz8PsUA844Y7hjkkX%2B4CVZcGtO11m3Ap0JECrtZW8hhJTE9bPY1v43X2BSL5Cp3Ulpac1FsM%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot; } 接收到的数据如下 { &quot;alipay_trade_query_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;132***@qq.com&quot;, &quot;buyer_pay_amount&quot;:&quot;1.01&quot;, &quot;buyer_user_id&quot;:&quot;2088002364008751&quot;, &quot;fund_bill_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;point_amount&quot;:&quot;0.00&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;send_pay_date&quot;:&quot;2016-08-26 17:38:58&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750239053830&quot;, &quot;trade_status&quot;:&quot;TRADE_SUCCESS&quot; }, &quot;sign&quot;:&quot;E2MxjdAhW/EqRFNkZgy/Y//dA5Cmb54Hnqa0cjBz+ZcFTULi1lvFms93onP7cpVK/fI7YxbkZTKBPk29o4aeWKXlSYCrT92domAyqahzYCA7/5A3Msc/awALYrFOdWyJJdlncWdFRN9hx52iVRIjxvLJ0hIMVIQqEDavG28HPbo=&quot; } &nbsp; 4. 订单退款 订单退款的参数配置如下 $out_trade_no = trim($_POST[&#39;out_trade_no&#39;]); $refund_amount = trim($_POST[&#39;refund_amount&#39;]); $out_request_no = trim($_POST[&#39;out_request_no&#39;]); //第三方应用授权令牌,商户授权系统商开发模式下使用 $appAuthToken = &quot;&quot;;//根据真实值填写 //创建退款请求builder,设置参数 $refundRequestBuilder = new AlipayTradeRefundContentBuilder(); $refundRequestBuilder-&gt;setOutTradeNo($out_trade_no); $refundRequestBuilder-&gt;setRefundAmount($refund_amount); $refundRequestBuilder-&gt;setOutRequestNo($out_request_no); $refundRequestBuilder-&gt;setAppAuthToken($appAuthToken); //初始化类对象,调用refund获取退款应答 $refundResponse = new AlipayTradeService($config); $refundResult = $refundResponse-&gt;refund($refundRequestBuilder); //根据交易状态进行处理 switch ($refundResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝退款成功:&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($refundResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝退款失败!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($refundResult-&gt;getResponse())){ print_r($refundResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($refundResult-&gt;getResponse())){ print_r($refundResult-&gt;getResponse()); } break; default: echo &quot;不支持的交易状态，交易返回异常!!!&quot;; break; } 最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.refund&amp;timestamp=2016-08-26+18%3A47%3A35&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=Y1c5qWglAQ0tasdfiEtqFnIJRQMn%2Fl9vMla1xgXKcExercJopMyS2rPOHaw%2F2PJEOKJC7r9qAfDGkNq4LHzXhBrD8sxLPqImPS6aWcW9p8s%2FzC2oQCJnLfaPx6lh8veHarj4WzDayeZLA48ttoQLjuMGPrITgOXYjHHyUKdBqSs%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;refund_amount&quot;:&quot;0.01&quot;, &quot;out_request_no&quot;:&quot;1&quot; } 接收到的数据如下 { &quot;alipay_trade_refund_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;123***@qq.com&quot;, &quot;buyer_user_id&quot;:&quot;2088002364008751&quot;, &quot;fund_change&quot;:&quot;Y&quot;, &quot;gmt_refund_pay&quot;:&quot;2016-08-26 18:47:41&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;refund_detail_item_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;refund_fee&quot;:&quot;0.01&quot;, &quot;send_back_fee&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750239053830&quot; }, &quot;sign&quot;:&quot;YDNSMpX5y0rQEs0ZbfNxRFVIp8hf0W30OR74cMtwKVPO2BYee6TQC+pbnwESSZ2XSGLozTyy7o+SIa07L+FMhDv/PTt6QX1mVgQv7RhzoDkls0zDRS/5/fy9Oyj01XS1wb8Od/93iNLZDkd2yw9g0He6qGYlpcXutkmwuASd7BM=&quot; } &nbsp; &nbsp;&nbsp; 阅读更多" />
<link rel="canonical" href="https://mlh.app/2016/08/26/1462b5be72edcd31fe0079fdab211ece.html" />
<meta property="og:url" content="https://mlh.app/2016/08/26/1462b5be72edcd31fe0079fdab211ece.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-08-26T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为方倍工作室原创文章，未经授权不得转载。 https://blog.csdn.net/txw1958/article/details/52330990 关键字：支付宝 当面付 条码支付 扫码支付 二维码支付 订单查询 退款 作者：方倍工作室 本文介绍支付宝中当面付下属的条码支付、扫码支付、订单查询、退款申请的集成开发过程。 &nbsp; 本文分为以下五个部分： 条码支付和扫码支付介绍 申请应用 密钥生成及配置 API及SDK集成 条码支付、扫码支付、订单查询、退款申请 &nbsp; 一、条码支付及二维码支付介绍 1. 条码支付 条码支付是支付宝给到线下传统行业的一种收款方式。商家使用扫码枪等条码识别设备扫描用户支付宝钱包上的条码/二维码，完成收款。用户仅需出示付款码，所有收款操作由商家端完成。其使用场景如下： 业务流程： 使用步骤： 用户登陆支付宝钱包，点击首页“付款”，进入付款码界面； 收银员在商家收银系统操作生成订单，用户确认支付金额； 用户出示钱包的“付款码”，收银员用扫码设备来扫描用户手机上的条码/二维码后，商家收银系统提交支付； 付款成功后商家收银系统会拿到支付成功或者失败的结果。 2. 扫码支付 扫码支付，指用户打开支付宝钱包中的“扫一扫”功能，扫描商家展示在某收银场景下的二维码并进行支付的模式。该模式适用于线下实体店支付、面对面支付等场景。 其使用场景如下： 业务流程： 使用步骤： 用户登陆支付宝钱包，点击首页“付款-扫码付”，进入扫一扫界面； 收银员在商家收银系统操作生成支付宝订单，用户确认支付金额，并生成二维码； 用户使用钱包的“扫码付”，扫收银员提供的二维码，确认支付； 用户付款后商家收银系统会拿到支付成功或者失败的结果。 &nbsp; 二、接口申请 企业在申请企业支付宝之后，进行功能申请并签约，然后在蚂蚁金服开放平台中申请应用如下（详细过程就略了） 然后在功能列表中，申请当面付这一功能，申请成功后如下。 这样，我们就有了当面付的权限了。 &nbsp; &nbsp; 三、密钥生成 在支付宝当面付的接口中，使用了非对称加密算法，商户自己的公钥和私钥需要自己使用OpenSSL手动生成。对这些概念比较陌生的话，请先自行先了解一下密码学的相关知识。OpenSSL也可以从方倍工作室博客中找到。 下载支付宝官方提供的密钥生成工具OpenSSL，然后执行以下命令就可以生成公钥和私钥。 其中 genrsa -out rsa_private_key.pem 1024 是用于生成RSA私钥，执行后在程序目录中生成一个文件rsa_private_key.pem，其内容如下 -----BEGIN RSA PRIVATE KEY----- MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b 3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTITasd hHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiJOxW02rxSQIDAQAB AoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVN JgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCz cEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQ qVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/H nGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3123 T/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34 g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHY OznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4 UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK7 7NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM= -----END RSA PRIVATE KEY----- 命令 rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem 是用于生成RSA公钥，执行后在程序目录中生成一个文件rsa_public_key.pem，其内容如下 -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyffRONGd8Q/1kRh1cpsSRi360 DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRb12345 LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrl123 zus0WcJiJOxW02rxSQIDAQAB -----END PUBLIC KEY----- 生成的这个RSA公钥，需要填写到应用中去，填写地址如下所示。私钥不需要填到配置中，到时候配置到代码中。 &nbsp;特别注意，密钥要去掉注释部分，且转换成一行字符，否则回车换行也成为密钥的一部分，将导致无法正常加解密。 &nbsp;同时，可以点击 “查看支付宝公钥”，将支付宝的公钥复制保存下来，后面的程序中将需要用到。 &nbsp; 四、密钥生成API与密钥配置 公共参数 请求地址： 环境 HTTPS请求地址 正式环境 https://openapi.alipay.com/gateway.do 公共请求参数： 参数 类型 是否必填 最大长度 描述 app_id String 是 32 支付宝分配给开发者的应用ID method String 是 128 接口名称 format String 否 40 仅支持JSON charset String 是 10 请求使用的编码格式，如utf-8,gbk,gb2312等 sign_type String 是 10 商户生成签名字符串所使用的签名算法类型，目前支持RSA sign String 是 256 商户请求参数的签名串，详见签名 timestamp String 是 19 发送请求的时间，格式&quot;yyyy-MM-dd HH:mm:ss&quot; version String 是 3 调用的接口版本，固定为：1.0 notify_url String 否 256 支付宝服务器主动通知商户服务器里指定的页面http/https路径。 app_auth_token String 否 40 详见应用授权概述 biz_content String 是 - 请求参数的集合，最大长度不限，除公共参数外所有请求参数都必须放在这个参数中传递，具体参照各产品快速接入文档 请求参数 参数 类型 是否必填 最大长度 描述 out_trade_no String 必须 64 商户订单号,64个字符以内、可包含字母、数字、下划线；需保证在商户端不重复 scene String 必须 32 支付场景 条码支付，取值：bar_code 声波支付，取值：wave_code auth_code String 必须 32 支付授权码 seller_id String 可选 28 如果该值为空，则默认为商户签约账号对应的支付宝用户ID total_amount Price 可选 11 订单总金额，单位为元， discountable_amount Price 可选 11 参与优惠计算的金额，单位为元 undiscountable_amount Price 可选 11 不参与优惠计算的金额，单位为元 subject String 必须 256 订单标题 body String 可选 128 订单描述 goods_detail GoodsDetail [] 可选 - 订单包含的商品列表信息，Json格式，其它说明详见商品明细说明 operator_id String 可选 28 商户操作员编号 store_id String 可选 32 商户门店编号 terminal_id String 可选 32 商户机具终端编号 alipay_store_id String 可选 32 支付宝的店铺编号 extend_params ExtendParams 可选 - 业务扩展参数 timeout_express String 可选 6 该笔订单允许的最晚付款时间，逾期将关闭交易。 royalty_info RoyaltyInfo 可选 - 描述分账信息，Json格式，其它说明详见分账说明 sub_merchant SubMerchant 可选 - 二级商户信息,当前只对特殊银行机构特定场景下使用此字段 公共响应参数 参数 类型 是否必填 最大长度 描述 code String 是 - 网关返回码,详见文档 msg String 是 - 网关返回码描述,详见文档 sub_code String 否 - 业务返回码,详见文档 sub_msg String 否 - 业务返回码描述,详见文档 sign String 是 - 签名,详见文档 响应参数 参数 类型 是否必填 最大长度 描述 trade_no String 必填 64 支付宝交易号 out_trade_no String 必填 64 商户订单号 buyer_logon_id String 必填 100 买家支付宝账号 total_amount Price 必填 11 交易金额 receipt_amount String 必填 11 实收金额 buyer_pay_amount Price 选填 11 买家付款的金额 point_amount Price 选填 11 使用积分宝付款的金额 invoice_amount Price 选填 11 交易中可给用户开具发票的金额 gmt_payment Date 必填 32 交易支付时间 fund_bill_list TradeFundBill [] 必填 - 交易支付使用的资金渠道 card_balance Price 选填 11 支付宝卡余额 store_name String 选填 512 发生支付交易的商户门店名称 buyer_user_id String 必填 28 买家在支付宝的用户id discount_goods_detail String 必填 - 本次交易支付所使用的单品券优惠的商品优惠信息 &nbsp; 系统中配置如下 &lt;?php $config = array ( //支付宝公钥 &#39;alipay_public_key&#39; =&gt; &quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOasdfiUeJHkrIvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632qJBVHf8sxHi/fEsraprwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUrCmZYI/FCEa3/cNMW0QIDA123&quot;, //商户私钥 &#39;merchant_private_key&#39; =&gt; &quot;MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiasdfW02rxSQIDAQABAoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVNJgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCzcEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQqVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/HnGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3raqT/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHYOznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK77NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM=&quot;, //编码格式 &#39;charset&#39; =&gt; &quot;UTF-8&quot;, //支付宝网关 &#39;gatewayUrl&#39; =&gt; &quot;https://openapi.alipay.com/gateway.do&quot;, //应用ID &#39;app_id&#39; =&gt; &quot;2016061501500000&quot;, //异步通知地址,只有扫码支付预下单可用 &#39;notify_url&#39; =&gt; &quot;http://www.fangbei.org/alipay/notify.html&quot;, //最大查询重试次数 &#39;MaxQueryRetry&#39; =&gt; &quot;10&quot;, //查询间隔 &#39;QueryDuration&#39; =&gt; &quot;3&quot; ); 其中支付宝公钥就是在前面中复制保存的，直接复制到程序中即可，而商户私钥是之前OpenSSL中生成的私钥。APPID是该服务的id号。 而这个异步通知将会接收扫码支付结果的通知。 &nbsp; &nbsp; 五、条码支付、扫码支付、订单查询、退款申请 1. 条码支付 条码支付的参数配置如下 // (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线， // 需保证商户系统端不能重复，建议通过数据库sequence生成， $outTradeNo = &quot;barpay&quot; . date(&#39;Ymdhis&#39;) . mt_rand(100, 1000); $subject = &quot;方倍工作室-支付宝-当面付-扫码支付&quot;; $totalAmount = 1.21; // (必填) 订单总金额，单位为元，不能超过1亿元 // (必填) 付款条码，用户支付宝钱包手机app点击“付款”产生的付款条码 $authCode = $_POST[&#39;auth_code&#39;]; //28开头18位数字 // 支付超时，线下扫码交易定义为5分钟 $timeExpress = &quot;5m&quot;; // 创建请求builder，设置请求参数 $barPayRequestBuilder = new AlipayTradePayContentBuilder(); $barPayRequestBuilder-&gt;setOutTradeNo($outTradeNo); $barPayRequestBuilder-&gt;setTotalAmount($totalAmount); $barPayRequestBuilder-&gt;setAuthCode($authCode); $barPayRequestBuilder-&gt;setTimeExpress($timeExpress); $barPayRequestBuilder-&gt;setSubject($subject); // 调用barPay方法获取当面付应答 $barPay = new AlipayTradeService($config); $barPayResult = $barPay-&gt;barPay($barPayRequestBuilder); switch ($barPayResult-&gt;getTradeStatus()) { case &quot;SUCCESS&quot;: echo &quot;支付宝支付成功:&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($barPayResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝支付失败!!!&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if (!empty($barPayResult-&gt;getResponse())) { print_r($barPayResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot; . &quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if (!empty($barPayResult-&gt;getResponse())) { print_r($barPayResult-&gt;getResponse()); } break; default: echo &quot;不支持的交易状态，交易返回异常!!!&quot;; break; } return; } 程序监测，最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016123150150asdf&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.pay&amp;timestamp=2016-08-26+17%3A14%3A52&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=EMVoBAhPkW6B1m%2BoXytdbUpIxnIAq73asdfasdfasdfYy4OcJQ2UiVTXWttw0y%2B7UEXHWILY8fYRDoNrJWSjBATrAqbGCLpPc4YBQSwtPCb%2F76d65dMQEyrEnk2sgcqhxCiJNKRoQjgAQmBQdHneerU7SwSNJ%2FfF%2F025yltZk5lzQ%3D 发送的json数据如下： { &quot;scene&quot;:&quot;bar_code&quot;, &quot;out_trade_no&quot;:&quot;barpay20160826051452680&quot;, &quot;total_amount&quot;:0.01, &quot;auth_code&quot;:&quot;123743098312323535&quot;, &quot;timeout_express&quot;:&quot;5m&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot; } 接收到的数据如下 { &quot;alipay_trade_pay_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot;, &quot;buyer_pay_amount&quot;:&quot;1.21&quot;, &quot;buyer_user_id&quot;:&quot;2088002312008751&quot;, &quot;fund_bill_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;gmt_payment&quot;:&quot;2016-08-26 17:14:59&quot;, &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;barpay20160826051452680&quot;, &quot;point_amount&quot;:&quot;0.00&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750244100034&quot; }, &quot;sign&quot;:&quot;pEDeMwh6x73t9LmWrZpGnVb1npnKtasdf6+8MDUTurNPVWXR1JHT+x3cRt2G4SDNHzxkJTzSpUXjNylsWisRTnQJJzqRP5XMujxmaAHP/d5xXeyWasDag5Cj7yGD7t80buDAsdE4eoqQ6ox7KzJ6LwKcphOX13tI+Ukt1dGCQS5o=&quot; } &nbsp; 2. 扫码支付 扫码支付的参数配置如下 // (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线， // 需保证商户系统端不能重复，建议通过数据库sequence生成， $outTradeNo = &quot;qrpay&quot;.date(&#39;Ymdhis&#39;).mt_rand(100,1000); $subject = &quot;方倍工作室-支付宝-当面付-扫码支付&quot;; $totalAmount = &quot;1.01&quot;; // 支付超时，线下扫码交易定义为5分钟 $timeExpress = &quot;5m&quot;; // 创建请求builder，设置请求参数 $qrPayRequestBuilder = new AlipayTradePrecreateContentBuilder(); $qrPayRequestBuilder-&gt;setOutTradeNo($outTradeNo); $qrPayRequestBuilder-&gt;setTotalAmount($totalAmount); $qrPayRequestBuilder-&gt;setTimeExpress($timeExpress); $qrPayRequestBuilder-&gt;setSubject($subject); // 调用qrPay方法获取当面付应答 $qrPay = new AlipayTradeService($config); $qrPayResult = $qrPay-&gt;qrPay($qrPayRequestBuilder); // 根据状态值进行业务处理 switch ($qrPayResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝创建订单二维码成功:&quot;.&quot;&lt;br&gt;---------------------------------------&lt;br&gt;&quot;; $response = $qrPayResult-&gt;getResponse(); $qrcode = $qrPay-&gt;create_erweima($response-&gt;qr_code); echo $qrcode; print_r($response); break; case &quot;FAILED&quot;: echo &quot;支付宝创建订单二维码失败!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($qrPayResult-&gt;getResponse())){ print_r($qrPayResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($qrPayResult-&gt;getResponse())){ print_r($qrPayResult-&gt;getResponse()); } break; default: echo &quot;不支持的返回状态，创建订单二维码返回异常!!!&quot;; break; } 生成的提交请求URL如下 https://openapi.alipay.com/gateway.do?app_id=2016061501501234&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.precreate&amp;timestamp=2016-08-26+17%3A38%3A13&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=http%3A%2F%2F123.daoqidata.com%2Fweixin%2Frawpost.php&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=ayYiJRZ63RomVEt8Ayz58Uiyv3y5IrbbXasdf16zNHkT%2Fu11U7ISUYWCXjrwrwCo2Oq2tdo%2FjtuhrBbDp5ULnTmuBBUktQDCCF53PF5yiUDGikxUPFYugeUrTg3gw4DqxOiNKM6ZB6MI0n%2F9M78a%2FnasdftZ4WthyHIl%2B%2FozSyT4%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;total_amount&quot;:&quot;1.01&quot;, &quot;timeout_express&quot;:&quot;5m&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot; } 返回的数据如下： { &quot;alipay_trade_precreate_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;qr_code&quot;:&quot;https://qr.alipay.com/bax00885xbhszseo9l7p404d&quot; }, &quot;sign&quot;:&quot;VfNTGo2WMZ+2CE1L05lNYWtFn4inHXO/tUaBZIBHN4fPlXnCvyc9IhS8S7wa3FYw23G30luEPEHkZWobnfpUjILonmExZVElHv3ylINz+Q2mQ5M8Sb/d61YPvf4Bgy1OvlrT4D3H/i3judmzEDBrOyFN9kB9vSkKaYC+b6L41Zw=&quot; } 其中的https://qr.alipay.com/bax00885xbhszseo9l7p404d 就是二维码链接地址，使用接口将其成二维码后如下所示。 当支付宝用户扫码的时候，接口通知将收到如下数据 { &quot;notify_id&quot;:&quot;4c2c04c3cc50e978d44212febe7c3f0lse&quot;, &quot;seller_email&quot;:&quot;pay***@fangbei.org&quot;, &quot;notify_type&quot;:&quot;trade_status_sync&quot;, &quot;sign&quot;:&quot;R0iRdYmSQ0+zuSUGLzkutHasdfhoOp+CcKojVBCMa1uji3rqQFe5XeHoJB1nMBCApE3zXPKhXMdLis109ngPbGy+NUEBR7YZjYuR/hXq3WXeYfZ8aiWLvloZHrF7dQWxDho/VHYexaLeqvRi/03m0HxrwhZKUOu1eS9wMgZOlqQ=&quot;, &quot;trade_no&quot;:&quot;2016082621001004750241229810&quot;, &quot;buyer_id&quot;:&quot;2088002364008751&quot;, &quot;app_id&quot;:&quot;2016061501500000&quot;, &quot;gmt_create&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826062009757&quot;, &quot;seller_id&quot;:&quot;2088421202724253&quot;, &quot;notify_time&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot;, &quot;trade_status&quot;:&quot;WAIT_BUYER_PAY&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;sign_type&quot;:&quot;RSA&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot; } 当用户输入密码付款成功之后，将收到如下数据 { &quot;fund_bill_list&quot;:&quot;[{&quot;amount&quot;:&quot;0.01&quot;,&quot;fundChannel&quot;:&quot;ALIPAYACCOUNT&quot;}]&quot;, &quot;subject&quot;:&quot;方倍工作室-支付宝-当面付-扫码支付&quot;, &quot;trade_no&quot;:&quot;2016082621001004750241229810&quot;, &quot;gmt_create&quot;:&quot;2016-08-26 18:20:37&quot;, &quot;notify_type&quot;:&quot;trade_status_sync&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826062009757&quot;, &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;seller_id&quot;:&quot;2088421202724253&quot;, &quot;notify_time&quot;:&quot;2016-08-26 18:20:50&quot;, &quot;trade_status&quot;:&quot;TRADE_SUCCESS&quot;, &quot;gmt_payment&quot;:&quot;2016-08-26 18:20:50&quot;, &quot;seller_email&quot;:&quot;pay***@fangbei.org&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;buyer_id&quot;:&quot;2088002364008751&quot;, &quot;app_id&quot;:&quot;2016061501500000&quot;, &quot;notify_id&quot;:&quot;56f97611ee609f46384b188b409e75else&quot;, &quot;buyer_logon_id&quot;:&quot;118***@qq.com&quot;, &quot;sign_type&quot;:&quot;RSA&quot;, &quot;buyer_pay_amount&quot;:&quot;0.01&quot;, &quot;sign&quot;:&quot;nf/KJryACk0utqlNrnuYMiSnYw6HsxqpJPk2O5MhCZ+wZUVQbrD3sq5POO3GU7LSRoSiUUIO4JEYEL12Ek2+w3lTcLS9WEi60sYowPOcJEYGmVfNZbVR6+k7yO5au2WIkM3MKsxm2XxIB9xPMmRDACGhvqZ2BXUAQujkPk1FT0s=&quot;, &quot;point_amount&quot;:&quot;0.00&quot; } &nbsp; 3. 订单查询 订单查询的参数配置如下 ////获取商户订单号 $out_trade_no = trim($_POST[&#39;out_trade_no&#39;]); //第三方应用授权令牌,商户授权系统商开发模式下使用 $appAuthToken = &quot;&quot;;//根据真实值填写 //构造查询业务请求参数对象 $queryContentBuilder = new AlipayTradeQueryContentBuilder(); $queryContentBuilder-&gt;setOutTradeNo($out_trade_no); $queryContentBuilder-&gt;setAppAuthToken($appAuthToken); //初始化类对象，调用queryTradeResult方法获取查询应答 $queryResponse = new AlipayTradeService($config); $queryResult = $queryResponse-&gt;queryTradeResult($queryContentBuilder); //根据查询返回结果状态进行业务处理 switch ($queryResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝查询交易成功:&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($queryResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝查询交易失败或者交易已关闭!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($queryResult-&gt;getResponse())){ print_r($queryResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($queryResult-&gt;getResponse())){ print_r($queryResult-&gt;getResponse()); } break; default: echo &quot;不支持的查询状态，交易返回异常!!!&quot;; break; } 最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.query&amp;timestamp=2016-08-26+18%3A27%3A07&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=eIuYJtes95asdf3X9eXbQzBa%2FCvm5QgQ0ToUsS8MSkCjhZACYpnU7ZT5MuD31lPZPFHVEjCKsdWiq4tuNtJPFPxirg7pkTiT09C%2Bz8PsUA844Y7hjkkX%2B4CVZcGtO11m3Ap0JECrtZW8hhJTE9bPY1v43X2BSL5Cp3Ulpac1FsM%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot; } 接收到的数据如下 { &quot;alipay_trade_query_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;132***@qq.com&quot;, &quot;buyer_pay_amount&quot;:&quot;1.01&quot;, &quot;buyer_user_id&quot;:&quot;2088002364008751&quot;, &quot;fund_bill_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;invoice_amount&quot;:&quot;0.01&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;point_amount&quot;:&quot;0.00&quot;, &quot;receipt_amount&quot;:&quot;0.01&quot;, &quot;send_pay_date&quot;:&quot;2016-08-26 17:38:58&quot;, &quot;total_amount&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750239053830&quot;, &quot;trade_status&quot;:&quot;TRADE_SUCCESS&quot; }, &quot;sign&quot;:&quot;E2MxjdAhW/EqRFNkZgy/Y//dA5Cmb54Hnqa0cjBz+ZcFTULi1lvFms93onP7cpVK/fI7YxbkZTKBPk29o4aeWKXlSYCrT92domAyqahzYCA7/5A3Msc/awALYrFOdWyJJdlncWdFRN9hx52iVRIjxvLJ0hIMVIQqEDavG28HPbo=&quot; } &nbsp; 4. 订单退款 订单退款的参数配置如下 $out_trade_no = trim($_POST[&#39;out_trade_no&#39;]); $refund_amount = trim($_POST[&#39;refund_amount&#39;]); $out_request_no = trim($_POST[&#39;out_request_no&#39;]); //第三方应用授权令牌,商户授权系统商开发模式下使用 $appAuthToken = &quot;&quot;;//根据真实值填写 //创建退款请求builder,设置参数 $refundRequestBuilder = new AlipayTradeRefundContentBuilder(); $refundRequestBuilder-&gt;setOutTradeNo($out_trade_no); $refundRequestBuilder-&gt;setRefundAmount($refund_amount); $refundRequestBuilder-&gt;setOutRequestNo($out_request_no); $refundRequestBuilder-&gt;setAppAuthToken($appAuthToken); //初始化类对象,调用refund获取退款应答 $refundResponse = new AlipayTradeService($config); $refundResult = $refundResponse-&gt;refund($refundRequestBuilder); //根据交易状态进行处理 switch ($refundResult-&gt;getTradeStatus()){ case &quot;SUCCESS&quot;: echo &quot;支付宝退款成功:&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; print_r($refundResult-&gt;getResponse()); break; case &quot;FAILED&quot;: echo &quot;支付宝退款失败!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($refundResult-&gt;getResponse())){ print_r($refundResult-&gt;getResponse()); } break; case &quot;UNKNOWN&quot;: echo &quot;系统异常，订单状态未知!!!&quot;.&quot;&lt;br&gt;--------------------------&lt;br&gt;&quot;; if(!empty($refundResult-&gt;getResponse())){ print_r($refundResult-&gt;getResponse()); } break; default: echo &quot;不支持的交易状态，交易返回异常!!!&quot;; break; } 最终提交的url如下 https://openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.refund&amp;timestamp=2016-08-26+18%3A47%3A35&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=Y1c5qWglAQ0tasdfiEtqFnIJRQMn%2Fl9vMla1xgXKcExercJopMyS2rPOHaw%2F2PJEOKJC7r9qAfDGkNq4LHzXhBrD8sxLPqImPS6aWcW9p8s%2FzC2oQCJnLfaPx6lh8veHarj4WzDayeZLA48ttoQLjuMGPrITgOXYjHHyUKdBqSs%3D 发送的json数据如下： { &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;refund_amount&quot;:&quot;0.01&quot;, &quot;out_request_no&quot;:&quot;1&quot; } 接收到的数据如下 { &quot;alipay_trade_refund_response&quot;:{ &quot;code&quot;:&quot;10000&quot;, &quot;msg&quot;:&quot;Success&quot;, &quot;buyer_logon_id&quot;:&quot;123***@qq.com&quot;, &quot;buyer_user_id&quot;:&quot;2088002364008751&quot;, &quot;fund_change&quot;:&quot;Y&quot;, &quot;gmt_refund_pay&quot;:&quot;2016-08-26 18:47:41&quot;, &quot;open_id&quot;:&quot;20880044751374809757987911112575&quot;, &quot;out_trade_no&quot;:&quot;qrpay20160826053813582&quot;, &quot;refund_detail_item_list&quot;:[ { &quot;amount&quot;:&quot;0.01&quot;, &quot;fund_channel&quot;:&quot;ALIPAYACCOUNT&quot; } ], &quot;refund_fee&quot;:&quot;0.01&quot;, &quot;send_back_fee&quot;:&quot;0.01&quot;, &quot;trade_no&quot;:&quot;2016082621001004750239053830&quot; }, &quot;sign&quot;:&quot;YDNSMpX5y0rQEs0ZbfNxRFVIp8hf0W30OR74cMtwKVPO2BYee6TQC+pbnwESSZ2XSGLozTyy7o+SIa07L+FMhDv/PTt6QX1mVgQv7RhzoDkls0zDRS/5/fy9Oyj01XS1wb8Od/93iNLZDkd2yw9g0He6qGYlpcXutkmwuASd7BM=&quot; } &nbsp; &nbsp;&nbsp; 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2016/08/26/1462b5be72edcd31fe0079fdab211ece.html","headline":"支付宝支付开发—当面付条码支付和扫码支付","dateModified":"2016-08-26T00:00:00+08:00","datePublished":"2016-08-26T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2016/08/26/1462b5be72edcd31fe0079fdab211ece.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>支付宝支付开发—当面付条码支付和扫码支付</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为方倍工作室原创文章，未经授权不得转载。 https://blog.csdn.net/txw1958/article/details/52330990 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"> 
 <div class="htmledit_views"> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 关键字：支付宝 当面付 条码支付 扫码支付 二维码支付 订单查询 退款<br style="margin:0px; padding:0px"> 作者：方倍工作室<br style="margin:0px; padding:0px"> <br> </p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 本文介绍支付宝中当面付下属的条码支付、扫码支付、订单查询、退款申请的集成开发过程。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 本文分为以下五个部分：</p> 
  <ol style="margin:0px; padding:0px 0px 0px 40px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 
   <li style="margin:0px; padding:0px; list-style:decimal">条码支付和扫码支付介绍</li>
   <li style="margin:0px; padding:0px; list-style:decimal">申请应用</li>
   <li style="margin:0px; padding:0px; list-style:decimal">密钥生成及配置</li>
   <li style="margin:0px; padding:0px; list-style:decimal">API及SDK集成</li>
   <li style="margin:0px; padding:0px; list-style:decimal">条码支付、扫码支付、订单查询、退款申请</li>
  </ol> 
  <h2 style="margin:0px; padding:0px; line-height:1.8; font-size:21px; font-family:verdana,Arial,Helvetica,sans-serif"> &nbsp;</h2> 
  <h2 style="margin:0px; padding:0px; line-height:1.8; font-size:21px; font-family:verdana,Arial,Helvetica,sans-serif"> 一、条码支付及二维码支付介绍</h2> 
  <h3 style="margin:0px; padding:0px; font-size:16px; font-family:verdana,Arial,Helvetica,sans-serif"> 1. 条码支付</h3> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 条码支付是支付宝给到线下传统行业的一种收款方式。商家使用扫码枪等条码识别设备扫描用户支付宝钱包上的条码/二维码，完成收款。用户仅需出示付款码，所有收款操作由商家端完成。其使用场景如下：</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826150740585-1083991565.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 业务流程：</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826155828991-721930105.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 使用步骤：</p> 
  <ol style="margin:0px; padding:0px 0px 0px 40px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 
   <li style="margin:0px; padding:0px; list-style:decimal">用户登陆支付宝钱包，点击首页“付款”，进入付款码界面；</li>
   <li style="margin:0px; padding:0px; list-style:decimal">收银员在商家收银系统操作生成订单，用户确认支付金额；</li>
   <li style="margin:0px; padding:0px; list-style:decimal">用户出示钱包的“付款码”，收银员用扫码设备来扫描用户手机上的条码/二维码后，商家收银系统提交支付；</li>
   <li style="margin:0px; padding:0px; list-style:decimal">付款成功后商家收银系统会拿到支付成功或者失败的结果。</li>
  </ol> 
  <h3 style="margin:0px; padding:0px; font-size:16px; font-family:verdana,Arial,Helvetica,sans-serif"> 2. 扫码支付</h3> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 扫码支付，指用户打开支付宝钱包中的“扫一扫”功能，扫描商家展示在某收银场景下的二维码并进行支付的模式。该模式适用于线下实体店支付、面对面支付等场景。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 其使用场景如下：</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826155907554-687187447.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 业务流程：</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826155915991-768037719.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 使用步骤：</p> 
  <ol style="margin:0px; padding:0px 0px 0px 40px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 
   <li style="margin:0px; padding:0px; list-style:decimal">用户登陆支付宝钱包，点击首页“付款-扫码付”，进入扫一扫界面；</li>
   <li style="margin:0px; padding:0px; list-style:decimal">收银员在商家收银系统操作生成支付宝订单，用户确认支付金额，并生成二维码；</li>
   <li style="margin:0px; padding:0px; list-style:decimal">用户使用钱包的“扫码付”，扫收银员提供的二维码，确认支付；</li>
   <li style="margin:0px; padding:0px; list-style:decimal">用户付款后商家收银系统会拿到支付成功或者失败的结果。</li>
  </ol> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h2 style="margin:0px; padding:0px; line-height:1.8; font-size:21px; font-family:verdana,Arial,Helvetica,sans-serif"> 二、接口申请</h2> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 企业在申请企业支付宝之后，进行功能申请并签约，然后在蚂蚁金服开放平台中申请应用如下（详细过程就略了）</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826151105397-683705404.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 然后在功能列表中，申请当面付这一功能，申请成功后如下。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826155106726-1895800753.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 这样，我们就有了当面付的权限了。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h2 style="margin:0px; padding:0px; line-height:1.8; font-size:21px; font-family:verdana,Arial,Helvetica,sans-serif"> 三、密钥生成</h2> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 在支付宝当面付的接口中，使用了非对称加密算法，商户自己的公钥和私钥需要自己使用OpenSSL手动生成。对这些概念比较陌生的话，请先自行先了解一下密码学的相关知识。OpenSSL也可以从方倍工作室博客中找到。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 下载支付宝官方提供的密钥生成工具OpenSSL，然后执行以下命令就可以生成公钥和私钥。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826152344038-1826089701.png" alt="" width="675" height="315" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 其中</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">genrsa -out rsa_private_key.pem <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">1024</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 是用于生成RSA私钥，执行后在程序目录中生成一个文件rsa_private_key.pem，其内容如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">-----BEGIN RSA PRIVATE KEY-----<span style="margin:0px; padding:0px; line-height:1.8">
MIICXAIBAAKBgQCyffRONGd8Q</span>/<span style="margin:0px; padding:0px; line-height:1.8">1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b
3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e</span>+<span style="margin:0px; padding:0px; line-height:1.8">LiYOyNpd6As3Q427KCTITasd
hHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiJOxW02rxSQIDAQAB
AoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW</span>/glWWT+<span style="margin:0px; padding:0px; line-height:1.8">0rnNEi90TQHRNvY7lNVN
JgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCz
cEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQ
qVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2</span>/Qw+tgtpN3YBcCDw/<span style="margin:0px; padding:0px; line-height:1.8">H
nGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9</span>+<span style="margin:0px; padding:0px; line-height:1.8">E19mcVOAJjLBH46mropwgOdj3123
T</span>/ThaKeaydjabsTAiY2J18HiTiyH+<span style="margin:0px; padding:0px; line-height:1.8">1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34
g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T</span>+lXzeQg8D/<span style="margin:0px; padding:0px; line-height:1.8">gfbJj0QuTVNzgdofdoECQBHY
OznCFk6Xe8PguXqUhT4JG</span>/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">4</span><span style="margin:0px; padding:0px; line-height:1.8">
UUqwRjmABFgZrX4</span>+<span style="margin:0px; padding:0px; line-height:1.8">sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK7
7NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM</span>=
-----END RSA PRIVATE KEY-----</pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 命令</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">rsa -<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">in</span> rsa_private_key.pem -pubout -out rsa_public_key.pem</pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 是用于生成RSA公钥，执行后在程序目录中生成一个文件rsa_public_key.pem，其内容如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">-----BEGIN PUBLIC KEY-----<span style="margin:0px; padding:0px; line-height:1.8">
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyffRONGd8Q</span>/<span style="margin:0px; padding:0px; line-height:1.8">1kRh1cpsSRi360
DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRb12345</span><span style="margin:0px; padding:0px; line-height:1.8">
LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrl123
zus0WcJiJOxW02rxSQIDAQAB
</span>-----END PUBLIC KEY-----</pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 生成的这个RSA公钥，需要填写到应用中去，填写地址如下所示。私钥不需要填到配置中，到时候配置到代码中。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826153147288-196263525.png" alt="" width="700" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;特别注意，密钥要去掉注释部分，且转换成一行字符，否则回车换行也成为密钥的一部分，将导致无法正常加解密。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826153923554-1289835436.png" alt="" width="600" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;同时，可以点击 “查看支付宝公钥”，将支付宝的公钥复制保存下来，后面的程序中将需要用到。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826165419726-1456592083.png" alt="" width="600" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h2 style="margin:0px; padding:0px; line-height:1.8; font-size:21px; font-family:verdana,Arial,Helvetica,sans-serif"> 四、密钥生成API与密钥配置</h2> 
  <p id="s0" style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 公共参数</p> 
  <div class="J_sCon" style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px">
    请求地址： 
   <table border="1" cellspacing="0" cellpadding="0" style="margin:0px; padding:0px; border:1px solid silver; border-collapse:collapse; word-break:break-word"> 
    <tbody style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <th width="30%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> 环境</th> 
      <th width="65%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> HTTPS请求地址</th> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> 正式环境</td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> https://openapi.alipay.com/gateway.do</td> 
     </tr> 
    </tbody> 
   </table> 公共请求参数： 
   <table border="1" cellspacing="0" cellpadding="0" style="margin:0px; padding:0px; border:1px solid silver; border-collapse:collapse; word-break:break-word"> 
    <thead style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <th width="20%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">参数</span></th> 
      <th width="12%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">类型</span></th> 
      <th width="10%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是否必填</span></th> 
      <th width="10%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">最大长度</span></th> 
      <th width="25%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">描述</span></th> 
     </tr> 
    </thead> 
    <tbody style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">app_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付宝分配给开发者的应用ID</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">method</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">128</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">接口名称</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">format</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">否</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">40</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">仅支持JSON</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">charset</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">10</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">请求使用的编码格式，如utf-8,gbk,gb2312等</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">sign_type</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">10</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户生成签名字符串所使用的签名算法类型，目前支持RSA</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">sign</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">256</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户请求参数的签名串，详见<a target="_blank" href="https://doc.open.alipay.com/doc2/detail.htm?treeId=200&amp;articleId=105351&amp;docType=1" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">签名</a></span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">timestamp</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">19</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">发送请求的时间，格式"yyyy-MM-dd HH:mm:ss"</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">version</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">3</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">调用的接口版本，固定为：1.0</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">notify_url</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">否</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">256</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付宝服务器主动通知商户服务器里指定的页面http/https路径。</span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">app_auth_token</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">否</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">40</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">详见<a target="_blank" href="https://doc.open.alipay.com/doc2/detail.htm?treeId=216&amp;articleId=105193&amp;docType=1" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">应用授权概述</a></span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">biz_content</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">请求参数的集合，最大长度不限，除公共参数外所有请求参数都必须放在这个参数中传递，具体参照各产品快速接入文档</span></td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <p id="s1" style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span class="triangle open" style="margin:0px; padding:0px; line-height:1.8">请求参数</span></p> 
  <div class="J_sCon" style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 
   <table class="table" border="1" cellspacing="0" cellpadding="0" style="margin:0px; padding:0px; border:1px solid silver; border-collapse:collapse; word-break:break-word"> 
    <thead style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <th width="22%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">参数</span></th> 
      <th width="15%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">类型</span></th> 
      <th width="12%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是否必填</span></th> 
      <th width="12%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">最大长度</span></th> 
      <th width="36%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">描述</span></th> 
     </tr> 
    </thead> 
    <tbody style="margin:0px; padding:0px"> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">out_trade_no</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必须</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">64</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户订单号,64个字符以内、可包含字母、数字、下划线；需保证在商户端不重复</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">scene</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必须</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付场景 条码支付，取值：bar_code 声波支付，取值：wave_code</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">auth_code</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必须</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付授权码</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">seller_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">28</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">如果该值为空，则默认为商户签约账号对应的支付宝用户ID</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">total_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">订单总金额，单位为元，</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">discountable_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">参与优惠计算的金额，单位为元</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">undiscountable_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">不参与优惠计算的金额，单位为元</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">subject</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必须</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">256</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">订单标题</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">body</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">128</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">订单描述</span></td> 
     </tr> 
     <tr class="  J_tableTr J_tableTrigger    even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span class="icon-wrap J_tableIcon" style="margin:0px; padding:0px; line-height:1.8">goods_detail</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">GoodsDetail []</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">订单包含的商品列表信息，Json格式，其它说明详见商品明细说明</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">operator_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">28</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户操作员编号</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">store_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户门店编号</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">terminal_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户机具终端编号</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">alipay_store_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付宝的店铺编号</span></td> 
     </tr> 
     <tr class="  J_tableTr J_tableTrigger    " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span class="icon-wrap J_tableIcon" style="margin:0px; padding:0px; line-height:1.8">extend_params</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">ExtendParams</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">业务扩展参数</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">timeout_express</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">6</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">该笔订单允许的最晚付款时间，逾期将关闭交易。</span></td> 
     </tr> 
     <tr class="  J_tableTr J_tableTrigger    " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span class="icon-wrap J_tableIcon" style="margin:0px; padding:0px; line-height:1.8">royalty_info</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">RoyaltyInfo</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">描述分账信息，Json格式，其它说明详见分账说明</span></td> 
     </tr> 
     <tr class="  J_tableTr J_tableTrigger    even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span class="icon-wrap J_tableIcon" style="margin:0px; padding:0px; line-height:1.8">sub_merchant</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">SubMerchant</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">可选</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">二级商户信息,当前只对特殊银行机构特定场景下使用此字段</span></td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <p id="s2" style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span class="triangle open" style="margin:0px; padding:0px; line-height:1.8">公共响应参数</span></p> 
  <div class="J_sCon" style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 
   <table class="table" border="1" cellspacing="0" cellpadding="0" style="margin:0px; padding:0px; border:1px solid silver; border-collapse:collapse; word-break:break-word"> 
    <thead style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <th width="25%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">参数</span></th> 
      <th width="15%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">类型</span></th> 
      <th width="10%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是否必填</span></th> 
      <th width="10%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">最大长度</span></th> 
      <th width="18%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">描述</span></th> 
     </tr> 
    </thead> 
    <tbody style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">code</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">网关返回码,<a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=200&amp;articleId=105351&amp;docType=1#s2" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">详见文档</a></span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">msg</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">网关返回码描述,<a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=200&amp;articleId=105351&amp;docType=1#s2" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">详见文档</a></span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">sub_code</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">否</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">业务返回码,<a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=200&amp;articleId=105351&amp;docType=1#s2" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">详见文档</a></span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">sub_msg</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">否</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">业务返回码描述,<a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=200&amp;articleId=105351&amp;docType=1#s2" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">详见文档</a></span></td> 
     </tr> 
     <tr style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">sign</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">签名,<a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=200&amp;articleId=105351&amp;docType=1" rel="nofollow" style="margin:0px; padding:0px; text-decoration:none; color:rgb(0,0,0); border-bottom-width:1px; border-bottom-style:dotted; border-bottom-color:rgb(51,51,51)">详见文档</a></span></td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <p id="s3" style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span class="triangle open" style="margin:0px; padding:0px; line-height:1.8">响应参数</span></p> 
  <div class="J_sCon" style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 
   <table class="table" border="1" cellspacing="0" cellpadding="0" style="margin:0px; padding:0px; border:1px solid silver; border-collapse:collapse; word-break:break-word"> 
    <thead style="margin:0px; padding:0px"> 
     <tr style="margin:0px; padding:0px"> 
      <th width="25%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">参数</span></th> 
      <th width="15%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">类型</span></th> 
      <th width="10%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">是否必填</span></th> 
      <th width="10%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">最大长度</span></th> 
      <th width="25%" style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">描述</span></th> 
     </tr> 
    </thead> 
    <tbody style="margin:0px; padding:0px"> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">trade_no</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">64</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付宝交易号</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">out_trade_no</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">64</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">商户订单号</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">buyer_logon_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">100</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">买家支付宝账号</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">total_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">交易金额</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">receipt_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">实收金额</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">buyer_pay_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">选填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">买家付款的金额</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">point_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">选填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">使用积分宝付款的金额</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">invoice_amount</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">选填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">交易中可给用户开具发票的金额</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">gmt_payment</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Date</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">32</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">交易支付时间</span></td> 
     </tr> 
     <tr class="  J_tableTr2 J_tableTrigger    even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span class="icon-wrap J_tableIcon" style="margin:0px; padding:0px; line-height:1.8">fund_bill_list</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">TradeFundBill []</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">交易支付使用的资金渠道</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">card_balance</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">Price</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">选填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">11</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">支付宝卡余额</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">store_name</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">选填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">512</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">发生支付交易的商户门店名称</span></td> 
     </tr> 
     <tr class="   " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">buyer_user_id</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">28</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">买家在支付宝的用户id</span></td> 
     </tr> 
     <tr class="   even  " style="margin:0px; padding:0px"> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">discount_goods_detail</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">String</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">必填</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">-</span></td> 
      <td style="margin:0px; padding:3px; border:1px solid silver; border-collapse:collapse"> <span style="margin:0px; padding:0px; line-height:1.8">本次交易支付所使用的单品券优惠的商品优惠信息</span></td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 系统中配置如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">&lt;?<span style="margin:0px; padding:0px; line-height:1.8">php
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$config</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">array</span><span style="margin:0px; padding:0px; line-height:1.8"> (    
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">支付宝公钥</span>
    'alipay_public_key' =&gt; "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDDI6d306Q8fIfCOasdfiUeJHkrIvYISRcc73s3vF1ZT7XN8RNPwJxo8pWaJMmvyTn9N4HQ632qJBVHf8sxHi/fEsraprwCtzvzQETrNRwVxLO5jVmRGi60j8Ue1efIlzPXV9je9mkjzOmdssymZkh2QhUrCmZYI/FCEa3/cNMW0QIDA123",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">商户私钥</span>
    'merchant_private_key' =&gt; "MIICXAIBAAKBgQCyffRONGd8Q/1kRh1cpsSRi360DXLHI7zxdPJGYe5HKDWF7u9b3zZU9erZpM90XE7gZRKsxIgOurH4uqhmVRbto3e+LiYOyNpd6As3Q427KCTIT7ajhHicZ6GWhegTUiVLqiuWLsauQcbI6DO4GEZrlvAdzus0WcJiasdfW02rxSQIDAQABAoGAXBJYyVaC4zj3Jph8YOStlR5N13bwdATdW/glWWT+0rnNEi90TQHRNvY7lNVNJgrPrTS182TVgjOPxmwSnebakhIuGIdPq99GLE4LGd5lKWTzkd84BMvhatfNsCCzcEVFqKg3tZd4t3fQ93FrILsnnZpLhiW53jIrStCkR3rx9OECQQDWMSHyc91hEVMQqVNasbGEicKWxhoDqjdm2lHkBx4mrB9JEZFDs6MxWdajf2/Qw+tgtpN3YBcCDw/HnGHhQtStAkEA1VTyjOdAwWode8X4fu0IPq9+E19mcVOAJjLBH46mropwgOdj3raqT/ThaKeaydjabsTAiY2J18HiTiyH+1bGjQJBAKgRJXH5OFxSG7uXIbCofYJiFi34g7EcfxxVcqxaaW4u4N2Uy0c0TXkL5T+lXzeQg8D/gfbJj0QuTVNzgdofdoECQBHYOznCFk6Xe8PguXqUhT4JG/iu4DjWjT+kuzbSjerHtcVylY4JpZFuoHRKoM4Fj6/4UUqwRjmABFgZrX4+sfkCQCNI8RCZ6yprh5kEOePo3uazAlNENP8dKkhgqChawdK77NzlJ727Nt23STHFx6NkhzyruJGQ5Vx1Lkl0wKuKbXM=",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">编码格式</span>
    'charset' =&gt; "UTF-8",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">支付宝网关</span>
    'gatewayUrl' =&gt; "https://openapi.alipay.com/gateway.do",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">应用ID</span>
    'app_id' =&gt; "2016061501500000",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">异步通知地址,只有扫码支付预下单可用</span>
    'notify_url' =&gt; "<span style="margin:0px; padding:0px"><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(255,0,0)">http://www.fangbei.org/alipay/notify.html</span></span>",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">最大查询重试次数</span>
    'MaxQueryRetry' =&gt; "10",

    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">查询间隔</span>
    'QueryDuration' =&gt; "3"<span style="margin:0px; padding:0px; line-height:1.8">
);</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 其中支付宝公钥就是在前面中复制保存的，直接复制到程序中即可，而商户私钥是之前OpenSSL中生成的私钥。APPID是该服务的id号。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 而这个异步通知将会接收扫码支付结果的通知。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h2 style="margin:0px; padding:0px; line-height:1.8; font-size:21px; font-family:verdana,Arial,Helvetica,sans-serif"> 五、条码支付、扫码支付、订单查询、退款申请</h2> 
  <h3 style="margin:0px; padding:0px; font-size:16px; font-family:verdana,Arial,Helvetica,sans-serif"> 1. 条码支付</h3> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 条码支付的参数配置如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线，
// 需保证商户系统端不能重复，建议通过数据库sequence生成，</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$outTradeNo</span> = "barpay" . <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">date</span>('Ymdhis') . <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">mt_rand</span>(100, 1000<span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$subject</span> = "方倍工作室-支付宝-当面付-扫码支付"<span style="margin:0px; padding:0px; line-height:1.8">;
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$totalAmount</span> = 1.21;    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> (必填) 订单总金额，单位为元，不能超过1亿元

// (必填) 付款条码，用户支付宝钱包手机app点击“付款”产生的付款条码</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$authCode</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$_POST</span>['auth_code']; <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">28开头18位数字

// 支付超时，线下扫码交易定义为5分钟</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$timeExpress</span> = "5m"<span style="margin:0px; padding:0px; line-height:1.8">;

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> 创建请求builder，设置请求参数</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span><span style="margin:0px; padding:0px; line-height:1.8"> AlipayTradePayContentBuilder();
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span>-&gt;setOutTradeNo(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$outTradeNo</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span>-&gt;setTotalAmount(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$totalAmount</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span>-&gt;setAuthCode(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$authCode</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span>-&gt;setTimeExpress(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$timeExpress</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span>-&gt;setSubject(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$subject</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> 调用barPay方法获取当面付应答</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPay</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span> AlipayTradeService(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$config</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPay</span>-&gt;barPay(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayRequestBuilder</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">switch</span> (<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getTradeStatus()) {
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "SUCCESS":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝支付成功:" . "&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "FAILED":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝支付失败!!!" . "&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span> (!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())) {
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "UNKNOWN":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "系统异常，订单状态未知!!!" . "&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span> (!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())) {
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$barPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">default</span>:
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "不支持的交易状态，交易返回异常!!!"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
}
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">return</span><span style="margin:0px; padding:0px; line-height:1.8">;
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 程序监测，最终提交的url如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">https:<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">openapi.alipay.com/gateway.do?app_id=2016123150150asdf&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.pay&amp;timestamp=2016-08-26+17%3A14%3A52&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=EMVoBAhPkW6B1m%2BoXytdbUpIxnIAq73asdfasdfasdfYy4OcJQ2UiVTXWttw0y%2B7UEXHWILY8fYRDoNrJWSjBATrAqbGCLpPc4YBQSwtPCb%2F76d65dMQEyrEnk2sgcqhxCiJNKRoQjgAQmBQdHneerU7SwSNJ%2FfF%2F025yltZk5lzQ%3D</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 发送的json数据如下：</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"scene":"bar_code"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"out_trade_no":"barpay20160826051452680"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"total_amount":0.01<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"auth_code":"123743098312323535"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"timeout_express":"5m"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"subject":"方倍工作室-支付宝-当面付-扫码支付"<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span style="margin:0px; padding:0px; line-height:1.5">接收到的数据如下</span></p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"alipay_trade_pay_response"<span style="margin:0px; padding:0px; line-height:1.8">:{
        </span>"code":"10000"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"msg":"Success"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"buyer_logon_id":"118***@qq.com"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"buyer_pay_amount":"1.21"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"buyer_user_id":"2088002312008751"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"fund_bill_list"<span style="margin:0px; padding:0px; line-height:1.8">:[
            {
                </span>"amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
                </span>"fund_channel":"ALIPAYACCOUNT"<span style="margin:0px; padding:0px; line-height:1.8">
            }
        ],
        </span>"gmt_payment":"2016-08-26 17:14:59"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"invoice_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"open_id":"20880044751374809757987911112575"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"out_trade_no":"barpay20160826051452680"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"point_amount":"0.00"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"receipt_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"total_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"trade_no":"2016082621001004750244100034"<span style="margin:0px; padding:0px; line-height:1.8">
    },
    </span>"sign":"pEDeMwh6x73t9LmWrZpGnVb1npnKtasdf6+8MDUTurNPVWXR1JHT+x3cRt2G4SDNHzxkJTzSpUXjNylsWisRTnQJJzqRP5XMujxmaAHP/d5xXeyWasDag5Cj7yGD7t80buDAsdE4eoqQ6ox7KzJ6LwKcphOX13tI+Ukt1dGCQS5o="<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h3 style="margin:0px; padding:0px; font-size:16px; font-family:verdana,Arial,Helvetica,sans-serif"> 2. 扫码支付</h3> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 扫码支付的参数配置如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> (必填) 商户网站订单系统中唯一订单号，64个字符以内，只能包含字母、数字、下划线，
// 需保证商户系统端不能重复，建议通过数据库sequence生成，</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$outTradeNo</span> = "qrpay".<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">date</span>('Ymdhis').<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">mt_rand</span>(100,1000<span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$subject</span> = "方倍工作室-支付宝-当面付-扫码支付"<span style="margin:0px; padding:0px; line-height:1.8">;
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$totalAmount</span> = "1.01"<span style="margin:0px; padding:0px; line-height:1.8">;

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> 支付超时，线下扫码交易定义为5分钟</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$timeExpress</span> = "5m"<span style="margin:0px; padding:0px; line-height:1.8">;

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> 创建请求builder，设置请求参数</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayRequestBuilder</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span><span style="margin:0px; padding:0px; line-height:1.8"> AlipayTradePrecreateContentBuilder();
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayRequestBuilder</span>-&gt;setOutTradeNo(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$outTradeNo</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayRequestBuilder</span>-&gt;setTotalAmount(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$totalAmount</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayRequestBuilder</span>-&gt;setTimeExpress(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$timeExpress</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayRequestBuilder</span>-&gt;setSubject(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$subject</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)"> 调用qrPay方法获取当面付应答</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPay</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span> AlipayTradeService(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$config</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPay</span>-&gt;qrPay(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayRequestBuilder</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">    根据状态值进行业务处理</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">switch</span> (<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getTradeStatus()){
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "SUCCESS":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝创建订单二维码成功:"."&lt;br&gt;---------------------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$response</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse();
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrcode</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPay</span>-&gt;create_erweima(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$response</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">qr_code);
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrcode</span><span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$response</span><span style="margin:0px; padding:0px; line-height:1.8">);
        
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "FAILED":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝创建订单二维码失败!!!"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span>(!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())){
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "UNKNOWN":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "系统异常，状态未知!!!"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span>(!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())){
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$qrPayResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">default</span>:
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "不支持的返回状态，创建订单二维码返回异常!!!"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 生成的提交请求URL如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">https:<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">openapi.alipay.com/gateway.do?app_id=2016061501501234&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.precreate&amp;timestamp=2016-08-26+17%3A38%3A13&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=http%3A%2F%2F123.daoqidata.com%2Fweixin%2Frawpost.php&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=ayYiJRZ63RomVEt8Ayz58Uiyv3y5IrbbXasdf16zNHkT%2Fu11U7ISUYWCXjrwrwCo2Oq2tdo%2FjtuhrBbDp5ULnTmuBBUktQDCCF53PF5yiUDGikxUPFYugeUrTg3gw4DqxOiNKM6ZB6MI0n%2F9M78a%2FnasdftZ4WthyHIl%2B%2FozSyT4%3D</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span style="margin:0px; padding:0px; line-height:1.5">发送的json数据如下：</span></p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"out_trade_no":"qrpay20160826053813582"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"total_amount":"1.01"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"timeout_express":"5m"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"subject":"方倍工作室-支付宝-当面付-扫码支付"<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 返回的数据如下：</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"alipay_trade_precreate_response"<span style="margin:0px; padding:0px; line-height:1.8">:{
        </span>"code":"10000"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"msg":"Success"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"out_trade_no":"qrpay20160826053813582"<span style="margin:0px; padding:0px; line-height:1.8">,
        </span>"qr_code":"https://qr.alipay.com/bax00885xbhszseo9l7p404d"<span style="margin:0px; padding:0px; line-height:1.8">
    },
    </span>"sign":"VfNTGo2WMZ+2CE1L05lNYWtFn4inHXO/tUaBZIBHN4fPlXnCvyc9IhS8S7wa3FYw23G30luEPEHkZWobnfpUjILonmExZVElHv3ylINz+Q2mQ5M8Sb/d61YPvf4Bgy1OvlrT4D3H/i3judmzEDBrOyFN9kB9vSkKaYC+b6L41Zw="<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 其中的https://qr.alipay.com/bax00885xbhszseo9l7p404d 就是二维码链接地址，使用接口将其成二维码后如下所示。</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <img src="http://images2015.cnblogs.com/blog/340216/201608/340216-20160826172559460-1256895759.png" alt="" style="margin:0px; padding:0px; border:0px; max-width:900px"></p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 当支付宝用户扫码的时候，接口通知将收到如下数据</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"notify_id":"4c2c04c3cc50e978d44212febe7c3f0lse"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"seller_email":"pay***@fangbei.org"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"notify_type":"trade_status_sync"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"sign":"R0iRdYmSQ0+zuSUGLzkutHasdfhoOp+CcKojVBCMa1uji3rqQFe5XeHoJB1nMBCApE3zXPKhXMdLis109ngPbGy+NUEBR7YZjYuR/hXq3WXeYfZ8aiWLvloZHrF7dQWxDho/VHYexaLeqvRi/03m0HxrwhZKUOu1eS9wMgZOlqQ="<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"trade_no":"2016082621001004750241229810"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"buyer_id":"2088002364008751"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"app_id":"2016061501500000"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"gmt_create":"2016-08-26 18:20:37"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"out_trade_no":"qrpay20160826062009757"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"seller_id":"2088421202724253"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"notify_time":"2016-08-26 18:20:37"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"subject":"方倍工作室-支付宝-当面付-扫码支付"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"trade_status":"WAIT_BUYER_PAY"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"open_id":"20880044751374809757987911112575"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"total_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"sign_type":"RSA"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"buyer_logon_id":"118***@qq.com"<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 当用户输入密码付款成功之后，将收到如下数据</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"fund_bill_list":"[{"amount":"0.01","fundChannel":"ALIPAYACCOUNT"}]"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"subject":"方倍工作室-支付宝-当面付-扫码支付"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"trade_no":"2016082621001004750241229810"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"gmt_create":"2016-08-26 18:20:37"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"notify_type":"trade_status_sync"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"total_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"out_trade_no":"qrpay20160826062009757"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"invoice_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"open_id":"20880044751374809757987911112575"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"seller_id":"2088421202724253"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"notify_time":"2016-08-26 18:20:50"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"trade_status":"TRADE_SUCCESS"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"gmt_payment":"2016-08-26 18:20:50"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"seller_email":"pay***@fangbei.org"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"receipt_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"buyer_id":"2088002364008751"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"app_id":"2016061501500000"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"notify_id":"56f97611ee609f46384b188b409e75else"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"buyer_logon_id":"118***@qq.com"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"sign_type":"RSA"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"buyer_pay_amount":"0.01"<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"sign":"nf/KJryACk0utqlNrnuYMiSnYw6HsxqpJPk2O5MhCZ+wZUVQbrD3sq5POO3GU7LSRoSiUUIO4JEYEL12Ek2+w3lTcLS9WEi60sYowPOcJEYGmVfNZbVR6+k7yO5au2WIkM3MKsxm2XxIB9xPMmRDACGhvqZ2BXUAQujkPk1FT0s="<span style="margin:0px; padding:0px; line-height:1.8">,
    </span>"point_amount":"0.00"<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h3 style="margin:0px; padding:0px; font-size:16px; font-family:verdana,Arial,Helvetica,sans-serif"> 3. 订单查询</h3> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 订单查询的参数配置如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//获取商户订单号</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$out_trade_no</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">trim</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$_POST</span>['out_trade_no'<span style="margin:0px; padding:0px; line-height:1.8">]);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">第三方应用授权令牌,商户授权系统商开发模式下使用</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$appAuthToken</span> = "";<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">根据真实值填写

//构造查询业务请求参数对象</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryContentBuilder</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span><span style="margin:0px; padding:0px; line-height:1.8"> AlipayTradeQueryContentBuilder();
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryContentBuilder</span>-&gt;setOutTradeNo(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$out_trade_no</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryContentBuilder</span>-&gt;setAppAuthToken(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$appAuthToken</span><span style="margin:0px; padding:0px; line-height:1.8">);


</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">初始化类对象，调用queryTradeResult方法获取查询应答</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResponse</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span> AlipayTradeService(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$config</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResponse</span>-&gt;queryTradeResult(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryContentBuilder</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">根据查询返回结果状态进行业务处理</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">switch</span> (<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getTradeStatus()){
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "SUCCESS":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝查询交易成功:"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "FAILED":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝查询交易失败或者交易已关闭!!!"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span>(!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())){
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "UNKNOWN":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "系统异常，订单状态未知!!!"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span>(!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())){
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$queryResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">default</span>:
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "不支持的查询状态，交易返回异常!!!"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 最终提交的url如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">https://openapi.alipay.com/gateway.<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">do</span>?app_id=2016061501500000&amp;version=1.0&amp;<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">format</span>=json&amp;sign_type=RSA&amp;method=alipay.trade.query&amp;timestamp=2016-08-26+18<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">%3</span>A27<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">%3</span>A07&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=eIuYJtes95asdf3X9eXbQzBa<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">%2</span>FCvm5QgQ0ToUsS8MSkCjhZACYpnU7ZT5MuD31lPZPFHVEjCKsdWiq4tuNtJPFPxirg7pkTiT09C<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">%2</span>Bz8PsUA844Y7hjkkX<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">%2</span>B4CVZcGtO11m3Ap0JECrtZW8hhJTE9bPY1v43X2BSL5Cp3Ulpac1FsM<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">%3</span>D</pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 发送的json数据如下：</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"out_trade_no":"qrpay20160826053813582"<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 接收到的数据如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"alipay_trade_query_response"<span style="margin:0px; padding:0px; line-height:1.8">:{
        </span>"code":"10000",
        "msg":"Success",
        "buyer_logon_id":"132***@qq.com",
        "buyer_pay_amount":"1.01",
        "buyer_user_id":"2088002364008751",
        "fund_bill_list"<span style="margin:0px; padding:0px; line-height:1.8">:[
            {
                </span>"amount":"0.01",
                "fund_channel":"ALIPAYACCOUNT"<span style="margin:0px; padding:0px; line-height:1.8">
            }
        ]</span>,
        "invoice_amount":"0.01",
        "open_id":"20880044751374809757987911112575",
        "out_trade_no":"qrpay20160826053813582",
        "point_amount":"0.00",
        "receipt_amount":"0.01",
        "send_pay_date":"2016-08-26 17:38:58",
        "total_amount":"0.01",
        "trade_no":"2016082621001004750239053830",
        "trade_status":"TRADE_SUCCESS"<span style="margin:0px; padding:0px; line-height:1.8">
    }</span>,
    "sign":"E2MxjdAhW/EqRFNkZgy/Y//dA5Cmb54Hnqa0cjBz+ZcFTULi1lvFms93onP7cpVK/fI7YxbkZTKBPk29o4aeWKXlSYCrT92domAyqahzYCA7/5A3Msc/awALYrFOdWyJJdlncWdFRN9hx52iVRIjxvLJ0hIMVIQqEDavG28HPbo="<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <h3 style="margin:0px; padding:0px; font-size:16px; font-family:verdana,Arial,Helvetica,sans-serif"> 4. 订单退款</h3> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> 订单退款的参数配置如下</p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$out_trade_no</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">trim</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$_POST</span>['out_trade_no'<span style="margin:0px; padding:0px; line-height:1.8">]);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refund_amount</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">trim</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$_POST</span>['refund_amount'<span style="margin:0px; padding:0px; line-height:1.8">]);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$out_request_no</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">trim</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$_POST</span>['out_request_no'<span style="margin:0px; padding:0px; line-height:1.8">]);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">第三方应用授权令牌,商户授权系统商开发模式下使用</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$appAuthToken</span> = "";<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">根据真实值填写

//创建退款请求builder,设置参数</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundRequestBuilder</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span><span style="margin:0px; padding:0px; line-height:1.8"> AlipayTradeRefundContentBuilder();
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundRequestBuilder</span>-&gt;setOutTradeNo(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$out_trade_no</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundRequestBuilder</span>-&gt;setRefundAmount(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refund_amount</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundRequestBuilder</span>-&gt;setOutRequestNo(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$out_request_no</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundRequestBuilder</span>-&gt;setAppAuthToken(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$appAuthToken</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">初始化类对象,调用refund获取退款应答</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResponse</span> = <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">new</span> AlipayTradeService(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$config</span><span style="margin:0px; padding:0px; line-height:1.8">);
</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span> =    <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResponse</span>-&gt;refund(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundRequestBuilder</span><span style="margin:0px; padding:0px; line-height:1.8">);

</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">根据交易状态进行处理</span>
<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">switch</span> (<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getTradeStatus()){
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "SUCCESS":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝退款成功:"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "FAILED":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "支付宝退款失败!!!"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span>(!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())){
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">case</span> "UNKNOWN":
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "系统异常，订单状态未知!!!"."&lt;br&gt;--------------------------&lt;br&gt;"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">if</span>(!<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">empty</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse())){
            </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,128)">print_r</span>(<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(128,0,128)">$refundResult</span>-&gt;<span style="margin:0px; padding:0px; line-height:1.8">getResponse());
        }
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
    </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">default</span>:
        <span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">echo</span> "不支持的交易状态，交易返回异常!!!"<span style="margin:0px; padding:0px; line-height:1.8">;
        </span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,0,255)">break</span><span style="margin:0px; padding:0px; line-height:1.8">;
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span style="margin:0px; padding:0px; line-height:1.5">最终提交的url如下</span></p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important">https:<span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">//</span><span style="margin:0px; padding:0px; line-height:1.8; color:rgb(0,128,0)">openapi.alipay.com/gateway.do?app_id=2016061501500000&amp;version=1.0&amp;format=json&amp;sign_type=RSA&amp;method=alipay.trade.refund&amp;timestamp=2016-08-26+18%3A47%3A35&amp;auth_token=&amp;alipay_sdk=alipay-sdk-php-20160411&amp;terminal_type=&amp;terminal_info=&amp;prod_code=&amp;notify_url=&amp;charset=UTF-8&amp;app_auth_token=&amp;sign=Y1c5qWglAQ0tasdfiEtqFnIJRQMn%2Fl9vMla1xgXKcExercJopMyS2rPOHaw%2F2PJEOKJC7r9qAfDGkNq4LHzXhBrD8sxLPqImPS6aWcW9p8s%2FzC2oQCJnLfaPx6lh8veHarj4WzDayeZLA48ttoQLjuMGPrITgOXYjHHyUKdBqSs%3D</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span style="margin:0px; padding:0px; line-height:1.5">发送的json数据如下：</span></p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"out_trade_no":"qrpay20160826053813582",
    "refund_amount":"0.01",
    "out_request_no":"1"<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> <span style="margin:0px; padding:0px; line-height:1.5">接收到的数据如下</span></p> 
  <div class="cnblogs_code" style="margin:5px 0px; padding:5px; border:1px solid rgb(204,204,204); overflow:auto; font-family:&quot;Courier New&quot;!important; background-color:rgb(245,245,245)"> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
   <pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:&quot;Courier New&quot;!important"><span style="margin:0px; padding:0px; line-height:1.8">{
    </span>"alipay_trade_refund_response":<span style="margin:0px; padding:0px; line-height:1.8">{
        </span>"code":"10000",
        "msg":"Success",
        "buyer_logon_id":"123***@qq.com",
        "buyer_user_id":"2088002364008751",
        "fund_change":"Y",
        "gmt_refund_pay":"2016-08-26 18:47:41",
        "open_id":"20880044751374809757987911112575",
        "out_trade_no":"qrpay20160826053813582",
        "refund_detail_item_list":<span style="margin:0px; padding:0px; line-height:1.8">[
            {
                </span>"amount":"0.01",
                "fund_channel":"ALIPAYACCOUNT"<span style="margin:0px; padding:0px; line-height:1.8">
            }
        ]</span>,
        "refund_fee":"0.01",
        "send_back_fee":"0.01",
        "trade_no":"2016082621001004750239053830"<span style="margin:0px; padding:0px; line-height:1.8">
    }</span>,
    "sign":"YDNSMpX5y0rQEs0ZbfNxRFVIp8hf0W30OR74cMtwKVPO2BYee6TQC+pbnwESSZ2XSGLozTyy7o+SIa07L+FMhDv/PTt6QX1mVgQv7RhzoDkls0zDRS/5/fy9Oyj01XS1wb8Od/93iNLZDkd2yw9g0He6qGYlpcXutkmwuASd7BM="<span style="margin:0px; padding:0px; line-height:1.8">
}</span></pre> 
   <div class="cnblogs_code_toolbar" style="margin:5px 0px 0px; padding:0px">
    <span class="cnblogs_code_copy" style="margin:0px; padding:0px 5px 0px 0px; line-height:1.8"><a target="_blank" title="复制代码" style="margin:0px; padding:0px; border:none!important"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px; padding:0px; max-width:900px; border:none!important"></a></span>
   </div> 
  </div> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;</p> 
  <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"> &nbsp;&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/pondbay/article/details/52330990,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/pondbay/article/details/52330990,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

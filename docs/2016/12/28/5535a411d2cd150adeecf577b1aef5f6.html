<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>自己动手部署区块链-hyperledger/fabric-02 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="自己动手部署区块链-hyperledger/fabric-02" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1、环境架构说明： 系统采用容器的方式运行，构建过程简单、各组件分工清晰： 1.Docker-compose:Docker 容器管理； 2.Go lang SDK:Go 语言开发、编译环境； 3.Git:git 镜像克隆与提交； 4.Rest Client: rest API 测试； 容器主要运行有：MemberSrv 和Peer; 2.部署环境准备 3.安装与部署 3.1从 DockerHub上拉取镜像 a. 安装和部署Docker以及docker-compose,详细过程见《使用docker compose部署服务》。 b.拉取镜像 [root@docker fabric]#docker pull hyperledger/fabric-peer:latest #拉取peer的镜像 [root@docker fabric]#docker pull hyperledger/fabric-membersrvc:latest#拉取memberserver的镜像 [root@docker fabric]# docker images#确认镜像拉取成功 REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/nginx latest 19146d5729dc 2 days ago 181.6 MB docker.io/hyperledger/fabric-membersrvc latest b3654d32e4f9 9 weeks ago 1.417 GB docker.io/hyperledger/fabric-peer latest 21cb00fb27f4 9 weeks ago 1.423 GB 3.2 Docker-compose.yml 编写 [root@docker fabric]# pwd /opt/fabric [root@docker fabric]# ls docker-compose.yml docker-compose.yml.old INFO [root@docker fabric]# more docker-compose.yml membersrvc: image: hyperledger/fabric-membersrvc ports: - &quot;7054:7054&quot; command: membersrvc vp0: image: hyperledger/fabric-peer ports: - &quot;7050:7050&quot; - &quot;7051:7051&quot; - &quot;7053:7053&quot; environment: - CORE_PEER_ADDRESSAUTODETECT=true - CORE_VM_ENDPOINT=unix:///var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=vp0 - CORE_PEER_PKI_ECA_PADDR=membersrvc:7054 - CORE_PEER_PKI_TCA_PADDR=membersrvc:7054 - CORE_PEER_PKI_TLSCA_PADDR=membersrvc:7054 - CORE_SECURITY_ENABLED=true - CORE_SECURITY_ENROLLID=test_vp0 - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT volumes: - /var/run/:/var/run/ links: - membersrvc command: sh -c &quot;sleep 5; peer node start --peer-chaincodedev&quot; [root@docker fabric]# 3.3 启动 保存 docker-compose.yml 到/opt/fabric目录，运行docker-compose up 命令启动2个容器（MemberServer和Peer). 到此，我们可以具备启动和运行chaincode，并进行权限管理的Fabric（虽然只有一个Peer)： [root@docker fabric]# docker-compose up Creating fabric_membersrvc_1 Creating fabric_vp0_1 Attaching to fabric_membersrvc_1, fabric_vp0_1 直到启动日志显示如下内容，说明启动成功： 运行docker-compose ps 可以看到服务和对应的端口映射： 另外，常用操作： [root@docker fabric]# docker-compose logs -f vp0#查看日志 [root@docker fabric]# docker-compose exec vp0 bash#exec到vp0 3.4运行与发布Chaincode a.进入到peer里 $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go 目录下： [root@docker fabric]# docker-compose exec vp0 bash 我们发现这个目录里有很多用例chaincode程序(基于go语言编写），我们选择chaincode_example2进行部署与测试。 b.部署chaincode_example。 拷贝chaincode_example02 到$GOPATH/src root@e33e7f4dceb3:/opt/gopath/src# cp $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02/chaincode_example02.go $GOPATH/src/ c.在$GOPATH/src中进行编译 root@e33e7f4dceb3:/opt/gopath/src# go build ./chaincode_example02.go root@e33e7f4dceb3:/opt/gopath/src# ls chaincode_example02 chaincode_example02.go github.com 编译成功会在 GOPATH/src目录生成chaincodeexample02文件。d.发布chaincode在 GOPATH/src 下运行 CORE_CHAINCODE_ID_NAME=mycc CORE_PEER_ADDRESS=0.0.0.0:7051 ./chaincode_example02 直至出现“Received REGISTERED”字样，代表成功。 3.5 deploy,invoke与query chaincode a.login CLI方式： peer network login #用户名和密码在 membersrvc.yaml 文件里 Rest 方式： b.deploy CLI 方式 CORE_SECURITY_ENABLED=true CORE_SECURITY_PRIVACY=true peer chaincode deploy -u jim -n mycc -c &#39;{&quot;Args&quot;: [&quot;init&quot;, &quot;a&quot;,&quot;100&quot;, &quot;b&quot;, &quot;200&quot;]}&#39; Rest 方式： c.Invoke CLI 方式 CORE_SECURITY_ENABLED=true CORE_SECURITY_PRIVACY=true peer chaincode invoke -u jim -l golang -n mycc -c &#39;{&quot;Args&quot;: [&quot;invoke&quot;, &quot;a&quot;, &quot;b&quot;, &quot;10&quot;]}&#39; a 向b 转10块钱后，可以看到a 变成90，b变成210 Aval = 90, Bval = 210 Rest 方式： d. query CLI方式： peer chaincode query -l golang -n mycc -c &#39;{&quot;Args&quot;: [&quot;query&quot;, &quot;b&quot;]}&#39; -u jim Rest 方式： 查询到b 得到了10块钱，查a 的话，会得到-10. 总结： 1.上述过程演示了Fabric的搭建过程； 2.演示了chaincode的部署、共识执行和查询； 3.演示了通过CLI和Rest api 方式与peer进行交互； 提示：chaincode chaincode_example02.go 用例程序社区上下载（https://raw.githubusercontent.com/hyperledger/fabric/master/examples/chaincode/go/chaincode_example02/chaincode_example02.go）的有问题，编译不能通过，query时会超时: vp0_1 | 07:49:12.906 [rest] processChaincodeInvokeOrQuery -&gt; ERRO af8 Error when querying chaincode: Error:Failed to execute transaction or query(Timeout expired while executing transaction) peer 里会出现： 14:57:01.368 [shim] DEBU : [ca1a01d3]Handling ChaincodeMessage of type: RANGE_QUERY_STATE(state:ready) Error starting Simple chaincode: Error handling message: [ca1a01d3-33e8-4fc2-be69-5ff8064f9b1a]Chaincode handler FSM cannot handle message (RANGE_QUERY_STATE) with payload size (10) while in state: ready 解决办法： 采用$GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02，不用下载的。 阅读更多" />
<meta property="og:description" content="1、环境架构说明： 系统采用容器的方式运行，构建过程简单、各组件分工清晰： 1.Docker-compose:Docker 容器管理； 2.Go lang SDK:Go 语言开发、编译环境； 3.Git:git 镜像克隆与提交； 4.Rest Client: rest API 测试； 容器主要运行有：MemberSrv 和Peer; 2.部署环境准备 3.安装与部署 3.1从 DockerHub上拉取镜像 a. 安装和部署Docker以及docker-compose,详细过程见《使用docker compose部署服务》。 b.拉取镜像 [root@docker fabric]#docker pull hyperledger/fabric-peer:latest #拉取peer的镜像 [root@docker fabric]#docker pull hyperledger/fabric-membersrvc:latest#拉取memberserver的镜像 [root@docker fabric]# docker images#确认镜像拉取成功 REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/nginx latest 19146d5729dc 2 days ago 181.6 MB docker.io/hyperledger/fabric-membersrvc latest b3654d32e4f9 9 weeks ago 1.417 GB docker.io/hyperledger/fabric-peer latest 21cb00fb27f4 9 weeks ago 1.423 GB 3.2 Docker-compose.yml 编写 [root@docker fabric]# pwd /opt/fabric [root@docker fabric]# ls docker-compose.yml docker-compose.yml.old INFO [root@docker fabric]# more docker-compose.yml membersrvc: image: hyperledger/fabric-membersrvc ports: - &quot;7054:7054&quot; command: membersrvc vp0: image: hyperledger/fabric-peer ports: - &quot;7050:7050&quot; - &quot;7051:7051&quot; - &quot;7053:7053&quot; environment: - CORE_PEER_ADDRESSAUTODETECT=true - CORE_VM_ENDPOINT=unix:///var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=vp0 - CORE_PEER_PKI_ECA_PADDR=membersrvc:7054 - CORE_PEER_PKI_TCA_PADDR=membersrvc:7054 - CORE_PEER_PKI_TLSCA_PADDR=membersrvc:7054 - CORE_SECURITY_ENABLED=true - CORE_SECURITY_ENROLLID=test_vp0 - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT volumes: - /var/run/:/var/run/ links: - membersrvc command: sh -c &quot;sleep 5; peer node start --peer-chaincodedev&quot; [root@docker fabric]# 3.3 启动 保存 docker-compose.yml 到/opt/fabric目录，运行docker-compose up 命令启动2个容器（MemberServer和Peer). 到此，我们可以具备启动和运行chaincode，并进行权限管理的Fabric（虽然只有一个Peer)： [root@docker fabric]# docker-compose up Creating fabric_membersrvc_1 Creating fabric_vp0_1 Attaching to fabric_membersrvc_1, fabric_vp0_1 直到启动日志显示如下内容，说明启动成功： 运行docker-compose ps 可以看到服务和对应的端口映射： 另外，常用操作： [root@docker fabric]# docker-compose logs -f vp0#查看日志 [root@docker fabric]# docker-compose exec vp0 bash#exec到vp0 3.4运行与发布Chaincode a.进入到peer里 $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go 目录下： [root@docker fabric]# docker-compose exec vp0 bash 我们发现这个目录里有很多用例chaincode程序(基于go语言编写），我们选择chaincode_example2进行部署与测试。 b.部署chaincode_example。 拷贝chaincode_example02 到$GOPATH/src root@e33e7f4dceb3:/opt/gopath/src# cp $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02/chaincode_example02.go $GOPATH/src/ c.在$GOPATH/src中进行编译 root@e33e7f4dceb3:/opt/gopath/src# go build ./chaincode_example02.go root@e33e7f4dceb3:/opt/gopath/src# ls chaincode_example02 chaincode_example02.go github.com 编译成功会在 GOPATH/src目录生成chaincodeexample02文件。d.发布chaincode在 GOPATH/src 下运行 CORE_CHAINCODE_ID_NAME=mycc CORE_PEER_ADDRESS=0.0.0.0:7051 ./chaincode_example02 直至出现“Received REGISTERED”字样，代表成功。 3.5 deploy,invoke与query chaincode a.login CLI方式： peer network login #用户名和密码在 membersrvc.yaml 文件里 Rest 方式： b.deploy CLI 方式 CORE_SECURITY_ENABLED=true CORE_SECURITY_PRIVACY=true peer chaincode deploy -u jim -n mycc -c &#39;{&quot;Args&quot;: [&quot;init&quot;, &quot;a&quot;,&quot;100&quot;, &quot;b&quot;, &quot;200&quot;]}&#39; Rest 方式： c.Invoke CLI 方式 CORE_SECURITY_ENABLED=true CORE_SECURITY_PRIVACY=true peer chaincode invoke -u jim -l golang -n mycc -c &#39;{&quot;Args&quot;: [&quot;invoke&quot;, &quot;a&quot;, &quot;b&quot;, &quot;10&quot;]}&#39; a 向b 转10块钱后，可以看到a 变成90，b变成210 Aval = 90, Bval = 210 Rest 方式： d. query CLI方式： peer chaincode query -l golang -n mycc -c &#39;{&quot;Args&quot;: [&quot;query&quot;, &quot;b&quot;]}&#39; -u jim Rest 方式： 查询到b 得到了10块钱，查a 的话，会得到-10. 总结： 1.上述过程演示了Fabric的搭建过程； 2.演示了chaincode的部署、共识执行和查询； 3.演示了通过CLI和Rest api 方式与peer进行交互； 提示：chaincode chaincode_example02.go 用例程序社区上下载（https://raw.githubusercontent.com/hyperledger/fabric/master/examples/chaincode/go/chaincode_example02/chaincode_example02.go）的有问题，编译不能通过，query时会超时: vp0_1 | 07:49:12.906 [rest] processChaincodeInvokeOrQuery -&gt; ERRO af8 Error when querying chaincode: Error:Failed to execute transaction or query(Timeout expired while executing transaction) peer 里会出现： 14:57:01.368 [shim] DEBU : [ca1a01d3]Handling ChaincodeMessage of type: RANGE_QUERY_STATE(state:ready) Error starting Simple chaincode: Error handling message: [ca1a01d3-33e8-4fc2-be69-5ff8064f9b1a]Chaincode handler FSM cannot handle message (RANGE_QUERY_STATE) with payload size (10) while in state: ready 解决办法： 采用$GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02，不用下载的。 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-12-28T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1、环境架构说明： 系统采用容器的方式运行，构建过程简单、各组件分工清晰： 1.Docker-compose:Docker 容器管理； 2.Go lang SDK:Go 语言开发、编译环境； 3.Git:git 镜像克隆与提交； 4.Rest Client: rest API 测试； 容器主要运行有：MemberSrv 和Peer; 2.部署环境准备 3.安装与部署 3.1从 DockerHub上拉取镜像 a. 安装和部署Docker以及docker-compose,详细过程见《使用docker compose部署服务》。 b.拉取镜像 [root@docker fabric]#docker pull hyperledger/fabric-peer:latest #拉取peer的镜像 [root@docker fabric]#docker pull hyperledger/fabric-membersrvc:latest#拉取memberserver的镜像 [root@docker fabric]# docker images#确认镜像拉取成功 REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/nginx latest 19146d5729dc 2 days ago 181.6 MB docker.io/hyperledger/fabric-membersrvc latest b3654d32e4f9 9 weeks ago 1.417 GB docker.io/hyperledger/fabric-peer latest 21cb00fb27f4 9 weeks ago 1.423 GB 3.2 Docker-compose.yml 编写 [root@docker fabric]# pwd /opt/fabric [root@docker fabric]# ls docker-compose.yml docker-compose.yml.old INFO [root@docker fabric]# more docker-compose.yml membersrvc: image: hyperledger/fabric-membersrvc ports: - &quot;7054:7054&quot; command: membersrvc vp0: image: hyperledger/fabric-peer ports: - &quot;7050:7050&quot; - &quot;7051:7051&quot; - &quot;7053:7053&quot; environment: - CORE_PEER_ADDRESSAUTODETECT=true - CORE_VM_ENDPOINT=unix:///var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=vp0 - CORE_PEER_PKI_ECA_PADDR=membersrvc:7054 - CORE_PEER_PKI_TCA_PADDR=membersrvc:7054 - CORE_PEER_PKI_TLSCA_PADDR=membersrvc:7054 - CORE_SECURITY_ENABLED=true - CORE_SECURITY_ENROLLID=test_vp0 - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT volumes: - /var/run/:/var/run/ links: - membersrvc command: sh -c &quot;sleep 5; peer node start --peer-chaincodedev&quot; [root@docker fabric]# 3.3 启动 保存 docker-compose.yml 到/opt/fabric目录，运行docker-compose up 命令启动2个容器（MemberServer和Peer). 到此，我们可以具备启动和运行chaincode，并进行权限管理的Fabric（虽然只有一个Peer)： [root@docker fabric]# docker-compose up Creating fabric_membersrvc_1 Creating fabric_vp0_1 Attaching to fabric_membersrvc_1, fabric_vp0_1 直到启动日志显示如下内容，说明启动成功： 运行docker-compose ps 可以看到服务和对应的端口映射： 另外，常用操作： [root@docker fabric]# docker-compose logs -f vp0#查看日志 [root@docker fabric]# docker-compose exec vp0 bash#exec到vp0 3.4运行与发布Chaincode a.进入到peer里 $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go 目录下： [root@docker fabric]# docker-compose exec vp0 bash 我们发现这个目录里有很多用例chaincode程序(基于go语言编写），我们选择chaincode_example2进行部署与测试。 b.部署chaincode_example。 拷贝chaincode_example02 到$GOPATH/src root@e33e7f4dceb3:/opt/gopath/src# cp $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02/chaincode_example02.go $GOPATH/src/ c.在$GOPATH/src中进行编译 root@e33e7f4dceb3:/opt/gopath/src# go build ./chaincode_example02.go root@e33e7f4dceb3:/opt/gopath/src# ls chaincode_example02 chaincode_example02.go github.com 编译成功会在 GOPATH/src目录生成chaincodeexample02文件。d.发布chaincode在 GOPATH/src 下运行 CORE_CHAINCODE_ID_NAME=mycc CORE_PEER_ADDRESS=0.0.0.0:7051 ./chaincode_example02 直至出现“Received REGISTERED”字样，代表成功。 3.5 deploy,invoke与query chaincode a.login CLI方式： peer network login #用户名和密码在 membersrvc.yaml 文件里 Rest 方式： b.deploy CLI 方式 CORE_SECURITY_ENABLED=true CORE_SECURITY_PRIVACY=true peer chaincode deploy -u jim -n mycc -c &#39;{&quot;Args&quot;: [&quot;init&quot;, &quot;a&quot;,&quot;100&quot;, &quot;b&quot;, &quot;200&quot;]}&#39; Rest 方式： c.Invoke CLI 方式 CORE_SECURITY_ENABLED=true CORE_SECURITY_PRIVACY=true peer chaincode invoke -u jim -l golang -n mycc -c &#39;{&quot;Args&quot;: [&quot;invoke&quot;, &quot;a&quot;, &quot;b&quot;, &quot;10&quot;]}&#39; a 向b 转10块钱后，可以看到a 变成90，b变成210 Aval = 90, Bval = 210 Rest 方式： d. query CLI方式： peer chaincode query -l golang -n mycc -c &#39;{&quot;Args&quot;: [&quot;query&quot;, &quot;b&quot;]}&#39; -u jim Rest 方式： 查询到b 得到了10块钱，查a 的话，会得到-10. 总结： 1.上述过程演示了Fabric的搭建过程； 2.演示了chaincode的部署、共识执行和查询； 3.演示了通过CLI和Rest api 方式与peer进行交互； 提示：chaincode chaincode_example02.go 用例程序社区上下载（https://raw.githubusercontent.com/hyperledger/fabric/master/examples/chaincode/go/chaincode_example02/chaincode_example02.go）的有问题，编译不能通过，query时会超时: vp0_1 | 07:49:12.906 [rest] processChaincodeInvokeOrQuery -&gt; ERRO af8 Error when querying chaincode: Error:Failed to execute transaction or query(Timeout expired while executing transaction) peer 里会出现： 14:57:01.368 [shim] DEBU : [ca1a01d3]Handling ChaincodeMessage of type: RANGE_QUERY_STATE(state:ready) Error starting Simple chaincode: Error handling message: [ca1a01d3-33e8-4fc2-be69-5ff8064f9b1a]Chaincode handler FSM cannot handle message (RANGE_QUERY_STATE) with payload size (10) while in state: ready 解决办法： 采用$GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02，不用下载的。 阅读更多","@type":"BlogPosting","url":"/2016/12/28/5535a411d2cd150adeecf577b1aef5f6.html","headline":"自己动手部署区块链-hyperledger/fabric-02","dateModified":"2016-12-28T00:00:00+08:00","datePublished":"2016-12-28T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2016/12/28/5535a411d2cd150adeecf577b1aef5f6.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>自己动手部署区块链-hyperledger/fabric-02</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>1、环境架构说明： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228131728106?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> 系统采用容器的方式运行，构建过程简单、各组件分工清晰： <br> 1.Docker-compose:Docker 容器管理； <br> 2.Go lang SDK:Go 语言开发、编译环境； <br> 3.Git:git 镜像克隆与提交； <br> 4.Rest Client: rest API 测试； <br> 容器主要运行有：MemberSrv 和Peer;</p> 
  <p>2.部署环境准备 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228152811524?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>3.安装与部署 <br> 3.1从 DockerHub上拉取镜像 <br> a. 安装和部署Docker以及docker-compose,详细过程见<a href="http://blog.csdn.net/yl_1314/article/details/53761049" rel="nofollow">《使用docker compose部署服务》</a>。 <br> b.拉取镜像</p> 
  <pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment">#docker pull hyperledger/fabric-peer:latest #拉取peer的镜像</span>
[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment">#docker pull hyperledger/fabric-membersrvc:latest#拉取memberserver的镜像</span>
[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment"># docker images#确认镜像拉取成功</span>
<span class="hljs-constant">REPOSITORY</span>                                <span class="hljs-constant">TAG</span>                 <span class="hljs-constant">IMAGE</span> <span class="hljs-constant">ID</span>            <span class="hljs-constant">CREATED</span>             <span class="hljs-constant">SIZE</span>
docker.io/nginx                           latest              <span class="hljs-number">19146</span>d5729dc        <span class="hljs-number">2</span> days ago          <span class="hljs-number">181.6</span> <span class="hljs-constant">MB</span>
docker.io/hyperledger/fabric-membersrvc   latest              b3654d32e4f9        <span class="hljs-number">9</span> weeks ago         <span class="hljs-number">1.417</span> <span class="hljs-constant">GB</span>
docker.io/hyperledger/fabric-peer         latest              <span class="hljs-number">21</span>cb00fb27f4        <span class="hljs-number">9</span> weeks ago         <span class="hljs-number">1.423</span> <span class="hljs-constant">GB</span></code></pre> 
  <p>3.2 Docker-compose.yml 编写</p> 
  <pre class="prettyprint"><code class=" hljs haml">[root@docker fabric]# pwd
<span class="hljs-comment">/opt/fabric</span>
[root@docker fabric]# ls
docker-compose.yml  docker-compose.yml.old  INFO
[root@docker fabric]# more docker-compose.yml
membersrvc:
  image: hyperledger/fabric-membersrvc
  ports:
    -<span class="ruby"> <span class="hljs-string">"7054:7054"</span> </span>  command: membersrvc
vp0:
  image: hyperledger/fabric-peer
  ports:
    -<span class="ruby"> <span class="hljs-string">"7050:7050"</span> </span>    -<span class="ruby"> <span class="hljs-string">"7051:7051"</span> </span>    -<span class="ruby"> <span class="hljs-string">"7053:7053"</span> </span>  environment:
    -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESSAUTODETECT</span>=<span class="hljs-keyword">true</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//var</span><span class="hljs-regexp">/run/docker</span>.sock </span>    -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=vp<span class="hljs-number">0</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_PEER_PKI_ECA_PADDR</span>=<span class="hljs-symbol">membersrvc:</span><span class="hljs-number">7054</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_PEER_PKI_TCA_PADDR</span>=<span class="hljs-symbol">membersrvc:</span><span class="hljs-number">7054</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_PEER_PKI_TLSCA_PADDR</span>=<span class="hljs-symbol">membersrvc:</span><span class="hljs-number">7054</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_SECURITY_ENABLED</span>=<span class="hljs-keyword">true</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_SECURITY_ENROLLID</span>=test_vp<span class="hljs-number">0</span> </span>    -<span class="ruby"> <span class="hljs-constant">CORE_SECURITY_ENROLLSECRET</span>=<span class="hljs-constant">MwYpmSRjupbT</span> </span>  volumes:
      -<span class="ruby"> /var/run/<span class="hljs-symbol">:/var/run/</span> </span>  links:
    -<span class="ruby"> membersrvc </span>  command: sh -c "sleep 5; peer node start --peer-chaincodedev"
[root@docker fabric]# </code></pre> 
  <p>3.3 启动 <br> 保存 docker-compose.yml 到/opt/fabric目录，运行docker-compose up 命令启动2个容器（MemberServer和Peer). <br> 到此，我们可以具备启动和运行chaincode，并进行权限管理的Fabric（虽然只有一个Peer)：</p> 
  <pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment"># docker-compose up</span>
<span class="hljs-constant">Creating</span> fabric_membersrvc_1
<span class="hljs-constant">Creating</span> fabric_vp0_1
<span class="hljs-constant">Attaching</span> to fabric_membersrvc_1, fabric_vp0_1</code></pre> 
  <p>直到启动日志显示如下内容，说明启动成功： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228154513657?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> 运行docker-compose ps 可以看到服务和对应的端口映射： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228155709173?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> 另外，常用操作：</p> 
  <pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment"># docker-compose logs -f vp0#查看日志</span>
[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment"># docker-compose exec vp0 bash#exec到vp0</span></code></pre> 
  <p>3.4运行与发布Chaincode <br> a.进入到peer里 $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go 目录下：</p> 
  <pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@docker</span> fabric]<span class="hljs-comment"># docker-compose exec vp0 bash</span></code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228160416995?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> 我们发现这个目录里有很多用例chaincode程序(基于go语言编写），我们选择chaincode_example2进行部署与测试。 <br> b.部署chaincode_example。 <br> 拷贝chaincode_example02 到$GOPATH/src</p> 
  <pre class="prettyprint"><code class=" hljs ruby">root<span class="hljs-variable">@e33e7f4dceb3</span><span class="hljs-symbol">:/opt/gopath/src</span><span class="hljs-comment"># cp $GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02/chaincode_example02.go $GOPATH/src/</span></code></pre> 
  <p>c.在$GOPATH/src中进行编译</p> 
  <pre class="prettyprint"><code class=" hljs ruby">root<span class="hljs-variable">@e33e7f4dceb3</span><span class="hljs-symbol">:/opt/gopath/src</span><span class="hljs-comment"># go build ./chaincode_example02.go </span>
root<span class="hljs-variable">@e33e7f4dceb3</span><span class="hljs-symbol">:/opt/gopath/src</span><span class="hljs-comment"># ls</span>
chaincode_example02  chaincode_example02.go  github.com</code></pre> 
  <p>编译成功会在<span class="MathJax_Preview"></span><span style="" aria-readonly="true" role="textbox" id="MathJax-Element-56-Frame" class="MathJax">
    <nobr>
     <span style="width: 33.083em; display: inline-block;" id="MathJax-Span-4016" class="math"><span style="display: inline-block; position: relative; width: 27.328em; height: 0px; font-size: 121%;"><span style="position: absolute; clip: rect(1.569em, 1000em, 2.905em, -0.444em); top: -2.534em; left: 0em;"><span id="MathJax-Span-4017" class="mrow"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4018" class="mi">G</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4019" class="mi">O</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4020" class="mi">P</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4021" class="mi">A</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4022" class="mi">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.077em;"></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4023" class="mi">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span><span id="MathJax-Span-4024" class="texatom"><span id="MathJax-Span-4025" class="mrow"><span style="font-family: STIXGeneral;" id="MathJax-Span-4026" class="mo">/</span></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4027" class="mi">s</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4028" class="mi">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4029" class="mi">c</span><span id="MathJax-Span-4030" class="texatom"><span id="MathJax-Span-4031" class="mrow"><span id="MathJax-Span-4032" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">目</span></span></span></span><span id="MathJax-Span-4033" class="texatom"><span id="MathJax-Span-4034" class="mrow"><span id="MathJax-Span-4035" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">录</span></span></span></span><span id="MathJax-Span-4036" class="texatom"><span id="MathJax-Span-4037" class="mrow"><span id="MathJax-Span-4038" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">生</span></span></span></span><span id="MathJax-Span-4039" class="texatom"><span id="MathJax-Span-4040" class="mrow"><span id="MathJax-Span-4041" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">成</span></span></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4042" class="mi">c</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4043" class="mi">h</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4044" class="mi">a</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4045" class="mi">i</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4046" class="mi">n</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4047" class="mi">c</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4048" class="mi">o</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4049" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span id="MathJax-Span-4050" class="msubsup"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(1.928em, 1000em, 2.711em, -0.465em); top: -2.534em; left: 0em;"><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4051" class="mi">e</span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span><span style="position: absolute; top: -1.944em; left: 0.441em;"><span style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4052" class="mi">e</span><span style="display: inline-block; width: 0px; height: 2.094em;"></span></span></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4053" class="mi">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4054" class="mi">a</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4055" class="mi">m</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4056" class="mi">p</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4057" class="mi">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4058" class="mi">e</span><span style="font-family: STIXGeneral;" id="MathJax-Span-4059" class="mn">02</span><span id="MathJax-Span-4060" class="texatom"><span id="MathJax-Span-4061" class="mrow"><span id="MathJax-Span-4062" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">文</span></span></span></span><span id="MathJax-Span-4063" class="texatom"><span id="MathJax-Span-4064" class="mrow"><span id="MathJax-Span-4065" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">件</span></span></span></span><span id="MathJax-Span-4066" class="texatom"><span id="MathJax-Span-4067" class="mrow"><span id="MathJax-Span-4068" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">。</span></span></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4069" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="font-family: STIXGeneral;" id="MathJax-Span-4070" class="mo">.</span><span style="padding-left: 0.188em;" id="MathJax-Span-4071" class="texatom"><span id="MathJax-Span-4072" class="mrow"><span id="MathJax-Span-4073" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">发</span></span></span></span><span id="MathJax-Span-4074" class="texatom"><span id="MathJax-Span-4075" class="mrow"><span id="MathJax-Span-4076" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">布</span></span></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4077" class="mi">c</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4078" class="mi">h</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4079" class="mi">a</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4080" class="mi">i</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4081" class="mi">n</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4082" class="mi">c</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4083" class="mi">o</span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4084" class="mi">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.027em;"></span></span><span style="font-family: STIXGeneral; font-style: italic;" id="MathJax-Span-4085" class="mi">e</span><span id="MathJax-Span-4086" class="texatom"><span id="MathJax-Span-4087" class="mrow"><span id="MathJax-Span-4088" class="mo"><span style="font-family: STIXGeneral,&quot;Arial Unicode MS&quot;,serif; font-size: 83%; font-style: normal; font-weight: normal;">在</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.534em;"></span></span></span><span style="border-left: 0em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.349em; vertical-align: -0.315em;"></span></span>
    </nobr></span><script id="MathJax-Element-56" type="math/tex">GOPATH/src目录生成chaincode_example02文件。  
d.发布chaincode  
在</script>GOPATH/src 下运行 <br> CORE_CHAINCODE_ID_NAME=mycc CORE_PEER_ADDRESS=0.0.0.0:7051 ./chaincode_example02 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228161639356?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> 直至出现“Received REGISTERED”字样，代表成功。 <br> 3.5 deploy,invoke与query chaincode <br> a.login <br> CLI方式：</p> 
  <pre class="prettyprint"><code class=" hljs bash">peer network login <span class="hljs-comment">#用户名和密码在 membersrvc.yaml 文件里</span></code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228162220096?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> Rest 方式： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228165748627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> b.deploy <br> CLI 方式</p> 
  <pre class="prettyprint"><code class=" hljs erlang">  <span class="hljs-variable">CORE_SECURITY_ENABLED</span>=<span class="hljs-literal">true</span> <span class="hljs-variable">CORE_SECURITY_PRIVACY</span>=<span class="hljs-literal">true</span> peer chaincode deploy -u jim -n mycc -c '<span class="hljs-tuple">{<span class="hljs-string">"Args"</span>: [<span class="hljs-string">"init"</span>, <span class="hljs-string">"a"</span>,<span class="hljs-string">"100"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"200"</span>]}</span>'</code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228165957245?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228170013488?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> Rest 方式： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228170312655?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>c.Invoke <br> CLI 方式</p> 
  <pre class="prettyprint"><code class=" hljs erlang">  <span class="hljs-variable">CORE_SECURITY_ENABLED</span>=<span class="hljs-literal">true</span> <span class="hljs-variable">CORE_SECURITY_PRIVACY</span>=<span class="hljs-literal">true</span> peer chaincode invoke -u jim -l golang -n mycc -c '<span class="hljs-tuple">{<span class="hljs-string">"Args"</span>: [<span class="hljs-string">"invoke"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"10"</span>]}</span>'</code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228170350770?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228170405333?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>a 向b 转10块钱后，可以看到a 变成90，b变成210</p> 
  <pre class="prettyprint"><code class=" hljs fix"><span class="hljs-attribute">Aval </span>=<span class="hljs-string"> 90, Bval = 210</span></code></pre> 
  <p>Rest 方式： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228173609966?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>d. query <br> CLI方式：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">peer chaincode query <span class="hljs-attribute">-l</span> golang <span class="hljs-attribute">-n</span> mycc <span class="hljs-attribute">-c</span> <span class="hljs-string">'{"Args": ["query", "b"]}'</span> <span class="hljs-attribute">-u</span> jim</code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228173806536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228173843188?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>Rest 方式： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20161228173948861?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWUxfMTMxNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>查询到b 得到了10块钱，查a 的话，会得到-10.</p> 
  <p>总结： <br> 1.上述过程演示了Fabric的搭建过程； <br> 2.演示了chaincode的部署、共识执行和查询； <br> 3.演示了通过CLI和Rest api 方式与peer进行交互；</p> 
  <p>提示：chaincode chaincode_example02.go 用例程序社区上下载（<a href="https://raw.githubusercontent.com/hyperledger/fabric/master/examples/chaincode/go/chaincode_example02/chaincode_example02.go" rel="nofollow">https://raw.githubusercontent.com/hyperledger/fabric/master/examples/chaincode/go/chaincode_example02/chaincode_example02.go</a>）的有问题，编译不能通过，query时会超时:</p> 
  <pre class="prettyprint"><code class=" hljs vbnet">vp0_1         | <span class="hljs-number">07</span>:<span class="hljs-number">49</span>:<span class="hljs-number">12.906</span> [rest] processChaincodeInvokeOrQuery -&gt; ERRO af8 <span class="hljs-keyword">Error</span> <span class="hljs-keyword">when</span> querying chaincode: <span class="hljs-keyword">Error</span>:Failed <span class="hljs-keyword">to</span> execute transaction <span class="hljs-keyword">or</span> query(Timeout expired <span class="hljs-keyword">while</span> executing transaction)</code></pre> 
  <p>peer 里会出现：</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-number">14</span>:<span class="hljs-number">57</span>:<span class="hljs-number">01.368</span> [shim] <span class="hljs-type">DEBU</span> : [ca1a01d3]<span class="hljs-type">Handling</span> <span class="hljs-type">ChaincodeMessage</span> <span class="hljs-keyword">of</span> <span class="hljs-typedef"><span class="hljs-keyword">type</span>: <span class="hljs-type">RANGE_QUERY_STATE</span><span class="hljs-container">(<span class="hljs-title">state</span>:<span class="hljs-title">ready</span>)</span> <span class="hljs-type">Error</span> starting <span class="hljs-type">Simple</span> chaincode: <span class="hljs-type">Error</span> handling message: [ca1a01d3-33e8-4fc2-be69-5ff8064f9b1a]<span class="hljs-type">Chaincode</span> handler <span class="hljs-type">FSM</span> cannot handle message <span class="hljs-container">(<span class="hljs-type">RANGE_QUERY_STATE</span>)</span> with payload size <span class="hljs-container">(10)</span> while in state: ready</span></code></pre> 
  <p>解决办法： <br> 采用$GOPATH/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02，不用下载的。</p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/YL_1314/article/details/53908973,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/YL_1314/article/details/53908973,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

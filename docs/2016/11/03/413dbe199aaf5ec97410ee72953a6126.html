<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Socket协议Loadrunner脚本+8583报文解析及组装 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Socket协议Loadrunner脚本+8583报文解析及组装" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本交易为POS消费交易，报文类型为8583通讯报文，一般在银联通讯方面，金融交易方面用的比较多，如下为手动编写我们的测试脚本，并非录制而成，在此类直接与接口交互的性能测试项目中，经常会用到报文组装、拼接等工作，这里记录想整个数据的解析拼装过程以及我们测试思路 一：pos交易（8583协议）报文处理部分： 必须熟悉不同交易每个域的划分及每个域的数据长度，具体详细报文结构不做具体描述，每个报文有其具体规则，解析出每个域的数据 如下报文全部调试成功，另外需要对卡号，交易金额，流水号等数据进行处理，需要对MAC校验进行额外处理，具体不详述 ①：发送报文获取： Ø&nbsp; 获取到POS机消费报文，我这里每个域使用不同颜色区分开来（部分数据涉及公司私密，已做小部分更改，不过不影响报文的分析及阅读）： 011F60000400006031003113060200702006c420c09a11166214441000010111000000000000000001003394071000110012cdf43eb3cb55b41a257c51c26eaef80138jnehnd98adac160195349a7127e126f03030303030363232383433313030303534313130303233313536d8uejeiuw28ce80526100000000000000983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f4104000011940014220000300006013437393435353436 注：在这里每个域区分开来后，就可以直接把每个域的数据提取出来，在Loadrunner中进行16进制转换。 ②：报文解析（解析出每个域的数据）： Ø&nbsp; 对上面的报文进行bitmap解析（使用bitmap工具解析每个域数据），上面消费报文解析出的每个域的数据如下所示： 报文长度：011F TPDU：&nbsp;&nbsp;&nbsp; 6000040000 报文头：&nbsp; 603100311306 MSGID：&nbsp;&nbsp; 0200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --消息类型，0200指消费交易 BITMAP：&nbsp; 702006c420c09a11&nbsp; --位图，确认后面所有使用的域，记录哪些域会出现在报文中 Bit 2：&nbsp;&nbsp; 6214441000010111&nbsp;&nbsp; --主账号 Bit 3：&nbsp;&nbsp; 000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --处理代码，交易类型，000000代表消费，n6 Bit 4：&nbsp;&nbsp; 000000000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --交易金额，单位为分，n12 Bit 11：&nbsp; 003394&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --交易流水号，n6 Bit 22：&nbsp; 071&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --服务器输入方式&nbsp;&nbsp; ，n3 Bit 23：&nbsp; 011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --卡顺序号，n3 Bit 25：&nbsp; 00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --服务点条件码，n2 Bit 26：&nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --售卡方业务代码， Bit 30：&nbsp; cdf43eb3cb55b41a257c51c26eaef801 --原始金额，n24 Bit 35：&nbsp; 38jnehnd98adac160195349a7127e126f0--第2磁道数据，z37 Bit 41：&nbsp; 00000622&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --终端代码，ANS8 Bit 42：&nbsp; 843100054110023&nbsp;&nbsp;&nbsp; --终端标示，ANS15 Bit 49：&nbsp; 156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --货币代码，n3,156为人民币 Bit 52：&nbsp; d8uejeiuw28ce805--用户密码（PIN Data），B64 Bit 53：&nbsp; 2610000000000000&nbsp;&nbsp; --安全控制信息，n16 Bit 55： 0983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f410400001194 --IC卡数据域 Bit 60：&nbsp; 22000030000601&nbsp;&nbsp; --附加数据，自定义域 Bit 64：&nbsp;3437393435353436&nbsp;&nbsp;&nbsp;&nbsp; --报文鉴别代码字段 &nbsp; &nbsp; ③：报文解析后对报文进行16进制转换处理（域位数不够需要注意域的左对齐右对齐以及左补0右补0）： Ø&nbsp; 因为loadrunner中需要识别16进制的数据进行socket报文发送，所以需要把如上消费报文转换为16进制进行发送，发送16进制格式为：每两位前面加转义符“\x”来代表16进制，上面消费报文转换后的16进制报文如下（每个域加上双引号且换行）： &quot;\x01\x1F&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//报文长度，必须加上，否则报文无法发送成功 &quot;\x60\x00\x04\x00\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //TPDU &quot;\x60\x31\x00\x31\x13\x06&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //报文头 &quot;\x02\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //MSGID，指余额查询、消费等 &quot;\x70\x20\x06\xc4\x20\xc0\x9a\x11&quot;//bitmap：确认后面报文使用的域 &quot;\x16\x62\x14\x44\x10\x00\x01\x01\x11&quot;//bit2，主账号16位卡号，前面加长度16 &quot;\x00\x00\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit3，处理码，直接转换16进制 &quot;\x00\x00\x00\x00\x00\x01&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit4，交易金额，直接转换16进制 &quot;\x00\x33\x94&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit11，交易流水号, 直接转换16进制 &quot;\x07\x10&quot;&nbsp; //bit22，服务点输入方式，原始数据为071，差一位，右补0 &quot;\x00\x11&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//bit23，原始数据011，差一位，左补0 &quot;\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit25，直接转16进制 &quot;\x12&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit26，直接转16进制 &quot;\xcd\xf4\x3e\xb3\xcb\x55\xb4\x1a\x25\x7c\x51\xc2\x6e\xae\xf8\x01&quot;&nbsp;&nbsp;&nbsp;&nbsp; //bit30，直接转16进制 &quot;\x32\xc4\x0e\x02\x19\xad\xac\x16\x01\x95\x34\x9a\x71\x27\xe1\x26\xf0&quot;//bit35，直接转16进制 &quot;\x30\x30\x30\x30\x30\x36\x32\x32&quot;&nbsp;&nbsp;&nbsp; //bit41，原始数据00000622，每个数字前加上数字3 &quot;\x38\x34\x33\x31\x30\x30\x30\x35\x34\x31\x31\x30\x30\x32\x33&quot;&nbsp; //bit42，原始数据843100054110023，每个数字前加上数字3 &quot;\x31\x35\x36&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit49，原始数据156，每个数字前加上数字3 &quot;\xd5\x11\x3d\x76\xf2\x8c\xe8\x05&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit62，直接转16进制 &quot;\x26\x10\x00\x00\x00\x00\x00\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit53，直接转16进制 &quot;\x01\x45\x9f\x26\x08\x29\xfa\xb2\xfe\x53\xaf\x9d\x5d\x9f\x27\x01\x80\x9f\x10\x13\x07\x00\x01\x03\xa0\x00\x00\x01\x0a\x01\x00\x00\x09\x81\x38\x2e\x42\x70\x76\x9f\x37\x04\xac\x8c\xbd\x61\x9f\x36\x02\x03\x6f\x95\x05\x00\x00\x00\x00\x00\x9a\x03\x16\x10\x19\x9c\x01\x00\x9f\x02\x06\x00\x00\x00\x00\x00\x01\x5f\x2a\x02\x01\x56\x82\x02\x7c\x00\x9f\x1a\x02\x01\x56\x9f\x03\x06\x00\x00\x00\x00\x00\x00\x9f\x33\x03\xe0\xe1\xc8\x9f\x34\x03\x00\x00\x00\x9f\x35\x01\x22\x9f\x1e\x08\x30\x31\x33\x30\x30\x30\x36\x35\x84\x08\xa0\x00\x00\x03\x33\x01\x01\x01\x9f\x09\x02\x00\x30\x9f\x41\x04\x00\x00\x11\x94&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit55，直接转16进制 &quot;\x00\x14\x22\x00\x00\x30\x00\x06\x01&quot;&nbsp;&nbsp;&nbsp;//bit60，原始数据，22000030000601（14位长度），前面加0014标示数据长度 &quot;\x34\x37\x39\x34\x35\x35\x34\x36&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit64，直接转16进制 &nbsp; 二：loadrunner脚本开发及数据塞入： ①：测试协议选择： Ø&nbsp; &nbsp;开发测试脚本选择Windowssocets协议 Ø&nbsp; vuser_init、vuser_end部分默认，不用更改，代码默认，主要在Action中开发测试脚本和在data.ws中传输数据到Action的代码中，具体操作如下： Ø&nbsp; &nbsp; ②：Action中编写socket性能测试脚本： 脚本减少逻辑换算，比如脚本中勿用对返回值的判断（直接后端服务器判断数据正确性或数据库验证数据正确性），比如十六进制的参数化在数据参数化中使用转义字符完成，无需额外写代码处理，最简代码如下： &nbsp; #include&quot;lrs.h&quot; Action() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_startup(257);&nbsp;&nbsp;&nbsp;&nbsp; //初始化 Windows Sockets DLL &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_create_socket(&quot;socket0&quot;,&quot;TCP&quot;, &quot;RemoteHost=192.180.80.87:6667&quot;, LrsLastArg);//创建连接目标服务器ip及端口 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_rendezvous(&quot;联机消费&quot;);//设置集合点 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_start_transaction(&quot;联机消费&quot;);//设置事物开始 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_send(&quot;socket0&quot;,&quot;buf0&quot;,LrsLastArg); //把数据塞入buf0中，发送data.ws中的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_receive (&quot;socket0&quot;,&quot;buf1&quot;,LrsLastArg);//接受服务器返回的数据 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_end_transaction(&quot;联机消费&quot;, LR_AUTO);//事物结束 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_close_socket(&quot;socket0&quot;);//关闭连接 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_cleanup(); //终止Windows套接字 DLL 的使用 &nbsp; &nbsp;&nbsp;&nbsp; return 0; } &nbsp; &nbsp; ③：data.ws中做传输数据处理： 把处理好的16进制的报文放入data.ws中，格式如下： &nbsp; ;WSRData2 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send buf0 287 // 发送给buf0的数据长度。 &nbsp; &quot;\x01\x1F&quot;//报文长度，必须加上，否则报文无法发送成功 &quot;\x60\x00\x04\x00\x00&quot; &quot;\x60\x31\x00\x31\x13\x06&quot; &quot;\x02\x00&quot; &quot;\x70\x20\x06\xc4\x20\xc0\x9a\x11&quot; &quot;\x16\x62\x14\x44\x10\x00\x01\x01\x11&quot;//16位卡号，前面加16 &quot;\x00\x00\x00&quot; &quot;\x00\x00\x00\x00\x00\x01&quot; &quot;\x01\x00\x08&quot;//交易流水号，每个交易流水号不能重复，须参数化 &quot;\x07\x10&quot; &quot;\x00\x11&quot; &quot;\x00&quot; &quot;\x12&quot; &quot;\xcd\xf4\x3e\xb3\xcb\x55\xb4\x1a\x25\x7c\x51\xc2\x6e\xae\xf8\x01&quot; &quot;\x32\xc4\x0e\x02\x19\xad\xac\x16\x01\x95\x34\x9a\x71\x27\xe1\x26\xf0&quot; &quot;\x30\x30\x30\x30\x30\x36\x32\x32&quot; &quot;\x38\x34\x33\x31\x30\x30\x30\x35\x34\x31\x31\x30\x30\x32\x33&quot; &quot;\x31\x35\x36&quot; &quot;\xd5\x11\x3d\x76\xf2\x8c\xe8\x05&quot; &quot;\x26\x10\x00\x00\x00\x00\x00\x00&quot; &quot;\x01\x45\x9f\x26\x08\x29\xfa\xb2\xfe\x53\xaf\x9d\x5d\x9f\x27\x01\x80\x9f\x10\x13\x07\x00\x01\x03\xa0\x00\x00\x01\x0a\x01\x00\x00\x09\x81\x38\x2e\x42\x70\x76\x9f\x37\x04\xac\x8c\xbd\x61\x9f\x36\x02\x03\x6f\x95\x05\x00\x00\x00\x00\x00\x9a\x03\x16\x10\x19\x9c\x01\x00\x9f\x02\x06\x00\x00\x00\x00\x00\x01\x5f\x2a\x02\x01\x56\x82\x02\x7c\x00\x9f\x1a\x02\x01\x56\x9f\x03\x06\x00\x00\x00\x00\x00\x00\x9f\x33\x03\xe0\xe1\xc8\x9f\x34\x03\x00\x00\x00\x9f\x35\x01\x22\x9f\x1e\x08\x30\x31\x33\x30\x30\x30\x36\x35\x84\x08\xa0\x00\x00\x03\x33\x01\x01\x01\x9f\x09\x02\x00\x30\x9f\x41\x04\x00\x00\x11\x94&quot; &quot;\x00\x14\x22\x00\x00\x30\x00\x06\x01&quot; &quot;\x34\x37\x39\x34\x35\x35\x34\x36&quot; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recv buf1 303 //经过验证，返回的数据无需正确也能够正常跑通脚本 -1 &nbsp; 如图验证调试脚本返回信息正确： 如图验证数据库交易数据正确： 脚本调试成功，根据具测试策略，进行加压并监控整个业务的（响应时间、TPS、加密机性能、支付服务器性能、应用服务器性能、oracle服务器性能等...） 经过压测，本系统存在3个性能问题： 1.increasemaxThreads问题（已优化解决） 2.加密机数据丢包问题（已优化解决）） 3.sql执行超时，无法响应问题（未来两年内生产用户大不了压测出问题时候的并发数，处理优先级降低） 以上问题的定位调优另外单独整理总结，详细信息可见“性能问题总结及经验汇总.docx”文档 &nbsp; 阅读更多" />
<meta property="og:description" content="本交易为POS消费交易，报文类型为8583通讯报文，一般在银联通讯方面，金融交易方面用的比较多，如下为手动编写我们的测试脚本，并非录制而成，在此类直接与接口交互的性能测试项目中，经常会用到报文组装、拼接等工作，这里记录想整个数据的解析拼装过程以及我们测试思路 一：pos交易（8583协议）报文处理部分： 必须熟悉不同交易每个域的划分及每个域的数据长度，具体详细报文结构不做具体描述，每个报文有其具体规则，解析出每个域的数据 如下报文全部调试成功，另外需要对卡号，交易金额，流水号等数据进行处理，需要对MAC校验进行额外处理，具体不详述 ①：发送报文获取： Ø&nbsp; 获取到POS机消费报文，我这里每个域使用不同颜色区分开来（部分数据涉及公司私密，已做小部分更改，不过不影响报文的分析及阅读）： 011F60000400006031003113060200702006c420c09a11166214441000010111000000000000000001003394071000110012cdf43eb3cb55b41a257c51c26eaef80138jnehnd98adac160195349a7127e126f03030303030363232383433313030303534313130303233313536d8uejeiuw28ce80526100000000000000983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f4104000011940014220000300006013437393435353436 注：在这里每个域区分开来后，就可以直接把每个域的数据提取出来，在Loadrunner中进行16进制转换。 ②：报文解析（解析出每个域的数据）： Ø&nbsp; 对上面的报文进行bitmap解析（使用bitmap工具解析每个域数据），上面消费报文解析出的每个域的数据如下所示： 报文长度：011F TPDU：&nbsp;&nbsp;&nbsp; 6000040000 报文头：&nbsp; 603100311306 MSGID：&nbsp;&nbsp; 0200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --消息类型，0200指消费交易 BITMAP：&nbsp; 702006c420c09a11&nbsp; --位图，确认后面所有使用的域，记录哪些域会出现在报文中 Bit 2：&nbsp;&nbsp; 6214441000010111&nbsp;&nbsp; --主账号 Bit 3：&nbsp;&nbsp; 000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --处理代码，交易类型，000000代表消费，n6 Bit 4：&nbsp;&nbsp; 000000000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --交易金额，单位为分，n12 Bit 11：&nbsp; 003394&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --交易流水号，n6 Bit 22：&nbsp; 071&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --服务器输入方式&nbsp;&nbsp; ，n3 Bit 23：&nbsp; 011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --卡顺序号，n3 Bit 25：&nbsp; 00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --服务点条件码，n2 Bit 26：&nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --售卡方业务代码， Bit 30：&nbsp; cdf43eb3cb55b41a257c51c26eaef801 --原始金额，n24 Bit 35：&nbsp; 38jnehnd98adac160195349a7127e126f0--第2磁道数据，z37 Bit 41：&nbsp; 00000622&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --终端代码，ANS8 Bit 42：&nbsp; 843100054110023&nbsp;&nbsp;&nbsp; --终端标示，ANS15 Bit 49：&nbsp; 156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --货币代码，n3,156为人民币 Bit 52：&nbsp; d8uejeiuw28ce805--用户密码（PIN Data），B64 Bit 53：&nbsp; 2610000000000000&nbsp;&nbsp; --安全控制信息，n16 Bit 55： 0983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f410400001194 --IC卡数据域 Bit 60：&nbsp; 22000030000601&nbsp;&nbsp; --附加数据，自定义域 Bit 64：&nbsp;3437393435353436&nbsp;&nbsp;&nbsp;&nbsp; --报文鉴别代码字段 &nbsp; &nbsp; ③：报文解析后对报文进行16进制转换处理（域位数不够需要注意域的左对齐右对齐以及左补0右补0）： Ø&nbsp; 因为loadrunner中需要识别16进制的数据进行socket报文发送，所以需要把如上消费报文转换为16进制进行发送，发送16进制格式为：每两位前面加转义符“\x”来代表16进制，上面消费报文转换后的16进制报文如下（每个域加上双引号且换行）： &quot;\x01\x1F&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//报文长度，必须加上，否则报文无法发送成功 &quot;\x60\x00\x04\x00\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //TPDU &quot;\x60\x31\x00\x31\x13\x06&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //报文头 &quot;\x02\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //MSGID，指余额查询、消费等 &quot;\x70\x20\x06\xc4\x20\xc0\x9a\x11&quot;//bitmap：确认后面报文使用的域 &quot;\x16\x62\x14\x44\x10\x00\x01\x01\x11&quot;//bit2，主账号16位卡号，前面加长度16 &quot;\x00\x00\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit3，处理码，直接转换16进制 &quot;\x00\x00\x00\x00\x00\x01&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit4，交易金额，直接转换16进制 &quot;\x00\x33\x94&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit11，交易流水号, 直接转换16进制 &quot;\x07\x10&quot;&nbsp; //bit22，服务点输入方式，原始数据为071，差一位，右补0 &quot;\x00\x11&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//bit23，原始数据011，差一位，左补0 &quot;\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit25，直接转16进制 &quot;\x12&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit26，直接转16进制 &quot;\xcd\xf4\x3e\xb3\xcb\x55\xb4\x1a\x25\x7c\x51\xc2\x6e\xae\xf8\x01&quot;&nbsp;&nbsp;&nbsp;&nbsp; //bit30，直接转16进制 &quot;\x32\xc4\x0e\x02\x19\xad\xac\x16\x01\x95\x34\x9a\x71\x27\xe1\x26\xf0&quot;//bit35，直接转16进制 &quot;\x30\x30\x30\x30\x30\x36\x32\x32&quot;&nbsp;&nbsp;&nbsp; //bit41，原始数据00000622，每个数字前加上数字3 &quot;\x38\x34\x33\x31\x30\x30\x30\x35\x34\x31\x31\x30\x30\x32\x33&quot;&nbsp; //bit42，原始数据843100054110023，每个数字前加上数字3 &quot;\x31\x35\x36&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit49，原始数据156，每个数字前加上数字3 &quot;\xd5\x11\x3d\x76\xf2\x8c\xe8\x05&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit62，直接转16进制 &quot;\x26\x10\x00\x00\x00\x00\x00\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit53，直接转16进制 &quot;\x01\x45\x9f\x26\x08\x29\xfa\xb2\xfe\x53\xaf\x9d\x5d\x9f\x27\x01\x80\x9f\x10\x13\x07\x00\x01\x03\xa0\x00\x00\x01\x0a\x01\x00\x00\x09\x81\x38\x2e\x42\x70\x76\x9f\x37\x04\xac\x8c\xbd\x61\x9f\x36\x02\x03\x6f\x95\x05\x00\x00\x00\x00\x00\x9a\x03\x16\x10\x19\x9c\x01\x00\x9f\x02\x06\x00\x00\x00\x00\x00\x01\x5f\x2a\x02\x01\x56\x82\x02\x7c\x00\x9f\x1a\x02\x01\x56\x9f\x03\x06\x00\x00\x00\x00\x00\x00\x9f\x33\x03\xe0\xe1\xc8\x9f\x34\x03\x00\x00\x00\x9f\x35\x01\x22\x9f\x1e\x08\x30\x31\x33\x30\x30\x30\x36\x35\x84\x08\xa0\x00\x00\x03\x33\x01\x01\x01\x9f\x09\x02\x00\x30\x9f\x41\x04\x00\x00\x11\x94&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit55，直接转16进制 &quot;\x00\x14\x22\x00\x00\x30\x00\x06\x01&quot;&nbsp;&nbsp;&nbsp;//bit60，原始数据，22000030000601（14位长度），前面加0014标示数据长度 &quot;\x34\x37\x39\x34\x35\x35\x34\x36&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit64，直接转16进制 &nbsp; 二：loadrunner脚本开发及数据塞入： ①：测试协议选择： Ø&nbsp; &nbsp;开发测试脚本选择Windowssocets协议 Ø&nbsp; vuser_init、vuser_end部分默认，不用更改，代码默认，主要在Action中开发测试脚本和在data.ws中传输数据到Action的代码中，具体操作如下： Ø&nbsp; &nbsp; ②：Action中编写socket性能测试脚本： 脚本减少逻辑换算，比如脚本中勿用对返回值的判断（直接后端服务器判断数据正确性或数据库验证数据正确性），比如十六进制的参数化在数据参数化中使用转义字符完成，无需额外写代码处理，最简代码如下： &nbsp; #include&quot;lrs.h&quot; Action() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_startup(257);&nbsp;&nbsp;&nbsp;&nbsp; //初始化 Windows Sockets DLL &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_create_socket(&quot;socket0&quot;,&quot;TCP&quot;, &quot;RemoteHost=192.180.80.87:6667&quot;, LrsLastArg);//创建连接目标服务器ip及端口 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_rendezvous(&quot;联机消费&quot;);//设置集合点 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_start_transaction(&quot;联机消费&quot;);//设置事物开始 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_send(&quot;socket0&quot;,&quot;buf0&quot;,LrsLastArg); //把数据塞入buf0中，发送data.ws中的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_receive (&quot;socket0&quot;,&quot;buf1&quot;,LrsLastArg);//接受服务器返回的数据 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_end_transaction(&quot;联机消费&quot;, LR_AUTO);//事物结束 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_close_socket(&quot;socket0&quot;);//关闭连接 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_cleanup(); //终止Windows套接字 DLL 的使用 &nbsp; &nbsp;&nbsp;&nbsp; return 0; } &nbsp; &nbsp; ③：data.ws中做传输数据处理： 把处理好的16进制的报文放入data.ws中，格式如下： &nbsp; ;WSRData2 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send buf0 287 // 发送给buf0的数据长度。 &nbsp; &quot;\x01\x1F&quot;//报文长度，必须加上，否则报文无法发送成功 &quot;\x60\x00\x04\x00\x00&quot; &quot;\x60\x31\x00\x31\x13\x06&quot; &quot;\x02\x00&quot; &quot;\x70\x20\x06\xc4\x20\xc0\x9a\x11&quot; &quot;\x16\x62\x14\x44\x10\x00\x01\x01\x11&quot;//16位卡号，前面加16 &quot;\x00\x00\x00&quot; &quot;\x00\x00\x00\x00\x00\x01&quot; &quot;\x01\x00\x08&quot;//交易流水号，每个交易流水号不能重复，须参数化 &quot;\x07\x10&quot; &quot;\x00\x11&quot; &quot;\x00&quot; &quot;\x12&quot; &quot;\xcd\xf4\x3e\xb3\xcb\x55\xb4\x1a\x25\x7c\x51\xc2\x6e\xae\xf8\x01&quot; &quot;\x32\xc4\x0e\x02\x19\xad\xac\x16\x01\x95\x34\x9a\x71\x27\xe1\x26\xf0&quot; &quot;\x30\x30\x30\x30\x30\x36\x32\x32&quot; &quot;\x38\x34\x33\x31\x30\x30\x30\x35\x34\x31\x31\x30\x30\x32\x33&quot; &quot;\x31\x35\x36&quot; &quot;\xd5\x11\x3d\x76\xf2\x8c\xe8\x05&quot; &quot;\x26\x10\x00\x00\x00\x00\x00\x00&quot; &quot;\x01\x45\x9f\x26\x08\x29\xfa\xb2\xfe\x53\xaf\x9d\x5d\x9f\x27\x01\x80\x9f\x10\x13\x07\x00\x01\x03\xa0\x00\x00\x01\x0a\x01\x00\x00\x09\x81\x38\x2e\x42\x70\x76\x9f\x37\x04\xac\x8c\xbd\x61\x9f\x36\x02\x03\x6f\x95\x05\x00\x00\x00\x00\x00\x9a\x03\x16\x10\x19\x9c\x01\x00\x9f\x02\x06\x00\x00\x00\x00\x00\x01\x5f\x2a\x02\x01\x56\x82\x02\x7c\x00\x9f\x1a\x02\x01\x56\x9f\x03\x06\x00\x00\x00\x00\x00\x00\x9f\x33\x03\xe0\xe1\xc8\x9f\x34\x03\x00\x00\x00\x9f\x35\x01\x22\x9f\x1e\x08\x30\x31\x33\x30\x30\x30\x36\x35\x84\x08\xa0\x00\x00\x03\x33\x01\x01\x01\x9f\x09\x02\x00\x30\x9f\x41\x04\x00\x00\x11\x94&quot; &quot;\x00\x14\x22\x00\x00\x30\x00\x06\x01&quot; &quot;\x34\x37\x39\x34\x35\x35\x34\x36&quot; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recv buf1 303 //经过验证，返回的数据无需正确也能够正常跑通脚本 -1 &nbsp; 如图验证调试脚本返回信息正确： 如图验证数据库交易数据正确： 脚本调试成功，根据具测试策略，进行加压并监控整个业务的（响应时间、TPS、加密机性能、支付服务器性能、应用服务器性能、oracle服务器性能等...） 经过压测，本系统存在3个性能问题： 1.increasemaxThreads问题（已优化解决） 2.加密机数据丢包问题（已优化解决）） 3.sql执行超时，无法响应问题（未来两年内生产用户大不了压测出问题时候的并发数，处理优先级降低） 以上问题的定位调优另外单独整理总结，详细信息可见“性能问题总结及经验汇总.docx”文档 &nbsp; 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-11-03T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"本交易为POS消费交易，报文类型为8583通讯报文，一般在银联通讯方面，金融交易方面用的比较多，如下为手动编写我们的测试脚本，并非录制而成，在此类直接与接口交互的性能测试项目中，经常会用到报文组装、拼接等工作，这里记录想整个数据的解析拼装过程以及我们测试思路 一：pos交易（8583协议）报文处理部分： 必须熟悉不同交易每个域的划分及每个域的数据长度，具体详细报文结构不做具体描述，每个报文有其具体规则，解析出每个域的数据 如下报文全部调试成功，另外需要对卡号，交易金额，流水号等数据进行处理，需要对MAC校验进行额外处理，具体不详述 ①：发送报文获取： Ø&nbsp; 获取到POS机消费报文，我这里每个域使用不同颜色区分开来（部分数据涉及公司私密，已做小部分更改，不过不影响报文的分析及阅读）： 011F60000400006031003113060200702006c420c09a11166214441000010111000000000000000001003394071000110012cdf43eb3cb55b41a257c51c26eaef80138jnehnd98adac160195349a7127e126f03030303030363232383433313030303534313130303233313536d8uejeiuw28ce80526100000000000000983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f4104000011940014220000300006013437393435353436 注：在这里每个域区分开来后，就可以直接把每个域的数据提取出来，在Loadrunner中进行16进制转换。 ②：报文解析（解析出每个域的数据）： Ø&nbsp; 对上面的报文进行bitmap解析（使用bitmap工具解析每个域数据），上面消费报文解析出的每个域的数据如下所示： 报文长度：011F TPDU：&nbsp;&nbsp;&nbsp; 6000040000 报文头：&nbsp; 603100311306 MSGID：&nbsp;&nbsp; 0200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --消息类型，0200指消费交易 BITMAP：&nbsp; 702006c420c09a11&nbsp; --位图，确认后面所有使用的域，记录哪些域会出现在报文中 Bit 2：&nbsp;&nbsp; 6214441000010111&nbsp;&nbsp; --主账号 Bit 3：&nbsp;&nbsp; 000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --处理代码，交易类型，000000代表消费，n6 Bit 4：&nbsp;&nbsp; 000000000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --交易金额，单位为分，n12 Bit 11：&nbsp; 003394&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --交易流水号，n6 Bit 22：&nbsp; 071&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --服务器输入方式&nbsp;&nbsp; ，n3 Bit 23：&nbsp; 011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --卡顺序号，n3 Bit 25：&nbsp; 00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --服务点条件码，n2 Bit 26：&nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --售卡方业务代码， Bit 30：&nbsp; cdf43eb3cb55b41a257c51c26eaef801 --原始金额，n24 Bit 35：&nbsp; 38jnehnd98adac160195349a7127e126f0--第2磁道数据，z37 Bit 41：&nbsp; 00000622&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --终端代码，ANS8 Bit 42：&nbsp; 843100054110023&nbsp;&nbsp;&nbsp; --终端标示，ANS15 Bit 49：&nbsp; 156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --货币代码，n3,156为人民币 Bit 52：&nbsp; d8uejeiuw28ce805--用户密码（PIN Data），B64 Bit 53：&nbsp; 2610000000000000&nbsp;&nbsp; --安全控制信息，n16 Bit 55： 0983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f410400001194 --IC卡数据域 Bit 60：&nbsp; 22000030000601&nbsp;&nbsp; --附加数据，自定义域 Bit 64：&nbsp;3437393435353436&nbsp;&nbsp;&nbsp;&nbsp; --报文鉴别代码字段 &nbsp; &nbsp; ③：报文解析后对报文进行16进制转换处理（域位数不够需要注意域的左对齐右对齐以及左补0右补0）： Ø&nbsp; 因为loadrunner中需要识别16进制的数据进行socket报文发送，所以需要把如上消费报文转换为16进制进行发送，发送16进制格式为：每两位前面加转义符“\\x”来代表16进制，上面消费报文转换后的16进制报文如下（每个域加上双引号且换行）： &quot;\\x01\\x1F&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//报文长度，必须加上，否则报文无法发送成功 &quot;\\x60\\x00\\x04\\x00\\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //TPDU &quot;\\x60\\x31\\x00\\x31\\x13\\x06&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //报文头 &quot;\\x02\\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //MSGID，指余额查询、消费等 &quot;\\x70\\x20\\x06\\xc4\\x20\\xc0\\x9a\\x11&quot;//bitmap：确认后面报文使用的域 &quot;\\x16\\x62\\x14\\x44\\x10\\x00\\x01\\x01\\x11&quot;//bit2，主账号16位卡号，前面加长度16 &quot;\\x00\\x00\\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit3，处理码，直接转换16进制 &quot;\\x00\\x00\\x00\\x00\\x00\\x01&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit4，交易金额，直接转换16进制 &quot;\\x00\\x33\\x94&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit11，交易流水号, 直接转换16进制 &quot;\\x07\\x10&quot;&nbsp; //bit22，服务点输入方式，原始数据为071，差一位，右补0 &quot;\\x00\\x11&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//bit23，原始数据011，差一位，左补0 &quot;\\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit25，直接转16进制 &quot;\\x12&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit26，直接转16进制 &quot;\\xcd\\xf4\\x3e\\xb3\\xcb\\x55\\xb4\\x1a\\x25\\x7c\\x51\\xc2\\x6e\\xae\\xf8\\x01&quot;&nbsp;&nbsp;&nbsp;&nbsp; //bit30，直接转16进制 &quot;\\x32\\xc4\\x0e\\x02\\x19\\xad\\xac\\x16\\x01\\x95\\x34\\x9a\\x71\\x27\\xe1\\x26\\xf0&quot;//bit35，直接转16进制 &quot;\\x30\\x30\\x30\\x30\\x30\\x36\\x32\\x32&quot;&nbsp;&nbsp;&nbsp; //bit41，原始数据00000622，每个数字前加上数字3 &quot;\\x38\\x34\\x33\\x31\\x30\\x30\\x30\\x35\\x34\\x31\\x31\\x30\\x30\\x32\\x33&quot;&nbsp; //bit42，原始数据843100054110023，每个数字前加上数字3 &quot;\\x31\\x35\\x36&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit49，原始数据156，每个数字前加上数字3 &quot;\\xd5\\x11\\x3d\\x76\\xf2\\x8c\\xe8\\x05&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit62，直接转16进制 &quot;\\x26\\x10\\x00\\x00\\x00\\x00\\x00\\x00&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit53，直接转16进制 &quot;\\x01\\x45\\x9f\\x26\\x08\\x29\\xfa\\xb2\\xfe\\x53\\xaf\\x9d\\x5d\\x9f\\x27\\x01\\x80\\x9f\\x10\\x13\\x07\\x00\\x01\\x03\\xa0\\x00\\x00\\x01\\x0a\\x01\\x00\\x00\\x09\\x81\\x38\\x2e\\x42\\x70\\x76\\x9f\\x37\\x04\\xac\\x8c\\xbd\\x61\\x9f\\x36\\x02\\x03\\x6f\\x95\\x05\\x00\\x00\\x00\\x00\\x00\\x9a\\x03\\x16\\x10\\x19\\x9c\\x01\\x00\\x9f\\x02\\x06\\x00\\x00\\x00\\x00\\x00\\x01\\x5f\\x2a\\x02\\x01\\x56\\x82\\x02\\x7c\\x00\\x9f\\x1a\\x02\\x01\\x56\\x9f\\x03\\x06\\x00\\x00\\x00\\x00\\x00\\x00\\x9f\\x33\\x03\\xe0\\xe1\\xc8\\x9f\\x34\\x03\\x00\\x00\\x00\\x9f\\x35\\x01\\x22\\x9f\\x1e\\x08\\x30\\x31\\x33\\x30\\x30\\x30\\x36\\x35\\x84\\x08\\xa0\\x00\\x00\\x03\\x33\\x01\\x01\\x01\\x9f\\x09\\x02\\x00\\x30\\x9f\\x41\\x04\\x00\\x00\\x11\\x94&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit55，直接转16进制 &quot;\\x00\\x14\\x22\\x00\\x00\\x30\\x00\\x06\\x01&quot;&nbsp;&nbsp;&nbsp;//bit60，原始数据，22000030000601（14位长度），前面加0014标示数据长度 &quot;\\x34\\x37\\x39\\x34\\x35\\x35\\x34\\x36&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit64，直接转16进制 &nbsp; 二：loadrunner脚本开发及数据塞入： ①：测试协议选择： Ø&nbsp; &nbsp;开发测试脚本选择Windowssocets协议 Ø&nbsp; vuser_init、vuser_end部分默认，不用更改，代码默认，主要在Action中开发测试脚本和在data.ws中传输数据到Action的代码中，具体操作如下： Ø&nbsp; &nbsp; ②：Action中编写socket性能测试脚本： 脚本减少逻辑换算，比如脚本中勿用对返回值的判断（直接后端服务器判断数据正确性或数据库验证数据正确性），比如十六进制的参数化在数据参数化中使用转义字符完成，无需额外写代码处理，最简代码如下： &nbsp; #include&quot;lrs.h&quot; Action() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_startup(257);&nbsp;&nbsp;&nbsp;&nbsp; //初始化 Windows Sockets DLL &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_create_socket(&quot;socket0&quot;,&quot;TCP&quot;, &quot;RemoteHost=192.180.80.87:6667&quot;, LrsLastArg);//创建连接目标服务器ip及端口 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_rendezvous(&quot;联机消费&quot;);//设置集合点 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_start_transaction(&quot;联机消费&quot;);//设置事物开始 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_send(&quot;socket0&quot;,&quot;buf0&quot;,LrsLastArg); //把数据塞入buf0中，发送data.ws中的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_receive (&quot;socket0&quot;,&quot;buf1&quot;,LrsLastArg);//接受服务器返回的数据 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_end_transaction(&quot;联机消费&quot;, LR_AUTO);//事物结束 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_close_socket(&quot;socket0&quot;);//关闭连接 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_cleanup(); //终止Windows套接字 DLL 的使用 &nbsp; &nbsp;&nbsp;&nbsp; return 0; } &nbsp; &nbsp; ③：data.ws中做传输数据处理： 把处理好的16进制的报文放入data.ws中，格式如下： &nbsp; ;WSRData2 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send buf0 287 // 发送给buf0的数据长度。 &nbsp; &quot;\\x01\\x1F&quot;//报文长度，必须加上，否则报文无法发送成功 &quot;\\x60\\x00\\x04\\x00\\x00&quot; &quot;\\x60\\x31\\x00\\x31\\x13\\x06&quot; &quot;\\x02\\x00&quot; &quot;\\x70\\x20\\x06\\xc4\\x20\\xc0\\x9a\\x11&quot; &quot;\\x16\\x62\\x14\\x44\\x10\\x00\\x01\\x01\\x11&quot;//16位卡号，前面加16 &quot;\\x00\\x00\\x00&quot; &quot;\\x00\\x00\\x00\\x00\\x00\\x01&quot; &quot;\\x01\\x00\\x08&quot;//交易流水号，每个交易流水号不能重复，须参数化 &quot;\\x07\\x10&quot; &quot;\\x00\\x11&quot; &quot;\\x00&quot; &quot;\\x12&quot; &quot;\\xcd\\xf4\\x3e\\xb3\\xcb\\x55\\xb4\\x1a\\x25\\x7c\\x51\\xc2\\x6e\\xae\\xf8\\x01&quot; &quot;\\x32\\xc4\\x0e\\x02\\x19\\xad\\xac\\x16\\x01\\x95\\x34\\x9a\\x71\\x27\\xe1\\x26\\xf0&quot; &quot;\\x30\\x30\\x30\\x30\\x30\\x36\\x32\\x32&quot; &quot;\\x38\\x34\\x33\\x31\\x30\\x30\\x30\\x35\\x34\\x31\\x31\\x30\\x30\\x32\\x33&quot; &quot;\\x31\\x35\\x36&quot; &quot;\\xd5\\x11\\x3d\\x76\\xf2\\x8c\\xe8\\x05&quot; &quot;\\x26\\x10\\x00\\x00\\x00\\x00\\x00\\x00&quot; &quot;\\x01\\x45\\x9f\\x26\\x08\\x29\\xfa\\xb2\\xfe\\x53\\xaf\\x9d\\x5d\\x9f\\x27\\x01\\x80\\x9f\\x10\\x13\\x07\\x00\\x01\\x03\\xa0\\x00\\x00\\x01\\x0a\\x01\\x00\\x00\\x09\\x81\\x38\\x2e\\x42\\x70\\x76\\x9f\\x37\\x04\\xac\\x8c\\xbd\\x61\\x9f\\x36\\x02\\x03\\x6f\\x95\\x05\\x00\\x00\\x00\\x00\\x00\\x9a\\x03\\x16\\x10\\x19\\x9c\\x01\\x00\\x9f\\x02\\x06\\x00\\x00\\x00\\x00\\x00\\x01\\x5f\\x2a\\x02\\x01\\x56\\x82\\x02\\x7c\\x00\\x9f\\x1a\\x02\\x01\\x56\\x9f\\x03\\x06\\x00\\x00\\x00\\x00\\x00\\x00\\x9f\\x33\\x03\\xe0\\xe1\\xc8\\x9f\\x34\\x03\\x00\\x00\\x00\\x9f\\x35\\x01\\x22\\x9f\\x1e\\x08\\x30\\x31\\x33\\x30\\x30\\x30\\x36\\x35\\x84\\x08\\xa0\\x00\\x00\\x03\\x33\\x01\\x01\\x01\\x9f\\x09\\x02\\x00\\x30\\x9f\\x41\\x04\\x00\\x00\\x11\\x94&quot; &quot;\\x00\\x14\\x22\\x00\\x00\\x30\\x00\\x06\\x01&quot; &quot;\\x34\\x37\\x39\\x34\\x35\\x35\\x34\\x36&quot; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recv buf1 303 //经过验证，返回的数据无需正确也能够正常跑通脚本 -1 &nbsp; 如图验证调试脚本返回信息正确： 如图验证数据库交易数据正确： 脚本调试成功，根据具测试策略，进行加压并监控整个业务的（响应时间、TPS、加密机性能、支付服务器性能、应用服务器性能、oracle服务器性能等...） 经过压测，本系统存在3个性能问题： 1.increasemaxThreads问题（已优化解决） 2.加密机数据丢包问题（已优化解决）） 3.sql执行超时，无法响应问题（未来两年内生产用户大不了压测出问题时候的并发数，处理优先级降低） 以上问题的定位调优另外单独整理总结，详细信息可见“性能问题总结及经验汇总.docx”文档 &nbsp; 阅读更多","@type":"BlogPosting","url":"/2016/11/03/413dbe199aaf5ec97410ee72953a6126.html","headline":"Socket协议Loadrunner脚本+8583报文解析及组装","dateModified":"2016-11-03T00:00:00+08:00","datePublished":"2016-11-03T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2016/11/03/413dbe199aaf5ec97410ee72953a6126.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Socket协议Loadrunner脚本+8583报文解析及组装</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><strong>本交易为POS消费交易，报文类型为8583通讯报文，一般在银联通讯方面，金融交易方面用的比较多，如下为手动编写我们的测试脚本，并非录制而成，在此类直接与接口交互的性能测试项目中，经常会用到报文组装、拼接等工作，这里记录想整个数据的解析拼装过程以及我们测试思路</strong></p> 
  <p><strong>一：pos交易（8583协议）报文处理部分：</strong></p> 
  <p><strong>必须熟悉不同交易每个域的划分及每个域的数据长度，具体详细报文结构不做具体描述，每个报文有其具体规则，解析出每个域的数据</strong></p> 
  <p><strong>如下报文全部调试成功，另外需要对卡号，交易金额，流水号等数据进行处理，需要对MAC校验进行额外处理，具体不详述</strong></p> 
  <p><strong>①：发送报文获取：</strong></p> 
  <p>Ø&nbsp; 获取到POS机消费报文，我这里每个域使用不同颜色区分开来<strong>（部分数据涉及公司私密，已做小部分更改，不过不影响报文的分析及阅读）：</strong></p> 
  <p><span style="background:#FFFF00;">011F</span><span style="background:#00FFFF;">6000040000</span><span style="background:#FF00FF;">603100311306</span><span style="background:#0000FF;">0200</span><span style="background:#808080;">702006c420c09a11</span><span style="background:#800080;">16</span><span style="background:#00FFFF;">6214441000010111</span><span style="background:#FF00FF;">000000</span><span style="background:#0000FF;">000000000001</span><span style="background:#FF00FF;">003394</span><span style="background:#FFFF00;">0710</span><span style="background:#00FFFF;">0011</span><span style="background:#FF0000;">00</span><span style="background:#0000FF;">12</span><span style="background:#FF00FF;">cdf43eb3cb55b41a257c51c26eaef801</span><span style="background:#0000FF;">38jnehnd98adac160195349a7127e126f0</span><span style="background:#00FFFF;">3030303030363232</span><span style="background:#0000FF;">383433313030303534313130303233</span><span style="background:#808080;">313536</span><span style="background:#FF00FF;">d8uejeiuw28ce805</span><span style="background-color:rgb(255,255,0);">2610000000000000</span><span style="background:#008080;">0983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f410400001194</span><span style="background:#00FFFF;">001422000030000601</span><span style="background:#FFFF00;">3437393435353436</span></p> 
  <p>注：在这里每个域区分开来后，就可以直接把每个域的数据提取出来，在Loadrunner中进行16进制转换。</p> 
  <p><strong>②：报文解析（解析出每个域的数据）：</strong></p> 
  <p>Ø&nbsp; 对上面的报文进行bitmap解析（使用bitmap工具解析每个域数据），上面消费报文解析出的每个域的数据如下所示：</p> 
  <p align="left"><span style="background:#00FF00;">报文长度：</span><span style="background:#00FF00;">011F</span></p> 
  <p align="left"><span style="background:#00FF00;">TPDU</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp; 6000040000</span></p> 
  <p align="left"><span style="background:#00FF00;">报文头：</span><span style="background:#00FF00;">&nbsp; 603100311306</span></p> 
  <p align="left"><span style="background:#00FF00;">MSGID</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp;&nbsp; 0200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">消息类型，</span><span style="background:#00FF00;">0200</span><span style="background:#00FF00;">指消费交易</span></p> 
  <p align="left"><span style="background:#00FF00;">BITMAP</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 702006c420c09a11&nbsp; --</span><span style="background:#00FF00;">位图，确认后面所有使用的域，记录哪些域会出现在报文中</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 2</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp;&nbsp; 6214441000010111&nbsp;&nbsp; --</span><span style="background:#00FF00;">主账号</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 3</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp;&nbsp; 000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">处理代码，交易类型，</span><span style="background:#00FF00;">000000</span><span style="background:#00FF00;">代表消费，</span><span style="background:#00FF00;">n6</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 4</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp;&nbsp; 000000000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">交易金额，单位为分，</span><span style="background:#00FF00;">n12</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 11</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 003394&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">交易流水号，</span><span style="background:#00FF00;">n6</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 22</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 071&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">服务器输入方式</span><span style="background:#00FF00;">&nbsp;&nbsp; </span><span style="background:#00FF00;">，</span><span style="background:#00FF00;">n3</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 23</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">卡顺序号，</span><span style="background:#00FF00;">n3</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 25</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">服务点条件码，</span><span style="background:#00FF00;">n2</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 26</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">售卡方业务代码，</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 30</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; cdf43eb3cb55b41a257c51c26eaef801 --</span><span style="background:#00FF00;">原始金额，</span><span style="background:#00FF00;">n24</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 35</span><span style="background:#00FF00;">：</span><span><span style="background-color:rgb(51,255,51);">&nbsp; 38jnehnd98adac160195349a7127e126f0</span><span style="background-color:#00FF00;">--</span></span><span style="background:#00FF00;">第</span><span style="background:#00FF00;">2</span><span style="background:#00FF00;">磁道数据，</span><span style="background:#00FF00;">z37</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 41</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 00000622&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">终端代码，</span><span style="background:#00FF00;">ANS8</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 42</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 843100054110023&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">终端标示，</span><span style="background:#00FF00;">ANS15</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 49</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">货币代码，</span><span style="background:#00FF00;">n3,156</span><span style="background:#00FF00;">为人民币</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 52</span><span style="background:#00FF00;">：</span><span><span style="background-color:#00FF00;">&nbsp; </span><span style="background-color:rgb(51,255,51);">d8uejeiuw28ce805</span><span style="background-color:#00FF00;">--</span></span><span style="background:#00FF00;">用户密码（</span><span style="background:#00FF00;">PIN Data</span><span style="background:#00FF00;">），</span><span style="background:#00FF00;">B64</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 53</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 2610000000000000&nbsp;&nbsp; --</span><span style="background:#00FF00;">安全控制信息，</span><span style="background:#00FF00;">n16</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 55</span><span style="background:#00FF00;">：</span></p> 
  <p align="left"><span style="background-color:rgb(51,255,51);">0983i3u33urhftb2fe53af9d5d9f2701809f1111111111111198987a0100000981382e4270769f3704ac8cbd619f3602036f950500000000009a031610199c01009f02060000000000015f2a02015682027c009f1a0201569f03060000000000009f3303e0e1c89f34030000009f3501229f1e0830319999999996358408a00000030oieieieief090200309f410400001194</span><br></p> 
  <p align="left"><span style="background:#00FF00;">--IC</span><span style="background:#00FF00;">卡数据域</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 60</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp; 22000030000601&nbsp;&nbsp; --</span><span style="background:#00FF00;">附加数据，自定义域</span></p> 
  <p align="left"><span style="background:#00FF00;">Bit 64</span><span style="background:#00FF00;">：</span><span style="background:#00FF00;">&nbsp;3437393435353436&nbsp;&nbsp;&nbsp;&nbsp; --</span><span style="background:#00FF00;">报文鉴别代码字段</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p>&nbsp;</p> 
  <p><strong>③：报文解析后对报文进行16进制转换处理（域位数不够需要注意域的左对齐右对齐以及左补0右补0）：</strong></p> 
  <p>Ø&nbsp; 因为loadrunner中需要识别16进制的数据进行socket报文发送，所以需要把如上消费报文转换为16进制进行发送，发送16进制格式为：<span style="background:#00FF00;">每两位前面加转义符“</span><span style="background:#00FF00;">\x</span><span style="background:#00FF00;">”来代表</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span>，上面消费报文转换后的16进制报文如下（每个域加上双引号且换行）：</p> 
  <p align="left"><span style="background:#00FF00;">"\x01\x1F"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//</span><span style="background:#00FF00;">报文长度，必须加上，否则报文无法发送成功</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x60\x00\x04\x00\x00"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //TPDU</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x60\x31\x00\x31\x13\x06"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style="background:#00FF00;">报文头</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x02\x00"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //MSGID</span><span style="background:#00FF00;">，指余额查询、消费等</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x70\x20\x06\xc4\x20\xc0\x9a\x11"//bitmap</span><span style="background:#00FF00;">：确认后面报文使用的域</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x16\x62\x14\x44\x10\x00\x01\x01\x11"//bit2</span><span style="background:#00FF00;">，主账号</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">位卡号，前面加长度</span><span style="background:#00FF00;">16</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x00\x00\x00"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit3</span><span style="background:#00FF00;">，处理码，直接转换</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x00\x00\x00\x00\x00\x01"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit4</span><span style="background:#00FF00;">，交易金额，直接转换</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x00\x33\x94"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit11</span><span style="background:#00FF00;">，交易流水号</span><span style="background:#00FF00;">, </span><span style="background:#00FF00;">直接转换</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x07\x10"&nbsp; //bit22</span><span style="background:#00FF00;">，服务点输入方式，原始数据为</span><span style="background:#00FF00;">071</span><span style="background:#00FF00;">，差一位，右补</span><span style="background:#00FF00;">0</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x00\x11"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//bit23</span><span style="background:#00FF00;">，原始数据</span><span style="background:#00FF00;">011</span><span style="background:#00FF00;">，差一位，左补</span><span style="background:#00FF00;">0</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x00"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit25</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x12"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit26</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\xcd\xf4\x3e\xb3\xcb\x55\xb4\x1a\x25\x7c\x51\xc2\x6e\xae\xf8\x01"&nbsp;&nbsp;&nbsp;&nbsp; //bit30</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x32\xc4\x0e\x02\x19\xad\xac\x16\x01\x95\x34\x9a\x71\x27\xe1\x26\xf0"//bit35</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x30\x30\x30\x30\x30\x36\x32\x32"&nbsp;&nbsp;&nbsp; //bit41</span><span style="background:#00FF00;">，原始数据</span><span style="background:#00FF00;">00000622</span><span style="background:#00FF00;">，每个数字前加上数字</span><span style="background:#00FF00;">3</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x38\x34\x33\x31\x30\x30\x30\x35\x34\x31\x31\x30\x30\x32\x33"&nbsp; //bit42</span><span style="background:#00FF00;">，原始数据</span><span style="background:#00FF00;">843100054110023</span><span style="background:#00FF00;">，每个数字前加上数字</span><span style="background:#00FF00;">3</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x31\x35\x36"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit49</span><span style="background:#00FF00;">，原始数据</span><span style="background:#00FF00;">156</span><span style="background:#00FF00;">，每个数字前加上数字</span><span style="background:#00FF00;">3</span></p> 
  <p align="left"><span style="background:#00FF00;">"\xd5\x11\x3d\x76\xf2\x8c\xe8\x05"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit62</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x26\x10\x00\x00\x00\x00\x00\x00"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit53</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x01\x45\x9f\x26\x08\x29\xfa\xb2\xfe\x53\xaf\x9d\x5d\x9f\x27\x01\x80\x9f\x10\x13\x07\x00\x01\x03\xa0\x00\x00\x01\x0a\x01\x00\x00\x09\x81\x38\x2e\x42\x70\x76\x9f\x37\x04\xac\x8c\xbd\x61\x9f\x36\x02\x03\x6f\x95\x05\x00\x00\x00\x00\x00\x9a\x03\x16\x10\x19\x9c\x01\x00\x9f\x02\x06\x00\x00\x00\x00\x00\x01\x5f\x2a\x02\x01\x56\x82\x02\x7c\x00\x9f\x1a\x02\x01\x56\x9f\x03\x06\x00\x00\x00\x00\x00\x00\x9f\x33\x03\xe0\xe1\xc8\x9f\x34\x03\x00\x00\x00\x9f\x35\x01\x22\x9f\x1e\x08\x30\x31\x33\x30\x30\x30\x36\x35\x84\x08\xa0\x00\x00\x03\x33\x01\x01\x01\x9f\x09\x02\x00\x30\x9f\x41\x04\x00\x00\x11\x94"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit55</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x00\x14\x22\x00\x00\x30\x00\x06\x01"&nbsp;&nbsp;&nbsp;//bit60</span><span style="background:#00FF00;">，原始数据，</span><span style="background:#00FF00;">22000030000601</span><span style="background:#00FF00;">（</span><span style="background:#00FF00;">14</span><span style="background:#00FF00;">位长度），前面加</span><span style="background:#00FF00;">0014</span><span style="background:#00FF00;">标示数据长度</span></p> 
  <p align="left"><span style="background:#00FF00;">"\x34\x37\x39\x34\x35\x35\x34\x36"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //bit64</span><span style="background:#00FF00;">，直接转</span><span style="background:#00FF00;">16</span><span style="background:#00FF00;">进制</span></p> 
  <p>&nbsp;</p> 
  <p><strong>二：loadrunner脚本开发及数据塞入：</strong></p> 
  <p><strong>①：测试协议选择：</strong></p> 
  <p>Ø&nbsp; &nbsp;开发测试脚本选择Windowssocets协议<strong></strong></p> 
  <p>Ø&nbsp; vuser_init、vuser_end部分默认，不用更改，代码默认，主要在Action中开发测试脚本和在data.ws中传输数据到Action的代码中，具体操作如下：</p> 
  <p>Ø&nbsp; <strong>&nbsp;</strong></p> 
  <p><strong>②：Action中编写socket性能测试脚本：</strong></p> 
  <p>脚本减少逻辑换算，比如脚本中勿用对返回值的判断（直接后端服务器判断数据正确性或数据库验证数据正确性），比如十六进制的参数化在数据参数化中使用转义字符完成，无需额外写代码处理，最简代码如下：</p> 
  <p>&nbsp;</p> 
  <p><span style="background:#00FF00;">#include"lrs.h"</span></p> 
  <p><span style="background:#00FF00;">Action()</span></p> 
  <p><span style="background:#00FF00;">{</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_startup(257);&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style="background:#00FF00;">初始化</span><span style="background:#00FF00;"> Windows Sockets DLL</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_create_socket("socket0","TCP", "RemoteHost=192.180.80.87:6667", LrsLastArg);//</span><span style="background:#00FF00;">创建连接目标服务器</span><span style="background:#00FF00;">ip</span><span style="background:#00FF00;">及端口</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_rendezvous("</span><span style="background:#00FF00;">联机消费</span><span style="background:#00FF00;">");//</span><span style="background:#00FF00;">设置集合点</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_start_transaction("</span><span style="background:#00FF00;">联机消费</span><span style="background:#00FF00;">");//</span><span style="background:#00FF00;">设置事物开始</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_send("socket0","buf0",LrsLastArg); //</span><span style="background:#00FF00;">把数据塞入</span><span style="background:#00FF00;">buf0</span><span style="background:#00FF00;">中，发送</span><span style="background:#00FF00;">data.ws</span><span style="background:#00FF00;">中的数据</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_receive ("socket0","buf1",LrsLastArg);//</span><span style="background:#00FF00;">接受服务器返回的数据</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lr_end_transaction("</span><span style="background:#00FF00;">联机消费</span><span style="background:#00FF00;">", LR_AUTO);//</span><span style="background:#00FF00;">事物结束</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_close_socket("socket0");//</span><span style="background:#00FF00;">关闭连接</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lrs_cleanup(); //</span><span style="background:#00FF00;">终止</span><span style="background:#00FF00;">Windows</span><span style="background:#00FF00;">套接字</span><span style="background:#00FF00;"> DLL </span><span style="background:#00FF00;">的使用</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp; return 0;</span></p> 
  <p><span style="background:#00FF00;">}</span></p> 
  <p>&nbsp;</p> 
  <p><strong>&nbsp;</strong></p> 
  <p><strong>③：<a name="OLE_LINK33"></a><a name="OLE_LINK32">data.ws</a>中做传输数据处理：</strong></p> 
  <p>把处理好的16进制的报文放入data.ws中，格式如下：</p> 
  <p>&nbsp;</p> 
  <p><span style="background:#00FF00;">;WSRData2 1</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; send buf0 287 // </span><span style="background:#00FF00;">发送给</span><span style="background:#00FF00;">buf0</span><span style="background:#00FF00;">的数据长度。</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">"\x01\x1F"//</span><span style="background:#00FF00;">报文长度，必须加上，否则报文无法发送成功</span></p> 
  <p><span style="background:#00FF00;">"\x60\x00\x04\x00\x00"</span></p> 
  <p><span style="background:#00FF00;">"\x60\x31\x00\x31\x13\x06"</span></p> 
  <p><span style="background:#00FF00;">"\x02\x00"</span></p> 
  <p><span style="background:#00FF00;">"\x70\x20\x06\xc4\x20\xc0\x9a\x11"</span></p> 
  <p><span style="background:#00FF00;">"\x16\x62\x14\x44\x10\x00\x01\x01\x11"//16</span><span style="background:#00FF00;">位卡号，前面加</span><span style="background:#00FF00;">16</span></p> 
  <p><span style="background:#00FF00;">"\x00\x00\x00"</span></p> 
  <p><span style="background:#00FF00;">"\x00\x00\x00\x00\x00\x01"</span></p> 
  <p><span style="background:#00FF00;">"\x01\x00\x08"//</span><span style="background:#00FF00;">交易流水号，每个交易流水号不能重复，须参数化</span></p> 
  <p><span style="background:#00FF00;">"\x07\x10"</span></p> 
  <p><span style="background:#00FF00;">"\x00\x11"</span></p> 
  <p><span style="background:#00FF00;">"\x00"</span></p> 
  <p><span style="background:#00FF00;">"\x12"</span></p> 
  <p><span style="background:#00FF00;">"\xcd\xf4\x3e\xb3\xcb\x55\xb4\x1a\x25\x7c\x51\xc2\x6e\xae\xf8\x01"</span></p> 
  <p><span style="background:#00FF00;">"\x32\xc4\x0e\x02\x19\xad\xac\x16\x01\x95\x34\x9a\x71\x27\xe1\x26\xf0"</span></p> 
  <p><span style="background:#00FF00;">"\x30\x30\x30\x30\x30\x36\x32\x32"</span></p> 
  <p><span style="background:#00FF00;">"\x38\x34\x33\x31\x30\x30\x30\x35\x34\x31\x31\x30\x30\x32\x33"</span></p> 
  <p><span style="background:#00FF00;">"\x31\x35\x36"</span></p> 
  <p><span style="background:#00FF00;">"\xd5\x11\x3d\x76\xf2\x8c\xe8\x05"</span></p> 
  <p><span style="background:#00FF00;">"\x26\x10\x00\x00\x00\x00\x00\x00"</span></p> 
  <p><span style="background:#00FF00;">"\x01\x45\x9f\x26\x08\x29\xfa\xb2\xfe\x53\xaf\x9d\x5d\x9f\x27\x01\x80\x9f\x10\x13\x07\x00\x01\x03\xa0\x00\x00\x01\x0a\x01\x00\x00\x09\x81\x38\x2e\x42\x70\x76\x9f\x37\x04\xac\x8c\xbd\x61\x9f\x36\x02\x03\x6f\x95\x05\x00\x00\x00\x00\x00\x9a\x03\x16\x10\x19\x9c\x01\x00\x9f\x02\x06\x00\x00\x00\x00\x00\x01\x5f\x2a\x02\x01\x56\x82\x02\x7c\x00\x9f\x1a\x02\x01\x56\x9f\x03\x06\x00\x00\x00\x00\x00\x00\x9f\x33\x03\xe0\xe1\xc8\x9f\x34\x03\x00\x00\x00\x9f\x35\x01\x22\x9f\x1e\x08\x30\x31\x33\x30\x30\x30\x36\x35\x84\x08\xa0\x00\x00\x03\x33\x01\x01\x01\x9f\x09\x02\x00\x30\x9f\x41\x04\x00\x00\x11\x94"</span></p> 
  <p><span style="background:#00FF00;">"\x00\x14\x22\x00\x00\x30\x00\x06\x01"</span></p> 
  <p><span style="background:#00FF00;">"\x34\x37\x39\x34\x35\x35\x34\x36"</span></p> 
  <p><span style="background:#00FF00;">&nbsp;</span></p> 
  <p><span style="background:#00FF00;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recv buf1 303 //</span><span style="background:#00FF00;">经过验证，返回的数据无需正确也能够正常跑通脚本</span></p> 
  <p><span style="background:#00FF00;">-1</span></p> 
  <p><strong>&nbsp;</strong></p> 
  <p><strong>如图验证调试脚本返回信息正确：</strong></p> 
  <p><strong><br></strong></p> 
  <p><strong><br></strong></p> 
  <p><strong>如图验证数据库交易数据正确：</strong></p> 
  <p><strong><br></strong></p> 
  <p><strong>脚本调试成功，根据具测试策略，进行加压并监控整个业务的（响应时间、TPS、加密机性能、支付服务器性能、应用服务器性能、oracle服务器性能等...<span style="font-weight:bold;">）</span></strong></p> 
  <p><strong><span style="font-weight:bold;"><br></span></strong></p> 
  <p><strong><span style="font-weight:bold;">经过压测，本系统存在3个性能问题：</span></strong></p> 
  <p><strong>1.increasemaxThreads问题（已优化解决）</strong></p> 
  <p><strong>2.加密机数据丢包问题（已优化解决））</strong></p> 
  <p><strong>3.sql执行超时，无法响应问题（未来两年内生产用户大不了压测出问题时候的并发数，处理优先级降低）</strong></p> 
  <p>以上问题的定位调优另外单独整理总结，详细信息可见“性能问题总结及经验汇总.docx”文档</p> 
  <p><strong></strong></p> 
  <p><strong>&nbsp;</strong></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/haoluojie/article/details/53021960,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/haoluojie/article/details/53021960,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

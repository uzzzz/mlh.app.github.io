<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>pn532中遇到的坑—–Mifare1 Card（一） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="pn532中遇到的坑—–Mifare1 Card（一）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="这几天玩玩pn532读写Mifare1 Card，s50，s70，在网上看了一些文章，照着做了，尝试了很久才成功最坑的莫过于校验位，还有认证过程。 1.先了解帧(frame)的结构： 可能好多人对英文望而却步，在下不才，解释下 1.PREAMBLE1 byte4, 这个就是所谓的帧头，也称为前导码，一般是002.START CODE2 bytes (0x00 and 0xFF), 开始码 2个字节，分别是 00和FF&nbsp;3.LEN1 byte indicating the number of bytes in the data field(TFI and PD0 to PDn), 这个是数据长度，一个TFI和n个PD3.LCS1 Packet Length Checksum LCS byte that satisfies the relation:Lower byte of [LEN + LCS] = 0x00, 这个是LEN的补码，也就是（LEN取反+1）4.TFI1 byte frame identifier, the value of this byte dependson the way of the message- D4h in case of a frame from the host controller to the PN532,- D5h in case of a frame from the PN532 to the host controller. 表示数据流向 D4 表示 数据发向PN532 &nbsp; &nbsp; &nbsp; &nbsp; D5 表示 PN532数据发出5.DATALEN-1 bytes of Packet Data InformationThe first byte PD0 is the Command Code, 搞了半天，这才是我们想要发的数据，DATA的第一个字节PD0为控制字符，其余为普通数据。该包长度为 LEN-16.DCS1 Data Checksum DCS byte that satisfies the relation:Lower byte of [TFI + PD0 + PD1 + … + PDn + DCS] = 0x00, DCS 其实最坑了，根本不知道怎么算出来的。其实就是把这些十六进制数加起来，后两位取补码即可。即(TFI + PD0 + PD1 + … + PDn)累加和，取后两位的补码。&nbsp;POSTAMBLE1 byte2. 帧尾 一般为 00The amount of data that can be exchanged using this frame structure is limited to 255bytes (including TFI). 最后一句话了，，这种的数据结构只能有255 个data （包括TFI），还有几种种结构，这里先不说了。 /**************************************分割线**开始实战读写M1卡********************************************/ 本人用的pn532的主控芯片，注意所有数字为16进制形式。用串口与pn532链接，串口助手发送选择hex。 硬件连接： 电脑串口RX-&gt;PN532 TX &nbsp; &nbsp; &nbsp; &nbsp;电脑串口TX-&gt;PN532 RX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;波特率 默认 115200 &nbsp;数据位8 校验位 无 &nbsp;停止位1 流控无 硬件连接正常后开始操作。 1. 唤醒PN532， &nbsp;PC-&gt;PN532:&nbsp; 55&nbsp;55&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;ff&nbsp;03&nbsp;fd&nbsp;d4&nbsp;14&nbsp;01&nbsp;17&nbsp;00 &nbsp;PN532 - &gt;PC :&nbsp; 00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp;00&nbsp;00&nbsp;FF&nbsp;02&nbsp;FE&nbsp;D5&nbsp;15&nbsp;16&nbsp;00 其实第一条不符合普通的发送格式，比较特殊。如果没有正常返回，检查硬件连接和波特率。 2.获取卡UID，也就是卡的唯一ID号，全球就这一个（理论上） &nbsp;PC-&gt;PN532:&nbsp;00&nbsp;00&nbsp;FF&nbsp;04&nbsp;FC&nbsp;D4&nbsp;4A&nbsp;02&nbsp;00&nbsp;E0&nbsp;00 析： 04 //代表有四个数据分别是 D4&nbsp;4A&nbsp;02&nbsp;00 &nbsp; &nbsp;FC //这是04的补码&nbsp; &nbsp; &nbsp;4a //命令 &nbsp; &nbsp;02 //卡数量，0--2 &nbsp; &nbsp;00 //波特率 106K &nbsp; &nbsp;E0 //校验位 &nbsp;D4+4A+02+00=0x0120 &nbsp;取后两位20的补码为E0。至于补码怎么计算自己百度吧。 &nbsp;PN532-&gt;PC: &nbsp; 00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00&nbsp;00&nbsp;FF&nbsp;0C&nbsp;F4&nbsp;D5&nbsp;4B&nbsp;01&nbsp;01&nbsp;00&nbsp;04&nbsp;08&nbsp;04&nbsp;A1&nbsp;9F&nbsp;F5&nbsp;5E&nbsp;3B&nbsp;00&nbsp; 析：00 00 FF 00 FF 00 &nbsp;//ACK &nbsp; &nbsp; 00 00 FF 0C F4&nbsp; &nbsp; &nbsp; D5 //PN532 到 MCU &nbsp; &nbsp; 4B //响应命令 &nbsp; &nbsp; 01 //目标卡1 &nbsp; &nbsp; 01 //目标卡数量，最大为0x02,最小为0 &nbsp; &nbsp; 00 04 //atq &nbsp; &nbsp; 08 &nbsp; &nbsp;//卡容量 08=1K &nbsp; &nbsp; 04 &nbsp; &nbsp;//4个字节UID &nbsp; &nbsp; 02 F5 13 BE //UID &nbsp; &nbsp; 06 00 //DCS+POST 到这一步总体来说还算顺利，主要是因为可以发送完命令在再刷卡也行，也可以把卡一直放上。 3、密钥验证，注意验证完秘钥，卡不能离开，需要一直放在上面，才能顺利的完成下面读写操作，我就栽了，验证完秘钥卡就离开了，读写卡怎么都不成功，浪费了一下午。还有注意替第二个步骤的UID，最后根据自己的UID计算校验位即倒数第二位。&nbsp;PC-&gt;PN532:&nbsp; 00 00 fF 0F F1 D4 40 01 60 07 FF FF FF FF FF FFA1&nbsp;9F&nbsp;F5&nbsp;5E C2 00 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;60 //密钥验证命令 &nbsp; &nbsp; &nbsp;07 //块号 &nbsp; &nbsp; &nbsp;ff ff ff ff ff ff //密钥 &nbsp; &nbsp; &nbsp;A1&nbsp;9F&nbsp;F5&nbsp;5E //UID 替换为步骤2得到的UID&nbsp; &nbsp; &nbsp; &nbsp;C2 //检验位，根据替换的UID计算，计方法跟步骤2一样。 &nbsp;PN532-&gt;PC:&nbsp;00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp; 析： 41 00 //正确状态 4.开始读卡，M1卡有16个扇区，每个扇区4个块.具体看博文http://blog.csdn.net/yxstars/article/details/38081521 &nbsp; &nbsp; //07是控制字节PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 07 B4 00 //读第7块PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 06 B5 00 //读第6块PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 08 B3 00 //读第8块&nbsp; 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;30 //读卡命令 &nbsp; &nbsp; &nbsp;07 //快号 &nbsp; &nbsp; &nbsp;&nbsp;PN532-&gt;PC: 00 00 FF 00 FF 00 //ACK &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 FF 07 80 69 FF FF FF FF FF FF 01 00 &nbsp;//7块PN532-&gt;PC: 00 00 FF 00 FF 00 //ACK &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 EA 00 //6块 析： 41 00 //正确 &nbsp; &nbsp;err: 00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp; 00 00 FF 03 FD D5 41 13 D7 00&nbsp; 析： 41 03 //错误 5、写卡PC-&gt;PN532:&nbsp;00 00 ff 15 EB D4 40 01 A0 06 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F CD 00 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;A0 //写卡命令 &nbsp; &nbsp; &nbsp;06 //块号 &nbsp; &nbsp; &nbsp;00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F &nbsp;//16字节数据 &nbsp; &nbsp; &nbsp;CD//校验和，如果更改其他的数需重新计算。PN532-&gt;PC: 00 00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp; 至此，读写卡的就完成了，接下来搞P2P，正在研究，接来下来更新。 小弟不才，有什么疏漏之处还望各位大拿指点一二。 GPIO_ADC 2016.01.18&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 阅读更多" />
<meta property="og:description" content="这几天玩玩pn532读写Mifare1 Card，s50，s70，在网上看了一些文章，照着做了，尝试了很久才成功最坑的莫过于校验位，还有认证过程。 1.先了解帧(frame)的结构： 可能好多人对英文望而却步，在下不才，解释下 1.PREAMBLE1 byte4, 这个就是所谓的帧头，也称为前导码，一般是002.START CODE2 bytes (0x00 and 0xFF), 开始码 2个字节，分别是 00和FF&nbsp;3.LEN1 byte indicating the number of bytes in the data field(TFI and PD0 to PDn), 这个是数据长度，一个TFI和n个PD3.LCS1 Packet Length Checksum LCS byte that satisfies the relation:Lower byte of [LEN + LCS] = 0x00, 这个是LEN的补码，也就是（LEN取反+1）4.TFI1 byte frame identifier, the value of this byte dependson the way of the message- D4h in case of a frame from the host controller to the PN532,- D5h in case of a frame from the PN532 to the host controller. 表示数据流向 D4 表示 数据发向PN532 &nbsp; &nbsp; &nbsp; &nbsp; D5 表示 PN532数据发出5.DATALEN-1 bytes of Packet Data InformationThe first byte PD0 is the Command Code, 搞了半天，这才是我们想要发的数据，DATA的第一个字节PD0为控制字符，其余为普通数据。该包长度为 LEN-16.DCS1 Data Checksum DCS byte that satisfies the relation:Lower byte of [TFI + PD0 + PD1 + … + PDn + DCS] = 0x00, DCS 其实最坑了，根本不知道怎么算出来的。其实就是把这些十六进制数加起来，后两位取补码即可。即(TFI + PD0 + PD1 + … + PDn)累加和，取后两位的补码。&nbsp;POSTAMBLE1 byte2. 帧尾 一般为 00The amount of data that can be exchanged using this frame structure is limited to 255bytes (including TFI). 最后一句话了，，这种的数据结构只能有255 个data （包括TFI），还有几种种结构，这里先不说了。 /**************************************分割线**开始实战读写M1卡********************************************/ 本人用的pn532的主控芯片，注意所有数字为16进制形式。用串口与pn532链接，串口助手发送选择hex。 硬件连接： 电脑串口RX-&gt;PN532 TX &nbsp; &nbsp; &nbsp; &nbsp;电脑串口TX-&gt;PN532 RX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;波特率 默认 115200 &nbsp;数据位8 校验位 无 &nbsp;停止位1 流控无 硬件连接正常后开始操作。 1. 唤醒PN532， &nbsp;PC-&gt;PN532:&nbsp; 55&nbsp;55&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;ff&nbsp;03&nbsp;fd&nbsp;d4&nbsp;14&nbsp;01&nbsp;17&nbsp;00 &nbsp;PN532 - &gt;PC :&nbsp; 00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp;00&nbsp;00&nbsp;FF&nbsp;02&nbsp;FE&nbsp;D5&nbsp;15&nbsp;16&nbsp;00 其实第一条不符合普通的发送格式，比较特殊。如果没有正常返回，检查硬件连接和波特率。 2.获取卡UID，也就是卡的唯一ID号，全球就这一个（理论上） &nbsp;PC-&gt;PN532:&nbsp;00&nbsp;00&nbsp;FF&nbsp;04&nbsp;FC&nbsp;D4&nbsp;4A&nbsp;02&nbsp;00&nbsp;E0&nbsp;00 析： 04 //代表有四个数据分别是 D4&nbsp;4A&nbsp;02&nbsp;00 &nbsp; &nbsp;FC //这是04的补码&nbsp; &nbsp; &nbsp;4a //命令 &nbsp; &nbsp;02 //卡数量，0--2 &nbsp; &nbsp;00 //波特率 106K &nbsp; &nbsp;E0 //校验位 &nbsp;D4+4A+02+00=0x0120 &nbsp;取后两位20的补码为E0。至于补码怎么计算自己百度吧。 &nbsp;PN532-&gt;PC: &nbsp; 00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00&nbsp;00&nbsp;FF&nbsp;0C&nbsp;F4&nbsp;D5&nbsp;4B&nbsp;01&nbsp;01&nbsp;00&nbsp;04&nbsp;08&nbsp;04&nbsp;A1&nbsp;9F&nbsp;F5&nbsp;5E&nbsp;3B&nbsp;00&nbsp; 析：00 00 FF 00 FF 00 &nbsp;//ACK &nbsp; &nbsp; 00 00 FF 0C F4&nbsp; &nbsp; &nbsp; D5 //PN532 到 MCU &nbsp; &nbsp; 4B //响应命令 &nbsp; &nbsp; 01 //目标卡1 &nbsp; &nbsp; 01 //目标卡数量，最大为0x02,最小为0 &nbsp; &nbsp; 00 04 //atq &nbsp; &nbsp; 08 &nbsp; &nbsp;//卡容量 08=1K &nbsp; &nbsp; 04 &nbsp; &nbsp;//4个字节UID &nbsp; &nbsp; 02 F5 13 BE //UID &nbsp; &nbsp; 06 00 //DCS+POST 到这一步总体来说还算顺利，主要是因为可以发送完命令在再刷卡也行，也可以把卡一直放上。 3、密钥验证，注意验证完秘钥，卡不能离开，需要一直放在上面，才能顺利的完成下面读写操作，我就栽了，验证完秘钥卡就离开了，读写卡怎么都不成功，浪费了一下午。还有注意替第二个步骤的UID，最后根据自己的UID计算校验位即倒数第二位。&nbsp;PC-&gt;PN532:&nbsp; 00 00 fF 0F F1 D4 40 01 60 07 FF FF FF FF FF FFA1&nbsp;9F&nbsp;F5&nbsp;5E C2 00 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;60 //密钥验证命令 &nbsp; &nbsp; &nbsp;07 //块号 &nbsp; &nbsp; &nbsp;ff ff ff ff ff ff //密钥 &nbsp; &nbsp; &nbsp;A1&nbsp;9F&nbsp;F5&nbsp;5E //UID 替换为步骤2得到的UID&nbsp; &nbsp; &nbsp; &nbsp;C2 //检验位，根据替换的UID计算，计方法跟步骤2一样。 &nbsp;PN532-&gt;PC:&nbsp;00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp; 析： 41 00 //正确状态 4.开始读卡，M1卡有16个扇区，每个扇区4个块.具体看博文http://blog.csdn.net/yxstars/article/details/38081521 &nbsp; &nbsp; //07是控制字节PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 07 B4 00 //读第7块PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 06 B5 00 //读第6块PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 08 B3 00 //读第8块&nbsp; 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;30 //读卡命令 &nbsp; &nbsp; &nbsp;07 //快号 &nbsp; &nbsp; &nbsp;&nbsp;PN532-&gt;PC: 00 00 FF 00 FF 00 //ACK &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 FF 07 80 69 FF FF FF FF FF FF 01 00 &nbsp;//7块PN532-&gt;PC: 00 00 FF 00 FF 00 //ACK &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 EA 00 //6块 析： 41 00 //正确 &nbsp; &nbsp;err: 00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp; 00 00 FF 03 FD D5 41 13 D7 00&nbsp; 析： 41 03 //错误 5、写卡PC-&gt;PN532:&nbsp;00 00 ff 15 EB D4 40 01 A0 06 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F CD 00 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;A0 //写卡命令 &nbsp; &nbsp; &nbsp;06 //块号 &nbsp; &nbsp; &nbsp;00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F &nbsp;//16字节数据 &nbsp; &nbsp; &nbsp;CD//校验和，如果更改其他的数需重新计算。PN532-&gt;PC: 00 00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp; 至此，读写卡的就完成了，接下来搞P2P，正在研究，接来下来更新。 小弟不才，有什么疏漏之处还望各位大拿指点一二。 GPIO_ADC 2016.01.18&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-01-18T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"这几天玩玩pn532读写Mifare1 Card，s50，s70，在网上看了一些文章，照着做了，尝试了很久才成功最坑的莫过于校验位，还有认证过程。 1.先了解帧(frame)的结构： 可能好多人对英文望而却步，在下不才，解释下 1.PREAMBLE1 byte4, 这个就是所谓的帧头，也称为前导码，一般是002.START CODE2 bytes (0x00 and 0xFF), 开始码 2个字节，分别是 00和FF&nbsp;3.LEN1 byte indicating the number of bytes in the data field(TFI and PD0 to PDn), 这个是数据长度，一个TFI和n个PD3.LCS1 Packet Length Checksum LCS byte that satisfies the relation:Lower byte of [LEN + LCS] = 0x00, 这个是LEN的补码，也就是（LEN取反+1）4.TFI1 byte frame identifier, the value of this byte dependson the way of the message- D4h in case of a frame from the host controller to the PN532,- D5h in case of a frame from the PN532 to the host controller. 表示数据流向 D4 表示 数据发向PN532 &nbsp; &nbsp; &nbsp; &nbsp; D5 表示 PN532数据发出5.DATALEN-1 bytes of Packet Data InformationThe first byte PD0 is the Command Code, 搞了半天，这才是我们想要发的数据，DATA的第一个字节PD0为控制字符，其余为普通数据。该包长度为 LEN-16.DCS1 Data Checksum DCS byte that satisfies the relation:Lower byte of [TFI + PD0 + PD1 + … + PDn + DCS] = 0x00, DCS 其实最坑了，根本不知道怎么算出来的。其实就是把这些十六进制数加起来，后两位取补码即可。即(TFI + PD0 + PD1 + … + PDn)累加和，取后两位的补码。&nbsp;POSTAMBLE1 byte2. 帧尾 一般为 00The amount of data that can be exchanged using this frame structure is limited to 255bytes (including TFI). 最后一句话了，，这种的数据结构只能有255 个data （包括TFI），还有几种种结构，这里先不说了。 /**************************************分割线**开始实战读写M1卡********************************************/ 本人用的pn532的主控芯片，注意所有数字为16进制形式。用串口与pn532链接，串口助手发送选择hex。 硬件连接： 电脑串口RX-&gt;PN532 TX &nbsp; &nbsp; &nbsp; &nbsp;电脑串口TX-&gt;PN532 RX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;波特率 默认 115200 &nbsp;数据位8 校验位 无 &nbsp;停止位1 流控无 硬件连接正常后开始操作。 1. 唤醒PN532， &nbsp;PC-&gt;PN532:&nbsp; 55&nbsp;55&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;ff&nbsp;03&nbsp;fd&nbsp;d4&nbsp;14&nbsp;01&nbsp;17&nbsp;00 &nbsp;PN532 - &gt;PC :&nbsp; 00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp;00&nbsp;00&nbsp;FF&nbsp;02&nbsp;FE&nbsp;D5&nbsp;15&nbsp;16&nbsp;00 其实第一条不符合普通的发送格式，比较特殊。如果没有正常返回，检查硬件连接和波特率。 2.获取卡UID，也就是卡的唯一ID号，全球就这一个（理论上） &nbsp;PC-&gt;PN532:&nbsp;00&nbsp;00&nbsp;FF&nbsp;04&nbsp;FC&nbsp;D4&nbsp;4A&nbsp;02&nbsp;00&nbsp;E0&nbsp;00 析： 04 //代表有四个数据分别是 D4&nbsp;4A&nbsp;02&nbsp;00 &nbsp; &nbsp;FC //这是04的补码&nbsp; &nbsp; &nbsp;4a //命令 &nbsp; &nbsp;02 //卡数量，0--2 &nbsp; &nbsp;00 //波特率 106K &nbsp; &nbsp;E0 //校验位 &nbsp;D4+4A+02+00=0x0120 &nbsp;取后两位20的补码为E0。至于补码怎么计算自己百度吧。 &nbsp;PN532-&gt;PC: &nbsp; 00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00&nbsp;00&nbsp;FF&nbsp;0C&nbsp;F4&nbsp;D5&nbsp;4B&nbsp;01&nbsp;01&nbsp;00&nbsp;04&nbsp;08&nbsp;04&nbsp;A1&nbsp;9F&nbsp;F5&nbsp;5E&nbsp;3B&nbsp;00&nbsp; 析：00 00 FF 00 FF 00 &nbsp;//ACK &nbsp; &nbsp; 00 00 FF 0C F4&nbsp; &nbsp; &nbsp; D5 //PN532 到 MCU &nbsp; &nbsp; 4B //响应命令 &nbsp; &nbsp; 01 //目标卡1 &nbsp; &nbsp; 01 //目标卡数量，最大为0x02,最小为0 &nbsp; &nbsp; 00 04 //atq &nbsp; &nbsp; 08 &nbsp; &nbsp;//卡容量 08=1K &nbsp; &nbsp; 04 &nbsp; &nbsp;//4个字节UID &nbsp; &nbsp; 02 F5 13 BE //UID &nbsp; &nbsp; 06 00 //DCS+POST 到这一步总体来说还算顺利，主要是因为可以发送完命令在再刷卡也行，也可以把卡一直放上。 3、密钥验证，注意验证完秘钥，卡不能离开，需要一直放在上面，才能顺利的完成下面读写操作，我就栽了，验证完秘钥卡就离开了，读写卡怎么都不成功，浪费了一下午。还有注意替第二个步骤的UID，最后根据自己的UID计算校验位即倒数第二位。&nbsp;PC-&gt;PN532:&nbsp; 00 00 fF 0F F1 D4 40 01 60 07 FF FF FF FF FF FFA1&nbsp;9F&nbsp;F5&nbsp;5E C2 00 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;60 //密钥验证命令 &nbsp; &nbsp; &nbsp;07 //块号 &nbsp; &nbsp; &nbsp;ff ff ff ff ff ff //密钥 &nbsp; &nbsp; &nbsp;A1&nbsp;9F&nbsp;F5&nbsp;5E //UID 替换为步骤2得到的UID&nbsp; &nbsp; &nbsp; &nbsp;C2 //检验位，根据替换的UID计算，计方法跟步骤2一样。 &nbsp;PN532-&gt;PC:&nbsp;00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp; 析： 41 00 //正确状态 4.开始读卡，M1卡有16个扇区，每个扇区4个块.具体看博文http://blog.csdn.net/yxstars/article/details/38081521 &nbsp; &nbsp; //07是控制字节PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 07 B4 00 //读第7块PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 06 B5 00 //读第6块PC-&gt;PN532:&nbsp;00 00 ff 05 fb D4 40 01 30 08 B3 00 //读第8块&nbsp; 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;30 //读卡命令 &nbsp; &nbsp; &nbsp;07 //快号 &nbsp; &nbsp; &nbsp;&nbsp;PN532-&gt;PC: 00 00 FF 00 FF 00 //ACK &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 FF 07 80 69 FF FF FF FF FF FF 01 00 &nbsp;//7块PN532-&gt;PC: 00 00 FF 00 FF 00 //ACK &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 EA 00 //6块 析： 41 00 //正确 &nbsp; &nbsp;err: 00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp; 00 00 FF 03 FD D5 41 13 D7 00&nbsp; 析： 41 03 //错误 5、写卡PC-&gt;PN532:&nbsp;00 00 ff 15 EB D4 40 01 A0 06 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F CD 00 析： &nbsp; 40 //命令 &nbsp; &nbsp; &nbsp;01 //卡1 &nbsp; &nbsp; &nbsp;A0 //写卡命令 &nbsp; &nbsp; &nbsp;06 //块号 &nbsp; &nbsp; &nbsp;00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F &nbsp;//16字节数据 &nbsp; &nbsp; &nbsp;CD//校验和，如果更改其他的数需重新计算。PN532-&gt;PC: 00 00 00 FF 00 FF 00&nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp; 至此，读写卡的就完成了，接下来搞P2P，正在研究，接来下来更新。 小弟不才，有什么疏漏之处还望各位大拿指点一二。 GPIO_ADC 2016.01.18&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 阅读更多","@type":"BlogPosting","url":"/2016/01/18/28e83f7fa105a93772faea33814167da.html","headline":"pn532中遇到的坑—–Mifare1 Card（一）","dateModified":"2016-01-18T00:00:00+08:00","datePublished":"2016-01-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2016/01/18/28e83f7fa105a93772faea33814167da.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>pn532中遇到的坑-----Mifare1 Card（一）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><span></span>这几天玩玩pn532读写Mifare1 Card，s50，s70，在网上看了一些文章，照着做了，尝试了很久才成功最坑的莫过于校验位，还有认证过程。</p> 
  <p>1.先了解帧(frame)的结构：</p> 
  <p><img src="" alt=""><img src="" alt=""><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160119185133629?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></p> 
  <p>可能好多人对英文望而却步，在下不才，解释下</p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><strong>1.PREAMBLE</strong><span style="font-family:ArialMT;font-size:10pt;">1 byte<span style="font-size:7pt;">4<span style="font-size:10pt;">,</span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;">这个就是所谓的帧头，也称为前导码，一般是00<br><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><strong>2.START CODE</strong><span style="font-family:ArialMT;font-size:10pt;">2 bytes (0x00 and 0xFF),</span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;">开始码 2个字节，分别是 00和FF&nbsp;<br><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><strong>3.LEN</strong><span style="font-family:ArialMT;font-size:10pt;">1 byte indicating the number of bytes in the data field<br><span style="font-size:10pt;">(TFI and PD0 to PDn),</span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;">这个是数据长度，一个TFI和n个PD<br><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><strong>3.LCS</strong><span style="font-family:ArialMT;font-size:10pt;">1 Packet Length Checksum LCS byte that satisfies the relation:<br><span style="font-size:10pt;">Lower byte of [LEN + LCS] = 0x00,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;">这个是LEN的补码，也就是（LEN取反+1）<br><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><strong>4.TFI</strong><span style="font-family:ArialMT;font-size:10pt;">1 byte frame identifier, the value of this byte depends<br><span style="font-size:10pt;">on the way of the message<br><span style="font-size:10pt;">- <span style="font-size:10pt;"><strong>D4h </strong> <span style="font-size:10pt;">in case of a frame from the host controller to the PN532,<br><span style="font-size:10pt;">- <span style="font-size:10pt;"><strong>D5h </strong> <span style="font-size:10pt;">in case of a frame from the PN532 to the host controller.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;">表示数据流向 D4 表示 数据发向PN532</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;">&nbsp; &nbsp; &nbsp; &nbsp; D5 表示 PN532数据发出<br><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;">5.<strong>DATA</strong><span style="font-family:ArialMT;font-size:10pt;">LEN-1 bytes of Packet Data Information<br><span style="font-size:10pt;">The first byte PD0 is the Command Code,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;">搞了半天，这才是我们想要发的数据，DATA的第一个字节PD0为控制字符，其余为普通数据。该包长度为 LEN-1<br><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;">6.<strong>DCS</strong><span style="font-family:ArialMT;font-size:10pt;">1 Data Checksum DCS byte that satisfies the relation:<br><span style="font-size:10pt;">Lower byte of [TFI + PD0 + PD1 + … + PDn + DCS] = 0x00,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;">DCS 其实最坑了，根本不知道怎么算出来的。其实就是把这些十六进制数加起来，后两位取补码即可。即(<span style="font-family:ArialMT;font-size:13.3333330154419px;">TFI + PD0 + PD1 + … + PDn)累加和，取后两位的补码。</span><br><span style="font-family:'Wingdings-Regular';font-size:10pt;">&nbsp;<span style="font-size:10pt;"><strong>POSTAMBLE</strong><span style="font-family:ArialMT;font-size:10pt;">1 byte<span style="font-size:7pt;">2<span style="font-size:10pt;">.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;">帧尾 一般为 00<br><span style="font-size:10pt;">The amount of data that can be exchanged using this frame structure is limited to 255<br><span style="font-size:10pt;">bytes (including TFI).</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p></p> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">最后一句话了，，这种的数据结构只能有255 个data （包括TFI），还有几种种结构，这里先不说了。</span></span>
  </div> 
  <div>
   <br>
  </div> 
  <div>
   <br>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">/**************************************分割线**开始实战读写M1卡********************************************/</span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">本人用的pn532的主控芯片，注意所有数字为16进制形式。用串口与pn532链接，<span style="color:#ff0000;">串口助手发送选择hex</span>。</span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">硬件连接： 电脑串口RX-&gt;PN532 TX</span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp; &nbsp; &nbsp; &nbsp;电脑串口TX-&gt;PN532 RX &nbsp;</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp; &nbsp; &nbsp; &nbsp;波特率 默认 115200 &nbsp;数据位8 校验位 无 &nbsp;停止位1 流控无</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">硬件连接正常后开始操作。</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">1. 唤醒PN532，</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp;PC-&gt;PN532:&nbsp;</span>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">55&nbsp;55&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;ff&nbsp;03&nbsp;fd&nbsp;d4&nbsp;14&nbsp;01&nbsp;17&nbsp;00</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp;PN532</span>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">-</span>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">&gt;PC</span>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">:&nbsp;</span>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp;00&nbsp;00&nbsp;FF&nbsp;02&nbsp;FE&nbsp;D5&nbsp;15&nbsp;16&nbsp;00</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">其实第一条不符合普通的发送格式，比较特殊。如果没有正常返回，检查硬件连接和波特率。</span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">2.获取卡UID，也就是卡的唯一ID号，全球就这一个（理论上）<img alt="偷笑" src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/titter.gif"></span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;"></span></span> 
   <p><span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp;PC-&gt;PN532:&nbsp;</span>00&nbsp;00&nbsp;FF&nbsp;04&nbsp;FC&nbsp;D4&nbsp;4A&nbsp;02&nbsp;00&nbsp;E0&nbsp;00</p> 析： 04 //代表有四个数据分别是 
   <span style="font-family:ArialMT;font-size:13.3333330154419px;"> D4&nbsp;4A&nbsp;02&nbsp;00</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">&nbsp; &nbsp;<span style="font-family:ArialMT;font-size:13.3333330154419px;">FC //这是04的补码</span>&nbsp;</span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">&nbsp; &nbsp;4a //命令<br> &nbsp; &nbsp;02 //卡数量，0--2<br> &nbsp; &nbsp;00 //波特率 106K<br></span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;">&nbsp; &nbsp;E0 //校验位 &nbsp;<span style="font-family:ArialMT;font-size:13.3333330154419px;">D4+4A+02+00=</span>0x01<span style="color:#ff0000;">20</span> &nbsp;取后两位20的补码为E0。至于补码怎么计算自己百度吧。</span></span>
  </div> 
  <div>
   <br>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;"><span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp;PN532</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">-</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">&gt;PC</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">: &nbsp;</span></span></span>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">00&nbsp;00&nbsp;FF&nbsp;00&nbsp;FF&nbsp;00&nbsp;</span>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;"><span style="font-size:13.3333330154419px;"></span></span></span> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00&nbsp;00&nbsp;FF&nbsp;0C&nbsp;F4&nbsp;D5&nbsp;4B&nbsp;01&nbsp;01&nbsp;00&nbsp;04&nbsp;08&nbsp;04&nbsp;<span style="color:rgb(0,0,255);">A1&nbsp;9F&nbsp;F5&nbsp;5E</span>&nbsp;3B&nbsp;00&nbsp;</p> 
   <p>析：00 00 FF 00 FF 00 &nbsp;//ACK<br> &nbsp; &nbsp; 00 00 FF 0C F4&nbsp;<br> &nbsp; &nbsp; D5 //PN532 到 MCU<br> &nbsp; &nbsp; 4B //响应命令<br> &nbsp; &nbsp; 01 //目标卡1<br> &nbsp; &nbsp; 01 //目标卡数量，最大为0x02,最小为0<br> &nbsp; &nbsp; 00 04 //atq<br> &nbsp; &nbsp; 08 &nbsp; &nbsp;//卡容量 08=1K<br> &nbsp; &nbsp; 04 &nbsp; &nbsp;//4个字节UID<br> &nbsp; &nbsp; 02 F5 13 BE //UID<br> &nbsp; &nbsp; 06 00 //DCS+POST<br></p> 
   <p>到这一步总体来说还算顺利，主要是因为可以发送完命令在再刷卡也行，也可以把卡一直放上。</p> 
   <p>3、密钥验证，注意验证完秘钥，<span style="color:#ff0000;">卡不能离开</span>，需要一直放在上面，才能顺利的完成下面读写操作，我就栽了，验证完秘钥卡就离开了，读写卡怎么都不成功，浪费了一下午。还有注意替第二个步骤的UID，<span style="color:#ff0000;">最后根据自己的UID计算校验位即倒数第二位</span>。<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp;PC-&gt;PN532:</span>&nbsp; 00 00 fF 0F F1 D4 40 01 60 07 FF FF FF FF FF FF<span style="color:rgb(0,0,255);font-family:ArialMT;font-size:13.3333330154419px;">A1&nbsp;9F&nbsp;F5&nbsp;5E</span> C2 00<br> 析： &nbsp; 40 //命令<br> &nbsp; &nbsp; &nbsp;01 //卡1<br> &nbsp; &nbsp; &nbsp;60 //密钥验证命令<br> &nbsp; &nbsp; &nbsp;07 //块号<br> &nbsp; &nbsp; &nbsp;ff ff ff ff ff ff //密钥<br> &nbsp; &nbsp; &nbsp;<span style="color:#ff0000;"><span style="font-family:ArialMT;font-size:13.3333330154419px;">A1&nbsp;9F&nbsp;F5&nbsp;5E</span> //UID 替换为步骤2得到的UID&nbsp;</span><br> &nbsp; &nbsp; &nbsp;<span style="color:#ff0000;">C2 //检验位，根据替换的UID计算，计方法跟步骤2一样。</span></p> 
   <p><span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp;PN532</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">-</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">&gt;PC</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">:&nbsp;</span>00 00 FF 00 FF 00&nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp;<br> 析： 41 00 //正确状态</p> 
   <p>4.开始读卡，M1卡有16个扇区，每个扇区4个块.具体看博文http://blog.csdn.net/yxstars/article/details/38081521</p> 
   <p>&nbsp; &nbsp; //07是控制字节<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PC-&gt;PN532:&nbsp;</span>00 00 ff 05 fb D4 40 01 30 07 B4 00 //读第7块<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PC-&gt;PN532:&nbsp;</span>00 00 ff 05 fb D4 40 01 30 06 B5 00 //读第6块<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PC-&gt;PN532:&nbsp;</span>00 00 ff 05 fb D4 40 01 30 08 B3 00 //读第8块&nbsp;<br> 析： &nbsp; 40 //命令<br> &nbsp; &nbsp; &nbsp;01 //卡1<br> &nbsp; &nbsp; &nbsp;30 //读卡命令<br> &nbsp; &nbsp; &nbsp;07 //快号<br> &nbsp; &nbsp; &nbsp;&nbsp;<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PN532</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">-</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">&gt;PC</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">:</span><span style="font-size:13.3333330154419px;"> 00 00 FF 00 FF 00 //ACK</span></p> 
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;"><span style="font-size:13.3333330154419px;"></span></span></span> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 FF 07 80 69 FF FF FF FF FF FF 01 00 &nbsp;//7块<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PN532</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">-</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">&gt;PC</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">:</span> 00 00 FF 00 FF 00 //ACK<br> &nbsp; &nbsp; &nbsp; &nbsp;00 00 FF 13 ED D5 41 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 EA 00 //6块<br> 析： 41 00 //正确<br><br> &nbsp; &nbsp;err: 00 00 FF 00 FF 00&nbsp;<br> &nbsp; &nbsp; &nbsp; 00 00 FF 03 FD D5 41 13 D7 00&nbsp;<br> 析： 41 03 //错误</p> 
   <p>5、写卡<br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PC-&gt;PN532:</span>&nbsp;00 00 ff 15 EB D4 40 01 A0 06 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F CD 00<br> 析： &nbsp; 40 //命令<br> &nbsp; &nbsp; &nbsp;01 //卡1<br> &nbsp; &nbsp; &nbsp;A0 //写卡命令<br> &nbsp; &nbsp; &nbsp;06 //块号<br> &nbsp; &nbsp; &nbsp;00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F &nbsp;//16字节数据</p> 
   <p>&nbsp; &nbsp; &nbsp;<span style="font-family:ArialMT;font-size:13.3333330154419px;">CD//<span style="color:#ff0000;">校验和，如果更改其他的数需重新计算。</span></span><br><span style="font-family:ArialMT;font-size:13.3333330154419px;">PN532</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">-</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">&gt;PC</span><span style="font-family:ArialMT;font-size:13.3333330154419px;">:</span> 00 00 00 FF 00 FF 00&nbsp;<br> &nbsp; &nbsp; &nbsp;00 00 FF 03 FD D5 41 00 EA 00&nbsp;<br></p> 
   <p>至此，读写卡的就完成了，接下来搞P2P，正在研究，接来下来更新。</p> 
   <br>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">小弟不才，有什么疏漏之处还望各位大拿指点一二。</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;"><span></span>GPIO_ADC</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;"><span></span>2016.01.18&nbsp;</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;font-size:13.3333330154419px;">&nbsp; &nbsp; &nbsp;&nbsp;</span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;"><br></span></span>
  </div> 
  <div>
   <span style="font-family:ArialMT;"><span style="font-size:13.3333330154419px;"><br></span></span>
  </div> 
  <span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:7pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:'Wingdings-Regular';font-size:10pt;"><span style="font-size:10pt;"><span style="font-family:ArialMT;font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <br>
  <p></p> 
  <p><br></p> 
  <p><br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/guangzhongyang/article/details/50538562,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/guangzhongyang/article/details/50538562,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>BZOJ1855   洛谷P2569 [SCOI2010]股票交易【单调队列优化DP】 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="BZOJ1855   洛谷P2569 [SCOI2010]股票交易【单调队列优化DP】" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/niiick/article/details/82952649 Time Limit: 5 Sec Memory Limit: 64 MB Description 最近lxhgww又迷上了投资股票，通过一段时间的观察和学习，他总结出了股票行情的一些规律。 通过一段时间的观察，lxhgww预测到了未来T天内某只股票的走势，第i天的股票买入价为每股APi，第i天的股票卖出价为每股BPi（数据保证对于每个i，都有APi&gt;=BPi），但是每天不能无限制地交易，于是股票交易所规定第i天的一次买入至多只能购买ASi股，一次卖出至多只能卖出BSi股。 另外，股票交易所还制定了两个规定。为了避免大家疯狂交易，股票交易所规定在两次交易（某一天的买入或者卖出均算是一次交易）之间，至少要间隔W天，也就是说如果在第i天发生了交易，那么从第i+1天到第i+W天，均不能发生交易。同时，为了避免垄断，股票交易所还规定在任何时间，一个人的手里的股票数不能超过MaxP。 在第1天之前，lxhgww手里有一大笔钱（可以认为钱的数目无限），但是没有任何股票，当然，T天以后，lxhgww想要赚到最多的钱，聪明的程序员们，你们能帮助他吗？ Input 输入数据第一行包括3个整数，分别是T，MaxP，W。 接下来T行，第i行代表第i-1天的股票走势，每行4个整数，分别表示APi，BPi，ASi，BSi。 Output 输出数据为一行，包括1个数字，表示lxhgww能赚到的最多的钱数。 HINT 对于30%的数据，0 &lt; =W 对于50%的数据，0 &lt; =W 对于100%的数据，0 &lt; =W 对于所有的数据，1 &lt; =BPi &lt; =APi &lt; =1000,1 &lt; =ASi,BSi &lt; =MaxP 题目分析 d p [ i ] [ j ] dp[i][j] dp[i][j]表示到第 i i i天时手上恰好有 j j j张股票的最大收益 那么有状态转移方程 dp[i][j]=-j*ap[i]//赋初值 dp[i][j]=max(dp[i][j],dp[i-1][j])//第i天啥也不干 dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])//第i天买入股票，(j-as[i]&lt;=k&lt;j) dp[i][j]=max(dp[i][j],dp[i-w-1][k]+(k-j)*bp[i])//第i天卖出股票，(j&lt;k&lt;=j+bs[i]) 直接转移复杂度为 O ( n 3 ) O(n^3) O(n3)，显然无法承受 尝试把第3、4个方程中k的枚举省去 以第3个为例 d p [ i ] [ j ] = m a x ( d p [ i ] [ j ] , d p [ i − w − 1 ] [ k ] − ( j − k ) ∗ a p [ i ] ) = m a x ( d p [ i ] [ j ] , m a x ( d p [ i − w − 1 ] [ k ] + k ∗ a p [ i ] ) − j ∗ a p [ i ] ) dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])=max(dp[i][j],max(dp[i-w-1][k]+k*ap[i])-j*ap[i]) dp[i][j]=max(dp[i][j],dp[i−w−1][k]−(j−k)∗ap[i])=max(dp[i][j],max(dp[i−w−1][k]+k∗ap[i])−j∗ap[i]) 这里面的 m a x ( d p [ i − w − 1 ] [ k ] + k ∗ a p [ i ] ) max(dp[i-w-1][k]+k*ap[i]) max(dp[i−w−1][k]+k∗ap[i])显然可以用单调队列维护 对于第4个方程同理，不过 j j j的枚举要倒序 这样复杂度就降到 O ( n 2 ) O(n^2) O(n2)了 #include&lt;iostream&gt; #include&lt;cmath&gt; #include&lt;algorithm&gt; #include&lt;queue&gt; #include&lt;cstring&gt; #include&lt;cstdio&gt; using namespace std; typedef long long lt; int read() { int f=1,x=0; char ss=getchar(); while(ss&lt;&#39;0&#39;||ss&gt;&#39;9&#39;){if(ss==&#39;-&#39;)f=-1;ss=getchar();} while(ss&gt;=&#39;0&#39;&amp;&amp;ss&lt;=&#39;9&#39;){x=x*10+ss-&#39;0&#39;;ss=getchar();} return f*x; } const int maxn=2010; int n,m,w; int ap[maxn],bp[maxn]; int as[maxn],bs[maxn]; int dp[maxn&lt;&lt;1][maxn&lt;&lt;1],ans; int q[maxn],ll,rr; int main() { n=read();m=read();w=read(); for(int i=1;i&lt;=n;++i) ap[i]=read(),bp[i]=read(), as[i]=read(),bs[i]=read(); memset(dp,128,sizeof(dp)); dp[0][0]=0; for(int i=1;i&lt;=n;++i) { for(int j=0;j&lt;=as[i];++j) dp[i][j]=-1*j*ap[i]; for(int j=0;j&lt;=m;++j) dp[i][j]=max(dp[i][j],dp[i-1][j]); if(i-w-1&lt;0) continue; ll=rr=1; for(int j=0;j&lt;=m;++j) { while(ll&lt;rr&amp;&amp;q[ll]&lt;j-as[i]) ll++; while(ll&lt;rr&amp;&amp;dp[i-w-1][q[rr-1]]+q[rr-1]*ap[i]&lt;=dp[i-w-1][j]+j*ap[i]) rr--; q[rr++]=j; dp[i][j]=max(dp[i][j],dp[i-w-1][q[ll]]-(j-q[ll])*ap[i]); } ll=rr=1; for(int j=m;j&gt;=0;--j)//注意这里倒叙 { while(ll&lt;rr&amp;&amp;q[ll]&gt;j+bs[i]) ll++; while(ll&lt;rr&amp;&amp;dp[i-w-1][q[rr-1]]+q[rr-1]*bp[i]&lt;=dp[i-w-1][j]+j*bp[i]) rr--; q[rr++]=j; dp[i][j]=max(dp[i][j],dp[i-w-1][q[ll]]+(q[ll]-j)*bp[i]); } } for(int i=0;i&lt;=m;++i) ans=max(ans,dp[n][i]); printf(&quot;%d&quot;,ans); return 0; } 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/niiick/article/details/82952649 Time Limit: 5 Sec Memory Limit: 64 MB Description 最近lxhgww又迷上了投资股票，通过一段时间的观察和学习，他总结出了股票行情的一些规律。 通过一段时间的观察，lxhgww预测到了未来T天内某只股票的走势，第i天的股票买入价为每股APi，第i天的股票卖出价为每股BPi（数据保证对于每个i，都有APi&gt;=BPi），但是每天不能无限制地交易，于是股票交易所规定第i天的一次买入至多只能购买ASi股，一次卖出至多只能卖出BSi股。 另外，股票交易所还制定了两个规定。为了避免大家疯狂交易，股票交易所规定在两次交易（某一天的买入或者卖出均算是一次交易）之间，至少要间隔W天，也就是说如果在第i天发生了交易，那么从第i+1天到第i+W天，均不能发生交易。同时，为了避免垄断，股票交易所还规定在任何时间，一个人的手里的股票数不能超过MaxP。 在第1天之前，lxhgww手里有一大笔钱（可以认为钱的数目无限），但是没有任何股票，当然，T天以后，lxhgww想要赚到最多的钱，聪明的程序员们，你们能帮助他吗？ Input 输入数据第一行包括3个整数，分别是T，MaxP，W。 接下来T行，第i行代表第i-1天的股票走势，每行4个整数，分别表示APi，BPi，ASi，BSi。 Output 输出数据为一行，包括1个数字，表示lxhgww能赚到的最多的钱数。 HINT 对于30%的数据，0 &lt; =W 对于50%的数据，0 &lt; =W 对于100%的数据，0 &lt; =W 对于所有的数据，1 &lt; =BPi &lt; =APi &lt; =1000,1 &lt; =ASi,BSi &lt; =MaxP 题目分析 d p [ i ] [ j ] dp[i][j] dp[i][j]表示到第 i i i天时手上恰好有 j j j张股票的最大收益 那么有状态转移方程 dp[i][j]=-j*ap[i]//赋初值 dp[i][j]=max(dp[i][j],dp[i-1][j])//第i天啥也不干 dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])//第i天买入股票，(j-as[i]&lt;=k&lt;j) dp[i][j]=max(dp[i][j],dp[i-w-1][k]+(k-j)*bp[i])//第i天卖出股票，(j&lt;k&lt;=j+bs[i]) 直接转移复杂度为 O ( n 3 ) O(n^3) O(n3)，显然无法承受 尝试把第3、4个方程中k的枚举省去 以第3个为例 d p [ i ] [ j ] = m a x ( d p [ i ] [ j ] , d p [ i − w − 1 ] [ k ] − ( j − k ) ∗ a p [ i ] ) = m a x ( d p [ i ] [ j ] , m a x ( d p [ i − w − 1 ] [ k ] + k ∗ a p [ i ] ) − j ∗ a p [ i ] ) dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])=max(dp[i][j],max(dp[i-w-1][k]+k*ap[i])-j*ap[i]) dp[i][j]=max(dp[i][j],dp[i−w−1][k]−(j−k)∗ap[i])=max(dp[i][j],max(dp[i−w−1][k]+k∗ap[i])−j∗ap[i]) 这里面的 m a x ( d p [ i − w − 1 ] [ k ] + k ∗ a p [ i ] ) max(dp[i-w-1][k]+k*ap[i]) max(dp[i−w−1][k]+k∗ap[i])显然可以用单调队列维护 对于第4个方程同理，不过 j j j的枚举要倒序 这样复杂度就降到 O ( n 2 ) O(n^2) O(n2)了 #include&lt;iostream&gt; #include&lt;cmath&gt; #include&lt;algorithm&gt; #include&lt;queue&gt; #include&lt;cstring&gt; #include&lt;cstdio&gt; using namespace std; typedef long long lt; int read() { int f=1,x=0; char ss=getchar(); while(ss&lt;&#39;0&#39;||ss&gt;&#39;9&#39;){if(ss==&#39;-&#39;)f=-1;ss=getchar();} while(ss&gt;=&#39;0&#39;&amp;&amp;ss&lt;=&#39;9&#39;){x=x*10+ss-&#39;0&#39;;ss=getchar();} return f*x; } const int maxn=2010; int n,m,w; int ap[maxn],bp[maxn]; int as[maxn],bs[maxn]; int dp[maxn&lt;&lt;1][maxn&lt;&lt;1],ans; int q[maxn],ll,rr; int main() { n=read();m=read();w=read(); for(int i=1;i&lt;=n;++i) ap[i]=read(),bp[i]=read(), as[i]=read(),bs[i]=read(); memset(dp,128,sizeof(dp)); dp[0][0]=0; for(int i=1;i&lt;=n;++i) { for(int j=0;j&lt;=as[i];++j) dp[i][j]=-1*j*ap[i]; for(int j=0;j&lt;=m;++j) dp[i][j]=max(dp[i][j],dp[i-1][j]); if(i-w-1&lt;0) continue; ll=rr=1; for(int j=0;j&lt;=m;++j) { while(ll&lt;rr&amp;&amp;q[ll]&lt;j-as[i]) ll++; while(ll&lt;rr&amp;&amp;dp[i-w-1][q[rr-1]]+q[rr-1]*ap[i]&lt;=dp[i-w-1][j]+j*ap[i]) rr--; q[rr++]=j; dp[i][j]=max(dp[i][j],dp[i-w-1][q[ll]]-(j-q[ll])*ap[i]); } ll=rr=1; for(int j=m;j&gt;=0;--j)//注意这里倒叙 { while(ll&lt;rr&amp;&amp;q[ll]&gt;j+bs[i]) ll++; while(ll&lt;rr&amp;&amp;dp[i-w-1][q[rr-1]]+q[rr-1]*bp[i]&lt;=dp[i-w-1][j]+j*bp[i]) rr--; q[rr++]=j; dp[i][j]=max(dp[i][j],dp[i-w-1][q[ll]]+(q[ll]-j)*bp[i]); } } for(int i=0;i&lt;=m;++i) ans=max(ans,dp[n][i]); printf(&quot;%d&quot;,ans); return 0; } 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/10/06/4b8ec47570ab13ebaf3a3a081163f80c.html" />
<meta property="og:url" content="https://mlh.app/2018/10/06/4b8ec47570ab13ebaf3a3a081163f80c.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-06T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/niiick/article/details/82952649 Time Limit: 5 Sec Memory Limit: 64 MB Description 最近lxhgww又迷上了投资股票，通过一段时间的观察和学习，他总结出了股票行情的一些规律。 通过一段时间的观察，lxhgww预测到了未来T天内某只股票的走势，第i天的股票买入价为每股APi，第i天的股票卖出价为每股BPi（数据保证对于每个i，都有APi&gt;=BPi），但是每天不能无限制地交易，于是股票交易所规定第i天的一次买入至多只能购买ASi股，一次卖出至多只能卖出BSi股。 另外，股票交易所还制定了两个规定。为了避免大家疯狂交易，股票交易所规定在两次交易（某一天的买入或者卖出均算是一次交易）之间，至少要间隔W天，也就是说如果在第i天发生了交易，那么从第i+1天到第i+W天，均不能发生交易。同时，为了避免垄断，股票交易所还规定在任何时间，一个人的手里的股票数不能超过MaxP。 在第1天之前，lxhgww手里有一大笔钱（可以认为钱的数目无限），但是没有任何股票，当然，T天以后，lxhgww想要赚到最多的钱，聪明的程序员们，你们能帮助他吗？ Input 输入数据第一行包括3个整数，分别是T，MaxP，W。 接下来T行，第i行代表第i-1天的股票走势，每行4个整数，分别表示APi，BPi，ASi，BSi。 Output 输出数据为一行，包括1个数字，表示lxhgww能赚到的最多的钱数。 HINT 对于30%的数据，0 &lt; =W 对于50%的数据，0 &lt; =W 对于100%的数据，0 &lt; =W 对于所有的数据，1 &lt; =BPi &lt; =APi &lt; =1000,1 &lt; =ASi,BSi &lt; =MaxP 题目分析 d p [ i ] [ j ] dp[i][j] dp[i][j]表示到第 i i i天时手上恰好有 j j j张股票的最大收益 那么有状态转移方程 dp[i][j]=-j*ap[i]//赋初值 dp[i][j]=max(dp[i][j],dp[i-1][j])//第i天啥也不干 dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])//第i天买入股票，(j-as[i]&lt;=k&lt;j) dp[i][j]=max(dp[i][j],dp[i-w-1][k]+(k-j)*bp[i])//第i天卖出股票，(j&lt;k&lt;=j+bs[i]) 直接转移复杂度为 O ( n 3 ) O(n^3) O(n3)，显然无法承受 尝试把第3、4个方程中k的枚举省去 以第3个为例 d p [ i ] [ j ] = m a x ( d p [ i ] [ j ] , d p [ i − w − 1 ] [ k ] − ( j − k ) ∗ a p [ i ] ) = m a x ( d p [ i ] [ j ] , m a x ( d p [ i − w − 1 ] [ k ] + k ∗ a p [ i ] ) − j ∗ a p [ i ] ) dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])=max(dp[i][j],max(dp[i-w-1][k]+k*ap[i])-j*ap[i]) dp[i][j]=max(dp[i][j],dp[i−w−1][k]−(j−k)∗ap[i])=max(dp[i][j],max(dp[i−w−1][k]+k∗ap[i])−j∗ap[i]) 这里面的 m a x ( d p [ i − w − 1 ] [ k ] + k ∗ a p [ i ] ) max(dp[i-w-1][k]+k*ap[i]) max(dp[i−w−1][k]+k∗ap[i])显然可以用单调队列维护 对于第4个方程同理，不过 j j j的枚举要倒序 这样复杂度就降到 O ( n 2 ) O(n^2) O(n2)了 #include&lt;iostream&gt; #include&lt;cmath&gt; #include&lt;algorithm&gt; #include&lt;queue&gt; #include&lt;cstring&gt; #include&lt;cstdio&gt; using namespace std; typedef long long lt; int read() { int f=1,x=0; char ss=getchar(); while(ss&lt;&#39;0&#39;||ss&gt;&#39;9&#39;){if(ss==&#39;-&#39;)f=-1;ss=getchar();} while(ss&gt;=&#39;0&#39;&amp;&amp;ss&lt;=&#39;9&#39;){x=x*10+ss-&#39;0&#39;;ss=getchar();} return f*x; } const int maxn=2010; int n,m,w; int ap[maxn],bp[maxn]; int as[maxn],bs[maxn]; int dp[maxn&lt;&lt;1][maxn&lt;&lt;1],ans; int q[maxn],ll,rr; int main() { n=read();m=read();w=read(); for(int i=1;i&lt;=n;++i) ap[i]=read(),bp[i]=read(), as[i]=read(),bs[i]=read(); memset(dp,128,sizeof(dp)); dp[0][0]=0; for(int i=1;i&lt;=n;++i) { for(int j=0;j&lt;=as[i];++j) dp[i][j]=-1*j*ap[i]; for(int j=0;j&lt;=m;++j) dp[i][j]=max(dp[i][j],dp[i-1][j]); if(i-w-1&lt;0) continue; ll=rr=1; for(int j=0;j&lt;=m;++j) { while(ll&lt;rr&amp;&amp;q[ll]&lt;j-as[i]) ll++; while(ll&lt;rr&amp;&amp;dp[i-w-1][q[rr-1]]+q[rr-1]*ap[i]&lt;=dp[i-w-1][j]+j*ap[i]) rr--; q[rr++]=j; dp[i][j]=max(dp[i][j],dp[i-w-1][q[ll]]-(j-q[ll])*ap[i]); } ll=rr=1; for(int j=m;j&gt;=0;--j)//注意这里倒叙 { while(ll&lt;rr&amp;&amp;q[ll]&gt;j+bs[i]) ll++; while(ll&lt;rr&amp;&amp;dp[i-w-1][q[rr-1]]+q[rr-1]*bp[i]&lt;=dp[i-w-1][j]+j*bp[i]) rr--; q[rr++]=j; dp[i][j]=max(dp[i][j],dp[i-w-1][q[ll]]+(q[ll]-j)*bp[i]); } } for(int i=0;i&lt;=m;++i) ans=max(ans,dp[n][i]); printf(&quot;%d&quot;,ans); return 0; } 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/10/06/4b8ec47570ab13ebaf3a3a081163f80c.html","headline":"BZOJ1855   洛谷P2569 [SCOI2010]股票交易【单调队列优化DP】","dateModified":"2018-10-06T00:00:00+08:00","datePublished":"2018-10-06T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/10/06/4b8ec47570ab13ebaf3a3a081163f80c.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>BZOJ1855 || 洛谷P2569 [SCOI2010]股票交易【单调队列优化DP】</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/niiick/article/details/82952649 
 </div> 
 <div class="markdown_views prism-github-gist"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>Time Limit: 5 Sec<br> Memory Limit: 64 MB</p> 
  <h4><a id="Description_2"></a><strong>Description</strong></h4> 
  <p>最近lxhgww又迷上了投资股票，通过一段时间的观察和学习，他总结出了股票行情的一些规律。 通过一段时间的观察，lxhgww预测到了未来T天内某只股票的走势，第i天的股票买入价为每股APi，第i天的股票卖出价为每股BPi（数据保证对于每个i，都有APi&gt;=BPi），但是每天不能无限制地交易，于是股票交易所规定第i天的一次买入至多只能购买ASi股，一次卖出至多只能卖出BSi股。 另外，股票交易所还制定了两个规定。为了避免大家疯狂交易，股票交易所规定在两次交易（某一天的买入或者卖出均算是一次交易）之间，至少要间隔W天，也就是说如果在第i天发生了交易，那么从第i+1天到第i+W天，均不能发生交易。同时，为了避免垄断，股票交易所还规定在任何时间，一个人的手里的股票数不能超过MaxP。 在第1天之前，lxhgww手里有一大笔钱（可以认为钱的数目无限），但是没有任何股票，当然，T天以后，lxhgww想要赚到最多的钱，聪明的程序员们，你们能帮助他吗？</p> 
  <h4><a id="Input_4"></a><strong>Input</strong></h4> 
  <p>输入数据第一行包括3个整数，分别是T，MaxP，W。 接下来T行，第i行代表第i-1天的股票走势，每行4个整数，分别表示APi，BPi，ASi，BSi。</p> 
  <h4><a id="Output_6"></a><strong>Output</strong></h4> 
  <p>输出数据为一行，包括1个数字，表示lxhgww能赚到的最多的钱数。</p> 
  <h4><a id="HINT_8"></a><strong>HINT</strong></h4> 
  <p>对于30%的数据，0 &lt; =W 对于50%的数据，0 &lt; =W 对于100%的数据，0 &lt; =W<br> 对于所有的数据，1 &lt; =BPi &lt; =APi &lt; =1000,1 &lt; =ASi,BSi &lt; =MaxP</p> 
  <hr> 
  <h4><a id="_12"></a><strong>题目分析</strong></h4> 
  <p><span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          j
         </mi>
         <mo>
          ]
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         dp[i][j]
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span></span></span>表示<strong>到第</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          i
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         i
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathit">i</span></span></span></span></span><strong>天时手上恰好有</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          j
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         j
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.05724em;">j</span></span></span></span></span><strong>张股票的最大收益</strong><br> 那么有状态转移方程</p> 
  <pre><code class="prism language-cpp">dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span>j<span class="token operator">*</span>ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token comment">//赋初值</span>
dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//第i天啥也不干</span>
dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>j<span class="token operator">-</span>k<span class="token punctuation">)</span><span class="token operator">*</span>ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//第i天买入股票，(j-as[i]&lt;=k&lt;j)</span>
dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span>k<span class="token operator">-</span>j<span class="token punctuation">)</span><span class="token operator">*</span>bp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//第i天卖出股票，(j&lt;k&lt;=j+bs[i])</span>
</code></pre> 
  <p>直接转移复杂度为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          O
         </mi>
         <mo>
          (
         </mo>
         <msup>
          <mi>
           n
          </mi>
          <mn>
           3
          </mn>
         </msup>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         O(n^3)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，显然无法承受<br> 尝试把第3、4个方程中k的枚举省去<br> 以第3个为例<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          j
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          =
         </mo>
         <mi>
          m
         </mi>
         <mi>
          a
         </mi>
         <mi>
          x
         </mi>
         <mo>
          (
         </mo>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          j
         </mi>
         <mo>
          ]
         </mo>
         <mo separator="true">
          ,
         </mo>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          −
         </mo>
         <mi>
          w
         </mi>
         <mo>
          −
         </mo>
         <mn>
          1
         </mn>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          k
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          −
         </mo>
         <mo>
          (
         </mo>
         <mi>
          j
         </mi>
         <mo>
          −
         </mo>
         <mi>
          k
         </mi>
         <mo>
          )
         </mo>
         <mo>
          ∗
         </mo>
         <mi>
          a
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          )
         </mo>
         <mo>
          =
         </mo>
         <mi>
          m
         </mi>
         <mi>
          a
         </mi>
         <mi>
          x
         </mi>
         <mo>
          (
         </mo>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          j
         </mi>
         <mo>
          ]
         </mo>
         <mo separator="true">
          ,
         </mo>
         <mi>
          m
         </mi>
         <mi>
          a
         </mi>
         <mi>
          x
         </mi>
         <mo>
          (
         </mo>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          −
         </mo>
         <mi>
          w
         </mi>
         <mo>
          −
         </mo>
         <mn>
          1
         </mn>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          k
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          +
         </mo>
         <mi>
          k
         </mi>
         <mo>
          ∗
         </mo>
         <mi>
          a
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          )
         </mo>
         <mo>
          −
         </mo>
         <mi>
          j
         </mi>
         <mo>
          ∗
         </mo>
         <mi>
          a
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         dp[i][j]=max(dp[i][j],dp[i-w-1][k]-(j-k)*ap[i])=max(dp[i][j],max(dp[i-w-1][k]+k*ap[i])-j*ap[i])
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">a</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">a</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">a</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mclose">)</span></span></span></span></span></p> 
  <p>这里面的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          m
         </mi>
         <mi>
          a
         </mi>
         <mi>
          x
         </mi>
         <mo>
          (
         </mo>
         <mi>
          d
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          −
         </mo>
         <mi>
          w
         </mi>
         <mo>
          −
         </mo>
         <mn>
          1
         </mn>
         <mo>
          ]
         </mo>
         <mo>
          [
         </mo>
         <mi>
          k
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          +
         </mo>
         <mi>
          k
         </mi>
         <mo>
          ∗
         </mo>
         <mi>
          a
         </mi>
         <mi>
          p
         </mi>
         <mo>
          [
         </mo>
         <mi>
          i
         </mi>
         <mo>
          ]
         </mo>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         max(dp[i-w-1][k]+k*ap[i])
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">a</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mclose">)</span></span></span></span></span>显然可以用<strong>单调队列</strong>维护<br> 对于第4个方程同理，不过<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          j
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         j
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.05724em;">j</span></span></span></span></span><strong>的枚举要倒序</strong></p> 
  <p>这样复杂度就降到<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          O
         </mi>
         <mo>
          (
         </mo>
         <msup>
          <mi>
           n
          </mi>
          <mn>
           2
          </mn>
         </msup>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         O(n^2)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>了</p> 
  <hr> 
  <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cmath&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;queue&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cstdio&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">long</span> lt<span class="token punctuation">;</span>
   
<span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> ss<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>ss<span class="token operator">&lt;</span><span class="token string">'0'</span><span class="token operator">||</span>ss<span class="token operator">&gt;</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>ss<span class="token operator">==</span><span class="token string">'-'</span><span class="token punctuation">)</span>f<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>ss<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>ss<span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token operator">&amp;&amp;</span>ss<span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>x<span class="token operator">=</span>x<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>ss<span class="token operator">-</span><span class="token string">'0'</span><span class="token punctuation">;</span>ss<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token operator">*</span>x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">const</span> <span class="token keyword">int</span> maxn<span class="token operator">=</span><span class="token number">2010</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">,</span>m<span class="token punctuation">,</span>w<span class="token punctuation">;</span>
<span class="token keyword">int</span> ap<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>bp<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> as<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>bs<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> dp<span class="token punctuation">[</span>maxn<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>maxn<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ans<span class="token punctuation">;</span>
<span class="token keyword">int</span> q<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>ll<span class="token punctuation">,</span>rr<span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>w<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
    ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    as<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
    <span class="token function">memset</span><span class="token punctuation">(</span>dp<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>as<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">*</span>j<span class="token operator">*</span>ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>m<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        ll<span class="token operator">=</span>rr<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>m<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>ll<span class="token operator">&lt;</span>rr<span class="token operator">&amp;&amp;</span>q<span class="token punctuation">[</span>ll<span class="token punctuation">]</span><span class="token operator">&lt;</span>j<span class="token operator">-</span>as<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> ll<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>ll<span class="token operator">&lt;</span>rr<span class="token operator">&amp;&amp;</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">[</span>rr<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span>q<span class="token punctuation">[</span>rr<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">+</span>j<span class="token operator">*</span>ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> rr<span class="token operator">--</span><span class="token punctuation">;</span>
            q<span class="token punctuation">[</span>rr<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>j<span class="token punctuation">;</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">[</span>ll<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>j<span class="token operator">-</span>q<span class="token punctuation">[</span>ll<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>ap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
          
        ll<span class="token operator">=</span>rr<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>m<span class="token punctuation">;</span>j<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token comment">//注意这里倒叙</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>ll<span class="token operator">&lt;</span>rr<span class="token operator">&amp;&amp;</span>q<span class="token punctuation">[</span>ll<span class="token punctuation">]</span><span class="token operator">&gt;</span>j<span class="token operator">+</span>bs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> ll<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>ll<span class="token operator">&lt;</span>rr<span class="token operator">&amp;&amp;</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">[</span>rr<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span>q<span class="token punctuation">[</span>rr<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>bp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">+</span>j<span class="token operator">*</span>bp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> rr<span class="token operator">--</span><span class="token punctuation">;</span>
            q<span class="token punctuation">[</span>rr<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>j<span class="token punctuation">;</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>dp<span class="token punctuation">[</span>i<span class="token operator">-</span>w<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">[</span>ll<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span>ll<span class="token punctuation">]</span><span class="token operator">-</span>j<span class="token punctuation">)</span><span class="token operator">*</span>bp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>m<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
    ans<span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span>dp<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/niiick/article/details/82952649,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/niiick/article/details/82952649,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

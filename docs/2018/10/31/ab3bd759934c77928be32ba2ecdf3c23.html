<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸‹ï¼‰ | æœ‰ç»„ç»‡åœ¨ï¼</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸‹ï¼‰" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ä¸Šä¸€ç¯‡ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸Šï¼‰æˆ‘ä»¬ä»‹ç»äº†åŸºæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬é‡ç‚¹æ¥çœ‹å®¢æˆ·ç«¯ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œæˆ‘ä»¬çš„DAppæ˜¯ä¸€ä¸ªç®€å•çš„HTML/ES6å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†åœ¨Asp.Net Core 2ä¹‹ä¸Šæ„å»ºå®¢æˆ·ç«¯ï¼Œä»¥åˆ©ç”¨IIS Expresså’ŒVisual Studio IDEã€‚å› æ­¤ï¼ŒStartup.csç±»ä¸­çš„Configureæ–¹æ³•å°†æ˜¯ï¼š if (env.IsDevelopment()) { app.UseDeveloperExceptionPage(); } app.UseDefaultFiles(); app.UseStaticFiles(); ä½¿DAppæˆä¸ºNPMé¡¹ç›®å¹¶å®‰è£…å¿…å¤‡æ¡ä»¶ä»¥ä½¿ç”¨ES6 Javascriptæ ‡å‡†ã€‚è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±çš„å †æ ˆæ„å»ºDAppã€‚ ä»é¡¹ç›®æ–‡ä»¶å¤¹è¿è¡ŒPowershellå¹¶è¿è¡Œä»¥ä¸‹NPMå‘½ä»¤ï¼š npm init npm install webpack npm install babel-core babel-loader --save-dev npm install babel-preset-es2015 --save-dev npm install babel-preset-stage-0 --save-dev npm install babel-polyfill --save npm install babel-runtime --save npm install babel-plugin-transform-runtime --save-dev è¦é…ç½®webpack/babelï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®åˆ›å»ºwebpack.config.jsæ–‡ä»¶ï¼š var path = require(&quot;path&quot;); module.exports = { entry: [ &quot;babel-polyfill&quot;, &quot;./src/main&quot; ], output: { publicPath: &quot;/js/&quot;, path: path.join(__dirname, &quot;/wwwroot/js/&quot;), filename: &quot;main.build.js&quot; } }; æˆ‘ä»¬å·²è®¾å®šwebpackå°†src/main.jsæ–‡ä»¶æ„å»ºåˆ°/www/js/main.build.jsã€‚ å®‰è£…ä»¥å¤ªåŠæ‰©å±•åŒ…ï¼š npm install web3 npm install ethereumjs-util Web3æ˜¯ä¸€ä¸ªjavascriptå°è£…åŒ…ï¼Œå®ƒç®€åŒ–äº†é’ˆå¯¹ä»¥å¤ªåŠåŒºå—é“¾çš„JSON RPCè°ƒç”¨ã€‚Ethereumjs-utilæä¾›äº†ä¸€äº›ä»¥å¤ªåŠç‰¹å®šçš„å®ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªéå¸¸ç®€å•çš„HTMLé¡µé¢ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç™»å½•æŒ‰é’®å’Œå¦ä¸€ä¸ªæŒ‰é’®æ¥ä»æˆ‘ä»¬çš„APIå±‚åŠ è½½ä¸€äº›å®‰å…¨æ•°æ®ï¼š &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot; /&gt; &lt;title&gt;Ethereum Jwt Client&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Ethereum Jwt Client&lt;/h1&gt; &lt;div id=&quot;login-view&quot;&gt; &lt;label&gt;Your account: &lt;/label&gt; &lt;span id=&quot;eth_account_span&quot;&gt;&lt;/span&gt; &lt;button type=&quot;submit&quot; id=&quot;login_btn&quot;&gt;Login&lt;/button&gt; &lt;/div&gt; &lt;div id=&quot;data-view&quot;&gt; &lt;button type=&quot;submit&quot; id=&quot;load_data_btn&quot;&gt;Request secured data&lt;/button&gt; &lt;ul id=&quot;data_list&quot;&gt; &lt;/ul&gt; &lt;/div&gt; &lt;script src=&quot;js/main.build.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; DAppé€»è¾‘å°†é©»ç•™åœ¨src/main.jsæ–‡ä»¶ä¸­ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨webpack.config.jsæ–‡ä»¶ä¸­æŒ‡å®šçš„é‚£æ ·ã€‚src/main.jsæ–‡ä»¶å°†æ˜¯ï¼š let ethUtil = require(&#39;ethereumjs-util&#39;); let Web3 = require(&#39;web3&#39;); let coinbase = null; let accessToken = null; let init = () =&gt; { if (typeof web3 !== &#39;undefined&#39;) { web3 = new Web3(web3.currentProvider); web3.eth.getCoinbase(function (err, account) { if (err === null &amp;&amp; ethUtil.isValidAddress(account)) { coinbase = account; eth_account_span.innerHTML = coinbase; } else { eth_account_span.innerHTML = &#39;Please unlock your account and refresh the page&#39;; console.error(err); } }); } else { eth_account_span.innerHTML = &#39;Please install or unlock Metamask browser plugin or navigate this page with Mist or another web3 browser&#39;; } }; let request = obj =&gt; { return new Promise((resolve, reject) =&gt; { let xhr = new XMLHttpRequest(); xhr.open(obj.method || &quot;GET&quot;, obj.url); if (obj.headers) { Object.keys(obj.headers).forEach(key =&gt; { xhr.setRequestHeader(key, obj.headers[key]); }); } xhr.onload = () =&gt; { if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) { resolve(xhr.response); } else { reject(xhr.statusText); } }; xhr.onerror = () =&gt; reject(xhr.statusText); xhr.send(obj.body); }); }; login_btn.addEventListener(&#39;click&#39;, (e) =&gt; { e.preventDefault(); login_btn.setAttribute(&#39;disabled&#39;, &#39;disabled&#39;); login_btn.innerHTML = &#39;Please sign the message&#39;; let plain = &#39;Hi, you request a login from client to Eth Jwt Api. Please sign this message. This is not a transaction, is completely free and 100% secure. We\&#39;ll use your signature to prove your ownership over your private key server side.&#39;; let msg = ethUtil.bufferToHex(new Buffer(plain, &#39;utf8&#39;)); let hash = ethUtil.bufferToHex(ethUtil.keccak256(&quot;\x19Ethereum Signed Message:\n&quot; + plain.length + plain)); let from = coinbase; let params = [msg, from]; let method = &#39;personal_sign&#39;; web3.currentProvider.sendAsync({ method, params, from, }, function (err, result) { if (err || result.error) { login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; console.error(err); return console.error(result.error); } console.log({ &#39;signature&#39;: result.result, &#39;msg&#39;: msg, &#39;hash&#39;: hash }); login_btn.innerHTML = &#39;Requesting token...&#39;; let loginData = {}; loginData.signer = from; loginData.signature = result.result; loginData.message = msg; loginData.hash = hash; request({ url: &#39;http://localhost:49443/api/token&#39;, body: JSON.stringify(loginData), method: &#39;post&#39;, headers: { &#39;Authorization&#39;: &#39;Bearer &#39; + accessToken, &#39;Content-type&#39;: &#39;application/json&#39; } }).then(data =&gt; { var json = JSON.parse(data); accessToken = json.token; console.log(&#39;access token: &#39; + accessToken); login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; }).catch(error =&gt; { console.error(error); login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; }); }); }); load_data_btn.addEventListener(&#39;click&#39;, (e) =&gt; { e.preventDefault(); request({ url: &#39;http://localhost:49443/api/values&#39;, headers: { &#39;Authorization&#39;: &#39;Bearer &#39; + accessToken } }).then(data =&gt; { var json = JSON.parse(data); for (let i = 0; i &lt; json.length; i++) { data_list.innerHTML += &#39;&lt;li&gt;&#39; + json[i] + &#39;&lt;/li&gt;&#39;; } }).catch(error =&gt; { console.error(err); }); }); window.addEventListener(&#39;load&#39;, init); 1.coinbaseå’ŒaccessTokenæ˜¯å…¨å±€å˜é‡ï¼Œåˆ†åˆ«å­˜å‚¨ç”¨æˆ·ä»¥å¤ªåŠå¸æˆ·å’ŒJWT tokenã€‚ 2.initå‡½æ•°ä»Metamaskæä¾›çš„æä¾›ç¨‹åºåˆå§‹åŒ–web3å¯¹è±¡ï¼Œç„¶åå®ƒå°è¯•æ£€ç´¢ç”¨æˆ·çš„å¸æˆ·ï¼ˆcoinbaseï¼‰ã€‚è¿™éœ€è¦è§£é”åœ¨Metamaskä¸­ç­¾åçš„å¸æˆ·ã€‚ 3.requireå‡½æ•°åªæ˜¯hxrå¯¹è±¡çš„å°è£…ï¼Œå¯ä»¥è½»æ¾åœ°å‘APIå±‚è°ƒç”¨ajaxã€‚ 4.load_data_btnå•å‡»å¤„ç†ç¨‹åºå¯¹APIå±‚å®‰å…¨ç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚è¿™éœ€è¦æœ‰æ•ˆçš„accessTokenæ‰èƒ½å·¥ä½œï¼Œå¦åˆ™ï¼ŒAPIå±‚å°†å“åº”401 HTTPå“åº”ã€‚ 5.login_btnå•å‡»æ˜¯ä¸€ä¸ªä¸¤æ­¥åŠŸèƒ½ã€‚é¦–å…ˆï¼Œå®ƒè¦æ±‚ç”¨æˆ·ç­¾ç½²ä»»æ„æ¶ˆæ¯ã€‚ç­¾ååï¼Œå®ƒä¼šå°†å¸æˆ·ï¼Œç­¾åï¼Œæ˜æ–‡æ¶ˆæ¯å’Œå¸¦å‰ç¼€çš„å“ˆå¸Œå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚ è¯·æ³¨æ„ï¼Œweb3.personal.signå°†åå…­è¿›åˆ¶æ ¼å¼ï¼ˆ0x â€¦ï¼‰çš„æ™®é€šå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ä½œä¸ºè¾“å…¥ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼ŒæœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼ä»ç­¾åä¸­æ¢å¤å…¬é’¥ï¼šåœ¨ä¸€ä¸ªä¸­æˆ‘ä»¬å°†ä½¿ç”¨JSON RPC æ¥å£ä¸­çš„web3.personal.ecrecoverï¼ˆweb3.personal.signå¯¹åº”ï¼‰;åœ¨å¦ä¸€ä¸ªä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åº•å±‚çš„ecrecoverç¦»çº¿åŠŸèƒ½ã€‚æ ¹æ®æ–‡æ¡£ï¼Œweb3.personal.signä½¿ç”¨åº•å±‚ç­¾åå‡½æ•°æ¥ç­¾ç½²hashå’Œå‰ç¼€æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œä¸ºäº†ä½¿ç”¨åº•å±‚ecrecoverå¯¹åº”ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—å¹¶å°†æ­¤hashå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚ è¿è¡Œä¸¤ä¸ªåº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨å®‰è£…äº†Metamaskæ’ä»¶çš„æµè§ˆå™¨å¯¼èˆªåˆ°å®¢æˆ·ç«¯ã€‚è¯·è®°ä½ï¼Œä¸ºäº†å°†src/main.jsæ–‡ä»¶æ„å»ºåˆ°js/main.build.jsï¼Œä½ éœ€è¦ä»Powershellè¿è¡Œwebpacå‘½ä»¤ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå®¢æˆ·ç«¯å°†æ£€ç´¢coinbaseï¼Œä½ å°†åœ¨é¡µé¢ä¸Šçœ‹åˆ°ä½ çš„å¸æˆ·ï¼š å¦‚æœä½ ç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†è·å¾—HTTPå“åº”401ã€‚å¦‚æœå•å‡»â€œç™»å½•â€æŒ‰é’®ï¼ŒMetamaskå°†æç¤ºä½ ç­¾åï¼š ç­¾ååï¼Œå¤„ç†ç¨‹åºå°†å¯¹ä»¤ç‰Œç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚åœ¨æ­¤é˜¶æ®µï¼Œèº«ä»½éªŒè¯æ–¹æ³•ä¸ä¼šæ£€æŸ¥ä»»ä½•ç­¾åï¼Œå› æ­¤ç«¯ç‚¹å°†å§‹ç»ˆå‘å‡ºJWTä»¤ç‰Œã€‚ä¸€æ—¦æ”¶åˆ°JWTä»¤ç‰Œï¼Œå®¢æˆ·ç«¯å°±èƒ½é€šè¿‡ajaxè°ƒç”¨å®‰å…¨ç«¯ç‚¹ã€‚å¦‚æœç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†æ”¶åˆ°HTTPå“åº”200å’Œæ•°æ®è´Ÿè½½ï¼š ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ· åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒEthereumJwtApiæ˜¯ä¸€ä¸ªç®€å•çš„JWT Asp.Netæ ¸å¿ƒç¤ºä¾‹ï¼Œå› ä¸ºå®ƒä¸æä¾›ä»»ä½•æœ‰æ•ˆçš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚ TokenControllerçš„å…³é”®éƒ¨åˆ†æ˜¯ä¸¤ä¸ªAuthenticateæ–¹æ³•åŠå…¶ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ·çš„èƒ½åŠ›ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å®‰è£…Nethereum.Web3 NuGetåŒ…ã€‚Nethereumæ˜¯ä»¥å¤ªåŠçš„.Netå®ç°ã€‚ Authenticateæ–¹æ³•åªæ˜¯å¯¹web3.personal.ecrecoverå‡½æ•°è¿›è¡ŒJSON RPCè°ƒç”¨ï¼š private async Task&lt;UserVM&gt; Authenticate(LoginVM login) { UserVM user = null; var client = new RpcClient(new Uri(_config[&quot;Nethereum:Geth&quot;])); // Require the RPC endpoint of a Geth node as input eg: http://127.0.0.1:8545 var signer = await client.SendRequestAsync&lt;string&gt;(new RpcRequest(1, &quot;personal_ecRecover&quot;, login.Message, login.Signature)); if (signer.ToLower().Equals(login.Signer.ToLower())) { // read user from DB or create a new one // for now we fake a new user user = new UserVM { Account = signer, Name = string.Empty, Email = string.Empty }; } return user; } PROï¼š web3.personal.signæ˜¯web3.personal.signçš„å¯¹åº”éƒ¨åˆ†ï¼Œå› æ­¤ä½ æ— éœ€æ‹…å¿ƒå…¶åº•å±‚å®ç°ã€‚ ç¼ºç‚¹ï¼š éœ€è¦ä½ è‡ªå·±çš„GethèŠ‚ç‚¹ã€‚ä¸æ”¯æŒParityï¼ŒInfuraä¸å…è®¸JSON RPCè°ƒç”¨web3.personal.*ã€‚Authenticate2æ–¹æ³•æ˜¾ç¤ºäº†å¦ä¸€ç§æ–¹æ³•ï¼Œå®ƒä½¿ç”¨åº•å±‚ecrecoveråŠŸèƒ½çš„ç¦»çº¿å®ç°ï¼š private async Task&lt;UserVM&gt; Authenticate2(LoginVM login) { UserVM user = null; var signer = new Nethereum.Signer.MessageSigner(); var account = signer.EcRecover(login.Hash.HexToByteArray(), login.Signature); if (account.ToLower().Equals(login.Signer.ToLower())) { // read user from DB or create a new one // for now we fake a new user user = new UserVM { Account = account, Name = string.Empty, Email = string.Empty }; } return user; } PROï¼š ä¸éœ€è¦JSON RPCè°ƒç”¨å°±èƒ½å·¥ä½œã€‚MessageSigner.EcRecoveræ˜¯Nethereumæä¾›çš„ç¦»çº¿åŠŸèƒ½ã€‚ ç¼ºç‚¹ï¼š ä½ éœ€è¦å¤„ç†web3.personal.signå®ç°æ‰èƒ½æ­£ç¡®æ¢å¤å¸æˆ·ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç›¸åº”åœ°è®¡ç®—äº†å‰ç¼€æ¶ˆæ¯å“ˆå¸Œã€‚ ç»“è®º ç°åœ¨ä½ æ‹¥æœ‰åŸºæœ¬çš„çŸ¥è¯†å’Œä¸€ä¸ªé¡¹ç›®çš„éª¨æ¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥å¤ªåŠä¿æŠ¤ä½ çš„Asp.Net Core 2 APIã€‚åªéœ€å‡ ç‚¹è¯´æ˜ï¼š web3 1.0.0å¤„äºæµ‹è¯•é˜¶æ®µï¼Œweb3.personal.signå®ç°å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ã€‚è¯·åŠ¡å¿…åœ¨ä½ å¯ä»¥ç»´æŠ¤çš„ä»£ç åº“ä¸Šä½¿ç”¨è¿™ç§èº«ä»½éªŒè¯æ–¹æ³•ã€‚ä¹Ÿè®¸InfuraæŸå¤©å†³å®šå…è®¸web3.personal.ecrecover ğŸ˜ƒ ====================================================================== åˆ†äº«ä¸€äº›ä»¥å¤ªåŠã€EOSã€æ¯”ç‰¹å¸ç­‰åŒºå—é“¾ç›¸å…³çš„äº¤äº’å¼åœ¨çº¿ç¼–ç¨‹å®æˆ˜æ•™ç¨‹ï¼š javaä»¥å¤ªåŠå¼€å‘æ•™ç¨‹ï¼Œä¸»è¦æ˜¯é’ˆå¯¹javaå’Œandroidç¨‹åºå‘˜è¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„web3jè¯¦è§£ã€‚ pythonä»¥å¤ªåŠï¼Œä¸»è¦æ˜¯é’ˆå¯¹pythonå·¥ç¨‹å¸ˆä½¿ç”¨web3.pyè¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„è¯¦è§£ã€‚ phpä»¥å¤ªåŠï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨phpè¿›è¡Œæ™ºèƒ½åˆçº¦å¼€å‘äº¤äº’ï¼Œè¿›è¡Œè´¦å·åˆ›å»ºã€äº¤æ˜“ã€è½¬è´¦ã€ä»£å¸å¼€å‘ä»¥åŠè¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰å†…å®¹ã€‚ ä»¥å¤ªåŠå…¥é—¨æ•™ç¨‹ï¼Œä¸»è¦ä»‹ç»æ™ºèƒ½åˆçº¦ä¸dappåº”ç”¨å¼€å‘ï¼Œé€‚åˆå…¥é—¨ã€‚ ä»¥å¤ªåŠå¼€å‘è¿›é˜¶æ•™ç¨‹ï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨node.jsã€mongodbã€åŒºå—é“¾ã€ipfså®ç°å»ä¸­å¿ƒåŒ–ç”µå•†DAppå®æˆ˜ï¼Œé€‚åˆè¿›é˜¶ã€‚ C#ä»¥å¤ªåŠï¼Œä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨C#å¼€å‘åŸºäº.Netçš„ä»¥å¤ªåŠåº”ç”¨ï¼ŒåŒ…æ‹¬è´¦æˆ·ç®¡ç†ã€çŠ¶æ€ä¸äº¤æ˜“ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸äº¤äº’ã€è¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰ã€‚ EOSæ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨EOSåŒºå—é“¾å»ä¸­å¿ƒåŒ–åº”ç”¨çš„å¼€å‘ï¼Œå†…å®¹æ¶µç›–EOSå·¥å…·é“¾ã€è´¦æˆ·ä¸é’±åŒ…ã€å‘è¡Œä»£å¸ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸éƒ¨ç½²ã€ä½¿ç”¨ä»£ç ä¸æ™ºèƒ½åˆçº¦äº¤äº’ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæœ€åç»¼åˆè¿ç”¨å„çŸ¥è¯†ç‚¹å®Œæˆä¸€ä¸ªä¾¿ç­¾DAppçš„å¼€å‘ã€‚ javaæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Javaä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Javaå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚ phpæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Phpä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Phpå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚ æ±‡æ™ºç½‘åŸåˆ›ç¿»è¯‘ï¼Œè½¬è½½è¯·æ ‡æ˜å‡ºå¤„ã€‚è¿™é‡Œæ˜¯åŸæ–‡ é˜…è¯»æ›´å¤š" />
<meta property="og:description" content="ä¸Šä¸€ç¯‡ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸Šï¼‰æˆ‘ä»¬ä»‹ç»äº†åŸºæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬é‡ç‚¹æ¥çœ‹å®¢æˆ·ç«¯ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œæˆ‘ä»¬çš„DAppæ˜¯ä¸€ä¸ªç®€å•çš„HTML/ES6å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†åœ¨Asp.Net Core 2ä¹‹ä¸Šæ„å»ºå®¢æˆ·ç«¯ï¼Œä»¥åˆ©ç”¨IIS Expresså’ŒVisual Studio IDEã€‚å› æ­¤ï¼ŒStartup.csç±»ä¸­çš„Configureæ–¹æ³•å°†æ˜¯ï¼š if (env.IsDevelopment()) { app.UseDeveloperExceptionPage(); } app.UseDefaultFiles(); app.UseStaticFiles(); ä½¿DAppæˆä¸ºNPMé¡¹ç›®å¹¶å®‰è£…å¿…å¤‡æ¡ä»¶ä»¥ä½¿ç”¨ES6 Javascriptæ ‡å‡†ã€‚è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±çš„å †æ ˆæ„å»ºDAppã€‚ ä»é¡¹ç›®æ–‡ä»¶å¤¹è¿è¡ŒPowershellå¹¶è¿è¡Œä»¥ä¸‹NPMå‘½ä»¤ï¼š npm init npm install webpack npm install babel-core babel-loader --save-dev npm install babel-preset-es2015 --save-dev npm install babel-preset-stage-0 --save-dev npm install babel-polyfill --save npm install babel-runtime --save npm install babel-plugin-transform-runtime --save-dev è¦é…ç½®webpack/babelï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®åˆ›å»ºwebpack.config.jsæ–‡ä»¶ï¼š var path = require(&quot;path&quot;); module.exports = { entry: [ &quot;babel-polyfill&quot;, &quot;./src/main&quot; ], output: { publicPath: &quot;/js/&quot;, path: path.join(__dirname, &quot;/wwwroot/js/&quot;), filename: &quot;main.build.js&quot; } }; æˆ‘ä»¬å·²è®¾å®šwebpackå°†src/main.jsæ–‡ä»¶æ„å»ºåˆ°/www/js/main.build.jsã€‚ å®‰è£…ä»¥å¤ªåŠæ‰©å±•åŒ…ï¼š npm install web3 npm install ethereumjs-util Web3æ˜¯ä¸€ä¸ªjavascriptå°è£…åŒ…ï¼Œå®ƒç®€åŒ–äº†é’ˆå¯¹ä»¥å¤ªåŠåŒºå—é“¾çš„JSON RPCè°ƒç”¨ã€‚Ethereumjs-utilæä¾›äº†ä¸€äº›ä»¥å¤ªåŠç‰¹å®šçš„å®ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªéå¸¸ç®€å•çš„HTMLé¡µé¢ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç™»å½•æŒ‰é’®å’Œå¦ä¸€ä¸ªæŒ‰é’®æ¥ä»æˆ‘ä»¬çš„APIå±‚åŠ è½½ä¸€äº›å®‰å…¨æ•°æ®ï¼š &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot; /&gt; &lt;title&gt;Ethereum Jwt Client&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Ethereum Jwt Client&lt;/h1&gt; &lt;div id=&quot;login-view&quot;&gt; &lt;label&gt;Your account: &lt;/label&gt; &lt;span id=&quot;eth_account_span&quot;&gt;&lt;/span&gt; &lt;button type=&quot;submit&quot; id=&quot;login_btn&quot;&gt;Login&lt;/button&gt; &lt;/div&gt; &lt;div id=&quot;data-view&quot;&gt; &lt;button type=&quot;submit&quot; id=&quot;load_data_btn&quot;&gt;Request secured data&lt;/button&gt; &lt;ul id=&quot;data_list&quot;&gt; &lt;/ul&gt; &lt;/div&gt; &lt;script src=&quot;js/main.build.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; DAppé€»è¾‘å°†é©»ç•™åœ¨src/main.jsæ–‡ä»¶ä¸­ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨webpack.config.jsæ–‡ä»¶ä¸­æŒ‡å®šçš„é‚£æ ·ã€‚src/main.jsæ–‡ä»¶å°†æ˜¯ï¼š let ethUtil = require(&#39;ethereumjs-util&#39;); let Web3 = require(&#39;web3&#39;); let coinbase = null; let accessToken = null; let init = () =&gt; { if (typeof web3 !== &#39;undefined&#39;) { web3 = new Web3(web3.currentProvider); web3.eth.getCoinbase(function (err, account) { if (err === null &amp;&amp; ethUtil.isValidAddress(account)) { coinbase = account; eth_account_span.innerHTML = coinbase; } else { eth_account_span.innerHTML = &#39;Please unlock your account and refresh the page&#39;; console.error(err); } }); } else { eth_account_span.innerHTML = &#39;Please install or unlock Metamask browser plugin or navigate this page with Mist or another web3 browser&#39;; } }; let request = obj =&gt; { return new Promise((resolve, reject) =&gt; { let xhr = new XMLHttpRequest(); xhr.open(obj.method || &quot;GET&quot;, obj.url); if (obj.headers) { Object.keys(obj.headers).forEach(key =&gt; { xhr.setRequestHeader(key, obj.headers[key]); }); } xhr.onload = () =&gt; { if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) { resolve(xhr.response); } else { reject(xhr.statusText); } }; xhr.onerror = () =&gt; reject(xhr.statusText); xhr.send(obj.body); }); }; login_btn.addEventListener(&#39;click&#39;, (e) =&gt; { e.preventDefault(); login_btn.setAttribute(&#39;disabled&#39;, &#39;disabled&#39;); login_btn.innerHTML = &#39;Please sign the message&#39;; let plain = &#39;Hi, you request a login from client to Eth Jwt Api. Please sign this message. This is not a transaction, is completely free and 100% secure. We\&#39;ll use your signature to prove your ownership over your private key server side.&#39;; let msg = ethUtil.bufferToHex(new Buffer(plain, &#39;utf8&#39;)); let hash = ethUtil.bufferToHex(ethUtil.keccak256(&quot;\x19Ethereum Signed Message:\n&quot; + plain.length + plain)); let from = coinbase; let params = [msg, from]; let method = &#39;personal_sign&#39;; web3.currentProvider.sendAsync({ method, params, from, }, function (err, result) { if (err || result.error) { login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; console.error(err); return console.error(result.error); } console.log({ &#39;signature&#39;: result.result, &#39;msg&#39;: msg, &#39;hash&#39;: hash }); login_btn.innerHTML = &#39;Requesting token...&#39;; let loginData = {}; loginData.signer = from; loginData.signature = result.result; loginData.message = msg; loginData.hash = hash; request({ url: &#39;http://localhost:49443/api/token&#39;, body: JSON.stringify(loginData), method: &#39;post&#39;, headers: { &#39;Authorization&#39;: &#39;Bearer &#39; + accessToken, &#39;Content-type&#39;: &#39;application/json&#39; } }).then(data =&gt; { var json = JSON.parse(data); accessToken = json.token; console.log(&#39;access token: &#39; + accessToken); login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; }).catch(error =&gt; { console.error(error); login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; }); }); }); load_data_btn.addEventListener(&#39;click&#39;, (e) =&gt; { e.preventDefault(); request({ url: &#39;http://localhost:49443/api/values&#39;, headers: { &#39;Authorization&#39;: &#39;Bearer &#39; + accessToken } }).then(data =&gt; { var json = JSON.parse(data); for (let i = 0; i &lt; json.length; i++) { data_list.innerHTML += &#39;&lt;li&gt;&#39; + json[i] + &#39;&lt;/li&gt;&#39;; } }).catch(error =&gt; { console.error(err); }); }); window.addEventListener(&#39;load&#39;, init); 1.coinbaseå’ŒaccessTokenæ˜¯å…¨å±€å˜é‡ï¼Œåˆ†åˆ«å­˜å‚¨ç”¨æˆ·ä»¥å¤ªåŠå¸æˆ·å’ŒJWT tokenã€‚ 2.initå‡½æ•°ä»Metamaskæä¾›çš„æä¾›ç¨‹åºåˆå§‹åŒ–web3å¯¹è±¡ï¼Œç„¶åå®ƒå°è¯•æ£€ç´¢ç”¨æˆ·çš„å¸æˆ·ï¼ˆcoinbaseï¼‰ã€‚è¿™éœ€è¦è§£é”åœ¨Metamaskä¸­ç­¾åçš„å¸æˆ·ã€‚ 3.requireå‡½æ•°åªæ˜¯hxrå¯¹è±¡çš„å°è£…ï¼Œå¯ä»¥è½»æ¾åœ°å‘APIå±‚è°ƒç”¨ajaxã€‚ 4.load_data_btnå•å‡»å¤„ç†ç¨‹åºå¯¹APIå±‚å®‰å…¨ç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚è¿™éœ€è¦æœ‰æ•ˆçš„accessTokenæ‰èƒ½å·¥ä½œï¼Œå¦åˆ™ï¼ŒAPIå±‚å°†å“åº”401 HTTPå“åº”ã€‚ 5.login_btnå•å‡»æ˜¯ä¸€ä¸ªä¸¤æ­¥åŠŸèƒ½ã€‚é¦–å…ˆï¼Œå®ƒè¦æ±‚ç”¨æˆ·ç­¾ç½²ä»»æ„æ¶ˆæ¯ã€‚ç­¾ååï¼Œå®ƒä¼šå°†å¸æˆ·ï¼Œç­¾åï¼Œæ˜æ–‡æ¶ˆæ¯å’Œå¸¦å‰ç¼€çš„å“ˆå¸Œå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚ è¯·æ³¨æ„ï¼Œweb3.personal.signå°†åå…­è¿›åˆ¶æ ¼å¼ï¼ˆ0x â€¦ï¼‰çš„æ™®é€šå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ä½œä¸ºè¾“å…¥ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼ŒæœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼ä»ç­¾åä¸­æ¢å¤å…¬é’¥ï¼šåœ¨ä¸€ä¸ªä¸­æˆ‘ä»¬å°†ä½¿ç”¨JSON RPC æ¥å£ä¸­çš„web3.personal.ecrecoverï¼ˆweb3.personal.signå¯¹åº”ï¼‰;åœ¨å¦ä¸€ä¸ªä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åº•å±‚çš„ecrecoverç¦»çº¿åŠŸèƒ½ã€‚æ ¹æ®æ–‡æ¡£ï¼Œweb3.personal.signä½¿ç”¨åº•å±‚ç­¾åå‡½æ•°æ¥ç­¾ç½²hashå’Œå‰ç¼€æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œä¸ºäº†ä½¿ç”¨åº•å±‚ecrecoverå¯¹åº”ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—å¹¶å°†æ­¤hashå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚ è¿è¡Œä¸¤ä¸ªåº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨å®‰è£…äº†Metamaskæ’ä»¶çš„æµè§ˆå™¨å¯¼èˆªåˆ°å®¢æˆ·ç«¯ã€‚è¯·è®°ä½ï¼Œä¸ºäº†å°†src/main.jsæ–‡ä»¶æ„å»ºåˆ°js/main.build.jsï¼Œä½ éœ€è¦ä»Powershellè¿è¡Œwebpacå‘½ä»¤ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå®¢æˆ·ç«¯å°†æ£€ç´¢coinbaseï¼Œä½ å°†åœ¨é¡µé¢ä¸Šçœ‹åˆ°ä½ çš„å¸æˆ·ï¼š å¦‚æœä½ ç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†è·å¾—HTTPå“åº”401ã€‚å¦‚æœå•å‡»â€œç™»å½•â€æŒ‰é’®ï¼ŒMetamaskå°†æç¤ºä½ ç­¾åï¼š ç­¾ååï¼Œå¤„ç†ç¨‹åºå°†å¯¹ä»¤ç‰Œç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚åœ¨æ­¤é˜¶æ®µï¼Œèº«ä»½éªŒè¯æ–¹æ³•ä¸ä¼šæ£€æŸ¥ä»»ä½•ç­¾åï¼Œå› æ­¤ç«¯ç‚¹å°†å§‹ç»ˆå‘å‡ºJWTä»¤ç‰Œã€‚ä¸€æ—¦æ”¶åˆ°JWTä»¤ç‰Œï¼Œå®¢æˆ·ç«¯å°±èƒ½é€šè¿‡ajaxè°ƒç”¨å®‰å…¨ç«¯ç‚¹ã€‚å¦‚æœç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†æ”¶åˆ°HTTPå“åº”200å’Œæ•°æ®è´Ÿè½½ï¼š ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ· åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒEthereumJwtApiæ˜¯ä¸€ä¸ªç®€å•çš„JWT Asp.Netæ ¸å¿ƒç¤ºä¾‹ï¼Œå› ä¸ºå®ƒä¸æä¾›ä»»ä½•æœ‰æ•ˆçš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚ TokenControllerçš„å…³é”®éƒ¨åˆ†æ˜¯ä¸¤ä¸ªAuthenticateæ–¹æ³•åŠå…¶ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ·çš„èƒ½åŠ›ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å®‰è£…Nethereum.Web3 NuGetåŒ…ã€‚Nethereumæ˜¯ä»¥å¤ªåŠçš„.Netå®ç°ã€‚ Authenticateæ–¹æ³•åªæ˜¯å¯¹web3.personal.ecrecoverå‡½æ•°è¿›è¡ŒJSON RPCè°ƒç”¨ï¼š private async Task&lt;UserVM&gt; Authenticate(LoginVM login) { UserVM user = null; var client = new RpcClient(new Uri(_config[&quot;Nethereum:Geth&quot;])); // Require the RPC endpoint of a Geth node as input eg: http://127.0.0.1:8545 var signer = await client.SendRequestAsync&lt;string&gt;(new RpcRequest(1, &quot;personal_ecRecover&quot;, login.Message, login.Signature)); if (signer.ToLower().Equals(login.Signer.ToLower())) { // read user from DB or create a new one // for now we fake a new user user = new UserVM { Account = signer, Name = string.Empty, Email = string.Empty }; } return user; } PROï¼š web3.personal.signæ˜¯web3.personal.signçš„å¯¹åº”éƒ¨åˆ†ï¼Œå› æ­¤ä½ æ— éœ€æ‹…å¿ƒå…¶åº•å±‚å®ç°ã€‚ ç¼ºç‚¹ï¼š éœ€è¦ä½ è‡ªå·±çš„GethèŠ‚ç‚¹ã€‚ä¸æ”¯æŒParityï¼ŒInfuraä¸å…è®¸JSON RPCè°ƒç”¨web3.personal.*ã€‚Authenticate2æ–¹æ³•æ˜¾ç¤ºäº†å¦ä¸€ç§æ–¹æ³•ï¼Œå®ƒä½¿ç”¨åº•å±‚ecrecoveråŠŸèƒ½çš„ç¦»çº¿å®ç°ï¼š private async Task&lt;UserVM&gt; Authenticate2(LoginVM login) { UserVM user = null; var signer = new Nethereum.Signer.MessageSigner(); var account = signer.EcRecover(login.Hash.HexToByteArray(), login.Signature); if (account.ToLower().Equals(login.Signer.ToLower())) { // read user from DB or create a new one // for now we fake a new user user = new UserVM { Account = account, Name = string.Empty, Email = string.Empty }; } return user; } PROï¼š ä¸éœ€è¦JSON RPCè°ƒç”¨å°±èƒ½å·¥ä½œã€‚MessageSigner.EcRecoveræ˜¯Nethereumæä¾›çš„ç¦»çº¿åŠŸèƒ½ã€‚ ç¼ºç‚¹ï¼š ä½ éœ€è¦å¤„ç†web3.personal.signå®ç°æ‰èƒ½æ­£ç¡®æ¢å¤å¸æˆ·ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç›¸åº”åœ°è®¡ç®—äº†å‰ç¼€æ¶ˆæ¯å“ˆå¸Œã€‚ ç»“è®º ç°åœ¨ä½ æ‹¥æœ‰åŸºæœ¬çš„çŸ¥è¯†å’Œä¸€ä¸ªé¡¹ç›®çš„éª¨æ¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥å¤ªåŠä¿æŠ¤ä½ çš„Asp.Net Core 2 APIã€‚åªéœ€å‡ ç‚¹è¯´æ˜ï¼š web3 1.0.0å¤„äºæµ‹è¯•é˜¶æ®µï¼Œweb3.personal.signå®ç°å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ã€‚è¯·åŠ¡å¿…åœ¨ä½ å¯ä»¥ç»´æŠ¤çš„ä»£ç åº“ä¸Šä½¿ç”¨è¿™ç§èº«ä»½éªŒè¯æ–¹æ³•ã€‚ä¹Ÿè®¸InfuraæŸå¤©å†³å®šå…è®¸web3.personal.ecrecover ğŸ˜ƒ ====================================================================== åˆ†äº«ä¸€äº›ä»¥å¤ªåŠã€EOSã€æ¯”ç‰¹å¸ç­‰åŒºå—é“¾ç›¸å…³çš„äº¤äº’å¼åœ¨çº¿ç¼–ç¨‹å®æˆ˜æ•™ç¨‹ï¼š javaä»¥å¤ªåŠå¼€å‘æ•™ç¨‹ï¼Œä¸»è¦æ˜¯é’ˆå¯¹javaå’Œandroidç¨‹åºå‘˜è¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„web3jè¯¦è§£ã€‚ pythonä»¥å¤ªåŠï¼Œä¸»è¦æ˜¯é’ˆå¯¹pythonå·¥ç¨‹å¸ˆä½¿ç”¨web3.pyè¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„è¯¦è§£ã€‚ phpä»¥å¤ªåŠï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨phpè¿›è¡Œæ™ºèƒ½åˆçº¦å¼€å‘äº¤äº’ï¼Œè¿›è¡Œè´¦å·åˆ›å»ºã€äº¤æ˜“ã€è½¬è´¦ã€ä»£å¸å¼€å‘ä»¥åŠè¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰å†…å®¹ã€‚ ä»¥å¤ªåŠå…¥é—¨æ•™ç¨‹ï¼Œä¸»è¦ä»‹ç»æ™ºèƒ½åˆçº¦ä¸dappåº”ç”¨å¼€å‘ï¼Œé€‚åˆå…¥é—¨ã€‚ ä»¥å¤ªåŠå¼€å‘è¿›é˜¶æ•™ç¨‹ï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨node.jsã€mongodbã€åŒºå—é“¾ã€ipfså®ç°å»ä¸­å¿ƒåŒ–ç”µå•†DAppå®æˆ˜ï¼Œé€‚åˆè¿›é˜¶ã€‚ C#ä»¥å¤ªåŠï¼Œä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨C#å¼€å‘åŸºäº.Netçš„ä»¥å¤ªåŠåº”ç”¨ï¼ŒåŒ…æ‹¬è´¦æˆ·ç®¡ç†ã€çŠ¶æ€ä¸äº¤æ˜“ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸äº¤äº’ã€è¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰ã€‚ EOSæ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨EOSåŒºå—é“¾å»ä¸­å¿ƒåŒ–åº”ç”¨çš„å¼€å‘ï¼Œå†…å®¹æ¶µç›–EOSå·¥å…·é“¾ã€è´¦æˆ·ä¸é’±åŒ…ã€å‘è¡Œä»£å¸ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸éƒ¨ç½²ã€ä½¿ç”¨ä»£ç ä¸æ™ºèƒ½åˆçº¦äº¤äº’ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæœ€åç»¼åˆè¿ç”¨å„çŸ¥è¯†ç‚¹å®Œæˆä¸€ä¸ªä¾¿ç­¾DAppçš„å¼€å‘ã€‚ javaæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Javaä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Javaå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚ phpæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Phpä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Phpå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚ æ±‡æ™ºç½‘åŸåˆ›ç¿»è¯‘ï¼Œè½¬è½½è¯·æ ‡æ˜å‡ºå¤„ã€‚è¿™é‡Œæ˜¯åŸæ–‡ é˜…è¯»æ›´å¤š" />
<meta property="og:site_name" content="æœ‰ç»„ç»‡åœ¨ï¼" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-31T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"ä¸Šä¸€ç¯‡ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸Šï¼‰æˆ‘ä»¬ä»‹ç»äº†åŸºæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬é‡ç‚¹æ¥çœ‹å®¢æˆ·ç«¯ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œæˆ‘ä»¬çš„DAppæ˜¯ä¸€ä¸ªç®€å•çš„HTML/ES6å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å°†åœ¨Asp.Net Core 2ä¹‹ä¸Šæ„å»ºå®¢æˆ·ç«¯ï¼Œä»¥åˆ©ç”¨IIS Expresså’ŒVisual Studio IDEã€‚å› æ­¤ï¼ŒStartup.csç±»ä¸­çš„Configureæ–¹æ³•å°†æ˜¯ï¼š if (env.IsDevelopment()) { app.UseDeveloperExceptionPage(); } app.UseDefaultFiles(); app.UseStaticFiles(); ä½¿DAppæˆä¸ºNPMé¡¹ç›®å¹¶å®‰è£…å¿…å¤‡æ¡ä»¶ä»¥ä½¿ç”¨ES6 Javascriptæ ‡å‡†ã€‚è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±çš„å †æ ˆæ„å»ºDAppã€‚ ä»é¡¹ç›®æ–‡ä»¶å¤¹è¿è¡ŒPowershellå¹¶è¿è¡Œä»¥ä¸‹NPMå‘½ä»¤ï¼š npm init npm install webpack npm install babel-core babel-loader --save-dev npm install babel-preset-es2015 --save-dev npm install babel-preset-stage-0 --save-dev npm install babel-polyfill --save npm install babel-runtime --save npm install babel-plugin-transform-runtime --save-dev è¦é…ç½®webpack/babelï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®åˆ›å»ºwebpack.config.jsæ–‡ä»¶ï¼š var path = require(&quot;path&quot;); module.exports = { entry: [ &quot;babel-polyfill&quot;, &quot;./src/main&quot; ], output: { publicPath: &quot;/js/&quot;, path: path.join(__dirname, &quot;/wwwroot/js/&quot;), filename: &quot;main.build.js&quot; } }; æˆ‘ä»¬å·²è®¾å®šwebpackå°†src/main.jsæ–‡ä»¶æ„å»ºåˆ°/www/js/main.build.jsã€‚ å®‰è£…ä»¥å¤ªåŠæ‰©å±•åŒ…ï¼š npm install web3 npm install ethereumjs-util Web3æ˜¯ä¸€ä¸ªjavascriptå°è£…åŒ…ï¼Œå®ƒç®€åŒ–äº†é’ˆå¯¹ä»¥å¤ªåŠåŒºå—é“¾çš„JSON RPCè°ƒç”¨ã€‚Ethereumjs-utilæä¾›äº†ä¸€äº›ä»¥å¤ªåŠç‰¹å®šçš„å®ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªéå¸¸ç®€å•çš„HTMLé¡µé¢ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç™»å½•æŒ‰é’®å’Œå¦ä¸€ä¸ªæŒ‰é’®æ¥ä»æˆ‘ä»¬çš„APIå±‚åŠ è½½ä¸€äº›å®‰å…¨æ•°æ®ï¼š &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot; /&gt; &lt;title&gt;Ethereum Jwt Client&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Ethereum Jwt Client&lt;/h1&gt; &lt;div id=&quot;login-view&quot;&gt; &lt;label&gt;Your account: &lt;/label&gt; &lt;span id=&quot;eth_account_span&quot;&gt;&lt;/span&gt; &lt;button type=&quot;submit&quot; id=&quot;login_btn&quot;&gt;Login&lt;/button&gt; &lt;/div&gt; &lt;div id=&quot;data-view&quot;&gt; &lt;button type=&quot;submit&quot; id=&quot;load_data_btn&quot;&gt;Request secured data&lt;/button&gt; &lt;ul id=&quot;data_list&quot;&gt; &lt;/ul&gt; &lt;/div&gt; &lt;script src=&quot;js/main.build.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; DAppé€»è¾‘å°†é©»ç•™åœ¨src/main.jsæ–‡ä»¶ä¸­ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨webpack.config.jsæ–‡ä»¶ä¸­æŒ‡å®šçš„é‚£æ ·ã€‚src/main.jsæ–‡ä»¶å°†æ˜¯ï¼š let ethUtil = require(&#39;ethereumjs-util&#39;); let Web3 = require(&#39;web3&#39;); let coinbase = null; let accessToken = null; let init = () =&gt; { if (typeof web3 !== &#39;undefined&#39;) { web3 = new Web3(web3.currentProvider); web3.eth.getCoinbase(function (err, account) { if (err === null &amp;&amp; ethUtil.isValidAddress(account)) { coinbase = account; eth_account_span.innerHTML = coinbase; } else { eth_account_span.innerHTML = &#39;Please unlock your account and refresh the page&#39;; console.error(err); } }); } else { eth_account_span.innerHTML = &#39;Please install or unlock Metamask browser plugin or navigate this page with Mist or another web3 browser&#39;; } }; let request = obj =&gt; { return new Promise((resolve, reject) =&gt; { let xhr = new XMLHttpRequest(); xhr.open(obj.method || &quot;GET&quot;, obj.url); if (obj.headers) { Object.keys(obj.headers).forEach(key =&gt; { xhr.setRequestHeader(key, obj.headers[key]); }); } xhr.onload = () =&gt; { if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) { resolve(xhr.response); } else { reject(xhr.statusText); } }; xhr.onerror = () =&gt; reject(xhr.statusText); xhr.send(obj.body); }); }; login_btn.addEventListener(&#39;click&#39;, (e) =&gt; { e.preventDefault(); login_btn.setAttribute(&#39;disabled&#39;, &#39;disabled&#39;); login_btn.innerHTML = &#39;Please sign the message&#39;; let plain = &#39;Hi, you request a login from client to Eth Jwt Api. Please sign this message. This is not a transaction, is completely free and 100% secure. We\\&#39;ll use your signature to prove your ownership over your private key server side.&#39;; let msg = ethUtil.bufferToHex(new Buffer(plain, &#39;utf8&#39;)); let hash = ethUtil.bufferToHex(ethUtil.keccak256(&quot;\\x19Ethereum Signed Message:\\n&quot; + plain.length + plain)); let from = coinbase; let params = [msg, from]; let method = &#39;personal_sign&#39;; web3.currentProvider.sendAsync({ method, params, from, }, function (err, result) { if (err || result.error) { login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; console.error(err); return console.error(result.error); } console.log({ &#39;signature&#39;: result.result, &#39;msg&#39;: msg, &#39;hash&#39;: hash }); login_btn.innerHTML = &#39;Requesting token...&#39;; let loginData = {}; loginData.signer = from; loginData.signature = result.result; loginData.message = msg; loginData.hash = hash; request({ url: &#39;http://localhost:49443/api/token&#39;, body: JSON.stringify(loginData), method: &#39;post&#39;, headers: { &#39;Authorization&#39;: &#39;Bearer &#39; + accessToken, &#39;Content-type&#39;: &#39;application/json&#39; } }).then(data =&gt; { var json = JSON.parse(data); accessToken = json.token; console.log(&#39;access token: &#39; + accessToken); login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; }).catch(error =&gt; { console.error(error); login_btn.removeAttribute(&#39;disabled&#39;); login_btn.innerHTML = &#39;Login&#39;; }); }); }); load_data_btn.addEventListener(&#39;click&#39;, (e) =&gt; { e.preventDefault(); request({ url: &#39;http://localhost:49443/api/values&#39;, headers: { &#39;Authorization&#39;: &#39;Bearer &#39; + accessToken } }).then(data =&gt; { var json = JSON.parse(data); for (let i = 0; i &lt; json.length; i++) { data_list.innerHTML += &#39;&lt;li&gt;&#39; + json[i] + &#39;&lt;/li&gt;&#39;; } }).catch(error =&gt; { console.error(err); }); }); window.addEventListener(&#39;load&#39;, init); 1.coinbaseå’ŒaccessTokenæ˜¯å…¨å±€å˜é‡ï¼Œåˆ†åˆ«å­˜å‚¨ç”¨æˆ·ä»¥å¤ªåŠå¸æˆ·å’ŒJWT tokenã€‚ 2.initå‡½æ•°ä»Metamaskæä¾›çš„æä¾›ç¨‹åºåˆå§‹åŒ–web3å¯¹è±¡ï¼Œç„¶åå®ƒå°è¯•æ£€ç´¢ç”¨æˆ·çš„å¸æˆ·ï¼ˆcoinbaseï¼‰ã€‚è¿™éœ€è¦è§£é”åœ¨Metamaskä¸­ç­¾åçš„å¸æˆ·ã€‚ 3.requireå‡½æ•°åªæ˜¯hxrå¯¹è±¡çš„å°è£…ï¼Œå¯ä»¥è½»æ¾åœ°å‘APIå±‚è°ƒç”¨ajaxã€‚ 4.load_data_btnå•å‡»å¤„ç†ç¨‹åºå¯¹APIå±‚å®‰å…¨ç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚è¿™éœ€è¦æœ‰æ•ˆçš„accessTokenæ‰èƒ½å·¥ä½œï¼Œå¦åˆ™ï¼ŒAPIå±‚å°†å“åº”401 HTTPå“åº”ã€‚ 5.login_btnå•å‡»æ˜¯ä¸€ä¸ªä¸¤æ­¥åŠŸèƒ½ã€‚é¦–å…ˆï¼Œå®ƒè¦æ±‚ç”¨æˆ·ç­¾ç½²ä»»æ„æ¶ˆæ¯ã€‚ç­¾ååï¼Œå®ƒä¼šå°†å¸æˆ·ï¼Œç­¾åï¼Œæ˜æ–‡æ¶ˆæ¯å’Œå¸¦å‰ç¼€çš„å“ˆå¸Œå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚ è¯·æ³¨æ„ï¼Œweb3.personal.signå°†åå…­è¿›åˆ¶æ ¼å¼ï¼ˆ0x â€¦ï¼‰çš„æ™®é€šå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ä½œä¸ºè¾“å…¥ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼ŒæœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼ä»ç­¾åä¸­æ¢å¤å…¬é’¥ï¼šåœ¨ä¸€ä¸ªä¸­æˆ‘ä»¬å°†ä½¿ç”¨JSON RPC æ¥å£ä¸­çš„web3.personal.ecrecoverï¼ˆweb3.personal.signå¯¹åº”ï¼‰;åœ¨å¦ä¸€ä¸ªä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åº•å±‚çš„ecrecoverç¦»çº¿åŠŸèƒ½ã€‚æ ¹æ®æ–‡æ¡£ï¼Œweb3.personal.signä½¿ç”¨åº•å±‚ç­¾åå‡½æ•°æ¥ç­¾ç½²hashå’Œå‰ç¼€æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œä¸ºäº†ä½¿ç”¨åº•å±‚ecrecoverå¯¹åº”ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—å¹¶å°†æ­¤hashå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚ è¿è¡Œä¸¤ä¸ªåº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨å®‰è£…äº†Metamaskæ’ä»¶çš„æµè§ˆå™¨å¯¼èˆªåˆ°å®¢æˆ·ç«¯ã€‚è¯·è®°ä½ï¼Œä¸ºäº†å°†src/main.jsæ–‡ä»¶æ„å»ºåˆ°js/main.build.jsï¼Œä½ éœ€è¦ä»Powershellè¿è¡Œwebpacå‘½ä»¤ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå®¢æˆ·ç«¯å°†æ£€ç´¢coinbaseï¼Œä½ å°†åœ¨é¡µé¢ä¸Šçœ‹åˆ°ä½ çš„å¸æˆ·ï¼š å¦‚æœä½ ç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†è·å¾—HTTPå“åº”401ã€‚å¦‚æœå•å‡»â€œç™»å½•â€æŒ‰é’®ï¼ŒMetamaskå°†æç¤ºä½ ç­¾åï¼š ç­¾ååï¼Œå¤„ç†ç¨‹åºå°†å¯¹ä»¤ç‰Œç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚åœ¨æ­¤é˜¶æ®µï¼Œèº«ä»½éªŒè¯æ–¹æ³•ä¸ä¼šæ£€æŸ¥ä»»ä½•ç­¾åï¼Œå› æ­¤ç«¯ç‚¹å°†å§‹ç»ˆå‘å‡ºJWTä»¤ç‰Œã€‚ä¸€æ—¦æ”¶åˆ°JWTä»¤ç‰Œï¼Œå®¢æˆ·ç«¯å°±èƒ½é€šè¿‡ajaxè°ƒç”¨å®‰å…¨ç«¯ç‚¹ã€‚å¦‚æœç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†æ”¶åˆ°HTTPå“åº”200å’Œæ•°æ®è´Ÿè½½ï¼š ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ· åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒEthereumJwtApiæ˜¯ä¸€ä¸ªç®€å•çš„JWT Asp.Netæ ¸å¿ƒç¤ºä¾‹ï¼Œå› ä¸ºå®ƒä¸æä¾›ä»»ä½•æœ‰æ•ˆçš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚ TokenControllerçš„å…³é”®éƒ¨åˆ†æ˜¯ä¸¤ä¸ªAuthenticateæ–¹æ³•åŠå…¶ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ·çš„èƒ½åŠ›ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å®‰è£…Nethereum.Web3 NuGetåŒ…ã€‚Nethereumæ˜¯ä»¥å¤ªåŠçš„.Netå®ç°ã€‚ Authenticateæ–¹æ³•åªæ˜¯å¯¹web3.personal.ecrecoverå‡½æ•°è¿›è¡ŒJSON RPCè°ƒç”¨ï¼š private async Task&lt;UserVM&gt; Authenticate(LoginVM login) { UserVM user = null; var client = new RpcClient(new Uri(_config[&quot;Nethereum:Geth&quot;])); // Require the RPC endpoint of a Geth node as input eg: http://127.0.0.1:8545 var signer = await client.SendRequestAsync&lt;string&gt;(new RpcRequest(1, &quot;personal_ecRecover&quot;, login.Message, login.Signature)); if (signer.ToLower().Equals(login.Signer.ToLower())) { // read user from DB or create a new one // for now we fake a new user user = new UserVM { Account = signer, Name = string.Empty, Email = string.Empty }; } return user; } PROï¼š web3.personal.signæ˜¯web3.personal.signçš„å¯¹åº”éƒ¨åˆ†ï¼Œå› æ­¤ä½ æ— éœ€æ‹…å¿ƒå…¶åº•å±‚å®ç°ã€‚ ç¼ºç‚¹ï¼š éœ€è¦ä½ è‡ªå·±çš„GethèŠ‚ç‚¹ã€‚ä¸æ”¯æŒParityï¼ŒInfuraä¸å…è®¸JSON RPCè°ƒç”¨web3.personal.*ã€‚Authenticate2æ–¹æ³•æ˜¾ç¤ºäº†å¦ä¸€ç§æ–¹æ³•ï¼Œå®ƒä½¿ç”¨åº•å±‚ecrecoveråŠŸèƒ½çš„ç¦»çº¿å®ç°ï¼š private async Task&lt;UserVM&gt; Authenticate2(LoginVM login) { UserVM user = null; var signer = new Nethereum.Signer.MessageSigner(); var account = signer.EcRecover(login.Hash.HexToByteArray(), login.Signature); if (account.ToLower().Equals(login.Signer.ToLower())) { // read user from DB or create a new one // for now we fake a new user user = new UserVM { Account = account, Name = string.Empty, Email = string.Empty }; } return user; } PROï¼š ä¸éœ€è¦JSON RPCè°ƒç”¨å°±èƒ½å·¥ä½œã€‚MessageSigner.EcRecoveræ˜¯Nethereumæä¾›çš„ç¦»çº¿åŠŸèƒ½ã€‚ ç¼ºç‚¹ï¼š ä½ éœ€è¦å¤„ç†web3.personal.signå®ç°æ‰èƒ½æ­£ç¡®æ¢å¤å¸æˆ·ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç›¸åº”åœ°è®¡ç®—äº†å‰ç¼€æ¶ˆæ¯å“ˆå¸Œã€‚ ç»“è®º ç°åœ¨ä½ æ‹¥æœ‰åŸºæœ¬çš„çŸ¥è¯†å’Œä¸€ä¸ªé¡¹ç›®çš„éª¨æ¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥å¤ªåŠä¿æŠ¤ä½ çš„Asp.Net Core 2 APIã€‚åªéœ€å‡ ç‚¹è¯´æ˜ï¼š web3 1.0.0å¤„äºæµ‹è¯•é˜¶æ®µï¼Œweb3.personal.signå®ç°å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ã€‚è¯·åŠ¡å¿…åœ¨ä½ å¯ä»¥ç»´æŠ¤çš„ä»£ç åº“ä¸Šä½¿ç”¨è¿™ç§èº«ä»½éªŒè¯æ–¹æ³•ã€‚ä¹Ÿè®¸InfuraæŸå¤©å†³å®šå…è®¸web3.personal.ecrecover ğŸ˜ƒ ====================================================================== åˆ†äº«ä¸€äº›ä»¥å¤ªåŠã€EOSã€æ¯”ç‰¹å¸ç­‰åŒºå—é“¾ç›¸å…³çš„äº¤äº’å¼åœ¨çº¿ç¼–ç¨‹å®æˆ˜æ•™ç¨‹ï¼š javaä»¥å¤ªåŠå¼€å‘æ•™ç¨‹ï¼Œä¸»è¦æ˜¯é’ˆå¯¹javaå’Œandroidç¨‹åºå‘˜è¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„web3jè¯¦è§£ã€‚ pythonä»¥å¤ªåŠï¼Œä¸»è¦æ˜¯é’ˆå¯¹pythonå·¥ç¨‹å¸ˆä½¿ç”¨web3.pyè¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„è¯¦è§£ã€‚ phpä»¥å¤ªåŠï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨phpè¿›è¡Œæ™ºèƒ½åˆçº¦å¼€å‘äº¤äº’ï¼Œè¿›è¡Œè´¦å·åˆ›å»ºã€äº¤æ˜“ã€è½¬è´¦ã€ä»£å¸å¼€å‘ä»¥åŠè¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰å†…å®¹ã€‚ ä»¥å¤ªåŠå…¥é—¨æ•™ç¨‹ï¼Œä¸»è¦ä»‹ç»æ™ºèƒ½åˆçº¦ä¸dappåº”ç”¨å¼€å‘ï¼Œé€‚åˆå…¥é—¨ã€‚ ä»¥å¤ªåŠå¼€å‘è¿›é˜¶æ•™ç¨‹ï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨node.jsã€mongodbã€åŒºå—é“¾ã€ipfså®ç°å»ä¸­å¿ƒåŒ–ç”µå•†DAppå®æˆ˜ï¼Œé€‚åˆè¿›é˜¶ã€‚ C#ä»¥å¤ªåŠï¼Œä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨C#å¼€å‘åŸºäº.Netçš„ä»¥å¤ªåŠåº”ç”¨ï¼ŒåŒ…æ‹¬è´¦æˆ·ç®¡ç†ã€çŠ¶æ€ä¸äº¤æ˜“ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸äº¤äº’ã€è¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰ã€‚ EOSæ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨EOSåŒºå—é“¾å»ä¸­å¿ƒåŒ–åº”ç”¨çš„å¼€å‘ï¼Œå†…å®¹æ¶µç›–EOSå·¥å…·é“¾ã€è´¦æˆ·ä¸é’±åŒ…ã€å‘è¡Œä»£å¸ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸éƒ¨ç½²ã€ä½¿ç”¨ä»£ç ä¸æ™ºèƒ½åˆçº¦äº¤äº’ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæœ€åç»¼åˆè¿ç”¨å„çŸ¥è¯†ç‚¹å®Œæˆä¸€ä¸ªä¾¿ç­¾DAppçš„å¼€å‘ã€‚ javaæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Javaä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Javaå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚ phpæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Phpä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Phpå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚ æ±‡æ™ºç½‘åŸåˆ›ç¿»è¯‘ï¼Œè½¬è½½è¯·æ ‡æ˜å‡ºå¤„ã€‚è¿™é‡Œæ˜¯åŸæ–‡ é˜…è¯»æ›´å¤š","@type":"BlogPosting","url":"/2018/10/31/ab3bd759934c77928be32ba2ecdf3c23.html","headline":"ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸‹ï¼‰","dateModified":"2018-10-31T00:00:00+08:00","datePublished":"2018-10-31T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/10/31/ab3bd759934c77928be32ba2ecdf3c23.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸‹ï¼‰</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>æŸšå­ç¤¾åŒº</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart ç®­å¤´å›¾æ ‡ å‹¿åˆ  --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>ä¸Šä¸€ç¯‡<a href="http://blog.hubwiz.com/2018/10/29/ethereum-asp_net_core_api-secure/" rel="nofollow">ç”¨ä»¥å¤ªåŠåŒºå—é“¾ä¿è¯Asp.Net Coreçš„APIå®‰å…¨ï¼ˆä¸Šï¼‰</a>æˆ‘ä»¬ä»‹ç»äº†åŸºæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬é‡ç‚¹æ¥çœ‹å®¢æˆ·ç«¯ã€‚</p> 
  <p>æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œæˆ‘ä»¬çš„DAppæ˜¯ä¸€ä¸ªç®€å•çš„HTML/ES6å®¢æˆ·ç«¯ã€‚<a href="http://xn--Asp-ot9dm09aukhmml.Net" rel="nofollow">æˆ‘ä»¬å°†åœ¨Asp.Net</a> Core 2ä¹‹ä¸Šæ„å»ºå®¢æˆ·ç«¯ï¼Œä»¥åˆ©ç”¨<strong>IIS Expresså’ŒVisual Studio IDE</strong>ã€‚å› æ­¤ï¼Œ<code>Startup.cs</code>ç±»ä¸­çš„<code>Configure</code>æ–¹æ³•å°†æ˜¯ï¼š</p> 
  <pre><code>if (env.IsDevelopment())
{
    app.UseDeveloperExceptionPage();
}

app.UseDefaultFiles();
app.UseStaticFiles();
</code></pre> 
  <p>ä½¿DAppæˆä¸º<code>NPM</code>é¡¹ç›®å¹¶å®‰è£…å¿…å¤‡æ¡ä»¶ä»¥ä½¿ç”¨ES6 Javascriptæ ‡å‡†ã€‚è¿™ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±çš„å †æ ˆæ„å»ºDAppã€‚</p> 
  <p>ä»é¡¹ç›®æ–‡ä»¶å¤¹è¿è¡Œ<code>Powershell</code>å¹¶è¿è¡Œä»¥ä¸‹<code>NPM</code>å‘½ä»¤ï¼š</p> 
  <pre><code>npm init
npm install webpack
npm install babel-core babel-loader --save-dev
npm install babel-preset-es2015 --save-dev
npm install babel-preset-stage-0 --save-dev
npm install babel-polyfill --save
npm install babel-runtime --save
npm install babel-plugin-transform-runtime --save-dev
</code></pre> 
  <p>è¦é…ç½®<code>webpack/babel</code>ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®åˆ›å»º<code>webpack.config.js</code>æ–‡ä»¶ï¼š</p> 
  <pre><code>var path = require("path");

module.exports = {
    entry: [
        "babel-polyfill",
        "./src/main"
    ],
    output: {
        publicPath: "/js/",
        path: path.join(__dirname, "/wwwroot/js/"),
        filename: "main.build.js"
    }
};
</code></pre> 
  <p>æˆ‘ä»¬å·²è®¾å®š<code>webpack</code>å°†<code>src/main.js</code>æ–‡ä»¶æ„å»ºåˆ°<code>/www/js/main.build.js</code>ã€‚</p> 
  <p>å®‰è£…ä»¥å¤ªåŠæ‰©å±•åŒ…ï¼š</p> 
  <pre><code>npm install web3
npm install ethereumjs-util
</code></pre> 
  <p>Web3æ˜¯ä¸€ä¸ª<code>javascript</code>å°è£…åŒ…ï¼Œå®ƒç®€åŒ–äº†é’ˆå¯¹ä»¥å¤ªåŠåŒºå—é“¾çš„JSON RPCè°ƒç”¨ã€‚<code>Ethereumjs-util</code>æä¾›äº†ä¸€äº›ä»¥å¤ªåŠç‰¹å®šçš„å®ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªéå¸¸ç®€å•çš„HTMLé¡µé¢ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç™»å½•æŒ‰é’®å’Œå¦ä¸€ä¸ªæŒ‰é’®æ¥ä»æˆ‘ä»¬çš„APIå±‚åŠ è½½ä¸€äº›å®‰å…¨æ•°æ®ï¼š</p> 
  <pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;Ethereum Jwt Client&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Ethereum Jwt Client&lt;/h1&gt;
    &lt;div id="login-view"&gt;
        &lt;label&gt;Your account: &lt;/label&gt; &lt;span id="eth_account_span"&gt;&lt;/span&gt;
        &lt;button type="submit" id="login_btn"&gt;Login&lt;/button&gt;
    &lt;/div&gt;
    &lt;div id="data-view"&gt;
        &lt;button type="submit" id="load_data_btn"&gt;Request secured data&lt;/button&gt;
        &lt;ul id="data_list"&gt;

        &lt;/ul&gt;
    &lt;/div&gt;
    &lt;script src="js/main.build.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
  <p>DAppé€»è¾‘å°†é©»ç•™åœ¨<code>src/main.js</code>æ–‡ä»¶ä¸­ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨<code>webpack.config.js</code>æ–‡ä»¶ä¸­æŒ‡å®šçš„é‚£æ ·ã€‚<code>src/main.js</code>æ–‡ä»¶å°†æ˜¯ï¼š</p> 
  <pre><code>let ethUtil = require('ethereumjs-util');
let Web3 = require('web3');

let coinbase = null;
let accessToken = null;

let init = () =&gt; {
    if (typeof web3 !== 'undefined') {
        web3 = new Web3(web3.currentProvider);
        web3.eth.getCoinbase(function (err, account) {
            if (err === null &amp;&amp; ethUtil.isValidAddress(account)) {
                coinbase = account;
                eth_account_span.innerHTML = coinbase;
            } else {
                eth_account_span.innerHTML = 'Please unlock your account and refresh the page';
                console.error(err);
            }
        });

    } else {
        eth_account_span.innerHTML = 'Please install or unlock Metamask browser plugin or navigate this page with Mist or another web3 browser';
    }
};

let request = obj =&gt; {
    return new Promise((resolve, reject) =&gt; {
        let xhr = new XMLHttpRequest();
        xhr.open(obj.method || "GET", obj.url);
        if (obj.headers) {
            Object.keys(obj.headers).forEach(key =&gt; {
                xhr.setRequestHeader(key, obj.headers[key]);
            });
        }
        xhr.onload = () =&gt; {
            if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {
                resolve(xhr.response);
            } else {
                reject(xhr.statusText);
            }
        };
        xhr.onerror = () =&gt; reject(xhr.statusText);
        xhr.send(obj.body);
    });
};

login_btn.addEventListener('click', (e) =&gt; {
    e.preventDefault();

    login_btn.setAttribute('disabled', 'disabled');
    login_btn.innerHTML = 'Please sign the message';

    let plain = 'Hi, you request a login from client to Eth Jwt Api. Please sign this message. This is not a transaction, is completely free and 100% secure. We\'ll use your signature to prove your ownership over your private key server side.';
    let msg = ethUtil.bufferToHex(new Buffer(plain, 'utf8'));
    let hash = ethUtil.bufferToHex(ethUtil.keccak256("\x19Ethereum Signed Message:\n" + plain.length + plain));
    let from = coinbase;

    let params = [msg, from];
    let method = 'personal_sign';

    web3.currentProvider.sendAsync({
        method,
        params,
        from,
    }, function (err, result) {
        if (err || result.error) {
            login_btn.removeAttribute('disabled');
            login_btn.innerHTML = 'Login';

            console.error(err);
            return console.error(result.error);
        }
        console.log({
            'signature': result.result,
            'msg': msg,
            'hash': hash
        });

        login_btn.innerHTML = 'Requesting token...';
        let loginData = {};
        loginData.signer = from;
        loginData.signature = result.result;
        loginData.message = msg;
        loginData.hash = hash;

        request({
            url: 'http://localhost:49443/api/token',
            body: JSON.stringify(loginData),
            method: 'post',
            headers: {
                'Authorization': 'Bearer ' + accessToken,
                'Content-type': 'application/json'
            }
        }).then(data =&gt; {
            var json = JSON.parse(data);
            accessToken = json.token;
            console.log('access token: ' + accessToken);

            login_btn.removeAttribute('disabled');
            login_btn.innerHTML = 'Login';
        }).catch(error =&gt; {
            console.error(error);

            login_btn.removeAttribute('disabled');
            login_btn.innerHTML = 'Login';
        });
    });
});

load_data_btn.addEventListener('click', (e) =&gt; {
    e.preventDefault();

    request({
        url: 'http://localhost:49443/api/values',
        headers: {
            'Authorization': 'Bearer ' + accessToken
        }
    }).then(data =&gt; {
        var json = JSON.parse(data);
        for (let i = 0; i &lt; json.length; i++) {
            data_list.innerHTML += '&lt;li&gt;' + json[i] + '&lt;/li&gt;';
        }
    }).catch(error =&gt; {
        console.error(err);
    });

});

window.addEventListener('load', init);
</code></pre> 
  <ul> 
   <li>1.<code>coinbase</code>å’Œ<code>accessToken</code>æ˜¯å…¨å±€å˜é‡ï¼Œåˆ†åˆ«å­˜å‚¨ç”¨æˆ·ä»¥å¤ªåŠå¸æˆ·å’ŒJWT tokenã€‚</li> 
   <li>2.<code>init</code>å‡½æ•°ä»Metamaskæä¾›çš„æä¾›ç¨‹åºåˆå§‹åŒ–web3å¯¹è±¡ï¼Œç„¶åå®ƒå°è¯•æ£€ç´¢ç”¨æˆ·çš„å¸æˆ·ï¼ˆcoinbaseï¼‰ã€‚è¿™éœ€è¦è§£é”åœ¨Metamaskä¸­ç­¾åçš„å¸æˆ·ã€‚</li> 
   <li>3.<code>require</code>å‡½æ•°åªæ˜¯hxrå¯¹è±¡çš„å°è£…ï¼Œå¯ä»¥è½»æ¾åœ°å‘APIå±‚è°ƒç”¨ajaxã€‚</li> 
   <li>4.<strong>load_data_btn</strong>å•å‡»å¤„ç†ç¨‹åºå¯¹APIå±‚å®‰å…¨ç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚è¿™éœ€è¦æœ‰æ•ˆçš„<code>accessToken</code>æ‰èƒ½å·¥ä½œï¼Œå¦åˆ™ï¼ŒAPIå±‚å°†å“åº”401 HTTPå“åº”ã€‚</li> 
   <li>5.<strong>login_btn</strong>å•å‡»æ˜¯ä¸€ä¸ªä¸¤æ­¥åŠŸèƒ½ã€‚é¦–å…ˆï¼Œå®ƒè¦æ±‚ç”¨æˆ·ç­¾ç½²ä»»æ„æ¶ˆæ¯ã€‚ç­¾ååï¼Œå®ƒä¼šå°†å¸æˆ·ï¼Œç­¾åï¼Œæ˜æ–‡æ¶ˆæ¯å’Œå¸¦å‰ç¼€çš„å“ˆå¸Œå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚</li> 
  </ul> 
  <p>è¯·æ³¨æ„ï¼Œ<code>web3.personal.sign</code>å°†åå…­è¿›åˆ¶æ ¼å¼ï¼ˆ0x â€¦ï¼‰çš„æ™®é€šå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ä½œä¸ºè¾“å…¥ã€‚</p> 
  <p>æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼ŒæœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹å¼ä»ç­¾åä¸­æ¢å¤å…¬é’¥ï¼šåœ¨ä¸€ä¸ªä¸­æˆ‘ä»¬å°†ä½¿ç”¨JSON RPC æ¥å£ä¸­çš„<code>web3.personal.ecrecover</code>ï¼ˆweb3.personal.signå¯¹åº”ï¼‰;åœ¨å¦ä¸€ä¸ªä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åº•å±‚çš„<code>ecrecover</code>ç¦»çº¿åŠŸèƒ½ã€‚æ ¹æ®æ–‡æ¡£ï¼Œ<code>web3.personal.sign</code>ä½¿ç”¨åº•å±‚ç­¾åå‡½æ•°æ¥ç­¾ç½²hashå’Œå‰ç¼€æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œä¸ºäº†ä½¿ç”¨åº•å±‚<code>ecrecover</code>å¯¹åº”ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—å¹¶å°†æ­¤hashå‘é€åˆ°ä»¤ç‰Œç«¯ç‚¹ã€‚</p> 
  <p>è¿è¡Œä¸¤ä¸ªåº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨å®‰è£…äº†Metamaskæ’ä»¶çš„æµè§ˆå™¨å¯¼èˆªåˆ°å®¢æˆ·ç«¯ã€‚è¯·è®°ä½ï¼Œä¸ºäº†å°†<code>src/main.js</code>æ–‡ä»¶æ„å»ºåˆ°<code>js/main.build.js</code>ï¼Œä½ éœ€è¦ä»<code>Powershell</code>è¿è¡Œ<code>webpac</code>å‘½ä»¤ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå®¢æˆ·ç«¯å°†æ£€ç´¢<code>coinbase</code>ï¼Œä½ å°†åœ¨é¡µé¢ä¸Šçœ‹åˆ°ä½ çš„å¸æˆ·ï¼š</p> 
  <p><img src="http://blog.hubwiz.com/2018/10/29/ethereum-asp_net_core_api-secure/index.png" alt=""></p> 
  <p>å¦‚æœä½ ç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†è·å¾—HTTPå“åº”401ã€‚å¦‚æœå•å‡»â€œç™»å½•â€æŒ‰é’®ï¼ŒMetamaskå°†æç¤ºä½ ç­¾åï¼š</p> 
  <p><img src="http://blog.hubwiz.com/2018/10/29/ethereum-asp_net_core_api-secure/message.png" alt=""></p> 
  <p>ç­¾ååï¼Œå¤„ç†ç¨‹åºå°†å¯¹ä»¤ç‰Œç«¯ç‚¹è¿›è¡Œajaxè°ƒç”¨ã€‚åœ¨æ­¤é˜¶æ®µï¼Œèº«ä»½éªŒè¯æ–¹æ³•ä¸ä¼šæ£€æŸ¥ä»»ä½•ç­¾åï¼Œå› æ­¤ç«¯ç‚¹å°†å§‹ç»ˆå‘å‡ºJWTä»¤ç‰Œã€‚ä¸€æ—¦æ”¶åˆ°JWTä»¤ç‰Œï¼Œå®¢æˆ·ç«¯å°±èƒ½é€šè¿‡ajaxè°ƒç”¨å®‰å…¨ç«¯ç‚¹ã€‚å¦‚æœç°åœ¨å•å‡»â€œè¯·æ±‚æ•°æ®â€æŒ‰é’®ï¼Œå°†æ”¶åˆ°HTTPå“åº”200å’Œæ•°æ®è´Ÿè½½ï¼š</p> 
  <p><img src="http://blog.hubwiz.com/2018/10/29/ethereum-asp_net_core_api-secure/jwtToken.png" alt=""></p> 
  <h3><a id="_237"></a>ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ·</h3> 
  <p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ<code>EthereumJwtApi</code>æ˜¯ä¸€ä¸ªç®€å•çš„JWT Asp.Netæ ¸å¿ƒç¤ºä¾‹ï¼Œå› ä¸ºå®ƒä¸æä¾›ä»»ä½•æœ‰æ•ˆçš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚</p> 
  <p><code>TokenController</code>çš„å…³é”®éƒ¨åˆ†æ˜¯ä¸¤ä¸ª<code>Authenticate</code>æ–¹æ³•åŠå…¶ä»ç­¾åä¸­æ£€ç´¢ä»¥å¤ªåŠå¸æˆ·çš„èƒ½åŠ›ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å®‰è£…<code>Nethereum.Web3 NuGet</code>åŒ…ã€‚Nethereumæ˜¯ä»¥å¤ªåŠçš„.Netå®ç°ã€‚</p> 
  <p><code>Authenticate</code>æ–¹æ³•åªæ˜¯å¯¹<code>web3.personal.ecrecover</code>å‡½æ•°è¿›è¡ŒJSON RPCè°ƒç”¨ï¼š</p> 
  <pre><code>private async Task&lt;UserVM&gt; Authenticate(LoginVM login)
{
    UserVM user = null;

    var client = new RpcClient(new Uri(_config["Nethereum:Geth"])); // Require the RPC endpoint of a Geth node as input eg: http://127.0.0.1:8545
    var signer = await client.SendRequestAsync&lt;string&gt;(new RpcRequest(1, "personal_ecRecover", login.Message, login.Signature));

    if (signer.ToLower().Equals(login.Signer.ToLower()))
    {
        // read user from DB or create a new one
        // for now we fake a new user
        user = new UserVM { Account = signer, Name = string.Empty, Email = string.Empty };
    }

    return user;
}
</code></pre> 
  <p>PROï¼š</p> 
  <p><code>web3.personal.sign</code>æ˜¯<code>web3.personal.sign</code>çš„å¯¹åº”éƒ¨åˆ†ï¼Œå› æ­¤ä½ æ— éœ€æ‹…å¿ƒå…¶åº•å±‚å®ç°ã€‚</p> 
  <p>ç¼ºç‚¹ï¼š</p> 
  <p>éœ€è¦ä½ è‡ªå·±çš„GethèŠ‚ç‚¹ã€‚ä¸æ”¯æŒParityï¼ŒInfuraä¸å…è®¸JSON RPCè°ƒç”¨<code>web3.personal.*</code>ã€‚<code>Authenticate2</code>æ–¹æ³•æ˜¾ç¤ºäº†å¦ä¸€ç§æ–¹æ³•ï¼Œå®ƒä½¿ç”¨åº•å±‚<code>ecrecover</code>åŠŸèƒ½çš„ç¦»çº¿å®ç°ï¼š</p> 
  <pre><code>private async Task&lt;UserVM&gt; Authenticate2(LoginVM login)
{
    UserVM user = null;

    var signer = new Nethereum.Signer.MessageSigner();
    var account = signer.EcRecover(login.Hash.HexToByteArray(), login.Signature);

    if (account.ToLower().Equals(login.Signer.ToLower()))
    {
        // read user from DB or create a new one
        // for now we fake a new user
        user = new UserVM { Account = account, Name = string.Empty, Email = string.Empty };
    }

    return user;
}
</code></pre> 
  <p>PROï¼š</p> 
  <p>ä¸éœ€è¦JSON RPCè°ƒç”¨å°±èƒ½å·¥ä½œã€‚<code>MessageSigner.EcRecover</code>æ˜¯<code>Nethereum</code>æä¾›çš„ç¦»çº¿åŠŸèƒ½ã€‚</p> 
  <p>ç¼ºç‚¹ï¼š</p> 
  <p>ä½ éœ€è¦å¤„ç†<code>web3.personal.sign</code>å®ç°æ‰èƒ½æ­£ç¡®æ¢å¤å¸æˆ·ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç›¸åº”åœ°è®¡ç®—äº†å‰ç¼€æ¶ˆæ¯å“ˆå¸Œã€‚</p> 
  <h3><a id="_299"></a>ç»“è®º</h3> 
  <p>ç°åœ¨ä½ æ‹¥æœ‰åŸºæœ¬çš„çŸ¥è¯†å’Œä¸€ä¸ªé¡¹ç›®çš„éª¨æ¶ï¼Œ<a href="http://xn--Asp-vs9da25ergy1a97zsvi3kf3p8apl7cn8d.Net" rel="nofollow">å¯ä»¥ä½¿ç”¨ä»¥å¤ªåŠä¿æŠ¤ä½ çš„Asp.Net</a> Core 2 APIã€‚åªéœ€å‡ ç‚¹è¯´æ˜ï¼š</p> 
  <p>web3 1.0.0å¤„äºæµ‹è¯•é˜¶æ®µï¼Œ<code>web3.personal.sign</code>å®ç°å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ã€‚è¯·åŠ¡å¿…åœ¨ä½ å¯ä»¥ç»´æŠ¤çš„ä»£ç åº“ä¸Šä½¿ç”¨è¿™ç§èº«ä»½éªŒè¯æ–¹æ³•ã€‚ä¹Ÿè®¸InfuraæŸå¤©å†³å®šå…è®¸<code>web3.personal.ecrecover</code> ğŸ˜ƒ</p> 
  <p>======================================================================</p> 
  <p>åˆ†äº«ä¸€äº›ä»¥å¤ªåŠã€EOSã€æ¯”ç‰¹å¸ç­‰åŒºå—é“¾ç›¸å…³çš„äº¤äº’å¼åœ¨çº¿ç¼–ç¨‹å®æˆ˜æ•™ç¨‹ï¼š</p> 
  <blockquote> 
   <ul> 
    <li><a href="http://xc.hubwiz.com/course/5b2b6e82c02e6b6a59171de2?affid=1030csdn" rel="nofollow">javaä»¥å¤ªåŠå¼€å‘æ•™ç¨‹</a>ï¼Œä¸»è¦æ˜¯é’ˆå¯¹javaå’Œandroidç¨‹åºå‘˜è¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„web3jè¯¦è§£ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5b40462cc02e6b6a59171de4?affid=1030csdn" rel="nofollow">pythonä»¥å¤ªåŠ</a>ï¼Œä¸»è¦æ˜¯é’ˆå¯¹pythonå·¥ç¨‹å¸ˆä½¿ç”¨web3.pyè¿›è¡ŒåŒºå—é“¾ä»¥å¤ªåŠå¼€å‘çš„è¯¦è§£ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5b36629bc02e6b6a59171de3?affid=1030csdn" rel="nofollow">phpä»¥å¤ªåŠ</a>ï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨phpè¿›è¡Œæ™ºèƒ½åˆçº¦å¼€å‘äº¤äº’ï¼Œè¿›è¡Œè´¦å·åˆ›å»ºã€äº¤æ˜“ã€è½¬è´¦ã€ä»£å¸å¼€å‘ä»¥åŠè¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰å†…å®¹ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5a952991adb3847553d205d1?affid=1030csdn" rel="nofollow">ä»¥å¤ªåŠå…¥é—¨æ•™ç¨‹</a>ï¼Œä¸»è¦ä»‹ç»æ™ºèƒ½åˆçº¦ä¸dappåº”ç”¨å¼€å‘ï¼Œé€‚åˆå…¥é—¨ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5abbb7acc02e6b6a59171dd6?affid=1030csdn" rel="nofollow">ä»¥å¤ªåŠå¼€å‘è¿›é˜¶æ•™ç¨‹</a>ï¼Œä¸»è¦æ˜¯ä»‹ç»ä½¿ç”¨node.jsã€mongodbã€åŒºå—é“¾ã€ipfså®ç°å»ä¸­å¿ƒåŒ–ç”µå•†DAppå®æˆ˜ï¼Œé€‚åˆè¿›é˜¶ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5b6048c3c02e6b6a59171dee?affid=1030csdn" rel="nofollow">C#ä»¥å¤ªåŠ</a>ï¼Œä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨C#å¼€å‘åŸºäº.Netçš„ä»¥å¤ªåŠåº”ç”¨ï¼ŒåŒ…æ‹¬è´¦æˆ·ç®¡ç†ã€çŠ¶æ€ä¸äº¤æ˜“ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸äº¤äº’ã€è¿‡æ»¤å™¨å’Œäº¤æ˜“ç­‰ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5b52c0a2c02e6b6a59171ded?affid=1030csdn" rel="nofollow">EOSæ•™ç¨‹</a>ï¼Œæœ¬è¯¾ç¨‹å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨EOSåŒºå—é“¾å»ä¸­å¿ƒåŒ–åº”ç”¨çš„å¼€å‘ï¼Œå†…å®¹æ¶µç›–EOSå·¥å…·é“¾ã€è´¦æˆ·ä¸é’±åŒ…ã€å‘è¡Œä»£å¸ã€æ™ºèƒ½åˆçº¦å¼€å‘ä¸éƒ¨ç½²ã€ä½¿ç”¨ä»£ç ä¸æ™ºèƒ½åˆçº¦äº¤äº’ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæœ€åç»¼åˆè¿ç”¨å„çŸ¥è¯†ç‚¹å®Œæˆä¸€ä¸ªä¾¿ç­¾DAppçš„å¼€å‘ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5bb35c90c02e6b6a59171df0?affid=1030csdn" rel="nofollow">javaæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹</a>ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Javaä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Javaå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚</li> 
    <li><a href="http://xc.hubwiz.com/course/5b9e779ac02e6b6a59171def?affid=1030csdn" rel="nofollow">phpæ¯”ç‰¹å¸å¼€å‘æ•™ç¨‹</a>ï¼Œæœ¬è¯¾ç¨‹é¢å‘åˆå­¦è€…ï¼Œå†…å®¹å³æ¶µç›–æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚åŒºå—é“¾å­˜å‚¨ã€å»ä¸­å¿ƒåŒ–å…±è¯†æœºåˆ¶ã€å¯†é’¥ä¸è„šæœ¬ã€äº¤æ˜“ä¸UTXOç­‰ï¼ŒåŒæ—¶ä¹Ÿè¯¦ç»†è®²è§£å¦‚ä½•åœ¨Phpä»£ç ä¸­é›†æˆæ¯”ç‰¹å¸æ”¯æŒåŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºåœ°å€ã€ç®¡ç†é’±åŒ…ã€æ„é€ è£¸äº¤æ˜“ç­‰ï¼Œæ˜¯Phpå·¥ç¨‹å¸ˆä¸å¯å¤šå¾—çš„æ¯”ç‰¹å¸å¼€å‘å­¦ä¹ è¯¾ç¨‹ã€‚</li> 
   </ul> 
  </blockquote> 
  <p>æ±‡æ™ºç½‘åŸåˆ›ç¿»è¯‘ï¼Œè½¬è½½è¯·æ ‡æ˜å‡ºå¤„ã€‚è¿™é‡Œæ˜¯<a href="https://medium.com/coinmonks/secure-asp-net-core-2-api-with-ethereum-blockchain-88001d5ddb6" rel="nofollow">åŸæ–‡</a></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/mongo_node/article/details/83573100,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/mongo_node/article/details/83573100,&quot;}">é˜…è¯»æ›´å¤š</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- è‡ªå®šä¹‰å¹¿å‘Š -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">æ›´å¤šç²¾å½©å†…å®¹</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">å›é¦–é¡µ</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

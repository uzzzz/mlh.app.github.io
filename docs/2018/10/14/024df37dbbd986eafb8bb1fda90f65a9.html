<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>SEER交易所及第三方平台充提网关接入指南 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="SEER交易所及第三方平台充提网关接入指南" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SEER交易所及第三方平台充提网关接入指南 本指南主要目的是帮助交易所和其它第三方平台（包括但不限于非SEER DAPPs应用、中心化应用等）搭建充提网关接入SEER主网，上线SEER主资产及基于SEER区块链发行的token，例如PFC、OPC等。 使用SEER主网进行充提等操作，手续费远远低于SEER的ERC-20token和BTS资产，且不受以太坊拥堵等事件的影响。 基本原理 大部分交易所及第三方平台使用的网关（充值提现）是一个中心化的应用服务。 以交易所充提为例，交易所为每位用户提供有一个平台id，任何用户向交易所的SEER主网账户转账，并在MEMO中填写该id，当交易所的SEER主网账户收到一笔转账时，可以根据MEMO中填写的信息确定是来自哪位用户的充值，从而在交易所平台内为用户上账。 举例： 1、小明从自己的SEER主网账户xiaoming充值1000SEER到交易所账户seerdex，MEMO中填写10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER； 2、小明请朋友小花帮自己充值，小花从自己的SEER主网账户xiaohua充值1000SEER到交易所账户seerdex，MEMO中填写10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER； 3、小明将自己玩大富翁游戏中赢得的SEER充值交易所，小明在大富翁游戏的提现页面中填写提现1000SEER到交易所账户seerdex，并填写MEMO10010，大富翁游戏在平台内扣除小明账户余额1000SEER，同时通过大富翁的SEER主网账户dafuweng向交易所账户seerdex转账1000SEER，MEMO为10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER。 例子3中，我们举例了用户从第三方平台提现到交易所的流程，从交易所提现到另一家交易所也是如此，这就需要交易所及第三方平台在设计提现功能时提供MEMO功能。为了资金安全，您可以部署两个或多个账号，其中一个账号负责用户充值，其它账号负责提现。 准备工作 运行环境 推荐服务器配置为：2vCPUs 4G内存 20G以上硬盘，Ubuntu 16.04.4 x64 系统。 获得账号及私钥 注册账号 您可以通过SEER网页钱包 https://wallet.seer.best 注册账号，其中账号中带有横杠或数字的账号为普通账号名，可以直接免费注册（点击了解方法） ，例如seer-exchange或seerdex01 ，而由纯英文字母构成的账号名为高级用户名，例如seerdex，则需通过一个终身会员账户缴纳注册手续费来注册。 获得私钥 在充提网关等功能中，我们需要账户的至少两对密钥，即当前资金密钥（Active key）和当前备注密钥（memo key），资金密钥让您拥有资金的转账及其他链上操作权限，备注密钥让您能生成和读取和该账号相关的MEMO信息。点击这里了解获取私钥的方法 。 配置一个SEER全节点 1、在服务器新建一个名叫seer的窗口； screen -S seer 2、在root目录下新建一个名叫seer的目录，下载v0.0.5版本的程序包到此目录，并更名为seer.tar.gz。（请到SEER软件发布页https://github.com/seer-project/seer-core-package/releases 复制最新的ubuntu版本程序包链接替换掉此下载链接。） mkdir seer curl -Lo seer/seer.tar.gz https://github.com/seer-project/seer-core-package/releases/download/v0.05/seer-ubuntu-0.0.5.tar.gz 3、进入seer目录，解压此软件包。 cd seer tar xzvf seer.tar.gz 4、带websocket参数启动witness_node： witness_node --rpc-endpoint=127.0.0.1:9090 partial-operations=true --track-account=&quot;\&quot;seerdex-withdraw\&quot;&quot; --track-account=&quot;\&quot;seerdex-deposit\&quot;&quot; max-ops-per-account=1000 其中的--rpc-endpoint参数为节点监听的websocket RPC IP地址和端口号，需要您替换，此处127.0.0.1为本机，9090是为节点指定的WS端口。 对于处理充提业务的节点，我们并不需要保存全部数据，仅需要保存和交易所账户相关的账户数据以节省内存开支，因此我们需要设置partial-operations参数和--track-account参数，此处partial-operations=true表示只需要部分的数据，&quot;\&quot;seerdex-withdraw\&quot;&quot;和&quot;\&quot;seerdex-deposit\&quot;&quot;表示要追踪的一个或多个账户id，需要您替换。 --max-ops-per-account参数设定内存中保留账户的多少条操作记录，此处1000表示保留追踪账户的1000条操作记录，需要您按需求填写。 5、观察节点运行正常后，ctrl+A d隐藏screen，断开服务器。之后要再打开运行有节点的Sreeen，则使用 screen -R ，或 screen -r seer。 节点正常启动后，会显示像下面一样的3秒一个的出块信息。 如果要关闭节点，则使用control + C 。 配置一个SEER命令行钱包 1、在服务器新建一个名叫cli的窗口，运行seer目录中的命令行钱包程序； screen -S cli cd~ seer/cli_wallet -s ws://127.0.0.1:9090 -r 127.0.0.1:9191 -H 127.0.0.1:9192 -s参数可以设置要连接的节点api地址及端口，此处ws://127.0.0.1:9090为上一步中运行的本地节点的websocket RPC地址和端口，您也可以在此处使用局域网或公网中的其他公共api地址，不过有因外部api无法提供服务而导致命令行钱包异常退出的风险； -r参数可以设置命令行钱包要监听的websocket RPC地址和端口，此处设为127.0.0.1:9191，负责充提业务的程序可以使用此端口调用命令行钱包进行操作； -H参数可以设置命令行钱包要监听的Http-RPC地址和端口，此处设为127.0.0.1:9192，负责充提业务的程序也可以使用此端口调用命令行钱包进行操作。 2、钱包启动成功后，会显示： Please use the set_password method to initialize a new wallet before continuing 3564395ms th_a main.cpp:227 main ] Listening for incoming RPC requests on 127.0.0.1:9191 3564396ms th_a main.cpp:252 main ] Listening for incoming HTTP RPC requests on 127.0.0.1:9192 new &gt;&gt;&gt; 先设置钱包解锁密码，123替换为你想设置的密码 set_password 123 解锁钱包 unlock 123 导入账号资金私钥和备注私钥 import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd 显示如下： new &gt;&gt;&gt; set_password 123 set_password 123 null locked &gt;&gt;&gt; unlock 123 unlock 123 null unlocked &gt;&gt;&gt; import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ import_key okok 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ 3572083ms th_a wallet.cpp:793 save_wallet_file ] saving wallet to file wallet.json 3572084ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to after-import-key-1cd0784e.wallet true unlocked &gt;&gt;&gt; import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd import_key else 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd 3572941ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to before-import-key-1bece5d8.wallet 3573189ms th_a wallet.cpp:793 save_wallet_file ] saving wallet to file wallet.json 3573191ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to after-import-key-1bece5d8.wallet true unlocked &gt;&gt;&gt; 接入命令行钱包 可以使用Http-RPC或websocket RPC方式接入命令行钱包。使用JSON-RPC远程调用协议传入相应的指令，即可让命令行钱包进行相关操作或返回需要的信息。 格式如下（实际使用时不换行无注释）： { &quot;jsonrpc&quot; : 2.0,//定义JSON-RPC版本 &quot;method&quot; : &quot;get_block&quot;,//调用的方法名，例如转账 transfer ，列出账户余额 list_account_balances 等，此处get_block为返回指令块号的区块信息 &quot;params&quot; : [1], //方法传入的参数，若无参数则为null，此处1表示块号 &quot;id&quot; : 1//调用标识符 } Http-RPC接入示例 可以使用curl命令来测试Http-RPC连接命令行钱包实现获取指定账户的各资产余额: curl http://127.0.0.1:9192 -d &#39;{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;list_account_balances&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;], &quot;id&quot;: 1}&#39; {&quot;id&quot;:1,&quot;result&quot;:[{&quot;amount&quot;:&quot;7861151753754&quot;,&quot;asset_id&quot;:&quot;1.3.0&quot;},{&quot;amount&quot;:97099800,&quot;asset_id&quot;:&quot;1.3.8&quot;}]} websocket RPC接入示例 首先在服务器上安装使用wscat测试ws： apt install node-ws 测试通过websocket RPC连接命令行钱包实现一笔转账： wscat -c ws://127.0.0.1:9191 &gt; {&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;transfer&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true], &quot;id&quot;: 1} &lt; {&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:{&quot;ref_block_num&quot;:64292,&quot;ref_block_prefix&quot;:1517346144,&quot;expiration&quot;:&quot;2018-10-12T07:33:12&quot;,&quot;operations&quot;:[[0,{&quot;fee&quot;:{&quot;amount&quot;:2136718,&quot;asset_id&quot;:&quot;1.3.0&quot;},&quot;from&quot;:&quot;1.2.105&quot;,&quot;to&quot;:&quot;1.2.138&quot;,&quot;amount&quot;:{&quot;amount&quot;:&quot;50000000000&quot;,&quot;asset_id&quot;:&quot;1.3.0&quot;},&quot;memo&quot;:{&quot;from&quot;:&quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;,&quot;to&quot;:&quot;SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp&quot;,&quot;nonce&quot;:&quot;4469110159915322318&quot;,&quot;message&quot;:&quot;482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39&quot;},&quot;extensions&quot;:[]}]],&quot;extensions&quot;:[],&quot;signatures&quot;:[&quot;204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd&quot;]}} 切换回命令行钱包所在窗口，可以看到钱包内有如下信息： 2230368ms th_a websocket_api.cpp:109 on_message ] API call execution time limit exceeded. method: transfer params: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true] time: 2310335 实现了让钱包进行了一次转账操作。 常用指令 get_dynamic_global_properties 作用：列出链的当前全局动态参数 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_dynamic_global_properties&quot;, &quot;params&quot;: [], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: { &quot;id&quot;: &quot;2.1.0&quot;, &quot;head_block_number&quot;: 3678309,//当前区块高度 &quot;head_block_id&quot;: &quot;00382065d1057b13415518f913ce26e46fe45cac&quot;,//当前块号 &quot;time&quot;: &quot;2018-10-12T16:37:30&quot;,//链上时间（格林尼治时间） &quot;current_witness&quot;: &quot;1.5.4&quot;,//当前出块的见证人 &quot;next_maintenance_time&quot;: &quot;2018-10-13T00:00:00&quot;,//下次维护更新时间 &quot;last_budget_time&quot;: &quot;2018-10-12T00:00:00&quot;,//上次维护时间 &quot;witness_budget&quot;: 3398400000,//本期见证人预算总额 &quot;accounts_registered_this_interval&quot;: 1,//账户注册间隔 &quot;recently_missed_count&quot;: 0,//最近缺失区块数 &quot;current_aslot&quot;: 4762199,//当前总块（丢掉的块加实际块高） &quot;recent_slots_filled&quot;: &quot;340240787892099949526793007880921399231&quot;,//用于计算见证人参与度的参数 &quot;dynamic_flags&quot;: 0, &quot;last_irreversible_block_num&quot;: 3678305//最近一个不可逆块块号 } } 充提业务需关注 head_block_number 当前区块高度， last_irreversible_block_num 最近一个不可逆块块号。用于判断是否是可信充值操作以及提现是否已处理。 info 作用：显示当前Seer区块链的状态 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;info&quot;, &quot;params&quot;: [], &quot;id&quot;: 1} 返回信息示例： {&quot;id&quot;:1, &quot;result&quot;: { &quot;head_block_num&quot;:3678258,//当前块高 &quot;head_block_id&quot;:&quot;00382032d0bfee243b0c5f6b37e3fd6f29682e6e&quot;,//当前块号 &quot;head_block_age&quot;:&quot;0 second old&quot;,//上一个区块生成时间 &quot;next_maintenance_time&quot;:&quot;7 hours in the future&quot;,//维护更新时间 &quot;chain_id&quot;:&quot;da68a9c5f2fd9ed48e626ea301db1c77505523884ba0dd409e779246c6ea26cf&quot;,//链号 &quot;participation&quot;:&quot;88.28125000000000000&quot;,//区块生产参与率 &quot;active_witnesses&quot;://活跃见证人ID [&quot;1.5.1&quot;,&quot;1.5.2&quot;,&quot;1.5.3&quot;,&quot;1.5.4&quot;,&quot;1.5.5&quot;,&quot;1.5.6&quot;,&quot;1.5.7&quot;,&quot;1.5.8&quot;], &quot;active_committee_members&quot;://活跃理事会成员ID [&quot;1.4.0&quot;,&quot;1.4.1&quot;,&quot;1.4.2&quot;,&quot;1.4.3&quot;,&quot;1.4.4&quot;,&quot;1.4.5&quot;,&quot;1.4.6&quot;,&quot;1.4.7&quot;] } } 充提业务需关注 head_block_age 上一个区块生成时间，participation 区块生产参与率。 提现操作前判断区块链是否正常运行。 list_account_balances 格式：list_account_balances name 参数：name可以是账户名，也可以是账户的id 作用：列出账号为id的账户的各资产余额 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;list_account_balances&quot;, &quot;params&quot;: [&quot;abc&quot;], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: [{ &quot;amount&quot;: &quot;7861177753754&quot;,//余额，精度5,amount没有小数点，其数值被乘以了10000 此处即78611777.53754 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 此处为SEER }, { &quot;amount&quot;: 97099800,//余额，精度5,amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.8&quot;//资产类型 此处为测试链上的ABC资产 }] } 充提业务需关注asset_id为1.3.0(即SEER)的amount (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。 transfer2 格式：transfer2 from to amount asset_symbol memo broadcast(true/false) 参数：from为转出账户,to为接收账户,amount为转账数量, asset_symbol为资产名,memo为备注。from/to 可以是用户名或者id，broadcast设置是否广播。 作用：转账 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;transfer2&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;:[ &quot;7ab0e58b6391a770cb62f432e0f2aef93de4d18e&quot;,//交易id { &quot;ref_block_num&quot;: 64292,//引用的区块号 &quot;ref_block_prefix&quot;: 1517346144,//引用的区块头 &quot;expiration&quot;: &quot;2018-10-12T07:33:12&quot;,//交易过期时间 &quot;operations&quot;: [ [0, {//0表示转账 &quot;fee&quot;: {//手续费 &quot;amount&quot;: 2136718,//金额 ,amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产 此处表示SEER }, &quot;from&quot;: &quot;1.2.105&quot;,//转出账户id &quot;to&quot;: &quot;1.2.138&quot;,//转入账户id &quot;amount&quot;: { &quot;amount&quot;: &quot;50000000000&quot;,//金额 amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产 此处表示SEER }, &quot;memo&quot;: {//memo权限相关 &quot;from&quot;: &quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;, &quot;to&quot;: &quot;SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp&quot;, &quot;nonce&quot;: &quot;4469110159915322318&quot;, &quot;message&quot;: &quot;482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39&quot; }, &quot;extensions&quot;: [] }] ], &quot;extensions&quot;: [], &quot;signatures&quot;: [&quot;204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd&quot;] } ] } 充提业务需关注返回信息的第一个字符串，即交易id，另expiration 交易过期时间。 get_account_id 格式：get_account_id name 参数：name是账户名 作用：列出账户name的账户id 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_account_id&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;], &quot;id&quot;: 1} 返回信息示例： {&quot;id&quot;:1,&quot;result&quot;:&quot;1.2.105&quot;} get_relative_account_history 格式：get_relative_account_history name start limit end 参数：name可以是账户名或id,start为返回结果的最小编号，limit 为返回结果的数量上限，end为返回结果的最大编号； 返回数据排序方式为按时间顺序，越新的越靠前； 编号从1开始，若end = 0，则返回最新的limit条操作信息； 若end - start &gt; limit，则返回满足条件的最新的limit条操作信息。 作用：列出账户name的操作历史记录 请避免一次性返回超过100条数据，以免节点或钱包报错。同时，在命令行钱包中使用此命令时只会返回 &quot;description&quot;中的数据，用RPC调用方能返回完整数据。 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_relative_account_history&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,15,1,30], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: [ { &quot;memo&quot;: &quot;give you 980 SEER&quot;,//解锁并有相应私钥的钱包方能显示MEMO &quot;description&quot;: &quot;Transfer 980 SEER from alice to okok -- Memo: give you 980 SEER (Fee: 21.05468 SEER)&quot;,//钱包一般只显示此内容 &quot;op&quot;: { &quot;id&quot;: &quot;1.9.703568&quot;,//该操作的对象id，可通过get_object 1.9.703568查看此操作 &quot;op&quot;: [ 0, //操作类型，0表示转账 { &quot;fee&quot;: {//手续费 &quot;amount&quot;: 2105468,//数额 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 }, &quot;from&quot;: &quot;1.2.109&quot;,//转出id &quot;to&quot;: &quot;1.2.105&quot;,//接收id &quot;amount&quot;: { &quot;amount&quot;: 98000000,//转账数额 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 }, &quot;memo&quot;: {//MEMO权限相关 &quot;from&quot;: &quot;SEER6sJwPuSSayEzHXLbVgw9HJsDnGBk5Dup5bq3ns1YziZEDMKMgU&quot;, &quot;to&quot;: &quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;, &quot;nonce&quot;: &quot;394073041834538&quot;, &quot;message&quot;: &quot;485e630438b9a38c94c12afd9b15007845484d7f0c8c2c29c135f4f9a155a1ee&quot; }, &quot;extensions&quot;: [] }], &quot;result&quot;: [//操作返回结果 0, { } ], &quot;block_num&quot;: 3674099,//入块高度 &quot;trx_in_block&quot;: 0,//操作所属交易在区块内的位置 &quot;op_in_trx&quot;: 0,//操作在交易内的位置 &quot;virtual_op&quot;: 52924//虚拟操作编号 } }] } get_relative_account_history会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等； 充提业务只需关注op.op.N（操作类型）为0,即转账的操作； 当然最重要的是memo（转账MEMO）和op.op.amount.amount（转账数额）以及op.op.amount.asset_id（资产类型）； 以及op.op.from（转出id），若同一个账号即负责充值又负责提现，则判断op.op.from是否和get_account_id获得的当前账户一样来区分该笔操作是否是本帐户发起的提现操作； op.id为该操作的对象id，也是该转账操作的唯一id； 另外，还需要关注op.block_num，即该操作的入块高度， op.trx_in_block 该操作所属交易在该区块内的位置， op.op_in_trx 该操作在该交易内的位置， 以及op.virtual_op 该操作的虚拟操作编号。 以上四个数据可以和其他指令配合获得该操作所属的txid及判断该操作的唯一性。 get_block 格式：get_block num 参数：块号 作用：显示第num个块的概况 示例：get_block 2090482 返回信息示例： get_block 2090482 { &quot;previous&quot;: &quot;001fe5f1e1dd8d195af805484ee8038a09866b76&quot;,//上一个块的块号 &quot;timestamp&quot;: &quot;2018-07-30T07:31:54&quot;,//时间戳 &quot;witness&quot;: &quot;1.5.22&quot;,//见证人 &quot;transaction_merkle_root&quot;: &quot;72756b0f1f1711622c8030eae65e6db055200320&quot;, &quot;extensions&quot;: [], &quot;witness_signature&quot;: &quot;200d202d735de10f4f8213d71a8f946a2cc49bc02e930f682bea74321819b4bc7c4d436e366f1cad962f214eeaa42b5030fd716f692077f135b3cf33c688f68f1f&quot;,//见证人签名 &quot;transactions&quot;: [{ &quot;ref_block_num&quot;: 58864,//引用的区块号 &quot;ref_block_prefix&quot;: 2207768636,//引用的区块头 &quot;expiration&quot;: &quot;2018-07-30T07:33:51&quot;,//交易过期时间 &quot;operations&quot;: [[ 0,{ &quot;fee&quot;: { &quot;amount&quot;: 200000,//手续费 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 1.3.0指SEER }, &quot;from&quot;: &quot;1.2.1250&quot;,//发起用户ID &quot;to&quot;: &quot;1.2.1292&quot;,//接收用户ID &quot;amount&quot;: { &quot;amount&quot;: 2000000000,//金额20000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 1.3.0指SEER }, &quot;extensions&quot;: [] } ] ], &quot;extensions&quot;: [], &quot;signatures&quot;: [ &quot;205c1f92cd9eebba507094c0fe4a05be47d301b6b2e989f4f0fdcfc8acef69ceec5356faf1667b5576629bfbc29ee5a257dbfac935c5a8fef588e32d7a7902c2b3&quot;//交易签名集合 ], &quot;operation_results&quot;: [[ 0,{} ] ] } ], &quot;block_id&quot;: &quot;001fe5f26d0f3ee5b1569a1618fe903e4dc5aef0&quot;,//块号 &quot;signing_key&quot;: &quot;SEER5oyAoCzw5GRD9unKK6vsLXkPVx1aKU7i3hX19E8BRU5u3FoAoA&quot;,//见证人签名公钥 &quot;transaction_ids&quot;: [ &quot;30e73f68d163398005557a21c58bd751db22eb53&quot;//交易id集 ] } 充提业务需需配合get_relative_account_history中获取的op.block_num来关注get_block获取的transaction_ids数据，若同一个块里有多笔交易，则会有多个transaction_id，需配合get_relative_account_history中获取到的op.trx_in_block来得到该操作所对应的txid。 处理充值业务 1、通过get_relative_account_history查询账户相关历史。 返回结果中并没有直接显示每条记录的序号，需要自行获取和记录。 建议：从start = 1，limit = 1， end = 2开始以一定时间间隔发送请求，每次start 和 end 各自 +1，limit恒等于1，若返回信息不为空，则将该条信息编号并存储。若返回信息为空：{&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[]}，则表示没有新的操作，等待有新的操作信息时继续记录存储。 2、判断是否为充值业务。 get_relative_account_history会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等，充提业务只需要op.op.N（操作类型）为0（转账）的操作数据； 若同一个账号即负责充值又负责提现，则需要区分op.op.from是否和当前账户id一样，，若一样，则是本帐户发起的提现操作，需要排除掉； 剩下的便是待处理的充值操作。 3、获得相关充值数据。 通过Http-RPC或websocket-RPC连接的命令行钱包在unlocked状态时，在get_relative_account_history返回的信息中可以查看memo内容，用户填写的交易所ID等入账信息便从此处获取； 通过op.op.amount.amount（转账数额）加上小数点，便是充值数额； 通过op.op.amount.asset_id（资产类型）来判断是否是平台支持的正确资产类型。 4、判断是否为可信操作。 不同于比特币和以太坊采用确认数来从概率上降低交易被退回的可能性，像SEER这样的石墨烯项目中有不可逆块的概念，不可逆块及更早区块中的交易，可以保证不会发生回退。 get_relative_account_history会返回该笔操作所属的op.block_num(入块高度)，但即使交易未入块，仍然可能出现在账户历史中，因此需要和通过get_dynamic_global_properties获取到的last_irreversible_block_num（最近一个不可逆块块号）比较，op.block_num必须小于或等于last_irreversible_block_num，才能被视为可信操作。 5、记录下该操作的相关信息。 get_relative_account_history中获取到的op.block_num+op.trx_in_block + op.op_in_trx + op.virtual_op 组合到一起，标识该操作的唯一性，可识别避免重复操作； get_relative_account_history中获取到的op.id也是该转账操作的唯一id； 可以通过get_object op.block_num 获取该转账操作所在块的信息，再通过op.trx_in_block的数值来获取到块信息中transaction_ids数组里该转账操作对应的txid，同一个txid可能对应多个操作。 6、如果有充值的MEMO或资产类型不正确，建议不要直接退回，而是等待用户主动联系确认退回路径，因为用户可能是通过交易所或第三方平台提现过来充值的，直接退回但没有对方MEMO可能会造成处理困难甚至资产损失。 处理提现业务 1、提现操作前检查区块链网络是否正常运行 提现业务需关注区块链网络是否正常运行状态，只在网络正常时处理提现。 通过info指令获取到head_block_age（上一个区块生成时间），须在1分钟以内，participation（区块生产参与率）须在80以上，表示80%的区块生产者在正常工作。 同时get_dynamic_global_properties指令获取到的 head_block_number（当前区块高度）和 last_irreversible_block_num（最近一个不可逆块）相差不会太大，一般在30以内。 2、检查提现账户余额 通过list_account_balances列出账户各资产余额，检查asset_id为1.3.0(即SEER)的amount (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。 3、转账并跟踪操作是否成功 通过transfer2向用户转账相应数额的指定资产。 需关注返回信息中的交易id，向用户提供此信息可以让用户在区块浏览器查询自己的提现操作在区块链上的状态和信息，在转出目标未到账的情况下确定该笔操作是否已出账； 关注transfer2返回信息中的expiration（交易过期时间），转账操作发出后，一般很快可以从get_relative_account_history中获取到该笔转账操作的信息，并通过op.block_num和last_irreversible_block_num比较来确认入块； （1）若确认入块，则返回信息中的交易id应该已经存在于get_object op.block_num 获取该转账操作所在块信息的transaction_ids数组中。 （2）若发出的转账操作超过了expiration还未确认入块，则这笔交易可能由于您同时广播的操作太多等各种原因未被区块链打包并已经被丢弃，此时重新发起转账是安全的。 本文由seer爱好者提供，可能理解有误，欢迎到github指出：https://github.com/akirasen/seerdocs/tree/master/zh-Hans 阅读更多" />
<meta property="og:description" content="SEER交易所及第三方平台充提网关接入指南 本指南主要目的是帮助交易所和其它第三方平台（包括但不限于非SEER DAPPs应用、中心化应用等）搭建充提网关接入SEER主网，上线SEER主资产及基于SEER区块链发行的token，例如PFC、OPC等。 使用SEER主网进行充提等操作，手续费远远低于SEER的ERC-20token和BTS资产，且不受以太坊拥堵等事件的影响。 基本原理 大部分交易所及第三方平台使用的网关（充值提现）是一个中心化的应用服务。 以交易所充提为例，交易所为每位用户提供有一个平台id，任何用户向交易所的SEER主网账户转账，并在MEMO中填写该id，当交易所的SEER主网账户收到一笔转账时，可以根据MEMO中填写的信息确定是来自哪位用户的充值，从而在交易所平台内为用户上账。 举例： 1、小明从自己的SEER主网账户xiaoming充值1000SEER到交易所账户seerdex，MEMO中填写10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER； 2、小明请朋友小花帮自己充值，小花从自己的SEER主网账户xiaohua充值1000SEER到交易所账户seerdex，MEMO中填写10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER； 3、小明将自己玩大富翁游戏中赢得的SEER充值交易所，小明在大富翁游戏的提现页面中填写提现1000SEER到交易所账户seerdex，并填写MEMO10010，大富翁游戏在平台内扣除小明账户余额1000SEER，同时通过大富翁的SEER主网账户dafuweng向交易所账户seerdex转账1000SEER，MEMO为10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER。 例子3中，我们举例了用户从第三方平台提现到交易所的流程，从交易所提现到另一家交易所也是如此，这就需要交易所及第三方平台在设计提现功能时提供MEMO功能。为了资金安全，您可以部署两个或多个账号，其中一个账号负责用户充值，其它账号负责提现。 准备工作 运行环境 推荐服务器配置为：2vCPUs 4G内存 20G以上硬盘，Ubuntu 16.04.4 x64 系统。 获得账号及私钥 注册账号 您可以通过SEER网页钱包 https://wallet.seer.best 注册账号，其中账号中带有横杠或数字的账号为普通账号名，可以直接免费注册（点击了解方法） ，例如seer-exchange或seerdex01 ，而由纯英文字母构成的账号名为高级用户名，例如seerdex，则需通过一个终身会员账户缴纳注册手续费来注册。 获得私钥 在充提网关等功能中，我们需要账户的至少两对密钥，即当前资金密钥（Active key）和当前备注密钥（memo key），资金密钥让您拥有资金的转账及其他链上操作权限，备注密钥让您能生成和读取和该账号相关的MEMO信息。点击这里了解获取私钥的方法 。 配置一个SEER全节点 1、在服务器新建一个名叫seer的窗口； screen -S seer 2、在root目录下新建一个名叫seer的目录，下载v0.0.5版本的程序包到此目录，并更名为seer.tar.gz。（请到SEER软件发布页https://github.com/seer-project/seer-core-package/releases 复制最新的ubuntu版本程序包链接替换掉此下载链接。） mkdir seer curl -Lo seer/seer.tar.gz https://github.com/seer-project/seer-core-package/releases/download/v0.05/seer-ubuntu-0.0.5.tar.gz 3、进入seer目录，解压此软件包。 cd seer tar xzvf seer.tar.gz 4、带websocket参数启动witness_node： witness_node --rpc-endpoint=127.0.0.1:9090 partial-operations=true --track-account=&quot;\&quot;seerdex-withdraw\&quot;&quot; --track-account=&quot;\&quot;seerdex-deposit\&quot;&quot; max-ops-per-account=1000 其中的--rpc-endpoint参数为节点监听的websocket RPC IP地址和端口号，需要您替换，此处127.0.0.1为本机，9090是为节点指定的WS端口。 对于处理充提业务的节点，我们并不需要保存全部数据，仅需要保存和交易所账户相关的账户数据以节省内存开支，因此我们需要设置partial-operations参数和--track-account参数，此处partial-operations=true表示只需要部分的数据，&quot;\&quot;seerdex-withdraw\&quot;&quot;和&quot;\&quot;seerdex-deposit\&quot;&quot;表示要追踪的一个或多个账户id，需要您替换。 --max-ops-per-account参数设定内存中保留账户的多少条操作记录，此处1000表示保留追踪账户的1000条操作记录，需要您按需求填写。 5、观察节点运行正常后，ctrl+A d隐藏screen，断开服务器。之后要再打开运行有节点的Sreeen，则使用 screen -R ，或 screen -r seer。 节点正常启动后，会显示像下面一样的3秒一个的出块信息。 如果要关闭节点，则使用control + C 。 配置一个SEER命令行钱包 1、在服务器新建一个名叫cli的窗口，运行seer目录中的命令行钱包程序； screen -S cli cd~ seer/cli_wallet -s ws://127.0.0.1:9090 -r 127.0.0.1:9191 -H 127.0.0.1:9192 -s参数可以设置要连接的节点api地址及端口，此处ws://127.0.0.1:9090为上一步中运行的本地节点的websocket RPC地址和端口，您也可以在此处使用局域网或公网中的其他公共api地址，不过有因外部api无法提供服务而导致命令行钱包异常退出的风险； -r参数可以设置命令行钱包要监听的websocket RPC地址和端口，此处设为127.0.0.1:9191，负责充提业务的程序可以使用此端口调用命令行钱包进行操作； -H参数可以设置命令行钱包要监听的Http-RPC地址和端口，此处设为127.0.0.1:9192，负责充提业务的程序也可以使用此端口调用命令行钱包进行操作。 2、钱包启动成功后，会显示： Please use the set_password method to initialize a new wallet before continuing 3564395ms th_a main.cpp:227 main ] Listening for incoming RPC requests on 127.0.0.1:9191 3564396ms th_a main.cpp:252 main ] Listening for incoming HTTP RPC requests on 127.0.0.1:9192 new &gt;&gt;&gt; 先设置钱包解锁密码，123替换为你想设置的密码 set_password 123 解锁钱包 unlock 123 导入账号资金私钥和备注私钥 import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd 显示如下： new &gt;&gt;&gt; set_password 123 set_password 123 null locked &gt;&gt;&gt; unlock 123 unlock 123 null unlocked &gt;&gt;&gt; import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ import_key okok 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ 3572083ms th_a wallet.cpp:793 save_wallet_file ] saving wallet to file wallet.json 3572084ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to after-import-key-1cd0784e.wallet true unlocked &gt;&gt;&gt; import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd import_key else 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd 3572941ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to before-import-key-1bece5d8.wallet 3573189ms th_a wallet.cpp:793 save_wallet_file ] saving wallet to file wallet.json 3573191ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to after-import-key-1bece5d8.wallet true unlocked &gt;&gt;&gt; 接入命令行钱包 可以使用Http-RPC或websocket RPC方式接入命令行钱包。使用JSON-RPC远程调用协议传入相应的指令，即可让命令行钱包进行相关操作或返回需要的信息。 格式如下（实际使用时不换行无注释）： { &quot;jsonrpc&quot; : 2.0,//定义JSON-RPC版本 &quot;method&quot; : &quot;get_block&quot;,//调用的方法名，例如转账 transfer ，列出账户余额 list_account_balances 等，此处get_block为返回指令块号的区块信息 &quot;params&quot; : [1], //方法传入的参数，若无参数则为null，此处1表示块号 &quot;id&quot; : 1//调用标识符 } Http-RPC接入示例 可以使用curl命令来测试Http-RPC连接命令行钱包实现获取指定账户的各资产余额: curl http://127.0.0.1:9192 -d &#39;{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;list_account_balances&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;], &quot;id&quot;: 1}&#39; {&quot;id&quot;:1,&quot;result&quot;:[{&quot;amount&quot;:&quot;7861151753754&quot;,&quot;asset_id&quot;:&quot;1.3.0&quot;},{&quot;amount&quot;:97099800,&quot;asset_id&quot;:&quot;1.3.8&quot;}]} websocket RPC接入示例 首先在服务器上安装使用wscat测试ws： apt install node-ws 测试通过websocket RPC连接命令行钱包实现一笔转账： wscat -c ws://127.0.0.1:9191 &gt; {&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;transfer&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true], &quot;id&quot;: 1} &lt; {&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:{&quot;ref_block_num&quot;:64292,&quot;ref_block_prefix&quot;:1517346144,&quot;expiration&quot;:&quot;2018-10-12T07:33:12&quot;,&quot;operations&quot;:[[0,{&quot;fee&quot;:{&quot;amount&quot;:2136718,&quot;asset_id&quot;:&quot;1.3.0&quot;},&quot;from&quot;:&quot;1.2.105&quot;,&quot;to&quot;:&quot;1.2.138&quot;,&quot;amount&quot;:{&quot;amount&quot;:&quot;50000000000&quot;,&quot;asset_id&quot;:&quot;1.3.0&quot;},&quot;memo&quot;:{&quot;from&quot;:&quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;,&quot;to&quot;:&quot;SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp&quot;,&quot;nonce&quot;:&quot;4469110159915322318&quot;,&quot;message&quot;:&quot;482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39&quot;},&quot;extensions&quot;:[]}]],&quot;extensions&quot;:[],&quot;signatures&quot;:[&quot;204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd&quot;]}} 切换回命令行钱包所在窗口，可以看到钱包内有如下信息： 2230368ms th_a websocket_api.cpp:109 on_message ] API call execution time limit exceeded. method: transfer params: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true] time: 2310335 实现了让钱包进行了一次转账操作。 常用指令 get_dynamic_global_properties 作用：列出链的当前全局动态参数 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_dynamic_global_properties&quot;, &quot;params&quot;: [], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: { &quot;id&quot;: &quot;2.1.0&quot;, &quot;head_block_number&quot;: 3678309,//当前区块高度 &quot;head_block_id&quot;: &quot;00382065d1057b13415518f913ce26e46fe45cac&quot;,//当前块号 &quot;time&quot;: &quot;2018-10-12T16:37:30&quot;,//链上时间（格林尼治时间） &quot;current_witness&quot;: &quot;1.5.4&quot;,//当前出块的见证人 &quot;next_maintenance_time&quot;: &quot;2018-10-13T00:00:00&quot;,//下次维护更新时间 &quot;last_budget_time&quot;: &quot;2018-10-12T00:00:00&quot;,//上次维护时间 &quot;witness_budget&quot;: 3398400000,//本期见证人预算总额 &quot;accounts_registered_this_interval&quot;: 1,//账户注册间隔 &quot;recently_missed_count&quot;: 0,//最近缺失区块数 &quot;current_aslot&quot;: 4762199,//当前总块（丢掉的块加实际块高） &quot;recent_slots_filled&quot;: &quot;340240787892099949526793007880921399231&quot;,//用于计算见证人参与度的参数 &quot;dynamic_flags&quot;: 0, &quot;last_irreversible_block_num&quot;: 3678305//最近一个不可逆块块号 } } 充提业务需关注 head_block_number 当前区块高度， last_irreversible_block_num 最近一个不可逆块块号。用于判断是否是可信充值操作以及提现是否已处理。 info 作用：显示当前Seer区块链的状态 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;info&quot;, &quot;params&quot;: [], &quot;id&quot;: 1} 返回信息示例： {&quot;id&quot;:1, &quot;result&quot;: { &quot;head_block_num&quot;:3678258,//当前块高 &quot;head_block_id&quot;:&quot;00382032d0bfee243b0c5f6b37e3fd6f29682e6e&quot;,//当前块号 &quot;head_block_age&quot;:&quot;0 second old&quot;,//上一个区块生成时间 &quot;next_maintenance_time&quot;:&quot;7 hours in the future&quot;,//维护更新时间 &quot;chain_id&quot;:&quot;da68a9c5f2fd9ed48e626ea301db1c77505523884ba0dd409e779246c6ea26cf&quot;,//链号 &quot;participation&quot;:&quot;88.28125000000000000&quot;,//区块生产参与率 &quot;active_witnesses&quot;://活跃见证人ID [&quot;1.5.1&quot;,&quot;1.5.2&quot;,&quot;1.5.3&quot;,&quot;1.5.4&quot;,&quot;1.5.5&quot;,&quot;1.5.6&quot;,&quot;1.5.7&quot;,&quot;1.5.8&quot;], &quot;active_committee_members&quot;://活跃理事会成员ID [&quot;1.4.0&quot;,&quot;1.4.1&quot;,&quot;1.4.2&quot;,&quot;1.4.3&quot;,&quot;1.4.4&quot;,&quot;1.4.5&quot;,&quot;1.4.6&quot;,&quot;1.4.7&quot;] } } 充提业务需关注 head_block_age 上一个区块生成时间，participation 区块生产参与率。 提现操作前判断区块链是否正常运行。 list_account_balances 格式：list_account_balances name 参数：name可以是账户名，也可以是账户的id 作用：列出账号为id的账户的各资产余额 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;list_account_balances&quot;, &quot;params&quot;: [&quot;abc&quot;], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: [{ &quot;amount&quot;: &quot;7861177753754&quot;,//余额，精度5,amount没有小数点，其数值被乘以了10000 此处即78611777.53754 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 此处为SEER }, { &quot;amount&quot;: 97099800,//余额，精度5,amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.8&quot;//资产类型 此处为测试链上的ABC资产 }] } 充提业务需关注asset_id为1.3.0(即SEER)的amount (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。 transfer2 格式：transfer2 from to amount asset_symbol memo broadcast(true/false) 参数：from为转出账户,to为接收账户,amount为转账数量, asset_symbol为资产名,memo为备注。from/to 可以是用户名或者id，broadcast设置是否广播。 作用：转账 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;transfer2&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;:[ &quot;7ab0e58b6391a770cb62f432e0f2aef93de4d18e&quot;,//交易id { &quot;ref_block_num&quot;: 64292,//引用的区块号 &quot;ref_block_prefix&quot;: 1517346144,//引用的区块头 &quot;expiration&quot;: &quot;2018-10-12T07:33:12&quot;,//交易过期时间 &quot;operations&quot;: [ [0, {//0表示转账 &quot;fee&quot;: {//手续费 &quot;amount&quot;: 2136718,//金额 ,amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产 此处表示SEER }, &quot;from&quot;: &quot;1.2.105&quot;,//转出账户id &quot;to&quot;: &quot;1.2.138&quot;,//转入账户id &quot;amount&quot;: { &quot;amount&quot;: &quot;50000000000&quot;,//金额 amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产 此处表示SEER }, &quot;memo&quot;: {//memo权限相关 &quot;from&quot;: &quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;, &quot;to&quot;: &quot;SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp&quot;, &quot;nonce&quot;: &quot;4469110159915322318&quot;, &quot;message&quot;: &quot;482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39&quot; }, &quot;extensions&quot;: [] }] ], &quot;extensions&quot;: [], &quot;signatures&quot;: [&quot;204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd&quot;] } ] } 充提业务需关注返回信息的第一个字符串，即交易id，另expiration 交易过期时间。 get_account_id 格式：get_account_id name 参数：name是账户名 作用：列出账户name的账户id 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_account_id&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;], &quot;id&quot;: 1} 返回信息示例： {&quot;id&quot;:1,&quot;result&quot;:&quot;1.2.105&quot;} get_relative_account_history 格式：get_relative_account_history name start limit end 参数：name可以是账户名或id,start为返回结果的最小编号，limit 为返回结果的数量上限，end为返回结果的最大编号； 返回数据排序方式为按时间顺序，越新的越靠前； 编号从1开始，若end = 0，则返回最新的limit条操作信息； 若end - start &gt; limit，则返回满足条件的最新的limit条操作信息。 作用：列出账户name的操作历史记录 请避免一次性返回超过100条数据，以免节点或钱包报错。同时，在命令行钱包中使用此命令时只会返回 &quot;description&quot;中的数据，用RPC调用方能返回完整数据。 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_relative_account_history&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,15,1,30], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: [ { &quot;memo&quot;: &quot;give you 980 SEER&quot;,//解锁并有相应私钥的钱包方能显示MEMO &quot;description&quot;: &quot;Transfer 980 SEER from alice to okok -- Memo: give you 980 SEER (Fee: 21.05468 SEER)&quot;,//钱包一般只显示此内容 &quot;op&quot;: { &quot;id&quot;: &quot;1.9.703568&quot;,//该操作的对象id，可通过get_object 1.9.703568查看此操作 &quot;op&quot;: [ 0, //操作类型，0表示转账 { &quot;fee&quot;: {//手续费 &quot;amount&quot;: 2105468,//数额 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 }, &quot;from&quot;: &quot;1.2.109&quot;,//转出id &quot;to&quot;: &quot;1.2.105&quot;,//接收id &quot;amount&quot;: { &quot;amount&quot;: 98000000,//转账数额 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 }, &quot;memo&quot;: {//MEMO权限相关 &quot;from&quot;: &quot;SEER6sJwPuSSayEzHXLbVgw9HJsDnGBk5Dup5bq3ns1YziZEDMKMgU&quot;, &quot;to&quot;: &quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;, &quot;nonce&quot;: &quot;394073041834538&quot;, &quot;message&quot;: &quot;485e630438b9a38c94c12afd9b15007845484d7f0c8c2c29c135f4f9a155a1ee&quot; }, &quot;extensions&quot;: [] }], &quot;result&quot;: [//操作返回结果 0, { } ], &quot;block_num&quot;: 3674099,//入块高度 &quot;trx_in_block&quot;: 0,//操作所属交易在区块内的位置 &quot;op_in_trx&quot;: 0,//操作在交易内的位置 &quot;virtual_op&quot;: 52924//虚拟操作编号 } }] } get_relative_account_history会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等； 充提业务只需关注op.op.N（操作类型）为0,即转账的操作； 当然最重要的是memo（转账MEMO）和op.op.amount.amount（转账数额）以及op.op.amount.asset_id（资产类型）； 以及op.op.from（转出id），若同一个账号即负责充值又负责提现，则判断op.op.from是否和get_account_id获得的当前账户一样来区分该笔操作是否是本帐户发起的提现操作； op.id为该操作的对象id，也是该转账操作的唯一id； 另外，还需要关注op.block_num，即该操作的入块高度， op.trx_in_block 该操作所属交易在该区块内的位置， op.op_in_trx 该操作在该交易内的位置， 以及op.virtual_op 该操作的虚拟操作编号。 以上四个数据可以和其他指令配合获得该操作所属的txid及判断该操作的唯一性。 get_block 格式：get_block num 参数：块号 作用：显示第num个块的概况 示例：get_block 2090482 返回信息示例： get_block 2090482 { &quot;previous&quot;: &quot;001fe5f1e1dd8d195af805484ee8038a09866b76&quot;,//上一个块的块号 &quot;timestamp&quot;: &quot;2018-07-30T07:31:54&quot;,//时间戳 &quot;witness&quot;: &quot;1.5.22&quot;,//见证人 &quot;transaction_merkle_root&quot;: &quot;72756b0f1f1711622c8030eae65e6db055200320&quot;, &quot;extensions&quot;: [], &quot;witness_signature&quot;: &quot;200d202d735de10f4f8213d71a8f946a2cc49bc02e930f682bea74321819b4bc7c4d436e366f1cad962f214eeaa42b5030fd716f692077f135b3cf33c688f68f1f&quot;,//见证人签名 &quot;transactions&quot;: [{ &quot;ref_block_num&quot;: 58864,//引用的区块号 &quot;ref_block_prefix&quot;: 2207768636,//引用的区块头 &quot;expiration&quot;: &quot;2018-07-30T07:33:51&quot;,//交易过期时间 &quot;operations&quot;: [[ 0,{ &quot;fee&quot;: { &quot;amount&quot;: 200000,//手续费 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 1.3.0指SEER }, &quot;from&quot;: &quot;1.2.1250&quot;,//发起用户ID &quot;to&quot;: &quot;1.2.1292&quot;,//接收用户ID &quot;amount&quot;: { &quot;amount&quot;: 2000000000,//金额20000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 1.3.0指SEER }, &quot;extensions&quot;: [] } ] ], &quot;extensions&quot;: [], &quot;signatures&quot;: [ &quot;205c1f92cd9eebba507094c0fe4a05be47d301b6b2e989f4f0fdcfc8acef69ceec5356faf1667b5576629bfbc29ee5a257dbfac935c5a8fef588e32d7a7902c2b3&quot;//交易签名集合 ], &quot;operation_results&quot;: [[ 0,{} ] ] } ], &quot;block_id&quot;: &quot;001fe5f26d0f3ee5b1569a1618fe903e4dc5aef0&quot;,//块号 &quot;signing_key&quot;: &quot;SEER5oyAoCzw5GRD9unKK6vsLXkPVx1aKU7i3hX19E8BRU5u3FoAoA&quot;,//见证人签名公钥 &quot;transaction_ids&quot;: [ &quot;30e73f68d163398005557a21c58bd751db22eb53&quot;//交易id集 ] } 充提业务需需配合get_relative_account_history中获取的op.block_num来关注get_block获取的transaction_ids数据，若同一个块里有多笔交易，则会有多个transaction_id，需配合get_relative_account_history中获取到的op.trx_in_block来得到该操作所对应的txid。 处理充值业务 1、通过get_relative_account_history查询账户相关历史。 返回结果中并没有直接显示每条记录的序号，需要自行获取和记录。 建议：从start = 1，limit = 1， end = 2开始以一定时间间隔发送请求，每次start 和 end 各自 +1，limit恒等于1，若返回信息不为空，则将该条信息编号并存储。若返回信息为空：{&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[]}，则表示没有新的操作，等待有新的操作信息时继续记录存储。 2、判断是否为充值业务。 get_relative_account_history会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等，充提业务只需要op.op.N（操作类型）为0（转账）的操作数据； 若同一个账号即负责充值又负责提现，则需要区分op.op.from是否和当前账户id一样，，若一样，则是本帐户发起的提现操作，需要排除掉； 剩下的便是待处理的充值操作。 3、获得相关充值数据。 通过Http-RPC或websocket-RPC连接的命令行钱包在unlocked状态时，在get_relative_account_history返回的信息中可以查看memo内容，用户填写的交易所ID等入账信息便从此处获取； 通过op.op.amount.amount（转账数额）加上小数点，便是充值数额； 通过op.op.amount.asset_id（资产类型）来判断是否是平台支持的正确资产类型。 4、判断是否为可信操作。 不同于比特币和以太坊采用确认数来从概率上降低交易被退回的可能性，像SEER这样的石墨烯项目中有不可逆块的概念，不可逆块及更早区块中的交易，可以保证不会发生回退。 get_relative_account_history会返回该笔操作所属的op.block_num(入块高度)，但即使交易未入块，仍然可能出现在账户历史中，因此需要和通过get_dynamic_global_properties获取到的last_irreversible_block_num（最近一个不可逆块块号）比较，op.block_num必须小于或等于last_irreversible_block_num，才能被视为可信操作。 5、记录下该操作的相关信息。 get_relative_account_history中获取到的op.block_num+op.trx_in_block + op.op_in_trx + op.virtual_op 组合到一起，标识该操作的唯一性，可识别避免重复操作； get_relative_account_history中获取到的op.id也是该转账操作的唯一id； 可以通过get_object op.block_num 获取该转账操作所在块的信息，再通过op.trx_in_block的数值来获取到块信息中transaction_ids数组里该转账操作对应的txid，同一个txid可能对应多个操作。 6、如果有充值的MEMO或资产类型不正确，建议不要直接退回，而是等待用户主动联系确认退回路径，因为用户可能是通过交易所或第三方平台提现过来充值的，直接退回但没有对方MEMO可能会造成处理困难甚至资产损失。 处理提现业务 1、提现操作前检查区块链网络是否正常运行 提现业务需关注区块链网络是否正常运行状态，只在网络正常时处理提现。 通过info指令获取到head_block_age（上一个区块生成时间），须在1分钟以内，participation（区块生产参与率）须在80以上，表示80%的区块生产者在正常工作。 同时get_dynamic_global_properties指令获取到的 head_block_number（当前区块高度）和 last_irreversible_block_num（最近一个不可逆块）相差不会太大，一般在30以内。 2、检查提现账户余额 通过list_account_balances列出账户各资产余额，检查asset_id为1.3.0(即SEER)的amount (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。 3、转账并跟踪操作是否成功 通过transfer2向用户转账相应数额的指定资产。 需关注返回信息中的交易id，向用户提供此信息可以让用户在区块浏览器查询自己的提现操作在区块链上的状态和信息，在转出目标未到账的情况下确定该笔操作是否已出账； 关注transfer2返回信息中的expiration（交易过期时间），转账操作发出后，一般很快可以从get_relative_account_history中获取到该笔转账操作的信息，并通过op.block_num和last_irreversible_block_num比较来确认入块； （1）若确认入块，则返回信息中的交易id应该已经存在于get_object op.block_num 获取该转账操作所在块信息的transaction_ids数组中。 （2）若发出的转账操作超过了expiration还未确认入块，则这笔交易可能由于您同时广播的操作太多等各种原因未被区块链打包并已经被丢弃，此时重新发起转账是安全的。 本文由seer爱好者提供，可能理解有误，欢迎到github指出：https://github.com/akirasen/seerdocs/tree/master/zh-Hans 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/10/14/024df37dbbd986eafb8bb1fda90f65a9.html" />
<meta property="og:url" content="https://mlh.app/2018/10/14/024df37dbbd986eafb8bb1fda90f65a9.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-14T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"SEER交易所及第三方平台充提网关接入指南 本指南主要目的是帮助交易所和其它第三方平台（包括但不限于非SEER DAPPs应用、中心化应用等）搭建充提网关接入SEER主网，上线SEER主资产及基于SEER区块链发行的token，例如PFC、OPC等。 使用SEER主网进行充提等操作，手续费远远低于SEER的ERC-20token和BTS资产，且不受以太坊拥堵等事件的影响。 基本原理 大部分交易所及第三方平台使用的网关（充值提现）是一个中心化的应用服务。 以交易所充提为例，交易所为每位用户提供有一个平台id，任何用户向交易所的SEER主网账户转账，并在MEMO中填写该id，当交易所的SEER主网账户收到一笔转账时，可以根据MEMO中填写的信息确定是来自哪位用户的充值，从而在交易所平台内为用户上账。 举例： 1、小明从自己的SEER主网账户xiaoming充值1000SEER到交易所账户seerdex，MEMO中填写10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER； 2、小明请朋友小花帮自己充值，小花从自己的SEER主网账户xiaohua充值1000SEER到交易所账户seerdex，MEMO中填写10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER； 3、小明将自己玩大富翁游戏中赢得的SEER充值交易所，小明在大富翁游戏的提现页面中填写提现1000SEER到交易所账户seerdex，并填写MEMO10010，大富翁游戏在平台内扣除小明账户余额1000SEER，同时通过大富翁的SEER主网账户dafuweng向交易所账户seerdex转账1000SEER，MEMO为10010，交易所检测到主网账户seerdex收到一笔1000SEER的转账，MEMO为10010，则在小明的交易所账户10010中上账1000SEER。 例子3中，我们举例了用户从第三方平台提现到交易所的流程，从交易所提现到另一家交易所也是如此，这就需要交易所及第三方平台在设计提现功能时提供MEMO功能。为了资金安全，您可以部署两个或多个账号，其中一个账号负责用户充值，其它账号负责提现。 准备工作 运行环境 推荐服务器配置为：2vCPUs 4G内存 20G以上硬盘，Ubuntu 16.04.4 x64 系统。 获得账号及私钥 注册账号 您可以通过SEER网页钱包 https://wallet.seer.best 注册账号，其中账号中带有横杠或数字的账号为普通账号名，可以直接免费注册（点击了解方法） ，例如seer-exchange或seerdex01 ，而由纯英文字母构成的账号名为高级用户名，例如seerdex，则需通过一个终身会员账户缴纳注册手续费来注册。 获得私钥 在充提网关等功能中，我们需要账户的至少两对密钥，即当前资金密钥（Active key）和当前备注密钥（memo key），资金密钥让您拥有资金的转账及其他链上操作权限，备注密钥让您能生成和读取和该账号相关的MEMO信息。点击这里了解获取私钥的方法 。 配置一个SEER全节点 1、在服务器新建一个名叫seer的窗口； screen -S seer 2、在root目录下新建一个名叫seer的目录，下载v0.0.5版本的程序包到此目录，并更名为seer.tar.gz。（请到SEER软件发布页https://github.com/seer-project/seer-core-package/releases 复制最新的ubuntu版本程序包链接替换掉此下载链接。） mkdir seer curl -Lo seer/seer.tar.gz https://github.com/seer-project/seer-core-package/releases/download/v0.05/seer-ubuntu-0.0.5.tar.gz 3、进入seer目录，解压此软件包。 cd seer tar xzvf seer.tar.gz 4、带websocket参数启动witness_node： witness_node --rpc-endpoint=127.0.0.1:9090 partial-operations=true --track-account=&quot;\\&quot;seerdex-withdraw\\&quot;&quot; --track-account=&quot;\\&quot;seerdex-deposit\\&quot;&quot; max-ops-per-account=1000 其中的--rpc-endpoint参数为节点监听的websocket RPC IP地址和端口号，需要您替换，此处127.0.0.1为本机，9090是为节点指定的WS端口。 对于处理充提业务的节点，我们并不需要保存全部数据，仅需要保存和交易所账户相关的账户数据以节省内存开支，因此我们需要设置partial-operations参数和--track-account参数，此处partial-operations=true表示只需要部分的数据，&quot;\\&quot;seerdex-withdraw\\&quot;&quot;和&quot;\\&quot;seerdex-deposit\\&quot;&quot;表示要追踪的一个或多个账户id，需要您替换。 --max-ops-per-account参数设定内存中保留账户的多少条操作记录，此处1000表示保留追踪账户的1000条操作记录，需要您按需求填写。 5、观察节点运行正常后，ctrl+A d隐藏screen，断开服务器。之后要再打开运行有节点的Sreeen，则使用 screen -R ，或 screen -r seer。 节点正常启动后，会显示像下面一样的3秒一个的出块信息。 如果要关闭节点，则使用control + C 。 配置一个SEER命令行钱包 1、在服务器新建一个名叫cli的窗口，运行seer目录中的命令行钱包程序； screen -S cli cd~ seer/cli_wallet -s ws://127.0.0.1:9090 -r 127.0.0.1:9191 -H 127.0.0.1:9192 -s参数可以设置要连接的节点api地址及端口，此处ws://127.0.0.1:9090为上一步中运行的本地节点的websocket RPC地址和端口，您也可以在此处使用局域网或公网中的其他公共api地址，不过有因外部api无法提供服务而导致命令行钱包异常退出的风险； -r参数可以设置命令行钱包要监听的websocket RPC地址和端口，此处设为127.0.0.1:9191，负责充提业务的程序可以使用此端口调用命令行钱包进行操作； -H参数可以设置命令行钱包要监听的Http-RPC地址和端口，此处设为127.0.0.1:9192，负责充提业务的程序也可以使用此端口调用命令行钱包进行操作。 2、钱包启动成功后，会显示： Please use the set_password method to initialize a new wallet before continuing 3564395ms th_a main.cpp:227 main ] Listening for incoming RPC requests on 127.0.0.1:9191 3564396ms th_a main.cpp:252 main ] Listening for incoming HTTP RPC requests on 127.0.0.1:9192 new &gt;&gt;&gt; 先设置钱包解锁密码，123替换为你想设置的密码 set_password 123 解锁钱包 unlock 123 导入账号资金私钥和备注私钥 import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd 显示如下： new &gt;&gt;&gt; set_password 123 set_password 123 null locked &gt;&gt;&gt; unlock 123 unlock 123 null unlocked &gt;&gt;&gt; import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ import_key okok 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ 3572083ms th_a wallet.cpp:793 save_wallet_file ] saving wallet to file wallet.json 3572084ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to after-import-key-1cd0784e.wallet true unlocked &gt;&gt;&gt; import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd import_key else 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd 3572941ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to before-import-key-1bece5d8.wallet 3573189ms th_a wallet.cpp:793 save_wallet_file ] saving wallet to file wallet.json 3573191ms th_a wallet.cpp:467 copy_wallet_file ] backing up wallet wallet.json to after-import-key-1bece5d8.wallet true unlocked &gt;&gt;&gt; 接入命令行钱包 可以使用Http-RPC或websocket RPC方式接入命令行钱包。使用JSON-RPC远程调用协议传入相应的指令，即可让命令行钱包进行相关操作或返回需要的信息。 格式如下（实际使用时不换行无注释）： { &quot;jsonrpc&quot; : 2.0,//定义JSON-RPC版本 &quot;method&quot; : &quot;get_block&quot;,//调用的方法名，例如转账 transfer ，列出账户余额 list_account_balances 等，此处get_block为返回指令块号的区块信息 &quot;params&quot; : [1], //方法传入的参数，若无参数则为null，此处1表示块号 &quot;id&quot; : 1//调用标识符 } Http-RPC接入示例 可以使用curl命令来测试Http-RPC连接命令行钱包实现获取指定账户的各资产余额: curl http://127.0.0.1:9192 -d &#39;{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;list_account_balances&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;], &quot;id&quot;: 1}&#39; {&quot;id&quot;:1,&quot;result&quot;:[{&quot;amount&quot;:&quot;7861151753754&quot;,&quot;asset_id&quot;:&quot;1.3.0&quot;},{&quot;amount&quot;:97099800,&quot;asset_id&quot;:&quot;1.3.8&quot;}]} websocket RPC接入示例 首先在服务器上安装使用wscat测试ws： apt install node-ws 测试通过websocket RPC连接命令行钱包实现一笔转账： wscat -c ws://127.0.0.1:9191 &gt; {&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;transfer&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true], &quot;id&quot;: 1} &lt; {&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:{&quot;ref_block_num&quot;:64292,&quot;ref_block_prefix&quot;:1517346144,&quot;expiration&quot;:&quot;2018-10-12T07:33:12&quot;,&quot;operations&quot;:[[0,{&quot;fee&quot;:{&quot;amount&quot;:2136718,&quot;asset_id&quot;:&quot;1.3.0&quot;},&quot;from&quot;:&quot;1.2.105&quot;,&quot;to&quot;:&quot;1.2.138&quot;,&quot;amount&quot;:{&quot;amount&quot;:&quot;50000000000&quot;,&quot;asset_id&quot;:&quot;1.3.0&quot;},&quot;memo&quot;:{&quot;from&quot;:&quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;,&quot;to&quot;:&quot;SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp&quot;,&quot;nonce&quot;:&quot;4469110159915322318&quot;,&quot;message&quot;:&quot;482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39&quot;},&quot;extensions&quot;:[]}]],&quot;extensions&quot;:[],&quot;signatures&quot;:[&quot;204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd&quot;]}} 切换回命令行钱包所在窗口，可以看到钱包内有如下信息： 2230368ms th_a websocket_api.cpp:109 on_message ] API call execution time limit exceeded. method: transfer params: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true] time: 2310335 实现了让钱包进行了一次转账操作。 常用指令 get_dynamic_global_properties 作用：列出链的当前全局动态参数 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_dynamic_global_properties&quot;, &quot;params&quot;: [], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: { &quot;id&quot;: &quot;2.1.0&quot;, &quot;head_block_number&quot;: 3678309,//当前区块高度 &quot;head_block_id&quot;: &quot;00382065d1057b13415518f913ce26e46fe45cac&quot;,//当前块号 &quot;time&quot;: &quot;2018-10-12T16:37:30&quot;,//链上时间（格林尼治时间） &quot;current_witness&quot;: &quot;1.5.4&quot;,//当前出块的见证人 &quot;next_maintenance_time&quot;: &quot;2018-10-13T00:00:00&quot;,//下次维护更新时间 &quot;last_budget_time&quot;: &quot;2018-10-12T00:00:00&quot;,//上次维护时间 &quot;witness_budget&quot;: 3398400000,//本期见证人预算总额 &quot;accounts_registered_this_interval&quot;: 1,//账户注册间隔 &quot;recently_missed_count&quot;: 0,//最近缺失区块数 &quot;current_aslot&quot;: 4762199,//当前总块（丢掉的块加实际块高） &quot;recent_slots_filled&quot;: &quot;340240787892099949526793007880921399231&quot;,//用于计算见证人参与度的参数 &quot;dynamic_flags&quot;: 0, &quot;last_irreversible_block_num&quot;: 3678305//最近一个不可逆块块号 } } 充提业务需关注 head_block_number 当前区块高度， last_irreversible_block_num 最近一个不可逆块块号。用于判断是否是可信充值操作以及提现是否已处理。 info 作用：显示当前Seer区块链的状态 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;info&quot;, &quot;params&quot;: [], &quot;id&quot;: 1} 返回信息示例： {&quot;id&quot;:1, &quot;result&quot;: { &quot;head_block_num&quot;:3678258,//当前块高 &quot;head_block_id&quot;:&quot;00382032d0bfee243b0c5f6b37e3fd6f29682e6e&quot;,//当前块号 &quot;head_block_age&quot;:&quot;0 second old&quot;,//上一个区块生成时间 &quot;next_maintenance_time&quot;:&quot;7 hours in the future&quot;,//维护更新时间 &quot;chain_id&quot;:&quot;da68a9c5f2fd9ed48e626ea301db1c77505523884ba0dd409e779246c6ea26cf&quot;,//链号 &quot;participation&quot;:&quot;88.28125000000000000&quot;,//区块生产参与率 &quot;active_witnesses&quot;://活跃见证人ID [&quot;1.5.1&quot;,&quot;1.5.2&quot;,&quot;1.5.3&quot;,&quot;1.5.4&quot;,&quot;1.5.5&quot;,&quot;1.5.6&quot;,&quot;1.5.7&quot;,&quot;1.5.8&quot;], &quot;active_committee_members&quot;://活跃理事会成员ID [&quot;1.4.0&quot;,&quot;1.4.1&quot;,&quot;1.4.2&quot;,&quot;1.4.3&quot;,&quot;1.4.4&quot;,&quot;1.4.5&quot;,&quot;1.4.6&quot;,&quot;1.4.7&quot;] } } 充提业务需关注 head_block_age 上一个区块生成时间，participation 区块生产参与率。 提现操作前判断区块链是否正常运行。 list_account_balances 格式：list_account_balances name 参数：name可以是账户名，也可以是账户的id 作用：列出账号为id的账户的各资产余额 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;list_account_balances&quot;, &quot;params&quot;: [&quot;abc&quot;], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: [{ &quot;amount&quot;: &quot;7861177753754&quot;,//余额，精度5,amount没有小数点，其数值被乘以了10000 此处即78611777.53754 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 此处为SEER }, { &quot;amount&quot;: 97099800,//余额，精度5,amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.8&quot;//资产类型 此处为测试链上的ABC资产 }] } 充提业务需关注asset_id为1.3.0(即SEER)的amount (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。 transfer2 格式：transfer2 from to amount asset_symbol memo broadcast(true/false) 参数：from为转出账户,to为接收账户,amount为转账数量, asset_symbol为资产名,memo为备注。from/to 可以是用户名或者id，broadcast设置是否广播。 作用：转账 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;transfer2&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,&quot;ffffff&quot;,&quot;500000&quot;,&quot;SEER&quot;,&quot;Welcome to SEERTALK. https://forum.seerchain.org&quot;,true], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;:[ &quot;7ab0e58b6391a770cb62f432e0f2aef93de4d18e&quot;,//交易id { &quot;ref_block_num&quot;: 64292,//引用的区块号 &quot;ref_block_prefix&quot;: 1517346144,//引用的区块头 &quot;expiration&quot;: &quot;2018-10-12T07:33:12&quot;,//交易过期时间 &quot;operations&quot;: [ [0, {//0表示转账 &quot;fee&quot;: {//手续费 &quot;amount&quot;: 2136718,//金额 ,amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产 此处表示SEER }, &quot;from&quot;: &quot;1.2.105&quot;,//转出账户id &quot;to&quot;: &quot;1.2.138&quot;,//转入账户id &quot;amount&quot;: { &quot;amount&quot;: &quot;50000000000&quot;,//金额 amount没有小数点，其数值被乘以了10000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产 此处表示SEER }, &quot;memo&quot;: {//memo权限相关 &quot;from&quot;: &quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;, &quot;to&quot;: &quot;SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp&quot;, &quot;nonce&quot;: &quot;4469110159915322318&quot;, &quot;message&quot;: &quot;482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39&quot; }, &quot;extensions&quot;: [] }] ], &quot;extensions&quot;: [], &quot;signatures&quot;: [&quot;204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd&quot;] } ] } 充提业务需关注返回信息的第一个字符串，即交易id，另expiration 交易过期时间。 get_account_id 格式：get_account_id name 参数：name是账户名 作用：列出账户name的账户id 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_account_id&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;], &quot;id&quot;: 1} 返回信息示例： {&quot;id&quot;:1,&quot;result&quot;:&quot;1.2.105&quot;} get_relative_account_history 格式：get_relative_account_history name start limit end 参数：name可以是账户名或id,start为返回结果的最小编号，limit 为返回结果的数量上限，end为返回结果的最大编号； 返回数据排序方式为按时间顺序，越新的越靠前； 编号从1开始，若end = 0，则返回最新的limit条操作信息； 若end - start &gt; limit，则返回满足条件的最新的limit条操作信息。 作用：列出账户name的操作历史记录 请避免一次性返回超过100条数据，以免节点或钱包报错。同时，在命令行钱包中使用此命令时只会返回 &quot;description&quot;中的数据，用RPC调用方能返回完整数据。 示例：{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;get_relative_account_history&quot;, &quot;params&quot;: [&quot;seerdex-withdraw&quot;,15,1,30], &quot;id&quot;: 1} 返回信息示例： { &quot;id&quot;: 1, &quot;result&quot;: [ { &quot;memo&quot;: &quot;give you 980 SEER&quot;,//解锁并有相应私钥的钱包方能显示MEMO &quot;description&quot;: &quot;Transfer 980 SEER from alice to okok -- Memo: give you 980 SEER (Fee: 21.05468 SEER)&quot;,//钱包一般只显示此内容 &quot;op&quot;: { &quot;id&quot;: &quot;1.9.703568&quot;,//该操作的对象id，可通过get_object 1.9.703568查看此操作 &quot;op&quot;: [ 0, //操作类型，0表示转账 { &quot;fee&quot;: {//手续费 &quot;amount&quot;: 2105468,//数额 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 }, &quot;from&quot;: &quot;1.2.109&quot;,//转出id &quot;to&quot;: &quot;1.2.105&quot;,//接收id &quot;amount&quot;: { &quot;amount&quot;: 98000000,//转账数额 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 }, &quot;memo&quot;: {//MEMO权限相关 &quot;from&quot;: &quot;SEER6sJwPuSSayEzHXLbVgw9HJsDnGBk5Dup5bq3ns1YziZEDMKMgU&quot;, &quot;to&quot;: &quot;SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH&quot;, &quot;nonce&quot;: &quot;394073041834538&quot;, &quot;message&quot;: &quot;485e630438b9a38c94c12afd9b15007845484d7f0c8c2c29c135f4f9a155a1ee&quot; }, &quot;extensions&quot;: [] }], &quot;result&quot;: [//操作返回结果 0, { } ], &quot;block_num&quot;: 3674099,//入块高度 &quot;trx_in_block&quot;: 0,//操作所属交易在区块内的位置 &quot;op_in_trx&quot;: 0,//操作在交易内的位置 &quot;virtual_op&quot;: 52924//虚拟操作编号 } }] } get_relative_account_history会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等； 充提业务只需关注op.op.N（操作类型）为0,即转账的操作； 当然最重要的是memo（转账MEMO）和op.op.amount.amount（转账数额）以及op.op.amount.asset_id（资产类型）； 以及op.op.from（转出id），若同一个账号即负责充值又负责提现，则判断op.op.from是否和get_account_id获得的当前账户一样来区分该笔操作是否是本帐户发起的提现操作； op.id为该操作的对象id，也是该转账操作的唯一id； 另外，还需要关注op.block_num，即该操作的入块高度， op.trx_in_block 该操作所属交易在该区块内的位置， op.op_in_trx 该操作在该交易内的位置， 以及op.virtual_op 该操作的虚拟操作编号。 以上四个数据可以和其他指令配合获得该操作所属的txid及判断该操作的唯一性。 get_block 格式：get_block num 参数：块号 作用：显示第num个块的概况 示例：get_block 2090482 返回信息示例： get_block 2090482 { &quot;previous&quot;: &quot;001fe5f1e1dd8d195af805484ee8038a09866b76&quot;,//上一个块的块号 &quot;timestamp&quot;: &quot;2018-07-30T07:31:54&quot;,//时间戳 &quot;witness&quot;: &quot;1.5.22&quot;,//见证人 &quot;transaction_merkle_root&quot;: &quot;72756b0f1f1711622c8030eae65e6db055200320&quot;, &quot;extensions&quot;: [], &quot;witness_signature&quot;: &quot;200d202d735de10f4f8213d71a8f946a2cc49bc02e930f682bea74321819b4bc7c4d436e366f1cad962f214eeaa42b5030fd716f692077f135b3cf33c688f68f1f&quot;,//见证人签名 &quot;transactions&quot;: [{ &quot;ref_block_num&quot;: 58864,//引用的区块号 &quot;ref_block_prefix&quot;: 2207768636,//引用的区块头 &quot;expiration&quot;: &quot;2018-07-30T07:33:51&quot;,//交易过期时间 &quot;operations&quot;: [[ 0,{ &quot;fee&quot;: { &quot;amount&quot;: 200000,//手续费 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 1.3.0指SEER }, &quot;from&quot;: &quot;1.2.1250&quot;,//发起用户ID &quot;to&quot;: &quot;1.2.1292&quot;,//接收用户ID &quot;amount&quot;: { &quot;amount&quot;: 2000000000,//金额20000 &quot;asset_id&quot;: &quot;1.3.0&quot;//资产类型 1.3.0指SEER }, &quot;extensions&quot;: [] } ] ], &quot;extensions&quot;: [], &quot;signatures&quot;: [ &quot;205c1f92cd9eebba507094c0fe4a05be47d301b6b2e989f4f0fdcfc8acef69ceec5356faf1667b5576629bfbc29ee5a257dbfac935c5a8fef588e32d7a7902c2b3&quot;//交易签名集合 ], &quot;operation_results&quot;: [[ 0,{} ] ] } ], &quot;block_id&quot;: &quot;001fe5f26d0f3ee5b1569a1618fe903e4dc5aef0&quot;,//块号 &quot;signing_key&quot;: &quot;SEER5oyAoCzw5GRD9unKK6vsLXkPVx1aKU7i3hX19E8BRU5u3FoAoA&quot;,//见证人签名公钥 &quot;transaction_ids&quot;: [ &quot;30e73f68d163398005557a21c58bd751db22eb53&quot;//交易id集 ] } 充提业务需需配合get_relative_account_history中获取的op.block_num来关注get_block获取的transaction_ids数据，若同一个块里有多笔交易，则会有多个transaction_id，需配合get_relative_account_history中获取到的op.trx_in_block来得到该操作所对应的txid。 处理充值业务 1、通过get_relative_account_history查询账户相关历史。 返回结果中并没有直接显示每条记录的序号，需要自行获取和记录。 建议：从start = 1，limit = 1， end = 2开始以一定时间间隔发送请求，每次start 和 end 各自 +1，limit恒等于1，若返回信息不为空，则将该条信息编号并存储。若返回信息为空：{&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:[]}，则表示没有新的操作，等待有新的操作信息时继续记录存储。 2、判断是否为充值业务。 get_relative_account_history会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等，充提业务只需要op.op.N（操作类型）为0（转账）的操作数据； 若同一个账号即负责充值又负责提现，则需要区分op.op.from是否和当前账户id一样，，若一样，则是本帐户发起的提现操作，需要排除掉； 剩下的便是待处理的充值操作。 3、获得相关充值数据。 通过Http-RPC或websocket-RPC连接的命令行钱包在unlocked状态时，在get_relative_account_history返回的信息中可以查看memo内容，用户填写的交易所ID等入账信息便从此处获取； 通过op.op.amount.amount（转账数额）加上小数点，便是充值数额； 通过op.op.amount.asset_id（资产类型）来判断是否是平台支持的正确资产类型。 4、判断是否为可信操作。 不同于比特币和以太坊采用确认数来从概率上降低交易被退回的可能性，像SEER这样的石墨烯项目中有不可逆块的概念，不可逆块及更早区块中的交易，可以保证不会发生回退。 get_relative_account_history会返回该笔操作所属的op.block_num(入块高度)，但即使交易未入块，仍然可能出现在账户历史中，因此需要和通过get_dynamic_global_properties获取到的last_irreversible_block_num（最近一个不可逆块块号）比较，op.block_num必须小于或等于last_irreversible_block_num，才能被视为可信操作。 5、记录下该操作的相关信息。 get_relative_account_history中获取到的op.block_num+op.trx_in_block + op.op_in_trx + op.virtual_op 组合到一起，标识该操作的唯一性，可识别避免重复操作； get_relative_account_history中获取到的op.id也是该转账操作的唯一id； 可以通过get_object op.block_num 获取该转账操作所在块的信息，再通过op.trx_in_block的数值来获取到块信息中transaction_ids数组里该转账操作对应的txid，同一个txid可能对应多个操作。 6、如果有充值的MEMO或资产类型不正确，建议不要直接退回，而是等待用户主动联系确认退回路径，因为用户可能是通过交易所或第三方平台提现过来充值的，直接退回但没有对方MEMO可能会造成处理困难甚至资产损失。 处理提现业务 1、提现操作前检查区块链网络是否正常运行 提现业务需关注区块链网络是否正常运行状态，只在网络正常时处理提现。 通过info指令获取到head_block_age（上一个区块生成时间），须在1分钟以内，participation（区块生产参与率）须在80以上，表示80%的区块生产者在正常工作。 同时get_dynamic_global_properties指令获取到的 head_block_number（当前区块高度）和 last_irreversible_block_num（最近一个不可逆块）相差不会太大，一般在30以内。 2、检查提现账户余额 通过list_account_balances列出账户各资产余额，检查asset_id为1.3.0(即SEER)的amount (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。 3、转账并跟踪操作是否成功 通过transfer2向用户转账相应数额的指定资产。 需关注返回信息中的交易id，向用户提供此信息可以让用户在区块浏览器查询自己的提现操作在区块链上的状态和信息，在转出目标未到账的情况下确定该笔操作是否已出账； 关注transfer2返回信息中的expiration（交易过期时间），转账操作发出后，一般很快可以从get_relative_account_history中获取到该笔转账操作的信息，并通过op.block_num和last_irreversible_block_num比较来确认入块； （1）若确认入块，则返回信息中的交易id应该已经存在于get_object op.block_num 获取该转账操作所在块信息的transaction_ids数组中。 （2）若发出的转账操作超过了expiration还未确认入块，则这笔交易可能由于您同时广播的操作太多等各种原因未被区块链打包并已经被丢弃，此时重新发起转账是安全的。 本文由seer爱好者提供，可能理解有误，欢迎到github指出：https://github.com/akirasen/seerdocs/tree/master/zh-Hans 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/10/14/024df37dbbd986eafb8bb1fda90f65a9.html","headline":"SEER交易所及第三方平台充提网关接入指南","dateModified":"2018-10-14T00:00:00+08:00","datePublished":"2018-10-14T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/10/14/024df37dbbd986eafb8bb1fda90f65a9.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>SEER交易所及第三方平台充提网关接入指南</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h1><a id="SEER_0"></a>SEER交易所及第三方平台充提网关接入指南</h1> 
  <p>本指南主要目的是帮助交易所和其它第三方平台（包括但不限于非SEER DAPPs应用、中心化应用等）搭建充提网关接入SEER主网，上线SEER主资产及基于SEER区块链发行的token，例如PFC、OPC等。</p> 
  <p>使用SEER主网进行充提等操作，手续费远远低于SEER的ERC-20token和BTS资产，且不受以太坊拥堵等事件的影响。</p> 
  <h2><a id="_6"></a>基本原理</h2> 
  <p>大部分交易所及第三方平台使用的网关（充值提现）是一个中心化的应用服务。</p> 
  <p>以交易所充提为例，交易所为每位用户提供有一个平台id，任何用户向交易所的SEER主网账户转账，并在MEMO中填写该id，当交易所的SEER主网账户收到一笔转账时，可以根据MEMO中填写的信息确定是来自哪位用户的充值，从而在交易所平台内为用户上账。</p> 
  <p>举例：</p> 
  <p>1、小明从自己的SEER主网账户<code>xiaoming</code>充值<code>1000SEER</code>到交易所账户<code>seerdex</code>，MEMO中填写<code>10010</code>，交易所检测到主网账户<code>seerdex</code>收到一笔<code>1000SEER</code>的转账，MEMO为<code>10010</code>，则在小明的交易所账户<code>10010</code>中上账<code>1000SEER</code>；</p> 
  <p>2、小明请朋友小花帮自己充值，小花从自己的SEER主网账户<code>xiaohua</code>充值<code>1000SEER</code>到交易所账户<code>seerdex</code>，MEMO中填写<code>10010</code>，交易所检测到主网账户<code>seerdex</code>收到一笔<code>1000SEER</code>的转账，MEMO为<code>10010</code>，则在小明的交易所账户<code>10010</code>中上账<code>1000SEER</code>；</p> 
  <p>3、小明将自己玩大富翁游戏中赢得的SEER充值交易所，小明在大富翁游戏的提现页面中填写提现<code>1000SEER</code>到交易所账户<code>seerdex</code>，并填写MEMO<code>10010</code>，大富翁游戏在平台内扣除小明账户余额<code>1000SEER</code>，同时通过大富翁的SEER主网账户<code>dafuweng</code>向交易所账户<code>seerdex</code>转账<code>1000SEER</code>，MEMO为<code>10010</code>，交易所检测到主网账户<code>seerdex</code>收到一笔<code>1000SEER</code>的转账，MEMO为<code>10010</code>，则在小明的交易所账户<code>10010</code>中上账<code>1000SEER</code>。</p> 
  <p><code>例子3</code>中，我们举例了用户从第三方平台提现到交易所的流程，从交易所提现到另一家交易所也是如此，这就需要交易所及第三方平台在设计提现功能时提供<code>MEMO功能</code>。为了资金安全，您可以部署两个或多个账号，其中一个账号负责用户充值，其它账号负责提现。</p> 
  <h2><a id="_22"></a>准备工作</h2> 
  <h3><a id="_24"></a>运行环境</h3> 
  <p>推荐服务器配置为：2vCPUs 4G内存 20G以上硬盘，Ubuntu 16.04.4 x64 系统。</p> 
  <h3><a id="_28"></a>获得账号及私钥</h3> 
  <h4><a id="_30"></a>注册账号</h4> 
  <p>您可以通过SEER网页钱包 <a href="https://wallet.seer.best" rel="nofollow">https://wallet.seer.best</a> 注册账号，其中账号中带有横杠或数字的账号为普通账号名，可以直接<a href="https://docs.seerchain.org/#/zh-Hans/?id=%E6%B3%A8%E5%86%8C" rel="nofollow">免费注册（点击了解方法） </a> ，例如<code>seer-exchange</code>或<code>seerdex01</code> ，而由纯英文字母构成的账号名为高级用户名，例如<code>seerdex</code>，则需通过一个终身会员账户缴纳注册手续费来注册。</p> 
  <h4><a id="_34"></a>获得私钥</h4> 
  <p>在充提网关等功能中，我们需要账户的至少两对密钥，即当前资金密钥（Active key）和当前备注密钥（memo key），资金密钥让您拥有资金的转账及其他链上操作权限，备注密钥让您能生成和读取和该账号相关的MEMO信息。<a href="https://docs.seerchain.org/#/zh-Hans/?id=%E6%9F%A5%E7%9C%8B%E6%82%A8%E7%9A%84%E7%A7%81%E9%92%A5" rel="nofollow">点击这里了解获取私钥的方法 </a> 。</p> 
  <h2><a id="SEER_38"></a>配置一个SEER全节点</h2> 
  <p>1、在服务器新建一个名叫seer的窗口；</p> 
  <pre><code class="prism language-linux">screen -S seer
</code></pre> 
  <p>2、在root目录下新建一个名叫seer的目录，下载<code>v0.0.5版本</code>的程序包到此目录，并更名为<code>seer.tar.gz</code>。（请到SEER软件发布页https://github.com/seer-project/seer-core-package/releases 复制最新的ubuntu版本程序包链接替换掉此下载链接。）</p> 
  <pre><code class="prism language-linux">mkdir seer
curl -Lo seer/seer.tar.gz https://github.com/seer-project/seer-core-package/releases/download/v0.05/seer-ubuntu-0.0.5.tar.gz 
</code></pre> 
  <p>3、进入seer目录，解压此软件包。</p> 
  <pre><code class="prism language-linux">cd seer
tar xzvf seer.tar.gz
</code></pre> 
  <p>4、带websocket参数启动witness_node：</p> 
  <pre><code class="prism language-linux">witness_node --rpc-endpoint=127.0.0.1:9090 partial-operations=true --track-account="\"seerdex-withdraw\"" --track-account="\"seerdex-deposit\"" max-ops-per-account=1000 
</code></pre> 
  <p>其中的<code>--rpc-endpoint</code>参数为节点监听的websocket RPC IP地址和端口号，需要您替换，此处<code>127.0.0.1</code>为本机，<code>9090</code>是为节点指定的WS端口。</p> 
  <p>对于处理充提业务的节点，我们并不需要保存全部数据，仅需要保存和交易所账户相关的账户数据以节省内存开支，因此我们需要设置<code>partial-operations</code>参数和<code>--track-account</code>参数，此处<code>partial-operations=true</code>表示只需要部分的数据，<code>"\"seerdex-withdraw\""</code>和<code>"\"seerdex-deposit\""</code>表示要追踪的一个或多个账户id，需要您替换。</p> 
  <p><code>--max-ops-per-account</code>参数设定内存中保留账户的多少条操作记录，此处<code>1000</code>表示保留追踪账户的<code>1000</code>条操作记录，需要您按需求填写。</p> 
  <p>5、观察节点运行正常后，ctrl+A d隐藏screen，断开服务器。之后要再打开运行有节点的Sreeen，则使用 <code>screen -R</code> ，或 <code>screen -r seer</code>。</p> 
  <p>节点正常启动后，会显示像下面一样的3秒一个的出块信息。</p> 
  <p><img src="https://github.com/akirasen/seerdocs/raw/master/zh-Hans/img/640.gif" alt="节点正常启动的状态"></p> 
  <p>如果要关闭节点，则使用<code>control</code> + <code>C</code> 。</p> 
  <h2><a id="SEER_79"></a>配置一个SEER命令行钱包</h2> 
  <p>1、在服务器新建一个名叫cli的窗口，运行seer目录中的命令行钱包程序；</p> 
  <pre><code class="prism language-linux">screen -S cli
cd~
seer/cli_wallet -s ws://127.0.0.1:9090 -r 127.0.0.1:9191 -H 127.0.0.1:9192
</code></pre> 
  <p><code>-s</code>参数可以设置要连接的节点api地址及端口，此处<code>ws://127.0.0.1:9090</code>为上一步中运行的本地节点的websocket RPC地址和端口，您也可以在此处使用局域网或公网中的其他公共api地址，不过有因外部api无法提供服务而导致命令行钱包异常退出的风险；</p> 
  <p><code>-r</code>参数可以设置命令行钱包要监听的websocket RPC地址和端口，此处设为<code>127.0.0.1:9191</code>，负责充提业务的程序可以使用此端口调用命令行钱包进行操作；</p> 
  <p><code>-H</code>参数可以设置命令行钱包要监听的Http-RPC地址和端口，此处设为<code>127.0.0.1:9192</code>，负责充提业务的程序也可以使用此端口调用命令行钱包进行操作。</p> 
  <p>2、钱包启动成功后，会显示：</p> 
  <pre><code class="prism language-cmd">Please use the set_password method to initialize a new wallet before continuing
3564395ms th_a       main.cpp:227                  main                 ] Listening for incoming RPC requests on 127.0.0.1:9191
3564396ms th_a       main.cpp:252                  main                 ] Listening for incoming HTTP RPC requests on 127.0.0.1:9192
new &gt;&gt;&gt; 
</code></pre> 
  <p>先设置钱包解锁密码，123替换为你想设置的密码</p> 
  <pre><code class="prism language-cmd">set_password 123
</code></pre> 
  <p>解锁钱包</p> 
  <pre><code class="prism language-cmd">unlock 123
</code></pre> 
  <p>导入账号资金私钥和备注私钥</p> 
  <pre><code class="prism language-cmd">import_key seerdex-withdraw 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ
import_key seerdex-withdraw 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd
</code></pre> 
  <p>显示如下：</p> 
  <pre><code class="prism language-cmd">new &gt;&gt;&gt; set_password 123
set_password 123
null
locked &gt;&gt;&gt; unlock 123
unlock 123
null
unlocked &gt;&gt;&gt; import_key seerdex-withdraw  5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ
import_key okok 5JkbV8aTaYRVaarTUJQ9Y56cr4QajxNFfCoQj6Q9JFL8XvUZ5CQ
3572083ms th_a       wallet.cpp:793                save_wallet_file     ] saving wallet to file wallet.json
3572084ms th_a       wallet.cpp:467                copy_wallet_file     ] backing up wallet wallet.json to after-import-key-1cd0784e.wallet
true
unlocked &gt;&gt;&gt; import_key seerdex-withdraw  5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd
import_key else 5KiSC6rRAEkTj72fg3G3zF8RHmCEgZw7aSXBjKqDfvY2XN1qvyd
3572941ms th_a       wallet.cpp:467                copy_wallet_file     ] backing up wallet wallet.json to before-import-key-1bece5d8.wallet
3573189ms th_a       wallet.cpp:793                save_wallet_file     ] saving wallet to file wallet.json
3573191ms th_a       wallet.cpp:467                copy_wallet_file     ] backing up wallet wallet.json to after-import-key-1bece5d8.wallet
true
unlocked &gt;&gt;&gt; 
</code></pre> 
  <h2><a id="_138"></a>接入命令行钱包</h2> 
  <p>可以使用Http-RPC或websocket RPC方式接入命令行钱包。使用JSON-RPC远程调用协议传入相应的指令，即可让命令行钱包进行相关操作或返回需要的信息。</p> 
  <p>格式如下（实际使用时不换行无注释）：</p> 
  <pre><code class="prism language-json"><span class="token punctuation">{</span> 
    <span class="token string">"jsonrpc"</span> <span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span><span class="token comment">//定义JSON-RPC版本</span>
    <span class="token string">"method"</span> <span class="token punctuation">:</span> <span class="token string">"get_block"</span><span class="token punctuation">,</span><span class="token comment">//调用的方法名，例如转账 transfer ，列出账户余额 list_account_balances 等，此处get_block为返回指令块号的区块信息</span>
    <span class="token string">"params"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//方法传入的参数，若无参数则为null，此处1表示块号</span>
    <span class="token string">"id"</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token comment">//调用标识符</span>
<span class="token punctuation">}</span> 
</code></pre> 
  <h3><a id="HttpRPC_153"></a>Http-RPC接入示例</h3> 
  <p>可以使用curl命令来测试Http-RPC连接命令行钱包实现获取指定账户的各资产余额:</p> 
  <pre><code class="prism language-linux"> curl http://127.0.0.1:9192 -d '{"jsonrpc": "2.0", "method": "list_account_balances", "params": ["seerdex-withdraw"], "id": 1}'

 {"id":1,"result":[{"amount":"7861151753754","asset_id":"1.3.0"},{"amount":97099800,"asset_id":"1.3.8"}]}
</code></pre> 
  <h3><a id="websocket_RPC_163"></a>websocket RPC接入示例</h3> 
  <p>首先在服务器上安装使用wscat测试ws：</p> 
  <pre><code class="prism language-linux"> apt install node-ws
</code></pre> 
  <p>测试通过websocket RPC连接命令行钱包实现一笔转账：</p> 
  <pre><code class="prism language-json">wscat <span class="token operator">-</span>c ws<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9191</span>
<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token string">"jsonrpc"</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span> <span class="token string">"method"</span><span class="token punctuation">:</span> <span class="token string">"transfer"</span><span class="token punctuation">,</span> <span class="token string">"params"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"seerdex-withdraw"</span><span class="token punctuation">,</span><span class="token string">"ffffff"</span><span class="token punctuation">,</span><span class="token string">"500000"</span><span class="token punctuation">,</span><span class="token string">"SEER"</span><span class="token punctuation">,</span><span class="token string">"Welcome to SEERTALK. https://forum.seerchain.org"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span> <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"jsonrpc"</span><span class="token punctuation">:</span><span class="token string">"2.0"</span><span class="token punctuation">,</span><span class="token string">"result"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"ref_block_num"</span><span class="token punctuation">:</span><span class="token number">64292</span><span class="token punctuation">,</span><span class="token string">"ref_block_prefix"</span><span class="token punctuation">:</span><span class="token number">1517346144</span><span class="token punctuation">,</span><span class="token string">"expiration"</span><span class="token punctuation">:</span><span class="token string">"2018-10-12T07:33:12"</span><span class="token punctuation">,</span><span class="token string">"operations"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"fee"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"amount"</span><span class="token punctuation">:</span><span class="token number">2136718</span><span class="token punctuation">,</span><span class="token string">"asset_id"</span><span class="token punctuation">:</span><span class="token string">"1.3.0"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"1.2.105"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"1.2.138"</span><span class="token punctuation">,</span><span class="token string">"amount"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"amount"</span><span class="token punctuation">:</span><span class="token string">"50000000000"</span><span class="token punctuation">,</span><span class="token string">"asset_id"</span><span class="token punctuation">:</span><span class="token string">"1.3.0"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"memo"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp"</span><span class="token punctuation">,</span><span class="token string">"nonce"</span><span class="token punctuation">:</span><span class="token string">"4469110159915322318"</span><span class="token punctuation">,</span><span class="token string">"message"</span><span class="token punctuation">:</span><span class="token string">"482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"extensions"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"extensions"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"signatures"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">"204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                                           
</code></pre> 
  <p>切换回命令行钱包所在窗口，可以看到钱包内有如下信息：</p> 
  <pre><code class="prism language-cmd">2230368ms th_a       websocket_api.cpp:109         on_message           ] API call execution time limit exceeded. method: transfer params: ["seerdex-withdraw","ffffff","500000","SEER","Welcome to SEERTALK. https://forum.seerchain.org",true] time: 2310335
</code></pre> 
  <p>实现了让钱包进行了一次转账操作。</p> 
  <h2><a id="_182"></a>常用指令</h2> 
  <h3><a id="get_dynamic_global_properties_184"></a>get_dynamic_global_properties</h3> 
  <p>作用：列出链的当前全局动态参数</p> 
  <p>示例：<code>{"jsonrpc": "2.0", "method": "get_dynamic_global_properties", "params": [], "id": 1}</code></p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json"><span class="token punctuation">{</span>
		<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
			<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"2.1.0"</span><span class="token punctuation">,</span>
			<span class="token string">"head_block_number"</span><span class="token punctuation">:</span> <span class="token number">3678309</span><span class="token punctuation">,</span><span class="token comment">//当前区块高度</span>
			<span class="token string">"head_block_id"</span><span class="token punctuation">:</span> <span class="token string">"00382065d1057b13415518f913ce26e46fe45cac"</span><span class="token punctuation">,</span><span class="token comment">//当前块号</span>
			<span class="token string">"time"</span><span class="token punctuation">:</span> <span class="token string">"2018-10-12T16:37:30"</span><span class="token punctuation">,</span><span class="token comment">//链上时间（格林尼治时间）</span>
			<span class="token string">"current_witness"</span><span class="token punctuation">:</span> <span class="token string">"1.5.4"</span><span class="token punctuation">,</span><span class="token comment">//当前出块的见证人</span>
			<span class="token string">"next_maintenance_time"</span><span class="token punctuation">:</span> <span class="token string">"2018-10-13T00:00:00"</span><span class="token punctuation">,</span><span class="token comment">//下次维护更新时间</span>
			<span class="token string">"last_budget_time"</span><span class="token punctuation">:</span> <span class="token string">"2018-10-12T00:00:00"</span><span class="token punctuation">,</span><span class="token comment">//上次维护时间</span>
			<span class="token string">"witness_budget"</span><span class="token punctuation">:</span> <span class="token number">3398400000</span><span class="token punctuation">,</span><span class="token comment">//本期见证人预算总额</span>
			<span class="token string">"accounts_registered_this_interval"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">//账户注册间隔</span>
			<span class="token string">"recently_missed_count"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//最近缺失区块数</span>
			<span class="token string">"current_aslot"</span><span class="token punctuation">:</span> <span class="token number">4762199</span><span class="token punctuation">,</span><span class="token comment">//当前总块（丢掉的块加实际块高）</span>
			<span class="token string">"recent_slots_filled"</span><span class="token punctuation">:</span> <span class="token string">"340240787892099949526793007880921399231"</span><span class="token punctuation">,</span><span class="token comment">//用于计算见证人参与度的参数</span>
			<span class="token string">"dynamic_flags"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			<span class="token string">"last_irreversible_block_num"</span><span class="token punctuation">:</span> <span class="token number">3678305</span><span class="token comment">//最近一个不可逆块块号</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>充提业务需关注 <code>head_block_number</code> 当前区块高度， <code>last_irreversible_block_num</code> 最近一个不可逆块块号。用于判断是否是可信充值操作以及提现是否已处理。</p> 
  <h3><a id="info_215"></a>info</h3> 
  <p>作用：显示当前Seer区块链的状态</p> 
  <p>示例：<code>{"jsonrpc": "2.0", "method": "info", "params": [], "id": 1}</code></p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json"> <span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
 	<span class="token string">"result"</span><span class="token punctuation">:</span>
 	<span class="token punctuation">{</span>
 		<span class="token string">"head_block_num"</span><span class="token punctuation">:</span><span class="token number">3678258</span><span class="token punctuation">,</span><span class="token comment">//当前块高</span>
 		<span class="token string">"head_block_id"</span><span class="token punctuation">:</span><span class="token string">"00382032d0bfee243b0c5f6b37e3fd6f29682e6e"</span><span class="token punctuation">,</span><span class="token comment">//当前块号</span>
 		<span class="token string">"head_block_age"</span><span class="token punctuation">:</span><span class="token string">"0 second old"</span><span class="token punctuation">,</span><span class="token comment">//上一个区块生成时间</span>
 		<span class="token string">"next_maintenance_time"</span><span class="token punctuation">:</span><span class="token string">"7 hours in the future"</span><span class="token punctuation">,</span><span class="token comment">//维护更新时间</span>
 		<span class="token string">"chain_id"</span><span class="token punctuation">:</span><span class="token string">"da68a9c5f2fd9ed48e626ea301db1c77505523884ba0dd409e779246c6ea26cf"</span><span class="token punctuation">,</span><span class="token comment">//链号</span>
 		<span class="token string">"participation"</span><span class="token punctuation">:</span><span class="token string">"88.28125000000000000"</span><span class="token punctuation">,</span><span class="token comment">//区块生产参与率</span>
 		<span class="token string">"active_witnesses"</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>活跃见证人<span class="token constant">ID</span>
 		<span class="token punctuation">[</span><span class="token string">"1.5.1"</span><span class="token punctuation">,</span><span class="token string">"1.5.2"</span><span class="token punctuation">,</span><span class="token string">"1.5.3"</span><span class="token punctuation">,</span><span class="token string">"1.5.4"</span><span class="token punctuation">,</span><span class="token string">"1.5.5"</span><span class="token punctuation">,</span><span class="token string">"1.5.6"</span><span class="token punctuation">,</span><span class="token string">"1.5.7"</span><span class="token punctuation">,</span><span class="token string">"1.5.8"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
 		<span class="token string">"active_committee_members"</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>活跃理事会成员<span class="token constant">ID</span>
 		<span class="token punctuation">[</span><span class="token string">"1.4.0"</span><span class="token punctuation">,</span><span class="token string">"1.4.1"</span><span class="token punctuation">,</span><span class="token string">"1.4.2"</span><span class="token punctuation">,</span><span class="token string">"1.4.3"</span><span class="token punctuation">,</span><span class="token string">"1.4.4"</span><span class="token punctuation">,</span><span class="token string">"1.4.5"</span><span class="token punctuation">,</span><span class="token string">"1.4.6"</span><span class="token punctuation">,</span><span class="token string">"1.4.7"</span><span class="token punctuation">]</span>
 	<span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> 
  <p>充提业务需关注 <code>head_block_age</code> 上一个区块生成时间，<code>participation</code> 区块生产参与率。 提现操作前判断区块链是否正常运行。</p> 
  <h3><a id="list_account_balances_242"></a>list_account_balances</h3> 
  <p>格式：<code>list_account_balances</code> name</p> 
  <p>参数：name可以是账户名，也可以是账户的id</p> 
  <p>作用：列出账号为id的账户的各资产余额</p> 
  <p>示例：<code>{"jsonrpc": "2.0", "method": "list_account_balances", "params": ["abc"], "id": 1}</code></p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json"><span class="token punctuation">{</span>
		<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
			<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token string">"7861177753754"</span><span class="token punctuation">,</span><span class="token comment">//余额，精度5,amount没有小数点，其数值被乘以了10000 此处即78611777.53754</span>
			<span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产类型 此处为SEER</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
			<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">97099800</span><span class="token punctuation">,</span><span class="token comment">//余额，精度5,amount没有小数点，其数值被乘以了10000 </span>
			<span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.8"</span><span class="token comment">//资产类型 此处为测试链上的ABC资产</span>
		<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>充提业务需关注<code>asset_id</code>为1.3.0(即SEER)的<code>amount</code> (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。</p> 
  <h3><a id="transfer2_267"></a>transfer2</h3> 
  <p>格式：<code>transfer2</code> from to amount asset_symbol memo broadcast(true/false)</p> 
  <p>参数：from为转出账户,to为接收账户,amount为转账数量, asset_symbol为资产名,memo为备注。from/to 可以是用户名或者id，broadcast设置是否广播。</p> 
  <p>作用：转账</p> 
  <p>示例：<code>{"jsonrpc": "2.0", "method": "transfer2", "params": ["seerdex-withdraw","ffffff","500000","SEER","Welcome to SEERTALK. https://forum.seerchain.org",true], "id": 1}</code></p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json"><span class="token punctuation">{</span>
	<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token string">"jsonrpc"</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span>
	<span class="token string">"result"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
		<span class="token string">"7ab0e58b6391a770cb62f432e0f2aef93de4d18e"</span><span class="token punctuation">,</span><span class="token comment">//交易id</span>
		<span class="token punctuation">{</span>
		<span class="token string">"ref_block_num"</span><span class="token punctuation">:</span> <span class="token number">64292</span><span class="token punctuation">,</span><span class="token comment">//引用的区块号</span>
		<span class="token string">"ref_block_prefix"</span><span class="token punctuation">:</span> <span class="token number">1517346144</span><span class="token punctuation">,</span><span class="token comment">//引用的区块头</span>
		<span class="token string">"expiration"</span><span class="token punctuation">:</span> <span class="token string">"2018-10-12T07:33:12"</span><span class="token punctuation">,</span><span class="token comment">//交易过期时间</span>
		<span class="token string">"operations"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">//0表示转账</span>
				<span class="token string">"fee"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">//手续费</span>
					<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">2136718</span><span class="token punctuation">,</span><span class="token comment">//金额 ,amount没有小数点，其数值被乘以了10000 </span>
					<span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产 此处表示SEER</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"1.2.105"</span><span class="token punctuation">,</span><span class="token comment">//转出账户id</span>
				<span class="token string">"to"</span><span class="token punctuation">:</span> <span class="token string">"1.2.138"</span><span class="token punctuation">,</span><span class="token comment">//转入账户id</span>
				<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
					<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token string">"50000000000"</span><span class="token punctuation">,</span><span class="token comment">//金额 amount没有小数点，其数值被乘以了10000 </span>
					<span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产 此处表示SEER</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token string">"memo"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">//memo权限相关</span>
					<span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH"</span><span class="token punctuation">,</span>
					<span class="token string">"to"</span><span class="token punctuation">:</span> <span class="token string">"SEER6QbqUZF6xzjdceVoLHS7K1KwvLyszVTZS8bbsQQQXcAm8L3aZp"</span><span class="token punctuation">,</span>
					<span class="token string">"nonce"</span><span class="token punctuation">:</span> <span class="token string">"4469110159915322318"</span><span class="token punctuation">,</span>
					<span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"482a7d070d298fe2a79d5f528f55778c62584d242274a7d697dae1ec63d7038b5a0b80dc9ba524e3f5f528bc717c60a635f89ff8af1cccbd1b4189f8ddc92e39"</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span><span class="token punctuation">]</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token string">"signatures"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"204e8746aac14a05fb3c66ac653429dead34bddac58911c53346feb365f0c7b5767ea870c1e5da6a104d8364e42f504fc1bdcfc442652f5c2e9bb9b26a858b0ccd"</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre> 
  <p>充提业务需关注返回信息的第一个字符串，即交易id，另<code>expiration</code> 交易过期时间。</p> 
  <h3><a id="get_account_id_319"></a>get_account_id</h3> 
  <p>格式：<code>get_account_id</code> name</p> 
  <p>参数：name是账户名</p> 
  <p>作用：列出账户name的账户id</p> 
  <p>示例：<code>{"jsonrpc": "2.0", "method": "get_account_id", "params": ["seerdex-withdraw"], "id": 1}</code></p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json"><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"result"</span><span class="token punctuation">:</span><span class="token string">"1.2.105"</span><span class="token punctuation">}</span>
</code></pre> 
  <h3><a id="get_relative_account_history_334"></a>get_relative_account_history</h3> 
  <p>格式：<code>get_relative_account_history</code> name start limit end</p> 
  <p>参数：name可以是账户名或id,start为返回结果的最小编号，limit 为返回结果的数量上限，end为返回结果的最大编号；</p> 
  <p>返回数据排序方式为按时间顺序，越新的越靠前；</p> 
  <p>编号从1开始，若end = 0，则返回最新的limit条操作信息；</p> 
  <p>若end - start &gt; limit，则返回满足条件的最新的limit条操作信息。</p> 
  <p>作用：列出账户name的操作历史记录</p> 
  <p class="tip"> 请避免一次性返回超过100条数据，以免节点或钱包报错。同时，在命令行钱包中使用此命令时只会返回 "description"中的数据，用RPC调用方能返回完整数据。 </p> 
  <p>示例：<code>{"jsonrpc": "2.0", "method": "get_relative_account_history", "params": ["seerdex-withdraw",15,1,30], "id": 1}</code></p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json"><span class="token punctuation">{</span>
		<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
			<span class="token string">"memo"</span><span class="token punctuation">:</span> <span class="token string">"give you 980 SEER"</span><span class="token punctuation">,</span><span class="token comment">//解锁并有相应私钥的钱包方能显示MEMO</span>
			<span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Transfer 980 SEER from alice to okok -- Memo: give you 980 SEER (Fee: 21.05468 SEER)"</span><span class="token punctuation">,</span><span class="token comment">//钱包一般只显示此内容</span>
			<span class="token string">"op"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
				<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"1.9.703568"</span><span class="token punctuation">,</span><span class="token comment">//该操作的对象id，可通过get_object 1.9.703568查看此操作</span>
				<span class="token string">"op"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
					<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//操作类型，0表示转账</span>
					<span class="token punctuation">{</span>
					<span class="token string">"fee"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">//手续费</span>
						<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">2105468</span><span class="token punctuation">,</span><span class="token comment">//数额</span>
						<span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产类型</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"1.2.109"</span><span class="token punctuation">,</span><span class="token comment">//转出id</span>
					<span class="token string">"to"</span><span class="token punctuation">:</span> <span class="token string">"1.2.105"</span><span class="token punctuation">,</span><span class="token comment">//接收id</span>
					<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
						<span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">98000000</span><span class="token punctuation">,</span><span class="token comment">//转账数额</span>
						<span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产类型</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token string">"memo"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">//MEMO权限相关</span>
						<span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"SEER6sJwPuSSayEzHXLbVgw9HJsDnGBk5Dup5bq3ns1YziZEDMKMgU"</span><span class="token punctuation">,</span>
						<span class="token string">"to"</span><span class="token punctuation">:</span> <span class="token string">"SEER8UAbnsAnXY1qr3CD6uzKaRuewsyPF9ynYJJGrdvSfDANxsGNxH"</span><span class="token punctuation">,</span>
						<span class="token string">"nonce"</span><span class="token punctuation">:</span> <span class="token string">"394073041834538"</span><span class="token punctuation">,</span>
						<span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"485e630438b9a38c94c12afd9b15007845484d7f0c8c2c29c135f4f9a155a1ee"</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
				<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token comment">//操作返回结果</span>
					<span class="token number">0</span><span class="token punctuation">,</span> 
					<span class="token punctuation">{</span>

					<span class="token punctuation">}</span>
				<span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string">"block_num"</span><span class="token punctuation">:</span> <span class="token number">3674099</span><span class="token punctuation">,</span><span class="token comment">//入块高度</span>
				<span class="token string">"trx_in_block"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//操作所属交易在区块内的位置</span>
				<span class="token string">"op_in_trx"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//操作在交易内的位置</span>
				<span class="token string">"virtual_op"</span><span class="token punctuation">:</span> <span class="token number">52924</span><span class="token comment">//虚拟操作编号</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p><code>get_relative_account_history</code>会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等；</p> 
  <p>充提业务只需关注<code>op.op.N</code>（操作类型）为<code>0</code>,即转账的操作；</p> 
  <p>当然最重要的是<code>memo</code>（转账MEMO）和<code>op.op.amount.amount</code>（转账数额）以及<code>op.op.amount.asset_id</code>（资产类型）；</p> 
  <p>以及<code>op.op.from</code>（转出id），若同一个账号即负责充值又负责提现，则判断<code>op.op.from</code>是否和<code>get_account_id</code>获得的当前账户一样来区分该笔操作是否是本帐户发起的提现操作；</p> 
  <p><code>op.id</code>为该操作的对象id，也是该转账操作的唯一id；</p> 
  <p>另外，还需要关注<code>op.block_num</code>，即该操作的入块高度，<br> <code>op.trx_in_block</code> 该操作所属交易在该区块内的位置，<br> <code>op.op_in_trx</code> 该操作在该交易内的位置，<br> 以及<code>op.virtual_op</code> 该操作的虚拟操作编号。</p> 
  <p>以上四个数据可以和其他指令配合获得该操作所属的txid及判断该操作的唯一性。</p> 
  <h3><a id="get_block_416"></a>get_block</h3> 
  <p>格式：<code>get_block</code> num</p> 
  <p>参数：块号</p> 
  <p>作用：显示第num个块的概况</p> 
  <p>示例：<code>get_block</code> 2090482</p> 
  <p>返回信息示例：</p> 
  <pre><code class="prism language-json">get_block <span class="token number">2090482</span>
<span class="token punctuation">{</span>
  <span class="token string">"previous"</span><span class="token punctuation">:</span> <span class="token string">"001fe5f1e1dd8d195af805484ee8038a09866b76"</span><span class="token punctuation">,</span><span class="token comment">//上一个块的块号</span>
  <span class="token string">"timestamp"</span><span class="token punctuation">:</span> <span class="token string">"2018-07-30T07:31:54"</span><span class="token punctuation">,</span><span class="token comment">//时间戳</span>
  <span class="token string">"witness"</span><span class="token punctuation">:</span> <span class="token string">"1.5.22"</span><span class="token punctuation">,</span><span class="token comment">//见证人</span>
  <span class="token string">"transaction_merkle_root"</span><span class="token punctuation">:</span> <span class="token string">"72756b0f1f1711622c8030eae65e6db055200320"</span><span class="token punctuation">,</span>
  <span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"witness_signature"</span><span class="token punctuation">:</span> <span class="token string">"200d202d735de10f4f8213d71a8f946a2cc49bc02e930f682bea74321819b4bc7c4d436e366f1cad962f214eeaa42b5030fd716f692077f135b3cf33c688f68f1f"</span><span class="token punctuation">,</span><span class="token comment">//见证人签名</span>
  <span class="token string">"transactions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"ref_block_num"</span><span class="token punctuation">:</span> <span class="token number">58864</span><span class="token punctuation">,</span><span class="token comment">//引用的区块号</span>
      <span class="token string">"ref_block_prefix"</span><span class="token punctuation">:</span> <span class="token number">2207768636</span><span class="token punctuation">,</span><span class="token comment">//引用的区块头</span>
      <span class="token string">"expiration"</span><span class="token punctuation">:</span> <span class="token string">"2018-07-30T07:33:51"</span><span class="token punctuation">,</span><span class="token comment">//交易过期时间</span>
      <span class="token string">"operations"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
          <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token string">"fee"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">200000</span><span class="token punctuation">,</span><span class="token comment">//手续费 </span>
              <span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产类型 1.3.0指SEER</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"1.2.1250"</span><span class="token punctuation">,</span><span class="token comment">//发起用户ID</span>
            <span class="token string">"to"</span><span class="token punctuation">:</span> <span class="token string">"1.2.1292"</span><span class="token punctuation">,</span><span class="token comment">//接收用户ID</span>
            <span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">2000000000</span><span class="token punctuation">,</span><span class="token comment">//金额20000</span>
              <span class="token string">"asset_id"</span><span class="token punctuation">:</span> <span class="token string">"1.3.0"</span><span class="token comment">//资产类型 1.3.0指SEER</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"signatures"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"205c1f92cd9eebba507094c0fe4a05be47d301b6b2e989f4f0fdcfc8acef69ceec5356faf1667b5576629bfbc29ee5a257dbfac935c5a8fef588e32d7a7902c2b3"</span><span class="token comment">//交易签名集合</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"operation_results"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
          <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"block_id"</span><span class="token punctuation">:</span> <span class="token string">"001fe5f26d0f3ee5b1569a1618fe903e4dc5aef0"</span><span class="token punctuation">,</span><span class="token comment">//块号</span>
  <span class="token string">"signing_key"</span><span class="token punctuation">:</span> <span class="token string">"SEER5oyAoCzw5GRD9unKK6vsLXkPVx1aKU7i3hX19E8BRU5u3FoAoA"</span><span class="token punctuation">,</span><span class="token comment">//见证人签名公钥</span>
  <span class="token string">"transaction_ids"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"30e73f68d163398005557a21c58bd751db22eb53"</span><span class="token comment">//交易id集</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>充提业务需需配合<code>get_relative_account_history</code>中获取的<code>op.block_num</code>来关注<code>get_block</code>获取的<code>transaction_ids</code>数据，若同一个块里有多笔交易，则会有多个<code>transaction_id</code>，需配合<code>get_relative_account_history</code>中获取到的<code>op.trx_in_block</code>来得到该操作所对应的txid。</p> 
  <h2><a id="_475"></a>处理充值业务</h2> 
  <p>1、通过<code>get_relative_account_history</code>查询账户相关历史。</p> 
  <p>返回结果中并没有直接显示每条记录的序号，需要自行获取和记录。</p> 
  <p>建议：从start = 1，limit = 1， end = 2开始以一定时间间隔发送请求，每次start 和 end 各自 +1，limit恒等于1，若返回信息不为空，则将该条信息编号并存储。若返回信息为空：<code>{"id":1,"jsonrpc":"2.0","result":[]}</code>，则表示没有新的操作，等待有新的操作信息时继续记录存储。</p> 
  <p>2、判断是否为充值业务。</p> 
  <p><code>get_relative_account_history</code>会列出和此账户有关的所有操作，例如自己转账给别人（包括提现）、别人转账给自己（包括充值）、账号注册、参与预测等，充提业务只需要<code>op.op.N</code>（操作类型）为<code>0</code>（转账）的操作数据；</p> 
  <p>若同一个账号即负责充值又负责提现，则需要区分<code>op.op.from</code>是否和当前账户id一样，，若一样，则是本帐户发起的提现操作，需要排除掉；</p> 
  <p>剩下的便是待处理的充值操作。</p> 
  <p>3、获得相关充值数据。</p> 
  <p>通过Http-RPC或websocket-RPC连接的命令行钱包在unlocked状态时，在<code>get_relative_account_history</code>返回的信息中可以查看<code>memo</code>内容，用户填写的交易所ID等入账信息便从此处获取；</p> 
  <p>通过<code>op.op.amount.amount</code>（转账数额）加上小数点，便是充值数额；</p> 
  <p>通过<code>op.op.amount.asset_id</code>（资产类型）来判断是否是平台支持的正确资产类型。</p> 
  <p>4、判断是否为可信操作。</p> 
  <p>不同于比特币和以太坊采用确认数来从概率上降低交易被退回的可能性，像SEER这样的石墨烯项目中有<code>不可逆块</code>的概念，<code>不可逆块</code>及更早区块中的交易，可以保证不会发生回退。</p> 
  <p><code>get_relative_account_history</code>会返回该笔操作所属的<code>op.block_num</code>(入块高度)，但即使交易未入块，仍然可能出现在账户历史中，因此需要和通过<code>get_dynamic_global_properties</code>获取到的<code>last_irreversible_block_num</code>（最近一个不可逆块块号）比较，<code>op.block_num</code>必须小于或等于<code>last_irreversible_block_num</code>，才能被视为可信操作。</p> 
  <p>5、记录下该操作的相关信息。</p> 
  <p><code>get_relative_account_history</code>中获取到的<code>op.block_num</code>+<code>op.trx_in_block</code> + <code>op.op_in_trx</code> + <code>op.virtual_op</code> 组合到一起，标识该操作的唯一性，可识别避免重复操作；</p> 
  <p><code>get_relative_account_history</code>中获取到的<code>op.id</code>也是该转账操作的唯一id；</p> 
  <p>可以通过<code>get_object</code> <code>op.block_num</code> 获取该转账操作所在块的信息，再通过<code>op.trx_in_block</code>的数值来获取到块信息中<code>transaction_ids</code>数组里该转账操作对应的txid，同一个txid可能对应多个操作。</p> 
  <p>6、如果有充值的MEMO或资产类型不正确，建议不要直接退回，而是等待用户主动联系确认退回路径，因为用户可能是通过交易所或第三方平台提现过来充值的，直接退回但没有对方MEMO可能会造成处理困难甚至资产损失。</p> 
  <h2><a id="_515"></a>处理提现业务</h2> 
  <p>1、提现操作前检查区块链网络是否正常运行</p> 
  <p>提现业务需关注区块链网络是否正常运行状态，只在网络正常时处理提现。</p> 
  <p>通过<code>info</code>指令获取到<code>head_block_age</code>（上一个区块生成时间），须在1分钟以内，<code>participation</code>（区块生产参与率）须在80以上，表示80%的区块生产者在正常工作。</p> 
  <p>同时<code>get_dynamic_global_properties</code>指令获取到的 <code>head_block_number</code>（当前区块高度）和 <code>last_irreversible_block_num</code>（最近一个不可逆块）相差不会太大，一般在30以内。</p> 
  <p>2、检查提现账户余额</p> 
  <p>通过<code>list_account_balances</code>列出账户各资产余额，检查<code>asset_id</code>为1.3.0(即SEER)的<code>amount</code> (余额)是否足够并支付网络手续费，若涉及SEER链上其他资产的充提业务，则还需要关注相应资产的余额是否足够。</p> 
  <p>3、转账并跟踪操作是否成功</p> 
  <p>通过<code>transfer2</code>向用户转账相应数额的指定资产。</p> 
  <p>需关注返回信息中的<code>交易id</code>，向用户提供此信息可以让用户在区块浏览器查询自己的提现操作在区块链上的状态和信息，在转出目标未到账的情况下确定该笔操作是否已出账；</p> 
  <p>关注<code>transfer2</code>返回信息中的<code>expiration</code>（交易过期时间），转账操作发出后，一般很快可以从<code>get_relative_account_history</code>中获取到该笔转账操作的信息，并通过<code>op.block_num</code>和<code>last_irreversible_block_num</code>比较来确认入块；</p> 
  <p>（1）若确认入块，则返回信息中的<code>交易id</code>应该已经存在于<code>get_object</code> <code>op.block_num</code> 获取该转账操作所在块信息的<code>transaction_ids</code>数组中。</p> 
  <p>（2）若发出的转账操作超过了<code>expiration</code>还未确认入块，则这笔交易可能由于您同时广播的操作太多等各种原因未被区块链打包并已经被丢弃，此时重新发起转账是安全的。</p> 
  <p>本文由seer爱好者提供，可能理解有误，欢迎到github指出：<a href="https://github.com/akirasen/seerdocs/tree/master/zh-Hans" rel="nofollow">https://github.com/akirasen/seerdocs/tree/master/zh-Hans</a></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/seerxiaozhushou/article/details/83050767,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/seerxiaozhushou/article/details/83050767,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

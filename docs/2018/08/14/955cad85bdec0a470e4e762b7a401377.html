<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>手工搭建fabric 1.1.0 网络 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="手工搭建fabric 1.1.0 网络" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="生成证书文件 crypto-config.yaml 内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # # --------------------------------------------------------------------------- # &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes # --------------------------------------------------------------------------- OrdererOrgs: # --------------------------------------------------------------------------- # Orderer # --------------------------------------------------------------------------- - Name: Orderer Domain: example.com # --------------------------------------------------------------------------- # &quot;Specs&quot; - See PeerOrgs below for complete description # --------------------------------------------------------------------------- Specs: - Hostname: orderer # --------------------------------------------------------------------------- # &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes # --------------------------------------------------------------------------- PeerOrgs: # --------------------------------------------------------------------------- # Org1 # --------------------------------------------------------------------------- - Name: Org1 Domain: org1.example.com EnableNodeOUs: true # --------------------------------------------------------------------------- # &quot;Specs&quot; # --------------------------------------------------------------------------- # Uncomment this section to enable the explicit definition of hosts in your # configuration. Most users will want to use Template, below # # Specs is an array of Spec entries. Each Spec entry consists of two fields: # - Hostname: (Required) The desired hostname, sans the domain. # - CommonName: (Optional) Specifies the template or explicit override for # the CN. By default, this is the template: # # &quot;{{.Hostname}}.{{.Domain}}&quot; # # which obtains its values from the Spec.Hostname and # Org.Domain, respectively. # --------------------------------------------------------------------------- # Specs: # - Hostname: foo # implicitly &quot;foo.org1.example.com&quot; # CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above # - Hostname: bar # - Hostname: baz # --------------------------------------------------------------------------- # &quot;Template&quot; # --------------------------------------------------------------------------- # Allows for the definition of 1 or more hosts that are created sequentially # from a template. By default, this looks like &quot;peer%d&quot; from 0 to Count-1. # You may override the number of nodes (Count), the starting index (Start) # or the template used to construct the name (Hostname). # # Note: Template and Specs are not mutually exclusive. You may define both # sections and the aggregate nodes will be created for you. Take care with # name collisions # --------------------------------------------------------------------------- Template: Count: 2 # Start: 5 # Hostname: {{.Prefix}}{{.Index}} # default # --------------------------------------------------------------------------- # &quot;Users&quot; # --------------------------------------------------------------------------- # Count: The number of user accounts _in addition_ to Admin # --------------------------------------------------------------------------- Users: Count: 1 # --------------------------------------------------------------------------- # Org2: See &quot;Org1&quot; for full specification # --------------------------------------------------------------------------- - Name: Org2 Domain: org2.example.com EnableNodeOUs: true Template: Count: 2 Users: Count: 1 cryptogen generate --config=./crypto-config.yaml 生成创世区块 configtx.yaml 文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # --- ################################################################################ # # Profile # # - Different configuration profiles may be encoded here to be specified # as parameters to the configtxgen tool # ################################################################################ Profiles: TwoOrgsOrdererGenesis: Capabilities: &lt;&lt;: *ChannelCapabilities Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Capabilities: &lt;&lt;: *OrdererCapabilities Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 TwoOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 Capabilities: &lt;&lt;: *ApplicationCapabilities ################################################################################ # # Section: Organizations # # - This section defines the different organizational identities which will # be referenced later in the configuration. # ################################################################################ Organizations: # SampleOrg defines an MSP using the sampleconfig. It should never be used # in production but may be used as a template for other definitions - &amp;OrdererOrg # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: OrdererOrg # ID to load the MSP definition as ID: OrdererMSP # MSPDir is the filesystem path which contains the MSP configuration MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org1MSP # ID to load the MSP definition as ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org2MSP # ID to load the MSP definition as ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org2.example.com Port: 7051 ################################################################################ # # SECTION: Orderer # # - This section defines the values to encode into a config transaction or # genesis block for orderer related parameters # ################################################################################ Orderer: &amp;OrdererDefaults # Orderer Type: The orderer implementation to start # Available types are &quot;solo&quot; and &quot;kafka&quot; OrdererType: solo Addresses: - orderer.example.com:7050 # Batch Timeout: The amount of time to wait before creating a batch BatchTimeout: 2s # Batch Size: Controls the number of messages batched into a block BatchSize: # Max Message Count: The maximum number of messages to permit in a batch MaxMessageCount: 10 # Absolute Max Bytes: The absolute maximum number of bytes allowed for # the serialized messages in a batch. AbsoluteMaxBytes: 99 MB # Preferred Max Bytes: The preferred maximum number of bytes allowed for # the serialized messages in a batch. A message larger than the preferred # max bytes will result in a batch larger than preferred max bytes. PreferredMaxBytes: 512 KB Kafka: # Brokers: A list of Kafka brokers to which the orderer connects # NOTE: Use IP:port notation Brokers: - 127.0.0.1:9092 # Organizations is the list of orgs which are defined as participants on # the orderer side of the network Organizations: ################################################################################ # # SECTION: Application # # - This section defines the values to encode into a config transaction or # genesis block for application related parameters # ################################################################################ Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: ################################################################################ # # SECTION: Capabilities # # - This section defines the capabilities of fabric network. This is a new # concept as of v1.1.0 and should not be utilized in mixed networks with # v1.0.x peers and orderers. Capabilities define features which must be # present in a fabric binary for that binary to safely participate in the # fabric network. For instance, if a new MSP type is added, newer binaries # might recognize and validate the signatures from this type, while older # binaries without this support would be unable to validate those # transactions. This could lead to different versions of the fabric binaries # having different world states. Instead, defining a capability for a channel # informs those binaries without this capability that they must cease # processing transactions until they have been upgraded. For v1.0.x if any # capabilities are defined (including a map with all capabilities turned off) # then the v1.0.x peer will deliberately crash. # ################################################################################ Capabilities: # Channel capabilities apply to both the orderers and the peers and must be # supported by both. Set the value of the capability to true to require it. Global: &amp;ChannelCapabilities # V1.1 for Global is a catchall flag for behavior which has been # determined to be desired for all orderers and peers running v1.0.x, # but the modification of which would cause incompatibilities. Users # should leave this flag set to true. V1_1: true # Orderer capabilities apply only to the orderers, and may be safely # manipulated without concern for upgrading peers. Set the value of the # capability to true to require it. Orderer: &amp;OrdererCapabilities # V1.1 for Order is a catchall flag for behavior which has been # determined to be desired for all orderers running v1.0.x, but the # modification of which would cause incompatibilities. Users should # leave this flag set to true. V1_1: true # Application capabilities apply only to the peer network, and may be safely # manipulated without concern for upgrading orderers. Set the value of the # capability to true to require it. Application: &amp;ApplicationCapabilities # V1.1 for Application is a catchall flag for behavior which has been # determined to be desired for all peers running v1.0.x, but the # modification of which would cause incompatibilities. Users should # leave this flag set to true. V1_1: true export FABRIC_CFG_PATH=$PWD mkdir dir channel-artifacts configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block 生成创建频道配置交易 configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel 命令成功执行后，进入channel-artifacts 文件夹，会看到生成的创世区块文件和创建频道交易数据文件 genesis.block mychannel.tx 配置和启动orderer容器 docker-orderer.yaml 文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer:latest environment: - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=steven_default - ORDERER_GENERAL_LOGLEVEL=DEBUG - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_LISTENPORT=7050 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=TRUE - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls networks: default: aliases: - steven ports: - 7050:7050 启动orderer容器 docker-compose -f docker-orderer.yaml up -d 配置和启动 peer0.org1 节点 KEY文件 cd ./crypto-config/peerOrganizations/org1.example.com/ca 这个路径下有一个文件名以 _sk 结尾的文件 FABRIC_CA_SERVER_TLS_KEYFILE command 配置项替换成实际的_sk文件 - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d&#39; 配置文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: couchdb: container_name: couchdb image: hyperledger/fabric-couchdb:latest # Populate the COUCHDB_USER and COUCHDB_PASSWORD to set an admin user and password # for CouchDB. This will prevent CouchDB from operating in an &quot;Admin Party&quot; mode. # environment: # - COUCHDB_USER= # - COUCHDB_PASSWORD= # Comment/Uncomment the port mapping if you want to hide/expose the CouchDB service, # for example map it to utilize Fauxton User Interface in dev environments. ports: - &quot;5984:5984&quot; ca: container_name: ca image: hyperledger/fabric-ca:latest environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca - FABRIC_CA_SERVER_TLS_ENABLED=TRUE - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk ports: - &quot;7054:7054&quot; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d&#39; volumes: - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config peer0.org1.example.com: container_name: peer0.org1.example.com image: hyperledger/fabric-peer:latest environment: - CORE_LEDGER_STATE_STATEDATABASE=CouchDB - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb:5984 - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_NETWORKID=steven - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=steven_default # - CORE_LOGGING_LEVEL=INFO - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true - CORE_PEER_GOSSIP_USELEADERELECTION=true - CORE_PEER_GOSSIP_ORGLEADER=false - CORE_PEER_PROFILE_ENABLED=false - CORE_PEER_TLS_ENABLED=TRUE - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt volumes: - /var/run/:/host/var/run/ - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 7051:7051 - 7052:7052 - 7053:7053 depends_on: - couchdb networks: default: aliases: - steven cli: container_name: cli image: hyperledger/fabric-tools:latest tty: true stdin_open: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG # - CORE_LOGGING_LEVEL=INFO - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=TRUE - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: /bin/bash volumes: - /var/run/:/host/var/run/ - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: # - orderer.example.com - peer0.org1.example.com # - peer1.org1.example.com # - peer0.org2.example.com # - peer1.org2.example.com networks: default: aliases: - steven 启动peer0.org1 节点容器 docker-compose -f docker-peer.yaml up -d 创建channel 登入cli容器 docker exec -it cli bash 创建频道 peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 日志中可以看到 [channelCmd] readBlock -&gt; INFO 020 Received block: 0 0号区块，即频道里的创世区块，已经被正常创建了。 在当前路径下执行ls，可以看到生成了 mychannel.block 文件，这个文件保存了创世区块的内容，说明创建频道成功。 将peer0.org1 加入频道 环境变量 CORE_PEER_ADDRESS 定义了要操作的目标节点 查看这个环境变量的值， echo $CORE_PEER_ADDRESS peer0.org1.example.com:7051 可以看到目前要操作的目标节点是peer0.org1 加入频道 peer channel join -b mychannel.block 查看频道信息 root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list 2018-08-14 03:52:28.753 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 03:52:28.753 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 03:52:28.754 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized 2018-08-14 03:52:28.755 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: plaintext: 0AB4070A5C08031A0C08FCA3C9DB0510...631A0D0A0B4765744368616E6E656C73 2018-08-14 03:52:28.755 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: digest: 99844B080D2E7B509EDD67B6DC7F5898AF1562D4AAC3A3593010844922AA0304 Channels peers has joined: mychannel 2018-08-14 03:52:28.757 UTC [main] main -&gt; INFO 006 Exiting..... 可以看到 节点已经成功加入了mychannel频道 root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel getinfo -c mychannel 2018-08-14 03:54:32.992 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 03:54:32.992 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 03:54:32.993 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized 2018-08-14 03:54:32.993 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: plaintext: 0AB4070A5C08031A0C08F8A4C9DB0510...6E496E666F0A096D796368616E6E656C 2018-08-14 03:54:32.993 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: digest: D19350DDC8B2042CB89C5F8A1EE06B7A196916B29BB44B82E51CEA3703448F25 Blockchain info: {&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;VbnvfMzMoQ3Bvbdf6BZcvtEj41W2657lQTptDsGTii0=&quot;} 2018-08-14 03:54:32.995 UTC [main] main -&gt; INFO 006 Exiting..... root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# 在这个频道里区块链的高度为1，也就是说目前只有1个区块，也就是0号创世区块 chaincode 编译chaincode cd chaincode/go/chaincode_example02/go go get -u --tags nopkcs11 github.com/hyperledger/fabric/core/chaincode/shim go build --tags nopkcs11 -o chaincode_example02 编译完成后，在当前目录会生成名为 chaincode_example02 的可执行文件 安装chaincode到peer节点 在peer节点的docker-peer.yaml 文件中 volumes: - /var/run/:/host/var/run/ - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go peer chaincode install -n mycc -p github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go -v 1.0 -p 参数定义chaincode所在路径 因为 chaincode所在的完整路径为 /opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go 因为定义了环境变量 GOPATH=/opt/gopath 所以 -p 参数只需要提供 github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go peer channel install 命令会自动到 $GOPATH/src/ github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go 找chaincode 实例化chaincode peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;10&quot;,&quot;B&quot;,&quot;10&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.member&#39;)&quot; -v 1.0 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 调用chaincode query peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;A&quot;]}&#39; 2018-08-14 06:24:31.987 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:24:31.987 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:24:31.987 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:24:31.987 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:24:31.987 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:24:31.987 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC4070A6C08031A0C089FEBC9DB0510...6E6E656C1A0A0A0571756572790A0141 2018-08-14 06:24:31.987 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: D3D6DBE27AF65A95CD956D28F79DD1E3BD9E2B18E2DD13B5CE8217F72A86FF12 Query Result: 10 2018-08-14 06:24:31.999 UTC [main] main -&gt; INFO 008 Exiting..... peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;B&quot;]}&#39; 2018-08-14 06:24:57.225 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:24:57.225 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:24:57.225 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:24:57.225 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:24:57.225 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:24:57.225 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC3070A6B08031A0B08B9EBC9DB0510...6E6E656C1A0A0A0571756572790A0142 2018-08-14 06:24:57.225 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 6A27E793D0F7E6CD473137EC984FB9D5803F66F80B64D2FF47034F705A7DE699 Query Result: 10 2018-08-14 06:24:57.242 UTC [main] main -&gt; INFO 008 Exiting..... 分别查询A 和 B的值，目前都是 10， invoke peer chaincode invoke -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;, &quot;A&quot;, &quot;B&quot;, &quot;3&quot;]}&#39; --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 再次query A和B root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;A&quot;]}&#39; 2018-08-14 06:28:10.210 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:28:10.210 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:28:10.210 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:28:10.210 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:28:10.211 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:28:10.211 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC3070A6B08031A0B08FAECC9DB0510...6E6E656C1A0A0A0571756572790A0141 2018-08-14 06:28:10.211 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 946CB5FE517D93FEC27065BB3534B69E5FD73AA5E8C08E2A56FC6C071F549DD3 Query Result: 7 2018-08-14 06:28:10.222 UTC [main] main -&gt; INFO 008 Exiting..... root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;B&quot;]}&#39; 2018-08-14 06:28:14.821 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:28:14.821 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:28:14.821 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:28:14.821 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:28:14.821 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:28:14.822 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC4070A6C08031A0C08FEECC9DB0510...6E6E656C1A0A0A0571756572790A0142 2018-08-14 06:28:14.822 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 81FC2A154BAE944DFB58FC8B2E7BA3E9A10820BCA74EBB93658030027A34904A Query Result: 13 2018-08-14 06:28:14.830 UTC [main] main -&gt; INFO 008 Exiting..... A减去了3变成了7 B加上了3变成了13 阅读更多" />
<meta property="og:description" content="生成证书文件 crypto-config.yaml 内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # # --------------------------------------------------------------------------- # &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes # --------------------------------------------------------------------------- OrdererOrgs: # --------------------------------------------------------------------------- # Orderer # --------------------------------------------------------------------------- - Name: Orderer Domain: example.com # --------------------------------------------------------------------------- # &quot;Specs&quot; - See PeerOrgs below for complete description # --------------------------------------------------------------------------- Specs: - Hostname: orderer # --------------------------------------------------------------------------- # &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes # --------------------------------------------------------------------------- PeerOrgs: # --------------------------------------------------------------------------- # Org1 # --------------------------------------------------------------------------- - Name: Org1 Domain: org1.example.com EnableNodeOUs: true # --------------------------------------------------------------------------- # &quot;Specs&quot; # --------------------------------------------------------------------------- # Uncomment this section to enable the explicit definition of hosts in your # configuration. Most users will want to use Template, below # # Specs is an array of Spec entries. Each Spec entry consists of two fields: # - Hostname: (Required) The desired hostname, sans the domain. # - CommonName: (Optional) Specifies the template or explicit override for # the CN. By default, this is the template: # # &quot;{{.Hostname}}.{{.Domain}}&quot; # # which obtains its values from the Spec.Hostname and # Org.Domain, respectively. # --------------------------------------------------------------------------- # Specs: # - Hostname: foo # implicitly &quot;foo.org1.example.com&quot; # CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above # - Hostname: bar # - Hostname: baz # --------------------------------------------------------------------------- # &quot;Template&quot; # --------------------------------------------------------------------------- # Allows for the definition of 1 or more hosts that are created sequentially # from a template. By default, this looks like &quot;peer%d&quot; from 0 to Count-1. # You may override the number of nodes (Count), the starting index (Start) # or the template used to construct the name (Hostname). # # Note: Template and Specs are not mutually exclusive. You may define both # sections and the aggregate nodes will be created for you. Take care with # name collisions # --------------------------------------------------------------------------- Template: Count: 2 # Start: 5 # Hostname: {{.Prefix}}{{.Index}} # default # --------------------------------------------------------------------------- # &quot;Users&quot; # --------------------------------------------------------------------------- # Count: The number of user accounts _in addition_ to Admin # --------------------------------------------------------------------------- Users: Count: 1 # --------------------------------------------------------------------------- # Org2: See &quot;Org1&quot; for full specification # --------------------------------------------------------------------------- - Name: Org2 Domain: org2.example.com EnableNodeOUs: true Template: Count: 2 Users: Count: 1 cryptogen generate --config=./crypto-config.yaml 生成创世区块 configtx.yaml 文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # --- ################################################################################ # # Profile # # - Different configuration profiles may be encoded here to be specified # as parameters to the configtxgen tool # ################################################################################ Profiles: TwoOrgsOrdererGenesis: Capabilities: &lt;&lt;: *ChannelCapabilities Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Capabilities: &lt;&lt;: *OrdererCapabilities Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 TwoOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 Capabilities: &lt;&lt;: *ApplicationCapabilities ################################################################################ # # Section: Organizations # # - This section defines the different organizational identities which will # be referenced later in the configuration. # ################################################################################ Organizations: # SampleOrg defines an MSP using the sampleconfig. It should never be used # in production but may be used as a template for other definitions - &amp;OrdererOrg # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: OrdererOrg # ID to load the MSP definition as ID: OrdererMSP # MSPDir is the filesystem path which contains the MSP configuration MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org1MSP # ID to load the MSP definition as ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org2MSP # ID to load the MSP definition as ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org2.example.com Port: 7051 ################################################################################ # # SECTION: Orderer # # - This section defines the values to encode into a config transaction or # genesis block for orderer related parameters # ################################################################################ Orderer: &amp;OrdererDefaults # Orderer Type: The orderer implementation to start # Available types are &quot;solo&quot; and &quot;kafka&quot; OrdererType: solo Addresses: - orderer.example.com:7050 # Batch Timeout: The amount of time to wait before creating a batch BatchTimeout: 2s # Batch Size: Controls the number of messages batched into a block BatchSize: # Max Message Count: The maximum number of messages to permit in a batch MaxMessageCount: 10 # Absolute Max Bytes: The absolute maximum number of bytes allowed for # the serialized messages in a batch. AbsoluteMaxBytes: 99 MB # Preferred Max Bytes: The preferred maximum number of bytes allowed for # the serialized messages in a batch. A message larger than the preferred # max bytes will result in a batch larger than preferred max bytes. PreferredMaxBytes: 512 KB Kafka: # Brokers: A list of Kafka brokers to which the orderer connects # NOTE: Use IP:port notation Brokers: - 127.0.0.1:9092 # Organizations is the list of orgs which are defined as participants on # the orderer side of the network Organizations: ################################################################################ # # SECTION: Application # # - This section defines the values to encode into a config transaction or # genesis block for application related parameters # ################################################################################ Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: ################################################################################ # # SECTION: Capabilities # # - This section defines the capabilities of fabric network. This is a new # concept as of v1.1.0 and should not be utilized in mixed networks with # v1.0.x peers and orderers. Capabilities define features which must be # present in a fabric binary for that binary to safely participate in the # fabric network. For instance, if a new MSP type is added, newer binaries # might recognize and validate the signatures from this type, while older # binaries without this support would be unable to validate those # transactions. This could lead to different versions of the fabric binaries # having different world states. Instead, defining a capability for a channel # informs those binaries without this capability that they must cease # processing transactions until they have been upgraded. For v1.0.x if any # capabilities are defined (including a map with all capabilities turned off) # then the v1.0.x peer will deliberately crash. # ################################################################################ Capabilities: # Channel capabilities apply to both the orderers and the peers and must be # supported by both. Set the value of the capability to true to require it. Global: &amp;ChannelCapabilities # V1.1 for Global is a catchall flag for behavior which has been # determined to be desired for all orderers and peers running v1.0.x, # but the modification of which would cause incompatibilities. Users # should leave this flag set to true. V1_1: true # Orderer capabilities apply only to the orderers, and may be safely # manipulated without concern for upgrading peers. Set the value of the # capability to true to require it. Orderer: &amp;OrdererCapabilities # V1.1 for Order is a catchall flag for behavior which has been # determined to be desired for all orderers running v1.0.x, but the # modification of which would cause incompatibilities. Users should # leave this flag set to true. V1_1: true # Application capabilities apply only to the peer network, and may be safely # manipulated without concern for upgrading orderers. Set the value of the # capability to true to require it. Application: &amp;ApplicationCapabilities # V1.1 for Application is a catchall flag for behavior which has been # determined to be desired for all peers running v1.0.x, but the # modification of which would cause incompatibilities. Users should # leave this flag set to true. V1_1: true export FABRIC_CFG_PATH=$PWD mkdir dir channel-artifacts configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block 生成创建频道配置交易 configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel 命令成功执行后，进入channel-artifacts 文件夹，会看到生成的创世区块文件和创建频道交易数据文件 genesis.block mychannel.tx 配置和启动orderer容器 docker-orderer.yaml 文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer:latest environment: - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=steven_default - ORDERER_GENERAL_LOGLEVEL=DEBUG - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_LISTENPORT=7050 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=TRUE - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls networks: default: aliases: - steven ports: - 7050:7050 启动orderer容器 docker-compose -f docker-orderer.yaml up -d 配置和启动 peer0.org1 节点 KEY文件 cd ./crypto-config/peerOrganizations/org1.example.com/ca 这个路径下有一个文件名以 _sk 结尾的文件 FABRIC_CA_SERVER_TLS_KEYFILE command 配置项替换成实际的_sk文件 - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d&#39; 配置文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: couchdb: container_name: couchdb image: hyperledger/fabric-couchdb:latest # Populate the COUCHDB_USER and COUCHDB_PASSWORD to set an admin user and password # for CouchDB. This will prevent CouchDB from operating in an &quot;Admin Party&quot; mode. # environment: # - COUCHDB_USER= # - COUCHDB_PASSWORD= # Comment/Uncomment the port mapping if you want to hide/expose the CouchDB service, # for example map it to utilize Fauxton User Interface in dev environments. ports: - &quot;5984:5984&quot; ca: container_name: ca image: hyperledger/fabric-ca:latest environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca - FABRIC_CA_SERVER_TLS_ENABLED=TRUE - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk ports: - &quot;7054:7054&quot; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d&#39; volumes: - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config peer0.org1.example.com: container_name: peer0.org1.example.com image: hyperledger/fabric-peer:latest environment: - CORE_LEDGER_STATE_STATEDATABASE=CouchDB - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb:5984 - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_NETWORKID=steven - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=steven_default # - CORE_LOGGING_LEVEL=INFO - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true - CORE_PEER_GOSSIP_USELEADERELECTION=true - CORE_PEER_GOSSIP_ORGLEADER=false - CORE_PEER_PROFILE_ENABLED=false - CORE_PEER_TLS_ENABLED=TRUE - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt volumes: - /var/run/:/host/var/run/ - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 7051:7051 - 7052:7052 - 7053:7053 depends_on: - couchdb networks: default: aliases: - steven cli: container_name: cli image: hyperledger/fabric-tools:latest tty: true stdin_open: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG # - CORE_LOGGING_LEVEL=INFO - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=TRUE - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: /bin/bash volumes: - /var/run/:/host/var/run/ - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: # - orderer.example.com - peer0.org1.example.com # - peer1.org1.example.com # - peer0.org2.example.com # - peer1.org2.example.com networks: default: aliases: - steven 启动peer0.org1 节点容器 docker-compose -f docker-peer.yaml up -d 创建channel 登入cli容器 docker exec -it cli bash 创建频道 peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 日志中可以看到 [channelCmd] readBlock -&gt; INFO 020 Received block: 0 0号区块，即频道里的创世区块，已经被正常创建了。 在当前路径下执行ls，可以看到生成了 mychannel.block 文件，这个文件保存了创世区块的内容，说明创建频道成功。 将peer0.org1 加入频道 环境变量 CORE_PEER_ADDRESS 定义了要操作的目标节点 查看这个环境变量的值， echo $CORE_PEER_ADDRESS peer0.org1.example.com:7051 可以看到目前要操作的目标节点是peer0.org1 加入频道 peer channel join -b mychannel.block 查看频道信息 root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list 2018-08-14 03:52:28.753 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 03:52:28.753 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 03:52:28.754 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized 2018-08-14 03:52:28.755 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: plaintext: 0AB4070A5C08031A0C08FCA3C9DB0510...631A0D0A0B4765744368616E6E656C73 2018-08-14 03:52:28.755 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: digest: 99844B080D2E7B509EDD67B6DC7F5898AF1562D4AAC3A3593010844922AA0304 Channels peers has joined: mychannel 2018-08-14 03:52:28.757 UTC [main] main -&gt; INFO 006 Exiting..... 可以看到 节点已经成功加入了mychannel频道 root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel getinfo -c mychannel 2018-08-14 03:54:32.992 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 03:54:32.992 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 03:54:32.993 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized 2018-08-14 03:54:32.993 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: plaintext: 0AB4070A5C08031A0C08F8A4C9DB0510...6E496E666F0A096D796368616E6E656C 2018-08-14 03:54:32.993 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: digest: D19350DDC8B2042CB89C5F8A1EE06B7A196916B29BB44B82E51CEA3703448F25 Blockchain info: {&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;VbnvfMzMoQ3Bvbdf6BZcvtEj41W2657lQTptDsGTii0=&quot;} 2018-08-14 03:54:32.995 UTC [main] main -&gt; INFO 006 Exiting..... root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# 在这个频道里区块链的高度为1，也就是说目前只有1个区块，也就是0号创世区块 chaincode 编译chaincode cd chaincode/go/chaincode_example02/go go get -u --tags nopkcs11 github.com/hyperledger/fabric/core/chaincode/shim go build --tags nopkcs11 -o chaincode_example02 编译完成后，在当前目录会生成名为 chaincode_example02 的可执行文件 安装chaincode到peer节点 在peer节点的docker-peer.yaml 文件中 volumes: - /var/run/:/host/var/run/ - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go peer chaincode install -n mycc -p github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go -v 1.0 -p 参数定义chaincode所在路径 因为 chaincode所在的完整路径为 /opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go 因为定义了环境变量 GOPATH=/opt/gopath 所以 -p 参数只需要提供 github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go peer channel install 命令会自动到 $GOPATH/src/ github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go 找chaincode 实例化chaincode peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;10&quot;,&quot;B&quot;,&quot;10&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.member&#39;)&quot; -v 1.0 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 调用chaincode query peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;A&quot;]}&#39; 2018-08-14 06:24:31.987 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:24:31.987 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:24:31.987 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:24:31.987 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:24:31.987 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:24:31.987 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC4070A6C08031A0C089FEBC9DB0510...6E6E656C1A0A0A0571756572790A0141 2018-08-14 06:24:31.987 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: D3D6DBE27AF65A95CD956D28F79DD1E3BD9E2B18E2DD13B5CE8217F72A86FF12 Query Result: 10 2018-08-14 06:24:31.999 UTC [main] main -&gt; INFO 008 Exiting..... peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;B&quot;]}&#39; 2018-08-14 06:24:57.225 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:24:57.225 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:24:57.225 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:24:57.225 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:24:57.225 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:24:57.225 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC3070A6B08031A0B08B9EBC9DB0510...6E6E656C1A0A0A0571756572790A0142 2018-08-14 06:24:57.225 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 6A27E793D0F7E6CD473137EC984FB9D5803F66F80B64D2FF47034F705A7DE699 Query Result: 10 2018-08-14 06:24:57.242 UTC [main] main -&gt; INFO 008 Exiting..... 分别查询A 和 B的值，目前都是 10， invoke peer chaincode invoke -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;, &quot;A&quot;, &quot;B&quot;, &quot;3&quot;]}&#39; --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 再次query A和B root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;A&quot;]}&#39; 2018-08-14 06:28:10.210 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:28:10.210 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:28:10.210 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:28:10.210 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:28:10.211 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:28:10.211 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC3070A6B08031A0B08FAECC9DB0510...6E6E656C1A0A0A0571756572790A0141 2018-08-14 06:28:10.211 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 946CB5FE517D93FEC27065BB3534B69E5FD73AA5E8C08E2A56FC6C071F549DD3 Query Result: 7 2018-08-14 06:28:10.222 UTC [main] main -&gt; INFO 008 Exiting..... root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;B&quot;]}&#39; 2018-08-14 06:28:14.821 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:28:14.821 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:28:14.821 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:28:14.821 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:28:14.821 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:28:14.822 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC4070A6C08031A0C08FEECC9DB0510...6E6E656C1A0A0A0571756572790A0142 2018-08-14 06:28:14.822 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 81FC2A154BAE944DFB58FC8B2E7BA3E9A10820BCA74EBB93658030027A34904A Query Result: 13 2018-08-14 06:28:14.830 UTC [main] main -&gt; INFO 008 Exiting..... A减去了3变成了7 B加上了3变成了13 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/14/955cad85bdec0a470e4e762b7a401377.html" />
<meta property="og:url" content="https://mlh.app/2018/08/14/955cad85bdec0a470e4e762b7a401377.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-14T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"生成证书文件 crypto-config.yaml 内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # # --------------------------------------------------------------------------- # &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes # --------------------------------------------------------------------------- OrdererOrgs: # --------------------------------------------------------------------------- # Orderer # --------------------------------------------------------------------------- - Name: Orderer Domain: example.com # --------------------------------------------------------------------------- # &quot;Specs&quot; - See PeerOrgs below for complete description # --------------------------------------------------------------------------- Specs: - Hostname: orderer # --------------------------------------------------------------------------- # &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes # --------------------------------------------------------------------------- PeerOrgs: # --------------------------------------------------------------------------- # Org1 # --------------------------------------------------------------------------- - Name: Org1 Domain: org1.example.com EnableNodeOUs: true # --------------------------------------------------------------------------- # &quot;Specs&quot; # --------------------------------------------------------------------------- # Uncomment this section to enable the explicit definition of hosts in your # configuration. Most users will want to use Template, below # # Specs is an array of Spec entries. Each Spec entry consists of two fields: # - Hostname: (Required) The desired hostname, sans the domain. # - CommonName: (Optional) Specifies the template or explicit override for # the CN. By default, this is the template: # # &quot;{{.Hostname}}.{{.Domain}}&quot; # # which obtains its values from the Spec.Hostname and # Org.Domain, respectively. # --------------------------------------------------------------------------- # Specs: # - Hostname: foo # implicitly &quot;foo.org1.example.com&quot; # CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above # - Hostname: bar # - Hostname: baz # --------------------------------------------------------------------------- # &quot;Template&quot; # --------------------------------------------------------------------------- # Allows for the definition of 1 or more hosts that are created sequentially # from a template. By default, this looks like &quot;peer%d&quot; from 0 to Count-1. # You may override the number of nodes (Count), the starting index (Start) # or the template used to construct the name (Hostname). # # Note: Template and Specs are not mutually exclusive. You may define both # sections and the aggregate nodes will be created for you. Take care with # name collisions # --------------------------------------------------------------------------- Template: Count: 2 # Start: 5 # Hostname: {{.Prefix}}{{.Index}} # default # --------------------------------------------------------------------------- # &quot;Users&quot; # --------------------------------------------------------------------------- # Count: The number of user accounts _in addition_ to Admin # --------------------------------------------------------------------------- Users: Count: 1 # --------------------------------------------------------------------------- # Org2: See &quot;Org1&quot; for full specification # --------------------------------------------------------------------------- - Name: Org2 Domain: org2.example.com EnableNodeOUs: true Template: Count: 2 Users: Count: 1 cryptogen generate --config=./crypto-config.yaml 生成创世区块 configtx.yaml 文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # --- ################################################################################ # # Profile # # - Different configuration profiles may be encoded here to be specified # as parameters to the configtxgen tool # ################################################################################ Profiles: TwoOrgsOrdererGenesis: Capabilities: &lt;&lt;: *ChannelCapabilities Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Capabilities: &lt;&lt;: *OrdererCapabilities Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 TwoOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 Capabilities: &lt;&lt;: *ApplicationCapabilities ################################################################################ # # Section: Organizations # # - This section defines the different organizational identities which will # be referenced later in the configuration. # ################################################################################ Organizations: # SampleOrg defines an MSP using the sampleconfig. It should never be used # in production but may be used as a template for other definitions - &amp;OrdererOrg # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: OrdererOrg # ID to load the MSP definition as ID: OrdererMSP # MSPDir is the filesystem path which contains the MSP configuration MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org1MSP # ID to load the MSP definition as ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org2MSP # ID to load the MSP definition as ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org2.example.com Port: 7051 ################################################################################ # # SECTION: Orderer # # - This section defines the values to encode into a config transaction or # genesis block for orderer related parameters # ################################################################################ Orderer: &amp;OrdererDefaults # Orderer Type: The orderer implementation to start # Available types are &quot;solo&quot; and &quot;kafka&quot; OrdererType: solo Addresses: - orderer.example.com:7050 # Batch Timeout: The amount of time to wait before creating a batch BatchTimeout: 2s # Batch Size: Controls the number of messages batched into a block BatchSize: # Max Message Count: The maximum number of messages to permit in a batch MaxMessageCount: 10 # Absolute Max Bytes: The absolute maximum number of bytes allowed for # the serialized messages in a batch. AbsoluteMaxBytes: 99 MB # Preferred Max Bytes: The preferred maximum number of bytes allowed for # the serialized messages in a batch. A message larger than the preferred # max bytes will result in a batch larger than preferred max bytes. PreferredMaxBytes: 512 KB Kafka: # Brokers: A list of Kafka brokers to which the orderer connects # NOTE: Use IP:port notation Brokers: - 127.0.0.1:9092 # Organizations is the list of orgs which are defined as participants on # the orderer side of the network Organizations: ################################################################################ # # SECTION: Application # # - This section defines the values to encode into a config transaction or # genesis block for application related parameters # ################################################################################ Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: ################################################################################ # # SECTION: Capabilities # # - This section defines the capabilities of fabric network. This is a new # concept as of v1.1.0 and should not be utilized in mixed networks with # v1.0.x peers and orderers. Capabilities define features which must be # present in a fabric binary for that binary to safely participate in the # fabric network. For instance, if a new MSP type is added, newer binaries # might recognize and validate the signatures from this type, while older # binaries without this support would be unable to validate those # transactions. This could lead to different versions of the fabric binaries # having different world states. Instead, defining a capability for a channel # informs those binaries without this capability that they must cease # processing transactions until they have been upgraded. For v1.0.x if any # capabilities are defined (including a map with all capabilities turned off) # then the v1.0.x peer will deliberately crash. # ################################################################################ Capabilities: # Channel capabilities apply to both the orderers and the peers and must be # supported by both. Set the value of the capability to true to require it. Global: &amp;ChannelCapabilities # V1.1 for Global is a catchall flag for behavior which has been # determined to be desired for all orderers and peers running v1.0.x, # but the modification of which would cause incompatibilities. Users # should leave this flag set to true. V1_1: true # Orderer capabilities apply only to the orderers, and may be safely # manipulated without concern for upgrading peers. Set the value of the # capability to true to require it. Orderer: &amp;OrdererCapabilities # V1.1 for Order is a catchall flag for behavior which has been # determined to be desired for all orderers running v1.0.x, but the # modification of which would cause incompatibilities. Users should # leave this flag set to true. V1_1: true # Application capabilities apply only to the peer network, and may be safely # manipulated without concern for upgrading orderers. Set the value of the # capability to true to require it. Application: &amp;ApplicationCapabilities # V1.1 for Application is a catchall flag for behavior which has been # determined to be desired for all peers running v1.0.x, but the # modification of which would cause incompatibilities. Users should # leave this flag set to true. V1_1: true export FABRIC_CFG_PATH=$PWD mkdir dir channel-artifacts configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block 生成创建频道配置交易 configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel 命令成功执行后，进入channel-artifacts 文件夹，会看到生成的创世区块文件和创建频道交易数据文件 genesis.block mychannel.tx 配置和启动orderer容器 docker-orderer.yaml 文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer:latest environment: - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=steven_default - ORDERER_GENERAL_LOGLEVEL=DEBUG - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_LISTENPORT=7050 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=TRUE - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls networks: default: aliases: - steven ports: - 7050:7050 启动orderer容器 docker-compose -f docker-orderer.yaml up -d 配置和启动 peer0.org1 节点 KEY文件 cd ./crypto-config/peerOrganizations/org1.example.com/ca 这个路径下有一个文件名以 _sk 结尾的文件 FABRIC_CA_SERVER_TLS_KEYFILE command 配置项替换成实际的_sk文件 - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d&#39; 配置文件内容如下 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: couchdb: container_name: couchdb image: hyperledger/fabric-couchdb:latest # Populate the COUCHDB_USER and COUCHDB_PASSWORD to set an admin user and password # for CouchDB. This will prevent CouchDB from operating in an &quot;Admin Party&quot; mode. # environment: # - COUCHDB_USER= # - COUCHDB_PASSWORD= # Comment/Uncomment the port mapping if you want to hide/expose the CouchDB service, # for example map it to utilize Fauxton User Interface in dev environments. ports: - &quot;5984:5984&quot; ca: container_name: ca image: hyperledger/fabric-ca:latest environment: - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server - FABRIC_CA_SERVER_CA_NAME=ca - FABRIC_CA_SERVER_TLS_ENABLED=TRUE - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk ports: - &quot;7054:7054&quot; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d&#39; volumes: - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config peer0.org1.example.com: container_name: peer0.org1.example.com image: hyperledger/fabric-peer:latest environment: - CORE_LEDGER_STATE_STATEDATABASE=CouchDB - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb:5984 - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_NETWORKID=steven - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=steven_default # - CORE_LOGGING_LEVEL=INFO - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true - CORE_PEER_GOSSIP_USELEADERELECTION=true - CORE_PEER_GOSSIP_ORGLEADER=false - CORE_PEER_PROFILE_ENABLED=false - CORE_PEER_TLS_ENABLED=TRUE - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt volumes: - /var/run/:/host/var/run/ - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 7051:7051 - 7052:7052 - 7053:7053 depends_on: - couchdb networks: default: aliases: - steven cli: container_name: cli image: hyperledger/fabric-tools:latest tty: true stdin_open: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG # - CORE_LOGGING_LEVEL=INFO - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=TRUE - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: /bin/bash volumes: - /var/run/:/host/var/run/ - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: # - orderer.example.com - peer0.org1.example.com # - peer1.org1.example.com # - peer0.org2.example.com # - peer1.org2.example.com networks: default: aliases: - steven 启动peer0.org1 节点容器 docker-compose -f docker-peer.yaml up -d 创建channel 登入cli容器 docker exec -it cli bash 创建频道 peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 日志中可以看到 [channelCmd] readBlock -&gt; INFO 020 Received block: 0 0号区块，即频道里的创世区块，已经被正常创建了。 在当前路径下执行ls，可以看到生成了 mychannel.block 文件，这个文件保存了创世区块的内容，说明创建频道成功。 将peer0.org1 加入频道 环境变量 CORE_PEER_ADDRESS 定义了要操作的目标节点 查看这个环境变量的值， echo $CORE_PEER_ADDRESS peer0.org1.example.com:7051 可以看到目前要操作的目标节点是peer0.org1 加入频道 peer channel join -b mychannel.block 查看频道信息 root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list 2018-08-14 03:52:28.753 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 03:52:28.753 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 03:52:28.754 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized 2018-08-14 03:52:28.755 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: plaintext: 0AB4070A5C08031A0C08FCA3C9DB0510...631A0D0A0B4765744368616E6E656C73 2018-08-14 03:52:28.755 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: digest: 99844B080D2E7B509EDD67B6DC7F5898AF1562D4AAC3A3593010844922AA0304 Channels peers has joined: mychannel 2018-08-14 03:52:28.757 UTC [main] main -&gt; INFO 006 Exiting..... 可以看到 节点已经成功加入了mychannel频道 root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel getinfo -c mychannel 2018-08-14 03:54:32.992 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 03:54:32.992 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 03:54:32.993 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized 2018-08-14 03:54:32.993 UTC [msp/identity] Sign -&gt; DEBU 004 Sign: plaintext: 0AB4070A5C08031A0C08F8A4C9DB0510...6E496E666F0A096D796368616E6E656C 2018-08-14 03:54:32.993 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: digest: D19350DDC8B2042CB89C5F8A1EE06B7A196916B29BB44B82E51CEA3703448F25 Blockchain info: {&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;VbnvfMzMoQ3Bvbdf6BZcvtEj41W2657lQTptDsGTii0=&quot;} 2018-08-14 03:54:32.995 UTC [main] main -&gt; INFO 006 Exiting..... root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/peer# 在这个频道里区块链的高度为1，也就是说目前只有1个区块，也就是0号创世区块 chaincode 编译chaincode cd chaincode/go/chaincode_example02/go go get -u --tags nopkcs11 github.com/hyperledger/fabric/core/chaincode/shim go build --tags nopkcs11 -o chaincode_example02 编译完成后，在当前目录会生成名为 chaincode_example02 的可执行文件 安装chaincode到peer节点 在peer节点的docker-peer.yaml 文件中 volumes: - /var/run/:/host/var/run/ - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go peer chaincode install -n mycc -p github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go -v 1.0 -p 参数定义chaincode所在路径 因为 chaincode所在的完整路径为 /opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go 因为定义了环境变量 GOPATH=/opt/gopath 所以 -p 参数只需要提供 github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go peer channel install 命令会自动到 $GOPATH/src/ github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go 找chaincode 实例化chaincode peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;10&quot;,&quot;B&quot;,&quot;10&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.member&#39;)&quot; -v 1.0 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 调用chaincode query peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;A&quot;]}&#39; 2018-08-14 06:24:31.987 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:24:31.987 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:24:31.987 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:24:31.987 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:24:31.987 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:24:31.987 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC4070A6C08031A0C089FEBC9DB0510...6E6E656C1A0A0A0571756572790A0141 2018-08-14 06:24:31.987 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: D3D6DBE27AF65A95CD956D28F79DD1E3BD9E2B18E2DD13B5CE8217F72A86FF12 Query Result: 10 2018-08-14 06:24:31.999 UTC [main] main -&gt; INFO 008 Exiting..... peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;B&quot;]}&#39; 2018-08-14 06:24:57.225 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:24:57.225 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:24:57.225 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:24:57.225 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:24:57.225 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:24:57.225 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC3070A6B08031A0B08B9EBC9DB0510...6E6E656C1A0A0A0571756572790A0142 2018-08-14 06:24:57.225 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 6A27E793D0F7E6CD473137EC984FB9D5803F66F80B64D2FF47034F705A7DE699 Query Result: 10 2018-08-14 06:24:57.242 UTC [main] main -&gt; INFO 008 Exiting..... 分别查询A 和 B的值，目前都是 10， invoke peer chaincode invoke -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;, &quot;A&quot;, &quot;B&quot;, &quot;3&quot;]}&#39; --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 再次query A和B root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;A&quot;]}&#39; 2018-08-14 06:28:10.210 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:28:10.210 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:28:10.210 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:28:10.210 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:28:10.211 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:28:10.211 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC3070A6B08031A0B08FAECC9DB0510...6E6E656C1A0A0A0571756572790A0141 2018-08-14 06:28:10.211 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 946CB5FE517D93FEC27065BB3534B69E5FD73AA5E8C08E2A56FC6C071F549DD3 Query Result: 7 2018-08-14 06:28:10.222 UTC [main] main -&gt; INFO 008 Exiting..... root@7fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -C mychannel -n mycc -c &#39;{&quot;Args&quot;:[&quot;query&quot;, &quot;B&quot;]}&#39; 2018-08-14 06:28:14.821 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2018-08-14 06:28:14.821 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2018-08-14 06:28:14.821 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2018-08-14 06:28:14.821 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2018-08-14 06:28:14.821 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 005 java chaincode disabled 2018-08-14 06:28:14.822 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: plaintext: 0AC4070A6C08031A0C08FEECC9DB0510...6E6E656C1A0A0A0571756572790A0142 2018-08-14 06:28:14.822 UTC [msp/identity] Sign -&gt; DEBU 007 Sign: digest: 81FC2A154BAE944DFB58FC8B2E7BA3E9A10820BCA74EBB93658030027A34904A Query Result: 13 2018-08-14 06:28:14.830 UTC [main] main -&gt; INFO 008 Exiting..... A减去了3变成了7 B加上了3变成了13 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/14/955cad85bdec0a470e4e762b7a401377.html","headline":"手工搭建fabric 1.1.0 网络","dateModified":"2018-08-14T00:00:00+08:00","datePublished":"2018-08-14T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/14/955cad85bdec0a470e4e762b7a401377.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>手工搭建fabric 1.1.0 网络</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h2 id="生成证书文件">生成证书文件</h2> 
  <p>crypto-config.yaml 内容如下</p> 
  <pre class="prettyprint"><code class=" hljs ruleslanguage"><span class="hljs-array"># Copyright IBM Corp. All Rights Reserved.</span>
#
<span class="hljs-array"># SPDX</span>-License-Identifier: Apache-<span class="hljs-number">2.0</span>
#

<span class="hljs-array"># </span>---------------------------------------------------------------------------
<span class="hljs-array"># </span><span class="hljs-string">"OrdererOrgs"</span> - Definition of organizations managing orderer nodes
<span class="hljs-array"># </span>---------------------------------------------------------------------------
OrdererOrgs:
  <span class="hljs-array"># </span>---------------------------------------------------------------------------
  <span class="hljs-array"># Orderer</span>
  <span class="hljs-array"># </span>---------------------------------------------------------------------------
  - Name: Orderer
    Domain: example.com
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># </span><span class="hljs-string">"Specs"</span> - See PeerOrgs below for complete description
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    Specs:
      - Hostname: orderer
<span class="hljs-array"># </span>---------------------------------------------------------------------------
<span class="hljs-array"># </span><span class="hljs-string">"PeerOrgs"</span> - Definition of organizations managing peer nodes
<span class="hljs-array"># </span>---------------------------------------------------------------------------
PeerOrgs:
  <span class="hljs-array"># </span>---------------------------------------------------------------------------
  <span class="hljs-array"># Org</span>1
  <span class="hljs-array"># </span>---------------------------------------------------------------------------
  - Name: Org1
    Domain: org1.example.com
    EnableNodeOUs: true
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># </span><span class="hljs-string">"Specs"</span>
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># Uncomment this section to enable the explicit definition of hosts in your</span>
    <span class="hljs-array"># configuration. Most users will want to use Template</span>, below
    #
    <span class="hljs-array"># Specs is an array of Spec entries. Each Spec entry consists of two fields</span>:
    <span class="hljs-array"># </span>- Hostname:   (Required) The desired hostname, sans the domain.
    <span class="hljs-array"># </span>- CommonName: (Optional) Specifies the template or explicit override for
    <span class="hljs-array"># the CN. By default</span>, this is the template:
    #
    <span class="hljs-array"># </span><span class="hljs-string">"{{.Hostname}}.{{.Domain}}"</span>
    #
    <span class="hljs-array"># which obtains its values from the Spec.Hostname and</span>
    <span class="hljs-array"># Org.Domain</span>, respectively.
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># Specs</span>:
    <span class="hljs-array"># </span>- Hostname: foo <span class="hljs-array"># implicitly </span><span class="hljs-string">"foo.org1.example.com"</span>
    <span class="hljs-array"># CommonName</span>: foo27.org5.example.com <span class="hljs-array"># overrides Hostname</span>-based FQDN set above
    <span class="hljs-array"># </span>- Hostname: bar
    <span class="hljs-array"># </span>- Hostname: baz
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># </span><span class="hljs-string">"Template"</span>
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># Allows for the definition of </span><span class="hljs-number">1</span> or more hosts that are created sequentially
    <span class="hljs-array"># from a template. By default</span>, this looks like <span class="hljs-string">"peer%d"</span> from <span class="hljs-number">0</span> to Count-<span class="hljs-number">1.</span>
    <span class="hljs-array"># You may override the number of nodes </span>(Count), the starting index (Start)
    <span class="hljs-array"># or the template used to construct the name </span>(Hostname).
    #
    <span class="hljs-array"># Note</span>: Template and Specs are not mutually exclusive.  You may define both
    <span class="hljs-array"># sections and the aggregate nodes will be created for you. Take care with</span>
    <span class="hljs-array"># name collisions</span>
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    Template:
      Count: <span class="hljs-number">2</span>
      <span class="hljs-array"># Start</span>: <span class="hljs-number">5</span>
      <span class="hljs-array"># Hostname</span>: {{.Prefix}}{{.Index}} <span class="hljs-array"># default</span>
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># </span><span class="hljs-string">"Users"</span>
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    <span class="hljs-array"># Count</span>: The number of user accounts _in addition_ to Admin
    <span class="hljs-array"># </span>---------------------------------------------------------------------------
    Users:
      Count: <span class="hljs-number">1</span>
  <span class="hljs-array"># </span>---------------------------------------------------------------------------
  <span class="hljs-array"># Org</span>2: See <span class="hljs-string">"Org1"</span> for full specification
  <span class="hljs-array"># </span>---------------------------------------------------------------------------
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: <span class="hljs-number">2</span>
    Users:
      Count: <span class="hljs-number">1</span>
</code></pre> 
  <pre class="prettyprint"><code class=" hljs vhdl">cryptogen <span class="hljs-keyword">generate</span> <span class="hljs-comment">--config=./crypto-config.yaml</span></code></pre> 
  <h2 id="生成创世区块">生成创世区块</h2> 
  <p>configtx.yaml 文件内容如下</p> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span>
<span class="hljs-comment">#</span>

---
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Profile</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - Different configuration profiles may be encoded here to be specified</span>
<span class="hljs-comment"># as parameters to the configtxgen tool</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Profiles</span>:

    <span class="hljs-attribute">TwoOrgsOrdererGenesis</span>:
        <span class="hljs-attribute">Capabilities</span>:
            &lt;&lt;: *ChannelCapabilities
        <span class="hljs-attribute">Orderer</span>:
            &lt;&lt;: *OrdererDefaults
            <span class="hljs-attribute">Organizations</span>:
                - *OrdererOrg
            <span class="hljs-attribute">Capabilities</span>:
                &lt;&lt;: *OrdererCapabilities
        <span class="hljs-attribute">Consortiums</span>:
            <span class="hljs-attribute">SampleConsortium</span>:
                <span class="hljs-attribute">Organizations</span>:
                    - *Org1
                    - *Org2
    <span class="hljs-attribute">TwoOrgsChannel</span>:
        <span class="hljs-attribute">Consortium</span>: SampleConsortium
        <span class="hljs-attribute">Application</span>:
            &lt;&lt;: *ApplicationDefaults
            <span class="hljs-attribute">Organizations</span>:
                - *Org1
                - *Org2
            <span class="hljs-attribute">Capabilities</span>:
                &lt;&lt;: *ApplicationCapabilities

<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Section: Organizations</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the different organizational identities which will</span>
<span class="hljs-comment"># be referenced later in the configuration.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Organizations</span>:

    <span class="hljs-comment"># SampleOrg defines an MSP using the sampleconfig. It should never be used</span>
    <span class="hljs-comment"># in production but may be used as a template for other definitions</span>
    - &amp;OrdererOrg
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: OrdererOrg

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: OrdererMSP

        <span class="hljs-comment"># MSPDir is the filesystem path which contains the MSP configuration</span>
        <span class="hljs-attribute">MSPDir</span>: crypto-config/ordererOrganizations/example.com/msp

    - &amp;Org1
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: Org1MSP

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: Org1MSP

        <span class="hljs-attribute">MSPDir</span>: crypto-config/peerOrganizations/org1.example.com/msp

        <span class="hljs-attribute">AnchorPeers</span>:
            <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used</span>
            <span class="hljs-comment"># for cross org gossip communication. Note, this value is only</span>
            <span class="hljs-comment"># encoded in the genesis block in the Application section context</span>
            - <span class="hljs-attribute">Host</span>: peer0.org1.example.com
              <span class="hljs-attribute">Port</span>: <span class="hljs-number">7051</span>

    - &amp;Org2
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: Org2MSP

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: Org2MSP

        <span class="hljs-attribute">MSPDir</span>: crypto-config/peerOrganizations/org2.example.com/msp

        <span class="hljs-attribute">AnchorPeers</span>:
            <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used</span>
            <span class="hljs-comment"># for cross org gossip communication. Note, this value is only</span>
            <span class="hljs-comment"># encoded in the genesis block in the Application section context</span>
            - <span class="hljs-attribute">Host</span>: peer0.org2.example.com
              <span class="hljs-attribute">Port</span>: <span class="hljs-number">7051</span>

<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SECTION: Orderer</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the values to encode into a config transaction or</span>
<span class="hljs-comment"># genesis block for orderer related parameters</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Orderer</span>: &amp;OrdererDefaults

    <span class="hljs-comment"># Orderer Type: The orderer implementation to start</span>
    <span class="hljs-comment"># Available types are "solo" and "kafka"</span>
    <span class="hljs-attribute">OrdererType</span>: solo

    <span class="hljs-attribute">Addresses</span>:
        - orderer.example.<span class="hljs-attribute">com</span>:<span class="hljs-number">7050</span>

    <span class="hljs-comment"># Batch Timeout: The amount of time to wait before creating a batch</span>
    <span class="hljs-attribute">BatchTimeout</span>: <span class="hljs-number">2</span>s

    <span class="hljs-comment"># Batch Size: Controls the number of messages batched into a block</span>
    <span class="hljs-attribute">BatchSize</span>:

        <span class="hljs-comment"># Max Message Count: The maximum number of messages to permit in a batch</span>
        <span class="hljs-attribute">MaxMessageCount</span>: <span class="hljs-number">10</span>

        <span class="hljs-comment"># Absolute Max Bytes: The absolute maximum number of bytes allowed for</span>
        <span class="hljs-comment"># the serialized messages in a batch.</span>
        <span class="hljs-attribute">AbsoluteMaxBytes</span>: <span class="hljs-number">99</span> MB

        <span class="hljs-comment"># Preferred Max Bytes: The preferred maximum number of bytes allowed for</span>
        <span class="hljs-comment"># the serialized messages in a batch. A message larger than the preferred</span>
        <span class="hljs-comment"># max bytes will result in a batch larger than preferred max bytes.</span>
        <span class="hljs-attribute">PreferredMaxBytes</span>: <span class="hljs-number">512</span> KB

    <span class="hljs-attribute">Kafka</span>:
        <span class="hljs-comment"># Brokers: A list of Kafka brokers to which the orderer connects</span>
        <span class="hljs-comment"># NOTE: Use IP:port notation</span>
        <span class="hljs-attribute">Brokers</span>:
            - <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">9092</span>

    <span class="hljs-comment"># Organizations is the list of orgs which are defined as participants on</span>
    <span class="hljs-comment"># the orderer side of the network</span>
    <span class="hljs-attribute">Organizations</span>:

<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SECTION: Application</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the values to encode into a config transaction or</span>
<span class="hljs-comment"># genesis block for application related parameters</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Application</span>: &amp;ApplicationDefaults

    <span class="hljs-comment"># Organizations is the list of orgs which are defined as participants on</span>
    <span class="hljs-comment"># the application side of the network</span>
    <span class="hljs-attribute">Organizations</span>:

<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SECTION: Capabilities</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the capabilities of fabric network. This is a new</span>
<span class="hljs-comment"># concept as of v1.1.0 and should not be utilized in mixed networks with</span>
<span class="hljs-comment"># v1.0.x peers and orderers. Capabilities define features which must be</span>
<span class="hljs-comment"># present in a fabric binary for that binary to safely participate in the</span>
<span class="hljs-comment"># fabric network. For instance, if a new MSP type is added, newer binaries</span>
<span class="hljs-comment"># might recognize and validate the signatures from this type, while older</span>
<span class="hljs-comment"># binaries without this support would be unable to validate those</span>
<span class="hljs-comment"># transactions. This could lead to different versions of the fabric binaries</span>
<span class="hljs-comment"># having different world states. Instead, defining a capability for a channel</span>
<span class="hljs-comment"># informs those binaries without this capability that they must cease</span>
<span class="hljs-comment"># processing transactions until they have been upgraded. For v1.0.x if any</span>
<span class="hljs-comment"># capabilities are defined (including a map with all capabilities turned off)</span>
<span class="hljs-comment"># then the v1.0.x peer will deliberately crash.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Capabilities</span>:
    <span class="hljs-comment"># Channel capabilities apply to both the orderers and the peers and must be</span>
    <span class="hljs-comment"># supported by both. Set the value of the capability to true to require it.</span>
    <span class="hljs-attribute">Global</span>: &amp;ChannelCapabilities
        <span class="hljs-comment"># V1.1 for Global is a catchall flag for behavior which has been</span>
        <span class="hljs-comment"># determined to be desired for all orderers and peers running v1.0.x,</span>
        <span class="hljs-comment"># but the modification of which would cause incompatibilities. Users</span>
        <span class="hljs-comment"># should leave this flag set to true.</span>
        <span class="hljs-attribute">V1_1</span>: <span class="hljs-literal">true</span>

    <span class="hljs-comment"># Orderer capabilities apply only to the orderers, and may be safely</span>
    <span class="hljs-comment"># manipulated without concern for upgrading peers. Set the value of the</span>
    <span class="hljs-comment"># capability to true to require it.</span>
    <span class="hljs-attribute">Orderer</span>: &amp;OrdererCapabilities
        <span class="hljs-comment"># V1.1 for Order is a catchall flag for behavior which has been</span>
        <span class="hljs-comment"># determined to be desired for all orderers running v1.0.x, but the</span>
        <span class="hljs-comment"># modification of which would cause incompatibilities. Users should</span>
        <span class="hljs-comment"># leave this flag set to true.</span>
        <span class="hljs-attribute">V1_1</span>: <span class="hljs-literal">true</span>

    <span class="hljs-comment"># Application capabilities apply only to the peer network, and may be safely</span>
    <span class="hljs-comment"># manipulated without concern for upgrading orderers. Set the value of the</span>
    <span class="hljs-comment"># capability to true to require it.</span>
    <span class="hljs-attribute">Application</span>: &amp;ApplicationCapabilities
        <span class="hljs-comment"># V1.1 for Application is a catchall flag for behavior which has been</span>
        <span class="hljs-comment"># determined to be desired for all peers running v1.0.x, but the</span>
        <span class="hljs-comment"># modification of which would cause incompatibilities. Users should</span>
        <span class="hljs-comment"># leave this flag set to true.</span>
        <span class="hljs-attribute">V1_1</span>: <span class="hljs-literal">true</span>
</code></pre> 
  <pre class="prettyprint"><code class=" hljs lasso">export FABRIC_CFG_PATH<span class="hljs-subst">=</span><span class="hljs-variable">$PWD</span>
mkdir dir channel<span class="hljs-attribute">-artifacts</span>
configtxgen <span class="hljs-attribute">-profile</span> TwoOrgsOrdererGenesis <span class="hljs-attribute">-outputBlock</span> <span class="hljs-built_in">.</span>/channel<span class="hljs-attribute">-artifacts</span>/genesis<span class="hljs-built_in">.</span>block</code></pre> 
  <h2 id="生成创建频道配置交易">生成创建频道配置交易</h2> 
  <pre class="prettyprint"><code class=" hljs lasso">configtxgen <span class="hljs-attribute">-profile</span> TwoOrgsChannel <span class="hljs-attribute">-outputCreateChannelTx</span> <span class="hljs-built_in">.</span>/channel<span class="hljs-attribute">-artifacts</span>/mychannel<span class="hljs-built_in">.</span>tx <span class="hljs-attribute">-channelID</span> mychannel</code></pre> 
  <p>命令成功执行后，进入channel-artifacts 文件夹，会看到生成的创世区块文件和创建频道交易数据文件</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"> genesis<span class="hljs-preprocessor">.block</span>
 mychannel<span class="hljs-preprocessor">.tx</span></code></pre> 
  <h2 id="配置和启动orderer容器">配置和启动orderer容器</h2> 
  <p>docker-orderer.yaml 文件内容如下</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  orderer.example.com:
    container_name: orderer.example.com
    image: hyperledger/fabric-orderer:latest
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE</span>=steven_default </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LOGLEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LISTENADDRESS</span>=<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LISTENPORT</span>=<span class="hljs-number">7050</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_GENESISMETHOD</span>=file </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_GENESISFILE</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/orderer</span>.genesis.block </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LOCALMSPID</span>=<span class="hljs-constant">OrdererMSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LOCALMSPDIR</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/msp</span> </span>      # enabled TLS
      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_ENABLED</span>=<span class="hljs-constant">TRUE</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_PRIVATEKEY</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/tls</span><span class="hljs-regexp">/server.key </span></span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_CERTIFICATE</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/tls</span><span class="hljs-regexp">/server.crt </span></span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_ROOTCAS</span>=[<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/tls</span><span class="hljs-regexp">/ca.crt] </span></span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric
    command: orderer
    volumes:
    -<span class="ruby"> ./channel-artifacts/genesis.<span class="hljs-symbol">block:</span>/var/hyperledger/orderer/orderer.genesis.block </span>    -<span class="ruby"> ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/<span class="hljs-symbol">msp:</span>/var/hyperledger/orderer/msp </span>    -<span class="ruby"> ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/<span class="hljs-symbol">:/var/hyperledger/orderer/tls</span> </span>    networks:
      default:
        aliases:
          -<span class="ruby"> steven </span>    ports:
      -<span class="ruby"> <span class="hljs-number">7050</span><span class="hljs-symbol">:</span><span class="hljs-number">7050</span> </span>


</code></pre> 
  <p>启动orderer容器</p> 
  <pre class="prettyprint"><code class=" hljs lasso">docker<span class="hljs-attribute">-compose</span> <span class="hljs-attribute">-f</span> docker<span class="hljs-attribute">-orderer</span><span class="hljs-built_in">.</span>yaml up <span class="hljs-attribute">-d</span></code></pre> 
  <h2 id="配置和启动-peer0org1-节点">配置和启动 peer0.org1 节点</h2> 
  <p>KEY文件</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">cd ./crypto-config/peerOrganizations/org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>/ca</code></pre> 
  <p>这个路径下有一个文件名以 _sk 结尾的文件</p> 
  <p>FABRIC_CA_SERVER_TLS_KEYFILE <br> command <br> 配置项替换成实际的_sk文件</p> 
  <pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-subst">-</span> FABRIC_CA_SERVER_TLS_KEYFILE<span class="hljs-subst">=</span>/etc/hyperledger/fabric<span class="hljs-attribute">-ca</span><span class="hljs-attribute">-server</span><span class="hljs-attribute">-config</span>/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk

command: sh <span class="hljs-attribute">-c</span> <span class="hljs-string">'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d'</span>
</code></pre> 
  <p>配置文件内容如下</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  couchdb:
    container_name: couchdb
    image: hyperledger/fabric-couchdb:latest
  # Populate the COUCHDB_USER and COUCHDB_PASSWORD to set an admin user and password
  # for CouchDB.  This will prevent CouchDB from operating in an "Admin Party" mode.
#    environment:
#      - COUCHDB_USER=
#      - COUCHDB_PASSWORD=
  # Comment/Uncomment the port mapping if you want to hide/expose the CouchDB service,
  # for example map it to utilize Fauxton User Interface in dev environments.
    ports:
      -<span class="ruby"> <span class="hljs-string">"5984:5984"</span> </span>

  ca:
      container_name: ca
      image: hyperledger/fabric-ca:latest
      environment:
        -<span class="ruby"> <span class="hljs-constant">FABRIC_CA_HOME</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric-ca-server </span></span>        -<span class="ruby"> <span class="hljs-constant">FABRIC_CA_SERVER_CA_NAME</span>=ca </span>        -<span class="ruby"> <span class="hljs-constant">FABRIC_CA_SERVER_TLS_ENABLED</span>=<span class="hljs-constant">TRUE</span> </span>        -<span class="ruby"> <span class="hljs-constant">FABRIC_CA_SERVER_TLS_CERTFILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric-ca-server-config/ca</span>.org1.example.com-cert.pem </span>        -<span class="ruby"> <span class="hljs-constant">FABRIC_CA_SERVER_TLS_KEYFILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric-ca-server-config/e</span>1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk </span>      ports:
        -<span class="ruby"> <span class="hljs-string">"7054:7054"</span> </span>      command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/e1f396671ed85eb422a1cf8f596cc68fabb00d902b6a51c238e933a181795ae7_sk -b admin:adminpw -d'
      volumes:
        -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/ca/<span class="hljs-symbol">:/etc/hyperledger/fabric-ca-server-config</span> </span>


  peer0.org1.example.com:
    container_name: peer0.org1.example.com
    image: hyperledger/fabric-peer:latest
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_LEDGER_STATE_STATEDATABASE</span>=<span class="hljs-constant">CouchDB</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS</span>=<span class="hljs-symbol">couchdb:</span><span class="hljs-number">5984</span> </span>
      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=peer<span class="hljs-number">0</span>.org1.example.com </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_NETWORKID</span>=steven </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_CHAINCODELISTENADDRESS</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_EXTERNALENDPOINT</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org1MSP</span> </span>
      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>    # the following setting starts chaincode containers on the same
    # bridge network as the peers
    # https://docs.docker.com/compose/networking/
      -<span class="ruby"> <span class="hljs-constant">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE</span>=steven_default </span>#      - CORE_LOGGING_LEVEL=INFO
      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_SKIPHANDSHAKE</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_USELEADERELECTION</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_ORGLEADER</span>=<span class="hljs-keyword">false</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_PROFILE_ENABLED</span>=<span class="hljs-keyword">false</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-constant">TRUE</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.key </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt </span></span>    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp </span>        -<span class="ruby"> ./crypto-config/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls </span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    command: peer node start
    ports:
      -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-number">7053</span><span class="hljs-symbol">:</span><span class="hljs-number">7053</span> </span>    depends_on:
      -<span class="ruby"> couchdb </span>    networks:
      default:
        aliases:
          -<span class="ruby"> steven </span>

  cli:
    container_name: cli
    image: hyperledger/fabric-tools:latest
    tty: true
    stdin_open: true
    environment:
      -<span class="ruby"> <span class="hljs-constant">GOPATH</span>=<span class="hljs-regexp">/opt/gopath</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>#    - CORE_LOGGING_LEVEL=INFO
      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=cli </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org1MSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-constant">TRUE</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/tls/server.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/tls/server.key </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/tls/ca.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com/msp </span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    command: /bin/bash
    volumes:
      -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>      -<span class="ruby"> ./chaincode/go/<span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/steven/chaincode/go </span>      -<span class="ruby"> ./crypto-<span class="hljs-symbol">config:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ </span>      -<span class="ruby"> ./channel-<span class="hljs-symbol">artifacts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts </span>    depends_on:
#    - orderer.example.com
      -<span class="ruby"> peer<span class="hljs-number">0</span>.org1.example.com </span>#    - peer1.org1.example.com
#    - peer0.org2.example.com
#    - peer1.org2.example.com
    networks:
      default:
        aliases:
          -<span class="ruby"> steven </span></code></pre> 
  <p>启动peer0.org1 节点容器</p> 
  <pre class="prettyprint"><code class=" hljs lasso">docker<span class="hljs-attribute">-compose</span> <span class="hljs-attribute">-f</span> docker<span class="hljs-attribute">-peer</span><span class="hljs-built_in">.</span>yaml up <span class="hljs-attribute">-d</span></code></pre> 
  <h2 id="创建channel">创建channel</h2> 
  <p>登入cli容器</p> 
  <pre class="prettyprint"><code class=" hljs bash">docker <span class="hljs-keyword">exec</span> -it cli bash</code></pre> 
  <p>创建频道</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">peer channel create -o orderer<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>:<span class="hljs-number">7050</span> -c mychannel -t <span class="hljs-number">50</span> -f ./channel-artifacts/mychannel<span class="hljs-preprocessor">.tx</span>  --tls --cafile /opt/gopath/src/github<span class="hljs-preprocessor">.com</span>/hyperledger/fabric/peer/crypto/ordererOrganizations/example<span class="hljs-preprocessor">.com</span>/orderers/orderer<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>/msp/tlscacerts/tlsca<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>-cert<span class="hljs-preprocessor">.pem</span> </code></pre> 
  <p>日志中可以看到</p> 
  <pre class="prettyprint"><code class=" hljs scss"><span class="hljs-attr_selector">[channelCmd]</span> readBlock -&gt; INFO 020 Received <span class="hljs-value">block</span><span class="hljs-value">: <span class="hljs-number">0</span></span></code></pre> 
  <p>0号区块，即频道里的创世区块，已经被正常创建了。 <br> 在当前路径下执行ls，可以看到生成了 mychannel.block 文件，这个文件保存了创世区块的内容，说明创建频道成功。</p> 
  <h2 id="将peer0org1-加入频道">将peer0.org1 加入频道</h2> 
  <p>环境变量 CORE_PEER_ADDRESS 定义了要操作的目标节点 <br> 查看这个环境变量的值，</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$CORE_PEER_ADDRESS</span>
peer0.org1.example.com:<span class="hljs-number">7051</span></code></pre> 
  <p>可以看到目前要操作的目标节点是peer0.org1</p> 
  <p>加入频道</p> 
  <pre class="prettyprint"><code class=" hljs oxygene">peer channel <span class="hljs-keyword">join</span> -b mychannel.<span class="hljs-keyword">block</span> </code></pre> 
  <p>查看频道信息</p> 
  <pre class="prettyprint"><code class=" hljs ruby">root<span class="hljs-variable">@7fdedcc1183b</span><span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/peer<span class="hljs-comment"># peer channel list</span>
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">28.753</span> <span class="hljs-constant">UTC</span> [msp] <span class="hljs-constant">GetLocalMSP</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">001</span> <span class="hljs-constant">Returning</span> existing local <span class="hljs-constant">MSP</span>
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">28.753</span> <span class="hljs-constant">UTC</span> [msp] <span class="hljs-constant">GetDefaultSigningIdentity</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">002</span> <span class="hljs-constant">Obtaining</span> default signing identity
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">28.754</span> <span class="hljs-constant">UTC</span> [channelCmd] <span class="hljs-constant">InitCmdFactory</span> -&gt; <span class="hljs-constant">INFO</span> <span class="hljs-number">003</span> <span class="hljs-constant">Endorser</span> <span class="hljs-keyword">and</span> orderer connections initialized
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">28.755</span> <span class="hljs-constant">UTC</span> [msp/identity] <span class="hljs-constant">Sign</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">004</span> <span class="hljs-constant">Sign</span><span class="hljs-symbol">:</span> <span class="hljs-symbol">plaintext:</span> 0AB4070A5C08031A0C08FCA3C9DB051<span class="hljs-number">0</span>...<span class="hljs-number">631</span>A0D0A0B4765744368616E6E656C73 
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">28.755</span> <span class="hljs-constant">UTC</span> [msp/identity] <span class="hljs-constant">Sign</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">005</span> <span class="hljs-constant">Sign</span><span class="hljs-symbol">:</span> <span class="hljs-symbol">digest:</span> <span class="hljs-number">99844</span>B080D2E7B509EDD67B6DC7F5898AF1562D4AAC3A3593010844922AA0304 
<span class="hljs-constant">Channels</span> peers has <span class="hljs-symbol">joined:</span> 
mychannel
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">52</span><span class="hljs-symbol">:</span><span class="hljs-number">28.757</span> <span class="hljs-constant">UTC</span> [main] main -&gt; <span class="hljs-constant">INFO</span> <span class="hljs-number">006</span> <span class="hljs-constant">Exiting</span>.....</code></pre> 
  <p>可以看到 节点已经成功加入了mychannel频道</p> 
  <pre class="prettyprint"><code class=" hljs ruby">root<span class="hljs-variable">@7fdedcc1183b</span><span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/peer<span class="hljs-comment"># peer channel getinfo -c mychannel</span>
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">32.992</span> <span class="hljs-constant">UTC</span> [msp] <span class="hljs-constant">GetLocalMSP</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">001</span> <span class="hljs-constant">Returning</span> existing local <span class="hljs-constant">MSP</span>
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">32.992</span> <span class="hljs-constant">UTC</span> [msp] <span class="hljs-constant">GetDefaultSigningIdentity</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">002</span> <span class="hljs-constant">Obtaining</span> default signing identity
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">32.993</span> <span class="hljs-constant">UTC</span> [channelCmd] <span class="hljs-constant">InitCmdFactory</span> -&gt; <span class="hljs-constant">INFO</span> <span class="hljs-number">003</span> <span class="hljs-constant">Endorser</span> <span class="hljs-keyword">and</span> orderer connections initialized
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">32.993</span> <span class="hljs-constant">UTC</span> [msp/identity] <span class="hljs-constant">Sign</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">004</span> <span class="hljs-constant">Sign</span><span class="hljs-symbol">:</span> <span class="hljs-symbol">plaintext:</span> 0AB4070A5C08031A0C08F8A4C9DB051<span class="hljs-number">0</span>...<span class="hljs-number">6</span>E496E666F0A096D796368616E6E656C 
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">32.993</span> <span class="hljs-constant">UTC</span> [msp/identity] <span class="hljs-constant">Sign</span> -&gt; <span class="hljs-constant">DEBU</span> <span class="hljs-number">005</span> <span class="hljs-constant">Sign</span><span class="hljs-symbol">:</span> <span class="hljs-symbol">digest:</span> <span class="hljs-constant">D19350DDC8B2042CB89C5F8A1EE06B7A196916B29BB44B82E51CEA3703448F25</span> 
<span class="hljs-constant">Blockchain</span> <span class="hljs-symbol">info:</span> {<span class="hljs-string">"height"</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span>,<span class="hljs-string">"currentBlockHash"</span><span class="hljs-symbol">:<span class="hljs-string">"VbnvfMzMoQ3Bvbdf6BZcvtEj41W2657lQTptDsGTii0="</span></span>}
<span class="hljs-number">2018</span>-08-<span class="hljs-number">14</span> <span class="hljs-number">03</span><span class="hljs-symbol">:</span><span class="hljs-number">54</span><span class="hljs-symbol">:</span><span class="hljs-number">32.995</span> <span class="hljs-constant">UTC</span> [main] main -&gt; <span class="hljs-constant">INFO</span> <span class="hljs-number">006</span> <span class="hljs-constant">Exiting</span>.....
root<span class="hljs-variable">@7fdedcc1183b</span><span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/peer<span class="hljs-comment"># </span></code></pre> 
  <p>在这个频道里区块链的高度为1，也就是说目前只有1个区块，也就是0号创世区块</p> 
  <h2 id="chaincode">chaincode</h2> 
  <h3 id="编译chaincode">编译chaincode</h3> 
  <pre class="prettyprint"><code class=" hljs go">cd chaincode/<span class="hljs-keyword">go</span>/chaincode_example02/<span class="hljs-keyword">go</span>
<span class="hljs-keyword">go</span> get -u --tags nopkcs11 github.com/hyperledger/fabric/core/chaincode/shim
<span class="hljs-keyword">go</span> build --tags nopkcs11 -o chaincode_example02</code></pre> 
  <p>编译完成后，在当前目录会生成名为 chaincode_example02 的可执行文件</p> 
  <h3 id="安装chaincode到peer节点">安装chaincode到peer节点</h3> 
  <p>在peer节点的docker-peer.yaml 文件中</p> 
  <pre class="prettyprint"><code class=" hljs haml">    volumes:
      -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>      -<span class="ruby"> ./chaincode/go/<span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/steven/chaincode/go</span></code></pre> 
  <pre class="prettyprint"><code class=" hljs lasso">peer chaincode install <span class="hljs-attribute">-n</span> mycc <span class="hljs-attribute">-p</span> github<span class="hljs-built_in">.</span>com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go <span class="hljs-attribute">-v</span> <span class="hljs-number">1.0</span>        </code></pre> 
  <p>-p 参数定义chaincode所在路径 <br> 因为 <br> chaincode所在的完整路径为 <br> /opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go <br> 因为定义了环境变量 GOPATH=/opt/gopath <br> 所以 -p 参数只需要提供 github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go <br> peer channel install 命令会自动到 $GOPATH/src/ github.com/hyperledger/fabric/steven/chaincode/go/chaincode_example02/go <br> 找chaincode</p> 
  <h3 id="实例化chaincode">实例化chaincode</h3> 
  <pre class="prettyprint"><code class=" hljs lasso">peer chaincode instantiate <span class="hljs-attribute">-o</span> orderer<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com:<span class="hljs-number">7050</span> <span class="hljs-attribute">-C</span> mychannel <span class="hljs-attribute">-n</span> mycc <span class="hljs-attribute">-c</span> <span class="hljs-string">'{"Args":["init","A","10","B","10"]}'</span> <span class="hljs-attribute">-P</span> <span class="hljs-string">"OR ('Org1MSP.member')"</span> <span class="hljs-attribute">-v</span> <span class="hljs-number">1.0</span>  <span class="hljs-subst">--</span>tls <span class="hljs-subst">--</span>cafile /opt/gopath/src/github<span class="hljs-built_in">.</span>com/hyperledger/fabric/peer/crypto/ordererOrganizations/example<span class="hljs-built_in">.</span>com/orderers/orderer<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com/msp/tlscacerts/tlsca<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-cert</span><span class="hljs-built_in">.</span>pem</code></pre> 
  <h3 id="调用chaincode">调用chaincode</h3> 
  <h4 id="query">query</h4> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">peer</span> chaincode query -<span class="hljs-type">C</span> mychannel -n mycc -c '{<span class="hljs-string">"Args"</span>:[<span class="hljs-string">"query"</span>, <span class="hljs-string">"A"</span>]}'   
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetLocalMSP</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">001</span> <span class="hljs-type">Returning</span> existing local <span class="hljs-type">MSP</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetDefaultSigningIdentity</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">002</span> <span class="hljs-type">Obtaining</span> <span class="hljs-default"><span class="hljs-keyword">default</span> signing identity</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">003</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> escc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">004</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> vscc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [chaincodeCmd] getChaincodeSpec -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">005</span> java chaincode disabled
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">006</span> <span class="hljs-type">Sign</span>: plaintext: <span class="hljs-number">0</span>AC4070A6C08031A0C089FEBC9DB0510..<span class="hljs-number">.6E6</span>E656C1A0A0A0571756572790A0141 
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.987</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">007</span> <span class="hljs-type">Sign</span>: digest: <span class="hljs-type">D3D6DBE27AF65A95CD956D28F79DD1E3BD9E2B18E2DD13B5CE8217F72A86FF12</span> 
<span class="hljs-type">Query</span> <span class="hljs-type">Result</span>: <span class="hljs-number">10</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">31.999</span> <span class="hljs-type">UTC</span> [main] main -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">008</span> <span class="hljs-type">Exiting</span>.....</code></pre> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">peer</span> chaincode query -<span class="hljs-type">C</span> mychannel -n mychannel -c '{<span class="hljs-string">"Args"</span>:[<span class="hljs-string">"query"</span>, <span class="hljs-string">"B"</span>]}' 
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetLocalMSP</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">001</span> <span class="hljs-type">Returning</span> existing local <span class="hljs-type">MSP</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetDefaultSigningIdentity</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">002</span> <span class="hljs-type">Obtaining</span> <span class="hljs-default"><span class="hljs-keyword">default</span> signing identity</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">003</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> escc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">004</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> vscc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [chaincodeCmd] getChaincodeSpec -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">005</span> java chaincode disabled
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">006</span> <span class="hljs-type">Sign</span>: plaintext: <span class="hljs-number">0</span>AC3070A6B08031A0B08B9EBC9DB0510..<span class="hljs-number">.6E6</span>E656C1A0A0A0571756572790A0142 
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.225</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">007</span> <span class="hljs-type">Sign</span>: digest: <span class="hljs-number">6</span>A27E793D0F7E6CD473137EC984FB9D5803F66F80B64D2FF47034F705A7DE699 
<span class="hljs-type">Query</span> <span class="hljs-type">Result</span>: <span class="hljs-number">10</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57.242</span> <span class="hljs-type">UTC</span> [main] main -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">008</span> <span class="hljs-type">Exiting</span>.....</code></pre> 
  <p>分别查询A 和 B的值，目前都是 10， </p> 
  <h4 id="invoke">invoke</h4> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">peer</span> chaincode invoke -<span class="hljs-type">C</span> mychannel -n mycc -c '{<span class="hljs-string">"Args"</span>:[<span class="hljs-string">"invoke"</span>, <span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"3"</span>]}'   <span class="hljs-comment">--tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span></code></pre> 
  <p>再次query A和B</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">root</span>@<span class="hljs-number">7</span>fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -<span class="hljs-type">C</span> mychannel -n mycc -c '{<span class="hljs-string">"Args"</span>:[<span class="hljs-string">"query"</span>, <span class="hljs-string">"A"</span>]}'            
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.210</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetLocalMSP</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">001</span> <span class="hljs-type">Returning</span> existing local <span class="hljs-type">MSP</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.210</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetDefaultSigningIdentity</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">002</span> <span class="hljs-type">Obtaining</span> <span class="hljs-default"><span class="hljs-keyword">default</span> signing identity</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.210</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">003</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> escc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.210</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">004</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> vscc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.211</span> <span class="hljs-type">UTC</span> [chaincodeCmd] getChaincodeSpec -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">005</span> java chaincode disabled
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.211</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">006</span> <span class="hljs-type">Sign</span>: plaintext: <span class="hljs-number">0</span>AC3070A6B08031A0B08FAECC9DB0510..<span class="hljs-number">.6E6</span>E656C1A0A0A0571756572790A0141 
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.211</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">007</span> <span class="hljs-type">Sign</span>: digest: <span class="hljs-number">946</span>CB5FE517D93FEC27065BB3534B69E5FD73AA5E8C08E2A56FC6C071F549DD3 
<span class="hljs-type">Query</span> <span class="hljs-type">Result</span>: <span class="hljs-number">7</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">10.222</span> <span class="hljs-type">UTC</span> [main] main -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">008</span> <span class="hljs-type">Exiting</span>.....
<span class="hljs-title">root</span>@<span class="hljs-number">7</span>fdedcc1183b:/opt/gopath/src/github.com/hyperledger/fabric/steven/chaincode# peer chaincode query -<span class="hljs-type">C</span> mychannel -n mycc -c '{<span class="hljs-string">"Args"</span>:[<span class="hljs-string">"query"</span>, <span class="hljs-string">"B"</span>]}'            
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.821</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetLocalMSP</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">001</span> <span class="hljs-type">Returning</span> existing local <span class="hljs-type">MSP</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.821</span> <span class="hljs-type">UTC</span> [msp] <span class="hljs-type">GetDefaultSigningIdentity</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">002</span> <span class="hljs-type">Obtaining</span> <span class="hljs-default"><span class="hljs-keyword">default</span> signing identity</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.821</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">003</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> escc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.821</span> <span class="hljs-type">UTC</span> [chaincodeCmd] checkChaincodeCmdParams -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">004</span> <span class="hljs-type">Using</span> <span class="hljs-default"><span class="hljs-keyword">default</span> vscc</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.821</span> <span class="hljs-type">UTC</span> [chaincodeCmd] getChaincodeSpec -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">005</span> java chaincode disabled
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.822</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">006</span> <span class="hljs-type">Sign</span>: plaintext: <span class="hljs-number">0</span>AC4070A6C08031A0C08FEECC9DB0510..<span class="hljs-number">.6E6</span>E656C1A0A0A0571756572790A0142 
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.822</span> <span class="hljs-type">UTC</span> [msp/identity] <span class="hljs-type">Sign</span> -&gt; <span class="hljs-type">DEBU</span> <span class="hljs-number">007</span> <span class="hljs-type">Sign</span>: digest: <span class="hljs-number">81</span>FC2A154BAE944DFB58FC8B2E7BA3E9A10820BCA74EBB93658030027A34904A 
<span class="hljs-type">Query</span> <span class="hljs-type">Result</span>: <span class="hljs-number">13</span>
<span class="hljs-number">2018</span>-<span class="hljs-number">08</span>-<span class="hljs-number">14</span> <span class="hljs-number">06</span>:<span class="hljs-number">28</span>:<span class="hljs-number">14.830</span> <span class="hljs-type">UTC</span> [main] main -&gt; <span class="hljs-type">INFO</span> <span class="hljs-number">008</span> <span class="hljs-type">Exiting</span>.....</code></pre> 
  <p>A减去了3变成了7 <br> B加上了3变成了13</p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhangleisddx/article/details/81661265,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhangleisddx/article/details/81661265,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>0.166666667小时，教会你深挖以太坊数据层 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="0.166666667小时，教会你深挖以太坊数据层" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="作者 | Vasa&nbsp; 企业家、TowardsBlockChain&nbsp;联合创始人 编译 | kou、Guoxi 在当下数据爆炸的信息时代，凭借区块链去中心化、点对点和防篡改的特性，“区块链+大数据”已成为研究的热门，可以说，区块链与大数据的结合为今后区块链应用的大规模落地奠定了基础。 那么，区块链中的数据如何存储？不同区块链数据存储机制有何异同？以以太坊为例，在本文中，MIT 孵化初创公司 TowardsBlockChain 联合创始人 vasa 详细阐述了以太坊的数据存储机制、以太坊如何存储区块链状态与交易以及以太坊和比特币在存储机制上的异同。 此外，本文将带你深入了解 “Patricia 字典树”数据结构背后的理论基础，并通过使用 Google 的 levelDB 数据库演示以太坊字典树的具体实现。 字字行文皆重点，行行代码皆干货，请往下看！ 从架构设计上来说，区块链可以简单的分为三个层次，协议层、扩展层和应用层。其中，协议层又可以分为存储层和网络层，它们相互独立但又不可分割。 数据存储层中存储了什么？ 首先了解下区块链的数据存储层，什么是区块链数据存储层？它存储了什么？它需要存储哪些数据才能保障区块链系统正常工作？ ﻿ ﻿ 比如Alice向Bob转账10美元。从上图可以看出，可以通过向区块链中加入一笔交易来改变区块链当前的状态。 在跟踪不同用户（状态）的账户余额和其他相关的细节的同时，也要跟踪不同用户通过区块链（交易）所引起的区块链状态转变的细节。 不同的区块链，比如比特币和以太坊，实现上述功能所使用的方法是不同的。 1、比特币的“状态” 比特币的“状态”由其全网络未使用的交易输出UTXO（Unspent Transaction Output）来表示。 比特币的价值转移是通过交易来实现的。更具体地说，比特币用户可以通过创建一笔交易并将其一个或多个UTXO添加为交易的输入来花掉这一个或多个UTXO。 比特币的UTXO模型，是其区别于以太坊的主要特征，为更好地理解二者之间的差异，先来看一些例子。 首先，比特币中的UTXO不能只花费一部分，必须全部花完。 如果一个比特币用户要花费0.5个比特币，而他只有一个价值1比特币的UTXO，那么在交易时他必须将自己的比特币地址也加入到交易的输出中，即发给自己0.5个比特币作为找零。 如果他不给自己发送找零，他将失去这0.5个比特币，这0.5个比特币将会被当作交易费付给挖出此区块的矿工。 ﻿ UTXO交易 其次，从本质上讲，比特币的区块链并不会存储和更新用户的账户余额。在比特币网络中，用户只需持有一个或多个 UTXO 的私钥。 数字钱包的使用使得比特币的区块链看起来像是在自动存储和更新用户的帐户余额，但其实并不是这样。 ﻿ ﻿图解比特币钱包工作过程 比特币的 UTXO 模型运行良好，一部分原因是数字钱包能够执行与交易相关的大多数任务，包括但不局限于： 处理 UTXO 存储密钥 设定交易费用 提供交易找零地址 汇总 UTXO（显示可用的、交易进行中的和总余额） 如何来描述 UTXO 模型中的交易行为？钞票是一个绝佳的类比。 用户通过将钱包（类比比特币地址或者数字钱包）中的钞票（类比 UTXO）相加来计算自己的资金，想要花钱时，就使用一张或者多张钞票。 每张钞票只能使用一次，因为一旦花费，它就不属于你了。 因此，可以得出这样的结论： 比特币区块链并不存储和更新账户余额 比特币钱包持有UTXO对应的私钥 如果UTXO包含在交易中，那么它会被全部花完（在 UTXO 大于支出金额时，会收到一个全新 UTXO 的“找零”） 2、以太坊的“状态” 与上述比特币的区块链不同，以太坊区块链中的状态能够存储和更新用户的账户余额等信息。 以太坊的状态不是一个抽象的概念，它是以太坊底层协议的一部分。 正如以太坊黄皮书所提到的，以太坊是一个基于交易的“状态机”，是一个可以构建所有基于交易的“状态机”的技术。 与所有其他区块链一样，以太坊的区块链由创世区块开始延伸。 从创世区块开始，诸如交易，部署智能合约和挖矿等行为将不断改变以太坊区块链的状态。在以太坊中，每当有与该帐户相关的交易发生时，帐户余额（存储在状态字典树中）就会发生变化。 帐户余额等数据并不直接存储在以太坊区块链的区块中， 只有交易字典树、状态字典树和收款字典树的根节点哈希直接存储在区块链中。如下图： ﻿ 存储字典树（保存所有智能合约数据的地方）的根节点哈希实际上指向状态字典树，而状态字典树又指向区块链。 以太坊中存储着两种截然不同的数据：永久数据和临时数据。 交易信息为永久数据，一笔交易在得到完全确认后，将被记录在交易字典树中，它永远不会改变；账户余额则为临时数据，地址对应的账户余额存储在状态字典树中，并且每当出现与该指定帐户相关的交易时账户余额就会更改。 因此，永久数据和临时数据应单独、分别存储，以太坊使用字典树的数据结构来管理数据。 以太坊的记录保存机制与银行一样，一个类比就是使用ATM /借记卡。 银行跟踪每张借记卡的余额，当用户需要花钱时，银行会检查交易记录，以判断用户是否有足够的余额来进行交易。 3、比特币 UTXO 模型与以太坊账户/余额模型的比较 比特币 UTXO 模型的优点： 可扩展性：由于可以同时处理多个 UTXO，因此可以实现并行交易并可促进在可扩展性上的创新。 隐私保护：即使比特币不是一个完全匿名的系统，但只要用户每笔交易都使用新地址，UTXO 模型就能提供更高级别的隐私保护。如果需要增强隐私保护，可以考虑使用更复杂的方案，例如环签名。 以太坊账户/余额模型的优点： 简单性：以太坊选择了更简单直观的模型，便于开发人员实现复杂的智能合约，特别是那些需要以太坊网络状态信息或涉及多个参与方的智能合约。比如基于以太坊网络的不同状态执行不同任务的智能合约，若使用 UTXO 的无状态模型，需要强制在每笔交易中加入状态信息，这会使智能合约的设计复杂化。 高效性：除了简单性之外，以太坊账户/余额模型更加高效，因为每笔交易只需要验证发送方账户是否有足够的余额来支付交易。 为防止以太坊账户/余额模型遭到双重支付攻击，可以用一个递增的随机数来防范这种类型的攻击。 在以太坊中，每个帐户都有一个公共可见的随机数，每次进行交易时，这个随机数增加1，这种机制可以防止同一笔交易被多次提交。 这个随机数与以太坊工作量证明的随机数不同，后者是一个挖矿过程的随机值 在计算机体系架构中，有时需要在不同模型之间进行折衷。一些区块链技术，比如 Hyperledger，就采用了 UTXO 机制，因为这样可以从比特币区块链所衍生的创新中受益。 接下来简要分析更多基于这两种记录保存模型构建的技术。 以太坊字典树数据结构 以太坊字典树数据结构主要包括状态字典树、存储字典树和交易字典树。 1、状态字典树——独一无二的存在 在以太坊网络中有一个唯一的全网络状态字典树。 这个全网络状态字典树不断在更新。 这个全网络状态字典树中包含以太坊网络中每个账户所对应的键值对（key and value pair）。 全网络状态字典树中的“键”是一个的160位标识符（以太坊帐户的地址）。 全网络状态字典树中的“值”是通过对以太坊账户的以下详细信息进行编码（使用递归长度字典编码（Recursive-Length Prefix encoding，RLP）方法）生成的： Nonce：一个公共可见的随机数。如果帐户是一个外部帐户，这个数字代表从帐户地址发送的交易数量；如果帐户是一个合约帐户，Nonce 是帐户创建的合约数量。 balance：这个地址拥有的 Wei（以太坊货币单位）数量，每个以太币有1e+18 Wei。 storageRoot ：一个Merkle Patricia 树根节点的哈希，它对帐户的存储内容的哈希值进行编码，并默认为空。 codeHash：EVM（以太坊虚拟机）的哈希值代码。 对于合约帐户，这是一个被哈希计算后并存储为codeHash的代码；对于外部帐户，codeHash字段是空字符串的哈希值。 状态字典树的根节点（在给定时间点整个状态字典树的哈希值）被用作状态字典树的安全且唯一的标识符；状态字典树的根节点在密码学上取决于状态字典树所有内部的数据。 ﻿ ﻿状态字典树（Merkle Patricia 字典树的levelDB实现）和以太坊区块之间的关系 ﻿﻿ 状态字典树：在给定的区块中，状态字典树根节点的 Keccak-256位哈希值被存储为“stateRoot”值 stateRoot: ‘0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976’ 2、存储字典树——存储智能合约数据的地方 存储字典树存储所有智能合约数据，每个以太坊帐户都有自己的存储字典树。存储字典树根节点的256位哈希值作为“storageRoot”值存储在全局状态字典树中。 ﻿ ﻿ 3、交易字典树——每个区块一个 每个以太坊区块都有自己独立的交易字典树。 一个区块中包含许多交易，区块中交易的顺序由挖出该区块的矿工决定。 交易字典树中到特定交易的路径经RLP编码后得到交易在区块中的索引。 由于区块链的防篡改性，已经被挖出的区块不会再改变，所以区块中交易的位置永远不会改变。 一旦在区块的交易字典树中找到这笔交易，即使你反复返回相同的路径，检索的结果也是相同的。 ﻿ ﻿ 以太坊字典树实例分析 主流的以太坊客户端使用两种不同的数据库软件解决方案来存储字典树。以太坊的 Rust 语言客户端 Parity 使用 rocksDB 数据库，而以太坊的 Go 语言，C ++ 语言和 Python 语言客户端都使用 levelDB 数据库。 本文中，主要带你了解 levelDB 数据库。 以太坊和 levelDB 数据库 LevelDB 是一个开源的谷歌键值存储程序库，除了常规功能外，它还提供对数据的前向和后向迭代，从字符串键到字符串值的有序映射，自定义比较函数和自动压缩。 自动压缩功能使用开源 Google 压缩/解压缩程序库 “Snappy”。Snappy 程序库的设计目标并不是追求最大压缩率，而是追求非常高的压缩速度。 LevelDB 数据库是一种重要的存储和检索机制，用于管理以太坊网络的状态。因此，levelDB 是主流以太坊客户端（节点），比如 go-ethereum，cpp-ethereum 和 pyethereum 的底层数据库。 虽然可以在磁盘上完成字典树数据结构的实现（使用诸如 levelDB 之类的数据库软件），但重要的是要注意遍历字典树和简单地查看键/值数据库之间存在的差异。 为了更详细说明这些差异，可以使用 Patricia 字典树的程序库来访问数据库levelDB 中的数据。 在以太坊客户端上，执行交易、部署智能合约和挖矿等网络操作，并观察它们如何影响以太坊的“状态”。 分析以太坊数据库 以太坊区块链中每个区块都包含许多 Merkle Patricia 字典树： 状态字典树 存储字典树 交易字典树 收款字典树 要在特定区块中引用特定的 Merkle Patricia 字典树，需要获取其根节点哈希值作为索引。 使用以下命令，获取创世区块中状态字典树、交易字典树和收款字典树的根节点哈希值： 1web3.eth.getBlock(0).stateRoot2web3.eth.getBlock(0).transactionsRoot3web3.eth.getBlock(0).receiptsRoot ﻿ ﻿ 如果想得到最新挖出区块的根节点哈希（而不是创世区块），使用以下命令： 1web3.eth.getBlock(web3.eth.blockNumber).stateRoot 获取根节点哈希值之后，需要配置网络环境。 1、安装npm、Node、Level 和 EthereumJS 使用 Node.js，Level 和 EthereumJS（使用 JavaScript 语言编写的以太坊虚拟机）三个程序来进行 levelDB 数据库的实验。 通过以下命令配置实验环境。 1cd&nbsp;~ 2 3sudo&nbsp;apt-get&nbsp;update 4 5sudo&nbsp;apt-get&nbsp;upgrade 6 7curl&nbsp;-sL&nbsp;https://deb.nodesource.com/setup_9.x&nbsp;|&nbsp;sudo&nbsp;-E&nbsp;bash&nbsp;-&nbsp;sudo&nbsp;apt-get&nbsp;install&nbsp;-y&nbsp;nodejs 8 9sudo&nbsp;apt-get&nbsp;install&nbsp;nodejs1011npm&nbsp;-v1213nodejs&nbsp;-v1415npm&nbsp;install&nbsp;levelup&nbsp;leveldown&nbsp;rlp&nbsp;merkle-patricia-tree&nbsp;--save1617git&nbsp;clone&nbsp;https://github.com/ethereumjs/ethereumjs-vm.git1819cd&nbsp;ethereumjs-vm2021npm&nbsp;install&nbsp;ethereumjs-account&nbsp;ethereumjs-util&nbsp;–save 实验环境配置完毕后，运行以下代码将打印出一个以太坊帐户和对应密钥的列表（存储在以太坊专用网络的状态根目录中），连接以太坊的 levelDB 数据库，进入以太坊专用网络的状态（使用区块链中区块的 stateRoot 值），然后访问以太坊专用网络上所有帐户的密钥。 1//Just&nbsp;importing&nbsp;the&nbsp;requirements 2 3var&nbsp;Trie&nbsp;=&nbsp;require(&#39;merkle-patricia-tree/secure&#39;); 4 5var&nbsp;levelup&nbsp;=&nbsp;require(&#39;levelup&#39;); 6 7var&nbsp;leveldown&nbsp;=&nbsp;require(&#39;leveldown&#39;); 8 9var&nbsp;RLP&nbsp;=&nbsp;require(&#39;rlp&#39;);1011var&nbsp;assert&nbsp;=&nbsp;require(&#39;assert&#39;);121314//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database1516var&nbsp;db&nbsp;=&nbsp;levelup(leveldown(&#39;/home/timothymccallum/gethDataDir/geth/chaindata&#39;));171819//Adding&nbsp;the&nbsp;&quot;stateRoot&quot;&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.2021var&nbsp;root&nbsp;=&nbsp;&#39;0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976&#39;;222324//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library2526var&nbsp;trie&nbsp;=&nbsp;new&nbsp;Trie(db,&nbsp;root);272829//Creating&nbsp;a&nbsp;nodejs&nbsp;stream&nbsp;object&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;access&nbsp;the&nbsp;data3031var&nbsp;stream&nbsp;=&nbsp;trie.createReadStream()323334//Turning&nbsp;on&nbsp;the&nbsp;stream&nbsp;(because&nbsp;the&nbsp;node&nbsp;js&nbsp;stream&nbsp;is&nbsp;set&nbsp;to&nbsp;pause&nbsp;by&nbsp;default)3536stream.on(&#39;data&#39;,&nbsp;function&nbsp;(data){3738&nbsp;&nbsp;//printing&nbsp;out&nbsp;the&nbsp;keys&nbsp;of&nbsp;the&nbsp;&quot;state&nbsp;trie&quot;3940&nbsp;&nbsp;console.log(data.key);4142}); ﻿ ﻿以上代码的输出 以太坊网络中的账户只有在交易（与该特定账户相关的交易）发生时才会被加入到状态字典树中。 例如，仅使用命令 “geth account new” 创建的新帐户将不会被加入到状态字典树中；如果一笔成功的交易（一笔消耗了以太坊燃料并被加入到已挖出的区块中的交易）与这个账户产生关联，那么这时该账户才会出现在状态字典树里。 这可以防止恶意攻击者不断创建新帐户，从而维持状态字典树的正常数据量。 2、解码数据 以太坊在与 levelDB 数据库交互时使用了“改进的 Merkle Patricia 字典树（Modified Merkle Patricia Trie）”，扩展了字典树数据结构。 例如，改进的 Merkle Patricia 包含一种方法，该方法可以通过使用“扩展”节点来实现快速遍历。 在以太坊中，一个改进的的 Merkle Patricia trie 节点可以是： 一个空字符串（NULL） 一个包含17个项目的数组（分支） 一个包含2个项目的数组（叶节点） 一个包含2个项目的数组（扩展名） 由于以太坊的字典树是根据严格的规则进行设计和构建的，因此检查它们的最佳方法是使用计算机代码进行测试。 以下示例使用了 EthereumJS，当提供特定区块的 stateRoot 以及以太坊帐户地址时，运行下面代码返回该帐户的余额。 ﻿﻿以下代码的输出（以太坊地址0xccc6b46fa5606826ce8c18fece6f519064e6130b的帐户余额） 1//Mozilla&nbsp;Public&nbsp;License&nbsp;2.0&nbsp; 2 3//As&nbsp;per&nbsp;https://github.com/ethereumjs/ethereumjs-vm/blob/master/LICENSE 4 5//Requires&nbsp;the&nbsp;following&nbsp;packages&nbsp;to&nbsp;run&nbsp;as&nbsp;nodejs&nbsp;file&nbsp;https://gist.github.com/tpmccallum/0e58fc4ba9061a2e634b7a877e60143a 6 7 8//Getting&nbsp;the&nbsp;requirements 910var&nbsp;Trie&nbsp;=&nbsp;require(&#39;merkle-patricia-tree/secure&#39;);1112var&nbsp;levelup&nbsp;=&nbsp;require(&#39;levelup&#39;);1314var&nbsp;leveldown&nbsp;=&nbsp;require(&#39;leveldown&#39;);1516var&nbsp;utils&nbsp;=&nbsp;require(&#39;ethereumjs-util&#39;);1718var&nbsp;BN&nbsp;=&nbsp;utils.BN;1920var&nbsp;Account&nbsp;=&nbsp;require(&#39;ethereumjs-account&#39;);212223//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database2425var&nbsp;db&nbsp;=&nbsp;levelup(leveldown(&#39;/home/timothymccallum/gethDataDir/geth/chaindata&#39;));262728//Adding&nbsp;the&nbsp;&quot;stateRoot&quot;&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.2930var&nbsp;root&nbsp;=&nbsp;&#39;0x9369577baeb7c4e971ebe76f5d5daddba44c2aa42193248245cf686d20a73028&#39;;313233//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library3435var&nbsp;trie&nbsp;=&nbsp;new&nbsp;Trie(db,&nbsp;root);363738var&nbsp;address&nbsp;=&nbsp;&#39;0xccc6b46fa5606826ce8c18fece6f519064e6130b&#39;;3940trie.get(address,&nbsp;function&nbsp;(err,&nbsp;raw)&nbsp;{4142&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(err)&nbsp;return&nbsp;cb(err)4344&nbsp;&nbsp;&nbsp;&nbsp;//Using&nbsp;ethereumjs-account&nbsp;to&nbsp;create&nbsp;an&nbsp;instance&nbsp;of&nbsp;an&nbsp;account4546&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;account&nbsp;=&nbsp;new&nbsp;Account(raw)4748&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Account&nbsp;Address:&nbsp;&#39;&nbsp;+&nbsp;address);4950&nbsp;&nbsp;&nbsp;&nbsp;//Using&nbsp;ethereumjs-util&nbsp;to&nbsp;decode&nbsp;and&nbsp;present&nbsp;the&nbsp;account&nbsp;balance&nbsp;5152&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Balance:&nbsp;&#39;&nbsp;+&nbsp;(new&nbsp;BN(account.balance)).toString());5354}) 独特的设计带来了哪些优点？ 1、移动性 如今移动设备和物联网（IoT）设备无处不在，而电子商务的未来建立在安全、强大和快速的移动应用上。 ﻿ ﻿ 可以说区块链在移动性上取得了巨大进步，但我们也必须承认区块链大小的不断增加是不可避免的。因此在日常移动设备上存储整个区块链是不切实际的。 2、速度快，不会影响安全性 以太坊网络状态的设计及其对改进的 Merkle Patricia 字典树的使用为其应用提供了更多的可能性。 在以太坊中字典树上执行的每个操作（添加、更新或删除）都使用了确定性的密码学哈希值。 此外，字典树根节点的密码学哈希值可以用作字典树未被篡改的证据。例如，对字典树数据的任何更改（例如增加 levelDB 数据库中的帐户余额）都将完全改变根节点哈希值。 这种密码学特性为轻客户端（不存储整个区块链的设备）带来了快速、可靠查询的可能性，比如查询账户 “0x ... 4857” 在区块高度为 “5044866” 的区块上是否有足够的资金完成此次交易等？ “Merkle 证明的空间复杂度与存储数据量呈对数关系。这意味着，即使整个状态字典树的大小为几千兆字节，如果一个节点从受信任的源接收一个状态，该节点只需下载一个几千字节的证明数据就能够完全确定该字典树上任何信息的有效性。” 3、额度限制 在以太坊白皮书中，有一个关于活期储蓄账户的概念。在这种情景下，两个用户（可能是丈夫和妻子，或着商业伙伴之间）每人每天最多只能提取帐户总余额的1%。 虽然这个想法仅仅在白皮书中“进一步发展方向”的部分中被提到，但无疑它会引起人们广泛的兴趣，因为理论上它可以作为以太坊底层协议的一部分（而不是被当作为第二层协议或者是第三方钱包的一部分）。 UTXO对区块链数据是不可见的，实际上比特币区块链并不存储用户的账户余额。因此，比特币的底层协议不太可能实现任何类型的每日额度限制。 4、消费者信心 相信随着区块链开发者的不断努力，我们会目睹轻量级客户端的快速发展，目睹可以与区块链技术交互的安全、强大和快速的移动应用程序的大规模落地。 ﻿ ﻿ 在电子商务领域想要实现区块链技术的落地必须提高速度、安全性和可用性。通过巧妙的设计提供优异的可用性，安全性和性能，这将提高消费者信心同时增加大众的采用率。 数据的存储机制也是当下区块链应用落地面临的一大问题，它决定了区块链的运行效率。 只有解决有关区块链应用落地的痛点，区块链才能真正走进人们的生活，给人们带来便利！ 看到这里，相信你对以太坊的数据存储机制已有了深入的了解。 如果你有关于以太坊数据存储、去中心化应用落地等方面的独特看法，记得及时留言给本营小姐姐哈！留言之前，记得点赞呦！ 古语说得好，“用心点赞，手有余香”~ 原文链接： https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033 内容转载请联系微信： qk15732632926（备注：微信公众号+转载） 商务合作请联系微信： fengyan-1101（备注：区块链大本营+商务合作） 最新热文： 现实版好莱坞, 门头沟事件受害者3年死磕查到真凶! 超燃黑客落网事件始末 长文 | 深度解析Solidity让老司机翻车的17个坑及超详细避坑指南，建议先马后看（附送独家资源） V神正在密切关注！这55行状态通道代码，带你快速扩展以太坊生态 10岁小表妹也能“吃透”Geth 客户端 ！360秒，快速部署 ICO Token 大力戳↑↑↑ &nbsp;加入区块链大本营读者⑦号群 （群满加微信 qk15732632926 入群） 了解更多区块链技术及应用内容 敬请关注： 阅读更多" />
<meta property="og:description" content="作者 | Vasa&nbsp; 企业家、TowardsBlockChain&nbsp;联合创始人 编译 | kou、Guoxi 在当下数据爆炸的信息时代，凭借区块链去中心化、点对点和防篡改的特性，“区块链+大数据”已成为研究的热门，可以说，区块链与大数据的结合为今后区块链应用的大规模落地奠定了基础。 那么，区块链中的数据如何存储？不同区块链数据存储机制有何异同？以以太坊为例，在本文中，MIT 孵化初创公司 TowardsBlockChain 联合创始人 vasa 详细阐述了以太坊的数据存储机制、以太坊如何存储区块链状态与交易以及以太坊和比特币在存储机制上的异同。 此外，本文将带你深入了解 “Patricia 字典树”数据结构背后的理论基础，并通过使用 Google 的 levelDB 数据库演示以太坊字典树的具体实现。 字字行文皆重点，行行代码皆干货，请往下看！ 从架构设计上来说，区块链可以简单的分为三个层次，协议层、扩展层和应用层。其中，协议层又可以分为存储层和网络层，它们相互独立但又不可分割。 数据存储层中存储了什么？ 首先了解下区块链的数据存储层，什么是区块链数据存储层？它存储了什么？它需要存储哪些数据才能保障区块链系统正常工作？ ﻿ ﻿ 比如Alice向Bob转账10美元。从上图可以看出，可以通过向区块链中加入一笔交易来改变区块链当前的状态。 在跟踪不同用户（状态）的账户余额和其他相关的细节的同时，也要跟踪不同用户通过区块链（交易）所引起的区块链状态转变的细节。 不同的区块链，比如比特币和以太坊，实现上述功能所使用的方法是不同的。 1、比特币的“状态” 比特币的“状态”由其全网络未使用的交易输出UTXO（Unspent Transaction Output）来表示。 比特币的价值转移是通过交易来实现的。更具体地说，比特币用户可以通过创建一笔交易并将其一个或多个UTXO添加为交易的输入来花掉这一个或多个UTXO。 比特币的UTXO模型，是其区别于以太坊的主要特征，为更好地理解二者之间的差异，先来看一些例子。 首先，比特币中的UTXO不能只花费一部分，必须全部花完。 如果一个比特币用户要花费0.5个比特币，而他只有一个价值1比特币的UTXO，那么在交易时他必须将自己的比特币地址也加入到交易的输出中，即发给自己0.5个比特币作为找零。 如果他不给自己发送找零，他将失去这0.5个比特币，这0.5个比特币将会被当作交易费付给挖出此区块的矿工。 ﻿ UTXO交易 其次，从本质上讲，比特币的区块链并不会存储和更新用户的账户余额。在比特币网络中，用户只需持有一个或多个 UTXO 的私钥。 数字钱包的使用使得比特币的区块链看起来像是在自动存储和更新用户的帐户余额，但其实并不是这样。 ﻿ ﻿图解比特币钱包工作过程 比特币的 UTXO 模型运行良好，一部分原因是数字钱包能够执行与交易相关的大多数任务，包括但不局限于： 处理 UTXO 存储密钥 设定交易费用 提供交易找零地址 汇总 UTXO（显示可用的、交易进行中的和总余额） 如何来描述 UTXO 模型中的交易行为？钞票是一个绝佳的类比。 用户通过将钱包（类比比特币地址或者数字钱包）中的钞票（类比 UTXO）相加来计算自己的资金，想要花钱时，就使用一张或者多张钞票。 每张钞票只能使用一次，因为一旦花费，它就不属于你了。 因此，可以得出这样的结论： 比特币区块链并不存储和更新账户余额 比特币钱包持有UTXO对应的私钥 如果UTXO包含在交易中，那么它会被全部花完（在 UTXO 大于支出金额时，会收到一个全新 UTXO 的“找零”） 2、以太坊的“状态” 与上述比特币的区块链不同，以太坊区块链中的状态能够存储和更新用户的账户余额等信息。 以太坊的状态不是一个抽象的概念，它是以太坊底层协议的一部分。 正如以太坊黄皮书所提到的，以太坊是一个基于交易的“状态机”，是一个可以构建所有基于交易的“状态机”的技术。 与所有其他区块链一样，以太坊的区块链由创世区块开始延伸。 从创世区块开始，诸如交易，部署智能合约和挖矿等行为将不断改变以太坊区块链的状态。在以太坊中，每当有与该帐户相关的交易发生时，帐户余额（存储在状态字典树中）就会发生变化。 帐户余额等数据并不直接存储在以太坊区块链的区块中， 只有交易字典树、状态字典树和收款字典树的根节点哈希直接存储在区块链中。如下图： ﻿ 存储字典树（保存所有智能合约数据的地方）的根节点哈希实际上指向状态字典树，而状态字典树又指向区块链。 以太坊中存储着两种截然不同的数据：永久数据和临时数据。 交易信息为永久数据，一笔交易在得到完全确认后，将被记录在交易字典树中，它永远不会改变；账户余额则为临时数据，地址对应的账户余额存储在状态字典树中，并且每当出现与该指定帐户相关的交易时账户余额就会更改。 因此，永久数据和临时数据应单独、分别存储，以太坊使用字典树的数据结构来管理数据。 以太坊的记录保存机制与银行一样，一个类比就是使用ATM /借记卡。 银行跟踪每张借记卡的余额，当用户需要花钱时，银行会检查交易记录，以判断用户是否有足够的余额来进行交易。 3、比特币 UTXO 模型与以太坊账户/余额模型的比较 比特币 UTXO 模型的优点： 可扩展性：由于可以同时处理多个 UTXO，因此可以实现并行交易并可促进在可扩展性上的创新。 隐私保护：即使比特币不是一个完全匿名的系统，但只要用户每笔交易都使用新地址，UTXO 模型就能提供更高级别的隐私保护。如果需要增强隐私保护，可以考虑使用更复杂的方案，例如环签名。 以太坊账户/余额模型的优点： 简单性：以太坊选择了更简单直观的模型，便于开发人员实现复杂的智能合约，特别是那些需要以太坊网络状态信息或涉及多个参与方的智能合约。比如基于以太坊网络的不同状态执行不同任务的智能合约，若使用 UTXO 的无状态模型，需要强制在每笔交易中加入状态信息，这会使智能合约的设计复杂化。 高效性：除了简单性之外，以太坊账户/余额模型更加高效，因为每笔交易只需要验证发送方账户是否有足够的余额来支付交易。 为防止以太坊账户/余额模型遭到双重支付攻击，可以用一个递增的随机数来防范这种类型的攻击。 在以太坊中，每个帐户都有一个公共可见的随机数，每次进行交易时，这个随机数增加1，这种机制可以防止同一笔交易被多次提交。 这个随机数与以太坊工作量证明的随机数不同，后者是一个挖矿过程的随机值 在计算机体系架构中，有时需要在不同模型之间进行折衷。一些区块链技术，比如 Hyperledger，就采用了 UTXO 机制，因为这样可以从比特币区块链所衍生的创新中受益。 接下来简要分析更多基于这两种记录保存模型构建的技术。 以太坊字典树数据结构 以太坊字典树数据结构主要包括状态字典树、存储字典树和交易字典树。 1、状态字典树——独一无二的存在 在以太坊网络中有一个唯一的全网络状态字典树。 这个全网络状态字典树不断在更新。 这个全网络状态字典树中包含以太坊网络中每个账户所对应的键值对（key and value pair）。 全网络状态字典树中的“键”是一个的160位标识符（以太坊帐户的地址）。 全网络状态字典树中的“值”是通过对以太坊账户的以下详细信息进行编码（使用递归长度字典编码（Recursive-Length Prefix encoding，RLP）方法）生成的： Nonce：一个公共可见的随机数。如果帐户是一个外部帐户，这个数字代表从帐户地址发送的交易数量；如果帐户是一个合约帐户，Nonce 是帐户创建的合约数量。 balance：这个地址拥有的 Wei（以太坊货币单位）数量，每个以太币有1e+18 Wei。 storageRoot ：一个Merkle Patricia 树根节点的哈希，它对帐户的存储内容的哈希值进行编码，并默认为空。 codeHash：EVM（以太坊虚拟机）的哈希值代码。 对于合约帐户，这是一个被哈希计算后并存储为codeHash的代码；对于外部帐户，codeHash字段是空字符串的哈希值。 状态字典树的根节点（在给定时间点整个状态字典树的哈希值）被用作状态字典树的安全且唯一的标识符；状态字典树的根节点在密码学上取决于状态字典树所有内部的数据。 ﻿ ﻿状态字典树（Merkle Patricia 字典树的levelDB实现）和以太坊区块之间的关系 ﻿﻿ 状态字典树：在给定的区块中，状态字典树根节点的 Keccak-256位哈希值被存储为“stateRoot”值 stateRoot: ‘0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976’ 2、存储字典树——存储智能合约数据的地方 存储字典树存储所有智能合约数据，每个以太坊帐户都有自己的存储字典树。存储字典树根节点的256位哈希值作为“storageRoot”值存储在全局状态字典树中。 ﻿ ﻿ 3、交易字典树——每个区块一个 每个以太坊区块都有自己独立的交易字典树。 一个区块中包含许多交易，区块中交易的顺序由挖出该区块的矿工决定。 交易字典树中到特定交易的路径经RLP编码后得到交易在区块中的索引。 由于区块链的防篡改性，已经被挖出的区块不会再改变，所以区块中交易的位置永远不会改变。 一旦在区块的交易字典树中找到这笔交易，即使你反复返回相同的路径，检索的结果也是相同的。 ﻿ ﻿ 以太坊字典树实例分析 主流的以太坊客户端使用两种不同的数据库软件解决方案来存储字典树。以太坊的 Rust 语言客户端 Parity 使用 rocksDB 数据库，而以太坊的 Go 语言，C ++ 语言和 Python 语言客户端都使用 levelDB 数据库。 本文中，主要带你了解 levelDB 数据库。 以太坊和 levelDB 数据库 LevelDB 是一个开源的谷歌键值存储程序库，除了常规功能外，它还提供对数据的前向和后向迭代，从字符串键到字符串值的有序映射，自定义比较函数和自动压缩。 自动压缩功能使用开源 Google 压缩/解压缩程序库 “Snappy”。Snappy 程序库的设计目标并不是追求最大压缩率，而是追求非常高的压缩速度。 LevelDB 数据库是一种重要的存储和检索机制，用于管理以太坊网络的状态。因此，levelDB 是主流以太坊客户端（节点），比如 go-ethereum，cpp-ethereum 和 pyethereum 的底层数据库。 虽然可以在磁盘上完成字典树数据结构的实现（使用诸如 levelDB 之类的数据库软件），但重要的是要注意遍历字典树和简单地查看键/值数据库之间存在的差异。 为了更详细说明这些差异，可以使用 Patricia 字典树的程序库来访问数据库levelDB 中的数据。 在以太坊客户端上，执行交易、部署智能合约和挖矿等网络操作，并观察它们如何影响以太坊的“状态”。 分析以太坊数据库 以太坊区块链中每个区块都包含许多 Merkle Patricia 字典树： 状态字典树 存储字典树 交易字典树 收款字典树 要在特定区块中引用特定的 Merkle Patricia 字典树，需要获取其根节点哈希值作为索引。 使用以下命令，获取创世区块中状态字典树、交易字典树和收款字典树的根节点哈希值： 1web3.eth.getBlock(0).stateRoot2web3.eth.getBlock(0).transactionsRoot3web3.eth.getBlock(0).receiptsRoot ﻿ ﻿ 如果想得到最新挖出区块的根节点哈希（而不是创世区块），使用以下命令： 1web3.eth.getBlock(web3.eth.blockNumber).stateRoot 获取根节点哈希值之后，需要配置网络环境。 1、安装npm、Node、Level 和 EthereumJS 使用 Node.js，Level 和 EthereumJS（使用 JavaScript 语言编写的以太坊虚拟机）三个程序来进行 levelDB 数据库的实验。 通过以下命令配置实验环境。 1cd&nbsp;~ 2 3sudo&nbsp;apt-get&nbsp;update 4 5sudo&nbsp;apt-get&nbsp;upgrade 6 7curl&nbsp;-sL&nbsp;https://deb.nodesource.com/setup_9.x&nbsp;|&nbsp;sudo&nbsp;-E&nbsp;bash&nbsp;-&nbsp;sudo&nbsp;apt-get&nbsp;install&nbsp;-y&nbsp;nodejs 8 9sudo&nbsp;apt-get&nbsp;install&nbsp;nodejs1011npm&nbsp;-v1213nodejs&nbsp;-v1415npm&nbsp;install&nbsp;levelup&nbsp;leveldown&nbsp;rlp&nbsp;merkle-patricia-tree&nbsp;--save1617git&nbsp;clone&nbsp;https://github.com/ethereumjs/ethereumjs-vm.git1819cd&nbsp;ethereumjs-vm2021npm&nbsp;install&nbsp;ethereumjs-account&nbsp;ethereumjs-util&nbsp;–save 实验环境配置完毕后，运行以下代码将打印出一个以太坊帐户和对应密钥的列表（存储在以太坊专用网络的状态根目录中），连接以太坊的 levelDB 数据库，进入以太坊专用网络的状态（使用区块链中区块的 stateRoot 值），然后访问以太坊专用网络上所有帐户的密钥。 1//Just&nbsp;importing&nbsp;the&nbsp;requirements 2 3var&nbsp;Trie&nbsp;=&nbsp;require(&#39;merkle-patricia-tree/secure&#39;); 4 5var&nbsp;levelup&nbsp;=&nbsp;require(&#39;levelup&#39;); 6 7var&nbsp;leveldown&nbsp;=&nbsp;require(&#39;leveldown&#39;); 8 9var&nbsp;RLP&nbsp;=&nbsp;require(&#39;rlp&#39;);1011var&nbsp;assert&nbsp;=&nbsp;require(&#39;assert&#39;);121314//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database1516var&nbsp;db&nbsp;=&nbsp;levelup(leveldown(&#39;/home/timothymccallum/gethDataDir/geth/chaindata&#39;));171819//Adding&nbsp;the&nbsp;&quot;stateRoot&quot;&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.2021var&nbsp;root&nbsp;=&nbsp;&#39;0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976&#39;;222324//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library2526var&nbsp;trie&nbsp;=&nbsp;new&nbsp;Trie(db,&nbsp;root);272829//Creating&nbsp;a&nbsp;nodejs&nbsp;stream&nbsp;object&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;access&nbsp;the&nbsp;data3031var&nbsp;stream&nbsp;=&nbsp;trie.createReadStream()323334//Turning&nbsp;on&nbsp;the&nbsp;stream&nbsp;(because&nbsp;the&nbsp;node&nbsp;js&nbsp;stream&nbsp;is&nbsp;set&nbsp;to&nbsp;pause&nbsp;by&nbsp;default)3536stream.on(&#39;data&#39;,&nbsp;function&nbsp;(data){3738&nbsp;&nbsp;//printing&nbsp;out&nbsp;the&nbsp;keys&nbsp;of&nbsp;the&nbsp;&quot;state&nbsp;trie&quot;3940&nbsp;&nbsp;console.log(data.key);4142}); ﻿ ﻿以上代码的输出 以太坊网络中的账户只有在交易（与该特定账户相关的交易）发生时才会被加入到状态字典树中。 例如，仅使用命令 “geth account new” 创建的新帐户将不会被加入到状态字典树中；如果一笔成功的交易（一笔消耗了以太坊燃料并被加入到已挖出的区块中的交易）与这个账户产生关联，那么这时该账户才会出现在状态字典树里。 这可以防止恶意攻击者不断创建新帐户，从而维持状态字典树的正常数据量。 2、解码数据 以太坊在与 levelDB 数据库交互时使用了“改进的 Merkle Patricia 字典树（Modified Merkle Patricia Trie）”，扩展了字典树数据结构。 例如，改进的 Merkle Patricia 包含一种方法，该方法可以通过使用“扩展”节点来实现快速遍历。 在以太坊中，一个改进的的 Merkle Patricia trie 节点可以是： 一个空字符串（NULL） 一个包含17个项目的数组（分支） 一个包含2个项目的数组（叶节点） 一个包含2个项目的数组（扩展名） 由于以太坊的字典树是根据严格的规则进行设计和构建的，因此检查它们的最佳方法是使用计算机代码进行测试。 以下示例使用了 EthereumJS，当提供特定区块的 stateRoot 以及以太坊帐户地址时，运行下面代码返回该帐户的余额。 ﻿﻿以下代码的输出（以太坊地址0xccc6b46fa5606826ce8c18fece6f519064e6130b的帐户余额） 1//Mozilla&nbsp;Public&nbsp;License&nbsp;2.0&nbsp; 2 3//As&nbsp;per&nbsp;https://github.com/ethereumjs/ethereumjs-vm/blob/master/LICENSE 4 5//Requires&nbsp;the&nbsp;following&nbsp;packages&nbsp;to&nbsp;run&nbsp;as&nbsp;nodejs&nbsp;file&nbsp;https://gist.github.com/tpmccallum/0e58fc4ba9061a2e634b7a877e60143a 6 7 8//Getting&nbsp;the&nbsp;requirements 910var&nbsp;Trie&nbsp;=&nbsp;require(&#39;merkle-patricia-tree/secure&#39;);1112var&nbsp;levelup&nbsp;=&nbsp;require(&#39;levelup&#39;);1314var&nbsp;leveldown&nbsp;=&nbsp;require(&#39;leveldown&#39;);1516var&nbsp;utils&nbsp;=&nbsp;require(&#39;ethereumjs-util&#39;);1718var&nbsp;BN&nbsp;=&nbsp;utils.BN;1920var&nbsp;Account&nbsp;=&nbsp;require(&#39;ethereumjs-account&#39;);212223//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database2425var&nbsp;db&nbsp;=&nbsp;levelup(leveldown(&#39;/home/timothymccallum/gethDataDir/geth/chaindata&#39;));262728//Adding&nbsp;the&nbsp;&quot;stateRoot&quot;&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.2930var&nbsp;root&nbsp;=&nbsp;&#39;0x9369577baeb7c4e971ebe76f5d5daddba44c2aa42193248245cf686d20a73028&#39;;313233//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library3435var&nbsp;trie&nbsp;=&nbsp;new&nbsp;Trie(db,&nbsp;root);363738var&nbsp;address&nbsp;=&nbsp;&#39;0xccc6b46fa5606826ce8c18fece6f519064e6130b&#39;;3940trie.get(address,&nbsp;function&nbsp;(err,&nbsp;raw)&nbsp;{4142&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(err)&nbsp;return&nbsp;cb(err)4344&nbsp;&nbsp;&nbsp;&nbsp;//Using&nbsp;ethereumjs-account&nbsp;to&nbsp;create&nbsp;an&nbsp;instance&nbsp;of&nbsp;an&nbsp;account4546&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;account&nbsp;=&nbsp;new&nbsp;Account(raw)4748&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Account&nbsp;Address:&nbsp;&#39;&nbsp;+&nbsp;address);4950&nbsp;&nbsp;&nbsp;&nbsp;//Using&nbsp;ethereumjs-util&nbsp;to&nbsp;decode&nbsp;and&nbsp;present&nbsp;the&nbsp;account&nbsp;balance&nbsp;5152&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Balance:&nbsp;&#39;&nbsp;+&nbsp;(new&nbsp;BN(account.balance)).toString());5354}) 独特的设计带来了哪些优点？ 1、移动性 如今移动设备和物联网（IoT）设备无处不在，而电子商务的未来建立在安全、强大和快速的移动应用上。 ﻿ ﻿ 可以说区块链在移动性上取得了巨大进步，但我们也必须承认区块链大小的不断增加是不可避免的。因此在日常移动设备上存储整个区块链是不切实际的。 2、速度快，不会影响安全性 以太坊网络状态的设计及其对改进的 Merkle Patricia 字典树的使用为其应用提供了更多的可能性。 在以太坊中字典树上执行的每个操作（添加、更新或删除）都使用了确定性的密码学哈希值。 此外，字典树根节点的密码学哈希值可以用作字典树未被篡改的证据。例如，对字典树数据的任何更改（例如增加 levelDB 数据库中的帐户余额）都将完全改变根节点哈希值。 这种密码学特性为轻客户端（不存储整个区块链的设备）带来了快速、可靠查询的可能性，比如查询账户 “0x ... 4857” 在区块高度为 “5044866” 的区块上是否有足够的资金完成此次交易等？ “Merkle 证明的空间复杂度与存储数据量呈对数关系。这意味着，即使整个状态字典树的大小为几千兆字节，如果一个节点从受信任的源接收一个状态，该节点只需下载一个几千字节的证明数据就能够完全确定该字典树上任何信息的有效性。” 3、额度限制 在以太坊白皮书中，有一个关于活期储蓄账户的概念。在这种情景下，两个用户（可能是丈夫和妻子，或着商业伙伴之间）每人每天最多只能提取帐户总余额的1%。 虽然这个想法仅仅在白皮书中“进一步发展方向”的部分中被提到，但无疑它会引起人们广泛的兴趣，因为理论上它可以作为以太坊底层协议的一部分（而不是被当作为第二层协议或者是第三方钱包的一部分）。 UTXO对区块链数据是不可见的，实际上比特币区块链并不存储用户的账户余额。因此，比特币的底层协议不太可能实现任何类型的每日额度限制。 4、消费者信心 相信随着区块链开发者的不断努力，我们会目睹轻量级客户端的快速发展，目睹可以与区块链技术交互的安全、强大和快速的移动应用程序的大规模落地。 ﻿ ﻿ 在电子商务领域想要实现区块链技术的落地必须提高速度、安全性和可用性。通过巧妙的设计提供优异的可用性，安全性和性能，这将提高消费者信心同时增加大众的采用率。 数据的存储机制也是当下区块链应用落地面临的一大问题，它决定了区块链的运行效率。 只有解决有关区块链应用落地的痛点，区块链才能真正走进人们的生活，给人们带来便利！ 看到这里，相信你对以太坊的数据存储机制已有了深入的了解。 如果你有关于以太坊数据存储、去中心化应用落地等方面的独特看法，记得及时留言给本营小姐姐哈！留言之前，记得点赞呦！ 古语说得好，“用心点赞，手有余香”~ 原文链接： https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033 内容转载请联系微信： qk15732632926（备注：微信公众号+转载） 商务合作请联系微信： fengyan-1101（备注：区块链大本营+商务合作） 最新热文： 现实版好莱坞, 门头沟事件受害者3年死磕查到真凶! 超燃黑客落网事件始末 长文 | 深度解析Solidity让老司机翻车的17个坑及超详细避坑指南，建议先马后看（附送独家资源） V神正在密切关注！这55行状态通道代码，带你快速扩展以太坊生态 10岁小表妹也能“吃透”Geth 客户端 ！360秒，快速部署 ICO Token 大力戳↑↑↑ &nbsp;加入区块链大本营读者⑦号群 （群满加微信 qk15732632926 入群） 了解更多区块链技术及应用内容 敬请关注： 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/14/b72c1c404b25eff78f4f8ca9c577740f.html" />
<meta property="og:url" content="https://mlh.app/2018/08/14/b72c1c404b25eff78f4f8ca9c577740f.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-14T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"作者 | Vasa&nbsp; 企业家、TowardsBlockChain&nbsp;联合创始人 编译 | kou、Guoxi 在当下数据爆炸的信息时代，凭借区块链去中心化、点对点和防篡改的特性，“区块链+大数据”已成为研究的热门，可以说，区块链与大数据的结合为今后区块链应用的大规模落地奠定了基础。 那么，区块链中的数据如何存储？不同区块链数据存储机制有何异同？以以太坊为例，在本文中，MIT 孵化初创公司 TowardsBlockChain 联合创始人 vasa 详细阐述了以太坊的数据存储机制、以太坊如何存储区块链状态与交易以及以太坊和比特币在存储机制上的异同。 此外，本文将带你深入了解 “Patricia 字典树”数据结构背后的理论基础，并通过使用 Google 的 levelDB 数据库演示以太坊字典树的具体实现。 字字行文皆重点，行行代码皆干货，请往下看！ 从架构设计上来说，区块链可以简单的分为三个层次，协议层、扩展层和应用层。其中，协议层又可以分为存储层和网络层，它们相互独立但又不可分割。 数据存储层中存储了什么？ 首先了解下区块链的数据存储层，什么是区块链数据存储层？它存储了什么？它需要存储哪些数据才能保障区块链系统正常工作？ ﻿ ﻿ 比如Alice向Bob转账10美元。从上图可以看出，可以通过向区块链中加入一笔交易来改变区块链当前的状态。 在跟踪不同用户（状态）的账户余额和其他相关的细节的同时，也要跟踪不同用户通过区块链（交易）所引起的区块链状态转变的细节。 不同的区块链，比如比特币和以太坊，实现上述功能所使用的方法是不同的。 1、比特币的“状态” 比特币的“状态”由其全网络未使用的交易输出UTXO（Unspent Transaction Output）来表示。 比特币的价值转移是通过交易来实现的。更具体地说，比特币用户可以通过创建一笔交易并将其一个或多个UTXO添加为交易的输入来花掉这一个或多个UTXO。 比特币的UTXO模型，是其区别于以太坊的主要特征，为更好地理解二者之间的差异，先来看一些例子。 首先，比特币中的UTXO不能只花费一部分，必须全部花完。 如果一个比特币用户要花费0.5个比特币，而他只有一个价值1比特币的UTXO，那么在交易时他必须将自己的比特币地址也加入到交易的输出中，即发给自己0.5个比特币作为找零。 如果他不给自己发送找零，他将失去这0.5个比特币，这0.5个比特币将会被当作交易费付给挖出此区块的矿工。 ﻿ UTXO交易 其次，从本质上讲，比特币的区块链并不会存储和更新用户的账户余额。在比特币网络中，用户只需持有一个或多个 UTXO 的私钥。 数字钱包的使用使得比特币的区块链看起来像是在自动存储和更新用户的帐户余额，但其实并不是这样。 ﻿ ﻿图解比特币钱包工作过程 比特币的 UTXO 模型运行良好，一部分原因是数字钱包能够执行与交易相关的大多数任务，包括但不局限于： 处理 UTXO 存储密钥 设定交易费用 提供交易找零地址 汇总 UTXO（显示可用的、交易进行中的和总余额） 如何来描述 UTXO 模型中的交易行为？钞票是一个绝佳的类比。 用户通过将钱包（类比比特币地址或者数字钱包）中的钞票（类比 UTXO）相加来计算自己的资金，想要花钱时，就使用一张或者多张钞票。 每张钞票只能使用一次，因为一旦花费，它就不属于你了。 因此，可以得出这样的结论： 比特币区块链并不存储和更新账户余额 比特币钱包持有UTXO对应的私钥 如果UTXO包含在交易中，那么它会被全部花完（在 UTXO 大于支出金额时，会收到一个全新 UTXO 的“找零”） 2、以太坊的“状态” 与上述比特币的区块链不同，以太坊区块链中的状态能够存储和更新用户的账户余额等信息。 以太坊的状态不是一个抽象的概念，它是以太坊底层协议的一部分。 正如以太坊黄皮书所提到的，以太坊是一个基于交易的“状态机”，是一个可以构建所有基于交易的“状态机”的技术。 与所有其他区块链一样，以太坊的区块链由创世区块开始延伸。 从创世区块开始，诸如交易，部署智能合约和挖矿等行为将不断改变以太坊区块链的状态。在以太坊中，每当有与该帐户相关的交易发生时，帐户余额（存储在状态字典树中）就会发生变化。 帐户余额等数据并不直接存储在以太坊区块链的区块中， 只有交易字典树、状态字典树和收款字典树的根节点哈希直接存储在区块链中。如下图： ﻿ 存储字典树（保存所有智能合约数据的地方）的根节点哈希实际上指向状态字典树，而状态字典树又指向区块链。 以太坊中存储着两种截然不同的数据：永久数据和临时数据。 交易信息为永久数据，一笔交易在得到完全确认后，将被记录在交易字典树中，它永远不会改变；账户余额则为临时数据，地址对应的账户余额存储在状态字典树中，并且每当出现与该指定帐户相关的交易时账户余额就会更改。 因此，永久数据和临时数据应单独、分别存储，以太坊使用字典树的数据结构来管理数据。 以太坊的记录保存机制与银行一样，一个类比就是使用ATM /借记卡。 银行跟踪每张借记卡的余额，当用户需要花钱时，银行会检查交易记录，以判断用户是否有足够的余额来进行交易。 3、比特币 UTXO 模型与以太坊账户/余额模型的比较 比特币 UTXO 模型的优点： 可扩展性：由于可以同时处理多个 UTXO，因此可以实现并行交易并可促进在可扩展性上的创新。 隐私保护：即使比特币不是一个完全匿名的系统，但只要用户每笔交易都使用新地址，UTXO 模型就能提供更高级别的隐私保护。如果需要增强隐私保护，可以考虑使用更复杂的方案，例如环签名。 以太坊账户/余额模型的优点： 简单性：以太坊选择了更简单直观的模型，便于开发人员实现复杂的智能合约，特别是那些需要以太坊网络状态信息或涉及多个参与方的智能合约。比如基于以太坊网络的不同状态执行不同任务的智能合约，若使用 UTXO 的无状态模型，需要强制在每笔交易中加入状态信息，这会使智能合约的设计复杂化。 高效性：除了简单性之外，以太坊账户/余额模型更加高效，因为每笔交易只需要验证发送方账户是否有足够的余额来支付交易。 为防止以太坊账户/余额模型遭到双重支付攻击，可以用一个递增的随机数来防范这种类型的攻击。 在以太坊中，每个帐户都有一个公共可见的随机数，每次进行交易时，这个随机数增加1，这种机制可以防止同一笔交易被多次提交。 这个随机数与以太坊工作量证明的随机数不同，后者是一个挖矿过程的随机值 在计算机体系架构中，有时需要在不同模型之间进行折衷。一些区块链技术，比如 Hyperledger，就采用了 UTXO 机制，因为这样可以从比特币区块链所衍生的创新中受益。 接下来简要分析更多基于这两种记录保存模型构建的技术。 以太坊字典树数据结构 以太坊字典树数据结构主要包括状态字典树、存储字典树和交易字典树。 1、状态字典树——独一无二的存在 在以太坊网络中有一个唯一的全网络状态字典树。 这个全网络状态字典树不断在更新。 这个全网络状态字典树中包含以太坊网络中每个账户所对应的键值对（key and value pair）。 全网络状态字典树中的“键”是一个的160位标识符（以太坊帐户的地址）。 全网络状态字典树中的“值”是通过对以太坊账户的以下详细信息进行编码（使用递归长度字典编码（Recursive-Length Prefix encoding，RLP）方法）生成的： Nonce：一个公共可见的随机数。如果帐户是一个外部帐户，这个数字代表从帐户地址发送的交易数量；如果帐户是一个合约帐户，Nonce 是帐户创建的合约数量。 balance：这个地址拥有的 Wei（以太坊货币单位）数量，每个以太币有1e+18 Wei。 storageRoot ：一个Merkle Patricia 树根节点的哈希，它对帐户的存储内容的哈希值进行编码，并默认为空。 codeHash：EVM（以太坊虚拟机）的哈希值代码。 对于合约帐户，这是一个被哈希计算后并存储为codeHash的代码；对于外部帐户，codeHash字段是空字符串的哈希值。 状态字典树的根节点（在给定时间点整个状态字典树的哈希值）被用作状态字典树的安全且唯一的标识符；状态字典树的根节点在密码学上取决于状态字典树所有内部的数据。 ﻿ ﻿状态字典树（Merkle Patricia 字典树的levelDB实现）和以太坊区块之间的关系 ﻿﻿ 状态字典树：在给定的区块中，状态字典树根节点的 Keccak-256位哈希值被存储为“stateRoot”值 stateRoot: ‘0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976’ 2、存储字典树——存储智能合约数据的地方 存储字典树存储所有智能合约数据，每个以太坊帐户都有自己的存储字典树。存储字典树根节点的256位哈希值作为“storageRoot”值存储在全局状态字典树中。 ﻿ ﻿ 3、交易字典树——每个区块一个 每个以太坊区块都有自己独立的交易字典树。 一个区块中包含许多交易，区块中交易的顺序由挖出该区块的矿工决定。 交易字典树中到特定交易的路径经RLP编码后得到交易在区块中的索引。 由于区块链的防篡改性，已经被挖出的区块不会再改变，所以区块中交易的位置永远不会改变。 一旦在区块的交易字典树中找到这笔交易，即使你反复返回相同的路径，检索的结果也是相同的。 ﻿ ﻿ 以太坊字典树实例分析 主流的以太坊客户端使用两种不同的数据库软件解决方案来存储字典树。以太坊的 Rust 语言客户端 Parity 使用 rocksDB 数据库，而以太坊的 Go 语言，C ++ 语言和 Python 语言客户端都使用 levelDB 数据库。 本文中，主要带你了解 levelDB 数据库。 以太坊和 levelDB 数据库 LevelDB 是一个开源的谷歌键值存储程序库，除了常规功能外，它还提供对数据的前向和后向迭代，从字符串键到字符串值的有序映射，自定义比较函数和自动压缩。 自动压缩功能使用开源 Google 压缩/解压缩程序库 “Snappy”。Snappy 程序库的设计目标并不是追求最大压缩率，而是追求非常高的压缩速度。 LevelDB 数据库是一种重要的存储和检索机制，用于管理以太坊网络的状态。因此，levelDB 是主流以太坊客户端（节点），比如 go-ethereum，cpp-ethereum 和 pyethereum 的底层数据库。 虽然可以在磁盘上完成字典树数据结构的实现（使用诸如 levelDB 之类的数据库软件），但重要的是要注意遍历字典树和简单地查看键/值数据库之间存在的差异。 为了更详细说明这些差异，可以使用 Patricia 字典树的程序库来访问数据库levelDB 中的数据。 在以太坊客户端上，执行交易、部署智能合约和挖矿等网络操作，并观察它们如何影响以太坊的“状态”。 分析以太坊数据库 以太坊区块链中每个区块都包含许多 Merkle Patricia 字典树： 状态字典树 存储字典树 交易字典树 收款字典树 要在特定区块中引用特定的 Merkle Patricia 字典树，需要获取其根节点哈希值作为索引。 使用以下命令，获取创世区块中状态字典树、交易字典树和收款字典树的根节点哈希值： 1web3.eth.getBlock(0).stateRoot2web3.eth.getBlock(0).transactionsRoot3web3.eth.getBlock(0).receiptsRoot ﻿ ﻿ 如果想得到最新挖出区块的根节点哈希（而不是创世区块），使用以下命令： 1web3.eth.getBlock(web3.eth.blockNumber).stateRoot 获取根节点哈希值之后，需要配置网络环境。 1、安装npm、Node、Level 和 EthereumJS 使用 Node.js，Level 和 EthereumJS（使用 JavaScript 语言编写的以太坊虚拟机）三个程序来进行 levelDB 数据库的实验。 通过以下命令配置实验环境。 1cd&nbsp;~ 2 3sudo&nbsp;apt-get&nbsp;update 4 5sudo&nbsp;apt-get&nbsp;upgrade 6 7curl&nbsp;-sL&nbsp;https://deb.nodesource.com/setup_9.x&nbsp;|&nbsp;sudo&nbsp;-E&nbsp;bash&nbsp;-&nbsp;sudo&nbsp;apt-get&nbsp;install&nbsp;-y&nbsp;nodejs 8 9sudo&nbsp;apt-get&nbsp;install&nbsp;nodejs1011npm&nbsp;-v1213nodejs&nbsp;-v1415npm&nbsp;install&nbsp;levelup&nbsp;leveldown&nbsp;rlp&nbsp;merkle-patricia-tree&nbsp;--save1617git&nbsp;clone&nbsp;https://github.com/ethereumjs/ethereumjs-vm.git1819cd&nbsp;ethereumjs-vm2021npm&nbsp;install&nbsp;ethereumjs-account&nbsp;ethereumjs-util&nbsp;–save 实验环境配置完毕后，运行以下代码将打印出一个以太坊帐户和对应密钥的列表（存储在以太坊专用网络的状态根目录中），连接以太坊的 levelDB 数据库，进入以太坊专用网络的状态（使用区块链中区块的 stateRoot 值），然后访问以太坊专用网络上所有帐户的密钥。 1//Just&nbsp;importing&nbsp;the&nbsp;requirements 2 3var&nbsp;Trie&nbsp;=&nbsp;require(&#39;merkle-patricia-tree/secure&#39;); 4 5var&nbsp;levelup&nbsp;=&nbsp;require(&#39;levelup&#39;); 6 7var&nbsp;leveldown&nbsp;=&nbsp;require(&#39;leveldown&#39;); 8 9var&nbsp;RLP&nbsp;=&nbsp;require(&#39;rlp&#39;);1011var&nbsp;assert&nbsp;=&nbsp;require(&#39;assert&#39;);121314//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database1516var&nbsp;db&nbsp;=&nbsp;levelup(leveldown(&#39;/home/timothymccallum/gethDataDir/geth/chaindata&#39;));171819//Adding&nbsp;the&nbsp;&quot;stateRoot&quot;&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.2021var&nbsp;root&nbsp;=&nbsp;&#39;0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976&#39;;222324//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library2526var&nbsp;trie&nbsp;=&nbsp;new&nbsp;Trie(db,&nbsp;root);272829//Creating&nbsp;a&nbsp;nodejs&nbsp;stream&nbsp;object&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;access&nbsp;the&nbsp;data3031var&nbsp;stream&nbsp;=&nbsp;trie.createReadStream()323334//Turning&nbsp;on&nbsp;the&nbsp;stream&nbsp;(because&nbsp;the&nbsp;node&nbsp;js&nbsp;stream&nbsp;is&nbsp;set&nbsp;to&nbsp;pause&nbsp;by&nbsp;default)3536stream.on(&#39;data&#39;,&nbsp;function&nbsp;(data){3738&nbsp;&nbsp;//printing&nbsp;out&nbsp;the&nbsp;keys&nbsp;of&nbsp;the&nbsp;&quot;state&nbsp;trie&quot;3940&nbsp;&nbsp;console.log(data.key);4142}); ﻿ ﻿以上代码的输出 以太坊网络中的账户只有在交易（与该特定账户相关的交易）发生时才会被加入到状态字典树中。 例如，仅使用命令 “geth account new” 创建的新帐户将不会被加入到状态字典树中；如果一笔成功的交易（一笔消耗了以太坊燃料并被加入到已挖出的区块中的交易）与这个账户产生关联，那么这时该账户才会出现在状态字典树里。 这可以防止恶意攻击者不断创建新帐户，从而维持状态字典树的正常数据量。 2、解码数据 以太坊在与 levelDB 数据库交互时使用了“改进的 Merkle Patricia 字典树（Modified Merkle Patricia Trie）”，扩展了字典树数据结构。 例如，改进的 Merkle Patricia 包含一种方法，该方法可以通过使用“扩展”节点来实现快速遍历。 在以太坊中，一个改进的的 Merkle Patricia trie 节点可以是： 一个空字符串（NULL） 一个包含17个项目的数组（分支） 一个包含2个项目的数组（叶节点） 一个包含2个项目的数组（扩展名） 由于以太坊的字典树是根据严格的规则进行设计和构建的，因此检查它们的最佳方法是使用计算机代码进行测试。 以下示例使用了 EthereumJS，当提供特定区块的 stateRoot 以及以太坊帐户地址时，运行下面代码返回该帐户的余额。 ﻿﻿以下代码的输出（以太坊地址0xccc6b46fa5606826ce8c18fece6f519064e6130b的帐户余额） 1//Mozilla&nbsp;Public&nbsp;License&nbsp;2.0&nbsp; 2 3//As&nbsp;per&nbsp;https://github.com/ethereumjs/ethereumjs-vm/blob/master/LICENSE 4 5//Requires&nbsp;the&nbsp;following&nbsp;packages&nbsp;to&nbsp;run&nbsp;as&nbsp;nodejs&nbsp;file&nbsp;https://gist.github.com/tpmccallum/0e58fc4ba9061a2e634b7a877e60143a 6 7 8//Getting&nbsp;the&nbsp;requirements 910var&nbsp;Trie&nbsp;=&nbsp;require(&#39;merkle-patricia-tree/secure&#39;);1112var&nbsp;levelup&nbsp;=&nbsp;require(&#39;levelup&#39;);1314var&nbsp;leveldown&nbsp;=&nbsp;require(&#39;leveldown&#39;);1516var&nbsp;utils&nbsp;=&nbsp;require(&#39;ethereumjs-util&#39;);1718var&nbsp;BN&nbsp;=&nbsp;utils.BN;1920var&nbsp;Account&nbsp;=&nbsp;require(&#39;ethereumjs-account&#39;);212223//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database2425var&nbsp;db&nbsp;=&nbsp;levelup(leveldown(&#39;/home/timothymccallum/gethDataDir/geth/chaindata&#39;));262728//Adding&nbsp;the&nbsp;&quot;stateRoot&quot;&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.2930var&nbsp;root&nbsp;=&nbsp;&#39;0x9369577baeb7c4e971ebe76f5d5daddba44c2aa42193248245cf686d20a73028&#39;;313233//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library3435var&nbsp;trie&nbsp;=&nbsp;new&nbsp;Trie(db,&nbsp;root);363738var&nbsp;address&nbsp;=&nbsp;&#39;0xccc6b46fa5606826ce8c18fece6f519064e6130b&#39;;3940trie.get(address,&nbsp;function&nbsp;(err,&nbsp;raw)&nbsp;{4142&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(err)&nbsp;return&nbsp;cb(err)4344&nbsp;&nbsp;&nbsp;&nbsp;//Using&nbsp;ethereumjs-account&nbsp;to&nbsp;create&nbsp;an&nbsp;instance&nbsp;of&nbsp;an&nbsp;account4546&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;account&nbsp;=&nbsp;new&nbsp;Account(raw)4748&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Account&nbsp;Address:&nbsp;&#39;&nbsp;+&nbsp;address);4950&nbsp;&nbsp;&nbsp;&nbsp;//Using&nbsp;ethereumjs-util&nbsp;to&nbsp;decode&nbsp;and&nbsp;present&nbsp;the&nbsp;account&nbsp;balance&nbsp;5152&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Balance:&nbsp;&#39;&nbsp;+&nbsp;(new&nbsp;BN(account.balance)).toString());5354}) 独特的设计带来了哪些优点？ 1、移动性 如今移动设备和物联网（IoT）设备无处不在，而电子商务的未来建立在安全、强大和快速的移动应用上。 ﻿ ﻿ 可以说区块链在移动性上取得了巨大进步，但我们也必须承认区块链大小的不断增加是不可避免的。因此在日常移动设备上存储整个区块链是不切实际的。 2、速度快，不会影响安全性 以太坊网络状态的设计及其对改进的 Merkle Patricia 字典树的使用为其应用提供了更多的可能性。 在以太坊中字典树上执行的每个操作（添加、更新或删除）都使用了确定性的密码学哈希值。 此外，字典树根节点的密码学哈希值可以用作字典树未被篡改的证据。例如，对字典树数据的任何更改（例如增加 levelDB 数据库中的帐户余额）都将完全改变根节点哈希值。 这种密码学特性为轻客户端（不存储整个区块链的设备）带来了快速、可靠查询的可能性，比如查询账户 “0x ... 4857” 在区块高度为 “5044866” 的区块上是否有足够的资金完成此次交易等？ “Merkle 证明的空间复杂度与存储数据量呈对数关系。这意味着，即使整个状态字典树的大小为几千兆字节，如果一个节点从受信任的源接收一个状态，该节点只需下载一个几千字节的证明数据就能够完全确定该字典树上任何信息的有效性。” 3、额度限制 在以太坊白皮书中，有一个关于活期储蓄账户的概念。在这种情景下，两个用户（可能是丈夫和妻子，或着商业伙伴之间）每人每天最多只能提取帐户总余额的1%。 虽然这个想法仅仅在白皮书中“进一步发展方向”的部分中被提到，但无疑它会引起人们广泛的兴趣，因为理论上它可以作为以太坊底层协议的一部分（而不是被当作为第二层协议或者是第三方钱包的一部分）。 UTXO对区块链数据是不可见的，实际上比特币区块链并不存储用户的账户余额。因此，比特币的底层协议不太可能实现任何类型的每日额度限制。 4、消费者信心 相信随着区块链开发者的不断努力，我们会目睹轻量级客户端的快速发展，目睹可以与区块链技术交互的安全、强大和快速的移动应用程序的大规模落地。 ﻿ ﻿ 在电子商务领域想要实现区块链技术的落地必须提高速度、安全性和可用性。通过巧妙的设计提供优异的可用性，安全性和性能，这将提高消费者信心同时增加大众的采用率。 数据的存储机制也是当下区块链应用落地面临的一大问题，它决定了区块链的运行效率。 只有解决有关区块链应用落地的痛点，区块链才能真正走进人们的生活，给人们带来便利！ 看到这里，相信你对以太坊的数据存储机制已有了深入的了解。 如果你有关于以太坊数据存储、去中心化应用落地等方面的独特看法，记得及时留言给本营小姐姐哈！留言之前，记得点赞呦！ 古语说得好，“用心点赞，手有余香”~ 原文链接： https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033 内容转载请联系微信： qk15732632926（备注：微信公众号+转载） 商务合作请联系微信： fengyan-1101（备注：区块链大本营+商务合作） 最新热文： 现实版好莱坞, 门头沟事件受害者3年死磕查到真凶! 超燃黑客落网事件始末 长文 | 深度解析Solidity让老司机翻车的17个坑及超详细避坑指南，建议先马后看（附送独家资源） V神正在密切关注！这55行状态通道代码，带你快速扩展以太坊生态 10岁小表妹也能“吃透”Geth 客户端 ！360秒，快速部署 ICO Token 大力戳↑↑↑ &nbsp;加入区块链大本营读者⑦号群 （群满加微信 qk15732632926 入群） 了解更多区块链技术及应用内容 敬请关注： 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/14/b72c1c404b25eff78f4f8ca9c577740f.html","headline":"0.166666667小时，教会你深挖以太坊数据层","dateModified":"2018-08-14T00:00:00+08:00","datePublished":"2018-08-14T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/14/b72c1c404b25eff78f4f8ca9c577740f.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>0.166666667小时，教会你深挖以太坊数据层</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><img style="text-align:center;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dY1Eld3icDKsYIkQRT9FswXXB1ZH8wWmRquHT2hJJF2wQCxZgA93bUib4Q/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:15px;">作者 | Vasa&nbsp; 企业家、<span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.5px;text-align:justify;">TowardsBlockChain&nbsp;</span>联合创始人</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:15px;">编译 | kou、Guoxi</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:15px;"><br></span></p>
   <blockquote>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="letter-spacing:.5px;color:rgb(136,136,136);font-size:15px;">在当下数据爆炸的信息时代</span><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.5px;">，凭借区块链去中心化、点对点和防篡改的特性，“区块链+大数据”已成为研究的热门，可以说，区块链与大数据的结合为今后区块链应用的大规模落地奠定了基础。</span></em></p>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;"><br></span></em></p>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;">那么，区块链中的数据如何存储？不同区块链数据存储机制有何异同？以以太坊为例，在本文中，MIT 孵化初创公司 TowardsBlockChain 联合创始人 vasa 详细阐述了以太坊的数据存储机制、以太坊如何存储区块链状态与交易以及以太坊和比特币在存储机制上的异同。</span></em></p>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;"><br></span></em></p>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;">此外，本文将带你深入了解 “Patricia 字典树”数据结构背后的理论基础，并通过使用 Google 的 levelDB 数据库演示以太坊字典树的具体实现。</span></em></p>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;"><br></span></em></p>
    <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;">字字行文皆重点，行行代码皆干货，请往下看！</span></em></p>
   </blockquote>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="letter-spacing:.5px;font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">从架构设计上来说，区块链可以简单的分为三个层次，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">协议层、扩展层和应用层</span></strong><span style="font-size:15px;">。其中，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">协议层又可以分为存储层和网络层</span></strong><span style="font-size:15px;">，它们相互独立但又不可分割。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="color:rgb(0,122,170);font-size:18px;">数据存储层中存储了什么？</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">首先了解下区块链的数据存储层，什么是区块链数据存储层？它存储了什么？它需要存储哪些数据才能保障区块链系统正常工作？</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:center;">﻿</span><span style="font-size:15px;text-align:center;margin-left:2px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kqogbEdkVX1c1IQunam9dY7TGqFeNPPSpGEozRortJHXpiauicianf9lxRnicuxqF0J60fLeefe1MweA/640?wx_fmt=png" alt="640?wx_fmt=png"></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:justify;">比如Alice向Bob转账10美元。从上图可以看出，</span><span style="font-size:15px;text-align:justify;color:rgb(0,122,170);"><strong>可以通过向区块链中加入一笔交易来改变区块链当前的状态</strong></span><span style="font-size:15px;text-align:justify;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在跟踪不同用户（状态）的</span><strong><span style="font-size:15px;color:rgb(0,122,170);">账户余额</span></strong><span style="font-size:15px;">和其他相关的细节的同时，也要跟踪不同用户通过区块链（交易）所引起的区块链</span><strong><span style="font-size:15px;color:rgb(0,122,170);">状态转变</span></strong><span style="font-size:15px;">的细节。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">不同的区块链，比如比特币和以太坊，实现上述功能所使用的方法是不同的。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">1、比特币的“状态”</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">比特币的“状态”由其全网络未使用的交易输出UTXO（Unspent Transaction Output）来表示。</span><span style="font-size:15px;color:rgb(0,122,170);"> <strong>比特币的价值转移是通过交易来实现的</strong></span><span style="font-size:15px;">。更具体地说，比特币用户可以通过创建一笔交易并将其一个或多个UTXO添加为交易的输入来花掉这一个或多个UTXO。 </span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币的UTXO模型，是其区别于以太坊的主要特征</span></strong><span style="font-size:15px;">，为更好地理解二者之间的差异，先来看一些例子。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">首先，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币中的UTXO不能只花费一部分，必须全部花完</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">如果一个比特币用户要花费0.5个比特币，而他只有一个价值1比特币的UTXO，那么在交易时他必须将自己的比特币地址也加入到交易的输出中，即</span><strong><span style="font-size:15px;color:rgb(0,122,170);">发给自己0.5个比特币作为找零</span></strong><span style="font-size:15px;">。 </span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">如果他不给自己发送找零，他将失去这0.5个比特币</span></strong><span style="font-size:15px;">，这0.5个比特币将会被当作交易费付给挖出此区块的矿工。</span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kqogbEdkVX1c1IQunam9dYXeojRNscHI8ibiaib8rk9IBdMINYVo1sMhp0ryxczQqRPfPxDjpOfc5gQ/640?wx_fmt=png" alt="640?wx_fmt=png"></span></span></p>
   <p style="text-align:center;line-height:normal;margin-left:8px;letter-spacing:.5px;"><span style="color:rgb(136,136,136);"><em><span style="text-align:justify;font-size:12px;">UTXO交易</span></em></span><br></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">其次，从本质上讲，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币的区块链并不会存储和更新用户的账户余额</span></strong><span style="font-size:15px;">。在比特币网络中，用户只需持有一个或多个 UTXO 的私钥。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">数字钱包的使用使得比特币的区块链看起来像是在自动存储和更新用户的帐户余额，但其实并不是这样。</span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kqogbEdkVX1c1IQunam9dY8nZj9mceUBacxcIZq6dyE1ZicibX2GBwEpNUsvvd6W783slf8iayJLXcQ/640?wx_fmt=png" alt="640?wx_fmt=png"></span></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿</span><span style="color:rgb(136,136,136);"><em><span style="text-align:justify;font-size:12px;">图解比特币钱包工作过程</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">比特币的 UTXO 模型运行良好，一部分原因是数字钱包能够执行与交易相关的大多数任务，包括但不局限于：</span></p>
   <p><br></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">处理 UTXO</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">存储密钥</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">设定交易费用</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">提供交易找零地址</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">汇总 UTXO</span></strong><span style="font-size:15px;">（显示可用的、交易进行中的和总余额）</span></p></li>
   </ul>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">如何来描述 UTXO 模型中的交易行为？钞票是一个绝佳的类比。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">用户通过将钱包（类比比特币地址或者数字钱包）中的钞票（类比 UTXO）相加来计算自己的资金，想要花钱时，就使用一张或者多张钞票。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">每张钞票只能使用一次，因为一旦花费，它就不属于你了。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">因此，可以得出这样的结论：</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币区块链并不存储和更新账户余额</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币钱包持有UTXO对应的私钥</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">如果UTXO包含在交易中，那么它会被全部花完</span></strong><span style="font-size:15px;">（在 UTXO 大于支出金额时，会收到一个全新 UTXO 的“找零”）</span></p></li>
   </ul>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">2、以太坊的“状态”</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);"><br></span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">与上述比特币的区块链不同，以太坊区块链中的状态能够</span><strong><span style="font-size:15px;color:rgb(0,122,170);">存储和更新用户的账户余额</span></strong><span style="font-size:15px;">等信息。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊的状态不是一个抽象的概念，</span><span style="font-size:15px;">它是以太坊底层协议的一部分。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">正如以太坊黄皮书所提到的，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊是一个基于交易的“状态机”</span></strong><span style="font-size:15px;">，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">是一个可以构建所有基于交易的“状态机”的技术</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">与所有其他区块链一样，以太坊的区块链由创世区块开始延伸。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">从创世区块开始，诸如</span><strong><span style="font-size:15px;color:rgb(0,122,170);">交易，部署智能合约和挖矿</span></strong><span style="font-size:15px;">等行为将不断改变以太坊区块链的状态。在以太坊中，每当有与该帐户相关的交易发生时，帐户余额（存储在状态字典树中）就会发生变化。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">帐户余额等数据并不直接存储在以太坊区块链的区块中， 只有</span><strong><span style="font-size:15px;color:rgb(0,122,170);">交易字典树、状态字典树和收款字典树的根节点哈希直接存储在区块链中</span></strong><span style="font-size:15px;">。如下图：</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYJZSyAPV1GujLKWY8IRdrKEyiaYM7DJH69ww9niaWX5icVeVyRicrm3cfLw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="margin-left:2px;font-size:15px;width:inherit;"><br></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">存储字典树（保存所有智能合约数据的地方）的根节点哈希实际上指向状态字典树，而状态字典树又指向区块链。</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊中存储着两种截然不同的数据：永久数据和临时数据。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">交易信息为永久数据</span></strong><span style="font-size:15px;">，一笔交易在得到完全确认后，将被记录在交易字典树中，它永远不会改变；</span><strong><span style="font-size:15px;color:rgb(0,122,170);">账户余额则为临时数据</span></strong><span style="font-size:15px;">，地址对应的账户余额存储在状态字典树中，并且每当出现与该指定帐户相关的交易时账户余额就会更改。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">因此，永久数据和临时数据应单独、分别存储，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊使用字典树的数据结构来管理数据</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊的记录保存机制与银行一样，一个类比就是使用ATM /借记卡。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">银行跟踪每张借记卡的余额，当用户需要花钱时，银行会检查交易记录，以判断用户是否有足够的余额来进行交易。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">3、比特币 UTXO 模型与以太坊账户/余额模型的比较</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币 UTXO 模型的优点：</span></strong></p>
   <p><br></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">可扩展性</span></strong><span style="font-size:15px;">：由于可以同时处理多个 UTXO，因此可以实现并行交易并可促进在可扩展性上的创新。</span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">隐私保护</span></strong><span style="font-size:15px;">：即使比特币不是一个完全匿名的系统，但只要用户每笔交易都使用新地址，UTXO 模型就能提供更高级别的隐私保护。如果需要增强隐私保护，可以考虑使用更复杂的方案，例如环签名。</span></p></li>
   </ul>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊账户/余额模型的优点：</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">简单性</span></strong><span style="font-size:15px;">：以太坊选择了更简单直观的模型，便于开发人员实现复杂的智能合约，特别是那些需要以太坊网络状态信息或涉及多个参与方的智能合约。</span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">比如基于以太坊网络的不同状态执行不同任务的智能合约，若使用 UTXO 的无状态模型，需要强制在每笔交易中加入状态信息，这会使智能合约的设计复杂化。</span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">高效性</span></strong><span style="font-size:15px;">：除了简单性之外，以太坊账户/余额模型更加高效，因为每笔交易只需要验证发送方账户是否有足够的余额来支付交易。</span></p></li>
   </ul>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">为防止以太坊账户/余额模型遭到双重支付攻击，可以用一个递增的随机数来防范这种类型的攻击。</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在以太坊中，每个帐户都有一个公共可见的随机数，每次进行交易时，这个随机数增加1，这种机制可以防止同一笔交易被多次提交。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">这个随机数与以太坊工作量证明的随机数不同，后者是一个挖矿过程的随机值</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">在计算机体系架构中，有时需要在不同模型之间进行折衷</span></strong><span style="font-size:15px;">。一些区块链技术，比如 Hyperledger，就采用了 UTXO 机制，因为这样可以从比特币区块链所衍生的创新中受益。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">接下来简要分析<span style="font-size:15px;letter-spacing:.5px;text-align:justify;">更多</span>基于这两种记录保存模型构建的技术。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:18px;"><strong><span style="color:rgb(0,122,170);"><br></span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:18px;"><strong><span style="color:rgb(0,122,170);"><br></span></strong></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:18px;"><strong><span style="color:rgb(0,122,170);">以太坊字典树数据结构</span></strong></span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊字典树数据结构主要包括状态字典树、存储字典树和交易字典树。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">1、状态字典树——独一无二的存在</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在以太坊网络中有<span style="font-size:15px;letter-spacing:.5px;text-align:justify;">一个</span></span><strong><span style="font-size:15px;color:rgb(0,122,170);">唯一的全网络状态字典树</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">这个全网络状态字典树不断在更新。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">这个全网络状态字典树中包含</span><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊网络中每个账户所对应的键值对</span></strong><span style="font-size:15px;">（key and value pair）。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">全网络状态字典树中的“键”是一个的160位标识符（以太坊帐户的地址）。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">全网络状态字典树中的“值”是通过对以太坊账户的以下详细信息进行编码（使用递归长度字典编码（Recursive-Length Prefix encoding，RLP）方法）生成的：</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">Nonce</span></strong><span style="font-size:15px;">：一个公共可见的随机数。如果帐户是一个外部帐户，这个数字代表从帐户地址发送的交易数量；如果帐户是一个合约帐户，Nonce 是帐户创建的合约数量。</span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">balance</span></strong><span style="font-size:15px;">：这个地址拥有的 Wei（以太坊货币单位）数量，每个以太币有1e+18 Wei。</span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">storageRoot</span></strong><span style="font-size:15px;"> ：一个Merkle Patricia 树根节点的哈希，它对帐户的存储内容的哈希值进行编码，并默认为空。</span></p><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">codeHash</span></strong><span style="font-size:15px;">：EVM（以太坊虚拟机）的哈希值代码。 对于合约帐户，这是一个被哈希计算后并存储为codeHash的代码；对于外部帐户，codeHash字段是空字符串的哈希值。</span></p></li>
   </ul>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">状态字典树的根节点（在给定时间点整个状态字典树的哈希值）被用作状态字典树的安全且唯一的标识符</span></strong><span style="font-size:15px;">；状态字典树的根节点在密码学上取决于状态字典树所有内部的数据。</span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kqogbEdkVX1c1IQunam9dYayqCjwcC0G5HB4Jgt9CoLHVwALGGqKUVnw8bnJSAT3fMbqWn6a7t8A/640?wx_fmt=png" alt="640?wx_fmt=png"></span></span></p>
   <p style="text-align:center;margin-left:8px;letter-spacing:.5px;line-height:normal;"><span style="font-size:15px;">﻿</span><span style="color:rgb(136,136,136);"><em><span style="text-align:justify;font-size:12px;">状态字典树（Merkle Patricia 字典树的levelDB实现）和以太坊区块之间的关系</span></em></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿</span><span style="font-size:15px;">﻿</span><span style="font-size:15px;"><span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYnLCMqARy52d3IMnmQbSoDZWicI4LE1tDgxnhQWFKmoibfOYcZYYP3d0w/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></span></p>
   <p style="text-align:center;margin-left:8px;letter-spacing:.5px;line-height:normal;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">状态字典树：在给定的区块中，状态字典树根节点的 Keccak-256位哈希值被存储为“stateRoot”值</span></em></span></p>
   <p style="text-align:center;margin-left:8px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);"><em><span style="color:rgb(136,136,136);font-size:12px;">stateRoot: ‘0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976’</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">2、存储字典树——存储智能合约数据的地方</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">存储字典树存储所有智能合约数据，每个以太坊帐户都有自己的存储字典树。存储字典树根节点的256位哈希值作为“storageRoot”值存储在全局状态字典树中。</span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kqogbEdkVX1c1IQunam9dYvuZ8WpiaXYc98ibLTNqZZzZ0ewljPUDtBQBoAicdOHbGibBSLhXf6D8oUg/640?wx_fmt=png" alt="640?wx_fmt=png"></span></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">3、交易字典树——每个区块一个</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">每个以太坊区块都有自己独立的交易字典树。</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">一个区块中包含许多交易，区块中交易的顺序由挖出该区块的矿工决定。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">交易字典树中到特定交易的路径经RLP编码后得到交易在区块中的索引。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">由于区块链的防篡改性，已经被挖出的区块不会再改变，所以</span><strong><span style="font-size:15px;color:rgb(0,122,170);">区块中交易的位置永远不会改变</span></strong><span style="font-size:15px;">。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">一旦在区块的交易字典树中找到这笔交易，即使你反复返回相同的路径，检索的结果也是相同的。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:center;">﻿</span><span style="font-size:15px;text-align:center;margin-left:2px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dY9zQIVgGGsBlibtF6nTp6AEwc8VV025HYTW2NCRcrkhAsQcDwoGbQBWw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:center;">﻿</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:center;"><br></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:18px;"><strong><span style="color:rgb(0,122,170);">以太坊字典树实例分析</span></strong></span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">主流的以太坊客户端使用两种不同的数据库软件解决方案来存储字典树。</span><span style="font-size:15px;">以太坊的 Rust 语言客户端 Parity 使用 rocksDB 数据库，</span><span style="font-size:15px;">而</span><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊的 Go 语言，C ++ 语言和 Python 语言客户端都使用 levelDB 数据库</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">本文中，主要带你了解 levelDB 数据库。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊和 levelDB 数据库</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">LevelDB 是一个开源的谷歌键值存储程序库</span></strong><span style="font-size:15px;">，除了常规功能外，它还提供对数据的前向和后向迭代，从字符串键到字符串值的有序映射，自定义比较函数和自动压缩。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">自动压缩功能使用开源 Google 压缩/解压缩程序库 “Snappy”</span></strong><span style="font-size:15px;">。Snappy 程序库的设计目标并不是追求最大压缩率，而是追求非常高的压缩速度。 </span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">LevelDB 数据库是一种重要的存储和检索机制，用于管理以太坊网络的状态。</span></strong><span style="font-size:15px;">因此，levelDB 是主流以太坊客户端（节点），比如 go-ethereum，cpp-ethereum 和 pyethereum 的底层数据库。 </span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">虽然可以在磁盘上完成字典树数据结构的实现（使用诸如 levelDB 之类的数据库软件），但重要的是要注意遍历字典树和简单地查看键/值数据库之间存在的差异。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">为了更详细说明这些差异，可以使用 Patricia 字典树的程序库来访问数据库levelDB 中的数据。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在以太坊客户端上，</span><span style="font-size:15px;">执行交易、部署智能合约和挖矿等网络操作，并观察它们如何影响以太坊的“状态”。</span></p>
   <p><br></p>
   <p><br></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:18px;"><strong><span style="color:rgb(0,122,170);">分析以太坊数据库</span></strong></span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊区块链中每个区块都包含许多 Merkle Patricia 字典树：</span></p>
   <p><br></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">状态字典树</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">存储字典树</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">交易字典树</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">收款字典树</span></strong></p></li>
   </ul>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">要在特定区块中引用特定的 Merkle Patricia 字典树，需要获取其根节点哈希值作为索引。 </span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">使用以下命令，获取创世区块中状态字典树、交易字典树和收款字典树的根节点哈希值：</span></p>
   <p><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="font-size:11px;word-spacing:-3px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">1</span><span class="hljs-selector-tag" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">web3</span><span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.eth.getBlock</span>(0)<span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.stateRoot</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">2</span><span class="hljs-selector-tag" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">web3</span><span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.eth.getBlock</span>(0)<span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.transactionsRoot</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">3</span><span class="hljs-selector-tag" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">web3</span><span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.eth.getBlock</span>(0)<span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.receiptsRoot</span><br></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYDlqlOJbUVJeRia04WBK3O0mDPymNx3jRzzCn8ZPiculwNZIBMgRVD3ag/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">如果想得到最新挖出区块的根节点哈希（而不是创世区块），使用以下命令：</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="font-size:11px;word-spacing:-3px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">1</span><span class="hljs-selector-tag" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">web3</span><span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.eth.getBlock</span>(<span class="hljs-selector-tag" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">web3</span><span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.eth.blockNumber</span>)<span class="hljs-selector-class" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">.stateRoot</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">获取根节点哈希值之后，需要配置网络环境。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">1、安装npm、Node、Level 和 EthereumJS</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">使用 </span><strong><span style="color:rgb(0,122,170);font-size:15px;">Node.js</span></strong><span style="font-size:15px;">，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">Level</span></strong><span style="font-size:15px;"> 和 </span><strong><span style="font-size:15px;color:rgb(0,122,170);">EthereumJS</span></strong><span style="font-size:15px;">（使用 JavaScript 语言编写的以太坊虚拟机）三个程序来进行 levelDB 数据库的实验。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">通过以下命令配置实验环境。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="font-size:11px;word-spacing:-3px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 1</span>cd&nbsp;~<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 2</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 3</span>sudo&nbsp;apt-get&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">update</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 4</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 5</span>sudo&nbsp;apt-<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">get</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">upgrade</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 6</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 7</span>curl&nbsp;-sL&nbsp;https://deb.nodesource.com/setup_9.x&nbsp;|&nbsp;sudo&nbsp;-E&nbsp;bash&nbsp;-&nbsp;sudo&nbsp;apt-<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">get</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">install</span>&nbsp;-y&nbsp;nodejs<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 8</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 9</span>sudo&nbsp;apt-<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">get</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">install</span>&nbsp;nodejs<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">10</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">11</span>npm&nbsp;-v<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">12</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">13</span>nodejs&nbsp;-v<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">14</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">15</span>npm&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">install</span>&nbsp;levelup&nbsp;leveldown&nbsp;rlp&nbsp;merkle-patricia-tree&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">--save</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">16</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">17</span>git&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">clone</span>&nbsp;https://github.com/ethereumjs/ethereumjs-vm.git<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">18</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">19</span>cd&nbsp;ethereumjs-vm<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">20</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">21</span>npm&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">install</span>&nbsp;ethereumjs-<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">account</span>&nbsp;ethereumjs-util&nbsp;–<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">save</span><br></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">实验环境配置完毕后，运行以下代码将</span><strong><span style="font-size:15px;color:rgb(0,122,170);">打印出一个以太坊帐户和对应密钥的列表</span></strong><span style="font-size:15px;">（存储在以太坊专用网络的状态根目录中），</span><strong><span style="font-size:15px;color:rgb(0,122,170);">连接以太坊的 levelDB 数据库</span></strong><span style="font-size:15px;">，进入以太坊专用网络的状态（使用区块链中区块的 stateRoot 值），然后</span><strong><span style="font-size:15px;color:rgb(0,122,170);">访问以太坊专用网络上所有帐户的密钥</span></strong><span style="font-size:15px;">。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="font-size:11px;word-spacing:-3px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 1</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Just&nbsp;importing&nbsp;the&nbsp;requirements</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 2</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 3</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;Trie&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'merkle-patricia-tree/secure'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 4</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 5</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;levelup&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'levelup'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 6</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 7</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;leveldown&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'leveldown'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 8</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 9</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;RLP&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'rlp'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">10</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">11</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;assert&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'assert'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">12</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">13</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">14</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">15</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">16</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;db&nbsp;=&nbsp;levelup(leveldown(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'/home/timothymccallum/gethDataDir/geth/chaindata'</span>));<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">17</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">18</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">19</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Adding&nbsp;the&nbsp;"stateRoot"&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">20</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">21</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;root&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'0x8c77785e3e9171715dd34117b047dffe44575c32ede59bde39fbf5dc074f2976'</span>;<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">22</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">23</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">24</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">25</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">26</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;trie&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">new</span>&nbsp;Trie(db,&nbsp;root);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">27</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">28</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">29</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Creating&nbsp;a&nbsp;nodejs&nbsp;stream&nbsp;object&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;access&nbsp;the&nbsp;data</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">30</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">31</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;stream&nbsp;=&nbsp;trie.createReadStream()<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">32</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">33</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">34</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Turning&nbsp;on&nbsp;the&nbsp;stream&nbsp;(because&nbsp;the&nbsp;node&nbsp;js&nbsp;stream&nbsp;is&nbsp;set&nbsp;to&nbsp;pause&nbsp;by&nbsp;default)</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">35</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">36</span>stream.on(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'data'</span>,&nbsp;<span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">function</span>&nbsp;(<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">data</span>)</span>{<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">37</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">38</span>&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//printing&nbsp;out&nbsp;the&nbsp;keys&nbsp;of&nbsp;the&nbsp;"state&nbsp;trie"</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">39</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">40</span>&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">console</span>.log(data.key);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">41</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">42</span>});<br></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYk2vcSh6gp6HsbJeo56tqMn1fnX0lDDGy6gp66ZE1XTuGHoiakL30riaw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></span></p>
   <p style="text-align:center;margin-left:8px;letter-spacing:.5px;line-height:normal;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">﻿<span style="text-align:justify;">以上代码的输出</span></span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">以太坊网络中的账户只有在交易（与该特定账户相关的交易）发生时才会被加入到状态字典树中</span></strong><span style="font-size:15px;">。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">例如，仅使用命令 “</span><span style="font-size:15px;color:rgb(136,136,136);"><em>geth account new</em></span><span style="font-size:15px;">” 创建的新帐户将不会被加入到状态字典树中；如果一笔成功的交易（一笔消耗了以太坊燃料并被加入到已挖出的区块中的交易）与这个账户产生关联，那么这时该账户才会出现在状态字典树里。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">这可以</span><strong><span style="font-size:15px;color:rgb(0,122,170);">防止恶意攻击者不断创建新帐户</span></strong><span style="font-size:15px;">，从而</span><strong><span style="font-size:15px;color:rgb(0,122,170);">维持状态字典树的正常数据量</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">2、解码数据</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊在与 levelDB 数据库交互时使用了“</span><strong><span style="font-size:15px;color:rgb(0,122,170);">改进的 Merkle Patricia 字典树（Modified Merkle Patricia Trie）</span></strong><span style="font-size:15px;">”，扩展了字典树数据结构。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">例如，改进的 Merkle Patricia 包含一种方法，该方法可以通过使用</span><strong><span style="font-size:15px;color:rgb(0,122,170);">“扩展”节点</span></strong><span style="font-size:15px;">来实现快速遍历。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在以太坊中，一个改进的的 Merkle Patricia trie 节点可以是：</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">一个空字符串（NULL）</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">一个包含17个项目的数组（分支）</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">一个包含2个项目的数组（叶节点）</span></strong></p></li>
    <li><p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">一个包含2个项目的数组（扩展名）</span></strong></p></li>
   </ul>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">由于以太坊的字典树是根据严格的规则进行设计和构建的，因此检查它们的最佳方法是使用计算机代码进行测试。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">以下示例使用了 EthereumJS</span></strong><span style="font-size:15px;">，</span><span style="font-size:15px;">当提供特定区块的 stateRoot 以及以太坊帐户地址时，运行下面代码返回该帐户的余额。</span></p>
   <p style="text-align:center;margin-left:8px;letter-spacing:.5px;line-height:normal;"><span style="font-size:15px;text-align:center;">﻿</span><span style="font-size:15px;text-align:center;margin-left:2px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kqogbEdkVX1c1IQunam9dYqRicIsrdcicQNdkXRfOcehMnNZltpcCgZicxeWqB95FmI8Woz1uzYL8Xw/640?wx_fmt=png" alt="640?wx_fmt=png"></span><span style="font-size:15px;text-align:center;">﻿</span><em><span style="font-size:12px;color:rgb(136,136,136);">以下代码的输出（以太坊地址0xccc6b46fa5606826ce8c18fece6f519064e6130b的帐户余额）</span></em></p>
   <p style="margin-left:8px;"><br></p>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="font-size:11px;word-spacing:-3px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 1</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Mozilla&nbsp;Public&nbsp;License&nbsp;2.0&nbsp;</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 2</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 3</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//As&nbsp;per&nbsp;https://github.com/ethereumjs/ethereumjs-vm/blob/master/LICENSE</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 4</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 5</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Requires&nbsp;the&nbsp;following&nbsp;packages&nbsp;to&nbsp;run&nbsp;as&nbsp;nodejs&nbsp;file&nbsp;https://gist.github.com/tpmccallum/0e58fc4ba9061a2e634b7a877e60143a</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 6</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 7</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 8</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Getting&nbsp;the&nbsp;requirements</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;"> 9</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">10</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;Trie&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'merkle-patricia-tree/secure'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">11</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">12</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;levelup&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'levelup'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">13</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">14</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;leveldown&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'leveldown'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">15</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">16</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;utils&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'ethereumjs-util'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">17</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">18</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;BN&nbsp;=&nbsp;utils.BN;<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">19</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">20</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;Account&nbsp;=&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">require</span>(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'ethereumjs-account'</span>);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">21</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">22</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">23</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Connecting&nbsp;to&nbsp;the&nbsp;leveldb&nbsp;database</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">24</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">25</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;db&nbsp;=&nbsp;levelup(leveldown(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'/home/timothymccallum/gethDataDir/geth/chaindata'</span>));<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">26</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">27</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">28</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Adding&nbsp;the&nbsp;"stateRoot"&nbsp;value&nbsp;from&nbsp;the&nbsp;block&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;state&nbsp;root&nbsp;at&nbsp;that&nbsp;block&nbsp;height.</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">29</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">30</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;root&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'0x9369577baeb7c4e971ebe76f5d5daddba44c2aa42193248245cf686d20a73028'</span>;<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">31</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">32</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">33</span><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Creating&nbsp;a&nbsp;trie&nbsp;object&nbsp;of&nbsp;the&nbsp;merkle-patricia-tree&nbsp;library</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">34</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">35</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;trie&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">new</span>&nbsp;Trie(db,&nbsp;root);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">36</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">37</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">38</span><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;address&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'0xccc6b46fa5606826ce8c18fece6f519064e6130b'</span>;<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">39</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">40</span>trie.get(address,&nbsp;<span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">function</span>&nbsp;(<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">err,&nbsp;raw</span>)&nbsp;</span>{<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">41</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">42</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(err)&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;cb(err)<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">43</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">44</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Using&nbsp;ethereumjs-account&nbsp;to&nbsp;create&nbsp;an&nbsp;instance&nbsp;of&nbsp;an&nbsp;account</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">45</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">46</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">var</span>&nbsp;account&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">new</span>&nbsp;Account(raw)<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">47</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">48</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">console</span>.log(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'Account&nbsp;Address:&nbsp;'</span>&nbsp;+&nbsp;address);<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">49</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//Using&nbsp;ethereumjs-util&nbsp;to&nbsp;decode&nbsp;and&nbsp;present&nbsp;the&nbsp;account&nbsp;balance&nbsp;</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">51</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">52</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">console</span>.log(<span class="hljs-string" style="font-size:inherit;line-height:inherit;color:rgb(238,220,112);">'Balance:&nbsp;'</span>&nbsp;+&nbsp;(<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">new</span>&nbsp;BN(account.balance)).toString());<br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">53</span><br><span class="linenum hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-spacing:0px;">54</span>})</p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="color:rgb(0,122,170);font-size:18px;"><strong><br></strong></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="color:rgb(0,122,170);font-size:18px;"><strong>独特的设计带来了哪些优点？</strong></span></p>
   <p style="text-align:left;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">1、移动性</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">如今移动设备和物联网（IoT）设备无处不在，而电子商务的未来建立在安全、强大和快速的移动应用上。</span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿<span style="margin-left:2px;font-size:15px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYuMN1OHT1UogRSUmdMhPgqmiaKMP1Xwwe0u5fYibZz3U0dRKLL4MXfDMA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></span></p>
   <p style="text-align:center;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">﻿</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">可以说区块链在移动性上取得了巨大进步，但我们也必须承认区块链大小的不断增加是不可避免的。因此</span><strong><span style="font-size:15px;color:rgb(0,122,170);">在日常移动设备上存储整个区块链是不切实际的</span></strong><span style="font-size:15px;">。</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">2、速度快，不会影响安全性</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">以太坊网络状态的设计及其对改进的 Merkle Patricia 字典树的使用为其应用提供了更多的可能性。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在以太坊中字典树上执行的每个操作（添加、更新或删除）都使用了确定性的密码学哈希值。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">此外，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">字典树根节点的密码学哈希值可以用作字典树未被篡改的证据</span></strong><span style="font-size:15px;">。例如，对字典树数据的任何更改（例如增加 levelDB 数据库中的帐户余额）都将完全改变根节点哈希值。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">这种密码学特性为轻客户端（不存储整个区块链的设备）带来了<span style="font-size:15px;letter-spacing:.5px;text-align:justify;">快速、可靠查询</span>的可能性，比如</span><strong><span style="font-size:15px;color:rgb(0,122,170);">查询账户 “0x ... 4857” 在区块高度为 “5044866” 的区块上是否有足够的资金完成此次交易等</span></strong><span style="font-size:15px;">？</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">“</span><strong><span style="font-size:15px;color:rgb(0,122,170);">Merkle 证明的空间复杂度与存储数据量呈对数关系</span></strong><span style="font-size:15px;">。这意味着，即使整个状态字典树的大小为几千兆字节，如果一个节点从受信任的源接收一个状态，该节点只需下载一个几千字节的证明数据就能够完全确定该字典树上任何信息的有效性。”</span></p>
   <p><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">3、额度限制</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">在以太坊白皮书中，有一个关于活期储蓄账户的概念</span></strong><span style="font-size:15px;">。在这种情景下，两个用户（可能是丈夫和妻子，或着商业伙伴之间）每人每天最多只能提取帐户总余额的1%。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">虽然这个想法仅仅在白皮书中</span><strong><span style="font-size:15px;color:rgb(0,122,170);">“进一步发展方向”</span></strong><span style="font-size:15px;">的部分中被提到，但无疑它会引起人们广泛的兴趣，因为理论上它可以作为以太坊底层协议的一部分（而不是被当作为第二层协议或者是第三方钱包的一部分）。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">UTXO对区块链数据是不可见的，实际上比特币区块链并不存储用户的账户余额。因此，</span><strong><span style="font-size:15px;color:rgb(0,122,170);">比特币的底层协议不太可能实现任何类型的每日额度限制</span></strong><span style="font-size:15px;">。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">4、消费者信心</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">相信随着区块链开发者的不断努力，我们会目睹轻量级客户端的</span><strong><span style="font-size:15px;color:rgb(0,122,170);">快速发展</span></strong><span style="font-size:15px;">，目睹可以与区块链技术交互的安全、强大和快速的移动应用程序的</span><strong><span style="font-size:15px;color:rgb(0,122,170);">大规模落地</span></strong><span style="font-size:15px;">。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:center;">﻿</span><span style="font-size:15px;text-align:center;margin-left:2px;width:inherit;"><img class="gallery-image" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYL9nH6AY17P7TCEKPWC0Vw8icHlfCCvl3wsZfFSzneAqzWcblTCgPWVw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;text-align:center;">﻿</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">在电子商务领域想要实现区块链技术的落地必须</span><strong><span style="font-size:15px;color:rgb(0,122,170);">提高速度</span></strong><span style="font-size:15px;">、</span><strong><span style="font-size:15px;color:rgb(0,122,170);">安全性</span></strong><span style="font-size:15px;">和</span><span style="font-size:15px;color:rgb(0,122,170);"><strong>可用性</strong></span><span style="font-size:15px;">。通过巧妙的设计提供优异的可用性，安全性和性能，这将</span><strong><span style="font-size:15px;color:rgb(0,122,170);">提高消费者信心同时增加大众的采用率</span></strong><span style="font-size:15px;">。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;">数据的存储机制也是当下区块链应用落地面临的一大问题，它决定了区块链的运行效率。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);">只有解决有关区块链应用落地的痛点，区块链才能真正走进人们的生活，给人们带来便利！</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);"><br></span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><strong><span style="font-size:15px;color:rgb(0,122,170);"><span style="font-size:15px;letter-spacing:.5px;text-align:justify;"><br></span></span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><strong><span style="font-size:15px;color:rgb(0,122,170);"><span style="font-size:15px;letter-spacing:.5px;text-align:justify;">看到这里，相信你对以太坊的数据存储机制已有了深入的了解。</span></span></strong></em></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><strong><span style="font-size:15px;color:rgb(0,122,170);"><span style="font-size:15px;letter-spacing:.5px;text-align:justify;"><br></span></span></strong></em></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;">如果你有关于以太坊数据存储、去中心化应用落地等方面的独特看法，记得及时留言给本营小姐姐哈！</span><span style="font-size:15px;">留言之前，记得点赞呦！</span></em></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><span style="font-size:15px;"><br></span></em></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><em><strong><span style="font-size:15px;color:rgb(0,122,170);">古语说得好，“用心点赞，手有余香”~<img style="width:20px;vertical-align:text-bottom;" src="https://res.wx.qq.com/mpres/htmledition/images/icon/common/emotion_panel/emoji_wx/2_04.png" alt="2_04.png"></span></strong></em></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <blockquote style="font-family:'微软雅黑';letter-spacing:.544px;text-align:justify;background-color:rgb(255,255,255);">
    <p style="margin-left:8px;color:rgb(51,51,51);font-size:16px;letter-spacing:2px;text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;">原文链接：</span></p>
    <p style="margin-left:8px;color:rgb(51,51,51);font-size:16px;letter-spacing:2px;text-align:left;line-height:1.75em;"><span style="letter-spacing:.5px;"><em><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.5px;text-align:justify;">https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033</span></em></span></p>
    <p style="margin-left:8px;color:rgb(51,51,51);font-size:16px;letter-spacing:2px;text-align:left;line-height:1.75em;"><br></p>
    <p style="margin-left:8px;color:rgb(51,51,51);font-size:16px;letter-spacing:2px;text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(136,136,136);letter-spacing:.5px;"></span></p>
    <p style="margin-left:8px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.5px;"></span></p>
    <p style="margin-left:8px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;">内容转载请联系微信：</span></p>
    <p style="margin-left:8px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;">qk15732632926（备注：微信公众号+转载）</span></p>
    <p style="margin-left:8px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;">商务合作请联系微信：</span></p>
    <p style="margin-left:8px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;">fengyan-1101<span style="letter-spacing:2px;">（备注：区块链大本营+商务合作）</span></span></p>
   </blockquote>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;letter-spacing:.5px;"><br></p>
   <p style="margin-left:8px;font-size:16px;color:rgb(51,51,51);font-family:'微软雅黑';text-align:center;background-color:rgb(255,255,255);letter-spacing:.5px;line-height:1.75em;"><span style="font-family:'宋体';font-size:15px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9lUGQW5MzBJAwicHRjXt8EiaxLuLKrknMw1MxRrd21kYaerjibWRJRTGLCY5YsIcqYHSP1pX3rmvmxEg/640?wx_fmt=png" alt="640?wx_fmt=png"></span></p>
   <p style="margin-left:8px;font-size:18px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;"><strong><br></strong></span></p>
   <p style="margin-left:8px;font-size:18px;letter-spacing:.5px;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;"><strong>最新热文：</strong></span></p>
   <ul class="list-paddingleft-2" style="margin-left:8px;">
    <li><p style="line-height:1.75em;letter-spacing:.5px;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247487970&amp;idx=1&amp;sn=04b80a487992c03bfbbe84394674cda3&amp;chksm=fc7c4f1fcb0bc6092db452d04c652be470fd1cb338eca02500786dfc9fca7dbe51b8edb6f125&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(0,122,170);text-decoration:underline;font-size:15px;"><span style="font-size:15px;"><strong>现实版好莱坞, 门头沟事件受害者3年死磕查到真凶! 超燃黑客落网事件始末</strong></span></a><br></p></li>
    <li><p style="line-height:1.75em;letter-spacing:.5px;"><a href="https://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247487933&amp;idx=1&amp;sn=2ab452b88e76ad3858b87e6428b61f10&amp;chksm=fc7c4f40cb0bc65626fc1d08c304d72e7af621bf43c01e4fbd97ecefcb91d8de749ecc02e42a&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(0,122,170);text-decoration:underline;font-family:'微软雅黑';letter-spacing:.5px;text-align:justify;background-color:rgb(255,255,255);font-size:15px;"><span style="font-size:15px;"><strong>长文 | 深度解析Solidity让老司机翻车的17个坑及超详细避坑指南，建议先马后看（附送独家资源）</strong></span></a><br></p></li>
    <li><p style="line-height:1.75em;letter-spacing:.5px;"><a href="https://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247487880&amp;idx=1&amp;sn=ead05db02480ea59a503123f32b3bbbb&amp;chksm=fc7c4f75cb0bc6635407a0b19369efcf69ba1ac766e2799b03a87a52770c743382647830c730&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(0,122,170);text-decoration:underline;font-size:15px;"><span style="font-size:15px;"><strong>V神正在密切关注！这55行状态通道代码，带你快速扩展以太坊生态</strong></span></a><br></p></li>
    <li><p style="line-height:1.75em;letter-spacing:.5px;"><span style="color:rgb(0,122,170);text-decoration:underline;font-size:15px;"><strong><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247487798&amp;idx=1&amp;sn=59fe786ab57a806b1b33b55404f80ff2&amp;chksm=fc7c4fcbcb0bc6dde6e468e22db69448074f947ccb5457632c3da58d08fc56b376788e33c140&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(0,122,170);text-decoration:underline;font-size:15px;">10岁小表妹也能“吃透”Geth 客户端 ！360秒，快速部署 ICO Token</a></strong></span></p></li>
   </ul>
   <p style="line-height:1.75em;letter-spacing:.5px;text-align:center;"><br></p>
   <p style="margin-left:8px;color:rgb(51,51,51);font-family:'微软雅黑';font-size:16px;background-color:rgb(255,255,255);text-align:center;letter-spacing:.5px;line-height:1.75em;"><img style="width:259px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9kqogbEdkVX1c1IQunam9dYWM2PicJwhTPiaXq5NwZichcH9vjcph4EQSmlppoY4bKibOVJmUGNh8pia1A/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="margin-left:8px;color:rgb(51,51,51);font-family:'微软雅黑';font-size:16px;background-color:rgb(255,255,255);text-align:center;letter-spacing:.5px;line-height:1.75em;"><span style="font-size:15px;"><strong style="color:rgb(63,63,63);">大力戳↑↑↑ &nbsp;加入区块链大本营读者⑦号群</strong></span></p>
   <p style="margin-left:8px;color:rgb(51,51,51);font-family:'微软雅黑';font-size:16px;background-color:rgb(255,255,255);text-align:center;letter-spacing:.5px;line-height:1.75em;"><span style="font-size:15px;"><strong style="color:rgb(63,63,63);">（群满加微信 qk15732632926 入群）</strong></span></p>
   <p style="margin-left:8px;text-align:center;letter-spacing:.5px;line-height:1.75em;"><br></p>
   <p style="margin-left:8px;text-align:center;letter-spacing:.5px;line-height:1.75em;"><span style="font-size:15px;"><strong style="color:rgb(63,63,63);"><br></strong></span></p>
   <p style="letter-spacing:.544px;"><img class="__bg_gif" style="margin-left:auto;line-height:28px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9kuuGYcoeg06IYM4TSEE1eCF4aiadptTMnNFDia5JfEBLuUslraYtDcYbKr2b4takjM2MfqeZYcVqkQ/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
   <p style="letter-spacing:.544px;"><br></p>
   <p style="letter-spacing:.544px;"><br></p>
   <p style="margin-left:8px;text-align:center;letter-spacing:.5px;line-height:1.75em;"><span style="font-size:15px;"><strong><span style="color:rgb(0,122,170);">了解更多区块链技术及应用内容</span></strong></span></p>
   <p style="margin-left:8px;text-align:center;letter-spacing:.5px;line-height:1.75em;"><span style="font-size:15px;"><strong><span style="color:rgb(0,122,170);">敬请关注：</span></strong></span></p>
   <p style="margin-left:8px;text-align:center;letter-spacing:.5px;line-height:1.75em;"><img class="__bg_gif" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9kegUbp0DLNf5dM2JbggFlThJvvibDiaEicHicPaTJV6oOMMWYZynQZcNupmQJIbPAdlVhT8PeicsKaFMQ/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
  </div> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/81713659,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/81713659,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

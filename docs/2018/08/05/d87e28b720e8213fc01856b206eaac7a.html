<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊源码分析之八虚拟机 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊源码分析之八虚拟机" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="以太坊源码分析之八虚拟机 一、智能合约的编译分析 接上文，先搞一个小的智能合约，编译好，放到环境里执行看流程和结果，先看智能合约 ： pragma solidity ^0.4.4; &nbsp; contract HelloWorld { &nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t = t +1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return t; &nbsp;&nbsp;&nbsp; } }最简单的一个HelloWorld,简单就意味着好分析，第一行表示使用的solidity的版本，不同版本编译结果略有不同。^代表 兼容的版本，这里是指兼容0.4.4~0.4.9，当然你也可以指定更新的。 合约的主体结构和普通的编程方式没有太大的区别，使用 contract表示一个封装，你理解成类或者结构体都可以，它也可以有接口有继承。 内部访问有各种限制，公有私有和索引等。 然后将其拷贝到REMIX上，进行编译会发现有两个警告： browser/ballot_test.sol:4:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. &nbsp;&nbsp;&nbsp;&nbsp;function Hello( uint256 t) returns (uint256) { ^ (Relevant source part starts here and spans across multiple lines). &nbsp; browser/ballot_test.sol:4:5: Warning: Function state mutability can be restricted to pure &nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) { &nbsp;&nbsp;&nbsp; ^ (Relevant source part starts here and spans across multiple lines). 这两上警告主要是告诉你的代码写得不规范，没有明确的指定可访问性和限制属性，这两个都可以忽略。将其部署到私链上，调用即可返回“HelloWorld”的字符串。（部署的方法见前面的博客） 看一下它的编译结果： &nbsp; //全局初始化 .code &nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; //此处检测返回value,如果该合约构造函数不支持payable,不为0，revert &nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^ &nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n &nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\n contrac tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;//此处为返回接口代码初始化 &nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH #[$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH [$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; CODECOPY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... .data &nbsp; 0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //此处为接口判断代码 &nbsp;&nbsp;&nbsp; .code &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATASIZE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH FFFFFFFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 100000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 775A9482&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EQ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp; tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp; tag 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\n contrac &nbsp;&nbsp;&nbsp; tag 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; tag 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; tag 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP [out]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; .data &nbsp; 不要被吓到，前头一大堆都是格式化的东西，真正对分析有用处的是tag 5中的部分，明显可以看出指令增加和调换。然后跳转到返回。 看一下它的RUNTIME BYTECODE: { &nbsp;&nbsp;&nbsp; &quot;linkReferences&quot;: {}, &nbsp;&nbsp;&nbsp; &quot;object&quot;: &quot;608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029&quot;, &nbsp;&nbsp;&nbsp; &quot;opcodes&quot;: &quot;PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3E JUMPI PUSH4 0xFFFFFFFF PUSH29 0x100000000000000000000000000000000000000000000000000000000 PUSH1 0x0 CALLDATALOAD DIV AND PUSH4 0x775A9482 DUP2 EQ PUSH1 0x43 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE DUP1 ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x58 PUSH1 0x4 CALLDATALOAD PUSH1 0x6A JUMP JUMPDEST PUSH1 0x40 DUP1 MLOAD SWAP2 DUP3 MSTORE MLOAD SWAP1 DUP2 SWAP1 SUB PUSH1 0x20 ADD SWAP1 RETURN JUMPDEST PUSH1 0x1 ADD SWAP1 JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xc2 0xf8 0xe3 PUSH30 0xD71A65637998AD372A063DD9DF1DFD4214E967A8F469D7605F8855470029 &quot;, &nbsp;&nbsp;&nbsp; &quot;sourceMap&quot;: &quot;25:116:0:-;;;;;;;;;;;;;;;;;;;;;;;51:88;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;51:88:0;;;;;;;;;;;;;;;;;;;;;;113:1;110:4;;51:88::o&quot; } 再看一下部署的CODE： data: &#39;0x6080604052348015600f57600080fd5b50609c8061001e6000396000f300608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029&#39;, &nbsp; 不难发现，其实运行时的Code是部署的Code的一子集 。 下面分析一下： Push 1表示将临时变量压入栈中。 Add&nbsp; t+1表示将t和1相加并保存结果。 SWAP1 &nbsp;t+1表示将结果交换到t，即将栈顶元素与栈中第1个（SWAPI代表第I个）交换 JUMP [out] 就返回了结果 分析一小段相关的代码，见上面紫色部分：60200190f35b6001019056 先看一上标准操作码： 0x00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; STOP 0x01&nbsp; ADD 0x90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; SWAP1 0xf3 &nbsp; RETURN 0x5b&nbsp; JUMPDEST 0x60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; PUSH1 0x56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; JUMP 然后和代码对比： 60&nbsp;&nbsp;&nbsp; 01 PUSH 01 01&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp; &nbsp;&nbsp;t+1 90&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;swap1&nbsp; t=t+1 56&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 再将红色部分与 tag4对比，发现也是一致的。 通过上面的简单分析可以显示出，以太坊的虚拟机是基于栈操作的图灵完备（准确的说是准图灵完备）的虚拟机。 在编译合约时可以得到两个字节码： contract bytecode（合约字节码）：最终存储在区块链中的字节码，也是将字节码存放在区块链、初始化智能合约（运行构造函数）时所需的字节码。 runtime bytecode（运行时字节码）：对应于存储在区块链中的字节码，与合约初始化和存放过程无关。 前面已经提到过，后者是前者的一个子集。 而一个个的指令编译出来，就可以按照这个来收gas费用了，举一个例子： sstore指令第一次写入一个新位置需要花费20000 gas sstore指令后续写入一个已存在的位置需要花费5000 gas sload指令的成本是500 gas 大多数的指令成本是3~10 gas 智能合约的存储是收费比较高的，所以一定要注意合理使用变量。 到现在为止，一个虽然简单但是完整的智能合约就编译并分析出来，正好对应着一篇的分析，下面开始分析虚拟机的部分。 二、虚拟机分析 虚拟机部分主要在core/vm中，其它的地方散布着一些调用的接口相关的封装： &nbsp; &nbsp;analysis.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //跳转目标判定 &nbsp;common.go &nbsp;contract.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //合约数据结构 &nbsp;contracts.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //预编译好的合约 &nbsp;doc.go &nbsp;errors.go &nbsp;evm.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行器 对外提供一些外部接口&nbsp;&nbsp; &nbsp;gas.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //call gas花费计算 一级指令耗费gas级别 &nbsp;gas_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//指令耗费计算函数表 &nbsp;gen_structlog.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //日志数据结构生成 &nbsp;instructions.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //指令操作 &nbsp;interface.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;interpreter.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //解释器 调用核心 &nbsp;intpool.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //int值池 &nbsp;int_pool_verifier_empty.go &nbsp;int_pool_verifier.go &nbsp;jump_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//指令和指令操作（操作等）对应表 &nbsp;logger.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //状态日志 &nbsp;memory.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存 &nbsp;memory_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存操作表 主要判断操作所需内存 &nbsp;noop.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //空指令 &nbsp;opcodes.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Op指令 以及一些对应关系&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;runtime &nbsp;&nbsp; &nbsp;env.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行环境 &nbsp;&nbsp; &nbsp;fuzz.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Go随机测试工具 &nbsp;&nbsp; &nbsp;runtime.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //运行接口 测试使用 &nbsp;stack.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈 stack_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈验证 vm_jit.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //这两个文件基本被注释空 vm_jit_fake.go &nbsp; 它主要分为以下几类： 1、操作码（OpCode） 文件opcodes.go中定义了所有的OpCode，该值是一个byte，智能合约编译出来的bytecode中，一个OpCode就是上面的一位。opcodes按功能分为9组（运算相关，块操作，加密相关等）。 const ( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 0x40 range - block operations &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BLOCKHASH OpCode = 0x40 + iota &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COINBASE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TIMESTAMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMBER &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIFFICULTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GASLIMIT ) 前面已经分析过一个简单的合约。 2、指令和指令集。 jump.table.go定义了三种指令集合，每个集合实质上是个256长度的数组，名字翻译过来是荒地，农庄，拜占庭，指令集向前兼容。 &nbsp;&nbsp;&nbsp; frontierInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewFrontierInstructionSet() &nbsp;&nbsp;&nbsp; homesteadInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewHomesteadInstructionSet() &nbsp;&nbsp;&nbsp; byzantiumInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewByzantiumInstructionSet() 下面举一个例子： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MUL: { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; execute:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; opMul, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gasCost:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constGasFunc(GasFastStep), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validateStack: makeStackFunc(2, 1), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; valid:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, &nbsp; 3、栈和内存 栈是用来执行指令的一个容器，前面说过。 type Stack struct { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data []*big.Int } &nbsp; func newstack() *Stack { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Stack{data: make([]*big.Int, 0, 1024)} } &nbsp; func (st *Stack) Data() []*big.Int { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return st.data } 内存是提供指令数据存储的地方： // Memory implements a simple memory model for the ethereum virtual machine. type Memory struct { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; []byte &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastGasCost uint64 } &nbsp; func NewMemory() *Memory { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Memory{} } 4、状态数据库 状态数据库由stateDb来保存，持久化到内存中，并依据具体的情况保存到 leveldb中去。在指令集的操作函数中： func opSload(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop()) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := evm.StateDB.GetState(contract.Address(), loc).Big() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stack.push(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil } &nbsp; func opSstore(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop()) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := stack.pop() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.StateDB.SetState(contract.Address(), loc, common.BigToHash(val)) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.interpreter.intPool.put(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil } 5、入口函数 入口函数在前面提到了， evm.go中，Call，CallCode，StaticCall和DelegateCall，不再赘述。 6、解释执行 前面也提到了，Run函数： func (in *Interpreter) Run(contract *Contract, input []byte) (ret []byte, err error) {…} &nbsp; &nbsp; 三、以太坊的EVM说明 以太坊的虚拟机主要是为了执行智能合约而出现，在以太坊的系统中，外部帐户和合约帐户对EVM来说都是一致的。每个帐户都有一个&lt;key,value&gt;来形成持久化存储（仍然在内存中，根据情况可存储到区块上或者日志中），二者的长度均为256位。 同样，帐户在操作内存时，为了简单，是以32字节（256位）为单位的。内存可以在一定范围内线性增长，但是需要消耗gas。 前面分析了，EVM是基于栈而不是常见的计算机的基于寄存器的，说通俗些，其实就是一个后进先出的容器，来回根据指令操作。 EVM的指令集数量比较少，其指令操作的长度恒定为32字节（256位）长度。具备常用的算术、位、逻辑和比较操作。支持有条件和无条件跳转。同时提供合约访问当前区块的相关属性，比如它的编号和时间戳。 最重要的，合约可以通过索引数据结构，将存储的数据映射到区块上，永久保存，这被称为日志logs，Solidity用它来实现事件Events。外总程序可以通过接口，利用布隆过滤器（Bloom Filter），得到想得到的日志数据，而不需要将整个区块同步到本地上。 EVM的编译器并不会为字节码的大小、速度或内存高效性进行优化。它只会为gas的使用进行优化，目的很直接，鼓励计算排序，提高以太坊区块链的执行效率。 四、总结 前面通过一个简单的例子并针对其进行EVM的初步分析，其实一个更好的方式是从智能合约、编译器和EVM虚拟机三个方面进行不同维度的说明，但这就超出了源码的分析范畴了。 更详细的智能合约编写、编译等，将单独开出一个系列来进行，在针对以太坊源码的分析中将不再展开。 如果对区块链和c++感兴趣，欢迎关注 阅读更多" />
<meta property="og:description" content="以太坊源码分析之八虚拟机 一、智能合约的编译分析 接上文，先搞一个小的智能合约，编译好，放到环境里执行看流程和结果，先看智能合约 ： pragma solidity ^0.4.4; &nbsp; contract HelloWorld { &nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t = t +1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return t; &nbsp;&nbsp;&nbsp; } }最简单的一个HelloWorld,简单就意味着好分析，第一行表示使用的solidity的版本，不同版本编译结果略有不同。^代表 兼容的版本，这里是指兼容0.4.4~0.4.9，当然你也可以指定更新的。 合约的主体结构和普通的编程方式没有太大的区别，使用 contract表示一个封装，你理解成类或者结构体都可以，它也可以有接口有继承。 内部访问有各种限制，公有私有和索引等。 然后将其拷贝到REMIX上，进行编译会发现有两个警告： browser/ballot_test.sol:4:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. &nbsp;&nbsp;&nbsp;&nbsp;function Hello( uint256 t) returns (uint256) { ^ (Relevant source part starts here and spans across multiple lines). &nbsp; browser/ballot_test.sol:4:5: Warning: Function state mutability can be restricted to pure &nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) { &nbsp;&nbsp;&nbsp; ^ (Relevant source part starts here and spans across multiple lines). 这两上警告主要是告诉你的代码写得不规范，没有明确的指定可访问性和限制属性，这两个都可以忽略。将其部署到私链上，调用即可返回“HelloWorld”的字符串。（部署的方法见前面的博客） 看一下它的编译结果： &nbsp; //全局初始化 .code &nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; //此处检测返回value,如果该合约构造函数不支持payable,不为0，revert &nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^ &nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n &nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\n contrac tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;//此处为返回接口代码初始化 &nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH #[$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH [$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; CODECOPY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... .data &nbsp; 0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //此处为接口判断代码 &nbsp;&nbsp;&nbsp; .code &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATASIZE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH FFFFFFFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 100000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 775A9482&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EQ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp; tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp; tag 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\n contrac &nbsp;&nbsp;&nbsp; tag 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; tag 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; tag 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP [out]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; .data &nbsp; 不要被吓到，前头一大堆都是格式化的东西，真正对分析有用处的是tag 5中的部分，明显可以看出指令增加和调换。然后跳转到返回。 看一下它的RUNTIME BYTECODE: { &nbsp;&nbsp;&nbsp; &quot;linkReferences&quot;: {}, &nbsp;&nbsp;&nbsp; &quot;object&quot;: &quot;608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029&quot;, &nbsp;&nbsp;&nbsp; &quot;opcodes&quot;: &quot;PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3E JUMPI PUSH4 0xFFFFFFFF PUSH29 0x100000000000000000000000000000000000000000000000000000000 PUSH1 0x0 CALLDATALOAD DIV AND PUSH4 0x775A9482 DUP2 EQ PUSH1 0x43 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE DUP1 ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x58 PUSH1 0x4 CALLDATALOAD PUSH1 0x6A JUMP JUMPDEST PUSH1 0x40 DUP1 MLOAD SWAP2 DUP3 MSTORE MLOAD SWAP1 DUP2 SWAP1 SUB PUSH1 0x20 ADD SWAP1 RETURN JUMPDEST PUSH1 0x1 ADD SWAP1 JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xc2 0xf8 0xe3 PUSH30 0xD71A65637998AD372A063DD9DF1DFD4214E967A8F469D7605F8855470029 &quot;, &nbsp;&nbsp;&nbsp; &quot;sourceMap&quot;: &quot;25:116:0:-;;;;;;;;;;;;;;;;;;;;;;;51:88;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;51:88:0;;;;;;;;;;;;;;;;;;;;;;113:1;110:4;;51:88::o&quot; } 再看一下部署的CODE： data: &#39;0x6080604052348015600f57600080fd5b50609c8061001e6000396000f300608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029&#39;, &nbsp; 不难发现，其实运行时的Code是部署的Code的一子集 。 下面分析一下： Push 1表示将临时变量压入栈中。 Add&nbsp; t+1表示将t和1相加并保存结果。 SWAP1 &nbsp;t+1表示将结果交换到t，即将栈顶元素与栈中第1个（SWAPI代表第I个）交换 JUMP [out] 就返回了结果 分析一小段相关的代码，见上面紫色部分：60200190f35b6001019056 先看一上标准操作码： 0x00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; STOP 0x01&nbsp; ADD 0x90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; SWAP1 0xf3 &nbsp; RETURN 0x5b&nbsp; JUMPDEST 0x60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; PUSH1 0x56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; JUMP 然后和代码对比： 60&nbsp;&nbsp;&nbsp; 01 PUSH 01 01&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp; &nbsp;&nbsp;t+1 90&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;swap1&nbsp; t=t+1 56&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 再将红色部分与 tag4对比，发现也是一致的。 通过上面的简单分析可以显示出，以太坊的虚拟机是基于栈操作的图灵完备（准确的说是准图灵完备）的虚拟机。 在编译合约时可以得到两个字节码： contract bytecode（合约字节码）：最终存储在区块链中的字节码，也是将字节码存放在区块链、初始化智能合约（运行构造函数）时所需的字节码。 runtime bytecode（运行时字节码）：对应于存储在区块链中的字节码，与合约初始化和存放过程无关。 前面已经提到过，后者是前者的一个子集。 而一个个的指令编译出来，就可以按照这个来收gas费用了，举一个例子： sstore指令第一次写入一个新位置需要花费20000 gas sstore指令后续写入一个已存在的位置需要花费5000 gas sload指令的成本是500 gas 大多数的指令成本是3~10 gas 智能合约的存储是收费比较高的，所以一定要注意合理使用变量。 到现在为止，一个虽然简单但是完整的智能合约就编译并分析出来，正好对应着一篇的分析，下面开始分析虚拟机的部分。 二、虚拟机分析 虚拟机部分主要在core/vm中，其它的地方散布着一些调用的接口相关的封装： &nbsp; &nbsp;analysis.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //跳转目标判定 &nbsp;common.go &nbsp;contract.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //合约数据结构 &nbsp;contracts.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //预编译好的合约 &nbsp;doc.go &nbsp;errors.go &nbsp;evm.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行器 对外提供一些外部接口&nbsp;&nbsp; &nbsp;gas.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //call gas花费计算 一级指令耗费gas级别 &nbsp;gas_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//指令耗费计算函数表 &nbsp;gen_structlog.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //日志数据结构生成 &nbsp;instructions.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //指令操作 &nbsp;interface.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;interpreter.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //解释器 调用核心 &nbsp;intpool.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //int值池 &nbsp;int_pool_verifier_empty.go &nbsp;int_pool_verifier.go &nbsp;jump_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//指令和指令操作（操作等）对应表 &nbsp;logger.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //状态日志 &nbsp;memory.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存 &nbsp;memory_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存操作表 主要判断操作所需内存 &nbsp;noop.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //空指令 &nbsp;opcodes.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Op指令 以及一些对应关系&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;runtime &nbsp;&nbsp; &nbsp;env.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行环境 &nbsp;&nbsp; &nbsp;fuzz.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Go随机测试工具 &nbsp;&nbsp; &nbsp;runtime.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //运行接口 测试使用 &nbsp;stack.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈 stack_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈验证 vm_jit.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //这两个文件基本被注释空 vm_jit_fake.go &nbsp; 它主要分为以下几类： 1、操作码（OpCode） 文件opcodes.go中定义了所有的OpCode，该值是一个byte，智能合约编译出来的bytecode中，一个OpCode就是上面的一位。opcodes按功能分为9组（运算相关，块操作，加密相关等）。 const ( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 0x40 range - block operations &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BLOCKHASH OpCode = 0x40 + iota &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COINBASE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TIMESTAMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMBER &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIFFICULTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GASLIMIT ) 前面已经分析过一个简单的合约。 2、指令和指令集。 jump.table.go定义了三种指令集合，每个集合实质上是个256长度的数组，名字翻译过来是荒地，农庄，拜占庭，指令集向前兼容。 &nbsp;&nbsp;&nbsp; frontierInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewFrontierInstructionSet() &nbsp;&nbsp;&nbsp; homesteadInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewHomesteadInstructionSet() &nbsp;&nbsp;&nbsp; byzantiumInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewByzantiumInstructionSet() 下面举一个例子： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MUL: { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; execute:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; opMul, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gasCost:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constGasFunc(GasFastStep), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validateStack: makeStackFunc(2, 1), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; valid:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, &nbsp; 3、栈和内存 栈是用来执行指令的一个容器，前面说过。 type Stack struct { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data []*big.Int } &nbsp; func newstack() *Stack { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Stack{data: make([]*big.Int, 0, 1024)} } &nbsp; func (st *Stack) Data() []*big.Int { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return st.data } 内存是提供指令数据存储的地方： // Memory implements a simple memory model for the ethereum virtual machine. type Memory struct { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; []byte &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastGasCost uint64 } &nbsp; func NewMemory() *Memory { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Memory{} } 4、状态数据库 状态数据库由stateDb来保存，持久化到内存中，并依据具体的情况保存到 leveldb中去。在指令集的操作函数中： func opSload(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop()) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := evm.StateDB.GetState(contract.Address(), loc).Big() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stack.push(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil } &nbsp; func opSstore(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop()) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := stack.pop() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.StateDB.SetState(contract.Address(), loc, common.BigToHash(val)) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.interpreter.intPool.put(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil } 5、入口函数 入口函数在前面提到了， evm.go中，Call，CallCode，StaticCall和DelegateCall，不再赘述。 6、解释执行 前面也提到了，Run函数： func (in *Interpreter) Run(contract *Contract, input []byte) (ret []byte, err error) {…} &nbsp; &nbsp; 三、以太坊的EVM说明 以太坊的虚拟机主要是为了执行智能合约而出现，在以太坊的系统中，外部帐户和合约帐户对EVM来说都是一致的。每个帐户都有一个&lt;key,value&gt;来形成持久化存储（仍然在内存中，根据情况可存储到区块上或者日志中），二者的长度均为256位。 同样，帐户在操作内存时，为了简单，是以32字节（256位）为单位的。内存可以在一定范围内线性增长，但是需要消耗gas。 前面分析了，EVM是基于栈而不是常见的计算机的基于寄存器的，说通俗些，其实就是一个后进先出的容器，来回根据指令操作。 EVM的指令集数量比较少，其指令操作的长度恒定为32字节（256位）长度。具备常用的算术、位、逻辑和比较操作。支持有条件和无条件跳转。同时提供合约访问当前区块的相关属性，比如它的编号和时间戳。 最重要的，合约可以通过索引数据结构，将存储的数据映射到区块上，永久保存，这被称为日志logs，Solidity用它来实现事件Events。外总程序可以通过接口，利用布隆过滤器（Bloom Filter），得到想得到的日志数据，而不需要将整个区块同步到本地上。 EVM的编译器并不会为字节码的大小、速度或内存高效性进行优化。它只会为gas的使用进行优化，目的很直接，鼓励计算排序，提高以太坊区块链的执行效率。 四、总结 前面通过一个简单的例子并针对其进行EVM的初步分析，其实一个更好的方式是从智能合约、编译器和EVM虚拟机三个方面进行不同维度的说明，但这就超出了源码的分析范畴了。 更详细的智能合约编写、编译等，将单独开出一个系列来进行，在针对以太坊源码的分析中将不再展开。 如果对区块链和c++感兴趣，欢迎关注 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/05/d87e28b720e8213fc01856b206eaac7a.html" />
<meta property="og:url" content="https://mlh.app/2018/08/05/d87e28b720e8213fc01856b206eaac7a.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"以太坊源码分析之八虚拟机 一、智能合约的编译分析 接上文，先搞一个小的智能合约，编译好，放到环境里执行看流程和结果，先看智能合约 ： pragma solidity ^0.4.4; &nbsp; contract HelloWorld { &nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t = t +1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return t; &nbsp;&nbsp;&nbsp; } }最简单的一个HelloWorld,简单就意味着好分析，第一行表示使用的solidity的版本，不同版本编译结果略有不同。^代表 兼容的版本，这里是指兼容0.4.4~0.4.9，当然你也可以指定更新的。 合约的主体结构和普通的编程方式没有太大的区别，使用 contract表示一个封装，你理解成类或者结构体都可以，它也可以有接口有继承。 内部访问有各种限制，公有私有和索引等。 然后将其拷贝到REMIX上，进行编译会发现有两个警告： browser/ballot_test.sol:4:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. &nbsp;&nbsp;&nbsp;&nbsp;function Hello( uint256 t) returns (uint256) { ^ (Relevant source part starts here and spans across multiple lines). &nbsp; browser/ballot_test.sol:4:5: Warning: Function state mutability can be restricted to pure &nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) { &nbsp;&nbsp;&nbsp; ^ (Relevant source part starts here and spans across multiple lines). 这两上警告主要是告诉你的代码写得不规范，没有明确的指定可访问性和限制属性，这两个都可以忽略。将其部署到私链上，调用即可返回“HelloWorld”的字符串。（部署的方法见前面的博客） 看一下它的编译结果： &nbsp; //全局初始化 .code &nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; //此处检测返回value,如果该合约构造函数不支持payable,不为0，revert &nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^ &nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n &nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\\n contrac tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;//此处为返回接口代码初始化 &nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH #[$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH [$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; CODECOPY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... .data &nbsp; 0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //此处为接口判断代码 &nbsp;&nbsp;&nbsp; .code &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATASIZE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH FFFFFFFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 100000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 775A9482&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EQ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp; tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\\n&nbsp;&nbsp;&nbsp; fun... &nbsp;&nbsp;&nbsp; tag 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\\n contrac &nbsp;&nbsp;&nbsp; tag 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; tag 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; tag 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP [out]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret... &nbsp;&nbsp;&nbsp; .data &nbsp; 不要被吓到，前头一大堆都是格式化的东西，真正对分析有用处的是tag 5中的部分，明显可以看出指令增加和调换。然后跳转到返回。 看一下它的RUNTIME BYTECODE: { &nbsp;&nbsp;&nbsp; &quot;linkReferences&quot;: {}, &nbsp;&nbsp;&nbsp; &quot;object&quot;: &quot;608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029&quot;, &nbsp;&nbsp;&nbsp; &quot;opcodes&quot;: &quot;PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3E JUMPI PUSH4 0xFFFFFFFF PUSH29 0x100000000000000000000000000000000000000000000000000000000 PUSH1 0x0 CALLDATALOAD DIV AND PUSH4 0x775A9482 DUP2 EQ PUSH1 0x43 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE DUP1 ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x58 PUSH1 0x4 CALLDATALOAD PUSH1 0x6A JUMP JUMPDEST PUSH1 0x40 DUP1 MLOAD SWAP2 DUP3 MSTORE MLOAD SWAP1 DUP2 SWAP1 SUB PUSH1 0x20 ADD SWAP1 RETURN JUMPDEST PUSH1 0x1 ADD SWAP1 JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xc2 0xf8 0xe3 PUSH30 0xD71A65637998AD372A063DD9DF1DFD4214E967A8F469D7605F8855470029 &quot;, &nbsp;&nbsp;&nbsp; &quot;sourceMap&quot;: &quot;25:116:0:-;;;;;;;;;;;;;;;;;;;;;;;51:88;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;51:88:0;;;;;;;;;;;;;;;;;;;;;;113:1;110:4;;51:88::o&quot; } 再看一下部署的CODE： data: &#39;0x6080604052348015600f57600080fd5b50609c8061001e6000396000f300608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029&#39;, &nbsp; 不难发现，其实运行时的Code是部署的Code的一子集 。 下面分析一下： Push 1表示将临时变量压入栈中。 Add&nbsp; t+1表示将t和1相加并保存结果。 SWAP1 &nbsp;t+1表示将结果交换到t，即将栈顶元素与栈中第1个（SWAPI代表第I个）交换 JUMP [out] 就返回了结果 分析一小段相关的代码，见上面紫色部分：60200190f35b6001019056 先看一上标准操作码： 0x00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; STOP 0x01&nbsp; ADD 0x90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; SWAP1 0xf3 &nbsp; RETURN 0x5b&nbsp; JUMPDEST 0x60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; PUSH1 0x56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; JUMP 然后和代码对比： 60&nbsp;&nbsp;&nbsp; 01 PUSH 01 01&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp; &nbsp;&nbsp;t+1 90&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;swap1&nbsp; t=t+1 56&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 再将红色部分与 tag4对比，发现也是一致的。 通过上面的简单分析可以显示出，以太坊的虚拟机是基于栈操作的图灵完备（准确的说是准图灵完备）的虚拟机。 在编译合约时可以得到两个字节码： contract bytecode（合约字节码）：最终存储在区块链中的字节码，也是将字节码存放在区块链、初始化智能合约（运行构造函数）时所需的字节码。 runtime bytecode（运行时字节码）：对应于存储在区块链中的字节码，与合约初始化和存放过程无关。 前面已经提到过，后者是前者的一个子集。 而一个个的指令编译出来，就可以按照这个来收gas费用了，举一个例子： sstore指令第一次写入一个新位置需要花费20000 gas sstore指令后续写入一个已存在的位置需要花费5000 gas sload指令的成本是500 gas 大多数的指令成本是3~10 gas 智能合约的存储是收费比较高的，所以一定要注意合理使用变量。 到现在为止，一个虽然简单但是完整的智能合约就编译并分析出来，正好对应着一篇的分析，下面开始分析虚拟机的部分。 二、虚拟机分析 虚拟机部分主要在core/vm中，其它的地方散布着一些调用的接口相关的封装： &nbsp; &nbsp;analysis.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //跳转目标判定 &nbsp;common.go &nbsp;contract.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //合约数据结构 &nbsp;contracts.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //预编译好的合约 &nbsp;doc.go &nbsp;errors.go &nbsp;evm.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行器 对外提供一些外部接口&nbsp;&nbsp; &nbsp;gas.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //call gas花费计算 一级指令耗费gas级别 &nbsp;gas_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//指令耗费计算函数表 &nbsp;gen_structlog.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //日志数据结构生成 &nbsp;instructions.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //指令操作 &nbsp;interface.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;interpreter.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //解释器 调用核心 &nbsp;intpool.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //int值池 &nbsp;int_pool_verifier_empty.go &nbsp;int_pool_verifier.go &nbsp;jump_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//指令和指令操作（操作等）对应表 &nbsp;logger.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //状态日志 &nbsp;memory.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存 &nbsp;memory_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存操作表 主要判断操作所需内存 &nbsp;noop.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //空指令 &nbsp;opcodes.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Op指令 以及一些对应关系&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;runtime &nbsp;&nbsp; &nbsp;env.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行环境 &nbsp;&nbsp; &nbsp;fuzz.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Go随机测试工具 &nbsp;&nbsp; &nbsp;runtime.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //运行接口 测试使用 &nbsp;stack.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈 stack_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈验证 vm_jit.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //这两个文件基本被注释空 vm_jit_fake.go &nbsp; 它主要分为以下几类： 1、操作码（OpCode） 文件opcodes.go中定义了所有的OpCode，该值是一个byte，智能合约编译出来的bytecode中，一个OpCode就是上面的一位。opcodes按功能分为9组（运算相关，块操作，加密相关等）。 const ( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 0x40 range - block operations &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BLOCKHASH OpCode = 0x40 + iota &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COINBASE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TIMESTAMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMBER &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIFFICULTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GASLIMIT ) 前面已经分析过一个简单的合约。 2、指令和指令集。 jump.table.go定义了三种指令集合，每个集合实质上是个256长度的数组，名字翻译过来是荒地，农庄，拜占庭，指令集向前兼容。 &nbsp;&nbsp;&nbsp; frontierInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewFrontierInstructionSet() &nbsp;&nbsp;&nbsp; homesteadInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewHomesteadInstructionSet() &nbsp;&nbsp;&nbsp; byzantiumInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewByzantiumInstructionSet() 下面举一个例子： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MUL: { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; execute:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; opMul, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gasCost:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constGasFunc(GasFastStep), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validateStack: makeStackFunc(2, 1), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; valid:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, &nbsp; 3、栈和内存 栈是用来执行指令的一个容器，前面说过。 type Stack struct { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data []*big.Int } &nbsp; func newstack() *Stack { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Stack{data: make([]*big.Int, 0, 1024)} } &nbsp; func (st *Stack) Data() []*big.Int { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return st.data } 内存是提供指令数据存储的地方： // Memory implements a simple memory model for the ethereum virtual machine. type Memory struct { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; []byte &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastGasCost uint64 } &nbsp; func NewMemory() *Memory { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Memory{} } 4、状态数据库 状态数据库由stateDb来保存，持久化到内存中，并依据具体的情况保存到 leveldb中去。在指令集的操作函数中： func opSload(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop()) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := evm.StateDB.GetState(contract.Address(), loc).Big() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stack.push(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil } &nbsp; func opSstore(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop()) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := stack.pop() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.StateDB.SetState(contract.Address(), loc, common.BigToHash(val)) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.interpreter.intPool.put(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil } 5、入口函数 入口函数在前面提到了， evm.go中，Call，CallCode，StaticCall和DelegateCall，不再赘述。 6、解释执行 前面也提到了，Run函数： func (in *Interpreter) Run(contract *Contract, input []byte) (ret []byte, err error) {…} &nbsp; &nbsp; 三、以太坊的EVM说明 以太坊的虚拟机主要是为了执行智能合约而出现，在以太坊的系统中，外部帐户和合约帐户对EVM来说都是一致的。每个帐户都有一个&lt;key,value&gt;来形成持久化存储（仍然在内存中，根据情况可存储到区块上或者日志中），二者的长度均为256位。 同样，帐户在操作内存时，为了简单，是以32字节（256位）为单位的。内存可以在一定范围内线性增长，但是需要消耗gas。 前面分析了，EVM是基于栈而不是常见的计算机的基于寄存器的，说通俗些，其实就是一个后进先出的容器，来回根据指令操作。 EVM的指令集数量比较少，其指令操作的长度恒定为32字节（256位）长度。具备常用的算术、位、逻辑和比较操作。支持有条件和无条件跳转。同时提供合约访问当前区块的相关属性，比如它的编号和时间戳。 最重要的，合约可以通过索引数据结构，将存储的数据映射到区块上，永久保存，这被称为日志logs，Solidity用它来实现事件Events。外总程序可以通过接口，利用布隆过滤器（Bloom Filter），得到想得到的日志数据，而不需要将整个区块同步到本地上。 EVM的编译器并不会为字节码的大小、速度或内存高效性进行优化。它只会为gas的使用进行优化，目的很直接，鼓励计算排序，提高以太坊区块链的执行效率。 四、总结 前面通过一个简单的例子并针对其进行EVM的初步分析，其实一个更好的方式是从智能合约、编译器和EVM虚拟机三个方面进行不同维度的说明，但这就超出了源码的分析范畴了。 更详细的智能合约编写、编译等，将单独开出一个系列来进行，在针对以太坊源码的分析中将不再展开。 如果对区块链和c++感兴趣，欢迎关注 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/05/d87e28b720e8213fc01856b206eaac7a.html","headline":"以太坊源码分析之八虚拟机","dateModified":"2018-08-05T00:00:00+08:00","datePublished":"2018-08-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/05/d87e28b720e8213fc01856b206eaac7a.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊源码分析之八虚拟机</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="margin-left:0cm;"><strong>以太坊源码分析之八虚拟机</strong></p> 
  <p style="margin-left:0cm;">一、智能合约的编译分析</p> 
  <p style="margin-left:0cm;">接上文，先搞一个小的智能合约，编译好，放到环境里执行看流程和结果，先看智能合约 ：</p> 
  <p style="margin-left:0cm;">pragma solidity ^0.4.4;</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">contract HelloWorld {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t = t +1;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return t;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}最简单的一个HelloWorld,简单就意味着好分析，第一行表示使用的solidity的版本，不同版本编译结果略有不同。^代表 兼容的版本，这里是指兼容0.4.4~0.4.9，当然你也可以指定更新的。</p> 
  <p style="margin-left:0cm;">合约的主体结构和普通的编程方式没有太大的区别，使用 contract表示一个封装，你理解成类或者结构体都可以，它也可以有接口有继承。</p> 
  <p style="margin-left:0cm;">内部访问有各种限制，公有私有和索引等。</p> 
  <p style="margin-left:0cm;">然后将其拷贝到REMIX上，进行编译会发现有两个警告：</p> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">browser/ballot_test.sol:4:5: Warning: No visibility specified. Defaulting to "public". </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;function Hello( uint256 t) returns (uint256) {</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">^ (Relevant source part starts here and spans across multiple lines).</code></pre> 
  <pre style="margin-left:0cm;">

<code class="language-html hljs">&nbsp;</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">browser/ballot_test.sol:4:5: Warning: Function state mutability can be restricted to pure</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; function Hello( uint256 t) returns (uint256) {</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; ^ (Relevant source part starts here and spans across multiple lines).</code></pre> 
  <p style="margin-left:0cm;">这两上警告主要是告诉你的代码写得不规范，没有明确的指定可访问性和限制属性，这两个都可以忽略。将其部署到私链上，调用即可返回“HelloWorld”的字符串。（部署的方法见前面的博客）</p> 
  <p style="margin-left:0cm;">看一下它的编译结果：</p> 
  <p style="margin-left:0cm;">&nbsp; //全局初始化</p> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">.code</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; //此处检测返回value,如果该合约构造函数不支持payable,不为0，revert</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\n</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">contrac</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a &nbsp;&nbsp;&nbsp;&nbsp;//此处为返回接口代码初始化</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; PUSH #[$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; PUSH [$] 0000000000000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; CODECOPY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">.data</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp; 0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //此处为接口判断代码</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; .code</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATASIZE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH FFFFFFFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 100000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIV &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 775A9482&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EQ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; tag 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; contract HelloWorld {\n&nbsp;&nbsp;&nbsp; fun...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; tag 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLVALUE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; olidity ^</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ISZERO &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REVERT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .4;\n</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">contrac</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; tag 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUSH [tag] 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CALLDATALOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH [tag] 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; tag 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSTORE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MLOAD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DUP2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; tag 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMPDEST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PUSH 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ADD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SWAP1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t +1</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JUMP [out]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function Hello( uint256 t) ret...</code></pre> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">&nbsp;&nbsp;&nbsp; .data</code></pre> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">不要被吓到，前头一大堆都是格式化的东西，真正对分析有用处的是tag 5中的部分，明显可以看出指令增加和调换。然后跳转到返回。</p> 
  <p style="margin-left:0cm;">看一下它的RUNTIME BYTECODE:</p> 
  <p style="margin-left:0cm;">{</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; "linkReferences": {},</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; "object": "608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029",</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; "opcodes": "PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3E JUMPI PUSH4 0xFFFFFFFF PUSH29 0x100000000000000000000000000000000000000000000000000000000 PUSH1 0x0 CALLDATALOAD DIV AND PUSH4 0x775A9482 DUP2 EQ PUSH1 0x43 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE DUP1 ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP PUSH1 0x58 PUSH1 0x4 CALLDATALOAD PUSH1 0x6A JUMP JUMPDEST PUSH1 0x40 DUP1 MLOAD SWAP2 DUP3 MSTORE MLOAD SWAP1 DUP2 SWAP1 SUB PUSH1 0x20 ADD SWAP1 RETURN JUMPDEST PUSH1 0x1 ADD SWAP1 JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xc2 0xf8 0xe3 PUSH30 0xD71A65637998AD372A063DD9DF1DFD4214E967A8F469D7605F8855470029 ",</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; "sourceMap": "25:116:0:-;;;;;;;;;;;;;;;;;;;;;;;51:88;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;51:88:0;;;;;;;;;;;;;;;;;;;;;;113:1;110:4;;51:88::o"</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">再看一下部署的CODE：</p> 
  <pre style="margin-left:0cm;">
<code class="language-html hljs">data: '0x6080604052348015600f57600080fd5b50609c8061001e6000396000f300608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663775a948281146043575b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b600101905600a165627a7a72305820c2f8e37dd71a65637998ad372a063dd9df1dfd4214e967a8f469d7605f8855470029', </code></pre> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">不难发现，其实运行时的Code是部署的Code的一子集 。</p> 
  <p style="margin-left:0cm;">下面分析一下：</p> 
  <p style="margin-left:0cm;">Push 1表示将临时变量压入栈中。</p> 
  <p style="margin-left:0cm;">Add&nbsp; t+1表示将t和1相加并保存结果。</p> 
  <p style="margin-left:0cm;">SWAP1 &nbsp;t+1表示将结果交换到t，即将栈顶元素与栈中第1个（SWAPI代表第I个）交换</p> 
  <p style="margin-left:0cm;">JUMP [out] 就返回了结果</p> 
  <p style="margin-left:0cm;">分析一小段相关的代码，见上面紫色部分：<strong><span style="color:#ff0000;">60200190f35b</span><span style="color:#002060;">6001019056</span></strong></p> 
  <p style="margin-left:0cm;">先看一上标准操作码：</p> 
  <p style="margin-left:0cm;">0x00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; STOP</p> 
  <p style="margin-left:0cm;">0x01&nbsp; ADD</p> 
  <p style="margin-left:0cm;">0x90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; SWAP1</p> 
  <p style="margin-left:0cm;">0xf3 &nbsp; RETURN</p> 
  <p style="margin-left:0cm;">0x5b&nbsp; JUMPDEST</p> 
  <p style="margin-left:0cm;">0x60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; PUSH1</p> 
  <p style="margin-left:0cm;">0x56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; JUMP</p> 
  <p style="margin-left:0cm;">然后和代码对比：</p> 
  <p style="margin-left:0cm;">60&nbsp;&nbsp;&nbsp; 01</p> 
  <p style="margin-left:0cm;">PUSH 01</p> 
  <p style="margin-left:0cm;">01&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp; &nbsp;&nbsp;t+1</p> 
  <p style="margin-left:0cm;">90&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;swap1&nbsp; t=t+1</p> 
  <p style="margin-left:0cm;">56&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">再将红色部分与 tag4对比，发现也是一致的。</p> 
  <p style="margin-left:0cm;">通过上面的简单分析可以显示出，以太坊的虚拟机是基于栈操作的图灵完备（准确的说是准图灵完备）的虚拟机。</p> 
  <p style="margin-left:0cm;">在编译合约时可以得到两个字节码：</p> 
  <p style="margin-left:0cm;">contract bytecode（合约字节码）：最终存储在区块链中的字节码，也是将字节码存放在区块链、初始化智能合约（运行构造函数）时所需的字节码。</p> 
  <p style="margin-left:0cm;">runtime bytecode（运行时字节码）：对应于存储在区块链中的字节码，与合约初始化和存放过程无关。</p> 
  <p style="margin-left:0cm;">前面已经提到过，后者是前者的一个子集。</p> 
  <p style="margin-left:0cm;">而一个个的指令编译出来，就可以按照这个来收gas费用了，举一个例子：</p> 
  <p style="margin-left:0cm;">sstore指令第一次写入一个新位置需要花费20000 gas</p> 
  <p style="margin-left:0cm;">sstore指令后续写入一个已存在的位置需要花费5000 gas</p> 
  <p style="margin-left:0cm;">sload指令的成本是500 gas</p> 
  <p style="margin-left:0cm;">大多数的指令成本是3~10 gas</p> 
  <p style="margin-left:0cm;">智能合约的存储是收费比较高的，所以一定要注意合理使用变量。</p> 
  <p style="margin-left:0cm;">到现在为止，一个虽然简单但是完整的智能合约就编译并分析出来，正好对应着一篇的分析，下面开始分析虚拟机的部分。</p> 
  <p style="margin-left:0cm;">二、虚拟机分析</p> 
  <p style="margin-left:0cm;">虚拟机部分主要在core/vm中，其它的地方散布着一些调用的接口相关的封装：</p> 
  <p style="margin-left:0cm;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180805083255605?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZwY2M=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;analysis.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //跳转目标判定</p> 
  <p style="margin-left:0cm;">&nbsp;common.go</p> 
  <p style="margin-left:0cm;">&nbsp;contract.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //合约数据结构</p> 
  <p style="margin-left:0cm;">&nbsp;contracts.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //预编译好的合约</p> 
  <p style="margin-left:0cm;">&nbsp;doc.go</p> 
  <p style="margin-left:0cm;">&nbsp;errors.go</p> 
  <p style="margin-left:0cm;">&nbsp;evm.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行器 对外提供一些外部接口&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;gas.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //call gas花费计算 一级指令耗费gas级别</p> 
  <p style="margin-left:0cm;">&nbsp;gas_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//指令耗费计算函数表</p> 
  <p style="margin-left:0cm;">&nbsp;gen_structlog.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //日志数据结构生成</p> 
  <p style="margin-left:0cm;">&nbsp;instructions.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //指令操作</p> 
  <p style="margin-left:0cm;">&nbsp;interface.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;interpreter.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //解释器 调用核心</p> 
  <p style="margin-left:0cm;">&nbsp;intpool.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //int值池</p> 
  <p style="margin-left:0cm;">&nbsp;int_pool_verifier_empty.go</p> 
  <p style="margin-left:0cm;">&nbsp;int_pool_verifier.go</p> 
  <p style="margin-left:0cm;">&nbsp;jump_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//指令和指令操作（操作等）对应表</p> 
  <p style="margin-left:0cm;">&nbsp;logger.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //状态日志</p> 
  <p style="margin-left:0cm;">&nbsp;memory.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存</p> 
  <p style="margin-left:0cm;">&nbsp;memory_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //EVM 内存操作表 主要判断操作所需内存</p> 
  <p style="margin-left:0cm;">&nbsp;noop.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //空指令</p> 
  <p style="margin-left:0cm;">&nbsp;opcodes.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Op指令 以及一些对应关系&nbsp;&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;runtime</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;env.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //执行环境</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;fuzz.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Go随机测试工具</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;runtime.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //运行接口 测试使用</p> 
  <p style="margin-left:0cm;">&nbsp;stack.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈</p> 
  <p style="margin-left:0cm;">stack_table.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //栈验证</p> 
  <p style="margin-left:0cm;">vm_jit.go&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //这两个文件基本被注释空</p> 
  <p style="margin-left:0cm;">vm_jit_fake.go</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">它主要分为以下几类：</p> 
  <p style="margin-left:0cm;">1、操作码（OpCode）</p> 
  <p style="margin-left:0cm;">文件opcodes.go中定义了所有的OpCode，该值是一个byte，智能合约编译出来的bytecode中，一个OpCode就是上面的一位。opcodes按功能分为9组（运算相关，块操作，加密相关等）。</p> 
  <p style="margin-left:0cm;">const (</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 0x40 range - block operations</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BLOCKHASH OpCode = 0x40 + iota</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COINBASE</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TIMESTAMP</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NUMBER</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DIFFICULTY</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GASLIMIT</p> 
  <p style="margin-left:0cm;">)</p> 
  <p style="margin-left:0cm;">前面已经分析过一个简单的合约。</p> 
  <p style="margin-left:0cm;">2、指令和指令集。</p> 
  <p style="margin-left:0cm;">jump.table.go定义了三种指令集合，每个集合实质上是个256长度的数组，名字翻译过来是荒地，农庄，拜占庭，指令集向前兼容。</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; frontierInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewFrontierInstructionSet()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; homesteadInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewHomesteadInstructionSet()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; byzantiumInstructionSet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = NewByzantiumInstructionSet()</p> 
  <p style="margin-left:0cm;">下面举一个例子：</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MUL: {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; execute:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; opMul,</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gasCost:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; constGasFunc(GasFastStep),</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validateStack: makeStackFunc(2, 1),</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; valid:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true,</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">3、栈和内存</p> 
  <p style="margin-left:0cm;">栈是用来执行指令的一个容器，前面说过。</p> 
  <p style="margin-left:0cm;">type Stack struct {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data []*big.Int</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">func newstack() *Stack {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Stack{data: make([]*big.Int, 0, 1024)}</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">func (st *Stack) Data() []*big.Int {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return st.data</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">内存是提供指令数据存储的地方：</p> 
  <p style="margin-left:0cm;">// Memory implements a simple memory model for the ethereum virtual machine.</p> 
  <p style="margin-left:0cm;">type Memory struct {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; store&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; []byte</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastGasCost uint64</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">func NewMemory() *Memory {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &amp;Memory{}</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">4、状态数据库</p> 
  <p style="margin-left:0cm;">状态数据库由stateDb来保存，持久化到内存中，并依据具体的情况保存到 leveldb中去。在指令集的操作函数中：</p> 
  <p style="margin-left:0cm;">func opSload(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop())</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := evm.StateDB.GetState(contract.Address(), loc).Big()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stack.push(val)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">func opSstore(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc := common.BigToHash(stack.pop())</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val := stack.pop()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.StateDB.SetState(contract.Address(), loc, common.BigToHash(val))</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evm.interpreter.intPool.put(val)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return nil, nil</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">5、入口函数</p> 
  <p style="margin-left:0cm;">入口函数在前面提到了， evm.go中，Call，CallCode，StaticCall和DelegateCall，不再赘述。</p> 
  <p style="margin-left:0cm;">6、解释执行</p> 
  <p style="margin-left:0cm;">前面也提到了，Run函数：</p> 
  <p style="margin-left:0cm;">func (in *Interpreter) Run(contract *Contract, input []byte) (ret []byte, err error) {…}</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">三、以太坊的EVM说明</p> 
  <p style="margin-left:0cm;">以太坊的虚拟机主要是为了执行智能合约而出现，在以太坊的系统中，外部帐户和合约帐户对EVM来说都是一致的。每个帐户都有一个&lt;key,value&gt;来形成持久化存储（仍然在内存中，根据情况可存储到区块上或者日志中），二者的长度均为256位。</p> 
  <p style="margin-left:0cm;">同样，帐户在操作内存时，为了简单，是以32字节（256位）为单位的。内存可以在一定范围内线性增长，但是需要消耗gas。</p> 
  <p style="margin-left:0cm;">前面分析了，EVM是基于栈而不是常见的计算机的基于寄存器的，说通俗些，其实就是一个后进先出的容器，来回根据指令操作。</p> 
  <p style="margin-left:0cm;">EVM的指令集数量比较少，其指令操作的长度恒定为32字节（256位）长度。具备常用的算术、位、逻辑和比较操作。支持有条件和无条件跳转。同时提供合约访问当前区块的相关属性，比如它的编号和时间戳。</p> 
  <p style="margin-left:0cm;">最重要的，合约可以通过索引数据结构，将存储的数据映射到区块上，永久保存，这被称为日志logs，Solidity用它来实现事件Events。外总程序可以通过接口，利用布隆过滤器（Bloom Filter），得到想得到的日志数据，而不需要将整个区块同步到本地上。</p> 
  <p style="margin-left:0cm;">EVM的编译器并不会为字节码的大小、速度或内存高效性进行优化。它只会为gas的使用进行优化，目的很直接，鼓励计算排序，提高以太坊区块链的执行效率。</p> 
  <p style="margin-left:0cm;">四、总结</p> 
  <p style="margin-left:0cm;">前面通过一个简单的例子并针对其进行EVM的初步分析，其实一个更好的方式是从智能合约、编译器和EVM虚拟机三个方面进行不同维度的说明，但这就超出了源码的分析范畴了。</p> 
  <p style="margin-left:0cm;">更详细的智能合约编写、编译等，将单独开出一个系列来进行，在针对以太坊源码的分析中将不再展开。</p> 
  <p style="margin-left:0cm;">如果对区块链和c++感兴趣，欢迎关注</p> 
  <p style="margin-left:0cm;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180805103546414?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZwY2M=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/fpcc/article/details/81427660,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/fpcc/article/details/81427660,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

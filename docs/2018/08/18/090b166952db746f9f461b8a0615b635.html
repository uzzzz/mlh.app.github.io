<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊源码分析(10)CMD深入分析 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊源码分析(10)CMD深入分析" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="### cmd包分析 #### cmd下面总共有13个子包，除了util包之外，每个子包都有一个主函数,每个主函数的init方法中都定义了该主函数支持的命令，如 &nbsp; ##### geth包下面的： &nbsp; ``` func init() { &nbsp;&nbsp;&nbsp;&nbsp;// Initialize the CLI app and start Geth &nbsp;&nbsp;&nbsp;&nbsp;app.Action = geth &nbsp;&nbsp;&nbsp;&nbsp;app.HideVersion = true // we have a command to print the version &nbsp;&nbsp;&nbsp;&nbsp;app.Copyright = &quot;Copyright 2013-2017 The go-ethereum Authors&quot; &nbsp;&nbsp;&nbsp;&nbsp;app.Commands = []cli.Command{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See chaincmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;importCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exportCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copydbCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removedbCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See monitorcmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;monitorCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See accountcmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accountCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;walletCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See consolecmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consoleCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javascriptCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See misccmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makecacheCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makedagCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bugCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;licenseCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See config.go &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpConfigCommand, &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;sort.Sort(cli.CommandsByName(app.Commands)) } ``` &nbsp; ###### 再单独分析initCommand: &nbsp; ``` initCommand = cli.Command{ Action: utils.MigrateFlags(initGenesis), Name: &quot;init&quot;, Usage: &quot;Bootstrap and initialize a new genesis block&quot;, ArgsUsage: &quot;&lt;genesisPath&gt;&quot;, Flags: []cli.Flag{ utils.DataDirFlag, utils.LightModeFlag, }, Category: &quot;BLOCKCHAIN COMMANDS&quot;, Description: ` The init command initializes a new genesis block and definition for the network. This is a destructive action and changes the network in which you will be participating. &nbsp; ``` &nbsp; ###### 其中Name是对应命令的指令，action是调用该指令去完成的动作，usage表示用途,arguUsage显示该命令后面跟的参数个数以及每个参数的意义, ###### 该init方法其实就是去初始化创世块,flags代表的是这个子命令额外可以执行的命令,如改init命令可以携带两个参数，点进去utils.DataDirFlag可以看到： &nbsp; ``` // General settings DataDirFlag = DirectoryFlag{ Name: &quot;datadir&quot;, Usage: &quot;Data directory for the databases and keystore&quot;, Value: DirectoryString{node.DefaultDataDir()}, } ``` &nbsp; *&nbsp;__可以用 --datadir [dir]来指定数据库的路径，如果没有指定由于该参数有value所以会启用默认的路径，也是home目录下面的.ethereum.__ &nbsp; *&nbsp;__/cmd/wnode/main.go　通过连接其他节点启动__ &nbsp; *&nbsp;__/cmd/geth /cmd/swarm　都是定义了很多命令__ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ### eth下cmd的rlpdump子包,该包的主要作用从给定文件中转储RLP数据以可读的形式．如果文件名被省略，数据将从stdin中读取 &nbsp; 　 /rlpdump &nbsp; ##### 解码rlp的数据 &nbsp; ###### rlpdump的command的help &nbsp; ``` Usage: /tmp/___cmd_rlpdump_test [-noascii] [-hex &lt;data&gt;] [filename] -hex string &nbsp;&nbsp;dump given hex data -noascii &nbsp;&nbsp;don&#39;t print ASCII strings readably -single &nbsp;&nbsp;print only the first element, discard the rest &nbsp; Dumps RLP data from the given file in readable form. If the filename is omitted, data is read from stdin. &nbsp; ``` &nbsp; ###### example1: ``` demo command: --hex f872f870845609a1ba64c0b8660480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee8580 success_result_demo: [ [ 5609a1ba, &quot;d&quot;, [], 0480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee85, &quot;&quot;, ], ] ``` &nbsp; ###### example2: &nbsp; ``` demo command: --noascii --hex CE0183FFFFFFC4C304050583616263 success_result_demo: [ 01, ffffff, [ [ 04, 05, 05, ], ], 616263, ] &nbsp; ``` ### cmd包下的p2psim子包的分析, p2psim is a command line client for the HTTP API &nbsp; ##### 首先我们启动对应的main函数,对应的启动参数是`--help`,来查看该包下所有命令的使用,结果如下: &nbsp; ``` NAME: ___go_build_main_go__1_ - devp2p simulation command-line client &nbsp; USAGE: ___go_build_main_go__1_ [global options] command [command options] [arguments...] &nbsp; VERSION: 0.0.0 &nbsp; COMMANDS: show show network information events stream network events snapshot create a network snapshot to stdout load load a network snapshot from stdin node manage simulation nodes help, h Shows a list of commands or help for one command &nbsp; GLOBAL OPTIONS: --api value simulation API URL (default: &quot;http://localhost:8888&quot;) [$P2PSIM_API_URL] --help, -h show help --version, -v print the version ``` &nbsp; ##### 该子包提供如何下的命令: ``` p2psim show p2psim events [--current] [--filter=FILTER] p2psim snapshot p2psim load p2psim node create [--name=NAME] [--services=SERVICES] [--key=KEY] p2psim node list p2psim node show &lt;node&gt; p2psim node start &lt;node&gt; p2psim node stop &lt;node&gt; p2psim node connect &lt;node&gt; &lt;peer&gt; p2psim node disconnect &lt;node&gt; &lt;peer&gt; p2psim node rpc &lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe] &nbsp; ``` &nbsp; ##### 要正常使用该子包下的命令，我们需要运行`/p2p/simulations/examples/ping-pong.go`的主函数来启动一个包含运行简单的节点的仿真网络. 正常启动后,你将看到: ``` INFO [01-23|11:17:10] using sim adapter INFO [01-23|11:17:10] starting simulation server on 0.0.0.0:8888... &nbsp; ``` &nbsp; ##### 该服务启动后,提供如下的API,其作用等同于上面的命令,命令调用的实现其实就是调用API,访问的路径前缀就是`0.0.0.0:8888`: ``` GET / Get network information POST /start Start all nodes in the network POST /stop Stop all nodes in the network GET /events Stream network events GET /snapshot Take a network snapshot POST /snapshot Load a network snapshot POST /nodes Create a node GET /nodes Get all nodes in the network GET /nodes/:nodeid Get node information POST /nodes/:nodeid/start Start a node POST /nodes/:nodeid/stop Stop a node POST /nodes/:nodeid/conn/:peerid Connect two nodes DELETE /nodes/:nodeid/conn/:peerid Disconnect two nodes GET /nodes/:nodeid/rpc Make RPC requests to a node via WebSocket &nbsp; ``` &nbsp; ##### 此处不深究API,仿真网络的服务已经起来了,下面开始p2psim包下命令的使用: &nbsp; __/p2psim__ &nbsp; *&nbsp;show ``` function:显示当前仿真网络的状态 args:&quot;&quot; demo: show notice: success_result_demo: NODES 0 CONNS 0 &nbsp; ``` &nbsp; *&nbsp;snapshot ``` function:导出当前仿真网络的节点信息 args:&quot;&quot; demo: shapshot notice: success_result_demo: {&quot;nodes&quot;:[{&quot;node&quot;:{&quot;config&quot;:{&quot;id&quot;:&quot;085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d&quot;,&quot;private_key&quot;:&quot;3480d230f453e7c207bbd3b770bf774dc8a17e599394f9283147a35c3ead561c&quot;,&quot;name&quot;:&quot;node1&quot;,&quot;services&quot;:[&quot;ping-pong&quot;]},&quot;up&quot;:true}},{&quot;node&quot;:{&quot;config&quot;:{&quot;id&quot;:&quot;cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b&quot;,&quot;private_key&quot;:&quot;b7592cdeee6195c4486fcdd8007e1aedfd3a49e6c9f53e0845bf977d4ad043cc&quot;,&quot;name&quot;:&quot;node2&quot;,&quot;services&quot;:[&quot;ping-pong&quot;]},&quot;up&quot;:false}}],&quot;conns&quot;:[{&quot;one&quot;:&quot;cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b&quot;,&quot;other&quot;:&quot;085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d&quot;,&quot;up&quot;:false}]} &nbsp; ``` &nbsp; *&nbsp;node &gt;&nbsp;*&nbsp;create ``` function:创建一个节点 args:[--name=NAME] [--services=SERVICES] [--key=KEY] demo: node create --name node1 notice: success_result_demo: Created node1 ``` &gt;&nbsp;*&nbsp;list ``` function:列出当前仿真网络的节点信息 args:&quot;&quot; demo: node list notice: success_result_demo: NAME PROTOCOLS ID node1 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d node2 cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b &nbsp; ``` &gt;&nbsp;*&nbsp;show ``` function:查看仿真网络中某个节点的具体信息 args:&lt;node&gt; demo: node show node1 notice: success_result_demo: NAME node1 PROTOCOLS ID 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d ENODE enode://085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d@127.0.0.1:30303 ``` &gt;&nbsp;*&nbsp;start ``` function:启动一个节点 args:&lt;node&gt; demo: node start node1 notice: success_result_demo: Started node1 ``` &gt;&nbsp;*&nbsp;connect ``` function:将一个节点连接到另外一个节点 args:&lt;node&gt; &lt;peer&gt; demo: node connect node2 node1 notice: success_result_demo: Connected node2 to node1 &nbsp; ``` &gt;&nbsp;*&nbsp;disconnect &nbsp; ``` function:节点断开连接 args:&lt;node&gt; &lt;peer&gt; demo: node disconnect node2 node1 notice: success_result_demo: Disconnected node2 from node1 &nbsp; ``` &gt;&nbsp;*&nbsp;stop &nbsp; ``` function:停止一个节点 args:&lt;node&gt; demo: node stop node2 notice: success_result_demo: Stopped node2 &nbsp; ``` &gt;&nbsp;*&nbsp;rpc &nbsp; ``` function:调用rpc接口 args:&lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe] demo: node rpc node1 admin notice: success_result_demo: 　// TODO &nbsp; ``` ### cmd包下的geth子包主函数启动的各个子命令解析 &nbsp; &nbsp; #### /geth &nbsp; *&nbsp;__init__ ``` function:导入创世块的json,以指定的json作为创世块 args:&lt;genesisPath&gt; demo: init /home/yujian/eth-go/genesis.json notice:ethereum默认创建路径为home目录的.ethereum,如果该目录下已经写入过创世快，会执行失败 success_result_demo: WARN [01-16|10:25:12] No etherbase set and no accounts found as default INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=16 handles=16 INFO [01-16|10:25:12] Writing custom genesis block INFO [01-16|10:25:12] Successfully wrote genesis state database=chaindata hash=bf2891…ad1419 INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/lightchaindata cache=16 handles=16 INFO [01-16|10:25:12] Writing custom genesis block INFO [01-16|10:25:12] Successfully wrote genesis state database=lightchaindata hash=bf2891…ad1419 ``` &nbsp; *&nbsp;__import__ ``` function:导入区块数据到当前运行的链中 args:&lt;filename&gt; (&lt;filename 2&gt; ... &lt;filename N&gt;) demo: import /home/yujian/eth-block.txt notice:如果导入的文件只要一个是错误的，那么会失败，如果有多个文件错误，那么程序会继续执行忽略错误的． success_result_demo: WARN [01-16|11:00:32] No etherbase set and no accounts found as default INFO [01-16|11:00:32] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 Import done in 306.866µs. &nbsp; INFO [01-16|11:00:32] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 Compactions INFO [01-16|11:00:32] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB) -------+------------+---------------+---------------+---------------+--------------- INFO [01-16|11:00:32] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 0 | 3 | 0.00094 | 0.00000 | 0.00000 | 0.00000 INFO [01-16|11:00:32] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 &nbsp; Trie cache misses: 0 INFO [01-16|11:00:32] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 Trie cache unloads: 0 &nbsp; INFO [01-16|11:00:32] Importing blockchain file=/home/yujian/eth-block.txt Object memory: 34.677 MB current, 34.670 MB peak System memory: 74.100 MB current, 73.850 MB peak Allocations: 0.015 million GC pause: 10.454997ms &nbsp; Compacting entire database... INFO [01-16|11:00:33] Database closed database=/home/yujian/.ethereum/geth/chaindata Compaction done in 64.422235ms. &nbsp; Compactions Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB) -------+------------+---------------+---------------+---------------+--------------- 0 | 0 | 0.00000 | 0.00451 | 0.00000 | 0.00021 1 | 1 | 0.00053 | 0.00435 | 0.00114 | 0.00053 ``` &nbsp; *&nbsp;__export__ ``` function:导出区块数据到指定的文件 args:&lt;filename&gt; [&lt;blockNumFirst&gt; &lt;blockNumLast&gt;] demo: export /home/yujian/eth-block.txt notice: success_result_demo: WARN [01-16|10:51:36] No etherbase set and no accounts found as default INFO [01-16|10:51:36] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|10:51:36] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|10:51:36] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 Export done in 628.951µsINFO [01-16|10:51:36] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Exporting blockchain file=/home/yujian/eth-block.txt INFO [01-16|10:51:36] Exporting batch of blocks count=1 INFO [01-16|10:51:36] Exported blockchain file=/home/yujian/eth-block.txt ``` &nbsp; *&nbsp;__copydb__ ``` function:从存在的链数据文件夹中创建一条本地链 args:&lt;sourceChaindataDir&gt; demo: copydb /home/yujian/eth-block.txt notice: success_result_demo: WARN [01-16|11:35:55] No etherbase set and no accounts found as default INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|11:35:55] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|11:35:55] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 INFO [01-16|11:35:55] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/eth-go/geth/chaindata cache=128 handles=256 INFO [01-16|11:35:55] Block synchronisation started INFO [01-16|11:35:55] Imported new state entries count=1 elapsed=33.277µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 INFO [01-16|11:35:56] Imported new block headers count=11 elapsed=1.276s number=11 hash=ec3374…59a2ba ignored=0 Database copy done in 1.280940454s Compacting entire database... INFO [01-16|11:35:56] Imported new chain segment blocks=11 txs=0 mgas=0.000 elapsed=1.961ms mgasps=0.000 number=11 hash=ec3374…59a2ba Compaction done in 11.130389ms. ``` &nbsp; *&nbsp;__removedb__ ``` function:移除当前链的数据库 args:&quot;&quot; demo: removedb notice:默认当前链的数据在home目录下的.ethereum目录下 success_result_demo: WARN [01-16|11:48:09] No etherbase set and no accounts found as default /home/yujian/.ethereum/geth/chaindata Remove this database? [y/N] y /home/yujian/.ethereum/geth/lightchaindata INFO [01-16|11:48:19] Database successfully deleted database=chaindata elapsed=7.832ms Remove this database? [y/N] y INFO [01-16|11:48:27] Database successfully deleted database=lightchaindata elapsed=481.229µs ``` &nbsp; *&nbsp;__dump__ ``` function:转存指定的块 args:[&lt;blockHash&gt; | &lt;blockNum&gt;]... demo: dump 0 notice: success_result_demo: &quot;storage&quot;: {} }, &quot;af3cb5965933e7dad883693b9c3e15beb68a4873&quot;: { &quot;balance&quot;: &quot;2000000000000000000000&quot;, &quot;nonce&quot;: 0, &quot;root&quot;: &quot;56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, &quot;codeHash&quot;: &quot;c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470&quot;, &quot;code&quot;: &quot;&quot;, &quot;storage&quot;: {} }, &quot;af4493e8521ca89d95f5267c1ab63f9f45411e1b&quot;: { &quot;balance&quot;: &quot;200000000000000000000&quot;, &quot;nonce&quot;: 0, &quot;root&quot;: &quot;56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, &quot;codeHash&quot;: &quot;c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470&quot;, &quot;code&quot;: &quot;&quot;, &quot;storage&quot;: {} }, } } INFO [01-16|14:02:06] Database closed database=/home/yujian/.ethereum/geth/chaindata ``` &nbsp; *&nbsp;__monitor__ ``` function:监视和可视化节点指标 args:&quot;&quot; demo: monitor notice:该命令本地未调通,需要先启链，才能调用该命令去看监控的状态 success_result_demo: // TODO &nbsp; ``` &nbsp; *&nbsp;__account__ ``` function:管理账户 args:&quot;[new|list|update|import]&quot; demo: account new notice:“帐户导入”选项只能用于导入通用密钥文件 success_result_demo: WARN [01-16|14:44:44] No etherbase set and no accounts found as default Your new account is locked with a password. Please give a password. Do not forget this password. !! Unsupported terminal, password will be echoed. Passphrase: 123456 &nbsp; Repeat passphrase: 123456 &nbsp; Address: {2a23e9223d7af9c56f5abd0c8226021b51c98cbc} &nbsp; Process finished with exit code 0 ``` &nbsp; *&nbsp;__wallet__ ``` function:导入预付款钱包(一般用不到，用的是account功能) args:&quot;&quot; demo: wallet import notice:&quot;钱包导入&quot;选项只能用于导入预售钱包 success_result_demo: &nbsp; ``` 　　 &nbsp; *&nbsp;__console__ ``` function:开启一条私有链,并打开一个可视化的js钱包控制台 args:&quot;&quot; demo: console notice: success_result_demo: INFO [01-16|15:26:13] Starting peer-to-peer node instance=Geth/v1.7.3-unstable/linux-amd64/go1.9.2 INFO [01-16|15:26:13] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|15:26:14] Initialised chain configuration config=&quot;{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Engine: ethash}&quot; INFO [01-16|15:26:14] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|15:26:14] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 INFO [01-16|15:26:14] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=1 INFO [01-16|15:26:14] Loaded most recent local header number=1127484 hash=ae7ee2…52ae4c td=8985161313979839462 INFO [01-16|15:26:14] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [01-16|15:26:14] Loaded most recent local fast block number=1092806 hash=6e839a…2eb127 td=8395031237882431385 INFO [01-16|15:26:14] Upgrading chain index type=bloombits percentage=80 INFO [01-16|15:26:14] Loaded local transaction journal transactions=0 dropped=0 INFO [01-16|15:26:14] Regenerated local transaction journal transactions=0 accounts=0 INFO [01-16|15:26:14] Starting P2P networking INFO [01-16|15:26:16] UDP listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303 INFO [01-16|15:26:16] RLPx listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303 INFO [01-16|15:26:16] IPC endpoint opened: /home/yujian/.ethereum/geth.ipc Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2 coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/yujian/.ethereum modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 ``` &nbsp; *&nbsp;__attach__ ``` function:打开一个可视化的js钱包控制台(连接到一个指定的链) args: --jspath loadScript JavaScript root path for loadScript (default: &quot;.&quot;) --exec value Execute JavaScript statement --preload value Comma separated list of JavaScript files to preload into the console --datadir &quot;/root/.ethereum&quot; Data directory for the databases and keystore demo:attach --datadir=&quot;/home/yujian/.ethereum/geth.ipc&quot; notice:必须启动一条本地链，这样才能连接过去 success_result_demo: Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2 coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/yujian/.ethereum modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 ``` &nbsp; *&nbsp;__js__ ``` 　function:执行指定的js文件 args:&lt;jsfile&gt; [jsfile...] demo:js notice: success_result_demo: &nbsp; ``` &nbsp; *&nbsp;__makecache__ &nbsp; ``` function:生成ethhash验证缓存(测试使用) args:&lt;blockNum&gt; &lt;outputDir&gt; demo:makecache 0 /home/yujian/ notice: success_result_demo: 在对应的输出目录，将会生成一个cache文件,如 cache-R23-0000000000000000 ``` &nbsp; *&nbsp;__makedag__ &nbsp; ``` function:生成ethhash mining dag(测试使用) args:&lt;blockNum&gt; &lt;outputDir&gt; demo:makedag 0 /home/yujian/ notice: success_result_demo: INFO [01-16|17:50:36] Generating DAG in progress epoch=0 percentage=92 elapsed=3m2.525s INFO [01-16|17:50:38] Generating DAG in progress epoch=0 percentage=93 elapsed=3m4.338s INFO [01-16|17:50:40] Generating DAG in progress epoch=0 percentage=94 elapsed=3m6.058s INFO [01-16|17:50:41] Generating DAG in progress epoch=0 percentage=95 elapsed=3m7.795s INFO [01-16|17:50:43] Generating DAG in progress epoch=0 percentage=96 elapsed=3m9.542s INFO [01-16|17:50:45] Generating DAG in progress epoch=0 percentage=97 elapsed=3m11.380s INFO [01-16|17:50:47] Generating DAG in progress epoch=0 percentage=98 elapsed=3m13.129s INFO [01-16|17:50:49] Generating DAG in progress epoch=0 percentage=99 elapsed=3m15.303s INFO [01-16|17:50:49] Generated ethash verification cache epoch=0 elapsed=3m15.306s &nbsp; Process finished with exit code 0 &nbsp; 在对应的输出目录,将会生成一个full文件,如 full-R23-0000000000000000 &nbsp; ``` &nbsp; *&nbsp;__version__ &nbsp; ``` function:打印版本数据 args:&quot;&quot; demo:version notice: success_result_demo: Geth Version: 1.7.3-unstable Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 Go Version: go1.9.2 Operating System: linux GOPATH=/home/yujian/blockchain-workspace/go-project GOROOT=/usr/local/go 　　 ``` &nbsp; *&nbsp;__bug__ &nbsp; ``` function:打开一个窗口,直接跳转到ethereum的github仓库的issue args:&quot;&quot; demo:bug notice: success_result_demo: 　　运行后会自动打开浏览器，跳转到ethereum的issue编辑页面　 &nbsp; ``` &nbsp; *&nbsp;__license__ &nbsp; ``` function:显示geth的license信息 args:&quot;&quot; demo:license notice: success_result_demo: Geth is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. &nbsp; Geth is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. &nbsp; You should have received a copy of the GNU General Public License along with geth. If not, see &lt;http://www.gnu.org/licenses/&gt;. ``` &nbsp; *&nbsp;__dumpconfig__ &nbsp; ``` function:显示配置信息 args:&quot;&quot; demo:dumpconfig notice: success_result_demo: 　[Eth] NetworkId = 1 SyncMode = &quot;fast&quot; LightPeers = 20 DatabaseCache = 128 Etherbase = &quot;0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc&quot; GasPrice = 18000000000 EthashCacheDir = &quot;ethash&quot; EthashCachesInMem = 2 EthashCachesOnDisk = 3 EthashDatasetDir = &quot;/home/yujian/.ethash&quot; EthashDatasetsInMem = 1 EthashDatasetsOnDisk = 2 EnablePreimageRecording = false &nbsp; [Eth.TxPool] NoLocals = false Journal = &quot;transactions.rlp&quot; Rejournal = 3600000000000 PriceLimit = 1 PriceBump = 10 AccountSlots = 16 GlobalSlots = 4096 AccountQueue = 64 GlobalQueue = 1024 Lifetime = 10800000000000 &nbsp; [Eth.GPO] Blocks = 10 Percentile = 50 &nbsp; [Shh] MaxMessageSize = 1048576 MinimumAcceptedPOW = 2e-01 &nbsp; [Node] DataDir = &quot;/home/yujian/.ethereum&quot; IPCPath = &quot;geth.ipc&quot; HTTPPort = 8545 HTTPModules = [&quot;net&quot;, &quot;web3&quot;, &quot;eth&quot;, &quot;shh&quot;] WSPort = 8546 WSModules = [&quot;net&quot;, &quot;web3&quot;, &quot;eth&quot;, &quot;shh&quot;] &nbsp; [Node.P2P] MaxPeers = 25 NoDiscovery = false DiscoveryV5Addr = &quot;:30304&quot; BootstrapNodes = [&quot;enode://a979fb575495b8d6db44f750317d0f4622bf4c2aa3365d6af7c284339968eef29b69ad0dce72a4d8db5ebb4968de0e3bec910127f134779fbcb0cb6d3331163c@52.16.188.185:30303&quot;, &quot;enode://3f1d12044546b76342d59d4a05532c14b85aa669704bfe1f864fe079415aa2c02d743e03218e57a33fb94523adb54032871a6c51b2cc5514cb7c7e35b3ed0a99@13.93.211.84:30303&quot;, &quot;enode://78de8a0916848093c73790ead81d1928bec737d565119932b98c6b100d944b7a95e94f847f689fc723399d2e31129d182f7ef3863f2b4c820abbf3ab2722344d@191.235.84.50:30303&quot;, &quot;enode://158f8aab45f6d19c6cbf4a089c2670541a8da11978a2f90dbf6a502a4a3bab80d288afdbeb7ec0ef6d92de563767f3b1ea9e8e334ca711e9f8e2df5a0385e8e6@13.75.154.138:30303&quot;, &quot;enode://1118980bf48b0a3640bdba04e0fe78b1add18e1cd99bf22d53daac1fd9972ad650df52176e7c7d89d1114cfef2bc23a2959aa54998a46afcf7d91809f0855082@52.74.57.123:30303&quot;, &quot;enode://979b7fa28feeb35a4741660a16076f1943202cb72b6af70d327f053e248bab9ba81760f39d0701ef1d8f89cc1fbd2cacba0710a12cd5314d5e0c9021aa3637f9@5.1.83.226:30303&quot;] BootstrapNodesV5 = [&quot;enode://0cc5f5ffb5d9098c8b8c62325f3797f56509bff942704687b6530992ac706e2cb946b90a34f1f19548cd3c7baccbcaea354531e5983c7d1bc0dee16ce4b6440b@40.118.3.223:30305&quot;, &quot;enode://1c7a64d76c0334b0418c004af2f67c50e36a3be60b5e4790bdac0439d21603469a85fad36f2473c9a80eb043ae60936df905fa28f1ff614c3e5dc34f15dcd2dc@40.118.3.223:30308&quot;, &quot;enode://85c85d7143ae8bb96924f2b54f1b3e70d8c4d367af305325d30a61385a432f247d2c75c45c6b4a60335060d072d7f5b35dd1d4c45f76941f62a4f83b6e75daaf@40.118.3.223:30309&quot;] StaticNodes = [] TrustedNodes = [] ListenAddr = &quot;:30303&quot; EnableMsgEvents = false &nbsp; [Dashboard] Host = &quot;localhost&quot; Port = 8080 Refresh = 3000000000　 ``` &nbsp; ##### 参考资料 *&nbsp;[eth钱包创建](https://www.myetherwallet.com/#generate-wallet) *&nbsp;[eth命令使用解释](http://www.blockcode.org/archives/185) 转载&nbsp; &nbsp; &nbsp;以太坊源码分析(10)CMD深入分析 阅读更多" />
<meta property="og:description" content="### cmd包分析 #### cmd下面总共有13个子包，除了util包之外，每个子包都有一个主函数,每个主函数的init方法中都定义了该主函数支持的命令，如 &nbsp; ##### geth包下面的： &nbsp; ``` func init() { &nbsp;&nbsp;&nbsp;&nbsp;// Initialize the CLI app and start Geth &nbsp;&nbsp;&nbsp;&nbsp;app.Action = geth &nbsp;&nbsp;&nbsp;&nbsp;app.HideVersion = true // we have a command to print the version &nbsp;&nbsp;&nbsp;&nbsp;app.Copyright = &quot;Copyright 2013-2017 The go-ethereum Authors&quot; &nbsp;&nbsp;&nbsp;&nbsp;app.Commands = []cli.Command{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See chaincmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;importCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exportCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copydbCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removedbCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See monitorcmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;monitorCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See accountcmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accountCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;walletCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See consolecmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consoleCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javascriptCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See misccmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makecacheCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makedagCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bugCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;licenseCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See config.go &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpConfigCommand, &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;sort.Sort(cli.CommandsByName(app.Commands)) } ``` &nbsp; ###### 再单独分析initCommand: &nbsp; ``` initCommand = cli.Command{ Action: utils.MigrateFlags(initGenesis), Name: &quot;init&quot;, Usage: &quot;Bootstrap and initialize a new genesis block&quot;, ArgsUsage: &quot;&lt;genesisPath&gt;&quot;, Flags: []cli.Flag{ utils.DataDirFlag, utils.LightModeFlag, }, Category: &quot;BLOCKCHAIN COMMANDS&quot;, Description: ` The init command initializes a new genesis block and definition for the network. This is a destructive action and changes the network in which you will be participating. &nbsp; ``` &nbsp; ###### 其中Name是对应命令的指令，action是调用该指令去完成的动作，usage表示用途,arguUsage显示该命令后面跟的参数个数以及每个参数的意义, ###### 该init方法其实就是去初始化创世块,flags代表的是这个子命令额外可以执行的命令,如改init命令可以携带两个参数，点进去utils.DataDirFlag可以看到： &nbsp; ``` // General settings DataDirFlag = DirectoryFlag{ Name: &quot;datadir&quot;, Usage: &quot;Data directory for the databases and keystore&quot;, Value: DirectoryString{node.DefaultDataDir()}, } ``` &nbsp; *&nbsp;__可以用 --datadir [dir]来指定数据库的路径，如果没有指定由于该参数有value所以会启用默认的路径，也是home目录下面的.ethereum.__ &nbsp; *&nbsp;__/cmd/wnode/main.go　通过连接其他节点启动__ &nbsp; *&nbsp;__/cmd/geth /cmd/swarm　都是定义了很多命令__ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ### eth下cmd的rlpdump子包,该包的主要作用从给定文件中转储RLP数据以可读的形式．如果文件名被省略，数据将从stdin中读取 &nbsp; 　 /rlpdump &nbsp; ##### 解码rlp的数据 &nbsp; ###### rlpdump的command的help &nbsp; ``` Usage: /tmp/___cmd_rlpdump_test [-noascii] [-hex &lt;data&gt;] [filename] -hex string &nbsp;&nbsp;dump given hex data -noascii &nbsp;&nbsp;don&#39;t print ASCII strings readably -single &nbsp;&nbsp;print only the first element, discard the rest &nbsp; Dumps RLP data from the given file in readable form. If the filename is omitted, data is read from stdin. &nbsp; ``` &nbsp; ###### example1: ``` demo command: --hex f872f870845609a1ba64c0b8660480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee8580 success_result_demo: [ [ 5609a1ba, &quot;d&quot;, [], 0480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee85, &quot;&quot;, ], ] ``` &nbsp; ###### example2: &nbsp; ``` demo command: --noascii --hex CE0183FFFFFFC4C304050583616263 success_result_demo: [ 01, ffffff, [ [ 04, 05, 05, ], ], 616263, ] &nbsp; ``` ### cmd包下的p2psim子包的分析, p2psim is a command line client for the HTTP API &nbsp; ##### 首先我们启动对应的main函数,对应的启动参数是`--help`,来查看该包下所有命令的使用,结果如下: &nbsp; ``` NAME: ___go_build_main_go__1_ - devp2p simulation command-line client &nbsp; USAGE: ___go_build_main_go__1_ [global options] command [command options] [arguments...] &nbsp; VERSION: 0.0.0 &nbsp; COMMANDS: show show network information events stream network events snapshot create a network snapshot to stdout load load a network snapshot from stdin node manage simulation nodes help, h Shows a list of commands or help for one command &nbsp; GLOBAL OPTIONS: --api value simulation API URL (default: &quot;http://localhost:8888&quot;) [$P2PSIM_API_URL] --help, -h show help --version, -v print the version ``` &nbsp; ##### 该子包提供如何下的命令: ``` p2psim show p2psim events [--current] [--filter=FILTER] p2psim snapshot p2psim load p2psim node create [--name=NAME] [--services=SERVICES] [--key=KEY] p2psim node list p2psim node show &lt;node&gt; p2psim node start &lt;node&gt; p2psim node stop &lt;node&gt; p2psim node connect &lt;node&gt; &lt;peer&gt; p2psim node disconnect &lt;node&gt; &lt;peer&gt; p2psim node rpc &lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe] &nbsp; ``` &nbsp; ##### 要正常使用该子包下的命令，我们需要运行`/p2p/simulations/examples/ping-pong.go`的主函数来启动一个包含运行简单的节点的仿真网络. 正常启动后,你将看到: ``` INFO [01-23|11:17:10] using sim adapter INFO [01-23|11:17:10] starting simulation server on 0.0.0.0:8888... &nbsp; ``` &nbsp; ##### 该服务启动后,提供如下的API,其作用等同于上面的命令,命令调用的实现其实就是调用API,访问的路径前缀就是`0.0.0.0:8888`: ``` GET / Get network information POST /start Start all nodes in the network POST /stop Stop all nodes in the network GET /events Stream network events GET /snapshot Take a network snapshot POST /snapshot Load a network snapshot POST /nodes Create a node GET /nodes Get all nodes in the network GET /nodes/:nodeid Get node information POST /nodes/:nodeid/start Start a node POST /nodes/:nodeid/stop Stop a node POST /nodes/:nodeid/conn/:peerid Connect two nodes DELETE /nodes/:nodeid/conn/:peerid Disconnect two nodes GET /nodes/:nodeid/rpc Make RPC requests to a node via WebSocket &nbsp; ``` &nbsp; ##### 此处不深究API,仿真网络的服务已经起来了,下面开始p2psim包下命令的使用: &nbsp; __/p2psim__ &nbsp; *&nbsp;show ``` function:显示当前仿真网络的状态 args:&quot;&quot; demo: show notice: success_result_demo: NODES 0 CONNS 0 &nbsp; ``` &nbsp; *&nbsp;snapshot ``` function:导出当前仿真网络的节点信息 args:&quot;&quot; demo: shapshot notice: success_result_demo: {&quot;nodes&quot;:[{&quot;node&quot;:{&quot;config&quot;:{&quot;id&quot;:&quot;085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d&quot;,&quot;private_key&quot;:&quot;3480d230f453e7c207bbd3b770bf774dc8a17e599394f9283147a35c3ead561c&quot;,&quot;name&quot;:&quot;node1&quot;,&quot;services&quot;:[&quot;ping-pong&quot;]},&quot;up&quot;:true}},{&quot;node&quot;:{&quot;config&quot;:{&quot;id&quot;:&quot;cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b&quot;,&quot;private_key&quot;:&quot;b7592cdeee6195c4486fcdd8007e1aedfd3a49e6c9f53e0845bf977d4ad043cc&quot;,&quot;name&quot;:&quot;node2&quot;,&quot;services&quot;:[&quot;ping-pong&quot;]},&quot;up&quot;:false}}],&quot;conns&quot;:[{&quot;one&quot;:&quot;cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b&quot;,&quot;other&quot;:&quot;085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d&quot;,&quot;up&quot;:false}]} &nbsp; ``` &nbsp; *&nbsp;node &gt;&nbsp;*&nbsp;create ``` function:创建一个节点 args:[--name=NAME] [--services=SERVICES] [--key=KEY] demo: node create --name node1 notice: success_result_demo: Created node1 ``` &gt;&nbsp;*&nbsp;list ``` function:列出当前仿真网络的节点信息 args:&quot;&quot; demo: node list notice: success_result_demo: NAME PROTOCOLS ID node1 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d node2 cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b &nbsp; ``` &gt;&nbsp;*&nbsp;show ``` function:查看仿真网络中某个节点的具体信息 args:&lt;node&gt; demo: node show node1 notice: success_result_demo: NAME node1 PROTOCOLS ID 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d ENODE enode://085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d@127.0.0.1:30303 ``` &gt;&nbsp;*&nbsp;start ``` function:启动一个节点 args:&lt;node&gt; demo: node start node1 notice: success_result_demo: Started node1 ``` &gt;&nbsp;*&nbsp;connect ``` function:将一个节点连接到另外一个节点 args:&lt;node&gt; &lt;peer&gt; demo: node connect node2 node1 notice: success_result_demo: Connected node2 to node1 &nbsp; ``` &gt;&nbsp;*&nbsp;disconnect &nbsp; ``` function:节点断开连接 args:&lt;node&gt; &lt;peer&gt; demo: node disconnect node2 node1 notice: success_result_demo: Disconnected node2 from node1 &nbsp; ``` &gt;&nbsp;*&nbsp;stop &nbsp; ``` function:停止一个节点 args:&lt;node&gt; demo: node stop node2 notice: success_result_demo: Stopped node2 &nbsp; ``` &gt;&nbsp;*&nbsp;rpc &nbsp; ``` function:调用rpc接口 args:&lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe] demo: node rpc node1 admin notice: success_result_demo: 　// TODO &nbsp; ``` ### cmd包下的geth子包主函数启动的各个子命令解析 &nbsp; &nbsp; #### /geth &nbsp; *&nbsp;__init__ ``` function:导入创世块的json,以指定的json作为创世块 args:&lt;genesisPath&gt; demo: init /home/yujian/eth-go/genesis.json notice:ethereum默认创建路径为home目录的.ethereum,如果该目录下已经写入过创世快，会执行失败 success_result_demo: WARN [01-16|10:25:12] No etherbase set and no accounts found as default INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=16 handles=16 INFO [01-16|10:25:12] Writing custom genesis block INFO [01-16|10:25:12] Successfully wrote genesis state database=chaindata hash=bf2891…ad1419 INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/lightchaindata cache=16 handles=16 INFO [01-16|10:25:12] Writing custom genesis block INFO [01-16|10:25:12] Successfully wrote genesis state database=lightchaindata hash=bf2891…ad1419 ``` &nbsp; *&nbsp;__import__ ``` function:导入区块数据到当前运行的链中 args:&lt;filename&gt; (&lt;filename 2&gt; ... &lt;filename N&gt;) demo: import /home/yujian/eth-block.txt notice:如果导入的文件只要一个是错误的，那么会失败，如果有多个文件错误，那么程序会继续执行忽略错误的． success_result_demo: WARN [01-16|11:00:32] No etherbase set and no accounts found as default INFO [01-16|11:00:32] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 Import done in 306.866µs. &nbsp; INFO [01-16|11:00:32] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 Compactions INFO [01-16|11:00:32] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB) -------+------------+---------------+---------------+---------------+--------------- INFO [01-16|11:00:32] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 0 | 3 | 0.00094 | 0.00000 | 0.00000 | 0.00000 INFO [01-16|11:00:32] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 &nbsp; Trie cache misses: 0 INFO [01-16|11:00:32] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 Trie cache unloads: 0 &nbsp; INFO [01-16|11:00:32] Importing blockchain file=/home/yujian/eth-block.txt Object memory: 34.677 MB current, 34.670 MB peak System memory: 74.100 MB current, 73.850 MB peak Allocations: 0.015 million GC pause: 10.454997ms &nbsp; Compacting entire database... INFO [01-16|11:00:33] Database closed database=/home/yujian/.ethereum/geth/chaindata Compaction done in 64.422235ms. &nbsp; Compactions Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB) -------+------------+---------------+---------------+---------------+--------------- 0 | 0 | 0.00000 | 0.00451 | 0.00000 | 0.00021 1 | 1 | 0.00053 | 0.00435 | 0.00114 | 0.00053 ``` &nbsp; *&nbsp;__export__ ``` function:导出区块数据到指定的文件 args:&lt;filename&gt; [&lt;blockNumFirst&gt; &lt;blockNumLast&gt;] demo: export /home/yujian/eth-block.txt notice: success_result_demo: WARN [01-16|10:51:36] No etherbase set and no accounts found as default INFO [01-16|10:51:36] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|10:51:36] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|10:51:36] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 Export done in 628.951µsINFO [01-16|10:51:36] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Exporting blockchain file=/home/yujian/eth-block.txt INFO [01-16|10:51:36] Exporting batch of blocks count=1 INFO [01-16|10:51:36] Exported blockchain file=/home/yujian/eth-block.txt ``` &nbsp; *&nbsp;__copydb__ ``` function:从存在的链数据文件夹中创建一条本地链 args:&lt;sourceChaindataDir&gt; demo: copydb /home/yujian/eth-block.txt notice: success_result_demo: WARN [01-16|11:35:55] No etherbase set and no accounts found as default INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|11:35:55] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|11:35:55] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 INFO [01-16|11:35:55] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/eth-go/geth/chaindata cache=128 handles=256 INFO [01-16|11:35:55] Block synchronisation started INFO [01-16|11:35:55] Imported new state entries count=1 elapsed=33.277µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 INFO [01-16|11:35:56] Imported new block headers count=11 elapsed=1.276s number=11 hash=ec3374…59a2ba ignored=0 Database copy done in 1.280940454s Compacting entire database... INFO [01-16|11:35:56] Imported new chain segment blocks=11 txs=0 mgas=0.000 elapsed=1.961ms mgasps=0.000 number=11 hash=ec3374…59a2ba Compaction done in 11.130389ms. ``` &nbsp; *&nbsp;__removedb__ ``` function:移除当前链的数据库 args:&quot;&quot; demo: removedb notice:默认当前链的数据在home目录下的.ethereum目录下 success_result_demo: WARN [01-16|11:48:09] No etherbase set and no accounts found as default /home/yujian/.ethereum/geth/chaindata Remove this database? [y/N] y /home/yujian/.ethereum/geth/lightchaindata INFO [01-16|11:48:19] Database successfully deleted database=chaindata elapsed=7.832ms Remove this database? [y/N] y INFO [01-16|11:48:27] Database successfully deleted database=lightchaindata elapsed=481.229µs ``` &nbsp; *&nbsp;__dump__ ``` function:转存指定的块 args:[&lt;blockHash&gt; | &lt;blockNum&gt;]... demo: dump 0 notice: success_result_demo: &quot;storage&quot;: {} }, &quot;af3cb5965933e7dad883693b9c3e15beb68a4873&quot;: { &quot;balance&quot;: &quot;2000000000000000000000&quot;, &quot;nonce&quot;: 0, &quot;root&quot;: &quot;56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, &quot;codeHash&quot;: &quot;c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470&quot;, &quot;code&quot;: &quot;&quot;, &quot;storage&quot;: {} }, &quot;af4493e8521ca89d95f5267c1ab63f9f45411e1b&quot;: { &quot;balance&quot;: &quot;200000000000000000000&quot;, &quot;nonce&quot;: 0, &quot;root&quot;: &quot;56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, &quot;codeHash&quot;: &quot;c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470&quot;, &quot;code&quot;: &quot;&quot;, &quot;storage&quot;: {} }, } } INFO [01-16|14:02:06] Database closed database=/home/yujian/.ethereum/geth/chaindata ``` &nbsp; *&nbsp;__monitor__ ``` function:监视和可视化节点指标 args:&quot;&quot; demo: monitor notice:该命令本地未调通,需要先启链，才能调用该命令去看监控的状态 success_result_demo: // TODO &nbsp; ``` &nbsp; *&nbsp;__account__ ``` function:管理账户 args:&quot;[new|list|update|import]&quot; demo: account new notice:“帐户导入”选项只能用于导入通用密钥文件 success_result_demo: WARN [01-16|14:44:44] No etherbase set and no accounts found as default Your new account is locked with a password. Please give a password. Do not forget this password. !! Unsupported terminal, password will be echoed. Passphrase: 123456 &nbsp; Repeat passphrase: 123456 &nbsp; Address: {2a23e9223d7af9c56f5abd0c8226021b51c98cbc} &nbsp; Process finished with exit code 0 ``` &nbsp; *&nbsp;__wallet__ ``` function:导入预付款钱包(一般用不到，用的是account功能) args:&quot;&quot; demo: wallet import notice:&quot;钱包导入&quot;选项只能用于导入预售钱包 success_result_demo: &nbsp; ``` 　　 &nbsp; *&nbsp;__console__ ``` function:开启一条私有链,并打开一个可视化的js钱包控制台 args:&quot;&quot; demo: console notice: success_result_demo: INFO [01-16|15:26:13] Starting peer-to-peer node instance=Geth/v1.7.3-unstable/linux-amd64/go1.9.2 INFO [01-16|15:26:13] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|15:26:14] Initialised chain configuration config=&quot;{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Engine: ethash}&quot; INFO [01-16|15:26:14] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|15:26:14] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 INFO [01-16|15:26:14] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=1 INFO [01-16|15:26:14] Loaded most recent local header number=1127484 hash=ae7ee2…52ae4c td=8985161313979839462 INFO [01-16|15:26:14] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [01-16|15:26:14] Loaded most recent local fast block number=1092806 hash=6e839a…2eb127 td=8395031237882431385 INFO [01-16|15:26:14] Upgrading chain index type=bloombits percentage=80 INFO [01-16|15:26:14] Loaded local transaction journal transactions=0 dropped=0 INFO [01-16|15:26:14] Regenerated local transaction journal transactions=0 accounts=0 INFO [01-16|15:26:14] Starting P2P networking INFO [01-16|15:26:16] UDP listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303 INFO [01-16|15:26:16] RLPx listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303 INFO [01-16|15:26:16] IPC endpoint opened: /home/yujian/.ethereum/geth.ipc Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2 coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/yujian/.ethereum modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 ``` &nbsp; *&nbsp;__attach__ ``` function:打开一个可视化的js钱包控制台(连接到一个指定的链) args: --jspath loadScript JavaScript root path for loadScript (default: &quot;.&quot;) --exec value Execute JavaScript statement --preload value Comma separated list of JavaScript files to preload into the console --datadir &quot;/root/.ethereum&quot; Data directory for the databases and keystore demo:attach --datadir=&quot;/home/yujian/.ethereum/geth.ipc&quot; notice:必须启动一条本地链，这样才能连接过去 success_result_demo: Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2 coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/yujian/.ethereum modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 ``` &nbsp; *&nbsp;__js__ ``` 　function:执行指定的js文件 args:&lt;jsfile&gt; [jsfile...] demo:js notice: success_result_demo: &nbsp; ``` &nbsp; *&nbsp;__makecache__ &nbsp; ``` function:生成ethhash验证缓存(测试使用) args:&lt;blockNum&gt; &lt;outputDir&gt; demo:makecache 0 /home/yujian/ notice: success_result_demo: 在对应的输出目录，将会生成一个cache文件,如 cache-R23-0000000000000000 ``` &nbsp; *&nbsp;__makedag__ &nbsp; ``` function:生成ethhash mining dag(测试使用) args:&lt;blockNum&gt; &lt;outputDir&gt; demo:makedag 0 /home/yujian/ notice: success_result_demo: INFO [01-16|17:50:36] Generating DAG in progress epoch=0 percentage=92 elapsed=3m2.525s INFO [01-16|17:50:38] Generating DAG in progress epoch=0 percentage=93 elapsed=3m4.338s INFO [01-16|17:50:40] Generating DAG in progress epoch=0 percentage=94 elapsed=3m6.058s INFO [01-16|17:50:41] Generating DAG in progress epoch=0 percentage=95 elapsed=3m7.795s INFO [01-16|17:50:43] Generating DAG in progress epoch=0 percentage=96 elapsed=3m9.542s INFO [01-16|17:50:45] Generating DAG in progress epoch=0 percentage=97 elapsed=3m11.380s INFO [01-16|17:50:47] Generating DAG in progress epoch=0 percentage=98 elapsed=3m13.129s INFO [01-16|17:50:49] Generating DAG in progress epoch=0 percentage=99 elapsed=3m15.303s INFO [01-16|17:50:49] Generated ethash verification cache epoch=0 elapsed=3m15.306s &nbsp; Process finished with exit code 0 &nbsp; 在对应的输出目录,将会生成一个full文件,如 full-R23-0000000000000000 &nbsp; ``` &nbsp; *&nbsp;__version__ &nbsp; ``` function:打印版本数据 args:&quot;&quot; demo:version notice: success_result_demo: Geth Version: 1.7.3-unstable Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 Go Version: go1.9.2 Operating System: linux GOPATH=/home/yujian/blockchain-workspace/go-project GOROOT=/usr/local/go 　　 ``` &nbsp; *&nbsp;__bug__ &nbsp; ``` function:打开一个窗口,直接跳转到ethereum的github仓库的issue args:&quot;&quot; demo:bug notice: success_result_demo: 　　运行后会自动打开浏览器，跳转到ethereum的issue编辑页面　 &nbsp; ``` &nbsp; *&nbsp;__license__ &nbsp; ``` function:显示geth的license信息 args:&quot;&quot; demo:license notice: success_result_demo: Geth is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. &nbsp; Geth is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. &nbsp; You should have received a copy of the GNU General Public License along with geth. If not, see &lt;http://www.gnu.org/licenses/&gt;. ``` &nbsp; *&nbsp;__dumpconfig__ &nbsp; ``` function:显示配置信息 args:&quot;&quot; demo:dumpconfig notice: success_result_demo: 　[Eth] NetworkId = 1 SyncMode = &quot;fast&quot; LightPeers = 20 DatabaseCache = 128 Etherbase = &quot;0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc&quot; GasPrice = 18000000000 EthashCacheDir = &quot;ethash&quot; EthashCachesInMem = 2 EthashCachesOnDisk = 3 EthashDatasetDir = &quot;/home/yujian/.ethash&quot; EthashDatasetsInMem = 1 EthashDatasetsOnDisk = 2 EnablePreimageRecording = false &nbsp; [Eth.TxPool] NoLocals = false Journal = &quot;transactions.rlp&quot; Rejournal = 3600000000000 PriceLimit = 1 PriceBump = 10 AccountSlots = 16 GlobalSlots = 4096 AccountQueue = 64 GlobalQueue = 1024 Lifetime = 10800000000000 &nbsp; [Eth.GPO] Blocks = 10 Percentile = 50 &nbsp; [Shh] MaxMessageSize = 1048576 MinimumAcceptedPOW = 2e-01 &nbsp; [Node] DataDir = &quot;/home/yujian/.ethereum&quot; IPCPath = &quot;geth.ipc&quot; HTTPPort = 8545 HTTPModules = [&quot;net&quot;, &quot;web3&quot;, &quot;eth&quot;, &quot;shh&quot;] WSPort = 8546 WSModules = [&quot;net&quot;, &quot;web3&quot;, &quot;eth&quot;, &quot;shh&quot;] &nbsp; [Node.P2P] MaxPeers = 25 NoDiscovery = false DiscoveryV5Addr = &quot;:30304&quot; BootstrapNodes = [&quot;enode://a979fb575495b8d6db44f750317d0f4622bf4c2aa3365d6af7c284339968eef29b69ad0dce72a4d8db5ebb4968de0e3bec910127f134779fbcb0cb6d3331163c@52.16.188.185:30303&quot;, &quot;enode://3f1d12044546b76342d59d4a05532c14b85aa669704bfe1f864fe079415aa2c02d743e03218e57a33fb94523adb54032871a6c51b2cc5514cb7c7e35b3ed0a99@13.93.211.84:30303&quot;, &quot;enode://78de8a0916848093c73790ead81d1928bec737d565119932b98c6b100d944b7a95e94f847f689fc723399d2e31129d182f7ef3863f2b4c820abbf3ab2722344d@191.235.84.50:30303&quot;, &quot;enode://158f8aab45f6d19c6cbf4a089c2670541a8da11978a2f90dbf6a502a4a3bab80d288afdbeb7ec0ef6d92de563767f3b1ea9e8e334ca711e9f8e2df5a0385e8e6@13.75.154.138:30303&quot;, &quot;enode://1118980bf48b0a3640bdba04e0fe78b1add18e1cd99bf22d53daac1fd9972ad650df52176e7c7d89d1114cfef2bc23a2959aa54998a46afcf7d91809f0855082@52.74.57.123:30303&quot;, &quot;enode://979b7fa28feeb35a4741660a16076f1943202cb72b6af70d327f053e248bab9ba81760f39d0701ef1d8f89cc1fbd2cacba0710a12cd5314d5e0c9021aa3637f9@5.1.83.226:30303&quot;] BootstrapNodesV5 = [&quot;enode://0cc5f5ffb5d9098c8b8c62325f3797f56509bff942704687b6530992ac706e2cb946b90a34f1f19548cd3c7baccbcaea354531e5983c7d1bc0dee16ce4b6440b@40.118.3.223:30305&quot;, &quot;enode://1c7a64d76c0334b0418c004af2f67c50e36a3be60b5e4790bdac0439d21603469a85fad36f2473c9a80eb043ae60936df905fa28f1ff614c3e5dc34f15dcd2dc@40.118.3.223:30308&quot;, &quot;enode://85c85d7143ae8bb96924f2b54f1b3e70d8c4d367af305325d30a61385a432f247d2c75c45c6b4a60335060d072d7f5b35dd1d4c45f76941f62a4f83b6e75daaf@40.118.3.223:30309&quot;] StaticNodes = [] TrustedNodes = [] ListenAddr = &quot;:30303&quot; EnableMsgEvents = false &nbsp; [Dashboard] Host = &quot;localhost&quot; Port = 8080 Refresh = 3000000000　 ``` &nbsp; ##### 参考资料 *&nbsp;[eth钱包创建](https://www.myetherwallet.com/#generate-wallet) *&nbsp;[eth命令使用解释](http://www.blockcode.org/archives/185) 转载&nbsp; &nbsp; &nbsp;以太坊源码分析(10)CMD深入分析 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-18T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"### cmd包分析 #### cmd下面总共有13个子包，除了util包之外，每个子包都有一个主函数,每个主函数的init方法中都定义了该主函数支持的命令，如 &nbsp; ##### geth包下面的： &nbsp; ``` func init() { &nbsp;&nbsp;&nbsp;&nbsp;// Initialize the CLI app and start Geth &nbsp;&nbsp;&nbsp;&nbsp;app.Action = geth &nbsp;&nbsp;&nbsp;&nbsp;app.HideVersion = true // we have a command to print the version &nbsp;&nbsp;&nbsp;&nbsp;app.Copyright = &quot;Copyright 2013-2017 The go-ethereum Authors&quot; &nbsp;&nbsp;&nbsp;&nbsp;app.Commands = []cli.Command{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See chaincmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;importCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exportCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copydbCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removedbCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See monitorcmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;monitorCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See accountcmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accountCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;walletCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See consolecmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consoleCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javascriptCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See misccmd.go: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makecacheCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makedagCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bugCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;licenseCommand, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See config.go &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpConfigCommand, &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;sort.Sort(cli.CommandsByName(app.Commands)) } ``` &nbsp; ###### 再单独分析initCommand: &nbsp; ``` initCommand = cli.Command{ Action: utils.MigrateFlags(initGenesis), Name: &quot;init&quot;, Usage: &quot;Bootstrap and initialize a new genesis block&quot;, ArgsUsage: &quot;&lt;genesisPath&gt;&quot;, Flags: []cli.Flag{ utils.DataDirFlag, utils.LightModeFlag, }, Category: &quot;BLOCKCHAIN COMMANDS&quot;, Description: ` The init command initializes a new genesis block and definition for the network. This is a destructive action and changes the network in which you will be participating. &nbsp; ``` &nbsp; ###### 其中Name是对应命令的指令，action是调用该指令去完成的动作，usage表示用途,arguUsage显示该命令后面跟的参数个数以及每个参数的意义, ###### 该init方法其实就是去初始化创世块,flags代表的是这个子命令额外可以执行的命令,如改init命令可以携带两个参数，点进去utils.DataDirFlag可以看到： &nbsp; ``` // General settings DataDirFlag = DirectoryFlag{ Name: &quot;datadir&quot;, Usage: &quot;Data directory for the databases and keystore&quot;, Value: DirectoryString{node.DefaultDataDir()}, } ``` &nbsp; *&nbsp;__可以用 --datadir [dir]来指定数据库的路径，如果没有指定由于该参数有value所以会启用默认的路径，也是home目录下面的.ethereum.__ &nbsp; *&nbsp;__/cmd/wnode/main.go　通过连接其他节点启动__ &nbsp; *&nbsp;__/cmd/geth /cmd/swarm　都是定义了很多命令__ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ### eth下cmd的rlpdump子包,该包的主要作用从给定文件中转储RLP数据以可读的形式．如果文件名被省略，数据将从stdin中读取 &nbsp; 　 /rlpdump &nbsp; ##### 解码rlp的数据 &nbsp; ###### rlpdump的command的help &nbsp; ``` Usage: /tmp/___cmd_rlpdump_test [-noascii] [-hex &lt;data&gt;] [filename] -hex string &nbsp;&nbsp;dump given hex data -noascii &nbsp;&nbsp;don&#39;t print ASCII strings readably -single &nbsp;&nbsp;print only the first element, discard the rest &nbsp; Dumps RLP data from the given file in readable form. If the filename is omitted, data is read from stdin. &nbsp; ``` &nbsp; ###### example1: ``` demo command: --hex f872f870845609a1ba64c0b8660480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee8580 success_result_demo: [ [ 5609a1ba, &quot;d&quot;, [], 0480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee85, &quot;&quot;, ], ] ``` &nbsp; ###### example2: &nbsp; ``` demo command: --noascii --hex CE0183FFFFFFC4C304050583616263 success_result_demo: [ 01, ffffff, [ [ 04, 05, 05, ], ], 616263, ] &nbsp; ``` ### cmd包下的p2psim子包的分析, p2psim is a command line client for the HTTP API &nbsp; ##### 首先我们启动对应的main函数,对应的启动参数是`--help`,来查看该包下所有命令的使用,结果如下: &nbsp; ``` NAME: ___go_build_main_go__1_ - devp2p simulation command-line client &nbsp; USAGE: ___go_build_main_go__1_ [global options] command [command options] [arguments...] &nbsp; VERSION: 0.0.0 &nbsp; COMMANDS: show show network information events stream network events snapshot create a network snapshot to stdout load load a network snapshot from stdin node manage simulation nodes help, h Shows a list of commands or help for one command &nbsp; GLOBAL OPTIONS: --api value simulation API URL (default: &quot;http://localhost:8888&quot;) [$P2PSIM_API_URL] --help, -h show help --version, -v print the version ``` &nbsp; ##### 该子包提供如何下的命令: ``` p2psim show p2psim events [--current] [--filter=FILTER] p2psim snapshot p2psim load p2psim node create [--name=NAME] [--services=SERVICES] [--key=KEY] p2psim node list p2psim node show &lt;node&gt; p2psim node start &lt;node&gt; p2psim node stop &lt;node&gt; p2psim node connect &lt;node&gt; &lt;peer&gt; p2psim node disconnect &lt;node&gt; &lt;peer&gt; p2psim node rpc &lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe] &nbsp; ``` &nbsp; ##### 要正常使用该子包下的命令，我们需要运行`/p2p/simulations/examples/ping-pong.go`的主函数来启动一个包含运行简单的节点的仿真网络. 正常启动后,你将看到: ``` INFO [01-23|11:17:10] using sim adapter INFO [01-23|11:17:10] starting simulation server on 0.0.0.0:8888... &nbsp; ``` &nbsp; ##### 该服务启动后,提供如下的API,其作用等同于上面的命令,命令调用的实现其实就是调用API,访问的路径前缀就是`0.0.0.0:8888`: ``` GET / Get network information POST /start Start all nodes in the network POST /stop Stop all nodes in the network GET /events Stream network events GET /snapshot Take a network snapshot POST /snapshot Load a network snapshot POST /nodes Create a node GET /nodes Get all nodes in the network GET /nodes/:nodeid Get node information POST /nodes/:nodeid/start Start a node POST /nodes/:nodeid/stop Stop a node POST /nodes/:nodeid/conn/:peerid Connect two nodes DELETE /nodes/:nodeid/conn/:peerid Disconnect two nodes GET /nodes/:nodeid/rpc Make RPC requests to a node via WebSocket &nbsp; ``` &nbsp; ##### 此处不深究API,仿真网络的服务已经起来了,下面开始p2psim包下命令的使用: &nbsp; __/p2psim__ &nbsp; *&nbsp;show ``` function:显示当前仿真网络的状态 args:&quot;&quot; demo: show notice: success_result_demo: NODES 0 CONNS 0 &nbsp; ``` &nbsp; *&nbsp;snapshot ``` function:导出当前仿真网络的节点信息 args:&quot;&quot; demo: shapshot notice: success_result_demo: {&quot;nodes&quot;:[{&quot;node&quot;:{&quot;config&quot;:{&quot;id&quot;:&quot;085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d&quot;,&quot;private_key&quot;:&quot;3480d230f453e7c207bbd3b770bf774dc8a17e599394f9283147a35c3ead561c&quot;,&quot;name&quot;:&quot;node1&quot;,&quot;services&quot;:[&quot;ping-pong&quot;]},&quot;up&quot;:true}},{&quot;node&quot;:{&quot;config&quot;:{&quot;id&quot;:&quot;cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b&quot;,&quot;private_key&quot;:&quot;b7592cdeee6195c4486fcdd8007e1aedfd3a49e6c9f53e0845bf977d4ad043cc&quot;,&quot;name&quot;:&quot;node2&quot;,&quot;services&quot;:[&quot;ping-pong&quot;]},&quot;up&quot;:false}}],&quot;conns&quot;:[{&quot;one&quot;:&quot;cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b&quot;,&quot;other&quot;:&quot;085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d&quot;,&quot;up&quot;:false}]} &nbsp; ``` &nbsp; *&nbsp;node &gt;&nbsp;*&nbsp;create ``` function:创建一个节点 args:[--name=NAME] [--services=SERVICES] [--key=KEY] demo: node create --name node1 notice: success_result_demo: Created node1 ``` &gt;&nbsp;*&nbsp;list ``` function:列出当前仿真网络的节点信息 args:&quot;&quot; demo: node list notice: success_result_demo: NAME PROTOCOLS ID node1 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d node2 cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b &nbsp; ``` &gt;&nbsp;*&nbsp;show ``` function:查看仿真网络中某个节点的具体信息 args:&lt;node&gt; demo: node show node1 notice: success_result_demo: NAME node1 PROTOCOLS ID 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d ENODE enode://085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d@127.0.0.1:30303 ``` &gt;&nbsp;*&nbsp;start ``` function:启动一个节点 args:&lt;node&gt; demo: node start node1 notice: success_result_demo: Started node1 ``` &gt;&nbsp;*&nbsp;connect ``` function:将一个节点连接到另外一个节点 args:&lt;node&gt; &lt;peer&gt; demo: node connect node2 node1 notice: success_result_demo: Connected node2 to node1 &nbsp; ``` &gt;&nbsp;*&nbsp;disconnect &nbsp; ``` function:节点断开连接 args:&lt;node&gt; &lt;peer&gt; demo: node disconnect node2 node1 notice: success_result_demo: Disconnected node2 from node1 &nbsp; ``` &gt;&nbsp;*&nbsp;stop &nbsp; ``` function:停止一个节点 args:&lt;node&gt; demo: node stop node2 notice: success_result_demo: Stopped node2 &nbsp; ``` &gt;&nbsp;*&nbsp;rpc &nbsp; ``` function:调用rpc接口 args:&lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe] demo: node rpc node1 admin notice: success_result_demo: 　// TODO &nbsp; ``` ### cmd包下的geth子包主函数启动的各个子命令解析 &nbsp; &nbsp; #### /geth &nbsp; *&nbsp;__init__ ``` function:导入创世块的json,以指定的json作为创世块 args:&lt;genesisPath&gt; demo: init /home/yujian/eth-go/genesis.json notice:ethereum默认创建路径为home目录的.ethereum,如果该目录下已经写入过创世快，会执行失败 success_result_demo: WARN [01-16|10:25:12] No etherbase set and no accounts found as default INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=16 handles=16 INFO [01-16|10:25:12] Writing custom genesis block INFO [01-16|10:25:12] Successfully wrote genesis state database=chaindata hash=bf2891…ad1419 INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/lightchaindata cache=16 handles=16 INFO [01-16|10:25:12] Writing custom genesis block INFO [01-16|10:25:12] Successfully wrote genesis state database=lightchaindata hash=bf2891…ad1419 ``` &nbsp; *&nbsp;__import__ ``` function:导入区块数据到当前运行的链中 args:&lt;filename&gt; (&lt;filename 2&gt; ... &lt;filename N&gt;) demo: import /home/yujian/eth-block.txt notice:如果导入的文件只要一个是错误的，那么会失败，如果有多个文件错误，那么程序会继续执行忽略错误的． success_result_demo: WARN [01-16|11:00:32] No etherbase set and no accounts found as default INFO [01-16|11:00:32] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 Import done in 306.866µs. &nbsp; INFO [01-16|11:00:32] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 Compactions INFO [01-16|11:00:32] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB) -------+------------+---------------+---------------+---------------+--------------- INFO [01-16|11:00:32] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 0 | 3 | 0.00094 | 0.00000 | 0.00000 | 0.00000 INFO [01-16|11:00:32] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 &nbsp; Trie cache misses: 0 INFO [01-16|11:00:32] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 Trie cache unloads: 0 &nbsp; INFO [01-16|11:00:32] Importing blockchain file=/home/yujian/eth-block.txt Object memory: 34.677 MB current, 34.670 MB peak System memory: 74.100 MB current, 73.850 MB peak Allocations: 0.015 million GC pause: 10.454997ms &nbsp; Compacting entire database... INFO [01-16|11:00:33] Database closed database=/home/yujian/.ethereum/geth/chaindata Compaction done in 64.422235ms. &nbsp; Compactions Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB) -------+------------+---------------+---------------+---------------+--------------- 0 | 0 | 0.00000 | 0.00451 | 0.00000 | 0.00021 1 | 1 | 0.00053 | 0.00435 | 0.00114 | 0.00053 ``` &nbsp; *&nbsp;__export__ ``` function:导出区块数据到指定的文件 args:&lt;filename&gt; [&lt;blockNumFirst&gt; &lt;blockNumLast&gt;] demo: export /home/yujian/eth-block.txt notice: success_result_demo: WARN [01-16|10:51:36] No etherbase set and no accounts found as default INFO [01-16|10:51:36] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|10:51:36] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|10:51:36] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 Export done in 628.951µsINFO [01-16|10:51:36] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|10:51:36] Exporting blockchain file=/home/yujian/eth-block.txt INFO [01-16|10:51:36] Exporting batch of blocks count=1 INFO [01-16|10:51:36] Exported blockchain file=/home/yujian/eth-block.txt ``` &nbsp; *&nbsp;__copydb__ ``` function:从存在的链数据文件夹中创建一条本地链 args:&lt;sourceChaindataDir&gt; demo: copydb /home/yujian/eth-block.txt notice: success_result_demo: WARN [01-16|11:35:55] No etherbase set and no accounts found as default INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|11:35:55] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|11:35:55] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 INFO [01-16|11:35:55] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432 INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/eth-go/geth/chaindata cache=128 handles=256 INFO [01-16|11:35:55] Block synchronisation started INFO [01-16|11:35:55] Imported new state entries count=1 elapsed=33.277µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 INFO [01-16|11:35:56] Imported new block headers count=11 elapsed=1.276s number=11 hash=ec3374…59a2ba ignored=0 Database copy done in 1.280940454s Compacting entire database... INFO [01-16|11:35:56] Imported new chain segment blocks=11 txs=0 mgas=0.000 elapsed=1.961ms mgasps=0.000 number=11 hash=ec3374…59a2ba Compaction done in 11.130389ms. ``` &nbsp; *&nbsp;__removedb__ ``` function:移除当前链的数据库 args:&quot;&quot; demo: removedb notice:默认当前链的数据在home目录下的.ethereum目录下 success_result_demo: WARN [01-16|11:48:09] No etherbase set and no accounts found as default /home/yujian/.ethereum/geth/chaindata Remove this database? [y/N] y /home/yujian/.ethereum/geth/lightchaindata INFO [01-16|11:48:19] Database successfully deleted database=chaindata elapsed=7.832ms Remove this database? [y/N] y INFO [01-16|11:48:27] Database successfully deleted database=lightchaindata elapsed=481.229µs ``` &nbsp; *&nbsp;__dump__ ``` function:转存指定的块 args:[&lt;blockHash&gt; | &lt;blockNum&gt;]... demo: dump 0 notice: success_result_demo: &quot;storage&quot;: {} }, &quot;af3cb5965933e7dad883693b9c3e15beb68a4873&quot;: { &quot;balance&quot;: &quot;2000000000000000000000&quot;, &quot;nonce&quot;: 0, &quot;root&quot;: &quot;56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, &quot;codeHash&quot;: &quot;c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470&quot;, &quot;code&quot;: &quot;&quot;, &quot;storage&quot;: {} }, &quot;af4493e8521ca89d95f5267c1ab63f9f45411e1b&quot;: { &quot;balance&quot;: &quot;200000000000000000000&quot;, &quot;nonce&quot;: 0, &quot;root&quot;: &quot;56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, &quot;codeHash&quot;: &quot;c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470&quot;, &quot;code&quot;: &quot;&quot;, &quot;storage&quot;: {} }, } } INFO [01-16|14:02:06] Database closed database=/home/yujian/.ethereum/geth/chaindata ``` &nbsp; *&nbsp;__monitor__ ``` function:监视和可视化节点指标 args:&quot;&quot; demo: monitor notice:该命令本地未调通,需要先启链，才能调用该命令去看监控的状态 success_result_demo: // TODO &nbsp; ``` &nbsp; *&nbsp;__account__ ``` function:管理账户 args:&quot;[new|list|update|import]&quot; demo: account new notice:“帐户导入”选项只能用于导入通用密钥文件 success_result_demo: WARN [01-16|14:44:44] No etherbase set and no accounts found as default Your new account is locked with a password. Please give a password. Do not forget this password. !! Unsupported terminal, password will be echoed. Passphrase: 123456 &nbsp; Repeat passphrase: 123456 &nbsp; Address: {2a23e9223d7af9c56f5abd0c8226021b51c98cbc} &nbsp; Process finished with exit code 0 ``` &nbsp; *&nbsp;__wallet__ ``` function:导入预付款钱包(一般用不到，用的是account功能) args:&quot;&quot; demo: wallet import notice:&quot;钱包导入&quot;选项只能用于导入预售钱包 success_result_demo: &nbsp; ``` 　　 &nbsp; *&nbsp;__console__ ``` function:开启一条私有链,并打开一个可视化的js钱包控制台 args:&quot;&quot; demo: console notice: success_result_demo: INFO [01-16|15:26:13] Starting peer-to-peer node instance=Geth/v1.7.3-unstable/linux-amd64/go1.9.2 INFO [01-16|15:26:13] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024 INFO [01-16|15:26:14] Initialised chain configuration config=&quot;{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Engine: ethash}&quot; INFO [01-16|15:26:14] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3 INFO [01-16|15:26:14] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2 INFO [01-16|15:26:14] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=1 INFO [01-16|15:26:14] Loaded most recent local header number=1127484 hash=ae7ee2…52ae4c td=8985161313979839462 INFO [01-16|15:26:14] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [01-16|15:26:14] Loaded most recent local fast block number=1092806 hash=6e839a…2eb127 td=8395031237882431385 INFO [01-16|15:26:14] Upgrading chain index type=bloombits percentage=80 INFO [01-16|15:26:14] Loaded local transaction journal transactions=0 dropped=0 INFO [01-16|15:26:14] Regenerated local transaction journal transactions=0 accounts=0 INFO [01-16|15:26:14] Starting P2P networking INFO [01-16|15:26:16] UDP listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303 INFO [01-16|15:26:16] RLPx listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303 INFO [01-16|15:26:16] IPC endpoint opened: /home/yujian/.ethereum/geth.ipc Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2 coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/yujian/.ethereum modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 ``` &nbsp; *&nbsp;__attach__ ``` function:打开一个可视化的js钱包控制台(连接到一个指定的链) args: --jspath loadScript JavaScript root path for loadScript (default: &quot;.&quot;) --exec value Execute JavaScript statement --preload value Comma separated list of JavaScript files to preload into the console --datadir &quot;/root/.ethereum&quot; Data directory for the databases and keystore demo:attach --datadir=&quot;/home/yujian/.ethereum/geth.ipc&quot; notice:必须启动一条本地链，这样才能连接过去 success_result_demo: Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2 coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/yujian/.ethereum modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 ``` &nbsp; *&nbsp;__js__ ``` 　function:执行指定的js文件 args:&lt;jsfile&gt; [jsfile...] demo:js notice: success_result_demo: &nbsp; ``` &nbsp; *&nbsp;__makecache__ &nbsp; ``` function:生成ethhash验证缓存(测试使用) args:&lt;blockNum&gt; &lt;outputDir&gt; demo:makecache 0 /home/yujian/ notice: success_result_demo: 在对应的输出目录，将会生成一个cache文件,如 cache-R23-0000000000000000 ``` &nbsp; *&nbsp;__makedag__ &nbsp; ``` function:生成ethhash mining dag(测试使用) args:&lt;blockNum&gt; &lt;outputDir&gt; demo:makedag 0 /home/yujian/ notice: success_result_demo: INFO [01-16|17:50:36] Generating DAG in progress epoch=0 percentage=92 elapsed=3m2.525s INFO [01-16|17:50:38] Generating DAG in progress epoch=0 percentage=93 elapsed=3m4.338s INFO [01-16|17:50:40] Generating DAG in progress epoch=0 percentage=94 elapsed=3m6.058s INFO [01-16|17:50:41] Generating DAG in progress epoch=0 percentage=95 elapsed=3m7.795s INFO [01-16|17:50:43] Generating DAG in progress epoch=0 percentage=96 elapsed=3m9.542s INFO [01-16|17:50:45] Generating DAG in progress epoch=0 percentage=97 elapsed=3m11.380s INFO [01-16|17:50:47] Generating DAG in progress epoch=0 percentage=98 elapsed=3m13.129s INFO [01-16|17:50:49] Generating DAG in progress epoch=0 percentage=99 elapsed=3m15.303s INFO [01-16|17:50:49] Generated ethash verification cache epoch=0 elapsed=3m15.306s &nbsp; Process finished with exit code 0 &nbsp; 在对应的输出目录,将会生成一个full文件,如 full-R23-0000000000000000 &nbsp; ``` &nbsp; *&nbsp;__version__ &nbsp; ``` function:打印版本数据 args:&quot;&quot; demo:version notice: success_result_demo: Geth Version: 1.7.3-unstable Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 Go Version: go1.9.2 Operating System: linux GOPATH=/home/yujian/blockchain-workspace/go-project GOROOT=/usr/local/go 　　 ``` &nbsp; *&nbsp;__bug__ &nbsp; ``` function:打开一个窗口,直接跳转到ethereum的github仓库的issue args:&quot;&quot; demo:bug notice: success_result_demo: 　　运行后会自动打开浏览器，跳转到ethereum的issue编辑页面　 &nbsp; ``` &nbsp; *&nbsp;__license__ &nbsp; ``` function:显示geth的license信息 args:&quot;&quot; demo:license notice: success_result_demo: Geth is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. &nbsp; Geth is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. &nbsp; You should have received a copy of the GNU General Public License along with geth. If not, see &lt;http://www.gnu.org/licenses/&gt;. ``` &nbsp; *&nbsp;__dumpconfig__ &nbsp; ``` function:显示配置信息 args:&quot;&quot; demo:dumpconfig notice: success_result_demo: 　[Eth] NetworkId = 1 SyncMode = &quot;fast&quot; LightPeers = 20 DatabaseCache = 128 Etherbase = &quot;0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc&quot; GasPrice = 18000000000 EthashCacheDir = &quot;ethash&quot; EthashCachesInMem = 2 EthashCachesOnDisk = 3 EthashDatasetDir = &quot;/home/yujian/.ethash&quot; EthashDatasetsInMem = 1 EthashDatasetsOnDisk = 2 EnablePreimageRecording = false &nbsp; [Eth.TxPool] NoLocals = false Journal = &quot;transactions.rlp&quot; Rejournal = 3600000000000 PriceLimit = 1 PriceBump = 10 AccountSlots = 16 GlobalSlots = 4096 AccountQueue = 64 GlobalQueue = 1024 Lifetime = 10800000000000 &nbsp; [Eth.GPO] Blocks = 10 Percentile = 50 &nbsp; [Shh] MaxMessageSize = 1048576 MinimumAcceptedPOW = 2e-01 &nbsp; [Node] DataDir = &quot;/home/yujian/.ethereum&quot; IPCPath = &quot;geth.ipc&quot; HTTPPort = 8545 HTTPModules = [&quot;net&quot;, &quot;web3&quot;, &quot;eth&quot;, &quot;shh&quot;] WSPort = 8546 WSModules = [&quot;net&quot;, &quot;web3&quot;, &quot;eth&quot;, &quot;shh&quot;] &nbsp; [Node.P2P] MaxPeers = 25 NoDiscovery = false DiscoveryV5Addr = &quot;:30304&quot; BootstrapNodes = [&quot;enode://a979fb575495b8d6db44f750317d0f4622bf4c2aa3365d6af7c284339968eef29b69ad0dce72a4d8db5ebb4968de0e3bec910127f134779fbcb0cb6d3331163c@52.16.188.185:30303&quot;, &quot;enode://3f1d12044546b76342d59d4a05532c14b85aa669704bfe1f864fe079415aa2c02d743e03218e57a33fb94523adb54032871a6c51b2cc5514cb7c7e35b3ed0a99@13.93.211.84:30303&quot;, &quot;enode://78de8a0916848093c73790ead81d1928bec737d565119932b98c6b100d944b7a95e94f847f689fc723399d2e31129d182f7ef3863f2b4c820abbf3ab2722344d@191.235.84.50:30303&quot;, &quot;enode://158f8aab45f6d19c6cbf4a089c2670541a8da11978a2f90dbf6a502a4a3bab80d288afdbeb7ec0ef6d92de563767f3b1ea9e8e334ca711e9f8e2df5a0385e8e6@13.75.154.138:30303&quot;, &quot;enode://1118980bf48b0a3640bdba04e0fe78b1add18e1cd99bf22d53daac1fd9972ad650df52176e7c7d89d1114cfef2bc23a2959aa54998a46afcf7d91809f0855082@52.74.57.123:30303&quot;, &quot;enode://979b7fa28feeb35a4741660a16076f1943202cb72b6af70d327f053e248bab9ba81760f39d0701ef1d8f89cc1fbd2cacba0710a12cd5314d5e0c9021aa3637f9@5.1.83.226:30303&quot;] BootstrapNodesV5 = [&quot;enode://0cc5f5ffb5d9098c8b8c62325f3797f56509bff942704687b6530992ac706e2cb946b90a34f1f19548cd3c7baccbcaea354531e5983c7d1bc0dee16ce4b6440b@40.118.3.223:30305&quot;, &quot;enode://1c7a64d76c0334b0418c004af2f67c50e36a3be60b5e4790bdac0439d21603469a85fad36f2473c9a80eb043ae60936df905fa28f1ff614c3e5dc34f15dcd2dc@40.118.3.223:30308&quot;, &quot;enode://85c85d7143ae8bb96924f2b54f1b3e70d8c4d367af305325d30a61385a432f247d2c75c45c6b4a60335060d072d7f5b35dd1d4c45f76941f62a4f83b6e75daaf@40.118.3.223:30309&quot;] StaticNodes = [] TrustedNodes = [] ListenAddr = &quot;:30303&quot; EnableMsgEvents = false &nbsp; [Dashboard] Host = &quot;localhost&quot; Port = 8080 Refresh = 3000000000　 ``` &nbsp; ##### 参考资料 *&nbsp;[eth钱包创建](https://www.myetherwallet.com/#generate-wallet) *&nbsp;[eth命令使用解释](http://www.blockcode.org/archives/185) 转载&nbsp; &nbsp; &nbsp;以太坊源码分析(10)CMD深入分析 阅读更多","@type":"BlogPosting","url":"/2018/08/18/090b166952db746f9f461b8a0615b635.html","headline":"以太坊源码分析(10)CMD深入分析","dateModified":"2018-08-18T00:00:00+08:00","datePublished":"2018-08-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/18/090b166952db746f9f461b8a0615b635.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊源码分析(10)CMD深入分析</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><strong>### cmd包分析</strong></p> 
  <p><strong>#### cmd下面总共有13个子包，除了util包之外，每个子包都有一个主函数,每个主函数的init方法中都定义了该主函数支持的命令，如</strong></p> 
  <p>&nbsp;</p> 
  <p><strong>##### geth包下面的：</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>func init() {</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;// Initialize the CLI app and start Geth</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;app.Action = geth</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;app.HideVersion = true // we have a command to print the version</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;app.Copyright = "Copyright 2013-2017 The go-ethereum Authors"</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;app.Commands = []cli.Command{</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See chaincmd.go:</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;importCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exportCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copydbCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removedbCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See monitorcmd.go:</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;monitorCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See accountcmd.go:</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accountCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;walletCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See consolecmd.go:</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consoleCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javascriptCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See misccmd.go:</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makecacheCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;makedagCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;versionCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bugCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;licenseCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// See config.go</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dumpConfigCommand,</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;}</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;sort.Sort(cli.CommandsByName(app.Commands))</p> 
  <p>}</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p><strong>###### 再单独分析initCommand:</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>initCommand = cli.Command{</p> 
  <p>Action: utils.MigrateFlags(initGenesis),</p> 
  <p>Name: "init",</p> 
  <p>Usage: "Bootstrap and initialize a new genesis block",</p> 
  <p>ArgsUsage: "&lt;genesisPath&gt;",</p> 
  <p>Flags: []cli.Flag{</p> 
  <p>utils.DataDirFlag,</p> 
  <p>utils.LightModeFlag,</p> 
  <p>},</p> 
  <p>Category: "BLOCKCHAIN COMMANDS",</p> 
  <p>Description: `</p> 
  <p>The init command initializes a new genesis block and definition for the network.</p> 
  <p>This is a destructive action and changes the network in which you will be</p> 
  <p>participating.</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p><strong>###### 其中Name是对应命令的指令，action是调用该指令去完成的动作，usage表示用途,arguUsage显示该命令后面跟的参数个数以及每个参数的意义,</strong></p> 
  <p><strong>###### 该init方法其实就是去初始化创世块,flags代表的是这个子命令额外可以执行的命令,如改init命令可以携带两个参数，点进去utils.DataDirFlag可以看到：</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>// General settings</p> 
  <p>DataDirFlag = DirectoryFlag{</p> 
  <p>Name: "datadir",</p> 
  <p>Usage: "Data directory for the databases and keystore",</p> 
  <p>Value: DirectoryString{node.DefaultDataDir()},</p> 
  <p>}</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__可以用 --datadir [dir]来指定数据库的路径，如果没有指定由于该参数有value所以会启用默认的路径，也是home目录下面的.ethereum.__</strong></p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__/cmd/wnode/main.go　通过连接其他节点启动__</strong></p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__/cmd/geth /cmd/swarm　都是定义了很多命令__</strong></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p><strong>### eth下cmd的rlpdump子包,该包的主要作用从给定文件中转储RLP数据以可读的形式．如果文件名被省略，数据将从stdin中读取</strong></p> 
  <p>&nbsp;</p> 
  <p>　 /rlpdump</p> 
  <p>&nbsp;</p> 
  <p><strong>##### 解码rlp的数据</strong></p> 
  <p><br> &nbsp;</p> 
  <p><strong>###### rlpdump的command的help</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>Usage: /tmp/___cmd_rlpdump_test [-noascii] [-hex &lt;data&gt;] [filename]</p> 
  <p>-hex string</p> 
  <p>&nbsp;&nbsp;dump given hex data</p> 
  <p>-noascii</p> 
  <p>&nbsp;&nbsp;don't print ASCII strings readably</p> 
  <p>-single</p> 
  <p>&nbsp;&nbsp;print only the first element, discard the rest</p> 
  <p>&nbsp;</p> 
  <p>Dumps RLP data from the given file in readable form.</p> 
  <p>If the filename is omitted, data is read from stdin.</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p><strong>###### example1:</strong></p> 
  <p>```</p> 
  <p>demo command: --hex f872f870845609a1ba64c0b8660480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee8580</p> 
  <p>success_result_demo:</p> 
  <p>[</p> 
  <p>[</p> 
  <p>5609a1ba,</p> 
  <p>"d",</p> 
  <p>[],</p> 
  <p>0480136e573eb81ac4a664f8f76e4887ba927f791a053ec5ff580b1037a8633320ca70f8ec0cdea59167acaa1debc07bc0a0b3a5b41bdf0cb4346c18ddbbd2cf222f54fed795dde94417d2e57f85a580d87238efc75394ca4a92cfe6eb9debcc3583c26fee85,</p> 
  <p>"",</p> 
  <p>],</p> 
  <p>]</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p><strong>###### example2:</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>demo command: --noascii --hex CE0183FFFFFFC4C304050583616263</p> 
  <p>success_result_demo:</p> 
  <p>[</p> 
  <p>01,</p> 
  <p>ffffff,</p> 
  <p>[</p> 
  <p>[</p> 
  <p>04,</p> 
  <p>05,</p> 
  <p>05,</p> 
  <p>],</p> 
  <p>],</p> 
  <p>616263,</p> 
  <p>]</p> 
  <p><br><br> &nbsp;</p> 
  <p>```</p> 
  <p><strong>### cmd包下的p2psim子包的分析, p2psim is a command line client for the HTTP API</strong></p> 
  <p>&nbsp;</p> 
  <p><strong>##### 首先我们启动对应的main函数,对应的启动参数是</strong><strong>`--help`</strong><strong>,来查看该包下所有命令的使用,结果如下:</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>NAME:</p> 
  <p>___go_build_main_go__1_ - devp2p simulation command-line client</p> 
  <p>&nbsp;</p> 
  <p>USAGE:</p> 
  <p>___go_build_main_go__1_ [global options] command [command options] [arguments...]</p> 
  <p>&nbsp;</p> 
  <p>VERSION:</p> 
  <p>0.0.0</p> 
  <p>&nbsp;</p> 
  <p>COMMANDS:</p> 
  <p>show show network information</p> 
  <p>events stream network events</p> 
  <p>snapshot create a network snapshot to stdout</p> 
  <p>load load a network snapshot from stdin</p> 
  <p>node manage simulation nodes</p> 
  <p>help, h Shows a list of commands or help for one command</p> 
  <p>&nbsp;</p> 
  <p>GLOBAL OPTIONS:</p> 
  <p>--api value simulation API URL (default: "http://localhost:8888") [$P2PSIM_API_URL]</p> 
  <p>--help, -h show help</p> 
  <p>--version, -v print the version</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p><strong>##### 该子包提供如何下的命令:</strong></p> 
  <p>```</p> 
  <p>p2psim show</p> 
  <p>p2psim events [--current] [--filter=FILTER]</p> 
  <p>p2psim snapshot</p> 
  <p>p2psim load</p> 
  <p>p2psim node create [--name=NAME] [--services=SERVICES] [--key=KEY]</p> 
  <p>p2psim node list</p> 
  <p>p2psim node show &lt;node&gt;</p> 
  <p>p2psim node start &lt;node&gt;</p> 
  <p>p2psim node stop &lt;node&gt;</p> 
  <p>p2psim node connect &lt;node&gt; &lt;peer&gt;</p> 
  <p>p2psim node disconnect &lt;node&gt; &lt;peer&gt;</p> 
  <p>p2psim node rpc &lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe]</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p><strong>##### 要正常使用该子包下的命令，我们需要运行</strong><strong>`/p2p/simulations/examples/ping-pong.go`</strong><strong>的主函数来启动一个包含运行简单的节点的仿真网络.</strong></p> 
  <p>正常启动后,你将看到:</p> 
  <p>```</p> 
  <p>INFO [01-23|11:17:10] using sim adapter</p> 
  <p>INFO [01-23|11:17:10] starting simulation server on 0.0.0.0:8888...</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p><strong>##### 该服务启动后,提供如下的API,其作用等同于上面的命令,命令调用的实现其实就是调用API,访问的路径前缀就是</strong><strong>`0.0.0.0:8888`</strong><strong>:</strong></p> 
  <p>```</p> 
  <p>GET / Get network information</p> 
  <p>POST /start Start all nodes in the network</p> 
  <p>POST /stop Stop all nodes in the network</p> 
  <p>GET /events Stream network events</p> 
  <p>GET /snapshot Take a network snapshot</p> 
  <p>POST /snapshot Load a network snapshot</p> 
  <p>POST /nodes Create a node</p> 
  <p>GET /nodes Get all nodes in the network</p> 
  <p>GET /nodes/:nodeid Get node information</p> 
  <p>POST /nodes/:nodeid/start Start a node</p> 
  <p>POST /nodes/:nodeid/stop Stop a node</p> 
  <p>POST /nodes/:nodeid/conn/:peerid Connect two nodes</p> 
  <p>DELETE /nodes/:nodeid/conn/:peerid Disconnect two nodes</p> 
  <p>GET /nodes/:nodeid/rpc Make RPC requests to a node via WebSocket</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p><strong>##### 此处不深究API,仿真网络的服务已经起来了,下面开始p2psim包下命令的使用:</strong></p> 
  <p>&nbsp;</p> 
  <p><strong>__/p2psim__</strong></p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;show</p> 
  <p>```</p> 
  <p>function:显示当前仿真网络的状态</p> 
  <p>args:""</p> 
  <p>demo: show</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>NODES 0</p> 
  <p>CONNS 0</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;snapshot</p> 
  <p>```</p> 
  <p>function:导出当前仿真网络的节点信息</p> 
  <p>args:""</p> 
  <p>demo: shapshot</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>{"nodes":[{"node":{"config":{"id":"085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d","private_key":"3480d230f453e7c207bbd3b770bf774dc8a17e599394f9283147a35c3ead561c","name":"node1","services":["ping-pong"]},"up":true}},{"node":{"config":{"id":"cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b","private_key":"b7592cdeee6195c4486fcdd8007e1aedfd3a49e6c9f53e0845bf977d4ad043cc","name":"node2","services":["ping-pong"]},"up":false}}],"conns":[{"one":"cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b","other":"085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d","up":false}]}</p> 
  <p><br> &nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;node</p> 
  <p>&gt;&nbsp;*&nbsp;create</p> 
  <p>```</p> 
  <p>function:创建一个节点</p> 
  <p>args:[--name=NAME] [--services=SERVICES] [--key=KEY]</p> 
  <p>demo: node create --name node1</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Created node1</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;list</p> 
  <p>```</p> 
  <p>function:列出当前仿真网络的节点信息</p> 
  <p>args:""</p> 
  <p>demo: node list</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>NAME PROTOCOLS ID</p> 
  <p>node1 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d</p> 
  <p>node2 cedbaecccfe42d04b742d1be6e924e0654a7eb1aa584d497f98d24951b156ada84bcfc6455ff37ba1fc81179d0a7c3da1ba34945be19d1fe5cd4c8a32a659a7b</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;show</p> 
  <p>```</p> 
  <p>function:查看仿真网络中某个节点的具体信息</p> 
  <p>args:&lt;node&gt;</p> 
  <p>demo: node show node1</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>NAME node1</p> 
  <p>PROTOCOLS</p> 
  <p>ID 085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d</p> 
  <p>ENODE enode://085416957c3a0afef6aabe6c0d6b27b7cf8a61f28a3a5439010fcc9e49945a1818ea38946dda8c82004b231ab771450ee0d87886163b65eaa48ecfbcb85e871d@127.0.0.1:30303</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;start</p> 
  <p>```</p> 
  <p>function:启动一个节点</p> 
  <p>args:&lt;node&gt;</p> 
  <p>demo: node start node1</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Started node1</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;connect</p> 
  <p>```</p> 
  <p>function:将一个节点连接到另外一个节点</p> 
  <p>args:&lt;node&gt; &lt;peer&gt;</p> 
  <p>demo: node connect node2 node1</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Connected node2 to node1</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;disconnect</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:节点断开连接</p> 
  <p>args:&lt;node&gt; &lt;peer&gt;</p> 
  <p>demo: node disconnect node2 node1</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Disconnected node2 from node1</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;stop</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:停止一个节点</p> 
  <p>args:&lt;node&gt;</p> 
  <p>demo: node stop node2</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Stopped node2</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>&gt;&nbsp;*&nbsp;rpc</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:调用rpc接口</p> 
  <p>args:&lt;node&gt; &lt;method&gt; [&lt;args&gt;] [--subscribe]</p> 
  <p>demo: node rpc node1 admin</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>　// TODO</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p><strong>### cmd包下的geth子包主函数启动的各个子命令解析</strong></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p><strong>#### /geth</strong></p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__init__</strong></p> 
  <p>```</p> 
  <p>function:导入创世块的json,以指定的json作为创世块</p> 
  <p>args:&lt;genesisPath&gt;</p> 
  <p>demo: init /home/yujian/eth-go/genesis.json</p> 
  <p>notice:ethereum默认创建路径为home目录的.ethereum,如果该目录下已经写入过创世快，会执行失败</p> 
  <p>success_result_demo:</p> 
  <p>WARN [01-16|10:25:12] No etherbase set and no accounts found as default</p> 
  <p>INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=16 handles=16</p> 
  <p>INFO [01-16|10:25:12] Writing custom genesis block</p> 
  <p>INFO [01-16|10:25:12] Successfully wrote genesis state database=chaindata hash=bf2891…ad1419</p> 
  <p>INFO [01-16|10:25:12] Allocated cache and file handles database=/home/yujian/.ethereum/geth/lightchaindata cache=16 handles=16</p> 
  <p>INFO [01-16|10:25:12] Writing custom genesis block</p> 
  <p>INFO [01-16|10:25:12] Successfully wrote genesis state database=lightchaindata hash=bf2891…ad1419</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__import__</strong></p> 
  <p>```</p> 
  <p>function:导入区块数据到当前运行的链中</p> 
  <p>args:&lt;filename&gt; (&lt;filename 2&gt; ... &lt;filename N&gt;)</p> 
  <p>demo: import /home/yujian/eth-block.txt</p> 
  <p>notice:如果导入的文件只要一个是错误的，那么会失败，如果有多个文件错误，那么程序会继续执行忽略错误的．</p> 
  <p>success_result_demo:</p> 
  <p>WARN [01-16|11:00:32] No etherbase set and no accounts found as default</p> 
  <p>INFO [01-16|11:00:32] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024</p> 
  <p>Import done in 306.866µs.</p> 
  <p>&nbsp;</p> 
  <p>INFO [01-16|11:00:32] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3</p> 
  <p>Compactions</p> 
  <p>INFO [01-16|11:00:32] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2</p> 
  <p>Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB)</p> 
  <p>-------+------------+---------------+---------------+---------------+---------------</p> 
  <p>INFO [01-16|11:00:32] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>0 | 3 | 0.00094 | 0.00000 | 0.00000 | 0.00000</p> 
  <p>INFO [01-16|11:00:32] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>&nbsp;</p> 
  <p>Trie cache misses: 0</p> 
  <p>INFO [01-16|11:00:32] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>Trie cache unloads: 0</p> 
  <p>&nbsp;</p> 
  <p>INFO [01-16|11:00:32] Importing blockchain file=/home/yujian/eth-block.txt</p> 
  <p>Object memory: 34.677 MB current, 34.670 MB peak</p> 
  <p>System memory: 74.100 MB current, 73.850 MB peak</p> 
  <p>Allocations: 0.015 million</p> 
  <p>GC pause: 10.454997ms</p> 
  <p>&nbsp;</p> 
  <p>Compacting entire database...</p> 
  <p>INFO [01-16|11:00:33] Database closed database=/home/yujian/.ethereum/geth/chaindata</p> 
  <p>Compaction done in 64.422235ms.</p> 
  <p>&nbsp;</p> 
  <p>Compactions</p> 
  <p>Level | Tables | Size(MB) | Time(sec) | Read(MB) | Write(MB)</p> 
  <p>-------+------------+---------------+---------------+---------------+---------------</p> 
  <p>0 | 0 | 0.00000 | 0.00451 | 0.00000 | 0.00021</p> 
  <p>1 | 1 | 0.00053 | 0.00435 | 0.00114 | 0.00053</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__export__</strong></p> 
  <p>```</p> 
  <p>function:导出区块数据到指定的文件</p> 
  <p>args:&lt;filename&gt; [&lt;blockNumFirst&gt; &lt;blockNumLast&gt;]</p> 
  <p>demo: export /home/yujian/eth-block.txt</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>WARN [01-16|10:51:36] No etherbase set and no accounts found as default</p> 
  <p>INFO [01-16|10:51:36] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024</p> 
  <p>INFO [01-16|10:51:36] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3</p> 
  <p>INFO [01-16|10:51:36] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2</p> 
  <p>Export done in 628.951µsINFO [01-16|10:51:36] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>INFO [01-16|10:51:36] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>INFO [01-16|10:51:36] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>INFO [01-16|10:51:36] Exporting blockchain file=/home/yujian/eth-block.txt</p> 
  <p>INFO [01-16|10:51:36] Exporting batch of blocks count=1</p> 
  <p>INFO [01-16|10:51:36] Exported blockchain file=/home/yujian/eth-block.txt</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__copydb__</strong></p> 
  <p>```</p> 
  <p>function:从存在的链数据文件夹中创建一条本地链</p> 
  <p>args:&lt;sourceChaindataDir&gt;</p> 
  <p>demo: copydb /home/yujian/eth-block.txt</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>WARN [01-16|11:35:55] No etherbase set and no accounts found as default</p> 
  <p>INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024</p> 
  <p>INFO [01-16|11:35:55] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3</p> 
  <p>INFO [01-16|11:35:55] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2</p> 
  <p>INFO [01-16|11:35:55] Loaded most recent local header number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>INFO [01-16|11:35:55] Loaded most recent local full block number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>INFO [01-16|11:35:55] Loaded most recent local fast block number=0 hash=bf2891…ad1419 td=33554432</p> 
  <p>INFO [01-16|11:35:55] Allocated cache and file handles database=/home/yujian/eth-go/geth/chaindata cache=128 handles=256</p> 
  <p>INFO [01-16|11:35:55] Block synchronisation started</p> 
  <p>INFO [01-16|11:35:55] Imported new state entries count=1 elapsed=33.277µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0</p> 
  <p>INFO [01-16|11:35:56] Imported new block headers count=11 elapsed=1.276s number=11 hash=ec3374…59a2ba ignored=0</p> 
  <p>Database copy done in 1.280940454s</p> 
  <p>Compacting entire database...</p> 
  <p>INFO [01-16|11:35:56] Imported new chain segment blocks=11 txs=0 mgas=0.000 elapsed=1.961ms mgasps=0.000 number=11 hash=ec3374…59a2ba</p> 
  <p>Compaction done in 11.130389ms.</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__removedb__</strong></p> 
  <p>```</p> 
  <p>function:移除当前链的数据库</p> 
  <p>args:""</p> 
  <p>demo: removedb</p> 
  <p>notice:默认当前链的数据在home目录下的.ethereum目录下</p> 
  <p>success_result_demo:</p> 
  <p>WARN [01-16|11:48:09] No etherbase set and no accounts found as default</p> 
  <p>/home/yujian/.ethereum/geth/chaindata</p> 
  <p>Remove this database? [y/N] y</p> 
  <p>/home/yujian/.ethereum/geth/lightchaindata</p> 
  <p>INFO [01-16|11:48:19] Database successfully deleted database=chaindata elapsed=7.832ms</p> 
  <p>Remove this database? [y/N] y</p> 
  <p>INFO [01-16|11:48:27] Database successfully deleted database=lightchaindata elapsed=481.229µs</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__dump__</strong></p> 
  <p>```</p> 
  <p>function:转存指定的块</p> 
  <p>args:[&lt;blockHash&gt; | &lt;blockNum&gt;]...</p> 
  <p>demo: dump 0</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>"storage": {}</p> 
  <p>},</p> 
  <p>"af3cb5965933e7dad883693b9c3e15beb68a4873": {</p> 
  <p>"balance": "2000000000000000000000",</p> 
  <p>"nonce": 0,</p> 
  <p>"root": "56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",</p> 
  <p>"codeHash": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",</p> 
  <p>"code": "",</p> 
  <p>"storage": {}</p> 
  <p>},</p> 
  <p>"af4493e8521ca89d95f5267c1ab63f9f45411e1b": {</p> 
  <p>"balance": "200000000000000000000",</p> 
  <p>"nonce": 0,</p> 
  <p>"root": "56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",</p> 
  <p>"codeHash": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",</p> 
  <p>"code": "",</p> 
  <p>"storage": {}</p> 
  <p>},</p> 
  <p>}</p> 
  <p>}</p> 
  <p>INFO [01-16|14:02:06] Database closed database=/home/yujian/.ethereum/geth/chaindata</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__monitor__</strong></p> 
  <p>```</p> 
  <p>function:监视和可视化节点指标</p> 
  <p>args:""</p> 
  <p>demo: monitor</p> 
  <p>notice:该命令本地未调通,需要先启链，才能调用该命令去看监控的状态</p> 
  <p>success_result_demo:</p> 
  <p>// TODO</p> 
  <p><br><br> &nbsp;</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__account__</strong></p> 
  <p>```</p> 
  <p>function:管理账户</p> 
  <p>args:"[new|list|update|import]"</p> 
  <p>demo: account new</p> 
  <p>notice:“帐户导入”选项只能用于导入通用密钥文件</p> 
  <p>success_result_demo:</p> 
  <p>WARN [01-16|14:44:44] No etherbase set and no accounts found as default</p> 
  <p>Your new account is locked with a password. Please give a password. Do not forget this password.</p> 
  <p>!! Unsupported terminal, password will be echoed.</p> 
  <p>Passphrase: 123456</p> 
  <p>&nbsp;</p> 
  <p>Repeat passphrase: 123456</p> 
  <p>&nbsp;</p> 
  <p>Address: {2a23e9223d7af9c56f5abd0c8226021b51c98cbc}</p> 
  <p>&nbsp;</p> 
  <p>Process finished with exit code 0</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__wallet__</strong></p> 
  <p>```</p> 
  <p>function:导入预付款钱包(一般用不到，用的是account功能)</p> 
  <p>args:""</p> 
  <p>demo: wallet import</p> 
  <p>notice:"钱包导入"选项只能用于导入预售钱包</p> 
  <p>success_result_demo:</p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>　　</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__console__</strong></p> 
  <p>```</p> 
  <p>function:开启一条私有链,并打开一个可视化的js钱包控制台</p> 
  <p>args:""</p> 
  <p>demo: console</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>INFO [01-16|15:26:13] Starting peer-to-peer node instance=Geth/v1.7.3-unstable/linux-amd64/go1.9.2</p> 
  <p>INFO [01-16|15:26:13] Allocated cache and file handles database=/home/yujian/.ethereum/geth/chaindata cache=128 handles=1024</p> 
  <p>INFO [01-16|15:26:14] Initialised chain configuration config="{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Engine: ethash}"</p> 
  <p>INFO [01-16|15:26:14] Disk storage enabled for ethash caches dir=/home/yujian/.ethereum/geth/ethash count=3</p> 
  <p>INFO [01-16|15:26:14] Disk storage enabled for ethash DAGs dir=/home/yujian/.ethash count=2</p> 
  <p>INFO [01-16|15:26:14] Initialising Ethereum protocol versions="[63 62]" network=1</p> 
  <p>INFO [01-16|15:26:14] Loaded most recent local header number=1127484 hash=ae7ee2…52ae4c td=8985161313979839462</p> 
  <p>INFO [01-16|15:26:14] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184</p> 
  <p>INFO [01-16|15:26:14] Loaded most recent local fast block number=1092806 hash=6e839a…2eb127 td=8395031237882431385</p> 
  <p>INFO [01-16|15:26:14] Upgrading chain index type=bloombits percentage=80</p> 
  <p>INFO [01-16|15:26:14] Loaded local transaction journal transactions=0 dropped=0</p> 
  <p>INFO [01-16|15:26:14] Regenerated local transaction journal transactions=0 accounts=0</p> 
  <p>INFO [01-16|15:26:14] Starting P2P networking</p> 
  <p>INFO [01-16|15:26:16] UDP listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303</p> 
  <p>INFO [01-16|15:26:16] RLPx listener up self=enode://bef014afb2b63c749d1e3917a25dc9e508cb67e6010965f11695beef50c29f40a5949fc2082487fadb262c30ff2fb626ce86d4a7cf994d025f5dfee7231051e6@[::]:30303</p> 
  <p>INFO [01-16|15:26:16] IPC endpoint opened: /home/yujian/.ethereum/geth.ipc</p> 
  <p>Welcome to the Geth JavaScript console!</p> 
  <p>&nbsp;</p> 
  <p>instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2</p> 
  <p>coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc</p> 
  <p>at block: 0 (Thu, 01 Jan 1970 08:00:00 CST)</p> 
  <p>datadir: /home/yujian/.ethereum</p> 
  <p>modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</p> 
  <p>```</p> 
  <p><br><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__attach__</strong></p> 
  <p>```</p> 
  <p>function:打开一个可视化的js钱包控制台(连接到一个指定的链)</p> 
  <p>args:</p> 
  <p>--jspath loadScript JavaScript root path for loadScript (default: ".")</p> 
  <p>--exec value Execute JavaScript statement</p> 
  <p>--preload value Comma separated list of JavaScript files to preload into the console</p> 
  <p>--datadir "/root/.ethereum" Data directory for the databases and keystore</p> 
  <p>demo:attach --datadir="/home/yujian/.ethereum/geth.ipc"</p> 
  <p>notice:必须启动一条本地链，这样才能连接过去</p> 
  <p>success_result_demo:</p> 
  <p>Welcome to the Geth JavaScript console!</p> 
  <p>&nbsp;</p> 
  <p>instance: Geth/v1.7.3-unstable/linux-amd64/go1.9.2</p> 
  <p>coinbase: 0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc</p> 
  <p>at block: 0 (Thu, 01 Jan 1970 08:00:00 CST)</p> 
  <p>datadir: /home/yujian/.ethereum</p> 
  <p>modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__js__</strong></p> 
  <p>```</p> 
  <p>　function:执行指定的js文件</p> 
  <p>args:&lt;jsfile&gt; [jsfile...]</p> 
  <p>demo:js</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p><br><br> &nbsp;</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__makecache__</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:生成ethhash验证缓存(测试使用)</p> 
  <p>args:&lt;blockNum&gt; &lt;outputDir&gt;</p> 
  <p>demo:makecache 0 /home/yujian/</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>在对应的输出目录，将会生成一个cache文件,如 cache-R23-0000000000000000</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p>*&nbsp;<strong>__makedag__</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:生成ethhash mining dag(测试使用)</p> 
  <p>args:&lt;blockNum&gt; &lt;outputDir&gt;</p> 
  <p>demo:makedag 0 /home/yujian/</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>INFO [01-16|17:50:36] Generating DAG in progress epoch=0 percentage=92 elapsed=3m2.525s</p> 
  <p>INFO [01-16|17:50:38] Generating DAG in progress epoch=0 percentage=93 elapsed=3m4.338s</p> 
  <p>INFO [01-16|17:50:40] Generating DAG in progress epoch=0 percentage=94 elapsed=3m6.058s</p> 
  <p>INFO [01-16|17:50:41] Generating DAG in progress epoch=0 percentage=95 elapsed=3m7.795s</p> 
  <p>INFO [01-16|17:50:43] Generating DAG in progress epoch=0 percentage=96 elapsed=3m9.542s</p> 
  <p>INFO [01-16|17:50:45] Generating DAG in progress epoch=0 percentage=97 elapsed=3m11.380s</p> 
  <p>INFO [01-16|17:50:47] Generating DAG in progress epoch=0 percentage=98 elapsed=3m13.129s</p> 
  <p>INFO [01-16|17:50:49] Generating DAG in progress epoch=0 percentage=99 elapsed=3m15.303s</p> 
  <p>INFO [01-16|17:50:49] Generated ethash verification cache epoch=0 elapsed=3m15.306s</p> 
  <p>&nbsp;</p> 
  <p>Process finished with exit code 0</p> 
  <p>&nbsp;</p> 
  <p>在对应的输出目录,将会生成一个full文件,如 full-R23-0000000000000000</p> 
  <p><br> &nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__version__</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:打印版本数据</p> 
  <p>args:""</p> 
  <p>demo:version</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Geth</p> 
  <p>Version: 1.7.3-unstable</p> 
  <p>Architecture: amd64</p> 
  <p>Protocol Versions: [63 62]</p> 
  <p>Network Id: 1</p> 
  <p>Go Version: go1.9.2</p> 
  <p>Operating System: linux</p> 
  <p>GOPATH=/home/yujian/blockchain-workspace/go-project</p> 
  <p>GOROOT=/usr/local/go</p> 
  <p>　　</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__bug__</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:打开一个窗口,直接跳转到ethereum的github仓库的issue</p> 
  <p>args:""</p> 
  <p>demo:bug</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>　　运行后会自动打开浏览器，跳转到ethereum的issue编辑页面　</p> 
  <p><br> &nbsp;</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__license__</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:显示geth的license信息</p> 
  <p>args:""</p> 
  <p>demo:license</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>Geth is free software: you can redistribute it and/or modify</p> 
  <p>it under the terms of the GNU General Public License as published by</p> 
  <p>the Free Software Foundation, either version 3 of the License, or</p> 
  <p>(at your option) any later version.</p> 
  <p>&nbsp;</p> 
  <p>Geth is distributed in the hope that it will be useful,</p> 
  <p>but WITHOUT ANY WARRANTY; without even the implied warranty of</p> 
  <p>MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</p> 
  <p>GNU General Public License for more details.</p> 
  <p>&nbsp;</p> 
  <p>You should have received a copy of the GNU General Public License</p> 
  <p>along with geth. If not, see &lt;http://www.gnu.org/licenses/&gt;.</p> 
  <p>```</p> 
  <p>&nbsp;</p> 
  <p>*&nbsp;<strong>__dumpconfig__</strong></p> 
  <p>&nbsp;</p> 
  <p>```</p> 
  <p>function:显示配置信息</p> 
  <p>args:""</p> 
  <p>demo:dumpconfig</p> 
  <p>notice:</p> 
  <p>success_result_demo:</p> 
  <p>　[Eth]</p> 
  <p>NetworkId = 1</p> 
  <p>SyncMode = "fast"</p> 
  <p>LightPeers = 20</p> 
  <p>DatabaseCache = 128</p> 
  <p>Etherbase = "0x2a23e9223d7af9c56f5abd0c8226021b51c98cbc"</p> 
  <p>GasPrice = 18000000000</p> 
  <p>EthashCacheDir = "ethash"</p> 
  <p>EthashCachesInMem = 2</p> 
  <p>EthashCachesOnDisk = 3</p> 
  <p>EthashDatasetDir = "/home/yujian/.ethash"</p> 
  <p>EthashDatasetsInMem = 1</p> 
  <p>EthashDatasetsOnDisk = 2</p> 
  <p>EnablePreimageRecording = false</p> 
  <p>&nbsp;</p> 
  <p>[Eth.TxPool]</p> 
  <p>NoLocals = false</p> 
  <p>Journal = "transactions.rlp"</p> 
  <p>Rejournal = 3600000000000</p> 
  <p>PriceLimit = 1</p> 
  <p>PriceBump = 10</p> 
  <p>AccountSlots = 16</p> 
  <p>GlobalSlots = 4096</p> 
  <p>AccountQueue = 64</p> 
  <p>GlobalQueue = 1024</p> 
  <p>Lifetime = 10800000000000</p> 
  <p>&nbsp;</p> 
  <p>[Eth.GPO]</p> 
  <p>Blocks = 10</p> 
  <p>Percentile = 50</p> 
  <p>&nbsp;</p> 
  <p>[Shh]</p> 
  <p>MaxMessageSize = 1048576</p> 
  <p>MinimumAcceptedPOW = 2e-01</p> 
  <p>&nbsp;</p> 
  <p>[Node]</p> 
  <p>DataDir = "/home/yujian/.ethereum"</p> 
  <p>IPCPath = "geth.ipc"</p> 
  <p>HTTPPort = 8545</p> 
  <p>HTTPModules = ["net", "web3", "eth", "shh"]</p> 
  <p>WSPort = 8546</p> 
  <p>WSModules = ["net", "web3", "eth", "shh"]</p> 
  <p>&nbsp;</p> 
  <p>[Node.P2P]</p> 
  <p>MaxPeers = 25</p> 
  <p>NoDiscovery = false</p> 
  <p>DiscoveryV5Addr = ":30304"</p> 
  <p>BootstrapNodes = ["enode://a979fb575495b8d6db44f750317d0f4622bf4c2aa3365d6af7c284339968eef29b69ad0dce72a4d8db5ebb4968de0e3bec910127f134779fbcb0cb6d3331163c@52.16.188.185:30303", "enode://3f1d12044546b76342d59d4a05532c14b85aa669704bfe1f864fe079415aa2c02d743e03218e57a33fb94523adb54032871a6c51b2cc5514cb7c7e35b3ed0a99@13.93.211.84:30303", "enode://78de8a0916848093c73790ead81d1928bec737d565119932b98c6b100d944b7a95e94f847f689fc723399d2e31129d182f7ef3863f2b4c820abbf3ab2722344d@191.235.84.50:30303", "enode://158f8aab45f6d19c6cbf4a089c2670541a8da11978a2f90dbf6a502a4a3bab80d288afdbeb7ec0ef6d92de563767f3b1ea9e8e334ca711e9f8e2df5a0385e8e6@13.75.154.138:30303", "enode://1118980bf48b0a3640bdba04e0fe78b1add18e1cd99bf22d53daac1fd9972ad650df52176e7c7d89d1114cfef2bc23a2959aa54998a46afcf7d91809f0855082@52.74.57.123:30303", "enode://979b7fa28feeb35a4741660a16076f1943202cb72b6af70d327f053e248bab9ba81760f39d0701ef1d8f89cc1fbd2cacba0710a12cd5314d5e0c9021aa3637f9@5.1.83.226:30303"]</p> 
  <p>BootstrapNodesV5 = ["enode://0cc5f5ffb5d9098c8b8c62325f3797f56509bff942704687b6530992ac706e2cb946b90a34f1f19548cd3c7baccbcaea354531e5983c7d1bc0dee16ce4b6440b@40.118.3.223:30305", "enode://1c7a64d76c0334b0418c004af2f67c50e36a3be60b5e4790bdac0439d21603469a85fad36f2473c9a80eb043ae60936df905fa28f1ff614c3e5dc34f15dcd2dc@40.118.3.223:30308", "enode://85c85d7143ae8bb96924f2b54f1b3e70d8c4d367af305325d30a61385a432f247d2c75c45c6b4a60335060d072d7f5b35dd1d4c45f76941f62a4f83b6e75daaf@40.118.3.223:30309"]</p> 
  <p>StaticNodes = []</p> 
  <p>TrustedNodes = []</p> 
  <p>ListenAddr = ":30303"</p> 
  <p>EnableMsgEvents = false</p> 
  <p>&nbsp;</p> 
  <p>[Dashboard]</p> 
  <p>Host = "localhost"</p> 
  <p>Port = 8080</p> 
  <p>Refresh = 3000000000　</p> 
  <p>```</p> 
  <p><br> &nbsp;</p> 
  <p><strong>##### 参考资料</strong></p> 
  <p>*&nbsp;[eth钱包创建](https://www.myetherwallet.com/#generate-wallet)</p> 
  <p>*&nbsp;[eth命令使用解释](http://www.blockcode.org/archives/185)</p> 
  <p><br> 转载&nbsp; &nbsp; &nbsp;<a href="https://blog.csdn.net/itcastcpp/article/details/80304332" rel="nofollow">以太坊源码分析(10)CMD深入分析</a></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhichunqi/article/details/81812524,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhichunqi/article/details/81812524,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

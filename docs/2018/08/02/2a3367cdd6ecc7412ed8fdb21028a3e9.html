<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>基于Ubuntu Docker环境下进行以太坊实践 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="基于Ubuntu Docker环境下进行以太坊实践" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本文是指导以太坊技术爱好者，通过基于Ubuntu环境下通过docker来进行以太坊的客户端安装和调试的指导教程。 &nbsp; 目录 1、实践环境要求 2、Ubuntu版本说明 3、Docker安装 4、Ethereum安装与实践 5、ZSH小工具推荐 &nbsp; 1 实践环境要求 1.1 概述 https://docs.docker.com/engine/installation/linux/ubuntulinux/ 上面这篇文章主要指导你去安装使用Docker-managed发布包及其安装机制。使用这些包确保你获得最近的docker官方发布版本。如果你需要安装使用Ubuntu-managed包，查阅Ubuntu文档。 1.2 docker对操作系统支持 Ubuntu Xenial 16.04[LTS] Ubuntu Trusty 14.04[LTS]　　 Ubuntu Precise 12.04[LTS] 1.3 前置需求 不管你是Ubuntu的哪个版本，Docker需要64的操作系统。此外你的kernel内核至少要在3.10版本之上。最近的3.10小版本或者最新的维护版本也是可以接受的。kernel3.10版本之前的系统缺少一些特性来运行docker容器。这些旧版本有些已知的bugs会导致数据丢失并且在一定条件下会频繁的故障。检查你当前的kernel版本，打开终端，输入uname –r 注意：如果你之前使用APT安装过docker，为了新版本的docker仓库，确保你更新了APT源。 1.4 更新apt源 Docker的APT仓库包含1.7.1以及更高的版本。通过设置APT使用来自docker仓库的包。 1) 登陆机器，用户必须使用sudo或者root权限。 2) 打开终端 3) 更新包信息，确保APT能使用https方式工作，并且CA证书已安装了 #sudo apt-get update ​ #sudo apt-get install apt-transport-https ca-certificates &nbsp; 出现这个问题可能是有另一个程序正在运行，导致资源被锁不可用。而导致资源被锁的原因可能是上次运行安装或更新没有正常完成，解决办法就是删掉。 #sudo rm /var/cache/apt/archives/lock ​ #sudo rm /var/lib/dpkg/lock 4)添加一个新的GPG密钥 #sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D 5)找到合适你的Ubuntu操作系统的键，这个键决定APT将搜索哪个包。可能的键有： Ubuntu version: Precise 12.04, Trusty 14.04,Cenial 16.04 注意：docker没有为所有的架构提供包，Binary artifacts are built nightly,你可以从以下链接下载。 https://master.dockerproject.org. 在一个多架构的系统上安装docker，为键添加一个[arch=]条款。更多细节参考Debian Multiarch维基百科。 6)运行下面的命令，用占位符&lt;REPO&gt;为你的操作系统替换键。 #echo &quot;&lt;REPO&gt;&quot; | sudo tee /etc/apt/sources.list.d/docker.list 比如你是16.04将上面命令的&lt;REPO&gt; 替换成deb https://apt.dockerproject.org/repoubuntu-xenial main 执行那条命令，就在那个文件夹下创建了一个docker.list文件，里面的内容就是 deb https://apt.dockerproject.org/repoubuntu-xenial main 7)更新APT包索引 #sudo apt-get update 8)校验APT是从一个正确的仓库拉取安装包。 当运行下面命令的时候，这个键会返回你目前可以安装的docker版本，每个键都包括URL：https://apt.dockerproject.org/repo/。下面是截取的部分输出内容。 #apt-cache policy docker-engine 现在当你运行apt-get upgrade的时候，APT就会从新的仓库拉安装包。 &nbsp; 2 Ubuntu版本说明 2.1 前置准备操作 Ubuntu Xenial 16.04[LTS]，Ubuntu Trusty 14.04[LTS]这两个版本记得安装linux-iamge-extra-*的kernel包。这个包允许你使用aufs存储驱动。 # sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual Ubuntu Precise 12.04[LTS]对于这个版本，你需要3.13以上的kernel版本，你必须升级。下面表格指导你需要哪些包： 你可以执行以下命令： #sudo apt-get install linux-image-generic-lts-trusty ​ #sudo reboot &nbsp; 3 Docker安装 3.1 前置操作 1).登陆系统，用你的账号使用sudo全权限 2).运行命令apt-get install openssh-server安装ssh 查看是否安装成功ps -ef|grep ssh 3).更新APT包索引：sudo apt-get update 4).安装docker：sudo apt-get install docker-engine 5).开启docker后台进程：sudo service docker start 6).校验docker是否安装成功：sudo docker run hello-world 这个命令会下载一个测试镜像，并且运行在一个容器中。当容器运行时，他会打印一些信息，并且退出。 3.2 创建一个docker组 docker后台进程是绑定的Unix的socket而不是TCP端口。默认情况下，Unix的socket属于用户root，其它用户要使用要通过sudo命令。由于这个原因，docker daemon通常使用root用户运行。为了避免使用sudo当你使用docker命令的时候，创建一个Unix组名为docker并且添加用户。当docker daemon启动，它会分配Unix socket读写权限给所属的docker组。 注意：docker组不等价于用户root，如果想要知道的更多关于安全影响，查看docker daemon attack surface。 #sudo groupadd docker ​ #sudo usermod -aG docker $USER 退出再重进，确保该用户有正确的权限。校验生效，通过运行docker命令不带sudo：docker run hello-world，如果失败会有以下类似的信息：Cannot connect to the Docker daemon. Is &#39;docker daemon&#39; running on this host?确保DOCKER_HOST环境变量没有设置。如果有取消它。 3.3 调整内存和交换区计算 当用户运行docker时，他们可能在使用一个镜像时看见下面的信息： WARNING: Your kernel does not support cgroup swap limit. WARNING: Your kernel does not support swap limit capabilities. Limitation discarded. 为了阻止这些信息，在你的系统中启用内存和交换区计算。这个操作会导致即便docker没有使用也有内存开销以及性能下降。内存开销大概是总内存的1%。性能降低了大约10%。 修改/etc/default/grub文件。vi或者vim命令都行，设置GRUB_CMDLINE_LINUX的值，如下： GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;。 保存文件并关闭。 #sudo update-grub 更新启动项，reboot重启你的系统。 3.4 启动UFW转发 当你运行docker时，在同一台主机上使用UFW(Uncomplicated Firewall) ，你需要额外的配置。docker使用桥接方式来管理容器的网络。默认情况下，UFW废弃所有的转发流量。因此，docker运行时UFW可以使用，你必须设置合适UFW的转发规则。 UFW默认配置规则拒绝了所有传入流量。如果你想要从另一个主机到达你的容器需要允许连接docker的端口。docker的默认端口是2376如果TLS启用，如果没有启动则是2375,会话是不加密的。默认情况，docker运行在没有TLS启动的情况下。 为了配置UFW并且允许进入的连接docker端口： 检查UFW是否安装并启用： #sudo ufw status 打开/etc/default/ufw文件并编辑： #sudo nano /etc/default/ufw 设置DEFAULT_FORWARD_POLICY：DEFAULT_FORWARD_POLICY=&quot;ACCEPT&quot; 保存退出并重启使用新的设置： #sudo ufw reload 允许所有的连接到docker端口： #sudo ufw allow 2375/tcp 3.5 为docker配置DNS服务器 系统运行桌面的Ubuntu或者Ubuntu衍生产品通常使用127.0.0.1作为默认的nameserver文件/etc/resolv.conf文件中。NetworkManager也通常设置dnsmasq nameserver 127.0.0.1在/etc/resolv.conf。 当在桌面机器运行容器，使用这些配置时，docker的使用者会看见这些警告： WARNING: Local (127.0.0.1) DNS resolver found in resolv.conf and containers can&#39;t use it. Using default external servers : [8.8.8.8 8.8.4.4] 这个警告发生是因为docker容器不能使用本地DNS命名服务器。此外docker默认使用一个额外的nameserver。 为了避免这个警告，你可以在使用docker容器的时候指定一个DNS服务器。或者你可以禁用dnsmasq在NetworkManager中。但是，禁用会导致DNS协议在某些网络中变慢。 下面的说明描述了如何在Ubuntu14.0或以下版本配置docker守护进程。Ubuntu15.04及之上的使用systemd用于启动项和服务管理。指导通过使用systemd来配置和控制一个守护进程。 设置指定的DNS服务： 打开/etc/default/docker文件并编辑：sudo nano /etc/default/docker，添加配置项：DOCKER_OPTS=&quot;--dns 8.8.8.8&quot;。将8.8.8.8用一个本地的DNS服务例如192.168.1.1替换。你也可以配置多个DNS服务器。 用空格隔开它们，如：--dns 8.8.8.8 --dns 192.168.1.1。 警告：当你在笔记本连接了不同网络的情况时做这些操作，确保选择一个公用的DNS服务器。保存文件并退出，重启docker守护进程：sudo service docker restart。或者另一个选择，禁用dnsmasq在网络管理器中，这可能导致你的网速变慢： 打开/etc/NetworkManager/NetworkManager.conf文件， 编辑它：sudo nano /etc/NetworkManager/NetworkManager.conf。 找到行dns=dnsmasq，注释掉。 保存关闭文件，重启网络管理器和docker. #sudo restart network-manager &nbsp; ​ #sudo restart docker 3.6 配置docker引导启动 Ubuntu15.04之后使用systemd作为引导启动和服务管理，14.10及以下版本是upstart。15.04以上，需要配置docker守护进程boot启动， 运行命令： #sudo systemctl enable docker 14.10及以下版本安装方法会自动配置upstart来启动docke daemon在boot。 3.7 升级卸载docker 升级： #sudo apt-get upgrade docker-engine 卸载： #sudo apt-get purge docker-engine 卸载及依赖： #sudo apt-get autoremove --purge docker-engine 上述命令不会卸载images，containers，volumes或者用户自己创建的配置文件。 你如果想删除这些东西，执行下面的命令： #rm -rf /var/lib/docker 安装最简单的方法是： #sudo apt-get update　　 ​ #sudo apt-get install 3.8 执行docker-compose安装 docker-compose 是用于定义和运行复杂docker应用的工具，以yaml定义语言在一个docker-compose.yaml文件中定义一个包括多容器的应用，用一条命令即可启动应用中包括的所有docker container，容器启动所有依赖的动作都会被工具自动完成。 #curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose ​ #chmod +x /usr/local/bin/docker- &nbsp; 4 Ethereum安装与实践 4.1 通过docker安装Ethereum 运行如下命令 #docker pull docker.io/ethereum/client-go 4.2 直接安装Ethereum 运行如下命令 #apt-get update ​ #apt-get install software-properties-common add-apt-repository -y ppa:ethereum/ethereum 安装一个稳定版本的以太坊 #apt-get update ​ #apt-get install ethereum ​ #apt-get update 生成引导节点ID #bootnode --genkey=boot.key 运行引导节点 #bootnode --nodekey=boot.key 4.3 新建genesis.json文件 运行以下命令 vi genesis.json 输入 &nbsp; 4.4 初始化创始区块 运行如下命令 #docker run -itd --privileged=true -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --datadir /root/ethdev --networkid 8765639736937780 init /root/ethdev/genesis.json 4.5 创建Ethereum节点的容器 运行如下命令 #docker rm -f gethDev1 ​ #docker run -itd -m 512M --privileged=true --memory-swap -1 --net=host -p 8545:8545 -p 40303:40303 -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --ipcdisable --port 40303 --bootnodes &quot;enode://2039a49989e45bf119ecd21403607ea9f5888b13a6bb7a03ed81687deabb251095e4193a77eca067076f77ed40e4c6fd51539038c440337beffbbb36953d1d75@192.168.3.43:30301&quot; --debug --nodiscover --rpcapi &quot;db,eth,net,web3,personal,admin,miner,txpool&quot; --datadir /root/ethdev --networkid 8765639736937780 --wsapi &quot;db,eth,net,web3,personal,admin,miner,txpool&quot; --ws --wsaddr &quot;0.0.0.0&quot; --rpc --rpcaddr &quot;0.0.0.0&quot; --cache=512 --verbosity 6 --mine --minerthreads=1 --etherbase=0x5f38056f45091ee992298e53681b0a60c999ff95 console &nbsp; 4.6 查看Ethereum节点docker日志 运行如下命令 #docker logs -f gethDev1 4.7启动Ethereum节点 运行如下命令 #docker startgethDev1 4.8 Attach Ethereum节点 运行如下命令 #docker attach gethDev1 4.9 Detach Ethereum节点 先后按下键盘ctrl+p+q退出节点，注意：有先后顺序 4.10 停止Ethereum节点 运行命令如下 #docker stopgethDev1 4.11 Ethereum日志释疑 首先，告警提示geth抱怨没有定义etherbase，etherbase是成功挖掘区块，执行智能合约并在区块链内返回结果之后用来接收以太奖励的“默认以太坊地址”。这个帐户，在开发合同时也很方便。 接下来，我们看到blockchain数据被写入/root/.ethereum/chaindata，因为我们已经从我们的主机挂载了这个目录，我们应该可以在本地磁盘上看到出现的数据： docker exec –i ethereum geth account new ls –l /opt/docker/ethereum/keystore/. docker exec ethereum apt-get install –y ntpdate docker exec ethereum ntpdate –s ntp.ubuntu.com 在当前配置中，我们有一个可以挂载到我们的容器中的以太坊数据目录。这不是因为区块链数据只能在任何情况下由一个进程访问，而是访问可由Ethereum节点用于进程间通信的IPC文件描述符。因此，我们可以在这里继续，而不需要访问网络。 &nbsp; 5 zsh小工具推荐 zsh是一款小工具，对命令补全功能非常强大，可以补齐路径，补齐命令，补齐参数等。 5.1 修改root用户SHELL 先进入root用户，命令： su root 查看默认SHELL命令： echo $SHELL 然后查看是否安装了zsh，命令： cat /etc/shells 默认没有安装，那么先安装zsh,命令： apt-get install zsh 确认zsh是否安装成功，命令： zsh --version 接下来替换bash为zsh，命令： chsh -s /bin/zsh 然后reboot重启，之后查看默认SHELL,发现修改为/bin/zsh 查看是否安装git，命令： git –version 如果没有安装则安装，命令： apt-get install git 最后下载oh-my-zsh，命令： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 出现如上则安装成功，重新进入终端即可。 5.2 修改普通用户SHELL 查看默认SHELL，命令： echo $SHELL 如果是/bin/zsh则直接： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 是/bin/bash则，切换： chsh -s /bin/zsh 然后用root权限reboot，然后： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 安装成功后可以（vi ~/.zshrc）来修改配置文件以改变样式(注意root和非root都要改，可以选择不一样的样式)。 root的样式配置文件在根目录root下，为隐藏文件；非root在/home/root下。 具体样式选择https://github.com/robbyrussell/oh-my-zsh/wiki/themes &nbsp; 原文链接：http://wangxiaoming.com/blog/2018/01/01/HPB-40-ETH-docker/ &nbsp; 关于我：蓝莲花（汪晓明），微信/QQ：86606813，公众号：xm123798。HPB芯链（http://www.hpb.io)创始人。致力于推动区块链应用落地。 &nbsp; 阅读更多" />
<meta property="og:description" content="本文是指导以太坊技术爱好者，通过基于Ubuntu环境下通过docker来进行以太坊的客户端安装和调试的指导教程。 &nbsp; 目录 1、实践环境要求 2、Ubuntu版本说明 3、Docker安装 4、Ethereum安装与实践 5、ZSH小工具推荐 &nbsp; 1 实践环境要求 1.1 概述 https://docs.docker.com/engine/installation/linux/ubuntulinux/ 上面这篇文章主要指导你去安装使用Docker-managed发布包及其安装机制。使用这些包确保你获得最近的docker官方发布版本。如果你需要安装使用Ubuntu-managed包，查阅Ubuntu文档。 1.2 docker对操作系统支持 Ubuntu Xenial 16.04[LTS] Ubuntu Trusty 14.04[LTS]　　 Ubuntu Precise 12.04[LTS] 1.3 前置需求 不管你是Ubuntu的哪个版本，Docker需要64的操作系统。此外你的kernel内核至少要在3.10版本之上。最近的3.10小版本或者最新的维护版本也是可以接受的。kernel3.10版本之前的系统缺少一些特性来运行docker容器。这些旧版本有些已知的bugs会导致数据丢失并且在一定条件下会频繁的故障。检查你当前的kernel版本，打开终端，输入uname –r 注意：如果你之前使用APT安装过docker，为了新版本的docker仓库，确保你更新了APT源。 1.4 更新apt源 Docker的APT仓库包含1.7.1以及更高的版本。通过设置APT使用来自docker仓库的包。 1) 登陆机器，用户必须使用sudo或者root权限。 2) 打开终端 3) 更新包信息，确保APT能使用https方式工作，并且CA证书已安装了 #sudo apt-get update ​ #sudo apt-get install apt-transport-https ca-certificates &nbsp; 出现这个问题可能是有另一个程序正在运行，导致资源被锁不可用。而导致资源被锁的原因可能是上次运行安装或更新没有正常完成，解决办法就是删掉。 #sudo rm /var/cache/apt/archives/lock ​ #sudo rm /var/lib/dpkg/lock 4)添加一个新的GPG密钥 #sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D 5)找到合适你的Ubuntu操作系统的键，这个键决定APT将搜索哪个包。可能的键有： Ubuntu version: Precise 12.04, Trusty 14.04,Cenial 16.04 注意：docker没有为所有的架构提供包，Binary artifacts are built nightly,你可以从以下链接下载。 https://master.dockerproject.org. 在一个多架构的系统上安装docker，为键添加一个[arch=]条款。更多细节参考Debian Multiarch维基百科。 6)运行下面的命令，用占位符&lt;REPO&gt;为你的操作系统替换键。 #echo &quot;&lt;REPO&gt;&quot; | sudo tee /etc/apt/sources.list.d/docker.list 比如你是16.04将上面命令的&lt;REPO&gt; 替换成deb https://apt.dockerproject.org/repoubuntu-xenial main 执行那条命令，就在那个文件夹下创建了一个docker.list文件，里面的内容就是 deb https://apt.dockerproject.org/repoubuntu-xenial main 7)更新APT包索引 #sudo apt-get update 8)校验APT是从一个正确的仓库拉取安装包。 当运行下面命令的时候，这个键会返回你目前可以安装的docker版本，每个键都包括URL：https://apt.dockerproject.org/repo/。下面是截取的部分输出内容。 #apt-cache policy docker-engine 现在当你运行apt-get upgrade的时候，APT就会从新的仓库拉安装包。 &nbsp; 2 Ubuntu版本说明 2.1 前置准备操作 Ubuntu Xenial 16.04[LTS]，Ubuntu Trusty 14.04[LTS]这两个版本记得安装linux-iamge-extra-*的kernel包。这个包允许你使用aufs存储驱动。 # sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual Ubuntu Precise 12.04[LTS]对于这个版本，你需要3.13以上的kernel版本，你必须升级。下面表格指导你需要哪些包： 你可以执行以下命令： #sudo apt-get install linux-image-generic-lts-trusty ​ #sudo reboot &nbsp; 3 Docker安装 3.1 前置操作 1).登陆系统，用你的账号使用sudo全权限 2).运行命令apt-get install openssh-server安装ssh 查看是否安装成功ps -ef|grep ssh 3).更新APT包索引：sudo apt-get update 4).安装docker：sudo apt-get install docker-engine 5).开启docker后台进程：sudo service docker start 6).校验docker是否安装成功：sudo docker run hello-world 这个命令会下载一个测试镜像，并且运行在一个容器中。当容器运行时，他会打印一些信息，并且退出。 3.2 创建一个docker组 docker后台进程是绑定的Unix的socket而不是TCP端口。默认情况下，Unix的socket属于用户root，其它用户要使用要通过sudo命令。由于这个原因，docker daemon通常使用root用户运行。为了避免使用sudo当你使用docker命令的时候，创建一个Unix组名为docker并且添加用户。当docker daemon启动，它会分配Unix socket读写权限给所属的docker组。 注意：docker组不等价于用户root，如果想要知道的更多关于安全影响，查看docker daemon attack surface。 #sudo groupadd docker ​ #sudo usermod -aG docker $USER 退出再重进，确保该用户有正确的权限。校验生效，通过运行docker命令不带sudo：docker run hello-world，如果失败会有以下类似的信息：Cannot connect to the Docker daemon. Is &#39;docker daemon&#39; running on this host?确保DOCKER_HOST环境变量没有设置。如果有取消它。 3.3 调整内存和交换区计算 当用户运行docker时，他们可能在使用一个镜像时看见下面的信息： WARNING: Your kernel does not support cgroup swap limit. WARNING: Your kernel does not support swap limit capabilities. Limitation discarded. 为了阻止这些信息，在你的系统中启用内存和交换区计算。这个操作会导致即便docker没有使用也有内存开销以及性能下降。内存开销大概是总内存的1%。性能降低了大约10%。 修改/etc/default/grub文件。vi或者vim命令都行，设置GRUB_CMDLINE_LINUX的值，如下： GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;。 保存文件并关闭。 #sudo update-grub 更新启动项，reboot重启你的系统。 3.4 启动UFW转发 当你运行docker时，在同一台主机上使用UFW(Uncomplicated Firewall) ，你需要额外的配置。docker使用桥接方式来管理容器的网络。默认情况下，UFW废弃所有的转发流量。因此，docker运行时UFW可以使用，你必须设置合适UFW的转发规则。 UFW默认配置规则拒绝了所有传入流量。如果你想要从另一个主机到达你的容器需要允许连接docker的端口。docker的默认端口是2376如果TLS启用，如果没有启动则是2375,会话是不加密的。默认情况，docker运行在没有TLS启动的情况下。 为了配置UFW并且允许进入的连接docker端口： 检查UFW是否安装并启用： #sudo ufw status 打开/etc/default/ufw文件并编辑： #sudo nano /etc/default/ufw 设置DEFAULT_FORWARD_POLICY：DEFAULT_FORWARD_POLICY=&quot;ACCEPT&quot; 保存退出并重启使用新的设置： #sudo ufw reload 允许所有的连接到docker端口： #sudo ufw allow 2375/tcp 3.5 为docker配置DNS服务器 系统运行桌面的Ubuntu或者Ubuntu衍生产品通常使用127.0.0.1作为默认的nameserver文件/etc/resolv.conf文件中。NetworkManager也通常设置dnsmasq nameserver 127.0.0.1在/etc/resolv.conf。 当在桌面机器运行容器，使用这些配置时，docker的使用者会看见这些警告： WARNING: Local (127.0.0.1) DNS resolver found in resolv.conf and containers can&#39;t use it. Using default external servers : [8.8.8.8 8.8.4.4] 这个警告发生是因为docker容器不能使用本地DNS命名服务器。此外docker默认使用一个额外的nameserver。 为了避免这个警告，你可以在使用docker容器的时候指定一个DNS服务器。或者你可以禁用dnsmasq在NetworkManager中。但是，禁用会导致DNS协议在某些网络中变慢。 下面的说明描述了如何在Ubuntu14.0或以下版本配置docker守护进程。Ubuntu15.04及之上的使用systemd用于启动项和服务管理。指导通过使用systemd来配置和控制一个守护进程。 设置指定的DNS服务： 打开/etc/default/docker文件并编辑：sudo nano /etc/default/docker，添加配置项：DOCKER_OPTS=&quot;--dns 8.8.8.8&quot;。将8.8.8.8用一个本地的DNS服务例如192.168.1.1替换。你也可以配置多个DNS服务器。 用空格隔开它们，如：--dns 8.8.8.8 --dns 192.168.1.1。 警告：当你在笔记本连接了不同网络的情况时做这些操作，确保选择一个公用的DNS服务器。保存文件并退出，重启docker守护进程：sudo service docker restart。或者另一个选择，禁用dnsmasq在网络管理器中，这可能导致你的网速变慢： 打开/etc/NetworkManager/NetworkManager.conf文件， 编辑它：sudo nano /etc/NetworkManager/NetworkManager.conf。 找到行dns=dnsmasq，注释掉。 保存关闭文件，重启网络管理器和docker. #sudo restart network-manager &nbsp; ​ #sudo restart docker 3.6 配置docker引导启动 Ubuntu15.04之后使用systemd作为引导启动和服务管理，14.10及以下版本是upstart。15.04以上，需要配置docker守护进程boot启动， 运行命令： #sudo systemctl enable docker 14.10及以下版本安装方法会自动配置upstart来启动docke daemon在boot。 3.7 升级卸载docker 升级： #sudo apt-get upgrade docker-engine 卸载： #sudo apt-get purge docker-engine 卸载及依赖： #sudo apt-get autoremove --purge docker-engine 上述命令不会卸载images，containers，volumes或者用户自己创建的配置文件。 你如果想删除这些东西，执行下面的命令： #rm -rf /var/lib/docker 安装最简单的方法是： #sudo apt-get update　　 ​ #sudo apt-get install 3.8 执行docker-compose安装 docker-compose 是用于定义和运行复杂docker应用的工具，以yaml定义语言在一个docker-compose.yaml文件中定义一个包括多容器的应用，用一条命令即可启动应用中包括的所有docker container，容器启动所有依赖的动作都会被工具自动完成。 #curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose ​ #chmod +x /usr/local/bin/docker- &nbsp; 4 Ethereum安装与实践 4.1 通过docker安装Ethereum 运行如下命令 #docker pull docker.io/ethereum/client-go 4.2 直接安装Ethereum 运行如下命令 #apt-get update ​ #apt-get install software-properties-common add-apt-repository -y ppa:ethereum/ethereum 安装一个稳定版本的以太坊 #apt-get update ​ #apt-get install ethereum ​ #apt-get update 生成引导节点ID #bootnode --genkey=boot.key 运行引导节点 #bootnode --nodekey=boot.key 4.3 新建genesis.json文件 运行以下命令 vi genesis.json 输入 &nbsp; 4.4 初始化创始区块 运行如下命令 #docker run -itd --privileged=true -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --datadir /root/ethdev --networkid 8765639736937780 init /root/ethdev/genesis.json 4.5 创建Ethereum节点的容器 运行如下命令 #docker rm -f gethDev1 ​ #docker run -itd -m 512M --privileged=true --memory-swap -1 --net=host -p 8545:8545 -p 40303:40303 -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --ipcdisable --port 40303 --bootnodes &quot;enode://2039a49989e45bf119ecd21403607ea9f5888b13a6bb7a03ed81687deabb251095e4193a77eca067076f77ed40e4c6fd51539038c440337beffbbb36953d1d75@192.168.3.43:30301&quot; --debug --nodiscover --rpcapi &quot;db,eth,net,web3,personal,admin,miner,txpool&quot; --datadir /root/ethdev --networkid 8765639736937780 --wsapi &quot;db,eth,net,web3,personal,admin,miner,txpool&quot; --ws --wsaddr &quot;0.0.0.0&quot; --rpc --rpcaddr &quot;0.0.0.0&quot; --cache=512 --verbosity 6 --mine --minerthreads=1 --etherbase=0x5f38056f45091ee992298e53681b0a60c999ff95 console &nbsp; 4.6 查看Ethereum节点docker日志 运行如下命令 #docker logs -f gethDev1 4.7启动Ethereum节点 运行如下命令 #docker startgethDev1 4.8 Attach Ethereum节点 运行如下命令 #docker attach gethDev1 4.9 Detach Ethereum节点 先后按下键盘ctrl+p+q退出节点，注意：有先后顺序 4.10 停止Ethereum节点 运行命令如下 #docker stopgethDev1 4.11 Ethereum日志释疑 首先，告警提示geth抱怨没有定义etherbase，etherbase是成功挖掘区块，执行智能合约并在区块链内返回结果之后用来接收以太奖励的“默认以太坊地址”。这个帐户，在开发合同时也很方便。 接下来，我们看到blockchain数据被写入/root/.ethereum/chaindata，因为我们已经从我们的主机挂载了这个目录，我们应该可以在本地磁盘上看到出现的数据： docker exec –i ethereum geth account new ls –l /opt/docker/ethereum/keystore/. docker exec ethereum apt-get install –y ntpdate docker exec ethereum ntpdate –s ntp.ubuntu.com 在当前配置中，我们有一个可以挂载到我们的容器中的以太坊数据目录。这不是因为区块链数据只能在任何情况下由一个进程访问，而是访问可由Ethereum节点用于进程间通信的IPC文件描述符。因此，我们可以在这里继续，而不需要访问网络。 &nbsp; 5 zsh小工具推荐 zsh是一款小工具，对命令补全功能非常强大，可以补齐路径，补齐命令，补齐参数等。 5.1 修改root用户SHELL 先进入root用户，命令： su root 查看默认SHELL命令： echo $SHELL 然后查看是否安装了zsh，命令： cat /etc/shells 默认没有安装，那么先安装zsh,命令： apt-get install zsh 确认zsh是否安装成功，命令： zsh --version 接下来替换bash为zsh，命令： chsh -s /bin/zsh 然后reboot重启，之后查看默认SHELL,发现修改为/bin/zsh 查看是否安装git，命令： git –version 如果没有安装则安装，命令： apt-get install git 最后下载oh-my-zsh，命令： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 出现如上则安装成功，重新进入终端即可。 5.2 修改普通用户SHELL 查看默认SHELL，命令： echo $SHELL 如果是/bin/zsh则直接： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 是/bin/bash则，切换： chsh -s /bin/zsh 然后用root权限reboot，然后： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 安装成功后可以（vi ~/.zshrc）来修改配置文件以改变样式(注意root和非root都要改，可以选择不一样的样式)。 root的样式配置文件在根目录root下，为隐藏文件；非root在/home/root下。 具体样式选择https://github.com/robbyrussell/oh-my-zsh/wiki/themes &nbsp; 原文链接：http://wangxiaoming.com/blog/2018/01/01/HPB-40-ETH-docker/ &nbsp; 关于我：蓝莲花（汪晓明），微信/QQ：86606813，公众号：xm123798。HPB芯链（http://www.hpb.io)创始人。致力于推动区块链应用落地。 &nbsp; 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/02/2a3367cdd6ecc7412ed8fdb21028a3e9.html" />
<meta property="og:url" content="https://mlh.app/2018/08/02/2a3367cdd6ecc7412ed8fdb21028a3e9.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-02T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"本文是指导以太坊技术爱好者，通过基于Ubuntu环境下通过docker来进行以太坊的客户端安装和调试的指导教程。 &nbsp; 目录 1、实践环境要求 2、Ubuntu版本说明 3、Docker安装 4、Ethereum安装与实践 5、ZSH小工具推荐 &nbsp; 1 实践环境要求 1.1 概述 https://docs.docker.com/engine/installation/linux/ubuntulinux/ 上面这篇文章主要指导你去安装使用Docker-managed发布包及其安装机制。使用这些包确保你获得最近的docker官方发布版本。如果你需要安装使用Ubuntu-managed包，查阅Ubuntu文档。 1.2 docker对操作系统支持 Ubuntu Xenial 16.04[LTS] Ubuntu Trusty 14.04[LTS]　　 Ubuntu Precise 12.04[LTS] 1.3 前置需求 不管你是Ubuntu的哪个版本，Docker需要64的操作系统。此外你的kernel内核至少要在3.10版本之上。最近的3.10小版本或者最新的维护版本也是可以接受的。kernel3.10版本之前的系统缺少一些特性来运行docker容器。这些旧版本有些已知的bugs会导致数据丢失并且在一定条件下会频繁的故障。检查你当前的kernel版本，打开终端，输入uname –r 注意：如果你之前使用APT安装过docker，为了新版本的docker仓库，确保你更新了APT源。 1.4 更新apt源 Docker的APT仓库包含1.7.1以及更高的版本。通过设置APT使用来自docker仓库的包。 1) 登陆机器，用户必须使用sudo或者root权限。 2) 打开终端 3) 更新包信息，确保APT能使用https方式工作，并且CA证书已安装了 #sudo apt-get update ​ #sudo apt-get install apt-transport-https ca-certificates &nbsp; 出现这个问题可能是有另一个程序正在运行，导致资源被锁不可用。而导致资源被锁的原因可能是上次运行安装或更新没有正常完成，解决办法就是删掉。 #sudo rm /var/cache/apt/archives/lock ​ #sudo rm /var/lib/dpkg/lock 4)添加一个新的GPG密钥 #sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D 5)找到合适你的Ubuntu操作系统的键，这个键决定APT将搜索哪个包。可能的键有： Ubuntu version: Precise 12.04, Trusty 14.04,Cenial 16.04 注意：docker没有为所有的架构提供包，Binary artifacts are built nightly,你可以从以下链接下载。 https://master.dockerproject.org. 在一个多架构的系统上安装docker，为键添加一个[arch=]条款。更多细节参考Debian Multiarch维基百科。 6)运行下面的命令，用占位符&lt;REPO&gt;为你的操作系统替换键。 #echo &quot;&lt;REPO&gt;&quot; | sudo tee /etc/apt/sources.list.d/docker.list 比如你是16.04将上面命令的&lt;REPO&gt; 替换成deb https://apt.dockerproject.org/repoubuntu-xenial main 执行那条命令，就在那个文件夹下创建了一个docker.list文件，里面的内容就是 deb https://apt.dockerproject.org/repoubuntu-xenial main 7)更新APT包索引 #sudo apt-get update 8)校验APT是从一个正确的仓库拉取安装包。 当运行下面命令的时候，这个键会返回你目前可以安装的docker版本，每个键都包括URL：https://apt.dockerproject.org/repo/。下面是截取的部分输出内容。 #apt-cache policy docker-engine 现在当你运行apt-get upgrade的时候，APT就会从新的仓库拉安装包。 &nbsp; 2 Ubuntu版本说明 2.1 前置准备操作 Ubuntu Xenial 16.04[LTS]，Ubuntu Trusty 14.04[LTS]这两个版本记得安装linux-iamge-extra-*的kernel包。这个包允许你使用aufs存储驱动。 # sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual Ubuntu Precise 12.04[LTS]对于这个版本，你需要3.13以上的kernel版本，你必须升级。下面表格指导你需要哪些包： 你可以执行以下命令： #sudo apt-get install linux-image-generic-lts-trusty ​ #sudo reboot &nbsp; 3 Docker安装 3.1 前置操作 1).登陆系统，用你的账号使用sudo全权限 2).运行命令apt-get install openssh-server安装ssh 查看是否安装成功ps -ef|grep ssh 3).更新APT包索引：sudo apt-get update 4).安装docker：sudo apt-get install docker-engine 5).开启docker后台进程：sudo service docker start 6).校验docker是否安装成功：sudo docker run hello-world 这个命令会下载一个测试镜像，并且运行在一个容器中。当容器运行时，他会打印一些信息，并且退出。 3.2 创建一个docker组 docker后台进程是绑定的Unix的socket而不是TCP端口。默认情况下，Unix的socket属于用户root，其它用户要使用要通过sudo命令。由于这个原因，docker daemon通常使用root用户运行。为了避免使用sudo当你使用docker命令的时候，创建一个Unix组名为docker并且添加用户。当docker daemon启动，它会分配Unix socket读写权限给所属的docker组。 注意：docker组不等价于用户root，如果想要知道的更多关于安全影响，查看docker daemon attack surface。 #sudo groupadd docker ​ #sudo usermod -aG docker $USER 退出再重进，确保该用户有正确的权限。校验生效，通过运行docker命令不带sudo：docker run hello-world，如果失败会有以下类似的信息：Cannot connect to the Docker daemon. Is &#39;docker daemon&#39; running on this host?确保DOCKER_HOST环境变量没有设置。如果有取消它。 3.3 调整内存和交换区计算 当用户运行docker时，他们可能在使用一个镜像时看见下面的信息： WARNING: Your kernel does not support cgroup swap limit. WARNING: Your kernel does not support swap limit capabilities. Limitation discarded. 为了阻止这些信息，在你的系统中启用内存和交换区计算。这个操作会导致即便docker没有使用也有内存开销以及性能下降。内存开销大概是总内存的1%。性能降低了大约10%。 修改/etc/default/grub文件。vi或者vim命令都行，设置GRUB_CMDLINE_LINUX的值，如下： GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;。 保存文件并关闭。 #sudo update-grub 更新启动项，reboot重启你的系统。 3.4 启动UFW转发 当你运行docker时，在同一台主机上使用UFW(Uncomplicated Firewall) ，你需要额外的配置。docker使用桥接方式来管理容器的网络。默认情况下，UFW废弃所有的转发流量。因此，docker运行时UFW可以使用，你必须设置合适UFW的转发规则。 UFW默认配置规则拒绝了所有传入流量。如果你想要从另一个主机到达你的容器需要允许连接docker的端口。docker的默认端口是2376如果TLS启用，如果没有启动则是2375,会话是不加密的。默认情况，docker运行在没有TLS启动的情况下。 为了配置UFW并且允许进入的连接docker端口： 检查UFW是否安装并启用： #sudo ufw status 打开/etc/default/ufw文件并编辑： #sudo nano /etc/default/ufw 设置DEFAULT_FORWARD_POLICY：DEFAULT_FORWARD_POLICY=&quot;ACCEPT&quot; 保存退出并重启使用新的设置： #sudo ufw reload 允许所有的连接到docker端口： #sudo ufw allow 2375/tcp 3.5 为docker配置DNS服务器 系统运行桌面的Ubuntu或者Ubuntu衍生产品通常使用127.0.0.1作为默认的nameserver文件/etc/resolv.conf文件中。NetworkManager也通常设置dnsmasq nameserver 127.0.0.1在/etc/resolv.conf。 当在桌面机器运行容器，使用这些配置时，docker的使用者会看见这些警告： WARNING: Local (127.0.0.1) DNS resolver found in resolv.conf and containers can&#39;t use it. Using default external servers : [8.8.8.8 8.8.4.4] 这个警告发生是因为docker容器不能使用本地DNS命名服务器。此外docker默认使用一个额外的nameserver。 为了避免这个警告，你可以在使用docker容器的时候指定一个DNS服务器。或者你可以禁用dnsmasq在NetworkManager中。但是，禁用会导致DNS协议在某些网络中变慢。 下面的说明描述了如何在Ubuntu14.0或以下版本配置docker守护进程。Ubuntu15.04及之上的使用systemd用于启动项和服务管理。指导通过使用systemd来配置和控制一个守护进程。 设置指定的DNS服务： 打开/etc/default/docker文件并编辑：sudo nano /etc/default/docker，添加配置项：DOCKER_OPTS=&quot;--dns 8.8.8.8&quot;。将8.8.8.8用一个本地的DNS服务例如192.168.1.1替换。你也可以配置多个DNS服务器。 用空格隔开它们，如：--dns 8.8.8.8 --dns 192.168.1.1。 警告：当你在笔记本连接了不同网络的情况时做这些操作，确保选择一个公用的DNS服务器。保存文件并退出，重启docker守护进程：sudo service docker restart。或者另一个选择，禁用dnsmasq在网络管理器中，这可能导致你的网速变慢： 打开/etc/NetworkManager/NetworkManager.conf文件， 编辑它：sudo nano /etc/NetworkManager/NetworkManager.conf。 找到行dns=dnsmasq，注释掉。 保存关闭文件，重启网络管理器和docker. #sudo restart network-manager &nbsp; ​ #sudo restart docker 3.6 配置docker引导启动 Ubuntu15.04之后使用systemd作为引导启动和服务管理，14.10及以下版本是upstart。15.04以上，需要配置docker守护进程boot启动， 运行命令： #sudo systemctl enable docker 14.10及以下版本安装方法会自动配置upstart来启动docke daemon在boot。 3.7 升级卸载docker 升级： #sudo apt-get upgrade docker-engine 卸载： #sudo apt-get purge docker-engine 卸载及依赖： #sudo apt-get autoremove --purge docker-engine 上述命令不会卸载images，containers，volumes或者用户自己创建的配置文件。 你如果想删除这些东西，执行下面的命令： #rm -rf /var/lib/docker 安装最简单的方法是： #sudo apt-get update　　 ​ #sudo apt-get install 3.8 执行docker-compose安装 docker-compose 是用于定义和运行复杂docker应用的工具，以yaml定义语言在一个docker-compose.yaml文件中定义一个包括多容器的应用，用一条命令即可启动应用中包括的所有docker container，容器启动所有依赖的动作都会被工具自动完成。 #curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose ​ #chmod +x /usr/local/bin/docker- &nbsp; 4 Ethereum安装与实践 4.1 通过docker安装Ethereum 运行如下命令 #docker pull docker.io/ethereum/client-go 4.2 直接安装Ethereum 运行如下命令 #apt-get update ​ #apt-get install software-properties-common add-apt-repository -y ppa:ethereum/ethereum 安装一个稳定版本的以太坊 #apt-get update ​ #apt-get install ethereum ​ #apt-get update 生成引导节点ID #bootnode --genkey=boot.key 运行引导节点 #bootnode --nodekey=boot.key 4.3 新建genesis.json文件 运行以下命令 vi genesis.json 输入 &nbsp; 4.4 初始化创始区块 运行如下命令 #docker run -itd --privileged=true -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --datadir /root/ethdev --networkid 8765639736937780 init /root/ethdev/genesis.json 4.5 创建Ethereum节点的容器 运行如下命令 #docker rm -f gethDev1 ​ #docker run -itd -m 512M --privileged=true --memory-swap -1 --net=host -p 8545:8545 -p 40303:40303 -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --ipcdisable --port 40303 --bootnodes &quot;enode://2039a49989e45bf119ecd21403607ea9f5888b13a6bb7a03ed81687deabb251095e4193a77eca067076f77ed40e4c6fd51539038c440337beffbbb36953d1d75@192.168.3.43:30301&quot; --debug --nodiscover --rpcapi &quot;db,eth,net,web3,personal,admin,miner,txpool&quot; --datadir /root/ethdev --networkid 8765639736937780 --wsapi &quot;db,eth,net,web3,personal,admin,miner,txpool&quot; --ws --wsaddr &quot;0.0.0.0&quot; --rpc --rpcaddr &quot;0.0.0.0&quot; --cache=512 --verbosity 6 --mine --minerthreads=1 --etherbase=0x5f38056f45091ee992298e53681b0a60c999ff95 console &nbsp; 4.6 查看Ethereum节点docker日志 运行如下命令 #docker logs -f gethDev1 4.7启动Ethereum节点 运行如下命令 #docker startgethDev1 4.8 Attach Ethereum节点 运行如下命令 #docker attach gethDev1 4.9 Detach Ethereum节点 先后按下键盘ctrl+p+q退出节点，注意：有先后顺序 4.10 停止Ethereum节点 运行命令如下 #docker stopgethDev1 4.11 Ethereum日志释疑 首先，告警提示geth抱怨没有定义etherbase，etherbase是成功挖掘区块，执行智能合约并在区块链内返回结果之后用来接收以太奖励的“默认以太坊地址”。这个帐户，在开发合同时也很方便。 接下来，我们看到blockchain数据被写入/root/.ethereum/chaindata，因为我们已经从我们的主机挂载了这个目录，我们应该可以在本地磁盘上看到出现的数据： docker exec –i ethereum geth account new ls –l /opt/docker/ethereum/keystore/. docker exec ethereum apt-get install –y ntpdate docker exec ethereum ntpdate –s ntp.ubuntu.com 在当前配置中，我们有一个可以挂载到我们的容器中的以太坊数据目录。这不是因为区块链数据只能在任何情况下由一个进程访问，而是访问可由Ethereum节点用于进程间通信的IPC文件描述符。因此，我们可以在这里继续，而不需要访问网络。 &nbsp; 5 zsh小工具推荐 zsh是一款小工具，对命令补全功能非常强大，可以补齐路径，补齐命令，补齐参数等。 5.1 修改root用户SHELL 先进入root用户，命令： su root 查看默认SHELL命令： echo $SHELL 然后查看是否安装了zsh，命令： cat /etc/shells 默认没有安装，那么先安装zsh,命令： apt-get install zsh 确认zsh是否安装成功，命令： zsh --version 接下来替换bash为zsh，命令： chsh -s /bin/zsh 然后reboot重启，之后查看默认SHELL,发现修改为/bin/zsh 查看是否安装git，命令： git –version 如果没有安装则安装，命令： apt-get install git 最后下载oh-my-zsh，命令： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 出现如上则安装成功，重新进入终端即可。 5.2 修改普通用户SHELL 查看默认SHELL，命令： echo $SHELL 如果是/bin/zsh则直接： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 是/bin/bash则，切换： chsh -s /bin/zsh 然后用root权限reboot，然后： sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot; 安装成功后可以（vi ~/.zshrc）来修改配置文件以改变样式(注意root和非root都要改，可以选择不一样的样式)。 root的样式配置文件在根目录root下，为隐藏文件；非root在/home/root下。 具体样式选择https://github.com/robbyrussell/oh-my-zsh/wiki/themes &nbsp; 原文链接：http://wangxiaoming.com/blog/2018/01/01/HPB-40-ETH-docker/ &nbsp; 关于我：蓝莲花（汪晓明），微信/QQ：86606813，公众号：xm123798。HPB芯链（http://www.hpb.io)创始人。致力于推动区块链应用落地。 &nbsp; 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/02/2a3367cdd6ecc7412ed8fdb21028a3e9.html","headline":"基于Ubuntu Docker环境下进行以太坊实践","dateModified":"2018-08-02T00:00:00+08:00","datePublished":"2018-08-02T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/02/2a3367cdd6ecc7412ed8fdb21028a3e9.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>基于Ubuntu Docker环境下进行以太坊实践</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>本文是指导以太坊技术爱好者，通过基于Ubuntu环境下通过docker来进行以太坊的客户端安装和调试的指导教程。</p> 
  <p>&nbsp;</p> 
  <p><strong>目录</strong></p> 
  <p>1、实践环境要求</p> 
  <p>2、Ubuntu版本说明</p> 
  <p>3、Docker安装</p> 
  <p>4、Ethereum安装与实践</p> 
  <p>5、ZSH小工具推荐</p> 
  <p>&nbsp;</p> 
  <p><strong>1 实践环境要求</strong></p> 
  <p><strong>1.1 概述</strong></p> 
  <p><a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/" rel="nofollow">https://docs.docker.com/engine/installation/linux/ubuntulinux/</a></p> 
  <p>上面这篇文章主要指导你去安装使用Docker-managed发布包及其安装机制。使用这些包确保你获得最近的docker官方发布版本。如果你需要安装使用Ubuntu-managed包，查阅Ubuntu文档。</p> 
  <p><strong>1.2 docker对操作系统支持</strong></p> 
  <p>Ubuntu Xenial 16.04[LTS]</p> 
  <p>Ubuntu Trusty 14.04[LTS]　　</p> 
  <p>Ubuntu Precise 12.04[LTS]</p> 
  <p><strong>1.3 前置需求</strong></p> 
  <p>不管你是Ubuntu的哪个版本，Docker需要64的操作系统。此外你的kernel内核至少要在3.10版本之上。最近的3.10小版本或者最新的维护版本也是可以接受的。kernel3.10版本之前的系统缺少一些特性来运行docker容器。这些旧版本有些已知的bugs会导致数据丢失并且在一定条件下会频繁的故障。检查你当前的kernel版本，打开终端，输入uname –r</p> 
  <p>注意：如果你之前使用APT安装过docker，为了新版本的docker仓库，确保你更新了APT源。</p> 
  <p><strong>1.4 更新apt源</strong></p> 
  <p>Docker的APT仓库包含1.7.1以及更高的版本。通过设置APT使用来自docker仓库的包。</p> 
  <p>1) 登陆机器，用户必须使用sudo或者root权限。</p> 
  <p>2) 打开终端</p> 
  <p>3) 更新包信息，确保APT能使用https方式工作，并且CA证书已安装了</p> 
  <blockquote> 
   <pre>
<code class="language-html hljs">#sudo apt-get update
​
#sudo apt-get install apt-transport-https ca-certificates</code></pre> 
  </blockquote> 
  <p>&nbsp;<img alt="" class="has" src="http://assets.wangxiaoming.com/image/do1.png"></p> 
  <p>出现这个问题可能是有另一个程序正在运行，导致资源被锁不可用。而导致资源被锁的原因可能是上次运行安装或更新没有正常完成，解决办法就是删掉。</p> 
  <blockquote> 
   <pre>
<code class="language-html hljs">#sudo rm /var/cache/apt/archives/lock
​
#sudo rm /var/lib/dpkg/lock</code>
</pre> 
  </blockquote> 
  <p>4)添加一个新的GPG密钥</p> 
  <pre>
<code class="language-html hljs">#sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D </code>
</pre> 
  <p>5)找到合适你的Ubuntu操作系统的键，这个键决定APT将搜索哪个包。可能的键有：</p> 
  <p>Ubuntu version: Precise 12.04, Trusty 14.04,Cenial 16.04</p> 
  <p>注意：docker没有为所有的架构提供包，Binary artifacts are built nightly,你可以从以下链接下载。</p> 
  <p><a href="https://master.dockerproject.org" rel="nofollow">https://master.dockerproject.org</a>. 在一个多架构的系统上安装docker，为键添加一个[arch=]条款。更多细节参考Debian Multiarch维基百科。</p> 
  <p>6)运行下面的命令，用占位符&lt;REPO&gt;为你的操作系统替换键。</p> 
  <p>#echo "&lt;REPO&gt;" | sudo tee /etc/apt/sources.list.d/docker.list</p> 
  <p>比如你是16.04将上面命令的&lt;REPO&gt;</p> 
  <p>替换成deb <a href="https://apt.dockerproject.org/repoubuntu-xenial" rel="nofollow">https://apt.dockerproject.org/repoubuntu-xenial</a> main 执行那条命令，就在那个文件夹下创建了一个docker.list文件，里面的内容就是</p> 
  <p>deb <a href="https://apt.dockerproject.org/repoubuntu-xenial" rel="nofollow">https://apt.dockerproject.org/repoubuntu-xenial</a> main</p> 
  <p>7)更新APT包索引</p> 
  <pre>
<code class="language-html hljs">#sudo apt-get update</code>
</pre> 
  <p>8)校验APT是从一个正确的仓库拉取安装包。</p> 
  <p>当运行下面命令的时候，这个键会返回你目前可以安装的docker版本，每个键都包括URL：<a href="https://apt.dockerproject.org/repo/" rel="nofollow">https://apt.dockerproject.org/repo/</a>。下面是截取的部分输出内容。</p> 
  <pre>
<code class="language-html hljs">#apt-cache policy docker-engine</code></pre> 
  <p><img alt="" class="has" src="http://assets.wangxiaoming.com/image/do2.png"></p> 
  <p>现在当你运行apt-get upgrade的时候，APT就会从新的仓库拉安装包。</p> 
  <p>&nbsp;</p> 
  <p><strong>2 Ubuntu版本说明</strong></p> 
  <p><strong>2.1 前置准备操作</strong></p> 
  <p>Ubuntu Xenial 16.04[LTS]，Ubuntu Trusty 14.04[LTS]这两个版本记得安装linux-iamge-extra-*的kernel包。这个包允许你使用aufs存储驱动。</p> 
  <p># sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual</p> 
  <p>Ubuntu Precise 12.04[LTS]对于这个版本，你需要3.13以上的kernel版本，你必须升级。下面表格指导你需要哪些包：</p> 
  <p><img alt="" class="has" src="http://assets.wangxiaoming.com/image/do3.png"></p> 
  <p>你可以执行以下命令：</p> 
  <pre>
<code class="language-html hljs">#sudo apt-get install linux-image-generic-lts-trusty
​
#sudo reboot</code></pre> 
  <p>&nbsp;</p> 
  <p><strong>3 Docker安装</strong></p> 
  <p><strong>3.1 前置操作</strong></p> 
  <p>1).登陆系统，用你的账号使用sudo全权限</p> 
  <p>2).运行命令apt-get install openssh-server安装ssh 查看是否安装成功ps -ef|grep ssh</p> 
  <p>3).更新APT包索引：sudo apt-get update</p> 
  <p>4).安装docker：sudo apt-get install docker-engine</p> 
  <p>5).开启docker后台进程：sudo service docker start</p> 
  <p>6).校验docker是否安装成功：sudo docker run hello-world</p> 
  <p>这个命令会下载一个测试镜像，并且运行在一个容器中。当容器运行时，他会打印一些信息，并且退出。</p> 
  <p><strong>3.2 创建一个docker组</strong></p> 
  <p>docker后台进程是绑定的Unix的socket而不是TCP端口。默认情况下，Unix的socket属于用户root，其它用户要使用要通过sudo命令。由于这个原因，docker daemon通常使用root用户运行。为了避免使用sudo当你使用docker命令的时候，创建一个Unix组名为docker并且添加用户。当docker daemon启动，它会分配Unix socket读写权限给所属的docker组。</p> 
  <p>注意：docker组不等价于用户root，如果想要知道的更多关于安全影响，查看docker daemon attack surface。</p> 
  <pre>
<code class="language-html hljs">#sudo groupadd docker
​
#sudo usermod -aG docker $USER</code></pre> 
  <p>退出再重进，确保该用户有正确的权限。校验生效，通过运行docker命令不带sudo：docker run hello-world，如果失败会有以下类似的信息：Cannot connect to the Docker daemon. Is 'docker daemon' running on this host?确保DOCKER_HOST环境变量没有设置。如果有取消它。</p> 
  <p><strong>3.3 调整内存和交换区计算</strong></p> 
  <p>当用户运行docker时，他们可能在使用一个镜像时看见下面的信息：</p> 
  <p>WARNING: Your kernel does not support cgroup swap limit. WARNING: Your kernel does not support swap limit capabilities. Limitation discarded.</p> 
  <p>为了阻止这些信息，在你的系统中启用内存和交换区计算。这个操作会导致即便docker没有使用也有内存开销以及性能下降。内存开销大概是总内存的1%。性能降低了大约10%。</p> 
  <p>修改/etc/default/grub文件。vi或者vim命令都行，设置GRUB_CMDLINE_LINUX的值，如下：</p> 
  <p>GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1"。</p> 
  <p>保存文件并关闭。</p> 
  <pre>
<code class="language-html hljs">#sudo update-grub</code></pre> 
  <p>更新启动项，reboot重启你的系统。</p> 
  <p><strong>3.4 启动UFW转发</strong></p> 
  <p>当你运行docker时，在同一台主机上使用UFW(Uncomplicated Firewall) ，你需要额外的配置。docker使用桥接方式来管理容器的网络。默认情况下，UFW废弃所有的转发流量。因此，docker运行时UFW可以使用，你必须设置合适UFW的转发规则。</p> 
  <p>UFW默认配置规则拒绝了所有传入流量。如果你想要从另一个主机到达你的容器需要允许连接docker的端口。docker的默认端口是2376如果TLS启用，如果没有启动则是2375,会话是不加密的。默认情况，docker运行在没有TLS启动的情况下。</p> 
  <ul>
   <li> <p>为了配置UFW并且允许进入的连接docker端口：</p> </li> 
   <li> <p>检查UFW是否安装并启用：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo ufw status</code></pre> 
  <ul>
   <li> <p>打开/etc/default/ufw文件并编辑：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo nano /etc/default/ufw</code>
</pre> 
  <ul>
   <li> <p>设置DEFAULT_FORWARD_POLICY：DEFAULT_FORWARD_POLICY="ACCEPT"</p> </li> 
   <li> <p>保存退出并重启使用新的设置：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo ufw reload</code>
</pre> 
  <ul>
   <li> <p>允许所有的连接到docker端口：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo ufw allow 2375/tcp</code>
</pre> 
  <p><strong>3.5 为docker配置DNS服务器</strong></p> 
  <p>系统运行桌面的Ubuntu或者Ubuntu衍生产品通常使用127.0.0.1作为默认的nameserver文件/etc/resolv.conf文件中。NetworkManager也通常设置dnsmasq nameserver 127.0.0.1在/etc/resolv.conf。</p> 
  <p>当在桌面机器运行容器，使用这些配置时，docker的使用者会看见这些警告：</p> 
  <p>WARNING: Local (127.0.0.1) DNS resolver found in resolv.conf and containers can't use it. Using default external servers : [8.8.8.8 8.8.4.4]</p> 
  <p>这个警告发生是因为docker容器不能使用本地DNS命名服务器。此外docker默认使用一个额外的nameserver。</p> 
  <p>为了避免这个警告，你可以在使用docker容器的时候指定一个DNS服务器。或者你可以禁用dnsmasq在NetworkManager中。但是，禁用会导致DNS协议在某些网络中变慢。</p> 
  <p>下面的说明描述了如何在Ubuntu14.0或以下版本配置docker守护进程。Ubuntu15.04及之上的使用systemd用于启动项和服务管理。指导通过使用systemd来配置和控制一个守护进程。</p> 
  <ul>
   <li> <p>设置指定的DNS服务：</p> </li> 
  </ul>
  <p>打开/etc/default/docker文件并编辑：sudo nano /etc/default/docker，添加配置项：DOCKER_OPTS="--dns 8.8.8.8"。将8.8.8.8用一个本地的DNS服务例如192.168.1.1替换。你也可以配置多个DNS服务器。</p> 
  <p>用空格隔开它们，如：--dns 8.8.8.8 --dns 192.168.1.1。</p> 
  <p>警告：当你在笔记本连接了不同网络的情况时做这些操作，确保选择一个公用的DNS服务器。保存文件并退出，重启docker守护进程：sudo service docker restart。或者另一个选择，禁用dnsmasq在网络管理器中，这可能导致你的网速变慢：</p> 
  <ul>
   <li> <p>打开/etc/NetworkManager/NetworkManager.conf文件，</p> </li> 
   <li> <p>编辑它：sudo nano /etc/NetworkManager/NetworkManager.conf。</p> </li> 
   <li> <p>找到行dns=dnsmasq，注释掉。</p> </li> 
   <li> <p>保存关闭文件，重启网络管理器和docker.</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo restart network-manager &nbsp;
​
#sudo restart docker</code>
</pre> 
  <p><strong>3.6 配置docker引导启动</strong></p> 
  <p>Ubuntu15.04之后使用systemd作为引导启动和服务管理，14.10及以下版本是upstart。15.04以上，需要配置docker守护进程boot启动，</p> 
  <ul>
   <li> <p>运行命令：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo systemctl enable docker</code></pre> 
  <p>14.10及以下版本安装方法会自动配置upstart来启动docke daemon在boot。</p> 
  <p><strong>3.7 升级卸载docker</strong></p> 
  <ul>
   <li> <p>升级：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo apt-get upgrade docker-engine</code>
</pre> 
  <ul>
   <li> <p>卸载：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo apt-get purge docker-engine</code>
</pre> 
  <ul>
   <li> <p>卸载及依赖：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo apt-get autoremove --purge docker-engine</code>
</pre> 
  <ul>
   <li> <p>上述命令不会卸载images，containers，volumes或者用户自己创建的配置文件。</p> </li> 
  </ul>
  <p>你如果想删除这些东西，执行下面的命令：</p> 
  <pre>
<code class="language-html hljs">#rm -rf /var/lib/docker</code></pre> 
  <ul>
   <li> <p>安装最简单的方法是：</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#sudo apt-get update　　
​
#sudo apt-get install </code>
</pre> 
  <p><strong>3.8 执行docker-compose安装</strong></p> 
  <p>docker-compose 是用于定义和运行复杂docker应用的工具，以yaml定义语言在一个docker-compose.yaml文件中定义一个包括多容器的应用，用一条命令即可启动应用中包括的所有docker container，容器启动所有依赖的动作都会被工具自动完成。</p> 
  <pre>
<code class="language-html hljs">#curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose
​
#chmod +x /usr/local/bin/docker-</code></pre> 
  <p>&nbsp;</p> 
  <p><strong>4 Ethereum安装与实践</strong></p> 
  <p><strong>4.1 通过docker安装Ethereum</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker pull docker.io/ethereum/client-go</code>
</pre> 
  <p><strong>4.2 直接安装Ethereum</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#apt-get update
​
#apt-get install software-properties-common add-apt-repository -y ppa:ethereum/ethereum</code>
</pre> 
  <ul>
   <li> <p>安装一个稳定版本的以太坊</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#apt-get update
​
#apt-get install ethereum
​
#apt-get update</code>
</pre> 
  <ul>
   <li> <p>生成引导节点ID</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#bootnode --genkey=boot.key</code>
</pre> 
  <ul>
   <li> <p>运行引导节点</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#bootnode --nodekey=boot.key</code></pre> 
  <p><strong>4.3 新建genesis.json文件</strong></p> 
  <ul>
   <li> <p>运行以下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">vi genesis.json</code>
</pre> 
  <ul>
   <li> <p>输入</p> </li> 
  </ul>
  <p><img alt="" class="has" src="http://assets.wangxiaoming.com/image/do4.png"></p> 
  <p>&nbsp;</p> 
  <p><strong>4.4 初始化创始区块</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker run -itd --privileged=true -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --datadir /root/ethdev --networkid 8765639736937780 init /root/ethdev/genesis.json</code>
</pre> 
  <p><strong>4.5 创建Ethereum节点的容器</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker rm -f gethDev1
​
#docker run -itd -m 512M --privileged=true --memory-swap -1 --net=host -p 8545:8545 -p 40303:40303 -v /path/docker/dev1:/root/ethdev --name gethDev1 ethereum/client-go --ipcdisable --port 40303 --bootnodes "enode://2039a49989e45bf119ecd21403607ea9f5888b13a6bb7a03ed81687deabb251095e4193a77eca067076f77ed40e4c6fd51539038c440337beffbbb36953d1d75@192.168.3.43:30301" --debug --nodiscover --rpcapi "db,eth,net,web3,personal,admin,miner,txpool" --datadir /root/ethdev --networkid 8765639736937780 --wsapi "db,eth,net,web3,personal,admin,miner,txpool" --ws --wsaddr "0.0.0.0" --rpc --rpcaddr "0.0.0.0" --cache=512 --verbosity 6 --mine --minerthreads=1 --etherbase=0x5f38056f45091ee992298e53681b0a60c999ff95 console</code>
</pre> 
  <p><img alt="" class="has" src="http://assets.wangxiaoming.com/image/do5.png"></p> 
  <p>&nbsp;</p> 
  <p><strong>4.6 查看Ethereum节点docker日志</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker logs -f gethDev1</code>
</pre> 
  <p><strong>4.7启动Ethereum节点</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker startgethDev1</code>
</pre> 
  <p><strong>4.8 Attach Ethereum节点</strong></p> 
  <ul>
   <li> <p>运行如下命令</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker attach gethDev1</code>
</pre> 
  <p><strong>4.9 Detach Ethereum节点</strong></p> 
  <p>先后按下键盘ctrl+p+q退出节点，注意：有先后顺序</p> 
  <p><strong>4.10 停止Ethereum节点</strong></p> 
  <ul>
   <li> <p>运行命令如下</p> </li> 
  </ul>
  <pre>
<code class="language-html hljs">#docker stopgethDev1</code>
</pre> 
  <p><strong>4.11 Ethereum日志释疑</strong></p> 
  <ul>
   <li> <p>首先，告警提示geth抱怨没有定义etherbase，etherbase是成功挖掘区块，执行智能合约并在区块链内返回结果之后用来接收以太奖励的“默认以太坊地址”。这个帐户，在开发合同时也很方便。</p> </li> 
   <li> <p>接下来，我们看到blockchain数据被写入/root/.ethereum/chaindata，因为我们已经从我们的主机挂载了这个目录，我们应该可以在本地磁盘上看到出现的数据：</p> </li> 
   <li> <pre>
<code class="language-html hljs">docker exec –i ethereum geth account new
ls –l /opt/docker/ethereum/keystore/.
docker exec ethereum apt-get install –y ntpdate
docker exec ethereum ntpdate –s ntp.ubuntu.com</code></pre> </li> 
  </ul>
  <p>在当前配置中，我们有一个可以挂载到我们的容器中的以太坊数据目录。这不是因为区块链数据只能在任何情况下由一个进程访问，而是访问可由Ethereum节点用于进程间通信的IPC文件描述符。因此，我们可以在这里继续，而不需要访问网络。</p> 
  <p>&nbsp;</p> 
  <p><strong>5 zsh小工具推荐</strong></p> 
  <p>zsh是一款小工具，对命令补全功能非常强大，可以补齐路径，补齐命令，补齐参数等。</p> 
  <p><strong>5.1 修改root用户SHELL</strong></p> 
  <p>先进入root用户，命令：</p> 
  <pre>
<code class="language-html hljs">su root</code>
</pre> 
  <p>查看默认SHELL命令：</p> 
  <pre>
<code class="language-html hljs">echo $SHELL</code>
</pre> 
  <p>然后查看是否安装了zsh，命令：</p> 
  <pre>
<code class="language-html hljs">cat /etc/shells</code>
</pre> 
  <p>默认没有安装，那么先安装zsh,命令：</p> 
  <pre>
<code class="language-html hljs">apt-get install zsh</code>
</pre> 
  <p>确认zsh是否安装成功，命令：</p> 
  <pre>
<code class="language-html hljs">zsh --version</code>
</pre> 
  <p>接下来替换bash为zsh，命令：</p> 
  <pre>
<code class="language-html hljs">chsh -s /bin/zsh</code>
</pre> 
  <p>然后reboot重启，之后查看默认SHELL,发现修改为/bin/zsh</p> 
  <p>查看是否安装git，命令：</p> 
  <pre>
<code class="language-html hljs">git –version</code>
</pre> 
  <p>如果没有安装则安装，命令：</p> 
  <pre>
<code class="language-html hljs">apt-get install git</code>
</pre> 
  <p>最后下载oh-my-zsh，命令：</p> 
  <pre>
<code class="language-html hljs">sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</code>
</pre> 
  <p><img alt="" class="has" src="http://assets.wangxiaoming.com/image/do6.png"></p> 
  <p>出现如上则安装成功，重新进入终端即可。</p> 
  <p><strong>5.2 修改普通用户SHELL</strong></p> 
  <p>查看默认SHELL，命令：</p> 
  <pre>
<code class="language-html hljs">echo $SHELL</code>
</pre> 
  <p>如果是/bin/zsh则直接：</p> 
  <pre>
<code class="language-html hljs">sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</code>
</pre> 
  <p>是/bin/bash则，切换：</p> 
  <pre>
<code class="language-html hljs">chsh -s /bin/zsh</code>
</pre> 
  <p>然后用root权限reboot，然后：</p> 
  <pre>
<code class="language-html hljs">sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</code>
</pre> 
  <p>安装成功后可以（vi ~/.zshrc）来修改配置文件以改变样式(注意root和非root都要改，可以选择不一样的样式)。</p> 
  <p>root的样式配置文件在根目录root下，为隐藏文件；非root在/home/root下。</p> 
  <p>具体样式选择<a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes" rel="nofollow">https://github.com/robbyrussell/oh-my-zsh/wiki/themes</a></p> 
  <p>&nbsp;</p> 
  <p><strong>原文链接：</strong><a href="http://wangxiaoming.com/blog/2018/01/01/HPB-40-ETH-docker/" rel="nofollow">http://wangxiaoming.com/blog/2018/01/01/HPB-40-ETH-docker/</a></p> 
  <p>&nbsp;</p> 
  <p><strong>关于我：</strong>蓝莲花（汪晓明），微信/QQ：86606813，公众号：xm123798。HPB芯链（<a href="http://www.hpb.io/" rel="nofollow">http://www.hpb.io</a>)创始人。致力于推动区块链应用落地。</p> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qukuai/article/details/81361272,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qukuai/article/details/81361272,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

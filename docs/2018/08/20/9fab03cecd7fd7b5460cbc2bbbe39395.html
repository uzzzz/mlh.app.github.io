<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>手动拆解一个block | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="手动拆解一个block" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一直以来，对比特币区块链数据存储的方式非常好奇。也许你跟我一样，看到过一些说明，但还是心存疑惑。本篇文章就深入又直观地解释一下，打消掉疑惑——我们来手动拆解一个区块。所以本篇文章是一片硬文，非常硬！ 阅读本文的需要一些基础知识：比特、字节、十六进制。这些知识，在高中的计算机基础课程里都有介绍，有一些印象就足够了。 对于专业的人，你可以弄懂本文的细节，进而深刻了解区块链的数据存储方式。而对于非专业的人，你可以直观地读，读一个轮阔，有道是 “好读书，不求甚解，每有会意，便欣然忘食”。只不过看完本文的这个轮阔，你会看见真真实实的存在，不用靠别的一些比喻来“维持”理解。甚至你都可以感受到对于数据存储与处理计算机是如何工作的。 1. 区块的数据格式 我们取一个早期的区块，早期的区块包含的交易少一些，方便分析。网址为： https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee 该网页里的格式formats: - json 是用原始数据解析出来的，一种方便人阅读的格式； - hex 是数据的16进制格式，形如3f323d…； - binary是二进制原始数据，如01010001… 肉眼可读的json格式内容如下（https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.json） { &quot;hash&quot;: &quot;00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee&quot;, &quot;ver&quot;: 1, &quot;prev_block&quot;: &quot;000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55&quot;, &quot;mrkl_root&quot;: &quot;7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff&quot;, &quot;time&quot;: 1231731025, &quot;bits&quot;: 486604799, &quot;nonce&quot;: 1889418792, &quot;n_tx&quot;: 2, &quot;size&quot;: 490, &quot;tx&quot;: [ { &quot;hash&quot;: &quot;b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082&quot;, &quot;ver&quot;: 1, &quot;vin_sz&quot;: 1, &quot;vout_sz&quot;: 1, &quot;lock_time&quot;: 0, &quot;size&quot;: 134, &quot;in&quot;: [ { &quot;prev_out&quot;: { &quot;hash&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;n&quot;: 4294967295 }, &quot;coinbase&quot;: &quot;04ffff001d0102&quot; } ], &quot;out&quot;: [ { &quot;value&quot;: &quot;50.00000000&quot;, &quot;scriptPubKey&quot;: &quot;04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG&quot; } ], &quot;nid&quot;: &quot;c56705435de47674259d6c92125907645d4fb512fa8e7f31457f5f29ba983d80&quot; }, { &quot;hash&quot;: &quot;f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16&quot;, &quot;ver&quot;: 1, &quot;vin_sz&quot;: 1, &quot;vout_sz&quot;: 2, &quot;lock_time&quot;: 0, &quot;size&quot;: 275, &quot;in&quot;: [ { &quot;prev_out&quot;: { &quot;hash&quot;: &quot;0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9&quot;, &quot;n&quot;: 0 }, &quot;scriptSig&quot;: &quot;304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901&quot; } ], &quot;out&quot;: [ { &quot;value&quot;: &quot;10.00000000&quot;, &quot;scriptPubKey&quot;: &quot;04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG&quot;, &quot;next_in&quot;: { &quot;hash&quot;: &quot;ea44e97271691990157559d0bdd9959e02790c34db6c006d779e82fa5aee708e&quot;, &quot;n&quot;: 0 } }, { &quot;value&quot;: &quot;40.00000000&quot;, &quot;scriptPubKey&quot;: &quot;0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG&quot;, &quot;next_in&quot;: { &quot;hash&quot;: &quot;a16f3ce4dd5deb92d98ef5cf8afeaf0775ebca408f708b2146c4fb42b41e14be&quot;, &quot;n&quot;: 0 } } ], &quot;nid&quot;: &quot;a1629e004eb3d703ecf3807f976e402a626d84c559f8eab1450adf207619f319&quot; } ], &quot;mrkl_tree&quot;: [ &quot;b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082&quot;, &quot;f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16&quot;, &quot;7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff&quot; ], &quot;next_block&quot;: &quot;00000000c9ec538cab7f38ef9c67a95742f56ab07b0a37c5be6b02808dbfb4e0&quot; } 针对上面的json格式，我们说几个关键的地方。”prev_block” 是前一个块的hash ID, “next_block”是后一个块的hash ID。tx 是本个区块打包的交易，第一个交易是coinbase, 就是我们之前文章《突破邓巴数字》中说的，在抢到仲裁打包后，用“上帝地址”给自己发币的那个交易，”hash”: “0000000000000000000000000000000000000000000000000000000000000000”， “value”: “50.00000000”， hash是0， 而value是50 ，也就是发了50个币。第二笔交易是一笔普通的转转帐交易，转帐完成后，两个输出分别是10个币和40个币，”value”: “10.00000000”， “value”: “40.00000000”。 实际上，区块数据真正存储的并不是以上字符的样子，其实计算机存储与运算的都是二进制数据，区块数据也是如此。但是二进制数据太长，不利于手动分析，我们选用等价的16进制格式。（https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.hex） 该区块的16进制数据如下。 0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e700201000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac000000000100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000 我们用工具格式化一下，变为每行16字节： 0100 0000 55bd 840a 7879 8ad0 da85 3f68 974f 3d18 3e2b d1db 6a84 2c1f eecf 222a 0000 0000 ff10 4ccb 0542 1ab9 3e63 f8c3 ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166 562c ac7d 51b9 6a49 ffff 001d 283e 9e70 0201 0000 0001 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ffff ffff 0704 ffff 001d 0102 ffff ffff 0100 f205 2a01 0000 0043 4104 d46c 4968 bde0 2899 d2aa 0963 367c 7a6c e34e ec33 2b32 e42e 5f34 07e0 52d6 4ac6 25da 6f07 18e7 b302 1404 34bd 7257 0695 7c09 2db5 3805 b821 a85b 23a7 ac61 725b ac00 0000 0001 0000 0001 c997 a5e5 6e10 4102 fa20 9c6a 852d d906 60a2 0b2d 9c35 2423 edce 2585 7fcd 3704 0000 0000 4847 3044 0220 4e45 e169 32b8 af51 4961 a1d3 a1a2 5fdf 3f4f 7732 e9d6 24c6 c615 48ab 5fb8 cd41 0220 1815 22ec 8eca 07de 4860 a4ac dd12 909d 831c c56c bbac 4622 0822 21a8 768d 1d09 01ff ffff ff02 00ca 9a3b 0000 0000 4341 04ae 1a62 fe09 c5f5 1b13 905f 07f0 6b99 a2f7 159b 2225 f374 cd37 8d71 302f a284 14e7 aab3 7397 f554 a7df 5f14 2c21 c1b7 303b 8a06 26f1 bade d5c7 2a70 4f7e 6cd8 4cac 0028 6bee 0000 0000 4341 0411 db93 e1dc db8a 016b 4984 0f8c 53bc 1eb6 8a38 2e97 b148 2eca d7b1 48a6 909a 5cb2 e0ea ddfb 84cc f974 4464 f82e 160b fa9b 8b64 f9d4 c03f 999b 8643 f656 b412 a3ac 0000 0000 接下来我们就要一个字节一个字节手动拆解了！ 首先说明一下，计算机存储数据一般采用小端格式编码，小端的含义是字节存储的顺序与真实值正好是反着的，比如存的是 12 34，实际的值是3412。在以下分析中，我们会发现，其中区块的版本、父区块头哈希值和Merkle根等大都采用的是小端格式编码。 2. 80字节的区块头 0100 0000 “ver” ，版本号，4字节，由小端格式转换成正常的值： 00000001 。 55bd 840a 7879 8ad0 da85 3f68 974f 3d18 3e2b d1db 6a84 2c1f eecf 222a 0000 0000 “prev_block”，32字节, 父区块头哈希值, 用SHA256(SHA256(父区块头))计算。 000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55 ff10 4ccb 0542 1ab9 3e63 f8c3 ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166 562c ac7d “mrkl_root”，32字节，Merkle根，同样采用SHA256(SHA256())计算。 7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff 51b9 6a49 “time”，4字节 ，时间戳。 用python转换一下， int(0x496ab951) 十进制为 1231731025 ， time.strftime(“%Y-%m-%d %H:%M:%S”, time.localtime(1381419600)) ，得到’2009-01-12 11:30:25’，这就是是这个块打包的时间。 ffff 001d “bits” ，4字节 ，难度目标。同上进行转换， int(0x1d00ffff) 为486604799 。当前区块的难度值0x1d00ffff需要采用一种特殊的编码方式才能正确转化为目标哈希值。 https://bitcoin.org/en/developer-reference#merkle-trees 283e 9e70 “nonce” ，709e3e28，4字节， Nonce。 int(0x709e3e28) 1889418792 3. 区块体 一个区块第一个交易称为coinbase交易。coinbase结构如下。 02 “n_tx” ，变长类型（CompactSize ）1-9字节，该区块包含的交易数量，coinbase交易也计入在内。02代表本区块只有2笔交易。变长类型是长度可变的数据类型，具体解释可见https://en.bitcoin.it/wiki/Protocol_documentation#Variable_length_integer 3.1 第一个coinbase交易 01 0000 00 “ver”，4字节 ，版本:这笔交易参照的规则， 0x00000001 ，版本为1 01 “vin_sz” ，变长类型，1-9字节，输入计数器:包含交易输入数量 ，0x01，表示只有一个输入。 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 “hash”，交易哈希：不引用任何一个交易，值全部为0，总共256位 32字节，不引用任何一个UTXO 0000000000000000000000000000000000000000000000000000000000000000 ffff ffff “n” ，4字节，交易输出索引，是固定值，为0xffffffff，转化为十进制值为 4294967295 07 变长类型，1-9字节， Coinbase数据长度，07即后面有7个字节是”coinbase”这个值的内容。 04 ffff 001d 0102 “coinbase” ，”04ffff001d0102”，不定字节, Coinbase数据: 在V2版本的区块中，除了需要以区块高度开始外，其它数据可以任意填写，用于extra nonce和挖矿标签。 ffff ffff 4字节，顺序号:值全部为1，0xffffffff ，即4294967295 01 “vout_sz”，1-9字节，输出计数器: 包含的交易数量。 00 f205 2a01 0000 00 “value” ，”000000012a05f200 ” 8字节。变为十进制, 5000000000亿聪， 43 变长，1-9字节， 锁定脚本大小:用字节表示的后面的锁定脚本长度。0x43, 即67，后面有67字节是锁定脚本的内容。 4104 d46c 4968 bde0 2899 d2aa 0963 367c 7a6c e34e ec33 2b32 e42e 5f34 07e0 52d6 4ac6 25da 6f07 18e7 b302 1404 34bd 7257 0695 7c09 2db5 3805 b821 a85b 23a7 ac61 725b ac “scriptPubKey” ，锁定脚本: 一个定义了支付输出所需条件的脚本。开头的41含义，表示要将接下来的65个字节压入堆栈，最后一个字节的16进制数值，ac，表示的是OP_CHECKSIG “04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG” 00 0000 00 “lock_time”，4字节，锁定时间: 一个区块号或UNIX时间戳。 锁定时间为0，表示立即执行。 3.2 第二笔普通交易 01 0000 00 “ver”: 1， 4字节， 版本为1。 01 “vin_sz”: 1 ， 1-9字节， 输入计数器:包含的交易输入数量。 3.2.1 交易输入 c997 a5e5 6e10 4102 fa20 9c6a 852d d906 60a2 0b2d 9c35 2423 edce 2585 7fcd 3704 “hash”，32字节，交易哈希值:指向被花费的UTXO所在的交易的哈希指针。”0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9” 0000 0000 “n”: 0，输出索引: 被花费的UTXO的索引号，索引为0。 48 变长类型，1-9字节 解锁脚本大小:用字节表示的后面的解锁脚本长度。转换成十进制为72，后面72字节是解锁脚本的值。 47 3044 0220 4e45 e169 32b8 af51 4961 a1d3 a1a2 5fdf 3f4f 7732 e9d6 24c6 c615 48ab 5fb8 cd41 0220 1815 22ec 8eca 07de 4860 a4ac dd12 909d 831c c56c bbac 4622 0822 21a8 768d 1d09 01 “scriptSig”，长度不定，解锁脚本:满足UTXO解锁脚本条件的脚本。解锁脚本开头的0x47表示现将后面的71个字节压入堆栈 “scriptSig”:”304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901” ff ffff ff 4字节，序列号:目前未被使用的交易替换功能。设为0xFFFFFFFF 3.2.2 交易输出 02 1-9字节，输出计数器：包含的交易输出数量，02表示有两个输出。 3.2.2.1 第一个输出 00ca 9a3b 0000 0000 “value”，8字节，总量:用聪表示的比特币值。 0x0000003b9aca00，即1000000000。 “value”: “10.00000000” 43 1-9字节，变长类型，锁定脚本大小，用字节表示的后面的锁定脚本长度。十进制为67，后面67字节是解锁脚本的值。 41 04ae 1a62 fe09 c5f5 1b13 905f 07f0 6b99 a2f7 159b 2225 f374 cd37 8d71 302f a284 14e7 aab3 7397 f554 a7df 5f14 2c21 c1b7 303b 8a06 26f1 bade d5c7 2a70 4f7e 6cd8 4cac “scriptPubKey”，不定长度，锁定脚本：一个定义了支付输出所需条件的脚本。开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 “scriptPubKey”:”04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG” 3.2.2.2 第二个输出 0028 6bee 0000 0000 “value”，8字节，总量。0x00000000ee6b2800，即4000000000 。 “value”: “40.00000000” 43 1-9字节，锁定脚本大小。十进制为67，含义同前。 41 0411 db93 e1dc db8a 016b 4984 0f8c 53bc 1eb6 8a38 2e97 b148 2eca d7b1 48a6 909a 5cb2 e0ea ddfb 84cc f974 4464 f82e 160b fa9b 8b64 f9d4 c03f 999b 8643 f656 b412 a3ac “scriptPubKey”，不定长 ，锁定脚本：一个定义了支付输出所需条件的脚本，开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 “scriptPubKey”:”0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG” 0000 0000 “lock_time”，4字节 ，锁定时间 一个区块号或UNIX时间戳 锁定时间为0，表示立即执行。”lock_time”: 0。 4. 数据长度 最后解释一下json中的各size值的来源。 （1）整个十六进制的数据长度是980，即490字节，对应json中的”size”: 490。 （2）区块头，header 是80字节： 0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e70 （3）交易数目值是02，占用1字节 （4）交易1， 长度268，134字节，对应json中的 “size”: 134 01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac00000000 （5）交易2 长度550，275字节 对应json中的”size”: 275 0100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000 所以 490 = 80 + 1 + 134 + 275，正好对应。 5. 小结 以上我们完成了一个完整区块的拆解，是不是觉得理解更踏实了一些呢？是不是感觉这区块链也没有那么神秘？是不是觉得计算机的世界也蛮有趣的？不过对于json中的 “next_in”，”hash” ，”nid”，”mrkl_tree”，”mrkl_root”,” scriptPubKey” 是怎么来的, 怎么计算的? 我们以后再讲了。 对于本文，如果你有什么疑问，欢迎留言。 最后，奉上一枚彩蛋, 一张本区块的结构图，画了很长时间的。 本公众号是活动“每周一新”第11周的践行产物。主要分享成长感悟、旅游经历、通用技术、IT趣闻、编程知识等，欢迎关注。 阅读更多" />
<meta property="og:description" content="一直以来，对比特币区块链数据存储的方式非常好奇。也许你跟我一样，看到过一些说明，但还是心存疑惑。本篇文章就深入又直观地解释一下，打消掉疑惑——我们来手动拆解一个区块。所以本篇文章是一片硬文，非常硬！ 阅读本文的需要一些基础知识：比特、字节、十六进制。这些知识，在高中的计算机基础课程里都有介绍，有一些印象就足够了。 对于专业的人，你可以弄懂本文的细节，进而深刻了解区块链的数据存储方式。而对于非专业的人，你可以直观地读，读一个轮阔，有道是 “好读书，不求甚解，每有会意，便欣然忘食”。只不过看完本文的这个轮阔，你会看见真真实实的存在，不用靠别的一些比喻来“维持”理解。甚至你都可以感受到对于数据存储与处理计算机是如何工作的。 1. 区块的数据格式 我们取一个早期的区块，早期的区块包含的交易少一些，方便分析。网址为： https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee 该网页里的格式formats: - json 是用原始数据解析出来的，一种方便人阅读的格式； - hex 是数据的16进制格式，形如3f323d…； - binary是二进制原始数据，如01010001… 肉眼可读的json格式内容如下（https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.json） { &quot;hash&quot;: &quot;00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee&quot;, &quot;ver&quot;: 1, &quot;prev_block&quot;: &quot;000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55&quot;, &quot;mrkl_root&quot;: &quot;7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff&quot;, &quot;time&quot;: 1231731025, &quot;bits&quot;: 486604799, &quot;nonce&quot;: 1889418792, &quot;n_tx&quot;: 2, &quot;size&quot;: 490, &quot;tx&quot;: [ { &quot;hash&quot;: &quot;b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082&quot;, &quot;ver&quot;: 1, &quot;vin_sz&quot;: 1, &quot;vout_sz&quot;: 1, &quot;lock_time&quot;: 0, &quot;size&quot;: 134, &quot;in&quot;: [ { &quot;prev_out&quot;: { &quot;hash&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;n&quot;: 4294967295 }, &quot;coinbase&quot;: &quot;04ffff001d0102&quot; } ], &quot;out&quot;: [ { &quot;value&quot;: &quot;50.00000000&quot;, &quot;scriptPubKey&quot;: &quot;04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG&quot; } ], &quot;nid&quot;: &quot;c56705435de47674259d6c92125907645d4fb512fa8e7f31457f5f29ba983d80&quot; }, { &quot;hash&quot;: &quot;f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16&quot;, &quot;ver&quot;: 1, &quot;vin_sz&quot;: 1, &quot;vout_sz&quot;: 2, &quot;lock_time&quot;: 0, &quot;size&quot;: 275, &quot;in&quot;: [ { &quot;prev_out&quot;: { &quot;hash&quot;: &quot;0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9&quot;, &quot;n&quot;: 0 }, &quot;scriptSig&quot;: &quot;304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901&quot; } ], &quot;out&quot;: [ { &quot;value&quot;: &quot;10.00000000&quot;, &quot;scriptPubKey&quot;: &quot;04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG&quot;, &quot;next_in&quot;: { &quot;hash&quot;: &quot;ea44e97271691990157559d0bdd9959e02790c34db6c006d779e82fa5aee708e&quot;, &quot;n&quot;: 0 } }, { &quot;value&quot;: &quot;40.00000000&quot;, &quot;scriptPubKey&quot;: &quot;0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG&quot;, &quot;next_in&quot;: { &quot;hash&quot;: &quot;a16f3ce4dd5deb92d98ef5cf8afeaf0775ebca408f708b2146c4fb42b41e14be&quot;, &quot;n&quot;: 0 } } ], &quot;nid&quot;: &quot;a1629e004eb3d703ecf3807f976e402a626d84c559f8eab1450adf207619f319&quot; } ], &quot;mrkl_tree&quot;: [ &quot;b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082&quot;, &quot;f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16&quot;, &quot;7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff&quot; ], &quot;next_block&quot;: &quot;00000000c9ec538cab7f38ef9c67a95742f56ab07b0a37c5be6b02808dbfb4e0&quot; } 针对上面的json格式，我们说几个关键的地方。”prev_block” 是前一个块的hash ID, “next_block”是后一个块的hash ID。tx 是本个区块打包的交易，第一个交易是coinbase, 就是我们之前文章《突破邓巴数字》中说的，在抢到仲裁打包后，用“上帝地址”给自己发币的那个交易，”hash”: “0000000000000000000000000000000000000000000000000000000000000000”， “value”: “50.00000000”， hash是0， 而value是50 ，也就是发了50个币。第二笔交易是一笔普通的转转帐交易，转帐完成后，两个输出分别是10个币和40个币，”value”: “10.00000000”， “value”: “40.00000000”。 实际上，区块数据真正存储的并不是以上字符的样子，其实计算机存储与运算的都是二进制数据，区块数据也是如此。但是二进制数据太长，不利于手动分析，我们选用等价的16进制格式。（https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.hex） 该区块的16进制数据如下。 0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e700201000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac000000000100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000 我们用工具格式化一下，变为每行16字节： 0100 0000 55bd 840a 7879 8ad0 da85 3f68 974f 3d18 3e2b d1db 6a84 2c1f eecf 222a 0000 0000 ff10 4ccb 0542 1ab9 3e63 f8c3 ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166 562c ac7d 51b9 6a49 ffff 001d 283e 9e70 0201 0000 0001 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ffff ffff 0704 ffff 001d 0102 ffff ffff 0100 f205 2a01 0000 0043 4104 d46c 4968 bde0 2899 d2aa 0963 367c 7a6c e34e ec33 2b32 e42e 5f34 07e0 52d6 4ac6 25da 6f07 18e7 b302 1404 34bd 7257 0695 7c09 2db5 3805 b821 a85b 23a7 ac61 725b ac00 0000 0001 0000 0001 c997 a5e5 6e10 4102 fa20 9c6a 852d d906 60a2 0b2d 9c35 2423 edce 2585 7fcd 3704 0000 0000 4847 3044 0220 4e45 e169 32b8 af51 4961 a1d3 a1a2 5fdf 3f4f 7732 e9d6 24c6 c615 48ab 5fb8 cd41 0220 1815 22ec 8eca 07de 4860 a4ac dd12 909d 831c c56c bbac 4622 0822 21a8 768d 1d09 01ff ffff ff02 00ca 9a3b 0000 0000 4341 04ae 1a62 fe09 c5f5 1b13 905f 07f0 6b99 a2f7 159b 2225 f374 cd37 8d71 302f a284 14e7 aab3 7397 f554 a7df 5f14 2c21 c1b7 303b 8a06 26f1 bade d5c7 2a70 4f7e 6cd8 4cac 0028 6bee 0000 0000 4341 0411 db93 e1dc db8a 016b 4984 0f8c 53bc 1eb6 8a38 2e97 b148 2eca d7b1 48a6 909a 5cb2 e0ea ddfb 84cc f974 4464 f82e 160b fa9b 8b64 f9d4 c03f 999b 8643 f656 b412 a3ac 0000 0000 接下来我们就要一个字节一个字节手动拆解了！ 首先说明一下，计算机存储数据一般采用小端格式编码，小端的含义是字节存储的顺序与真实值正好是反着的，比如存的是 12 34，实际的值是3412。在以下分析中，我们会发现，其中区块的版本、父区块头哈希值和Merkle根等大都采用的是小端格式编码。 2. 80字节的区块头 0100 0000 “ver” ，版本号，4字节，由小端格式转换成正常的值： 00000001 。 55bd 840a 7879 8ad0 da85 3f68 974f 3d18 3e2b d1db 6a84 2c1f eecf 222a 0000 0000 “prev_block”，32字节, 父区块头哈希值, 用SHA256(SHA256(父区块头))计算。 000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55 ff10 4ccb 0542 1ab9 3e63 f8c3 ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166 562c ac7d “mrkl_root”，32字节，Merkle根，同样采用SHA256(SHA256())计算。 7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff 51b9 6a49 “time”，4字节 ，时间戳。 用python转换一下， int(0x496ab951) 十进制为 1231731025 ， time.strftime(“%Y-%m-%d %H:%M:%S”, time.localtime(1381419600)) ，得到’2009-01-12 11:30:25’，这就是是这个块打包的时间。 ffff 001d “bits” ，4字节 ，难度目标。同上进行转换， int(0x1d00ffff) 为486604799 。当前区块的难度值0x1d00ffff需要采用一种特殊的编码方式才能正确转化为目标哈希值。 https://bitcoin.org/en/developer-reference#merkle-trees 283e 9e70 “nonce” ，709e3e28，4字节， Nonce。 int(0x709e3e28) 1889418792 3. 区块体 一个区块第一个交易称为coinbase交易。coinbase结构如下。 02 “n_tx” ，变长类型（CompactSize ）1-9字节，该区块包含的交易数量，coinbase交易也计入在内。02代表本区块只有2笔交易。变长类型是长度可变的数据类型，具体解释可见https://en.bitcoin.it/wiki/Protocol_documentation#Variable_length_integer 3.1 第一个coinbase交易 01 0000 00 “ver”，4字节 ，版本:这笔交易参照的规则， 0x00000001 ，版本为1 01 “vin_sz” ，变长类型，1-9字节，输入计数器:包含交易输入数量 ，0x01，表示只有一个输入。 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 “hash”，交易哈希：不引用任何一个交易，值全部为0，总共256位 32字节，不引用任何一个UTXO 0000000000000000000000000000000000000000000000000000000000000000 ffff ffff “n” ，4字节，交易输出索引，是固定值，为0xffffffff，转化为十进制值为 4294967295 07 变长类型，1-9字节， Coinbase数据长度，07即后面有7个字节是”coinbase”这个值的内容。 04 ffff 001d 0102 “coinbase” ，”04ffff001d0102”，不定字节, Coinbase数据: 在V2版本的区块中，除了需要以区块高度开始外，其它数据可以任意填写，用于extra nonce和挖矿标签。 ffff ffff 4字节，顺序号:值全部为1，0xffffffff ，即4294967295 01 “vout_sz”，1-9字节，输出计数器: 包含的交易数量。 00 f205 2a01 0000 00 “value” ，”000000012a05f200 ” 8字节。变为十进制, 5000000000亿聪， 43 变长，1-9字节， 锁定脚本大小:用字节表示的后面的锁定脚本长度。0x43, 即67，后面有67字节是锁定脚本的内容。 4104 d46c 4968 bde0 2899 d2aa 0963 367c 7a6c e34e ec33 2b32 e42e 5f34 07e0 52d6 4ac6 25da 6f07 18e7 b302 1404 34bd 7257 0695 7c09 2db5 3805 b821 a85b 23a7 ac61 725b ac “scriptPubKey” ，锁定脚本: 一个定义了支付输出所需条件的脚本。开头的41含义，表示要将接下来的65个字节压入堆栈，最后一个字节的16进制数值，ac，表示的是OP_CHECKSIG “04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG” 00 0000 00 “lock_time”，4字节，锁定时间: 一个区块号或UNIX时间戳。 锁定时间为0，表示立即执行。 3.2 第二笔普通交易 01 0000 00 “ver”: 1， 4字节， 版本为1。 01 “vin_sz”: 1 ， 1-9字节， 输入计数器:包含的交易输入数量。 3.2.1 交易输入 c997 a5e5 6e10 4102 fa20 9c6a 852d d906 60a2 0b2d 9c35 2423 edce 2585 7fcd 3704 “hash”，32字节，交易哈希值:指向被花费的UTXO所在的交易的哈希指针。”0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9” 0000 0000 “n”: 0，输出索引: 被花费的UTXO的索引号，索引为0。 48 变长类型，1-9字节 解锁脚本大小:用字节表示的后面的解锁脚本长度。转换成十进制为72，后面72字节是解锁脚本的值。 47 3044 0220 4e45 e169 32b8 af51 4961 a1d3 a1a2 5fdf 3f4f 7732 e9d6 24c6 c615 48ab 5fb8 cd41 0220 1815 22ec 8eca 07de 4860 a4ac dd12 909d 831c c56c bbac 4622 0822 21a8 768d 1d09 01 “scriptSig”，长度不定，解锁脚本:满足UTXO解锁脚本条件的脚本。解锁脚本开头的0x47表示现将后面的71个字节压入堆栈 “scriptSig”:”304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901” ff ffff ff 4字节，序列号:目前未被使用的交易替换功能。设为0xFFFFFFFF 3.2.2 交易输出 02 1-9字节，输出计数器：包含的交易输出数量，02表示有两个输出。 3.2.2.1 第一个输出 00ca 9a3b 0000 0000 “value”，8字节，总量:用聪表示的比特币值。 0x0000003b9aca00，即1000000000。 “value”: “10.00000000” 43 1-9字节，变长类型，锁定脚本大小，用字节表示的后面的锁定脚本长度。十进制为67，后面67字节是解锁脚本的值。 41 04ae 1a62 fe09 c5f5 1b13 905f 07f0 6b99 a2f7 159b 2225 f374 cd37 8d71 302f a284 14e7 aab3 7397 f554 a7df 5f14 2c21 c1b7 303b 8a06 26f1 bade d5c7 2a70 4f7e 6cd8 4cac “scriptPubKey”，不定长度，锁定脚本：一个定义了支付输出所需条件的脚本。开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 “scriptPubKey”:”04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG” 3.2.2.2 第二个输出 0028 6bee 0000 0000 “value”，8字节，总量。0x00000000ee6b2800，即4000000000 。 “value”: “40.00000000” 43 1-9字节，锁定脚本大小。十进制为67，含义同前。 41 0411 db93 e1dc db8a 016b 4984 0f8c 53bc 1eb6 8a38 2e97 b148 2eca d7b1 48a6 909a 5cb2 e0ea ddfb 84cc f974 4464 f82e 160b fa9b 8b64 f9d4 c03f 999b 8643 f656 b412 a3ac “scriptPubKey”，不定长 ，锁定脚本：一个定义了支付输出所需条件的脚本，开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 “scriptPubKey”:”0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG” 0000 0000 “lock_time”，4字节 ，锁定时间 一个区块号或UNIX时间戳 锁定时间为0，表示立即执行。”lock_time”: 0。 4. 数据长度 最后解释一下json中的各size值的来源。 （1）整个十六进制的数据长度是980，即490字节，对应json中的”size”: 490。 （2）区块头，header 是80字节： 0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e70 （3）交易数目值是02，占用1字节 （4）交易1， 长度268，134字节，对应json中的 “size”: 134 01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac00000000 （5）交易2 长度550，275字节 对应json中的”size”: 275 0100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000 所以 490 = 80 + 1 + 134 + 275，正好对应。 5. 小结 以上我们完成了一个完整区块的拆解，是不是觉得理解更踏实了一些呢？是不是感觉这区块链也没有那么神秘？是不是觉得计算机的世界也蛮有趣的？不过对于json中的 “next_in”，”hash” ，”nid”，”mrkl_tree”，”mrkl_root”,” scriptPubKey” 是怎么来的, 怎么计算的? 我们以后再讲了。 对于本文，如果你有什么疑问，欢迎留言。 最后，奉上一枚彩蛋, 一张本区块的结构图，画了很长时间的。 本公众号是活动“每周一新”第11周的践行产物。主要分享成长感悟、旅游经历、通用技术、IT趣闻、编程知识等，欢迎关注。 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-20T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"一直以来，对比特币区块链数据存储的方式非常好奇。也许你跟我一样，看到过一些说明，但还是心存疑惑。本篇文章就深入又直观地解释一下，打消掉疑惑——我们来手动拆解一个区块。所以本篇文章是一片硬文，非常硬！ 阅读本文的需要一些基础知识：比特、字节、十六进制。这些知识，在高中的计算机基础课程里都有介绍，有一些印象就足够了。 对于专业的人，你可以弄懂本文的细节，进而深刻了解区块链的数据存储方式。而对于非专业的人，你可以直观地读，读一个轮阔，有道是 “好读书，不求甚解，每有会意，便欣然忘食”。只不过看完本文的这个轮阔，你会看见真真实实的存在，不用靠别的一些比喻来“维持”理解。甚至你都可以感受到对于数据存储与处理计算机是如何工作的。 1. 区块的数据格式 我们取一个早期的区块，早期的区块包含的交易少一些，方便分析。网址为： https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee 该网页里的格式formats: - json 是用原始数据解析出来的，一种方便人阅读的格式； - hex 是数据的16进制格式，形如3f323d…； - binary是二进制原始数据，如01010001… 肉眼可读的json格式内容如下（https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.json） { &quot;hash&quot;: &quot;00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee&quot;, &quot;ver&quot;: 1, &quot;prev_block&quot;: &quot;000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55&quot;, &quot;mrkl_root&quot;: &quot;7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff&quot;, &quot;time&quot;: 1231731025, &quot;bits&quot;: 486604799, &quot;nonce&quot;: 1889418792, &quot;n_tx&quot;: 2, &quot;size&quot;: 490, &quot;tx&quot;: [ { &quot;hash&quot;: &quot;b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082&quot;, &quot;ver&quot;: 1, &quot;vin_sz&quot;: 1, &quot;vout_sz&quot;: 1, &quot;lock_time&quot;: 0, &quot;size&quot;: 134, &quot;in&quot;: [ { &quot;prev_out&quot;: { &quot;hash&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;n&quot;: 4294967295 }, &quot;coinbase&quot;: &quot;04ffff001d0102&quot; } ], &quot;out&quot;: [ { &quot;value&quot;: &quot;50.00000000&quot;, &quot;scriptPubKey&quot;: &quot;04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG&quot; } ], &quot;nid&quot;: &quot;c56705435de47674259d6c92125907645d4fb512fa8e7f31457f5f29ba983d80&quot; }, { &quot;hash&quot;: &quot;f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16&quot;, &quot;ver&quot;: 1, &quot;vin_sz&quot;: 1, &quot;vout_sz&quot;: 2, &quot;lock_time&quot;: 0, &quot;size&quot;: 275, &quot;in&quot;: [ { &quot;prev_out&quot;: { &quot;hash&quot;: &quot;0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9&quot;, &quot;n&quot;: 0 }, &quot;scriptSig&quot;: &quot;304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901&quot; } ], &quot;out&quot;: [ { &quot;value&quot;: &quot;10.00000000&quot;, &quot;scriptPubKey&quot;: &quot;04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG&quot;, &quot;next_in&quot;: { &quot;hash&quot;: &quot;ea44e97271691990157559d0bdd9959e02790c34db6c006d779e82fa5aee708e&quot;, &quot;n&quot;: 0 } }, { &quot;value&quot;: &quot;40.00000000&quot;, &quot;scriptPubKey&quot;: &quot;0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG&quot;, &quot;next_in&quot;: { &quot;hash&quot;: &quot;a16f3ce4dd5deb92d98ef5cf8afeaf0775ebca408f708b2146c4fb42b41e14be&quot;, &quot;n&quot;: 0 } } ], &quot;nid&quot;: &quot;a1629e004eb3d703ecf3807f976e402a626d84c559f8eab1450adf207619f319&quot; } ], &quot;mrkl_tree&quot;: [ &quot;b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082&quot;, &quot;f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16&quot;, &quot;7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff&quot; ], &quot;next_block&quot;: &quot;00000000c9ec538cab7f38ef9c67a95742f56ab07b0a37c5be6b02808dbfb4e0&quot; } 针对上面的json格式，我们说几个关键的地方。”prev_block” 是前一个块的hash ID, “next_block”是后一个块的hash ID。tx 是本个区块打包的交易，第一个交易是coinbase, 就是我们之前文章《突破邓巴数字》中说的，在抢到仲裁打包后，用“上帝地址”给自己发币的那个交易，”hash”: “0000000000000000000000000000000000000000000000000000000000000000”， “value”: “50.00000000”， hash是0， 而value是50 ，也就是发了50个币。第二笔交易是一笔普通的转转帐交易，转帐完成后，两个输出分别是10个币和40个币，”value”: “10.00000000”， “value”: “40.00000000”。 实际上，区块数据真正存储的并不是以上字符的样子，其实计算机存储与运算的都是二进制数据，区块数据也是如此。但是二进制数据太长，不利于手动分析，我们选用等价的16进制格式。（https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.hex） 该区块的16进制数据如下。 0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e700201000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac000000000100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000 我们用工具格式化一下，变为每行16字节： 0100 0000 55bd 840a 7879 8ad0 da85 3f68 974f 3d18 3e2b d1db 6a84 2c1f eecf 222a 0000 0000 ff10 4ccb 0542 1ab9 3e63 f8c3 ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166 562c ac7d 51b9 6a49 ffff 001d 283e 9e70 0201 0000 0001 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 ffff ffff 0704 ffff 001d 0102 ffff ffff 0100 f205 2a01 0000 0043 4104 d46c 4968 bde0 2899 d2aa 0963 367c 7a6c e34e ec33 2b32 e42e 5f34 07e0 52d6 4ac6 25da 6f07 18e7 b302 1404 34bd 7257 0695 7c09 2db5 3805 b821 a85b 23a7 ac61 725b ac00 0000 0001 0000 0001 c997 a5e5 6e10 4102 fa20 9c6a 852d d906 60a2 0b2d 9c35 2423 edce 2585 7fcd 3704 0000 0000 4847 3044 0220 4e45 e169 32b8 af51 4961 a1d3 a1a2 5fdf 3f4f 7732 e9d6 24c6 c615 48ab 5fb8 cd41 0220 1815 22ec 8eca 07de 4860 a4ac dd12 909d 831c c56c bbac 4622 0822 21a8 768d 1d09 01ff ffff ff02 00ca 9a3b 0000 0000 4341 04ae 1a62 fe09 c5f5 1b13 905f 07f0 6b99 a2f7 159b 2225 f374 cd37 8d71 302f a284 14e7 aab3 7397 f554 a7df 5f14 2c21 c1b7 303b 8a06 26f1 bade d5c7 2a70 4f7e 6cd8 4cac 0028 6bee 0000 0000 4341 0411 db93 e1dc db8a 016b 4984 0f8c 53bc 1eb6 8a38 2e97 b148 2eca d7b1 48a6 909a 5cb2 e0ea ddfb 84cc f974 4464 f82e 160b fa9b 8b64 f9d4 c03f 999b 8643 f656 b412 a3ac 0000 0000 接下来我们就要一个字节一个字节手动拆解了！ 首先说明一下，计算机存储数据一般采用小端格式编码，小端的含义是字节存储的顺序与真实值正好是反着的，比如存的是 12 34，实际的值是3412。在以下分析中，我们会发现，其中区块的版本、父区块头哈希值和Merkle根等大都采用的是小端格式编码。 2. 80字节的区块头 0100 0000 “ver” ，版本号，4字节，由小端格式转换成正常的值： 00000001 。 55bd 840a 7879 8ad0 da85 3f68 974f 3d18 3e2b d1db 6a84 2c1f eecf 222a 0000 0000 “prev_block”，32字节, 父区块头哈希值, 用SHA256(SHA256(父区块头))计算。 000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55 ff10 4ccb 0542 1ab9 3e63 f8c3 ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166 562c ac7d “mrkl_root”，32字节，Merkle根，同样采用SHA256(SHA256())计算。 7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff 51b9 6a49 “time”，4字节 ，时间戳。 用python转换一下， int(0x496ab951) 十进制为 1231731025 ， time.strftime(“%Y-%m-%d %H:%M:%S”, time.localtime(1381419600)) ，得到’2009-01-12 11:30:25’，这就是是这个块打包的时间。 ffff 001d “bits” ，4字节 ，难度目标。同上进行转换， int(0x1d00ffff) 为486604799 。当前区块的难度值0x1d00ffff需要采用一种特殊的编码方式才能正确转化为目标哈希值。 https://bitcoin.org/en/developer-reference#merkle-trees 283e 9e70 “nonce” ，709e3e28，4字节， Nonce。 int(0x709e3e28) 1889418792 3. 区块体 一个区块第一个交易称为coinbase交易。coinbase结构如下。 02 “n_tx” ，变长类型（CompactSize ）1-9字节，该区块包含的交易数量，coinbase交易也计入在内。02代表本区块只有2笔交易。变长类型是长度可变的数据类型，具体解释可见https://en.bitcoin.it/wiki/Protocol_documentation#Variable_length_integer 3.1 第一个coinbase交易 01 0000 00 “ver”，4字节 ，版本:这笔交易参照的规则， 0x00000001 ，版本为1 01 “vin_sz” ，变长类型，1-9字节，输入计数器:包含交易输入数量 ，0x01，表示只有一个输入。 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 “hash”，交易哈希：不引用任何一个交易，值全部为0，总共256位 32字节，不引用任何一个UTXO 0000000000000000000000000000000000000000000000000000000000000000 ffff ffff “n” ，4字节，交易输出索引，是固定值，为0xffffffff，转化为十进制值为 4294967295 07 变长类型，1-9字节， Coinbase数据长度，07即后面有7个字节是”coinbase”这个值的内容。 04 ffff 001d 0102 “coinbase” ，”04ffff001d0102”，不定字节, Coinbase数据: 在V2版本的区块中，除了需要以区块高度开始外，其它数据可以任意填写，用于extra nonce和挖矿标签。 ffff ffff 4字节，顺序号:值全部为1，0xffffffff ，即4294967295 01 “vout_sz”，1-9字节，输出计数器: 包含的交易数量。 00 f205 2a01 0000 00 “value” ，”000000012a05f200 ” 8字节。变为十进制, 5000000000亿聪， 43 变长，1-9字节， 锁定脚本大小:用字节表示的后面的锁定脚本长度。0x43, 即67，后面有67字节是锁定脚本的内容。 4104 d46c 4968 bde0 2899 d2aa 0963 367c 7a6c e34e ec33 2b32 e42e 5f34 07e0 52d6 4ac6 25da 6f07 18e7 b302 1404 34bd 7257 0695 7c09 2db5 3805 b821 a85b 23a7 ac61 725b ac “scriptPubKey” ，锁定脚本: 一个定义了支付输出所需条件的脚本。开头的41含义，表示要将接下来的65个字节压入堆栈，最后一个字节的16进制数值，ac，表示的是OP_CHECKSIG “04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG” 00 0000 00 “lock_time”，4字节，锁定时间: 一个区块号或UNIX时间戳。 锁定时间为0，表示立即执行。 3.2 第二笔普通交易 01 0000 00 “ver”: 1， 4字节， 版本为1。 01 “vin_sz”: 1 ， 1-9字节， 输入计数器:包含的交易输入数量。 3.2.1 交易输入 c997 a5e5 6e10 4102 fa20 9c6a 852d d906 60a2 0b2d 9c35 2423 edce 2585 7fcd 3704 “hash”，32字节，交易哈希值:指向被花费的UTXO所在的交易的哈希指针。”0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9” 0000 0000 “n”: 0，输出索引: 被花费的UTXO的索引号，索引为0。 48 变长类型，1-9字节 解锁脚本大小:用字节表示的后面的解锁脚本长度。转换成十进制为72，后面72字节是解锁脚本的值。 47 3044 0220 4e45 e169 32b8 af51 4961 a1d3 a1a2 5fdf 3f4f 7732 e9d6 24c6 c615 48ab 5fb8 cd41 0220 1815 22ec 8eca 07de 4860 a4ac dd12 909d 831c c56c bbac 4622 0822 21a8 768d 1d09 01 “scriptSig”，长度不定，解锁脚本:满足UTXO解锁脚本条件的脚本。解锁脚本开头的0x47表示现将后面的71个字节压入堆栈 “scriptSig”:”304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901” ff ffff ff 4字节，序列号:目前未被使用的交易替换功能。设为0xFFFFFFFF 3.2.2 交易输出 02 1-9字节，输出计数器：包含的交易输出数量，02表示有两个输出。 3.2.2.1 第一个输出 00ca 9a3b 0000 0000 “value”，8字节，总量:用聪表示的比特币值。 0x0000003b9aca00，即1000000000。 “value”: “10.00000000” 43 1-9字节，变长类型，锁定脚本大小，用字节表示的后面的锁定脚本长度。十进制为67，后面67字节是解锁脚本的值。 41 04ae 1a62 fe09 c5f5 1b13 905f 07f0 6b99 a2f7 159b 2225 f374 cd37 8d71 302f a284 14e7 aab3 7397 f554 a7df 5f14 2c21 c1b7 303b 8a06 26f1 bade d5c7 2a70 4f7e 6cd8 4cac “scriptPubKey”，不定长度，锁定脚本：一个定义了支付输出所需条件的脚本。开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 “scriptPubKey”:”04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG” 3.2.2.2 第二个输出 0028 6bee 0000 0000 “value”，8字节，总量。0x00000000ee6b2800，即4000000000 。 “value”: “40.00000000” 43 1-9字节，锁定脚本大小。十进制为67，含义同前。 41 0411 db93 e1dc db8a 016b 4984 0f8c 53bc 1eb6 8a38 2e97 b148 2eca d7b1 48a6 909a 5cb2 e0ea ddfb 84cc f974 4464 f82e 160b fa9b 8b64 f9d4 c03f 999b 8643 f656 b412 a3ac “scriptPubKey”，不定长 ，锁定脚本：一个定义了支付输出所需条件的脚本，开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 “scriptPubKey”:”0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG” 0000 0000 “lock_time”，4字节 ，锁定时间 一个区块号或UNIX时间戳 锁定时间为0，表示立即执行。”lock_time”: 0。 4. 数据长度 最后解释一下json中的各size值的来源。 （1）整个十六进制的数据长度是980，即490字节，对应json中的”size”: 490。 （2）区块头，header 是80字节： 0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e70 （3）交易数目值是02，占用1字节 （4）交易1， 长度268，134字节，对应json中的 “size”: 134 01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac00000000 （5）交易2 长度550，275字节 对应json中的”size”: 275 0100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000 所以 490 = 80 + 1 + 134 + 275，正好对应。 5. 小结 以上我们完成了一个完整区块的拆解，是不是觉得理解更踏实了一些呢？是不是感觉这区块链也没有那么神秘？是不是觉得计算机的世界也蛮有趣的？不过对于json中的 “next_in”，”hash” ，”nid”，”mrkl_tree”，”mrkl_root”,” scriptPubKey” 是怎么来的, 怎么计算的? 我们以后再讲了。 对于本文，如果你有什么疑问，欢迎留言。 最后，奉上一枚彩蛋, 一张本区块的结构图，画了很长时间的。 本公众号是活动“每周一新”第11周的践行产物。主要分享成长感悟、旅游经历、通用技术、IT趣闻、编程知识等，欢迎关注。 阅读更多","@type":"BlogPosting","url":"/2018/08/20/9fab03cecd7fd7b5460cbc2bbbe39395.html","headline":"手动拆解一个block","dateModified":"2018-08-20T00:00:00+08:00","datePublished":"2018-08-20T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/20/9fab03cecd7fd7b5460cbc2bbbe39395.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>手动拆解一个block</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>一直以来，对比特币区块链数据存储的方式非常好奇。也许你跟我一样，看到过一些说明，但还是心存疑惑。本篇文章就深入又直观地解释一下，打消掉疑惑——我们来手动拆解一个区块。所以本篇文章是一片硬文，非常硬！</p> 
  <p>阅读本文的需要一些基础知识：比特、字节、十六进制。这些知识，在高中的计算机基础课程里都有介绍，有一些印象就足够了。</p> 
  <p>对于专业的人，你可以弄懂本文的细节，进而深刻了解区块链的数据存储方式。而对于非专业的人，你可以直观地读，读一个轮阔，有道是 “<strong>好读书，不求甚解，每有会意，便欣然忘食</strong>”。只不过看完本文的这个轮阔，你会看见真真实实的存在，不用靠别的一些比喻来“维持”理解。甚至你都可以感受到对于数据存储与处理计算机是如何工作的。 </p> 
  <h2 id="1-区块的数据格式">1. 区块的数据格式</h2> 
  <p>我们取一个早期的区块，早期的区块包含的交易少一些，方便分析。网址为： <br> <a href="https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee" rel="nofollow">https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee</a> <br> 该网页里的格式formats: <br> - json 是用原始数据解析出来的，一种方便人阅读的格式； <br> - hex 是数据的16进制格式，形如3f323d…； <br> - binary是二进制原始数据，如01010001…</p> 
  <p>肉眼可读的json格式内容如下（<a href="https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.json" rel="nofollow">https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.json</a>）</p> 
  <pre class="prettyprint"><code class=" hljs json">{
  "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee"</span></span>,
  "<span class="hljs-attribute">ver</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
  "<span class="hljs-attribute">prev_block</span>": <span class="hljs-value"><span class="hljs-string">"000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55"</span></span>,
  "<span class="hljs-attribute">mrkl_root</span>": <span class="hljs-value"><span class="hljs-string">"7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff"</span></span>,
  "<span class="hljs-attribute">time</span>": <span class="hljs-value"><span class="hljs-number">1231731025</span></span>,
  "<span class="hljs-attribute">bits</span>": <span class="hljs-value"><span class="hljs-number">486604799</span></span>,
  "<span class="hljs-attribute">nonce</span>": <span class="hljs-value"><span class="hljs-number">1889418792</span></span>,
  "<span class="hljs-attribute">n_tx</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>,
  "<span class="hljs-attribute">size</span>": <span class="hljs-value"><span class="hljs-number">490</span></span>,
  "<span class="hljs-attribute">tx</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082"</span></span>, "<span class="hljs-attribute">ver</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>, "<span class="hljs-attribute">vin_sz</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>, "<span class="hljs-attribute">vout_sz</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>, "<span class="hljs-attribute">lock_time</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">size</span>": <span class="hljs-value"><span class="hljs-number">134</span></span>, "<span class="hljs-attribute">in</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">prev_out</span>": <span class="hljs-value">{ "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"0000000000000000000000000000000000000000000000000000000000000000"</span></span>, "<span class="hljs-attribute">n</span>": <span class="hljs-value"><span class="hljs-number">4294967295</span> </span>}</span>, "<span class="hljs-attribute">coinbase</span>": <span class="hljs-value"><span class="hljs-string">"04ffff001d0102"</span> </span>} ]</span>, "<span class="hljs-attribute">out</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"50.00000000"</span></span>, "<span class="hljs-attribute">scriptPubKey</span>": <span class="hljs-value"><span class="hljs-string">"04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG"</span> </span>} ]</span>, "<span class="hljs-attribute">nid</span>": <span class="hljs-value"><span class="hljs-string">"c56705435de47674259d6c92125907645d4fb512fa8e7f31457f5f29ba983d80"</span> </span>}, { "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16"</span></span>, "<span class="hljs-attribute">ver</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>, "<span class="hljs-attribute">vin_sz</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>, "<span class="hljs-attribute">vout_sz</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>, "<span class="hljs-attribute">lock_time</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">size</span>": <span class="hljs-value"><span class="hljs-number">275</span></span>, "<span class="hljs-attribute">in</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">prev_out</span>": <span class="hljs-value">{ "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9"</span></span>, "<span class="hljs-attribute">n</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>}</span>, "<span class="hljs-attribute">scriptSig</span>": <span class="hljs-value"><span class="hljs-string">"304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901"</span> </span>} ]</span>, "<span class="hljs-attribute">out</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"10.00000000"</span></span>, "<span class="hljs-attribute">scriptPubKey</span>": <span class="hljs-value"><span class="hljs-string">"04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG"</span></span>, "<span class="hljs-attribute">next_in</span>": <span class="hljs-value">{ "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"ea44e97271691990157559d0bdd9959e02790c34db6c006d779e82fa5aee708e"</span></span>, "<span class="hljs-attribute">n</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>} </span>}, { "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"40.00000000"</span></span>, "<span class="hljs-attribute">scriptPubKey</span>": <span class="hljs-value"><span class="hljs-string">"0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG"</span></span>, "<span class="hljs-attribute">next_in</span>": <span class="hljs-value">{ "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"a16f3ce4dd5deb92d98ef5cf8afeaf0775ebca408f708b2146c4fb42b41e14be"</span></span>, "<span class="hljs-attribute">n</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>} </span>} ]</span>, "<span class="hljs-attribute">nid</span>": <span class="hljs-value"><span class="hljs-string">"a1629e004eb3d703ecf3807f976e402a626d84c559f8eab1450adf207619f319"</span> </span>} ]</span>,
  "<span class="hljs-attribute">mrkl_tree</span>": <span class="hljs-value">[ <span class="hljs-string">"b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082"</span>, <span class="hljs-string">"f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16"</span>, <span class="hljs-string">"7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff"</span> ]</span>,
  "<span class="hljs-attribute">next_block</span>": <span class="hljs-value"><span class="hljs-string">"00000000c9ec538cab7f38ef9c67a95742f56ab07b0a37c5be6b02808dbfb4e0"</span> </span>}</code></pre> 
  <p>针对上面的json格式，我们说几个关键的地方。”prev_block” 是前一个块的hash ID, “next_block”是后一个块的hash ID。tx 是本个区块打包的交易，第一个交易是coinbase, 就是我们之前文章《突破邓巴数字》中说的，在抢到仲裁打包后，用“上帝地址”给自己发币的那个交易，”hash”: “0000000000000000000000000000000000000000000000000000000000000000”， “value”: “50.00000000”， hash是0， 而value是50 ，也就是发了50个币。第二笔交易是一笔普通的转转帐交易，转帐完成后，两个输出分别是10个币和40个币，”value”: “10.00000000”， “value”: “40.00000000”。</p> 
  <p>实际上，区块数据真正存储的并不是以上字符的样子，其实计算机存储与运算的都是二进制数据，区块数据也是如此。但是二进制数据太长，不利于手动分析，我们选用等价的16进制格式。（<a href="https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.hex" rel="nofollow">https://webbtc.com/block/00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee.hex</a>） <br> 该区块的16进制数据如下。</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-number">0100000055</span>bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e700201000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac000000000100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8<span class="hljs-built_in">cd</span>410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374<span class="hljs-built_in">cd</span>378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6<span class="hljs-built_in">cd</span>84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000</code></pre> 
  <p>我们用工具格式化一下，变为每行16字节：</p> 
  <pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-number">0100</span> <span class="hljs-number">0000</span> <span class="hljs-number">55</span>bd <span class="hljs-number">840</span>a <span class="hljs-number">7879</span> <span class="hljs-number">8</span>ad0 da85 <span class="hljs-number">3f</span>68
<span class="hljs-number">974f</span> <span class="hljs-number">3</span>d18 <span class="hljs-number">3e2</span>b d1db <span class="hljs-number">6</span>a84 <span class="hljs-number">2</span>c1f eecf <span class="hljs-number">222</span>a
<span class="hljs-number">0000</span> <span class="hljs-number">0000</span> ff10 <span class="hljs-number">4</span>ccb <span class="hljs-number">0542</span> <span class="hljs-number">1</span>ab9 <span class="hljs-number">3e63</span> f8c3
ce5c <span class="hljs-number">2</span>c2e <span class="hljs-number">9</span>dbb <span class="hljs-number">37</span>de <span class="hljs-number">2764</span> b3a3 <span class="hljs-number">175</span>c <span class="hljs-number">8166</span>
<span class="hljs-number">562</span>c ac7d <span class="hljs-number">51</span>b9 <span class="hljs-number">6</span>a49 ffff <span class="hljs-number">001</span>d <span class="hljs-number">283</span>e <span class="hljs-number">9e70</span>
<span class="hljs-number">0201</span> <span class="hljs-number">0000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span>
<span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span>
<span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> ffff ffff <span class="hljs-number">0704</span> ffff <span class="hljs-number">001</span>d
<span class="hljs-number">0102</span> ffff ffff <span class="hljs-number">0100</span> f205 <span class="hljs-number">2</span>a01 <span class="hljs-number">0000</span> <span class="hljs-number">0043</span>
<span class="hljs-number">4104</span> d46c <span class="hljs-number">4968</span> bde0 <span class="hljs-number">2899</span> d2aa <span class="hljs-number">0963</span> <span class="hljs-number">367</span>c
<span class="hljs-number">7</span>a6c e34e ec33 <span class="hljs-number">2</span>b32 e42e <span class="hljs-number">5f</span>34 <span class="hljs-number">07e0</span> <span class="hljs-number">52</span>d6
<span class="hljs-number">4</span>ac6 <span class="hljs-number">25</span>da <span class="hljs-number">6f</span>07 <span class="hljs-number">18e7</span> b302 <span class="hljs-number">1404</span> <span class="hljs-number">34</span>bd <span class="hljs-number">7257</span>
<span class="hljs-number">0695</span> <span class="hljs-number">7</span>c09 <span class="hljs-number">2</span>db5 <span class="hljs-number">3805</span> b821 a85b <span class="hljs-number">23</span>a7 ac61
<span class="hljs-number">725</span>b ac00 <span class="hljs-number">0000</span> <span class="hljs-number">0001</span> <span class="hljs-number">0000</span> <span class="hljs-number">0001</span> c997 a5e5
<span class="hljs-number">6e10</span> <span class="hljs-number">4102</span> fa20 <span class="hljs-number">9</span>c6a <span class="hljs-number">852</span>d d906 <span class="hljs-number">60</span>a2 <span class="hljs-number">0</span>b2d
<span class="hljs-number">9</span>c35 <span class="hljs-number">2423</span> edce <span class="hljs-number">2585</span> <span class="hljs-number">7f</span>cd <span class="hljs-number">3704</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span>
<span class="hljs-number">4847</span> <span class="hljs-number">3044</span> <span class="hljs-number">0220</span> <span class="hljs-number">4e45</span> e169 <span class="hljs-number">32</span>b8 af51 <span class="hljs-number">4961</span>
a1d3 a1a2 <span class="hljs-number">5f</span>df <span class="hljs-number">3f</span>4f <span class="hljs-number">7732</span> e9d6 <span class="hljs-number">24</span>c6 c615
<span class="hljs-number">48</span>ab <span class="hljs-number">5f</span>b8 cd41 <span class="hljs-number">0220</span> <span class="hljs-number">1815</span> <span class="hljs-number">22</span>ec <span class="hljs-number">8</span>eca <span class="hljs-number">07</span>de
<span class="hljs-number">4860</span> a4ac dd12 <span class="hljs-number">909</span>d <span class="hljs-number">831</span>c c56c bbac <span class="hljs-number">4622</span>
<span class="hljs-number">0822</span> <span class="hljs-number">21</span>a8 <span class="hljs-number">768</span>d <span class="hljs-number">1</span>d09 <span class="hljs-number">01f</span>f ffff ff02 <span class="hljs-number">00</span>ca
<span class="hljs-number">9</span>a3b <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">4341</span> <span class="hljs-number">04</span>ae <span class="hljs-number">1</span>a62 fe09 c5f5
<span class="hljs-number">1</span>b13 <span class="hljs-number">905f</span> <span class="hljs-number">07f</span>0 <span class="hljs-number">6</span>b99 a2f7 <span class="hljs-number">159</span>b <span class="hljs-number">2225</span> f374
cd37 <span class="hljs-number">8</span>d71 <span class="hljs-number">302f</span> a284 <span class="hljs-number">14e7</span> aab3 <span class="hljs-number">7397</span> f554
a7df <span class="hljs-number">5f</span>14 <span class="hljs-number">2</span>c21 c1b7 <span class="hljs-number">303</span>b <span class="hljs-number">8</span>a06 <span class="hljs-number">26f</span>1 bade
d5c7 <span class="hljs-number">2</span>a70 <span class="hljs-number">4f</span>7e <span class="hljs-number">6</span>cd8 <span class="hljs-number">4</span>cac <span class="hljs-number">0028</span> <span class="hljs-number">6</span>bee <span class="hljs-number">0000</span>
<span class="hljs-number">0000</span> <span class="hljs-number">4341</span> <span class="hljs-number">0411</span> db93 e1dc db8a <span class="hljs-number">016</span>b <span class="hljs-number">4984</span>
<span class="hljs-number">0f</span>8c <span class="hljs-number">53</span>bc <span class="hljs-number">1</span>eb6 <span class="hljs-number">8</span>a38 <span class="hljs-number">2e97</span> b148 <span class="hljs-number">2</span>eca d7b1
<span class="hljs-number">48</span>a6 <span class="hljs-number">909</span>a <span class="hljs-number">5</span>cb2 e0ea ddfb <span class="hljs-number">84</span>cc f974 <span class="hljs-number">4464</span>
f82e <span class="hljs-number">160</span>b fa9b <span class="hljs-number">8</span>b64 f9d4 c03f <span class="hljs-number">999</span>b <span class="hljs-number">8643</span>
f656 b412 a3ac <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> </code></pre> 
  <p><strong>接下来我们就要一个字节一个字节手动拆解了！</strong></p> 
  <p>首先说明一下，计算机存储数据一般采用<strong>小端</strong>格式编码，小端的含义是字节存储的顺序与真实值正好是反着的，比如存的是 12 34，实际的值是3412。在以下分析中，我们会发现，其中区块的版本、父区块头哈希值和Merkle根等大都采用的是小端格式编码。</p> 
  <h2 id="2-80字节的区块头">2. 80字节的区块头</h2> 
  <pre class="prettyprint"><code class=" hljs ">0100 0000</code></pre> 
  <p>“ver” ，版本号，4字节，由小端格式转换成正常的值： 00000001 。</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">          <span class="hljs-number">55</span>bd <span class="hljs-number">840</span><span class="hljs-operator">a</span> <span class="hljs-number">7879</span> <span class="hljs-number">8</span>ad0 da85 <span class="hljs-number">3</span>f68
<span class="hljs-number">974</span>f <span class="hljs-number">3</span>d18 <span class="hljs-number">3e2</span>b d1db <span class="hljs-number">6</span>a84 <span class="hljs-number">2</span>c1f eecf <span class="hljs-number">222</span><span class="hljs-operator">a</span>
<span class="hljs-number">0000</span> <span class="hljs-number">0000</span></code></pre> 
  <p>“prev_block”，32字节, 父区块头哈希值, 用SHA256(SHA256(父区块头))计算。 <br> 000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55</p> 
  <pre class="prettyprint"><code class=" hljs ">          ff10 4ccb 0542 1ab9 3e63 f8c3
ce5c 2c2e 9dbb 37de 2764 b3a3 175c 8166
562c ac7d</code></pre> 
  <p>“mrkl_root”，32字节，Merkle根，同样采用SHA256(SHA256())计算。 <br> 7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff</p> 
  <pre class="prettyprint"><code class=" hljs ">          51b9 6a49</code></pre> 
  <p>“time”，4字节 ，时间戳。 用python转换一下， int(0x496ab951) 十进制为 1231731025 ， time.strftime(“%Y-%m-%d %H:%M:%S”, time.localtime(1381419600)) ，得到’2009-01-12 11:30:25’，这就是是这个块打包的时间。</p> 
  <pre class="prettyprint"><code class=" hljs ">                    ffff 001d </code></pre> 
  <p>“bits” ，4字节 ，难度目标。同上进行转换， int(0x1d00ffff) 为486604799 。当前区块的难度值0x1d00ffff需要采用一种特殊的编码方式才能正确转化为目标哈希值。 <br> <a href="https://bitcoin.org/en/developer-reference#merkle-trees" rel="nofollow">https://bitcoin.org/en/developer-reference#merkle-trees</a></p> 
  <pre class="prettyprint"><code class=" hljs ">                               283e 9e70</code></pre> 
  <p>“nonce” ，709e3e28，4字节， Nonce。 int(0x709e3e28) 1889418792 </p> 
  <h2 id="3-区块体">3. 区块体</h2> 
  <p>一个区块第一个交易称为coinbase交易。coinbase结构如下。</p> 
  <pre class="prettyprint"><code class=" hljs ">02</code></pre> 
  <p>“n_tx” ，变长类型（CompactSize ）1-9字节，该区块包含的交易数量，coinbase交易也计入在内。02代表本区块只有2笔交易。变长类型是长度可变的数据类型，具体解释可见<a href="https://en.bitcoin.it/wiki/Protocol_documentation#Variable_length_integer" rel="nofollow">https://en.bitcoin.it/wiki/Protocol_documentation#Variable_length_integer</a></p> 
  <h3 id="31-第一个coinbase交易">3.1 第一个coinbase交易</h3> 
  <pre class="prettyprint"><code class=" hljs ">   01 0000 00</code></pre> 
  <p>“ver”，4字节 ，版本:这笔交易参照的规则， 0x00000001 ，版本为1</p> 
  <pre class="prettyprint"><code class=" hljs ">             01 </code></pre> 
  <p>“vin_sz” ，变长类型，1-9字节，输入计数器:包含交易输入数量 ，0x01，表示只有一个输入。</p> 
  <pre class="prettyprint"><code class=" hljs ">               0000 0000 0000 0000 0000
0000 0000 0000 0000 0000 0000 0000 0000
0000 0000 0000 </code></pre> 
  <p>“hash”，交易哈希：不引用任何一个交易，值全部为0，总共256位 32字节，不引用任何一个UTXO 0000000000000000000000000000000000000000000000000000000000000000</p> 
  <pre class="prettyprint"><code class=" hljs ">               ffff ffff </code></pre> 
  <p>“n” ，4字节，交易输出索引，是固定值，为0xffffffff，转化为十进制值为 4294967295</p> 
  <pre class="prettyprint"><code class=" hljs ">                         07</code></pre> 
  <p>变长类型，1-9字节， Coinbase数据长度，07即后面有7个字节是”coinbase”这个值的内容。</p> 
  <pre class="prettyprint"><code class=" hljs ">                            04 ffff 001d
0102 </code></pre> 
  <p>“coinbase” ，”04ffff001d0102”，不定字节, Coinbase数据: 在V2版本的区块中，除了需要以区块高度开始外，其它数据可以任意填写，用于extra nonce和挖矿标签。</p> 
  <pre class="prettyprint"><code class=" hljs ">     ffff ffff </code></pre> 
  <p>4字节，顺序号:值全部为1，0xffffffff ，即4294967295</p> 
  <pre class="prettyprint"><code class=" hljs ">              01</code></pre> 
  <p>“vout_sz”，1-9字节，输出计数器: 包含的交易数量。</p> 
  <pre class="prettyprint"><code class=" hljs ">                00 f205 2a01  0000 00</code></pre> 
  <p>“value” ，”000000012a05f200 ” 8字节。变为十进制, 5000000000亿聪，</p> 
  <pre class="prettyprint"><code class=" hljs ">                                     43</code></pre> 
  <p>变长，1-9字节， 锁定脚本大小:用字节表示的后面的锁定脚本长度。0x43, 即67，后面有67字节是锁定脚本的内容。</p> 
  <pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-number">4104</span> d46c <span class="hljs-number">4968</span> bde0 <span class="hljs-number">2899</span> d2aa <span class="hljs-number">0963</span> <span class="hljs-number">367</span>c
<span class="hljs-number">7</span>a6c e34e ec33 <span class="hljs-number">2</span>b32 e42e <span class="hljs-number">5f</span>34 <span class="hljs-number">07e0</span> <span class="hljs-number">52</span>d6
<span class="hljs-number">4</span>ac6 <span class="hljs-number">25</span>da <span class="hljs-number">6f</span>07 <span class="hljs-number">18e7</span> b302 <span class="hljs-number">1404</span> <span class="hljs-number">34</span>bd <span class="hljs-number">7257</span>
<span class="hljs-number">0695</span> <span class="hljs-number">7</span>c09 <span class="hljs-number">2</span>db5 <span class="hljs-number">3805</span> b821 a85b <span class="hljs-number">23</span>a7 ac61
<span class="hljs-number">725</span>b ac</code></pre> 
  <p>“scriptPubKey” ，锁定脚本: 一个定义了支付输出所需条件的脚本。开头的41含义，表示要将接下来的65个字节压入堆栈，最后一个字节的16进制数值，ac，表示的是OP_CHECKSIG <br> “04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG”</p> 
  <pre class="prettyprint"><code class=" hljs ">       00 0000 00</code></pre> 
  <p>“lock_time”，4字节，锁定时间: 一个区块号或UNIX时间戳。 锁定时间为0，表示立即执行。</p> 
  <h3 id="32-第二笔普通交易">3.2 第二笔普通交易</h3> 
  <pre class="prettyprint"><code class=" hljs ">                 01 0000 00</code></pre> 
  <p>“ver”: 1， 4字节， 版本为1。</p> 
  <pre><code>                       01 
</code></pre> 
  <p>“vin_sz”: 1 ， 1-9字节， 输入计数器:包含的交易输入数量。</p> 
  <h4 id="321-交易输入">3.2.1 交易输入</h4> 
  <pre class="prettyprint"><code class=" hljs cpp">                              c997 a5e5
<span class="hljs-number">6e10</span> <span class="hljs-number">4102</span> fa20 <span class="hljs-number">9</span>c6a <span class="hljs-number">852</span>d d906 <span class="hljs-number">60</span>a2 <span class="hljs-number">0</span>b2d
<span class="hljs-number">9</span>c35 <span class="hljs-number">2423</span> edce <span class="hljs-number">2585</span> <span class="hljs-number">7f</span>cd <span class="hljs-number">3704</span></code></pre> 
  <p>“hash”，32字节，交易哈希值:指向被花费的UTXO所在的交易的哈希指针。”0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9”</p> 
  <pre class="prettyprint"><code class=" hljs ">                              0000 0000</code></pre> 
  <p>“n”: 0，输出索引: 被花费的UTXO的索引号，索引为0。</p> 
  <pre class="prettyprint"><code class=" hljs ">48</code></pre> 
  <p>变长类型，1-9字节 解锁脚本大小:用字节表示的后面的解锁脚本长度。转换成十进制为72，后面72字节是解锁脚本的值。</p> 
  <pre class="prettyprint"><code class=" hljs cpp">  <span class="hljs-number">47</span> <span class="hljs-number">3044</span> <span class="hljs-number">0220</span> <span class="hljs-number">4e45</span> e169 <span class="hljs-number">32</span>b8 af51 <span class="hljs-number">4961</span>
a1d3 a1a2 <span class="hljs-number">5f</span>df <span class="hljs-number">3f</span>4f <span class="hljs-number">7732</span> e9d6 <span class="hljs-number">24</span>c6 c615
<span class="hljs-number">48</span>ab <span class="hljs-number">5f</span>b8 cd41 <span class="hljs-number">0220</span> <span class="hljs-number">1815</span> <span class="hljs-number">22</span>ec <span class="hljs-number">8</span>eca <span class="hljs-number">07</span>de
<span class="hljs-number">4860</span> a4ac dd12 <span class="hljs-number">909</span>d <span class="hljs-number">831</span>c c56c bbac <span class="hljs-number">4622</span>
<span class="hljs-number">0822</span> <span class="hljs-number">21</span>a8 <span class="hljs-number">768</span>d <span class="hljs-number">1</span>d09 <span class="hljs-number">01</span></code></pre> 
  <p>“scriptSig”，长度不定，解锁脚本:满足UTXO解锁脚本条件的脚本。解锁脚本开头的0x47表示现将后面的71个字节压入堆栈 <br> “scriptSig”:”304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901”</p> 
  <pre class="prettyprint"><code class=" hljs ">                      ff ffff ff</code></pre> 
  <p>4字节，序列号:目前未被使用的交易替换功能。设为0xFFFFFFFF</p> 
  <h4 id="322-交易输出">3.2.2 交易输出</h4> 
  <pre class="prettyprint"><code class=" hljs ">                                02 </code></pre> 
  <p>1-9字节，输出计数器：包含的交易输出数量，02表示有两个输出。</p> 
  <h5 id="3221-第一个输出">3.2.2.1 第一个输出</h5> 
  <pre class="prettyprint"><code class=" hljs ">                                   00ca
9a3b 0000 0000</code></pre> 
  <p>“value”，8字节，总量:用聪表示的比特币值。 0x0000003b9aca00，即1000000000。 <br> “value”: “10.00000000”</p> 
  <pre class="prettyprint"><code class=" hljs ">               43</code></pre> 
  <p>1-9字节，变长类型，锁定脚本大小，用字节表示的后面的锁定脚本长度。十进制为67，后面67字节是解锁脚本的值。</p> 
  <pre class="prettyprint"><code class=" hljs cpp">                 <span class="hljs-number">41</span> <span class="hljs-number">04</span>ae <span class="hljs-number">1</span>a62 fe09 c5f5
<span class="hljs-number">1</span>b13 <span class="hljs-number">905f</span> <span class="hljs-number">07f</span>0 <span class="hljs-number">6</span>b99 a2f7 <span class="hljs-number">159</span>b <span class="hljs-number">2225</span> f374
cd37 <span class="hljs-number">8</span>d71 <span class="hljs-number">302f</span> a284 <span class="hljs-number">14e7</span> aab3 <span class="hljs-number">7397</span> f554
a7df <span class="hljs-number">5f</span>14 <span class="hljs-number">2</span>c21 c1b7 <span class="hljs-number">303</span>b <span class="hljs-number">8</span>a06 <span class="hljs-number">26f</span>1 bade
d5c7 <span class="hljs-number">2</span>a70 <span class="hljs-number">4f</span>7e <span class="hljs-number">6</span>cd8 <span class="hljs-number">4</span>cac</code></pre> 
  <p>“scriptPubKey”，不定长度，锁定脚本：一个定义了支付输出所需条件的脚本。开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 <br> “scriptPubKey”:”04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG”</p> 
  <h5 id="3222-第二个输出">3.2.2.2 第二个输出</h5> 
  <pre class="prettyprint"><code class=" hljs ">                         0028 6bee 0000
0000</code></pre> 
  <p>“value”，8字节，总量。0x00000000ee6b2800，即4000000000 。 “value”: “40.00000000”</p> 
  <pre class="prettyprint"><code class=" hljs ">     43</code></pre> 
  <p>1-9字节，锁定脚本大小。十进制为67，含义同前。</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">       <span class="hljs-number">41</span> <span class="hljs-number">0411</span> db93 e1dc db8a <span class="hljs-number">016</span>b <span class="hljs-number">4984</span>
<span class="hljs-number">0</span>f8c <span class="hljs-number">53</span>bc <span class="hljs-number">1</span>eb6 <span class="hljs-number">8</span>a38 <span class="hljs-number">2e97</span> b148 <span class="hljs-number">2</span>eca d7b1
<span class="hljs-number">48</span>a6 <span class="hljs-number">909</span><span class="hljs-operator">a</span> <span class="hljs-number">5</span>cb2 e0ea ddfb <span class="hljs-number">84</span>cc f974 <span class="hljs-number">4464</span>
f82e <span class="hljs-number">160</span>b fa9b <span class="hljs-number">8</span>b64 f9d4 c03f <span class="hljs-number">999</span>b <span class="hljs-number">8643</span>
f656 b412 a3ac </code></pre> 
  <p>“scriptPubKey”，不定长 ，锁定脚本：一个定义了支付输出所需条件的脚本，开头的0x41表示将接下来的65个字节压入堆栈。而结尾的0xac表示OP_CHECKSIG。 <br> “scriptPubKey”:”0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG”</p> 
  <pre class="prettyprint"><code class=" hljs ">               0000 0000 </code></pre> 
  <p>“lock_time”，4字节 ，锁定时间 一个区块号或UNIX时间戳 锁定时间为0，表示立即执行。”lock_time”: 0。</p> 
  <h2 id="4-数据长度">4. 数据长度</h2> 
  <p>最后解释一下json中的各size值的来源。 <br> （1）整个十六进制的数据长度是980，即490字节，对应json中的”size”: 490。 <br> （2）区块头，header 是80字节：</p> 
  <pre class="prettyprint"><code class=" hljs ">0100000055bd840a78798ad0da853f68974f3d183e2bd1db6a842c1feecf222a00000000ff104ccb05421ab93e63f8c3ce5c2c2e9dbb37de2764b3a3175c8166562cac7d51b96a49ffff001d283e9e70</code></pre> 
  <p>（3）交易数目值是02，占用1字节 <br> （4）交易1， 长度268，134字节，对应json中的 “size”: 134</p> 
  <pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-number">01000000010000000000000000000000000000000000000000000000000000000000000000f</span>fffffff0704ffff001d0102ffffffff0100f2052a01000000434104d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725bac00000000</code></pre> 
  <p>（5）交易2 长度550，275字节 对应json中的”size”: 275</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-number">0100000001</span>c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8<span class="hljs-built_in">cd</span>410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374<span class="hljs-built_in">cd</span>378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6<span class="hljs-built_in">cd</span>84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000</code></pre> 
  <p>所以 490 = 80 + 1 + 134 + 275，正好对应。</p> 
  <h2 id="5-小结">5. 小结</h2> 
  <p>以上我们完成了一个完整区块的拆解，是不是觉得理解更踏实了一些呢？是不是感觉这区块链也没有那么神秘？是不是觉得计算机的世界也蛮有趣的？不过对于json中的 “next_in”，”hash” ，”nid”，”mrkl_tree”，”mrkl_root”,” scriptPubKey” 是怎么来的, 怎么计算的? 我们以后再讲了。 <br> 对于本文，如果你有什么疑问，欢迎留言。 <br> 最后，奉上一枚彩蛋, 一张本区块的结构图，画了很长时间的。</p> 
  <p><img src="http://oukq46j2b.bkt.clouddn.com/_image/mark_border_block3_final_jpg.jpg" alt="" title=""></p> 
  <hr> 
  <p>本公众号是活动“每周一新”第11周的践行产物。主要分享成长感悟、旅游经历、通用技术、IT趣闻、编程知识等，欢迎关注。 <br> <img src="http://oukq46j2b.bkt.clouddn.com/_image/qrcode_for_gh_aa4b5111fe5f_258-3.jpg" alt="" title=""></p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/victor0535/article/details/81844908,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/victor0535/article/details/81844908,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>web3j对于智能合约有两种方式 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="web3j对于智能合约有两种方式" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1、第一种：直接使用RawTrasaction进行创建 // using a raw transaction RawTransaction rawTransaction = RawTransaction.createContractTransaction( &lt;nonce&gt;, &lt;gasPrice&gt;, &lt;gasLimit&gt;, &lt;value&gt;, &quot;0x &lt;compiled smart contract code&gt;&quot;); // send... // get contract address EthGetTransactionReceipt transactionReceipt = web3j.ethGetTransactionReceipt(transactionHash).send(); if (transactionReceipt.getTransactionReceipt.isPresent()) { String contractAddress = transactionReceipt.get().getContractAddress(); } else { // try again } 第二种：将合约代码转换成Java Bean。 （1）首先我们需要一份写好的智能合约。 pragma solidity ^0.4.18; // Example taken from https://www.ethereum.org/greeter, also used in // https://github.com/ethereum/go-ethereum/wiki/Contract-Tutorial#your-first-citizen-the-greeter contract mortal { /* Define variable owner of the type address*/ address owner; /* this function is executed at initialization and sets the owner of the contract */ function mortal() { owner = msg.sender; } /* Function to recover the funds on the contract */ function kill() { if (msg.sender == owner) suicide(owner); } } contract greeter is mortal { /* define variable greeting of the type string */ string greeting; /* this runs when the contract is executed */ function greeter(string _greeting) public { greeting = _greeting; } /* main function */ function greet() constant returns (string) { return greeting; } } 注意：智能合约的代码是solidity写的，有关solidity语法和使用可以查询solidity官网 https://solidity.readthedocs.io/en/v0.4.21/ 有可能需要FQ，请自行百度科学上网 （2）进入https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.19+commit.c4cbbb05.js网站，此网站是在线智能合约编译网站，所以比较简便，不需要安装truffle等工具。 　　 点击图示中details按钮，会出现智能合约的ABI和BIN 将BYTECODE中的object复制下来保存成greeter.bin，点击ABI旁边的复制按钮将其保存成greeter.abi 进入https://github.com/web3j/web3j/releases/tag/v3.3.1网站，下载web3j-3.3.1.tar，并解压。 web3j solidity generate --solidityTypes &lt;智能合约编译之后的.bin文件的地址&gt;.bin &lt;智能合约编译之后的.abi文件的地址&gt;.abi -o /path/to/src/main/java -p com.your.organisation.name -o&nbsp;后接生成好的java文件放置的位置，-p&nbsp;后接生成的java文件的包名 或者&nbsp;进入目录bin下，将greeter.abi，复制,创建符合规则的json文件，格式如下： web3j truffle generate C:\Users\Administrator\Desktop\web3j-3.2.0\bin\HumanStandardToken.json -o C:\Users\Administrator\Desktop\web3j-3.2.0\data -p com.ycwallet.servcie　　　　　　　　 web3j truffle generate　本地合约json地址 -o 是源代码要放的目录，-p是包名，生成出来Greeter.java import org.web3j.abi.FunctionEncoder; import org.web3j.abi.TypeReference; import org.web3j.abi.datatypes.Function; import org.web3j.abi.datatypes.Type; import org.web3j.abi.datatypes.Utf8String; import org.web3j.crypto.Credentials; import org.web3j.protocol.Web3j; import org.web3j.protocol.core.RemoteCall; import org.web3j.protocol.core.methods.response.TransactionReceipt; import org.web3j.tx.Contract; import org.web3j.tx.TransactionManager; import java.math.BigInteger; import java.util.Arrays; import java.util.Collections; public class Greeter extends Contract { private static final String BINARY = &quot;6060604052341561000f57600080fd5b6040516103203803806103208339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b6102168061010a6000396000f30060606040526004361061004b5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610050578063cfae321714610065575b600080fd5b341561005b57600080fd5b6100636100ef565b005b341561007057600080fd5b610078610130565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100b457808201518382015260200161009c565b50505050905090810190601f1680156100e15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff9081169116141561012e5760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b6101386101d8565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101ce5780601f106101a3576101008083540402835291602001916101ce565b820191906000526020600020905b8154815290600101906020018083116101b157829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a723058209dd925f8a845985cc97b98b1d11e67cb72915d7316a7eeb4e28cec3f5f398c9f0029&quot;; protected Greeter(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) { super(BINARY, contractAddress, web3j, credentials, gasPrice, gasLimit); } protected Greeter(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) { super(BINARY, contractAddress, web3j, transactionManager, gasPrice, gasLimit); } public RemoteCall&lt;TransactionReceipt&gt; kill() { Function function = new Function( &quot;kill&quot;, Arrays.&lt;Type&gt;asList(), Collections.&lt;TypeReference&lt;?&gt;&gt;emptyList()); return executeRemoteCallTransaction(function); } public RemoteCall&lt;String&gt; greet() { Function function = new Function(&quot;greet&quot;, Arrays.&lt;Type&gt;asList(), Arrays.&lt;TypeReference&lt;?&gt;&gt;asList(new TypeReference&lt;Utf8String&gt;() {})); return executeRemoteCallSingleValueReturn(function, String.class); } public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit, String _greeting) { String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting))); return deployRemoteCall(Greeter.class, web3j, credentials, gasPrice, gasLimit, BINARY, encodedConstructor); } public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit, String _greeting) { String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting))); return deployRemoteCall(Greeter.class, web3j, transactionManager, gasPrice, gasLimit, BINARY, encodedConstructor); } public static Greeter load(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) { return new Greeter(contractAddress, web3j, credentials, gasPrice, gasLimit); } public static Greeter load(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) { return new Greeter(contractAddress, web3j, transactionManager, gasPrice, gasLimit); 部署智能合约 import org.web3j.crypto.Credentials; import org.web3j.protocol.Web3j; import org.web3j.protocol.http.HttpService; import org.web3j.tx.Contract; public class SmartContractTest1 { public static void main(String[] args) throws Exception { Web3j web3j = Web3j.build(new HttpService(&quot;https://kovan.infura.io/&lt;your-token&gt;&quot;)); String ownAddress = &quot;0xD1c82c71cC567d63Fd53D5B91dcAC6156E5B96B3&quot;; String toAddress = &quot;0x6e27727bbb9f0140024a62822f013385f4194999&quot;; Credentials credentials = Credentials.create(&quot;xxxxxxxxxxxxxxxxxxx&quot;); //部署智能合约 Greeter greeter = Greeter.deploy(web3j,credentials,Contract.GAS_PRICE,Contract.GAS_LIMIT,&quot;zx&quot;).send(); System.out.println(greeter.getContractAddress()); 　　　　 //调用智能合约 System.out.println(greeter.greet().send()); } } 注：远程连接的化 节点需要配置 geth --datadir data --networkid 31415926 --rpc --rpcaddr &quot;0.0.0.0&quot; --rpcport 8545 --rpccorsdomain &quot;*&quot; --rpcapi=&quot;db,eth,net,web3,personal,web3&quot; console &nbsp; &nbsp; 阅读更多 登录后自动展开" />
<meta property="og:description" content="1、第一种：直接使用RawTrasaction进行创建 // using a raw transaction RawTransaction rawTransaction = RawTransaction.createContractTransaction( &lt;nonce&gt;, &lt;gasPrice&gt;, &lt;gasLimit&gt;, &lt;value&gt;, &quot;0x &lt;compiled smart contract code&gt;&quot;); // send... // get contract address EthGetTransactionReceipt transactionReceipt = web3j.ethGetTransactionReceipt(transactionHash).send(); if (transactionReceipt.getTransactionReceipt.isPresent()) { String contractAddress = transactionReceipt.get().getContractAddress(); } else { // try again } 第二种：将合约代码转换成Java Bean。 （1）首先我们需要一份写好的智能合约。 pragma solidity ^0.4.18; // Example taken from https://www.ethereum.org/greeter, also used in // https://github.com/ethereum/go-ethereum/wiki/Contract-Tutorial#your-first-citizen-the-greeter contract mortal { /* Define variable owner of the type address*/ address owner; /* this function is executed at initialization and sets the owner of the contract */ function mortal() { owner = msg.sender; } /* Function to recover the funds on the contract */ function kill() { if (msg.sender == owner) suicide(owner); } } contract greeter is mortal { /* define variable greeting of the type string */ string greeting; /* this runs when the contract is executed */ function greeter(string _greeting) public { greeting = _greeting; } /* main function */ function greet() constant returns (string) { return greeting; } } 注意：智能合约的代码是solidity写的，有关solidity语法和使用可以查询solidity官网 https://solidity.readthedocs.io/en/v0.4.21/ 有可能需要FQ，请自行百度科学上网 （2）进入https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.19+commit.c4cbbb05.js网站，此网站是在线智能合约编译网站，所以比较简便，不需要安装truffle等工具。 　　 点击图示中details按钮，会出现智能合约的ABI和BIN 将BYTECODE中的object复制下来保存成greeter.bin，点击ABI旁边的复制按钮将其保存成greeter.abi 进入https://github.com/web3j/web3j/releases/tag/v3.3.1网站，下载web3j-3.3.1.tar，并解压。 web3j solidity generate --solidityTypes &lt;智能合约编译之后的.bin文件的地址&gt;.bin &lt;智能合约编译之后的.abi文件的地址&gt;.abi -o /path/to/src/main/java -p com.your.organisation.name -o&nbsp;后接生成好的java文件放置的位置，-p&nbsp;后接生成的java文件的包名 或者&nbsp;进入目录bin下，将greeter.abi，复制,创建符合规则的json文件，格式如下： web3j truffle generate C:\Users\Administrator\Desktop\web3j-3.2.0\bin\HumanStandardToken.json -o C:\Users\Administrator\Desktop\web3j-3.2.0\data -p com.ycwallet.servcie　　　　　　　　 web3j truffle generate　本地合约json地址 -o 是源代码要放的目录，-p是包名，生成出来Greeter.java import org.web3j.abi.FunctionEncoder; import org.web3j.abi.TypeReference; import org.web3j.abi.datatypes.Function; import org.web3j.abi.datatypes.Type; import org.web3j.abi.datatypes.Utf8String; import org.web3j.crypto.Credentials; import org.web3j.protocol.Web3j; import org.web3j.protocol.core.RemoteCall; import org.web3j.protocol.core.methods.response.TransactionReceipt; import org.web3j.tx.Contract; import org.web3j.tx.TransactionManager; import java.math.BigInteger; import java.util.Arrays; import java.util.Collections; public class Greeter extends Contract { private static final String BINARY = &quot;6060604052341561000f57600080fd5b6040516103203803806103208339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b6102168061010a6000396000f30060606040526004361061004b5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610050578063cfae321714610065575b600080fd5b341561005b57600080fd5b6100636100ef565b005b341561007057600080fd5b610078610130565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100b457808201518382015260200161009c565b50505050905090810190601f1680156100e15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff9081169116141561012e5760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b6101386101d8565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101ce5780601f106101a3576101008083540402835291602001916101ce565b820191906000526020600020905b8154815290600101906020018083116101b157829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a723058209dd925f8a845985cc97b98b1d11e67cb72915d7316a7eeb4e28cec3f5f398c9f0029&quot;; protected Greeter(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) { super(BINARY, contractAddress, web3j, credentials, gasPrice, gasLimit); } protected Greeter(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) { super(BINARY, contractAddress, web3j, transactionManager, gasPrice, gasLimit); } public RemoteCall&lt;TransactionReceipt&gt; kill() { Function function = new Function( &quot;kill&quot;, Arrays.&lt;Type&gt;asList(), Collections.&lt;TypeReference&lt;?&gt;&gt;emptyList()); return executeRemoteCallTransaction(function); } public RemoteCall&lt;String&gt; greet() { Function function = new Function(&quot;greet&quot;, Arrays.&lt;Type&gt;asList(), Arrays.&lt;TypeReference&lt;?&gt;&gt;asList(new TypeReference&lt;Utf8String&gt;() {})); return executeRemoteCallSingleValueReturn(function, String.class); } public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit, String _greeting) { String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting))); return deployRemoteCall(Greeter.class, web3j, credentials, gasPrice, gasLimit, BINARY, encodedConstructor); } public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit, String _greeting) { String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting))); return deployRemoteCall(Greeter.class, web3j, transactionManager, gasPrice, gasLimit, BINARY, encodedConstructor); } public static Greeter load(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) { return new Greeter(contractAddress, web3j, credentials, gasPrice, gasLimit); } public static Greeter load(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) { return new Greeter(contractAddress, web3j, transactionManager, gasPrice, gasLimit); 部署智能合约 import org.web3j.crypto.Credentials; import org.web3j.protocol.Web3j; import org.web3j.protocol.http.HttpService; import org.web3j.tx.Contract; public class SmartContractTest1 { public static void main(String[] args) throws Exception { Web3j web3j = Web3j.build(new HttpService(&quot;https://kovan.infura.io/&lt;your-token&gt;&quot;)); String ownAddress = &quot;0xD1c82c71cC567d63Fd53D5B91dcAC6156E5B96B3&quot;; String toAddress = &quot;0x6e27727bbb9f0140024a62822f013385f4194999&quot;; Credentials credentials = Credentials.create(&quot;xxxxxxxxxxxxxxxxxxx&quot;); //部署智能合约 Greeter greeter = Greeter.deploy(web3j,credentials,Contract.GAS_PRICE,Contract.GAS_LIMIT,&quot;zx&quot;).send(); System.out.println(greeter.getContractAddress()); 　　　　 //调用智能合约 System.out.println(greeter.greet().send()); } } 注：远程连接的化 节点需要配置 geth --datadir data --networkid 31415926 --rpc --rpcaddr &quot;0.0.0.0&quot; --rpcport 8545 --rpccorsdomain &quot;*&quot; --rpcapi=&quot;db,eth,net,web3,personal,web3&quot; console &nbsp; &nbsp; 阅读更多 登录后自动展开" />
<link rel="canonical" href="https://mlh.app/2018/08/20/518850427115b7053c3ae991a4d066e9.html" />
<meta property="og:url" content="https://mlh.app/2018/08/20/518850427115b7053c3ae991a4d066e9.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-20T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1、第一种：直接使用RawTrasaction进行创建 // using a raw transaction RawTransaction rawTransaction = RawTransaction.createContractTransaction( &lt;nonce&gt;, &lt;gasPrice&gt;, &lt;gasLimit&gt;, &lt;value&gt;, &quot;0x &lt;compiled smart contract code&gt;&quot;); // send... // get contract address EthGetTransactionReceipt transactionReceipt = web3j.ethGetTransactionReceipt(transactionHash).send(); if (transactionReceipt.getTransactionReceipt.isPresent()) { String contractAddress = transactionReceipt.get().getContractAddress(); } else { // try again } 第二种：将合约代码转换成Java Bean。 （1）首先我们需要一份写好的智能合约。 pragma solidity ^0.4.18; // Example taken from https://www.ethereum.org/greeter, also used in // https://github.com/ethereum/go-ethereum/wiki/Contract-Tutorial#your-first-citizen-the-greeter contract mortal { /* Define variable owner of the type address*/ address owner; /* this function is executed at initialization and sets the owner of the contract */ function mortal() { owner = msg.sender; } /* Function to recover the funds on the contract */ function kill() { if (msg.sender == owner) suicide(owner); } } contract greeter is mortal { /* define variable greeting of the type string */ string greeting; /* this runs when the contract is executed */ function greeter(string _greeting) public { greeting = _greeting; } /* main function */ function greet() constant returns (string) { return greeting; } } 注意：智能合约的代码是solidity写的，有关solidity语法和使用可以查询solidity官网 https://solidity.readthedocs.io/en/v0.4.21/ 有可能需要FQ，请自行百度科学上网 （2）进入https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.19+commit.c4cbbb05.js网站，此网站是在线智能合约编译网站，所以比较简便，不需要安装truffle等工具。 　　 点击图示中details按钮，会出现智能合约的ABI和BIN 将BYTECODE中的object复制下来保存成greeter.bin，点击ABI旁边的复制按钮将其保存成greeter.abi 进入https://github.com/web3j/web3j/releases/tag/v3.3.1网站，下载web3j-3.3.1.tar，并解压。 web3j solidity generate --solidityTypes &lt;智能合约编译之后的.bin文件的地址&gt;.bin &lt;智能合约编译之后的.abi文件的地址&gt;.abi -o /path/to/src/main/java -p com.your.organisation.name -o&nbsp;后接生成好的java文件放置的位置，-p&nbsp;后接生成的java文件的包名 或者&nbsp;进入目录bin下，将greeter.abi，复制,创建符合规则的json文件，格式如下： web3j truffle generate C:\\Users\\Administrator\\Desktop\\web3j-3.2.0\\bin\\HumanStandardToken.json -o C:\\Users\\Administrator\\Desktop\\web3j-3.2.0\\data -p com.ycwallet.servcie　　　　　　　　 web3j truffle generate　本地合约json地址 -o 是源代码要放的目录，-p是包名，生成出来Greeter.java import org.web3j.abi.FunctionEncoder; import org.web3j.abi.TypeReference; import org.web3j.abi.datatypes.Function; import org.web3j.abi.datatypes.Type; import org.web3j.abi.datatypes.Utf8String; import org.web3j.crypto.Credentials; import org.web3j.protocol.Web3j; import org.web3j.protocol.core.RemoteCall; import org.web3j.protocol.core.methods.response.TransactionReceipt; import org.web3j.tx.Contract; import org.web3j.tx.TransactionManager; import java.math.BigInteger; import java.util.Arrays; import java.util.Collections; public class Greeter extends Contract { private static final String BINARY = &quot;6060604052341561000f57600080fd5b6040516103203803806103208339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b6102168061010a6000396000f30060606040526004361061004b5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610050578063cfae321714610065575b600080fd5b341561005b57600080fd5b6100636100ef565b005b341561007057600080fd5b610078610130565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100b457808201518382015260200161009c565b50505050905090810190601f1680156100e15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff9081169116141561012e5760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b6101386101d8565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101ce5780601f106101a3576101008083540402835291602001916101ce565b820191906000526020600020905b8154815290600101906020018083116101b157829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a723058209dd925f8a845985cc97b98b1d11e67cb72915d7316a7eeb4e28cec3f5f398c9f0029&quot;; protected Greeter(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) { super(BINARY, contractAddress, web3j, credentials, gasPrice, gasLimit); } protected Greeter(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) { super(BINARY, contractAddress, web3j, transactionManager, gasPrice, gasLimit); } public RemoteCall&lt;TransactionReceipt&gt; kill() { Function function = new Function( &quot;kill&quot;, Arrays.&lt;Type&gt;asList(), Collections.&lt;TypeReference&lt;?&gt;&gt;emptyList()); return executeRemoteCallTransaction(function); } public RemoteCall&lt;String&gt; greet() { Function function = new Function(&quot;greet&quot;, Arrays.&lt;Type&gt;asList(), Arrays.&lt;TypeReference&lt;?&gt;&gt;asList(new TypeReference&lt;Utf8String&gt;() {})); return executeRemoteCallSingleValueReturn(function, String.class); } public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit, String _greeting) { String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting))); return deployRemoteCall(Greeter.class, web3j, credentials, gasPrice, gasLimit, BINARY, encodedConstructor); } public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit, String _greeting) { String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting))); return deployRemoteCall(Greeter.class, web3j, transactionManager, gasPrice, gasLimit, BINARY, encodedConstructor); } public static Greeter load(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) { return new Greeter(contractAddress, web3j, credentials, gasPrice, gasLimit); } public static Greeter load(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) { return new Greeter(contractAddress, web3j, transactionManager, gasPrice, gasLimit); 部署智能合约 import org.web3j.crypto.Credentials; import org.web3j.protocol.Web3j; import org.web3j.protocol.http.HttpService; import org.web3j.tx.Contract; public class SmartContractTest1 { public static void main(String[] args) throws Exception { Web3j web3j = Web3j.build(new HttpService(&quot;https://kovan.infura.io/&lt;your-token&gt;&quot;)); String ownAddress = &quot;0xD1c82c71cC567d63Fd53D5B91dcAC6156E5B96B3&quot;; String toAddress = &quot;0x6e27727bbb9f0140024a62822f013385f4194999&quot;; Credentials credentials = Credentials.create(&quot;xxxxxxxxxxxxxxxxxxx&quot;); //部署智能合约 Greeter greeter = Greeter.deploy(web3j,credentials,Contract.GAS_PRICE,Contract.GAS_LIMIT,&quot;zx&quot;).send(); System.out.println(greeter.getContractAddress()); 　　　　 //调用智能合约 System.out.println(greeter.greet().send()); } } 注：远程连接的化 节点需要配置 geth --datadir data --networkid 31415926 --rpc --rpcaddr &quot;0.0.0.0&quot; --rpcport 8545 --rpccorsdomain &quot;*&quot; --rpcapi=&quot;db,eth,net,web3,personal,web3&quot; console &nbsp; &nbsp; 阅读更多 登录后自动展开","@type":"BlogPosting","url":"https://mlh.app/2018/08/20/518850427115b7053c3ae991a4d066e9.html","headline":"web3j对于智能合约有两种方式","dateModified":"2018-08-20T00:00:00+08:00","datePublished":"2018-08-20T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/20/518850427115b7053c3ae991a4d066e9.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>web3j对于智能合约有两种方式</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><strong><span style="color:#333333;">1</span></strong><strong><span style="color:#333333;">、第一种：直接使用</span></strong><strong><span style="color:#333333;">RawTrasaction</span></strong><strong><span style="color:#333333;">进行创建</span></strong></p> 
  <pre class="has">
<code>// using a raw transaction
RawTransaction rawTransaction = RawTransaction.createContractTransaction(
        &lt;nonce&gt;,
        &lt;gasPrice&gt;,
        &lt;gasLimit&gt;,
        &lt;value&gt;,
        "0x &lt;compiled smart contract code&gt;");
// send...

// get contract address
EthGetTransactionReceipt transactionReceipt =
             web3j.ethGetTransactionReceipt(transactionHash).send();

if (transactionReceipt.getTransactionReceipt.isPresent()) {
    String contractAddress = transactionReceipt.get().getContractAddress();
} else {
    // try again
}
</code></pre> 
  <p><strong><span style="color:#333333;">第二种：将合约代码转换成</span></strong><strong><span style="color:#333333;">Java Bean</span></strong><strong><span style="color:#333333;">。</span></strong></p> 
  <p><span style="color:#333333;">（</span><span style="color:#333333;">1</span><span style="color:#333333;">）首先我们需要一份写好的智能合约。</span></p> 
  <pre class="has">
<code>pragma solidity ^0.4.18;

// Example taken from https://www.ethereum.org/greeter, also used in
// https://github.com/ethereum/go-ethereum/wiki/Contract-Tutorial#your-first-citizen-the-greeter

contract mortal {
    /* Define variable owner of the type address*/
    address owner;

    /* this function is executed at initialization and sets the owner of the contract */
    function mortal() { owner = msg.sender; }

    /* Function to recover the funds on the contract */
    function kill() { if (msg.sender == owner) suicide(owner); }
}

contract greeter is mortal {
    /* define variable greeting of the type string */
    string greeting;

    /* this runs when the contract is executed */
    function greeter(string _greeting) public {
        greeting = _greeting;
    }

    /* main function */
    function greet() constant returns (string) {
        return greeting;
    }
}</code></pre> 
  <p style="margin-left:0cm;"><span style="color:#333333;">注意：智能合约的代码是</span><span style="color:#333333;">solidity</span><span style="color:#333333;">写的，有关</span><span style="color:#333333;">solidity</span><span style="color:#333333;">语法和使用可以查询</span><span style="color:#333333;">solidity</span><span style="color:#333333;">官网</span></p> 
  <p style="margin-left:0cm;"><a href="https://solidity.readthedocs.io/en/v0.4.21/" rel="nofollow">https://solidity.readthedocs.io/en/v0.4.21/</a></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">有可能需要</span><span style="color:#333333;">FQ</span><span style="color:#333333;">，请自行百度科学上网</span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">（</span><span style="color:#333333;">2</span><span style="color:#333333;">）进入</span><a href="https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.19+commit.c4cbbb05.js" rel="nofollow"><span style="color:#000000;">https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.19+commit.c4cbbb05.js</span></a><span style="color:#333333;">网站，此网站是在线智能合约编译网站，所以比较简便，不需要安装</span><span style="color:#333333;">truffle</span><span style="color:#333333;">等工具。</span></p> 
  <p style="margin-left:0cm;">　　<span style="color:#333333;"><img alt="https://images2018.cnblogs.com/blog/1171881/201803/1171881-20180316140507926-1397833168.png" class="has" src="https://images2018.cnblogs.com/blog/1171881/201803/1171881-20180316140507926-1397833168.png"></span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">点击图示中</span><span style="color:#333333;">details</span><span style="color:#333333;">按钮，会出现智能合约的</span><span style="color:#333333;">ABI</span><span style="color:#333333;">和</span><span style="color:#333333;">BIN</span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;"><img alt="https://images2018.cnblogs.com/blog/1171881/201803/1171881-20180316140656853-1765048701.png" class="has" src="https://images2018.cnblogs.com/blog/1171881/201803/1171881-20180316140656853-1765048701.png"></span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">将</span><span style="color:#333333;">BYTECODE</span><span style="color:#333333;">中的</span><span style="color:#333333;">object</span><span style="color:#333333;">复制下来保存成</span><span style="color:#333333;">greeter.bin</span><span style="color:#333333;">，点击</span><span style="color:#333333;">ABI</span><span style="color:#333333;">旁边的复制按钮将其保存成</span><span style="color:#333333;">greeter.abi</span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;"><img alt="https://images2018.cnblogs.com/blog/1171881/201803/1171881-20180316140924541-633893352.png" class="has" src="https://images2018.cnblogs.com/blog/1171881/201803/1171881-20180316140924541-633893352.png"></span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">进入</span><a href="https://github.com/web3j/web3j/releases/tag/v3.3.1" rel="nofollow">https://github.com/web3j/web3j/releases/tag/v3.3.1</a><span style="color:#333333;">网站，下载</span><span style="color:#333333;">web3j-3.3.1.tar</span><span style="color:#333333;">，并解压。</span></p> 
  <pre class="has">
<code>web3j solidity generate --solidityTypes &lt;智能合约编译之后的.bin文件的地址&gt;.bin &lt;智能合约编译之后的.abi文件的地址&gt;.abi -o /path/to/src/main/java -p com.your.organisation.name
</code></pre> 
  <p style="margin-left:0cm;"><span style="color:#f33b45;"><code>-o</code></span>&nbsp;后接生成好的java文件放置的位置，<span style="color:#f33b45;"><code>-p</code></span>&nbsp;后接生成的java文件的包名</p> 
  <p style="margin-left:0cm;"><span style="color:#333333;"><strong>或者&nbsp;</strong>进入目录</span><span style="color:#333333;">bin</span><span style="color:#333333;">下，将</span><span style="color:#333333;">greeter.abi</span><span style="color:#333333;">，复制</span><span style="color:#333333;">,</span><span style="color:#333333;">创建符合规则的</span><span style="color:#333333;">json文件，格式如下：</span></p> 
  <p style="margin-left:0cm;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180820161929791?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tlaXRoMDAz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <pre class="has">
<code>web3j truffle generate C:\Users\Administrator\Desktop\web3j-3.2.0\bin\HumanStandardToken.json -o C:\Users\Administrator\Desktop\web3j-3.2.0\data -p com.ycwallet.servcie　　　　　　　　

web3j truffle generate　本地合约json地址 -o 是源代码要放的目录，-p是包名，生成出来Greeter.java
</code></pre> 
  <pre class="has">
<code>import org.web3j.abi.FunctionEncoder;
import org.web3j.abi.TypeReference;
import org.web3j.abi.datatypes.Function;
import org.web3j.abi.datatypes.Type;
import org.web3j.abi.datatypes.Utf8String;
import org.web3j.crypto.Credentials;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.RemoteCall;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.tx.Contract;
import org.web3j.tx.TransactionManager;

import java.math.BigInteger;
import java.util.Arrays;
import java.util.Collections;

public class Greeter extends Contract {
    private static final String BINARY = "6060604052341561000f57600080fd5b6040516103203803806103208339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b6102168061010a6000396000f30060606040526004361061004b5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610050578063cfae321714610065575b600080fd5b341561005b57600080fd5b6100636100ef565b005b341561007057600080fd5b610078610130565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100b457808201518382015260200161009c565b50505050905090810190601f1680156100e15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff9081169116141561012e5760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b6101386101d8565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101ce5780601f106101a3576101008083540402835291602001916101ce565b820191906000526020600020905b8154815290600101906020018083116101b157829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a723058209dd925f8a845985cc97b98b1d11e67cb72915d7316a7eeb4e28cec3f5f398c9f0029";

    protected Greeter(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) {
        super(BINARY, contractAddress, web3j, credentials, gasPrice, gasLimit);
    }

    protected Greeter(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) {
        super(BINARY, contractAddress, web3j, transactionManager, gasPrice, gasLimit);
    }

    public RemoteCall&lt;TransactionReceipt&gt; kill() {
        Function function = new Function(
                "kill",
                Arrays.&lt;Type&gt;asList(),
                Collections.&lt;TypeReference&lt;?&gt;&gt;emptyList());
        return executeRemoteCallTransaction(function);
    }

    public RemoteCall&lt;String&gt; greet() {
        Function function = new Function("greet",
                Arrays.&lt;Type&gt;asList(),
                Arrays.&lt;TypeReference&lt;?&gt;&gt;asList(new TypeReference&lt;Utf8String&gt;() {}));
        return executeRemoteCallSingleValueReturn(function, String.class);
    }

    public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit, String _greeting) {
        String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting)));
        return deployRemoteCall(Greeter.class, web3j, credentials, gasPrice, gasLimit, BINARY, encodedConstructor);
    }

    public static RemoteCall&lt;Greeter&gt; deploy(Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit, String _greeting) {
        String encodedConstructor = FunctionEncoder.encodeConstructor(Arrays.&lt;Type&gt;asList(new org.web3j.abi.datatypes.Utf8String(_greeting)));
        return deployRemoteCall(Greeter.class, web3j, transactionManager, gasPrice, gasLimit, BINARY, encodedConstructor);
    }

    public static Greeter load(String contractAddress, Web3j web3j, Credentials credentials, BigInteger gasPrice, BigInteger gasLimit) {
        return new Greeter(contractAddress, web3j, credentials, gasPrice, gasLimit);
    }

    public static Greeter load(String contractAddress, Web3j web3j, TransactionManager transactionManager, BigInteger gasPrice, BigInteger gasLimit) {
        return new Greeter(contractAddress, web3j, transactionManager, gasPrice, gasLimit);
  

</code></pre> 
  <p style="margin-left:0cm;"><span style="color:#333333;">部署智能合约</span></p> 
  <pre class="has">
<code>import org.web3j.crypto.Credentials;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.http.HttpService;
import org.web3j.tx.Contract;

public class SmartContractTest1 {
    public static void main(String[] args) throws Exception {
        Web3j web3j = Web3j.build(new HttpService("https://kovan.infura.io/&lt;your-token&gt;"));
        String ownAddress = "0xD1c82c71cC567d63Fd53D5B91dcAC6156E5B96B3";
        String toAddress = "0x6e27727bbb9f0140024a62822f013385f4194999";
        Credentials credentials = Credentials.create("xxxxxxxxxxxxxxxxxxx");
        //部署智能合约
        Greeter greeter = Greeter.deploy(web3j,credentials,Contract.GAS_PRICE,Contract.GAS_LIMIT,"zx").send();
        System.out.println(greeter.getContractAddress());
　　　　 //调用智能合约
        System.out.println(greeter.greet().send());

    }
}
</code></pre> 
  <h2 style="margin-left:0cm;"><span style="color:#f33b45;">注：远程连接的化 节点需要配置</span></h2> 
  <pre class="has">
<code>geth --datadir data --networkid 31415926 --rpc --rpcaddr "0.0.0.0" --rpcport 8545 --rpccorsdomain "*" --rpcapi="db,eth,net,web3,personal,web3" console</code></pre> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Keith003/article/details/81873154,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Keith003/article/details/81873154,&quot;}">阅读更多</a> 
 <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Keith003/article/details/81873154,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Keith003/article/details/81873154,&quot;}">登录后自动展开</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>hyperledger多机部署 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="hyperledger多机部署" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一、环境配置 5台服务器全部是centos7.4 orderer 47.75.123.155 orderer.example.com orderer peer0.org1&nbsp;47.52.202.124&nbsp; &nbsp;1G内存 peer1.org1&nbsp;47.75.184.117 cli 启动后如果出错，很可能要重新安装 总结： 1、首先所有的服务器都要预先处理vim /etc/resolv.conf的问题，否则会有问题； 2、只有orderer服务器需要启动network_setup，获取bin文件夹，并且生成channel-artifacts crypto-config 两个文件夹 3、所有的服务器最好都copy一下chaincode文件夹 4、peer0运行cli后，有一个mychannel.block文件需要发送到其余的peer1，其中要进行多次copy，最终到其他peer的cli容器 5、peer的启动脚本docker-peer.yaml中有两处是org的CA编号，需要保持一致 二、服务器的初始化和安装有关软件 参考单机部署https://blog.csdn.net/frankxixu/article/details/81369411 的描述，完成环境搭建 0、vi ~/.ssh/known_hosts 解决连接问题 1、更新依赖源 sudo yum update 2、安装docker: sudo yum install -y yum-utils \device-mapper-persistent-data \lvm2 3、安装有关的依赖 sudo yum-config-manager \--add-repo \https://download.docker.com/linux/centos/docker-ce.repo 4、安装docker-ce sudo yum install docker-ce 检查安装结果 docker --version 5、启动&nbsp;service docker start 6、每次自动启动 chkconfig docker on 7、安装curl 命令 yum install curl 8、下载docker-compose，注意不是单引号 sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose cp /usr/local/bin/docker-compose /usr/bin 10、docker-compose version&nbsp; 如果提示权限不足，那么chmod +x /usr/local/bin/docker-compose 11、安装go curl -O https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz tar -C /usr/local -xzf go1.10.1.linux-amd64.tar.gz 解压缩到/usr/local目录 12、配置环境 vim /etc/profile export PATH=$PATH:/usr/local/go/bin export GOPATH=/opt/gopath source /etc/profile 13、查看go 安装信息 echo $PATH go version 14、安装git yum install git 15、创建安装目录 mkdir -p /opt/gopath/src/github.com/hyperledger 16、进入安装目录 cd /opt/gopath/src/github.com/hyperledger 17、拉取源代码 git clone https://github.com/hyperledger/fabric.git 18、切换到分支 cd fabric git checkout v1.0.0&nbsp; &nbsp;这两个有差异！应该这样而不是上面的 -b是新建分支的意思！ 19、拉取docker cd examples/e2e_cli/ chmod +x download-dockerimages.sh ./download-dockerimages.sh -c x86_64-1.0.0 -f x86_64-1.0.0 docker images 查看下载内容 修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉&nbsp; 所有节点都提前改一下，不然进入cli 指令错误 20、运行fabric网络&nbsp; &nbsp; peer节点暂时不运行 orderer运行获取bin cd examples/e2e_cli/ ./network_setup.sh up 错误：fatal error: unexpected signal during runtime execution ./network_setup.sh down docker rm -f $(docker ps -aq) 解决办法： 修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉 peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错 21、在fabric目录下 mkdir aberic all节点 22、上一步生成了bin 在fabric/release/linux-amd64/下&nbsp;&nbsp;orderer节点 ./network_setup.sh down 先停止服务 cp -r bin /opt/gopath/src/github.com/hyperledger/fabric/aberic 还需要configtx.yaml 和 crypto-config.yaml 这两个文件来自/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli cp configtx.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic cp crypto-config.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic 配置齐全了！ 22、准备有关文件&nbsp;orderer节点 准备启动&nbsp;&nbsp;aberic目录下 ./bin/cryptogen generate --config=./crypto-config.yaml 结果生成 org1.example.com org2.example.com crypto-config 目录也添加了 生成创世区块 export FABRIC_CFG_PATH=$PWD 在fabric/aberic目录下执行以上 echo&nbsp;$PWD 输出：/opt/gopath/src/github.com/hyperledger/fabric/aberic 23、执行创世区块生成&nbsp;orderer节点 在fabric/aberic目录下创建channel-artifacts目录 mkdir channel-artifacts 执行 ./bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block ./bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel ------- 查看ca的具体ID,写入peer节点的docker-peer01.yaml文件 /opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config/peerOrganizations/org1.example.com/ca 三、orderer服务器 1、准备docker-orderer.yaml脚本，上传 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-orderer.yaml root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic 2、启动orderer节点 docker-compose -f docker-orderer.yaml up -d 要关闭的话执行：docker-compose -f docker-orderer.yaml down 这里即使有错误也会显示成功，主要要docker ps来看 四、peer0.org1服务器 不需要启动网络产生bin 需要channel-artifacts文件夹和crypto-config文件夹，channel-artifacts文件夹包含了channel的相关信息，crypto-config文件夹包含了所有节点的公钥，私钥和证书信息。这两个文件夹我们只在orderer服务器上生成就行了，然后拷贝到其他机器上就可以了。 在aberic目录下 还需要chaincode copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic cd fabric/aberic scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./ scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./ 在本地开发的机器上执行 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer01.yaml root@47.52.202.124:/opt/gopath/src/github.com/hyperledger/fabric/aberic #上传之前docker-peer01.yaml 中要更换CA的具体ID 回到peer0.org1 fabric/aberic/ docker-compose -f docker-peer01.yaml up -d #docker-compose -f docker-peer01.yaml down #docker rm `docker ps -a -q` 进入 cli of peer0 docker exec -it cli bash 3、尝试有关智能合约指令 创建mychannel peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx 4、加入channel peer channel join -b mychannel.block peer0加入网络，由于cli是默认指向peer0的，docker-peer.yaml文件说明 可以修改cli配置，使得指向其他的peer 5、安装智能合约 peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0 6、实例化chaincode peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;10&quot;,&quot;B&quot;,&quot;10&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.member&#39;)&quot; -v 1.0 7、查询 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39; Query Result: 10 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; 8、交易 peer chaincode invoke -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;A&quot;,&quot;B&quot;,&quot;8&quot;]}&#39; result: status:200&nbsp; &nbsp; 五、peer1.org1 1、修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉 peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错 2、从peer0.org1的cli中copy出mychannel.block文件，这个需要多次中转 3、在aberic目录下还需要chaincode、channel-artifacts crypto-config 和启动用的yaml脚本 （1）copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic （2）cd fabric/aberic scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./ scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./ （3）在本地开发的机器上执行 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer11.yaml root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic (4)启动 docker-compose -f docker-peer11.yaml up -d docker ps 5a4ff44f7a41 containerID of cli&nbsp; &nbsp;每次装系统都不一样，这个ID 会在后面copy mychannel.block文件中用到 (5) 获取mychannel.block （5.1）首先从peer0.org1的cli中将mychannel.block考出 退出 peer0.org1 cli&nbsp; (exit) 把peer0的cli中的mychannel.block copy出来到物理主机 docker cp&nbsp;46370c0ca94e:/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block&nbsp;/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/ （5.2）将该文件从peer0.org1发到peer1.org1 cd&nbsp;channel-artifacts&nbsp; (peer0.org1) scp -r mychannel.block root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/ (5.3)想办法把该文件从peer1.org1的主机copy到其上的cli中 另外从本地建1个ssh 到peer1.org1 cd channel-artifacts docker cp mychannel.block 5a4ff44f7a41:/opt/gopath/src/github.com/hyperledger/fabric/peer/ 4、测试智能合约 （1）加入peer channel join -b mychannel.block （2）安装智能合约 peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0 （3）查询账户 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; 18 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39;&nbsp; 2 （4）交易 peer chaincode invoke -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;A&quot;,&quot;B&quot;,&quot;1&quot;]}&#39; result: status:200 （5）交易后查询 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39;&nbsp; Query Result: 1 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; Query Result: 19 （6）这里的交易会使得peer0.org1查询的结果也发生变化 &nbsp; 阅读更多" />
<meta property="og:description" content="一、环境配置 5台服务器全部是centos7.4 orderer 47.75.123.155 orderer.example.com orderer peer0.org1&nbsp;47.52.202.124&nbsp; &nbsp;1G内存 peer1.org1&nbsp;47.75.184.117 cli 启动后如果出错，很可能要重新安装 总结： 1、首先所有的服务器都要预先处理vim /etc/resolv.conf的问题，否则会有问题； 2、只有orderer服务器需要启动network_setup，获取bin文件夹，并且生成channel-artifacts crypto-config 两个文件夹 3、所有的服务器最好都copy一下chaincode文件夹 4、peer0运行cli后，有一个mychannel.block文件需要发送到其余的peer1，其中要进行多次copy，最终到其他peer的cli容器 5、peer的启动脚本docker-peer.yaml中有两处是org的CA编号，需要保持一致 二、服务器的初始化和安装有关软件 参考单机部署https://blog.csdn.net/frankxixu/article/details/81369411 的描述，完成环境搭建 0、vi ~/.ssh/known_hosts 解决连接问题 1、更新依赖源 sudo yum update 2、安装docker: sudo yum install -y yum-utils \device-mapper-persistent-data \lvm2 3、安装有关的依赖 sudo yum-config-manager \--add-repo \https://download.docker.com/linux/centos/docker-ce.repo 4、安装docker-ce sudo yum install docker-ce 检查安装结果 docker --version 5、启动&nbsp;service docker start 6、每次自动启动 chkconfig docker on 7、安装curl 命令 yum install curl 8、下载docker-compose，注意不是单引号 sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose cp /usr/local/bin/docker-compose /usr/bin 10、docker-compose version&nbsp; 如果提示权限不足，那么chmod +x /usr/local/bin/docker-compose 11、安装go curl -O https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz tar -C /usr/local -xzf go1.10.1.linux-amd64.tar.gz 解压缩到/usr/local目录 12、配置环境 vim /etc/profile export PATH=$PATH:/usr/local/go/bin export GOPATH=/opt/gopath source /etc/profile 13、查看go 安装信息 echo $PATH go version 14、安装git yum install git 15、创建安装目录 mkdir -p /opt/gopath/src/github.com/hyperledger 16、进入安装目录 cd /opt/gopath/src/github.com/hyperledger 17、拉取源代码 git clone https://github.com/hyperledger/fabric.git 18、切换到分支 cd fabric git checkout v1.0.0&nbsp; &nbsp;这两个有差异！应该这样而不是上面的 -b是新建分支的意思！ 19、拉取docker cd examples/e2e_cli/ chmod +x download-dockerimages.sh ./download-dockerimages.sh -c x86_64-1.0.0 -f x86_64-1.0.0 docker images 查看下载内容 修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉&nbsp; 所有节点都提前改一下，不然进入cli 指令错误 20、运行fabric网络&nbsp; &nbsp; peer节点暂时不运行 orderer运行获取bin cd examples/e2e_cli/ ./network_setup.sh up 错误：fatal error: unexpected signal during runtime execution ./network_setup.sh down docker rm -f $(docker ps -aq) 解决办法： 修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉 peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错 21、在fabric目录下 mkdir aberic all节点 22、上一步生成了bin 在fabric/release/linux-amd64/下&nbsp;&nbsp;orderer节点 ./network_setup.sh down 先停止服务 cp -r bin /opt/gopath/src/github.com/hyperledger/fabric/aberic 还需要configtx.yaml 和 crypto-config.yaml 这两个文件来自/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli cp configtx.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic cp crypto-config.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic 配置齐全了！ 22、准备有关文件&nbsp;orderer节点 准备启动&nbsp;&nbsp;aberic目录下 ./bin/cryptogen generate --config=./crypto-config.yaml 结果生成 org1.example.com org2.example.com crypto-config 目录也添加了 生成创世区块 export FABRIC_CFG_PATH=$PWD 在fabric/aberic目录下执行以上 echo&nbsp;$PWD 输出：/opt/gopath/src/github.com/hyperledger/fabric/aberic 23、执行创世区块生成&nbsp;orderer节点 在fabric/aberic目录下创建channel-artifacts目录 mkdir channel-artifacts 执行 ./bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block ./bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel ------- 查看ca的具体ID,写入peer节点的docker-peer01.yaml文件 /opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config/peerOrganizations/org1.example.com/ca 三、orderer服务器 1、准备docker-orderer.yaml脚本，上传 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-orderer.yaml root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic 2、启动orderer节点 docker-compose -f docker-orderer.yaml up -d 要关闭的话执行：docker-compose -f docker-orderer.yaml down 这里即使有错误也会显示成功，主要要docker ps来看 四、peer0.org1服务器 不需要启动网络产生bin 需要channel-artifacts文件夹和crypto-config文件夹，channel-artifacts文件夹包含了channel的相关信息，crypto-config文件夹包含了所有节点的公钥，私钥和证书信息。这两个文件夹我们只在orderer服务器上生成就行了，然后拷贝到其他机器上就可以了。 在aberic目录下 还需要chaincode copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic cd fabric/aberic scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./ scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./ 在本地开发的机器上执行 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer01.yaml root@47.52.202.124:/opt/gopath/src/github.com/hyperledger/fabric/aberic #上传之前docker-peer01.yaml 中要更换CA的具体ID 回到peer0.org1 fabric/aberic/ docker-compose -f docker-peer01.yaml up -d #docker-compose -f docker-peer01.yaml down #docker rm `docker ps -a -q` 进入 cli of peer0 docker exec -it cli bash 3、尝试有关智能合约指令 创建mychannel peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx 4、加入channel peer channel join -b mychannel.block peer0加入网络，由于cli是默认指向peer0的，docker-peer.yaml文件说明 可以修改cli配置，使得指向其他的peer 5、安装智能合约 peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0 6、实例化chaincode peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;10&quot;,&quot;B&quot;,&quot;10&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.member&#39;)&quot; -v 1.0 7、查询 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39; Query Result: 10 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; 8、交易 peer chaincode invoke -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;A&quot;,&quot;B&quot;,&quot;8&quot;]}&#39; result: status:200&nbsp; &nbsp; 五、peer1.org1 1、修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉 peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错 2、从peer0.org1的cli中copy出mychannel.block文件，这个需要多次中转 3、在aberic目录下还需要chaincode、channel-artifacts crypto-config 和启动用的yaml脚本 （1）copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic （2）cd fabric/aberic scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./ scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./ （3）在本地开发的机器上执行 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer11.yaml root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic (4)启动 docker-compose -f docker-peer11.yaml up -d docker ps 5a4ff44f7a41 containerID of cli&nbsp; &nbsp;每次装系统都不一样，这个ID 会在后面copy mychannel.block文件中用到 (5) 获取mychannel.block （5.1）首先从peer0.org1的cli中将mychannel.block考出 退出 peer0.org1 cli&nbsp; (exit) 把peer0的cli中的mychannel.block copy出来到物理主机 docker cp&nbsp;46370c0ca94e:/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block&nbsp;/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/ （5.2）将该文件从peer0.org1发到peer1.org1 cd&nbsp;channel-artifacts&nbsp; (peer0.org1) scp -r mychannel.block root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/ (5.3)想办法把该文件从peer1.org1的主机copy到其上的cli中 另外从本地建1个ssh 到peer1.org1 cd channel-artifacts docker cp mychannel.block 5a4ff44f7a41:/opt/gopath/src/github.com/hyperledger/fabric/peer/ 4、测试智能合约 （1）加入peer channel join -b mychannel.block （2）安装智能合约 peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0 （3）查询账户 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; 18 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39;&nbsp; 2 （4）交易 peer chaincode invoke -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;A&quot;,&quot;B&quot;,&quot;1&quot;]}&#39; result: status:200 （5）交易后查询 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39;&nbsp; Query Result: 1 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; Query Result: 19 （6）这里的交易会使得peer0.org1查询的结果也发生变化 &nbsp; 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-01T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"一、环境配置 5台服务器全部是centos7.4 orderer 47.75.123.155 orderer.example.com orderer peer0.org1&nbsp;47.52.202.124&nbsp; &nbsp;1G内存 peer1.org1&nbsp;47.75.184.117 cli 启动后如果出错，很可能要重新安装 总结： 1、首先所有的服务器都要预先处理vim /etc/resolv.conf的问题，否则会有问题； 2、只有orderer服务器需要启动network_setup，获取bin文件夹，并且生成channel-artifacts crypto-config 两个文件夹 3、所有的服务器最好都copy一下chaincode文件夹 4、peer0运行cli后，有一个mychannel.block文件需要发送到其余的peer1，其中要进行多次copy，最终到其他peer的cli容器 5、peer的启动脚本docker-peer.yaml中有两处是org的CA编号，需要保持一致 二、服务器的初始化和安装有关软件 参考单机部署https://blog.csdn.net/frankxixu/article/details/81369411 的描述，完成环境搭建 0、vi ~/.ssh/known_hosts 解决连接问题 1、更新依赖源 sudo yum update 2、安装docker: sudo yum install -y yum-utils \\device-mapper-persistent-data \\lvm2 3、安装有关的依赖 sudo yum-config-manager \\--add-repo \\https://download.docker.com/linux/centos/docker-ce.repo 4、安装docker-ce sudo yum install docker-ce 检查安装结果 docker --version 5、启动&nbsp;service docker start 6、每次自动启动 chkconfig docker on 7、安装curl 命令 yum install curl 8、下载docker-compose，注意不是单引号 sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose cp /usr/local/bin/docker-compose /usr/bin 10、docker-compose version&nbsp; 如果提示权限不足，那么chmod +x /usr/local/bin/docker-compose 11、安装go curl -O https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz tar -C /usr/local -xzf go1.10.1.linux-amd64.tar.gz 解压缩到/usr/local目录 12、配置环境 vim /etc/profile export PATH=$PATH:/usr/local/go/bin export GOPATH=/opt/gopath source /etc/profile 13、查看go 安装信息 echo $PATH go version 14、安装git yum install git 15、创建安装目录 mkdir -p /opt/gopath/src/github.com/hyperledger 16、进入安装目录 cd /opt/gopath/src/github.com/hyperledger 17、拉取源代码 git clone https://github.com/hyperledger/fabric.git 18、切换到分支 cd fabric git checkout v1.0.0&nbsp; &nbsp;这两个有差异！应该这样而不是上面的 -b是新建分支的意思！ 19、拉取docker cd examples/e2e_cli/ chmod +x download-dockerimages.sh ./download-dockerimages.sh -c x86_64-1.0.0 -f x86_64-1.0.0 docker images 查看下载内容 修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉&nbsp; 所有节点都提前改一下，不然进入cli 指令错误 20、运行fabric网络&nbsp; &nbsp; peer节点暂时不运行 orderer运行获取bin cd examples/e2e_cli/ ./network_setup.sh up 错误：fatal error: unexpected signal during runtime execution ./network_setup.sh down docker rm -f $(docker ps -aq) 解决办法： 修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉 peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错 21、在fabric目录下 mkdir aberic all节点 22、上一步生成了bin 在fabric/release/linux-amd64/下&nbsp;&nbsp;orderer节点 ./network_setup.sh down 先停止服务 cp -r bin /opt/gopath/src/github.com/hyperledger/fabric/aberic 还需要configtx.yaml 和 crypto-config.yaml 这两个文件来自/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli cp configtx.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic cp crypto-config.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic 配置齐全了！ 22、准备有关文件&nbsp;orderer节点 准备启动&nbsp;&nbsp;aberic目录下 ./bin/cryptogen generate --config=./crypto-config.yaml 结果生成 org1.example.com org2.example.com crypto-config 目录也添加了 生成创世区块 export FABRIC_CFG_PATH=$PWD 在fabric/aberic目录下执行以上 echo&nbsp;$PWD 输出：/opt/gopath/src/github.com/hyperledger/fabric/aberic 23、执行创世区块生成&nbsp;orderer节点 在fabric/aberic目录下创建channel-artifacts目录 mkdir channel-artifacts 执行 ./bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block ./bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel ------- 查看ca的具体ID,写入peer节点的docker-peer01.yaml文件 /opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config/peerOrganizations/org1.example.com/ca 三、orderer服务器 1、准备docker-orderer.yaml脚本，上传 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-orderer.yaml root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic 2、启动orderer节点 docker-compose -f docker-orderer.yaml up -d 要关闭的话执行：docker-compose -f docker-orderer.yaml down 这里即使有错误也会显示成功，主要要docker ps来看 四、peer0.org1服务器 不需要启动网络产生bin 需要channel-artifacts文件夹和crypto-config文件夹，channel-artifacts文件夹包含了channel的相关信息，crypto-config文件夹包含了所有节点的公钥，私钥和证书信息。这两个文件夹我们只在orderer服务器上生成就行了，然后拷贝到其他机器上就可以了。 在aberic目录下 还需要chaincode copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic cd fabric/aberic scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./ scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./ 在本地开发的机器上执行 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer01.yaml root@47.52.202.124:/opt/gopath/src/github.com/hyperledger/fabric/aberic #上传之前docker-peer01.yaml 中要更换CA的具体ID 回到peer0.org1 fabric/aberic/ docker-compose -f docker-peer01.yaml up -d #docker-compose -f docker-peer01.yaml down #docker rm `docker ps -a -q` 进入 cli of peer0 docker exec -it cli bash 3、尝试有关智能合约指令 创建mychannel peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx 4、加入channel peer channel join -b mychannel.block peer0加入网络，由于cli是默认指向peer0的，docker-peer.yaml文件说明 可以修改cli配置，使得指向其他的peer 5、安装智能合约 peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0 6、实例化chaincode peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;10&quot;,&quot;B&quot;,&quot;10&quot;]}&#39; -P &quot;OR (&#39;Org1MSP.member&#39;)&quot; -v 1.0 7、查询 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39; Query Result: 10 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; 8、交易 peer chaincode invoke -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;A&quot;,&quot;B&quot;,&quot;8&quot;]}&#39; result: status:200&nbsp; &nbsp; 五、peer1.org1 1、修改vim /etc/resolv.conf&nbsp;配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉 peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错 2、从peer0.org1的cli中copy出mychannel.block文件，这个需要多次中转 3、在aberic目录下还需要chaincode、channel-artifacts crypto-config 和启动用的yaml脚本 （1）copy chaincode 在　fabric/examples cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic （2）cd fabric/aberic scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./ scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./ （3）在本地开发的机器上执行 scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer11.yaml root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic (4)启动 docker-compose -f docker-peer11.yaml up -d docker ps 5a4ff44f7a41 containerID of cli&nbsp; &nbsp;每次装系统都不一样，这个ID 会在后面copy mychannel.block文件中用到 (5) 获取mychannel.block （5.1）首先从peer0.org1的cli中将mychannel.block考出 退出 peer0.org1 cli&nbsp; (exit) 把peer0的cli中的mychannel.block copy出来到物理主机 docker cp&nbsp;46370c0ca94e:/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block&nbsp;/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/ （5.2）将该文件从peer0.org1发到peer1.org1 cd&nbsp;channel-artifacts&nbsp; (peer0.org1) scp -r mychannel.block root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/ (5.3)想办法把该文件从peer1.org1的主机copy到其上的cli中 另外从本地建1个ssh 到peer1.org1 cd channel-artifacts docker cp mychannel.block 5a4ff44f7a41:/opt/gopath/src/github.com/hyperledger/fabric/peer/ 4、测试智能合约 （1）加入peer channel join -b mychannel.block （2）安装智能合约 peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0 （3）查询账户 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; 18 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39;&nbsp; 2 （4）交易 peer chaincode invoke -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;A&quot;,&quot;B&quot;,&quot;1&quot;]}&#39; result: status:200 （5）交易后查询 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]}&#39;&nbsp; Query Result: 1 peer chaincode query -C mychannel -n mychannel -c &#39;{&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]}&#39; Query Result: 19 （6）这里的交易会使得peer0.org1查询的结果也发生变化 &nbsp; 阅读更多","@type":"BlogPosting","url":"/2018/08/01/2a0d50b7fecda5e66f63ef652f3d2f89.html","headline":"hyperledger多机部署","dateModified":"2018-08-01T00:00:00+08:00","datePublished":"2018-08-01T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/01/2a0d50b7fecda5e66f63ef652f3d2f89.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>hyperledger多机部署</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>一、环境配置</p> 
  <p>5台服务器全部是centos7.4</p> 
  <p>orderer 47.75.123.155 orderer.example.com orderer</p> 
  <p>peer0.org1&nbsp;47.52.202.124&nbsp; &nbsp;1G内存</p> 
  <p>peer1.org1&nbsp;47.75.184.117</p> 
  <p>cli 启动后如果出错，很可能要重新安装</p> 
  <p><span style="color:#3399ea;">总结：</span></p> 
  <p><span style="color:#3399ea;">1、首先所有的服务器都要预先处理vim /etc/resolv.conf的问题，否则会有问题；</span></p> 
  <p><span style="color:#3399ea;">2、只有orderer服务器需要启动network_setup，获取bin文件夹，并且生成channel-artifacts crypto-config 两个文件夹</span></p> 
  <p><span style="color:#3399ea;">3、所有的服务器最好都copy一下chaincode文件夹</span></p> 
  <p><span style="color:#3399ea;">4、peer0运行cli后，有一个mychannel.block文件需要发送到其余的peer1，其中要进行多次copy，最终到其他peer的cli容器</span></p> 
  <p><span style="color:#3399ea;">5、peer的启动脚本docker-peer.yaml中有两处是org的CA编号，需要保持一致</span></p> 
  <p>二、服务器的初始化和安装有关软件</p> 
  <p>参考单机部署<a href="https://blog.csdn.net/frankxixu/article/details/81369411" rel="nofollow">https://blog.csdn.net/frankxixu/article/details/81369411</a></p> 
  <p>的描述，完成环境搭建</p> 
  <p>0、vi ~/.ssh/known_hosts</p> 
  <p>解决连接问题</p> 
  <p>1、更新依赖源 sudo yum update</p> 
  <p>2、安装docker:</p> 
  <p>sudo yum install -y yum-utils \device-mapper-persistent-data \lvm2</p> 
  <p>3、安装有关的依赖</p> 
  <p>sudo yum-config-manager \--add-repo \https://download.docker.com/linux/centos/docker-ce.repo</p> 
  <p>4、安装docker-ce</p> 
  <p>sudo yum install docker-ce</p> 
  <p>检查安装结果</p> 
  <p>docker --version</p> 
  <p>5、启动&nbsp;service docker start</p> 
  <p>6、每次自动启动 chkconfig docker on</p> 
  <p>7、安装curl 命令 yum install curl</p> 
  <p>8、下载docker-compose，注意不是单引号</p> 
  <p>sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</p> 
  <p>cp /usr/local/bin/docker-compose /usr/bin</p> 
  <p>10、docker-compose version&nbsp; 如果提示权限不足，那么chmod +x /usr/local/bin/docker-compose</p> 
  <p>11、安装go</p> 
  <p>curl -O https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz</p> 
  <p>tar -C /usr/local -xzf go1.10.1.linux-amd64.tar.gz</p> 
  <p>解压缩到/usr/local目录</p> 
  <p>12、配置环境</p> 
  <p>vim /etc/profile</p> 
  <p>export PATH=$PATH:/usr/local/go/bin</p> 
  <p>export GOPATH=/opt/gopath</p> 
  <p>source /etc/profile</p> 
  <p>13、查看go 安装信息</p> 
  <p>echo $PATH</p> 
  <p>go version</p> 
  <p>14、安装git</p> 
  <p>yum install git</p> 
  <p>15、创建安装目录</p> 
  <p>mkdir -p /opt/gopath/src/github.com/hyperledger</p> 
  <p>16、进入安装目录</p> 
  <p>cd /opt/gopath/src/github.com/hyperledger</p> 
  <p>17、拉取源代码</p> 
  <p>git clone https://github.com/hyperledger/fabric.git</p> 
  <p>18、切换到分支</p> 
  <p>cd fabric</p> 
  <p><strong>git checkout v1.0.0&nbsp; &nbsp;这两个有差异！应该这样而不是上面的 -b是新建分支的意思！</strong></p> 
  <p>19、拉取docker</p> 
  <p><strong>cd examples/e2e_cli/</strong></p> 
  <p>chmod +x download-dockerimages.sh</p> 
  <p>./download-dockerimages.sh -c x86_64-1.0.0 -f x86_64-1.0.0</p> 
  <p><strong>docker images 查看下载内容</strong></p> 
  <p><span style="color:#f33b45;"><strong>修改</strong>vim /etc/resolv.conf&nbsp;<strong>配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉&nbsp;</strong></span></p> 
  <p><span style="color:#f33b45;"><strong>所有节点都提前改一下，不然进入cli 指令错误</strong></span></p> 
  <p><strong>20、运行fabric网络&nbsp; &nbsp;<span style="color:#f33b45;"> peer节点暂时不运行 orderer运行获取bin</span></strong></p> 
  <p><strong>cd examples/e2e_cli/</strong></p> 
  <p>./network_setup.sh up</p> 
  <p>错误：fatal error: unexpected signal during runtime execution</p> 
  <p><strong>./network_setup.sh down</strong></p> 
  <p>docker rm -f $(docker ps -aq)</p> 
  <p><strong>解决办法：</strong></p> 
  <p><span style="color:#f33b45;"><strong>修改</strong>vim /etc/resolv.conf&nbsp;<strong>配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉</strong></span></p> 
  <p><span style="color:#f33b45;"><strong>peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错</strong></span></p> 
  <p><strong>21、在fabric目录下 mkdir aberic </strong><strong><span style="color:#f33b45;">all节点</span></strong></p> 
  <p><strong>22、上一步生成了bin 在fabric/release/linux-amd64/下&nbsp;&nbsp;<span style="color:#f33b45;">orderer节点</span></strong></p> 
  <p><strong>./network_setup.sh down 先停止服务</strong></p> 
  <p>cp -r bin /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>还需要configtx.yaml 和 crypto-config.yaml</p> 
  <p>这两个文件来自/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli</p> 
  <p>cp configtx.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>cp crypto-config.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>copy chaincode 在　fabric/examples</p> 
  <p>cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>配置齐全了！</p> 
  <p>22、准备有关文件&nbsp;<strong><span style="color:#f33b45;">orderer节点</span></strong></p> 
  <p>准备启动&nbsp;&nbsp;aberic目录下</p> 
  <p>./bin/cryptogen generate --config=./crypto-config.yaml</p> 
  <p>结果生成</p> 
  <p>org1.example.com</p> 
  <p>org2.example.com</p> 
  <p>crypto-config 目录也添加了</p> 
  <p>生成创世区块</p> 
  <p>export FABRIC_CFG_PATH=$PWD</p> 
  <p>在fabric/aberic目录下执行以上</p> 
  <p>echo&nbsp;$PWD</p> 
  <p>输出：/opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>23、执行创世区块生成&nbsp;<strong><span style="color:#f33b45;">orderer节点</span></strong></p> 
  <p>在fabric/aberic目录下创建channel-artifacts目录</p> 
  <p>mkdir channel-artifacts</p> 
  <p>执行</p> 
  <p>./bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</p> 
  <p>./bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel</p> 
  <p>-------</p> 
  <p><span style="color:#f33b45;">查看ca的具体ID,写入peer节点的docker-peer01.yaml文件</span></p> 
  <p><span style="color:#f33b45;">/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config/peerOrganizations/org1.example.com/ca</span></p> 
  <p><span style="color:#ffbb66;">三、orderer服务器</span></p> 
  <p><span style="color:#ffbb66;">1、准备docker-orderer.yaml脚本，上传</span></p> 
  <p>scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-orderer.yaml root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>2、启动orderer节点</p> 
  <p>docker-compose -f docker-orderer.yaml up -d</p> 
  <p>要关闭的话执行：docker-compose -f docker-orderer.yaml down</p> 
  <p>这里即使有错误也会显示成功，主要要docker ps来看</p> 
  <p><span style="color:#ffbb66;">四、peer0.org1服务器</span></p> 
  <p><span style="color:#ffbb66;">不需要启动网络产生bin</span></p> 
  <p><span style="color:#ffbb66;">需要channel-artifacts文件夹和crypto-config文件夹，channel-artifacts文件夹包含了channel的相关信息，crypto-config文件夹包含了所有节点的公钥，私钥和证书信息。这两个文件夹我们只在orderer服务器上生成就行了，然后拷贝到其他机器上就可以了。</span></p> 
  <p>在aberic目录下</p> 
  <p>还需要chaincode</p> 
  <p>copy chaincode 在　fabric/examples</p> 
  <p>cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>cd fabric/aberic</p> 
  <p>scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./</p> 
  <p>scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./</p> 
  <p>在本地开发的机器上执行</p> 
  <p>scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer01.yaml root@47.52.202.124:/opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>#上传之前docker-peer01.yaml 中要更换CA的具体ID</p> 
  <p>回到peer0.org1 fabric/aberic/</p> 
  <p>docker-compose -f docker-peer01.yaml up -d</p> 
  <p>#docker-compose -f docker-peer01.yaml down</p> 
  <p>#docker rm `docker ps -a -q`</p> 
  <p>进入 cli of peer0</p> 
  <p>docker exec -it cli bash</p> 
  <p>3、尝试有关智能合约指令</p> 
  <p>创建mychannel</p> 
  <p>peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx</p> 
  <p>4、加入channel</p> 
  <pre class="has">
<code>peer channel join -b mychannel.block</code></pre> 
  <p>peer0加入网络，由于cli是默认指向peer0的，docker-peer.yaml文件说明</p> 
  <p>可以修改cli配置，使得指向其他的peer</p> 
  <p>5、安装智能合约</p> 
  <p>peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0</p> 
  <p>6、实例化chaincode</p> 
  <p>peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n mychannel -c '{"Args":["init","A","10","B","10"]}' -P "OR ('Org1MSP.member')" -v 1.0</p> 
  <p>7、查询</p> 
  <p>peer chaincode query -C mychannel -n mychannel -c '{"Args":["query","A"]}'</p> 
  <p>Query Result: 10</p> 
  <p>peer chaincode query -C mychannel -n mychannel -c '{"Args":["query","B"]}'</p> 
  <p>8、交易</p> 
  <p>peer chaincode invoke -C mychannel -n mychannel -c '{"Args":["invoke","A","B","8"]}'</p> 
  <p>result: status:200&nbsp;</p> 
  <p>&nbsp;</p> 
  <p><span style="color:#ffbb66;">五、peer1.org1</span></p> 
  <p><span style="color:#f33b45;"><strong>1、修改</strong>vim /etc/resolv.conf&nbsp;<strong>配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉</strong></span></p> 
  <p><span style="color:#f33b45;"><strong>peer也需要修改，虽然不需要启动测试网络，但是不修改的话，进入cli,执行peer指令报错</strong></span></p> 
  <p><span style="color:#f33b45;"><strong>2、从peer0.org1的cli中copy出</strong></span>mychannel.block文件，这个需要多次中转</p> 
  <p>3、在aberic目录下还需要chaincode、channel-artifacts crypto-config 和启动用的yaml脚本</p> 
  <p>（1）copy chaincode 在　fabric/examples</p> 
  <p>cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>（2）cd fabric/aberic</p> 
  <p>scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts ./</p> 
  <p>scp -r root@47.75.123.155:/opt/gopath/src/github.com/hyperledger/fabric/aberic/crypto-config ./</p> 
  <p>（3）在本地开发的机器上执行</p> 
  <p>scp -r /Users/developer/Desktop/git/Hyperledger_singleServer/multiple/docker-peer11.yaml root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>(4)启动</p> 
  <p>docker-compose -f docker-peer11.yaml up -d</p> 
  <p>docker ps</p> 
  <p><span style="color:#f33b45;">5a4ff44f7a41</span> containerID of cli&nbsp; &nbsp;每次装系统都不一样<span style="color:#f33b45;">，这个ID 会在后面copy mychannel.block文件中用到</span></p> 
  <p>(5) 获取mychannel.block</p> 
  <p>（5.1）首先从peer0.org1的cli中将mychannel.block考出</p> 
  <p>退出 peer0.org1 cli&nbsp; (exit)</p> 
  <p>把peer0的cli中的mychannel.block copy出来到物理主机</p> 
  <p>docker cp&nbsp;<span style="color:#f33b45;">46370c0ca94e:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block&nbsp;/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/</p> 
  <p>（5.2）将该文件从peer0.org1发到peer1.org1</p> 
  <p>cd&nbsp;channel-artifacts&nbsp; (peer0.org1)</p> 
  <p>scp -r mychannel.block root@47.75.184.117:/opt/gopath/src/github.com/hyperledger/fabric/aberic/channel-artifacts/</p> 
  <p>(5.3)想办法把该文件从peer1.org1的主机copy到其上的cli中</p> 
  <p>另外从本地建1个ssh 到peer1.org1</p> 
  <p>cd channel-artifacts</p> 
  <p>docker cp mychannel.block 5a4ff44f7a41:/opt/gopath/src/github.com/hyperledger/fabric/peer/</p> 
  <p>4、测试智能合约</p> 
  <p>（1）加入peer channel join -b mychannel.block</p> 
  <p>（2）安装智能合约</p> 
  <p>peer chaincode install -n mychannel -p github.com/hyperledger/fabric/aberic/chaincode/go/chaincode_example02 -v 1.0</p> 
  <p>（3）查询账户</p> 
  <p>peer chaincode query -C mychannel -n mychannel -c '{"Args":["query","B"]}'</p> 
  <p>18</p> 
  <p>peer chaincode query -C mychannel -n mychannel -c '{"Args":["query","A"]}'&nbsp;</p> 
  <p>2</p> 
  <p>（4）交易</p> 
  <p>peer chaincode invoke -C mychannel -n mychannel -c '{"Args":["invoke","A","B","1"]}'</p> 
  <p>result: status:200</p> 
  <p>（5）交易后查询</p> 
  <p>peer chaincode query -C mychannel -n mychannel -c '{"Args":["query","A"]}'&nbsp;</p> 
  <p>Query Result: 1</p> 
  <p>peer chaincode query -C mychannel -n mychannel -c '{"Args":["query","B"]}'</p> 
  <p>Query Result: 19</p> 
  <p>（6）这里的交易会使得peer0.org1查询的结果也发生变化</p> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/frankxixu/article/details/81348874,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/frankxixu/article/details/81348874,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Fabric 环境搭建时bootstrap.sh帮我们做了什么？ | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Fabric 环境搭建时bootstrap.sh帮我们做了什么？" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="00 导言 &nbsp; &nbsp; &nbsp;&nbsp;在上一讲中，我们手把手带着大家一步一步《在Ubuntu 18.04上搭建HyperLedger Fabric 1.2.0 环境》，其中有两个步骤是：下载bootstrap.sh引导脚本和执行该引导脚本。很多朋友执行这两个步骤时可能会有疑问：为什么要下载这个脚本？执行这个脚本的作用是什么？ &nbsp; &nbsp; &nbsp;&nbsp;别急，接下来我们会深入分析一下这个文件的源码，探个究竟。不过在分析之前，我们先来回顾一下上一讲是怎么下载和执行这个脚本的。 02 如何下载和执行bootstrap.sh脚本 &nbsp; &nbsp; &nbsp;&nbsp;我们先来看看官方是怎么说的。官方提供的命令如下： $ curl -sSL http://bit.ly/2ysbOFE | bash -s 1.2.0 1.2.0 0.4.10 &nbsp; &nbsp; &nbsp;&nbsp;我们来解释一下这条命令:curl -sSL http://bit.ly/2ysbOFE，这条命令是通过请求短链接http://bit.ly/2ysbOFE，该短链接会重定向到真正的目标地址，目标地址会响应我们要的内容，响应的内容就是bootstrap.sh文件里的内容。很不幸的是，上面的短链接已经失效，不过我们已经找到了一个有效的长链接：https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh，用它替换掉短链接就可以了。于是我们得到了下面的命令： $ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh | bash -s 1.2.0 1.2.0 0.4.10 &nbsp; &nbsp; &nbsp;&nbsp;这里要解释一下-sSL的作用，小s指的是沉默模式，表示不输出请求过程的任何信息，只输出最终响应的内容，大S指的是如果有错显示出来，L指的是短链接要进行重定向。 &nbsp; &nbsp; &nbsp;&nbsp;接下来是一根竖线 |，学过linux的朋友应该都知道，这根竖线表示管道，意思是上一个命令输出的内容，交给下一个命令去执行，这里表示交给bash去执行。 &nbsp; &nbsp; &nbsp;&nbsp;bash 后面是-s ，-s后面的所有内容将做为参数传给bootstrap.sh。1.2.0 1.2.0 0.4.10这3个对应的是 Fabric, Fabric-ca 和 thirdparty(couchdb, kafka and zookeeper) 这三个模块的版本。如果我们想要安装更早的版本，我们可以修改它们，脚本程序会知道下载对应的版本。 &nbsp; &nbsp; &nbsp;&nbsp;上面实际上是两条命令通过管道( | )连接在一起执行，实际上我们也可以将它们分开： $ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh -o bootstrap.sh $ chmod 755 bootstrap.sh $ sudo ./bootstrap.sh 1.2.0 1.2.0 0.4.10 03 bootstrap.sh到底帮我们做了什么？ &nbsp; &nbsp; &nbsp;&nbsp;bootstrap.sh实际上帮我们作了如下几件事情： &nbsp; &nbsp; &nbsp;&nbsp;1. 从github上克隆 hyperledger/fabric-samples并进入该目录，然后检出适当的版本 &nbsp; &nbsp; &nbsp;&nbsp;2. 在fabric-samples目录下安装特定平台的 Hyperledger Fabric 二进制可执行文件 和配置文件 &nbsp; &nbsp; &nbsp;&nbsp;3.下载 指定版本的Hyperledger Fabric 的docker镜像 &nbsp; &nbsp; &nbsp;&nbsp; 整个脚本帮我们做了上面这三件事情，bootstrap.sh中对应的代码如下： 218 if [ &quot;$SAMPLES&quot; == &quot;true&quot; ]; then 219 echo 220 echo &quot;Installing hyperledger/fabric-samples repo&quot; 221 echo 222 samplesInstall 223 fi 224 if [ &quot;$BINARIES&quot; == &quot;true&quot; ]; then 225 echo 226 echo &quot;Installing Hyperledger Fabric binaries&quot; 227 echo 228 binariesInstall 229 fi 230 if [ &quot;$DOCKER&quot; == &quot;true&quot; ]; then 231 echo 232 echo &quot;Installing Hyperledger Fabric docker images&quot; 233 echo 234 dockerInstall 235 fi &nbsp; &nbsp; &nbsp;&nbsp;其中samplesInstall对应的是克隆fabric-samples，binariesInstall对应的是安装二进制文件，dockerInstall对应的是下载docker镜像。 接下来我们分析一下它们对应的代码部分。 04 第一件事：克隆fabric-samples并检出适当的版本 &nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的samplesInstall函数，代码如下： 56 samplesInstall() { 57 # clone (if needed) hyperledger/fabric-samples and checkout corresponding 58 # version to the binaries and docker images to be downloaded 59 if [ -d first-network ]; then 60 # if we are in the fabric-samples repo, checkout corresponding version 61 echo &quot;===&gt; Checking out v${VERSION} branch of hyperledger/fabric-samples&quot; 62 git checkout v${VERSION} 63 elif [ -d fabric-samples ]; then 64 # if fabric-samples repo already cloned and in current directory, 65 # cd fabric-samples and checkout corresponding version 66 echo &quot;===&gt; Checking out v${VERSION} branch of hyperledger/fabric-samples&quot; 67 cd fabric-samples &amp;&amp; git checkout v${VERSION} 68 else 69 echo &quot;===&gt; Cloning hyperledger/fabric-samples repo and checkout v${VERSION}&quot; 70 git clone -b master https://github.com/hyperledger/fabric-samples.git &amp;&amp; cd fabric-samples &amp;&amp; git checkout v${VERSION} 71 fi 72 } &nbsp; &nbsp; &nbsp;&nbsp;我们可以看到第70行代码，这行代码的作用就是 从github上克隆 hyperledger/fabric-samples，然后进入该目录，并检出指定的版本。 &nbsp; &nbsp; &nbsp;&nbsp;该仓库的地址是： https://github.com/hyperledger/fabric-samples.git 05 第二件事：安装二进制可执行文件 和配置文件 &nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的binariesInstall函数，代码如下： 133 binariesInstall() { 134 echo &quot;===&gt; Downloading version ${FABRIC_TAG} platform specific fabric binaries&quot; 135 binaryDownload ${BINARY_FILE} https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/${ARCH}-${VERSION}/${BINARY_FILE} 136 if [ $? -eq 22 ]; then 137 echo 138 echo &quot;------&gt; ${FABRIC_TAG} platform specific fabric binary is not available to download &lt;----&quot; 139 echo 140 fi 141 142 echo &quot;===&gt; Downloading version ${CA_TAG} platform specific fabric-ca-client binary&quot; 143 binaryDownload ${CA_BINARY_FILE} https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/${ARCH}-${CA_VERSION}/${CA_BINARY_FILE} 144 if [ $? -eq 22 ]; then 145 echo 146 echo &quot;------&gt; ${CA_TAG} fabric-ca-client binary is not available to download (Available from 1.1.0-rc1) &lt;----&quot; 147 echo 148 fi 149 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第135行和第143行分别调用binaryDownload函数去下面这两个地址下载fabric和fabric-ca相应的二进制文件打成的压缩包。实际上我们也可以使用浏览器或者下载软件单独下载它们。 1.https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz 2.https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/linux-amd64-1.2.0/hyperledger-fabric-ca-linux-amd64-1.2.0.tar.gz &nbsp; &nbsp; &nbsp;&nbsp;我们接下来看看binaryDownload函数： 113 binaryDownload() { 114 local BINARY_FILE=$1 115 local URL=$2 116 echo &quot;===&gt; Downloading: &quot; ${URL} 117 # Check if a previous failure occurred and the file was partially downloaded 118 if [ -e ${BINARY_FILE} ]; then 119 echo &quot;==&gt; Partial binary file found. Resuming download...&quot; 120 binaryIncrementalDownload ${BINARY_FILE} ${URL} 121 else 122 curl ${URL} | tar xz || rc=$? 123 if [ ! -z &quot;$rc&quot; ]; then 124 echo &quot;==&gt; There was an error downloading the binary file. Switching to incremental download.&quot; 125 echo &quot;==&gt; Downloading file...&quot; 126 binaryIncrementalDownload ${BINARY_FILE} ${URL} 127 else 128 echo &quot;==&gt; Done.&quot; 129 fi 130 fi 131 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第122行，执行curl命令去下载tar包,并用tar命令解压。解压后的命令出现在bin目录下。实际上，这些二进制命令我们也可以通过编译hyperledger fabric的源码生成！后面我们有文章会讲到怎么编译源码去生成这些二进制文件。 -rwxrwxr-x 1 1001 1001 16784432 7月 4 03:04 configtxgen* -rwxrwxr-x 1 1001 1001 17925784 7月 4 03:04 configtxlator* -rwxrwxr-x 1 1001 1001 8660280 7月 4 03:04 cryptogen* -rwxrwxr-x 1 1001 1001 17611704 7月 4 03:04 discover* -rwxrwxr-x 1 1001 1001 14298688 7月 4 04:41 fabric-ca-client* -rwxrwxr-x 1 1001 1001 817 7月 4 03:04 get-docker-images.sh* -rwxrwxr-x 1 1001 1001 7152824 7月 4 03:04 idemixgen* -rwxrwxr-x 1 1001 1001 22075240 7月 4 03:04 orderer* -rwxrwxr-x 1 1001 1001 29880000 7月 4 03:04 peer* &nbsp; &nbsp; &nbsp;&nbsp;我们解释一下其中这些命令的作用： 名称 作用 peer 负责启动节点，存储区块链数据，运行维护链码 order 负责启动排序节点，对交易进行排序，并将排序好的交易打包成模块 cryptogen 生成组织结构和身份文件 configtxgen 生成配置区块和配置交易 configtxlator 解读配置信息 06 第三件事：下载docker镜像 &nbsp; &nbsp; &nbsp;&nbsp;对应bootstrap.sh中的dockerInstall函数，代码如下： 151 dockerInstall() { 152 which docker &gt;&amp; /dev/null 153 NODOCKER=$? 154 if [ &quot;${NODOCKER}&quot; == 0 ]; then 155 echo &quot;===&gt; Pulling fabric Images&quot; 156 dockerFabricPull ${FABRIC_TAG} 157 echo &quot;===&gt; Pulling fabric ca Image&quot; 158 dockerCaPull ${CA_TAG} 159 echo &quot;===&gt; Pulling thirdparty docker images&quot; 160 dockerThirdPartyImagesPull ${THIRDPARTY_TAG} 161 echo 162 echo &quot;===&gt; List out hyperledger docker images&quot; 163 docker images | grep hyperledger* 164 else 165 echo &quot;=========================================================&quot; 166 echo &quot;Docker not installed, bypassing download of Fabric images&quot; 167 echo &quot;=========================================================&quot; 168 fi 169 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第156行，第158行，第160行，分别调用了dockerFabricPull 、dockerCaPull 、dockerThirdPartyImagesPull 三个函数去拉取相应的docker镜像并打标签。最后下载完还执行docker images | grep hyperledger*(第163行)查看是否已下载好下面所列的镜像。 hyperledger/fabric-ca 1.2.0 66cc132bd09c 4 weeks ago 252MB hyperledger/fabric-tools 1.2.0 379602873003 4 weeks ago 1.51GB hyperledger/fabric-ccenv 1.2.0 6acf31e2d9a4 4 weeks ago 1.43GB hyperledger/fabric-orderer 1.2.0 4baf7789a8ec 4 weeks ago 152MB hyperledger/fabric-peer 1.2.0 82c262e65984 4 weeks ago 159MB hyperledger/fabric-zookeeper 0.4.10 2b51158f3898 4 weeks ago 1.44GB hyperledger/fabric-kafka 0.4.10 936aef6db0e6 4 weeks ago 1.45GB hyperledger/fabric-couchdb 0.4.10 3092eca241fc 4 weeks ago 1.61GB hyperledger/fabric-baseos amd64-0.4.10 52190e831002 4 weeks ago 132MB hyperledger/fabric-ca x86_64-1.0.4 8e691b3509bf 9 months ago 238MB hyperledger/fabric-javaenv x86_64-1.0.4 a517b70135c7 9 months ago 1.41GB &nbsp; &nbsp; &nbsp;&nbsp;dockerFabricPull函数代码如下： 28 dockerFabricPull() { 29 local FABRIC_TAG=$1 30 for IMAGES in peer orderer ccenv tools; do 31 echo &quot;==&gt; FABRIC IMAGE: $IMAGES&quot; 32 echo 33 docker pull hyperledger/fabric-$IMAGES:$FABRIC_TAG 34 docker tag hyperledger/fabric-$IMAGES:$FABRIC_TAG hyperledger/fabric-$IMAGES 35 done 36 } &nbsp; &nbsp; &nbsp;&nbsp;dockerCaPull 函数代码如下： 48 dockerCaPull() { 49 local CA_TAG=$1 50 echo &quot;==&gt; FABRIC CA IMAGE&quot; 51 echo 52 docker pull hyperledger/fabric-ca:$CA_TAG 53 docker tag hyperledger/fabric-ca:$CA_TAG hyperledger/fabric-ca 54 } &nbsp; &nbsp; &nbsp;&nbsp;dockerThirdPartyImagesPull 函数代码如下： 38 dockerThirdPartyImagesPull() { 39 local THIRDPARTY_TAG=$1 40 for IMAGES in couchdb kafka zookeeper; do 41 echo &quot;==&gt; THIRDPARTY DOCKER IMAGE: $IMAGES&quot; 42 echo 43 docker pull hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG 44 docker tag hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG hyperledger/fabric-$IMAGES 45 done 46 } &nbsp; &nbsp; &nbsp;&nbsp;上面dockerThirdPartyImagesPull 函数内部使用了一个for循环（第40行）挨个去下载couchdb、kafka、zookeeper三个镜像。 &nbsp; &nbsp; &nbsp;&nbsp;部分镜像说明如下： 镜像名称 是否可选 镜像说明 hyperledger/fabric-tools 可选 包含crytogen、configtxgen、configtxlator我第二次工具的镜像文件 hyperledger/fabric-couchdb 可选 CouchDB的数据库镜像文件、状态数据库选择CouchDB的时候才需要 hyperledger/fabric-kafka 可选 Kafka的镜像文件 hyperledger/fabric-zookeeper 可选 Zookeeper的镜像文件 hyperledger/fabric-peer 必选 Peer节点的镜像文件 hyperledger/fabric-orderer 必选 排序服务节点的镜像文件 hyperledger/fabric-javaenv 可选 java链码的基础镜像文件 hyperledger/fabric-ccenv 必选 Golang链码的基础镜像文件 hyperledger/fabric-ca 可选 fabric-ca的镜像文件，用到fabric-ca的时候才需要 07 总结 &nbsp; &nbsp; &nbsp;&nbsp;通过上面的介绍，相信大家已经了解了bootstrap.sh的作用了。读者可能会纳闷了，为啥要花这么大篇幅来介绍这个脚本文件？？吃饱了撑的吗。这是因为我们通过分析这个文件，知道了具体内部干了什么，知其然也要知其所以然嘛。这样，我们也可以不需要这个脚本文件，手动就能把环境搭建好！！ 08 参考资料 1.https://hyperledger-fabric.readthedocs.io/en/release-1.2/install.html 2.《深度探索区块链：Hyperledger技术与应用》作者: 张增骏 / 董宁 / 朱轩彤 / 陈剑雄 出版社: 机械工业出版社 3. 《区块链开发实战 Hyperledger Fabric关键技术与案例分析》作者： 冯翔 刘涛 吴寿鹤 周广益 出版社：机械工业出版社 4. 《HyperLedger Fabric开发实战快速掌握区块链技术》作者：杨毅 出版社： 电子工业出版社 阅读更多" />
<meta property="og:description" content="00 导言 &nbsp; &nbsp; &nbsp;&nbsp;在上一讲中，我们手把手带着大家一步一步《在Ubuntu 18.04上搭建HyperLedger Fabric 1.2.0 环境》，其中有两个步骤是：下载bootstrap.sh引导脚本和执行该引导脚本。很多朋友执行这两个步骤时可能会有疑问：为什么要下载这个脚本？执行这个脚本的作用是什么？ &nbsp; &nbsp; &nbsp;&nbsp;别急，接下来我们会深入分析一下这个文件的源码，探个究竟。不过在分析之前，我们先来回顾一下上一讲是怎么下载和执行这个脚本的。 02 如何下载和执行bootstrap.sh脚本 &nbsp; &nbsp; &nbsp;&nbsp;我们先来看看官方是怎么说的。官方提供的命令如下： $ curl -sSL http://bit.ly/2ysbOFE | bash -s 1.2.0 1.2.0 0.4.10 &nbsp; &nbsp; &nbsp;&nbsp;我们来解释一下这条命令:curl -sSL http://bit.ly/2ysbOFE，这条命令是通过请求短链接http://bit.ly/2ysbOFE，该短链接会重定向到真正的目标地址，目标地址会响应我们要的内容，响应的内容就是bootstrap.sh文件里的内容。很不幸的是，上面的短链接已经失效，不过我们已经找到了一个有效的长链接：https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh，用它替换掉短链接就可以了。于是我们得到了下面的命令： $ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh | bash -s 1.2.0 1.2.0 0.4.10 &nbsp; &nbsp; &nbsp;&nbsp;这里要解释一下-sSL的作用，小s指的是沉默模式，表示不输出请求过程的任何信息，只输出最终响应的内容，大S指的是如果有错显示出来，L指的是短链接要进行重定向。 &nbsp; &nbsp; &nbsp;&nbsp;接下来是一根竖线 |，学过linux的朋友应该都知道，这根竖线表示管道，意思是上一个命令输出的内容，交给下一个命令去执行，这里表示交给bash去执行。 &nbsp; &nbsp; &nbsp;&nbsp;bash 后面是-s ，-s后面的所有内容将做为参数传给bootstrap.sh。1.2.0 1.2.0 0.4.10这3个对应的是 Fabric, Fabric-ca 和 thirdparty(couchdb, kafka and zookeeper) 这三个模块的版本。如果我们想要安装更早的版本，我们可以修改它们，脚本程序会知道下载对应的版本。 &nbsp; &nbsp; &nbsp;&nbsp;上面实际上是两条命令通过管道( | )连接在一起执行，实际上我们也可以将它们分开： $ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh -o bootstrap.sh $ chmod 755 bootstrap.sh $ sudo ./bootstrap.sh 1.2.0 1.2.0 0.4.10 03 bootstrap.sh到底帮我们做了什么？ &nbsp; &nbsp; &nbsp;&nbsp;bootstrap.sh实际上帮我们作了如下几件事情： &nbsp; &nbsp; &nbsp;&nbsp;1. 从github上克隆 hyperledger/fabric-samples并进入该目录，然后检出适当的版本 &nbsp; &nbsp; &nbsp;&nbsp;2. 在fabric-samples目录下安装特定平台的 Hyperledger Fabric 二进制可执行文件 和配置文件 &nbsp; &nbsp; &nbsp;&nbsp;3.下载 指定版本的Hyperledger Fabric 的docker镜像 &nbsp; &nbsp; &nbsp;&nbsp; 整个脚本帮我们做了上面这三件事情，bootstrap.sh中对应的代码如下： 218 if [ &quot;$SAMPLES&quot; == &quot;true&quot; ]; then 219 echo 220 echo &quot;Installing hyperledger/fabric-samples repo&quot; 221 echo 222 samplesInstall 223 fi 224 if [ &quot;$BINARIES&quot; == &quot;true&quot; ]; then 225 echo 226 echo &quot;Installing Hyperledger Fabric binaries&quot; 227 echo 228 binariesInstall 229 fi 230 if [ &quot;$DOCKER&quot; == &quot;true&quot; ]; then 231 echo 232 echo &quot;Installing Hyperledger Fabric docker images&quot; 233 echo 234 dockerInstall 235 fi &nbsp; &nbsp; &nbsp;&nbsp;其中samplesInstall对应的是克隆fabric-samples，binariesInstall对应的是安装二进制文件，dockerInstall对应的是下载docker镜像。 接下来我们分析一下它们对应的代码部分。 04 第一件事：克隆fabric-samples并检出适当的版本 &nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的samplesInstall函数，代码如下： 56 samplesInstall() { 57 # clone (if needed) hyperledger/fabric-samples and checkout corresponding 58 # version to the binaries and docker images to be downloaded 59 if [ -d first-network ]; then 60 # if we are in the fabric-samples repo, checkout corresponding version 61 echo &quot;===&gt; Checking out v${VERSION} branch of hyperledger/fabric-samples&quot; 62 git checkout v${VERSION} 63 elif [ -d fabric-samples ]; then 64 # if fabric-samples repo already cloned and in current directory, 65 # cd fabric-samples and checkout corresponding version 66 echo &quot;===&gt; Checking out v${VERSION} branch of hyperledger/fabric-samples&quot; 67 cd fabric-samples &amp;&amp; git checkout v${VERSION} 68 else 69 echo &quot;===&gt; Cloning hyperledger/fabric-samples repo and checkout v${VERSION}&quot; 70 git clone -b master https://github.com/hyperledger/fabric-samples.git &amp;&amp; cd fabric-samples &amp;&amp; git checkout v${VERSION} 71 fi 72 } &nbsp; &nbsp; &nbsp;&nbsp;我们可以看到第70行代码，这行代码的作用就是 从github上克隆 hyperledger/fabric-samples，然后进入该目录，并检出指定的版本。 &nbsp; &nbsp; &nbsp;&nbsp;该仓库的地址是： https://github.com/hyperledger/fabric-samples.git 05 第二件事：安装二进制可执行文件 和配置文件 &nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的binariesInstall函数，代码如下： 133 binariesInstall() { 134 echo &quot;===&gt; Downloading version ${FABRIC_TAG} platform specific fabric binaries&quot; 135 binaryDownload ${BINARY_FILE} https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/${ARCH}-${VERSION}/${BINARY_FILE} 136 if [ $? -eq 22 ]; then 137 echo 138 echo &quot;------&gt; ${FABRIC_TAG} platform specific fabric binary is not available to download &lt;----&quot; 139 echo 140 fi 141 142 echo &quot;===&gt; Downloading version ${CA_TAG} platform specific fabric-ca-client binary&quot; 143 binaryDownload ${CA_BINARY_FILE} https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/${ARCH}-${CA_VERSION}/${CA_BINARY_FILE} 144 if [ $? -eq 22 ]; then 145 echo 146 echo &quot;------&gt; ${CA_TAG} fabric-ca-client binary is not available to download (Available from 1.1.0-rc1) &lt;----&quot; 147 echo 148 fi 149 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第135行和第143行分别调用binaryDownload函数去下面这两个地址下载fabric和fabric-ca相应的二进制文件打成的压缩包。实际上我们也可以使用浏览器或者下载软件单独下载它们。 1.https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz 2.https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/linux-amd64-1.2.0/hyperledger-fabric-ca-linux-amd64-1.2.0.tar.gz &nbsp; &nbsp; &nbsp;&nbsp;我们接下来看看binaryDownload函数： 113 binaryDownload() { 114 local BINARY_FILE=$1 115 local URL=$2 116 echo &quot;===&gt; Downloading: &quot; ${URL} 117 # Check if a previous failure occurred and the file was partially downloaded 118 if [ -e ${BINARY_FILE} ]; then 119 echo &quot;==&gt; Partial binary file found. Resuming download...&quot; 120 binaryIncrementalDownload ${BINARY_FILE} ${URL} 121 else 122 curl ${URL} | tar xz || rc=$? 123 if [ ! -z &quot;$rc&quot; ]; then 124 echo &quot;==&gt; There was an error downloading the binary file. Switching to incremental download.&quot; 125 echo &quot;==&gt; Downloading file...&quot; 126 binaryIncrementalDownload ${BINARY_FILE} ${URL} 127 else 128 echo &quot;==&gt; Done.&quot; 129 fi 130 fi 131 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第122行，执行curl命令去下载tar包,并用tar命令解压。解压后的命令出现在bin目录下。实际上，这些二进制命令我们也可以通过编译hyperledger fabric的源码生成！后面我们有文章会讲到怎么编译源码去生成这些二进制文件。 -rwxrwxr-x 1 1001 1001 16784432 7月 4 03:04 configtxgen* -rwxrwxr-x 1 1001 1001 17925784 7月 4 03:04 configtxlator* -rwxrwxr-x 1 1001 1001 8660280 7月 4 03:04 cryptogen* -rwxrwxr-x 1 1001 1001 17611704 7月 4 03:04 discover* -rwxrwxr-x 1 1001 1001 14298688 7月 4 04:41 fabric-ca-client* -rwxrwxr-x 1 1001 1001 817 7月 4 03:04 get-docker-images.sh* -rwxrwxr-x 1 1001 1001 7152824 7月 4 03:04 idemixgen* -rwxrwxr-x 1 1001 1001 22075240 7月 4 03:04 orderer* -rwxrwxr-x 1 1001 1001 29880000 7月 4 03:04 peer* &nbsp; &nbsp; &nbsp;&nbsp;我们解释一下其中这些命令的作用： 名称 作用 peer 负责启动节点，存储区块链数据，运行维护链码 order 负责启动排序节点，对交易进行排序，并将排序好的交易打包成模块 cryptogen 生成组织结构和身份文件 configtxgen 生成配置区块和配置交易 configtxlator 解读配置信息 06 第三件事：下载docker镜像 &nbsp; &nbsp; &nbsp;&nbsp;对应bootstrap.sh中的dockerInstall函数，代码如下： 151 dockerInstall() { 152 which docker &gt;&amp; /dev/null 153 NODOCKER=$? 154 if [ &quot;${NODOCKER}&quot; == 0 ]; then 155 echo &quot;===&gt; Pulling fabric Images&quot; 156 dockerFabricPull ${FABRIC_TAG} 157 echo &quot;===&gt; Pulling fabric ca Image&quot; 158 dockerCaPull ${CA_TAG} 159 echo &quot;===&gt; Pulling thirdparty docker images&quot; 160 dockerThirdPartyImagesPull ${THIRDPARTY_TAG} 161 echo 162 echo &quot;===&gt; List out hyperledger docker images&quot; 163 docker images | grep hyperledger* 164 else 165 echo &quot;=========================================================&quot; 166 echo &quot;Docker not installed, bypassing download of Fabric images&quot; 167 echo &quot;=========================================================&quot; 168 fi 169 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第156行，第158行，第160行，分别调用了dockerFabricPull 、dockerCaPull 、dockerThirdPartyImagesPull 三个函数去拉取相应的docker镜像并打标签。最后下载完还执行docker images | grep hyperledger*(第163行)查看是否已下载好下面所列的镜像。 hyperledger/fabric-ca 1.2.0 66cc132bd09c 4 weeks ago 252MB hyperledger/fabric-tools 1.2.0 379602873003 4 weeks ago 1.51GB hyperledger/fabric-ccenv 1.2.0 6acf31e2d9a4 4 weeks ago 1.43GB hyperledger/fabric-orderer 1.2.0 4baf7789a8ec 4 weeks ago 152MB hyperledger/fabric-peer 1.2.0 82c262e65984 4 weeks ago 159MB hyperledger/fabric-zookeeper 0.4.10 2b51158f3898 4 weeks ago 1.44GB hyperledger/fabric-kafka 0.4.10 936aef6db0e6 4 weeks ago 1.45GB hyperledger/fabric-couchdb 0.4.10 3092eca241fc 4 weeks ago 1.61GB hyperledger/fabric-baseos amd64-0.4.10 52190e831002 4 weeks ago 132MB hyperledger/fabric-ca x86_64-1.0.4 8e691b3509bf 9 months ago 238MB hyperledger/fabric-javaenv x86_64-1.0.4 a517b70135c7 9 months ago 1.41GB &nbsp; &nbsp; &nbsp;&nbsp;dockerFabricPull函数代码如下： 28 dockerFabricPull() { 29 local FABRIC_TAG=$1 30 for IMAGES in peer orderer ccenv tools; do 31 echo &quot;==&gt; FABRIC IMAGE: $IMAGES&quot; 32 echo 33 docker pull hyperledger/fabric-$IMAGES:$FABRIC_TAG 34 docker tag hyperledger/fabric-$IMAGES:$FABRIC_TAG hyperledger/fabric-$IMAGES 35 done 36 } &nbsp; &nbsp; &nbsp;&nbsp;dockerCaPull 函数代码如下： 48 dockerCaPull() { 49 local CA_TAG=$1 50 echo &quot;==&gt; FABRIC CA IMAGE&quot; 51 echo 52 docker pull hyperledger/fabric-ca:$CA_TAG 53 docker tag hyperledger/fabric-ca:$CA_TAG hyperledger/fabric-ca 54 } &nbsp; &nbsp; &nbsp;&nbsp;dockerThirdPartyImagesPull 函数代码如下： 38 dockerThirdPartyImagesPull() { 39 local THIRDPARTY_TAG=$1 40 for IMAGES in couchdb kafka zookeeper; do 41 echo &quot;==&gt; THIRDPARTY DOCKER IMAGE: $IMAGES&quot; 42 echo 43 docker pull hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG 44 docker tag hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG hyperledger/fabric-$IMAGES 45 done 46 } &nbsp; &nbsp; &nbsp;&nbsp;上面dockerThirdPartyImagesPull 函数内部使用了一个for循环（第40行）挨个去下载couchdb、kafka、zookeeper三个镜像。 &nbsp; &nbsp; &nbsp;&nbsp;部分镜像说明如下： 镜像名称 是否可选 镜像说明 hyperledger/fabric-tools 可选 包含crytogen、configtxgen、configtxlator我第二次工具的镜像文件 hyperledger/fabric-couchdb 可选 CouchDB的数据库镜像文件、状态数据库选择CouchDB的时候才需要 hyperledger/fabric-kafka 可选 Kafka的镜像文件 hyperledger/fabric-zookeeper 可选 Zookeeper的镜像文件 hyperledger/fabric-peer 必选 Peer节点的镜像文件 hyperledger/fabric-orderer 必选 排序服务节点的镜像文件 hyperledger/fabric-javaenv 可选 java链码的基础镜像文件 hyperledger/fabric-ccenv 必选 Golang链码的基础镜像文件 hyperledger/fabric-ca 可选 fabric-ca的镜像文件，用到fabric-ca的时候才需要 07 总结 &nbsp; &nbsp; &nbsp;&nbsp;通过上面的介绍，相信大家已经了解了bootstrap.sh的作用了。读者可能会纳闷了，为啥要花这么大篇幅来介绍这个脚本文件？？吃饱了撑的吗。这是因为我们通过分析这个文件，知道了具体内部干了什么，知其然也要知其所以然嘛。这样，我们也可以不需要这个脚本文件，手动就能把环境搭建好！！ 08 参考资料 1.https://hyperledger-fabric.readthedocs.io/en/release-1.2/install.html 2.《深度探索区块链：Hyperledger技术与应用》作者: 张增骏 / 董宁 / 朱轩彤 / 陈剑雄 出版社: 机械工业出版社 3. 《区块链开发实战 Hyperledger Fabric关键技术与案例分析》作者： 冯翔 刘涛 吴寿鹤 周广益 出版社：机械工业出版社 4. 《HyperLedger Fabric开发实战快速掌握区块链技术》作者：杨毅 出版社： 电子工业出版社 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-01T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"00 导言 &nbsp; &nbsp; &nbsp;&nbsp;在上一讲中，我们手把手带着大家一步一步《在Ubuntu 18.04上搭建HyperLedger Fabric 1.2.0 环境》，其中有两个步骤是：下载bootstrap.sh引导脚本和执行该引导脚本。很多朋友执行这两个步骤时可能会有疑问：为什么要下载这个脚本？执行这个脚本的作用是什么？ &nbsp; &nbsp; &nbsp;&nbsp;别急，接下来我们会深入分析一下这个文件的源码，探个究竟。不过在分析之前，我们先来回顾一下上一讲是怎么下载和执行这个脚本的。 02 如何下载和执行bootstrap.sh脚本 &nbsp; &nbsp; &nbsp;&nbsp;我们先来看看官方是怎么说的。官方提供的命令如下： $ curl -sSL http://bit.ly/2ysbOFE | bash -s 1.2.0 1.2.0 0.4.10 &nbsp; &nbsp; &nbsp;&nbsp;我们来解释一下这条命令:curl -sSL http://bit.ly/2ysbOFE，这条命令是通过请求短链接http://bit.ly/2ysbOFE，该短链接会重定向到真正的目标地址，目标地址会响应我们要的内容，响应的内容就是bootstrap.sh文件里的内容。很不幸的是，上面的短链接已经失效，不过我们已经找到了一个有效的长链接：https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh，用它替换掉短链接就可以了。于是我们得到了下面的命令： $ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh | bash -s 1.2.0 1.2.0 0.4.10 &nbsp; &nbsp; &nbsp;&nbsp;这里要解释一下-sSL的作用，小s指的是沉默模式，表示不输出请求过程的任何信息，只输出最终响应的内容，大S指的是如果有错显示出来，L指的是短链接要进行重定向。 &nbsp; &nbsp; &nbsp;&nbsp;接下来是一根竖线 |，学过linux的朋友应该都知道，这根竖线表示管道，意思是上一个命令输出的内容，交给下一个命令去执行，这里表示交给bash去执行。 &nbsp; &nbsp; &nbsp;&nbsp;bash 后面是-s ，-s后面的所有内容将做为参数传给bootstrap.sh。1.2.0 1.2.0 0.4.10这3个对应的是 Fabric, Fabric-ca 和 thirdparty(couchdb, kafka and zookeeper) 这三个模块的版本。如果我们想要安装更早的版本，我们可以修改它们，脚本程序会知道下载对应的版本。 &nbsp; &nbsp; &nbsp;&nbsp;上面实际上是两条命令通过管道( | )连接在一起执行，实际上我们也可以将它们分开： $ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh -o bootstrap.sh $ chmod 755 bootstrap.sh $ sudo ./bootstrap.sh 1.2.0 1.2.0 0.4.10 03 bootstrap.sh到底帮我们做了什么？ &nbsp; &nbsp; &nbsp;&nbsp;bootstrap.sh实际上帮我们作了如下几件事情： &nbsp; &nbsp; &nbsp;&nbsp;1. 从github上克隆 hyperledger/fabric-samples并进入该目录，然后检出适当的版本 &nbsp; &nbsp; &nbsp;&nbsp;2. 在fabric-samples目录下安装特定平台的 Hyperledger Fabric 二进制可执行文件 和配置文件 &nbsp; &nbsp; &nbsp;&nbsp;3.下载 指定版本的Hyperledger Fabric 的docker镜像 &nbsp; &nbsp; &nbsp;&nbsp; 整个脚本帮我们做了上面这三件事情，bootstrap.sh中对应的代码如下： 218 if [ &quot;$SAMPLES&quot; == &quot;true&quot; ]; then 219 echo 220 echo &quot;Installing hyperledger/fabric-samples repo&quot; 221 echo 222 samplesInstall 223 fi 224 if [ &quot;$BINARIES&quot; == &quot;true&quot; ]; then 225 echo 226 echo &quot;Installing Hyperledger Fabric binaries&quot; 227 echo 228 binariesInstall 229 fi 230 if [ &quot;$DOCKER&quot; == &quot;true&quot; ]; then 231 echo 232 echo &quot;Installing Hyperledger Fabric docker images&quot; 233 echo 234 dockerInstall 235 fi &nbsp; &nbsp; &nbsp;&nbsp;其中samplesInstall对应的是克隆fabric-samples，binariesInstall对应的是安装二进制文件，dockerInstall对应的是下载docker镜像。 接下来我们分析一下它们对应的代码部分。 04 第一件事：克隆fabric-samples并检出适当的版本 &nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的samplesInstall函数，代码如下： 56 samplesInstall() { 57 # clone (if needed) hyperledger/fabric-samples and checkout corresponding 58 # version to the binaries and docker images to be downloaded 59 if [ -d first-network ]; then 60 # if we are in the fabric-samples repo, checkout corresponding version 61 echo &quot;===&gt; Checking out v${VERSION} branch of hyperledger/fabric-samples&quot; 62 git checkout v${VERSION} 63 elif [ -d fabric-samples ]; then 64 # if fabric-samples repo already cloned and in current directory, 65 # cd fabric-samples and checkout corresponding version 66 echo &quot;===&gt; Checking out v${VERSION} branch of hyperledger/fabric-samples&quot; 67 cd fabric-samples &amp;&amp; git checkout v${VERSION} 68 else 69 echo &quot;===&gt; Cloning hyperledger/fabric-samples repo and checkout v${VERSION}&quot; 70 git clone -b master https://github.com/hyperledger/fabric-samples.git &amp;&amp; cd fabric-samples &amp;&amp; git checkout v${VERSION} 71 fi 72 } &nbsp; &nbsp; &nbsp;&nbsp;我们可以看到第70行代码，这行代码的作用就是 从github上克隆 hyperledger/fabric-samples，然后进入该目录，并检出指定的版本。 &nbsp; &nbsp; &nbsp;&nbsp;该仓库的地址是： https://github.com/hyperledger/fabric-samples.git 05 第二件事：安装二进制可执行文件 和配置文件 &nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的binariesInstall函数，代码如下： 133 binariesInstall() { 134 echo &quot;===&gt; Downloading version ${FABRIC_TAG} platform specific fabric binaries&quot; 135 binaryDownload ${BINARY_FILE} https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/${ARCH}-${VERSION}/${BINARY_FILE} 136 if [ $? -eq 22 ]; then 137 echo 138 echo &quot;------&gt; ${FABRIC_TAG} platform specific fabric binary is not available to download &lt;----&quot; 139 echo 140 fi 141 142 echo &quot;===&gt; Downloading version ${CA_TAG} platform specific fabric-ca-client binary&quot; 143 binaryDownload ${CA_BINARY_FILE} https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/${ARCH}-${CA_VERSION}/${CA_BINARY_FILE} 144 if [ $? -eq 22 ]; then 145 echo 146 echo &quot;------&gt; ${CA_TAG} fabric-ca-client binary is not available to download (Available from 1.1.0-rc1) &lt;----&quot; 147 echo 148 fi 149 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第135行和第143行分别调用binaryDownload函数去下面这两个地址下载fabric和fabric-ca相应的二进制文件打成的压缩包。实际上我们也可以使用浏览器或者下载软件单独下载它们。 1.https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz 2.https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/linux-amd64-1.2.0/hyperledger-fabric-ca-linux-amd64-1.2.0.tar.gz &nbsp; &nbsp; &nbsp;&nbsp;我们接下来看看binaryDownload函数： 113 binaryDownload() { 114 local BINARY_FILE=$1 115 local URL=$2 116 echo &quot;===&gt; Downloading: &quot; ${URL} 117 # Check if a previous failure occurred and the file was partially downloaded 118 if [ -e ${BINARY_FILE} ]; then 119 echo &quot;==&gt; Partial binary file found. Resuming download...&quot; 120 binaryIncrementalDownload ${BINARY_FILE} ${URL} 121 else 122 curl ${URL} | tar xz || rc=$? 123 if [ ! -z &quot;$rc&quot; ]; then 124 echo &quot;==&gt; There was an error downloading the binary file. Switching to incremental download.&quot; 125 echo &quot;==&gt; Downloading file...&quot; 126 binaryIncrementalDownload ${BINARY_FILE} ${URL} 127 else 128 echo &quot;==&gt; Done.&quot; 129 fi 130 fi 131 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第122行，执行curl命令去下载tar包,并用tar命令解压。解压后的命令出现在bin目录下。实际上，这些二进制命令我们也可以通过编译hyperledger fabric的源码生成！后面我们有文章会讲到怎么编译源码去生成这些二进制文件。 -rwxrwxr-x 1 1001 1001 16784432 7月 4 03:04 configtxgen* -rwxrwxr-x 1 1001 1001 17925784 7月 4 03:04 configtxlator* -rwxrwxr-x 1 1001 1001 8660280 7月 4 03:04 cryptogen* -rwxrwxr-x 1 1001 1001 17611704 7月 4 03:04 discover* -rwxrwxr-x 1 1001 1001 14298688 7月 4 04:41 fabric-ca-client* -rwxrwxr-x 1 1001 1001 817 7月 4 03:04 get-docker-images.sh* -rwxrwxr-x 1 1001 1001 7152824 7月 4 03:04 idemixgen* -rwxrwxr-x 1 1001 1001 22075240 7月 4 03:04 orderer* -rwxrwxr-x 1 1001 1001 29880000 7月 4 03:04 peer* &nbsp; &nbsp; &nbsp;&nbsp;我们解释一下其中这些命令的作用： 名称 作用 peer 负责启动节点，存储区块链数据，运行维护链码 order 负责启动排序节点，对交易进行排序，并将排序好的交易打包成模块 cryptogen 生成组织结构和身份文件 configtxgen 生成配置区块和配置交易 configtxlator 解读配置信息 06 第三件事：下载docker镜像 &nbsp; &nbsp; &nbsp;&nbsp;对应bootstrap.sh中的dockerInstall函数，代码如下： 151 dockerInstall() { 152 which docker &gt;&amp; /dev/null 153 NODOCKER=$? 154 if [ &quot;${NODOCKER}&quot; == 0 ]; then 155 echo &quot;===&gt; Pulling fabric Images&quot; 156 dockerFabricPull ${FABRIC_TAG} 157 echo &quot;===&gt; Pulling fabric ca Image&quot; 158 dockerCaPull ${CA_TAG} 159 echo &quot;===&gt; Pulling thirdparty docker images&quot; 160 dockerThirdPartyImagesPull ${THIRDPARTY_TAG} 161 echo 162 echo &quot;===&gt; List out hyperledger docker images&quot; 163 docker images | grep hyperledger* 164 else 165 echo &quot;=========================================================&quot; 166 echo &quot;Docker not installed, bypassing download of Fabric images&quot; 167 echo &quot;=========================================================&quot; 168 fi 169 } &nbsp; &nbsp; &nbsp;&nbsp;可以看到第156行，第158行，第160行，分别调用了dockerFabricPull 、dockerCaPull 、dockerThirdPartyImagesPull 三个函数去拉取相应的docker镜像并打标签。最后下载完还执行docker images | grep hyperledger*(第163行)查看是否已下载好下面所列的镜像。 hyperledger/fabric-ca 1.2.0 66cc132bd09c 4 weeks ago 252MB hyperledger/fabric-tools 1.2.0 379602873003 4 weeks ago 1.51GB hyperledger/fabric-ccenv 1.2.0 6acf31e2d9a4 4 weeks ago 1.43GB hyperledger/fabric-orderer 1.2.0 4baf7789a8ec 4 weeks ago 152MB hyperledger/fabric-peer 1.2.0 82c262e65984 4 weeks ago 159MB hyperledger/fabric-zookeeper 0.4.10 2b51158f3898 4 weeks ago 1.44GB hyperledger/fabric-kafka 0.4.10 936aef6db0e6 4 weeks ago 1.45GB hyperledger/fabric-couchdb 0.4.10 3092eca241fc 4 weeks ago 1.61GB hyperledger/fabric-baseos amd64-0.4.10 52190e831002 4 weeks ago 132MB hyperledger/fabric-ca x86_64-1.0.4 8e691b3509bf 9 months ago 238MB hyperledger/fabric-javaenv x86_64-1.0.4 a517b70135c7 9 months ago 1.41GB &nbsp; &nbsp; &nbsp;&nbsp;dockerFabricPull函数代码如下： 28 dockerFabricPull() { 29 local FABRIC_TAG=$1 30 for IMAGES in peer orderer ccenv tools; do 31 echo &quot;==&gt; FABRIC IMAGE: $IMAGES&quot; 32 echo 33 docker pull hyperledger/fabric-$IMAGES:$FABRIC_TAG 34 docker tag hyperledger/fabric-$IMAGES:$FABRIC_TAG hyperledger/fabric-$IMAGES 35 done 36 } &nbsp; &nbsp; &nbsp;&nbsp;dockerCaPull 函数代码如下： 48 dockerCaPull() { 49 local CA_TAG=$1 50 echo &quot;==&gt; FABRIC CA IMAGE&quot; 51 echo 52 docker pull hyperledger/fabric-ca:$CA_TAG 53 docker tag hyperledger/fabric-ca:$CA_TAG hyperledger/fabric-ca 54 } &nbsp; &nbsp; &nbsp;&nbsp;dockerThirdPartyImagesPull 函数代码如下： 38 dockerThirdPartyImagesPull() { 39 local THIRDPARTY_TAG=$1 40 for IMAGES in couchdb kafka zookeeper; do 41 echo &quot;==&gt; THIRDPARTY DOCKER IMAGE: $IMAGES&quot; 42 echo 43 docker pull hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG 44 docker tag hyperledger/fabric-$IMAGES:$THIRDPARTY_TAG hyperledger/fabric-$IMAGES 45 done 46 } &nbsp; &nbsp; &nbsp;&nbsp;上面dockerThirdPartyImagesPull 函数内部使用了一个for循环（第40行）挨个去下载couchdb、kafka、zookeeper三个镜像。 &nbsp; &nbsp; &nbsp;&nbsp;部分镜像说明如下： 镜像名称 是否可选 镜像说明 hyperledger/fabric-tools 可选 包含crytogen、configtxgen、configtxlator我第二次工具的镜像文件 hyperledger/fabric-couchdb 可选 CouchDB的数据库镜像文件、状态数据库选择CouchDB的时候才需要 hyperledger/fabric-kafka 可选 Kafka的镜像文件 hyperledger/fabric-zookeeper 可选 Zookeeper的镜像文件 hyperledger/fabric-peer 必选 Peer节点的镜像文件 hyperledger/fabric-orderer 必选 排序服务节点的镜像文件 hyperledger/fabric-javaenv 可选 java链码的基础镜像文件 hyperledger/fabric-ccenv 必选 Golang链码的基础镜像文件 hyperledger/fabric-ca 可选 fabric-ca的镜像文件，用到fabric-ca的时候才需要 07 总结 &nbsp; &nbsp; &nbsp;&nbsp;通过上面的介绍，相信大家已经了解了bootstrap.sh的作用了。读者可能会纳闷了，为啥要花这么大篇幅来介绍这个脚本文件？？吃饱了撑的吗。这是因为我们通过分析这个文件，知道了具体内部干了什么，知其然也要知其所以然嘛。这样，我们也可以不需要这个脚本文件，手动就能把环境搭建好！！ 08 参考资料 1.https://hyperledger-fabric.readthedocs.io/en/release-1.2/install.html 2.《深度探索区块链：Hyperledger技术与应用》作者: 张增骏 / 董宁 / 朱轩彤 / 陈剑雄 出版社: 机械工业出版社 3. 《区块链开发实战 Hyperledger Fabric关键技术与案例分析》作者： 冯翔 刘涛 吴寿鹤 周广益 出版社：机械工业出版社 4. 《HyperLedger Fabric开发实战快速掌握区块链技术》作者：杨毅 出版社： 电子工业出版社 阅读更多","@type":"BlogPosting","url":"/2018/08/01/3884f478e7cbcaf188f25bb663779e44.html","headline":"Fabric 环境搭建时bootstrap.sh帮我们做了什么？","dateModified":"2018-08-01T00:00:00+08:00","datePublished":"2018-08-01T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/01/3884f478e7cbcaf188f25bb663779e44.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Fabric 环境搭建时bootstrap.sh帮我们做了什么？</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h3 id="00-导言">00 导言</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;在上一讲中，我们手把手带着大家一步一步<a href="https://blog.csdn.net/ltt1st/article/details/81332722" rel="nofollow">《在Ubuntu 18.04上搭建HyperLedger Fabric 1.2.0 环境》</a>，其中有两个步骤是：下载bootstrap.sh引导脚本和执行该引导脚本。很多朋友执行这两个步骤时可能会有疑问：为什么要下载这个脚本？执行这个脚本的作用是什么？</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;别急，接下来我们会深入分析一下这个文件的源码，探个究竟。不过在分析之前，我们先来回顾一下上一讲是怎么下载和执行这个脚本的。</p> 
  <h3 id="02-如何下载和执行bootstrapsh脚本">02 如何下载和执行bootstrap.sh脚本</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;我们先来看看官方是怎么说的。官方提供的命令如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash">$ curl <span class="hljs-operator">-s</span>SL http://bit.ly/<span class="hljs-number">2</span>ysbOFE | bash <span class="hljs-operator">-s</span> <span class="hljs-number">1.2</span>.<span class="hljs-number">0</span> <span class="hljs-number">1.2</span>.<span class="hljs-number">0</span> <span class="hljs-number">0.4</span>.<span class="hljs-number">10</span></code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;我们来解释一下这条命令:curl -sSL <a href="http://bit.ly/2ysbOFE" rel="nofollow">http://bit.ly/2ysbOFE</a>，这条命令是通过请求短链接<a href="http://bit.ly/2ysbOFE" rel="nofollow">http://bit.ly/2ysbOFE</a>，该短链接会重定向到真正的目标地址，目标地址会响应我们要的内容，响应的内容就是bootstrap.sh文件里的内容。很不幸的是，上面的短链接已经失效，不过我们已经找到了一个有效的长链接：<a href="https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh" rel="nofollow">https://raw.githubusercontent.com/hyperledger/fabric/release-1.2/scripts/bootstrap.sh</a>，用它替换掉短链接就可以了。于是我们得到了下面的命令：</p> 
  <pre class="prettyprint"><code class="language-linux hljs ruby"><span class="hljs-variable">$ </span>curl -sSL <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/raw.githubusercontent.com/hyperledger</span><span class="hljs-regexp">/fabric/release</span>-<span class="hljs-number">1.2</span>/scripts/bootstrap.sh | bash -s <span class="hljs-number">1.2</span>.<span class="hljs-number">0</span> <span class="hljs-number">1.2</span>.<span class="hljs-number">0</span> <span class="hljs-number">0</span>.<span class="hljs-number">4.10</span></code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;这里要解释一下-sSL的作用，小s指的是沉默模式，表示不输出请求过程的任何信息，只输出最终响应的内容，大S指的是如果有错显示出来，L指的是短链接要进行重定向。</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;接下来是一根竖线 |，学过linux的朋友应该都知道，这根竖线表示管道，意思是上一个命令输出的内容，交给下一个命令去执行，这里表示交给bash去执行。</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;bash 后面是-s ，-s后面的所有内容将做为参数传给bootstrap.sh。1.2.0 1.2.0 0.4.10这3个对应的是 Fabric, Fabric-ca 和 thirdparty(couchdb, kafka and zookeeper) 这三个模块的版本。如果我们想要安装更早的版本，我们可以修改它们，脚本程序会知道下载对应的版本。</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;上面实际上是两条命令通过管道( | )连接在一起执行，实际上我们也可以将它们分开：</p> 
  <pre class="prettyprint"><code class="language-linux hljs avrasm">$ curl -sSL https://raw<span class="hljs-preprocessor">.githubusercontent</span><span class="hljs-preprocessor">.com</span>/hyperledger/fabric/release-<span class="hljs-number">1.2</span>/scripts/bootstrap<span class="hljs-preprocessor">.sh</span> -o bootstrap<span class="hljs-preprocessor">.sh</span>
$ chmod <span class="hljs-number">755</span> bootstrap<span class="hljs-preprocessor">.sh</span>
$ sudo ./bootstrap<span class="hljs-preprocessor">.sh</span> <span class="hljs-number">1.2</span><span class="hljs-number">.0</span> <span class="hljs-number">1.2</span><span class="hljs-number">.0</span> <span class="hljs-number">0.4</span><span class="hljs-number">.10</span></code></pre> 
  <h3 id="03-bootstrapsh到底帮我们做了什么">03 bootstrap.sh到底帮我们做了什么？</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;bootstrap.sh实际上帮我们作了如下几件事情：</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;1. 从github上克隆 hyperledger/fabric-samples并进入该目录，然后检出适当的版本 <br> &nbsp; &nbsp; &nbsp;&nbsp;2. 在fabric-samples目录下安装特定平台的 Hyperledger Fabric 二进制可执行文件 和配置文件 <br> &nbsp; &nbsp; &nbsp;&nbsp;3.下载 指定版本的Hyperledger Fabric 的docker镜像</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp; 整个脚本帮我们做了上面这三件事情，bootstrap.sh中对应的代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash">    <span class="hljs-number">218</span> <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$SAMPLES</span>"</span> == <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-number">219</span>   <span class="hljs-built_in">echo</span>
    <span class="hljs-number">220</span>   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Installing hyperledger/fabric-samples repo"</span>
    <span class="hljs-number">221</span>   <span class="hljs-built_in">echo</span>
    <span class="hljs-number">222</span>   samplesInstall
    <span class="hljs-number">223</span> <span class="hljs-keyword">fi</span>
    <span class="hljs-number">224</span> <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$BINARIES</span>"</span> == <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-number">225</span>   <span class="hljs-built_in">echo</span>
    <span class="hljs-number">226</span>   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Installing Hyperledger Fabric binaries"</span>
    <span class="hljs-number">227</span>   <span class="hljs-built_in">echo</span>
    <span class="hljs-number">228</span>   binariesInstall
    <span class="hljs-number">229</span> <span class="hljs-keyword">fi</span>
    <span class="hljs-number">230</span> <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$DOCKER</span>"</span> == <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-number">231</span>   <span class="hljs-built_in">echo</span>
    <span class="hljs-number">232</span>   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Installing Hyperledger Fabric docker images"</span>
    <span class="hljs-number">233</span>   <span class="hljs-built_in">echo</span>
    <span class="hljs-number">234</span>   dockerInstall
    <span class="hljs-number">235</span> <span class="hljs-keyword">fi</span></code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;其中samplesInstall对应的是克隆fabric-samples，binariesInstall对应的是安装二进制文件，dockerInstall对应的是下载docker镜像。</p> 
  <p>接下来我们分析一下它们对应的代码部分。</p> 
  <h3 id="04-第一件事克隆fabric-samples并检出适当的版本">04 第一件事：克隆fabric-samples并检出适当的版本</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的samplesInstall函数，代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash"><span class="hljs-number">56</span> <span class="hljs-function"><span class="hljs-title">samplesInstall</span></span>() {
<span class="hljs-number">57</span>   <span class="hljs-comment"># clone (if needed) hyperledger/fabric-samples and checkout corresponding</span>
<span class="hljs-number">58</span>   <span class="hljs-comment"># version to the binaries and docker images to be downloaded</span>
<span class="hljs-number">59</span>   <span class="hljs-keyword">if</span> [ <span class="hljs-operator">-d</span> first-network ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">60</span>     <span class="hljs-comment"># if we are in the fabric-samples repo, checkout corresponding version</span>
<span class="hljs-number">61</span>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Checking out v<span class="hljs-variable">${VERSION}</span> branch of hyperledger/fabric-samples"</span>
<span class="hljs-number">62</span>     git checkout v<span class="hljs-variable">${VERSION}</span>
<span class="hljs-number">63</span>   <span class="hljs-keyword">elif</span> [ <span class="hljs-operator">-d</span> fabric-samples ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">64</span>     <span class="hljs-comment"># if fabric-samples repo already cloned and in current directory,</span>
<span class="hljs-number">65</span>     <span class="hljs-comment"># cd fabric-samples and checkout corresponding version</span>
<span class="hljs-number">66</span>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Checking out v<span class="hljs-variable">${VERSION}</span> branch of hyperledger/fabric-samples"</span>
<span class="hljs-number">67</span>     <span class="hljs-built_in">cd</span> fabric-samples &amp;&amp; git checkout v<span class="hljs-variable">${VERSION}</span>
<span class="hljs-number">68</span>   <span class="hljs-keyword">else</span>
<span class="hljs-number">69</span>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Cloning hyperledger/fabric-samples repo and checkout v<span class="hljs-variable">${VERSION}</span>"</span>
<span class="hljs-number">70</span>     git clone -b master https://github.com/hyperledger/fabric-samples.git &amp;&amp; <span class="hljs-built_in">cd</span> fabric-samples &amp;&amp; git checkout v<span class="hljs-variable">${VERSION}</span>
<span class="hljs-number">71</span>   <span class="hljs-keyword">fi</span>
<span class="hljs-number">72</span> }
</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;我们可以看到第70行代码，这行代码的作用就是 从github上克隆 hyperledger/fabric-samples，然后进入该目录，并检出指定的版本。</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;该仓库的地址是：</p> 
  <pre class="prettyprint"><code class="language-html hljs ">https://github.com/hyperledger/fabric-samples.git</code></pre> 
  <h3 id="05-第二件事安装二进制可执行文件-和配置文件">05 第二件事：安装二进制可执行文件 和配置文件</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp; 对应bootstrap.sh中的binariesInstall函数，代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash"><span class="hljs-number">133</span> <span class="hljs-function"><span class="hljs-title">binariesInstall</span></span>() {
<span class="hljs-number">134</span>   <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Downloading version <span class="hljs-variable">${FABRIC_TAG}</span> platform specific fabric binaries"</span>
<span class="hljs-number">135</span>   binaryDownload <span class="hljs-variable">${BINARY_FILE}</span> https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/<span class="hljs-variable">${ARCH}</span>-<span class="hljs-variable">${VERSION}</span>/<span class="hljs-variable">${BINARY_FILE}</span>
<span class="hljs-number">136</span>   <span class="hljs-keyword">if</span> [ $? <span class="hljs-operator">-eq</span> <span class="hljs-number">22</span> ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">137</span>      <span class="hljs-built_in">echo</span>
<span class="hljs-number">138</span>      <span class="hljs-built_in">echo</span> <span class="hljs-string">"------&gt; <span class="hljs-variable">${FABRIC_TAG}</span> platform specific fabric binary is not available to download &lt;----"</span>
<span class="hljs-number">139</span>      <span class="hljs-built_in">echo</span>
<span class="hljs-number">140</span>    <span class="hljs-keyword">fi</span>
<span class="hljs-number">141</span> 
<span class="hljs-number">142</span>   <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Downloading version <span class="hljs-variable">${CA_TAG}</span> platform specific fabric-ca-client binary"</span>
<span class="hljs-number">143</span>   binaryDownload <span class="hljs-variable">${CA_BINARY_FILE}</span> https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/<span class="hljs-variable">${ARCH}</span>-<span class="hljs-variable">${CA_VERSION}</span>/<span class="hljs-variable">${CA_BINARY_FILE}</span>
<span class="hljs-number">144</span>   <span class="hljs-keyword">if</span> [ $? <span class="hljs-operator">-eq</span> <span class="hljs-number">22</span> ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">145</span>      <span class="hljs-built_in">echo</span>
<span class="hljs-number">146</span>      <span class="hljs-built_in">echo</span> <span class="hljs-string">"------&gt; <span class="hljs-variable">${CA_TAG}</span> fabric-ca-client binary is not available to download (Available from 1.1.0-rc1) &lt;----"</span>
<span class="hljs-number">147</span>      <span class="hljs-built_in">echo</span>
<span class="hljs-number">148</span>    <span class="hljs-keyword">fi</span>
<span class="hljs-number">149</span> }</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;可以看到第135行和第143行分别调用binaryDownload函数去下面这两个地址下载fabric和fabric-ca相应的二进制文件打成的压缩包。实际上我们也可以使用浏览器或者下载软件单独下载它们。 <br> 1.<a href="https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz" rel="nofollow">https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz</a> <br> 2.<a href="https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/linux-amd64-1.2.0/hyperledger-fabric-ca-linux-amd64-1.2.0.tar.gz" rel="nofollow">https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric-ca/hyperledger-fabric-ca/linux-amd64-1.2.0/hyperledger-fabric-ca-linux-amd64-1.2.0.tar.gz</a></p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;我们接下来看看binaryDownload函数：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash"><span class="hljs-number">113</span> <span class="hljs-function"><span class="hljs-title">binaryDownload</span></span>() {
<span class="hljs-number">114</span>       local BINARY_FILE=<span class="hljs-variable">$1</span>
<span class="hljs-number">115</span>       local URL=<span class="hljs-variable">$2</span>
<span class="hljs-number">116</span>       <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Downloading: "</span> <span class="hljs-variable">${URL}</span>
<span class="hljs-number">117</span>       <span class="hljs-comment"># Check if a previous failure occurred and the file was partially downloaded</span>
<span class="hljs-number">118</span>       <span class="hljs-keyword">if</span> [ <span class="hljs-operator">-e</span> <span class="hljs-variable">${BINARY_FILE}</span> ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">119</span>           <span class="hljs-built_in">echo</span> <span class="hljs-string">"==&gt; Partial binary file found. Resuming download..."</span>
<span class="hljs-number">120</span>           binaryIncrementalDownload <span class="hljs-variable">${BINARY_FILE}</span> <span class="hljs-variable">${URL}</span>
<span class="hljs-number">121</span>       <span class="hljs-keyword">else</span>
<span class="hljs-number">122</span>           curl <span class="hljs-variable">${URL}</span> | tar xz || rc=$?
<span class="hljs-number">123</span>           <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-string">"<span class="hljs-variable">$rc</span>"</span> ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">124</span>               <span class="hljs-built_in">echo</span> <span class="hljs-string">"==&gt; There was an error downloading the binary file. Switching to incremental download."</span>
<span class="hljs-number">125</span>               <span class="hljs-built_in">echo</span> <span class="hljs-string">"==&gt; Downloading file..."</span>
<span class="hljs-number">126</span>               binaryIncrementalDownload <span class="hljs-variable">${BINARY_FILE}</span> <span class="hljs-variable">${URL}</span>
<span class="hljs-number">127</span>           <span class="hljs-keyword">else</span>
<span class="hljs-number">128</span>               <span class="hljs-built_in">echo</span> <span class="hljs-string">"==&gt; Done."</span>
<span class="hljs-number">129</span>           <span class="hljs-keyword">fi</span>
<span class="hljs-number">130</span>       <span class="hljs-keyword">fi</span>
<span class="hljs-number">131</span> }</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;可以看到第122行，执行curl命令去下载tar包,并用tar命令解压。解压后的命令出现在bin目录下。<strong>实际上，这些二进制命令我们也可以通过编译hyperledger fabric的源码生成！</strong>后面我们有文章会讲到怎么编译源码去生成这些二进制文件。</p> 
  <pre class="prettyprint"><code class="language-linux hljs lasso"><span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span> <span class="hljs-number">16784432</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> configtxgen<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span> <span class="hljs-number">17925784</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> configtxlator<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span>  <span class="hljs-number">8660280</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> cryptogen<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span> <span class="hljs-number">17611704</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> discover<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span> <span class="hljs-number">14298688</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">04</span>:<span class="hljs-number">41</span> fabric<span class="hljs-attribute">-ca</span><span class="hljs-attribute">-client</span><span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span>      <span class="hljs-number">817</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> get<span class="hljs-attribute">-docker</span><span class="hljs-attribute">-images</span><span class="hljs-built_in">.</span>sh<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span>  <span class="hljs-number">7152824</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> idemixgen<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span> <span class="hljs-number">22075240</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> orderer<span class="hljs-subst">*</span>
<span class="hljs-attribute">-rwxrwxr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> <span class="hljs-number">1001</span> <span class="hljs-number">1001</span> <span class="hljs-number">29880000</span> <span class="hljs-number">7</span>月   <span class="hljs-number">4</span> <span class="hljs-number">03</span>:<span class="hljs-number">04</span> peer<span class="hljs-subst">*</span></code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;我们解释一下其中这些命令的作用：</p> 
  <table> 
   <thead> 
    <tr> 
     <th>名称</th> 
     <th>作用</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td>peer</td> 
     <td>负责启动节点，存储区块链数据，运行维护链码</td> 
    </tr> 
    <tr> 
     <td>order</td> 
     <td>负责启动排序节点，对交易进行排序，并将排序好的交易打包成模块</td> 
    </tr> 
    <tr> 
     <td>cryptogen</td> 
     <td>生成组织结构和身份文件</td> 
    </tr> 
    <tr> 
     <td>configtxgen</td> 
     <td>生成配置区块和配置交易</td> 
    </tr> 
    <tr> 
     <td>configtxlator</td> 
     <td>解读配置信息</td> 
    </tr> 
   </tbody>
  </table> 
  <h3 id="06-第三件事下载docker镜像">06 第三件事：下载docker镜像</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;对应bootstrap.sh中的dockerInstall函数，代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash"><span class="hljs-number">151</span> <span class="hljs-function"><span class="hljs-title">dockerInstall</span></span>() {
<span class="hljs-number">152</span>   which docker &gt;&amp; /dev/null
<span class="hljs-number">153</span>   NODOCKER=$?
<span class="hljs-number">154</span>   <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${NODOCKER}</span>"</span> == <span class="hljs-number">0</span> ]; <span class="hljs-keyword">then</span>
<span class="hljs-number">155</span>           <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Pulling fabric Images"</span>
<span class="hljs-number">156</span>           dockerFabricPull <span class="hljs-variable">${FABRIC_TAG}</span>
<span class="hljs-number">157</span>           <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Pulling fabric ca Image"</span>
<span class="hljs-number">158</span>           dockerCaPull <span class="hljs-variable">${CA_TAG}</span>
<span class="hljs-number">159</span>           <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; Pulling thirdparty docker images"</span>
<span class="hljs-number">160</span>           dockerThirdPartyImagesPull <span class="hljs-variable">${THIRDPARTY_TAG}</span>
<span class="hljs-number">161</span>           <span class="hljs-built_in">echo</span>
<span class="hljs-number">162</span>           <span class="hljs-built_in">echo</span> <span class="hljs-string">"===&gt; List out hyperledger docker images"</span>
<span class="hljs-number">163</span>           docker images | grep hyperledger*
<span class="hljs-number">164</span>   <span class="hljs-keyword">else</span>
<span class="hljs-number">165</span>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================================="</span>
<span class="hljs-number">166</span>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"Docker not installed, bypassing download of Fabric images"</span>
<span class="hljs-number">167</span>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================================="</span>
<span class="hljs-number">168</span>   <span class="hljs-keyword">fi</span>
<span class="hljs-number">169</span> }</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;可以看到第156行，第158行，第160行，分别调用了dockerFabricPull 、dockerCaPull 、dockerThirdPartyImagesPull 三个函数去拉取相应的docker镜像并打标签。最后下载完还执行<em>docker images | grep hyperledger*</em>(第163行)查看是否已下载好下面所列的镜像。</p> 
  <pre class="prettyprint"><code class="language-linux hljs lasso">hyperledger/fabric<span class="hljs-attribute">-ca</span>         <span class="hljs-number">1.2</span><span class="hljs-number">.0</span>               <span class="hljs-number">66</span>cc132bd09c        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">252</span>MB
hyperledger/fabric<span class="hljs-attribute">-tools</span>      <span class="hljs-number">1.2</span><span class="hljs-number">.0</span>               <span class="hljs-number">379602873003</span>        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">1.51</span>GB
hyperledger/fabric<span class="hljs-attribute">-ccenv</span>      <span class="hljs-number">1.2</span><span class="hljs-number">.0</span>               <span class="hljs-number">6</span>acf31e2d9a4        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">1.43</span>GB
hyperledger/fabric<span class="hljs-attribute">-orderer</span>    <span class="hljs-number">1.2</span><span class="hljs-number">.0</span>               <span class="hljs-number">4</span>baf7789a8ec        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">152</span>MB
hyperledger/fabric<span class="hljs-attribute">-peer</span>       <span class="hljs-number">1.2</span><span class="hljs-number">.0</span>               <span class="hljs-number">82</span>c262e65984        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">159</span>MB
hyperledger/fabric<span class="hljs-attribute">-zookeeper</span>  <span class="hljs-number">0.4</span><span class="hljs-number">.10</span>              <span class="hljs-number">2</span>b51158f3898        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">1.44</span>GB
hyperledger/fabric<span class="hljs-attribute">-kafka</span>      <span class="hljs-number">0.4</span><span class="hljs-number">.10</span>              <span class="hljs-number">936</span>aef6db0e6        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">1.45</span>GB
hyperledger/fabric<span class="hljs-attribute">-couchdb</span>    <span class="hljs-number">0.4</span><span class="hljs-number">.10</span>              <span class="hljs-number">3092</span>eca241fc        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">1.61</span>GB
hyperledger/fabric<span class="hljs-attribute">-baseos</span>     amd64<span class="hljs-subst">-</span><span class="hljs-number">0.4</span><span class="hljs-number">.10</span>        <span class="hljs-number">52190e831002</span>        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">132</span>MB
hyperledger/fabric<span class="hljs-attribute">-ca</span>         x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>        <span class="hljs-number">8e691</span>b3509bf        <span class="hljs-number">9</span> months ago        <span class="hljs-number">238</span>MB
hyperledger/fabric<span class="hljs-attribute">-javaenv</span>    x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>        a517b70135c7        <span class="hljs-number">9</span> months ago        <span class="hljs-number">1.41</span>GB</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;dockerFabricPull函数代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash"> <span class="hljs-number">28</span> <span class="hljs-function"><span class="hljs-title">dockerFabricPull</span></span>() {
 <span class="hljs-number">29</span>   local FABRIC_TAG=<span class="hljs-variable">$1</span>
 <span class="hljs-number">30</span>   <span class="hljs-keyword">for</span> IMAGES <span class="hljs-keyword">in</span> peer orderer ccenv tools; <span class="hljs-keyword">do</span>
 <span class="hljs-number">31</span>       <span class="hljs-built_in">echo</span> <span class="hljs-string">"==&gt; FABRIC IMAGE: <span class="hljs-variable">$IMAGES</span>"</span>
 <span class="hljs-number">32</span>       <span class="hljs-built_in">echo</span>
 <span class="hljs-number">33</span>       docker pull hyperledger/fabric-<span class="hljs-variable">$IMAGES</span>:<span class="hljs-variable">$FABRIC_TAG</span>
 <span class="hljs-number">34</span>       docker tag hyperledger/fabric-<span class="hljs-variable">$IMAGES</span>:<span class="hljs-variable">$FABRIC_TAG</span> hyperledger/fabric-<span class="hljs-variable">$IMAGES</span>
 <span class="hljs-number">35</span>   <span class="hljs-keyword">done</span>
 <span class="hljs-number">36</span> }</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;dockerCaPull 函数代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs lasso"> <span class="hljs-number">48</span> dockerCaPull() {
 <span class="hljs-number">49</span>       <span class="hljs-built_in">local</span> CA_TAG<span class="hljs-subst">=</span>$<span class="hljs-number">1</span>
 <span class="hljs-number">50</span>       echo <span class="hljs-string">"==&gt; FABRIC CA IMAGE"</span>
 <span class="hljs-number">51</span>       echo
 <span class="hljs-number">52</span>       docker pull hyperledger/fabric<span class="hljs-attribute">-ca</span>:<span class="hljs-variable">$CA_TAG</span>
 <span class="hljs-number">53</span>       docker <span class="hljs-built_in">tag</span> hyperledger/fabric<span class="hljs-attribute">-ca</span>:<span class="hljs-variable">$CA_TAG</span> hyperledger/fabric<span class="hljs-attribute">-ca</span>
 <span class="hljs-number">54</span> }
</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;dockerThirdPartyImagesPull 函数代码如下：</p> 
  <pre class="prettyprint"><code class="language-linux hljs bash"> <span class="hljs-number">38</span> <span class="hljs-function"><span class="hljs-title">dockerThirdPartyImagesPull</span></span>() {
 <span class="hljs-number">39</span>   local THIRDPARTY_TAG=<span class="hljs-variable">$1</span>
 <span class="hljs-number">40</span>   <span class="hljs-keyword">for</span> IMAGES <span class="hljs-keyword">in</span> couchdb kafka zookeeper; <span class="hljs-keyword">do</span>
 <span class="hljs-number">41</span>       <span class="hljs-built_in">echo</span> <span class="hljs-string">"==&gt; THIRDPARTY DOCKER IMAGE: <span class="hljs-variable">$IMAGES</span>"</span>
 <span class="hljs-number">42</span>       <span class="hljs-built_in">echo</span>
 <span class="hljs-number">43</span>       docker pull hyperledger/fabric-<span class="hljs-variable">$IMAGES</span>:<span class="hljs-variable">$THIRDPARTY_TAG</span>
 <span class="hljs-number">44</span>       docker tag hyperledger/fabric-<span class="hljs-variable">$IMAGES</span>:<span class="hljs-variable">$THIRDPARTY_TAG</span> hyperledger/fabric-<span class="hljs-variable">$IMAGES</span>
 <span class="hljs-number">45</span>   <span class="hljs-keyword">done</span>
 <span class="hljs-number">46</span> }</code></pre> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;上面dockerThirdPartyImagesPull 函数内部使用了一个for循环（第40行）挨个去下载couchdb、kafka、zookeeper三个镜像。</p> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;部分镜像说明如下：</p> 
  <table> 
   <thead> 
    <tr> 
     <th>镜像名称</th> 
     <th>是否可选</th> 
     <th>镜像说明</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td>hyperledger/fabric-tools</td> 
     <td>可选</td> 
     <td>包含crytogen、configtxgen、configtxlator我第二次工具的镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-couchdb</td> 
     <td>可选</td> 
     <td>CouchDB的数据库镜像文件、状态数据库选择CouchDB的时候才需要</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-kafka</td> 
     <td>可选</td> 
     <td>Kafka的镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-zookeeper</td> 
     <td>可选</td> 
     <td>Zookeeper的镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-peer</td> 
     <td>必选</td> 
     <td>Peer节点的镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-orderer</td> 
     <td>必选</td> 
     <td>排序服务节点的镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-javaenv</td> 
     <td>可选</td> 
     <td>java链码的基础镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-ccenv</td> 
     <td>必选</td> 
     <td>Golang链码的基础镜像文件</td> 
    </tr> 
    <tr> 
     <td>hyperledger/fabric-ca</td> 
     <td>可选</td> 
     <td>fabric-ca的镜像文件，用到fabric-ca的时候才需要</td> 
    </tr> 
   </tbody>
  </table> 
  <h3 id="07-总结">07 总结</h3> 
  <p>&nbsp; &nbsp; &nbsp;&nbsp;通过上面的介绍，相信大家已经了解了bootstrap.sh的作用了。读者可能会纳闷了，为啥要花这么大篇幅来介绍这个脚本文件？？吃饱了撑的吗。这是因为我们通过分析这个文件，知道了具体内部干了什么，知其然也要知其所以然嘛。这样，我们也可以不需要这个脚本文件，手动就能把环境搭建好！！</p> 
  <h3 id="08-参考资料">08 参考资料</h3> 
  <p>1.<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.2/install.html" rel="nofollow">https://hyperledger-fabric.readthedocs.io/en/release-1.2/install.html</a> <br> 2.《深度探索区块链：Hyperledger技术与应用》作者: 张增骏 / 董宁 / 朱轩彤 / 陈剑雄 出版社: 机械工业出版社 <br> 3. 《区块链开发实战 Hyperledger Fabric关键技术与案例分析》作者： 冯翔 刘涛 吴寿鹤 周广益 出版社：机械工业出版社 <br> 4. 《HyperLedger Fabric开发实战快速掌握区块链技术》作者：杨毅 出版社： 电子工业出版社</p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ltt1st/article/details/81332752,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ltt1st/article/details/81332752,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊宠物店搭建教程 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊宠物店搭建教程" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="设置开发环境 在我们开始之前，有一些技术要求。请安装以下内容： Node.js v6 + LTS和npm（自带Node）(https://nodejs.org/en/) 一旦我们安装了这些，我们只需要一个命令来安装Truffle： npm install -g truffle 要验证Truffle是否已正确安装，请truffle version在终端上键入。如果发现错误，请确保将npm模块添加到路径中。 我们还将使用Ganache，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。您可以通过导航到http://truffleframework.com/ganache并单击“下载”按钮来下载Ganache&nbsp;。 &nbsp; Truffle在当前目录中初始化，因此首先在您选择的开发文件夹中创建一个目录，然后在其中移动。 mkdir pet-shop-tutorial&nbsp; cd pet-shop-tutor mkdir pet-shop-tutorial cd pet-shop-tutorial al truffle unbox命令解压缩此松露盒。 truffle unbox命令解压缩此松露盒。 truffle unbox pet-shop truffle unbox pet-shop 目录结构 默认的Truffle目录结构包含以下内容： contracts/：包含我们的智能合约的Solidity源文件。这里有一个重要的合同Migrations.sol，我们将在后面讨论。 migrations/：Truffle使用迁移系统来处理智能合约部署。迁移是一种额外的特殊智能合约，可以跟踪变化。 test/：包含我们的智能合约的JavaScript和Solidity测试 truffle.js：松露配置文件 该pet-shop松露盒有额外的文件和文件夹，但我们不会担心这些，只是还没有。 &nbsp; 写出智能合约 我们将通过编写充当后端逻辑和存储的智能合约来启动我们的dapp。 1创建一个名为一个新的文件Adoption.sol在contracts/目录中。 2将以下内容添加到文件中： pragma solidity ^0.4.17;&nbsp; contract Adoption { &nbsp;} 需要注意的事项： 合同顶部注明了所需的最低Solidity版本：pragma solidity ^0.4.17;。该pragma命令表示“&nbsp;只有编译器关心的附加信息&nbsp;”，而插入符号（^）表示“&nbsp;指示的版本或更高&nbsp;”。 与JavaScript或PHP一样，语句以分号结束。 变量设置 &nbsp; &nbsp; Solidity是一种静态类型语言，意味着必须定义字符串，整数和数组等数据类型。Solidity有一种称为地址的独特类型。地址是以太坊地址，存储为20字节值。以太坊区块链上的每个账户和智能合约都有一个地址，可以通过该地址发送和接收以太网。、 之后的下一行添加以下变量contract Adoption { address[16]&nbsp;public&nbsp;adopters; &nbsp; 我们定义了一个变量：adopters。这是以太坊地址的数组。数组包含一种类型，可以具有固定或可变长度。在这种情况下，类型是address和长度是16。 你也会注意到adopters是公开的。公共变量具有自动getter方法，但在数组的情况下，需要一个键，并且只返回一个值。稍后，我们将编写一个函数来返回整个数组，以便在我们的UI中使用。 &nbsp; 你的第一个功能：采用宠物 1在我们上面设置的变量声明之后，将以下函数添加到智能合约中。 // Adopting a pet&nbsp; function&nbsp;adopt(uint petId)&nbsp;public&nbsp;returns (uint)&nbsp; {&nbsp; require(petId &gt;=&nbsp;0&nbsp;&amp;&amp;&nbsp;petId &lt;=&nbsp;15);&nbsp; adopters[petId]&nbsp;=&nbsp;msg.sender; &nbsp; return&nbsp;petId;&nbsp; } 需要注意的事项： &nbsp; 在Solidity中，必须指定函数参数和输出的类型。在这种情况下，我们将接受一个petId（整数）并返回一个整数。 &nbsp; 我们正在检查以确保petId在我们的adopters阵列范围内。Solidity中的数组从0开始索引，因此ID值必须介于0到15之间。我们使用该require()语句确保ID在范围内。 &nbsp; 如果ID在范围内，我们然后添加调用我们的adopters数组的地址。调用此函数的人或智能合约的地址表示为msg.sender。 &nbsp; 最后，我们将petId提供的内容作为确认返回。 &nbsp; &nbsp; &nbsp; &nbsp; 您的第二个功能：检索采用者 如上所述，数组getter仅从给定键返回单个值。我们的UI需要更新所有宠物采用状态，但进行16次API调用并不理想。所以我们下一步是编写一个函数来返回整个数组。 1在我们上面添加的getAdopters()函数之后，将以下函数添加到智能合约中adopt()： // Retrieving the adopters&nbsp; function&nbsp;getAdopters()&nbsp;public&nbsp;view returns (address[16])&nbsp;{ &nbsp;return&nbsp;adopters; &nbsp;} 既然adopters已经宣布，我们可以简单地归还它。请务必将返回类型（在本例中为类型adopters）指定为address[16]。 &nbsp; 编译和迁移智能合约 现在我们已经编写了智能合约，接下来的步骤是编译和迁移它。 Truffle有一个内置的开发者控制台，我们称之为Truffle Develop，它生成一个开发区块链，我们可以使用它来测试部署合同。它还能够直接从控制台运行Truffle命令。在本教程中，我们将使用Truffle Develop来执行我们合同中的大部分操作。 Solidity是一种编译语言，这意味着我们需要将我们的Solidity编译为字节码，以便执行以太坊虚拟机（EVM）。可以把它想象成将人类可读的Solidity翻译成EVM理解的东西。 1在终端中，确保您位于包含dapp的目录的根目录中并键入： truffle compile 您应该看到类似于以下内容的输出： Compiling ./contracts/Migrations.sol... Compiling ./contracts/Adoption.sol... Writing artifacts to ./build/contracts 移民 现在我们已经成功编译了合同，是时候将它们迁移到区块链了！ 迁移是一种部署脚本，用于更改应用程序合同的状态，将其从一个状态移动到另一个状态。对于第一次迁移，您可能只是部署新代码，但随着时间的推移，其他迁移可能会移动数据或用新代码替换合同。 您将在migrations/目录中看到一个JavaScript文件：1_initial_migration.js。这会处理部署Migrations.sol合同以观察后续智能合约迁移，并确保我们不会在未来双重迁移未更改的合同。 现在我们准备创建自己的迁移脚本了。 创建一个名为一个新的文件2_deploy_contracts.js在migrations/目录中。 将以下内容添加到2_deploy_contracts.js文件中： var&nbsp;Adoption =&nbsp;artifacts.require(&quot;Adoption&quot;);&nbsp;module.exports =&nbsp;function(deployer)&nbsp;{&nbsp;deployer.deploy(Adoption);&nbsp;}; 在我们将合同迁移到区块链之前，我们需要运行区块链。对于本教程，我们将使用Ganache，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。如果您还没有，请下载Ganache并双击该图标以启动该应用程序。这将生成在端口7545上本地运行的区块链。 回到我们的终端，将合同迁移到区块链。 truffle migrate truffle migrate 您应该看到类似于以下内容的输出： Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 您可以按顺序查看正在执行的迁移，然后是每个已部署合同的区块链地址。 在Ganache中，请注意区块链的状态已发生变化。现在，区块链显示了当前的块，0现在是4。此外，虽然第一个帐户最初有100个以太，但由于迁移的交易成本，它现在更低。我们稍后会详细讨论交易成本。 &nbsp; 迁移后的Ganache 您现在已经编写了第一份智能合约，并将其部署到本地运行的区块链中。现在是时候与我们的智能合约进行互动，以确保它能够满足我们的需求。 测试智能合约 Truffle在智能合约测试方面非常灵活，因为测试可以用JavaScript或Solidity编写。在本教程中，我们将在Solidity中编写测试。 创建一个名为一个新的文件TestAdoption.sol在test/目录中。 将以下内容添加到TestAdoption.sol文件中： pragma solidity ^0.4.17;&nbsp;import&nbsp;&quot;truffle/Assert.sol&quot;;&nbsp;import&nbsp;&quot;truffle/DeployedAddresses.sol&quot;;&nbsp;import&nbsp;&quot;../contracts/Adoption.sol&quot;;&nbsp;contract TestAdoption {&nbsp;Adoption adoption =&nbsp;Adoption(DeployedAddresses.Adoption());&nbsp;} 我们用3个进口开始合同： Assert.sol：给我们在测试中使用的各种断言。在测试中，断言检查诸如平等，不平等或空虚之类的事情，以便从我们的测试中返回通过/失败。以下是Truffle附带的断言的完整列表。 DeployedAddresses.sol：运行测试时，Truffle会将正在测试的合同的新实例部署到区块链。这个智能合约获得已部署合同的地址。 Adoption.sol：我们想要测试的智能合约。 注意：前两个导入是指全局Truffle文件，而不是truffle目录。您不应该在truffle目录中看到test/目录。 然后我们定义一个合约范围的变量，其中包含要测试的DeployedAddresses智能合约，调用智能合约来获取其地址。  测试adopt（）函数 要测试该adopt()功能，请记住，一旦成功，它将返回给定的petId。通过比较adopt()我们传入的ID&nbsp;的返回值，我们可以确保返回一个ID并且它是正确的。 TestAdoption.sol声明后，在智能合约中添加以下功能Adoption： &nbsp; // Testing the adopt() function&nbsp;function&nbsp;testUserCanAdoptPet()&nbsp;public&nbsp;{&nbsp;uint returnedId =&nbsp;adoption.adopt(8);&nbsp;uint expected =&nbsp;8;&nbsp;Assert.equal(returnedId,&nbsp;expected,&nbsp;&quot;Adoption of pet ID 8 should be recorded.&quot;);&nbsp;} &nbsp; 需要注意的事项： 我们将之前声明的智能合约称为ID&nbsp;8。 然后我们也声明了预期值8。 最后，我们传递实际值，期望值和失败消息（如果测试未通过则将其打印到控制台）Assert.equal()。 测试单个宠物主人的检索 记住上面公共变量有自动getter方法，我们可以检索上面的采用测试存储的地址。存储的数据将在我们的测试期间持续存在，因此我们对8上面的pet的采用可以通过其他测试来检索。 在以前添加的函数下面添加此函数TestAdoption.sol。 // Testing retrieval of a single pet&#39;s owner&nbsp;function&nbsp;testGetAdopterAddressByPetId()&nbsp;public&nbsp;{&nbsp;// Expected owner is this contract&nbsp;address expected =&nbsp;this;&nbsp;address adopter =&nbsp;adoption.adopters(8);&nbsp;Assert.equal(adopter,&nbsp;expected,&nbsp;&quot;Owner of pet ID 8 should be recorded.&quot;);&nbsp;} 由于TestAdoption合约将发送交易，我们将预期值设置为此，这是一个获得当前合约地址的合约范围变量。从那里我们就像上面所说的那样断言平等。  测试所有宠物主人的检索 由于数组只能在给定单个键的情况下返回单个值，因此我们为整个数组创建自己的getter。 在以前添加的函数下面添加此函数TestAdoption.sol。 // Testing retrieval of all pet owners&nbsp;function&nbsp;testGetAdopterAddressByPetIdInArray()&nbsp;public&nbsp;{ &nbsp;// Expected owner is this contract&nbsp; address expected =&nbsp;this;&nbsp; // Store adopters in memory rather than contract&#39;s storage&nbsp; address[16]&nbsp;memory adopters =&nbsp;adoption.getAdopters();&nbsp;Assert.equal(adopters[8],&nbsp;expected,&nbsp;&quot;Owner of pet ID 8 should be recorded.&quot;);&nbsp; } 请注意内存属性adopters。memory属性告诉Solidity将值临时存储在内存中，而不是将其保存到合同的存储中。由于adopters是一个数组，我们从第一次采用测试我们知道采用pet&nbsp;8，我们将测试合同地址与8数组中的位置进行比较。 &nbsp; &nbsp; 运行测试 回到终端，运行测试 运行测试 回到终端，运行测试： truffle test 如果所有测试都通过，您将看到与此类似的控制台输出： Using network &#39;development&#39;. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... TestAdoption ✓ testUserCanAdoptPet (91ms) ✓ testGetAdopterAddressByPetId (70ms) ✓ testGetAdopterAddressByPetIdInArray (89ms) 3 passing (670ms) &nbsp; &nbsp; 创建用户界面以与智能合约进行交互&lt;下一章&gt; &nbsp; 阅读更多" />
<meta property="og:description" content="设置开发环境 在我们开始之前，有一些技术要求。请安装以下内容： Node.js v6 + LTS和npm（自带Node）(https://nodejs.org/en/) 一旦我们安装了这些，我们只需要一个命令来安装Truffle： npm install -g truffle 要验证Truffle是否已正确安装，请truffle version在终端上键入。如果发现错误，请确保将npm模块添加到路径中。 我们还将使用Ganache，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。您可以通过导航到http://truffleframework.com/ganache并单击“下载”按钮来下载Ganache&nbsp;。 &nbsp; Truffle在当前目录中初始化，因此首先在您选择的开发文件夹中创建一个目录，然后在其中移动。 mkdir pet-shop-tutorial&nbsp; cd pet-shop-tutor mkdir pet-shop-tutorial cd pet-shop-tutorial al truffle unbox命令解压缩此松露盒。 truffle unbox命令解压缩此松露盒。 truffle unbox pet-shop truffle unbox pet-shop 目录结构 默认的Truffle目录结构包含以下内容： contracts/：包含我们的智能合约的Solidity源文件。这里有一个重要的合同Migrations.sol，我们将在后面讨论。 migrations/：Truffle使用迁移系统来处理智能合约部署。迁移是一种额外的特殊智能合约，可以跟踪变化。 test/：包含我们的智能合约的JavaScript和Solidity测试 truffle.js：松露配置文件 该pet-shop松露盒有额外的文件和文件夹，但我们不会担心这些，只是还没有。 &nbsp; 写出智能合约 我们将通过编写充当后端逻辑和存储的智能合约来启动我们的dapp。 1创建一个名为一个新的文件Adoption.sol在contracts/目录中。 2将以下内容添加到文件中： pragma solidity ^0.4.17;&nbsp; contract Adoption { &nbsp;} 需要注意的事项： 合同顶部注明了所需的最低Solidity版本：pragma solidity ^0.4.17;。该pragma命令表示“&nbsp;只有编译器关心的附加信息&nbsp;”，而插入符号（^）表示“&nbsp;指示的版本或更高&nbsp;”。 与JavaScript或PHP一样，语句以分号结束。 变量设置 &nbsp; &nbsp; Solidity是一种静态类型语言，意味着必须定义字符串，整数和数组等数据类型。Solidity有一种称为地址的独特类型。地址是以太坊地址，存储为20字节值。以太坊区块链上的每个账户和智能合约都有一个地址，可以通过该地址发送和接收以太网。、 之后的下一行添加以下变量contract Adoption { address[16]&nbsp;public&nbsp;adopters; &nbsp; 我们定义了一个变量：adopters。这是以太坊地址的数组。数组包含一种类型，可以具有固定或可变长度。在这种情况下，类型是address和长度是16。 你也会注意到adopters是公开的。公共变量具有自动getter方法，但在数组的情况下，需要一个键，并且只返回一个值。稍后，我们将编写一个函数来返回整个数组，以便在我们的UI中使用。 &nbsp; 你的第一个功能：采用宠物 1在我们上面设置的变量声明之后，将以下函数添加到智能合约中。 // Adopting a pet&nbsp; function&nbsp;adopt(uint petId)&nbsp;public&nbsp;returns (uint)&nbsp; {&nbsp; require(petId &gt;=&nbsp;0&nbsp;&amp;&amp;&nbsp;petId &lt;=&nbsp;15);&nbsp; adopters[petId]&nbsp;=&nbsp;msg.sender; &nbsp; return&nbsp;petId;&nbsp; } 需要注意的事项： &nbsp; 在Solidity中，必须指定函数参数和输出的类型。在这种情况下，我们将接受一个petId（整数）并返回一个整数。 &nbsp; 我们正在检查以确保petId在我们的adopters阵列范围内。Solidity中的数组从0开始索引，因此ID值必须介于0到15之间。我们使用该require()语句确保ID在范围内。 &nbsp; 如果ID在范围内，我们然后添加调用我们的adopters数组的地址。调用此函数的人或智能合约的地址表示为msg.sender。 &nbsp; 最后，我们将petId提供的内容作为确认返回。 &nbsp; &nbsp; &nbsp; &nbsp; 您的第二个功能：检索采用者 如上所述，数组getter仅从给定键返回单个值。我们的UI需要更新所有宠物采用状态，但进行16次API调用并不理想。所以我们下一步是编写一个函数来返回整个数组。 1在我们上面添加的getAdopters()函数之后，将以下函数添加到智能合约中adopt()： // Retrieving the adopters&nbsp; function&nbsp;getAdopters()&nbsp;public&nbsp;view returns (address[16])&nbsp;{ &nbsp;return&nbsp;adopters; &nbsp;} 既然adopters已经宣布，我们可以简单地归还它。请务必将返回类型（在本例中为类型adopters）指定为address[16]。 &nbsp; 编译和迁移智能合约 现在我们已经编写了智能合约，接下来的步骤是编译和迁移它。 Truffle有一个内置的开发者控制台，我们称之为Truffle Develop，它生成一个开发区块链，我们可以使用它来测试部署合同。它还能够直接从控制台运行Truffle命令。在本教程中，我们将使用Truffle Develop来执行我们合同中的大部分操作。 Solidity是一种编译语言，这意味着我们需要将我们的Solidity编译为字节码，以便执行以太坊虚拟机（EVM）。可以把它想象成将人类可读的Solidity翻译成EVM理解的东西。 1在终端中，确保您位于包含dapp的目录的根目录中并键入： truffle compile 您应该看到类似于以下内容的输出： Compiling ./contracts/Migrations.sol... Compiling ./contracts/Adoption.sol... Writing artifacts to ./build/contracts 移民 现在我们已经成功编译了合同，是时候将它们迁移到区块链了！ 迁移是一种部署脚本，用于更改应用程序合同的状态，将其从一个状态移动到另一个状态。对于第一次迁移，您可能只是部署新代码，但随着时间的推移，其他迁移可能会移动数据或用新代码替换合同。 您将在migrations/目录中看到一个JavaScript文件：1_initial_migration.js。这会处理部署Migrations.sol合同以观察后续智能合约迁移，并确保我们不会在未来双重迁移未更改的合同。 现在我们准备创建自己的迁移脚本了。 创建一个名为一个新的文件2_deploy_contracts.js在migrations/目录中。 将以下内容添加到2_deploy_contracts.js文件中： var&nbsp;Adoption =&nbsp;artifacts.require(&quot;Adoption&quot;);&nbsp;module.exports =&nbsp;function(deployer)&nbsp;{&nbsp;deployer.deploy(Adoption);&nbsp;}; 在我们将合同迁移到区块链之前，我们需要运行区块链。对于本教程，我们将使用Ganache，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。如果您还没有，请下载Ganache并双击该图标以启动该应用程序。这将生成在端口7545上本地运行的区块链。 回到我们的终端，将合同迁移到区块链。 truffle migrate truffle migrate 您应该看到类似于以下内容的输出： Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 您可以按顺序查看正在执行的迁移，然后是每个已部署合同的区块链地址。 在Ganache中，请注意区块链的状态已发生变化。现在，区块链显示了当前的块，0现在是4。此外，虽然第一个帐户最初有100个以太，但由于迁移的交易成本，它现在更低。我们稍后会详细讨论交易成本。 &nbsp; 迁移后的Ganache 您现在已经编写了第一份智能合约，并将其部署到本地运行的区块链中。现在是时候与我们的智能合约进行互动，以确保它能够满足我们的需求。 测试智能合约 Truffle在智能合约测试方面非常灵活，因为测试可以用JavaScript或Solidity编写。在本教程中，我们将在Solidity中编写测试。 创建一个名为一个新的文件TestAdoption.sol在test/目录中。 将以下内容添加到TestAdoption.sol文件中： pragma solidity ^0.4.17;&nbsp;import&nbsp;&quot;truffle/Assert.sol&quot;;&nbsp;import&nbsp;&quot;truffle/DeployedAddresses.sol&quot;;&nbsp;import&nbsp;&quot;../contracts/Adoption.sol&quot;;&nbsp;contract TestAdoption {&nbsp;Adoption adoption =&nbsp;Adoption(DeployedAddresses.Adoption());&nbsp;} 我们用3个进口开始合同： Assert.sol：给我们在测试中使用的各种断言。在测试中，断言检查诸如平等，不平等或空虚之类的事情，以便从我们的测试中返回通过/失败。以下是Truffle附带的断言的完整列表。 DeployedAddresses.sol：运行测试时，Truffle会将正在测试的合同的新实例部署到区块链。这个智能合约获得已部署合同的地址。 Adoption.sol：我们想要测试的智能合约。 注意：前两个导入是指全局Truffle文件，而不是truffle目录。您不应该在truffle目录中看到test/目录。 然后我们定义一个合约范围的变量，其中包含要测试的DeployedAddresses智能合约，调用智能合约来获取其地址。  测试adopt（）函数 要测试该adopt()功能，请记住，一旦成功，它将返回给定的petId。通过比较adopt()我们传入的ID&nbsp;的返回值，我们可以确保返回一个ID并且它是正确的。 TestAdoption.sol声明后，在智能合约中添加以下功能Adoption： &nbsp; // Testing the adopt() function&nbsp;function&nbsp;testUserCanAdoptPet()&nbsp;public&nbsp;{&nbsp;uint returnedId =&nbsp;adoption.adopt(8);&nbsp;uint expected =&nbsp;8;&nbsp;Assert.equal(returnedId,&nbsp;expected,&nbsp;&quot;Adoption of pet ID 8 should be recorded.&quot;);&nbsp;} &nbsp; 需要注意的事项： 我们将之前声明的智能合约称为ID&nbsp;8。 然后我们也声明了预期值8。 最后，我们传递实际值，期望值和失败消息（如果测试未通过则将其打印到控制台）Assert.equal()。 测试单个宠物主人的检索 记住上面公共变量有自动getter方法，我们可以检索上面的采用测试存储的地址。存储的数据将在我们的测试期间持续存在，因此我们对8上面的pet的采用可以通过其他测试来检索。 在以前添加的函数下面添加此函数TestAdoption.sol。 // Testing retrieval of a single pet&#39;s owner&nbsp;function&nbsp;testGetAdopterAddressByPetId()&nbsp;public&nbsp;{&nbsp;// Expected owner is this contract&nbsp;address expected =&nbsp;this;&nbsp;address adopter =&nbsp;adoption.adopters(8);&nbsp;Assert.equal(adopter,&nbsp;expected,&nbsp;&quot;Owner of pet ID 8 should be recorded.&quot;);&nbsp;} 由于TestAdoption合约将发送交易，我们将预期值设置为此，这是一个获得当前合约地址的合约范围变量。从那里我们就像上面所说的那样断言平等。  测试所有宠物主人的检索 由于数组只能在给定单个键的情况下返回单个值，因此我们为整个数组创建自己的getter。 在以前添加的函数下面添加此函数TestAdoption.sol。 // Testing retrieval of all pet owners&nbsp;function&nbsp;testGetAdopterAddressByPetIdInArray()&nbsp;public&nbsp;{ &nbsp;// Expected owner is this contract&nbsp; address expected =&nbsp;this;&nbsp; // Store adopters in memory rather than contract&#39;s storage&nbsp; address[16]&nbsp;memory adopters =&nbsp;adoption.getAdopters();&nbsp;Assert.equal(adopters[8],&nbsp;expected,&nbsp;&quot;Owner of pet ID 8 should be recorded.&quot;);&nbsp; } 请注意内存属性adopters。memory属性告诉Solidity将值临时存储在内存中，而不是将其保存到合同的存储中。由于adopters是一个数组，我们从第一次采用测试我们知道采用pet&nbsp;8，我们将测试合同地址与8数组中的位置进行比较。 &nbsp; &nbsp; 运行测试 回到终端，运行测试 运行测试 回到终端，运行测试： truffle test 如果所有测试都通过，您将看到与此类似的控制台输出： Using network &#39;development&#39;. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... TestAdoption ✓ testUserCanAdoptPet (91ms) ✓ testGetAdopterAddressByPetId (70ms) ✓ testGetAdopterAddressByPetIdInArray (89ms) 3 passing (670ms) &nbsp; &nbsp; 创建用户界面以与智能合约进行交互&lt;下一章&gt; &nbsp; 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-15T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"设置开发环境 在我们开始之前，有一些技术要求。请安装以下内容： Node.js v6 + LTS和npm（自带Node）(https://nodejs.org/en/) 一旦我们安装了这些，我们只需要一个命令来安装Truffle： npm install -g truffle 要验证Truffle是否已正确安装，请truffle version在终端上键入。如果发现错误，请确保将npm模块添加到路径中。 我们还将使用Ganache，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。您可以通过导航到http://truffleframework.com/ganache并单击“下载”按钮来下载Ganache&nbsp;。 &nbsp; Truffle在当前目录中初始化，因此首先在您选择的开发文件夹中创建一个目录，然后在其中移动。 mkdir pet-shop-tutorial&nbsp; cd pet-shop-tutor mkdir pet-shop-tutorial cd pet-shop-tutorial al truffle unbox命令解压缩此松露盒。 truffle unbox命令解压缩此松露盒。 truffle unbox pet-shop truffle unbox pet-shop 目录结构 默认的Truffle目录结构包含以下内容： contracts/：包含我们的智能合约的Solidity源文件。这里有一个重要的合同Migrations.sol，我们将在后面讨论。 migrations/：Truffle使用迁移系统来处理智能合约部署。迁移是一种额外的特殊智能合约，可以跟踪变化。 test/：包含我们的智能合约的JavaScript和Solidity测试 truffle.js：松露配置文件 该pet-shop松露盒有额外的文件和文件夹，但我们不会担心这些，只是还没有。 &nbsp; 写出智能合约 我们将通过编写充当后端逻辑和存储的智能合约来启动我们的dapp。 1创建一个名为一个新的文件Adoption.sol在contracts/目录中。 2将以下内容添加到文件中： pragma solidity ^0.4.17;&nbsp; contract Adoption { &nbsp;} 需要注意的事项： 合同顶部注明了所需的最低Solidity版本：pragma solidity ^0.4.17;。该pragma命令表示“&nbsp;只有编译器关心的附加信息&nbsp;”，而插入符号（^）表示“&nbsp;指示的版本或更高&nbsp;”。 与JavaScript或PHP一样，语句以分号结束。 变量设置 &nbsp; &nbsp; Solidity是一种静态类型语言，意味着必须定义字符串，整数和数组等数据类型。Solidity有一种称为地址的独特类型。地址是以太坊地址，存储为20字节值。以太坊区块链上的每个账户和智能合约都有一个地址，可以通过该地址发送和接收以太网。、 之后的下一行添加以下变量contract Adoption { address[16]&nbsp;public&nbsp;adopters; &nbsp; 我们定义了一个变量：adopters。这是以太坊地址的数组。数组包含一种类型，可以具有固定或可变长度。在这种情况下，类型是address和长度是16。 你也会注意到adopters是公开的。公共变量具有自动getter方法，但在数组的情况下，需要一个键，并且只返回一个值。稍后，我们将编写一个函数来返回整个数组，以便在我们的UI中使用。 &nbsp; 你的第一个功能：采用宠物 1在我们上面设置的变量声明之后，将以下函数添加到智能合约中。 // Adopting a pet&nbsp; function&nbsp;adopt(uint petId)&nbsp;public&nbsp;returns (uint)&nbsp; {&nbsp; require(petId &gt;=&nbsp;0&nbsp;&amp;&amp;&nbsp;petId &lt;=&nbsp;15);&nbsp; adopters[petId]&nbsp;=&nbsp;msg.sender; &nbsp; return&nbsp;petId;&nbsp; } 需要注意的事项： &nbsp; 在Solidity中，必须指定函数参数和输出的类型。在这种情况下，我们将接受一个petId（整数）并返回一个整数。 &nbsp; 我们正在检查以确保petId在我们的adopters阵列范围内。Solidity中的数组从0开始索引，因此ID值必须介于0到15之间。我们使用该require()语句确保ID在范围内。 &nbsp; 如果ID在范围内，我们然后添加调用我们的adopters数组的地址。调用此函数的人或智能合约的地址表示为msg.sender。 &nbsp; 最后，我们将petId提供的内容作为确认返回。 &nbsp; &nbsp; &nbsp; &nbsp; 您的第二个功能：检索采用者 如上所述，数组getter仅从给定键返回单个值。我们的UI需要更新所有宠物采用状态，但进行16次API调用并不理想。所以我们下一步是编写一个函数来返回整个数组。 1在我们上面添加的getAdopters()函数之后，将以下函数添加到智能合约中adopt()： // Retrieving the adopters&nbsp; function&nbsp;getAdopters()&nbsp;public&nbsp;view returns (address[16])&nbsp;{ &nbsp;return&nbsp;adopters; &nbsp;} 既然adopters已经宣布，我们可以简单地归还它。请务必将返回类型（在本例中为类型adopters）指定为address[16]。 &nbsp; 编译和迁移智能合约 现在我们已经编写了智能合约，接下来的步骤是编译和迁移它。 Truffle有一个内置的开发者控制台，我们称之为Truffle Develop，它生成一个开发区块链，我们可以使用它来测试部署合同。它还能够直接从控制台运行Truffle命令。在本教程中，我们将使用Truffle Develop来执行我们合同中的大部分操作。 Solidity是一种编译语言，这意味着我们需要将我们的Solidity编译为字节码，以便执行以太坊虚拟机（EVM）。可以把它想象成将人类可读的Solidity翻译成EVM理解的东西。 1在终端中，确保您位于包含dapp的目录的根目录中并键入： truffle compile 您应该看到类似于以下内容的输出： Compiling ./contracts/Migrations.sol... Compiling ./contracts/Adoption.sol... Writing artifacts to ./build/contracts 移民 现在我们已经成功编译了合同，是时候将它们迁移到区块链了！ 迁移是一种部署脚本，用于更改应用程序合同的状态，将其从一个状态移动到另一个状态。对于第一次迁移，您可能只是部署新代码，但随着时间的推移，其他迁移可能会移动数据或用新代码替换合同。 您将在migrations/目录中看到一个JavaScript文件：1_initial_migration.js。这会处理部署Migrations.sol合同以观察后续智能合约迁移，并确保我们不会在未来双重迁移未更改的合同。 现在我们准备创建自己的迁移脚本了。 创建一个名为一个新的文件2_deploy_contracts.js在migrations/目录中。 将以下内容添加到2_deploy_contracts.js文件中： var&nbsp;Adoption =&nbsp;artifacts.require(&quot;Adoption&quot;);&nbsp;module.exports =&nbsp;function(deployer)&nbsp;{&nbsp;deployer.deploy(Adoption);&nbsp;}; 在我们将合同迁移到区块链之前，我们需要运行区块链。对于本教程，我们将使用Ganache，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。如果您还没有，请下载Ganache并双击该图标以启动该应用程序。这将生成在端口7545上本地运行的区块链。 回到我们的终端，将合同迁移到区块链。 truffle migrate truffle migrate 您应该看到类似于以下内容的输出： Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 您可以按顺序查看正在执行的迁移，然后是每个已部署合同的区块链地址。 在Ganache中，请注意区块链的状态已发生变化。现在，区块链显示了当前的块，0现在是4。此外，虽然第一个帐户最初有100个以太，但由于迁移的交易成本，它现在更低。我们稍后会详细讨论交易成本。 &nbsp; 迁移后的Ganache 您现在已经编写了第一份智能合约，并将其部署到本地运行的区块链中。现在是时候与我们的智能合约进行互动，以确保它能够满足我们的需求。 测试智能合约 Truffle在智能合约测试方面非常灵活，因为测试可以用JavaScript或Solidity编写。在本教程中，我们将在Solidity中编写测试。 创建一个名为一个新的文件TestAdoption.sol在test/目录中。 将以下内容添加到TestAdoption.sol文件中： pragma solidity ^0.4.17;&nbsp;import&nbsp;&quot;truffle/Assert.sol&quot;;&nbsp;import&nbsp;&quot;truffle/DeployedAddresses.sol&quot;;&nbsp;import&nbsp;&quot;../contracts/Adoption.sol&quot;;&nbsp;contract TestAdoption {&nbsp;Adoption adoption =&nbsp;Adoption(DeployedAddresses.Adoption());&nbsp;} 我们用3个进口开始合同： Assert.sol：给我们在测试中使用的各种断言。在测试中，断言检查诸如平等，不平等或空虚之类的事情，以便从我们的测试中返回通过/失败。以下是Truffle附带的断言的完整列表。 DeployedAddresses.sol：运行测试时，Truffle会将正在测试的合同的新实例部署到区块链。这个智能合约获得已部署合同的地址。 Adoption.sol：我们想要测试的智能合约。 注意：前两个导入是指全局Truffle文件，而不是truffle目录。您不应该在truffle目录中看到test/目录。 然后我们定义一个合约范围的变量，其中包含要测试的DeployedAddresses智能合约，调用智能合约来获取其地址。  测试adopt（）函数 要测试该adopt()功能，请记住，一旦成功，它将返回给定的petId。通过比较adopt()我们传入的ID&nbsp;的返回值，我们可以确保返回一个ID并且它是正确的。 TestAdoption.sol声明后，在智能合约中添加以下功能Adoption： &nbsp; // Testing the adopt() function&nbsp;function&nbsp;testUserCanAdoptPet()&nbsp;public&nbsp;{&nbsp;uint returnedId =&nbsp;adoption.adopt(8);&nbsp;uint expected =&nbsp;8;&nbsp;Assert.equal(returnedId,&nbsp;expected,&nbsp;&quot;Adoption of pet ID 8 should be recorded.&quot;);&nbsp;} &nbsp; 需要注意的事项： 我们将之前声明的智能合约称为ID&nbsp;8。 然后我们也声明了预期值8。 最后，我们传递实际值，期望值和失败消息（如果测试未通过则将其打印到控制台）Assert.equal()。 测试单个宠物主人的检索 记住上面公共变量有自动getter方法，我们可以检索上面的采用测试存储的地址。存储的数据将在我们的测试期间持续存在，因此我们对8上面的pet的采用可以通过其他测试来检索。 在以前添加的函数下面添加此函数TestAdoption.sol。 // Testing retrieval of a single pet&#39;s owner&nbsp;function&nbsp;testGetAdopterAddressByPetId()&nbsp;public&nbsp;{&nbsp;// Expected owner is this contract&nbsp;address expected =&nbsp;this;&nbsp;address adopter =&nbsp;adoption.adopters(8);&nbsp;Assert.equal(adopter,&nbsp;expected,&nbsp;&quot;Owner of pet ID 8 should be recorded.&quot;);&nbsp;} 由于TestAdoption合约将发送交易，我们将预期值设置为此，这是一个获得当前合约地址的合约范围变量。从那里我们就像上面所说的那样断言平等。  测试所有宠物主人的检索 由于数组只能在给定单个键的情况下返回单个值，因此我们为整个数组创建自己的getter。 在以前添加的函数下面添加此函数TestAdoption.sol。 // Testing retrieval of all pet owners&nbsp;function&nbsp;testGetAdopterAddressByPetIdInArray()&nbsp;public&nbsp;{ &nbsp;// Expected owner is this contract&nbsp; address expected =&nbsp;this;&nbsp; // Store adopters in memory rather than contract&#39;s storage&nbsp; address[16]&nbsp;memory adopters =&nbsp;adoption.getAdopters();&nbsp;Assert.equal(adopters[8],&nbsp;expected,&nbsp;&quot;Owner of pet ID 8 should be recorded.&quot;);&nbsp; } 请注意内存属性adopters。memory属性告诉Solidity将值临时存储在内存中，而不是将其保存到合同的存储中。由于adopters是一个数组，我们从第一次采用测试我们知道采用pet&nbsp;8，我们将测试合同地址与8数组中的位置进行比较。 &nbsp; &nbsp; 运行测试 回到终端，运行测试 运行测试 回到终端，运行测试： truffle test 如果所有测试都通过，您将看到与此类似的控制台输出： Using network &#39;development&#39;. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... TestAdoption ✓ testUserCanAdoptPet (91ms) ✓ testGetAdopterAddressByPetId (70ms) ✓ testGetAdopterAddressByPetIdInArray (89ms) 3 passing (670ms) &nbsp; &nbsp; 创建用户界面以与智能合约进行交互&lt;下一章&gt; &nbsp; 阅读更多","@type":"BlogPosting","url":"/2018/08/15/c689bc537c374562fcb7752d333e87c1.html","headline":"以太坊宠物店搭建教程","dateModified":"2018-08-15T00:00:00+08:00","datePublished":"2018-08-15T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/15/c689bc537c374562fcb7752d333e87c1.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊宠物店搭建教程</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h2 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>设置开发环境</strong></span></strong></strong></h2> 
  <p style="margin-left:0pt;"><span style="color:#545452;">在我们开始之前，有一些技术要求。请安装以下内容：</span></p> 
  <ul>
   <li><a href="https://nodejs.org/en/" rel="nofollow"><span style="color:#337ab7;">Node.js v6 + LTS和npm</span></a><span style="color:#545452;">（自带Node）</span><span style="color:#545452;">(https://nodejs.org/en/)</span></li> 
  </ul>
  <p style="margin-left:0pt;"><span style="color:#545452;">一旦我们安装了这些，我们只需要一个命令来安装Truffle：</span></p> 
  <p style="margin-left:0pt;"><span style="color:#ffffff;">npm install -g truffle</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">要验证Truffle是否已正确安装，请</span><span style="color:#c7254e;">truffle version</span><span style="color:#545452;">在终端上键入。如果发现错误，请确保将npm模块添加到路径中。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">我们还将使用</span><a href="https://truffleframework.com/ganache" rel="nofollow"><span style="color:#337ab7;">Ganache</span></a><span style="color:#545452;">，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。您可以通过导航到</span><a href="http://truffleframework.com/ganache" rel="nofollow"><span style="color:#337ab7;">http://truffleframework.com/ganache</span></a><span style="color:#545452;">并单击“下载”按钮来下载Ganache&nbsp;。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">Truffle在当前目录中初始化，因此首先在您选择的开发文件夹中创建一个目录，然后在其中移动。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#ffffff;">mkdir pet-shop-tutorial</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#ffffff;">cd pet-shop-tutor</span></p> 
  <pre class="has">
<code>mkdir pet-shop-tutorial 
cd pet-shop-tutorial</code></pre> 
  <p style="margin-left:0pt;"><span style="color:#ffffff;">al</span></p> 
  <p style="margin-left:0pt;"><span style="color:#c7254e;">truffle unbox</span><span style="color:#545452;">命令解压缩此松露盒。</span></p> 
  <pre class="has">
<code>truffle unbox命令解压缩此松露盒。
truffle unbox pet-shop</code></pre> 
  <p style="margin-left:0pt;"><span style="color:#ffffff;">truffle unbox pet-shop</span></p> 
  <h3 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>目录结构</strong></span></strong></strong></h3> 
  <p style="margin-left:0pt;"><span style="color:#545452;">默认的Truffle目录结构包含以下内容：</span></p> 
  <ul>
   <li><span style="color:#c7254e;">contracts/</span><span style="color:#545452;">：包含我们的智能合约的</span><a href="https://solidity.readthedocs.io/" rel="nofollow"><span style="color:#337ab7;">Solidity</span></a><span style="color:#545452;">源文件。这里有一个重要的合同</span><span style="color:#c7254e;">Migrations.sol</span><span style="color:#545452;">，我们将在后面讨论。</span></li> 
   <li><span style="color:#c7254e;">migrations/</span><span style="color:#545452;">：Truffle使用迁移系统来处理智能合约部署。迁移是一种额外的特殊智能合约，可以跟踪变化。</span></li> 
   <li><span style="color:#c7254e;">test/</span><span style="color:#545452;">：包含我们的智能合约的JavaScript和Solidity测试</span></li> 
   <li><span style="color:#c7254e;">truffle.js</span><span style="color:#545452;">：松露配置文件</span></li> 
  </ul>
  <p style="margin-left:0pt;"><span style="color:#545452;">该</span><span style="color:#c7254e;">pet-shop</span><span style="color:#545452;">松露盒有额外的文件和文件夹，但我们不会担心这些，只是还没有。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <h2 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>写出智能合约</strong></span></strong></strong></h2> 
  <p style="margin-left:0pt;"><span style="color:#545452;">我们将通过编写充当后端逻辑和存储的智能合约来启动我们的dapp。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">1</span><span style="color:#545452;">创建一个名为一个新的文件</span><span style="color:#c7254e;">Adoption.sol</span><span style="color:#545452;">在</span><span style="color:#c7254e;">contracts/</span><span style="color:#545452;">目录中。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">2</span><span style="color:#545452;">将以下内容添加到文件中：</span></p> 
  <p style="margin-left:0pt;"><span style="color:#000000;">pragma solidity </span><span style="color:#a67f59;">^</span><span style="color:#990055;">0.4</span><span style="color:#999999;">.</span><span style="color:#990055;">17</span><span style="color:#999999;">;</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#000000;">contract Adoption </span><span style="color:#999999;">{</span></p> 
  <p style="margin-left:0pt;">&nbsp;<span style="color:#999999;">}</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">需要注意的事项：</span></p> 
  <ul>
   <li><span style="color:#545452;">合同顶部注明了所需的最低Solidity版本：</span><span style="color:#c7254e;">pragma solidity ^0.4.17;</span><span style="color:#545452;">。该</span><span style="color:#c7254e;">pragma</span><span style="color:#545452;">命令表示“&nbsp;</span><span style="color:#545452;">只有编译器关心的附加信息</span><span style="color:#545452;">&nbsp;”，而插入符号（^）表示“&nbsp;</span><span style="color:#545452;">指示的版本或更高</span><span style="color:#545452;">&nbsp;”。</span></li> 
   <li><span style="color:#545452;">与JavaScript或PHP一样，语句以分号结束。</span></li> 
  </ul>
  <p><strong><strong><span style="color:#545452;"><strong>变量设置</strong></span></strong></strong></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">Solidity是一种静态类型语言，意味着必须定义字符串，整数和数组等数据类型。</span><strong><span style="color:#545452;"><strong>Solidity有一种称为地址的独特类型</strong></span></strong><span style="color:#545452;">。地址是以太坊地址，存储为20字节值。以太坊区块链上的每个账户和智能合约都有一个地址，可以通过该地址发送和接收以太网。</span><span style="color:#545452;">、</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">之后的下一行添加以下变量</span><span style="color:#c7254e;">contract Adoption {</span></p> 
  <p style="margin-left:0pt;"><span style="color:#000000;">address</span><span style="color:#999999;">[</span><span style="color:#990055;">16</span><span style="color:#999999;">]</span>&nbsp;<span style="color:#0077aa;">public</span><span style="color:#000000;">&nbsp;adopters</span><span style="color:#999999;">;</span></p> 
  <ul>
   <li>&nbsp;</li> 
  </ul>
  <p style="margin-left:0pt;"><span style="color:#545452;">我们定义了一个变量：</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">。这是以太坊地址的</span><strong><span style="color:#545452;"><strong>数组</strong></span></strong><span style="color:#545452;">。数组包含一种类型，可以具有固定或可变长度。在这种情况下，类型是</span><span style="color:#c7254e;">address</span><span style="color:#545452;">和长度是</span><span style="color:#c7254e;">16</span><span style="color:#c7254e;">。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">你也会注意到</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">是公开的。</span><strong><span style="color:#545452;"><strong>公共</strong></span></strong><span style="color:#545452;">变量具有自动getter方法，但在数组的情况下，需要一个键，并且只返回一个值。稍后，我们将编写一个函数来返回整个数组，以便在我们的UI中使用。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <h3 style="margin-left:21pt;"><strong><strong><span style="color:#545452;"><strong>你的第一个功能：采用宠物</strong></span></strong></strong></h3> 
  <p style="margin-left:0pt;"><span style="color:#545452;">1</span><span style="color:#545452;">在我们上面设置的变量声明之后，将以下函数添加到智能合约中。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#708090;">// Adopting a pet</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#0077aa;">function</span>&nbsp;<span style="color:#dd4a68;">adopt</span><span style="color:#999999;">(</span><span style="color:#000000;">uint petId</span><span style="color:#999999;">)</span>&nbsp;<span style="color:#0077aa;">public</span><span style="color:#000000;">&nbsp;returns </span><span style="color:#999999;">(</span><span style="color:#000000;">uint</span><span style="color:#999999;">)</span>&nbsp; <span style="color:#999999;">{</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#dd4a68;">require</span><span style="color:#999999;">(</span><span style="color:#000000;">petId </span><span style="color:#a67f59;">&gt;=</span>&nbsp;<span style="color:#990055;">0</span>&nbsp;<span style="color:#a67f59;">&amp;&amp;</span><span style="color:#000000;">&nbsp;petId </span><span style="color:#a67f59;">&lt;=</span>&nbsp;<span style="color:#990055;">15</span><span style="color:#999999;">);</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#000000;">adopters</span><span style="color:#999999;">[</span><span style="color:#000000;">petId</span><span style="color:#999999;">]</span>&nbsp;<span style="color:#a67f59;">=</span><span style="color:#000000;">&nbsp;msg</span><span style="color:#999999;">.</span><span style="color:#000000;">sender</span><span style="color:#999999;">;</span> &nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#0077aa;">return</span><span style="color:#000000;">&nbsp;petId</span><span style="color:#999999;">;</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#999999;">}</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">需要注意的事项：</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">在Solidity中，必须指定函数参数和输出的类型。在这种情况下，我们将接受一个</span><span style="color:#c7254e;">petId</span><span style="color:#545452;">（整数）并返回一个整数。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">我们正在检查以确保</span><span style="color:#c7254e;">petId</span><span style="color:#545452;">在我们的</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">阵列范围内。Solidity中的数组从0开始索引，因此ID值必须介于0到15之间。我们使用该</span><span style="color:#c7254e;">require()</span><span style="color:#545452;">语句确保ID在范围内。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">如果ID在范围内，我们然后添加调用我们的</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">数组的地址。</span><strong><span style="color:#545452;"><strong>调用此函数的人或智能合约的地址表示为</strong></span></strong><strong><span style="color:#c7254e;"><strong>msg.sender</strong></span></strong><span style="color:#545452;">。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">最后，我们将</span><span style="color:#c7254e;">petId</span><span style="color:#545452;">提供的内容作为确认返回。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <h3 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>您的第二个功能：检索采用者</strong></span></strong></strong></h3> 
  <p style="margin-left:0pt;"><span style="color:#545452;">如上所述，数组getter仅从给定键返回单个值。我们的UI需要更新所有宠物采用状态，但进行16次API调用并不理想。所以我们下一步是编写一个函数来返回整个数组。</span></p> 
  <p style="margin-left:0pt;">1<span style="color:#545452;">在</span><span style="color:#545452;">我们上面添加的</span><span style="color:#c7254e;">getAdopters()</span><span style="color:#545452;">函数之后，将以下函数添加到智能合约中</span><span style="color:#c7254e;">adopt()</span><span style="color:#545452;">：</span></p> 
  <p style="margin-left:0pt;"><span style="color:#708090;">// Retrieving the adopters</span>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#0077aa;">function</span>&nbsp;<span style="color:#dd4a68;">getAdopters</span><span style="color:#999999;">()</span>&nbsp;<span style="color:#0077aa;">public</span><span style="color:#000000;">&nbsp;view returns </span><span style="color:#999999;">(</span><span style="color:#000000;">address</span><span style="color:#999999;">[</span><span style="color:#990055;">16</span><span style="color:#999999;">])</span>&nbsp;<span style="color:#999999;">{</span></p> 
  <p style="margin-left:0pt;">&nbsp;<span style="color:#0077aa;">return</span><span style="color:#000000;">&nbsp;adopters</span><span style="color:#999999;">;</span></p> 
  <p style="margin-left:0pt;">&nbsp;<span style="color:#999999;">}</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">既然</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">已经宣布，我们可以简单地归还它。请务必将返回类型（在本例中为类型</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">）指定为</span><span style="color:#c7254e;">address[16]</span><span style="color:#545452;">。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <h2 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>编译和迁移智能合约</strong></span></strong></strong></h2> 
  <p style="margin-left:0pt;"><span style="color:#545452;">现在我们已经编写了智能合约，接下来的步骤是编译和迁移它。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">Truffle有一个内置的开发者控制台，我们称之为Truffle Develop，它生成一个开发区块链，我们可以使用它来测试部署合同。它还能够直接从控制台运行Truffle命令。在本教程中，我们将使用Truffle Develop来执行我们合同中的大部分操作。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">Solidity是一种编译语言，这意味着我们需要将我们的Solidity编译为字节码，以便执行以太坊虚拟机（EVM）。可以把它想象成将人类可读的Solidity翻译成EVM理解的东西。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">1</span><span style="color:#545452;">在终端中，确保您位于包含dapp的目录的根目录中并键入：</span></p> 
  <pre class="has">
<code>truffle compile
您应该看到类似于以下内容的输出：
Compiling ./contracts/Migrations.sol... 
Compiling ./contracts/Adoption.sol... 
Writing artifacts to ./build/contracts</code></pre> 
  <h3 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>移民</strong></span></strong></strong></h3> 
  <p style="margin-left:0pt;"><span style="color:#545452;">现在我们已经成功编译了合同，是时候将它们迁移到区块链了！</span></p> 
  <p style="margin-left:0pt;"><strong><span style="color:#545452;"><strong>迁移是一种部署脚本，用于更改应用程序合同的状态</strong></span></strong><span style="color:#545452;">，将其从一个状态移动到另一个状态。对于第一次迁移，您可能只是部署新代码，但随着时间的推移，其他迁移可能会移动数据或用新代码替换合同。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">您将在</span><span style="color:#c7254e;">migrations/</span><span style="color:#545452;">目录中看到一个JavaScript文件：</span><span style="color:#c7254e;">1_initial_migration.js</span><span style="color:#545452;">。这会处理部署</span><span style="color:#c7254e;">Migrations.sol</span><span style="color:#545452;">合同以观察后续智能合约迁移，并确保我们不会在未来双重迁移未更改的合同。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">现在我们准备创建自己的迁移脚本了。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">创建一个名为一个新的文件</span><span style="color:#c7254e;">2_deploy_contracts.js</span><span style="color:#545452;">在</span><span style="color:#c7254e;">migrations/</span><span style="color:#545452;">目录中。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">将以下内容添加到</span><span style="color:#c7254e;">2_deploy_contracts.js</span><span style="color:#545452;">文件中：</span></p> 
  <p style="margin-left:0pt;"><span style="color:#0077aa;">var</span><span style="color:#000000;">&nbsp;Adoption </span><span style="color:#a67f59;">=</span><span style="color:#000000;">&nbsp;artifacts</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">require</span><span style="color:#999999;">(</span><span style="color:#669900;">"Adoption"</span><span style="color:#999999;">);</span><span style="color:#000000;">&nbsp;module</span><span style="color:#999999;">.</span><span style="color:#000000;">exports </span><span style="color:#a67f59;">=</span>&nbsp;<span style="color:#0077aa;">function</span><span style="color:#999999;">(</span><span style="color:#000000;">deployer</span><span style="color:#999999;">)</span>&nbsp;<span style="color:#999999;">{</span><span style="color:#000000;">&nbsp;deployer</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">deploy</span><span style="color:#999999;">(</span><span style="color:#000000;">Adoption</span><span style="color:#999999;">);</span>&nbsp;<span style="color:#999999;">};</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">在我们将合同迁移到区块链之前，我们需要运行区块链。</span><span style="color:#545452;">对于本教程，我们将使用</span><a href="https://truffleframework.com/ganache" rel="nofollow"><span style="color:#337ab7;">Ganache</span></a><span style="color:#545452;">，一个用于以太坊开发的个人区块链，您可以使用它来部署合同，开发应用程序和运行测试。如果您还没有，请</span><a href="https://truffleframework.com/ganache" rel="nofollow"><span style="color:#337ab7;">下载Ganache</span></a><span style="color:#545452;">并双击该图标以启动该应用程序。这将生成在端口7545上本地运行的区块链。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">回到我们的终端，将合同迁移到区块链。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#ffffff;">truffle migrate</span></p> 
  <pre class="has">
<code>truffle migrate
您应该看到类似于以下内容的输出：
Using network 'development'. 
Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 </code></pre> 
  <p style="margin-left:0pt;"><span style="color:#545452;">您可以按顺序查看正在执行的迁移，然后是每个已部署合同的区块链地址。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">在Ganache中，请注意区块链的状态已发生变化。现在，区块链显示了当前的块，</span><span style="color:#c7254e;">0</span><span style="color:#545452;">现在是</span><span style="color:#c7254e;">4</span><span style="color:#545452;">。此外，虽然第一个帐户最初有100个以太，但由于迁移的交易成本，它现在更低。我们稍后会详细讨论交易成本。</span></p> 
  <p style="margin-left:0pt;">&nbsp;</p> 
  <p style="margin-left:0pt;"><em><span style="color:#545452;"><em>迁移后的Ganache</em></span></em></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">您现在已经编写了第一份智能合约，并将其部署到本地运行的区块链中。现在是时候与我们的智能合约进行互动，以确保它能够满足我们的需求。</span></p> 
  <h2 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>测试智能合约</strong></span></strong></strong></h2> 
  <p style="margin-left:0pt;"><span style="color:#545452;">Truffle在智能合约测试方面非常灵活，因为测试可以用JavaScript或Solidity编写。在本教程中，我们将在Solidity中编写测试。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">创建一个名为一个新的文件</span><span style="color:#c7254e;">TestAdoption.sol</span><span style="color:#545452;">在</span><span style="color:#c7254e;">test/</span><span style="color:#545452;">目录中。</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">将以下内容添加到</span><span style="color:#c7254e;">TestAdoption.sol</span><span style="color:#545452;">文件中：</span></p> 
  <p style="margin-left:0pt;"><span style="color:#000000;">pragma solidity </span><span style="color:#a67f59;">^</span><span style="color:#990055;">0.4</span><span style="color:#999999;">.</span><span style="color:#990055;">17</span><span style="color:#999999;">;</span>&nbsp;<span style="color:#0077aa;">import</span>&nbsp;<span style="color:#669900;">"truffle/Assert.sol"</span><span style="color:#999999;">;</span>&nbsp;<span style="color:#0077aa;">import</span>&nbsp;<span style="color:#669900;">"truffle/DeployedAddresses.sol"</span><span style="color:#999999;">;</span>&nbsp;<span style="color:#0077aa;">import</span>&nbsp;<span style="color:#669900;">"../contracts/Adoption.sol"</span><span style="color:#999999;">;</span><span style="color:#000000;">&nbsp;contract TestAdoption </span><span style="color:#999999;">{</span><span style="color:#000000;">&nbsp;Adoption adoption </span><span style="color:#a67f59;">=</span>&nbsp;<span style="color:#dd4a68;">Adoption</span><span style="color:#999999;">(</span><span style="color:#000000;">DeployedAddresses</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">Adoption</span><span style="color:#999999;">());</span>&nbsp;<span style="color:#999999;">}</span></p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">我们用3个进口开始合同：</span></p> 
  <ul>
   <li><span style="color:#c7254e;">Assert.sol</span><span style="color:#545452;">：给我们在测试中使用的各种断言。在测试中，</span><strong><span style="color:#545452;"><strong>断言检查诸如平等，不平等或空虚之类的事情，以便</strong></span></strong><span style="color:#545452;">从我们的测试中</span><strong><span style="color:#545452;"><strong>返回通过/失败</strong></span></strong><span style="color:#545452;">。</span><a href="https://github.com/trufflesuite/truffle-core/blob/master/lib/testing/Assert.sol" rel="nofollow"><span style="color:#337ab7;">以下是Truffle附带的断言的完整列表</span></a><span style="color:#545452;">。</span></li> 
   <li><span style="color:#c7254e;">DeployedAddresses.sol</span><span style="color:#545452;">：运行测试时，Truffle会将正在测试的合同的新实例部署到区块链。这个智能合约获得已部署合同的地址。</span></li> 
   <li><span style="color:#c7254e;">Adoption.sol</span><span style="color:#545452;">：我们想要测试的智能合约。</span></li> 
   <li> <p style="margin-left:0pt;"><strong><span style="color:#31708f;"><strong>注意</strong></span></strong><span style="color:#31708f;">：前两个导入是指全局Truffle文件，而不是</span><span style="color:#c7254e;">truffle</span><span style="color:#31708f;">目录。您不应该在</span><span style="color:#c7254e;">truffle</span><span style="color:#31708f;">目录中看到</span><span style="color:#c7254e;">test/</span><span style="color:#31708f;">目录。</span></p> <p style="margin-left:0pt;"><span style="color:#545452;">然后我们定义一个合约范围的变量，其中包含要测试的</span><span style="color:#c7254e;">DeployedAddresses</span><span style="color:#545452;">智能合约，调用智能合约来获取其地址。</span></p> <h3 style="margin-left:0pt;"><strong><a name="testing-the-adopt-function"></a><a href="#testing-the-adopt-function" rel="nofollow"> </a><strong><span style="color:#545452;"><strong>测试adopt（）函数</strong></span></strong></strong></h3> <p style="margin-left:0pt;"><span style="color:#545452;">要测试该</span><span style="color:#c7254e;">adopt()</span><span style="color:#545452;">功能，请记住，一旦成功，它将返回给定的</span><span style="color:#c7254e;">petId</span><span style="color:#545452;">。通过比较</span><span style="color:#c7254e;">adopt()</span><span style="color:#545452;">我们传入的ID&nbsp;的返回值，我们可以确保返回一个ID并且它是正确的。</span></p> <p style="margin-left:0pt;"><span style="color:#c7254e;">TestAdoption.sol</span><span style="color:#545452;">声明后，在智能合约中添加以下功能</span><span style="color:#c7254e;">Adoption</span><span style="color:#545452;">：</span></p> <p style="margin-left:0pt;">&nbsp;</p> <p style="margin-left:0pt;"><span style="color:#708090;">// Testing the adopt() function</span>&nbsp;<span style="color:#0077aa;">function</span>&nbsp;<span style="color:#dd4a68;">testUserCanAdoptPet</span><span style="color:#999999;">()</span>&nbsp;<span style="color:#0077aa;">public</span>&nbsp;<span style="color:#999999;">{</span><span style="color:#000000;">&nbsp;uint returnedId </span><span style="color:#a67f59;">=</span><span style="color:#000000;">&nbsp;adoption</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">adopt</span><span style="color:#999999;">(</span><span style="color:#990055;">8</span><span style="color:#999999;">);</span><span style="color:#000000;">&nbsp;uint expected </span><span style="color:#a67f59;">=</span>&nbsp;<span style="color:#990055;">8</span><span style="color:#999999;">;</span><span style="color:#000000;">&nbsp;Assert</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">equal</span><span style="color:#999999;">(</span><span style="color:#000000;">returnedId</span><span style="color:#999999;">,</span><span style="color:#000000;">&nbsp;expected</span><span style="color:#999999;">,</span>&nbsp;<span style="color:#669900;">"Adoption of pet ID 8 should be recorded."</span><span style="color:#999999;">);</span>&nbsp;<span style="color:#999999;">}</span></p> <p style="margin-left:0pt;">&nbsp;</p> <p style="margin-left:0pt;"><span style="color:#545452;">需要注意的事项：</span></p> </li> 
   <li><span style="color:#545452;">我们将之前声明的智能合约称为ID&nbsp;</span><span style="color:#c7254e;">8</span><span style="color:#545452;">。</span></li> 
   <li><span style="color:#545452;">然后我们也声明了预期值</span><span style="color:#c7254e;">8</span><span style="color:#545452;">。</span></li> 
   <li><span style="color:#545452;">最后，我们传递实际值，期望值和失败消息（如果测试未通过则将其打印到控制台）</span><span style="color:#c7254e;">Assert.equal()</span><span style="color:#545452;">。</span> <h3 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>测试单个宠物主人的检索</strong></span></strong></strong></h3> <p style="margin-left:0pt;"><span style="color:#545452;">记住上面公共变量有自动getter方法，我们可以检索上面的采用测试存储的地址。存储的数据将在我们的测试期间持续存在，因此我们对</span><span style="color:#c7254e;">8</span><span style="color:#545452;">上面的pet的采用可以通过其他测试来检索。</span></p> <p style="margin-left:0pt;"><span style="color:#545452;">在以前添加的函数下面添加此函数</span><span style="color:#c7254e;">TestAdoption.sol</span><span style="color:#545452;">。</span></p> <p style="margin-left:0pt;"><span style="color:#708090;">// Testing retrieval of a single pet's owner</span>&nbsp;<span style="color:#0077aa;">function</span>&nbsp;<span style="color:#dd4a68;">testGetAdopterAddressByPetId</span><span style="color:#999999;">()</span>&nbsp;<span style="color:#0077aa;">public</span>&nbsp;<span style="color:#999999;">{</span>&nbsp;<span style="color:#708090;">// Expected owner is this contract</span><span style="color:#000000;">&nbsp;address expected </span><span style="color:#a67f59;">=</span>&nbsp;<span style="color:#0077aa;">this</span><span style="color:#999999;">;</span><span style="color:#000000;">&nbsp;address adopter </span><span style="color:#a67f59;">=</span><span style="color:#000000;">&nbsp;adoption</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">adopters</span><span style="color:#999999;">(</span><span style="color:#990055;">8</span><span style="color:#999999;">);</span><span style="color:#000000;">&nbsp;Assert</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">equal</span><span style="color:#999999;">(</span><span style="color:#000000;">adopter</span><span style="color:#999999;">,</span><span style="color:#000000;">&nbsp;expected</span><span style="color:#999999;">,</span>&nbsp;<span style="color:#669900;">"Owner of pet ID 8 should be recorded."</span><span style="color:#999999;">);</span>&nbsp;<span style="color:#999999;">}</span></p> <p style="margin-left:0pt;"><span style="color:#545452;">由于TestAdoption合约将发送交易，我们将预期值设置</span><strong><span style="color:#545452;"><strong>为此</strong></span></strong><span style="color:#545452;">，</span><strong><span style="color:#545452;"><strong>这</strong></span></strong><span style="color:#545452;">是一个获得当前合约地址的合约范围变量。从那里我们就像上面所说的那样断言平等。</span></p> <h3 style="margin-left:0pt;"><strong><a name="testing-retrieval-of-all-pet-owners"></a><a href="#testing-retrieval-of-all-pet-owners" rel="nofollow"> </a><strong><span style="color:#545452;"><strong>测试所有宠物主人的检索</strong></span></strong></strong></h3> <p style="margin-left:0pt;"><span style="color:#545452;">由于数组只能在给定单个键的情况下返回单个值，因此我们为整个数组创建自己的getter。</span></p> <p style="margin-left:0pt;"><span style="color:#545452;">在以前添加的函数下面添加此函数</span><span style="color:#c7254e;">TestAdoption.sol</span><span style="color:#545452;">。</span></p> <p style="margin-left:0pt;"><span style="color:#708090;">// Testing retrieval of all pet owners</span>&nbsp;<span style="color:#0077aa;">function</span>&nbsp;<span style="color:#dd4a68;">testGetAdopterAddressByPetIdInArray</span><span style="color:#999999;">()</span>&nbsp;<span style="color:#0077aa;">public</span>&nbsp;<span style="color:#999999;">{</span></p> <p style="margin-left:0pt;">&nbsp;<span style="color:#708090;">// Expected owner is this contract</span>&nbsp;</p> <p style="margin-left:0pt;"><span style="color:#000000;">address expected </span><span style="color:#a67f59;">=</span>&nbsp;<span style="color:#0077aa;">this</span><span style="color:#999999;">;</span>&nbsp;</p> <p style="margin-left:0pt;"><span style="color:#708090;">// Store adopters in memory rather than contract's storage</span>&nbsp;</p> <p style="margin-left:0pt;"><span style="color:#000000;">address</span><span style="color:#999999;">[</span><span style="color:#990055;">16</span><span style="color:#999999;">]</span><span style="color:#000000;">&nbsp;memory adopters </span><span style="color:#a67f59;">=</span><span style="color:#000000;">&nbsp;adoption</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">getAdopters</span><span style="color:#999999;">();</span><span style="color:#000000;">&nbsp;Assert</span><span style="color:#999999;">.</span><span style="color:#dd4a68;">equal</span><span style="color:#999999;">(</span><span style="color:#000000;">adopters</span><span style="color:#999999;">[</span><span style="color:#990055;">8</span><span style="color:#999999;">],</span><span style="color:#000000;">&nbsp;expected</span><span style="color:#999999;">,</span>&nbsp;<span style="color:#669900;">"Owner of pet ID 8 should be recorded."</span><span style="color:#999999;">);</span>&nbsp;</p> <p style="margin-left:0pt;"><span style="color:#999999;">}</span></p> <p style="margin-left:0pt;"><span style="color:#545452;">请注意</span><strong><span style="color:#545452;"><strong>内存</strong></span></strong><span style="color:#545452;">属性</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">。memory属性告诉Solidity将值临时存储在内存中，而不是将其保存到合同的存储中。由于</span><span style="color:#c7254e;">adopters</span><span style="color:#545452;">是一个数组，我们从第一次采用测试我们知道采用pet&nbsp;</span><span style="color:#c7254e;">8</span><span style="color:#545452;">，我们将测试合同地址与</span><span style="color:#c7254e;">8</span><span style="color:#545452;">数组中的位置进行比较。</span></p> </li> 
   <li> <p style="margin-left:0pt;">&nbsp;</p> <p style="margin-left:0pt;">&nbsp;</p> <h3 style="margin-left:0pt;"><strong><strong><span style="color:#545452;"><strong>运行测试</strong></span></strong></strong></h3> <p style="margin-left:0pt;"><span style="color:#545452;">回到终端，运行测试</span></p> <pre class="has">
<code>运行测试
回到终端，运行测试：
truffle test
如果所有测试都通过，您将看到与此类似的控制台输出：
Using network 'development'. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... TestAdoption ✓ testUserCanAdoptPet (91ms) ✓ testGetAdopterAddressByPetId (70ms) ✓ testGetAdopterAddressByPetIdInArray (89ms) 3 passing (670ms)</code></pre> <p style="margin-left:0pt;">&nbsp;</p> </li> 
  </ul>
  <p>&nbsp;</p> 
  <p style="margin-left:0pt;"><span style="color:#545452;">创建用户界面以与智能合约进行交互&lt;下一章&gt;</span></p> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/AVGworkld/article/details/81708522,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/AVGworkld/article/details/81708522,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

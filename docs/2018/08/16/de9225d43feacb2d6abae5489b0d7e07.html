<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>“双花”问题及解决之道 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="“双花”问题及解决之道" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权归作者所有，任何形式转载请联系作者。 作者：郭知行（来自豆瓣） 来源：https://www.douban.com/note/663186556/ 提个问题先： 小明在星巴克点了杯拿铁，付给漂亮的收银员小姐姐30元现金。喝完咖啡，小明走进隔壁的花店，准备为女朋友买束玫瑰，一摸口袋发现最后的30元现金已经用来买咖啡了。这时候，如果小明想用给星巴克小姐姐的那30元买花。可能吗？ 不可能。除非他从小姐姐那把钱偷回来。 如果小明使用的不是现金，而是数字货币呢？ 要回答这个问题，你需要了解“双花”问题。 01 什么是“双花”问题？ “双花”，即双重支付，指的是在数字货币系统中，由于数据的可复制性，使得系统可能存在同一笔数字资产因不当操作被重复使用的情况。 “双花”是任何一种数字货币都要解决的问题。为什么？ 如果某种数字货币能被人重复使用，同样一笔钱被花掉两次或多次，它没有价值。 在上述星巴克买咖啡的情境中，小明使用的30元现金可以很容易地被小姐姐确认。但如果小明使用的是某种数字化货币，小姐姐想确认就不那么容易了。事实上，30元数字货币背后的数据是相同的，伪造数据的成本远远低于伪造现金。 02 “支付宝”们如何解决“双花”问题？ 那你可能要问了，我每天都在淘宝上买买买，也不需要使用现金。支付宝如何解决“双花问题”呢？ 事实上，支付宝中的钱并不存在于数字世界。相反，它仍存在于现实世界的银行中。当小明在淘宝上下单并付款给卖家时，小明实际上做的是： &nbsp;&nbsp;&nbsp; 你把钱付给支付宝； &nbsp;&nbsp;&nbsp; 支付宝将你的钱存在他们的银行账户中； &nbsp;&nbsp;&nbsp; 你确认收货后，支付宝将钱从他们的银行账户中取出，并支付给卖家。 更简单地说，支付宝仅仅是一个第三方中介。当你走进任何一家商店，星巴克也好，花店也好，如果你想使用数字货币进行支付，你必须将钱交给一个第三方中介，可以是支付宝，也可以是微信等。这类机构对数据进行中心化管理，并通过实时修改账户余额的方法来防止“双花”的出现。只有经过第三方确认后，小姐姐们才会把咖啡和玫瑰给小明。 这样有什么问题吗？ 人类需要为交易中第三方验证支付巨额费用。 虽然每一笔交易的“中介费”并不高，但如果交易数量十分大呢？要知道，全球总共有超过75亿人，每天交易量高达以万亿级别。更值得注意的是，这类第三方机构对数据进行的是中心化管理，它们会不会有意或无意（被黑客攻击）篡改数据呢？我不知道。以支付宝、微信举例子，仅仅是因为我日常生活中常使用它们，并非有意诋毁，它们都是伟大的公司。 那我们有没有可能，在不需要信任中心化第三方机构的情况，向某人转移数字资产？ 03 比特币如何解决“双花”问题？ 比特币作为一个去中心化的点对点电子现金系统，主要依靠未花费的交易输出（unspend transaction output, UTXO）和时间戳来解决“双花”问题。 什么是UTXO？ 比特币交易的基本单位是未花费的一个交易输出，简称UTXO。UTXO是不能再分割、被所有者锁住和记录区块链网络中的一定数量的比特币货币。当一个用户接收比特币时，金额被当作UTXO记录到区块链里。一个用户拥有的比特币实际上会被当作UTXO分散到数百个交易和数百个区块中。 “一个用户的比特币余额”，这个概念是通过比特币钱包创建的派生之物。比特币钱包通过扫描区块链并聚合所有属于该用户的UTXO来计算该用户的比特币余额。事实上，比特币现金系统中并没有账户，没有钱包，没有余额，有的只是记录在区块链中，被所有者锁住的UTXO。 当某一笔比特币交易被创建并广播到区块链网络之后，接收到此交易信息的节点会对交易进行验证，检查其是否存在于UTXO中。如果交易输出已不存在于UTXO中，则验证失败。 小明给李雷转账1个BTC。整个过程如下： &nbsp;&nbsp;&nbsp; 小明要发送的那1个比特币存在于小明的UTXO中； &nbsp;&nbsp;&nbsp; 小明发送的金额等于李雷接受的金额，即1BTC； &nbsp;&nbsp;&nbsp; 李雷接收后，1个比特币从李雷的UTXO中解锁，进入李雷的UTXO中。 比特币现金系统中记录着当前每一笔“未花费的交易输出”。当节点接收到一笔交易信息的时候，它需要去 UTXO 数据库里查，看看这笔交易所引用的 UTXO 是否存在，它的收款人（拥有者）是不是当前新交易的付款者。交易结束之后，系统会做相应的更新。 什么是时间戳？ &nbsp;&nbsp;&nbsp; 时间戳（timestamp），一个能表示一份数据在某个特定时间之前已经存在的、 完整的、 可验证的数据。通常是一个字符序列，唯一地标识某一刻的时间。使用数字签名技术产生的数据， 签名的对象包括了原始文件信息、 签名参数、 签名时间等信息。广泛的运用在知识产权保护、 合同签字、 金融帐务、 电子报价投标、 股票交易等方面。 生活中时间戳也很常见，比如我们每天阅读的报纸。报纸记录是现实生活中曾经某一个时刻发生过的事件，我们通过报纸了解这个事件都是在事件发生之后。报纸便是该事件的时间戳，该事件一旦被写进报纸印刷成很多份分发后，便难以被后来人篡改。 比特币现金系统也引入了时间戳的概念。事实上，比特币现金系统是一个由众多节点共同参与的分布式数据库，是一个开放的大账本；由一串按照密码学方法产生的数据块，即区块组成。系统会对每一个区块的数据信息都自动加上时间戳，从而计算出一个数据加密数值，即哈希。每一个新区块都包含前一个区块的哈希，从创始区块开始，链接到当前区块链，形成区块链。 比特币现金系统本身就是构造了一个永不停息、无坚不摧的时间戳系统。系统利用数字时间戳保证每个区块按时间顺序相连成区块链，时间戳也为区块链链上每一笔数据打上时间标记。 假设小明将被存在于自己UTXO中的1个BTC同时转账给李雷和韩梅梅，两笔交易仅有一笔会成功完成。为什么呢？因为系统中的节点会选择性地记录先接收到的那笔交易。当两笔交易同时被同一节点记录，根据时间戳的数据，只有先被记录的交易才能被确认成功。 如果小明的两笔转账的时间隔得非常非常近，“小明在12点34分56秒转给李雷1个比特币”、“小明在12点34分57秒转给韩梅梅1个比特币”恰好被两个不同的节点记录，会出现“双花”吗？也不会。这两个节点会将各自挖出包含相关交易的区块同时广播到比特币网络中，此时区块链将出现分叉，剩余节点选择在他们认为的最长链上构建新的区块。最后，率先构建出新区块并成为当前最长链上的交易（通常为6个区块），才能被确认成功。之后的所有节点将在此最长链上构建新的区块。 总结一下，面对“双花问题”，比特币现金系统是这样解决的： &nbsp;&nbsp;&nbsp; 首先，每笔交易都要先确认对应比特币之前的情况，要检查它是否存在于小明的UTXO中。如果不在，那么该交易会被系统拒绝。 &nbsp;&nbsp;&nbsp; 如果小明用同一笔UTXO付给李雷和韩梅梅，系统中的节点只确认先接收到的那一笔。 &nbsp;&nbsp;&nbsp; 当两笔时间上很接近的交易被不同节点确认，区块链将发生分叉。剩余节点选择在他们认为的最长链上构建新的区块。当其中一笔交易被6个节点确认后，它将成为系统最长链，可以认为这笔交易获得了最终的确认。 有没有例外？ 有。如果小明能掌握比特币网络中50%以上的节点，即使他落后最长的区块链（记录“小明在12点34分56秒转给李雷1个比特币”）也没关系，他可以一直在另一条区块链（记录“小明在12点34分57秒转给韩梅梅1个比特币”）上构建区块，直到追上并成为新的最长链，这就是比特币的“51%攻击”。 “51%攻击”的确是比特币需要警惕的问题，目前尚未发生过。原因也很简单，首先没有人能轻易掌握51%的节点；其次，如果一个人或机构已经掌握51%的节点，他是比特币现金系统中的最大受益者。如果他发动51%攻击，比特币的价值将立刻归零（能够“双花”的比特币一文不值），届时他将成为最大的受害者。 04 总结 比特币作为一个去中心化的点对点电子现金系统，主要依靠UTXO和时间戳来解决“双花”问题，它教会世界如何在不需要信任第三方的情况下转移数字资产。 本文首发于微信公众号：郭知行。知者行之始，行者知之成，和你一起终身成长。 阅读更多" />
<meta property="og:description" content="版权归作者所有，任何形式转载请联系作者。 作者：郭知行（来自豆瓣） 来源：https://www.douban.com/note/663186556/ 提个问题先： 小明在星巴克点了杯拿铁，付给漂亮的收银员小姐姐30元现金。喝完咖啡，小明走进隔壁的花店，准备为女朋友买束玫瑰，一摸口袋发现最后的30元现金已经用来买咖啡了。这时候，如果小明想用给星巴克小姐姐的那30元买花。可能吗？ 不可能。除非他从小姐姐那把钱偷回来。 如果小明使用的不是现金，而是数字货币呢？ 要回答这个问题，你需要了解“双花”问题。 01 什么是“双花”问题？ “双花”，即双重支付，指的是在数字货币系统中，由于数据的可复制性，使得系统可能存在同一笔数字资产因不当操作被重复使用的情况。 “双花”是任何一种数字货币都要解决的问题。为什么？ 如果某种数字货币能被人重复使用，同样一笔钱被花掉两次或多次，它没有价值。 在上述星巴克买咖啡的情境中，小明使用的30元现金可以很容易地被小姐姐确认。但如果小明使用的是某种数字化货币，小姐姐想确认就不那么容易了。事实上，30元数字货币背后的数据是相同的，伪造数据的成本远远低于伪造现金。 02 “支付宝”们如何解决“双花”问题？ 那你可能要问了，我每天都在淘宝上买买买，也不需要使用现金。支付宝如何解决“双花问题”呢？ 事实上，支付宝中的钱并不存在于数字世界。相反，它仍存在于现实世界的银行中。当小明在淘宝上下单并付款给卖家时，小明实际上做的是： &nbsp;&nbsp;&nbsp; 你把钱付给支付宝； &nbsp;&nbsp;&nbsp; 支付宝将你的钱存在他们的银行账户中； &nbsp;&nbsp;&nbsp; 你确认收货后，支付宝将钱从他们的银行账户中取出，并支付给卖家。 更简单地说，支付宝仅仅是一个第三方中介。当你走进任何一家商店，星巴克也好，花店也好，如果你想使用数字货币进行支付，你必须将钱交给一个第三方中介，可以是支付宝，也可以是微信等。这类机构对数据进行中心化管理，并通过实时修改账户余额的方法来防止“双花”的出现。只有经过第三方确认后，小姐姐们才会把咖啡和玫瑰给小明。 这样有什么问题吗？ 人类需要为交易中第三方验证支付巨额费用。 虽然每一笔交易的“中介费”并不高，但如果交易数量十分大呢？要知道，全球总共有超过75亿人，每天交易量高达以万亿级别。更值得注意的是，这类第三方机构对数据进行的是中心化管理，它们会不会有意或无意（被黑客攻击）篡改数据呢？我不知道。以支付宝、微信举例子，仅仅是因为我日常生活中常使用它们，并非有意诋毁，它们都是伟大的公司。 那我们有没有可能，在不需要信任中心化第三方机构的情况，向某人转移数字资产？ 03 比特币如何解决“双花”问题？ 比特币作为一个去中心化的点对点电子现金系统，主要依靠未花费的交易输出（unspend transaction output, UTXO）和时间戳来解决“双花”问题。 什么是UTXO？ 比特币交易的基本单位是未花费的一个交易输出，简称UTXO。UTXO是不能再分割、被所有者锁住和记录区块链网络中的一定数量的比特币货币。当一个用户接收比特币时，金额被当作UTXO记录到区块链里。一个用户拥有的比特币实际上会被当作UTXO分散到数百个交易和数百个区块中。 “一个用户的比特币余额”，这个概念是通过比特币钱包创建的派生之物。比特币钱包通过扫描区块链并聚合所有属于该用户的UTXO来计算该用户的比特币余额。事实上，比特币现金系统中并没有账户，没有钱包，没有余额，有的只是记录在区块链中，被所有者锁住的UTXO。 当某一笔比特币交易被创建并广播到区块链网络之后，接收到此交易信息的节点会对交易进行验证，检查其是否存在于UTXO中。如果交易输出已不存在于UTXO中，则验证失败。 小明给李雷转账1个BTC。整个过程如下： &nbsp;&nbsp;&nbsp; 小明要发送的那1个比特币存在于小明的UTXO中； &nbsp;&nbsp;&nbsp; 小明发送的金额等于李雷接受的金额，即1BTC； &nbsp;&nbsp;&nbsp; 李雷接收后，1个比特币从李雷的UTXO中解锁，进入李雷的UTXO中。 比特币现金系统中记录着当前每一笔“未花费的交易输出”。当节点接收到一笔交易信息的时候，它需要去 UTXO 数据库里查，看看这笔交易所引用的 UTXO 是否存在，它的收款人（拥有者）是不是当前新交易的付款者。交易结束之后，系统会做相应的更新。 什么是时间戳？ &nbsp;&nbsp;&nbsp; 时间戳（timestamp），一个能表示一份数据在某个特定时间之前已经存在的、 完整的、 可验证的数据。通常是一个字符序列，唯一地标识某一刻的时间。使用数字签名技术产生的数据， 签名的对象包括了原始文件信息、 签名参数、 签名时间等信息。广泛的运用在知识产权保护、 合同签字、 金融帐务、 电子报价投标、 股票交易等方面。 生活中时间戳也很常见，比如我们每天阅读的报纸。报纸记录是现实生活中曾经某一个时刻发生过的事件，我们通过报纸了解这个事件都是在事件发生之后。报纸便是该事件的时间戳，该事件一旦被写进报纸印刷成很多份分发后，便难以被后来人篡改。 比特币现金系统也引入了时间戳的概念。事实上，比特币现金系统是一个由众多节点共同参与的分布式数据库，是一个开放的大账本；由一串按照密码学方法产生的数据块，即区块组成。系统会对每一个区块的数据信息都自动加上时间戳，从而计算出一个数据加密数值，即哈希。每一个新区块都包含前一个区块的哈希，从创始区块开始，链接到当前区块链，形成区块链。 比特币现金系统本身就是构造了一个永不停息、无坚不摧的时间戳系统。系统利用数字时间戳保证每个区块按时间顺序相连成区块链，时间戳也为区块链链上每一笔数据打上时间标记。 假设小明将被存在于自己UTXO中的1个BTC同时转账给李雷和韩梅梅，两笔交易仅有一笔会成功完成。为什么呢？因为系统中的节点会选择性地记录先接收到的那笔交易。当两笔交易同时被同一节点记录，根据时间戳的数据，只有先被记录的交易才能被确认成功。 如果小明的两笔转账的时间隔得非常非常近，“小明在12点34分56秒转给李雷1个比特币”、“小明在12点34分57秒转给韩梅梅1个比特币”恰好被两个不同的节点记录，会出现“双花”吗？也不会。这两个节点会将各自挖出包含相关交易的区块同时广播到比特币网络中，此时区块链将出现分叉，剩余节点选择在他们认为的最长链上构建新的区块。最后，率先构建出新区块并成为当前最长链上的交易（通常为6个区块），才能被确认成功。之后的所有节点将在此最长链上构建新的区块。 总结一下，面对“双花问题”，比特币现金系统是这样解决的： &nbsp;&nbsp;&nbsp; 首先，每笔交易都要先确认对应比特币之前的情况，要检查它是否存在于小明的UTXO中。如果不在，那么该交易会被系统拒绝。 &nbsp;&nbsp;&nbsp; 如果小明用同一笔UTXO付给李雷和韩梅梅，系统中的节点只确认先接收到的那一笔。 &nbsp;&nbsp;&nbsp; 当两笔时间上很接近的交易被不同节点确认，区块链将发生分叉。剩余节点选择在他们认为的最长链上构建新的区块。当其中一笔交易被6个节点确认后，它将成为系统最长链，可以认为这笔交易获得了最终的确认。 有没有例外？ 有。如果小明能掌握比特币网络中50%以上的节点，即使他落后最长的区块链（记录“小明在12点34分56秒转给李雷1个比特币”）也没关系，他可以一直在另一条区块链（记录“小明在12点34分57秒转给韩梅梅1个比特币”）上构建区块，直到追上并成为新的最长链，这就是比特币的“51%攻击”。 “51%攻击”的确是比特币需要警惕的问题，目前尚未发生过。原因也很简单，首先没有人能轻易掌握51%的节点；其次，如果一个人或机构已经掌握51%的节点，他是比特币现金系统中的最大受益者。如果他发动51%攻击，比特币的价值将立刻归零（能够“双花”的比特币一文不值），届时他将成为最大的受害者。 04 总结 比特币作为一个去中心化的点对点电子现金系统，主要依靠UTXO和时间戳来解决“双花”问题，它教会世界如何在不需要信任第三方的情况下转移数字资产。 本文首发于微信公众号：郭知行。知者行之始，行者知之成，和你一起终身成长。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/16/de9225d43feacb2d6abae5489b0d7e07.html" />
<meta property="og:url" content="https://mlh.app/2018/08/16/de9225d43feacb2d6abae5489b0d7e07.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权归作者所有，任何形式转载请联系作者。 作者：郭知行（来自豆瓣） 来源：https://www.douban.com/note/663186556/ 提个问题先： 小明在星巴克点了杯拿铁，付给漂亮的收银员小姐姐30元现金。喝完咖啡，小明走进隔壁的花店，准备为女朋友买束玫瑰，一摸口袋发现最后的30元现金已经用来买咖啡了。这时候，如果小明想用给星巴克小姐姐的那30元买花。可能吗？ 不可能。除非他从小姐姐那把钱偷回来。 如果小明使用的不是现金，而是数字货币呢？ 要回答这个问题，你需要了解“双花”问题。 01 什么是“双花”问题？ “双花”，即双重支付，指的是在数字货币系统中，由于数据的可复制性，使得系统可能存在同一笔数字资产因不当操作被重复使用的情况。 “双花”是任何一种数字货币都要解决的问题。为什么？ 如果某种数字货币能被人重复使用，同样一笔钱被花掉两次或多次，它没有价值。 在上述星巴克买咖啡的情境中，小明使用的30元现金可以很容易地被小姐姐确认。但如果小明使用的是某种数字化货币，小姐姐想确认就不那么容易了。事实上，30元数字货币背后的数据是相同的，伪造数据的成本远远低于伪造现金。 02 “支付宝”们如何解决“双花”问题？ 那你可能要问了，我每天都在淘宝上买买买，也不需要使用现金。支付宝如何解决“双花问题”呢？ 事实上，支付宝中的钱并不存在于数字世界。相反，它仍存在于现实世界的银行中。当小明在淘宝上下单并付款给卖家时，小明实际上做的是： &nbsp;&nbsp;&nbsp; 你把钱付给支付宝； &nbsp;&nbsp;&nbsp; 支付宝将你的钱存在他们的银行账户中； &nbsp;&nbsp;&nbsp; 你确认收货后，支付宝将钱从他们的银行账户中取出，并支付给卖家。 更简单地说，支付宝仅仅是一个第三方中介。当你走进任何一家商店，星巴克也好，花店也好，如果你想使用数字货币进行支付，你必须将钱交给一个第三方中介，可以是支付宝，也可以是微信等。这类机构对数据进行中心化管理，并通过实时修改账户余额的方法来防止“双花”的出现。只有经过第三方确认后，小姐姐们才会把咖啡和玫瑰给小明。 这样有什么问题吗？ 人类需要为交易中第三方验证支付巨额费用。 虽然每一笔交易的“中介费”并不高，但如果交易数量十分大呢？要知道，全球总共有超过75亿人，每天交易量高达以万亿级别。更值得注意的是，这类第三方机构对数据进行的是中心化管理，它们会不会有意或无意（被黑客攻击）篡改数据呢？我不知道。以支付宝、微信举例子，仅仅是因为我日常生活中常使用它们，并非有意诋毁，它们都是伟大的公司。 那我们有没有可能，在不需要信任中心化第三方机构的情况，向某人转移数字资产？ 03 比特币如何解决“双花”问题？ 比特币作为一个去中心化的点对点电子现金系统，主要依靠未花费的交易输出（unspend transaction output, UTXO）和时间戳来解决“双花”问题。 什么是UTXO？ 比特币交易的基本单位是未花费的一个交易输出，简称UTXO。UTXO是不能再分割、被所有者锁住和记录区块链网络中的一定数量的比特币货币。当一个用户接收比特币时，金额被当作UTXO记录到区块链里。一个用户拥有的比特币实际上会被当作UTXO分散到数百个交易和数百个区块中。 “一个用户的比特币余额”，这个概念是通过比特币钱包创建的派生之物。比特币钱包通过扫描区块链并聚合所有属于该用户的UTXO来计算该用户的比特币余额。事实上，比特币现金系统中并没有账户，没有钱包，没有余额，有的只是记录在区块链中，被所有者锁住的UTXO。 当某一笔比特币交易被创建并广播到区块链网络之后，接收到此交易信息的节点会对交易进行验证，检查其是否存在于UTXO中。如果交易输出已不存在于UTXO中，则验证失败。 小明给李雷转账1个BTC。整个过程如下： &nbsp;&nbsp;&nbsp; 小明要发送的那1个比特币存在于小明的UTXO中； &nbsp;&nbsp;&nbsp; 小明发送的金额等于李雷接受的金额，即1BTC； &nbsp;&nbsp;&nbsp; 李雷接收后，1个比特币从李雷的UTXO中解锁，进入李雷的UTXO中。 比特币现金系统中记录着当前每一笔“未花费的交易输出”。当节点接收到一笔交易信息的时候，它需要去 UTXO 数据库里查，看看这笔交易所引用的 UTXO 是否存在，它的收款人（拥有者）是不是当前新交易的付款者。交易结束之后，系统会做相应的更新。 什么是时间戳？ &nbsp;&nbsp;&nbsp; 时间戳（timestamp），一个能表示一份数据在某个特定时间之前已经存在的、 完整的、 可验证的数据。通常是一个字符序列，唯一地标识某一刻的时间。使用数字签名技术产生的数据， 签名的对象包括了原始文件信息、 签名参数、 签名时间等信息。广泛的运用在知识产权保护、 合同签字、 金融帐务、 电子报价投标、 股票交易等方面。 生活中时间戳也很常见，比如我们每天阅读的报纸。报纸记录是现实生活中曾经某一个时刻发生过的事件，我们通过报纸了解这个事件都是在事件发生之后。报纸便是该事件的时间戳，该事件一旦被写进报纸印刷成很多份分发后，便难以被后来人篡改。 比特币现金系统也引入了时间戳的概念。事实上，比特币现金系统是一个由众多节点共同参与的分布式数据库，是一个开放的大账本；由一串按照密码学方法产生的数据块，即区块组成。系统会对每一个区块的数据信息都自动加上时间戳，从而计算出一个数据加密数值，即哈希。每一个新区块都包含前一个区块的哈希，从创始区块开始，链接到当前区块链，形成区块链。 比特币现金系统本身就是构造了一个永不停息、无坚不摧的时间戳系统。系统利用数字时间戳保证每个区块按时间顺序相连成区块链，时间戳也为区块链链上每一笔数据打上时间标记。 假设小明将被存在于自己UTXO中的1个BTC同时转账给李雷和韩梅梅，两笔交易仅有一笔会成功完成。为什么呢？因为系统中的节点会选择性地记录先接收到的那笔交易。当两笔交易同时被同一节点记录，根据时间戳的数据，只有先被记录的交易才能被确认成功。 如果小明的两笔转账的时间隔得非常非常近，“小明在12点34分56秒转给李雷1个比特币”、“小明在12点34分57秒转给韩梅梅1个比特币”恰好被两个不同的节点记录，会出现“双花”吗？也不会。这两个节点会将各自挖出包含相关交易的区块同时广播到比特币网络中，此时区块链将出现分叉，剩余节点选择在他们认为的最长链上构建新的区块。最后，率先构建出新区块并成为当前最长链上的交易（通常为6个区块），才能被确认成功。之后的所有节点将在此最长链上构建新的区块。 总结一下，面对“双花问题”，比特币现金系统是这样解决的： &nbsp;&nbsp;&nbsp; 首先，每笔交易都要先确认对应比特币之前的情况，要检查它是否存在于小明的UTXO中。如果不在，那么该交易会被系统拒绝。 &nbsp;&nbsp;&nbsp; 如果小明用同一笔UTXO付给李雷和韩梅梅，系统中的节点只确认先接收到的那一笔。 &nbsp;&nbsp;&nbsp; 当两笔时间上很接近的交易被不同节点确认，区块链将发生分叉。剩余节点选择在他们认为的最长链上构建新的区块。当其中一笔交易被6个节点确认后，它将成为系统最长链，可以认为这笔交易获得了最终的确认。 有没有例外？ 有。如果小明能掌握比特币网络中50%以上的节点，即使他落后最长的区块链（记录“小明在12点34分56秒转给李雷1个比特币”）也没关系，他可以一直在另一条区块链（记录“小明在12点34分57秒转给韩梅梅1个比特币”）上构建区块，直到追上并成为新的最长链，这就是比特币的“51%攻击”。 “51%攻击”的确是比特币需要警惕的问题，目前尚未发生过。原因也很简单，首先没有人能轻易掌握51%的节点；其次，如果一个人或机构已经掌握51%的节点，他是比特币现金系统中的最大受益者。如果他发动51%攻击，比特币的价值将立刻归零（能够“双花”的比特币一文不值），届时他将成为最大的受害者。 04 总结 比特币作为一个去中心化的点对点电子现金系统，主要依靠UTXO和时间戳来解决“双花”问题，它教会世界如何在不需要信任第三方的情况下转移数字资产。 本文首发于微信公众号：郭知行。知者行之始，行者知之成，和你一起终身成长。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/16/de9225d43feacb2d6abae5489b0d7e07.html","headline":"“双花”问题及解决之道","dateModified":"2018-08-16T00:00:00+08:00","datePublished":"2018-08-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/16/de9225d43feacb2d6abae5489b0d7e07.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>“双花”问题及解决之道</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>版权归作者所有，任何形式转载请联系作者。<br> 作者：郭知行（来自豆瓣）<br> 来源：https://www.douban.com/note/663186556/</p> 
  <p>提个问题先：</p> 
  <p>小明在星巴克点了杯拿铁，付给漂亮的收银员小姐姐30元现金。喝完咖啡，小明走进隔壁的花店，准备为女朋友买束玫瑰，一摸口袋发现最后的30元现金已经用来买咖啡了。这时候，如果小明想用给星巴克小姐姐的那30元买花。可能吗？</p> 
  <p>不可能。除非他从小姐姐那把钱偷回来。</p> 
  <p>如果小明使用的不是现金，而是数字货币呢？</p> 
  <p>要回答这个问题，你需要了解“双花”问题。</p> 
  <p>01 什么是“双花”问题？</p> 
  <p>“双花”，即双重支付，指的是在数字货币系统中，由于数据的可复制性，使得系统可能存在同一笔数字资产因不当操作被重复使用的情况。</p> 
  <p>“双花”是任何一种数字货币都要解决的问题。为什么？</p> 
  <p>如果某种数字货币能被人重复使用，同样一笔钱被花掉两次或多次，它没有价值。</p> 
  <p>在上述星巴克买咖啡的情境中，小明使用的30元现金可以很容易地被小姐姐确认。但如果小明使用的是某种数字化货币，小姐姐想确认就不那么容易了。事实上，30元数字货币背后的数据是相同的，伪造数据的成本远远低于伪造现金。</p> 
  <p>02 “支付宝”们如何解决“双花”问题？</p> 
  <p>那你可能要问了，我每天都在淘宝上买买买，也不需要使用现金。支付宝如何解决“双花问题”呢？</p> 
  <p>事实上，支付宝中的钱并不存在于数字世界。相反，它仍存在于现实世界的银行中。当小明在淘宝上下单并付款给卖家时，小明实际上做的是：</p> 
  <p>&nbsp;&nbsp;&nbsp; 你把钱付给支付宝；<br> &nbsp;&nbsp;&nbsp; 支付宝将你的钱存在他们的银行账户中；<br> &nbsp;&nbsp;&nbsp; 你确认收货后，支付宝将钱从他们的银行账户中取出，并支付给卖家。</p> 
  <p>更简单地说，支付宝仅仅是一个第三方中介。当你走进任何一家商店，星巴克也好，花店也好，如果你想使用数字货币进行支付，你必须将钱交给一个第三方中介，可以是支付宝，也可以是微信等。这类机构对数据进行中心化管理，并通过实时修改账户余额的方法来防止“双花”的出现。只有经过第三方确认后，小姐姐们才会把咖啡和玫瑰给小明。</p> 
  <p>这样有什么问题吗？</p> 
  <p>人类需要为交易中第三方验证支付巨额费用。</p> 
  <p>虽然每一笔交易的“中介费”并不高，但如果交易数量十分大呢？要知道，全球总共有超过75亿人，每天交易量高达以万亿级别。更值得注意的是，这类第三方机构对数据进行的是中心化管理，它们会不会有意或无意（被黑客攻击）篡改数据呢？我不知道。以支付宝、微信举例子，仅仅是因为我日常生活中常使用它们，并非有意诋毁，它们都是伟大的公司。</p> 
  <p>那我们有没有可能，在不需要信任中心化第三方机构的情况，向某人转移数字资产？</p> 
  <p>03 比特币如何解决“双花”问题？</p> 
  <p>比特币作为一个去中心化的点对点电子现金系统，主要依靠未花费的交易输出（unspend transaction output, UTXO）和时间戳来解决“双花”问题。</p> 
  <p>什么是UTXO？</p> 
  <p>比特币交易的基本单位是未花费的一个交易输出，简称UTXO。UTXO是不能再分割、被所有者锁住和记录区块链网络中的一定数量的比特币货币。当一个用户接收比特币时，金额被当作UTXO记录到区块链里。一个用户拥有的比特币实际上会被当作UTXO分散到数百个交易和数百个区块中。</p> 
  <p>“一个用户的比特币余额”，这个概念是通过比特币钱包创建的派生之物。比特币钱包通过扫描区块链并聚合所有属于该用户的UTXO来计算该用户的比特币余额。事实上，比特币现金系统中并没有账户，没有钱包，没有余额，有的只是记录在区块链中，被所有者锁住的UTXO。</p> 
  <p>当某一笔比特币交易被创建并广播到区块链网络之后，接收到此交易信息的节点会对交易进行验证，检查其是否存在于UTXO中。如果交易输出已不存在于UTXO中，则验证失败。</p> 
  <p>小明给李雷转账1个BTC。整个过程如下：</p> 
  <p>&nbsp;&nbsp;&nbsp; 小明要发送的那1个比特币存在于小明的UTXO中；<br> &nbsp;&nbsp;&nbsp; 小明发送的金额等于李雷接受的金额，即1BTC；<br> &nbsp;&nbsp;&nbsp; 李雷接收后，1个比特币从李雷的UTXO中解锁，进入李雷的UTXO中。</p> 
  <p>比特币现金系统中记录着当前每一笔“未花费的交易输出”。当节点接收到一笔交易信息的时候，它需要去 UTXO 数据库里查，看看这笔交易所引用的 UTXO 是否存在，它的收款人（拥有者）是不是当前新交易的付款者。交易结束之后，系统会做相应的更新。</p> 
  <p>什么是时间戳？</p> 
  <p>&nbsp;&nbsp;&nbsp; 时间戳（timestamp），一个能表示一份数据在某个特定时间之前已经存在的、 完整的、 可验证的数据。通常是一个字符序列，唯一地标识某一刻的时间。使用数字签名技术产生的数据， 签名的对象包括了原始文件信息、 签名参数、 签名时间等信息。广泛的运用在知识产权保护、 合同签字、 金融帐务、 电子报价投标、 股票交易等方面。</p> 
  <p>生活中时间戳也很常见，比如我们每天阅读的报纸。报纸记录是现实生活中曾经某一个时刻发生过的事件，我们通过报纸了解这个事件都是在事件发生之后。报纸便是该事件的时间戳，该事件一旦被写进报纸印刷成很多份分发后，便难以被后来人篡改。</p> 
  <p>比特币现金系统也引入了时间戳的概念。事实上，比特币现金系统是一个由众多节点共同参与的分布式数据库，是一个开放的大账本；由一串按照密码学方法产生的数据块，即区块组成。系统会对每一个区块的数据信息都自动加上时间戳，从而计算出一个数据加密数值，即哈希。每一个新区块都包含前一个区块的哈希，从创始区块开始，链接到当前区块链，形成区块链。</p> 
  <p>比特币现金系统本身就是构造了一个永不停息、无坚不摧的时间戳系统。系统利用数字时间戳保证每个区块按时间顺序相连成区块链，时间戳也为区块链链上每一笔数据打上时间标记。</p> 
  <p>假设小明将被存在于自己UTXO中的1个BTC同时转账给李雷和韩梅梅，两笔交易仅有一笔会成功完成。为什么呢？因为系统中的节点会选择性地记录先接收到的那笔交易。当两笔交易同时被同一节点记录，根据时间戳的数据，只有先被记录的交易才能被确认成功。</p> 
  <p>如果小明的两笔转账的时间隔得非常非常近，“小明在12点34分56秒转给李雷1个比特币”、“小明在12点34分57秒转给韩梅梅1个比特币”恰好被两个不同的节点记录，会出现“双花”吗？也不会。这两个节点会将各自挖出包含相关交易的区块同时广播到比特币网络中，此时区块链将出现分叉，剩余节点选择在他们认为的最长链上构建新的区块。最后，率先构建出新区块并成为当前最长链上的交易（通常为6个区块），才能被确认成功。之后的所有节点将在此最长链上构建新的区块。</p> 
  <p>总结一下，面对“双花问题”，比特币现金系统是这样解决的：</p> 
  <p>&nbsp;&nbsp;&nbsp; 首先，每笔交易都要先确认对应比特币之前的情况，要检查它是否存在于小明的UTXO中。如果不在，那么该交易会被系统拒绝。<br> &nbsp;&nbsp;&nbsp; 如果小明用同一笔UTXO付给李雷和韩梅梅，系统中的节点只确认先接收到的那一笔。<br> &nbsp;&nbsp;&nbsp; 当两笔时间上很接近的交易被不同节点确认，区块链将发生分叉。剩余节点选择在他们认为的最长链上构建新的区块。当其中一笔交易被6个节点确认后，它将成为系统最长链，可以认为这笔交易获得了最终的确认。</p> 
  <p>有没有例外？</p> 
  <p>有。如果小明能掌握比特币网络中50%以上的节点，即使他落后最长的区块链（记录“小明在12点34分56秒转给李雷1个比特币”）也没关系，他可以一直在另一条区块链（记录“小明在12点34分57秒转给韩梅梅1个比特币”）上构建区块，直到追上并成为新的最长链，这就是比特币的“51%攻击”。</p> 
  <p>“51%攻击”的确是比特币需要警惕的问题，目前尚未发生过。原因也很简单，首先没有人能轻易掌握51%的节点；其次，如果一个人或机构已经掌握51%的节点，他是比特币现金系统中的最大受益者。如果他发动51%攻击，比特币的价值将立刻归零（能够“双花”的比特币一文不值），届时他将成为最大的受害者。</p> 
  <p>04 总结</p> 
  <p>比特币作为一个去中心化的点对点电子现金系统，主要依靠UTXO和时间戳来解决“双花”问题，它教会世界如何在不需要信任第三方的情况下转移数字资产。</p> 
  <p>本文首发于微信公众号：郭知行。知者行之始，行者知之成，和你一起终身成长。</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/liduanwh/article/details/81738892,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/liduanwh/article/details/81738892,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

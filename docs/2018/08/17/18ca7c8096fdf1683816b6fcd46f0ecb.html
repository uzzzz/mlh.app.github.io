<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链学习之Fabric的Java应用层搭建 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链学习之Fabric的Java应用层搭建" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="自从上篇Java-sdk跑通之后，今天已经是8/17号了，这期间干嘛了呢？一直在尝试搭建出一个Java应用层，好对外提供简单的接口以便将来能够实现一些自己的存储。 此篇博客记录时，CA容器没有单独起，而仅仅是在客户端读取已经生成好的CA文件来成功访问。下面说下一些步骤。 1. 搭建出一个Fabric环境。 搭建过程 1.1 这边需要注意1.3 用工具生成的私钥和证书，我们需要拷贝到工程中去。 channel-artifacts 和 crypto-config（这一个是这一期主要的） 2. 整个工程目录如图，只是一个简单的java项目 3. pom文件如下： &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.tc.fabric&lt;/groupId&gt; &lt;artifactId&gt;FabricSdk&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.14&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.hyperledger.fabric-sdk-java&lt;/groupId&gt; &lt;artifactId&gt;fabric-sdk-java&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 4. CommonUtils package com.t.fabric; public class CommonUtils { //peer节点的CA文件路径 public static final String cryptoPeerPath = &quot;crypto-config/peerOrganizations/&quot;; //order节点的CA文件路径 public static final String cryptoOrderPath = &quot;crypto-config/ordererOrganizations/&quot;; //peer节点的CA文件路径 public static String peerFilePath = CommonUtils.class.getResource(&quot;/&quot;).getPath() + cryptoPeerPath; //order节点的CA文件路径 public static String orderFilePath = CommonUtils.class.getResource(&quot;/&quot;).getPath() + cryptoOrderPath; //org1组织的目录 public static final String org1Path = &quot;org1.example.com/users/&quot;; //org1组织的cert文件目录 public static final String org1CertFilePath = &quot;@org1.example.com/msp/signcerts/&quot;; //org1组织的Key文件目录 public static final String org1KeyFilePath = &quot;@org1.example.com/msp/keystore/&quot;; //org2组织的目录 public static final String org2Path = &quot;org2.example.com/users/&quot;; //org2组织的cert文件目录 public static final String org2CertFilePath = &quot;@org2.example.com/msp/signcerts/&quot;; //org2组织的Key文件目录 public static final String org2KeyFilePath = &quot;@org2.example.com/msp/keystore/&quot;; //链码名称 public static final String chainCodeName = &quot;mycc&quot;; //链码版本 public static final String chaincodeVersion = &quot;1&quot;; //channel名称 public static final String channelId = &quot;mychannel&quot;; //order名称 和 Fabrci-java-sdk保持一致 public static final String orderName = &quot;orderer.example.com&quot;; //peer0org1名称 和 Fabrci-java-sdk保持一致 public static final String peer0Org1Name = &quot;peer0.org1.example.com&quot;; //peer1org1名称 和 Fabrci-java-sdk保持一致 public static final String peer1Org1Name = &quot;peer1.org1.example.com&quot;; //peer0org2名称 和 Fabrci-java-sdk保持一致 public static final String peer0Org2Name = &quot;peer0.org2.example.com&quot;; //peer1org2名称 和 Fabrci-java-sdk保持一致 public static final String peer1Org2Name = &quot;peer1.org2.example.com&quot;; //order地址 public static final String orderLocation = &quot;grpc://localhost:7050&quot;; //peer0org1地址 public static final String peer0Org1Location = &quot;grpc://localhost:7051&quot;; //peer1org1地址 public static final String peer1Org1Location = &quot;grpc://localhost:8051&quot;; //peer0org2地址 public static final String peer0Org2Location = &quot;grpc://localhost:9051&quot;; //peer1org2地址 public static final String peer1Org2Location = &quot;grpc://localhost:10051&quot;; } 5.FabricUtils package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.*; import org.hyperledger.fabric.sdk.security.CryptoSuite; import java.util.Collection; import java.util.HashMap; import java.util.Map; import static java.nio.charset.StandardCharsets.UTF_8; /** * FabricUtils,暂时不关注CA方面的东西 */ public class FabricUtils { //日志记录 private static Logger logger = Logger.getLogger(FabricUtils.class); //CA客户端 public static HFClient client = null; public static CryptoSuite cs = null; public static HashMap&lt;String, SOrg&gt; orgHashMap=null; public static ChaincodeID cid = null; public static User peer0org1=null; public static void init()throws Exception{ cs = CryptoSuite.Factory.getCryptoSuite(); cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build(); client = HFClient.createNewInstance(); client.setCryptoSuite(cs); orgHashMap = OrgConfig.getSOrg(); peer0org1 = orgHashMap.get(&quot;org1&quot;).getAdmin(); client.setUserContext(peer0org1); } /* * 实现插入数据 * */ public static void instertFabcar(Channel channel, DataRecord data) throws Exception { TransactionProposalRequest req = client.newTransactionProposalRequest(); req.setChaincodeID(cid); req.setFcn(&quot;set&quot;); req.setArgs(data.toStringArray()); Map&lt;String, byte[]&gt; tm2 = new HashMap&lt;&gt;(); //代码来自End2End tm2.put(&quot;HyperLedgerFabric&quot;, &quot;TransactionProposalRequest:JavaSDK&quot;.getBytes(UTF_8)); tm2.put(&quot;method&quot;, &quot;TransactionProposalRequest&quot;.getBytes(UTF_8)); tm2.put(&quot;result&quot;, &quot;:)&quot;.getBytes(UTF_8)); req.setTransientMap(tm2); Collection&lt;ProposalResponse&gt; resps = channel.sendTransactionProposal(req); for (ProposalResponse resp : resps) { String payload = new String(resp.getChaincodeActionResponsePayload()); logger.debug(&quot;payload!!!!!!!: &quot;+payload); } channel.sendTransaction(resps); } /* * 实现给定的Key查询数据 * */ public static void queryFabcar(Channel channel, String key) throws Exception { QueryByChaincodeRequest req = client.newQueryProposalRequest(); ChaincodeID cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build(); req.setChaincodeID(cid); req.setFcn(&quot;get&quot;); req.setArgs(new String[] { key }); Collection&lt;ProposalResponse&gt; resps = channel.queryByChaincode(req); for (ProposalResponse resp : resps) { String payload = new String(resp.getChaincodeActionResponsePayload()); logger.debug(&quot;payload!!!!!!!: &quot;+payload); } } } 6. OrgConfig package com.t.fabric; import org.apache.commons.io.IOUtils; import org.bouncycastle.asn1.pkcs.PrivateKeyInfo; import org.bouncycastle.jce.provider.BouncyCastleProvider; import org.bouncycastle.openssl.PEMParser; import org.bouncycastle.openssl.jcajce.JcaPEMKeyConverter; import org.hyperledger.fabric.sdk.Enrollment; import java.io.*; import java.security.NoSuchAlgorithmException; import java.security.NoSuchProviderException; import java.security.PrivateKey; import java.security.spec.InvalidKeySpecException; import java.util.HashMap; /** * 模拟peer,order,admin,user等一些配置项 */ public class OrgConfig { /** * 获取Org组织信息, * 代码精简自End2End * @return */ public static HashMap&lt;String,SOrg&gt; getSOrg() throws Exception{ HashMap&lt;String,SOrg&gt; orgMap = new HashMap&lt;&gt;(); SOrg org1=new SOrg(&quot;Org1&quot;,&quot;Org1MSP&quot;); org1.addPeerLocation(CommonUtils.peer0Org1Name,CommonUtils.peer0Org1Location); org1.addPeerLocation(CommonUtils.peer1Org1Name,CommonUtils.peer1Org1Location); org1.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation); SUser adminOrg1 = new SUser(&quot;Admin&quot;,&quot;Org1MSP&quot;); SUser user1Org1 = new SUser(&quot;User1&quot;,&quot;Org1MSP&quot;); adminOrg1.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg1.getName(),adminOrg1.getMspId()) ,getCertificateFile(adminOrg1.getName(),adminOrg1.getMspId()))); user1Org1.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org1.getName(),user1Org1.getMspId()) ,getCertificateFile(user1Org1.getName(),user1Org1.getMspId()))); org1.addUser(adminOrg1); org1.addUser(user1Org1); org1.setAdmin(adminOrg1); SOrg org2=new SOrg(&quot;Org2&quot;,&quot;Org2MSP&quot;); org2.addPeerLocation(CommonUtils.peer0Org2Name,CommonUtils.peer0Org2Location); org2.addPeerLocation(CommonUtils.peer1Org2Name,CommonUtils.peer1Org2Location); org2.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation); SUser adminOrg2 = new SUser(&quot;Admin&quot;,&quot;Org2MSP&quot;); SUser user1Org2 = new SUser(&quot;User1&quot;,&quot;Org2MSP&quot;); adminOrg2.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg2.getName(),adminOrg2.getMspId()) ,getCertificateFile(adminOrg2.getName(),adminOrg2.getMspId()))); user1Org2.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org2.getName(),user1Org2.getMspId()) ,getCertificateFile(user1Org2.getName(),user1Org2.getMspId()))); org2.addUser(adminOrg2); org2.addUser(user1Org2); org2.setAdmin(adminOrg2); orgMap.put(&quot;org1&quot;,org1); orgMap.put(&quot;org2&quot;,org2); return orgMap; } /** * 获取对应用户的私钥Key * @param userName * @param mspId * @return */ public static PrivateKey getKeyFile(String userName,String mspId) throws Exception{ String tempPath = null; String fileName = null; String keyFile = null; if(&quot;Org1MSP&quot;.equals(mspId)){ tempPath = CommonUtils.peerFilePath +CommonUtils.org1Path + userName + CommonUtils.org1KeyFilePath; fileName = new File(tempPath).listFiles()[0].getName(); keyFile = tempPath + fileName; }else { tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2KeyFilePath; fileName = new File(tempPath).listFiles()[0].getName(); keyFile = tempPath + fileName; } //来源于ChannelTest return getPrivateKeyFromBytes(IOUtils.toByteArray(new FileInputStream(keyFile))); } /** * 获取对应用户的ceritificate证书 * @param userName * @param mspId * @return * @throws Exception */ public static String getCertificateFile(String userName,String mspId) throws Exception{ String tempPath = null; String fileName = null; String certFile = null; if(&quot;Org1MSP&quot;.equals(mspId)){ tempPath = CommonUtils.peerFilePath + CommonUtils.org1Path + userName + CommonUtils.org1CertFilePath; fileName = new File(tempPath).listFiles()[0].getName(); certFile = tempPath + fileName; }else { tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2CertFilePath; fileName = new File(tempPath).listFiles()[0].getName(); certFile = tempPath + fileName; } //来源于ChannelTest return new String(IOUtils.toByteArray(new FileInputStream(certFile)), &quot;UTF-8&quot;); } public static PrivateKey getPrivateKeyFromBytes(byte[] data) throws NoSuchProviderException, NoSuchAlgorithmException, InvalidKeySpecException, IOException { final Reader pemReader = new StringReader(new String(data)); final PrivateKeyInfo pemPair; try (PEMParser pemParser = new PEMParser(pemReader)) { pemPair = (PrivateKeyInfo) pemParser.readObject(); } PrivateKey privateKey = new JcaPEMKeyConverter().setProvider(BouncyCastleProvider.PROVIDER_NAME).getPrivateKey(pemPair); return privateKey; } static final class SampleStoreEnrollement implements Enrollment, Serializable { private final PrivateKey privateKey; private final String certificate; SampleStoreEnrollement(PrivateKey privateKey, String certificate) { this.certificate = certificate; this.privateKey = privateKey; } @Override public PrivateKey getKey() { return privateKey; } @Override public String getCert() { return certificate; } } } 7. SOrg package com.t.fabric; import org.hyperledger.fabric.sdk.Peer; import org.hyperledger.fabric.sdk.User; import org.hyperledger.fabric_ca.sdk.HFCAClient; import java.util.*; /** * Java-SDK直接复制得来 */ public class SOrg { private String name; private String mspid; private HFCAClient caClient; //暂时未使用 private Map&lt;String, User&gt; userMap = new HashMap&lt;String, User&gt;(); private Map&lt;String, String&gt; peerLocations = new HashMap&lt;String, String&gt;(); private Map&lt;String, String&gt; ordererLocations = new HashMap&lt;String, String&gt;(); private Map&lt;String, String&gt; eventHubLocations = new HashMap&lt;String, String&gt;(); //暂时未使用 private Set&lt;Peer&gt; peers = new HashSet&lt;Peer&gt;(); //暂时未使用 private SUser admin; private String caLocation; //暂时未使用 private Properties caProperties = null; //暂时未使用 private SUser peerAdmin; //暂时未使用 private String domainName; //暂时未使用 public SOrg(String name, String mspid) { this.name = name; this.mspid = mspid; } public void setName(String name) { this.name = name; } public void setMspid(String mspid) { this.mspid = mspid; } public void setCaClient(HFCAClient caClient) { this.caClient = caClient; } public void setUserMap(Map&lt;String, User&gt; userMap) { this.userMap = userMap; } public void setPeerLocations(Map&lt;String, String&gt; peerLocations) { this.peerLocations = peerLocations; } public void setOrdererLocations(Map&lt;String, String&gt; ordererLocations) { this.ordererLocations = ordererLocations; } public void setEventHubLocations(Map&lt;String, String&gt; eventHubLocations) { this.eventHubLocations = eventHubLocations; } public void setPeers(Set&lt;Peer&gt; peers) { this.peers = peers; } public void setAdmin(SUser admin) { this.admin = admin; } public void setCaLocation(String caLocation) { this.caLocation = caLocation; } public void setCaProperties(Properties caProperties) { this.caProperties = caProperties; } public void setPeerAdmin(SUser peerAdmin) { this.peerAdmin = peerAdmin; } public void setDomainName(String domainName) { this.domainName = domainName; } public String getName() { return name; } public String getMspid() { return mspid; } public HFCAClient getCaClient() { return caClient; } public Map&lt;String, User&gt; getUserMap() { return userMap; } public Map&lt;String, String&gt; getPeerLocations() { return peerLocations; } public Map&lt;String, String&gt; getOrdererLocations() { return ordererLocations; } public Map&lt;String, String&gt; getEventHubLocations() { return eventHubLocations; } public Set&lt;Peer&gt; getPeers() { return peers; } public SUser getAdmin() { return admin; } public String getCaLocation() { return caLocation; } public Properties getCaProperties() { return caProperties; } public SUser getPeerAdmin() { return peerAdmin; } public String getDomainName() { return domainName; } public void addPeerLocation(String name, String location) { peerLocations.put(name, location); } public void addOrdererLocation(String name, String location) { ordererLocations.put(name, location); } public void addEventHubLocation(String name, String location) { eventHubLocations.put(name, location); } public String getPeerLocation(String name) { return peerLocations.get(name); } public String getOrdererLocation(String name) { return ordererLocations.get(name); } public String getEventHubLocation(String name) { return eventHubLocations.get(name); } public void addUser(SUser user) { userMap.put(user.getName(), user); } } 8.SUser package com.t.fabric; import org.hyperledger.fabric.sdk.Enrollment; import org.hyperledger.fabric.sdk.User; import java.util.HashSet; import java.util.Set; /** * SUser的构造用crypton工具生成的证书本地读取来生成 */ public class SUser implements User { private String userName; private String mspid; private Enrollment enrollment; public SUser(String userName, String mspid) { this.userName = userName; this.mspid = mspid; } public String getName() { return userName; } public Set&lt;String&gt; getRoles() { return new HashSet&lt;String&gt;(); } public String getAccount() { return &quot;&quot;; } public String getAffiliation() { return &quot;&quot;; } public Enrollment getEnrollment() { return this.enrollment; } public String getMspId() { return this.mspid; } public void setEnrollment(Enrollment enrollment) { this.enrollment = enrollment; } } 9. DataRecord package com.t.fabric; public class DataRecord { private String key; private String value; public DataRecord(String key, String value) { this.key = key; this.value = value; } public String getKey() { return key; } public String getValue() { return value; } public void setKey(String key) { this.key = key; } public void setValue(String value) { this.value = value; } public String[] toStringArray() { return new String[] {this.getKey(),this.getValue()}; } @Override public String toString() { return &quot;Data: key = &quot;+key+&quot; value = &quot; +value; } } 10 .Insert package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.Channel; public class TestFabricInsert { private static Logger logger=Logger.getLogger(TestFabricInsert.class); public static void main(String[] args) throws Exception{ FabricUtils.init(); DataRecord dataRecord = new DataRecord(&quot;data&quot;,&quot;{name:\&quot;testName\&quot;,address:\&quot;testAddress\&quot;}&quot;); testInsert(dataRecord); } public static void testInsert(DataRecord record) throws Exception { System.out.println(&quot;test insert&quot;); Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId); channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, CommonUtils.peer0Org1Location)); channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, CommonUtils.orderLocation)); channel.initialize(); FabricUtils.instert(channel,record); } } 11 .query package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.Channel; public class TestFabricQuery { private static Logger logger=Logger.getLogger(TestFabricQuery.class); public static void main(String[] args) throws Exception{ DataRecord dataRecord = new DataRecord(&quot;data&quot;,&quot;&quot;); FabricUtils.init(); testQuery(dataRecord); } public static void testQuery(DataRecord record) throws Exception { logger.debug(&quot;测试Fabric 查询功能&quot;); Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId); channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, FabricUtils.orgHashMap.get(&quot;org1&quot;).getPeerLocation(CommonUtils.peer0Org1Name))); channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, FabricUtils.orgHashMap.get(&quot;org1&quot;).getOrdererLocation(CommonUtils.orderName))); channel.initialize(); FabricUtils.query(channel, record.getKey()); } } 以上就是全部的精简代码了。但是如果直接运行以上代码的话会有一些环境方面的问题，我这边遇到的就是tls问题.... 下面是我打开orderer的日志时发现的问题（表明不是一个合法的tls访问,个人推测）： 1.错误1 grpc: Server.Serve failed to complete security handshake from &quot;172.18.0.1:41678&quot;: tls: first record does not look like a TLS handshake 2. 伴随错误1出现在java日志里的是错误2： Caused by: io.netty.handler.codec.http2.Http2Exception: First received frame was not SETTINGS. Hex dump for first 5 bytes: 1503010002 暂时解决方案就是关闭tls..... 1. 在e2e/base内的两个文件里面分别关掉 docker-compose-base.yaml&nbsp; ---- &gt;&nbsp; ORDERER_GENERAL_TLS_ENABLED=false peer-base.yaml&nbsp; ---- &gt;&nbsp; CORE_PEER_TLS_ENABLED=false 2.在e2e/docker-compose-cli.yaml内的文件中关掉 CORE_PEER_TLS_ENABLED=false 然后重新部署环境。 需要额外注意的是，搭建步骤内的4.2&nbsp; / 5.2 等涉及到tls的参数设置 --tls true 去掉。 insert输出日志： DEBUG sdk.Channel - Creating channel: mychannel, client context Admin DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050 DEBUG sdk.Channel - Channel mychannel initialize shutdown false DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG sdk.Channel - getConfigurationBlock for channel mychannel ... DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200 DEBUG sdk.Channel - Last config index is 2 DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 4104f7b6af57f3a9176ed9e6ce5a506304ef9d35f92d675eb8d64335ce43236d, channelId: mychannel, epoch 0 ... .... DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data DEBUG sdk.Channel - Channel mychannel loadCACertificates DEBUG sdk.Channel - loading certificates for MSP : Org2MSP DEBUG sdk.Channel - loading certificates for MSP : Org1MSP DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP DEBUG sdk.Channel - Channel mychannel loadCACertificates completed DEBUG sdk.Channel - Eventque started null DEBUG sdk.Channel - 0 eventhubs initialized DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting DEBUG sdk.Channel - Channel mychannel blockListener 32a8ef34-46b6-4d3e-af61-903c2e1f27ba starting DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed DEBUG sdk.Channel - Channel mychannel initialized DEBUG transaction.ProposalBuilder - transientMap(&#39;result&#39;, &#39;:)&#39;)) DEBUG transaction.ProposalBuilder - transientMap(&#39;method&#39;, &#39;TransactionProposalRequest&#39;)) DEBUG transaction.ProposalBuilder - transientMap(&#39;HyperLedgerFabric&#39;, &#39;TransactionProposalRequest:JavaSDK&#39;)) DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9, channelId: mychannel, epoch 0 DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version: args(&quot;set&quot;, &quot;data&quot;, &quot;{name:&quot;testName&quot;,address:&quot;testAddress&quot;}&quot;) DEBUG transaction.ProtoUtils - SignatureHeader: nonce: af86713b93d098b8ec2ef7380a2bb584c8355c393ea0d2ab, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6 DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051 DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051 .. .. DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK DEBUG fabric.FabricUtils - payload!!!!!!!: DEBUG sdk.Channel - Channel mychannel sending transaction to orderer(s) with TxID 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 DEBUG sdk.Orderer - Order.sendTransaction name: orderer.example.com, url: grpc://localhost:7050 .... DEBUG sdk.Channel - Channel mychannel successful sent to Orderer transaction id: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 query输出日志： &nbsp; DEBUG helper.Config - Loading configuration from /home/dell/go/javaproject/FabricSdk/config.properties and it is present: false WARN helper.Config - Failed to load any configuration from: config.properties. Using toolkit defaults DEBUG sdk.HFClient - Setting user context to MSPID: Org1MSP user: Admin DEBUG fabric.TestFabricQuery - 测试Fabric 查询功能 DEBUG sdk.Channel - Creating channel: mychannel, client context Admin DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050 DEBUG sdk.Channel - Channel mychannel initialize shutdown false DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 7341e25d471cbc614a1a996f896462286a20f9ba78fd72b619fdedfed674255f, channelId: mychannel, epoch 0 DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050 .... DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200 .. DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 21046ed568a93549a16224a977423351d5d7ef0ffe66455210929ab7acc6480f, channelId: mychannel, epoch 0 DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050 ... .. DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data DEBUG sdk.Channel - Channel mychannel loadCACertificates DEBUG sdk.Channel - loading certificates for MSP : Org2MSP DEBUG sdk.Channel - loading certificates for MSP : Org1MSP DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP DEBUG sdk.Channel - Channel mychannel loadCACertificates completed DEBUG sdk.Channel - Eventque started null DEBUG sdk.Channel - 0 eventhubs initialized DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting DEBUG sdk.Channel - Channel mychannel blockListener 3d8076a4-fca7-466a-904f-5c104c96ea1f starting DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed DEBUG sdk.Channel - Channel mychannel initialized DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: a08572d26702b2bdafe0ac53039e21faadb36e9a0640c9169dd66552af0a1994, channelId: mychannel, epoch 0 DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version: args(&quot;get&quot;, &quot;data&quot;) DEBUG transaction.ProtoUtils - SignatureHeader: nonce: ebc13657e548bdb8319e689baa9c263e6c8fa712835828b8, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6 DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051 DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051 .... .... DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK DEBUG fabric.FabricUtils - payload!!!!!!!: {name:&quot;testName&quot;,address:&quot;testAddress&quot;} 最后贴一下自己的chaincode001（其实就是以前测试的一个简单的chaincode） chaincode 阅读更多" />
<meta property="og:description" content="自从上篇Java-sdk跑通之后，今天已经是8/17号了，这期间干嘛了呢？一直在尝试搭建出一个Java应用层，好对外提供简单的接口以便将来能够实现一些自己的存储。 此篇博客记录时，CA容器没有单独起，而仅仅是在客户端读取已经生成好的CA文件来成功访问。下面说下一些步骤。 1. 搭建出一个Fabric环境。 搭建过程 1.1 这边需要注意1.3 用工具生成的私钥和证书，我们需要拷贝到工程中去。 channel-artifacts 和 crypto-config（这一个是这一期主要的） 2. 整个工程目录如图，只是一个简单的java项目 3. pom文件如下： &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.tc.fabric&lt;/groupId&gt; &lt;artifactId&gt;FabricSdk&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.14&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.hyperledger.fabric-sdk-java&lt;/groupId&gt; &lt;artifactId&gt;fabric-sdk-java&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 4. CommonUtils package com.t.fabric; public class CommonUtils { //peer节点的CA文件路径 public static final String cryptoPeerPath = &quot;crypto-config/peerOrganizations/&quot;; //order节点的CA文件路径 public static final String cryptoOrderPath = &quot;crypto-config/ordererOrganizations/&quot;; //peer节点的CA文件路径 public static String peerFilePath = CommonUtils.class.getResource(&quot;/&quot;).getPath() + cryptoPeerPath; //order节点的CA文件路径 public static String orderFilePath = CommonUtils.class.getResource(&quot;/&quot;).getPath() + cryptoOrderPath; //org1组织的目录 public static final String org1Path = &quot;org1.example.com/users/&quot;; //org1组织的cert文件目录 public static final String org1CertFilePath = &quot;@org1.example.com/msp/signcerts/&quot;; //org1组织的Key文件目录 public static final String org1KeyFilePath = &quot;@org1.example.com/msp/keystore/&quot;; //org2组织的目录 public static final String org2Path = &quot;org2.example.com/users/&quot;; //org2组织的cert文件目录 public static final String org2CertFilePath = &quot;@org2.example.com/msp/signcerts/&quot;; //org2组织的Key文件目录 public static final String org2KeyFilePath = &quot;@org2.example.com/msp/keystore/&quot;; //链码名称 public static final String chainCodeName = &quot;mycc&quot;; //链码版本 public static final String chaincodeVersion = &quot;1&quot;; //channel名称 public static final String channelId = &quot;mychannel&quot;; //order名称 和 Fabrci-java-sdk保持一致 public static final String orderName = &quot;orderer.example.com&quot;; //peer0org1名称 和 Fabrci-java-sdk保持一致 public static final String peer0Org1Name = &quot;peer0.org1.example.com&quot;; //peer1org1名称 和 Fabrci-java-sdk保持一致 public static final String peer1Org1Name = &quot;peer1.org1.example.com&quot;; //peer0org2名称 和 Fabrci-java-sdk保持一致 public static final String peer0Org2Name = &quot;peer0.org2.example.com&quot;; //peer1org2名称 和 Fabrci-java-sdk保持一致 public static final String peer1Org2Name = &quot;peer1.org2.example.com&quot;; //order地址 public static final String orderLocation = &quot;grpc://localhost:7050&quot;; //peer0org1地址 public static final String peer0Org1Location = &quot;grpc://localhost:7051&quot;; //peer1org1地址 public static final String peer1Org1Location = &quot;grpc://localhost:8051&quot;; //peer0org2地址 public static final String peer0Org2Location = &quot;grpc://localhost:9051&quot;; //peer1org2地址 public static final String peer1Org2Location = &quot;grpc://localhost:10051&quot;; } 5.FabricUtils package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.*; import org.hyperledger.fabric.sdk.security.CryptoSuite; import java.util.Collection; import java.util.HashMap; import java.util.Map; import static java.nio.charset.StandardCharsets.UTF_8; /** * FabricUtils,暂时不关注CA方面的东西 */ public class FabricUtils { //日志记录 private static Logger logger = Logger.getLogger(FabricUtils.class); //CA客户端 public static HFClient client = null; public static CryptoSuite cs = null; public static HashMap&lt;String, SOrg&gt; orgHashMap=null; public static ChaincodeID cid = null; public static User peer0org1=null; public static void init()throws Exception{ cs = CryptoSuite.Factory.getCryptoSuite(); cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build(); client = HFClient.createNewInstance(); client.setCryptoSuite(cs); orgHashMap = OrgConfig.getSOrg(); peer0org1 = orgHashMap.get(&quot;org1&quot;).getAdmin(); client.setUserContext(peer0org1); } /* * 实现插入数据 * */ public static void instertFabcar(Channel channel, DataRecord data) throws Exception { TransactionProposalRequest req = client.newTransactionProposalRequest(); req.setChaincodeID(cid); req.setFcn(&quot;set&quot;); req.setArgs(data.toStringArray()); Map&lt;String, byte[]&gt; tm2 = new HashMap&lt;&gt;(); //代码来自End2End tm2.put(&quot;HyperLedgerFabric&quot;, &quot;TransactionProposalRequest:JavaSDK&quot;.getBytes(UTF_8)); tm2.put(&quot;method&quot;, &quot;TransactionProposalRequest&quot;.getBytes(UTF_8)); tm2.put(&quot;result&quot;, &quot;:)&quot;.getBytes(UTF_8)); req.setTransientMap(tm2); Collection&lt;ProposalResponse&gt; resps = channel.sendTransactionProposal(req); for (ProposalResponse resp : resps) { String payload = new String(resp.getChaincodeActionResponsePayload()); logger.debug(&quot;payload!!!!!!!: &quot;+payload); } channel.sendTransaction(resps); } /* * 实现给定的Key查询数据 * */ public static void queryFabcar(Channel channel, String key) throws Exception { QueryByChaincodeRequest req = client.newQueryProposalRequest(); ChaincodeID cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build(); req.setChaincodeID(cid); req.setFcn(&quot;get&quot;); req.setArgs(new String[] { key }); Collection&lt;ProposalResponse&gt; resps = channel.queryByChaincode(req); for (ProposalResponse resp : resps) { String payload = new String(resp.getChaincodeActionResponsePayload()); logger.debug(&quot;payload!!!!!!!: &quot;+payload); } } } 6. OrgConfig package com.t.fabric; import org.apache.commons.io.IOUtils; import org.bouncycastle.asn1.pkcs.PrivateKeyInfo; import org.bouncycastle.jce.provider.BouncyCastleProvider; import org.bouncycastle.openssl.PEMParser; import org.bouncycastle.openssl.jcajce.JcaPEMKeyConverter; import org.hyperledger.fabric.sdk.Enrollment; import java.io.*; import java.security.NoSuchAlgorithmException; import java.security.NoSuchProviderException; import java.security.PrivateKey; import java.security.spec.InvalidKeySpecException; import java.util.HashMap; /** * 模拟peer,order,admin,user等一些配置项 */ public class OrgConfig { /** * 获取Org组织信息, * 代码精简自End2End * @return */ public static HashMap&lt;String,SOrg&gt; getSOrg() throws Exception{ HashMap&lt;String,SOrg&gt; orgMap = new HashMap&lt;&gt;(); SOrg org1=new SOrg(&quot;Org1&quot;,&quot;Org1MSP&quot;); org1.addPeerLocation(CommonUtils.peer0Org1Name,CommonUtils.peer0Org1Location); org1.addPeerLocation(CommonUtils.peer1Org1Name,CommonUtils.peer1Org1Location); org1.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation); SUser adminOrg1 = new SUser(&quot;Admin&quot;,&quot;Org1MSP&quot;); SUser user1Org1 = new SUser(&quot;User1&quot;,&quot;Org1MSP&quot;); adminOrg1.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg1.getName(),adminOrg1.getMspId()) ,getCertificateFile(adminOrg1.getName(),adminOrg1.getMspId()))); user1Org1.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org1.getName(),user1Org1.getMspId()) ,getCertificateFile(user1Org1.getName(),user1Org1.getMspId()))); org1.addUser(adminOrg1); org1.addUser(user1Org1); org1.setAdmin(adminOrg1); SOrg org2=new SOrg(&quot;Org2&quot;,&quot;Org2MSP&quot;); org2.addPeerLocation(CommonUtils.peer0Org2Name,CommonUtils.peer0Org2Location); org2.addPeerLocation(CommonUtils.peer1Org2Name,CommonUtils.peer1Org2Location); org2.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation); SUser adminOrg2 = new SUser(&quot;Admin&quot;,&quot;Org2MSP&quot;); SUser user1Org2 = new SUser(&quot;User1&quot;,&quot;Org2MSP&quot;); adminOrg2.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg2.getName(),adminOrg2.getMspId()) ,getCertificateFile(adminOrg2.getName(),adminOrg2.getMspId()))); user1Org2.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org2.getName(),user1Org2.getMspId()) ,getCertificateFile(user1Org2.getName(),user1Org2.getMspId()))); org2.addUser(adminOrg2); org2.addUser(user1Org2); org2.setAdmin(adminOrg2); orgMap.put(&quot;org1&quot;,org1); orgMap.put(&quot;org2&quot;,org2); return orgMap; } /** * 获取对应用户的私钥Key * @param userName * @param mspId * @return */ public static PrivateKey getKeyFile(String userName,String mspId) throws Exception{ String tempPath = null; String fileName = null; String keyFile = null; if(&quot;Org1MSP&quot;.equals(mspId)){ tempPath = CommonUtils.peerFilePath +CommonUtils.org1Path + userName + CommonUtils.org1KeyFilePath; fileName = new File(tempPath).listFiles()[0].getName(); keyFile = tempPath + fileName; }else { tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2KeyFilePath; fileName = new File(tempPath).listFiles()[0].getName(); keyFile = tempPath + fileName; } //来源于ChannelTest return getPrivateKeyFromBytes(IOUtils.toByteArray(new FileInputStream(keyFile))); } /** * 获取对应用户的ceritificate证书 * @param userName * @param mspId * @return * @throws Exception */ public static String getCertificateFile(String userName,String mspId) throws Exception{ String tempPath = null; String fileName = null; String certFile = null; if(&quot;Org1MSP&quot;.equals(mspId)){ tempPath = CommonUtils.peerFilePath + CommonUtils.org1Path + userName + CommonUtils.org1CertFilePath; fileName = new File(tempPath).listFiles()[0].getName(); certFile = tempPath + fileName; }else { tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2CertFilePath; fileName = new File(tempPath).listFiles()[0].getName(); certFile = tempPath + fileName; } //来源于ChannelTest return new String(IOUtils.toByteArray(new FileInputStream(certFile)), &quot;UTF-8&quot;); } public static PrivateKey getPrivateKeyFromBytes(byte[] data) throws NoSuchProviderException, NoSuchAlgorithmException, InvalidKeySpecException, IOException { final Reader pemReader = new StringReader(new String(data)); final PrivateKeyInfo pemPair; try (PEMParser pemParser = new PEMParser(pemReader)) { pemPair = (PrivateKeyInfo) pemParser.readObject(); } PrivateKey privateKey = new JcaPEMKeyConverter().setProvider(BouncyCastleProvider.PROVIDER_NAME).getPrivateKey(pemPair); return privateKey; } static final class SampleStoreEnrollement implements Enrollment, Serializable { private final PrivateKey privateKey; private final String certificate; SampleStoreEnrollement(PrivateKey privateKey, String certificate) { this.certificate = certificate; this.privateKey = privateKey; } @Override public PrivateKey getKey() { return privateKey; } @Override public String getCert() { return certificate; } } } 7. SOrg package com.t.fabric; import org.hyperledger.fabric.sdk.Peer; import org.hyperledger.fabric.sdk.User; import org.hyperledger.fabric_ca.sdk.HFCAClient; import java.util.*; /** * Java-SDK直接复制得来 */ public class SOrg { private String name; private String mspid; private HFCAClient caClient; //暂时未使用 private Map&lt;String, User&gt; userMap = new HashMap&lt;String, User&gt;(); private Map&lt;String, String&gt; peerLocations = new HashMap&lt;String, String&gt;(); private Map&lt;String, String&gt; ordererLocations = new HashMap&lt;String, String&gt;(); private Map&lt;String, String&gt; eventHubLocations = new HashMap&lt;String, String&gt;(); //暂时未使用 private Set&lt;Peer&gt; peers = new HashSet&lt;Peer&gt;(); //暂时未使用 private SUser admin; private String caLocation; //暂时未使用 private Properties caProperties = null; //暂时未使用 private SUser peerAdmin; //暂时未使用 private String domainName; //暂时未使用 public SOrg(String name, String mspid) { this.name = name; this.mspid = mspid; } public void setName(String name) { this.name = name; } public void setMspid(String mspid) { this.mspid = mspid; } public void setCaClient(HFCAClient caClient) { this.caClient = caClient; } public void setUserMap(Map&lt;String, User&gt; userMap) { this.userMap = userMap; } public void setPeerLocations(Map&lt;String, String&gt; peerLocations) { this.peerLocations = peerLocations; } public void setOrdererLocations(Map&lt;String, String&gt; ordererLocations) { this.ordererLocations = ordererLocations; } public void setEventHubLocations(Map&lt;String, String&gt; eventHubLocations) { this.eventHubLocations = eventHubLocations; } public void setPeers(Set&lt;Peer&gt; peers) { this.peers = peers; } public void setAdmin(SUser admin) { this.admin = admin; } public void setCaLocation(String caLocation) { this.caLocation = caLocation; } public void setCaProperties(Properties caProperties) { this.caProperties = caProperties; } public void setPeerAdmin(SUser peerAdmin) { this.peerAdmin = peerAdmin; } public void setDomainName(String domainName) { this.domainName = domainName; } public String getName() { return name; } public String getMspid() { return mspid; } public HFCAClient getCaClient() { return caClient; } public Map&lt;String, User&gt; getUserMap() { return userMap; } public Map&lt;String, String&gt; getPeerLocations() { return peerLocations; } public Map&lt;String, String&gt; getOrdererLocations() { return ordererLocations; } public Map&lt;String, String&gt; getEventHubLocations() { return eventHubLocations; } public Set&lt;Peer&gt; getPeers() { return peers; } public SUser getAdmin() { return admin; } public String getCaLocation() { return caLocation; } public Properties getCaProperties() { return caProperties; } public SUser getPeerAdmin() { return peerAdmin; } public String getDomainName() { return domainName; } public void addPeerLocation(String name, String location) { peerLocations.put(name, location); } public void addOrdererLocation(String name, String location) { ordererLocations.put(name, location); } public void addEventHubLocation(String name, String location) { eventHubLocations.put(name, location); } public String getPeerLocation(String name) { return peerLocations.get(name); } public String getOrdererLocation(String name) { return ordererLocations.get(name); } public String getEventHubLocation(String name) { return eventHubLocations.get(name); } public void addUser(SUser user) { userMap.put(user.getName(), user); } } 8.SUser package com.t.fabric; import org.hyperledger.fabric.sdk.Enrollment; import org.hyperledger.fabric.sdk.User; import java.util.HashSet; import java.util.Set; /** * SUser的构造用crypton工具生成的证书本地读取来生成 */ public class SUser implements User { private String userName; private String mspid; private Enrollment enrollment; public SUser(String userName, String mspid) { this.userName = userName; this.mspid = mspid; } public String getName() { return userName; } public Set&lt;String&gt; getRoles() { return new HashSet&lt;String&gt;(); } public String getAccount() { return &quot;&quot;; } public String getAffiliation() { return &quot;&quot;; } public Enrollment getEnrollment() { return this.enrollment; } public String getMspId() { return this.mspid; } public void setEnrollment(Enrollment enrollment) { this.enrollment = enrollment; } } 9. DataRecord package com.t.fabric; public class DataRecord { private String key; private String value; public DataRecord(String key, String value) { this.key = key; this.value = value; } public String getKey() { return key; } public String getValue() { return value; } public void setKey(String key) { this.key = key; } public void setValue(String value) { this.value = value; } public String[] toStringArray() { return new String[] {this.getKey(),this.getValue()}; } @Override public String toString() { return &quot;Data: key = &quot;+key+&quot; value = &quot; +value; } } 10 .Insert package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.Channel; public class TestFabricInsert { private static Logger logger=Logger.getLogger(TestFabricInsert.class); public static void main(String[] args) throws Exception{ FabricUtils.init(); DataRecord dataRecord = new DataRecord(&quot;data&quot;,&quot;{name:\&quot;testName\&quot;,address:\&quot;testAddress\&quot;}&quot;); testInsert(dataRecord); } public static void testInsert(DataRecord record) throws Exception { System.out.println(&quot;test insert&quot;); Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId); channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, CommonUtils.peer0Org1Location)); channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, CommonUtils.orderLocation)); channel.initialize(); FabricUtils.instert(channel,record); } } 11 .query package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.Channel; public class TestFabricQuery { private static Logger logger=Logger.getLogger(TestFabricQuery.class); public static void main(String[] args) throws Exception{ DataRecord dataRecord = new DataRecord(&quot;data&quot;,&quot;&quot;); FabricUtils.init(); testQuery(dataRecord); } public static void testQuery(DataRecord record) throws Exception { logger.debug(&quot;测试Fabric 查询功能&quot;); Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId); channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, FabricUtils.orgHashMap.get(&quot;org1&quot;).getPeerLocation(CommonUtils.peer0Org1Name))); channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, FabricUtils.orgHashMap.get(&quot;org1&quot;).getOrdererLocation(CommonUtils.orderName))); channel.initialize(); FabricUtils.query(channel, record.getKey()); } } 以上就是全部的精简代码了。但是如果直接运行以上代码的话会有一些环境方面的问题，我这边遇到的就是tls问题.... 下面是我打开orderer的日志时发现的问题（表明不是一个合法的tls访问,个人推测）： 1.错误1 grpc: Server.Serve failed to complete security handshake from &quot;172.18.0.1:41678&quot;: tls: first record does not look like a TLS handshake 2. 伴随错误1出现在java日志里的是错误2： Caused by: io.netty.handler.codec.http2.Http2Exception: First received frame was not SETTINGS. Hex dump for first 5 bytes: 1503010002 暂时解决方案就是关闭tls..... 1. 在e2e/base内的两个文件里面分别关掉 docker-compose-base.yaml&nbsp; ---- &gt;&nbsp; ORDERER_GENERAL_TLS_ENABLED=false peer-base.yaml&nbsp; ---- &gt;&nbsp; CORE_PEER_TLS_ENABLED=false 2.在e2e/docker-compose-cli.yaml内的文件中关掉 CORE_PEER_TLS_ENABLED=false 然后重新部署环境。 需要额外注意的是，搭建步骤内的4.2&nbsp; / 5.2 等涉及到tls的参数设置 --tls true 去掉。 insert输出日志： DEBUG sdk.Channel - Creating channel: mychannel, client context Admin DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050 DEBUG sdk.Channel - Channel mychannel initialize shutdown false DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG sdk.Channel - getConfigurationBlock for channel mychannel ... DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200 DEBUG sdk.Channel - Last config index is 2 DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 4104f7b6af57f3a9176ed9e6ce5a506304ef9d35f92d675eb8d64335ce43236d, channelId: mychannel, epoch 0 ... .... DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data DEBUG sdk.Channel - Channel mychannel loadCACertificates DEBUG sdk.Channel - loading certificates for MSP : Org2MSP DEBUG sdk.Channel - loading certificates for MSP : Org1MSP DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP DEBUG sdk.Channel - Channel mychannel loadCACertificates completed DEBUG sdk.Channel - Eventque started null DEBUG sdk.Channel - 0 eventhubs initialized DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting DEBUG sdk.Channel - Channel mychannel blockListener 32a8ef34-46b6-4d3e-af61-903c2e1f27ba starting DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed DEBUG sdk.Channel - Channel mychannel initialized DEBUG transaction.ProposalBuilder - transientMap(&#39;result&#39;, &#39;:)&#39;)) DEBUG transaction.ProposalBuilder - transientMap(&#39;method&#39;, &#39;TransactionProposalRequest&#39;)) DEBUG transaction.ProposalBuilder - transientMap(&#39;HyperLedgerFabric&#39;, &#39;TransactionProposalRequest:JavaSDK&#39;)) DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9, channelId: mychannel, epoch 0 DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version: args(&quot;set&quot;, &quot;data&quot;, &quot;{name:&quot;testName&quot;,address:&quot;testAddress&quot;}&quot;) DEBUG transaction.ProtoUtils - SignatureHeader: nonce: af86713b93d098b8ec2ef7380a2bb584c8355c393ea0d2ab, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6 DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051 DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051 .. .. DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK DEBUG fabric.FabricUtils - payload!!!!!!!: DEBUG sdk.Channel - Channel mychannel sending transaction to orderer(s) with TxID 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 DEBUG sdk.Orderer - Order.sendTransaction name: orderer.example.com, url: grpc://localhost:7050 .... DEBUG sdk.Channel - Channel mychannel successful sent to Orderer transaction id: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 query输出日志： &nbsp; DEBUG helper.Config - Loading configuration from /home/dell/go/javaproject/FabricSdk/config.properties and it is present: false WARN helper.Config - Failed to load any configuration from: config.properties. Using toolkit defaults DEBUG sdk.HFClient - Setting user context to MSPID: Org1MSP user: Admin DEBUG fabric.TestFabricQuery - 测试Fabric 查询功能 DEBUG sdk.Channel - Creating channel: mychannel, client context Admin DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050 DEBUG sdk.Channel - Channel mychannel initialize shutdown false DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 7341e25d471cbc614a1a996f896462286a20f9ba78fd72b619fdedfed674255f, channelId: mychannel, epoch 0 DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050 .... DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200 .. DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 21046ed568a93549a16224a977423351d5d7ef0ffe66455210929ab7acc6480f, channelId: mychannel, epoch 0 DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050 ... .. DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data DEBUG sdk.Channel - Channel mychannel loadCACertificates DEBUG sdk.Channel - loading certificates for MSP : Org2MSP DEBUG sdk.Channel - loading certificates for MSP : Org1MSP DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP DEBUG sdk.Channel - Channel mychannel loadCACertificates completed DEBUG sdk.Channel - Eventque started null DEBUG sdk.Channel - 0 eventhubs initialized DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting DEBUG sdk.Channel - Channel mychannel blockListener 3d8076a4-fca7-466a-904f-5c104c96ea1f starting DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed DEBUG sdk.Channel - Channel mychannel initialized DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: a08572d26702b2bdafe0ac53039e21faadb36e9a0640c9169dd66552af0a1994, channelId: mychannel, epoch 0 DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version: args(&quot;get&quot;, &quot;data&quot;) DEBUG transaction.ProtoUtils - SignatureHeader: nonce: ebc13657e548bdb8319e689baa9c263e6c8fa712835828b8, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6 DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051 DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051 .... .... DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK DEBUG fabric.FabricUtils - payload!!!!!!!: {name:&quot;testName&quot;,address:&quot;testAddress&quot;} 最后贴一下自己的chaincode001（其实就是以前测试的一个简单的chaincode） chaincode 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-17T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"自从上篇Java-sdk跑通之后，今天已经是8/17号了，这期间干嘛了呢？一直在尝试搭建出一个Java应用层，好对外提供简单的接口以便将来能够实现一些自己的存储。 此篇博客记录时，CA容器没有单独起，而仅仅是在客户端读取已经生成好的CA文件来成功访问。下面说下一些步骤。 1. 搭建出一个Fabric环境。 搭建过程 1.1 这边需要注意1.3 用工具生成的私钥和证书，我们需要拷贝到工程中去。 channel-artifacts 和 crypto-config（这一个是这一期主要的） 2. 整个工程目录如图，只是一个简单的java项目 3. pom文件如下： &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.tc.fabric&lt;/groupId&gt; &lt;artifactId&gt;FabricSdk&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.14&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.hyperledger.fabric-sdk-java&lt;/groupId&gt; &lt;artifactId&gt;fabric-sdk-java&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 4. CommonUtils package com.t.fabric; public class CommonUtils { //peer节点的CA文件路径 public static final String cryptoPeerPath = &quot;crypto-config/peerOrganizations/&quot;; //order节点的CA文件路径 public static final String cryptoOrderPath = &quot;crypto-config/ordererOrganizations/&quot;; //peer节点的CA文件路径 public static String peerFilePath = CommonUtils.class.getResource(&quot;/&quot;).getPath() + cryptoPeerPath; //order节点的CA文件路径 public static String orderFilePath = CommonUtils.class.getResource(&quot;/&quot;).getPath() + cryptoOrderPath; //org1组织的目录 public static final String org1Path = &quot;org1.example.com/users/&quot;; //org1组织的cert文件目录 public static final String org1CertFilePath = &quot;@org1.example.com/msp/signcerts/&quot;; //org1组织的Key文件目录 public static final String org1KeyFilePath = &quot;@org1.example.com/msp/keystore/&quot;; //org2组织的目录 public static final String org2Path = &quot;org2.example.com/users/&quot;; //org2组织的cert文件目录 public static final String org2CertFilePath = &quot;@org2.example.com/msp/signcerts/&quot;; //org2组织的Key文件目录 public static final String org2KeyFilePath = &quot;@org2.example.com/msp/keystore/&quot;; //链码名称 public static final String chainCodeName = &quot;mycc&quot;; //链码版本 public static final String chaincodeVersion = &quot;1&quot;; //channel名称 public static final String channelId = &quot;mychannel&quot;; //order名称 和 Fabrci-java-sdk保持一致 public static final String orderName = &quot;orderer.example.com&quot;; //peer0org1名称 和 Fabrci-java-sdk保持一致 public static final String peer0Org1Name = &quot;peer0.org1.example.com&quot;; //peer1org1名称 和 Fabrci-java-sdk保持一致 public static final String peer1Org1Name = &quot;peer1.org1.example.com&quot;; //peer0org2名称 和 Fabrci-java-sdk保持一致 public static final String peer0Org2Name = &quot;peer0.org2.example.com&quot;; //peer1org2名称 和 Fabrci-java-sdk保持一致 public static final String peer1Org2Name = &quot;peer1.org2.example.com&quot;; //order地址 public static final String orderLocation = &quot;grpc://localhost:7050&quot;; //peer0org1地址 public static final String peer0Org1Location = &quot;grpc://localhost:7051&quot;; //peer1org1地址 public static final String peer1Org1Location = &quot;grpc://localhost:8051&quot;; //peer0org2地址 public static final String peer0Org2Location = &quot;grpc://localhost:9051&quot;; //peer1org2地址 public static final String peer1Org2Location = &quot;grpc://localhost:10051&quot;; } 5.FabricUtils package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.*; import org.hyperledger.fabric.sdk.security.CryptoSuite; import java.util.Collection; import java.util.HashMap; import java.util.Map; import static java.nio.charset.StandardCharsets.UTF_8; /** * FabricUtils,暂时不关注CA方面的东西 */ public class FabricUtils { //日志记录 private static Logger logger = Logger.getLogger(FabricUtils.class); //CA客户端 public static HFClient client = null; public static CryptoSuite cs = null; public static HashMap&lt;String, SOrg&gt; orgHashMap=null; public static ChaincodeID cid = null; public static User peer0org1=null; public static void init()throws Exception{ cs = CryptoSuite.Factory.getCryptoSuite(); cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build(); client = HFClient.createNewInstance(); client.setCryptoSuite(cs); orgHashMap = OrgConfig.getSOrg(); peer0org1 = orgHashMap.get(&quot;org1&quot;).getAdmin(); client.setUserContext(peer0org1); } /* * 实现插入数据 * */ public static void instertFabcar(Channel channel, DataRecord data) throws Exception { TransactionProposalRequest req = client.newTransactionProposalRequest(); req.setChaincodeID(cid); req.setFcn(&quot;set&quot;); req.setArgs(data.toStringArray()); Map&lt;String, byte[]&gt; tm2 = new HashMap&lt;&gt;(); //代码来自End2End tm2.put(&quot;HyperLedgerFabric&quot;, &quot;TransactionProposalRequest:JavaSDK&quot;.getBytes(UTF_8)); tm2.put(&quot;method&quot;, &quot;TransactionProposalRequest&quot;.getBytes(UTF_8)); tm2.put(&quot;result&quot;, &quot;:)&quot;.getBytes(UTF_8)); req.setTransientMap(tm2); Collection&lt;ProposalResponse&gt; resps = channel.sendTransactionProposal(req); for (ProposalResponse resp : resps) { String payload = new String(resp.getChaincodeActionResponsePayload()); logger.debug(&quot;payload!!!!!!!: &quot;+payload); } channel.sendTransaction(resps); } /* * 实现给定的Key查询数据 * */ public static void queryFabcar(Channel channel, String key) throws Exception { QueryByChaincodeRequest req = client.newQueryProposalRequest(); ChaincodeID cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build(); req.setChaincodeID(cid); req.setFcn(&quot;get&quot;); req.setArgs(new String[] { key }); Collection&lt;ProposalResponse&gt; resps = channel.queryByChaincode(req); for (ProposalResponse resp : resps) { String payload = new String(resp.getChaincodeActionResponsePayload()); logger.debug(&quot;payload!!!!!!!: &quot;+payload); } } } 6. OrgConfig package com.t.fabric; import org.apache.commons.io.IOUtils; import org.bouncycastle.asn1.pkcs.PrivateKeyInfo; import org.bouncycastle.jce.provider.BouncyCastleProvider; import org.bouncycastle.openssl.PEMParser; import org.bouncycastle.openssl.jcajce.JcaPEMKeyConverter; import org.hyperledger.fabric.sdk.Enrollment; import java.io.*; import java.security.NoSuchAlgorithmException; import java.security.NoSuchProviderException; import java.security.PrivateKey; import java.security.spec.InvalidKeySpecException; import java.util.HashMap; /** * 模拟peer,order,admin,user等一些配置项 */ public class OrgConfig { /** * 获取Org组织信息, * 代码精简自End2End * @return */ public static HashMap&lt;String,SOrg&gt; getSOrg() throws Exception{ HashMap&lt;String,SOrg&gt; orgMap = new HashMap&lt;&gt;(); SOrg org1=new SOrg(&quot;Org1&quot;,&quot;Org1MSP&quot;); org1.addPeerLocation(CommonUtils.peer0Org1Name,CommonUtils.peer0Org1Location); org1.addPeerLocation(CommonUtils.peer1Org1Name,CommonUtils.peer1Org1Location); org1.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation); SUser adminOrg1 = new SUser(&quot;Admin&quot;,&quot;Org1MSP&quot;); SUser user1Org1 = new SUser(&quot;User1&quot;,&quot;Org1MSP&quot;); adminOrg1.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg1.getName(),adminOrg1.getMspId()) ,getCertificateFile(adminOrg1.getName(),adminOrg1.getMspId()))); user1Org1.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org1.getName(),user1Org1.getMspId()) ,getCertificateFile(user1Org1.getName(),user1Org1.getMspId()))); org1.addUser(adminOrg1); org1.addUser(user1Org1); org1.setAdmin(adminOrg1); SOrg org2=new SOrg(&quot;Org2&quot;,&quot;Org2MSP&quot;); org2.addPeerLocation(CommonUtils.peer0Org2Name,CommonUtils.peer0Org2Location); org2.addPeerLocation(CommonUtils.peer1Org2Name,CommonUtils.peer1Org2Location); org2.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation); SUser adminOrg2 = new SUser(&quot;Admin&quot;,&quot;Org2MSP&quot;); SUser user1Org2 = new SUser(&quot;User1&quot;,&quot;Org2MSP&quot;); adminOrg2.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg2.getName(),adminOrg2.getMspId()) ,getCertificateFile(adminOrg2.getName(),adminOrg2.getMspId()))); user1Org2.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org2.getName(),user1Org2.getMspId()) ,getCertificateFile(user1Org2.getName(),user1Org2.getMspId()))); org2.addUser(adminOrg2); org2.addUser(user1Org2); org2.setAdmin(adminOrg2); orgMap.put(&quot;org1&quot;,org1); orgMap.put(&quot;org2&quot;,org2); return orgMap; } /** * 获取对应用户的私钥Key * @param userName * @param mspId * @return */ public static PrivateKey getKeyFile(String userName,String mspId) throws Exception{ String tempPath = null; String fileName = null; String keyFile = null; if(&quot;Org1MSP&quot;.equals(mspId)){ tempPath = CommonUtils.peerFilePath +CommonUtils.org1Path + userName + CommonUtils.org1KeyFilePath; fileName = new File(tempPath).listFiles()[0].getName(); keyFile = tempPath + fileName; }else { tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2KeyFilePath; fileName = new File(tempPath).listFiles()[0].getName(); keyFile = tempPath + fileName; } //来源于ChannelTest return getPrivateKeyFromBytes(IOUtils.toByteArray(new FileInputStream(keyFile))); } /** * 获取对应用户的ceritificate证书 * @param userName * @param mspId * @return * @throws Exception */ public static String getCertificateFile(String userName,String mspId) throws Exception{ String tempPath = null; String fileName = null; String certFile = null; if(&quot;Org1MSP&quot;.equals(mspId)){ tempPath = CommonUtils.peerFilePath + CommonUtils.org1Path + userName + CommonUtils.org1CertFilePath; fileName = new File(tempPath).listFiles()[0].getName(); certFile = tempPath + fileName; }else { tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2CertFilePath; fileName = new File(tempPath).listFiles()[0].getName(); certFile = tempPath + fileName; } //来源于ChannelTest return new String(IOUtils.toByteArray(new FileInputStream(certFile)), &quot;UTF-8&quot;); } public static PrivateKey getPrivateKeyFromBytes(byte[] data) throws NoSuchProviderException, NoSuchAlgorithmException, InvalidKeySpecException, IOException { final Reader pemReader = new StringReader(new String(data)); final PrivateKeyInfo pemPair; try (PEMParser pemParser = new PEMParser(pemReader)) { pemPair = (PrivateKeyInfo) pemParser.readObject(); } PrivateKey privateKey = new JcaPEMKeyConverter().setProvider(BouncyCastleProvider.PROVIDER_NAME).getPrivateKey(pemPair); return privateKey; } static final class SampleStoreEnrollement implements Enrollment, Serializable { private final PrivateKey privateKey; private final String certificate; SampleStoreEnrollement(PrivateKey privateKey, String certificate) { this.certificate = certificate; this.privateKey = privateKey; } @Override public PrivateKey getKey() { return privateKey; } @Override public String getCert() { return certificate; } } } 7. SOrg package com.t.fabric; import org.hyperledger.fabric.sdk.Peer; import org.hyperledger.fabric.sdk.User; import org.hyperledger.fabric_ca.sdk.HFCAClient; import java.util.*; /** * Java-SDK直接复制得来 */ public class SOrg { private String name; private String mspid; private HFCAClient caClient; //暂时未使用 private Map&lt;String, User&gt; userMap = new HashMap&lt;String, User&gt;(); private Map&lt;String, String&gt; peerLocations = new HashMap&lt;String, String&gt;(); private Map&lt;String, String&gt; ordererLocations = new HashMap&lt;String, String&gt;(); private Map&lt;String, String&gt; eventHubLocations = new HashMap&lt;String, String&gt;(); //暂时未使用 private Set&lt;Peer&gt; peers = new HashSet&lt;Peer&gt;(); //暂时未使用 private SUser admin; private String caLocation; //暂时未使用 private Properties caProperties = null; //暂时未使用 private SUser peerAdmin; //暂时未使用 private String domainName; //暂时未使用 public SOrg(String name, String mspid) { this.name = name; this.mspid = mspid; } public void setName(String name) { this.name = name; } public void setMspid(String mspid) { this.mspid = mspid; } public void setCaClient(HFCAClient caClient) { this.caClient = caClient; } public void setUserMap(Map&lt;String, User&gt; userMap) { this.userMap = userMap; } public void setPeerLocations(Map&lt;String, String&gt; peerLocations) { this.peerLocations = peerLocations; } public void setOrdererLocations(Map&lt;String, String&gt; ordererLocations) { this.ordererLocations = ordererLocations; } public void setEventHubLocations(Map&lt;String, String&gt; eventHubLocations) { this.eventHubLocations = eventHubLocations; } public void setPeers(Set&lt;Peer&gt; peers) { this.peers = peers; } public void setAdmin(SUser admin) { this.admin = admin; } public void setCaLocation(String caLocation) { this.caLocation = caLocation; } public void setCaProperties(Properties caProperties) { this.caProperties = caProperties; } public void setPeerAdmin(SUser peerAdmin) { this.peerAdmin = peerAdmin; } public void setDomainName(String domainName) { this.domainName = domainName; } public String getName() { return name; } public String getMspid() { return mspid; } public HFCAClient getCaClient() { return caClient; } public Map&lt;String, User&gt; getUserMap() { return userMap; } public Map&lt;String, String&gt; getPeerLocations() { return peerLocations; } public Map&lt;String, String&gt; getOrdererLocations() { return ordererLocations; } public Map&lt;String, String&gt; getEventHubLocations() { return eventHubLocations; } public Set&lt;Peer&gt; getPeers() { return peers; } public SUser getAdmin() { return admin; } public String getCaLocation() { return caLocation; } public Properties getCaProperties() { return caProperties; } public SUser getPeerAdmin() { return peerAdmin; } public String getDomainName() { return domainName; } public void addPeerLocation(String name, String location) { peerLocations.put(name, location); } public void addOrdererLocation(String name, String location) { ordererLocations.put(name, location); } public void addEventHubLocation(String name, String location) { eventHubLocations.put(name, location); } public String getPeerLocation(String name) { return peerLocations.get(name); } public String getOrdererLocation(String name) { return ordererLocations.get(name); } public String getEventHubLocation(String name) { return eventHubLocations.get(name); } public void addUser(SUser user) { userMap.put(user.getName(), user); } } 8.SUser package com.t.fabric; import org.hyperledger.fabric.sdk.Enrollment; import org.hyperledger.fabric.sdk.User; import java.util.HashSet; import java.util.Set; /** * SUser的构造用crypton工具生成的证书本地读取来生成 */ public class SUser implements User { private String userName; private String mspid; private Enrollment enrollment; public SUser(String userName, String mspid) { this.userName = userName; this.mspid = mspid; } public String getName() { return userName; } public Set&lt;String&gt; getRoles() { return new HashSet&lt;String&gt;(); } public String getAccount() { return &quot;&quot;; } public String getAffiliation() { return &quot;&quot;; } public Enrollment getEnrollment() { return this.enrollment; } public String getMspId() { return this.mspid; } public void setEnrollment(Enrollment enrollment) { this.enrollment = enrollment; } } 9. DataRecord package com.t.fabric; public class DataRecord { private String key; private String value; public DataRecord(String key, String value) { this.key = key; this.value = value; } public String getKey() { return key; } public String getValue() { return value; } public void setKey(String key) { this.key = key; } public void setValue(String value) { this.value = value; } public String[] toStringArray() { return new String[] {this.getKey(),this.getValue()}; } @Override public String toString() { return &quot;Data: key = &quot;+key+&quot; value = &quot; +value; } } 10 .Insert package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.Channel; public class TestFabricInsert { private static Logger logger=Logger.getLogger(TestFabricInsert.class); public static void main(String[] args) throws Exception{ FabricUtils.init(); DataRecord dataRecord = new DataRecord(&quot;data&quot;,&quot;{name:\\&quot;testName\\&quot;,address:\\&quot;testAddress\\&quot;}&quot;); testInsert(dataRecord); } public static void testInsert(DataRecord record) throws Exception { System.out.println(&quot;test insert&quot;); Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId); channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, CommonUtils.peer0Org1Location)); channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, CommonUtils.orderLocation)); channel.initialize(); FabricUtils.instert(channel,record); } } 11 .query package com.t.fabric; import org.apache.log4j.Logger; import org.hyperledger.fabric.sdk.Channel; public class TestFabricQuery { private static Logger logger=Logger.getLogger(TestFabricQuery.class); public static void main(String[] args) throws Exception{ DataRecord dataRecord = new DataRecord(&quot;data&quot;,&quot;&quot;); FabricUtils.init(); testQuery(dataRecord); } public static void testQuery(DataRecord record) throws Exception { logger.debug(&quot;测试Fabric 查询功能&quot;); Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId); channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, FabricUtils.orgHashMap.get(&quot;org1&quot;).getPeerLocation(CommonUtils.peer0Org1Name))); channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, FabricUtils.orgHashMap.get(&quot;org1&quot;).getOrdererLocation(CommonUtils.orderName))); channel.initialize(); FabricUtils.query(channel, record.getKey()); } } 以上就是全部的精简代码了。但是如果直接运行以上代码的话会有一些环境方面的问题，我这边遇到的就是tls问题.... 下面是我打开orderer的日志时发现的问题（表明不是一个合法的tls访问,个人推测）： 1.错误1 grpc: Server.Serve failed to complete security handshake from &quot;172.18.0.1:41678&quot;: tls: first record does not look like a TLS handshake 2. 伴随错误1出现在java日志里的是错误2： Caused by: io.netty.handler.codec.http2.Http2Exception: First received frame was not SETTINGS. Hex dump for first 5 bytes: 1503010002 暂时解决方案就是关闭tls..... 1. 在e2e/base内的两个文件里面分别关掉 docker-compose-base.yaml&nbsp; ---- &gt;&nbsp; ORDERER_GENERAL_TLS_ENABLED=false peer-base.yaml&nbsp; ---- &gt;&nbsp; CORE_PEER_TLS_ENABLED=false 2.在e2e/docker-compose-cli.yaml内的文件中关掉 CORE_PEER_TLS_ENABLED=false 然后重新部署环境。 需要额外注意的是，搭建步骤内的4.2&nbsp; / 5.2 等涉及到tls的参数设置 --tls true 去掉。 insert输出日志： DEBUG sdk.Channel - Creating channel: mychannel, client context Admin DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050 DEBUG sdk.Channel - Channel mychannel initialize shutdown false DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG sdk.Channel - getConfigurationBlock for channel mychannel ... DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200 DEBUG sdk.Channel - Last config index is 2 DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 4104f7b6af57f3a9176ed9e6ce5a506304ef9d35f92d675eb8d64335ce43236d, channelId: mychannel, epoch 0 ... .... DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data DEBUG sdk.Channel - Channel mychannel loadCACertificates DEBUG sdk.Channel - loading certificates for MSP : Org2MSP DEBUG sdk.Channel - loading certificates for MSP : Org1MSP DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP DEBUG sdk.Channel - Channel mychannel loadCACertificates completed DEBUG sdk.Channel - Eventque started null DEBUG sdk.Channel - 0 eventhubs initialized DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting DEBUG sdk.Channel - Channel mychannel blockListener 32a8ef34-46b6-4d3e-af61-903c2e1f27ba starting DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed DEBUG sdk.Channel - Channel mychannel initialized DEBUG transaction.ProposalBuilder - transientMap(&#39;result&#39;, &#39;:)&#39;)) DEBUG transaction.ProposalBuilder - transientMap(&#39;method&#39;, &#39;TransactionProposalRequest&#39;)) DEBUG transaction.ProposalBuilder - transientMap(&#39;HyperLedgerFabric&#39;, &#39;TransactionProposalRequest:JavaSDK&#39;)) DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9, channelId: mychannel, epoch 0 DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version: args(&quot;set&quot;, &quot;data&quot;, &quot;{name:&quot;testName&quot;,address:&quot;testAddress&quot;}&quot;) DEBUG transaction.ProtoUtils - SignatureHeader: nonce: af86713b93d098b8ec2ef7380a2bb584c8355c393ea0d2ab, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6 DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051 DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051 .. .. DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK DEBUG fabric.FabricUtils - payload!!!!!!!: DEBUG sdk.Channel - Channel mychannel sending transaction to orderer(s) with TxID 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 DEBUG sdk.Orderer - Order.sendTransaction name: orderer.example.com, url: grpc://localhost:7050 .... DEBUG sdk.Channel - Channel mychannel successful sent to Orderer transaction id: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 query输出日志： &nbsp; DEBUG helper.Config - Loading configuration from /home/dell/go/javaproject/FabricSdk/config.properties and it is present: false WARN helper.Config - Failed to load any configuration from: config.properties. Using toolkit defaults DEBUG sdk.HFClient - Setting user context to MSPID: Org1MSP user: Admin DEBUG fabric.TestFabricQuery - 测试Fabric 查询功能 DEBUG sdk.Channel - Creating channel: mychannel, client context Admin DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050 DEBUG sdk.Channel - Channel mychannel initialize shutdown false DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG sdk.Channel - getConfigurationBlock for channel mychannel DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 7341e25d471cbc614a1a996f896462286a20f9ba78fd72b619fdedfed674255f, channelId: mychannel, epoch 0 DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050 .... DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200 .. DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 21046ed568a93549a16224a977423351d5d7ef0ffe66455210929ab7acc6480f, channelId: mychannel, epoch 0 DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050 ... .. DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data DEBUG sdk.Channel - Channel mychannel loadCACertificates DEBUG sdk.Channel - loading certificates for MSP : Org2MSP DEBUG sdk.Channel - loading certificates for MSP : Org1MSP DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP DEBUG sdk.Channel - Channel mychannel loadCACertificates completed DEBUG sdk.Channel - Eventque started null DEBUG sdk.Channel - 0 eventhubs initialized DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting DEBUG sdk.Channel - Channel mychannel blockListener 3d8076a4-fca7-466a-904f-5c104c96ea1f starting DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed DEBUG sdk.Channel - Channel mychannel initialized DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: a08572d26702b2bdafe0ac53039e21faadb36e9a0640c9169dd66552af0a1994, channelId: mychannel, epoch 0 DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version: args(&quot;get&quot;, &quot;data&quot;) DEBUG transaction.ProtoUtils - SignatureHeader: nonce: ebc13657e548bdb8319e689baa9c263e6c8fa712835828b8, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6 DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051 DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051 .... .... DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK DEBUG fabric.FabricUtils - payload!!!!!!!: {name:&quot;testName&quot;,address:&quot;testAddress&quot;} 最后贴一下自己的chaincode001（其实就是以前测试的一个简单的chaincode） chaincode 阅读更多","@type":"BlogPosting","url":"/2018/08/17/18ca7c8096fdf1683816b6fcd46f0ecb.html","headline":"区块链学习之Fabric的Java应用层搭建","dateModified":"2018-08-17T00:00:00+08:00","datePublished":"2018-08-17T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/17/18ca7c8096fdf1683816b6fcd46f0ecb.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链学习之Fabric的Java应用层搭建</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>自从上篇Java-sdk跑通之后，今天已经是8/17号了，这期间干嘛了呢？一直在尝试搭建出一个Java应用层，好对外提供简单的接口以便将来能够实现一些自己的存储。</p> 
  <p>此篇博客记录时，CA容器没有单独起，而仅仅是在客户端读取已经生成好的CA文件来成功访问。下面说下一些步骤。</p> 
  <p>1. 搭建出一个Fabric环境。</p> 
  <p><a href="https://www.cnblogs.com/studyzy/p/7451276.html" rel="nofollow">搭建过程</a></p> 
  <p><span style="color:#f33b45;"><strong><em>1.1 这边需要注意1.3 用工具生成的私钥和证书，我们需要拷贝到工程中去。</em></strong></span></p> 
  <p>channel-artifacts 和 crypto-config（这一个是这一期主要的）</p> 
  <p>2. 整个工程目录如图，只是一个简单的java项目</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180817143945544?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMyOTI0MzQz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>3. pom文件如下：</p> 
  <pre class="has">
<code class="language-java">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.tc.fabric&lt;/groupId&gt;
    &lt;artifactId&gt;FabricSdk&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.14&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hyperledger.fabric-sdk-java&lt;/groupId&gt;
            &lt;artifactId&gt;fabric-sdk-java&lt;/artifactId&gt;
            &lt;version&gt;1.0.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;</code></pre> 
  <p>4. CommonUtils</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

public class CommonUtils {

    //peer节点的CA文件路径
    public static final String cryptoPeerPath = "crypto-config/peerOrganizations/";
    //order节点的CA文件路径
    public static final String cryptoOrderPath = "crypto-config/ordererOrganizations/";

    //peer节点的CA文件路径
    public static String peerFilePath = CommonUtils.class.getResource("/").getPath() + cryptoPeerPath;

    //order节点的CA文件路径
    public static String orderFilePath = CommonUtils.class.getResource("/").getPath() + cryptoOrderPath;

    //org1组织的目录
    public static final String org1Path = "org1.example.com/users/";

    //org1组织的cert文件目录
    public static final String org1CertFilePath = "@org1.example.com/msp/signcerts/";

    //org1组织的Key文件目录
    public static final String org1KeyFilePath = "@org1.example.com/msp/keystore/";

    //org2组织的目录
    public static final String org2Path = "org2.example.com/users/";

    //org2组织的cert文件目录
    public static final String org2CertFilePath = "@org2.example.com/msp/signcerts/";

    //org2组织的Key文件目录
    public static final String org2KeyFilePath = "@org2.example.com/msp/keystore/";

    //链码名称
    public static final String chainCodeName = "mycc";

    //链码版本
    public static final String chaincodeVersion = "1";

    //channel名称
    public static final String channelId = "mychannel";

    //order名称 和 Fabrci-java-sdk保持一致
    public static final String orderName = "orderer.example.com";

    //peer0org1名称  和 Fabrci-java-sdk保持一致
    public static final String peer0Org1Name = "peer0.org1.example.com";
    //peer1org1名称 和 Fabrci-java-sdk保持一致
    public static final String peer1Org1Name = "peer1.org1.example.com";

    //peer0org2名称 和 Fabrci-java-sdk保持一致
    public static final String peer0Org2Name = "peer0.org2.example.com";
    //peer1org2名称 和 Fabrci-java-sdk保持一致
    public static final String peer1Org2Name = "peer1.org2.example.com";

    //order地址
    public static final String orderLocation = "grpc://localhost:7050";
    //peer0org1地址
    public static final String peer0Org1Location = "grpc://localhost:7051";
    //peer1org1地址
    public static final String peer1Org1Location = "grpc://localhost:8051";
    //peer0org2地址
    public static final String peer0Org2Location = "grpc://localhost:9051";
    //peer1org2地址
    public static final String peer1Org2Location = "grpc://localhost:10051";

}</code></pre> 
  <p>5.FabricUtils</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

import org.apache.log4j.Logger;
import org.hyperledger.fabric.sdk.*;
import org.hyperledger.fabric.sdk.security.CryptoSuite;

import java.util.Collection;
import java.util.HashMap;
import java.util.Map;

import static java.nio.charset.StandardCharsets.UTF_8;

/**
 * FabricUtils,暂时不关注CA方面的东西
 */
public class FabricUtils {

    //日志记录
    private static Logger logger = Logger.getLogger(FabricUtils.class);

    //CA客户端
    public static HFClient client = null;

    public static CryptoSuite cs = null;

    public static HashMap&lt;String, SOrg&gt; orgHashMap=null;

    public static ChaincodeID cid = null;

    public static User peer0org1=null;

    public static void init()throws Exception{

        cs = CryptoSuite.Factory.getCryptoSuite();
        cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build();
        client = HFClient.createNewInstance();
        client.setCryptoSuite(cs);
        orgHashMap = OrgConfig.getSOrg();
        peer0org1 = orgHashMap.get("org1").getAdmin();
        client.setUserContext(peer0org1);

    }

    /*
     *   实现插入数据
     * */
    public static void instertFabcar(Channel channel, DataRecord data) throws Exception {
        TransactionProposalRequest req = client.newTransactionProposalRequest();
        req.setChaincodeID(cid);
        req.setFcn("set");
        req.setArgs(data.toStringArray());
        Map&lt;String, byte[]&gt; tm2 = new HashMap&lt;&gt;();
        //代码来自End2End
        tm2.put("HyperLedgerFabric", "TransactionProposalRequest:JavaSDK".getBytes(UTF_8));
        tm2.put("method", "TransactionProposalRequest".getBytes(UTF_8));
        tm2.put("result", ":)".getBytes(UTF_8));
        req.setTransientMap(tm2);
        Collection&lt;ProposalResponse&gt; resps = channel.sendTransactionProposal(req);
        for (ProposalResponse resp : resps) {
            String payload = new String(resp.getChaincodeActionResponsePayload());
            logger.debug("payload!!!!!!!: "+payload);
        }
        channel.sendTransaction(resps);
    }

    /*
     *   实现给定的Key查询数据
     * */
    public static void queryFabcar(Channel channel, String key) throws Exception {
        QueryByChaincodeRequest req = client.newQueryProposalRequest();
        ChaincodeID cid = ChaincodeID.newBuilder().setName(CommonUtils.chainCodeName).build();
        req.setChaincodeID(cid);
        req.setFcn("get");
        req.setArgs(new String[] { key });
        Collection&lt;ProposalResponse&gt; resps = channel.queryByChaincode(req);
        for (ProposalResponse resp : resps) {
            String payload = new String(resp.getChaincodeActionResponsePayload());
            logger.debug("payload!!!!!!!: "+payload);
        }
    }
}</code></pre> 
  <p>6. OrgConfig</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

import org.apache.commons.io.IOUtils;
import org.bouncycastle.asn1.pkcs.PrivateKeyInfo;
import org.bouncycastle.jce.provider.BouncyCastleProvider;
import org.bouncycastle.openssl.PEMParser;
import org.bouncycastle.openssl.jcajce.JcaPEMKeyConverter;
import org.hyperledger.fabric.sdk.Enrollment;

import java.io.*;
import java.security.NoSuchAlgorithmException;
import java.security.NoSuchProviderException;
import java.security.PrivateKey;
import java.security.spec.InvalidKeySpecException;
import java.util.HashMap;

/**
 * 模拟peer,order,admin,user等一些配置项
 */
public class OrgConfig {

    /**
     * 获取Org组织信息,
     * 代码精简自End2End
     * @return
     */
    public static HashMap&lt;String,SOrg&gt; getSOrg() throws Exception{

        HashMap&lt;String,SOrg&gt; orgMap = new HashMap&lt;&gt;();

        SOrg org1=new SOrg("Org1","Org1MSP");
        org1.addPeerLocation(CommonUtils.peer0Org1Name,CommonUtils.peer0Org1Location);
        org1.addPeerLocation(CommonUtils.peer1Org1Name,CommonUtils.peer1Org1Location);
        org1.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation);

        SUser adminOrg1 = new SUser("Admin","Org1MSP");
        SUser user1Org1 = new SUser("User1","Org1MSP");

        adminOrg1.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg1.getName(),adminOrg1.getMspId())
                ,getCertificateFile(adminOrg1.getName(),adminOrg1.getMspId())));

        user1Org1.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org1.getName(),user1Org1.getMspId())
                ,getCertificateFile(user1Org1.getName(),user1Org1.getMspId())));

        org1.addUser(adminOrg1);
        org1.addUser(user1Org1);
        org1.setAdmin(adminOrg1);

        SOrg org2=new SOrg("Org2","Org2MSP");
        org2.addPeerLocation(CommonUtils.peer0Org2Name,CommonUtils.peer0Org2Location);
        org2.addPeerLocation(CommonUtils.peer1Org2Name,CommonUtils.peer1Org2Location);
        org2.addOrdererLocation(CommonUtils.orderName,CommonUtils.orderLocation);
        SUser adminOrg2 = new SUser("Admin","Org2MSP");
        SUser user1Org2 = new SUser("User1","Org2MSP");

        adminOrg2.setEnrollment(new SampleStoreEnrollement(getKeyFile(adminOrg2.getName(),adminOrg2.getMspId())
                ,getCertificateFile(adminOrg2.getName(),adminOrg2.getMspId())));

        user1Org2.setEnrollment(new SampleStoreEnrollement(getKeyFile(user1Org2.getName(),user1Org2.getMspId())
                ,getCertificateFile(user1Org2.getName(),user1Org2.getMspId())));

        org2.addUser(adminOrg2);
        org2.addUser(user1Org2);
        org2.setAdmin(adminOrg2);

        orgMap.put("org1",org1);
        orgMap.put("org2",org2);
        return orgMap;

    }

    /**
     * 获取对应用户的私钥Key
     * @param userName
     * @param mspId
     * @return
     */
    public static PrivateKey getKeyFile(String userName,String mspId) throws Exception{

        String tempPath = null;

        String fileName = null;

        String keyFile = null;

        if("Org1MSP".equals(mspId)){
            tempPath = CommonUtils.peerFilePath +CommonUtils.org1Path + userName + CommonUtils.org1KeyFilePath;

            fileName = new File(tempPath).listFiles()[0].getName();

            keyFile = tempPath + fileName;
        }else {
            tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2KeyFilePath;

            fileName = new File(tempPath).listFiles()[0].getName();

            keyFile = tempPath + fileName;
        }
        //来源于ChannelTest
        return getPrivateKeyFromBytes(IOUtils.toByteArray(new FileInputStream(keyFile)));

    }

    /**
     * 获取对应用户的ceritificate证书
     * @param userName
     * @param mspId
     * @return
     * @throws Exception
     */
    public static String getCertificateFile(String userName,String mspId) throws Exception{

        String tempPath = null;

        String fileName = null;

        String certFile = null;

        if("Org1MSP".equals(mspId)){
            tempPath = CommonUtils.peerFilePath + CommonUtils.org1Path + userName + CommonUtils.org1CertFilePath;

            fileName = new File(tempPath).listFiles()[0].getName();

            certFile = tempPath + fileName;
        }else {
            tempPath = CommonUtils.peerFilePath + CommonUtils.org2Path + userName + CommonUtils.org2CertFilePath;

            fileName = new File(tempPath).listFiles()[0].getName();

            certFile = tempPath + fileName;
        }
        //来源于ChannelTest
        return new String(IOUtils.toByteArray(new FileInputStream(certFile)), "UTF-8");

    }



    public static PrivateKey getPrivateKeyFromBytes(byte[] data) throws NoSuchProviderException, NoSuchAlgorithmException, InvalidKeySpecException, IOException {
        final Reader pemReader = new StringReader(new String(data));

        final PrivateKeyInfo pemPair;
        try (PEMParser pemParser = new PEMParser(pemReader)) {
            pemPair = (PrivateKeyInfo) pemParser.readObject();
        }

        PrivateKey privateKey = new JcaPEMKeyConverter().setProvider(BouncyCastleProvider.PROVIDER_NAME).getPrivateKey(pemPair);

        return privateKey;
    }


    static final class SampleStoreEnrollement implements Enrollment, Serializable {

        private final PrivateKey privateKey;
        private final String certificate;

        SampleStoreEnrollement(PrivateKey privateKey, String certificate)  {
            this.certificate = certificate;
            this.privateKey =  privateKey;
        }

        @Override
        public PrivateKey getKey() {

            return privateKey;
        }

        @Override
        public String getCert() {
            return certificate;
        }

    }

}</code></pre> 
  <p>7. SOrg</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

import org.hyperledger.fabric.sdk.Peer;
import org.hyperledger.fabric.sdk.User;
import org.hyperledger.fabric_ca.sdk.HFCAClient;

import java.util.*;

/**
 * Java-SDK直接复制得来
 */
public class SOrg {

    private String name;
    private String mspid;
    private HFCAClient caClient;  //暂时未使用
    private Map&lt;String, User&gt; userMap = new HashMap&lt;String, User&gt;();
    private Map&lt;String, String&gt; peerLocations = new HashMap&lt;String, String&gt;();
    private Map&lt;String, String&gt; ordererLocations = new HashMap&lt;String, String&gt;();
    private Map&lt;String, String&gt; eventHubLocations = new HashMap&lt;String, String&gt;(); //暂时未使用
    private Set&lt;Peer&gt; peers = new HashSet&lt;Peer&gt;(); //暂时未使用
    private SUser admin;
    private String caLocation; //暂时未使用
    private Properties caProperties = null; //暂时未使用
    private SUser peerAdmin; //暂时未使用
    private String domainName; //暂时未使用

    public SOrg(String name, String mspid) {
        this.name = name;
        this.mspid = mspid;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setMspid(String mspid) {
        this.mspid = mspid;
    }

    public void setCaClient(HFCAClient caClient) {
        this.caClient = caClient;
    }

    public void setUserMap(Map&lt;String, User&gt; userMap) {
        this.userMap = userMap;
    }

    public void setPeerLocations(Map&lt;String, String&gt; peerLocations) {
        this.peerLocations = peerLocations;
    }

    public void setOrdererLocations(Map&lt;String, String&gt; ordererLocations) {
        this.ordererLocations = ordererLocations;
    }

    public void setEventHubLocations(Map&lt;String, String&gt; eventHubLocations) {
        this.eventHubLocations = eventHubLocations;
    }

    public void setPeers(Set&lt;Peer&gt; peers) {
        this.peers = peers;
    }

    public void setAdmin(SUser admin) {
        this.admin = admin;
    }

    public void setCaLocation(String caLocation) {
        this.caLocation = caLocation;
    }

    public void setCaProperties(Properties caProperties) {
        this.caProperties = caProperties;
    }

    public void setPeerAdmin(SUser peerAdmin) {
        this.peerAdmin = peerAdmin;
    }

    public void setDomainName(String domainName) {
        this.domainName = domainName;
    }

    public String getName() {
        return name;
    }

    public String getMspid() {
        return mspid;
    }

    public HFCAClient getCaClient() {
        return caClient;
    }

    public Map&lt;String, User&gt; getUserMap() {
        return userMap;
    }

    public Map&lt;String, String&gt; getPeerLocations() {
        return peerLocations;
    }

    public Map&lt;String, String&gt; getOrdererLocations() {
        return ordererLocations;
    }

    public Map&lt;String, String&gt; getEventHubLocations() {
        return eventHubLocations;
    }

    public Set&lt;Peer&gt; getPeers() {
        return peers;
    }

    public SUser getAdmin() {
        return admin;
    }

    public String getCaLocation() {
        return caLocation;
    }

    public Properties getCaProperties() {
        return caProperties;
    }

    public SUser getPeerAdmin() {
        return peerAdmin;
    }

    public String getDomainName() {
        return domainName;
    }

    public void addPeerLocation(String name, String location) {

        peerLocations.put(name, location);
    }

    public void addOrdererLocation(String name, String location) {

        ordererLocations.put(name, location);
    }

    public void addEventHubLocation(String name, String location) {

        eventHubLocations.put(name, location);
    }

    public String getPeerLocation(String name) {
        return peerLocations.get(name);

    }

    public String getOrdererLocation(String name) {
        return ordererLocations.get(name);

    }

    public String getEventHubLocation(String name) {
        return eventHubLocations.get(name);

    }

    public void addUser(SUser user) {
        userMap.put(user.getName(), user);
    }

}</code></pre> 
  <p>8.SUser</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

import org.hyperledger.fabric.sdk.Enrollment;
import org.hyperledger.fabric.sdk.User;
import java.util.HashSet;
import java.util.Set;

/**
 * SUser的构造用crypton工具生成的证书本地读取来生成
 */
public class SUser implements User {

    private String userName;

    private String mspid;

    private Enrollment enrollment;

    public SUser(String userName, String mspid) {
        this.userName = userName;
        this.mspid = mspid;
    }

    public String getName() {
        return userName;
    }

    public Set&lt;String&gt; getRoles() {
        return new HashSet&lt;String&gt;();
    }

    public String getAccount() {
        return "";
    }

    public String getAffiliation() {
        return "";
    }

    public Enrollment getEnrollment() {
        return this.enrollment;
    }

    public String getMspId() {
        return this.mspid;
    }

    public void setEnrollment(Enrollment enrollment) {
        this.enrollment = enrollment;
    }
}</code></pre> 
  <p>9. DataRecord</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

public class DataRecord {

    private String key;

    private String value;

    public DataRecord(String key, String value) {
        this.key = key;
        this.value = value;
    }

    public String getKey() {
        return key;
    }

    public String getValue() {
        return value;
    }

    public void setKey(String key) {
        this.key = key;
    }

    public void setValue(String value) {
        this.value = value;
    }

    public String[] toStringArray() {
        return new String[] {this.getKey(),this.getValue()};
    }

    @Override
    public String toString() {
        return "Data: key = "+key+"  value = " +value;
    }
}</code></pre> 
  <p>10 .Insert</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

import org.apache.log4j.Logger;
import org.hyperledger.fabric.sdk.Channel;

public class TestFabricInsert {

    private static Logger logger=Logger.getLogger(TestFabricInsert.class);

    public static void main(String[] args) throws Exception{

        FabricUtils.init();

        DataRecord dataRecord = new DataRecord("data","{name:\"testName\",address:\"testAddress\"}");

        testInsert(dataRecord);

    }

    public static void testInsert(DataRecord record) throws Exception {
        System.out.println("test insert");
        Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId);
        channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, CommonUtils.peer0Org1Location));
        channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, CommonUtils.orderLocation));
        channel.initialize();
        FabricUtils.instert(channel,record);
    }

}</code></pre> 
  <p>11 .query</p> 
  <pre class="has">
<code class="language-java">package com.t.fabric;

import org.apache.log4j.Logger;
import org.hyperledger.fabric.sdk.Channel;

public class TestFabricQuery {

    private static Logger logger=Logger.getLogger(TestFabricQuery.class);

    public static void main(String[] args) throws Exception{
        DataRecord dataRecord = new DataRecord("data","");

        FabricUtils.init();

        testQuery(dataRecord);

    }

    public static void testQuery(DataRecord record) throws Exception {
        logger.debug("测试Fabric 查询功能");
        Channel channel = FabricUtils.client.newChannel(CommonUtils.channelId);
        channel.addPeer(FabricUtils.client.newPeer(CommonUtils.peer0Org1Name, FabricUtils.orgHashMap.get("org1").getPeerLocation(CommonUtils.peer0Org1Name)));
        channel.addOrderer(FabricUtils.client.newOrderer(CommonUtils.orderName, FabricUtils.orgHashMap.get("org1").getOrdererLocation(CommonUtils.orderName)));
        channel.initialize();
        FabricUtils.query(channel, record.getKey());
    }
}</code></pre> 
  <p><span style="color:#f33b45;"><em><strong>以上就是全部的精简代码了。但是如果直接运行以上代码的话会有一些环境方面的问题，我这边遇到的就是tls问题....</strong></em></span></p> 
  <p><span style="color:#f33b45;"><em><strong>下面是我打开orderer的日志时发现的问题（表明不是一个合法的tls访问,个人推测）：</strong></em></span></p> 
  <p>1.错误1</p> 
  <pre class="has">
<code class="language-java">grpc: Server.Serve failed to complete security handshake from "172.18.0.1:41678": tls: first record does not look like a TLS handshake</code></pre> 
  <p>2. 伴随错误1出现在java日志里的是错误2：</p> 
  <pre class="has">
<code class="language-java">Caused by: io.netty.handler.codec.http2.Http2Exception: First received frame was not SETTINGS. Hex dump for first 5 bytes: 1503010002</code></pre> 
  <p><span style="color:#86ca5e;"><em><strong>暂时解决方案就是关闭tls.....</strong></em></span></p> 
  <p><span style="color:#86ca5e;"><em><strong>1. 在e2e/base内的两个文件里面分别关掉 </strong></em></span></p> 
  <p><span style="color:#86ca5e;"><em><strong>docker-compose-base.yaml&nbsp; ---- &gt;&nbsp; ORDERER_GENERAL_TLS_ENABLED=false</strong></em></span></p> 
  <p><span style="color:#86ca5e;"><em><strong>peer-base.yaml&nbsp; ---- &gt;&nbsp; CORE_PEER_TLS_ENABLED=false</strong></em></span></p> 
  <p><span style="color:#86ca5e;"><em><strong>2.在e2e/docker-compose-cli.yaml内的文件中关掉 CORE_PEER_TLS_ENABLED=false</strong></em></span></p> 
  <p><span style="color:#86ca5e;"><em><strong>然后重新部署环境。</strong></em></span></p> 
  <p><span style="color:#ffbb66;"><strong>需要额外注意的是，搭建步骤内的4.2&nbsp; / 5.2 等涉及到tls的参数设置 --tls true 去掉。</strong></span></p> 
  <p>insert输出日志：</p> 
  <pre class="has">
<code class="language-java">DEBUG sdk.Channel - Creating channel: mychannel, client context Admin
DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050
DEBUG sdk.Channel - Channel mychannel initialize shutdown false
DEBUG sdk.Channel - getConfigurationBlock for channel mychannel
DEBUG sdk.Channel - getConfigurationBlock for channel mychannel
...
DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK
DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS
DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200
DEBUG sdk.Channel - Last config index is 2
DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 4104f7b6af57f3a9176ed9e6ce5a506304ef9d35f92d675eb8d64335ce43236d, channelId: mychannel, epoch 0
...
....
DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned
DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data
DEBUG sdk.Channel - Channel mychannel loadCACertificates
DEBUG sdk.Channel - loading certificates for MSP : Org2MSP
DEBUG sdk.Channel - loading certificates for MSP : Org1MSP
DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP
DEBUG sdk.Channel - Channel mychannel loadCACertificates completed 
DEBUG sdk.Channel - Eventque started null
DEBUG sdk.Channel - 0 eventhubs initialized
DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting
DEBUG sdk.Channel - Channel mychannel blockListener 32a8ef34-46b6-4d3e-af61-903c2e1f27ba starting
DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed
DEBUG sdk.Channel - Channel mychannel initialized
DEBUG transaction.ProposalBuilder - transientMap('result', ':)'))
DEBUG transaction.ProposalBuilder - transientMap('method', 'TransactionProposalRequest'))
DEBUG transaction.ProposalBuilder - transientMap('HyperLedgerFabric', 'TransactionProposalRequest:JavaSDK'))
DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9, channelId: mychannel, epoch 0
DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version:  args("set", "data", "{name:"testName",address:"testAddress"}")
DEBUG transaction.ProtoUtils - SignatureHeader: nonce: af86713b93d098b8ec2ef7380a2bb584c8355c393ea0d2ab, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6
DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051
DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051
..
..
DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK
DEBUG fabric.FabricUtils - payload!!!!!!!: 
DEBUG sdk.Channel - Channel mychannel sending transaction to orderer(s) with TxID 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9 
DEBUG sdk.Orderer - Order.sendTransaction name: orderer.example.com, url: grpc://localhost:7050
....
DEBUG sdk.Channel - Channel mychannel successful sent to Orderer transaction id: 7f0dc2e2ef4beca32e50d8115fd154e1347c4e8e85ccc6ea2138013e53d731f9</code></pre> 
  <p>query输出日志：<br> &nbsp;</p> 
  <pre class="has">
<code class="language-java">DEBUG helper.Config - Loading configuration from /home/dell/go/javaproject/FabricSdk/config.properties and it is present: false
 WARN helper.Config - Failed to load any configuration from: config.properties. Using toolkit defaults
DEBUG sdk.HFClient - Setting user context to MSPID: Org1MSP user: Admin
DEBUG fabric.TestFabricQuery - 测试Fabric 查询功能
DEBUG sdk.Channel - Creating channel: mychannel, client context Admin
DEBUG sdk.Channel - Channel mychannel adding ordererorderer.example.com, url: grpc://localhost:7050
DEBUG sdk.Channel - Channel mychannel initialize shutdown false
DEBUG sdk.Channel - getConfigurationBlock for channel mychannel
DEBUG sdk.Channel - getConfigurationBlock for channel mychannel
DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 7341e25d471cbc614a1a996f896462286a20f9ba78fd72b619fdedfed674255f, channelId: mychannel, epoch 0
DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050
....
DEBUG sdk.OrdererClient - resp status value: 0, resp: UNKNOWN, type case: BLOCK
DEBUG sdk.OrdererClient - resp status value: 200, resp: SUCCESS, type case: STATUS
DEBUG sdk.Channel - Channel mychannel getLatestBlock returned status 200

..
DEBUG transaction.ProtoUtils - ChannelHeader: type: DELIVER_SEEK_INFO, version: 1, Txid: 21046ed568a93549a16224a977423351d5d7ef0ffe66455210929ab7acc6480f, channelId: mychannel, epoch 0
DEBUG sdk.Orderer - Order.sendDeliver name: orderer.example.com, url: grpc://localhost:7050
...
..
DEBUG sdk.Channel - Channel mychannel getConfigurationBlock returned
DEBUG sdk.Channel - Channel mychannel Got config block getting MSP data and anchorPeers data
DEBUG sdk.Channel - Channel mychannel loadCACertificates
DEBUG sdk.Channel - loading certificates for MSP : Org2MSP
DEBUG sdk.Channel - loading certificates for MSP : Org1MSP
DEBUG sdk.Channel - loading certificates for MSP : OrdererMSP
DEBUG sdk.Channel - Channel mychannel loadCACertificates completed 
DEBUG sdk.Channel - Eventque started null
DEBUG sdk.Channel - 0 eventhubs initialized
DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor starting
DEBUG sdk.Channel - Channel mychannel blockListener 3d8076a4-fca7-466a-904f-5c104c96ea1f starting
DEBUG sdk.Channel - Channel mychannel registerTransactionListenerProcessor completed
DEBUG sdk.Channel - Channel mychannel initialized
DEBUG transaction.ProtoUtils - ChannelHeader: type: ENDORSER_TRANSACTION, version: 1, Txid: a08572d26702b2bdafe0ac53039e21faadb36e9a0640c9169dd66552af0a1994, channelId: mychannel, epoch 0
DEBUG transaction.ProposalBuilder - ChaincodeInvocationSpec type: GOLANG, chaincode name: mycc, chaincode path: , chaincode version:  args("get", "data")
DEBUG transaction.ProtoUtils - SignatureHeader: nonce: ebc13657e548bdb8319e689baa9c263e6c8fa712835828b8, User:Admin, MSPID: Org1MSP, idBytes: 427d0ae5efdfff9a663a66df1643f9c21130fc4b3b0f668e6d5e8df4cf43a2d6
DEBUG sdk.Channel - Channel mychannel send proposal to peer peer0.org1.example.com at url grpc://localhost:7051
DEBUG sdk.Peer - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051

....

....

DEBUG sdk.Channel - Channel mychannel got back from peer peer0.org1.example.com status: 200, message: OK
DEBUG fabric.FabricUtils - payload!!!!!!!: {name:"testName",address:"testAddress"}</code></pre> 
  <p>最后贴一下自己的chaincode001（其实就是以前测试的一个简单的chaincode）</p> 
  <p><a href="https://blog.csdn.net/qq_32924343/article/details/81287985" rel="nofollow">chaincode</a></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_32924343/article/details/81777067,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_32924343/article/details/81777067,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>基础向：「财务对账」的秘密都在这篇 3000 字的文章里 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="基础向：「财务对账」的秘密都在这篇 3000 字的文章里" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="概念及目的 首先抛出3个问题： 为什么需要对账？ 支付机构是如何进行账务对账的？ 互联网平台应该如何进行对账模块的设计？ 对账是会计学的一个名字，会计学对对账的定义是：为了保证账簿记录的真实性、完整性、准确性，在记账以后结账之前，定期或不定期地对有关数据进行检查、核对。 账簿记录是对公司企业日常经济活动的记录，类似于我们日常生活中使用记账 APP 来记录日常开销，记账 APP 里的每一条记录都是账簿记录。 这里重点是对账簿记录进行核对，包含三个方面的核对工作，即账证核对、账账核对、账实核对。 （1）账证核对，是将账簿记录与记账凭证进行核对，这里是记账凭证是指日常经济活动的书面证明。如果还是用记账 APP 来类别的话，我们超市购物的小票、购买商品的发票、银行卡的收款转账记录，都是记账凭证。 （2）账账核对，是把有相互关系的多个账簿记录进行核对。有相互关系的账簿记录，包括总分类账簿间核对，明细账簿间核对等多种类型。例如：我们使用记账 APP 时，整个家庭的日常开销和购物、教育、交通等分类开销的核对，是总分类账簿间核对；核对银行卡取现记录和日常现金支出记录，是明细账簿间核对。 （3）账实核对，是各项资产物资的记录数值与实际真实数额间的核对。例如：我们使用记账 APP 记录购买了一台手机，我发现自己手里确实有一台手机，这就是账实核对。 业务场景中的对账 以上内容说明的是会计上是如何定义对账的，下面让我们看一下具体的业务场景中，是如何定义对账的。 1. 对账的职能 Ping++ 服务的客户都是开展电子商务业务的互联网公司或项目，我们习惯称之为电商平台。电商平台的对账，主要需要完成如下三个任务： 核对平台自身系统交易数据与支付渠道的对账单数据，并将交易金额和支付渠道结算资金进行核对。 保证电商平台各系统间交易状态、交易资金的一致性，支付订单和业务订单状态要一致，收款金额和订单金额一致，总收款金额和商品金额、运费金额要一致。 要包含对账和后续的差错处理流程。 2. 对账的内容 对照会计定义中，对账包含的三个方面核对工作。 对于电商平台来说，记账凭证就是电商平台自身的交易订单，支付渠道提供对账单。 账账核对，最重要的是将系统交易数据和渠道的对账单数据进行核对。同时也包括自营商品交易、入驻第三方交易数据的核对，有余额钱包的平台，需要进行余额数据和交易数据的核对。 电商平台需要向入驻第三方进行付款时，要进行结算数据与交易数据的核对。账实核对，是将交易数据与支付渠道收款金额、已发货商品数量进行核对，结算数据和付款进行进行核对。 对账模块是大家搭建电商平台、进行业务系统、支付系统规则设计时，容易忽视的环节。往往在平台业务上线后，交易量出现爆发增长，人工无法处理每天出现的差错交易时，才会考虑设计、开发对账模块。 将对账模块的价值比作一个冰山的话，业务运行正常情况下显示的价值，就是冰山海面上的部分；当电商平台发生差错交易时，平静被打破，才会显现出对账的真正价值。 3. 对账的价值 平台发生差错交易时，对账模块的价值主要体现在： 通过系统自动进行交易数据的核对，解放了财务、运营人员的工作时间，让他们可以专注于可以公司创造更多价值的工作上； 自动完成大量交易数据的核对工作，订单数据量很大的情况，单靠人工无法完成交易数据核对并定位差错； 可以在第一时间发现差错交易，并及时进行处理。不用等到客户投诉来了，再定位问题进行处理，提高了用户体验。 电商平台的对账包含差错处理模块，运营人员人工完成差错处理后，将交易数据同步更新到支付系统；同时还包括电商平台日常业务流程中，和支付系统相关的业务订单系统、发货仓储系统、财务管理软件等周边系统，保证整个平台数据的一致性。 对账的设计 如何进行对账模块的设计，我想先说明下支付机构是如何进行账务对账的。众所周知，支付机构每天需要处理大量的交易订单和资金，支付机构的账务对账对我们进行电商平台对账模块的设计，有很好的指导价值。 支付机构在进行交易处理时，主要涉及三个系统模块，分别是联机、清分和结算。 （1）联机系统负责处理商户的交易，并将交易发送到后端扣款渠道完成交易。支付、代扣、代付、预授权等多种类型的交易，都通过联机系统进行处理。联机系统完成交易处理后，记录的交易信息有：交易时间、交易商户、交易金额、交易类型、扣款渠道等信息。 （2）清分系统主要负责各类账务金额的计算，根据交易类型计算交易商户手续费，根据扣款渠道计算交易成本，手续费减去成本等到支付机构的手机数据。清分系统还负责对账工作，将联机交易信息和资金来源方流水文件进行核对。 资金来源方就是扣款渠道，两方的数据核对完成后，对于有差异的流水，生成差错交易。差错交易会交由运营人员，进行差错交易处理。 对账后，正确无误的交易会生成结算流水文件。如果某一个扣款渠道的流水文件存在差错交易，则这个扣款渠道所有交易都不会生成结算流水文件。等待运营人员完成差错处理后，清分系统再对该扣款渠道的所有交易生成结算流水文件。 （3）结算系统根据清分生成的结算流水文件，生成支付机构对外付款的商户结算数据、等待收款的资金来款方数据，以及支付机构的收益数据。 支付机构负责进行交易资金处理的工作人员，在所有扣款渠道的资金全部入账后，对交易商户所有扣款渠道的交易资金通过一笔资金，完成交易资金的结算。结算系统根据结算流水文件，为交易商户生成对账单，供交易商户后续核对交易订单使用。清分系统对账后，会生成差错交易等待运营人员处理。 典型差错类别及处理方法 下面会介绍几种典型的差错类型及其处理方式。 第一种差错类型是长款，简单来说就是支付机构收的钱多了。 这种类型的差错交易表现为，资金来款方流水文件有记录，而支付机构联机交易状态为未支付、超时等情况。这种情况下，交易商户未收到交易成功信息，支付机构需要交易资金通过来款渠道返还用户。 第二种差错类型是短款，也就是支付机构收的钱少了。 这种类型的差错交易表现为，资金来款方流水文件无记录，而支付机构联机交易状态已成功支付。除了支付机构自身系统故障，错误记录了交易状态之外，发生短款差错的常见原因是，该笔交易资金在通过人民银行系统进行资金划转时，未能及时划转到来款渠道，导致来款渠道无法将交易资金结算到支付机构。 这种情况下，支付机构需要向来款渠道发起请款操作，同时将交易商户的其他无差错交易资金进行优先结算。 第三种差错类型双方的交易数据记录不一致，例如交易金额不一致、支付机构记录的成本金额和来款渠道实际成本金额不一致等。 发生数据记录不一致的情况，比较罕见，处理差错时，需要业务人员和开发人员配合，根据实际情况进行针对性的处理。 对账模块设计思路 对于支付机构账务对账流程，有了一个宏观的认知后，下面会借鉴支付机构的对账流程，介绍下互联网电商平台的对账模块设计思路。 支付系统是电商平台对接各个支付渠道，完成交易订单处理的核心系统。电商平台进行对账模块设计时，首先要进行的就是支付系统对账。 支付系统对账，是将本系统产生的交易资金和支付渠道的结算金额进行核对。包含对账单下载、数据准备、对账、差错处理四个环节。 （1）账单下载支付系统要对接支付宝、微信、银联等多个渠道，在进行对账单下载时候，就需要针对不同的支付渠道的特点，进行针对性的处理，主要注意这三个方面的不同，分别是：下载方式不同、下载时间不同以及文件格式不同。 完成了对账单下载，就需要对渠道对账单数据和本地交易数据，整理成可供对账处理的数据。 （2）数据准备 数据准备后，要注意和渠道对账单原始数据、本地交易订单原始数据进行核对，保证数据的准确性。 （3）对账单笔账单需要对商户订单号、渠道流水号、交易时间、交易金额等字段进行比对，所有订单进行逐笔比对。 （4）差错账处理失败订单：支付系统中状态为“失败”的，渠道状态为“成功”的订单。 首次对账，对账模块本地交易数据无此订单； 按渠道数据中的商户订单号、渠道流水号、交易时间，在支付系统查找该笔订单，导入对账模块进行数据准备后，进行二次对账。 跨天订单：本地交易数据和渠道对账单记录的交易时间不在同一天。 交易时间中日期一致的不记录为差错； 日期不在同一天，按本地交易日期计入当天差错交易。 阅读更多" />
<meta property="og:description" content="概念及目的 首先抛出3个问题： 为什么需要对账？ 支付机构是如何进行账务对账的？ 互联网平台应该如何进行对账模块的设计？ 对账是会计学的一个名字，会计学对对账的定义是：为了保证账簿记录的真实性、完整性、准确性，在记账以后结账之前，定期或不定期地对有关数据进行检查、核对。 账簿记录是对公司企业日常经济活动的记录，类似于我们日常生活中使用记账 APP 来记录日常开销，记账 APP 里的每一条记录都是账簿记录。 这里重点是对账簿记录进行核对，包含三个方面的核对工作，即账证核对、账账核对、账实核对。 （1）账证核对，是将账簿记录与记账凭证进行核对，这里是记账凭证是指日常经济活动的书面证明。如果还是用记账 APP 来类别的话，我们超市购物的小票、购买商品的发票、银行卡的收款转账记录，都是记账凭证。 （2）账账核对，是把有相互关系的多个账簿记录进行核对。有相互关系的账簿记录，包括总分类账簿间核对，明细账簿间核对等多种类型。例如：我们使用记账 APP 时，整个家庭的日常开销和购物、教育、交通等分类开销的核对，是总分类账簿间核对；核对银行卡取现记录和日常现金支出记录，是明细账簿间核对。 （3）账实核对，是各项资产物资的记录数值与实际真实数额间的核对。例如：我们使用记账 APP 记录购买了一台手机，我发现自己手里确实有一台手机，这就是账实核对。 业务场景中的对账 以上内容说明的是会计上是如何定义对账的，下面让我们看一下具体的业务场景中，是如何定义对账的。 1. 对账的职能 Ping++ 服务的客户都是开展电子商务业务的互联网公司或项目，我们习惯称之为电商平台。电商平台的对账，主要需要完成如下三个任务： 核对平台自身系统交易数据与支付渠道的对账单数据，并将交易金额和支付渠道结算资金进行核对。 保证电商平台各系统间交易状态、交易资金的一致性，支付订单和业务订单状态要一致，收款金额和订单金额一致，总收款金额和商品金额、运费金额要一致。 要包含对账和后续的差错处理流程。 2. 对账的内容 对照会计定义中，对账包含的三个方面核对工作。 对于电商平台来说，记账凭证就是电商平台自身的交易订单，支付渠道提供对账单。 账账核对，最重要的是将系统交易数据和渠道的对账单数据进行核对。同时也包括自营商品交易、入驻第三方交易数据的核对，有余额钱包的平台，需要进行余额数据和交易数据的核对。 电商平台需要向入驻第三方进行付款时，要进行结算数据与交易数据的核对。账实核对，是将交易数据与支付渠道收款金额、已发货商品数量进行核对，结算数据和付款进行进行核对。 对账模块是大家搭建电商平台、进行业务系统、支付系统规则设计时，容易忽视的环节。往往在平台业务上线后，交易量出现爆发增长，人工无法处理每天出现的差错交易时，才会考虑设计、开发对账模块。 将对账模块的价值比作一个冰山的话，业务运行正常情况下显示的价值，就是冰山海面上的部分；当电商平台发生差错交易时，平静被打破，才会显现出对账的真正价值。 3. 对账的价值 平台发生差错交易时，对账模块的价值主要体现在： 通过系统自动进行交易数据的核对，解放了财务、运营人员的工作时间，让他们可以专注于可以公司创造更多价值的工作上； 自动完成大量交易数据的核对工作，订单数据量很大的情况，单靠人工无法完成交易数据核对并定位差错； 可以在第一时间发现差错交易，并及时进行处理。不用等到客户投诉来了，再定位问题进行处理，提高了用户体验。 电商平台的对账包含差错处理模块，运营人员人工完成差错处理后，将交易数据同步更新到支付系统；同时还包括电商平台日常业务流程中，和支付系统相关的业务订单系统、发货仓储系统、财务管理软件等周边系统，保证整个平台数据的一致性。 对账的设计 如何进行对账模块的设计，我想先说明下支付机构是如何进行账务对账的。众所周知，支付机构每天需要处理大量的交易订单和资金，支付机构的账务对账对我们进行电商平台对账模块的设计，有很好的指导价值。 支付机构在进行交易处理时，主要涉及三个系统模块，分别是联机、清分和结算。 （1）联机系统负责处理商户的交易，并将交易发送到后端扣款渠道完成交易。支付、代扣、代付、预授权等多种类型的交易，都通过联机系统进行处理。联机系统完成交易处理后，记录的交易信息有：交易时间、交易商户、交易金额、交易类型、扣款渠道等信息。 （2）清分系统主要负责各类账务金额的计算，根据交易类型计算交易商户手续费，根据扣款渠道计算交易成本，手续费减去成本等到支付机构的手机数据。清分系统还负责对账工作，将联机交易信息和资金来源方流水文件进行核对。 资金来源方就是扣款渠道，两方的数据核对完成后，对于有差异的流水，生成差错交易。差错交易会交由运营人员，进行差错交易处理。 对账后，正确无误的交易会生成结算流水文件。如果某一个扣款渠道的流水文件存在差错交易，则这个扣款渠道所有交易都不会生成结算流水文件。等待运营人员完成差错处理后，清分系统再对该扣款渠道的所有交易生成结算流水文件。 （3）结算系统根据清分生成的结算流水文件，生成支付机构对外付款的商户结算数据、等待收款的资金来款方数据，以及支付机构的收益数据。 支付机构负责进行交易资金处理的工作人员，在所有扣款渠道的资金全部入账后，对交易商户所有扣款渠道的交易资金通过一笔资金，完成交易资金的结算。结算系统根据结算流水文件，为交易商户生成对账单，供交易商户后续核对交易订单使用。清分系统对账后，会生成差错交易等待运营人员处理。 典型差错类别及处理方法 下面会介绍几种典型的差错类型及其处理方式。 第一种差错类型是长款，简单来说就是支付机构收的钱多了。 这种类型的差错交易表现为，资金来款方流水文件有记录，而支付机构联机交易状态为未支付、超时等情况。这种情况下，交易商户未收到交易成功信息，支付机构需要交易资金通过来款渠道返还用户。 第二种差错类型是短款，也就是支付机构收的钱少了。 这种类型的差错交易表现为，资金来款方流水文件无记录，而支付机构联机交易状态已成功支付。除了支付机构自身系统故障，错误记录了交易状态之外，发生短款差错的常见原因是，该笔交易资金在通过人民银行系统进行资金划转时，未能及时划转到来款渠道，导致来款渠道无法将交易资金结算到支付机构。 这种情况下，支付机构需要向来款渠道发起请款操作，同时将交易商户的其他无差错交易资金进行优先结算。 第三种差错类型双方的交易数据记录不一致，例如交易金额不一致、支付机构记录的成本金额和来款渠道实际成本金额不一致等。 发生数据记录不一致的情况，比较罕见，处理差错时，需要业务人员和开发人员配合，根据实际情况进行针对性的处理。 对账模块设计思路 对于支付机构账务对账流程，有了一个宏观的认知后，下面会借鉴支付机构的对账流程，介绍下互联网电商平台的对账模块设计思路。 支付系统是电商平台对接各个支付渠道，完成交易订单处理的核心系统。电商平台进行对账模块设计时，首先要进行的就是支付系统对账。 支付系统对账，是将本系统产生的交易资金和支付渠道的结算金额进行核对。包含对账单下载、数据准备、对账、差错处理四个环节。 （1）账单下载支付系统要对接支付宝、微信、银联等多个渠道，在进行对账单下载时候，就需要针对不同的支付渠道的特点，进行针对性的处理，主要注意这三个方面的不同，分别是：下载方式不同、下载时间不同以及文件格式不同。 完成了对账单下载，就需要对渠道对账单数据和本地交易数据，整理成可供对账处理的数据。 （2）数据准备 数据准备后，要注意和渠道对账单原始数据、本地交易订单原始数据进行核对，保证数据的准确性。 （3）对账单笔账单需要对商户订单号、渠道流水号、交易时间、交易金额等字段进行比对，所有订单进行逐笔比对。 （4）差错账处理失败订单：支付系统中状态为“失败”的，渠道状态为“成功”的订单。 首次对账，对账模块本地交易数据无此订单； 按渠道数据中的商户订单号、渠道流水号、交易时间，在支付系统查找该笔订单，导入对账模块进行数据准备后，进行二次对账。 跨天订单：本地交易数据和渠道对账单记录的交易时间不在同一天。 交易时间中日期一致的不记录为差错； 日期不在同一天，按本地交易日期计入当天差错交易。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/17/8417635d71817ddc70aa8670c0d9b8a8.html" />
<meta property="og:url" content="https://mlh.app/2018/08/17/8417635d71817ddc70aa8670c0d9b8a8.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-17T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"概念及目的 首先抛出3个问题： 为什么需要对账？ 支付机构是如何进行账务对账的？ 互联网平台应该如何进行对账模块的设计？ 对账是会计学的一个名字，会计学对对账的定义是：为了保证账簿记录的真实性、完整性、准确性，在记账以后结账之前，定期或不定期地对有关数据进行检查、核对。 账簿记录是对公司企业日常经济活动的记录，类似于我们日常生活中使用记账 APP 来记录日常开销，记账 APP 里的每一条记录都是账簿记录。 这里重点是对账簿记录进行核对，包含三个方面的核对工作，即账证核对、账账核对、账实核对。 （1）账证核对，是将账簿记录与记账凭证进行核对，这里是记账凭证是指日常经济活动的书面证明。如果还是用记账 APP 来类别的话，我们超市购物的小票、购买商品的发票、银行卡的收款转账记录，都是记账凭证。 （2）账账核对，是把有相互关系的多个账簿记录进行核对。有相互关系的账簿记录，包括总分类账簿间核对，明细账簿间核对等多种类型。例如：我们使用记账 APP 时，整个家庭的日常开销和购物、教育、交通等分类开销的核对，是总分类账簿间核对；核对银行卡取现记录和日常现金支出记录，是明细账簿间核对。 （3）账实核对，是各项资产物资的记录数值与实际真实数额间的核对。例如：我们使用记账 APP 记录购买了一台手机，我发现自己手里确实有一台手机，这就是账实核对。 业务场景中的对账 以上内容说明的是会计上是如何定义对账的，下面让我们看一下具体的业务场景中，是如何定义对账的。 1. 对账的职能 Ping++ 服务的客户都是开展电子商务业务的互联网公司或项目，我们习惯称之为电商平台。电商平台的对账，主要需要完成如下三个任务： 核对平台自身系统交易数据与支付渠道的对账单数据，并将交易金额和支付渠道结算资金进行核对。 保证电商平台各系统间交易状态、交易资金的一致性，支付订单和业务订单状态要一致，收款金额和订单金额一致，总收款金额和商品金额、运费金额要一致。 要包含对账和后续的差错处理流程。 2. 对账的内容 对照会计定义中，对账包含的三个方面核对工作。 对于电商平台来说，记账凭证就是电商平台自身的交易订单，支付渠道提供对账单。 账账核对，最重要的是将系统交易数据和渠道的对账单数据进行核对。同时也包括自营商品交易、入驻第三方交易数据的核对，有余额钱包的平台，需要进行余额数据和交易数据的核对。 电商平台需要向入驻第三方进行付款时，要进行结算数据与交易数据的核对。账实核对，是将交易数据与支付渠道收款金额、已发货商品数量进行核对，结算数据和付款进行进行核对。 对账模块是大家搭建电商平台、进行业务系统、支付系统规则设计时，容易忽视的环节。往往在平台业务上线后，交易量出现爆发增长，人工无法处理每天出现的差错交易时，才会考虑设计、开发对账模块。 将对账模块的价值比作一个冰山的话，业务运行正常情况下显示的价值，就是冰山海面上的部分；当电商平台发生差错交易时，平静被打破，才会显现出对账的真正价值。 3. 对账的价值 平台发生差错交易时，对账模块的价值主要体现在： 通过系统自动进行交易数据的核对，解放了财务、运营人员的工作时间，让他们可以专注于可以公司创造更多价值的工作上； 自动完成大量交易数据的核对工作，订单数据量很大的情况，单靠人工无法完成交易数据核对并定位差错； 可以在第一时间发现差错交易，并及时进行处理。不用等到客户投诉来了，再定位问题进行处理，提高了用户体验。 电商平台的对账包含差错处理模块，运营人员人工完成差错处理后，将交易数据同步更新到支付系统；同时还包括电商平台日常业务流程中，和支付系统相关的业务订单系统、发货仓储系统、财务管理软件等周边系统，保证整个平台数据的一致性。 对账的设计 如何进行对账模块的设计，我想先说明下支付机构是如何进行账务对账的。众所周知，支付机构每天需要处理大量的交易订单和资金，支付机构的账务对账对我们进行电商平台对账模块的设计，有很好的指导价值。 支付机构在进行交易处理时，主要涉及三个系统模块，分别是联机、清分和结算。 （1）联机系统负责处理商户的交易，并将交易发送到后端扣款渠道完成交易。支付、代扣、代付、预授权等多种类型的交易，都通过联机系统进行处理。联机系统完成交易处理后，记录的交易信息有：交易时间、交易商户、交易金额、交易类型、扣款渠道等信息。 （2）清分系统主要负责各类账务金额的计算，根据交易类型计算交易商户手续费，根据扣款渠道计算交易成本，手续费减去成本等到支付机构的手机数据。清分系统还负责对账工作，将联机交易信息和资金来源方流水文件进行核对。 资金来源方就是扣款渠道，两方的数据核对完成后，对于有差异的流水，生成差错交易。差错交易会交由运营人员，进行差错交易处理。 对账后，正确无误的交易会生成结算流水文件。如果某一个扣款渠道的流水文件存在差错交易，则这个扣款渠道所有交易都不会生成结算流水文件。等待运营人员完成差错处理后，清分系统再对该扣款渠道的所有交易生成结算流水文件。 （3）结算系统根据清分生成的结算流水文件，生成支付机构对外付款的商户结算数据、等待收款的资金来款方数据，以及支付机构的收益数据。 支付机构负责进行交易资金处理的工作人员，在所有扣款渠道的资金全部入账后，对交易商户所有扣款渠道的交易资金通过一笔资金，完成交易资金的结算。结算系统根据结算流水文件，为交易商户生成对账单，供交易商户后续核对交易订单使用。清分系统对账后，会生成差错交易等待运营人员处理。 典型差错类别及处理方法 下面会介绍几种典型的差错类型及其处理方式。 第一种差错类型是长款，简单来说就是支付机构收的钱多了。 这种类型的差错交易表现为，资金来款方流水文件有记录，而支付机构联机交易状态为未支付、超时等情况。这种情况下，交易商户未收到交易成功信息，支付机构需要交易资金通过来款渠道返还用户。 第二种差错类型是短款，也就是支付机构收的钱少了。 这种类型的差错交易表现为，资金来款方流水文件无记录，而支付机构联机交易状态已成功支付。除了支付机构自身系统故障，错误记录了交易状态之外，发生短款差错的常见原因是，该笔交易资金在通过人民银行系统进行资金划转时，未能及时划转到来款渠道，导致来款渠道无法将交易资金结算到支付机构。 这种情况下，支付机构需要向来款渠道发起请款操作，同时将交易商户的其他无差错交易资金进行优先结算。 第三种差错类型双方的交易数据记录不一致，例如交易金额不一致、支付机构记录的成本金额和来款渠道实际成本金额不一致等。 发生数据记录不一致的情况，比较罕见，处理差错时，需要业务人员和开发人员配合，根据实际情况进行针对性的处理。 对账模块设计思路 对于支付机构账务对账流程，有了一个宏观的认知后，下面会借鉴支付机构的对账流程，介绍下互联网电商平台的对账模块设计思路。 支付系统是电商平台对接各个支付渠道，完成交易订单处理的核心系统。电商平台进行对账模块设计时，首先要进行的就是支付系统对账。 支付系统对账，是将本系统产生的交易资金和支付渠道的结算金额进行核对。包含对账单下载、数据准备、对账、差错处理四个环节。 （1）账单下载支付系统要对接支付宝、微信、银联等多个渠道，在进行对账单下载时候，就需要针对不同的支付渠道的特点，进行针对性的处理，主要注意这三个方面的不同，分别是：下载方式不同、下载时间不同以及文件格式不同。 完成了对账单下载，就需要对渠道对账单数据和本地交易数据，整理成可供对账处理的数据。 （2）数据准备 数据准备后，要注意和渠道对账单原始数据、本地交易订单原始数据进行核对，保证数据的准确性。 （3）对账单笔账单需要对商户订单号、渠道流水号、交易时间、交易金额等字段进行比对，所有订单进行逐笔比对。 （4）差错账处理失败订单：支付系统中状态为“失败”的，渠道状态为“成功”的订单。 首次对账，对账模块本地交易数据无此订单； 按渠道数据中的商户订单号、渠道流水号、交易时间，在支付系统查找该笔订单，导入对账模块进行数据准备后，进行二次对账。 跨天订单：本地交易数据和渠道对账单记录的交易时间不在同一天。 交易时间中日期一致的不记录为差错； 日期不在同一天，按本地交易日期计入当天差错交易。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/17/8417635d71817ddc70aa8670c0d9b8a8.html","headline":"基础向：「财务对账」的秘密都在这篇 3000 字的文章里","dateModified":"2018-08-17T00:00:00+08:00","datePublished":"2018-08-17T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/17/8417635d71817ddc70aa8670c0d9b8a8.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>基础向：「财务对账」的秘密都在这篇 3000 字的文章里</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h2><strong>概念及目的</strong></h2> 
  <p>首先抛出3个问题：</p> 
  <ol>
   <li>为什么需要对账？</li> 
   <li>支付机构是如何进行账务对账的？</li> 
   <li>互联网平台应该如何进行对账模块的设计？</li> 
  </ol>
  <p><strong>对账</strong>是会计学的一个名字，会计学对对账的定义是：<strong>为了保证账簿记录的真实性、完整性、准确性，在记账以后结账之前，定期或不定期地对有关数据进行检查、核对。</strong></p> 
  <p>账簿记录是对公司企业日常经济活动的记录，类似于我们日常生活中使用记账 APP 来记录日常开销，记账 APP 里的每一条记录都是账簿记录。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/wQJ6OCKb89V28dBDhYDP.jpg"></p> 
  <p>这里重点是对账簿记录进行核对，包含三个方面的核对工作，即账证核对、账账核对、账实核对。</p> 
  <p><strong>（1）账证核对</strong>，是将账簿记录与记账凭证进行核对，这里是记账凭证是指日常经济活动的书面证明。如果还是用记账 APP 来类别的话，我们超市购物的小票、购买商品的发票、银行卡的收款转账记录，都是记账凭证。</p> 
  <p><strong>（2）账账核对</strong>，是把有相互关系的多个账簿记录进行核对。有相互关系的账簿记录，包括总分类账簿间核对，明细账簿间核对等多种类型。例如：我们使用记账 APP 时，整个家庭的日常开销和购物、教育、交通等分类开销的核对，是总分类账簿间核对；核对银行卡取现记录和日常现金支出记录，是明细账簿间核对。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/76UHBP9UgUxnOXNsLrY2.jpg"></p> 
  <p><strong>（3）账实核对</strong>，是各项资产物资的记录数值与实际真实数额间的核对。例如：我们使用记账 APP 记录购买了一台手机，我发现自己手里确实有一台手机，这就是账实核对。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/fsXG2jFldFxomnGocgID.jpg"></p> 
  <h2><strong>业务场景中的对账</strong></h2> 
  <p>以上内容说明的是会计上是如何定义对账的，下面让我们看一下具体的业务场景中，是如何定义对账的。</p> 
  <h3>1. 对账的职能</h3> 
  <p>Ping++ 服务的客户都是开展电子商务业务的互联网公司或项目，我们习惯称之为电商平台。电商平台的对账，主要需要完成如下三个任务：</p> 
  <ol>
   <li>核对平台自身系统交易数据与支付渠道的对账单数据，并将交易金额和支付渠道结算资金进行核对。</li> 
   <li>保证电商平台各系统间交易状态、交易资金的一致性，支付订单和业务订单状态要一致，收款金额和订单金额一致，总收款金额和商品金额、运费金额要一致。</li> 
   <li>要包含对账和后续的差错处理流程。</li> 
  </ol>
  <h3>2. 对账的内容</h3> 
  <p>对照会计定义中，对账包含的三个方面核对工作。</p> 
  <ol>
   <li>对于电商平台来说，<strong>记账凭证</strong>就是电商平台自身的交易订单，支付渠道提供对账单。</li> 
   <li><strong>账账核对</strong>，最重要的是将系统交易数据和渠道的对账单数据进行核对。同时也包括自营商品交易、入驻第三方交易数据的核对，有余额钱包的平台，需要进行余额数据和交易数据的核对。</li> 
   <li>电商平台需要向入驻第三方进行付款时，要进行结算数据与交易数据的核对。<strong>账实核对</strong>，是将交易数据与支付渠道收款金额、已发货商品数量进行核对，结算数据和付款进行进行核对。</li> 
  </ol>
  <p>对账模块是大家搭建电商平台、进行业务系统、支付系统规则设计时，容易忽视的环节。往往在平台业务上线后，交易量出现爆发增长，人工无法处理每天出现的差错交易时，才会考虑设计、开发对账模块。</p> 
  <p>将对账模块的价值比作一个冰山的话，业务运行正常情况下显示的价值，就是冰山海面上的部分；当电商平台发生差错交易时，平静被打破，才会显现出对账的真正价值。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/ahybzVIPTjlIgpZ8I6mi.jpg"></p> 
  <h3>3. 对账的价值</h3> 
  <p>平台发生差错交易时，对账模块的价值主要体现在：</p> 
  <ol>
   <li>通过系统自动进行交易数据的核对，解放了财务、运营人员的工作时间，让他们可以专注于可以公司创造更多价值的工作上；</li> 
   <li>自动完成大量交易数据的核对工作，订单数据量很大的情况，单靠人工无法完成交易数据核对并定位差错；</li> 
   <li>可以在第一时间发现差错交易，并及时进行处理。不用等到客户投诉来了，再定位问题进行处理，提高了用户体验。</li> 
  </ol>
  <p>电商平台的对账包含差错处理模块，运营人员人工完成差错处理后，将交易数据同步更新到支付系统；同时还包括电商平台日常业务流程中，和支付系统相关的业务订单系统、发货仓储系统、财务管理软件等周边系统，保证整个平台数据的一致性。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/f8f9EgRGXwp4vF4QV5Tf.jpg"></p> 
  <h2><strong>对账的设计</strong></h2> 
  <p>如何进行对账模块的设计，我想先说明下支付机构是如何进行账务对账的。众所周知，支付机构每天需要处理大量的交易订单和资金，支付机构的账务对账对我们进行电商平台对账模块的设计，有很好的指导价值。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/8anOXOM9d2xltytvq70p.jpg"></p> 
  <p>支付机构在进行交易处理时，主要涉及三个系统模块，分别是<strong>联机</strong>、<strong>清分</strong>和<strong>结算</strong>。</p> 
  <p><strong>（1）联机系统</strong>负责处理商户的交易，并将交易发送到后端扣款渠道完成交易。支付、代扣、代付、预授权等多种类型的交易，都通过联机系统进行处理。联机系统完成交易处理后，记录的交易信息有：交易时间、交易商户、交易金额、交易类型、扣款渠道等信息。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/odShzu2RC0JPTiuNKmBp.png"></p> 
  <p><strong>（2）清分系统</strong>主要负责各类账务金额的计算，根据交易类型计算交易商户手续费，根据扣款渠道计算交易成本，手续费减去成本等到支付机构的手机数据。清分系统还负责对账工作，将联机交易信息和资金来源方流水文件进行核对。</p> 
  <p>资金来源方就是扣款渠道，两方的数据核对完成后，对于有差异的流水，生成差错交易。差错交易会交由运营人员，进行差错交易处理。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/hUU1VcK8xgIsjBBJ18Uv.jpg"></p> 
  <p>对账后，正确无误的交易会生成结算流水文件。如果某一个扣款渠道的流水文件存在差错交易，则这个扣款渠道所有交易都不会生成结算流水文件。等待运营人员完成差错处理后，清分系统再对该扣款渠道的所有交易生成结算流水文件。</p> 
  <p><strong>（3）结算系统</strong>根据清分生成的结算流水文件，生成支付机构对外付款的商户结算数据、等待收款的资金来款方数据，以及支付机构的收益数据。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/9Utd1QPlGD2Z8t44vep5.jpg"></p> 
  <p>支付机构负责进行交易资金处理的工作人员，在所有扣款渠道的资金全部入账后，对交易商户所有扣款渠道的交易资金通过一笔资金，完成交易资金的结算。结算系统根据结算流水文件，为交易商户生成对账单，供交易商户后续核对交易订单使用。清分系统对账后，会生成差错交易等待运营人员处理。</p> 
  <h3>典型差错类别及处理方法</h3> 
  <p>下面会介绍几种典型的差错类型及其处理方式。</p> 
  <p>第一种差错类型是长款，简单来说就是支付机构<strong>收的钱多了</strong>。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/i9LUbiq4VIqITLEQKQ4B.jpg"></p> 
  <p>这种类型的差错交易表现为，资金来款方流水文件有记录，而支付机构联机交易状态为未支付、超时等情况。这种情况下，交易商户未收到交易成功信息，支付机构需要交易资金通过来款渠道返还用户。</p> 
  <p>第二种差错类型是短款，也就是支付机构<strong>收的钱少了</strong>。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/zUFcfL3SFFJipcm6DrKH.jpg"></p> 
  <p>这种类型的差错交易表现为，资金来款方流水文件无记录，而支付机构联机交易状态已成功支付。除了支付机构自身系统故障，错误记录了交易状态之外，发生短款差错的常见原因是，<strong>该笔交易资金在通过人民银行系统进行资金划转时，未能及时划转到来款渠道，导致来款渠道无法将交易资金结算到支付机构</strong>。</p> 
  <p>这种情况下，支付机构需要向来款渠道发起请款操作，同时将交易商户的其他无差错交易资金进行优先结算。</p> 
  <p>第三种差错类型双方的交易数据记录不一致，例如交易金额不一致、支付机构记录的成本金额和来款渠道实际成本金额不一致等。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/FHggUWV0y97jG4onhr4M.jpg"></p> 
  <p>发生数据记录不一致的情况，比较罕见，处理差错时，需要业务人员和开发人员配合，根据实际情况进行针对性的处理。</p> 
  <h3><strong>对账模块设计思路</strong></h3> 
  <p>对于支付机构账务对账流程，有了一个宏观的认知后，下面会借鉴支付机构的对账流程，介绍下<strong>互联网电商平台的对账模块设计思路。</strong></p> 
  <p>支付系统是电商平台对接各个支付渠道，完成交易订单处理的核心系统。电商平台进行对账模块设计时，首先要进行的就是支付系统对账。</p> 
  <p>支付系统对账，是将本系统产生的交易资金和支付渠道的结算金额进行核对。包含对<strong>账单下载、数据准备、对账、差错处理</strong>四个环节。</p> 
  <p><strong>（1）账单下载</strong>支付系统要对接支付宝、微信、银联等多个渠道，在进行对账单下载时候，就需要针对不同的支付渠道的特点，进行针对性的处理，主要注意这三个方面的不同，分别是：<strong>下载方式不同、下载时间不同以及文件格式不同。</strong></p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/5UKG6oEmGADjp8Iz4aNU.png"></p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/6FTLWUkt8pdtFTDuYB3J.png"></p> 
  <p>完成了对账单下载，就需要对渠道对账单数据和本地交易数据，整理成可供对账处理的数据。</p> 
  <p><strong>（2）数据准备</strong></p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/xwDAIDpYJhf1OYKyc0yO.png"></p> 
  <p>数据准备后，要注意和渠道对账单原始数据、本地交易订单原始数据进行核对，保证数据的准确性。</p> 
  <p><strong>（3）对账</strong>单笔账单需要对商户订单号、渠道流水号、交易时间、交易金额等字段进行比对，所有订单进行逐笔比对。</p> 
  <p style="text-align:center;"><img alt="" class="has" src="http://image.woshipm.com/wp-files/2018/08/4FIRzQ1PfiWyi9cfibQe.png"></p> 
  <p><strong>（4）差错账处理</strong><strong>失败订单</strong>：支付系统中状态为“失败”的，渠道状态为“成功”的订单。</p> 
  <ul>
   <li>首次对账，对账模块本地交易数据无此订单；</li> 
   <li>按渠道数据中的商户订单号、渠道流水号、交易时间，在支付系统查找该笔订单，导入对账模块进行数据准备后，进行二次对账。</li> 
  </ul>
  <p><strong>跨天订单</strong>：本地交易数据和渠道对账单记录的交易时间不在同一天。</p> 
  <ul>
   <li>交易时间中日期一致的不记录为差错；</li> 
   <li>日期不在同一天，按本地交易日期计入当天差错交易。</li> 
  </ul> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_42549663/article/details/81777349,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_42549663/article/details/81777349,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>一张金融IC卡的交易流程（二）—–基本测试环境及借贷记交易流程 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="一张金融IC卡的交易流程（二）—–基本测试环境及借贷记交易流程" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1.基本测试环境 读卡器：SDI011 密钥： ;3DES算法主密钥,应用密文计算 MdkAc_3DES=2F3D201558865D02A1497F04F820924C ;3DES算法主密钥,MAC计算 MdkMac_3DES=3B0D4AE6EFEA20FB8F5E510264089D5D ;3DES算法主密钥,敏感数据加密计算 MdkDek_3DES=9EB33751912CC792750E0E19A7896BFE 2.借贷记（所有数据均为模拟测试数据，与任何银行和金融机构均没有对应实际业务关系）出于对安全考虑，数据做过修改，请只参考流程和指令即可。 数据初始化成功 -------------------------------------------1 选择应用--------------------------------------------- 交易开始 ********************************* 选择交易应用 ********************************* ATR: 3B6D000000960755DD8648410100000001 ---&gt; 00A404000E 315041592E5359532E4444463031 &lt;--- [6120] ---&gt; 00C0000020&nbsp; &lt;--- 6F1E840E 315041592E5359532E4444463031 &nbsp;A50C8801015F2D027A689F110101[9000] 1PAY.SYS.DDF01 ---&gt; 00B2010C00&nbsp; &lt;--- [6C2A] ---&gt; 00B2010C2A&nbsp; &lt;--- 70286126 4F08A000000333010101 500A50424F43204445424954 870101 &nbsp; 9F120AD5D0D0D0D2BBBFA8CDA8 [9000] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 应用AID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PBOC DEBIT（每款产品不同） &nbsp; &nbsp; &nbsp; 招行一卡通（每款产品不同） ---&gt; 00B2020C00&nbsp; &lt;--- [6A83] 建立交易应用列表成功 ---&gt; 00A4040008 A000000333010101 &lt;--- [614C] ---&gt; 00C000004C&nbsp; &lt;--- 6F4A8408 A000000333010101 A53E500A50424F432044454249548701019F38099F7A019F02065F2A025F2D027A689F1101019F120A50424F43204445424954BF0C0A 9F4D020B0A DF4D020C0A[9000] ********************************* 选择交易应用结束 ********************************* -------------------------------------------------------2 应用初始化--------------------------------------------------------------------- ********************************* 初始化应用 ********************************* &nbsp;//获取处理选项GPO：用来启动 IC 卡内的交易 &nbsp;//根据9F38(PDOL)的值 , 来拼装数据 , 如下： &nbsp;//9F7A01：电子现金终端支持指示器 ,00( 不支持电子现金处理 ) &nbsp;//9F0206：授权金额 ,000000000001 &nbsp;//5F2A02：货币代码 ,0156 ---&gt; 80A800000B 8309 000000000001 00 0156 &lt;--- [6110] ---&gt; 00C0000010&nbsp; &nbsp;//GPO 返回： 80( Tag，接触 )+ 应用交互特征 ( AIP )+ 应用文件定位器 ( AFL ) //7C ( SDA + DDA + 支持持卡人认证 + 支持终端风险管理 + 支持发卡行认证 )+00 &nbsp;//根据 GPO 返回的 AFL，从卡中读取数据 &lt;--- 800E 7C00 080102001001050118010100[9000] //08-01 10-02 18-03 20-04 28-05 30-06 发送GPO指令成功 ********************************* 初始化应用结束 ********************************* --------------------------------------------------------3 读应用数据-------------------------------------------------------------------- ********************************* 读取应用数据 ********************************* Read Record : SFI = 1,RecordNum = 1 ---&gt; 00B2010C00&nbsp; &lt;--- [6C6A] ---&gt; 00B2010C6A&nbsp; &lt;--- 706857138207853600005183859D29112201000087700F9F1F502020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020[9000] [57] 13 8207853600005183859D29112201000087700F [9F1F] 50 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020 Read Record : SFI = 1,RecordNum = 2 ---&gt; 00B2020C00&nbsp; &lt;--- [6C3E] ---&gt; 00B2020C3E&nbsp; &lt;--- 703C9F61182020202020202020202020202020202020202020202020209F6201005F201A2020202020202020202020202020202020202020202020202020[9000] [9F61] 18 202020202020202020202020202020202020202020202020 [9F62] 01 00 [5F20] 1A 2020202020202020202020202020202020202020202020202020 Read Record : SFI = 2,RecordNum = 1 ---&gt; 00B2011400&nbsp; &lt;--- [6C89] ---&gt; 00B2011489&nbsp; &lt;--- 7081865F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103[9000] [5F24] 03 291130 [5F25] 03 260425 [5A] 0A 8207853600005183859F [9F07] 02 FF00 [9F08] 02 0030 [5F28] 02 0156 [8E] 0C 000000000000000002031F00 [9F0D] 05 D86004A800 [9F0E] 05 0010980000 [9F0F] 05 D86804F800 [8C] 1B 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 [8D] 1A 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 Read Record : SFI = 2,RecordNum = 2 ---&gt; 00B2021400&nbsp; &lt;--- [6CBB] ---&gt; 00B20214BB&nbsp; &lt;--- 7081B89F4681B09456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA555649F470103[9000] [9F46] B0 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 [9F47] 01 03 Read Record : SFI = 2,RecordNum = 3 ---&gt; 00B2031400&nbsp; &lt;--- [6CCD] ---&gt; 00B20314CD&nbsp; &lt;--- 7081CA9381B02D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D9F4A01829F631030313034373930300000000000006000[9000] [93] B0 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D [9F4A] 01 82 [9F63] 10 30313034373930300000000000006000 Read Record : SFI = 2,RecordNum = 4 ---&gt; 00B2041400&nbsp; &lt;--- [6C19] ---&gt; 00B2041419&nbsp; &lt;--- 70175F300202209F49039F37045F3401019F1401009F230100[9000] [5F30] 02 0220 [9F49] 03 9F3704 [5F34] 01 01 [9F14] 01 00 [9F23] 01 00 Read Record : SFI = 2,RecordNum = 5 ---&gt; 00B2051400&nbsp; &lt;--- [6C09] ---&gt; 00B2051409&nbsp; &lt;--- 70079F3201038F010B[9000] [9F32] 01 03 [8F] 01 0B Read Record : SFI = 3,RecordNum = 1 ---&gt; 00B2011C00&nbsp; &lt;--- [6CFE] ---&gt; 00B2011CFE&nbsp; &lt;--- 7081FB9081F8A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472[9000] [90] F8 A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 // 静态认证数据列表 = DGI 0201 + TagValue [&quot;82&quot;] 静态认证的应用数据 SDA_Value= 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 + 7C00 ********************************* 读取应用数据结束 ********************************* ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理 ********************************* -----------------------------------------------------------4 静态数据认证-------------------------------------------------------------------- ---------4.1恢复发卡行公钥-------------- 脱机数据认证-终端使用RSA/SHA-1/3DES算法 动态数据认证,DDA CA公钥RID: A000000333 标识银联RID CA公钥PKI [8F]: 0B &nbsp; &nbsp; CA公钥索引 CA公钥模: CA_N= CF9FDF46B356378E9AF311B0F981B21A1F22F250FB11F55C958709E3C7241918293483289EAE688A094C02C344E2999F315A72841F489E24B1BA0056CFAB3B479D0E826452375DCDBB67E97EC2AA66F4601D774FEAEF775ACCC621BFEB65FB0053FC5F392AA5E1D4C41A4DE9FFDFDF1327C4BB874F1F63A599EE3902FE95E729FD78D4234DC7E6CF1ABABAA3F6DB29B7F05D1D901D2E76A606A8CBFFFFECBD918FA2D278BDB43B0434F5D45134BE1C2781D157D501FF43E5F1C470967CD57CE53B64D82974C8275937C5D8502A1252A8A5D6088A259B694F98648D9AF2CB0EFD9D943C69F896D49FA39702162ACB5AF29B90BADE005BC157 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA公钥值，此值在终端进行配置，非卡片中数据 CA公钥指数:CA_E= 03 发卡行公钥证书 [90]: CA_I= A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 使用CA公钥对发卡行公钥证书解密后:&nbsp; 终端恢复发卡行公钥 CA_O = DERSA（CA公钥，CA公钥指数，发卡行公钥证书） 软件中 E是公钥指数（65537或03） N是模 D是私钥指数 CA_O=6A 02820785FF12300030220101B001BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440FBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB &nbsp; 97D3B68E372323FF1B487D800D7AABA14D0CEDA3BC 发卡行公钥余项 [92]:不存在 发卡行公钥指数 [9F32]: 03 计算哈希值输入数据:&nbsp; // 组织摘要输入信息 + 发卡行公钥余项 ( 如果有 ) + 发卡行公钥指数 &nbsp;// HashValueInfo = CA _ O . Mid (2, CA _ O . GetLength ()- 42 - 2) + TagValue [_ T (&quot;92&quot;)] + TagValue [_ T (&quot;9F32&quot;)]; // HashV = SHA 1( HashValueInfo ) 02820785FF12300030220101B001 BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F &nbsp; &nbsp; BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB03 终端计算哈希结果: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3 HashV = SHA1(计算哈希输入数据) 卡恢复哈希数据: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3 终端交易日期 [9A]: 150609 证书有效日期: 3012 -------恢复和验证IC卡公钥（P【8205】*Q【8204】）----- 发卡行公钥模:&nbsp; 发卡行公钥模 = 发卡行公钥的最左边字节 + 发卡行公钥的余项（如果有） _ CA _ N = CA _ O . Mid (30, CA _ N . GetLength () - 72) + TagValue [_ T (&quot;92&quot;)]; BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F ICC公钥证书 [9F46]: IC_I= 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 使用发卡行公钥对ICC公钥证书解密后:&nbsp; /恢复 IC 卡公钥证书 ( 唯一 ) IC _ O = DeRSA (_ CA _ N , IC _ E , IC _ I ) IC _ O = 6A 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB285D71F611B4D473150EFB22B49044A87E99904ABC ICC公钥余项 [9F48]:不存在 ICC公钥指数: 03 BB = (&#39; B &#39;, CA _ N . GetLength () - 52); HashValueInfo = IC _ O . Mid (2, IC _ O . GetLength () -42 - 2) + TagValue [9 F 48] + IC _ E + SDA _ Value HashV = SHA 1( HashValueInfo ); 计算哈希的输入数据: 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB035F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 终端计算哈希结果: 285D71F611B4D473150EFB22B49044A87E99904A HashV = SHA1(计算哈希输入数据) 卡恢复哈希数据: 285D71F611B4D473150EFB22B49044A87E99904A 证书有效日期: 3012 ----------------------动态签名应用数据的生成---------------------------- ICC公钥模: _ IC _ N ( IC 卡公钥 P * Q ) = IC_O . Mid (42, nIssuer _ n _ Len - 84) + TagValue [9F48] nIssuer _ n _ Len =发卡行公钥模的长度 _ IC_N= C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27 内部认证， + DDOL [9 F49]( 由终端生成的不可预知数 ,9F37,4 个字节的二进制数） ---&gt; 0088000004 5BC15BC1 &lt;--- [6183] ---&gt; 00C0000083&nbsp; &lt;--- 808180 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547[9000] 动态签名结果 [9F4B]: IC_I= 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547 ICC公钥指数 [9F47]: 03 使用ICC公钥对动态签名结果解密后:&nbsp; 恢复 IC 卡签名动态数据 _ IC _ O = DeRSA (_ IC _ N , IC _ E , _ IC _ I ); _IC_O= 6A 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBA7CB3EDB482D95AF74D3FF9156F93CE2E89B2033BC 计算哈希值输入数据:&nbsp; HashValueInfo = _ IC _ O . Mid (2, _ IC _ O . GetLength () -22 * 2) + TagValue [9F37]; HashV = SHA 1( HashValueInfo );&nbsp; 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB5BC15BC1 卡恢复哈希值: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033 终端计算哈希结果: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033 动态数据认证DDA成功 ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理结束 ********************************* ********************************* 处理限制 ********************************* 卡应用版本号: 0030----PBOC3.0 终端应用版本号: 008C 应用版本号不一致 应用用途控制检查 处理限制结果可参考TVR,TSI的树示意图 ********************************* 处理限制结束 ********************************* ********************************* 持卡人认证 ********************************* CVM 代码 02----如果此CVM失败,则持卡人验证失败.联机加密PIN验证 CVM 条件代码 03---如果终端支持这个CVM 持卡人认证--联机PIN验证 持卡人认证--联机PIN输入完毕 ********************************* 持卡人认证结束 ********************************* ********************************* 终端风险管理 ********************************* 主帐号 [5A]: 8207853600005183859F 交易金额 [9F02]: 000000000100 终端最低交易限额 [9F1B]: 0000FFFF 偏置随机选择的最大目标百分比: 50 随机选择的目标百分比: 20 偏置随机选择的阈值: 40 随机数小于或等于交易百分比,终端随机交易选择联机 连续脱机交易下限 [9F14]: 00 连续脱机交易上限 [9F23]: 00 ---&gt; 80CA9F1300&nbsp; &lt;--- [6C05] ---&gt; 80CA9F1305&nbsp; &lt;--- 9F13020000[9000] ---&gt; 80CA9F3600&nbsp; &lt;--- [6C05] ---&gt; 80CA9F3605&nbsp; &lt;--- 9F36020001[9000] 此次ATC寄存器值 [9F36]: 0001 上次联机ATC寄存器值 [9F13]: 0000 超过连续脱机交易次数下限 超过连续脱机交易次数上限 新卡检查 ---&gt; 80CA9F1300&nbsp; &lt;--- [6C05] ---&gt; 80CA9F1305&nbsp; &lt;--- 9F13020000[9000] 上次联机ATC寄存器值: 0000 //0000为初始值,TVR值置为1 新卡 ********************************* 终端风险管理结束 ********************************* ********************************* 终端行为分析 ********************************* 终端交易属性TTQ [9F66]: B6000000 终端验证结果TVR [95]: 00a8047000 IAC-拒绝 [9F0E]: 0010980000 TAC-拒绝: 0000000000 终端具有联机能力 IAC-联机 [9F0F]: D86804F800 TAC-联机: 0000000000 有TVR和IAC-联机或TAC-联机的任何对应位同时为&#39;1&#39;,联机(ARQC) ********************************* 终端行为分析结束 ********************************* ********************************* 卡片行为分析 ********************************* ------------------------应用密文产生--------------- 卡片风险管理数据对象列表1 CDOL1 [8C]: 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 AC _ I = TagToValue ( TagValue [_ T (&quot;8 C &quot;)]); 8C =9F0206(授权金额)+9F0306( 其它金额)+9F1A02( 终端国家代码)+9505( 终端验证结果)+5F2A02(交易货币代码)+9A03(交易日期)+9C01( 交易类型)+9 F3704(不可预知数)+9F2103(交易时间)+9F4E14(商户名称 ) AC_I= &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674 // 生成应用密文（GENERATE APPLICATION CRYPTOGRAM（AC））：传送交易相关数据到 IC 卡，IC 卡计算并且返回一个密文。 // P 1 ： 80( ARQC ), 授权请求密文 ( Authorization Request Cryptogram ) 为联机请求 // 40( TC ), 交易证书 ( Transaction Certificate ) 为核准 // 00( AAC ), 应用认证密文 ( Application Authentication Cryptogram ) 为拒绝 // 一次交易卡片最多处理两个生成应用密文命令，如果收到三个及以上个数，卡片返回 “6985 ” // 如果在第 1 个 GENEARATE AC 命令中 IC 卡返回 TC 或 AAC，则交易脱机授权批准或拒绝 ---&gt; 80AE800034 &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674 &lt;--- [6120] ---&gt; 00C0000020&nbsp; // 密文信息数据 + 应用交易计数器 ( ATC , 0001)+ 应用密文 ( AC , F8A82BB1573B653E即ARQC &nbsp;)+ 发卡行应用数据 (0 X 01+9F79低5字节 + MAC ) &lt;--- 801E &nbsp;80 &nbsp;0001 &nbsp;F8A82BB1573B653E &nbsp;07020103A03002010A010000000000 &nbsp;AA30A471 [9000] 卡片风险管理巳执行 ********************************* 卡片行为分析结束 ********************************* -----------------------------------------------发卡行认证------------------------------------------------------- ********************************* 联机处理或脱机批准或拒绝检查 ********************************* 联机授权 发送联机请求数据至发卡行...... 发送报文数据 : 5A0A8207853600005183859F5F3401019F3901059F2608F8A82BB1573B653E9F02060000000001009F03060000000000009F1A020156950500A80470005F2A0201569A031506099C01009F37045BC15BC182027C009F360200019F101307020103A03002010A010000000000AA30A471 // 模拟后台计算 ARPC 授权响应密文 ( Authorization Response Cryptogram ) // ARC = 3030+000000000000 // 授权响应代码 ( ARC ), 定义发卡行对交易联机授权的结果 授权响应码为 00 ， 10 或 11 表明发卡行接受交易； 授权响应码为 01 或 02 表明发卡行请求参考； 其它值表明发卡行拒绝，卡片按照终端请求交易拒绝进行处理。 // 脱机批准 Y 1; 脱机拒绝 Z 1; 无法联机，脱机被批准 Y 3; 无法联机，脱机被拒绝 Z 3 // ValueA = Xor ( ARC , ARQC ) // 借记贷记联机验证密钥 UDK (8000. Left (32)) UDK _ AC =2F3D201558865D02A1497F04F820924C ATC _ = 000000000000+0001+000000000000+ FFFE // 离散因子 // DoDes ( ECB , ENCRYPT , ATC _, UDK _ AC, SKAC );// 计算过程密钥 // DoDes ( ECB , ENCRYPT , ValueA , SKAC , ARPC );// 授权响应密文 ARPC 发卡行响应数据成功,CUP8583报文55域数据: 910A1EBAD851FC4229B53030 发卡行认证主机响应数据 ARPC 91: 1EBAD851FC4229B53030 ---&gt; 008200000a 1EBAD851FC4229B53030 &lt;--- [9000] 发卡行认证---外部认证成功 联机授权完成 ********************************* 联机处理或脱机批准或拒绝检查结束 ********************************* ********************************* 完成交易处理 ********************************* 终端验证结果TVR [95]: 00a8047000 IAC-缺省 [9F0D]: D86004A800 TAC-缺省: 0000000000 发卡行认证主机响应数据: 1EBAD851FC4229B53030 发卡行认证主机响应授权响应码 ARC: 3030 授权批准:TC 卡片风险管理数据对象列表2 CDOL2 [8D]: 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 CDOL2 数据元 3030000000000100000000000000015600a80470000156150609005BC15BC1160417 ---&gt; 80AE400022 3030000000000100000000000000015600a80470000156150609005BC15BC1160417 &lt;--- [6120] ---&gt; 00C0000020&nbsp; &lt;--- 801E4000017C642EE203F388FC07020103603002010A010000000000AA30A471[9000] CDI_1 [9F27_1]: 40 ********************************* 完成交易处理结束 ********************************* 交易成功 卡片交易数据: [57] 8207853600005183859D29112201000087700F [5A] 8207853600005183859F [5F20] 2020202020202020202020202020202020202020202020202020 [5F24] 291130 [5F25] 260425 [5F28] 0156 [5F30] 0220 [5F34] 01 [82] 7C00 [8A] 3030 [8C] 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 [8D] 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 [8E] 000000000000000002031F00 [8F] 0B [90] A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 [91] 1EBAD851FC4229B53030 [93] 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D [94] 080102001001050118010100 [9F07] FF00 [9F08] 0030 [9F0D] D86004A800 [9F0E] 0010980000 [9F0F] D86804F800 [9F10] 07020103603002010A010000000000AA30A471 [9F13] 0000 [9F14] 00 [9F1F] 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020 [9F23] 00 [9F26] F8A82BB1573B653E [9F26_1] 7C642EE203F388FC [9F27] 80 [9F27_1] 40 [9F32] 03 [9F34] 020302 [9F36] 0001 [9F36_1] 0001 [9F38] 9F7A019F02065F2A02 [9F46] 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 [9F47] 03 [9F49] 9F3704 [9F4A] 82 [9F4B] 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547 [9F4C] 0001 [9F4D] 0B0A [9F61] 202020202020202020202020202020202020202020202020 [9F62] 00 [9F63] 30313034373930300000000000006000 [CVR] 03603002 [DF61] 0C0A [OnLinePin] 1111 [Static_Data_To_Authentiocate] 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 阅读更多 登录后自动展开" />
<meta property="og:description" content="1.基本测试环境 读卡器：SDI011 密钥： ;3DES算法主密钥,应用密文计算 MdkAc_3DES=2F3D201558865D02A1497F04F820924C ;3DES算法主密钥,MAC计算 MdkMac_3DES=3B0D4AE6EFEA20FB8F5E510264089D5D ;3DES算法主密钥,敏感数据加密计算 MdkDek_3DES=9EB33751912CC792750E0E19A7896BFE 2.借贷记（所有数据均为模拟测试数据，与任何银行和金融机构均没有对应实际业务关系）出于对安全考虑，数据做过修改，请只参考流程和指令即可。 数据初始化成功 -------------------------------------------1 选择应用--------------------------------------------- 交易开始 ********************************* 选择交易应用 ********************************* ATR: 3B6D000000960755DD8648410100000001 ---&gt; 00A404000E 315041592E5359532E4444463031 &lt;--- [6120] ---&gt; 00C0000020&nbsp; &lt;--- 6F1E840E 315041592E5359532E4444463031 &nbsp;A50C8801015F2D027A689F110101[9000] 1PAY.SYS.DDF01 ---&gt; 00B2010C00&nbsp; &lt;--- [6C2A] ---&gt; 00B2010C2A&nbsp; &lt;--- 70286126 4F08A000000333010101 500A50424F43204445424954 870101 &nbsp; 9F120AD5D0D0D0D2BBBFA8CDA8 [9000] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 应用AID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PBOC DEBIT（每款产品不同） &nbsp; &nbsp; &nbsp; 招行一卡通（每款产品不同） ---&gt; 00B2020C00&nbsp; &lt;--- [6A83] 建立交易应用列表成功 ---&gt; 00A4040008 A000000333010101 &lt;--- [614C] ---&gt; 00C000004C&nbsp; &lt;--- 6F4A8408 A000000333010101 A53E500A50424F432044454249548701019F38099F7A019F02065F2A025F2D027A689F1101019F120A50424F43204445424954BF0C0A 9F4D020B0A DF4D020C0A[9000] ********************************* 选择交易应用结束 ********************************* -------------------------------------------------------2 应用初始化--------------------------------------------------------------------- ********************************* 初始化应用 ********************************* &nbsp;//获取处理选项GPO：用来启动 IC 卡内的交易 &nbsp;//根据9F38(PDOL)的值 , 来拼装数据 , 如下： &nbsp;//9F7A01：电子现金终端支持指示器 ,00( 不支持电子现金处理 ) &nbsp;//9F0206：授权金额 ,000000000001 &nbsp;//5F2A02：货币代码 ,0156 ---&gt; 80A800000B 8309 000000000001 00 0156 &lt;--- [6110] ---&gt; 00C0000010&nbsp; &nbsp;//GPO 返回： 80( Tag，接触 )+ 应用交互特征 ( AIP )+ 应用文件定位器 ( AFL ) //7C ( SDA + DDA + 支持持卡人认证 + 支持终端风险管理 + 支持发卡行认证 )+00 &nbsp;//根据 GPO 返回的 AFL，从卡中读取数据 &lt;--- 800E 7C00 080102001001050118010100[9000] //08-01 10-02 18-03 20-04 28-05 30-06 发送GPO指令成功 ********************************* 初始化应用结束 ********************************* --------------------------------------------------------3 读应用数据-------------------------------------------------------------------- ********************************* 读取应用数据 ********************************* Read Record : SFI = 1,RecordNum = 1 ---&gt; 00B2010C00&nbsp; &lt;--- [6C6A] ---&gt; 00B2010C6A&nbsp; &lt;--- 706857138207853600005183859D29112201000087700F9F1F502020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020[9000] [57] 13 8207853600005183859D29112201000087700F [9F1F] 50 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020 Read Record : SFI = 1,RecordNum = 2 ---&gt; 00B2020C00&nbsp; &lt;--- [6C3E] ---&gt; 00B2020C3E&nbsp; &lt;--- 703C9F61182020202020202020202020202020202020202020202020209F6201005F201A2020202020202020202020202020202020202020202020202020[9000] [9F61] 18 202020202020202020202020202020202020202020202020 [9F62] 01 00 [5F20] 1A 2020202020202020202020202020202020202020202020202020 Read Record : SFI = 2,RecordNum = 1 ---&gt; 00B2011400&nbsp; &lt;--- [6C89] ---&gt; 00B2011489&nbsp; &lt;--- 7081865F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103[9000] [5F24] 03 291130 [5F25] 03 260425 [5A] 0A 8207853600005183859F [9F07] 02 FF00 [9F08] 02 0030 [5F28] 02 0156 [8E] 0C 000000000000000002031F00 [9F0D] 05 D86004A800 [9F0E] 05 0010980000 [9F0F] 05 D86804F800 [8C] 1B 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 [8D] 1A 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 Read Record : SFI = 2,RecordNum = 2 ---&gt; 00B2021400&nbsp; &lt;--- [6CBB] ---&gt; 00B20214BB&nbsp; &lt;--- 7081B89F4681B09456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA555649F470103[9000] [9F46] B0 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 [9F47] 01 03 Read Record : SFI = 2,RecordNum = 3 ---&gt; 00B2031400&nbsp; &lt;--- [6CCD] ---&gt; 00B20314CD&nbsp; &lt;--- 7081CA9381B02D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D9F4A01829F631030313034373930300000000000006000[9000] [93] B0 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D [9F4A] 01 82 [9F63] 10 30313034373930300000000000006000 Read Record : SFI = 2,RecordNum = 4 ---&gt; 00B2041400&nbsp; &lt;--- [6C19] ---&gt; 00B2041419&nbsp; &lt;--- 70175F300202209F49039F37045F3401019F1401009F230100[9000] [5F30] 02 0220 [9F49] 03 9F3704 [5F34] 01 01 [9F14] 01 00 [9F23] 01 00 Read Record : SFI = 2,RecordNum = 5 ---&gt; 00B2051400&nbsp; &lt;--- [6C09] ---&gt; 00B2051409&nbsp; &lt;--- 70079F3201038F010B[9000] [9F32] 01 03 [8F] 01 0B Read Record : SFI = 3,RecordNum = 1 ---&gt; 00B2011C00&nbsp; &lt;--- [6CFE] ---&gt; 00B2011CFE&nbsp; &lt;--- 7081FB9081F8A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472[9000] [90] F8 A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 // 静态认证数据列表 = DGI 0201 + TagValue [&quot;82&quot;] 静态认证的应用数据 SDA_Value= 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 + 7C00 ********************************* 读取应用数据结束 ********************************* ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理 ********************************* -----------------------------------------------------------4 静态数据认证-------------------------------------------------------------------- ---------4.1恢复发卡行公钥-------------- 脱机数据认证-终端使用RSA/SHA-1/3DES算法 动态数据认证,DDA CA公钥RID: A000000333 标识银联RID CA公钥PKI [8F]: 0B &nbsp; &nbsp; CA公钥索引 CA公钥模: CA_N= CF9FDF46B356378E9AF311B0F981B21A1F22F250FB11F55C958709E3C7241918293483289EAE688A094C02C344E2999F315A72841F489E24B1BA0056CFAB3B479D0E826452375DCDBB67E97EC2AA66F4601D774FEAEF775ACCC621BFEB65FB0053FC5F392AA5E1D4C41A4DE9FFDFDF1327C4BB874F1F63A599EE3902FE95E729FD78D4234DC7E6CF1ABABAA3F6DB29B7F05D1D901D2E76A606A8CBFFFFECBD918FA2D278BDB43B0434F5D45134BE1C2781D157D501FF43E5F1C470967CD57CE53B64D82974C8275937C5D8502A1252A8A5D6088A259B694F98648D9AF2CB0EFD9D943C69F896D49FA39702162ACB5AF29B90BADE005BC157 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA公钥值，此值在终端进行配置，非卡片中数据 CA公钥指数:CA_E= 03 发卡行公钥证书 [90]: CA_I= A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 使用CA公钥对发卡行公钥证书解密后:&nbsp; 终端恢复发卡行公钥 CA_O = DERSA（CA公钥，CA公钥指数，发卡行公钥证书） 软件中 E是公钥指数（65537或03） N是模 D是私钥指数 CA_O=6A 02820785FF12300030220101B001BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440FBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB &nbsp; 97D3B68E372323FF1B487D800D7AABA14D0CEDA3BC 发卡行公钥余项 [92]:不存在 发卡行公钥指数 [9F32]: 03 计算哈希值输入数据:&nbsp; // 组织摘要输入信息 + 发卡行公钥余项 ( 如果有 ) + 发卡行公钥指数 &nbsp;// HashValueInfo = CA _ O . Mid (2, CA _ O . GetLength ()- 42 - 2) + TagValue [_ T (&quot;92&quot;)] + TagValue [_ T (&quot;9F32&quot;)]; // HashV = SHA 1( HashValueInfo ) 02820785FF12300030220101B001 BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F &nbsp; &nbsp; BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB03 终端计算哈希结果: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3 HashV = SHA1(计算哈希输入数据) 卡恢复哈希数据: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3 终端交易日期 [9A]: 150609 证书有效日期: 3012 -------恢复和验证IC卡公钥（P【8205】*Q【8204】）----- 发卡行公钥模:&nbsp; 发卡行公钥模 = 发卡行公钥的最左边字节 + 发卡行公钥的余项（如果有） _ CA _ N = CA _ O . Mid (30, CA _ N . GetLength () - 72) + TagValue [_ T (&quot;92&quot;)]; BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F ICC公钥证书 [9F46]: IC_I= 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 使用发卡行公钥对ICC公钥证书解密后:&nbsp; /恢复 IC 卡公钥证书 ( 唯一 ) IC _ O = DeRSA (_ CA _ N , IC _ E , IC _ I ) IC _ O = 6A 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB285D71F611B4D473150EFB22B49044A87E99904ABC ICC公钥余项 [9F48]:不存在 ICC公钥指数: 03 BB = (&#39; B &#39;, CA _ N . GetLength () - 52); HashValueInfo = IC _ O . Mid (2, IC _ O . GetLength () -42 - 2) + TagValue [9 F 48] + IC _ E + SDA _ Value HashV = SHA 1( HashValueInfo ); 计算哈希的输入数据: 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB035F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 终端计算哈希结果: 285D71F611B4D473150EFB22B49044A87E99904A HashV = SHA1(计算哈希输入数据) 卡恢复哈希数据: 285D71F611B4D473150EFB22B49044A87E99904A 证书有效日期: 3012 ----------------------动态签名应用数据的生成---------------------------- ICC公钥模: _ IC _ N ( IC 卡公钥 P * Q ) = IC_O . Mid (42, nIssuer _ n _ Len - 84) + TagValue [9F48] nIssuer _ n _ Len =发卡行公钥模的长度 _ IC_N= C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27 内部认证， + DDOL [9 F49]( 由终端生成的不可预知数 ,9F37,4 个字节的二进制数） ---&gt; 0088000004 5BC15BC1 &lt;--- [6183] ---&gt; 00C0000083&nbsp; &lt;--- 808180 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547[9000] 动态签名结果 [9F4B]: IC_I= 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547 ICC公钥指数 [9F47]: 03 使用ICC公钥对动态签名结果解密后:&nbsp; 恢复 IC 卡签名动态数据 _ IC _ O = DeRSA (_ IC _ N , IC _ E , _ IC _ I ); _IC_O= 6A 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBA7CB3EDB482D95AF74D3FF9156F93CE2E89B2033BC 计算哈希值输入数据:&nbsp; HashValueInfo = _ IC _ O . Mid (2, _ IC _ O . GetLength () -22 * 2) + TagValue [9F37]; HashV = SHA 1( HashValueInfo );&nbsp; 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB5BC15BC1 卡恢复哈希值: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033 终端计算哈希结果: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033 动态数据认证DDA成功 ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理结束 ********************************* ********************************* 处理限制 ********************************* 卡应用版本号: 0030----PBOC3.0 终端应用版本号: 008C 应用版本号不一致 应用用途控制检查 处理限制结果可参考TVR,TSI的树示意图 ********************************* 处理限制结束 ********************************* ********************************* 持卡人认证 ********************************* CVM 代码 02----如果此CVM失败,则持卡人验证失败.联机加密PIN验证 CVM 条件代码 03---如果终端支持这个CVM 持卡人认证--联机PIN验证 持卡人认证--联机PIN输入完毕 ********************************* 持卡人认证结束 ********************************* ********************************* 终端风险管理 ********************************* 主帐号 [5A]: 8207853600005183859F 交易金额 [9F02]: 000000000100 终端最低交易限额 [9F1B]: 0000FFFF 偏置随机选择的最大目标百分比: 50 随机选择的目标百分比: 20 偏置随机选择的阈值: 40 随机数小于或等于交易百分比,终端随机交易选择联机 连续脱机交易下限 [9F14]: 00 连续脱机交易上限 [9F23]: 00 ---&gt; 80CA9F1300&nbsp; &lt;--- [6C05] ---&gt; 80CA9F1305&nbsp; &lt;--- 9F13020000[9000] ---&gt; 80CA9F3600&nbsp; &lt;--- [6C05] ---&gt; 80CA9F3605&nbsp; &lt;--- 9F36020001[9000] 此次ATC寄存器值 [9F36]: 0001 上次联机ATC寄存器值 [9F13]: 0000 超过连续脱机交易次数下限 超过连续脱机交易次数上限 新卡检查 ---&gt; 80CA9F1300&nbsp; &lt;--- [6C05] ---&gt; 80CA9F1305&nbsp; &lt;--- 9F13020000[9000] 上次联机ATC寄存器值: 0000 //0000为初始值,TVR值置为1 新卡 ********************************* 终端风险管理结束 ********************************* ********************************* 终端行为分析 ********************************* 终端交易属性TTQ [9F66]: B6000000 终端验证结果TVR [95]: 00a8047000 IAC-拒绝 [9F0E]: 0010980000 TAC-拒绝: 0000000000 终端具有联机能力 IAC-联机 [9F0F]: D86804F800 TAC-联机: 0000000000 有TVR和IAC-联机或TAC-联机的任何对应位同时为&#39;1&#39;,联机(ARQC) ********************************* 终端行为分析结束 ********************************* ********************************* 卡片行为分析 ********************************* ------------------------应用密文产生--------------- 卡片风险管理数据对象列表1 CDOL1 [8C]: 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 AC _ I = TagToValue ( TagValue [_ T (&quot;8 C &quot;)]); 8C =9F0206(授权金额)+9F0306( 其它金额)+9F1A02( 终端国家代码)+9505( 终端验证结果)+5F2A02(交易货币代码)+9A03(交易日期)+9C01( 交易类型)+9 F3704(不可预知数)+9F2103(交易时间)+9F4E14(商户名称 ) AC_I= &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674 // 生成应用密文（GENERATE APPLICATION CRYPTOGRAM（AC））：传送交易相关数据到 IC 卡，IC 卡计算并且返回一个密文。 // P 1 ： 80( ARQC ), 授权请求密文 ( Authorization Request Cryptogram ) 为联机请求 // 40( TC ), 交易证书 ( Transaction Certificate ) 为核准 // 00( AAC ), 应用认证密文 ( Application Authentication Cryptogram ) 为拒绝 // 一次交易卡片最多处理两个生成应用密文命令，如果收到三个及以上个数，卡片返回 “6985 ” // 如果在第 1 个 GENEARATE AC 命令中 IC 卡返回 TC 或 AAC，则交易脱机授权批准或拒绝 ---&gt; 80AE800034 &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674 &lt;--- [6120] ---&gt; 00C0000020&nbsp; // 密文信息数据 + 应用交易计数器 ( ATC , 0001)+ 应用密文 ( AC , F8A82BB1573B653E即ARQC &nbsp;)+ 发卡行应用数据 (0 X 01+9F79低5字节 + MAC ) &lt;--- 801E &nbsp;80 &nbsp;0001 &nbsp;F8A82BB1573B653E &nbsp;07020103A03002010A010000000000 &nbsp;AA30A471 [9000] 卡片风险管理巳执行 ********************************* 卡片行为分析结束 ********************************* -----------------------------------------------发卡行认证------------------------------------------------------- ********************************* 联机处理或脱机批准或拒绝检查 ********************************* 联机授权 发送联机请求数据至发卡行...... 发送报文数据 : 5A0A8207853600005183859F5F3401019F3901059F2608F8A82BB1573B653E9F02060000000001009F03060000000000009F1A020156950500A80470005F2A0201569A031506099C01009F37045BC15BC182027C009F360200019F101307020103A03002010A010000000000AA30A471 // 模拟后台计算 ARPC 授权响应密文 ( Authorization Response Cryptogram ) // ARC = 3030+000000000000 // 授权响应代码 ( ARC ), 定义发卡行对交易联机授权的结果 授权响应码为 00 ， 10 或 11 表明发卡行接受交易； 授权响应码为 01 或 02 表明发卡行请求参考； 其它值表明发卡行拒绝，卡片按照终端请求交易拒绝进行处理。 // 脱机批准 Y 1; 脱机拒绝 Z 1; 无法联机，脱机被批准 Y 3; 无法联机，脱机被拒绝 Z 3 // ValueA = Xor ( ARC , ARQC ) // 借记贷记联机验证密钥 UDK (8000. Left (32)) UDK _ AC =2F3D201558865D02A1497F04F820924C ATC _ = 000000000000+0001+000000000000+ FFFE // 离散因子 // DoDes ( ECB , ENCRYPT , ATC _, UDK _ AC, SKAC );// 计算过程密钥 // DoDes ( ECB , ENCRYPT , ValueA , SKAC , ARPC );// 授权响应密文 ARPC 发卡行响应数据成功,CUP8583报文55域数据: 910A1EBAD851FC4229B53030 发卡行认证主机响应数据 ARPC 91: 1EBAD851FC4229B53030 ---&gt; 008200000a 1EBAD851FC4229B53030 &lt;--- [9000] 发卡行认证---外部认证成功 联机授权完成 ********************************* 联机处理或脱机批准或拒绝检查结束 ********************************* ********************************* 完成交易处理 ********************************* 终端验证结果TVR [95]: 00a8047000 IAC-缺省 [9F0D]: D86004A800 TAC-缺省: 0000000000 发卡行认证主机响应数据: 1EBAD851FC4229B53030 发卡行认证主机响应授权响应码 ARC: 3030 授权批准:TC 卡片风险管理数据对象列表2 CDOL2 [8D]: 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 CDOL2 数据元 3030000000000100000000000000015600a80470000156150609005BC15BC1160417 ---&gt; 80AE400022 3030000000000100000000000000015600a80470000156150609005BC15BC1160417 &lt;--- [6120] ---&gt; 00C0000020&nbsp; &lt;--- 801E4000017C642EE203F388FC07020103603002010A010000000000AA30A471[9000] CDI_1 [9F27_1]: 40 ********************************* 完成交易处理结束 ********************************* 交易成功 卡片交易数据: [57] 8207853600005183859D29112201000087700F [5A] 8207853600005183859F [5F20] 2020202020202020202020202020202020202020202020202020 [5F24] 291130 [5F25] 260425 [5F28] 0156 [5F30] 0220 [5F34] 01 [82] 7C00 [8A] 3030 [8C] 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 [8D] 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 [8E] 000000000000000002031F00 [8F] 0B [90] A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 [91] 1EBAD851FC4229B53030 [93] 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D [94] 080102001001050118010100 [9F07] FF00 [9F08] 0030 [9F0D] D86004A800 [9F0E] 0010980000 [9F0F] D86804F800 [9F10] 07020103603002010A010000000000AA30A471 [9F13] 0000 [9F14] 00 [9F1F] 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020 [9F23] 00 [9F26] F8A82BB1573B653E [9F26_1] 7C642EE203F388FC [9F27] 80 [9F27_1] 40 [9F32] 03 [9F34] 020302 [9F36] 0001 [9F36_1] 0001 [9F38] 9F7A019F02065F2A02 [9F46] 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 [9F47] 03 [9F49] 9F3704 [9F4A] 82 [9F4B] 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547 [9F4C] 0001 [9F4D] 0B0A [9F61] 202020202020202020202020202020202020202020202020 [9F62] 00 [9F63] 30313034373930300000000000006000 [CVR] 03603002 [DF61] 0C0A [OnLinePin] 1111 [Static_Data_To_Authentiocate] 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 阅读更多 登录后自动展开" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1.基本测试环境 读卡器：SDI011 密钥： ;3DES算法主密钥,应用密文计算 MdkAc_3DES=2F3D201558865D02A1497F04F820924C ;3DES算法主密钥,MAC计算 MdkMac_3DES=3B0D4AE6EFEA20FB8F5E510264089D5D ;3DES算法主密钥,敏感数据加密计算 MdkDek_3DES=9EB33751912CC792750E0E19A7896BFE 2.借贷记（所有数据均为模拟测试数据，与任何银行和金融机构均没有对应实际业务关系）出于对安全考虑，数据做过修改，请只参考流程和指令即可。 数据初始化成功 -------------------------------------------1 选择应用--------------------------------------------- 交易开始 ********************************* 选择交易应用 ********************************* ATR: 3B6D000000960755DD8648410100000001 ---&gt; 00A404000E 315041592E5359532E4444463031 &lt;--- [6120] ---&gt; 00C0000020&nbsp; &lt;--- 6F1E840E 315041592E5359532E4444463031 &nbsp;A50C8801015F2D027A689F110101[9000] 1PAY.SYS.DDF01 ---&gt; 00B2010C00&nbsp; &lt;--- [6C2A] ---&gt; 00B2010C2A&nbsp; &lt;--- 70286126 4F08A000000333010101 500A50424F43204445424954 870101 &nbsp; 9F120AD5D0D0D0D2BBBFA8CDA8 [9000] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 应用AID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PBOC DEBIT（每款产品不同） &nbsp; &nbsp; &nbsp; 招行一卡通（每款产品不同） ---&gt; 00B2020C00&nbsp; &lt;--- [6A83] 建立交易应用列表成功 ---&gt; 00A4040008 A000000333010101 &lt;--- [614C] ---&gt; 00C000004C&nbsp; &lt;--- 6F4A8408 A000000333010101 A53E500A50424F432044454249548701019F38099F7A019F02065F2A025F2D027A689F1101019F120A50424F43204445424954BF0C0A 9F4D020B0A DF4D020C0A[9000] ********************************* 选择交易应用结束 ********************************* -------------------------------------------------------2 应用初始化--------------------------------------------------------------------- ********************************* 初始化应用 ********************************* &nbsp;//获取处理选项GPO：用来启动 IC 卡内的交易 &nbsp;//根据9F38(PDOL)的值 , 来拼装数据 , 如下： &nbsp;//9F7A01：电子现金终端支持指示器 ,00( 不支持电子现金处理 ) &nbsp;//9F0206：授权金额 ,000000000001 &nbsp;//5F2A02：货币代码 ,0156 ---&gt; 80A800000B 8309 000000000001 00 0156 &lt;--- [6110] ---&gt; 00C0000010&nbsp; &nbsp;//GPO 返回： 80( Tag，接触 )+ 应用交互特征 ( AIP )+ 应用文件定位器 ( AFL ) //7C ( SDA + DDA + 支持持卡人认证 + 支持终端风险管理 + 支持发卡行认证 )+00 &nbsp;//根据 GPO 返回的 AFL，从卡中读取数据 &lt;--- 800E 7C00 080102001001050118010100[9000] //08-01 10-02 18-03 20-04 28-05 30-06 发送GPO指令成功 ********************************* 初始化应用结束 ********************************* --------------------------------------------------------3 读应用数据-------------------------------------------------------------------- ********************************* 读取应用数据 ********************************* Read Record : SFI = 1,RecordNum = 1 ---&gt; 00B2010C00&nbsp; &lt;--- [6C6A] ---&gt; 00B2010C6A&nbsp; &lt;--- 706857138207853600005183859D29112201000087700F9F1F502020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020[9000] [57] 13 8207853600005183859D29112201000087700F [9F1F] 50 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020 Read Record : SFI = 1,RecordNum = 2 ---&gt; 00B2020C00&nbsp; &lt;--- [6C3E] ---&gt; 00B2020C3E&nbsp; &lt;--- 703C9F61182020202020202020202020202020202020202020202020209F6201005F201A2020202020202020202020202020202020202020202020202020[9000] [9F61] 18 202020202020202020202020202020202020202020202020 [9F62] 01 00 [5F20] 1A 2020202020202020202020202020202020202020202020202020 Read Record : SFI = 2,RecordNum = 1 ---&gt; 00B2011400&nbsp; &lt;--- [6C89] ---&gt; 00B2011489&nbsp; &lt;--- 7081865F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103[9000] [5F24] 03 291130 [5F25] 03 260425 [5A] 0A 8207853600005183859F [9F07] 02 FF00 [9F08] 02 0030 [5F28] 02 0156 [8E] 0C 000000000000000002031F00 [9F0D] 05 D86004A800 [9F0E] 05 0010980000 [9F0F] 05 D86804F800 [8C] 1B 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 [8D] 1A 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 Read Record : SFI = 2,RecordNum = 2 ---&gt; 00B2021400&nbsp; &lt;--- [6CBB] ---&gt; 00B20214BB&nbsp; &lt;--- 7081B89F4681B09456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA555649F470103[9000] [9F46] B0 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 [9F47] 01 03 Read Record : SFI = 2,RecordNum = 3 ---&gt; 00B2031400&nbsp; &lt;--- [6CCD] ---&gt; 00B20314CD&nbsp; &lt;--- 7081CA9381B02D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D9F4A01829F631030313034373930300000000000006000[9000] [93] B0 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D [9F4A] 01 82 [9F63] 10 30313034373930300000000000006000 Read Record : SFI = 2,RecordNum = 4 ---&gt; 00B2041400&nbsp; &lt;--- [6C19] ---&gt; 00B2041419&nbsp; &lt;--- 70175F300202209F49039F37045F3401019F1401009F230100[9000] [5F30] 02 0220 [9F49] 03 9F3704 [5F34] 01 01 [9F14] 01 00 [9F23] 01 00 Read Record : SFI = 2,RecordNum = 5 ---&gt; 00B2051400&nbsp; &lt;--- [6C09] ---&gt; 00B2051409&nbsp; &lt;--- 70079F3201038F010B[9000] [9F32] 01 03 [8F] 01 0B Read Record : SFI = 3,RecordNum = 1 ---&gt; 00B2011C00&nbsp; &lt;--- [6CFE] ---&gt; 00B2011CFE&nbsp; &lt;--- 7081FB9081F8A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472[9000] [90] F8 A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 // 静态认证数据列表 = DGI 0201 + TagValue [&quot;82&quot;] 静态认证的应用数据 SDA_Value= 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 + 7C00 ********************************* 读取应用数据结束 ********************************* ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理 ********************************* -----------------------------------------------------------4 静态数据认证-------------------------------------------------------------------- ---------4.1恢复发卡行公钥-------------- 脱机数据认证-终端使用RSA/SHA-1/3DES算法 动态数据认证,DDA CA公钥RID: A000000333 标识银联RID CA公钥PKI [8F]: 0B &nbsp; &nbsp; CA公钥索引 CA公钥模: CA_N= CF9FDF46B356378E9AF311B0F981B21A1F22F250FB11F55C958709E3C7241918293483289EAE688A094C02C344E2999F315A72841F489E24B1BA0056CFAB3B479D0E826452375DCDBB67E97EC2AA66F4601D774FEAEF775ACCC621BFEB65FB0053FC5F392AA5E1D4C41A4DE9FFDFDF1327C4BB874F1F63A599EE3902FE95E729FD78D4234DC7E6CF1ABABAA3F6DB29B7F05D1D901D2E76A606A8CBFFFFECBD918FA2D278BDB43B0434F5D45134BE1C2781D157D501FF43E5F1C470967CD57CE53B64D82974C8275937C5D8502A1252A8A5D6088A259B694F98648D9AF2CB0EFD9D943C69F896D49FA39702162ACB5AF29B90BADE005BC157 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA公钥值，此值在终端进行配置，非卡片中数据 CA公钥指数:CA_E= 03 发卡行公钥证书 [90]: CA_I= A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 使用CA公钥对发卡行公钥证书解密后:&nbsp; 终端恢复发卡行公钥 CA_O = DERSA（CA公钥，CA公钥指数，发卡行公钥证书） 软件中 E是公钥指数（65537或03） N是模 D是私钥指数 CA_O=6A 02820785FF12300030220101B001BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440FBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB &nbsp; 97D3B68E372323FF1B487D800D7AABA14D0CEDA3BC 发卡行公钥余项 [92]:不存在 发卡行公钥指数 [9F32]: 03 计算哈希值输入数据:&nbsp; // 组织摘要输入信息 + 发卡行公钥余项 ( 如果有 ) + 发卡行公钥指数 &nbsp;// HashValueInfo = CA _ O . Mid (2, CA _ O . GetLength ()- 42 - 2) + TagValue [_ T (&quot;92&quot;)] + TagValue [_ T (&quot;9F32&quot;)]; // HashV = SHA 1( HashValueInfo ) 02820785FF12300030220101B001 BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F &nbsp; &nbsp; BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB03 终端计算哈希结果: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3 HashV = SHA1(计算哈希输入数据) 卡恢复哈希数据: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3 终端交易日期 [9A]: 150609 证书有效日期: 3012 -------恢复和验证IC卡公钥（P【8205】*Q【8204】）----- 发卡行公钥模:&nbsp; 发卡行公钥模 = 发卡行公钥的最左边字节 + 发卡行公钥的余项（如果有） _ CA _ N = CA _ O . Mid (30, CA _ N . GetLength () - 72) + TagValue [_ T (&quot;92&quot;)]; BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F ICC公钥证书 [9F46]: IC_I= 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 使用发卡行公钥对ICC公钥证书解密后:&nbsp; /恢复 IC 卡公钥证书 ( 唯一 ) IC _ O = DeRSA (_ CA _ N , IC _ E , IC _ I ) IC _ O = 6A 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB285D71F611B4D473150EFB22B49044A87E99904ABC ICC公钥余项 [9F48]:不存在 ICC公钥指数: 03 BB = (&#39; B &#39;, CA _ N . GetLength () - 52); HashValueInfo = IC _ O . Mid (2, IC _ O . GetLength () -42 - 2) + TagValue [9 F 48] + IC _ E + SDA _ Value HashV = SHA 1( HashValueInfo ); 计算哈希的输入数据: 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB035F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 终端计算哈希结果: 285D71F611B4D473150EFB22B49044A87E99904A HashV = SHA1(计算哈希输入数据) 卡恢复哈希数据: 285D71F611B4D473150EFB22B49044A87E99904A 证书有效日期: 3012 ----------------------动态签名应用数据的生成---------------------------- ICC公钥模: _ IC _ N ( IC 卡公钥 P * Q ) = IC_O . Mid (42, nIssuer _ n _ Len - 84) + TagValue [9F48] nIssuer _ n _ Len =发卡行公钥模的长度 _ IC_N= C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27 内部认证， + DDOL [9 F49]( 由终端生成的不可预知数 ,9F37,4 个字节的二进制数） ---&gt; 0088000004 5BC15BC1 &lt;--- [6183] ---&gt; 00C0000083&nbsp; &lt;--- 808180 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547[9000] 动态签名结果 [9F4B]: IC_I= 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547 ICC公钥指数 [9F47]: 03 使用ICC公钥对动态签名结果解密后:&nbsp; 恢复 IC 卡签名动态数据 _ IC _ O = DeRSA (_ IC _ N , IC _ E , _ IC _ I ); _IC_O= 6A 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBA7CB3EDB482D95AF74D3FF9156F93CE2E89B2033BC 计算哈希值输入数据:&nbsp; HashValueInfo = _ IC _ O . Mid (2, _ IC _ O . GetLength () -22 * 2) + TagValue [9F37]; HashV = SHA 1( HashValueInfo );&nbsp; 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB5BC15BC1 卡恢复哈希值: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033 终端计算哈希结果: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033 动态数据认证DDA成功 ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理结束 ********************************* ********************************* 处理限制 ********************************* 卡应用版本号: 0030----PBOC3.0 终端应用版本号: 008C 应用版本号不一致 应用用途控制检查 处理限制结果可参考TVR,TSI的树示意图 ********************************* 处理限制结束 ********************************* ********************************* 持卡人认证 ********************************* CVM 代码 02----如果此CVM失败,则持卡人验证失败.联机加密PIN验证 CVM 条件代码 03---如果终端支持这个CVM 持卡人认证--联机PIN验证 持卡人认证--联机PIN输入完毕 ********************************* 持卡人认证结束 ********************************* ********************************* 终端风险管理 ********************************* 主帐号 [5A]: 8207853600005183859F 交易金额 [9F02]: 000000000100 终端最低交易限额 [9F1B]: 0000FFFF 偏置随机选择的最大目标百分比: 50 随机选择的目标百分比: 20 偏置随机选择的阈值: 40 随机数小于或等于交易百分比,终端随机交易选择联机 连续脱机交易下限 [9F14]: 00 连续脱机交易上限 [9F23]: 00 ---&gt; 80CA9F1300&nbsp; &lt;--- [6C05] ---&gt; 80CA9F1305&nbsp; &lt;--- 9F13020000[9000] ---&gt; 80CA9F3600&nbsp; &lt;--- [6C05] ---&gt; 80CA9F3605&nbsp; &lt;--- 9F36020001[9000] 此次ATC寄存器值 [9F36]: 0001 上次联机ATC寄存器值 [9F13]: 0000 超过连续脱机交易次数下限 超过连续脱机交易次数上限 新卡检查 ---&gt; 80CA9F1300&nbsp; &lt;--- [6C05] ---&gt; 80CA9F1305&nbsp; &lt;--- 9F13020000[9000] 上次联机ATC寄存器值: 0000 //0000为初始值,TVR值置为1 新卡 ********************************* 终端风险管理结束 ********************************* ********************************* 终端行为分析 ********************************* 终端交易属性TTQ [9F66]: B6000000 终端验证结果TVR [95]: 00a8047000 IAC-拒绝 [9F0E]: 0010980000 TAC-拒绝: 0000000000 终端具有联机能力 IAC-联机 [9F0F]: D86804F800 TAC-联机: 0000000000 有TVR和IAC-联机或TAC-联机的任何对应位同时为&#39;1&#39;,联机(ARQC) ********************************* 终端行为分析结束 ********************************* ********************************* 卡片行为分析 ********************************* ------------------------应用密文产生--------------- 卡片风险管理数据对象列表1 CDOL1 [8C]: 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 AC _ I = TagToValue ( TagValue [_ T (&quot;8 C &quot;)]); 8C =9F0206(授权金额)+9F0306( 其它金额)+9F1A02( 终端国家代码)+9505( 终端验证结果)+5F2A02(交易货币代码)+9A03(交易日期)+9C01( 交易类型)+9 F3704(不可预知数)+9F2103(交易时间)+9F4E14(商户名称 ) AC_I= &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674 // 生成应用密文（GENERATE APPLICATION CRYPTOGRAM（AC））：传送交易相关数据到 IC 卡，IC 卡计算并且返回一个密文。 // P 1 ： 80( ARQC ), 授权请求密文 ( Authorization Request Cryptogram ) 为联机请求 // 40( TC ), 交易证书 ( Transaction Certificate ) 为核准 // 00( AAC ), 应用认证密文 ( Application Authentication Cryptogram ) 为拒绝 // 一次交易卡片最多处理两个生成应用密文命令，如果收到三个及以上个数，卡片返回 “6985 ” // 如果在第 1 个 GENEARATE AC 命令中 IC 卡返回 TC 或 AAC，则交易脱机授权批准或拒绝 ---&gt; 80AE800034 &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674 &lt;--- [6120] ---&gt; 00C0000020&nbsp; // 密文信息数据 + 应用交易计数器 ( ATC , 0001)+ 应用密文 ( AC , F8A82BB1573B653E即ARQC &nbsp;)+ 发卡行应用数据 (0 X 01+9F79低5字节 + MAC ) &lt;--- 801E &nbsp;80 &nbsp;0001 &nbsp;F8A82BB1573B653E &nbsp;07020103A03002010A010000000000 &nbsp;AA30A471 [9000] 卡片风险管理巳执行 ********************************* 卡片行为分析结束 ********************************* -----------------------------------------------发卡行认证------------------------------------------------------- ********************************* 联机处理或脱机批准或拒绝检查 ********************************* 联机授权 发送联机请求数据至发卡行...... 发送报文数据 : 5A0A8207853600005183859F5F3401019F3901059F2608F8A82BB1573B653E9F02060000000001009F03060000000000009F1A020156950500A80470005F2A0201569A031506099C01009F37045BC15BC182027C009F360200019F101307020103A03002010A010000000000AA30A471 // 模拟后台计算 ARPC 授权响应密文 ( Authorization Response Cryptogram ) // ARC = 3030+000000000000 // 授权响应代码 ( ARC ), 定义发卡行对交易联机授权的结果 授权响应码为 00 ， 10 或 11 表明发卡行接受交易； 授权响应码为 01 或 02 表明发卡行请求参考； 其它值表明发卡行拒绝，卡片按照终端请求交易拒绝进行处理。 // 脱机批准 Y 1; 脱机拒绝 Z 1; 无法联机，脱机被批准 Y 3; 无法联机，脱机被拒绝 Z 3 // ValueA = Xor ( ARC , ARQC ) // 借记贷记联机验证密钥 UDK (8000. Left (32)) UDK _ AC =2F3D201558865D02A1497F04F820924C ATC _ = 000000000000+0001+000000000000+ FFFE // 离散因子 // DoDes ( ECB , ENCRYPT , ATC _, UDK _ AC, SKAC );// 计算过程密钥 // DoDes ( ECB , ENCRYPT , ValueA , SKAC , ARPC );// 授权响应密文 ARPC 发卡行响应数据成功,CUP8583报文55域数据: 910A1EBAD851FC4229B53030 发卡行认证主机响应数据 ARPC 91: 1EBAD851FC4229B53030 ---&gt; 008200000a 1EBAD851FC4229B53030 &lt;--- [9000] 发卡行认证---外部认证成功 联机授权完成 ********************************* 联机处理或脱机批准或拒绝检查结束 ********************************* ********************************* 完成交易处理 ********************************* 终端验证结果TVR [95]: 00a8047000 IAC-缺省 [9F0D]: D86004A800 TAC-缺省: 0000000000 发卡行认证主机响应数据: 1EBAD851FC4229B53030 发卡行认证主机响应授权响应码 ARC: 3030 授权批准:TC 卡片风险管理数据对象列表2 CDOL2 [8D]: 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 CDOL2 数据元 3030000000000100000000000000015600a80470000156150609005BC15BC1160417 ---&gt; 80AE400022 3030000000000100000000000000015600a80470000156150609005BC15BC1160417 &lt;--- [6120] ---&gt; 00C0000020&nbsp; &lt;--- 801E4000017C642EE203F388FC07020103603002010A010000000000AA30A471[9000] CDI_1 [9F27_1]: 40 ********************************* 完成交易处理结束 ********************************* 交易成功 卡片交易数据: [57] 8207853600005183859D29112201000087700F [5A] 8207853600005183859F [5F20] 2020202020202020202020202020202020202020202020202020 [5F24] 291130 [5F25] 260425 [5F28] 0156 [5F30] 0220 [5F34] 01 [82] 7C00 [8A] 3030 [8C] 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14 [8D] 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 [8E] 000000000000000002031F00 [8F] 0B [90] A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472 [91] 1EBAD851FC4229B53030 [93] 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D [94] 080102001001050118010100 [9F07] FF00 [9F08] 0030 [9F0D] D86004A800 [9F0E] 0010980000 [9F0F] D86804F800 [9F10] 07020103603002010A010000000000AA30A471 [9F13] 0000 [9F14] 00 [9F1F] 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020 [9F23] 00 [9F26] F8A82BB1573B653E [9F26_1] 7C642EE203F388FC [9F27] 80 [9F27_1] 40 [9F32] 03 [9F34] 020302 [9F36] 0001 [9F36_1] 0001 [9F38] 9F7A019F02065F2A02 [9F46] 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564 [9F47] 03 [9F49] 9F3704 [9F4A] 82 [9F4B] 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547 [9F4C] 0001 [9F4D] 0B0A [9F61] 202020202020202020202020202020202020202020202020 [9F62] 00 [9F63] 30313034373930300000000000006000 [CVR] 03603002 [DF61] 0C0A [OnLinePin] 1111 [Static_Data_To_Authentiocate] 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 阅读更多 登录后自动展开","@type":"BlogPosting","url":"/2018/08/29/11bd81ffb2df48e8a3ccdf813e19bf42.html","headline":"一张金融IC卡的交易流程（二）—–基本测试环境及借贷记交易流程","dateModified":"2018-08-29T00:00:00+08:00","datePublished":"2018-08-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/08/29/11bd81ffb2df48e8a3ccdf813e19bf42.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>一张金融IC卡的交易流程（二）-----基本测试环境及借贷记交易流程</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>1.<strong>基本测试环境</strong><br> 读卡器：SDI011<br> 密钥：<br> ;3DES算法主密钥,应用密文计算<br> MdkAc_3DES=2F3D201558865D02A1497F04F820924C</p> 
  <p>;3DES算法主密钥,MAC计算<br> MdkMac_3DES=3B0D4AE6EFEA20FB8F5E510264089D5D</p> 
  <p>;3DES算法主密钥,敏感数据加密计算<br> MdkDek_3DES=9EB33751912CC792750E0E19A7896BFE</p> 
  <p><br><strong>2.借贷记</strong><span style="color:#3399ea;">（所有数据均为模拟测试数据，与任何银行和金融机构均没有对应实际业务关系）出于对安全考虑，数据做过修改，请只参考流程和指令即可。</span></p> 
  <p>数据初始化成功<br> -------------------------------------------1 选择应用---------------------------------------------<br> 交易开始</p> 
  <p>********************************* 选择交易应用 *********************************</p> 
  <p>ATR: 3B6D000000960755DD8648410100000001<br> ---&gt; 00A404000E 315041592E5359532E4444463031<br> &lt;--- [6120]<br> ---&gt; 00C0000020&nbsp;<br> &lt;--- 6F1E840E 315041592E5359532E4444463031 &nbsp;A50C8801015F2D027A689F110101[9000]<br> 1PAY.SYS.DDF01<br> ---&gt; 00B2010C00&nbsp;<br> &lt;--- [6C2A]<br> ---&gt; 00B2010C2A&nbsp;<br> &lt;--- 70286126 4F08A000000333010101 500A50424F43204445424954 870101 &nbsp; 9F120AD5D0D0D0D2BBBFA8CDA8 [9000]<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 应用AID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PBOC DEBIT（每款产品不同） &nbsp; &nbsp; &nbsp; 招行一卡通（每款产品不同）<br> ---&gt; 00B2020C00&nbsp;<br> &lt;--- [6A83]</p> 
  <p>建立交易应用列表成功</p> 
  <p>---&gt; 00A4040008 A000000333010101<br> &lt;--- [614C]<br> ---&gt; 00C000004C&nbsp;<br> &lt;--- 6F4A8408 A000000333010101 A53E500A50424F432044454249548701019F38099F7A019F02065F2A025F2D027A689F1101019F120A50424F43204445424954BF0C0A 9F4D020B0A DF4D020C0A[9000]<br> ********************************* 选择交易应用结束 *********************************</p> 
  <p>-------------------------------------------------------2 应用初始化---------------------------------------------------------------------<br> ********************************* 初始化应用 *********************************<br> &nbsp;//获取处理选项GPO：用来启动 IC 卡内的交易<br> &nbsp;//根据9F38(PDOL)的值 , 来拼装数据 , 如下：<br> &nbsp;//9F7A01：电子现金终端支持指示器 ,00( 不支持电子现金处理 )<br> &nbsp;//9F0206：授权金额 ,000000000001<br> &nbsp;//5F2A02：货币代码 ,0156<br> ---&gt; 80A800000B 8309 000000000001 00 0156<br> &lt;--- [6110]<br> ---&gt; 00C0000010&nbsp;<br> &nbsp;//GPO 返回： 80( Tag，接触 )+ 应用交互特征 ( AIP )+ 应用文件定位器 ( AFL )<br> //7C ( SDA + DDA + 支持持卡人认证 + 支持终端风险管理 + 支持发卡行认证 )+00<br> &nbsp;//根据 GPO 返回的 AFL，从卡中读取数据<br> &lt;--- 800E 7C00 080102001001050118010100[9000]<br> //08-01 10-02 18-03 20-04 28-05 30-06<br> 发送GPO指令成功<br> ********************************* 初始化应用结束 *********************************</p> 
  <p>--------------------------------------------------------3 读应用数据--------------------------------------------------------------------<br> ********************************* 读取应用数据 *********************************</p> 
  <p>Read Record : SFI = 1,RecordNum = 1<br> ---&gt; 00B2010C00&nbsp;<br> &lt;--- [6C6A]<br> ---&gt; 00B2010C6A&nbsp;<br> &lt;--- 706857138207853600005183859D29112201000087700F9F1F502020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020[9000]<br> [57] 13 8207853600005183859D29112201000087700F<br> [9F1F] 50 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020<br> Read Record : SFI = 1,RecordNum = 2<br> ---&gt; 00B2020C00&nbsp;<br> &lt;--- [6C3E]<br> ---&gt; 00B2020C3E&nbsp;<br> &lt;--- 703C9F61182020202020202020202020202020202020202020202020209F6201005F201A2020202020202020202020202020202020202020202020202020[9000]<br> [9F61] 18 202020202020202020202020202020202020202020202020<br> [9F62] 01 00<br> [5F20] 1A 2020202020202020202020202020202020202020202020202020<br> Read Record : SFI = 2,RecordNum = 1<br> ---&gt; 00B2011400&nbsp;<br> &lt;--- [6C89]<br> ---&gt; 00B2011489&nbsp;<br> &lt;--- 7081865F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103[9000]<br> [5F24] 03 291130<br> [5F25] 03 260425<br> [5A] 0A 8207853600005183859F<br> [9F07] 02 FF00<br> [9F08] 02 0030<br> [5F28] 02 0156<br> [8E] 0C 000000000000000002031F00<br> [9F0D] 05 D86004A800<br> [9F0E] 05 0010980000<br> [9F0F] 05 D86804F800<br> [8C] 1B 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14<br> [8D] 1A 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103<br> Read Record : SFI = 2,RecordNum = 2<br> ---&gt; 00B2021400&nbsp;<br> &lt;--- [6CBB]<br> ---&gt; 00B20214BB&nbsp;<br> &lt;--- 7081B89F4681B09456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA555649F470103[9000]<br> [9F46] B0 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564<br> [9F47] 01 03<br> Read Record : SFI = 2,RecordNum = 3<br> ---&gt; 00B2031400&nbsp;<br> &lt;--- [6CCD]<br> ---&gt; 00B20314CD&nbsp;<br> &lt;--- 7081CA9381B02D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D9F4A01829F631030313034373930300000000000006000[9000]<br> [93] B0 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D<br> [9F4A] 01 82<br> [9F63] 10 30313034373930300000000000006000<br> Read Record : SFI = 2,RecordNum = 4<br> ---&gt; 00B2041400&nbsp;<br> &lt;--- [6C19]<br> ---&gt; 00B2041419&nbsp;<br> &lt;--- 70175F300202209F49039F37045F3401019F1401009F230100[9000]<br> [5F30] 02 0220<br> [9F49] 03 9F3704<br> [5F34] 01 01<br> [9F14] 01 00<br> [9F23] 01 00<br> Read Record : SFI = 2,RecordNum = 5<br> ---&gt; 00B2051400&nbsp;<br> &lt;--- [6C09]<br> ---&gt; 00B2051409&nbsp;<br> &lt;--- 70079F3201038F010B[9000]<br> [9F32] 01 03<br> [8F] 01 0B<br> Read Record : SFI = 3,RecordNum = 1<br> ---&gt; 00B2011C00&nbsp;<br> &lt;--- [6CFE]<br> ---&gt; 00B2011CFE&nbsp;<br> &lt;--- 7081FB9081F8A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472[9000]<br> [90] F8 A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472<br> // 静态认证数据列表 = DGI 0201 + TagValue ["82"]<br> 静态认证的应用数据 SDA_Value= 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 + 7C00<br> ********************************* 读取应用数据结束 *********************************</p> 
  <p>********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理 *********************************<br> -----------------------------------------------------------4 静态数据认证--------------------------------------------------------------------<br> ---------4.1恢复发卡行公钥--------------<br> 脱机数据认证-终端使用RSA/SHA-1/3DES算法<br> 动态数据认证,DDA<br> CA公钥RID: A000000333 标识银联RID<br> CA公钥PKI [8F]: 0B &nbsp; &nbsp; CA公钥索引<br> CA公钥模: CA_N= CF9FDF46B356378E9AF311B0F981B21A1F22F250FB11F55C958709E3C7241918293483289EAE688A094C02C344E2999F315A72841F489E24B1BA0056CFAB3B479D0E826452375DCDBB67E97EC2AA66F4601D774FEAEF775ACCC621BFEB65FB0053FC5F392AA5E1D4C41A4DE9FFDFDF1327C4BB874F1F63A599EE3902FE95E729FD78D4234DC7E6CF1ABABAA3F6DB29B7F05D1D901D2E76A606A8CBFFFFECBD918FA2D278BDB43B0434F5D45134BE1C2781D157D501FF43E5F1C470967CD57CE53B64D82974C8275937C5D8502A1252A8A5D6088A259B694F98648D9AF2CB0EFD9D943C69F896D49FA39702162ACB5AF29B90BADE005BC157 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA公钥值，此值在终端进行配置，非卡片中数据<br> CA公钥指数:CA_E= 03<br> 发卡行公钥证书 [90]: CA_I= A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472</p> 
  <p>使用CA公钥对发卡行公钥证书解密后:&nbsp;<br> 终端恢复发卡行公钥<br> CA_O = DERSA（CA公钥，CA公钥指数，发卡行公钥证书）<br> 软件中 E是公钥指数（65537或03） N是模 D是私钥指数</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018083009525879?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1bmh1YW5zaGVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><br> CA_O=6A 02820785FF12300030220101B001BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440FBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB &nbsp; 97D3B68E372323FF1B487D800D7AABA14D0CEDA3BC<br> 发卡行公钥余项 [92]:不存在<br> 发卡行公钥指数 [9F32]: 03<br> 计算哈希值输入数据:&nbsp;<br> // 组织摘要输入信息 + 发卡行公钥余项 ( 如果有 ) + 发卡行公钥指数<br> &nbsp;// HashValueInfo = CA _ O . Mid (2, CA _ O . GetLength ()- 42 - 2) + TagValue [_ T ("92")] + TagValue [_ T ("9F32")];<br> // HashV = SHA 1( HashValueInfo )<br> 02820785FF12300030220101B001 BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F &nbsp; &nbsp; BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB03<br> 终端计算哈希结果: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3<br> HashV = SHA1(计算哈希输入数据)</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180830095323666?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1bmh1YW5zaGVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>卡恢复哈希数据: 97D3B68E372323FF1B487D800D7AABA14D0CEDA3<br> 终端交易日期 [9A]: 150609<br> 证书有效日期: 3012<br> -------恢复和验证IC卡公钥（P【8205】*Q【8204】）-----<br> 发卡行公钥模:&nbsp;<br> 发卡行公钥模 = 发卡行公钥的最左边字节 + 发卡行公钥的余项（如果有）<br> _ CA _ N = CA _ O . Mid (30, CA _ N . GetLength () - 72) + TagValue [_ T ("92")];<br> BB6CCEABE9E67E1376C4867D741CF1BA1588F37F5DCCDDA72A9E22F800615C5D19B5EF6D92822F1EB74E9786F5CB004AF432C1CB020CFEC1FD5812E80754E0D897CC7C13B74C9D2AEEAADCBF6A61E858B051190542B9D79FDA364F3A5B7E1AFBFAD159055C1A2328970E476D6775E239FE5717550B470E2FC5D42AA5F02EBBA71EC3D01C91BB7C660FA225176CE85D0E16A96BA60904CF14C5AC31BAA90340195117C544F0AF70E75A468E523A00440F<br> ICC公钥证书 [9F46]: IC_I= 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564<br> 使用发卡行公钥对ICC公钥证书解密后:&nbsp;<br> /恢复 IC 卡公钥证书 ( 唯一 )<br> IC _ O = DeRSA (_ CA _ N , IC _ E , IC _ I )</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180830095348371?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1bmh1YW5zaGVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>IC _ O =<br> 6A 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB285D71F611B4D473150EFB22B49044A87E99904ABC<br> ICC公钥余项 [9F48]:不存在<br> ICC公钥指数: 03<br> BB = (' B ', CA _ N . GetLength () - 52);<br> HashValueInfo = IC _ O . Mid (2, IC _ O . GetLength () -42 - 2) + TagValue [9 F 48] + IC _ E + SDA _ Value<br> HashV = SHA 1( HashValueInfo );<br> 计算哈希的输入数据: 048207853600005183859F123004744501018001C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27BBBBBBBBBBBB035F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00<br> 终端计算哈希结果: 285D71F611B4D473150EFB22B49044A87E99904A<br> HashV = SHA1(计算哈希输入数据)</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180830095409406?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1bmh1YW5zaGVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>卡恢复哈希数据: 285D71F611B4D473150EFB22B49044A87E99904A<br> 证书有效日期: 3012<br> ----------------------动态签名应用数据的生成----------------------------<br> ICC公钥模:<br> _ IC _ N ( IC 卡公钥 P * Q ) = IC_O . Mid (42, nIssuer _ n _ Len - 84) + TagValue [9F48]<br> nIssuer _ n _ Len =发卡行公钥模的长度<br> _ IC_N= C821C3DD994D17E26FB2A817B2403BF2E279682E7003AEFEB6A5AA16911EEA3B511BC2068B0A4A103E6277359CD7B67A5E97E139EFECBAB3DDA69805562C88543DEE38825D3B994A00E52EAE005D44A426C9BA98066B3AB32FEE4A60ED89837289AA3ACB86E891CEC0C491F19D0F4369D39B7D5C7B893078A837702FC60E8B27<br> 内部认证， + DDOL [9 F49]( 由终端生成的不可预知数 ,9F37,4 个字节的二进制数）<br> ---&gt; 0088000004 5BC15BC1<br> &lt;--- [6183]<br> ---&gt; 00C0000083&nbsp;<br> &lt;--- 808180 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547[9000]<br> 动态签名结果 [9F4B]: IC_I= 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547<br> ICC公钥指数 [9F47]: 03<br> 使用ICC公钥对动态签名结果解密后:&nbsp;<br> 恢复 IC 卡签名动态数据<br> _ IC _ O = DeRSA (_ IC _ N , IC _ E , _ IC _ I );</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018083009543832?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1bmh1YW5zaGVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>_IC_O= 6A 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBA7CB3EDB482D95AF74D3FF9156F93CE2E89B2033BC<br> 计算哈希值输入数据:&nbsp;<br> HashValueInfo = _ IC _ O . Mid (2, _ IC _ O . GetLength () -22 * 2) + TagValue [9F37];<br> HashV = SHA 1( HashValueInfo );&nbsp;<br> 05012002000100A49ECD258E231BF253432363F261A8834743E63E10BC4BC7F79B4BAEBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB5BC15BC1</p> 
  <p>卡恢复哈希值: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180830095511945?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1bmh1YW5zaGVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>终端计算哈希结果: A7CB3EDB482D95AF74D3FF9156F93CE2E89B2033<br> 动态数据认证DDA成功<br> ********************************* 分析卡片返回的AIP及终端的9F33决定做脱机数据认证及联机处理结束 *********************************</p> 
  <p>********************************* 处理限制 *********************************</p> 
  <p>卡应用版本号: 0030----PBOC3.0<br> 终端应用版本号: 008C<br> 应用版本号不一致<br> 应用用途控制检查<br> 处理限制结果可参考TVR,TSI的树示意图</p> 
  <p>********************************* 处理限制结束 *********************************</p> 
  <p>********************************* 持卡人认证 *********************************<br> CVM 代码 02----如果此CVM失败,则持卡人验证失败.联机加密PIN验证<br> CVM 条件代码 03---如果终端支持这个CVM<br> 持卡人认证--联机PIN验证<br> 持卡人认证--联机PIN输入完毕<br> ********************************* 持卡人认证结束 *********************************</p> 
  <p>********************************* 终端风险管理 *********************************</p> 
  <p>主帐号 [5A]: 8207853600005183859F<br> 交易金额 [9F02]: 000000000100<br> 终端最低交易限额 [9F1B]: 0000FFFF<br> 偏置随机选择的最大目标百分比: 50<br> 随机选择的目标百分比: 20<br> 偏置随机选择的阈值: 40<br> 随机数小于或等于交易百分比,终端随机交易选择联机<br> 连续脱机交易下限 [9F14]: 00<br> 连续脱机交易上限 [9F23]: 00<br> ---&gt; 80CA9F1300&nbsp;<br> &lt;--- [6C05]<br> ---&gt; 80CA9F1305&nbsp;<br> &lt;--- 9F13020000[9000]<br> ---&gt; 80CA9F3600&nbsp;<br> &lt;--- [6C05]<br> ---&gt; 80CA9F3605&nbsp;<br> &lt;--- 9F36020001[9000]<br> 此次ATC寄存器值 [9F36]: 0001<br> 上次联机ATC寄存器值 [9F13]: 0000<br> 超过连续脱机交易次数下限<br> 超过连续脱机交易次数上限<br> 新卡检查<br> ---&gt; 80CA9F1300&nbsp;<br> &lt;--- [6C05]<br> ---&gt; 80CA9F1305&nbsp;<br> &lt;--- 9F13020000[9000]<br> 上次联机ATC寄存器值: 0000<br> //0000为初始值,TVR值置为1<br> 新卡<br> ********************************* 终端风险管理结束 *********************************</p> 
  <p>********************************* 终端行为分析 *********************************<br> 终端交易属性TTQ [9F66]: B6000000<br> 终端验证结果TVR [95]: 00a8047000<br> IAC-拒绝 [9F0E]: 0010980000<br> TAC-拒绝: 0000000000<br> 终端具有联机能力<br> IAC-联机 [9F0F]: D86804F800<br> TAC-联机: 0000000000<br> 有TVR和IAC-联机或TAC-联机的任何对应位同时为'1',联机(ARQC)</p> 
  <p>********************************* 终端行为分析结束 *********************************</p> 
  <p>********************************* 卡片行为分析 *********************************<br> ------------------------应用密文产生---------------<br> 卡片风险管理数据对象列表1 CDOL1 [8C]: 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14<br> AC _ I = TagToValue ( TagValue [_ T ("8 C ")]);<br> 8C =9F0206(授权金额)+9F0306( 其它金额)+9F1A02( 终端国家代码)+9505( 终端验证结果)+5F2A02(交易货币代码)+9A03(交易日期)+9C01( 交易类型)+9 F3704(不可预知数)+9F2103(交易时间)+9F4E14(商户名称 )<br> AC_I= &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674<br> // 生成应用密文（GENERATE APPLICATION CRYPTOGRAM（AC））：传送交易相关数据到 IC 卡，IC 卡计算并且返回一个密文。<br> // P 1 ： 80( ARQC ), 授权请求密文 ( Authorization Request Cryptogram ) 为联机请求<br> // 40( TC ), 交易证书 ( Transaction Certificate ) 为核准<br> // 00( AAC ), 应用认证密文 ( Application Authentication Cryptogram ) 为拒绝<br> // 一次交易卡片最多处理两个生成应用密文命令，如果收到三个及以上个数，卡片返回 “6985 ”<br> // 如果在第 1 个 GENEARATE AC 命令中 IC 卡返回 TC 或 AAC，则交易脱机授权批准或拒绝<br> ---&gt; 80AE800034 &nbsp;000000000100000000000000015600a80470000156150609005BC15BC11604175A686F755A68655F5A6F6E74696F6E5F536F6674<br> &lt;--- [6120]<br> ---&gt; 00C0000020&nbsp;<br> // 密文信息数据 + 应用交易计数器 ( ATC , 0001)+ 应用密文 ( AC , F8A82BB1573B653E即ARQC &nbsp;)+ 发卡行应用数据 (0 X 01+9F79低5字节 + MAC )<br> &lt;--- 801E &nbsp;80 &nbsp;0001 &nbsp;F8A82BB1573B653E &nbsp;07020103A03002010A010000000000 &nbsp;AA30A471 [9000]<br> 卡片风险管理巳执行<br> ********************************* 卡片行为分析结束 *********************************</p> 
  <p>-----------------------------------------------发卡行认证-------------------------------------------------------<br> ********************************* 联机处理或脱机批准或拒绝检查 *********************************<br> 联机授权<br> 发送联机请求数据至发卡行......<br> 发送报文数据 : 5A0A8207853600005183859F5F3401019F3901059F2608F8A82BB1573B653E9F02060000000001009F03060000000000009F1A020156950500A80470005F2A0201569A031506099C01009F37045BC15BC182027C009F360200019F101307020103A03002010A010000000000AA30A471<br> // 模拟后台计算 ARPC 授权响应密文 ( Authorization Response Cryptogram )<br> // ARC = 3030+000000000000 // 授权响应代码 ( ARC ), 定义发卡行对交易联机授权的结果<br> 授权响应码为 00 ， 10 或 11 表明发卡行接受交易；<br> 授权响应码为 01 或 02 表明发卡行请求参考；<br> 其它值表明发卡行拒绝，卡片按照终端请求交易拒绝进行处理。<br> // 脱机批准 Y 1; 脱机拒绝 Z 1; 无法联机，脱机被批准 Y 3; 无法联机，脱机被拒绝 Z 3<br> // ValueA = Xor ( ARC , ARQC )<br> // 借记贷记联机验证密钥 UDK (8000. Left (32))<br> UDK _ AC =2F3D201558865D02A1497F04F820924C<br> ATC _ = 000000000000+0001+000000000000+ FFFE // 离散因子<br> // DoDes ( ECB , ENCRYPT , ATC _, UDK _ AC, SKAC );// 计算过程密钥<br> // DoDes ( ECB , ENCRYPT , ValueA , SKAC , ARPC );// 授权响应密文 ARPC<br> 发卡行响应数据成功,CUP8583报文55域数据: 910A1EBAD851FC4229B53030<br> 发卡行认证主机响应数据<br> ARPC 91: 1EBAD851FC4229B53030<br> ---&gt; 008200000a 1EBAD851FC4229B53030<br> &lt;--- [9000]<br> 发卡行认证---外部认证成功<br> 联机授权完成<br> ********************************* 联机处理或脱机批准或拒绝检查结束 *********************************</p> 
  <p>********************************* 完成交易处理 *********************************<br> 终端验证结果TVR [95]: 00a8047000<br> IAC-缺省 [9F0D]: D86004A800<br> TAC-缺省: 0000000000<br> 发卡行认证主机响应数据: 1EBAD851FC4229B53030<br> 发卡行认证主机响应授权响应码 ARC: 3030<br> 授权批准:TC<br> 卡片风险管理数据对象列表2 CDOL2 [8D]: 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103<br> CDOL2 数据元 3030000000000100000000000000015600a80470000156150609005BC15BC1160417<br> ---&gt; 80AE400022 3030000000000100000000000000015600a80470000156150609005BC15BC1160417<br> &lt;--- [6120]<br> ---&gt; 00C0000020&nbsp;<br> &lt;--- 801E4000017C642EE203F388FC07020103603002010A010000000000AA30A471[9000]<br> CDI_1 [9F27_1]: 40<br> ********************************* 完成交易处理结束 *********************************<br> 交易成功</p> 
  <p>卡片交易数据:<br> [57] 8207853600005183859D29112201000087700F<br> [5A] 8207853600005183859F<br> [5F20] 2020202020202020202020202020202020202020202020202020<br> [5F24] 291130<br> [5F25] 260425<br> [5F28] 0156<br> [5F30] 0220<br> [5F34] 01<br> [82] 7C00<br> [8A] 3030<br> [8C] 9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E14<br> [8D] 8A029F02069F03069F1A0295055F2A029A039C019F37049F2103<br> [8E] 000000000000000002031F00<br> [8F] 0B<br> [90] A9D1D1D285BB6933C50AAC87B5744FA9ED1699B884BFB67490CD9B483FAEA8A1404B052153A3F7C0AB5894CA7804C41404EFD1A33B735B14AA6C65F91B37D22FF5FE64971BEBE8D596B1A08A0321999DC75675F8AE66A1DD301F307E932E0E7A9F197EB8B3E4B6EE5E17B180D3F95E03F078D685A0F1B6613464EFC35CA385C131875790B910AFBBF454099834F74D4082E34BE089D5318FC8BD0FD55520E0494AA1A95013ADBF30C03A6551EA34AF2B91AA5BBBA985889765DFFC3D773CBBD413CCAA8D013B45FAED2FF51237448A0A90AD00D94A2C63A26C0DC44F8C02C5BD962B4E868BF16E4AFDD1E05FE0F16ECD281E5C186CD59472<br> [91] 1EBAD851FC4229B53030<br> [93] 2D26373016ACABC9E3F017FFF7521A46C49FE666237312BC407FC1EC6DFFA6293D87620F36FAE7E7804BFF4FC32083A24461E5325EC6BADE087330C6DFF7786AE425AECBED3EB30A6189CD350BA7386360328A3AF81762E030D6985F2DFD50024CBBC89CEBAD05655ED7D35181C4BDC0E7BA83DFF8772974F844487EDE8A018223B882E9A109D25BDA679A3A23FAE2EB7A12FC609E59BBC478A7588369ADF992A6560761E8037B2D664396B45F2CA47D<br> [94] 080102001001050118010100<br> [9F07] FF00<br> [9F08] 0030<br> [9F0D] D86004A800<br> [9F0E] 0010980000<br> [9F0F] D86804F800<br> [9F10] 07020103603002010A010000000000AA30A471<br> [9F13] 0000<br> [9F14] 00<br> [9F1F] 2020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020<br> [9F23] 00<br> [9F26] F8A82BB1573B653E<br> [9F26_1] 7C642EE203F388FC<br> [9F27] 80<br> [9F27_1] 40<br> [9F32] 03<br> [9F34] 020302<br> [9F36] 0001<br> [9F36_1] 0001<br> [9F38] 9F7A019F02065F2A02<br> [9F46] 9456DED6E8B209CCFD0B1F60CAF6372623B63096200D72D73E1FCD7F93A68086E58AA291EB30DA3ABAAC0614352D207074485E67208CCB99DDE0E92F13B3D91F3724A61D6CE9A699773E22DFFD51462D8C17E7139D2316A7DB0EA6EA802A86C3FD2104632EF579FCAB9095732B46A3C944AF8031BAB0F1336927AB590207411ABE9E83FDBCC7169E461F429BE6EAD6DB22D3C3567D374A71911CEDFD6C910A414B36BDA9EBDB3F4EC9A054286CA55564<br> [9F47] 03<br> [9F49] 9F3704<br> [9F4A] 82<br> [9F4B] 896FB62F6F8D6F39566231BEBD94EAD54C58ECDD7012BF0E7CE90B20EBCCFB0BA00B957849856E1F02F8C7CFDEEBF52169D9732C33E58E80192CBF522815E3B3C7C3F289BEA71216B477C76FF6D8E9408085D0F97AA48569C69B47B102674F80AC48C50E866C77DE603D9A03B1EA2A02B372FF2E25E4DEE8FBDC648E5CF1A547<br> [9F4C] 0001<br> [9F4D] 0B0A<br> [9F61] 202020202020202020202020202020202020202020202020<br> [9F62] 00<br> [9F63] 30313034373930300000000000006000<br> [CVR] 03603002<br> [DF61] 0C0A<br> [OnLinePin] 1111</p> 
  <p>[Static_Data_To_Authentiocate] 5F24032911305F25032604255A0A8207853600005183859F9F0702FF009F080200305F280201568E0C000000000000000002031F009F0D05D86004A8009F0E0500109800009F0F05D86804F8008C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sunhuansheng/article/details/82182416,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sunhuansheng/article/details/82182416,&quot;}">阅读更多</a> 
 <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sunhuansheng/article/details/82182416,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sunhuansheng/article/details/82182416,&quot;}">登录后自动展开</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

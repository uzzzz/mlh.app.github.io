<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊gas、gaslimit、gasPrice说明 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊gas、gaslimit、gasPrice说明" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1. gas 以太坊在区块链上实现了一个运行环境，被称为以太坊虚拟机（EVM）。每个参与到网络的节点都会运行都会运行EVM作为区块验证协议的一部分。他们会验证区块中涵盖的每个交易并在EVM中运行交易所触发的代码。每个网络中的全节点都会进行相同的计算并储存相同的值。合约执行会在所有节点中被多次重复，这个事实得使得合约执行的消耗变得昂贵，所以这也促使大家将能在链下进行的运算都不放到区块链上进行。对于每个被执行的命令都会有一个特定的消耗，用单位gas计数。每个合约可以利用的命令都会有一个相应的gas值。gas使用ETH来支付。 2. gas和交易消耗的gas 每笔交易都被要求包括一个gas limit（有的时候被称为startGas）和一个交易愿为单位gas支付的费用。矿工可以有选择的打包这些交易并收取这些费用。在现实中，今天所有的交易最终都是由矿工选择的，但是用户所选择支付的交易费用多少会影响到该交易被打包所需等待的时长。如果该交易由于计算，包括原始消息和一些触发的其他消息，需要使用的gas数量小于或等于所设置的gas limit，那么这个交易会被处理。如果gas总消耗超过gas limit，那么所有的操作都会被复原，但交易是成立的并且交易费任会被矿工收取。区块链会显示这笔交易完成尝试，但因为没有提供足够的gas导致所有的合约命令都被复原。所以交易里没有被使用的超量gas都会以以太币的形式打回给交易发起者。因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。这没什么问题，因为多余的gas会被退回给你。 &nbsp; Gas是由两个部分组成： Gas limit(限制)* Gas Price(价格) Gas Price 是 Gwei 的数量，是指用户愿意花费于每个 Gas 单位的价钱，frontier版 默认为 0.05 Gwei。 Gas Limit 是用户愿意为执行某个操作或确认交易支付的最大Gas量（最少21,000），不同时期、不同的操作默认值不同，在执行操作时可设置Gas Limit。 估算交易消耗 一个交易的交易费由两个因素组成： gasUsed：该交易消耗的总gas数量 gasPrice：该交易中单位gas的价格（用以太币计算） 交易费 = gasUsed * gasPrice gasUsed 每个EVM中的命令都被设置了相应的gas消耗值。gasUsed是所有被执行的命令的gas消耗值总和。 区块gas limit 区块gas limit是单个区块允许的最多gas总量，以此可以用来决定单个区块中能打包多少笔交易。例如，我们有5笔交易的gas limit分别是10、20、30、40和50.如果区块gas limit是100，那么前4笔交易就能被成功打包进入这个区块。矿工有权决定将哪些交易打包入区块。所以，另一个矿工可以选择打包最后两笔交易进入这个区块（50+40），然后再将第一笔交易打包（10）。如果你尝试将一个会使用超过当前区块gas limit的交易打包，这个交易会被网络拒绝，你的以太坊客户端会反馈错误&quot;交易超过区块gas limit&quot;。以下例子是来自于以太坊StackExhcange的帖子。 目前区块的gas limit是&nbsp;4,712,357 gas，数据来自于ethstats.net，这表示着大约224笔转账交易（gas limit为21000）可以被塞进一个区块（区块时间大约在15-20秒间波动）。这个协议允许每个区块的矿工调整区块gas limit，任意加减 1/2024（0.0976%）。 &nbsp; 谁来决定区块gas limit 区块的gas limit是由在网络上的矿工决定的。与可调整的区块gas limit协议不同的是一个默认的挖矿策略，即大多数客户端默认最小区块gas limit为4,712,388。 区块gas limit是怎样改变的 以太坊上的矿工需要用一个挖矿软件，例如ethminer。它会连接到一个geth或者Parity以太坊客户端。Geth和Pairty都有让矿工可以更改配置的选项。这里是geth挖矿命令行选项以及Parity的选项。 一个重要需要注意的事情是内部交易或者消息不包含gasLimit。因为gas limit是由原始交易的外部创建者决定的（也就是外部拥有账户）。外部拥有账户设置的gas limit必须要高到足够将交易完成，包括由于此交易而产生的任何”子执行”，例如合约到合约的消息。如果，在一个交易或者信息链中，其中一个消息执行使gas已不足，那么这个消息的执行会被还原，包括任何被此执行触发的子消息。不过，父执行没必要被还原。 作者：孔德健 链接：https://www.jianshu.com/p/8fd649d41263 來源：简书 简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。 &nbsp; gas 的支付是通过ether实现的，gas 最小值 21000（单纯交易无data（input）） 因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。 3、决定数据大小的另一个因素是数据内容，因为不同的数据消耗的gas也不同： 0字节消耗4个gas 非0的字节消耗68个gas 每个交易要支付的21000个gas gas、gasPrice都能由用户指定的，在测试私链中，这两个值的默认值会按照发送交易设置的最大值填充下一次交易值，若不指定，gas会默认最小值21000，gasprice决定交易被打包的优先级，一般根据自己的数据量和合约内容估计填写。 &nbsp; 每个指令价目表https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit#gid=0， gasPrice 以Gwei为单位默认0.05 Gwei 当前区块GasPrice：60Gwei，见https://ethstats.net/ &nbsp; 例如： 私链打包的一笔交易 （仅有交易值无data） { &nbsp; difficulty: 157870, &nbsp; extraData: &quot;0xd98301080d846765746888676f312e31302e338664617277696e&quot;, &nbsp; gasLimit: 2635108496, &nbsp; gasUsed: 21000, &nbsp; hash: &quot;0x015ddd6a3ae2a7415319cba0eea293b442ff2b5d22e9d0aadbf62929a5b7d127&quot;, &nbsp; …… } 2 web3 源码发送一笔签名交易，签名内容为账户地址，得到一个130个64位字符码结果； &nbsp; const Web3=require(&quot;web3&quot;)//let web3=new Web3(new Web3.providers.HttpProvider(&quot;http://0.0.0.0:8545&quot;))let web3=new Web3(new Web3.providers.HttpProvider(&quot;http://127.0.0.1:8545&quot;)) web3.eth.getAccounts().then(function(accounts){ &nbsp;&nbsp;&nbsp; web3.eth.personal.unlockAccount(accounts[0],&#39;liujp&#39;).then(function(err){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(err) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.sign(accounts[0],accounts[2]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .then(function(result){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.estimateGas({from:accounts[0],to:accounts[1],data:result}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .then(function(value){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(value) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;console.log(result) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.sendTransaction({from:accounts[0],to:accounts[1],value:web3.utils.toWei(&quot;2&quot;),data:result}).then(function(val){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; }) })//sign data 发送签名数据计算后打包的交易块儿如下： { &nbsp; difficulty: 140617, &nbsp; extraData: &quot;0xd98301080d846765746888676f312e31302e338664617277696e&quot;, &nbsp; gasLimit: 2460911184, &nbsp; gasUsed: 25356, &nbsp; hash: &quot;0x1faffb83f0f08d3aaa01604d339e8c7ce0e41ba895c0b81a3905397eb9594864&quot;, &nbsp; logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp; miner: &quot;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&quot;, &nbsp; mixHash: &quot;0x89aa2ffbb803769d5bf52072cf9fdf7f81686b6ece72b78316ae866dc958f03a&quot;, &nbsp; nonce: &quot;0x2d6ac2944283758a&quot;, &nbsp; number: 570, &nbsp; parentHash: &quot;0x1e540e531f6c959b25f60165483a54c67ec6e730b9c8ad3b446ffaf395f6dac6&quot;, &nbsp; receiptsRoot: &quot;0xd846e2a6d17355d13fbfa33c90d181fd72ec8e6631aca44dfbdcc173e2b51f8c&quot;, &nbsp; sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, &nbsp; size: 720, &nbsp; stateRoot: &quot;0x610d465c8aed0fbb8d026b15517f097e638d6a25d35d6de07f025139e6dd5891&quot;, &nbsp; timestamp: 1533731373, &nbsp; totalDifficulty: 84923387, &nbsp; transactions: [&quot;0xb7c9929adc769db25ebdd75b8e81d489fd679f5a9fce7152ae6fb3304b0ff4df&quot;], &nbsp; transactionsRoot: &quot;0x863eb81e2b1e9c6c4f039938a01b26c61c9b0138636b5df3a2a10e2c9511ab39&quot;, &nbsp; &nbsp; uncles: [] } &nbsp; input如下，每两个为一位，可知64位非零和1位0值 0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c 总交易gas： 25356 = 交易费 + data处理费 input: 65字节：其中非零字节 64个， =》 25356 = 21000（一笔交易）+ 64（位，data加密数据长度）*68+4 &nbsp; &nbsp; &nbsp; 例3 输入一笔全0交易数据 估计：25356，使用21260； 21260=21000 + 4*65 {blockHash: &#39;0x9b08fe576261f95423cdfbb000c30148b1774a63664398226727fac34f0fcaa7&#39;, &nbsp; blockNumber: 708, &nbsp; contractAddress: null, &nbsp; cumulativeGasUsed: 21260, &nbsp; from: &#39;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&#39;, &nbsp; gasUsed: 21260, &nbsp; logs: [], &nbsp; …… &nbsp;} &nbsp; 例4 输入一笔全1交易数据（数据长度130） data: &quot;0x1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; 估计：25356，使用25420； 21260=21000 + 68*65（位）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { blockHash: &#39;0x60dcd93e9dc191b402b63e967dd1dddd3aa2a354fcf7610b46e6f1001e5cb9d2&#39;, &nbsp; blockNumber: 2990, &nbsp; contractAddress: null, &nbsp; cumulativeGasUsed: 25420, &nbsp; from: &#39;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&#39;, &nbsp; gasUsed: 25420, &nbsp; logs: [], &nbsp; …… } 测试data： 0x1a fe 5c ac1 bc b7 ec de 4c 3a 22 c3 69 7f 13 d0 eb a8 d7 1b fd 5d 4e 7b b7 3f a1 0a 48 a7 3a 81 87 61 27 21 4a b4 c2 d2 a1 e0 e6 76 30 08 13 99 b8 20 6f 2e 1a 0c f7 60 d8 96 c0 6a 76 6d 0f b1 b&nbsp; &nbsp;&nbsp; 0xb0 3b 0e c3 35 24 58 bc 09 ac 9f a8 da d4 e9 18 79 80 e6 bb 64 3f 4e 58 fa 38 53 7b 02 cb b9 7b 4b 0a 70 51 59 f4 7e 07 05 e7 e2 1c 4d 42 a4 87 80 ea 2d 76 b6 c3 9a cb 07 98 00 44 18 65 60 ea 1c&nbsp; &nbsp; &nbsp; &nbsp;0x3b84a 8047e ae293 4fca2 dcb3c f6119 11ae8 7630f 194e1 a8ccc 9b20c 0bae5 0c570 04220 cf26e 928da e5505 8bd2c fc2e3 b54fe f7a73 53173 08687 23948 e93cf 9911c&nbsp; &nbsp;&nbsp; 0x1000 00010 0000 00100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 01 0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c 阅读更多" />
<meta property="og:description" content="1. gas 以太坊在区块链上实现了一个运行环境，被称为以太坊虚拟机（EVM）。每个参与到网络的节点都会运行都会运行EVM作为区块验证协议的一部分。他们会验证区块中涵盖的每个交易并在EVM中运行交易所触发的代码。每个网络中的全节点都会进行相同的计算并储存相同的值。合约执行会在所有节点中被多次重复，这个事实得使得合约执行的消耗变得昂贵，所以这也促使大家将能在链下进行的运算都不放到区块链上进行。对于每个被执行的命令都会有一个特定的消耗，用单位gas计数。每个合约可以利用的命令都会有一个相应的gas值。gas使用ETH来支付。 2. gas和交易消耗的gas 每笔交易都被要求包括一个gas limit（有的时候被称为startGas）和一个交易愿为单位gas支付的费用。矿工可以有选择的打包这些交易并收取这些费用。在现实中，今天所有的交易最终都是由矿工选择的，但是用户所选择支付的交易费用多少会影响到该交易被打包所需等待的时长。如果该交易由于计算，包括原始消息和一些触发的其他消息，需要使用的gas数量小于或等于所设置的gas limit，那么这个交易会被处理。如果gas总消耗超过gas limit，那么所有的操作都会被复原，但交易是成立的并且交易费任会被矿工收取。区块链会显示这笔交易完成尝试，但因为没有提供足够的gas导致所有的合约命令都被复原。所以交易里没有被使用的超量gas都会以以太币的形式打回给交易发起者。因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。这没什么问题，因为多余的gas会被退回给你。 &nbsp; Gas是由两个部分组成： Gas limit(限制)* Gas Price(价格) Gas Price 是 Gwei 的数量，是指用户愿意花费于每个 Gas 单位的价钱，frontier版 默认为 0.05 Gwei。 Gas Limit 是用户愿意为执行某个操作或确认交易支付的最大Gas量（最少21,000），不同时期、不同的操作默认值不同，在执行操作时可设置Gas Limit。 估算交易消耗 一个交易的交易费由两个因素组成： gasUsed：该交易消耗的总gas数量 gasPrice：该交易中单位gas的价格（用以太币计算） 交易费 = gasUsed * gasPrice gasUsed 每个EVM中的命令都被设置了相应的gas消耗值。gasUsed是所有被执行的命令的gas消耗值总和。 区块gas limit 区块gas limit是单个区块允许的最多gas总量，以此可以用来决定单个区块中能打包多少笔交易。例如，我们有5笔交易的gas limit分别是10、20、30、40和50.如果区块gas limit是100，那么前4笔交易就能被成功打包进入这个区块。矿工有权决定将哪些交易打包入区块。所以，另一个矿工可以选择打包最后两笔交易进入这个区块（50+40），然后再将第一笔交易打包（10）。如果你尝试将一个会使用超过当前区块gas limit的交易打包，这个交易会被网络拒绝，你的以太坊客户端会反馈错误&quot;交易超过区块gas limit&quot;。以下例子是来自于以太坊StackExhcange的帖子。 目前区块的gas limit是&nbsp;4,712,357 gas，数据来自于ethstats.net，这表示着大约224笔转账交易（gas limit为21000）可以被塞进一个区块（区块时间大约在15-20秒间波动）。这个协议允许每个区块的矿工调整区块gas limit，任意加减 1/2024（0.0976%）。 &nbsp; 谁来决定区块gas limit 区块的gas limit是由在网络上的矿工决定的。与可调整的区块gas limit协议不同的是一个默认的挖矿策略，即大多数客户端默认最小区块gas limit为4,712,388。 区块gas limit是怎样改变的 以太坊上的矿工需要用一个挖矿软件，例如ethminer。它会连接到一个geth或者Parity以太坊客户端。Geth和Pairty都有让矿工可以更改配置的选项。这里是geth挖矿命令行选项以及Parity的选项。 一个重要需要注意的事情是内部交易或者消息不包含gasLimit。因为gas limit是由原始交易的外部创建者决定的（也就是外部拥有账户）。外部拥有账户设置的gas limit必须要高到足够将交易完成，包括由于此交易而产生的任何”子执行”，例如合约到合约的消息。如果，在一个交易或者信息链中，其中一个消息执行使gas已不足，那么这个消息的执行会被还原，包括任何被此执行触发的子消息。不过，父执行没必要被还原。 作者：孔德健 链接：https://www.jianshu.com/p/8fd649d41263 來源：简书 简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。 &nbsp; gas 的支付是通过ether实现的，gas 最小值 21000（单纯交易无data（input）） 因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。 3、决定数据大小的另一个因素是数据内容，因为不同的数据消耗的gas也不同： 0字节消耗4个gas 非0的字节消耗68个gas 每个交易要支付的21000个gas gas、gasPrice都能由用户指定的，在测试私链中，这两个值的默认值会按照发送交易设置的最大值填充下一次交易值，若不指定，gas会默认最小值21000，gasprice决定交易被打包的优先级，一般根据自己的数据量和合约内容估计填写。 &nbsp; 每个指令价目表https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit#gid=0， gasPrice 以Gwei为单位默认0.05 Gwei 当前区块GasPrice：60Gwei，见https://ethstats.net/ &nbsp; 例如： 私链打包的一笔交易 （仅有交易值无data） { &nbsp; difficulty: 157870, &nbsp; extraData: &quot;0xd98301080d846765746888676f312e31302e338664617277696e&quot;, &nbsp; gasLimit: 2635108496, &nbsp; gasUsed: 21000, &nbsp; hash: &quot;0x015ddd6a3ae2a7415319cba0eea293b442ff2b5d22e9d0aadbf62929a5b7d127&quot;, &nbsp; …… } 2 web3 源码发送一笔签名交易，签名内容为账户地址，得到一个130个64位字符码结果； &nbsp; const Web3=require(&quot;web3&quot;)//let web3=new Web3(new Web3.providers.HttpProvider(&quot;http://0.0.0.0:8545&quot;))let web3=new Web3(new Web3.providers.HttpProvider(&quot;http://127.0.0.1:8545&quot;)) web3.eth.getAccounts().then(function(accounts){ &nbsp;&nbsp;&nbsp; web3.eth.personal.unlockAccount(accounts[0],&#39;liujp&#39;).then(function(err){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(err) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.sign(accounts[0],accounts[2]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .then(function(result){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.estimateGas({from:accounts[0],to:accounts[1],data:result}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .then(function(value){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(value) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;console.log(result) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.sendTransaction({from:accounts[0],to:accounts[1],value:web3.utils.toWei(&quot;2&quot;),data:result}).then(function(val){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; }) })//sign data 发送签名数据计算后打包的交易块儿如下： { &nbsp; difficulty: 140617, &nbsp; extraData: &quot;0xd98301080d846765746888676f312e31302e338664617277696e&quot;, &nbsp; gasLimit: 2460911184, &nbsp; gasUsed: 25356, &nbsp; hash: &quot;0x1faffb83f0f08d3aaa01604d339e8c7ce0e41ba895c0b81a3905397eb9594864&quot;, &nbsp; logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp; miner: &quot;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&quot;, &nbsp; mixHash: &quot;0x89aa2ffbb803769d5bf52072cf9fdf7f81686b6ece72b78316ae866dc958f03a&quot;, &nbsp; nonce: &quot;0x2d6ac2944283758a&quot;, &nbsp; number: 570, &nbsp; parentHash: &quot;0x1e540e531f6c959b25f60165483a54c67ec6e730b9c8ad3b446ffaf395f6dac6&quot;, &nbsp; receiptsRoot: &quot;0xd846e2a6d17355d13fbfa33c90d181fd72ec8e6631aca44dfbdcc173e2b51f8c&quot;, &nbsp; sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, &nbsp; size: 720, &nbsp; stateRoot: &quot;0x610d465c8aed0fbb8d026b15517f097e638d6a25d35d6de07f025139e6dd5891&quot;, &nbsp; timestamp: 1533731373, &nbsp; totalDifficulty: 84923387, &nbsp; transactions: [&quot;0xb7c9929adc769db25ebdd75b8e81d489fd679f5a9fce7152ae6fb3304b0ff4df&quot;], &nbsp; transactionsRoot: &quot;0x863eb81e2b1e9c6c4f039938a01b26c61c9b0138636b5df3a2a10e2c9511ab39&quot;, &nbsp; &nbsp; uncles: [] } &nbsp; input如下，每两个为一位，可知64位非零和1位0值 0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c 总交易gas： 25356 = 交易费 + data处理费 input: 65字节：其中非零字节 64个， =》 25356 = 21000（一笔交易）+ 64（位，data加密数据长度）*68+4 &nbsp; &nbsp; &nbsp; 例3 输入一笔全0交易数据 估计：25356，使用21260； 21260=21000 + 4*65 {blockHash: &#39;0x9b08fe576261f95423cdfbb000c30148b1774a63664398226727fac34f0fcaa7&#39;, &nbsp; blockNumber: 708, &nbsp; contractAddress: null, &nbsp; cumulativeGasUsed: 21260, &nbsp; from: &#39;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&#39;, &nbsp; gasUsed: 21260, &nbsp; logs: [], &nbsp; …… &nbsp;} &nbsp; 例4 输入一笔全1交易数据（数据长度130） data: &quot;0x1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; 估计：25356，使用25420； 21260=21000 + 68*65（位）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { blockHash: &#39;0x60dcd93e9dc191b402b63e967dd1dddd3aa2a354fcf7610b46e6f1001e5cb9d2&#39;, &nbsp; blockNumber: 2990, &nbsp; contractAddress: null, &nbsp; cumulativeGasUsed: 25420, &nbsp; from: &#39;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&#39;, &nbsp; gasUsed: 25420, &nbsp; logs: [], &nbsp; …… } 测试data： 0x1a fe 5c ac1 bc b7 ec de 4c 3a 22 c3 69 7f 13 d0 eb a8 d7 1b fd 5d 4e 7b b7 3f a1 0a 48 a7 3a 81 87 61 27 21 4a b4 c2 d2 a1 e0 e6 76 30 08 13 99 b8 20 6f 2e 1a 0c f7 60 d8 96 c0 6a 76 6d 0f b1 b&nbsp; &nbsp;&nbsp; 0xb0 3b 0e c3 35 24 58 bc 09 ac 9f a8 da d4 e9 18 79 80 e6 bb 64 3f 4e 58 fa 38 53 7b 02 cb b9 7b 4b 0a 70 51 59 f4 7e 07 05 e7 e2 1c 4d 42 a4 87 80 ea 2d 76 b6 c3 9a cb 07 98 00 44 18 65 60 ea 1c&nbsp; &nbsp; &nbsp; &nbsp;0x3b84a 8047e ae293 4fca2 dcb3c f6119 11ae8 7630f 194e1 a8ccc 9b20c 0bae5 0c570 04220 cf26e 928da e5505 8bd2c fc2e3 b54fe f7a73 53173 08687 23948 e93cf 9911c&nbsp; &nbsp;&nbsp; 0x1000 00010 0000 00100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 01 0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/09/6d9d24f912ce4cf5a0cd24229e6339af.html" />
<meta property="og:url" content="https://mlh.app/2018/08/09/6d9d24f912ce4cf5a0cd24229e6339af.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-09T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1. gas 以太坊在区块链上实现了一个运行环境，被称为以太坊虚拟机（EVM）。每个参与到网络的节点都会运行都会运行EVM作为区块验证协议的一部分。他们会验证区块中涵盖的每个交易并在EVM中运行交易所触发的代码。每个网络中的全节点都会进行相同的计算并储存相同的值。合约执行会在所有节点中被多次重复，这个事实得使得合约执行的消耗变得昂贵，所以这也促使大家将能在链下进行的运算都不放到区块链上进行。对于每个被执行的命令都会有一个特定的消耗，用单位gas计数。每个合约可以利用的命令都会有一个相应的gas值。gas使用ETH来支付。 2. gas和交易消耗的gas 每笔交易都被要求包括一个gas limit（有的时候被称为startGas）和一个交易愿为单位gas支付的费用。矿工可以有选择的打包这些交易并收取这些费用。在现实中，今天所有的交易最终都是由矿工选择的，但是用户所选择支付的交易费用多少会影响到该交易被打包所需等待的时长。如果该交易由于计算，包括原始消息和一些触发的其他消息，需要使用的gas数量小于或等于所设置的gas limit，那么这个交易会被处理。如果gas总消耗超过gas limit，那么所有的操作都会被复原，但交易是成立的并且交易费任会被矿工收取。区块链会显示这笔交易完成尝试，但因为没有提供足够的gas导致所有的合约命令都被复原。所以交易里没有被使用的超量gas都会以以太币的形式打回给交易发起者。因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。这没什么问题，因为多余的gas会被退回给你。 &nbsp; Gas是由两个部分组成： Gas limit(限制)* Gas Price(价格) Gas Price 是 Gwei 的数量，是指用户愿意花费于每个 Gas 单位的价钱，frontier版 默认为 0.05 Gwei。 Gas Limit 是用户愿意为执行某个操作或确认交易支付的最大Gas量（最少21,000），不同时期、不同的操作默认值不同，在执行操作时可设置Gas Limit。 估算交易消耗 一个交易的交易费由两个因素组成： gasUsed：该交易消耗的总gas数量 gasPrice：该交易中单位gas的价格（用以太币计算） 交易费 = gasUsed * gasPrice gasUsed 每个EVM中的命令都被设置了相应的gas消耗值。gasUsed是所有被执行的命令的gas消耗值总和。 区块gas limit 区块gas limit是单个区块允许的最多gas总量，以此可以用来决定单个区块中能打包多少笔交易。例如，我们有5笔交易的gas limit分别是10、20、30、40和50.如果区块gas limit是100，那么前4笔交易就能被成功打包进入这个区块。矿工有权决定将哪些交易打包入区块。所以，另一个矿工可以选择打包最后两笔交易进入这个区块（50+40），然后再将第一笔交易打包（10）。如果你尝试将一个会使用超过当前区块gas limit的交易打包，这个交易会被网络拒绝，你的以太坊客户端会反馈错误&quot;交易超过区块gas limit&quot;。以下例子是来自于以太坊StackExhcange的帖子。 目前区块的gas limit是&nbsp;4,712,357 gas，数据来自于ethstats.net，这表示着大约224笔转账交易（gas limit为21000）可以被塞进一个区块（区块时间大约在15-20秒间波动）。这个协议允许每个区块的矿工调整区块gas limit，任意加减 1/2024（0.0976%）。 &nbsp; 谁来决定区块gas limit 区块的gas limit是由在网络上的矿工决定的。与可调整的区块gas limit协议不同的是一个默认的挖矿策略，即大多数客户端默认最小区块gas limit为4,712,388。 区块gas limit是怎样改变的 以太坊上的矿工需要用一个挖矿软件，例如ethminer。它会连接到一个geth或者Parity以太坊客户端。Geth和Pairty都有让矿工可以更改配置的选项。这里是geth挖矿命令行选项以及Parity的选项。 一个重要需要注意的事情是内部交易或者消息不包含gasLimit。因为gas limit是由原始交易的外部创建者决定的（也就是外部拥有账户）。外部拥有账户设置的gas limit必须要高到足够将交易完成，包括由于此交易而产生的任何”子执行”，例如合约到合约的消息。如果，在一个交易或者信息链中，其中一个消息执行使gas已不足，那么这个消息的执行会被还原，包括任何被此执行触发的子消息。不过，父执行没必要被还原。 作者：孔德健 链接：https://www.jianshu.com/p/8fd649d41263 來源：简书 简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。 &nbsp; gas 的支付是通过ether实现的，gas 最小值 21000（单纯交易无data（input）） 因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。 3、决定数据大小的另一个因素是数据内容，因为不同的数据消耗的gas也不同： 0字节消耗4个gas 非0的字节消耗68个gas 每个交易要支付的21000个gas gas、gasPrice都能由用户指定的，在测试私链中，这两个值的默认值会按照发送交易设置的最大值填充下一次交易值，若不指定，gas会默认最小值21000，gasprice决定交易被打包的优先级，一般根据自己的数据量和合约内容估计填写。 &nbsp; 每个指令价目表https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit#gid=0， gasPrice 以Gwei为单位默认0.05 Gwei 当前区块GasPrice：60Gwei，见https://ethstats.net/ &nbsp; 例如： 私链打包的一笔交易 （仅有交易值无data） { &nbsp; difficulty: 157870, &nbsp; extraData: &quot;0xd98301080d846765746888676f312e31302e338664617277696e&quot;, &nbsp; gasLimit: 2635108496, &nbsp; gasUsed: 21000, &nbsp; hash: &quot;0x015ddd6a3ae2a7415319cba0eea293b442ff2b5d22e9d0aadbf62929a5b7d127&quot;, &nbsp; …… } 2 web3 源码发送一笔签名交易，签名内容为账户地址，得到一个130个64位字符码结果； &nbsp; const Web3=require(&quot;web3&quot;)//let web3=new Web3(new Web3.providers.HttpProvider(&quot;http://0.0.0.0:8545&quot;))let web3=new Web3(new Web3.providers.HttpProvider(&quot;http://127.0.0.1:8545&quot;)) web3.eth.getAccounts().then(function(accounts){ &nbsp;&nbsp;&nbsp; web3.eth.personal.unlockAccount(accounts[0],&#39;liujp&#39;).then(function(err){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(err) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.sign(accounts[0],accounts[2]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .then(function(result){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.estimateGas({from:accounts[0],to:accounts[1],data:result}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .then(function(value){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(value) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;console.log(result) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.sendTransaction({from:accounts[0],to:accounts[1],value:web3.utils.toWei(&quot;2&quot;),data:result}).then(function(val){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(val) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; }) })//sign data 发送签名数据计算后打包的交易块儿如下： { &nbsp; difficulty: 140617, &nbsp; extraData: &quot;0xd98301080d846765746888676f312e31302e338664617277696e&quot;, &nbsp; gasLimit: 2460911184, &nbsp; gasUsed: 25356, &nbsp; hash: &quot;0x1faffb83f0f08d3aaa01604d339e8c7ce0e41ba895c0b81a3905397eb9594864&quot;, &nbsp; logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp; miner: &quot;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&quot;, &nbsp; mixHash: &quot;0x89aa2ffbb803769d5bf52072cf9fdf7f81686b6ece72b78316ae866dc958f03a&quot;, &nbsp; nonce: &quot;0x2d6ac2944283758a&quot;, &nbsp; number: 570, &nbsp; parentHash: &quot;0x1e540e531f6c959b25f60165483a54c67ec6e730b9c8ad3b446ffaf395f6dac6&quot;, &nbsp; receiptsRoot: &quot;0xd846e2a6d17355d13fbfa33c90d181fd72ec8e6631aca44dfbdcc173e2b51f8c&quot;, &nbsp; sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, &nbsp; size: 720, &nbsp; stateRoot: &quot;0x610d465c8aed0fbb8d026b15517f097e638d6a25d35d6de07f025139e6dd5891&quot;, &nbsp; timestamp: 1533731373, &nbsp; totalDifficulty: 84923387, &nbsp; transactions: [&quot;0xb7c9929adc769db25ebdd75b8e81d489fd679f5a9fce7152ae6fb3304b0ff4df&quot;], &nbsp; transactionsRoot: &quot;0x863eb81e2b1e9c6c4f039938a01b26c61c9b0138636b5df3a2a10e2c9511ab39&quot;, &nbsp; &nbsp; uncles: [] } &nbsp; input如下，每两个为一位，可知64位非零和1位0值 0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c 总交易gas： 25356 = 交易费 + data处理费 input: 65字节：其中非零字节 64个， =》 25356 = 21000（一笔交易）+ 64（位，data加密数据长度）*68+4 &nbsp; &nbsp; &nbsp; 例3 输入一笔全0交易数据 估计：25356，使用21260； 21260=21000 + 4*65 {blockHash: &#39;0x9b08fe576261f95423cdfbb000c30148b1774a63664398226727fac34f0fcaa7&#39;, &nbsp; blockNumber: 708, &nbsp; contractAddress: null, &nbsp; cumulativeGasUsed: 21260, &nbsp; from: &#39;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&#39;, &nbsp; gasUsed: 21260, &nbsp; logs: [], &nbsp; …… &nbsp;} &nbsp; 例4 输入一笔全1交易数据（数据长度130） data: &quot;0x1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; 估计：25356，使用25420； 21260=21000 + 68*65（位）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { blockHash: &#39;0x60dcd93e9dc191b402b63e967dd1dddd3aa2a354fcf7610b46e6f1001e5cb9d2&#39;, &nbsp; blockNumber: 2990, &nbsp; contractAddress: null, &nbsp; cumulativeGasUsed: 25420, &nbsp; from: &#39;0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4&#39;, &nbsp; gasUsed: 25420, &nbsp; logs: [], &nbsp; …… } 测试data： 0x1a fe 5c ac1 bc b7 ec de 4c 3a 22 c3 69 7f 13 d0 eb a8 d7 1b fd 5d 4e 7b b7 3f a1 0a 48 a7 3a 81 87 61 27 21 4a b4 c2 d2 a1 e0 e6 76 30 08 13 99 b8 20 6f 2e 1a 0c f7 60 d8 96 c0 6a 76 6d 0f b1 b&nbsp; &nbsp;&nbsp; 0xb0 3b 0e c3 35 24 58 bc 09 ac 9f a8 da d4 e9 18 79 80 e6 bb 64 3f 4e 58 fa 38 53 7b 02 cb b9 7b 4b 0a 70 51 59 f4 7e 07 05 e7 e2 1c 4d 42 a4 87 80 ea 2d 76 b6 c3 9a cb 07 98 00 44 18 65 60 ea 1c&nbsp; &nbsp; &nbsp; &nbsp;0x3b84a 8047e ae293 4fca2 dcb3c f6119 11ae8 7630f 194e1 a8ccc 9b20c 0bae5 0c570 04220 cf26e 928da e5505 8bd2c fc2e3 b54fe f7a73 53173 08687 23948 e93cf 9911c&nbsp; &nbsp;&nbsp; 0x1000 00010 0000 00100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 01 0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/09/6d9d24f912ce4cf5a0cd24229e6339af.html","headline":"以太坊gas、gaslimit、gasPrice说明","dateModified":"2018-08-09T00:00:00+08:00","datePublished":"2018-08-09T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/09/6d9d24f912ce4cf5a0cd24229e6339af.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊gas、gaslimit、gasPrice说明</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="margin-left:0cm;"><span style="color:#222222;">1. gas</span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">以太坊在区块链上实现了一个运行环境，被称为以太坊虚拟机（</span><span style="color:#333333;">EVM</span><span style="color:#333333;">）。每个参与到网络的节点都会运行都会运行</span><span style="color:#333333;">EVM</span><span style="color:#333333;">作为区块验证协议的一部分。他们会验证区块中涵盖的每个交易并在</span><span style="color:#333333;">EVM</span><span style="color:#333333;">中运行交易所触发的代码。每个网络中的全节点都会进行相同的计算并储存相同的值。合约执行会在所有节点中被多次重复，这个事实得使得合约执行的消耗变得昂贵，所以这也促使大家将能在链下进行的运算都不放到区块链上进行。对于每个被执行的命令都会有一个特定的消耗，用单位</span><span style="color:#333333;">gas</span><span style="color:#333333;">计数。每个合约可以利用的命令都会有一个相应的</span><span style="color:#333333;">gas</span><span style="color:#333333;">值。</span><span style="color:#333333;">gas</span><span style="color:#333333;">使用</span><span style="color:#333333;">ETH</span><span style="color:#333333;">来支付。</span></p> 
  <p>2. gas和交易消耗的gas</p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">每笔交易都被要求包括一个</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">（</span><a href="https://media.consensys.net/ethereum-gas-fuel-and-fees-3333e17fe1dc" rel="nofollow"><span style="color:#7089a9;">有的时候被称为</span></a><code><span style="color:#333333;">startGas</span></code><span style="color:#333333;">）和一个交易愿为单位</span><span style="color:#333333;">gas</span><span style="color:#333333;">支付的费用。矿工可以有选择的打包这些交易并收取这些费用。在现实中，今天所有的交易最终都是由矿工选择的，但是用户所选择支付的交易费用多少会影响到该交易被打包所需等待的时长。如果该交易由于计算，包括原始消息和一些触发的其他消息，需要使用的</span><span style="color:#333333;">gas</span><span style="color:#333333;">数量小于或等于所设置的</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">，那么这个交易会被处理。如果</span><span style="color:#333333;">gas</span><span style="color:#333333;">总消耗超过</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">，那么所有的操作都会被复原，但交易是成立的并且交易费任会被矿工收取。区块链会显示这笔交易完成尝试，但因为没有提供足够的</span><span style="color:#333333;">gas</span><span style="color:#333333;">导致所有的合约命令都被复原。所以交易里没有被使用的超量</span><span style="color:#333333;">gas</span><span style="color:#333333;">都会以以太币的形式打回给交易发起者。因为</span><span style="color:#333333;">gas</span><span style="color:#333333;">消耗一般只是一个大致估算，所以许多用户会超额支付</span><span style="color:#333333;">gas</span><span style="color:#333333;">来保证他们的交易会被接受。这没什么问题，因为多余的</span><span style="color:#333333;">gas</span><span style="color:#333333;">会被退回给你。</span></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><strong>Gas是由两个部分组成： <code>Gas limit</code>(限制)* <code>Gas Price</code>(价格)</strong></p> 
  <ul>
   <li><span style="color:#333333;">Gas Price 是 Gwei 的数量，是指用户愿意花费于每个 Gas 单位的价钱，frontier版 默认为 0.05 Gwei。</span></li> 
   <li><span style="color:#333333;">Gas Limit 是用户愿意为执行某个操作或确认交易支付的最大Gas量（最少21,000），不同时期、不同的操作默认值不同，在执行操作时可设置Gas Limit。</span></li> 
  </ul>
  <h3 style="margin-left:0cm;"><strong><strong><span style="color:#222222;">估算交易消耗</span></strong></strong></h3> 
  <p style="margin-left:0cm;"><span style="color:#333333;">一个交易的交易费由两个因素组成：</span></p> 
  <ul>
   <li><code><span style="color:#333333;">gasUsed</span></code><span style="color:#333333;">：该交易消耗的总</span><span style="color:#333333;">gas</span><span style="color:#333333;">数量</span></li> 
   <li><code><span style="color:#333333;">gasPrice</span></code><span style="color:#333333;">：该交易中单位</span><span style="color:#333333;">gas</span><span style="color:#333333;">的价格（用以太币计算）</span></li> 
  </ul>
  <p style="margin-left:0cm;"><strong><span style="color:#333333;">交易费</span><span style="color:#333333;"> = gasUsed * gasPrice</span></strong></p> 
  <p><strong><strong><span style="color:#222222;">gasUsed</span></strong></strong></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">每个</span><span style="color:#333333;">EVM</span><span style="color:#333333;">中的命令都被设置了相应的</span><span style="color:#333333;">gas</span><span style="color:#333333;">消耗值。</span><span style="color:#333333;">gasUsed</span><span style="color:#333333;">是所有被执行的命令的</span><span style="color:#333333;">gas</span><span style="color:#333333;">消耗值总和。</span></p> 
  <p><strong>区块gas limit</strong></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">区块</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">是单个区块允许的最多</span><span style="color:#333333;">gas</span><span style="color:#333333;">总量，以此可以用来决定单个区块中能打包多少笔交易。例如，我们有</span><span style="color:#333333;">5</span><span style="color:#333333;">笔交易的</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">分别是</span><span style="color:#333333;">10</span><span style="color:#333333;">、</span><span style="color:#333333;">20</span><span style="color:#333333;">、</span><span style="color:#333333;">30</span><span style="color:#333333;">、</span><span style="color:#333333;">40</span><span style="color:#333333;">和</span><span style="color:#333333;">50.</span><span style="color:#333333;">如果区块</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">是</span><span style="color:#333333;">100</span><span style="color:#333333;">，那么前</span><span style="color:#333333;">4</span><span style="color:#333333;">笔交易就能被成功打包进入这个区块。矿工有权决定将哪些交易打包入区块。所以，另一个矿工可以选择打包最后两笔交易进入这个区块（</span><span style="color:#333333;">50+40</span><span style="color:#333333;">），然后再将第一笔交易打包（</span><span style="color:#333333;">10</span><span style="color:#333333;">）。如果你尝试将一个会使用超过当前区块</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">的交易打包，这个交易会被网络拒绝，你的以太坊客户端会反馈错误</span><span style="color:#333333;">"</span><span style="color:#333333;">交易超过区块</span><span style="color:#333333;">gas limit"</span><span style="color:#333333;">。</span><span style="color:#333333;"><a href="https://ethereum.stackexchange.com/questions/7359/are-gas-limit-in-transaction-and-block-gas-limit-different" rel="nofollow"><span style="color:#7089a9;">以下例子是来自于以太坊</span><span style="color:#7089a9;">StackExhcange</span><span style="color:#7089a9;">的帖子。</span></a></span></p> 
  <p style="margin-left:0cm;"><span style="color:#333333;">目前区块的</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">是</span>&nbsp;<a href="https://ethstats.net/" rel="nofollow"><span style="color:#7089a9;">4,712,357 gas</span><span style="color:#7089a9;">，数据来自于</span><span style="color:#7089a9;">ethstats.net</span></a><span style="color:#333333;">，这表示着大约</span><span style="color:#333333;">224</span><span style="color:#333333;">笔转账交易（</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">为</span><span style="color:#333333;">21000</span><span style="color:#333333;">）可以被塞进一个区块（区块时间大约在</span><span style="color:#333333;">15-20</span><span style="color:#333333;">秒间波动）。</span><span style="color:#333333;"><a href="https://www.reddit.com/r/ethereum/comments/6g6tww/there_are_hundreds_or_even_thousands_of_pending/dinzrgq/" rel="nofollow"><span style="color:#7089a9;">这个协议允许每个区块的矿工调整区块</span><span style="color:#7089a9;">gas limit</span><span style="color:#7089a9;">，任意加减</span><span style="color:#7089a9;"> 1/2024</span><span style="color:#7089a9;">（</span><span style="color:#7089a9;">0.0976%</span><span style="color:#7089a9;">）。</span></a></span></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <h3 style="margin-left:0cm;"><strong><strong><span style="color:#222222;">谁来决</span></strong><strong><span style="color:#222222;">定区</span></strong><strong><span style="color:#222222;">块</span></strong><strong><span style="color:#222222;">gas limit</span></strong></strong></h3> 
  <p style="margin-left:0cm;"><span style="color:#333333;">区块的</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">是由在网络上的矿工决定的。与可调整的区块</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">协议不同的是一个默认的挖矿策略，即大多数客户端默认最小区块</span><span style="color:#333333;">gas limit</span><span style="color:#333333;">为</span><span style="color:#333333;">4,712,388</span><span style="color:#333333;">。</span></p> 
  <h3 style="margin-left:0cm;"><strong><strong><span style="color:#222222;">区</span></strong><strong><span style="color:#222222;">块</span></strong><strong><span style="color:#222222;">gas limit</span></strong><strong><span style="color:#222222;">是怎</span></strong><strong><span style="color:#222222;">样</span></strong><strong><span style="color:#222222;">改</span></strong><strong><span style="color:#222222;">变</span></strong><strong><span style="color:#222222;">的</span></strong></strong></h3> 
  <p style="margin-left:0cm;"><span style="color:#333333;">以太坊上的矿工需要用一个挖矿软件，例如</span><span style="color:#333333;">ethminer</span><span style="color:#333333;">。它会连接到一个</span><span style="color:#333333;">geth</span><span style="color:#333333;">或者</span><span style="color:#333333;">Parity</span><span style="color:#333333;">以太坊客户端。</span><span style="color:#333333;">Geth</span><span style="color:#333333;">和</span><span style="color:#333333;">Pairty</span><span style="color:#333333;">都有让矿工可以更改配置的选项。这里是</span><span style="color:#333333;">geth</span><span style="color:#333333;">挖矿命令行选项以及</span><span style="color:#333333;">Parity</span><span style="color:#333333;">的选项。</span></p> 
  <p>一个重要需要注意的事情是内部交易或者消息不包含<strong>gasLimit</strong>。因为gas limit是由原始交易的外部创建者决定的（也就是外部拥有账户）。外部拥有账户设置的gas limit必须要高到足够将交易完成，包括由于此交易而产生的任何”子执行”，例如合约到合约的消息。如果，在一个交易或者信息链中，其中一个消息执行使gas已不足，那么这个消息的执行会被还原，包括任何被此执行触发的子消息。不过，父执行没必要被还原。</p> 
  <p><br><br> 作者：孔德健<br> 链接：https://www.jianshu.com/p/8fd649d41263<br> 來源：简书<br> 简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <ul>
   <li>gas 的支付是通过ether实现的，gas 最小值 21000（单纯交易无data（input））</li> 
   <li>因为gas消耗一般只是一个大致估算，所以许多用户会超额支付gas来保证他们的交易会被接受。</li> 
   <li>3、决定数据大小的另一个因素是数据内容，因为不同的数据消耗的gas也不同：</li> 
  </ul>
  <ol>
   <li>0字节消耗4个gas</li> 
   <li>非0的字节消耗68个gas</li> 
   <li>每个交易要支付的21000个gas</li> 
   <li><strong>gas</strong><strong>、</strong><strong>gasPrice</strong><strong>都能由用户指定的，在测试私链中，这两个值的默认值会按照发送交易设置的最大值填充下一次交易值，若不指定，</strong><strong>gas</strong><strong>会默认最小值</strong><strong>21000</strong><strong>，</strong><strong>gasprice</strong><strong>决定交易被打包的优先级，一般根据自己的数据量和合约内容估计填写。</strong></li> 
  </ol>
  <p style="margin-left:0cm;">&nbsp;</p> 
  <ul>
   <li><strong>每个指令价目表</strong><strong><a href="https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit#gid=0" rel="nofollow">https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit#gid=0</a></strong><strong>，</strong></li> 
   <li><strong>gasPrice </strong><strong>以</strong><strong>Gwei</strong><strong>为单位默认</strong><strong>0.05 Gwei </strong><strong>当前区块</strong><strong>GasPrice</strong><strong>：</strong><strong>60Gwei</strong><strong>，见</strong><strong><a href="https://ethstats.net/" rel="nofollow">https://ethstats.net/</a></strong></li> 
  </ul>
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><strong>例如：</strong></p> 
  <ol>
   <li><strong>私链打包的一笔交易</strong><strong> </strong><strong>（仅有交易值无</strong><strong>data</strong><strong>）</strong></li> 
  </ol>
  <p style="margin-left:0cm;"><span style="color:#000000;">{</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; difficulty: </span><span style="color:#b42419;">157870</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; extraData: </span><span style="color:#2fb41d;">"0xd98301080d846765746888676f312e31302e338664617277696e"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; gasLimit: </span><span style="color:#b42419;">2635108496</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; gasUsed: </span><span style="color:#b42419;">21000</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; hash: </span><span style="color:#2fb41d;">"0x015ddd6a3ae2a7415319cba0eea293b442ff2b5d22e9d0aadbf62929a5b7d127"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; ……</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> 
  <p style="margin-left:0cm;"><strong>2</strong></p> 
  <p style="margin-left:0cm;"><strong>web3 </strong><strong>源码发送一笔签名交易，签名内容为账户地址，得到一个</strong><strong>130</strong><strong>个</strong><strong>64</strong><strong>位字符码结果；</strong></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><strong><span style="color:#cc7832;">const </span></strong><span style="color:#a9b7c6;">Web3=require(</span><span style="color:#6a8759;">"web3"</span><span style="color:#a9b7c6;">)</span><br><span style="color:#808080;">//let web3=new Web3(new Web3.providers.HttpProvider("http://0.0.0.0:8545"))</span><br><strong><span style="color:#cc7832;">let </span></strong><span style="color:#a9b7c6;">web3=</span><strong><span style="color:#cc7832;">new </span></strong><span style="color:#a9b7c6;">Web3(</span><strong><span style="color:#cc7832;">new </span></strong><span style="color:#a9b7c6;">Web3.providers.HttpProvider(</span><span style="color:#6a8759;">"http://127.0.0.1:8545"</span><span style="color:#a9b7c6;">))<br><br><br> web3.eth.</span><span style="color:#ffc66d;">getAccounts</span><span style="color:#a9b7c6;">().</span><span style="color:#ffc66d;">then</span><span style="color:#a9b7c6;">(</span><strong><span style="color:#cc7832;">function</span></strong><span style="color:#a9b7c6;">(accounts){<br><br> &nbsp;&nbsp;&nbsp; web3.eth.</span><span style="color:#9876aa;">personal</span><span style="color:#a9b7c6;">.</span><span style="color:#ffc66d;">unlockAccount</span><span style="color:#a9b7c6;">(accounts[</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">,</span><span style="color:#6a8759;">'liujp'</span><span style="color:#a9b7c6;">).</span><span style="color:#ffc66d;">then</span><span style="color:#a9b7c6;">(</span><strong><span style="color:#cc7832;">function</span></strong><span style="color:#a9b7c6;">(err){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.</span><span style="color:#ffc66d;">log</span><span style="color:#a9b7c6;">(err)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.</span><span style="color:#ffc66d;">sign</span><span style="color:#a9b7c6;">(accounts[</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">,</span><span style="color:#a9b7c6;">accounts[</span><span style="color:#6897bb;">2</span><span style="color:#a9b7c6;">])<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .</span><span style="color:#ffc66d;">then</span><span style="color:#a9b7c6;">(</span><strong><span style="color:#cc7832;">function</span></strong><span style="color:#a9b7c6;">(result){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.</span><span style="color:#ffc66d;">estimateGas</span><span style="color:#a9b7c6;">({</span><span style="color:#9876aa;">from</span><span style="color:#a9b7c6;">:accounts[</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">,</span><span style="color:#9876aa;">to</span><span style="color:#a9b7c6;">:accounts[</span><span style="color:#6897bb;">1</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">,</span><span style="color:#9876aa;">data</span><span style="color:#a9b7c6;">:result})<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .</span><span style="color:#ffc66d;">then</span><span style="color:#a9b7c6;">(</span><strong><span style="color:#cc7832;">function</span></strong><span style="color:#a9b7c6;">(value){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.</span><span style="color:#ffc66d;">log</span><span style="color:#a9b7c6;">(value)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;console.</span><span style="color:#ffc66d;">log</span><span style="color:#a9b7c6;">(result)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; web3.eth.</span><span style="color:#ffc66d;">sendTransaction</span><span style="color:#a9b7c6;">({</span><span style="color:#9876aa;">from</span><span style="color:#a9b7c6;">:accounts[</span><span style="color:#6897bb;">0</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">,</span><span style="color:#9876aa;">to</span><span style="color:#a9b7c6;">:accounts[</span><span style="color:#6897bb;">1</span><span style="color:#a9b7c6;">]</span><span style="color:#cc7832;">,</span><span style="color:#9876aa;">value</span><span style="color:#a9b7c6;">:web3.utils.</span><span style="color:#ffc66d;">toWei</span><span style="color:#a9b7c6;">(</span><span style="color:#6a8759;">"2"</span><span style="color:#a9b7c6;">)</span><span style="color:#cc7832;">,</span><span style="color:#9876aa;">data</span><span style="color:#a9b7c6;">:result}).</span><span style="color:#ffc66d;">then</span><span style="color:#a9b7c6;">(</span><strong><span style="color:#cc7832;">function</span></strong><span style="color:#a9b7c6;">(val){<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.</span><span style="color:#ffc66d;">log</span><span style="color:#a9b7c6;">(val)<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<br> &nbsp;&nbsp;&nbsp; })<br> })</span><br><span style="color:#808080;">//sign data</span></p> 
  <p style="margin-left:0cm;"><strong>发送签名数据计算后打包的交易块儿如下：</strong></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">{</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; difficulty: </span><span style="color:#b42419;">140617</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; extraData: </span><span style="color:#2fb41d;">"0xd98301080d846765746888676f312e31302e338664617277696e"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; gasLimit: </span><span style="color:#b42419;">2460911184</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; gasUsed: </span><strong><span style="color:#b42419;">25356</span></strong><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; hash: </span><span style="color:#2fb41d;">"0x1faffb83f0f08d3aaa01604d339e8c7ce0e41ba895c0b81a3905397eb9594864"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; logsBloom: </span><span style="color:#2fb41d;">"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; miner: </span><span style="color:#2fb41d;">"0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; mixHash: </span><span style="color:#2fb41d;">"0x89aa2ffbb803769d5bf52072cf9fdf7f81686b6ece72b78316ae866dc958f03a"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; nonce: </span><span style="color:#2fb41d;">"0x2d6ac2944283758a"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; number: </span><span style="color:#b42419;">570</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; parentHash: </span><span style="color:#2fb41d;">"0x1e540e531f6c959b25f60165483a54c67ec6e730b9c8ad3b446ffaf395f6dac6"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; receiptsRoot: </span><span style="color:#2fb41d;">"0xd846e2a6d17355d13fbfa33c90d181fd72ec8e6631aca44dfbdcc173e2b51f8c"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; sha3Uncles: </span><span style="color:#2fb41d;">"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; size: </span><span style="color:#b42419;">720</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; stateRoot: </span><span style="color:#2fb41d;">"0x610d465c8aed0fbb8d026b15517f097e638d6a25d35d6de07f025139e6dd5891"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; timestamp: </span><span style="color:#b42419;">1533731373</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; totalDifficulty: </span><span style="color:#b42419;">84923387</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; transactions: [</span><span style="color:#2fb41d;">"0xb7c9929adc769db25ebdd75b8e81d489fd679f5a9fce7152ae6fb3304b0ff4df"</span><span style="color:#000000;">],</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; transactionsRoot: </span><span style="color:#2fb41d;">"0x863eb81e2b1e9c6c4f039938a01b26c61c9b0138636b5df3a2a10e2c9511ab39"</span><span style="color:#000000;">,</span></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">&nbsp; uncles: []</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">}</span></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">input</span><span style="color:#000000;">如下，每两个为一位，可知</span><span style="color:#000000;">64</span><span style="color:#000000;">位非零和</span><span style="color:#000000;">1</span><span style="color:#000000;">位</span><span style="color:#000000;">0</span><span style="color:#000000;">值</span></p> 
  <p style="margin-left:0cm;"><span style="color:#587647;">0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c</span></p> 
  <p style="margin-left:0cm;"><span style="color:#000000;">总交易</span><span style="color:#000000;">gas</span><span style="color:#000000;">：</span></p> 
  <p style="margin-left:0cm;"><strong>25356 = </strong><strong>交易费</strong><strong> + data</strong><strong>处理费</strong></p> 
  <p style="margin-left:0cm;"><strong>input: 65</strong><strong>字节：其中非零字节</strong><strong> 64</strong><strong>个，</strong></p> 
  <p style="margin-left:0cm;"><strong>=</strong><strong>》</strong><strong> 25356 = 21000</strong><strong>（一笔交易）</strong><strong>+ 64</strong><strong>（位，</strong><strong>data</strong><strong>加密数据长度）</strong><strong>*68+4</strong></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><strong>例</strong><strong>3 </strong><strong>输入一笔全</strong><strong>0</strong><strong>交易数据</strong></p> 
  <p style="margin-left:0cm;"><strong>估计：</strong><strong>25356</strong><strong>，使用</strong><strong>21260</strong><strong>；</strong></p> 
  <p style="margin-left:0cm;"><strong>21260=21000 + 4*65</strong></p> 
  <p style="margin-left:0cm;"><strong>{blockHash: '0x9b08fe576261f95423cdfbb000c30148b1774a63664398226727fac34f0fcaa7',</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; blockNumber: 708,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; contractAddress: null,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; cumulativeGasUsed: 21260,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; from: '0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4',</strong></p> 
  <p style="margin-left:0cm;"><strong><span style="color:#ff0000;">&nbsp; gasUsed: 21260,</span></strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; logs: [],</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; ……</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp;}</strong></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><strong>例</strong><strong>4 </strong><strong>输入一笔全</strong><strong>1</strong><strong>交易数据（数据长度</strong><strong>130</strong><strong>）</strong></p> 
  <p style="margin-left:0cm;"><strong>data: "0x1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"</strong></p> 
  <p style="margin-left:0cm;"><strong>估计：</strong><strong>25356</strong><strong>，使用</strong><strong>25420</strong><strong>；</strong></p> 
  <p style="margin-left:0cm;"><strong>21260=21000 + 68*65</strong><strong>（位）</strong><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong></p> 
  <p style="margin-left:0cm;"><strong>{ blockHash: '0x60dcd93e9dc191b402b63e967dd1dddd3aa2a354fcf7610b46e6f1001e5cb9d2',</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; blockNumber: 2990,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; contractAddress: null,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; cumulativeGasUsed: 25420,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; from: '0x04a78a0ef3d868fdb9d7532c8b1ef7f49167f5a4',</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; gasUsed: 25420,</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; logs: [],</strong></p> 
  <p style="margin-left:0cm;"><strong>&nbsp; ……</strong></p> 
  <p style="margin-left:0cm;"><strong>}</strong></p> 
  <p style="margin-left:0cm;">测试data：</p> 
  <p>0x1a fe 5c ac1 bc b7 ec de 4c 3a 22 c3 69 7f 13 d0 eb a8 d7 1b fd 5d 4e 7b b7 3f a1 0a 48 a7 3a 81 87 61 27 21 4a b4 c2 d2 a1 e0 e6 76 30 08 13 99 b8 20 6f 2e 1a 0c f7 60 d8 96 c0 6a 76 6d 0f b1 b&nbsp; &nbsp;&nbsp;</p> 
  <p>0xb0 3b 0e c3 35 24 58 bc 09 ac 9f a8 da d4 e9 18 79 80 e6 bb 64 3f 4e 58 fa 38 53 7b 02 cb b9 7b 4b 0a 70 51 59 f4 7e 07 05 e7 e2 1c 4d 42 a4 87 80 ea 2d 76 b6 c3 9a cb 07 98 00 44 18 65 60 ea 1c&nbsp; &nbsp; &nbsp;</p> 
  <p>&nbsp;0x3b84a 8047e ae293 4fca2 dcb3c f6119 11ae8 7630f 194e1 a8ccc 9b20c 0bae5 0c570 04220 cf26e 928da e5505 8bd2c fc2e3 b54fe f7a73 53173 08687 23948 e93cf 9911c&nbsp; &nbsp;&nbsp;</p> 
  <p>0x1000 00010 0000 00100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 0100 0000 01</p> 
  <p>0x3b 84 a8 04 7e ae 29 34 fc a2 dc b3 cf 61 19 11 ae 87 63 0f 19 4e 1a 8c cc 9b 20 c0 ba e5 0c 57 00 42 20 cf 26 e9 28 da e5 50 58 bd 2c fc 2e 3b 54 fe f7 a7 35 31 73 08 68 72 39 48 e9 3c f9 91 1c</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/dwjpeng2/article/details/81536753,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/dwjpeng2/article/details/81536753,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用react开发dapp应用实战-宠物认领 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用react开发dapp应用实战-宠物认领" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="阅读本文前，你应该对以太坊、智能合约有所了解，如果你还不了解，建议你先看以太坊是什么 除此之外，你最好还了解一些react知识。 本文通过实例教大家来开发去中心化应用，应用效果如图： &nbsp; 从本文，你可以学习到： 搭建智能合约开发环境 创建Truffle项目 编写智能合约 编译和部署智能合约到区块链 如何通过Web3和智能合约交互 MetaMask 的使用 &nbsp; 项目背景 Pet有一个宠物店，有16只宠物，他想开发一个去中心化应用，让大家来领养宠物。 在truffle box中，已经提供了pet-shop的网站部分的代码和react框架，我们只需要编写合约及交互部分。 环境搭建 安装Node 安装 Truffle ：npm install -g truffle 安装Ganache 创建项目 建立项目目录并进入 mkdir pet-shop-react cd pet-shop-react 使用truffle unbox 创建项目 &gt; truffle unbox react-box Downloading... Unpacking... Setting up... Unbox successful. Sweet! &nbsp; Commands: &nbsp; Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test Test dapp: npm test Run dev server: npm run start Build for production: npm run build &nbsp; &nbsp; 也可以使用truffle init 来创建一个全新的项目。 项目目录结构 contracts/&nbsp;智能合约的文件夹，所有的智能合约文件都放置在这里，里面包含一个重要的合约Migrations.sol（稍后再讲） migrations/&nbsp;用来处理部署（迁移）智能合约 ，迁移是一个额外特别的合约用来保存合约的变化。 test/&nbsp;智能合约测试用例文件夹 truffle.js/&nbsp;配置文件 src/&nbsp;前端业务文件夹 build/&nbsp;合约编译后存放文件夹 &nbsp; &nbsp; 编写智能合约 智能合约承担着分布式应用的后台逻辑和存储。智能合约使用solidity编写，可阅读 solidity系列文章 在contracts目录下，添加合约文件Adoption.sol &nbsp; pragma solidity ^0.4.17; &nbsp; contract Adoption { address[16] public adopters; // 保存领养者的地址 // 领养宠物 function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); // 确保id在数组长度内 &nbsp; adopters[petId] = msg.sender; // 保存调用这地址 return petId; } // 返回领养者 function getAdopters() public view returns (address[16]) { return adopters; } } &nbsp; 智能合约 Truffle集成了一个开发者控制台，可用来生成一个开发链用来测试和部署智能合约。 编译 Solidity是编译型语言，需要把可读的Solidity代码编译为EVM字节码才能运行。 &gt; truffle compile &nbsp; Compiling ./contracts/Adoption.sol... Compiling ./contracts/Migrations.sol... Compiling ./contracts/SimpleStorage.sol... Writing artifacts to ./build/contracts &nbsp; 部署 编译之后，就可以部署到区块链上。 在migrations文件夹下已经有一个1_initial_migration.js部署脚本，用来部署Migrations.sol合约。 Migrations.sol 用来确保不会部署相同的合约。 现在我们来创建一个自己的部署脚本3_deploy_contracts.js var Adoption = artifacts.require(&quot;./Adoption.sol&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; &nbsp; 启动Ganache: &nbsp; 修改truffle.js 文件： module.exports = { // See &lt;http://truffleframework.com/docs/advanced/configuration&gt; networks: { development: { host: &quot;localhost&quot;, port: 7545, network_id: &quot;*&quot; // Match any network id } } }; &nbsp; 部署 truffle migrate &nbsp; Using network &#39;development&#39;. &nbsp; Running migration: 1_initial_migration.js Replacing Migrations... ... 0xb7a9652d5fd73a7df1703c874e4fc510f5b714fb61203ada3931babfd7f3cb25 Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Replacing SimpleStorage... ... 0x989a1bf7b17292d05bc5fbc5a70d27d2b002ba2d0265d366f836f619763a733e SimpleStorage: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Saving successful migration to network... ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0 Saving artifacts... Running migration: 3_deploy_contracts.js Deploying Adoption... ... 0xda3a44984cadaf6481a4b462c495b6dbdc3ab77592de062ac3d286c24e6fd1ec Adoption: 0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f Saving successful migration to network... ... 0x55b13865c62964c3b211dd22c1106101855e698e00dbf6d21aad05d6707cf626 Saving artifacts... 到上面为止服务器端就开发完成。 &nbsp; React编写页面 在src目录下，创建components和images文件夹 cd src mkdir components mkdir images &nbsp; 在util编写公共方法 getTransactionReceiptMined.js: module.exports = function getTransactionReceiptMined(txHash, interval) { const self = this; const transactionReceiptAsync = function(resolve, reject) { self.getTransactionReceipt(txHash, (error, receipt) =&gt; { if (error) { reject(error); } else if (receipt == null) { setTimeout( () =&gt; transactionReceiptAsync(resolve, reject), interval ? interval : 500); } else { resolve(receipt); } }); }; &nbsp; if (Array.isArray(txHash)) { return Promise.all(txHash.map( oneTxHash =&gt; self.getTransactionReceiptMined(oneTxHash, interval))); } else if (typeof txHash === &quot;string&quot;) { return new Promise(transactionReceiptAsync); } else { throw new Error(&quot;Invalid Type: &quot; + txHash); } }; &nbsp; isAdopted.js: export default function isAdopted(adopter) { return adopter !== &#39;0x0000000000000000000000000000000000000000&#39;; } &nbsp; 将官方的pet shop中image下图片拷贝到image目录 &nbsp; 创建dogImageMap.js文件： import boxer from &#39;./images/boxer.jpeg&#39;; import frenchBulldog from &#39;./images/french-bulldog.jpeg&#39;; import goldenRetriever from &#39;./images/golden-retriever.jpeg&#39;; import scottishTerrier from &#39;./images/scottish-terrier.jpeg&#39;; &nbsp; &nbsp; export default function dogImageMap(path) { switch(path) { case &#39;images/boxer.jpeg&#39;: { return boxer; } &nbsp; case &#39;images/french-bulldog.jpeg&#39;: { return frenchBulldog; } &nbsp; case &#39;images/golden-retriever.jpeg&#39;: { return goldenRetriever; } &nbsp; default: { return scottishTerrier; } } } &nbsp; 在compents文件下创建Pet.js import React, { Component } from &#39;react&#39;; import PropTypes from &#39;prop-types&#39;; import dogImageMap from &#39;../dogImageMap&#39;; import isAdopted from &#39;../utils/isAdopted&#39;; &nbsp; class Pet extends Component { constructor(props) { super(props); &nbsp; this.state = { pending: false, } } &nbsp; render() { const { pet, adopter, index, } = this.props; &nbsp; return ( &lt;div className=&quot;panel-body&quot;&gt; &lt;img alt=&quot;140x140&quot; data-src=&quot;holder.js/140x140&quot; className=&quot;img-rounded img-center&quot; style={{ width: &#39;100%&#39; }} src={dogImageMap(pet.picture)} data-holder-rendered=&quot;true&quot; /&gt; &lt;strong&gt;Breed&lt;/strong&gt;: &lt;span className=&quot;pet-breed&quot;&gt;{pet.breed}&lt;/span&gt;&lt;br/&gt; &lt;strong&gt;Age&lt;/strong&gt;: &lt;span className=&quot;pet-age&quot;&gt;{pet.age}&lt;/span&gt;&lt;br/&gt; &lt;strong&gt;Location&lt;/strong&gt;: &lt;span className=&quot;pet-location&quot;&gt;{pet.location}&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;button className=&quot;btn btn-default btn-adopt&quot; type=&quot;button&quot; disabled={isAdopted(adopter)} onClick={() =&gt; this.props.adoptPet(index)} &gt; { isAdopted(adopter) ? &#39;Success&#39; : &#39;Adopt&#39; } &lt;/button&gt; &lt;br /&gt; &lt;strong&gt;Owner: {(adopter)}&lt;/strong&gt; &lt;/div&gt; ); } } &nbsp; Pet.propTypes = { pet: PropTypes.object, adopters: PropTypes.string, index: PropTypes.number.isRequired, adoptPet: PropTypes.func.isRequired, } &nbsp; export default Pet; &nbsp; 创建pets.js: export const petsArray = [ { &quot;id&quot;: 0, &quot;name&quot;: &quot;Frieda&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Lisco, Alabama&quot; }, { &quot;id&quot;: 1, &quot;name&quot;: &quot;Gina&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Tooleville, West Virginia&quot; }, { &quot;id&quot;: 2, &quot;name&quot;: &quot;Collins&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Freeburn, Idaho&quot; }, { &quot;id&quot;: 3, &quot;name&quot;: &quot;Melissa&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Camas, Pennsylvania&quot; }, { &quot;id&quot;: 4, &quot;name&quot;: &quot;Jeanine&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Gerber, South Dakota&quot; }, { &quot;id&quot;: 5, &quot;name&quot;: &quot;Elvia&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Innsbrook, Illinois&quot; }, { &quot;id&quot;: 6, &quot;name&quot;: &quot;Latisha&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Soudan, Louisiana&quot; }, { &quot;id&quot;: 7, &quot;name&quot;: &quot;Coleman&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Jacksonwald, Palau&quot; }, { &quot;id&quot;: 8, &quot;name&quot;: &quot;Nichole&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Honolulu, Hawaii&quot; }, { &quot;id&quot;: 9, &quot;name&quot;: &quot;Fran&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Matheny, Utah&quot; }, { &quot;id&quot;: 10, &quot;name&quot;: &quot;Leonor&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Tyhee, Indiana&quot; }, { &quot;id&quot;: 11, &quot;name&quot;: &quot;Dean&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Windsor, Montana&quot; }, { &quot;id&quot;: 12, &quot;name&quot;: &quot;Stevenson&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Kingstowne, Nevada&quot; }, { &quot;id&quot;: 13, &quot;name&quot;: &quot;Kristina&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 4, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Sultana, Massachusetts&quot; }, { &quot;id&quot;: 14, &quot;name&quot;: &quot;Ethel&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Broadlands, Oregon&quot; }, { &quot;id&quot;: 15, &quot;name&quot;: &quot;Terry&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Dawn, Wisconsin&quot; } ] &nbsp; 修改app.js文件： import React from &#39;react&#39; import _ from &#39;lodash&#39;; import AdoptionContract from &#39;../build/contracts/Adoption.json&#39; import { petsArray } from &#39;./pets.js&#39;; import getWeb3 from &#39;./utils/getWeb3&#39; import Pet from &#39;./components/Pet&#39;; import &#39;./css/oswald.css&#39; import &#39;./css/open-sans.css&#39; import &#39;./css/pure-min.css&#39; import &#39;./App.css&#39; &nbsp; class App extends React.Component { constructor(props) { super(props) &nbsp; this.state = { web3: {}, adoptionContract: null, pets: [], adopters: [], blockNumber: null, } &nbsp; this.adoptPet = this.adoptPet.bind(this); this.getBlockNumber = this.getBlockNumber.bind(this); } &nbsp; componentWillMount() { getWeb3 .then(results =&gt; { this.setState({ web3: results.web3 }, () =&gt; { this.getBlockNumber() this.instantiateContract() this.fetchPets(); }); }) .catch(() =&gt; { console.log(&#39;Error finding web3.&#39;) }) } &nbsp; getBlockNumber() { this.state.web3.eth.getBlockNumber((error, block) =&gt; { this.setState({ blockNumber: block }); }); } &nbsp; fetchPets() { this.setState({ pets: petsArray }); } &nbsp; adoptPet(item) { const { adoptionContract } = this.state; const newAdopters = this.state.adopters; &nbsp; this.state.web3.eth.getAccounts((error, accounts) =&gt; { adoptionContract.deployed().then((instance) =&gt; { return instance.adopt(item, { from: accounts[0]}) .then((result) =&gt; { this.state.web3.eth.getTransactionReceiptMined(result.tx) .then((newResult) =&gt; { newAdopters[item] = accounts[0]; this.setState({ blockNumber: newResult.blockNumber, adopters: newAdopters }) }); }) .catch((err) =&gt; { console.log(err.message); }) }); }); } &nbsp; instantiateContract() { const contract = require(&#39;truffle-contract&#39;) const adoption = contract(AdoptionContract); adoption.setProvider(this.state.web3.currentProvider) &nbsp; adoption.deployed().then((instance) =&gt; { return instance.getAdopters.call().then((result) =&gt; { this.setState({ adopters: result, adoptionContract: adoption }); }); }); } &nbsp; render() { const { pets, adopters } = this.state &nbsp; return ( &lt;div className=&quot;App&quot;&gt; &lt;div className=&quot;container&quot;&gt; &lt;div className=&quot;row&quot;&gt; &lt;div className=&quot;col-xs-12 col-sm-8 col-sm-push-2&quot;&gt; &lt;h1 className=&quot;text-center&quot;&gt;Pete&#39;s Pet Shop&lt;/h1&gt; &lt;hr/&gt; &lt;br/&gt; &lt;/div&gt; &lt;/div&gt; &nbsp; &lt;div id=&quot;petsRow&quot; className=&quot;row&quot;&gt; { _.map(pets, (pet, index) =&gt; { return ( &lt;div className=&quot;col-sm-6 col-md-4 col-lg-3&quot; key={index}&gt; &lt;div className=&quot;panel panel-default panel-pet&quot;&gt; &lt;div className=&quot;panel-heading&quot;&gt; &lt;h3 className=&quot;panel-title&quot;&gt;{pet.name}&lt;/h3&gt; &lt;/div&gt; &lt;/div&gt; &lt;Pet pet={pet} adopter={adopters[index]} index={index} adoptPet={this.adoptPet} /&gt; &lt;/div&gt; ) }) } &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; ); } } &nbsp; export default App &nbsp; &nbsp; 修改utils下getWeb3.js文件到url路径到7454端口。 import Web3 from &#39;web3&#39; import getTransactionReceiptMined from &#39;./getTransactionReceiptMined&#39;; let getWeb3 = new Promise(function(resolve, reject) { // Wait for loading completion to avoid race conditions with web3 injection timing. window.addEventListener(&#39;load&#39;, function() { var results var web3 = window.web3 &nbsp; // Checking if Web3 has been injected by the browser (Mist/MetaMask) if (typeof web3 !== &#39;undefined&#39;) { // Use Mist/MetaMask&#39;s provider. web3 = new Web3(web3.currentProvider) web3.eth.getTransactionReceiptMined = getTransactionReceiptMined; results = { web3: web3 } &nbsp; console.log(&#39;Injected web3 detected.&#39;); &nbsp; resolve(results) } else { // Fallback to localhost if no web3 injection. We&#39;ve configured this to // use the development console&#39;s port by default. var provider = new Web3.providers.HttpProvider(&#39;http://127.0.0.1:7545&#39;) &nbsp; web3 = new Web3(provider) &nbsp; results = { web3: web3 } &nbsp; console.log(&#39;No web3 instance injected, using Local web3.&#39;); &nbsp; resolve(results) } }) }) &nbsp; export default getWeb3 &nbsp; 由于copy官方例子，使用了bootstrap.mini.css 将css放入到public文件夹中，并修改index.html,加上下面这句话： &lt;link href=&quot;%PUBLIC_URL%/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &nbsp; 运行： yarn run start &nbsp; 在浏览器中运行 安装 MetaMask MetaMask 是一款插件形式的以太坊轻客户端，开发过程中使用MetaMask和我们的dapp进行交互是个很好的选择，通过此链接安装，安装完成后，浏览器工具条会显示一个小狐狸图标。 配置钱包 在接受隐私说明后，会出现页面如下： 这里我们通过还原一个Ganache为我们创建好的钱包，作为我们的开发测试钱包。点击页面的Import Existing DEN，输入Ganache显示的助记词。 candy maple cake sugar pudding cream honey rich smooth crumble sweet treat 然后自己想要的密码，点击OK。 如图： 连接开发区块链网络 默认连接的是以太坊主网（左上角显示），选择Custom RPC，添加一个网络：http://127.0.0.1:7545，点返回后，显示如下： &nbsp; 这是左上角显示为Private Network，账号是Ganache中默认的第一个账号。 注意 在交易时候 请注意保持metamask保持活跃状态。 &nbsp; &nbsp; 点击领取。 &nbsp; &nbsp; 成功： &nbsp; &nbsp; 感谢Tiny熊和kkomaz,pet shop 相关文章。https://blog.csdn.net/yuanfangyuan_block/article/details/79412830 阅读更多" />
<meta property="og:description" content="阅读本文前，你应该对以太坊、智能合约有所了解，如果你还不了解，建议你先看以太坊是什么 除此之外，你最好还了解一些react知识。 本文通过实例教大家来开发去中心化应用，应用效果如图： &nbsp; 从本文，你可以学习到： 搭建智能合约开发环境 创建Truffle项目 编写智能合约 编译和部署智能合约到区块链 如何通过Web3和智能合约交互 MetaMask 的使用 &nbsp; 项目背景 Pet有一个宠物店，有16只宠物，他想开发一个去中心化应用，让大家来领养宠物。 在truffle box中，已经提供了pet-shop的网站部分的代码和react框架，我们只需要编写合约及交互部分。 环境搭建 安装Node 安装 Truffle ：npm install -g truffle 安装Ganache 创建项目 建立项目目录并进入 mkdir pet-shop-react cd pet-shop-react 使用truffle unbox 创建项目 &gt; truffle unbox react-box Downloading... Unpacking... Setting up... Unbox successful. Sweet! &nbsp; Commands: &nbsp; Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test Test dapp: npm test Run dev server: npm run start Build for production: npm run build &nbsp; &nbsp; 也可以使用truffle init 来创建一个全新的项目。 项目目录结构 contracts/&nbsp;智能合约的文件夹，所有的智能合约文件都放置在这里，里面包含一个重要的合约Migrations.sol（稍后再讲） migrations/&nbsp;用来处理部署（迁移）智能合约 ，迁移是一个额外特别的合约用来保存合约的变化。 test/&nbsp;智能合约测试用例文件夹 truffle.js/&nbsp;配置文件 src/&nbsp;前端业务文件夹 build/&nbsp;合约编译后存放文件夹 &nbsp; &nbsp; 编写智能合约 智能合约承担着分布式应用的后台逻辑和存储。智能合约使用solidity编写，可阅读 solidity系列文章 在contracts目录下，添加合约文件Adoption.sol &nbsp; pragma solidity ^0.4.17; &nbsp; contract Adoption { address[16] public adopters; // 保存领养者的地址 // 领养宠物 function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); // 确保id在数组长度内 &nbsp; adopters[petId] = msg.sender; // 保存调用这地址 return petId; } // 返回领养者 function getAdopters() public view returns (address[16]) { return adopters; } } &nbsp; 智能合约 Truffle集成了一个开发者控制台，可用来生成一个开发链用来测试和部署智能合约。 编译 Solidity是编译型语言，需要把可读的Solidity代码编译为EVM字节码才能运行。 &gt; truffle compile &nbsp; Compiling ./contracts/Adoption.sol... Compiling ./contracts/Migrations.sol... Compiling ./contracts/SimpleStorage.sol... Writing artifacts to ./build/contracts &nbsp; 部署 编译之后，就可以部署到区块链上。 在migrations文件夹下已经有一个1_initial_migration.js部署脚本，用来部署Migrations.sol合约。 Migrations.sol 用来确保不会部署相同的合约。 现在我们来创建一个自己的部署脚本3_deploy_contracts.js var Adoption = artifacts.require(&quot;./Adoption.sol&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; &nbsp; 启动Ganache: &nbsp; 修改truffle.js 文件： module.exports = { // See &lt;http://truffleframework.com/docs/advanced/configuration&gt; networks: { development: { host: &quot;localhost&quot;, port: 7545, network_id: &quot;*&quot; // Match any network id } } }; &nbsp; 部署 truffle migrate &nbsp; Using network &#39;development&#39;. &nbsp; Running migration: 1_initial_migration.js Replacing Migrations... ... 0xb7a9652d5fd73a7df1703c874e4fc510f5b714fb61203ada3931babfd7f3cb25 Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Replacing SimpleStorage... ... 0x989a1bf7b17292d05bc5fbc5a70d27d2b002ba2d0265d366f836f619763a733e SimpleStorage: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Saving successful migration to network... ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0 Saving artifacts... Running migration: 3_deploy_contracts.js Deploying Adoption... ... 0xda3a44984cadaf6481a4b462c495b6dbdc3ab77592de062ac3d286c24e6fd1ec Adoption: 0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f Saving successful migration to network... ... 0x55b13865c62964c3b211dd22c1106101855e698e00dbf6d21aad05d6707cf626 Saving artifacts... 到上面为止服务器端就开发完成。 &nbsp; React编写页面 在src目录下，创建components和images文件夹 cd src mkdir components mkdir images &nbsp; 在util编写公共方法 getTransactionReceiptMined.js: module.exports = function getTransactionReceiptMined(txHash, interval) { const self = this; const transactionReceiptAsync = function(resolve, reject) { self.getTransactionReceipt(txHash, (error, receipt) =&gt; { if (error) { reject(error); } else if (receipt == null) { setTimeout( () =&gt; transactionReceiptAsync(resolve, reject), interval ? interval : 500); } else { resolve(receipt); } }); }; &nbsp; if (Array.isArray(txHash)) { return Promise.all(txHash.map( oneTxHash =&gt; self.getTransactionReceiptMined(oneTxHash, interval))); } else if (typeof txHash === &quot;string&quot;) { return new Promise(transactionReceiptAsync); } else { throw new Error(&quot;Invalid Type: &quot; + txHash); } }; &nbsp; isAdopted.js: export default function isAdopted(adopter) { return adopter !== &#39;0x0000000000000000000000000000000000000000&#39;; } &nbsp; 将官方的pet shop中image下图片拷贝到image目录 &nbsp; 创建dogImageMap.js文件： import boxer from &#39;./images/boxer.jpeg&#39;; import frenchBulldog from &#39;./images/french-bulldog.jpeg&#39;; import goldenRetriever from &#39;./images/golden-retriever.jpeg&#39;; import scottishTerrier from &#39;./images/scottish-terrier.jpeg&#39;; &nbsp; &nbsp; export default function dogImageMap(path) { switch(path) { case &#39;images/boxer.jpeg&#39;: { return boxer; } &nbsp; case &#39;images/french-bulldog.jpeg&#39;: { return frenchBulldog; } &nbsp; case &#39;images/golden-retriever.jpeg&#39;: { return goldenRetriever; } &nbsp; default: { return scottishTerrier; } } } &nbsp; 在compents文件下创建Pet.js import React, { Component } from &#39;react&#39;; import PropTypes from &#39;prop-types&#39;; import dogImageMap from &#39;../dogImageMap&#39;; import isAdopted from &#39;../utils/isAdopted&#39;; &nbsp; class Pet extends Component { constructor(props) { super(props); &nbsp; this.state = { pending: false, } } &nbsp; render() { const { pet, adopter, index, } = this.props; &nbsp; return ( &lt;div className=&quot;panel-body&quot;&gt; &lt;img alt=&quot;140x140&quot; data-src=&quot;holder.js/140x140&quot; className=&quot;img-rounded img-center&quot; style={{ width: &#39;100%&#39; }} src={dogImageMap(pet.picture)} data-holder-rendered=&quot;true&quot; /&gt; &lt;strong&gt;Breed&lt;/strong&gt;: &lt;span className=&quot;pet-breed&quot;&gt;{pet.breed}&lt;/span&gt;&lt;br/&gt; &lt;strong&gt;Age&lt;/strong&gt;: &lt;span className=&quot;pet-age&quot;&gt;{pet.age}&lt;/span&gt;&lt;br/&gt; &lt;strong&gt;Location&lt;/strong&gt;: &lt;span className=&quot;pet-location&quot;&gt;{pet.location}&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;button className=&quot;btn btn-default btn-adopt&quot; type=&quot;button&quot; disabled={isAdopted(adopter)} onClick={() =&gt; this.props.adoptPet(index)} &gt; { isAdopted(adopter) ? &#39;Success&#39; : &#39;Adopt&#39; } &lt;/button&gt; &lt;br /&gt; &lt;strong&gt;Owner: {(adopter)}&lt;/strong&gt; &lt;/div&gt; ); } } &nbsp; Pet.propTypes = { pet: PropTypes.object, adopters: PropTypes.string, index: PropTypes.number.isRequired, adoptPet: PropTypes.func.isRequired, } &nbsp; export default Pet; &nbsp; 创建pets.js: export const petsArray = [ { &quot;id&quot;: 0, &quot;name&quot;: &quot;Frieda&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Lisco, Alabama&quot; }, { &quot;id&quot;: 1, &quot;name&quot;: &quot;Gina&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Tooleville, West Virginia&quot; }, { &quot;id&quot;: 2, &quot;name&quot;: &quot;Collins&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Freeburn, Idaho&quot; }, { &quot;id&quot;: 3, &quot;name&quot;: &quot;Melissa&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Camas, Pennsylvania&quot; }, { &quot;id&quot;: 4, &quot;name&quot;: &quot;Jeanine&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Gerber, South Dakota&quot; }, { &quot;id&quot;: 5, &quot;name&quot;: &quot;Elvia&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Innsbrook, Illinois&quot; }, { &quot;id&quot;: 6, &quot;name&quot;: &quot;Latisha&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Soudan, Louisiana&quot; }, { &quot;id&quot;: 7, &quot;name&quot;: &quot;Coleman&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Jacksonwald, Palau&quot; }, { &quot;id&quot;: 8, &quot;name&quot;: &quot;Nichole&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Honolulu, Hawaii&quot; }, { &quot;id&quot;: 9, &quot;name&quot;: &quot;Fran&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Matheny, Utah&quot; }, { &quot;id&quot;: 10, &quot;name&quot;: &quot;Leonor&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Tyhee, Indiana&quot; }, { &quot;id&quot;: 11, &quot;name&quot;: &quot;Dean&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Windsor, Montana&quot; }, { &quot;id&quot;: 12, &quot;name&quot;: &quot;Stevenson&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Kingstowne, Nevada&quot; }, { &quot;id&quot;: 13, &quot;name&quot;: &quot;Kristina&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 4, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Sultana, Massachusetts&quot; }, { &quot;id&quot;: 14, &quot;name&quot;: &quot;Ethel&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Broadlands, Oregon&quot; }, { &quot;id&quot;: 15, &quot;name&quot;: &quot;Terry&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Dawn, Wisconsin&quot; } ] &nbsp; 修改app.js文件： import React from &#39;react&#39; import _ from &#39;lodash&#39;; import AdoptionContract from &#39;../build/contracts/Adoption.json&#39; import { petsArray } from &#39;./pets.js&#39;; import getWeb3 from &#39;./utils/getWeb3&#39; import Pet from &#39;./components/Pet&#39;; import &#39;./css/oswald.css&#39; import &#39;./css/open-sans.css&#39; import &#39;./css/pure-min.css&#39; import &#39;./App.css&#39; &nbsp; class App extends React.Component { constructor(props) { super(props) &nbsp; this.state = { web3: {}, adoptionContract: null, pets: [], adopters: [], blockNumber: null, } &nbsp; this.adoptPet = this.adoptPet.bind(this); this.getBlockNumber = this.getBlockNumber.bind(this); } &nbsp; componentWillMount() { getWeb3 .then(results =&gt; { this.setState({ web3: results.web3 }, () =&gt; { this.getBlockNumber() this.instantiateContract() this.fetchPets(); }); }) .catch(() =&gt; { console.log(&#39;Error finding web3.&#39;) }) } &nbsp; getBlockNumber() { this.state.web3.eth.getBlockNumber((error, block) =&gt; { this.setState({ blockNumber: block }); }); } &nbsp; fetchPets() { this.setState({ pets: petsArray }); } &nbsp; adoptPet(item) { const { adoptionContract } = this.state; const newAdopters = this.state.adopters; &nbsp; this.state.web3.eth.getAccounts((error, accounts) =&gt; { adoptionContract.deployed().then((instance) =&gt; { return instance.adopt(item, { from: accounts[0]}) .then((result) =&gt; { this.state.web3.eth.getTransactionReceiptMined(result.tx) .then((newResult) =&gt; { newAdopters[item] = accounts[0]; this.setState({ blockNumber: newResult.blockNumber, adopters: newAdopters }) }); }) .catch((err) =&gt; { console.log(err.message); }) }); }); } &nbsp; instantiateContract() { const contract = require(&#39;truffle-contract&#39;) const adoption = contract(AdoptionContract); adoption.setProvider(this.state.web3.currentProvider) &nbsp; adoption.deployed().then((instance) =&gt; { return instance.getAdopters.call().then((result) =&gt; { this.setState({ adopters: result, adoptionContract: adoption }); }); }); } &nbsp; render() { const { pets, adopters } = this.state &nbsp; return ( &lt;div className=&quot;App&quot;&gt; &lt;div className=&quot;container&quot;&gt; &lt;div className=&quot;row&quot;&gt; &lt;div className=&quot;col-xs-12 col-sm-8 col-sm-push-2&quot;&gt; &lt;h1 className=&quot;text-center&quot;&gt;Pete&#39;s Pet Shop&lt;/h1&gt; &lt;hr/&gt; &lt;br/&gt; &lt;/div&gt; &lt;/div&gt; &nbsp; &lt;div id=&quot;petsRow&quot; className=&quot;row&quot;&gt; { _.map(pets, (pet, index) =&gt; { return ( &lt;div className=&quot;col-sm-6 col-md-4 col-lg-3&quot; key={index}&gt; &lt;div className=&quot;panel panel-default panel-pet&quot;&gt; &lt;div className=&quot;panel-heading&quot;&gt; &lt;h3 className=&quot;panel-title&quot;&gt;{pet.name}&lt;/h3&gt; &lt;/div&gt; &lt;/div&gt; &lt;Pet pet={pet} adopter={adopters[index]} index={index} adoptPet={this.adoptPet} /&gt; &lt;/div&gt; ) }) } &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; ); } } &nbsp; export default App &nbsp; &nbsp; 修改utils下getWeb3.js文件到url路径到7454端口。 import Web3 from &#39;web3&#39; import getTransactionReceiptMined from &#39;./getTransactionReceiptMined&#39;; let getWeb3 = new Promise(function(resolve, reject) { // Wait for loading completion to avoid race conditions with web3 injection timing. window.addEventListener(&#39;load&#39;, function() { var results var web3 = window.web3 &nbsp; // Checking if Web3 has been injected by the browser (Mist/MetaMask) if (typeof web3 !== &#39;undefined&#39;) { // Use Mist/MetaMask&#39;s provider. web3 = new Web3(web3.currentProvider) web3.eth.getTransactionReceiptMined = getTransactionReceiptMined; results = { web3: web3 } &nbsp; console.log(&#39;Injected web3 detected.&#39;); &nbsp; resolve(results) } else { // Fallback to localhost if no web3 injection. We&#39;ve configured this to // use the development console&#39;s port by default. var provider = new Web3.providers.HttpProvider(&#39;http://127.0.0.1:7545&#39;) &nbsp; web3 = new Web3(provider) &nbsp; results = { web3: web3 } &nbsp; console.log(&#39;No web3 instance injected, using Local web3.&#39;); &nbsp; resolve(results) } }) }) &nbsp; export default getWeb3 &nbsp; 由于copy官方例子，使用了bootstrap.mini.css 将css放入到public文件夹中，并修改index.html,加上下面这句话： &lt;link href=&quot;%PUBLIC_URL%/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &nbsp; 运行： yarn run start &nbsp; 在浏览器中运行 安装 MetaMask MetaMask 是一款插件形式的以太坊轻客户端，开发过程中使用MetaMask和我们的dapp进行交互是个很好的选择，通过此链接安装，安装完成后，浏览器工具条会显示一个小狐狸图标。 配置钱包 在接受隐私说明后，会出现页面如下： 这里我们通过还原一个Ganache为我们创建好的钱包，作为我们的开发测试钱包。点击页面的Import Existing DEN，输入Ganache显示的助记词。 candy maple cake sugar pudding cream honey rich smooth crumble sweet treat 然后自己想要的密码，点击OK。 如图： 连接开发区块链网络 默认连接的是以太坊主网（左上角显示），选择Custom RPC，添加一个网络：http://127.0.0.1:7545，点返回后，显示如下： &nbsp; 这是左上角显示为Private Network，账号是Ganache中默认的第一个账号。 注意 在交易时候 请注意保持metamask保持活跃状态。 &nbsp; &nbsp; 点击领取。 &nbsp; &nbsp; 成功： &nbsp; &nbsp; 感谢Tiny熊和kkomaz,pet shop 相关文章。https://blog.csdn.net/yuanfangyuan_block/article/details/79412830 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/08/03/9c2425085987809fbc4ba31b04ad32a4.html" />
<meta property="og:url" content="https://mlh.app/2018/08/03/9c2425085987809fbc4ba31b04ad32a4.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-03T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"阅读本文前，你应该对以太坊、智能合约有所了解，如果你还不了解，建议你先看以太坊是什么 除此之外，你最好还了解一些react知识。 本文通过实例教大家来开发去中心化应用，应用效果如图： &nbsp; 从本文，你可以学习到： 搭建智能合约开发环境 创建Truffle项目 编写智能合约 编译和部署智能合约到区块链 如何通过Web3和智能合约交互 MetaMask 的使用 &nbsp; 项目背景 Pet有一个宠物店，有16只宠物，他想开发一个去中心化应用，让大家来领养宠物。 在truffle box中，已经提供了pet-shop的网站部分的代码和react框架，我们只需要编写合约及交互部分。 环境搭建 安装Node 安装 Truffle ：npm install -g truffle 安装Ganache 创建项目 建立项目目录并进入 mkdir pet-shop-react cd pet-shop-react 使用truffle unbox 创建项目 &gt; truffle unbox react-box Downloading... Unpacking... Setting up... Unbox successful. Sweet! &nbsp; Commands: &nbsp; Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test Test dapp: npm test Run dev server: npm run start Build for production: npm run build &nbsp; &nbsp; 也可以使用truffle init 来创建一个全新的项目。 项目目录结构 contracts/&nbsp;智能合约的文件夹，所有的智能合约文件都放置在这里，里面包含一个重要的合约Migrations.sol（稍后再讲） migrations/&nbsp;用来处理部署（迁移）智能合约 ，迁移是一个额外特别的合约用来保存合约的变化。 test/&nbsp;智能合约测试用例文件夹 truffle.js/&nbsp;配置文件 src/&nbsp;前端业务文件夹 build/&nbsp;合约编译后存放文件夹 &nbsp; &nbsp; 编写智能合约 智能合约承担着分布式应用的后台逻辑和存储。智能合约使用solidity编写，可阅读 solidity系列文章 在contracts目录下，添加合约文件Adoption.sol &nbsp; pragma solidity ^0.4.17; &nbsp; contract Adoption { address[16] public adopters; // 保存领养者的地址 // 领养宠物 function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); // 确保id在数组长度内 &nbsp; adopters[petId] = msg.sender; // 保存调用这地址 return petId; } // 返回领养者 function getAdopters() public view returns (address[16]) { return adopters; } } &nbsp; 智能合约 Truffle集成了一个开发者控制台，可用来生成一个开发链用来测试和部署智能合约。 编译 Solidity是编译型语言，需要把可读的Solidity代码编译为EVM字节码才能运行。 &gt; truffle compile &nbsp; Compiling ./contracts/Adoption.sol... Compiling ./contracts/Migrations.sol... Compiling ./contracts/SimpleStorage.sol... Writing artifacts to ./build/contracts &nbsp; 部署 编译之后，就可以部署到区块链上。 在migrations文件夹下已经有一个1_initial_migration.js部署脚本，用来部署Migrations.sol合约。 Migrations.sol 用来确保不会部署相同的合约。 现在我们来创建一个自己的部署脚本3_deploy_contracts.js var Adoption = artifacts.require(&quot;./Adoption.sol&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; &nbsp; 启动Ganache: &nbsp; 修改truffle.js 文件： module.exports = { // See &lt;http://truffleframework.com/docs/advanced/configuration&gt; networks: { development: { host: &quot;localhost&quot;, port: 7545, network_id: &quot;*&quot; // Match any network id } } }; &nbsp; 部署 truffle migrate &nbsp; Using network &#39;development&#39;. &nbsp; Running migration: 1_initial_migration.js Replacing Migrations... ... 0xb7a9652d5fd73a7df1703c874e4fc510f5b714fb61203ada3931babfd7f3cb25 Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Replacing SimpleStorage... ... 0x989a1bf7b17292d05bc5fbc5a70d27d2b002ba2d0265d366f836f619763a733e SimpleStorage: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Saving successful migration to network... ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0 Saving artifacts... Running migration: 3_deploy_contracts.js Deploying Adoption... ... 0xda3a44984cadaf6481a4b462c495b6dbdc3ab77592de062ac3d286c24e6fd1ec Adoption: 0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f Saving successful migration to network... ... 0x55b13865c62964c3b211dd22c1106101855e698e00dbf6d21aad05d6707cf626 Saving artifacts... 到上面为止服务器端就开发完成。 &nbsp; React编写页面 在src目录下，创建components和images文件夹 cd src mkdir components mkdir images &nbsp; 在util编写公共方法 getTransactionReceiptMined.js: module.exports = function getTransactionReceiptMined(txHash, interval) { const self = this; const transactionReceiptAsync = function(resolve, reject) { self.getTransactionReceipt(txHash, (error, receipt) =&gt; { if (error) { reject(error); } else if (receipt == null) { setTimeout( () =&gt; transactionReceiptAsync(resolve, reject), interval ? interval : 500); } else { resolve(receipt); } }); }; &nbsp; if (Array.isArray(txHash)) { return Promise.all(txHash.map( oneTxHash =&gt; self.getTransactionReceiptMined(oneTxHash, interval))); } else if (typeof txHash === &quot;string&quot;) { return new Promise(transactionReceiptAsync); } else { throw new Error(&quot;Invalid Type: &quot; + txHash); } }; &nbsp; isAdopted.js: export default function isAdopted(adopter) { return adopter !== &#39;0x0000000000000000000000000000000000000000&#39;; } &nbsp; 将官方的pet shop中image下图片拷贝到image目录 &nbsp; 创建dogImageMap.js文件： import boxer from &#39;./images/boxer.jpeg&#39;; import frenchBulldog from &#39;./images/french-bulldog.jpeg&#39;; import goldenRetriever from &#39;./images/golden-retriever.jpeg&#39;; import scottishTerrier from &#39;./images/scottish-terrier.jpeg&#39;; &nbsp; &nbsp; export default function dogImageMap(path) { switch(path) { case &#39;images/boxer.jpeg&#39;: { return boxer; } &nbsp; case &#39;images/french-bulldog.jpeg&#39;: { return frenchBulldog; } &nbsp; case &#39;images/golden-retriever.jpeg&#39;: { return goldenRetriever; } &nbsp; default: { return scottishTerrier; } } } &nbsp; 在compents文件下创建Pet.js import React, { Component } from &#39;react&#39;; import PropTypes from &#39;prop-types&#39;; import dogImageMap from &#39;../dogImageMap&#39;; import isAdopted from &#39;../utils/isAdopted&#39;; &nbsp; class Pet extends Component { constructor(props) { super(props); &nbsp; this.state = { pending: false, } } &nbsp; render() { const { pet, adopter, index, } = this.props; &nbsp; return ( &lt;div className=&quot;panel-body&quot;&gt; &lt;img alt=&quot;140x140&quot; data-src=&quot;holder.js/140x140&quot; className=&quot;img-rounded img-center&quot; style={{ width: &#39;100%&#39; }} src={dogImageMap(pet.picture)} data-holder-rendered=&quot;true&quot; /&gt; &lt;strong&gt;Breed&lt;/strong&gt;: &lt;span className=&quot;pet-breed&quot;&gt;{pet.breed}&lt;/span&gt;&lt;br/&gt; &lt;strong&gt;Age&lt;/strong&gt;: &lt;span className=&quot;pet-age&quot;&gt;{pet.age}&lt;/span&gt;&lt;br/&gt; &lt;strong&gt;Location&lt;/strong&gt;: &lt;span className=&quot;pet-location&quot;&gt;{pet.location}&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;button className=&quot;btn btn-default btn-adopt&quot; type=&quot;button&quot; disabled={isAdopted(adopter)} onClick={() =&gt; this.props.adoptPet(index)} &gt; { isAdopted(adopter) ? &#39;Success&#39; : &#39;Adopt&#39; } &lt;/button&gt; &lt;br /&gt; &lt;strong&gt;Owner: {(adopter)}&lt;/strong&gt; &lt;/div&gt; ); } } &nbsp; Pet.propTypes = { pet: PropTypes.object, adopters: PropTypes.string, index: PropTypes.number.isRequired, adoptPet: PropTypes.func.isRequired, } &nbsp; export default Pet; &nbsp; 创建pets.js: export const petsArray = [ { &quot;id&quot;: 0, &quot;name&quot;: &quot;Frieda&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Lisco, Alabama&quot; }, { &quot;id&quot;: 1, &quot;name&quot;: &quot;Gina&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Tooleville, West Virginia&quot; }, { &quot;id&quot;: 2, &quot;name&quot;: &quot;Collins&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Freeburn, Idaho&quot; }, { &quot;id&quot;: 3, &quot;name&quot;: &quot;Melissa&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Camas, Pennsylvania&quot; }, { &quot;id&quot;: 4, &quot;name&quot;: &quot;Jeanine&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Gerber, South Dakota&quot; }, { &quot;id&quot;: 5, &quot;name&quot;: &quot;Elvia&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Innsbrook, Illinois&quot; }, { &quot;id&quot;: 6, &quot;name&quot;: &quot;Latisha&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Soudan, Louisiana&quot; }, { &quot;id&quot;: 7, &quot;name&quot;: &quot;Coleman&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Jacksonwald, Palau&quot; }, { &quot;id&quot;: 8, &quot;name&quot;: &quot;Nichole&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Honolulu, Hawaii&quot; }, { &quot;id&quot;: 9, &quot;name&quot;: &quot;Fran&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Matheny, Utah&quot; }, { &quot;id&quot;: 10, &quot;name&quot;: &quot;Leonor&quot;, &quot;picture&quot;: &quot;images/boxer.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Boxer&quot;, &quot;location&quot;: &quot;Tyhee, Indiana&quot; }, { &quot;id&quot;: 11, &quot;name&quot;: &quot;Dean&quot;, &quot;picture&quot;: &quot;images/scottish-terrier.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;Scottish Terrier&quot;, &quot;location&quot;: &quot;Windsor, Montana&quot; }, { &quot;id&quot;: 12, &quot;name&quot;: &quot;Stevenson&quot;, &quot;picture&quot;: &quot;images/french-bulldog.jpeg&quot;, &quot;age&quot;: 3, &quot;breed&quot;: &quot;French Bulldog&quot;, &quot;location&quot;: &quot;Kingstowne, Nevada&quot; }, { &quot;id&quot;: 13, &quot;name&quot;: &quot;Kristina&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 4, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Sultana, Massachusetts&quot; }, { &quot;id&quot;: 14, &quot;name&quot;: &quot;Ethel&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Broadlands, Oregon&quot; }, { &quot;id&quot;: 15, &quot;name&quot;: &quot;Terry&quot;, &quot;picture&quot;: &quot;images/golden-retriever.jpeg&quot;, &quot;age&quot;: 2, &quot;breed&quot;: &quot;Golden Retriever&quot;, &quot;location&quot;: &quot;Dawn, Wisconsin&quot; } ] &nbsp; 修改app.js文件： import React from &#39;react&#39; import _ from &#39;lodash&#39;; import AdoptionContract from &#39;../build/contracts/Adoption.json&#39; import { petsArray } from &#39;./pets.js&#39;; import getWeb3 from &#39;./utils/getWeb3&#39; import Pet from &#39;./components/Pet&#39;; import &#39;./css/oswald.css&#39; import &#39;./css/open-sans.css&#39; import &#39;./css/pure-min.css&#39; import &#39;./App.css&#39; &nbsp; class App extends React.Component { constructor(props) { super(props) &nbsp; this.state = { web3: {}, adoptionContract: null, pets: [], adopters: [], blockNumber: null, } &nbsp; this.adoptPet = this.adoptPet.bind(this); this.getBlockNumber = this.getBlockNumber.bind(this); } &nbsp; componentWillMount() { getWeb3 .then(results =&gt; { this.setState({ web3: results.web3 }, () =&gt; { this.getBlockNumber() this.instantiateContract() this.fetchPets(); }); }) .catch(() =&gt; { console.log(&#39;Error finding web3.&#39;) }) } &nbsp; getBlockNumber() { this.state.web3.eth.getBlockNumber((error, block) =&gt; { this.setState({ blockNumber: block }); }); } &nbsp; fetchPets() { this.setState({ pets: petsArray }); } &nbsp; adoptPet(item) { const { adoptionContract } = this.state; const newAdopters = this.state.adopters; &nbsp; this.state.web3.eth.getAccounts((error, accounts) =&gt; { adoptionContract.deployed().then((instance) =&gt; { return instance.adopt(item, { from: accounts[0]}) .then((result) =&gt; { this.state.web3.eth.getTransactionReceiptMined(result.tx) .then((newResult) =&gt; { newAdopters[item] = accounts[0]; this.setState({ blockNumber: newResult.blockNumber, adopters: newAdopters }) }); }) .catch((err) =&gt; { console.log(err.message); }) }); }); } &nbsp; instantiateContract() { const contract = require(&#39;truffle-contract&#39;) const adoption = contract(AdoptionContract); adoption.setProvider(this.state.web3.currentProvider) &nbsp; adoption.deployed().then((instance) =&gt; { return instance.getAdopters.call().then((result) =&gt; { this.setState({ adopters: result, adoptionContract: adoption }); }); }); } &nbsp; render() { const { pets, adopters } = this.state &nbsp; return ( &lt;div className=&quot;App&quot;&gt; &lt;div className=&quot;container&quot;&gt; &lt;div className=&quot;row&quot;&gt; &lt;div className=&quot;col-xs-12 col-sm-8 col-sm-push-2&quot;&gt; &lt;h1 className=&quot;text-center&quot;&gt;Pete&#39;s Pet Shop&lt;/h1&gt; &lt;hr/&gt; &lt;br/&gt; &lt;/div&gt; &lt;/div&gt; &nbsp; &lt;div id=&quot;petsRow&quot; className=&quot;row&quot;&gt; { _.map(pets, (pet, index) =&gt; { return ( &lt;div className=&quot;col-sm-6 col-md-4 col-lg-3&quot; key={index}&gt; &lt;div className=&quot;panel panel-default panel-pet&quot;&gt; &lt;div className=&quot;panel-heading&quot;&gt; &lt;h3 className=&quot;panel-title&quot;&gt;{pet.name}&lt;/h3&gt; &lt;/div&gt; &lt;/div&gt; &lt;Pet pet={pet} adopter={adopters[index]} index={index} adoptPet={this.adoptPet} /&gt; &lt;/div&gt; ) }) } &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; ); } } &nbsp; export default App &nbsp; &nbsp; 修改utils下getWeb3.js文件到url路径到7454端口。 import Web3 from &#39;web3&#39; import getTransactionReceiptMined from &#39;./getTransactionReceiptMined&#39;; let getWeb3 = new Promise(function(resolve, reject) { // Wait for loading completion to avoid race conditions with web3 injection timing. window.addEventListener(&#39;load&#39;, function() { var results var web3 = window.web3 &nbsp; // Checking if Web3 has been injected by the browser (Mist/MetaMask) if (typeof web3 !== &#39;undefined&#39;) { // Use Mist/MetaMask&#39;s provider. web3 = new Web3(web3.currentProvider) web3.eth.getTransactionReceiptMined = getTransactionReceiptMined; results = { web3: web3 } &nbsp; console.log(&#39;Injected web3 detected.&#39;); &nbsp; resolve(results) } else { // Fallback to localhost if no web3 injection. We&#39;ve configured this to // use the development console&#39;s port by default. var provider = new Web3.providers.HttpProvider(&#39;http://127.0.0.1:7545&#39;) &nbsp; web3 = new Web3(provider) &nbsp; results = { web3: web3 } &nbsp; console.log(&#39;No web3 instance injected, using Local web3.&#39;); &nbsp; resolve(results) } }) }) &nbsp; export default getWeb3 &nbsp; 由于copy官方例子，使用了bootstrap.mini.css 将css放入到public文件夹中，并修改index.html,加上下面这句话： &lt;link href=&quot;%PUBLIC_URL%/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &nbsp; 运行： yarn run start &nbsp; 在浏览器中运行 安装 MetaMask MetaMask 是一款插件形式的以太坊轻客户端，开发过程中使用MetaMask和我们的dapp进行交互是个很好的选择，通过此链接安装，安装完成后，浏览器工具条会显示一个小狐狸图标。 配置钱包 在接受隐私说明后，会出现页面如下： 这里我们通过还原一个Ganache为我们创建好的钱包，作为我们的开发测试钱包。点击页面的Import Existing DEN，输入Ganache显示的助记词。 candy maple cake sugar pudding cream honey rich smooth crumble sweet treat 然后自己想要的密码，点击OK。 如图： 连接开发区块链网络 默认连接的是以太坊主网（左上角显示），选择Custom RPC，添加一个网络：http://127.0.0.1:7545，点返回后，显示如下： &nbsp; 这是左上角显示为Private Network，账号是Ganache中默认的第一个账号。 注意 在交易时候 请注意保持metamask保持活跃状态。 &nbsp; &nbsp; 点击领取。 &nbsp; &nbsp; 成功： &nbsp; &nbsp; 感谢Tiny熊和kkomaz,pet shop 相关文章。https://blog.csdn.net/yuanfangyuan_block/article/details/79412830 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/08/03/9c2425085987809fbc4ba31b04ad32a4.html","headline":"使用react开发dapp应用实战-宠物认领","dateModified":"2018-08-03T00:00:00+08:00","datePublished":"2018-08-03T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/08/03/9c2425085987809fbc4ba31b04ad32a4.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用react开发dapp应用实战-宠物认领</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>阅读本文前，你应该对以太坊、智能合约有所了解，如果你还不了解，建议你先看<a href="https://learnblockchain.cn/2017/11/20/whatiseth/" rel="nofollow">以太坊是什么</a></p> 
  <p>除此之外，你最好还了解一些react知识。</p> 
  <p>本文通过实例教大家来开发去中心化应用，应用效果如图：</p> 
  <p><img alt="" class="has" src="http://note.youdao.com/yws/res/4721/3D8B5F9F36844F2F9F50EBF9FC0C909E"></p> 
  <p>&nbsp;</p> 
  <p>从本文，你可以学习到：</p> 
  <ul>
   <li>搭建智能合约开发环境</li> 
   <li>创建Truffle项目</li> 
   <li>编写智能合约</li> 
   <li>编译和部署智能合约到区块链</li> 
   <li>如何通过Web3和智能合约交互</li> 
   <li>MetaMask 的使用</li> 
  </ul>
  <p>&nbsp;</p> 
  <p>项目背景</p> 
  <p>Pet有一个宠物店，有16只宠物，他想开发一个去中心化应用，让大家来领养宠物。</p> 
  <p>在truffle box中，已经提供了pet-shop的网站部分的代码和react框架，我们只需要编写合约及交互部分。</p> 
  <p>环境搭建</p> 
  <ol>
   <li>安装<a href="https://nodejs.org/en/download/" rel="nofollow">Node</a></li> 
   <li>安装 Truffle ：npm install -g truffle</li> 
   <li>安装<a href="http://truffleframework.com/ganache/" rel="nofollow">Ganache</a></li> 
  </ol>
  <p>创建项目</p> 
  <ol>
   <li>建立项目目录并进入</li> 
  </ol>
  <p>mkdir pet-shop-react</p> 
  <p>cd pet-shop-react</p> 
  <ol>
   <li>使用truffle unbox 创建项目</li> 
  </ol>
  <p>&gt; truffle unbox react-box</p> 
  <p>Downloading...</p> 
  <p>Unpacking...</p> 
  <p>Setting up...</p> 
  <p>Unbox successful. Sweet!</p> 
  <p>&nbsp;</p> 
  <p>Commands:</p> 
  <p>&nbsp;</p> 
  <p>Compile: truffle compile</p> 
  <p>Migrate: truffle migrate</p> 
  <p>Test contracts: truffle test</p> 
  <p>Test dapp: npm test</p> 
  <p>Run dev server: npm run start</p> 
  <p>Build for production: npm run build</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>也可以使用truffle init 来创建一个全新的项目。</p> 
  <p>项目目录结构</p> 
  <p>contracts/&nbsp;智能合约的文件夹，所有的智能合约文件都放置在这里，里面包含一个重要的合约Migrations.sol（稍后再讲）</p> 
  <p>migrations/&nbsp;用来处理部署（迁移）智能合约 ，迁移是一个额外特别的合约用来保存合约的变化。</p> 
  <p>test/&nbsp;智能合约测试用例文件夹</p> 
  <p>truffle.js/&nbsp;配置文件</p> 
  <p>src/&nbsp;前端业务文件夹</p> 
  <p>build/&nbsp;合约编译后存放文件夹</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>编写智能合约</p> 
  <p>智能合约承担着分布式应用的后台逻辑和存储。智能合约使用solidity编写，可阅读</p> 
  <p><a href="https://learnblockchain.cn/categories/ethereum/Solidity/" rel="nofollow">solidity系列文章</a></p> 
  <p>在contracts目录下，添加合约文件Adoption.sol</p> 
  <p>&nbsp;</p> 
  <p>pragma solidity ^0.4.17;</p> 
  <p>&nbsp;</p> 
  <p>contract Adoption {</p> 
  <p>address[16] public adopters; // 保存领养者的地址</p> 
  <p>// 领养宠物</p> 
  <p>function adopt(uint petId) public returns (uint) {</p> 
  <p>require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); // 确保id在数组长度内</p> 
  <p>&nbsp;</p> 
  <p>adopters[petId] = msg.sender; // 保存调用这地址</p> 
  <p>return petId;</p> 
  <p>}</p> 
  <p>// 返回领养者</p> 
  <p>function getAdopters() public view returns (address[16]) {</p> 
  <p>return adopters;</p> 
  <p>}</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>智能合约</p> 
  <p>Truffle集成了一个开发者控制台，可用来生成一个开发链用来测试和部署智能合约。</p> 
  <p>编译</p> 
  <p>Solidity是编译型语言，需要把可读的Solidity代码编译为EVM字节码才能运行。</p> 
  <p>&gt; truffle compile</p> 
  <p>&nbsp;</p> 
  <p>Compiling ./contracts/Adoption.sol...</p> 
  <p>Compiling ./contracts/Migrations.sol...</p> 
  <p>Compiling ./contracts/SimpleStorage.sol...</p> 
  <p>Writing artifacts to ./build/contracts</p> 
  <p>&nbsp;</p> 
  <p>部署</p> 
  <p>编译之后，就可以部署到区块链上。</p> 
  <p>在migrations文件夹下已经有一个1_initial_migration.js部署脚本，用来部署Migrations.sol合约。</p> 
  <p>Migrations.sol 用来确保不会部署相同的合约。</p> 
  <p>现在我们来创建一个自己的部署脚本3_deploy_contracts.js</p> 
  <p>var Adoption = artifacts.require("./Adoption.sol");</p> 
  <p>module.exports = function(deployer) {</p> 
  <p>deployer.deploy(Adoption);</p> 
  <p>};</p> 
  <p>&nbsp;</p> 
  <p>启动Ganache:</p> 
  <p><img alt="" class="has" src="http://note.youdao.com/yws/res/4633/6A5B5D2295F0441389EAF75157071F6C"></p> 
  <p>&nbsp;</p> 
  <p>修改truffle.js 文件：</p> 
  <p>module.exports = {</p> 
  <p>// See &lt;http://truffleframework.com/docs/advanced/configuration&gt;</p> 
  <p>networks: {</p> 
  <p>development: {</p> 
  <p>host: "localhost",</p> 
  <p>port: 7545,</p> 
  <p>network_id: "*" // Match any network id</p> 
  <p>}</p> 
  <p>}</p> 
  <p>};</p> 
  <p>&nbsp;</p> 
  <p>部署</p> 
  <p>truffle migrate</p> 
  <p>&nbsp;</p> 
  <p>Using network 'development'.</p> 
  <p>&nbsp;</p> 
  <p>Running migration: 1_initial_migration.js</p> 
  <p>Replacing Migrations...</p> 
  <p>... 0xb7a9652d5fd73a7df1703c874e4fc510f5b714fb61203ada3931babfd7f3cb25</p> 
  <p>Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0</p> 
  <p>Saving successful migration to network...</p> 
  <p>... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956</p> 
  <p>Saving artifacts...</p> 
  <p>Running migration: 2_deploy_contracts.js</p> 
  <p>Replacing SimpleStorage...</p> 
  <p>... 0x989a1bf7b17292d05bc5fbc5a70d27d2b002ba2d0265d366f836f619763a733e</p> 
  <p>SimpleStorage: 0x345ca3e014aaf5dca488057592ee47305d9b3e10</p> 
  <p>Saving successful migration to network...</p> 
  <p>... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0</p> 
  <p>Saving artifacts...</p> 
  <p>Running migration: 3_deploy_contracts.js</p> 
  <p>Deploying Adoption...</p> 
  <p>... 0xda3a44984cadaf6481a4b462c495b6dbdc3ab77592de062ac3d286c24e6fd1ec</p> 
  <p>Adoption: 0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f</p> 
  <p>Saving successful migration to network...</p> 
  <p>... 0x55b13865c62964c3b211dd22c1106101855e698e00dbf6d21aad05d6707cf626</p> 
  <p>Saving artifacts...</p> 
  <p>到上面为止服务器端就开发完成。</p> 
  <p><img alt="" class="has" src="http://note.youdao.com/yws/res/4643/B5F4C9EBA04A4296963CC2FB2B16741F"></p> 
  <p>&nbsp;</p> 
  <p>React编写页面</p> 
  <p>在src目录下，创建components和images文件夹</p> 
  <p>cd src</p> 
  <p>mkdir components</p> 
  <p>mkdir images</p> 
  <p>&nbsp;</p> 
  <p>在util编写公共方法</p> 
  <p>getTransactionReceiptMined.js:</p> 
  <p>module.exports = function getTransactionReceiptMined(txHash, interval) {</p> 
  <p>const self = this;</p> 
  <p>const transactionReceiptAsync = function(resolve, reject) {</p> 
  <p>self.getTransactionReceipt(txHash, (error, receipt) =&gt; {</p> 
  <p>if (error) {</p> 
  <p>reject(error);</p> 
  <p>} else if (receipt == null) {</p> 
  <p>setTimeout(</p> 
  <p>() =&gt; transactionReceiptAsync(resolve, reject),</p> 
  <p>interval ? interval : 500);</p> 
  <p>} else {</p> 
  <p>resolve(receipt);</p> 
  <p>}</p> 
  <p>});</p> 
  <p>};</p> 
  <p>&nbsp;</p> 
  <p>if (Array.isArray(txHash)) {</p> 
  <p>return Promise.all(txHash.map(</p> 
  <p>oneTxHash =&gt; self.getTransactionReceiptMined(oneTxHash, interval)));</p> 
  <p>} else if (typeof txHash === "string") {</p> 
  <p>return new Promise(transactionReceiptAsync);</p> 
  <p>} else {</p> 
  <p>throw new Error("Invalid Type: " + txHash);</p> 
  <p>}</p> 
  <p>};</p> 
  <p>&nbsp;</p> 
  <p>isAdopted.js:</p> 
  <p>export default function isAdopted(adopter) {</p> 
  <p>return adopter !== '0x0000000000000000000000000000000000000000';</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>将官方的pet shop中image下图片拷贝到image目录</p> 
  <p>&nbsp;</p> 
  <p>创建dogImageMap.js文件：</p> 
  <p>import boxer from './images/boxer.jpeg';</p> 
  <p>import frenchBulldog from './images/french-bulldog.jpeg';</p> 
  <p>import goldenRetriever from './images/golden-retriever.jpeg';</p> 
  <p>import scottishTerrier from './images/scottish-terrier.jpeg';</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>export default function dogImageMap(path) {</p> 
  <p>switch(path) {</p> 
  <p>case 'images/boxer.jpeg': {</p> 
  <p>return boxer;</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>case 'images/french-bulldog.jpeg': {</p> 
  <p>return frenchBulldog;</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>case 'images/golden-retriever.jpeg': {</p> 
  <p>return goldenRetriever;</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>default: {</p> 
  <p>return scottishTerrier;</p> 
  <p>}</p> 
  <p>}</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>在compents文件下创建Pet.js</p> 
  <p>import React, { Component } from 'react';</p> 
  <p>import PropTypes from 'prop-types';</p> 
  <p>import dogImageMap from '../dogImageMap';</p> 
  <p>import isAdopted from '../utils/isAdopted';</p> 
  <p>&nbsp;</p> 
  <p>class Pet extends Component {</p> 
  <p>constructor(props) {</p> 
  <p>super(props);</p> 
  <p>&nbsp;</p> 
  <p>this.state = {</p> 
  <p>pending: false,</p> 
  <p>}</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>render() {</p> 
  <p>const {</p> 
  <p>pet,</p> 
  <p>adopter,</p> 
  <p>index,</p> 
  <p>} = this.props;</p> 
  <p>&nbsp;</p> 
  <p>return (</p> 
  <p>&lt;div className="panel-body"&gt;</p> 
  <p>&lt;img alt="140x140" data-src="holder.js/140x140" className="img-rounded img-center" style={{ width: '100%' }} src={dogImageMap(pet.picture)} data-holder-rendered="true" /&gt;</p> 
  <p>&lt;strong&gt;Breed&lt;/strong&gt;: &lt;span className="pet-breed"&gt;{pet.breed}&lt;/span&gt;&lt;br/&gt;</p> 
  <p>&lt;strong&gt;Age&lt;/strong&gt;: &lt;span className="pet-age"&gt;{pet.age}&lt;/span&gt;&lt;br/&gt;</p> 
  <p>&lt;strong&gt;Location&lt;/strong&gt;: &lt;span className="pet-location"&gt;{pet.location}&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;</p> 
  <p>&lt;button</p> 
  <p>className="btn btn-default btn-adopt"</p> 
  <p>type="button"</p> 
  <p>disabled={isAdopted(adopter)}</p> 
  <p>onClick={() =&gt; this.props.adoptPet(index)}</p> 
  <p>&gt;</p> 
  <p>{</p> 
  <p>isAdopted(adopter) ? 'Success' : 'Adopt'</p> 
  <p>}</p> 
  <p>&lt;/button&gt;</p> 
  <p>&lt;br /&gt;</p> 
  <p>&lt;strong&gt;Owner: {(adopter)}&lt;/strong&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>);</p> 
  <p>}</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>Pet.propTypes = {</p> 
  <p>pet: PropTypes.object,</p> 
  <p>adopters: PropTypes.string,</p> 
  <p>index: PropTypes.number.isRequired,</p> 
  <p>adoptPet: PropTypes.func.isRequired,</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>export default Pet;</p> 
  <p>&nbsp;</p> 
  <p>创建pets.js:</p> 
  <p>export const petsArray = [</p> 
  <p>{</p> 
  <p>"id": 0,</p> 
  <p>"name": "Frieda",</p> 
  <p>"picture": "images/scottish-terrier.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "Scottish Terrier",</p> 
  <p>"location": "Lisco, Alabama"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 1,</p> 
  <p>"name": "Gina",</p> 
  <p>"picture": "images/scottish-terrier.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "Scottish Terrier",</p> 
  <p>"location": "Tooleville, West Virginia"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 2,</p> 
  <p>"name": "Collins",</p> 
  <p>"picture": "images/french-bulldog.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "French Bulldog",</p> 
  <p>"location": "Freeburn, Idaho"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 3,</p> 
  <p>"name": "Melissa",</p> 
  <p>"picture": "images/boxer.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "Boxer",</p> 
  <p>"location": "Camas, Pennsylvania"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 4,</p> 
  <p>"name": "Jeanine",</p> 
  <p>"picture": "images/french-bulldog.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "French Bulldog",</p> 
  <p>"location": "Gerber, South Dakota"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 5,</p> 
  <p>"name": "Elvia",</p> 
  <p>"picture": "images/french-bulldog.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "French Bulldog",</p> 
  <p>"location": "Innsbrook, Illinois"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 6,</p> 
  <p>"name": "Latisha",</p> 
  <p>"picture": "images/golden-retriever.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "Golden Retriever",</p> 
  <p>"location": "Soudan, Louisiana"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 7,</p> 
  <p>"name": "Coleman",</p> 
  <p>"picture": "images/golden-retriever.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "Golden Retriever",</p> 
  <p>"location": "Jacksonwald, Palau"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 8,</p> 
  <p>"name": "Nichole",</p> 
  <p>"picture": "images/french-bulldog.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "French Bulldog",</p> 
  <p>"location": "Honolulu, Hawaii"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 9,</p> 
  <p>"name": "Fran",</p> 
  <p>"picture": "images/boxer.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "Boxer",</p> 
  <p>"location": "Matheny, Utah"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 10,</p> 
  <p>"name": "Leonor",</p> 
  <p>"picture": "images/boxer.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "Boxer",</p> 
  <p>"location": "Tyhee, Indiana"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 11,</p> 
  <p>"name": "Dean",</p> 
  <p>"picture": "images/scottish-terrier.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "Scottish Terrier",</p> 
  <p>"location": "Windsor, Montana"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 12,</p> 
  <p>"name": "Stevenson",</p> 
  <p>"picture": "images/french-bulldog.jpeg",</p> 
  <p>"age": 3,</p> 
  <p>"breed": "French Bulldog",</p> 
  <p>"location": "Kingstowne, Nevada"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 13,</p> 
  <p>"name": "Kristina",</p> 
  <p>"picture": "images/golden-retriever.jpeg",</p> 
  <p>"age": 4,</p> 
  <p>"breed": "Golden Retriever",</p> 
  <p>"location": "Sultana, Massachusetts"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 14,</p> 
  <p>"name": "Ethel",</p> 
  <p>"picture": "images/golden-retriever.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "Golden Retriever",</p> 
  <p>"location": "Broadlands, Oregon"</p> 
  <p>},</p> 
  <p>{</p> 
  <p>"id": 15,</p> 
  <p>"name": "Terry",</p> 
  <p>"picture": "images/golden-retriever.jpeg",</p> 
  <p>"age": 2,</p> 
  <p>"breed": "Golden Retriever",</p> 
  <p>"location": "Dawn, Wisconsin"</p> 
  <p>}</p> 
  <p>]</p> 
  <p>&nbsp;</p> 
  <p>修改app.js文件：</p> 
  <p>import React from 'react'</p> 
  <p>import _ from 'lodash';</p> 
  <p>import AdoptionContract from '../build/contracts/Adoption.json'</p> 
  <p>import { petsArray } from './pets.js';</p> 
  <p>import getWeb3 from './utils/getWeb3'</p> 
  <p>import Pet from './components/Pet';</p> 
  <p>import './css/oswald.css'</p> 
  <p>import './css/open-sans.css'</p> 
  <p>import './css/pure-min.css'</p> 
  <p>import './App.css'</p> 
  <p>&nbsp;</p> 
  <p>class App extends React.Component {</p> 
  <p>constructor(props) {</p> 
  <p>super(props)</p> 
  <p>&nbsp;</p> 
  <p>this.state = {</p> 
  <p>web3: {},</p> 
  <p>adoptionContract: null,</p> 
  <p>pets: [],</p> 
  <p>adopters: [],</p> 
  <p>blockNumber: null,</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>this.adoptPet = this.adoptPet.bind(this);</p> 
  <p>this.getBlockNumber = this.getBlockNumber.bind(this);</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>componentWillMount() {</p> 
  <p>getWeb3</p> 
  <p>.then(results =&gt; {</p> 
  <p>this.setState({</p> 
  <p>web3: results.web3</p> 
  <p>}, () =&gt; {</p> 
  <p>this.getBlockNumber()</p> 
  <p>this.instantiateContract()</p> 
  <p>this.fetchPets();</p> 
  <p>});</p> 
  <p>})</p> 
  <p>.catch(() =&gt; {</p> 
  <p>console.log('Error finding web3.')</p> 
  <p>})</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>getBlockNumber() {</p> 
  <p>this.state.web3.eth.getBlockNumber((error, block) =&gt; {</p> 
  <p>this.setState({ blockNumber: block });</p> 
  <p>});</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>fetchPets() {</p> 
  <p>this.setState({ pets: petsArray });</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>adoptPet(item) {</p> 
  <p>const { adoptionContract } = this.state;</p> 
  <p>const newAdopters = this.state.adopters;</p> 
  <p>&nbsp;</p> 
  <p>this.state.web3.eth.getAccounts((error, accounts) =&gt; {</p> 
  <p>adoptionContract.deployed().then((instance) =&gt; {</p> 
  <p>return instance.adopt(item, { from: accounts[0]})</p> 
  <p>.then((result) =&gt; {</p> 
  <p>this.state.web3.eth.getTransactionReceiptMined(result.tx)</p> 
  <p>.then((newResult) =&gt; {</p> 
  <p>newAdopters[item] = accounts[0];</p> 
  <p>this.setState({</p> 
  <p>blockNumber: newResult.blockNumber,</p> 
  <p>adopters: newAdopters</p> 
  <p>})</p> 
  <p>});</p> 
  <p>})</p> 
  <p>.catch((err) =&gt; {</p> 
  <p>console.log(err.message);</p> 
  <p>})</p> 
  <p>});</p> 
  <p>});</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>instantiateContract() {</p> 
  <p>const contract = require('truffle-contract')</p> 
  <p>const adoption = contract(AdoptionContract);</p> 
  <p>adoption.setProvider(this.state.web3.currentProvider)</p> 
  <p>&nbsp;</p> 
  <p>adoption.deployed().then((instance) =&gt; {</p> 
  <p>return instance.getAdopters.call().then((result) =&gt; {</p> 
  <p>this.setState({</p> 
  <p>adopters: result,</p> 
  <p>adoptionContract: adoption</p> 
  <p>});</p> 
  <p>});</p> 
  <p>});</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>render() {</p> 
  <p>const {</p> 
  <p>pets,</p> 
  <p>adopters</p> 
  <p>} = this.state</p> 
  <p>&nbsp;</p> 
  <p>return (</p> 
  <p>&lt;div className="App"&gt;</p> 
  <p>&lt;div className="container"&gt;</p> 
  <p>&lt;div className="row"&gt;</p> 
  <p>&lt;div className="col-xs-12 col-sm-8 col-sm-push-2"&gt;</p> 
  <p>&lt;h1 className="text-center"&gt;Pete's Pet Shop&lt;/h1&gt;</p> 
  <p>&lt;hr/&gt;</p> 
  <p>&lt;br/&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>&nbsp;</p> 
  <p>&lt;div id="petsRow" className="row"&gt;</p> 
  <p>{</p> 
  <p>_.map(pets, (pet, index) =&gt; {</p> 
  <p>return (</p> 
  <p>&lt;div className="col-sm-6 col-md-4 col-lg-3" key={index}&gt;</p> 
  <p>&lt;div className="panel panel-default panel-pet"&gt;</p> 
  <p>&lt;div className="panel-heading"&gt;</p> 
  <p>&lt;h3 className="panel-title"&gt;{pet.name}&lt;/h3&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>&lt;Pet</p> 
  <p>pet={pet}</p> 
  <p>adopter={adopters[index]}</p> 
  <p>index={index}</p> 
  <p>adoptPet={this.adoptPet}</p> 
  <p>/&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>)</p> 
  <p>})</p> 
  <p>}</p> 
  <p>&lt;/div&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>&lt;/div&gt;</p> 
  <p>);</p> 
  <p>}</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>export default App</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>修改utils下getWeb3.js文件到url路径到7454端口。</p> 
  <p>import Web3 from 'web3'</p> 
  <p>import getTransactionReceiptMined from './getTransactionReceiptMined';</p> 
  <p>let getWeb3 = new Promise(function(resolve, reject) {</p> 
  <p>// Wait for loading completion to avoid race conditions with web3 injection timing.</p> 
  <p>window.addEventListener('load', function() {</p> 
  <p>var results</p> 
  <p>var web3 = window.web3</p> 
  <p>&nbsp;</p> 
  <p>// Checking if Web3 has been injected by the browser (Mist/MetaMask)</p> 
  <p>if (typeof web3 !== 'undefined') {</p> 
  <p>// Use Mist/MetaMask's provider.</p> 
  <p>web3 = new Web3(web3.currentProvider)</p> 
  <p>web3.eth.getTransactionReceiptMined = getTransactionReceiptMined;</p> 
  <p>results = {</p> 
  <p>web3: web3</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>console.log('Injected web3 detected.');</p> 
  <p>&nbsp;</p> 
  <p>resolve(results)</p> 
  <p>} else {</p> 
  <p>// Fallback to localhost if no web3 injection. We've configured this to</p> 
  <p>// use the development console's port by default.</p> 
  <p>var provider = new Web3.providers.HttpProvider('http://127.0.0.1:7545')</p> 
  <p>&nbsp;</p> 
  <p>web3 = new Web3(provider)</p> 
  <p>&nbsp;</p> 
  <p>results = {</p> 
  <p>web3: web3</p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>console.log('No web3 instance injected, using Local web3.');</p> 
  <p>&nbsp;</p> 
  <p>resolve(results)</p> 
  <p>}</p> 
  <p>})</p> 
  <p>})</p> 
  <p>&nbsp;</p> 
  <p>export default getWeb3</p> 
  <p>&nbsp;</p> 
  <p>由于copy官方例子，使用了bootstrap.mini.css</p> 
  <p>将css放入到public文件夹中，并修改index.html,加上下面这句话：</p> 
  <p>&lt;link href="%PUBLIC_URL%/bootstrap.min.css" rel="stylesheet"&gt;</p> 
  <p>&nbsp;</p> 
  <p>运行：</p> 
  <p>yarn run start</p> 
  <p>&nbsp;</p> 
  <p>在浏览器中运行</p> 
  <p>安装 MetaMask</p> 
  <p>MetaMask 是一款插件形式的以太坊轻客户端，开发过程中使用MetaMask和我们的dapp进行交互是个很好的选择，通过此<a href="https://metamask.io/" rel="nofollow">链接</a>安装，安装完成后，浏览器工具条会显示一个小狐狸图标。</p> 
  <p>配置钱包</p> 
  <p>在接受隐私说明后，会出现页面如下：</p> 
  <p><img alt="metamask-initial.png" class="has" src="http://note.youdao.com/yws/res/4697/4EC073BE1B684AAC85FE22F63532C746"></p> 
  <p>这里我们通过还原一个Ganache为我们创建好的钱包，作为我们的开发测试钱包。点击页面的Import Existing DEN，输入Ganache显示的助记词。</p> 
  <table>
   <tbody>
    <tr>
     <td> <p>candy maple cake sugar pudding cream honey rich smooth crumble sweet treat</p> </td> 
    </tr>
   </tbody>
  </table>
  <p>然后自己想要的密码，点击OK。</p> 
  <p>如图：</p> 
  <p><img alt="metamask-seed.png" class="has" src="http://note.youdao.com/yws/res/4695/38FE476BC49248859675BFD323E8F311"></p> 
  <p>连接开发区块链网络</p> 
  <p>默认连接的是以太坊主网（左上角显示），选择Custom RPC，添加一个网络：<a href="http://127.0.0.1:7545/" rel="nofollow">http://127.0.0.1:7545</a>，点返回后，显示如下：</p> 
  <p><img alt="metamask-account1.png" class="has" src="http://note.youdao.com/yws/res/4696/C8094125EC9449AFACAEC43908152849"></p> 
  <p>&nbsp;</p> 
  <p>这是左上角显示为Private Network，账号是Ganache中默认的第一个账号。</p> 
  <p>注意 在交易时候 请注意保持metamask保持活跃状态。</p> 
  <p>&nbsp;</p> 
  <p><img alt="" class="has" src="http://note.youdao.com/yws/res/4709/F8225386E32B49E2ABA814BD87E2B85C"></p> 
  <p>&nbsp;</p> 
  <p>点击领取。</p> 
  <p><img alt="" class="has" src="http://note.youdao.com/yws/res/4712/7F350112181C463CB6C47ECCBCE23F69"></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>成功：</p> 
  <p><img alt="" class="has" src="http://note.youdao.com/yws/res/4715/B50B01F9B1A04A09BADDB06A634EC6FC"></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>感谢Tiny熊和kkomaz,pet shop 相关文章。<a href="https://blog.csdn.net/yuanfangyuan_block/article/details/79412830" rel="nofollow">https://blog.csdn.net/yuanfangyuan_block/article/details/79412830</a></p> 
  <p></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/xwinie/article/details/81386324,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/xwinie/article/details/81386324,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

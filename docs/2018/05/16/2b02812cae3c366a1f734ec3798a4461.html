<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>BitShares 2.0 多节点私链部署 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="BitShares 2.0 多节点私链部署" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：文章所有权归作者个人所有，转载请注明作者及来源 https://blog.csdn.net/ggq89/article/details/80234262 关于如何搭建BitShares多节点私链请参看：BitShares 2.0 多节点私链部署 关于如何搭建BitShares的web钱包搭建和接入私链请参考：BitShares之web钱包搭建及接入私链 关于如何对BitShares进行交易量压力测试请参考：BitShares交易量压力测试 目录 1. 总体概述 2. 软件版本和硬件环境要求 3. 编译和安装 BitShares Core 4. 搭建私链并启动 4.1 创建目录 4.2 创建和编辑genesis文件 4.3 初始化证人节点 4.4 配置证人节点 4.5 开始区块生产 5. 命令行钱包的使用 5.1 创建钱包 5.2 导入账号和资金 5.3 创建新帐户 5.4 转移资金给新账户 6. 部署其他证人节点生产区块 6.1 新证人节点连接到区块链网 6.2 打开新钱包创建新账户 6.3 升级新账户为终生会员 6.4 注册为证人并投票为活跃证人 6.5 让新证人节点生产区块 基于便于管理和测试石墨烯（graphene）区块链的目的，本文讲解如何在局域网中部署一个包含多个证人节点的BitShares 2.0 私有测试链。 1. 总体概述 一般来说，在BitShares2.0中，每个证人是不同的账号在不同的节点上运行，但为了方便私有测试网的部署和讲解，在整个区块链创建初始时使用1个节点1个账号控制11个证人生产区块，后面再逐渐创建新的证人逐步替代。 基于上面的目标，实现步骤如下： 首先在一个节点上初始化和启动整个区块链测试链。 创建其他账号，将其选举投票为证人。 开启其他证人节点，加入网络开始生产区块。 2. 软件版本和硬件环境要求 本文基于的BitShares的版本为：BitShares Core Release 2.0.180425 本文基于的操作系统为: Ubuntu 16.04.4 LTS 官方建议使用32GB（至少16GB） RAM、SSD硬盘的专用服务器。本人使用普通非SSD硬盘，经测试，编译BitShares全节点程序至少需要8G RAM。 3. 编译和安装 BitShares Core 更新和安装依赖库： sudo apt-get update sudo apt-get install autoconf cmake git libboost-all-dev libssl-dev g++ libcurl4-openssl-dev 克隆代码仓库，切换到指定tag，更新子模块代码： git clone https://github.com/bitshares/bitshares-core.git cd bitshares-core &amp;&amp; git checkout 2.0.180425 git submodule update --init --recursive 生成Makefile，编译，安装 cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo . make sudo make install 检查是否编译安装成功： cd .. &amp;&amp; which witness_node cli_wallet 4. 搭建私链并启动 本节主要讲解如何从genesis.json开始，创建一个区块链，并让证人节点开始生产区块。 4.1 创建目录 创建测试目录，并切换到该目录 mkdir -p testnet_home &amp;&amp; cd testnet_home/ 4.2 创建和编辑genesis文件 witness_node --create-genesis-json=my-genesis.json vim my-genesis.json 石墨烯（graphene）代码中默认的geneis块包含唯一一个账户，geneis块中所有的初始证人，初始委员会成员和初始证人候选人都是该账户，该账户的名称是：nathan，私钥为：5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3。 genesis文件是用来定义区块链网络初始状态，可以诸如以下的状态： 存在于genesis区块的账户，包括账户的名字和公钥 资产及其初始分配状况（包括核心资产） 区块链参数的初始值 初始证人的帐户/签名密钥（或者其他任何帐户，注：默认的 witness 是 init0～inti10）。 在本人的设置中，为了加快活跃证人的更新时间，修改如下： &quot;maintenance_interval&quot;: 600, 保存并退出。 4.3 初始化证人节点 运行如下命令来初始化证人节点： witness_node --data-dir data/ --genesis-json my-genesis.json --seed-nodes &quot;[]&quot; 当类似以下信息出现时，意味着初始化过程完成，按ctrl+c关闭见证节点： 1620535ms th_a main.cpp:266 main] Started BitShares node on a chain with 0 blocks. 1620535ms th_a main.cpp:267 main] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 此时，完成了两件事： 创建了区块链data目录和在其之下的config.ini文件。 获得了区块链ID。将Chain ID另外保存起来，后面会用到。 4.4 配置证人节点 打开[Testnet-Home]/data/config.ini文件： vim data/config.ini 在合适的位置进行以下设置，注意将重复的设置注释掉： p2p-endpoint = 0.0.0.0:31010 seed-nodes = [] rpc-endpoint = 0.0.0.0:38090 genesis-json = my-genesis.json enable-stale-production = true # ID of witness controlled by this node (e.g. &quot;1.6.5&quot;, quotes are required, may specify multiple times) witness-id = &quot;1.6.1&quot; witness-id = &quot;1.6.2&quot; witness-id = &quot;1.6.3&quot; witness-id = &quot;1.6.4&quot; witness-id = &quot;1.6.5&quot; witness-id = &quot;1.6.6&quot; witness-id = &quot;1.6.7&quot; witness-id = &quot;1.6.8&quot; witness-id = &quot;1.6.9&quot; witness-id = &quot;1.6.10&quot; witness-id = &quot;1.6.11&quot; 解释一下上面的设置： p2p-endpoint，指定开启的p2p监听端口，以方便其他节点连接，可以作为其他节点的seed-node。 rpc-endpoint，指定开启的rpc监听端口，以方便cli-wallet和web钱包与证人节点连接。 genesis-json，设置genesis.json的路径，通常只在创建新链生产创世区块时设置。 enable-stale-production，让本节点无视区块链数据的时间，无论如何都生成区块数据。该字段通常只在创建新链生产创世区块时设为true。当已存在区块链时，一定要将本参数设为false或者不管，否则会因数据不完整导致分叉。 seed-nodes，设置种子节点集合，以方便快速连接到区块链网络和同步区块链数据。在创建新链生产创世区块时设为空，以防止连接到正式网络（代码）中的默认种子节点。当连接已有区块链网络时，尽可能多的设置种子节点以加快同步速度。 witness-id，用于授权本证人节点所代表的证人id产生区块，可指定多个。一般来说一个证人节点授权一个证人id，私链第一个节点指定了11个。 4.5 开始区块生产 关键时刻到来了，生产私有测试链的第一个区块。 运行如下命令： witness_node --data-dir=data 将看到如下重要信息： ******************************** * * * ------- NEW CHAIN ------ * * - Welcome to Graphene! - * * ------------------------ * * * ******************************** 接着连续将看到类以下消息，表明成功开始生产区块： 453735ms th_a main.cpp:266 main] Started BitShares node on a chain with 0 blocks. 453735ms th_a main.cpp:267 main] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 455003ms th_a witness.cpp:181 block_production_loo] Generated block #1 with timestamp 2018-05-11T15:07:35 at time 2018-05-11T15:07:35 460000ms th_a witness.cpp:181 block_production_loo] Generated block #2 with timestamp 2018-05-11T15:07:40 at time 2018-05-11T15:07:40 462000ms th_a witness.cpp:181 block_production_loo] Generated block #3 with timestamp 2018-05-11T15:07:42 at time 2018-05-11T15:07:42 5. 命令行钱包的使用 本节主要讲解如何使用命令行钱包导入账户、创建一个新账户，并转账，查看属性等等。 5.1 创建钱包 现在使用命令行钱包（cli_wallet）连接到上一节创建的证人节点（witness_node）。 保持证人节点处于运行状态，打开另一个命令提示符窗口，运行如下命令： mkdir -p wallet &amp;&amp; cd wallet cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --rpc-endpoint 0.0.0.0:38099 --rpc-http-endpoint 0.0.0.0:38092 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 下面对指令参数进行解释： --wallet-file：指定钱包json文件，该文件用于保存本钱包中所有加密后的私钥； --server-rpc-endpoint：rpc服务器终端地址，指定钱包要连接的区块链全节点所需要的协议、地址和端口； --rpc-endpoint：指定命令行钱包要监听的websocket RPC的ip地址和端口号； --rpc-http-endpoint：指定命令行钱包要监听的HTTP RPC的ip地址和端口号； --chain-id：指定要连接的区块链ID。不指定的话，钱包连接到bitshares的正式链上。 收到set_password提示，表示cli_wallet钱包已成功连接到witness_node节点。为钱包设置一个密码。 该密码用于加密钱包中所有的私钥。 在本例中，我使用supersecret作为密码。 使用如下命令给钱包创建密码并解锁新创建的钱包： set_password supersecret unlock supersecret 5.2 导入账号和资金 要将帐户导入钱包，必须知道账户名称和私钥才行。使用import_key命令将代码中默认的账户nathan导入钱包（其私钥为5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3）： import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 注意：帐户名称是前面在genesies.json文件中设置的， 私钥也是前面在config.ini文件中设置的。 现在已经将私钥导入到钱包中，但初始账户仍然没有资金（后面升级账户需要资金）。 资金在genesies.json文件中的initial_balances字段已经设置好了。 使用import_balance命令可以将这些资金免费（相对于转账需要付手续费来说的）导入钱包： import_balance nathan [&quot;5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3&quot;] true 5.3 创建新帐户 现在来创建另一个帐户（名为alpha ），以便在nathan和alpha之间来回转移资金，产生交易。 只能使用现有的账户去创建新账户，且该账户（称为注册商: registrar）必须支付注册费用。 此外，要求注册商账户必须是终身会员（LTM: lifetime member）。使用upgrade_account命令将nathan升级到LTM： upgrade_account nathan true 注意：由于缓存问题 ，需要重启cli_wallet钱包，否则升级nathan没有更新。 按下ctrl+c停止CLI钱包，运行与以下命令重新钱包并解锁： cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 unlock supersecret 确认nathan现在处于LTM状态： get_account nathan 在打印的账户属性中，membership_expiration_date的属性值应该是1969-12-31T23:59:59 。 如果仍然是1970-01-01T00:00:00，那么账户就没有成功升级。 现在用原账户作为注册商注册一个新帐户了。 首先需要新帐户的公钥。可以通过suggest_brain_key命令来获得： suggest_brain_key 显示的信息大致如下： { &quot;brain_priv_key&quot;: &quot;FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND&quot;, &quot;wif_priv_key&quot;: &quot;5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp&quot;, &quot;pub_key&quot;: &quot;BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF&quot; } 其中brain_priv_key是私钥助记符，wif_priv_key是钱包导入格式的私钥，pub_key。一定要记下以上重要的信息找个黑客攻击不到的地方保存起来，非常关键。 现在可以注册一个新帐户。可以只使用前面推荐的公钥来注册一个名为alpha的新帐户： register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan 0 true 5.4 转移资金给新账户 使用transfer命令从nathan账户里转一些资金alpha给： transfer nathan alpha 100000 BTS &quot;here is some cash&quot; true 可以验证alpha是否收到了钱，运行一下命令查看账户余额： list_account_balances alpha 6. 部署其他证人节点生产区块 前面已经创建一个新的区块链，并已经开启生产区块。本节主要讲解如何在新节点上创建新账户并让新账户成为证人，并投票成活跃证人生产区块。 6.1 新证人节点连接到区块链网 在新节点上按同样的方式编译安装BitShares Core 测试版。 为了保证新节点连接的是前面创建的私链，必须保证chain id相同，而witness_node无法指定chain id，只能通过genesis.json文件初始化。 将原来的genesis.json复制到新节点指定目录中。可用如下指令完成该功能： mkdir -p testnet-home &amp;&amp; cd testnet-home/ scp bitshares@192.168.110.103:~/testnet_home/my-genesis.json . 然后运行以下指令初始化该证人节点，并按ctrl+c完成： witness_node --data-dir data/ --genesis-json my-genesis.json --seed-nodes &quot;[]&quot; 然后编辑 data 目录下的config.ini，修改设置如下： seed-nodes = [&quot;192.168.110.103:31010&quot;] rpc-endpoint = 127.0.0.1:38090 基本和前面的config.ini设置差不多，有两点要注意，seed-nodes种子节点集合一定填写之前启动的全节点（即证人节点）的 ip 和 p2p-endpoint 端口。rpc-endpoint指定开启的rpc监听端口，以方便cli-wallet和web钱包与证人节点连接。 使用如下命令重新运行证人节点： witness_node --data-dir data 由于本节点没有证人权限，所以不会生产区块，只会同步区块信息。打印的信息类似如下： 2188254ms th_a main.cpp:266 main ] Started BitShares node on a chain with 0 blocks. 2188254ms th_a main.cpp:267 main ] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 2190025ms th_a application.cpp:512 handle_block ] Got block: #460 time: 2018-05-16T09:36:30 latency: 25 ms from: init6 irreversible: 452 (-8) 2195020ms th_a application.cpp:512 handle_block ] Got block: #461 time: 2018-05-16T09:36:35 latency: 20 ms from: init1 irreversible: 453 (-8) 2200021ms th_a application.cpp:512 handle_block ] Got block: #462 time: 2018-05-16T09:36:40 latency: 21 ms from: init10 irreversible: 454 (-8) 当该节点和网络中的区块数据同步完成后，并定期从其他节点接收新区块后，才能继续下一步。 6.2 打开新钱包创建新账户 基本和前面的操作一样（详细讲解请参考：命令行钱包的使用）。保持证人节点处于运行状态，打开另一个命令提示符窗口： mkdir -p wallet &amp;&amp; cd wallet cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 设置新钱包密码，并解锁： set_password my_password unlock my_password 只能使用现有的账户去创建新账户，因此先导入 nathan 用户： import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 使用指令suggest_brain_key获得新账户信息： suggest_brain_key 得到新账户信息如下： { &quot;brain_priv_key&quot;: &quot;FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND&quot;, &quot;wif_priv_key&quot;: &quot;5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp&quot;, &quot;pub_key&quot;: &quot;BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF&quot; } 创建新账户alpha： register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan 0 true 6.3 升级新账户为终生会员 新账户必须升级为终身会员（LTM: lifetime member）后才能称为证人账户。而新账户升级为LTM需要的资金只能通过其他账户转账。 给账户alpha转入一些资金： transfer nathan alpha 100000 BTS &quot;here is some cash!&quot; true 导入新账户alpha： import_key alpha 5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp 可以查看当前钱包的账户及其余额： list_my_accounts list_account_balances alpha 现在可以升级为终身会员了： upgrade_account alpha true 6.4 注册为证人并投票为活跃证人 要成为证人，首先需要创建一个可以投票的证人对象。 create_witness alpha &quot;http://www.alpha&quot; true 可运行get_witness 来获得新证人的id和signing_key。 get_witness alpha 得到结果： { &quot;id&quot;: &quot;1.6.12&quot;, &quot;witness_account&quot;: &quot;1.2.18&quot;, &quot;last_aslot&quot;: 0, &quot;signing_key&quot;: &quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot;, &quot;vote_id&quot;: &quot;1:22&quot;, &quot;total_votes&quot;: 0, &quot;url&quot;: &quot;http://www.alpha&quot;, &quot;total_missed&quot;: 0, &quot;last_confirmed_block_num&quot;: 0 } witness_node需要signing_key和对应的私钥，并联合id才能生成区块。通过get_private_key获取该签名密钥的私钥： get_private_key &quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot; 得到私钥如下： &quot;5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF&quot; 要想让证人生产区块就必须给新建的证人对象投票让其成为活跃证人： vote_for_witness alpha alpha true true 只有等到下一个维护间隔后，投票才会统计，证人 才有可能成为新的活跃证人。可以使用命令get_dynamic_global_properties查看next_maintenance_time字段的值。在前面我们将维护间隔重新设置为了10分钟。 6.5 让新证人节点生产区块 一旦下一次维护时间间隔过去后，可以使用get_global_properties命令来查看到当前的活动证人列表，根据证人id查看新证人已被投票成为活跃证人。一旦成为活跃证人后， 就可以让新证人节点生产区块。 现在需要重新启动证人，关闭钱包（ctrl+d），然后关闭证人节点（ctrl+c）。 用上面获得新证人id及其公私钥对编辑 data 目录下的config.ini，添加设置如下： # ID of witness controlled by this node (e.g. &quot;1.6.5&quot;, quotes are required, may specify multiple times) witness-id = &quot;1.6.12&quot; # Tuple of [PublicKey, WIF private key] (may specify multiple times) private-key = [&quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot;,&quot;5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF&quot;] private-key， 指定本证人节点生产和签署区块所需的公私钥对。 重新运行证人节点： witness_node --data-dir data 如果witness_node的输出结果如下，那么就轮到本证人节点生产区块，并成功出块： 909991ms th_a application.cpp:512 handle_block ] Got block: #907 time: 2018-05-16T10:15:10 latency: -8 ms from: init9 irreversible: 898 (-9) 915000ms th_a witness.cpp:181 block_production_loo ] Generated block #908 with timestamp 2018-05-16T10:15:15 at time 2018-05-16T10:15:15 919991ms th_a application.cpp:512 handle_block ] Got block: #909 time: 2018-05-16T10:15:20 latency: -8 ms from: init6 irreversible: 901 (-8) 参考文章： bitshares-core/README.md: https://github.com/bitshares/bitshares-core/blob/master/README.md Private Testnet Howto: http://docs.bitshares.eu/testnet/private-testnet.html private testnet: https://github.com/bitshares/bitshares-core/wiki/private-testnet CLI Wallet: http://docs.bitshares.org/integration/apps/cliwallet.html Howto Run a Block-producing Witness: http://docs.bitshares.eu/bitshares/tutorials/witness-howto.html Bitshares 私链部署witness节点: https://www.jianshu.com/p/2cb1cdb98529 阅读更多" />
<meta property="og:description" content="版权声明：文章所有权归作者个人所有，转载请注明作者及来源 https://blog.csdn.net/ggq89/article/details/80234262 关于如何搭建BitShares多节点私链请参看：BitShares 2.0 多节点私链部署 关于如何搭建BitShares的web钱包搭建和接入私链请参考：BitShares之web钱包搭建及接入私链 关于如何对BitShares进行交易量压力测试请参考：BitShares交易量压力测试 目录 1. 总体概述 2. 软件版本和硬件环境要求 3. 编译和安装 BitShares Core 4. 搭建私链并启动 4.1 创建目录 4.2 创建和编辑genesis文件 4.3 初始化证人节点 4.4 配置证人节点 4.5 开始区块生产 5. 命令行钱包的使用 5.1 创建钱包 5.2 导入账号和资金 5.3 创建新帐户 5.4 转移资金给新账户 6. 部署其他证人节点生产区块 6.1 新证人节点连接到区块链网 6.2 打开新钱包创建新账户 6.3 升级新账户为终生会员 6.4 注册为证人并投票为活跃证人 6.5 让新证人节点生产区块 基于便于管理和测试石墨烯（graphene）区块链的目的，本文讲解如何在局域网中部署一个包含多个证人节点的BitShares 2.0 私有测试链。 1. 总体概述 一般来说，在BitShares2.0中，每个证人是不同的账号在不同的节点上运行，但为了方便私有测试网的部署和讲解，在整个区块链创建初始时使用1个节点1个账号控制11个证人生产区块，后面再逐渐创建新的证人逐步替代。 基于上面的目标，实现步骤如下： 首先在一个节点上初始化和启动整个区块链测试链。 创建其他账号，将其选举投票为证人。 开启其他证人节点，加入网络开始生产区块。 2. 软件版本和硬件环境要求 本文基于的BitShares的版本为：BitShares Core Release 2.0.180425 本文基于的操作系统为: Ubuntu 16.04.4 LTS 官方建议使用32GB（至少16GB） RAM、SSD硬盘的专用服务器。本人使用普通非SSD硬盘，经测试，编译BitShares全节点程序至少需要8G RAM。 3. 编译和安装 BitShares Core 更新和安装依赖库： sudo apt-get update sudo apt-get install autoconf cmake git libboost-all-dev libssl-dev g++ libcurl4-openssl-dev 克隆代码仓库，切换到指定tag，更新子模块代码： git clone https://github.com/bitshares/bitshares-core.git cd bitshares-core &amp;&amp; git checkout 2.0.180425 git submodule update --init --recursive 生成Makefile，编译，安装 cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo . make sudo make install 检查是否编译安装成功： cd .. &amp;&amp; which witness_node cli_wallet 4. 搭建私链并启动 本节主要讲解如何从genesis.json开始，创建一个区块链，并让证人节点开始生产区块。 4.1 创建目录 创建测试目录，并切换到该目录 mkdir -p testnet_home &amp;&amp; cd testnet_home/ 4.2 创建和编辑genesis文件 witness_node --create-genesis-json=my-genesis.json vim my-genesis.json 石墨烯（graphene）代码中默认的geneis块包含唯一一个账户，geneis块中所有的初始证人，初始委员会成员和初始证人候选人都是该账户，该账户的名称是：nathan，私钥为：5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3。 genesis文件是用来定义区块链网络初始状态，可以诸如以下的状态： 存在于genesis区块的账户，包括账户的名字和公钥 资产及其初始分配状况（包括核心资产） 区块链参数的初始值 初始证人的帐户/签名密钥（或者其他任何帐户，注：默认的 witness 是 init0～inti10）。 在本人的设置中，为了加快活跃证人的更新时间，修改如下： &quot;maintenance_interval&quot;: 600, 保存并退出。 4.3 初始化证人节点 运行如下命令来初始化证人节点： witness_node --data-dir data/ --genesis-json my-genesis.json --seed-nodes &quot;[]&quot; 当类似以下信息出现时，意味着初始化过程完成，按ctrl+c关闭见证节点： 1620535ms th_a main.cpp:266 main] Started BitShares node on a chain with 0 blocks. 1620535ms th_a main.cpp:267 main] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 此时，完成了两件事： 创建了区块链data目录和在其之下的config.ini文件。 获得了区块链ID。将Chain ID另外保存起来，后面会用到。 4.4 配置证人节点 打开[Testnet-Home]/data/config.ini文件： vim data/config.ini 在合适的位置进行以下设置，注意将重复的设置注释掉： p2p-endpoint = 0.0.0.0:31010 seed-nodes = [] rpc-endpoint = 0.0.0.0:38090 genesis-json = my-genesis.json enable-stale-production = true # ID of witness controlled by this node (e.g. &quot;1.6.5&quot;, quotes are required, may specify multiple times) witness-id = &quot;1.6.1&quot; witness-id = &quot;1.6.2&quot; witness-id = &quot;1.6.3&quot; witness-id = &quot;1.6.4&quot; witness-id = &quot;1.6.5&quot; witness-id = &quot;1.6.6&quot; witness-id = &quot;1.6.7&quot; witness-id = &quot;1.6.8&quot; witness-id = &quot;1.6.9&quot; witness-id = &quot;1.6.10&quot; witness-id = &quot;1.6.11&quot; 解释一下上面的设置： p2p-endpoint，指定开启的p2p监听端口，以方便其他节点连接，可以作为其他节点的seed-node。 rpc-endpoint，指定开启的rpc监听端口，以方便cli-wallet和web钱包与证人节点连接。 genesis-json，设置genesis.json的路径，通常只在创建新链生产创世区块时设置。 enable-stale-production，让本节点无视区块链数据的时间，无论如何都生成区块数据。该字段通常只在创建新链生产创世区块时设为true。当已存在区块链时，一定要将本参数设为false或者不管，否则会因数据不完整导致分叉。 seed-nodes，设置种子节点集合，以方便快速连接到区块链网络和同步区块链数据。在创建新链生产创世区块时设为空，以防止连接到正式网络（代码）中的默认种子节点。当连接已有区块链网络时，尽可能多的设置种子节点以加快同步速度。 witness-id，用于授权本证人节点所代表的证人id产生区块，可指定多个。一般来说一个证人节点授权一个证人id，私链第一个节点指定了11个。 4.5 开始区块生产 关键时刻到来了，生产私有测试链的第一个区块。 运行如下命令： witness_node --data-dir=data 将看到如下重要信息： ******************************** * * * ------- NEW CHAIN ------ * * - Welcome to Graphene! - * * ------------------------ * * * ******************************** 接着连续将看到类以下消息，表明成功开始生产区块： 453735ms th_a main.cpp:266 main] Started BitShares node on a chain with 0 blocks. 453735ms th_a main.cpp:267 main] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 455003ms th_a witness.cpp:181 block_production_loo] Generated block #1 with timestamp 2018-05-11T15:07:35 at time 2018-05-11T15:07:35 460000ms th_a witness.cpp:181 block_production_loo] Generated block #2 with timestamp 2018-05-11T15:07:40 at time 2018-05-11T15:07:40 462000ms th_a witness.cpp:181 block_production_loo] Generated block #3 with timestamp 2018-05-11T15:07:42 at time 2018-05-11T15:07:42 5. 命令行钱包的使用 本节主要讲解如何使用命令行钱包导入账户、创建一个新账户，并转账，查看属性等等。 5.1 创建钱包 现在使用命令行钱包（cli_wallet）连接到上一节创建的证人节点（witness_node）。 保持证人节点处于运行状态，打开另一个命令提示符窗口，运行如下命令： mkdir -p wallet &amp;&amp; cd wallet cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --rpc-endpoint 0.0.0.0:38099 --rpc-http-endpoint 0.0.0.0:38092 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 下面对指令参数进行解释： --wallet-file：指定钱包json文件，该文件用于保存本钱包中所有加密后的私钥； --server-rpc-endpoint：rpc服务器终端地址，指定钱包要连接的区块链全节点所需要的协议、地址和端口； --rpc-endpoint：指定命令行钱包要监听的websocket RPC的ip地址和端口号； --rpc-http-endpoint：指定命令行钱包要监听的HTTP RPC的ip地址和端口号； --chain-id：指定要连接的区块链ID。不指定的话，钱包连接到bitshares的正式链上。 收到set_password提示，表示cli_wallet钱包已成功连接到witness_node节点。为钱包设置一个密码。 该密码用于加密钱包中所有的私钥。 在本例中，我使用supersecret作为密码。 使用如下命令给钱包创建密码并解锁新创建的钱包： set_password supersecret unlock supersecret 5.2 导入账号和资金 要将帐户导入钱包，必须知道账户名称和私钥才行。使用import_key命令将代码中默认的账户nathan导入钱包（其私钥为5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3）： import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 注意：帐户名称是前面在genesies.json文件中设置的， 私钥也是前面在config.ini文件中设置的。 现在已经将私钥导入到钱包中，但初始账户仍然没有资金（后面升级账户需要资金）。 资金在genesies.json文件中的initial_balances字段已经设置好了。 使用import_balance命令可以将这些资金免费（相对于转账需要付手续费来说的）导入钱包： import_balance nathan [&quot;5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3&quot;] true 5.3 创建新帐户 现在来创建另一个帐户（名为alpha ），以便在nathan和alpha之间来回转移资金，产生交易。 只能使用现有的账户去创建新账户，且该账户（称为注册商: registrar）必须支付注册费用。 此外，要求注册商账户必须是终身会员（LTM: lifetime member）。使用upgrade_account命令将nathan升级到LTM： upgrade_account nathan true 注意：由于缓存问题 ，需要重启cli_wallet钱包，否则升级nathan没有更新。 按下ctrl+c停止CLI钱包，运行与以下命令重新钱包并解锁： cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 unlock supersecret 确认nathan现在处于LTM状态： get_account nathan 在打印的账户属性中，membership_expiration_date的属性值应该是1969-12-31T23:59:59 。 如果仍然是1970-01-01T00:00:00，那么账户就没有成功升级。 现在用原账户作为注册商注册一个新帐户了。 首先需要新帐户的公钥。可以通过suggest_brain_key命令来获得： suggest_brain_key 显示的信息大致如下： { &quot;brain_priv_key&quot;: &quot;FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND&quot;, &quot;wif_priv_key&quot;: &quot;5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp&quot;, &quot;pub_key&quot;: &quot;BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF&quot; } 其中brain_priv_key是私钥助记符，wif_priv_key是钱包导入格式的私钥，pub_key。一定要记下以上重要的信息找个黑客攻击不到的地方保存起来，非常关键。 现在可以注册一个新帐户。可以只使用前面推荐的公钥来注册一个名为alpha的新帐户： register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan 0 true 5.4 转移资金给新账户 使用transfer命令从nathan账户里转一些资金alpha给： transfer nathan alpha 100000 BTS &quot;here is some cash&quot; true 可以验证alpha是否收到了钱，运行一下命令查看账户余额： list_account_balances alpha 6. 部署其他证人节点生产区块 前面已经创建一个新的区块链，并已经开启生产区块。本节主要讲解如何在新节点上创建新账户并让新账户成为证人，并投票成活跃证人生产区块。 6.1 新证人节点连接到区块链网 在新节点上按同样的方式编译安装BitShares Core 测试版。 为了保证新节点连接的是前面创建的私链，必须保证chain id相同，而witness_node无法指定chain id，只能通过genesis.json文件初始化。 将原来的genesis.json复制到新节点指定目录中。可用如下指令完成该功能： mkdir -p testnet-home &amp;&amp; cd testnet-home/ scp bitshares@192.168.110.103:~/testnet_home/my-genesis.json . 然后运行以下指令初始化该证人节点，并按ctrl+c完成： witness_node --data-dir data/ --genesis-json my-genesis.json --seed-nodes &quot;[]&quot; 然后编辑 data 目录下的config.ini，修改设置如下： seed-nodes = [&quot;192.168.110.103:31010&quot;] rpc-endpoint = 127.0.0.1:38090 基本和前面的config.ini设置差不多，有两点要注意，seed-nodes种子节点集合一定填写之前启动的全节点（即证人节点）的 ip 和 p2p-endpoint 端口。rpc-endpoint指定开启的rpc监听端口，以方便cli-wallet和web钱包与证人节点连接。 使用如下命令重新运行证人节点： witness_node --data-dir data 由于本节点没有证人权限，所以不会生产区块，只会同步区块信息。打印的信息类似如下： 2188254ms th_a main.cpp:266 main ] Started BitShares node on a chain with 0 blocks. 2188254ms th_a main.cpp:267 main ] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 2190025ms th_a application.cpp:512 handle_block ] Got block: #460 time: 2018-05-16T09:36:30 latency: 25 ms from: init6 irreversible: 452 (-8) 2195020ms th_a application.cpp:512 handle_block ] Got block: #461 time: 2018-05-16T09:36:35 latency: 20 ms from: init1 irreversible: 453 (-8) 2200021ms th_a application.cpp:512 handle_block ] Got block: #462 time: 2018-05-16T09:36:40 latency: 21 ms from: init10 irreversible: 454 (-8) 当该节点和网络中的区块数据同步完成后，并定期从其他节点接收新区块后，才能继续下一步。 6.2 打开新钱包创建新账户 基本和前面的操作一样（详细讲解请参考：命令行钱包的使用）。保持证人节点处于运行状态，打开另一个命令提示符窗口： mkdir -p wallet &amp;&amp; cd wallet cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 设置新钱包密码，并解锁： set_password my_password unlock my_password 只能使用现有的账户去创建新账户，因此先导入 nathan 用户： import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 使用指令suggest_brain_key获得新账户信息： suggest_brain_key 得到新账户信息如下： { &quot;brain_priv_key&quot;: &quot;FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND&quot;, &quot;wif_priv_key&quot;: &quot;5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp&quot;, &quot;pub_key&quot;: &quot;BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF&quot; } 创建新账户alpha： register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan 0 true 6.3 升级新账户为终生会员 新账户必须升级为终身会员（LTM: lifetime member）后才能称为证人账户。而新账户升级为LTM需要的资金只能通过其他账户转账。 给账户alpha转入一些资金： transfer nathan alpha 100000 BTS &quot;here is some cash!&quot; true 导入新账户alpha： import_key alpha 5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp 可以查看当前钱包的账户及其余额： list_my_accounts list_account_balances alpha 现在可以升级为终身会员了： upgrade_account alpha true 6.4 注册为证人并投票为活跃证人 要成为证人，首先需要创建一个可以投票的证人对象。 create_witness alpha &quot;http://www.alpha&quot; true 可运行get_witness 来获得新证人的id和signing_key。 get_witness alpha 得到结果： { &quot;id&quot;: &quot;1.6.12&quot;, &quot;witness_account&quot;: &quot;1.2.18&quot;, &quot;last_aslot&quot;: 0, &quot;signing_key&quot;: &quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot;, &quot;vote_id&quot;: &quot;1:22&quot;, &quot;total_votes&quot;: 0, &quot;url&quot;: &quot;http://www.alpha&quot;, &quot;total_missed&quot;: 0, &quot;last_confirmed_block_num&quot;: 0 } witness_node需要signing_key和对应的私钥，并联合id才能生成区块。通过get_private_key获取该签名密钥的私钥： get_private_key &quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot; 得到私钥如下： &quot;5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF&quot; 要想让证人生产区块就必须给新建的证人对象投票让其成为活跃证人： vote_for_witness alpha alpha true true 只有等到下一个维护间隔后，投票才会统计，证人 才有可能成为新的活跃证人。可以使用命令get_dynamic_global_properties查看next_maintenance_time字段的值。在前面我们将维护间隔重新设置为了10分钟。 6.5 让新证人节点生产区块 一旦下一次维护时间间隔过去后，可以使用get_global_properties命令来查看到当前的活动证人列表，根据证人id查看新证人已被投票成为活跃证人。一旦成为活跃证人后， 就可以让新证人节点生产区块。 现在需要重新启动证人，关闭钱包（ctrl+d），然后关闭证人节点（ctrl+c）。 用上面获得新证人id及其公私钥对编辑 data 目录下的config.ini，添加设置如下： # ID of witness controlled by this node (e.g. &quot;1.6.5&quot;, quotes are required, may specify multiple times) witness-id = &quot;1.6.12&quot; # Tuple of [PublicKey, WIF private key] (may specify multiple times) private-key = [&quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot;,&quot;5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF&quot;] private-key， 指定本证人节点生产和签署区块所需的公私钥对。 重新运行证人节点： witness_node --data-dir data 如果witness_node的输出结果如下，那么就轮到本证人节点生产区块，并成功出块： 909991ms th_a application.cpp:512 handle_block ] Got block: #907 time: 2018-05-16T10:15:10 latency: -8 ms from: init9 irreversible: 898 (-9) 915000ms th_a witness.cpp:181 block_production_loo ] Generated block #908 with timestamp 2018-05-16T10:15:15 at time 2018-05-16T10:15:15 919991ms th_a application.cpp:512 handle_block ] Got block: #909 time: 2018-05-16T10:15:20 latency: -8 ms from: init6 irreversible: 901 (-8) 参考文章： bitshares-core/README.md: https://github.com/bitshares/bitshares-core/blob/master/README.md Private Testnet Howto: http://docs.bitshares.eu/testnet/private-testnet.html private testnet: https://github.com/bitshares/bitshares-core/wiki/private-testnet CLI Wallet: http://docs.bitshares.org/integration/apps/cliwallet.html Howto Run a Block-producing Witness: http://docs.bitshares.eu/bitshares/tutorials/witness-howto.html Bitshares 私链部署witness节点: https://www.jianshu.com/p/2cb1cdb98529 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/05/16/2b02812cae3c366a1f734ec3798a4461.html" />
<meta property="og:url" content="https://mlh.app/2018/05/16/2b02812cae3c366a1f734ec3798a4461.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：文章所有权归作者个人所有，转载请注明作者及来源 https://blog.csdn.net/ggq89/article/details/80234262 关于如何搭建BitShares多节点私链请参看：BitShares 2.0 多节点私链部署 关于如何搭建BitShares的web钱包搭建和接入私链请参考：BitShares之web钱包搭建及接入私链 关于如何对BitShares进行交易量压力测试请参考：BitShares交易量压力测试 目录 1. 总体概述 2. 软件版本和硬件环境要求 3. 编译和安装 BitShares Core 4. 搭建私链并启动 4.1 创建目录 4.2 创建和编辑genesis文件 4.3 初始化证人节点 4.4 配置证人节点 4.5 开始区块生产 5. 命令行钱包的使用 5.1 创建钱包 5.2 导入账号和资金 5.3 创建新帐户 5.4 转移资金给新账户 6. 部署其他证人节点生产区块 6.1 新证人节点连接到区块链网 6.2 打开新钱包创建新账户 6.3 升级新账户为终生会员 6.4 注册为证人并投票为活跃证人 6.5 让新证人节点生产区块 基于便于管理和测试石墨烯（graphene）区块链的目的，本文讲解如何在局域网中部署一个包含多个证人节点的BitShares 2.0 私有测试链。 1. 总体概述 一般来说，在BitShares2.0中，每个证人是不同的账号在不同的节点上运行，但为了方便私有测试网的部署和讲解，在整个区块链创建初始时使用1个节点1个账号控制11个证人生产区块，后面再逐渐创建新的证人逐步替代。 基于上面的目标，实现步骤如下： 首先在一个节点上初始化和启动整个区块链测试链。 创建其他账号，将其选举投票为证人。 开启其他证人节点，加入网络开始生产区块。 2. 软件版本和硬件环境要求 本文基于的BitShares的版本为：BitShares Core Release 2.0.180425 本文基于的操作系统为: Ubuntu 16.04.4 LTS 官方建议使用32GB（至少16GB） RAM、SSD硬盘的专用服务器。本人使用普通非SSD硬盘，经测试，编译BitShares全节点程序至少需要8G RAM。 3. 编译和安装 BitShares Core 更新和安装依赖库： sudo apt-get update sudo apt-get install autoconf cmake git libboost-all-dev libssl-dev g++ libcurl4-openssl-dev 克隆代码仓库，切换到指定tag，更新子模块代码： git clone https://github.com/bitshares/bitshares-core.git cd bitshares-core &amp;&amp; git checkout 2.0.180425 git submodule update --init --recursive 生成Makefile，编译，安装 cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo . make sudo make install 检查是否编译安装成功： cd .. &amp;&amp; which witness_node cli_wallet 4. 搭建私链并启动 本节主要讲解如何从genesis.json开始，创建一个区块链，并让证人节点开始生产区块。 4.1 创建目录 创建测试目录，并切换到该目录 mkdir -p testnet_home &amp;&amp; cd testnet_home/ 4.2 创建和编辑genesis文件 witness_node --create-genesis-json=my-genesis.json vim my-genesis.json 石墨烯（graphene）代码中默认的geneis块包含唯一一个账户，geneis块中所有的初始证人，初始委员会成员和初始证人候选人都是该账户，该账户的名称是：nathan，私钥为：5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3。 genesis文件是用来定义区块链网络初始状态，可以诸如以下的状态： 存在于genesis区块的账户，包括账户的名字和公钥 资产及其初始分配状况（包括核心资产） 区块链参数的初始值 初始证人的帐户/签名密钥（或者其他任何帐户，注：默认的 witness 是 init0～inti10）。 在本人的设置中，为了加快活跃证人的更新时间，修改如下： &quot;maintenance_interval&quot;: 600, 保存并退出。 4.3 初始化证人节点 运行如下命令来初始化证人节点： witness_node --data-dir data/ --genesis-json my-genesis.json --seed-nodes &quot;[]&quot; 当类似以下信息出现时，意味着初始化过程完成，按ctrl+c关闭见证节点： 1620535ms th_a main.cpp:266 main] Started BitShares node on a chain with 0 blocks. 1620535ms th_a main.cpp:267 main] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 此时，完成了两件事： 创建了区块链data目录和在其之下的config.ini文件。 获得了区块链ID。将Chain ID另外保存起来，后面会用到。 4.4 配置证人节点 打开[Testnet-Home]/data/config.ini文件： vim data/config.ini 在合适的位置进行以下设置，注意将重复的设置注释掉： p2p-endpoint = 0.0.0.0:31010 seed-nodes = [] rpc-endpoint = 0.0.0.0:38090 genesis-json = my-genesis.json enable-stale-production = true # ID of witness controlled by this node (e.g. &quot;1.6.5&quot;, quotes are required, may specify multiple times) witness-id = &quot;1.6.1&quot; witness-id = &quot;1.6.2&quot; witness-id = &quot;1.6.3&quot; witness-id = &quot;1.6.4&quot; witness-id = &quot;1.6.5&quot; witness-id = &quot;1.6.6&quot; witness-id = &quot;1.6.7&quot; witness-id = &quot;1.6.8&quot; witness-id = &quot;1.6.9&quot; witness-id = &quot;1.6.10&quot; witness-id = &quot;1.6.11&quot; 解释一下上面的设置： p2p-endpoint，指定开启的p2p监听端口，以方便其他节点连接，可以作为其他节点的seed-node。 rpc-endpoint，指定开启的rpc监听端口，以方便cli-wallet和web钱包与证人节点连接。 genesis-json，设置genesis.json的路径，通常只在创建新链生产创世区块时设置。 enable-stale-production，让本节点无视区块链数据的时间，无论如何都生成区块数据。该字段通常只在创建新链生产创世区块时设为true。当已存在区块链时，一定要将本参数设为false或者不管，否则会因数据不完整导致分叉。 seed-nodes，设置种子节点集合，以方便快速连接到区块链网络和同步区块链数据。在创建新链生产创世区块时设为空，以防止连接到正式网络（代码）中的默认种子节点。当连接已有区块链网络时，尽可能多的设置种子节点以加快同步速度。 witness-id，用于授权本证人节点所代表的证人id产生区块，可指定多个。一般来说一个证人节点授权一个证人id，私链第一个节点指定了11个。 4.5 开始区块生产 关键时刻到来了，生产私有测试链的第一个区块。 运行如下命令： witness_node --data-dir=data 将看到如下重要信息： ******************************** * * * ------- NEW CHAIN ------ * * - Welcome to Graphene! - * * ------------------------ * * * ******************************** 接着连续将看到类以下消息，表明成功开始生产区块： 453735ms th_a main.cpp:266 main] Started BitShares node on a chain with 0 blocks. 453735ms th_a main.cpp:267 main] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 455003ms th_a witness.cpp:181 block_production_loo] Generated block #1 with timestamp 2018-05-11T15:07:35 at time 2018-05-11T15:07:35 460000ms th_a witness.cpp:181 block_production_loo] Generated block #2 with timestamp 2018-05-11T15:07:40 at time 2018-05-11T15:07:40 462000ms th_a witness.cpp:181 block_production_loo] Generated block #3 with timestamp 2018-05-11T15:07:42 at time 2018-05-11T15:07:42 5. 命令行钱包的使用 本节主要讲解如何使用命令行钱包导入账户、创建一个新账户，并转账，查看属性等等。 5.1 创建钱包 现在使用命令行钱包（cli_wallet）连接到上一节创建的证人节点（witness_node）。 保持证人节点处于运行状态，打开另一个命令提示符窗口，运行如下命令： mkdir -p wallet &amp;&amp; cd wallet cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --rpc-endpoint 0.0.0.0:38099 --rpc-http-endpoint 0.0.0.0:38092 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 下面对指令参数进行解释： --wallet-file：指定钱包json文件，该文件用于保存本钱包中所有加密后的私钥； --server-rpc-endpoint：rpc服务器终端地址，指定钱包要连接的区块链全节点所需要的协议、地址和端口； --rpc-endpoint：指定命令行钱包要监听的websocket RPC的ip地址和端口号； --rpc-http-endpoint：指定命令行钱包要监听的HTTP RPC的ip地址和端口号； --chain-id：指定要连接的区块链ID。不指定的话，钱包连接到bitshares的正式链上。 收到set_password提示，表示cli_wallet钱包已成功连接到witness_node节点。为钱包设置一个密码。 该密码用于加密钱包中所有的私钥。 在本例中，我使用supersecret作为密码。 使用如下命令给钱包创建密码并解锁新创建的钱包： set_password supersecret unlock supersecret 5.2 导入账号和资金 要将帐户导入钱包，必须知道账户名称和私钥才行。使用import_key命令将代码中默认的账户nathan导入钱包（其私钥为5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3）： import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 注意：帐户名称是前面在genesies.json文件中设置的， 私钥也是前面在config.ini文件中设置的。 现在已经将私钥导入到钱包中，但初始账户仍然没有资金（后面升级账户需要资金）。 资金在genesies.json文件中的initial_balances字段已经设置好了。 使用import_balance命令可以将这些资金免费（相对于转账需要付手续费来说的）导入钱包： import_balance nathan [&quot;5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3&quot;] true 5.3 创建新帐户 现在来创建另一个帐户（名为alpha ），以便在nathan和alpha之间来回转移资金，产生交易。 只能使用现有的账户去创建新账户，且该账户（称为注册商: registrar）必须支付注册费用。 此外，要求注册商账户必须是终身会员（LTM: lifetime member）。使用upgrade_account命令将nathan升级到LTM： upgrade_account nathan true 注意：由于缓存问题 ，需要重启cli_wallet钱包，否则升级nathan没有更新。 按下ctrl+c停止CLI钱包，运行与以下命令重新钱包并解锁： cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 unlock supersecret 确认nathan现在处于LTM状态： get_account nathan 在打印的账户属性中，membership_expiration_date的属性值应该是1969-12-31T23:59:59 。 如果仍然是1970-01-01T00:00:00，那么账户就没有成功升级。 现在用原账户作为注册商注册一个新帐户了。 首先需要新帐户的公钥。可以通过suggest_brain_key命令来获得： suggest_brain_key 显示的信息大致如下： { &quot;brain_priv_key&quot;: &quot;FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND&quot;, &quot;wif_priv_key&quot;: &quot;5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp&quot;, &quot;pub_key&quot;: &quot;BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF&quot; } 其中brain_priv_key是私钥助记符，wif_priv_key是钱包导入格式的私钥，pub_key。一定要记下以上重要的信息找个黑客攻击不到的地方保存起来，非常关键。 现在可以注册一个新帐户。可以只使用前面推荐的公钥来注册一个名为alpha的新帐户： register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan 0 true 5.4 转移资金给新账户 使用transfer命令从nathan账户里转一些资金alpha给： transfer nathan alpha 100000 BTS &quot;here is some cash&quot; true 可以验证alpha是否收到了钱，运行一下命令查看账户余额： list_account_balances alpha 6. 部署其他证人节点生产区块 前面已经创建一个新的区块链，并已经开启生产区块。本节主要讲解如何在新节点上创建新账户并让新账户成为证人，并投票成活跃证人生产区块。 6.1 新证人节点连接到区块链网 在新节点上按同样的方式编译安装BitShares Core 测试版。 为了保证新节点连接的是前面创建的私链，必须保证chain id相同，而witness_node无法指定chain id，只能通过genesis.json文件初始化。 将原来的genesis.json复制到新节点指定目录中。可用如下指令完成该功能： mkdir -p testnet-home &amp;&amp; cd testnet-home/ scp bitshares@192.168.110.103:~/testnet_home/my-genesis.json . 然后运行以下指令初始化该证人节点，并按ctrl+c完成： witness_node --data-dir data/ --genesis-json my-genesis.json --seed-nodes &quot;[]&quot; 然后编辑 data 目录下的config.ini，修改设置如下： seed-nodes = [&quot;192.168.110.103:31010&quot;] rpc-endpoint = 127.0.0.1:38090 基本和前面的config.ini设置差不多，有两点要注意，seed-nodes种子节点集合一定填写之前启动的全节点（即证人节点）的 ip 和 p2p-endpoint 端口。rpc-endpoint指定开启的rpc监听端口，以方便cli-wallet和web钱包与证人节点连接。 使用如下命令重新运行证人节点： witness_node --data-dir data 由于本节点没有证人权限，所以不会生产区块，只会同步区块信息。打印的信息类似如下： 2188254ms th_a main.cpp:266 main ] Started BitShares node on a chain with 0 blocks. 2188254ms th_a main.cpp:267 main ] Chain ID is 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 2190025ms th_a application.cpp:512 handle_block ] Got block: #460 time: 2018-05-16T09:36:30 latency: 25 ms from: init6 irreversible: 452 (-8) 2195020ms th_a application.cpp:512 handle_block ] Got block: #461 time: 2018-05-16T09:36:35 latency: 20 ms from: init1 irreversible: 453 (-8) 2200021ms th_a application.cpp:512 handle_block ] Got block: #462 time: 2018-05-16T09:36:40 latency: 21 ms from: init10 irreversible: 454 (-8) 当该节点和网络中的区块数据同步完成后，并定期从其他节点接收新区块后，才能继续下一步。 6.2 打开新钱包创建新账户 基本和前面的操作一样（详细讲解请参考：命令行钱包的使用）。保持证人节点处于运行状态，打开另一个命令提示符窗口： mkdir -p wallet &amp;&amp; cd wallet cli_wallet --wallet-file my-wallet.json --server-rpc-endpoint ws://127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4 设置新钱包密码，并解锁： set_password my_password unlock my_password 只能使用现有的账户去创建新账户，因此先导入 nathan 用户： import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 使用指令suggest_brain_key获得新账户信息： suggest_brain_key 得到新账户信息如下： { &quot;brain_priv_key&quot;: &quot;FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND&quot;, &quot;wif_priv_key&quot;: &quot;5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp&quot;, &quot;pub_key&quot;: &quot;BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF&quot; } 创建新账户alpha： register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan 0 true 6.3 升级新账户为终生会员 新账户必须升级为终身会员（LTM: lifetime member）后才能称为证人账户。而新账户升级为LTM需要的资金只能通过其他账户转账。 给账户alpha转入一些资金： transfer nathan alpha 100000 BTS &quot;here is some cash!&quot; true 导入新账户alpha： import_key alpha 5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp 可以查看当前钱包的账户及其余额： list_my_accounts list_account_balances alpha 现在可以升级为终身会员了： upgrade_account alpha true 6.4 注册为证人并投票为活跃证人 要成为证人，首先需要创建一个可以投票的证人对象。 create_witness alpha &quot;http://www.alpha&quot; true 可运行get_witness 来获得新证人的id和signing_key。 get_witness alpha 得到结果： { &quot;id&quot;: &quot;1.6.12&quot;, &quot;witness_account&quot;: &quot;1.2.18&quot;, &quot;last_aslot&quot;: 0, &quot;signing_key&quot;: &quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot;, &quot;vote_id&quot;: &quot;1:22&quot;, &quot;total_votes&quot;: 0, &quot;url&quot;: &quot;http://www.alpha&quot;, &quot;total_missed&quot;: 0, &quot;last_confirmed_block_num&quot;: 0 } witness_node需要signing_key和对应的私钥，并联合id才能生成区块。通过get_private_key获取该签名密钥的私钥： get_private_key &quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot; 得到私钥如下： &quot;5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF&quot; 要想让证人生产区块就必须给新建的证人对象投票让其成为活跃证人： vote_for_witness alpha alpha true true 只有等到下一个维护间隔后，投票才会统计，证人 才有可能成为新的活跃证人。可以使用命令get_dynamic_global_properties查看next_maintenance_time字段的值。在前面我们将维护间隔重新设置为了10分钟。 6.5 让新证人节点生产区块 一旦下一次维护时间间隔过去后，可以使用get_global_properties命令来查看到当前的活动证人列表，根据证人id查看新证人已被投票成为活跃证人。一旦成为活跃证人后， 就可以让新证人节点生产区块。 现在需要重新启动证人，关闭钱包（ctrl+d），然后关闭证人节点（ctrl+c）。 用上面获得新证人id及其公私钥对编辑 data 目录下的config.ini，添加设置如下： # ID of witness controlled by this node (e.g. &quot;1.6.5&quot;, quotes are required, may specify multiple times) witness-id = &quot;1.6.12&quot; # Tuple of [PublicKey, WIF private key] (may specify multiple times) private-key = [&quot;BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT&quot;,&quot;5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF&quot;] private-key， 指定本证人节点生产和签署区块所需的公私钥对。 重新运行证人节点： witness_node --data-dir data 如果witness_node的输出结果如下，那么就轮到本证人节点生产区块，并成功出块： 909991ms th_a application.cpp:512 handle_block ] Got block: #907 time: 2018-05-16T10:15:10 latency: -8 ms from: init9 irreversible: 898 (-9) 915000ms th_a witness.cpp:181 block_production_loo ] Generated block #908 with timestamp 2018-05-16T10:15:15 at time 2018-05-16T10:15:15 919991ms th_a application.cpp:512 handle_block ] Got block: #909 time: 2018-05-16T10:15:20 latency: -8 ms from: init6 irreversible: 901 (-8) 参考文章： bitshares-core/README.md: https://github.com/bitshares/bitshares-core/blob/master/README.md Private Testnet Howto: http://docs.bitshares.eu/testnet/private-testnet.html private testnet: https://github.com/bitshares/bitshares-core/wiki/private-testnet CLI Wallet: http://docs.bitshares.org/integration/apps/cliwallet.html Howto Run a Block-producing Witness: http://docs.bitshares.eu/bitshares/tutorials/witness-howto.html Bitshares 私链部署witness节点: https://www.jianshu.com/p/2cb1cdb98529 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/05/16/2b02812cae3c366a1f734ec3798a4461.html","headline":"BitShares 2.0 多节点私链部署","dateModified":"2018-05-16T00:00:00+08:00","datePublished":"2018-05-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/05/16/2b02812cae3c366a1f734ec3798a4461.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>BitShares 2.0 多节点私链部署</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：文章所有权归作者个人所有，转载请注明作者及来源 https://blog.csdn.net/ggq89/article/details/80234262 
 </div> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>关于如何搭建BitShares多节点私链请参看：<a href="https://blog.csdn.net/ggq89/article/details/80234262" rel="nofollow">BitShares 2.0 多节点私链部署</a></p> 
  <p>关于如何搭建BitShares的web钱包搭建和接入私链请参考：<a href="https://blog.csdn.net/ggq89/article/details/80467249" rel="nofollow">BitShares之web钱包搭建及接入私链</a></p> 
  <p>关于如何对BitShares进行交易量压力测试请参考：<a href="https://blog.csdn.net/ggq89/article/details/80470034" rel="nofollow">BitShares交易量压力测试</a></p> 
  <p><strong>目录</strong></p> 
  <p></p>
  <div class="toc"> 
   <ul> 
    <li><a href="#1-总体概述" rel="nofollow">1. 总体概述</a></li> 
    <li><a href="#2-软件版本和硬件环境要求" rel="nofollow">2. 软件版本和硬件环境要求</a></li> 
    <li><a href="#3-编译和安装-bitshares-core" rel="nofollow">3. 编译和安装 BitShares Core</a></li> 
    <li><a href="#4-搭建私链并启动" rel="nofollow">4. 搭建私链并启动</a>
     <ul> 
      <li><a href="#41-创建目录" rel="nofollow">4.1 创建目录</a></li> 
      <li><a href="#42-创建和编辑genesis文件" rel="nofollow">4.2 创建和编辑genesis文件</a></li> 
      <li><a href="#43-初始化证人节点" rel="nofollow">4.3 初始化证人节点</a></li> 
      <li><a href="#44-配置证人节点" rel="nofollow">4.4 配置证人节点</a></li> 
      <li><a href="#45-开始区块生产" rel="nofollow">4.5 开始区块生产</a></li> 
     </ul> </li> 
    <li><a href="#5-命令行钱包的使用" rel="nofollow">5. 命令行钱包的使用</a>
     <ul> 
      <li><a href="#51-创建钱包" rel="nofollow">5.1 创建钱包</a></li> 
      <li><a href="#52-导入账号和资金" rel="nofollow">5.2 导入账号和资金</a></li> 
      <li><a href="#53-创建新帐户" rel="nofollow">5.3 创建新帐户</a></li> 
      <li><a href="#54-转移资金给新账户" rel="nofollow">5.4 转移资金给新账户</a></li> 
     </ul> </li> 
    <li><a href="#6-部署其他证人节点生产区块" rel="nofollow">6. 部署其他证人节点生产区块</a>
     <ul> 
      <li><a href="#61-新证人节点连接到区块链网" rel="nofollow">6.1 新证人节点连接到区块链网</a></li> 
      <li><a href="#62-打开新钱包创建新账户" rel="nofollow">6.2 打开新钱包创建新账户</a></li> 
      <li><a href="#63-升级新账户为终生会员" rel="nofollow">6.3 升级新账户为终生会员</a></li> 
      <li><a href="#64-注册为证人并投票为活跃证人" rel="nofollow">6.4 注册为证人并投票为活跃证人</a></li> 
      <li><a href="#65-让新证人节点生产区块" rel="nofollow">6.5 让新证人节点生产区块</a></li> 
     </ul> </li> 
   </ul> 
  </div> 
  <p></p> 
  <p>基于便于管理和测试石墨烯（graphene）区块链的目的，本文讲解如何在局域网中部署一个包含多个证人节点的BitShares 2.0 私有测试链。</p> 
  <h1 id="1-总体概述">1. 总体概述</h1> 
  <p>一般来说，在BitShares2.0中，每个证人是不同的账号在不同的节点上运行，但为了方便私有测试网的部署和讲解，在整个区块链创建初始时使用1个节点1个账号控制11个证人生产区块，后面再逐渐创建新的证人逐步替代。</p> 
  <p>基于上面的目标，实现步骤如下：</p> 
  <ol> 
   <li>首先在一个节点上初始化和启动整个区块链测试链。</li> 
   <li>创建其他账号，将其选举投票为证人。</li> 
   <li>开启其他证人节点，加入网络开始生产区块。</li> 
  </ol> 
  <h1 id="2-软件版本和硬件环境要求">2. 软件版本和硬件环境要求</h1> 
  <ul> 
   <li><p>本文基于的BitShares的版本为：<a href="https://github.com/bitshares/bitshares-core/releases/tag/2.0.180425" rel="nofollow">BitShares Core Release 2.0.180425</a></p></li> 
   <li><p>本文基于的操作系统为: <a href="https://fridge.ubuntu.com/2018/03/03/ubuntu-16-04-4-lts-released/" rel="nofollow">Ubuntu 16.04.4 LTS</a></p></li> 
   <li><p>官方建议使用32GB（至少16GB） RAM、SSD硬盘的专用服务器。本人使用普通非SSD硬盘，经测试，编译BitShares全节点程序至少需要8G RAM。</p></li> 
  </ul> 
  <h1 id="3-编译和安装-bitshares-core">3. 编译和安装 BitShares Core</h1> 
  <p>更新和安装依赖库：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">sudo apt<span class="hljs-attribute">-get</span> update
sudo apt<span class="hljs-attribute">-get</span> install autoconf cmake git libboost<span class="hljs-attribute">-all</span><span class="hljs-attribute">-dev</span> libssl<span class="hljs-attribute">-dev</span> g<span class="hljs-subst">++</span> libcurl4<span class="hljs-attribute">-openssl</span><span class="hljs-attribute">-dev</span></code></pre> 
  <p>克隆代码仓库，切换到指定tag，更新子模块代码：</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">git</span> <span class="hljs-comment">clone</span> <span class="hljs-comment">https://github</span><span class="hljs-string">.</span><span class="hljs-comment">com/bitshares/bitshares</span><span class="hljs-literal">-</span><span class="hljs-comment">core</span><span class="hljs-string">.</span><span class="hljs-comment">git</span>
<span class="hljs-comment">cd</span> <span class="hljs-comment">bitshares</span><span class="hljs-literal">-</span><span class="hljs-comment">core</span> <span class="hljs-comment">&amp;&amp;</span> <span class="hljs-comment">git</span> <span class="hljs-comment">checkout</span> <span class="hljs-comment">2</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">180425</span>
<span class="hljs-comment">git</span> <span class="hljs-comment">submodule</span> <span class="hljs-comment">update</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">init</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">recursive</span></code></pre> 
  <p>生成Makefile，编译，安装</p> 
  <pre class="prettyprint"><code class=" hljs go">cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo .
<span class="hljs-built_in">make</span>
sudo <span class="hljs-built_in">make</span> install</code></pre> 
  <p>检查是否编译安装成功：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> .. &amp;&amp; which witness_node cli_wallet</code></pre> 
  <h1 id="4-搭建私链并启动">4. 搭建私链并启动</h1> 
  <p>本节主要讲解如何从<code>genesis.json</code>开始，创建一个区块链，并让证人节点开始生产区块。</p> 
  <h2 id="41-创建目录">4.1 创建目录</h2> 
  <p>创建测试目录，并切换到该目录</p> 
  <pre class="prettyprint"><code class=" hljs bash">mkdir -p testnet_home &amp;&amp; <span class="hljs-built_in">cd</span> testnet_home/</code></pre> 
  <h2 id="42-创建和编辑genesis文件">4.2 创建和编辑<code>genesis</code>文件</h2> 
  <pre class="prettyprint"><code class=" hljs lasso">witness_node <span class="hljs-subst">--</span>create<span class="hljs-attribute">-genesis</span><span class="hljs-attribute">-json</span><span class="hljs-subst">=</span>my<span class="hljs-attribute">-genesis</span><span class="hljs-built_in">.</span>json
vim my<span class="hljs-attribute">-genesis</span><span class="hljs-built_in">.</span>json</code></pre> 
  <p>石墨烯（graphene）代码中默认的geneis块包含唯一一个账户，geneis块中所有的初始证人，初始委员会成员和初始证人候选人都是该账户，该账户的名称是：<code>nathan</code>，私钥为：<code>5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3</code>。</p> 
  <p><code>genesis</code>文件是用来定义区块链网络初始状态，可以诸如以下的状态：</p> 
  <ul> 
   <li>存在于<code>genesis区块</code>的账户，包括账户的名字和公钥</li> 
   <li>资产及其初始分配状况（包括核心资产） </li> 
   <li>区块链参数的初始值 </li> 
   <li>初始证人的帐户/签名密钥（或者其他任何帐户，注：默认的 <code>witness</code> 是 init0～inti10）。 </li> 
  </ul> 
  <p>在本人的设置中，为了加快活跃证人的更新时间，修改如下：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-string">"maintenance_interval"</span>: <span class="hljs-number">600</span>,</code></pre> 
  <p>保存并退出。</p> 
  <h2 id="43-初始化证人节点">4.3 初始化证人节点</h2> 
  <p>运行如下命令来初始化证人节点：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">witness_node <span class="hljs-subst">--</span><span class="hljs-built_in">data</span><span class="hljs-attribute">-dir</span> <span class="hljs-built_in">data</span><span class="hljs-subst">/</span> <span class="hljs-subst">--</span>genesis<span class="hljs-attribute">-json</span> my<span class="hljs-attribute">-genesis</span><span class="hljs-built_in">.</span>json <span class="hljs-subst">--</span>seed<span class="hljs-attribute">-nodes</span> <span class="hljs-string">"[]"</span></code></pre> 
  <p>当类似以下信息出现时，意味着初始化过程完成，按<code>ctrl+c</code>关闭见证节点：</p> 
  <pre class="prettyprint"><code class=" hljs applescript"><span class="hljs-number">1620535</span>ms th_a main.cpp:<span class="hljs-number">266</span> main] Started BitShares node <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> a chain <span class="hljs-keyword">with</span> <span class="hljs-number">0</span> blocks.
<span class="hljs-number">1620535</span>ms th_a main.cpp:<span class="hljs-number">267</span> main] Chain ID <span class="hljs-keyword">is</span> <span class="hljs-number">20e5</span>aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4</code></pre> 
  <p>此时，完成了两件事：</p> 
  <ol> 
   <li>创建了区块链<code>data</code>目录和在其之下的<code>config.ini</code>文件。</li> 
   <li>获得了区块链ID。将<code>Chain ID</code>另外保存起来，后面会用到。</li> 
  </ol> 
  <h2 id="44-配置证人节点">4.4 配置证人节点</h2> 
  <p>打开<code>[Testnet-Home]/data/config.ini</code>文件：</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">vim</span> <span class="hljs-typedef"><span class="hljs-keyword">data</span>/config.ini</span></code></pre> 
  <p>在合适的位置进行以下设置，注意将重复的设置注释掉： </p> 
  <pre class="prettyprint"><code class=" hljs applescript">p2p-endpoint = <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">31010</span>
seed-nodes = []
rpc-endpoint = <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">38090</span>
genesis-json = <span class="hljs-keyword">my</span>-genesis.json
enable-stale-production = <span class="hljs-constant">true</span>

<span class="hljs-comment"># ID of witness controlled by this node (e.g. "1.6.5", quotes are required, may specify multiple times)</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.1"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.2"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.3"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.4"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.5"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.6"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.7"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.8"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.9"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.10"</span>
witness-<span class="hljs-property">id</span> = <span class="hljs-string">"1.6.11"</span></code></pre> 
  <p>解释一下上面的设置：</p> 
  <ul> 
   <li><code>p2p-endpoint</code>，指定开启的p2p监听端口，以方便其他节点连接，可以作为其他节点的<code>seed-node</code>。</li> 
   <li><code>rpc-endpoint</code>，指定开启的rpc监听端口，以方便<code>cli-wallet</code>和<code>web</code>钱包与证人节点连接。</li> 
   <li><code>genesis-json</code>，设置<code>genesis.json</code>的路径，通常只在创建新链生产创世区块时设置。</li> 
   <li><code>enable-stale-production</code>，让本节点无视区块链数据的时间，无论如何都生成区块数据。该字段通常只在创建新链生产创世区块时设为true。当已存在区块链时，一定要将本参数设为false或者不管，否则会因数据不完整导致分叉。</li> 
   <li><code>seed-nodes</code>，设置种子节点集合，以方便快速连接到区块链网络和同步区块链数据。在创建新链生产创世区块时设为空，以防止连接到正式网络（代码）中的默认种子节点。当连接已有区块链网络时，尽可能多的设置种子节点以加快同步速度。</li> 
   <li><code>witness-id</code>，用于授权本证人节点所代表的证人id产生区块，可指定多个。一般来说一个证人节点授权一个证人id，私链第一个节点指定了11个。</li> 
  </ul> 
  <h2 id="45-开始区块生产">4.5 开始区块生产</h2> 
  <p>关键时刻到来了，生产私有测试链的第一个区块。 运行如下命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">witness_node <span class="hljs-subst">--</span><span class="hljs-built_in">data</span><span class="hljs-attribute">-dir</span><span class="hljs-subst">=</span><span class="hljs-built_in">data</span></code></pre> 
  <p>将看到如下重要信息：</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>**
<span class="hljs-bullet">* </span>*
<span class="hljs-bullet">* </span>------- NEW CHAIN ------   *
<span class="hljs-bullet">* </span>- Welcome to Graphene! -   *
<span class="hljs-bullet">* </span>------------------------   *
<span class="hljs-bullet">* </span>*
<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>**</code></pre> 
  <p>接着连续将看到类以下消息，表明成功开始生产区块：</p> 
  <pre class="prettyprint"><code class=" hljs css">453735<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span> <span class="hljs-tag">main</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:266</span> <span class="hljs-tag">main</span>] <span class="hljs-tag">Started</span> <span class="hljs-tag">BitShares</span> <span class="hljs-tag">node</span> <span class="hljs-tag">on</span> <span class="hljs-tag">a</span> <span class="hljs-tag">chain</span> <span class="hljs-tag">with</span> 0 <span class="hljs-tag">blocks</span>.
453735<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span> <span class="hljs-tag">main</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:267</span> <span class="hljs-tag">main</span>] <span class="hljs-tag">Chain</span> <span class="hljs-tag">ID</span> <span class="hljs-tag">is</span> 20<span class="hljs-tag">e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4</span>
455003<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span> <span class="hljs-tag">witness</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:181</span> <span class="hljs-tag">block_production_loo</span>] <span class="hljs-tag">Generated</span> <span class="hljs-tag">block</span> <span class="hljs-id">#1</span> <span class="hljs-tag">with</span> <span class="hljs-tag">timestamp</span> 2018<span class="hljs-tag">-05-11T15</span><span class="hljs-pseudo">:07</span><span class="hljs-pseudo">:35</span> <span class="hljs-tag">at</span> <span class="hljs-tag">time</span> 2018<span class="hljs-tag">-05-11T15</span><span class="hljs-pseudo">:07</span><span class="hljs-pseudo">:35</span>
460000<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span> <span class="hljs-tag">witness</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:181</span> <span class="hljs-tag">block_production_loo</span>] <span class="hljs-tag">Generated</span> <span class="hljs-tag">block</span> <span class="hljs-id">#2</span> <span class="hljs-tag">with</span> <span class="hljs-tag">timestamp</span> 2018<span class="hljs-tag">-05-11T15</span><span class="hljs-pseudo">:07</span><span class="hljs-pseudo">:40</span> <span class="hljs-tag">at</span> <span class="hljs-tag">time</span> 2018<span class="hljs-tag">-05-11T15</span><span class="hljs-pseudo">:07</span><span class="hljs-pseudo">:40</span>
462000<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span> <span class="hljs-tag">witness</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:181</span> <span class="hljs-tag">block_production_loo</span>] <span class="hljs-tag">Generated</span> <span class="hljs-tag">block</span> <span class="hljs-id">#3</span> <span class="hljs-tag">with</span> <span class="hljs-tag">timestamp</span> 2018<span class="hljs-tag">-05-11T15</span><span class="hljs-pseudo">:07</span><span class="hljs-pseudo">:42</span> <span class="hljs-tag">at</span> <span class="hljs-tag">time</span> 2018<span class="hljs-tag">-05-11T15</span><span class="hljs-pseudo">:07</span><span class="hljs-pseudo">:42</span></code></pre> 
  <h1 id="5-命令行钱包的使用">5. 命令行钱包的使用</h1> 
  <p>本节主要讲解如何使用命令行钱包导入账户、创建一个新账户，并转账，查看属性等等。</p> 
  <h2 id="51-创建钱包">5.1 创建钱包</h2> 
  <p>现在使用命令行钱包（<code>cli_wallet</code>）连接到上一节创建的证人节点（<code>witness_node</code>）。 保持证人节点处于运行状态，打开另一个命令提示符窗口，运行如下命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">mkdir <span class="hljs-attribute">-p</span> wallet <span class="hljs-subst">&amp;&amp;</span> cd wallet
cli_wallet <span class="hljs-subst">--</span>wallet<span class="hljs-attribute">-file</span> my<span class="hljs-attribute">-wallet</span><span class="hljs-built_in">.</span>json <span class="hljs-subst">--</span>server<span class="hljs-attribute">-rpc</span><span class="hljs-attribute">-endpoint</span> ws:<span class="hljs-comment">//127.0.0.1:38090 --rpc-endpoint 0.0.0.0:38099 --rpc-http-endpoint 0.0.0.0:38092 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4</span></code></pre> 
  <p>下面对指令参数进行解释： <br> <code>--wallet-file</code>：指定钱包json文件，该文件用于保存本钱包中所有加密后的私钥； <br> <code>--server-rpc-endpoint</code>：rpc服务器终端地址，指定钱包要连接的区块链全节点所需要的协议、地址和端口； <br> <code>--rpc-endpoint</code>：指定命令行钱包要监听的websocket RPC的ip地址和端口号； <br> <code>--rpc-http-endpoint</code>：指定命令行钱包要监听的HTTP RPC的ip地址和端口号； <br> <code>--chain-id</code>：指定要连接的区块链ID。不指定的话，钱包连接到bitshares的正式链上。</p> 
  <p>收到set_password提示，表示<code>cli_wallet</code>钱包已成功连接到<code>witness_node</code>节点。为钱包设置一个密码。 该密码用于加密钱包中所有的私钥。 在本例中，我使用<code>supersecret</code>作为密码。</p> 
  <p>使用如下命令给钱包创建密码并解锁新创建的钱包：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-keyword">set</span>_password supersecret
unlock supersecret</code></pre> 
  <h2 id="52-导入账号和资金">5.2 导入账号和资金</h2> 
  <p>要将帐户导入钱包，必须知道账户名称和私钥才行。使用<code>import_key</code>命令将代码中默认的账户<code>nathan</code>导入钱包（其私钥为<code>5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3</code>）： </p> 
  <pre class="prettyprint"><code class=" hljs ">import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3</code></pre> 
  <p>注意：帐户名称是前面在<code>genesies.json</code>文件中设置的， 私钥也是前面在<code>config.ini</code>文件中设置的。 </p> 
  <p>现在已经将私钥导入到钱包中，但初始账户仍然没有资金（后面升级账户需要资金）。 资金在<code>genesies.json</code>文件中的<code>initial_balances</code>字段已经设置好了。 使用<code>import_balance</code>命令可以将这些资金免费（相对于转账需要付手续费来说的）导入钱包： </p> 
  <pre class="prettyprint"><code class=" hljs bash">import_balance nathan [<span class="hljs-string">"5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3"</span>] <span class="hljs-literal">true</span></code></pre> 
  <h2 id="53-创建新帐户">5.3 创建新帐户</h2> 
  <p>现在来创建另一个帐户（名为alpha ），以便在nathan和alpha之间来回转移资金，产生交易。 </p> 
  <p>只能使用现有的账户去创建新账户，且该账户（称为注册商: <code>registrar</code>）必须支付注册费用。 此外，要求注册商账户必须是终身会员（<code>LTM: lifetime member</code>）。使用<code>upgrade_account</code>命令将<code>nathan</code>升级到LTM：</p> 
  <pre class="prettyprint"><code class=" hljs bash">upgrade_account nathan <span class="hljs-literal">true</span></code></pre> 
  <p>注意：由于缓存问题 ，需要重启<code>cli_wallet</code>钱包，否则升级<code>nathan</code>没有更新。 按下<code>ctrl+c</code>停止CLI钱包，运行与以下命令重新钱包并解锁：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">cli_wallet <span class="hljs-subst">--</span>wallet<span class="hljs-attribute">-file</span> my<span class="hljs-attribute">-wallet</span><span class="hljs-built_in">.</span>json <span class="hljs-subst">--</span>server<span class="hljs-attribute">-rpc</span><span class="hljs-attribute">-endpoint</span> ws:<span class="hljs-comment">//127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4</span>
unlock supersecret</code></pre> 
  <p>确认nathan现在处于<code>LTM</code>状态：</p> 
  <pre class="prettyprint"><code class=" hljs ">get_account nathan</code></pre> 
  <p>在打印的账户属性中，<code>membership_expiration_date</code>的属性值应该是<code>1969-12-31T23:59:59</code> 。 如果仍然是<code>1970-01-01T00:00:00</code>，那么账户就没有成功升级。</p> 
  <p>现在用原账户作为注册商注册一个新帐户了。 首先需要新帐户的公钥。可以通过<code>suggest_brain_key</code>命令来获得： </p> 
  <pre class="prettyprint"><code class=" hljs ">suggest_brain_key</code></pre> 
  <p>显示的信息大致如下：</p> 
  <pre class="prettyprint"><code class=" hljs json">{
  "<span class="hljs-attribute">brain_priv_key</span>": <span class="hljs-value"><span class="hljs-string">"FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND"</span></span>,
  "<span class="hljs-attribute">wif_priv_key</span>": <span class="hljs-value"><span class="hljs-string">"5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp"</span></span>,
  "<span class="hljs-attribute">pub_key</span>": <span class="hljs-value"><span class="hljs-string">"BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF"</span> </span>}</code></pre> 
  <p>其中<code>brain_priv_key</code>是私钥助记符，<code>wif_priv_key</code>是钱包导入格式的私钥，<code>pub_key</code>。一定要记下以上重要的信息找个黑客攻击不到的地方保存起来，非常关键。</p> 
  <p>现在可以注册一个新帐户。可以只使用前面推荐的公钥来注册一个名为<code>alpha</code>的新帐户：</p> 
  <pre class="prettyprint"><code class=" hljs bash">register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan <span class="hljs-number">0</span> <span class="hljs-literal">true</span></code></pre> 
  <h2 id="54-转移资金给新账户">5.4 转移资金给新账户</h2> 
  <p>使用<code>transfer</code>命令从<code>nathan</code>账户里转一些资金<code>alpha</code>给：</p> 
  <pre class="prettyprint"><code class=" hljs bash">transfer nathan alpha <span class="hljs-number">100000</span> BTS <span class="hljs-string">"here is some cash"</span> <span class="hljs-literal">true</span></code></pre> 
  <p>可以验证<code>alpha</code>是否收到了钱，运行一下命令查看账户余额：</p> 
  <pre class="prettyprint"><code class=" hljs ">list_account_balances alpha</code></pre> 
  <h1 id="6-部署其他证人节点生产区块">6. 部署其他证人节点生产区块</h1> 
  <p>前面已经创建一个新的区块链，并已经开启生产区块。本节主要讲解如何在新节点上创建新账户并让新账户成为证人，并投票成活跃证人生产区块。</p> 
  <h2 id="61-新证人节点连接到区块链网">6.1 新证人节点连接到区块链网</h2> 
  <p>在新节点上按同样的方式<a href="https://blog.csdn.net/ggq89/article/details/80234262#t2" rel="nofollow">编译安装BitShares Core 测试版</a>。</p> 
  <p>为了保证新节点连接的是前面创建的私链，必须保证<code>chain id</code>相同，而<code>witness_node</code>无法指定<code>chain id</code>，只能通过<code>genesis.json</code>文件初始化。</p> 
  <p>将原来的<code>genesis.json</code>复制到新节点指定目录中。可用如下指令完成该功能：</p> 
  <pre class="prettyprint"><code class=" hljs ruby">mkdir -p testnet-home &amp;&amp; cd testnet-home/
scp bitshares<span class="hljs-variable">@192</span>.<span class="hljs-number">168.110</span>.<span class="hljs-number">103</span><span class="hljs-symbol">:~/testnet_home/my-genesis</span>.json .</code></pre> 
  <p>然后运行以下指令初始化该证人节点，并按<code>ctrl+c</code>完成：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">witness_node <span class="hljs-subst">--</span><span class="hljs-built_in">data</span><span class="hljs-attribute">-dir</span> <span class="hljs-built_in">data</span><span class="hljs-subst">/</span> <span class="hljs-subst">--</span>genesis<span class="hljs-attribute">-json</span> my<span class="hljs-attribute">-genesis</span><span class="hljs-built_in">.</span>json <span class="hljs-subst">--</span>seed<span class="hljs-attribute">-nodes</span> <span class="hljs-string">"[]"</span></code></pre> 
  <p>然后编辑 data 目录下的<code>config.ini</code>，修改设置如下：</p> 
  <pre class="prettyprint"><code class=" hljs ini"><span class="hljs-setting">seed-nodes = <span class="hljs-value">[<span class="hljs-string">"192.168.110.103:31010"</span>]</span></span>
<span class="hljs-setting">rpc-endpoint = <span class="hljs-value"><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">38090</span></span></span></code></pre> 
  <p>基本和前面的<a href="https://blog.csdn.net/ggq89/article/details/80234262#t7" rel="nofollow">config.ini设置</a>差不多，有两点要注意，<code>seed-nodes</code>种子节点集合一定填写之前启动的全节点（即证人节点）的 <code>ip</code> 和 <code>p2p-endpoint</code> 端口。<code>rpc-endpoint</code>指定开启的rpc监听端口，以方便<code>cli-wallet</code>和<code>web</code>钱包与证人节点连接。</p> 
  <p>使用如下命令重新运行证人节点：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">witness_node <span class="hljs-subst">--</span><span class="hljs-built_in">data</span><span class="hljs-attribute">-dir</span> <span class="hljs-built_in">data</span></code></pre> 
  <p>由于本节点没有证人权限，所以不会生产区块，只会同步区块信息。打印的信息类似如下：</p> 
  <pre class="prettyprint"><code class=" hljs css">2188254<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">main</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:266</span>                  <span class="hljs-tag">main</span>                 ] <span class="hljs-tag">Started</span> <span class="hljs-tag">BitShares</span> <span class="hljs-tag">node</span> <span class="hljs-tag">on</span> <span class="hljs-tag">a</span> <span class="hljs-tag">chain</span> <span class="hljs-tag">with</span> 0 <span class="hljs-tag">blocks</span>.
2188254<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">main</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:267</span>                  <span class="hljs-tag">main</span>                 ] <span class="hljs-tag">Chain</span> <span class="hljs-tag">ID</span> <span class="hljs-tag">is</span> 20<span class="hljs-tag">e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4</span>
2190025<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">application</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:512</span>           <span class="hljs-tag">handle_block</span>         ] <span class="hljs-tag">Got</span> <span class="hljs-tag">block</span>: <span class="hljs-id">#460</span> <span class="hljs-tag">time</span>: 2018<span class="hljs-tag">-05-16T09</span><span class="hljs-pseudo">:36</span><span class="hljs-pseudo">:30</span> <span class="hljs-tag">latency</span>: 25 <span class="hljs-tag">ms</span> <span class="hljs-tag">from</span>: <span class="hljs-tag">init6</span>  <span class="hljs-tag">irreversible</span>: 452 (<span class="hljs-tag">-8</span>)
2195020<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">application</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:512</span>           <span class="hljs-tag">handle_block</span>         ] <span class="hljs-tag">Got</span> <span class="hljs-tag">block</span>: <span class="hljs-id">#461</span> <span class="hljs-tag">time</span>: 2018<span class="hljs-tag">-05-16T09</span><span class="hljs-pseudo">:36</span><span class="hljs-pseudo">:35</span> <span class="hljs-tag">latency</span>: 20 <span class="hljs-tag">ms</span> <span class="hljs-tag">from</span>: <span class="hljs-tag">init1</span>  <span class="hljs-tag">irreversible</span>: 453 (<span class="hljs-tag">-8</span>)
2200021<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">application</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:512</span>           <span class="hljs-tag">handle_block</span>         ] <span class="hljs-tag">Got</span> <span class="hljs-tag">block</span>: <span class="hljs-id">#462</span> <span class="hljs-tag">time</span>: 2018<span class="hljs-tag">-05-16T09</span><span class="hljs-pseudo">:36</span><span class="hljs-pseudo">:40</span> <span class="hljs-tag">latency</span>: 21 <span class="hljs-tag">ms</span> <span class="hljs-tag">from</span>: <span class="hljs-tag">init10</span>  <span class="hljs-tag">irreversible</span>: 454 (<span class="hljs-tag">-8</span>)</code></pre> 
  <p>当该节点和网络中的区块数据同步完成后，并定期从其他节点接收新区块后，才能继续下一步。 </p> 
  <h2 id="62-打开新钱包创建新账户">6.2 打开新钱包创建新账户</h2> 
  <p>基本和前面的操作一样（详细讲解请参考：<a href="https://blog.csdn.net/ggq89/article/details/80234262#t9" rel="nofollow">命令行钱包的使用</a>）。保持证人节点处于运行状态，打开另一个命令提示符窗口：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">mkdir <span class="hljs-attribute">-p</span> wallet <span class="hljs-subst">&amp;&amp;</span> cd wallet
cli_wallet <span class="hljs-subst">--</span>wallet<span class="hljs-attribute">-file</span> my<span class="hljs-attribute">-wallet</span><span class="hljs-built_in">.</span>json <span class="hljs-subst">--</span>server<span class="hljs-attribute">-rpc</span><span class="hljs-attribute">-endpoint</span> ws:<span class="hljs-comment">//127.0.0.1:38090 --chain-id 20e5aa92b1e3b7f971796a3f3fba59ea0a34b1eeb6fb5e585b2e4c9e441015f4</span></code></pre> 
  <p>设置新钱包密码，并解锁：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-keyword">set</span>_password my_password
unlock my_password</code></pre> 
  <p>只能使用现有的账户去创建新账户，因此先导入 <code>nathan</code> 用户：</p> 
  <pre class="prettyprint"><code class=" hljs ">import_key nathan 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3</code></pre> 
  <p>使用指令<code>suggest_brain_key</code>获得新账户信息：</p> 
  <pre class="prettyprint"><code class=" hljs ">suggest_brain_key</code></pre> 
  <p>得到新账户信息如下：</p> 
  <pre class="prettyprint"><code class=" hljs json">{
  "<span class="hljs-attribute">brain_priv_key</span>": <span class="hljs-value"><span class="hljs-string">"FACADAL POOF FOXER MOUSE BANDOG CUBEB BRIERED NE JUTKA QUILLED TORIC GRYLLOS FLEAM LEEWILL PLENIST HUSBAND"</span></span>,
  "<span class="hljs-attribute">wif_priv_key</span>": <span class="hljs-value"><span class="hljs-string">"5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp"</span></span>,
  "<span class="hljs-attribute">pub_key</span>": <span class="hljs-value"><span class="hljs-string">"BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF"</span> </span>}</code></pre> 
  <p>创建新账户<code>alpha</code>：</p> 
  <pre class="prettyprint"><code class=" hljs bash">register_account alpha BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF BTS5s2iBiMeaCt96hoiAhQz94AqiPChTNF2YpYt6zJNNFJonhXPTF nathan nathan <span class="hljs-number">0</span> <span class="hljs-literal">true</span></code></pre> 
  <h2 id="63-升级新账户为终生会员">6.3 升级新账户为终生会员</h2> 
  <p>新账户必须升级为终身会员（<code>LTM</code>: lifetime member）后才能称为证人账户。而新账户升级为<code>LTM</code>需要的资金只能通过其他账户转账。</p> 
  <p>给账户<code>alpha</code>转入一些资金：</p> 
  <pre class="prettyprint"><code class=" hljs bash">transfer nathan alpha <span class="hljs-number">100000</span> BTS <span class="hljs-string">"here is some cash!"</span> <span class="hljs-literal">true</span></code></pre> 
  <p>导入新账户<code>alpha</code>：</p> 
  <pre class="prettyprint"><code class=" hljs ">import_key alpha 5JtnWHxYMUD13sBPNMzprH1Z6r1nH3EWV1WeQXpAbsMLgxVt7tp</code></pre> 
  <p>可以查看当前钱包的账户及其余额：</p> 
  <pre class="prettyprint"><code class=" hljs ">list_my_accounts
list_account_balances alpha</code></pre> 
  <p>现在可以升级为终身会员了：</p> 
  <pre class="prettyprint"><code class=" hljs bash">upgrade_account alpha <span class="hljs-literal">true</span></code></pre> 
  <h2 id="64-注册为证人并投票为活跃证人">6.4 注册为证人并投票为活跃证人</h2> 
  <p>要成为证人，首先需要创建一个可以投票的证人对象。 </p> 
  <pre class="prettyprint"><code class=" hljs bash">create_witness alpha <span class="hljs-string">"http://www.alpha"</span> <span class="hljs-literal">true</span></code></pre> 
  <p>可运行<code>get_witness</code> 来获得新证人的<code>id</code>和<code>signing_key</code>。 </p> 
  <pre class="prettyprint"><code class=" hljs ">get_witness alpha</code></pre> 
  <p>得到结果：</p> 
  <pre class="prettyprint"><code class=" hljs json">{
  "<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-string">"1.6.12"</span></span>,
  "<span class="hljs-attribute">witness_account</span>": <span class="hljs-value"><span class="hljs-string">"1.2.18"</span></span>,
  "<span class="hljs-attribute">last_aslot</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">signing_key</span>": <span class="hljs-value"><span class="hljs-string">"BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT"</span></span>,
  "<span class="hljs-attribute">vote_id</span>": <span class="hljs-value"><span class="hljs-string">"1:22"</span></span>,
  "<span class="hljs-attribute">total_votes</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"http://www.alpha"</span></span>,
  "<span class="hljs-attribute">total_missed</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">last_confirmed_block_num</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>}</code></pre> 
  <p><code>witness_node</code>需要<code>signing_key</code>和对应的私钥，并联合<code>id</code>才能生成区块。通过<code>get_private_key</code>获取该签名密钥的私钥：</p> 
  <pre class="prettyprint"><code class=" hljs bash">get_private_key <span class="hljs-string">"BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT"</span></code></pre> 
  <p>得到私钥如下：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-string">"5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF"</span></code></pre> 
  <p>要想让证人生产区块就必须给新建的证人对象投票让其成为活跃证人：</p> 
  <pre class="prettyprint"><code class=" hljs bash">vote_<span class="hljs-keyword">for</span>_witness alpha alpha <span class="hljs-literal">true</span> <span class="hljs-literal">true</span></code></pre> 
  <p>只有等到下一个维护间隔后，投票才会统计，证人 才有可能成为新的活跃证人。可以使用命令<code>get_dynamic_global_properties</code>查看<code>next_maintenance_time</code>字段的值。在前面我们将维护间隔重新设置为了<code>10</code>分钟。</p> 
  <h2 id="65-让新证人节点生产区块">6.5 让新证人节点生产区块</h2> 
  <p>一旦下一次维护时间间隔过去后，可以使用<code>get_global_properties</code>命令来查看到当前的活动证人列表，根据证人<code>id</code>查看新证人已被投票成为活跃证人。一旦成为活跃证人后， 就可以让新证人节点生产区块。</p> 
  <p>现在需要重新启动证人，关闭钱包（<code>ctrl+d</code>），然后关闭证人节点（<code>ctrl+c</code>）。 用上面获得新证人id及其公私钥对编辑 <code>data</code> 目录下的<code>config.ini</code>，添加设置如下：</p> 
  <pre class="prettyprint"><code class=" hljs java"># ID of witness controlled by <span class="hljs-keyword">this</span> node (e.g. <span class="hljs-string">"1.6.5"</span>, quotes are required, may specify multiple times)
witness-id = <span class="hljs-string">"1.6.12"</span>

# Tuple of [PublicKey, WIF <span class="hljs-keyword">private</span> key] (may specify multiple times)
<span class="hljs-keyword">private</span>-key = [<span class="hljs-string">"BTS6CNPh8b1xkDPxmn9mNt968QGGM8W7vcbfKthXC12p1HdWSKyNT"</span>,<span class="hljs-string">"5KNTT2tYjZ2eDDZUkPjHHnr1PJGCpBaMMWtxt9JD7fXxsTwanuF"</span>]</code></pre> 
  <ul> 
   <li><code>private-key</code>， 指定本证人节点生产和签署区块所需的公私钥对。</li> 
  </ul> 
  <p>重新运行证人节点：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">witness_node <span class="hljs-subst">--</span><span class="hljs-built_in">data</span><span class="hljs-attribute">-dir</span> <span class="hljs-built_in">data</span></code></pre> 
  <p>如果<code>witness_node</code>的输出结果如下，那么就轮到本证人节点生产区块，并成功出块：</p> 
  <pre class="prettyprint"><code class=" hljs css">909991<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">application</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:512</span>           <span class="hljs-tag">handle_block</span>         ] <span class="hljs-tag">Got</span> <span class="hljs-tag">block</span>: <span class="hljs-id">#907</span> <span class="hljs-tag">time</span>: 2018<span class="hljs-tag">-05-16T10</span><span class="hljs-pseudo">:15</span><span class="hljs-pseudo">:10</span> <span class="hljs-tag">latency</span>: <span class="hljs-tag">-8</span> <span class="hljs-tag">ms</span> <span class="hljs-tag">from</span>: <span class="hljs-tag">init9</span>  <span class="hljs-tag">irreversible</span>: 898 (<span class="hljs-tag">-9</span>)
915000<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">witness</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:181</span>               <span class="hljs-tag">block_production_loo</span> ] <span class="hljs-tag">Generated</span> <span class="hljs-tag">block</span> <span class="hljs-id">#908</span> <span class="hljs-tag">with</span> <span class="hljs-tag">timestamp</span> 2018<span class="hljs-tag">-05-16T10</span><span class="hljs-pseudo">:15</span><span class="hljs-pseudo">:15</span> <span class="hljs-tag">at</span> <span class="hljs-tag">time</span> 2018<span class="hljs-tag">-05-16T10</span><span class="hljs-pseudo">:15</span><span class="hljs-pseudo">:15</span>
919991<span class="hljs-tag">ms</span> <span class="hljs-tag">th_a</span>       <span class="hljs-tag">application</span><span class="hljs-class">.cpp</span><span class="hljs-pseudo">:512</span>           <span class="hljs-tag">handle_block</span>         ] <span class="hljs-tag">Got</span> <span class="hljs-tag">block</span>: <span class="hljs-id">#909</span> <span class="hljs-tag">time</span>: 2018<span class="hljs-tag">-05-16T10</span><span class="hljs-pseudo">:15</span><span class="hljs-pseudo">:20</span> <span class="hljs-tag">latency</span>: <span class="hljs-tag">-8</span> <span class="hljs-tag">ms</span> <span class="hljs-tag">from</span>: <span class="hljs-tag">init6</span>  <span class="hljs-tag">irreversible</span>: 901 (<span class="hljs-tag">-8</span>)</code></pre> 
  <p><strong>参考文章：</strong></p> 
  <blockquote> 
   <p>bitshares-core/README.md: <a href="https://github.com/bitshares/bitshares-core/blob/master/README.md" rel="nofollow">https://github.com/bitshares/bitshares-core/blob/master/README.md</a> <br> Private Testnet Howto: <a href="http://docs.bitshares.eu/testnet/private-testnet.html" rel="nofollow">http://docs.bitshares.eu/testnet/private-testnet.html</a> <br> private testnet: <a href="https://github.com/bitshares/bitshares-core/wiki/private-testnet" rel="nofollow">https://github.com/bitshares/bitshares-core/wiki/private-testnet</a> <br> CLI Wallet: <a href="http://docs.bitshares.org/integration/apps/cliwallet.html" rel="nofollow">http://docs.bitshares.org/integration/apps/cliwallet.html</a> <br> Howto Run a Block-producing Witness: <a href="http://docs.bitshares.eu/bitshares/tutorials/witness-howto.html" rel="nofollow">http://docs.bitshares.eu/bitshares/tutorials/witness-howto.html</a> <br> Bitshares 私链部署witness节点: <a href="https://www.jianshu.com/p/2cb1cdb98529" rel="nofollow">https://www.jianshu.com/p/2cb1cdb98529</a></p> 
  </blockquote> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-778f64ae39.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ggq89/article/details/80234262,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ggq89/article/details/80234262,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

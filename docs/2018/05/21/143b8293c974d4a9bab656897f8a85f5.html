<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链背后的信息安全(1)AES加密算法原理及其GO语言实现 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链背后的信息安全(1)AES加密算法原理及其GO语言实现" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="# AES加密算法原理及其GO语言实现 AES是作为DES的替代标准出现的，全称Advanced Encryption Standard，即：高级加密标准。 AES加密算法，经历了公开的选拔，最终2000年，由比利时密码学家Joan Daemen和Vincent Rijmen设计的Rijndael算法被选中，成为了AES标准。 AES明文分组长度为128位，即16个字节，密钥长度可以为16个字节、24个字节、或32个字节，即128位密钥、192位密钥、或256位密钥。 ## 总体结构 和DES相同，AES也由多个轮组成，其中每个轮分为SubBytes、ShiftRows、MixColumns、AddRoundKey 4个步骤，即：字节代替、行移位、列混淆和轮密钥加。 根据密钥长度不同，所需轮数也不同，128位、192位、256位密钥，分别需要10轮、12轮和14轮。 第1轮之前有一次AddRoundKey，即轮密钥加，可以视为第0轮；之后1至N-1轮，执行SubBytes、ShiftRows、MixColumns、AddRoundKey；最后一轮仅包括：SubBytes、MixColumns、AddRoundKey。 用Nr表示轮数，需要Nr+1次轮密钥加，因此需要Nr+1个子密钥。以128位密钥为例，需要11个子密钥，因此需要密钥扩展，密钥扩展方法下文介绍。 AES中没有使用Feistel网络，其结构称为SPN结构。 AES的解密算法，即加密算法的反向操作。 如下为AES总体结构示意图： ## 密钥扩展 Nk表示初始密钥的字数，一个字为4个字节，以16字节初始密钥为例，初始密钥共计4个字。 AES加密过程共计需Nk+7个子密钥，即4(Nk + 7)个字，以16字节初始密钥为例，共计需11个子密钥，44个字。 其中前Nk个字作为种子密钥，由初始密钥填充。以16字节初始密钥为例，前4个字，由初始密钥填充。 之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或。 但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数。 如下为密钥扩展示意图： go标准库AES密钥扩展实现如下： ```go func expandKeyGo(key []byte, enc, dec []uint32) { &nbsp;&nbsp;&nbsp;&nbsp;var i int &nbsp;&nbsp;&nbsp;&nbsp;nk := len(key) / 4 &nbsp;&nbsp;&nbsp;&nbsp;for i = 0; i &lt; nk; i++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//其中前Nk个字作为种子密钥，由初始密钥填充 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//以16字节初始密钥为例，前4个字，由初始密钥填充 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = uint32(key[4*i])&lt;&lt;24 | uint32(key[4*i+1])&lt;&lt;16 | uint32(key[4*i+2])&lt;&lt;8 | uint32(key[4*i+3]) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;for ; i &lt; len(enc); i++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t := enc[i-1] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i%nk == 0 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(rotw(t)) ^ (uint32(powx[i/nk-1]) &lt;&lt; 24) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if nk &gt; 6 &amp;&amp; i%nk == 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(t) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = enc[i-nk] ^ t &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//enc为加密子密钥组 &nbsp;&nbsp;&nbsp;&nbsp;//dec为解密子密钥组，dec为enc逆序 &nbsp;&nbsp;&nbsp;&nbsp;if dec == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;n := len(enc) &nbsp;&nbsp;&nbsp;&nbsp;for i := 0; i &lt; n; i += 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ei := n - i - 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for j := 0; j &lt; 4; j++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x := enc[ei+j] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i &gt; 0 &amp;&amp; i+4 &lt; n { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = td0[sbox0[x&gt;&gt;24]] ^ td1[sbox0[x&gt;&gt;16&amp;0xff]] ^ td2[sbox0[x&gt;&gt;8&amp;0xff]] ^ td3[sbox0[x&amp;0xff]] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec[i+j] = x &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;} } //代码位置src/crypto/aes/block.go ``` 如下将展开介绍每轮中的4个步骤：字节代替、行移位、列混淆和轮密钥加。 ## 字节代替SubBytes AES定义了一个S盒，它由16x16个字节组成的矩阵，包含了8位所能表示的256个数的一个置换表。 AES的分组长度128位，即16字节，每个字节高4位作为行值、低4位作为列值，从S盒中查找指定行、列的值作为输出。 AES输入的16个字节，每个字节按上述方式映射为新的字节，即字节代替。 如下为go标准库中使用的S盒和逆S盒： ```go //S盒 var sbox0 = [256]byte{ &nbsp;&nbsp;&nbsp;&nbsp;0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, &nbsp;&nbsp;&nbsp;&nbsp;0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, &nbsp;&nbsp;&nbsp;&nbsp;0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, &nbsp;&nbsp;&nbsp;&nbsp;0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, &nbsp;&nbsp;&nbsp;&nbsp;0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, &nbsp;&nbsp;&nbsp;&nbsp;0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, &nbsp;&nbsp;&nbsp;&nbsp;0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, &nbsp;&nbsp;&nbsp;&nbsp;0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, &nbsp;&nbsp;&nbsp;&nbsp;0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, &nbsp;&nbsp;&nbsp;&nbsp;0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, &nbsp;&nbsp;&nbsp;&nbsp;0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, &nbsp;&nbsp;&nbsp;&nbsp;0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, &nbsp;&nbsp;&nbsp;&nbsp;0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, &nbsp;&nbsp;&nbsp;&nbsp;0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, &nbsp;&nbsp;&nbsp;&nbsp;0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, &nbsp;&nbsp;&nbsp;&nbsp;0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16, } //逆S盒 var sbox1 = [256]byte{ &nbsp;&nbsp;&nbsp;&nbsp;0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, &nbsp;&nbsp;&nbsp;&nbsp;0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, &nbsp;&nbsp;&nbsp;&nbsp;0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, &nbsp;&nbsp;&nbsp;&nbsp;0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, &nbsp;&nbsp;&nbsp;&nbsp;0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, &nbsp;&nbsp;&nbsp;&nbsp;0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, &nbsp;&nbsp;&nbsp;&nbsp;0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, &nbsp;&nbsp;&nbsp;&nbsp;0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, &nbsp;&nbsp;&nbsp;&nbsp;0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, &nbsp;&nbsp;&nbsp;&nbsp;0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, &nbsp;&nbsp;&nbsp;&nbsp;0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, &nbsp;&nbsp;&nbsp;&nbsp;0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, &nbsp;&nbsp;&nbsp;&nbsp;0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, &nbsp;&nbsp;&nbsp;&nbsp;0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, &nbsp;&nbsp;&nbsp;&nbsp;0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, &nbsp;&nbsp;&nbsp;&nbsp;0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d, } //代码位置src/crypto/aes/const.go ``` ## 行移位ShiftRows AES输入的16个字节组成4x4字节矩阵，行移位即： 第1行保持不变，第2行循环左移1个字节，第3行循环左移2个字节，第4行循环左移3个字节。 逆向行移位为后3行做行移位的反向操作，如第2行循环右移1个字节，其他行类似处理。 附行移位示意图如下： ## 列混淆MixColumns 列混淆和逆向列混淆，实际上是使用乘法矩阵，但是其加法和乘法均为定义在有限域上的加法和乘法。 如下为正向列混淆： 如下为逆向列混淆： ## 轮密钥加AddRoundKey 轮密钥加，即128位输入与128位轮密钥做异或运算。 ## go标准库中AES加密算法实现 go标准库中AES算法加密、解密实现代码如下： ```go func newCipherGeneric(key []byte) (cipher.Block, error) { &nbsp;&nbsp;&nbsp;&nbsp;n := len(key) + 28 &nbsp;&nbsp;&nbsp;&nbsp;c := aesCipher{make([]uint32, n), make([]uint32, n)} &nbsp;&nbsp;&nbsp;&nbsp;//密钥扩展 &nbsp;&nbsp;&nbsp;&nbsp;expandKeyGo(key, c.enc, c.dec) &nbsp;&nbsp;&nbsp;&nbsp;return &amp;c, nil } //加密 //xk即子密钥组 func encryptBlockGo(xk []uint32, dst, src []byte) { &nbsp;&nbsp;&nbsp;&nbsp;var s0, s1, s2, s3, t0, t1, t2, t3 uint32 &nbsp;&nbsp;&nbsp;&nbsp;//按4x4矩阵排列 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[0])&lt;&lt;24 | uint32(src[1])&lt;&lt;16 | uint32(src[2])&lt;&lt;8 | uint32(src[3]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[4])&lt;&lt;24 | uint32(src[5])&lt;&lt;16 | uint32(src[6])&lt;&lt;8 | uint32(src[7]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[8])&lt;&lt;24 | uint32(src[9])&lt;&lt;16 | uint32(src[10])&lt;&lt;8 | uint32(src[11]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[12])&lt;&lt;24 | uint32(src[13])&lt;&lt;16 | uint32(src[14])&lt;&lt;8 | uint32(src[15]) &nbsp;&nbsp;&nbsp;&nbsp;//第1次轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[3] &nbsp;&nbsp;&nbsp;&nbsp;//nr为中间重复轮数 &nbsp;&nbsp;&nbsp;&nbsp;//例如128位密钥，44字子密钥，此处为9轮 &nbsp;&nbsp;&nbsp;&nbsp;//-2位去除开头和结尾轮 &nbsp;&nbsp;&nbsp;&nbsp;nr := len(xk)/4 - 2 &nbsp;&nbsp;&nbsp;&nbsp;//4表示已使用了4个字子密钥 &nbsp;&nbsp;&nbsp;&nbsp;k := 4 &nbsp;&nbsp;&nbsp;&nbsp;for r := 0; r &lt; nr; r++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//此处代码包括字节代替、行移位、列混淆、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+0] ^ te0[uint8(s0&gt;&gt;24)] ^ te1[uint8(s1&gt;&gt;16)] ^ te2[uint8(s2&gt;&gt;8)] ^ te3[uint8(s3)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+1] ^ te0[uint8(s1&gt;&gt;24)] ^ te1[uint8(s2&gt;&gt;16)] ^ te2[uint8(s3&gt;&gt;8)] ^ te3[uint8(s0)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+2] ^ te0[uint8(s2&gt;&gt;24)] ^ te1[uint8(s3&gt;&gt;16)] ^ te2[uint8(s0&gt;&gt;8)] ^ te3[uint8(s1)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+3] ^ te0[uint8(s3&gt;&gt;24)] ^ te1[uint8(s0&gt;&gt;16)] ^ te2[uint8(s1&gt;&gt;8)] ^ te3[uint8(s2)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//最后一轮仅包括字节代替、行移位、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;//此处为字节代替和行移位 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox0[t0&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t1&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t2&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t3&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox0[t1&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t2&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t3&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t0&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox0[t2&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t3&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t0&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t1&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox0[t3&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t0&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t1&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t2&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;//轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+3] &nbsp;&nbsp;&nbsp;&nbsp;//输出 &nbsp;&nbsp;&nbsp;&nbsp;dst[0], dst[1], dst[2], dst[3] = byte(s0&gt;&gt;24), byte(s0&gt;&gt;16), byte(s0&gt;&gt;8), byte(s0) &nbsp;&nbsp;&nbsp;&nbsp;dst[4], dst[5], dst[6], dst[7] = byte(s1&gt;&gt;24), byte(s1&gt;&gt;16), byte(s1&gt;&gt;8), byte(s1) &nbsp;&nbsp;&nbsp;&nbsp;dst[8], dst[9], dst[10], dst[11] = byte(s2&gt;&gt;24), byte(s2&gt;&gt;16), byte(s2&gt;&gt;8), byte(s2) &nbsp;&nbsp;&nbsp;&nbsp;dst[12], dst[13], dst[14], dst[15] = byte(s3&gt;&gt;24), byte(s3&gt;&gt;16), byte(s3&gt;&gt;8), byte(s3) } //解密 //xk即子密钥组 func decryptBlockGo(xk []uint32, dst, src []byte) { &nbsp;&nbsp;&nbsp;&nbsp;var s0, s1, s2, s3, t0, t1, t2, t3 uint32 &nbsp;&nbsp;&nbsp;&nbsp;//按4x4矩阵排列 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[0])&lt;&lt;24 | uint32(src[1])&lt;&lt;16 | uint32(src[2])&lt;&lt;8 | uint32(src[3]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[4])&lt;&lt;24 | uint32(src[5])&lt;&lt;16 | uint32(src[6])&lt;&lt;8 | uint32(src[7]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[8])&lt;&lt;24 | uint32(src[9])&lt;&lt;16 | uint32(src[10])&lt;&lt;8 | uint32(src[11]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[12])&lt;&lt;24 | uint32(src[13])&lt;&lt;16 | uint32(src[14])&lt;&lt;8 | uint32(src[15]) &nbsp;&nbsp;&nbsp;&nbsp;//第1次轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[3] &nbsp;&nbsp;&nbsp;&nbsp;//nr为中间重复轮数 &nbsp;&nbsp;&nbsp;&nbsp;//例如128位密钥，44字子密钥，此处为9轮 &nbsp;&nbsp;&nbsp;&nbsp;//-2位去除开头和结尾轮 &nbsp;&nbsp;&nbsp;&nbsp;nr := len(xk)/4 - 2 &nbsp;&nbsp;&nbsp;&nbsp;//4表示已使用了4个字子密钥 &nbsp;&nbsp;&nbsp;&nbsp;k := 4 &nbsp;&nbsp;&nbsp;&nbsp;for r := 0; r &lt; nr; r++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//此处代码包括逆向字节代替、逆向行移位、逆向列混淆、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+0] ^ td0[uint8(s0&gt;&gt;24)] ^ td1[uint8(s3&gt;&gt;16)] ^ td2[uint8(s2&gt;&gt;8)] ^ td3[uint8(s1)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+1] ^ td0[uint8(s1&gt;&gt;24)] ^ td1[uint8(s0&gt;&gt;16)] ^ td2[uint8(s3&gt;&gt;8)] ^ td3[uint8(s2)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+2] ^ td0[uint8(s2&gt;&gt;24)] ^ td1[uint8(s1&gt;&gt;16)] ^ td2[uint8(s0&gt;&gt;8)] ^ td3[uint8(s3)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+3] ^ td0[uint8(s3&gt;&gt;24)] ^ td1[uint8(s2&gt;&gt;16)] ^ td2[uint8(s1&gt;&gt;8)] ^ td3[uint8(s0)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//最后一轮仅包括逆向字节代替、逆向行移位、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;//此处为逆向字节代替和逆向行移位 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox1[t0&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t3&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t2&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t1&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox1[t1&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t0&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t3&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t2&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox1[t2&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t1&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t0&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t3&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox1[t3&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t2&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t1&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t0&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;//轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+3] &nbsp;&nbsp;&nbsp;&nbsp;//输出 &nbsp;&nbsp;&nbsp;&nbsp;dst[0], dst[1], dst[2], dst[3] = byte(s0&gt;&gt;24), byte(s0&gt;&gt;16), byte(s0&gt;&gt;8), byte(s0) &nbsp;&nbsp;&nbsp;&nbsp;dst[4], dst[5], dst[6], dst[7] = byte(s1&gt;&gt;24), byte(s1&gt;&gt;16), byte(s1&gt;&gt;8), byte(s1) &nbsp;&nbsp;&nbsp;&nbsp;dst[8], dst[9], dst[10], dst[11] = byte(s2&gt;&gt;24), byte(s2&gt;&gt;16), byte(s2&gt;&gt;8), byte(s2) &nbsp;&nbsp;&nbsp;&nbsp;dst[12], dst[13], dst[14], dst[15] = byte(s3&gt;&gt;24), byte(s3&gt;&gt;16), byte(s3&gt;&gt;8), byte(s3) } //代码位置src/crypto/aes/block.go ``` 网址：http://www.qukuailianxueyuan.io/ 欲领取造币技术与全套虚拟机资料 区块链技术交流QQ群：756146052&nbsp;&nbsp;备注：CSDN 尹成学院微信：备注：CSDN 阅读更多" />
<meta property="og:description" content="# AES加密算法原理及其GO语言实现 AES是作为DES的替代标准出现的，全称Advanced Encryption Standard，即：高级加密标准。 AES加密算法，经历了公开的选拔，最终2000年，由比利时密码学家Joan Daemen和Vincent Rijmen设计的Rijndael算法被选中，成为了AES标准。 AES明文分组长度为128位，即16个字节，密钥长度可以为16个字节、24个字节、或32个字节，即128位密钥、192位密钥、或256位密钥。 ## 总体结构 和DES相同，AES也由多个轮组成，其中每个轮分为SubBytes、ShiftRows、MixColumns、AddRoundKey 4个步骤，即：字节代替、行移位、列混淆和轮密钥加。 根据密钥长度不同，所需轮数也不同，128位、192位、256位密钥，分别需要10轮、12轮和14轮。 第1轮之前有一次AddRoundKey，即轮密钥加，可以视为第0轮；之后1至N-1轮，执行SubBytes、ShiftRows、MixColumns、AddRoundKey；最后一轮仅包括：SubBytes、MixColumns、AddRoundKey。 用Nr表示轮数，需要Nr+1次轮密钥加，因此需要Nr+1个子密钥。以128位密钥为例，需要11个子密钥，因此需要密钥扩展，密钥扩展方法下文介绍。 AES中没有使用Feistel网络，其结构称为SPN结构。 AES的解密算法，即加密算法的反向操作。 如下为AES总体结构示意图： ## 密钥扩展 Nk表示初始密钥的字数，一个字为4个字节，以16字节初始密钥为例，初始密钥共计4个字。 AES加密过程共计需Nk+7个子密钥，即4(Nk + 7)个字，以16字节初始密钥为例，共计需11个子密钥，44个字。 其中前Nk个字作为种子密钥，由初始密钥填充。以16字节初始密钥为例，前4个字，由初始密钥填充。 之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或。 但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数。 如下为密钥扩展示意图： go标准库AES密钥扩展实现如下： ```go func expandKeyGo(key []byte, enc, dec []uint32) { &nbsp;&nbsp;&nbsp;&nbsp;var i int &nbsp;&nbsp;&nbsp;&nbsp;nk := len(key) / 4 &nbsp;&nbsp;&nbsp;&nbsp;for i = 0; i &lt; nk; i++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//其中前Nk个字作为种子密钥，由初始密钥填充 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//以16字节初始密钥为例，前4个字，由初始密钥填充 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = uint32(key[4*i])&lt;&lt;24 | uint32(key[4*i+1])&lt;&lt;16 | uint32(key[4*i+2])&lt;&lt;8 | uint32(key[4*i+3]) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;for ; i &lt; len(enc); i++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t := enc[i-1] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i%nk == 0 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(rotw(t)) ^ (uint32(powx[i/nk-1]) &lt;&lt; 24) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if nk &gt; 6 &amp;&amp; i%nk == 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(t) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = enc[i-nk] ^ t &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//enc为加密子密钥组 &nbsp;&nbsp;&nbsp;&nbsp;//dec为解密子密钥组，dec为enc逆序 &nbsp;&nbsp;&nbsp;&nbsp;if dec == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;n := len(enc) &nbsp;&nbsp;&nbsp;&nbsp;for i := 0; i &lt; n; i += 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ei := n - i - 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for j := 0; j &lt; 4; j++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x := enc[ei+j] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i &gt; 0 &amp;&amp; i+4 &lt; n { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = td0[sbox0[x&gt;&gt;24]] ^ td1[sbox0[x&gt;&gt;16&amp;0xff]] ^ td2[sbox0[x&gt;&gt;8&amp;0xff]] ^ td3[sbox0[x&amp;0xff]] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec[i+j] = x &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;} } //代码位置src/crypto/aes/block.go ``` 如下将展开介绍每轮中的4个步骤：字节代替、行移位、列混淆和轮密钥加。 ## 字节代替SubBytes AES定义了一个S盒，它由16x16个字节组成的矩阵，包含了8位所能表示的256个数的一个置换表。 AES的分组长度128位，即16字节，每个字节高4位作为行值、低4位作为列值，从S盒中查找指定行、列的值作为输出。 AES输入的16个字节，每个字节按上述方式映射为新的字节，即字节代替。 如下为go标准库中使用的S盒和逆S盒： ```go //S盒 var sbox0 = [256]byte{ &nbsp;&nbsp;&nbsp;&nbsp;0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, &nbsp;&nbsp;&nbsp;&nbsp;0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, &nbsp;&nbsp;&nbsp;&nbsp;0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, &nbsp;&nbsp;&nbsp;&nbsp;0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, &nbsp;&nbsp;&nbsp;&nbsp;0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, &nbsp;&nbsp;&nbsp;&nbsp;0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, &nbsp;&nbsp;&nbsp;&nbsp;0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, &nbsp;&nbsp;&nbsp;&nbsp;0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, &nbsp;&nbsp;&nbsp;&nbsp;0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, &nbsp;&nbsp;&nbsp;&nbsp;0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, &nbsp;&nbsp;&nbsp;&nbsp;0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, &nbsp;&nbsp;&nbsp;&nbsp;0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, &nbsp;&nbsp;&nbsp;&nbsp;0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, &nbsp;&nbsp;&nbsp;&nbsp;0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, &nbsp;&nbsp;&nbsp;&nbsp;0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, &nbsp;&nbsp;&nbsp;&nbsp;0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16, } //逆S盒 var sbox1 = [256]byte{ &nbsp;&nbsp;&nbsp;&nbsp;0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, &nbsp;&nbsp;&nbsp;&nbsp;0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, &nbsp;&nbsp;&nbsp;&nbsp;0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, &nbsp;&nbsp;&nbsp;&nbsp;0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, &nbsp;&nbsp;&nbsp;&nbsp;0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, &nbsp;&nbsp;&nbsp;&nbsp;0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, &nbsp;&nbsp;&nbsp;&nbsp;0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, &nbsp;&nbsp;&nbsp;&nbsp;0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, &nbsp;&nbsp;&nbsp;&nbsp;0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, &nbsp;&nbsp;&nbsp;&nbsp;0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, &nbsp;&nbsp;&nbsp;&nbsp;0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, &nbsp;&nbsp;&nbsp;&nbsp;0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, &nbsp;&nbsp;&nbsp;&nbsp;0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, &nbsp;&nbsp;&nbsp;&nbsp;0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, &nbsp;&nbsp;&nbsp;&nbsp;0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, &nbsp;&nbsp;&nbsp;&nbsp;0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d, } //代码位置src/crypto/aes/const.go ``` ## 行移位ShiftRows AES输入的16个字节组成4x4字节矩阵，行移位即： 第1行保持不变，第2行循环左移1个字节，第3行循环左移2个字节，第4行循环左移3个字节。 逆向行移位为后3行做行移位的反向操作，如第2行循环右移1个字节，其他行类似处理。 附行移位示意图如下： ## 列混淆MixColumns 列混淆和逆向列混淆，实际上是使用乘法矩阵，但是其加法和乘法均为定义在有限域上的加法和乘法。 如下为正向列混淆： 如下为逆向列混淆： ## 轮密钥加AddRoundKey 轮密钥加，即128位输入与128位轮密钥做异或运算。 ## go标准库中AES加密算法实现 go标准库中AES算法加密、解密实现代码如下： ```go func newCipherGeneric(key []byte) (cipher.Block, error) { &nbsp;&nbsp;&nbsp;&nbsp;n := len(key) + 28 &nbsp;&nbsp;&nbsp;&nbsp;c := aesCipher{make([]uint32, n), make([]uint32, n)} &nbsp;&nbsp;&nbsp;&nbsp;//密钥扩展 &nbsp;&nbsp;&nbsp;&nbsp;expandKeyGo(key, c.enc, c.dec) &nbsp;&nbsp;&nbsp;&nbsp;return &amp;c, nil } //加密 //xk即子密钥组 func encryptBlockGo(xk []uint32, dst, src []byte) { &nbsp;&nbsp;&nbsp;&nbsp;var s0, s1, s2, s3, t0, t1, t2, t3 uint32 &nbsp;&nbsp;&nbsp;&nbsp;//按4x4矩阵排列 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[0])&lt;&lt;24 | uint32(src[1])&lt;&lt;16 | uint32(src[2])&lt;&lt;8 | uint32(src[3]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[4])&lt;&lt;24 | uint32(src[5])&lt;&lt;16 | uint32(src[6])&lt;&lt;8 | uint32(src[7]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[8])&lt;&lt;24 | uint32(src[9])&lt;&lt;16 | uint32(src[10])&lt;&lt;8 | uint32(src[11]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[12])&lt;&lt;24 | uint32(src[13])&lt;&lt;16 | uint32(src[14])&lt;&lt;8 | uint32(src[15]) &nbsp;&nbsp;&nbsp;&nbsp;//第1次轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[3] &nbsp;&nbsp;&nbsp;&nbsp;//nr为中间重复轮数 &nbsp;&nbsp;&nbsp;&nbsp;//例如128位密钥，44字子密钥，此处为9轮 &nbsp;&nbsp;&nbsp;&nbsp;//-2位去除开头和结尾轮 &nbsp;&nbsp;&nbsp;&nbsp;nr := len(xk)/4 - 2 &nbsp;&nbsp;&nbsp;&nbsp;//4表示已使用了4个字子密钥 &nbsp;&nbsp;&nbsp;&nbsp;k := 4 &nbsp;&nbsp;&nbsp;&nbsp;for r := 0; r &lt; nr; r++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//此处代码包括字节代替、行移位、列混淆、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+0] ^ te0[uint8(s0&gt;&gt;24)] ^ te1[uint8(s1&gt;&gt;16)] ^ te2[uint8(s2&gt;&gt;8)] ^ te3[uint8(s3)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+1] ^ te0[uint8(s1&gt;&gt;24)] ^ te1[uint8(s2&gt;&gt;16)] ^ te2[uint8(s3&gt;&gt;8)] ^ te3[uint8(s0)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+2] ^ te0[uint8(s2&gt;&gt;24)] ^ te1[uint8(s3&gt;&gt;16)] ^ te2[uint8(s0&gt;&gt;8)] ^ te3[uint8(s1)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+3] ^ te0[uint8(s3&gt;&gt;24)] ^ te1[uint8(s0&gt;&gt;16)] ^ te2[uint8(s1&gt;&gt;8)] ^ te3[uint8(s2)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//最后一轮仅包括字节代替、行移位、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;//此处为字节代替和行移位 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox0[t0&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t1&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t2&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t3&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox0[t1&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t2&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t3&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t0&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox0[t2&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t3&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t0&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t1&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox0[t3&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t0&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t1&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t2&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;//轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+3] &nbsp;&nbsp;&nbsp;&nbsp;//输出 &nbsp;&nbsp;&nbsp;&nbsp;dst[0], dst[1], dst[2], dst[3] = byte(s0&gt;&gt;24), byte(s0&gt;&gt;16), byte(s0&gt;&gt;8), byte(s0) &nbsp;&nbsp;&nbsp;&nbsp;dst[4], dst[5], dst[6], dst[7] = byte(s1&gt;&gt;24), byte(s1&gt;&gt;16), byte(s1&gt;&gt;8), byte(s1) &nbsp;&nbsp;&nbsp;&nbsp;dst[8], dst[9], dst[10], dst[11] = byte(s2&gt;&gt;24), byte(s2&gt;&gt;16), byte(s2&gt;&gt;8), byte(s2) &nbsp;&nbsp;&nbsp;&nbsp;dst[12], dst[13], dst[14], dst[15] = byte(s3&gt;&gt;24), byte(s3&gt;&gt;16), byte(s3&gt;&gt;8), byte(s3) } //解密 //xk即子密钥组 func decryptBlockGo(xk []uint32, dst, src []byte) { &nbsp;&nbsp;&nbsp;&nbsp;var s0, s1, s2, s3, t0, t1, t2, t3 uint32 &nbsp;&nbsp;&nbsp;&nbsp;//按4x4矩阵排列 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[0])&lt;&lt;24 | uint32(src[1])&lt;&lt;16 | uint32(src[2])&lt;&lt;8 | uint32(src[3]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[4])&lt;&lt;24 | uint32(src[5])&lt;&lt;16 | uint32(src[6])&lt;&lt;8 | uint32(src[7]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[8])&lt;&lt;24 | uint32(src[9])&lt;&lt;16 | uint32(src[10])&lt;&lt;8 | uint32(src[11]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[12])&lt;&lt;24 | uint32(src[13])&lt;&lt;16 | uint32(src[14])&lt;&lt;8 | uint32(src[15]) &nbsp;&nbsp;&nbsp;&nbsp;//第1次轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[3] &nbsp;&nbsp;&nbsp;&nbsp;//nr为中间重复轮数 &nbsp;&nbsp;&nbsp;&nbsp;//例如128位密钥，44字子密钥，此处为9轮 &nbsp;&nbsp;&nbsp;&nbsp;//-2位去除开头和结尾轮 &nbsp;&nbsp;&nbsp;&nbsp;nr := len(xk)/4 - 2 &nbsp;&nbsp;&nbsp;&nbsp;//4表示已使用了4个字子密钥 &nbsp;&nbsp;&nbsp;&nbsp;k := 4 &nbsp;&nbsp;&nbsp;&nbsp;for r := 0; r &lt; nr; r++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//此处代码包括逆向字节代替、逆向行移位、逆向列混淆、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+0] ^ td0[uint8(s0&gt;&gt;24)] ^ td1[uint8(s3&gt;&gt;16)] ^ td2[uint8(s2&gt;&gt;8)] ^ td3[uint8(s1)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+1] ^ td0[uint8(s1&gt;&gt;24)] ^ td1[uint8(s0&gt;&gt;16)] ^ td2[uint8(s3&gt;&gt;8)] ^ td3[uint8(s2)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+2] ^ td0[uint8(s2&gt;&gt;24)] ^ td1[uint8(s1&gt;&gt;16)] ^ td2[uint8(s0&gt;&gt;8)] ^ td3[uint8(s3)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+3] ^ td0[uint8(s3&gt;&gt;24)] ^ td1[uint8(s2&gt;&gt;16)] ^ td2[uint8(s1&gt;&gt;8)] ^ td3[uint8(s0)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//最后一轮仅包括逆向字节代替、逆向行移位、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;//此处为逆向字节代替和逆向行移位 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox1[t0&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t3&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t2&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t1&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox1[t1&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t0&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t3&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t2&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox1[t2&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t1&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t0&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t3&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox1[t3&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t2&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t1&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t0&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;//轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+3] &nbsp;&nbsp;&nbsp;&nbsp;//输出 &nbsp;&nbsp;&nbsp;&nbsp;dst[0], dst[1], dst[2], dst[3] = byte(s0&gt;&gt;24), byte(s0&gt;&gt;16), byte(s0&gt;&gt;8), byte(s0) &nbsp;&nbsp;&nbsp;&nbsp;dst[4], dst[5], dst[6], dst[7] = byte(s1&gt;&gt;24), byte(s1&gt;&gt;16), byte(s1&gt;&gt;8), byte(s1) &nbsp;&nbsp;&nbsp;&nbsp;dst[8], dst[9], dst[10], dst[11] = byte(s2&gt;&gt;24), byte(s2&gt;&gt;16), byte(s2&gt;&gt;8), byte(s2) &nbsp;&nbsp;&nbsp;&nbsp;dst[12], dst[13], dst[14], dst[15] = byte(s3&gt;&gt;24), byte(s3&gt;&gt;16), byte(s3&gt;&gt;8), byte(s3) } //代码位置src/crypto/aes/block.go ``` 网址：http://www.qukuailianxueyuan.io/ 欲领取造币技术与全套虚拟机资料 区块链技术交流QQ群：756146052&nbsp;&nbsp;备注：CSDN 尹成学院微信：备注：CSDN 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/05/21/143b8293c974d4a9bab656897f8a85f5.html" />
<meta property="og:url" content="https://mlh.app/2018/05/21/143b8293c974d4a9bab656897f8a85f5.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-21T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"# AES加密算法原理及其GO语言实现 AES是作为DES的替代标准出现的，全称Advanced Encryption Standard，即：高级加密标准。 AES加密算法，经历了公开的选拔，最终2000年，由比利时密码学家Joan Daemen和Vincent Rijmen设计的Rijndael算法被选中，成为了AES标准。 AES明文分组长度为128位，即16个字节，密钥长度可以为16个字节、24个字节、或32个字节，即128位密钥、192位密钥、或256位密钥。 ## 总体结构 和DES相同，AES也由多个轮组成，其中每个轮分为SubBytes、ShiftRows、MixColumns、AddRoundKey 4个步骤，即：字节代替、行移位、列混淆和轮密钥加。 根据密钥长度不同，所需轮数也不同，128位、192位、256位密钥，分别需要10轮、12轮和14轮。 第1轮之前有一次AddRoundKey，即轮密钥加，可以视为第0轮；之后1至N-1轮，执行SubBytes、ShiftRows、MixColumns、AddRoundKey；最后一轮仅包括：SubBytes、MixColumns、AddRoundKey。 用Nr表示轮数，需要Nr+1次轮密钥加，因此需要Nr+1个子密钥。以128位密钥为例，需要11个子密钥，因此需要密钥扩展，密钥扩展方法下文介绍。 AES中没有使用Feistel网络，其结构称为SPN结构。 AES的解密算法，即加密算法的反向操作。 如下为AES总体结构示意图： ## 密钥扩展 Nk表示初始密钥的字数，一个字为4个字节，以16字节初始密钥为例，初始密钥共计4个字。 AES加密过程共计需Nk+7个子密钥，即4(Nk + 7)个字，以16字节初始密钥为例，共计需11个子密钥，44个字。 其中前Nk个字作为种子密钥，由初始密钥填充。以16字节初始密钥为例，前4个字，由初始密钥填充。 之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或。 但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数。 如下为密钥扩展示意图： go标准库AES密钥扩展实现如下： ```go func expandKeyGo(key []byte, enc, dec []uint32) { &nbsp;&nbsp;&nbsp;&nbsp;var i int &nbsp;&nbsp;&nbsp;&nbsp;nk := len(key) / 4 &nbsp;&nbsp;&nbsp;&nbsp;for i = 0; i &lt; nk; i++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//其中前Nk个字作为种子密钥，由初始密钥填充 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//以16字节初始密钥为例，前4个字，由初始密钥填充 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = uint32(key[4*i])&lt;&lt;24 | uint32(key[4*i+1])&lt;&lt;16 | uint32(key[4*i+2])&lt;&lt;8 | uint32(key[4*i+3]) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;for ; i &lt; len(enc); i++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t := enc[i-1] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i%nk == 0 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(rotw(t)) ^ (uint32(powx[i/nk-1]) &lt;&lt; 24) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if nk &gt; 6 &amp;&amp; i%nk == 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(t) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = enc[i-nk] ^ t &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//enc为加密子密钥组 &nbsp;&nbsp;&nbsp;&nbsp;//dec为解密子密钥组，dec为enc逆序 &nbsp;&nbsp;&nbsp;&nbsp;if dec == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;n := len(enc) &nbsp;&nbsp;&nbsp;&nbsp;for i := 0; i &lt; n; i += 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ei := n - i - 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for j := 0; j &lt; 4; j++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x := enc[ei+j] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i &gt; 0 &amp;&amp; i+4 &lt; n { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = td0[sbox0[x&gt;&gt;24]] ^ td1[sbox0[x&gt;&gt;16&amp;0xff]] ^ td2[sbox0[x&gt;&gt;8&amp;0xff]] ^ td3[sbox0[x&amp;0xff]] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec[i+j] = x &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;} } //代码位置src/crypto/aes/block.go ``` 如下将展开介绍每轮中的4个步骤：字节代替、行移位、列混淆和轮密钥加。 ## 字节代替SubBytes AES定义了一个S盒，它由16x16个字节组成的矩阵，包含了8位所能表示的256个数的一个置换表。 AES的分组长度128位，即16字节，每个字节高4位作为行值、低4位作为列值，从S盒中查找指定行、列的值作为输出。 AES输入的16个字节，每个字节按上述方式映射为新的字节，即字节代替。 如下为go标准库中使用的S盒和逆S盒： ```go //S盒 var sbox0 = [256]byte{ &nbsp;&nbsp;&nbsp;&nbsp;0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, &nbsp;&nbsp;&nbsp;&nbsp;0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, &nbsp;&nbsp;&nbsp;&nbsp;0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, &nbsp;&nbsp;&nbsp;&nbsp;0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, &nbsp;&nbsp;&nbsp;&nbsp;0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, &nbsp;&nbsp;&nbsp;&nbsp;0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, &nbsp;&nbsp;&nbsp;&nbsp;0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, &nbsp;&nbsp;&nbsp;&nbsp;0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, &nbsp;&nbsp;&nbsp;&nbsp;0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, &nbsp;&nbsp;&nbsp;&nbsp;0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, &nbsp;&nbsp;&nbsp;&nbsp;0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, &nbsp;&nbsp;&nbsp;&nbsp;0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, &nbsp;&nbsp;&nbsp;&nbsp;0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, &nbsp;&nbsp;&nbsp;&nbsp;0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, &nbsp;&nbsp;&nbsp;&nbsp;0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, &nbsp;&nbsp;&nbsp;&nbsp;0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16, } //逆S盒 var sbox1 = [256]byte{ &nbsp;&nbsp;&nbsp;&nbsp;0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, &nbsp;&nbsp;&nbsp;&nbsp;0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, &nbsp;&nbsp;&nbsp;&nbsp;0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, &nbsp;&nbsp;&nbsp;&nbsp;0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, &nbsp;&nbsp;&nbsp;&nbsp;0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, &nbsp;&nbsp;&nbsp;&nbsp;0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, &nbsp;&nbsp;&nbsp;&nbsp;0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, &nbsp;&nbsp;&nbsp;&nbsp;0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, &nbsp;&nbsp;&nbsp;&nbsp;0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, &nbsp;&nbsp;&nbsp;&nbsp;0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, &nbsp;&nbsp;&nbsp;&nbsp;0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, &nbsp;&nbsp;&nbsp;&nbsp;0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, &nbsp;&nbsp;&nbsp;&nbsp;0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, &nbsp;&nbsp;&nbsp;&nbsp;0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, &nbsp;&nbsp;&nbsp;&nbsp;0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, &nbsp;&nbsp;&nbsp;&nbsp;0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d, } //代码位置src/crypto/aes/const.go ``` ## 行移位ShiftRows AES输入的16个字节组成4x4字节矩阵，行移位即： 第1行保持不变，第2行循环左移1个字节，第3行循环左移2个字节，第4行循环左移3个字节。 逆向行移位为后3行做行移位的反向操作，如第2行循环右移1个字节，其他行类似处理。 附行移位示意图如下： ## 列混淆MixColumns 列混淆和逆向列混淆，实际上是使用乘法矩阵，但是其加法和乘法均为定义在有限域上的加法和乘法。 如下为正向列混淆： 如下为逆向列混淆： ## 轮密钥加AddRoundKey 轮密钥加，即128位输入与128位轮密钥做异或运算。 ## go标准库中AES加密算法实现 go标准库中AES算法加密、解密实现代码如下： ```go func newCipherGeneric(key []byte) (cipher.Block, error) { &nbsp;&nbsp;&nbsp;&nbsp;n := len(key) + 28 &nbsp;&nbsp;&nbsp;&nbsp;c := aesCipher{make([]uint32, n), make([]uint32, n)} &nbsp;&nbsp;&nbsp;&nbsp;//密钥扩展 &nbsp;&nbsp;&nbsp;&nbsp;expandKeyGo(key, c.enc, c.dec) &nbsp;&nbsp;&nbsp;&nbsp;return &amp;c, nil } //加密 //xk即子密钥组 func encryptBlockGo(xk []uint32, dst, src []byte) { &nbsp;&nbsp;&nbsp;&nbsp;var s0, s1, s2, s3, t0, t1, t2, t3 uint32 &nbsp;&nbsp;&nbsp;&nbsp;//按4x4矩阵排列 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[0])&lt;&lt;24 | uint32(src[1])&lt;&lt;16 | uint32(src[2])&lt;&lt;8 | uint32(src[3]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[4])&lt;&lt;24 | uint32(src[5])&lt;&lt;16 | uint32(src[6])&lt;&lt;8 | uint32(src[7]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[8])&lt;&lt;24 | uint32(src[9])&lt;&lt;16 | uint32(src[10])&lt;&lt;8 | uint32(src[11]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[12])&lt;&lt;24 | uint32(src[13])&lt;&lt;16 | uint32(src[14])&lt;&lt;8 | uint32(src[15]) &nbsp;&nbsp;&nbsp;&nbsp;//第1次轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[3] &nbsp;&nbsp;&nbsp;&nbsp;//nr为中间重复轮数 &nbsp;&nbsp;&nbsp;&nbsp;//例如128位密钥，44字子密钥，此处为9轮 &nbsp;&nbsp;&nbsp;&nbsp;//-2位去除开头和结尾轮 &nbsp;&nbsp;&nbsp;&nbsp;nr := len(xk)/4 - 2 &nbsp;&nbsp;&nbsp;&nbsp;//4表示已使用了4个字子密钥 &nbsp;&nbsp;&nbsp;&nbsp;k := 4 &nbsp;&nbsp;&nbsp;&nbsp;for r := 0; r &lt; nr; r++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//此处代码包括字节代替、行移位、列混淆、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+0] ^ te0[uint8(s0&gt;&gt;24)] ^ te1[uint8(s1&gt;&gt;16)] ^ te2[uint8(s2&gt;&gt;8)] ^ te3[uint8(s3)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+1] ^ te0[uint8(s1&gt;&gt;24)] ^ te1[uint8(s2&gt;&gt;16)] ^ te2[uint8(s3&gt;&gt;8)] ^ te3[uint8(s0)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+2] ^ te0[uint8(s2&gt;&gt;24)] ^ te1[uint8(s3&gt;&gt;16)] ^ te2[uint8(s0&gt;&gt;8)] ^ te3[uint8(s1)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+3] ^ te0[uint8(s3&gt;&gt;24)] ^ te1[uint8(s0&gt;&gt;16)] ^ te2[uint8(s1&gt;&gt;8)] ^ te3[uint8(s2)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//最后一轮仅包括字节代替、行移位、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;//此处为字节代替和行移位 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox0[t0&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t1&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t2&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t3&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox0[t1&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t2&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t3&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t0&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox0[t2&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t3&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t0&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t1&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox0[t3&gt;&gt;24])&lt;&lt;24 | uint32(sbox0[t0&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox0[t1&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox0[t2&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;//轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+3] &nbsp;&nbsp;&nbsp;&nbsp;//输出 &nbsp;&nbsp;&nbsp;&nbsp;dst[0], dst[1], dst[2], dst[3] = byte(s0&gt;&gt;24), byte(s0&gt;&gt;16), byte(s0&gt;&gt;8), byte(s0) &nbsp;&nbsp;&nbsp;&nbsp;dst[4], dst[5], dst[6], dst[7] = byte(s1&gt;&gt;24), byte(s1&gt;&gt;16), byte(s1&gt;&gt;8), byte(s1) &nbsp;&nbsp;&nbsp;&nbsp;dst[8], dst[9], dst[10], dst[11] = byte(s2&gt;&gt;24), byte(s2&gt;&gt;16), byte(s2&gt;&gt;8), byte(s2) &nbsp;&nbsp;&nbsp;&nbsp;dst[12], dst[13], dst[14], dst[15] = byte(s3&gt;&gt;24), byte(s3&gt;&gt;16), byte(s3&gt;&gt;8), byte(s3) } //解密 //xk即子密钥组 func decryptBlockGo(xk []uint32, dst, src []byte) { &nbsp;&nbsp;&nbsp;&nbsp;var s0, s1, s2, s3, t0, t1, t2, t3 uint32 &nbsp;&nbsp;&nbsp;&nbsp;//按4x4矩阵排列 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[0])&lt;&lt;24 | uint32(src[1])&lt;&lt;16 | uint32(src[2])&lt;&lt;8 | uint32(src[3]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[4])&lt;&lt;24 | uint32(src[5])&lt;&lt;16 | uint32(src[6])&lt;&lt;8 | uint32(src[7]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[8])&lt;&lt;24 | uint32(src[9])&lt;&lt;16 | uint32(src[10])&lt;&lt;8 | uint32(src[11]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[12])&lt;&lt;24 | uint32(src[13])&lt;&lt;16 | uint32(src[14])&lt;&lt;8 | uint32(src[15]) &nbsp;&nbsp;&nbsp;&nbsp;//第1次轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[3] &nbsp;&nbsp;&nbsp;&nbsp;//nr为中间重复轮数 &nbsp;&nbsp;&nbsp;&nbsp;//例如128位密钥，44字子密钥，此处为9轮 &nbsp;&nbsp;&nbsp;&nbsp;//-2位去除开头和结尾轮 &nbsp;&nbsp;&nbsp;&nbsp;nr := len(xk)/4 - 2 &nbsp;&nbsp;&nbsp;&nbsp;//4表示已使用了4个字子密钥 &nbsp;&nbsp;&nbsp;&nbsp;k := 4 &nbsp;&nbsp;&nbsp;&nbsp;for r := 0; r &lt; nr; r++ { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//此处代码包括逆向字节代替、逆向行移位、逆向列混淆、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+0] ^ td0[uint8(s0&gt;&gt;24)] ^ td1[uint8(s3&gt;&gt;16)] ^ td2[uint8(s2&gt;&gt;8)] ^ td3[uint8(s1)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+1] ^ td0[uint8(s1&gt;&gt;24)] ^ td1[uint8(s0&gt;&gt;16)] ^ td2[uint8(s3&gt;&gt;8)] ^ td3[uint8(s2)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+2] ^ td0[uint8(s2&gt;&gt;24)] ^ td1[uint8(s1&gt;&gt;16)] ^ td2[uint8(s0&gt;&gt;8)] ^ td3[uint8(s3)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+3] ^ td0[uint8(s3&gt;&gt;24)] ^ td1[uint8(s2&gt;&gt;16)] ^ td2[uint8(s1&gt;&gt;8)] ^ td3[uint8(s0)] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += 4 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3 &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;//最后一轮仅包括逆向字节代替、逆向行移位、轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;//此处为逆向字节代替和逆向行移位 &nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox1[t0&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t3&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t2&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t1&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox1[t1&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t0&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t3&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t2&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox1[t2&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t1&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t0&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t3&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox1[t3&gt;&gt;24])&lt;&lt;24 | uint32(sbox1[t2&gt;&gt;16&amp;0xff])&lt;&lt;16 | uint32(sbox1[t1&gt;&gt;8&amp;0xff])&lt;&lt;8 | uint32(sbox1[t0&amp;0xff]) &nbsp;&nbsp;&nbsp;&nbsp;//轮密钥加 &nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+0] &nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+1] &nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+2] &nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+3] &nbsp;&nbsp;&nbsp;&nbsp;//输出 &nbsp;&nbsp;&nbsp;&nbsp;dst[0], dst[1], dst[2], dst[3] = byte(s0&gt;&gt;24), byte(s0&gt;&gt;16), byte(s0&gt;&gt;8), byte(s0) &nbsp;&nbsp;&nbsp;&nbsp;dst[4], dst[5], dst[6], dst[7] = byte(s1&gt;&gt;24), byte(s1&gt;&gt;16), byte(s1&gt;&gt;8), byte(s1) &nbsp;&nbsp;&nbsp;&nbsp;dst[8], dst[9], dst[10], dst[11] = byte(s2&gt;&gt;24), byte(s2&gt;&gt;16), byte(s2&gt;&gt;8), byte(s2) &nbsp;&nbsp;&nbsp;&nbsp;dst[12], dst[13], dst[14], dst[15] = byte(s3&gt;&gt;24), byte(s3&gt;&gt;16), byte(s3&gt;&gt;8), byte(s3) } //代码位置src/crypto/aes/block.go ``` 网址：http://www.qukuailianxueyuan.io/ 欲领取造币技术与全套虚拟机资料 区块链技术交流QQ群：756146052&nbsp;&nbsp;备注：CSDN 尹成学院微信：备注：CSDN 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/05/21/143b8293c974d4a9bab656897f8a85f5.html","headline":"区块链背后的信息安全(1)AES加密算法原理及其GO语言实现","dateModified":"2018-05-21T00:00:00+08:00","datePublished":"2018-05-21T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/05/21/143b8293c974d4a9bab656897f8a85f5.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链背后的信息安全(1)AES加密算法原理及其GO语言实现</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;"># AES加密算法原理及其GO语言实现</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES是作为DES的替代标准出现的，全称Advanced Encryption Standard，即：高级加密标准。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES加密算法，经历了公开的选拔，最终2000年，由比利时密码学家Joan Daemen和Vincent Rijmen设计的Rijndael算法被选中，成为了AES标准。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES明文分组长度为128位，即16个字节，密钥长度可以为16个字节、24个字节、或32个字节，即128位密钥、192位密钥、或256位密钥。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## 总体结构</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">和DES相同，AES也由多个轮组成，其中每个轮分为SubBytes、ShiftRows、MixColumns、AddRoundKey 4个步骤，即：字节代替、行移位、列混淆和轮密钥加。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">根据密钥长度不同，所需轮数也不同，128位、192位、256位密钥，分别需要10轮、12轮和14轮。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">第1轮之前有一次AddRoundKey，即轮密钥加，可以视为第0轮；之后1至N-1轮，执行SubBytes、ShiftRows、MixColumns、AddRoundKey；最后一轮仅包括：SubBytes、MixColumns、AddRoundKey。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">用Nr表示轮数，需要Nr+1次轮密钥加，因此需要Nr+1个子密钥。以128位密钥为例，需要11个子密钥，因此需要密钥扩展，密钥扩展方法下文介绍。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES中没有使用Feistel网络，其结构称为SPN结构。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES的解密算法，即加密算法的反向操作。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">如下为AES总体结构示意图：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180517120918834" alt=""><br></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## 密钥扩展</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">Nk表示初始密钥的字数，一个字为4个字节，以16字节初始密钥为例，初始密钥共计4个字。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES加密过程共计需Nk+7个子密钥，即4(Nk + 7)个字，以16字节初始密钥为例，共计需11个子密钥，44个字。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">其中前Nk个字作为种子密钥，由初始密钥填充。以16字节初始密钥为例，前4个字，由初始密钥填充。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">如下为密钥扩展示意图：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180517120929754" alt=""><br></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">go标准库AES密钥扩展实现如下：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">```go</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><span>func</span> expandKeyGo(key []<span>byte</span>, enc, dec []<span>uint32</span>) {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>var</span> i int</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;nk := <span>len</span>(key) / <span>4</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>for</span> i = <span>0</span>; i &lt; nk; i++ {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//其中前Nk个字作为种子密钥，由初始密钥填充</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//以16字节初始密钥为例，前4个字，由初始密钥填充</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = uint32(key[<span>4</span>*i])&lt;&lt;<span>24</span> | uint32(key[<span>4</span>*i+<span>1</span>])&lt;&lt;<span>16</span> | uint32(key[<span>4</span>*i+<span>2</span>])&lt;&lt;<span>8</span> | uint32(key[<span>4</span>*i+<span>3</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>for</span> ; i &lt; <span>len</span>(enc); i++ {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t := enc[i-<span>1</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if</span> i%nk == <span>0</span> {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//但是对于Nk整数倍位置的字，在异或之前先对W[i-1]做如下变换：字节循环移位、S盒变换，并异或轮常数</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(rotw(t)) ^ (uint32(powx[i/nk-<span>1</span>]) &lt;&lt; <span>24</span>)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span>else</span> <span>if</span> nk &gt; <span>6</span> &amp;&amp; i%nk == <span>4</span> {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = subw(t)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//之后的每个字，W[i]等于前边一个字W[i-1]与Nk个字之前的字W[i-Nk]异或</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc[i] = enc[i-nk] ^ t</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//enc为加密子密钥组</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//dec为解密子密钥组，dec为enc逆序</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>if</span> dec == <span>nil</span> {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;n := <span>len</span>(enc)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>for</span> i := <span>0</span>; i &lt; n; i += <span>4</span> {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ei := n - i - <span>4</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>for</span> j := <span>0</span>; j &lt; <span>4</span>; j++ {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x := enc[ei+j]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>if</span> i &gt; <span>0</span> &amp;&amp; i+<span>4</span> &lt; n {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = td0[sbox0[x&gt;&gt;<span>24</span>]] ^ td1[sbox0[x&gt;&gt;<span>16</span>&amp;<span>0xff</span>]] ^ td2[sbox0[x&gt;&gt;<span>8</span>&amp;<span>0xff</span>]] ^ td3[sbox0[x&amp;<span>0xff</span>]]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec[i+j] = x</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//代码位置src/crypto/aes/block.go</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">```</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">如下将展开介绍每轮中的4个步骤：字节代替、行移位、列混淆和轮密钥加。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## 字节代替SubBytes</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES定义了一个S盒，它由16x16个字节组成的矩阵，包含了8位所能表示的256个数的一个置换表。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES的分组长度128位，即16字节，每个字节高4位作为行值、低4位作为列值，从S盒中查找指定行、列的值作为输出。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES输入的16个字节，每个字节按上述方式映射为新的字节，即字节代替。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">如下为go标准库中使用的S盒和逆S盒：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">```go</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//S盒</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><span>var</span> sbox0 = [<span>256</span>]<span>byte</span>{</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x63</span>, <span>0x7c</span>, <span>0x77</span>, <span>0x7b</span>, <span>0xf2</span>, <span>0x6b</span>, <span>0x6f</span>, <span>0xc5</span>, <span>0x30</span>, <span>0x01</span>, <span>0x67</span>, <span>0x2b</span>, <span>0xfe</span>, <span>0xd7</span>, <span>0xab</span>, <span>0x76</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xca</span>, <span>0x82</span>, <span>0xc9</span>, <span>0x7d</span>, <span>0xfa</span>, <span>0x59</span>, <span>0x47</span>, <span>0xf0</span>, <span>0xad</span>, <span>0xd4</span>, <span>0xa2</span>, <span>0xaf</span>, <span>0x9c</span>, <span>0xa4</span>, <span>0x72</span>, <span>0xc0</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xb7</span>, <span>0xfd</span>, <span>0x93</span>, <span>0x26</span>, <span>0x36</span>, <span>0x3f</span>, <span>0xf7</span>, <span>0xcc</span>, <span>0x34</span>, <span>0xa5</span>, <span>0xe5</span>, <span>0xf1</span>, <span>0x71</span>, <span>0xd8</span>, <span>0x31</span>, <span>0x15</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x04</span>, <span>0xc7</span>, <span>0x23</span>, <span>0xc3</span>, <span>0x18</span>, <span>0x96</span>, <span>0x05</span>, <span>0x9a</span>, <span>0x07</span>, <span>0x12</span>, <span>0x80</span>, <span>0xe2</span>, <span>0xeb</span>, <span>0x27</span>, <span>0xb2</span>, <span>0x75</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x09</span>, <span>0x83</span>, <span>0x2c</span>, <span>0x1a</span>, <span>0x1b</span>, <span>0x6e</span>, <span>0x5a</span>, <span>0xa0</span>, <span>0x52</span>, <span>0x3b</span>, <span>0xd6</span>, <span>0xb3</span>, <span>0x29</span>, <span>0xe3</span>, <span>0x2f</span>, <span>0x84</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x53</span>, <span>0xd1</span>, <span>0x00</span>, <span>0xed</span>, <span>0x20</span>, <span>0xfc</span>, <span>0xb1</span>, <span>0x5b</span>, <span>0x6a</span>, <span>0xcb</span>, <span>0xbe</span>, <span>0x39</span>, <span>0x4a</span>, <span>0x4c</span>, <span>0x58</span>, <span>0xcf</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xd0</span>, <span>0xef</span>, <span>0xaa</span>, <span>0xfb</span>, <span>0x43</span>, <span>0x4d</span>, <span>0x33</span>, <span>0x85</span>, <span>0x45</span>, <span>0xf9</span>, <span>0x02</span>, <span>0x7f</span>, <span>0x50</span>, <span>0x3c</span>, <span>0x9f</span>, <span>0xa8</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x51</span>, <span>0xa3</span>, <span>0x40</span>, <span>0x8f</span>, <span>0x92</span>, <span>0x9d</span>, <span>0x38</span>, <span>0xf5</span>, <span>0xbc</span>, <span>0xb6</span>, <span>0xda</span>, <span>0x21</span>, <span>0x10</span>, <span>0xff</span>, <span>0xf3</span>, <span>0xd2</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xcd</span>, <span>0x0c</span>, <span>0x13</span>, <span>0xec</span>, <span>0x5f</span>, <span>0x97</span>, <span>0x44</span>, <span>0x17</span>, <span>0xc4</span>, <span>0xa7</span>, <span>0x7e</span>, <span>0x3d</span>, <span>0x64</span>, <span>0x5d</span>, <span>0x19</span>, <span>0x73</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x60</span>, <span>0x81</span>, <span>0x4f</span>, <span>0xdc</span>, <span>0x22</span>, <span>0x2a</span>, <span>0x90</span>, <span>0x88</span>, <span>0x46</span>, <span>0xee</span>, <span>0xb8</span>, <span>0x14</span>, <span>0xde</span>, <span>0x5e</span>, <span>0x0b</span>, <span>0xdb</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xe0</span>, <span>0x32</span>, <span>0x3a</span>, <span>0x0a</span>, <span>0x49</span>, <span>0x06</span>, <span>0x24</span>, <span>0x5c</span>, <span>0xc2</span>, <span>0xd3</span>, <span>0xac</span>, <span>0x62</span>, <span>0x91</span>, <span>0x95</span>, <span>0xe4</span>, <span>0x79</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xe7</span>, <span>0xc8</span>, <span>0x37</span>, <span>0x6d</span>, <span>0x8d</span>, <span>0xd5</span>, <span>0x4e</span>, <span>0xa9</span>, <span>0x6c</span>, <span>0x56</span>, <span>0xf4</span>, <span>0xea</span>, <span>0x65</span>, <span>0x7a</span>, <span>0xae</span>, <span>0x08</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xba</span>, <span>0x78</span>, <span>0x25</span>, <span>0x2e</span>, <span>0x1c</span>, <span>0xa6</span>, <span>0xb4</span>, <span>0xc6</span>, <span>0xe8</span>, <span>0xdd</span>, <span>0x74</span>, <span>0x1f</span>, <span>0x4b</span>, <span>0xbd</span>, <span>0x8b</span>, <span>0x8a</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x70</span>, <span>0x3e</span>, <span>0xb5</span>, <span>0x66</span>, <span>0x48</span>, <span>0x03</span>, <span>0xf6</span>, <span>0x0e</span>, <span>0x61</span>, <span>0x35</span>, <span>0x57</span>, <span>0xb9</span>, <span>0x86</span>, <span>0xc1</span>, <span>0x1d</span>, <span>0x9e</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xe1</span>, <span>0xf8</span>, <span>0x98</span>, <span>0x11</span>, <span>0x69</span>, <span>0xd9</span>, <span>0x8e</span>, <span>0x94</span>, <span>0x9b</span>, <span>0x1e</span>, <span>0x87</span>, <span>0xe9</span>, <span>0xce</span>, <span>0x55</span>, <span>0x28</span>, <span>0xdf</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x8c</span>, <span>0xa1</span>, <span>0x89</span>, <span>0x0d</span>, <span>0xbf</span>, <span>0xe6</span>, <span>0x42</span>, <span>0x68</span>, <span>0x41</span>, <span>0x99</span>, <span>0x2d</span>, <span>0x0f</span>, <span>0xb0</span>, <span>0x54</span>, <span>0xbb</span>, <span>0x16</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">}</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//逆S盒</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><span>var</span> sbox1 = [<span>256</span>]<span>byte</span>{</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x52</span>, <span>0x09</span>, <span>0x6a</span>, <span>0xd5</span>, <span>0x30</span>, <span>0x36</span>, <span>0xa5</span>, <span>0x38</span>, <span>0xbf</span>, <span>0x40</span>, <span>0xa3</span>, <span>0x9e</span>, <span>0x81</span>, <span>0xf3</span>, <span>0xd7</span>, <span>0xfb</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x7c</span>, <span>0xe3</span>, <span>0x39</span>, <span>0x82</span>, <span>0x9b</span>, <span>0x2f</span>, <span>0xff</span>, <span>0x87</span>, <span>0x34</span>, <span>0x8e</span>, <span>0x43</span>, <span>0x44</span>, <span>0xc4</span>, <span>0xde</span>, <span>0xe9</span>, <span>0xcb</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x54</span>, <span>0x7b</span>, <span>0x94</span>, <span>0x32</span>, <span>0xa6</span>, <span>0xc2</span>, <span>0x23</span>, <span>0x3d</span>, <span>0xee</span>, <span>0x4c</span>, <span>0x95</span>, <span>0x0b</span>, <span>0x42</span>, <span>0xfa</span>, <span>0xc3</span>, <span>0x4e</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x08</span>, <span>0x2e</span>, <span>0xa1</span>, <span>0x66</span>, <span>0x28</span>, <span>0xd9</span>, <span>0x24</span>, <span>0xb2</span>, <span>0x76</span>, <span>0x5b</span>, <span>0xa2</span>, <span>0x49</span>, <span>0x6d</span>, <span>0x8b</span>, <span>0xd1</span>, <span>0x25</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x72</span>, <span>0xf8</span>, <span>0xf6</span>, <span>0x64</span>, <span>0x86</span>, <span>0x68</span>, <span>0x98</span>, <span>0x16</span>, <span>0xd4</span>, <span>0xa4</span>, <span>0x5c</span>, <span>0xcc</span>, <span>0x5d</span>, <span>0x65</span>, <span>0xb6</span>, <span>0x92</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x6c</span>, <span>0x70</span>, <span>0x48</span>, <span>0x50</span>, <span>0xfd</span>, <span>0xed</span>, <span>0xb9</span>, <span>0xda</span>, <span>0x5e</span>, <span>0x15</span>, <span>0x46</span>, <span>0x57</span>, <span>0xa7</span>, <span>0x8d</span>, <span>0x9d</span>, <span>0x84</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x90</span>, <span>0xd8</span>, <span>0xab</span>, <span>0x00</span>, <span>0x8c</span>, <span>0xbc</span>, <span>0xd3</span>, <span>0x0a</span>, <span>0xf7</span>, <span>0xe4</span>, <span>0x58</span>, <span>0x05</span>, <span>0xb8</span>, <span>0xb3</span>, <span>0x45</span>, <span>0x06</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xd0</span>, <span>0x2c</span>, <span>0x1e</span>, <span>0x8f</span>, <span>0xca</span>, <span>0x3f</span>, <span>0x0f</span>, <span>0x02</span>, <span>0xc1</span>, <span>0xaf</span>, <span>0xbd</span>, <span>0x03</span>, <span>0x01</span>, <span>0x13</span>, <span>0x8a</span>, <span>0x6b</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x3a</span>, <span>0x91</span>, <span>0x11</span>, <span>0x41</span>, <span>0x4f</span>, <span>0x67</span>, <span>0xdc</span>, <span>0xea</span>, <span>0x97</span>, <span>0xf2</span>, <span>0xcf</span>, <span>0xce</span>, <span>0xf0</span>, <span>0xb4</span>, <span>0xe6</span>, <span>0x73</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x96</span>, <span>0xac</span>, <span>0x74</span>, <span>0x22</span>, <span>0xe7</span>, <span>0xad</span>, <span>0x35</span>, <span>0x85</span>, <span>0xe2</span>, <span>0xf9</span>, <span>0x37</span>, <span>0xe8</span>, <span>0x1c</span>, <span>0x75</span>, <span>0xdf</span>, <span>0x6e</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x47</span>, <span>0xf1</span>, <span>0x1a</span>, <span>0x71</span>, <span>0x1d</span>, <span>0x29</span>, <span>0xc5</span>, <span>0x89</span>, <span>0x6f</span>, <span>0xb7</span>, <span>0x62</span>, <span>0x0e</span>, <span>0xaa</span>, <span>0x18</span>, <span>0xbe</span>, <span>0x1b</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xfc</span>, <span>0x56</span>, <span>0x3e</span>, <span>0x4b</span>, <span>0xc6</span>, <span>0xd2</span>, <span>0x79</span>, <span>0x20</span>, <span>0x9a</span>, <span>0xdb</span>, <span>0xc0</span>, <span>0xfe</span>, <span>0x78</span>, <span>0xcd</span>, <span>0x5a</span>, <span>0xf4</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x1f</span>, <span>0xdd</span>, <span>0xa8</span>, <span>0x33</span>, <span>0x88</span>, <span>0x07</span>, <span>0xc7</span>, <span>0x31</span>, <span>0xb1</span>, <span>0x12</span>, <span>0x10</span>, <span>0x59</span>, <span>0x27</span>, <span>0x80</span>, <span>0xec</span>, <span>0x5f</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x60</span>, <span>0x51</span>, <span>0x7f</span>, <span>0xa9</span>, <span>0x19</span>, <span>0xb5</span>, <span>0x4a</span>, <span>0x0d</span>, <span>0x2d</span>, <span>0xe5</span>, <span>0x7a</span>, <span>0x9f</span>, <span>0x93</span>, <span>0xc9</span>, <span>0x9c</span>, <span>0xef</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0xa0</span>, <span>0xe0</span>, <span>0x3b</span>, <span>0x4d</span>, <span>0xae</span>, <span>0x2a</span>, <span>0xf5</span>, <span>0xb0</span>, <span>0xc8</span>, <span>0xeb</span>, <span>0xbb</span>, <span>0x3c</span>, <span>0x83</span>, <span>0x53</span>, <span>0x99</span>, <span>0x61</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>0x17</span>, <span>0x2b</span>, <span>0x04</span>, <span>0x7e</span>, <span>0xba</span>, <span>0x77</span>, <span>0xd6</span>, <span>0x26</span>, <span>0xe1</span>, <span>0x69</span>, <span>0x14</span>, <span>0x63</span>, <span>0x55</span>, <span>0x21</span>, <span>0x0c</span>, <span>0x7d</span>,</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//代码位置src/crypto/aes/const.go</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">```</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## 行移位ShiftRows</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">AES输入的16个字节组成4x4字节矩阵，行移位即：</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">第1行保持不变，第2行循环左移1个字节，第3行循环左移2个字节，第4行循环左移3个字节。</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">逆向行移位为后3行做行移位的反向操作，如第2行循环右移1个字节，其他行类似处理。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">附行移位示意图如下：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180517120945949" alt=""><br></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## 列混淆MixColumns</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">列混淆和逆向列混淆，实际上是使用乘法矩阵，但是其加法和乘法均为定义在有限域上的加法和乘法。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">如下为正向列混淆：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180517120955465" alt=""><br></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">如下为逆向列混淆：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180517121003152" alt=""><br></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## 轮密钥加AddRoundKey</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">轮密钥加，即128位输入与128位轮密钥做异或运算。</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="font-weight:700;"><span style="color:#000000;">## go标准库中AES加密算法实现</span></span></span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">go标准库中AES算法加密、解密实现代码如下：</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">```go</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><span>func</span> newCipherGeneric(key []<span>byte</span>) (cipher.Block, <span>error</span>) {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;n := <span>len</span>(key) + <span>28</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;c := aesCipher{<span>make</span>([]<span>uint32</span>, n), <span>make</span>([]<span>uint32</span>, n)}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//密钥扩展</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;expandKeyGo(key, c.enc, c.dec)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>return</span> &amp;c, <span>nil</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">}</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//加密</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//xk即子密钥组</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><span>func</span> encryptBlockGo(xk []<span>uint32</span>, dst, src []<span>byte</span>) {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>var</span> s0, s1, s2, s3, t0, t1, t2, t3 uint32</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//按4x4矩阵排列</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[<span>0</span>])&lt;&lt;<span>24</span> | uint32(src[<span>1</span>])&lt;&lt;<span>16</span> | uint32(src[<span>2</span>])&lt;&lt;<span>8</span> | uint32(src[<span>3</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[<span>4</span>])&lt;&lt;<span>24</span> | uint32(src[<span>5</span>])&lt;&lt;<span>16</span> | uint32(src[<span>6</span>])&lt;&lt;<span>8</span> | uint32(src[<span>7</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[<span>8</span>])&lt;&lt;<span>24</span> | uint32(src[<span>9</span>])&lt;&lt;<span>16</span> | uint32(src[<span>10</span>])&lt;&lt;<span>8</span> | uint32(src[<span>11</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[<span>12</span>])&lt;&lt;<span>24</span> | uint32(src[<span>13</span>])&lt;&lt;<span>16</span> | uint32(src[<span>14</span>])&lt;&lt;<span>8</span> | uint32(src[<span>15</span>])</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//第1次轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[<span>0</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[<span>1</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[<span>2</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[<span>3</span>]</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//nr为中间重复轮数</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//例如128位密钥，44字子密钥，此处为9轮</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//-2位去除开头和结尾轮</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;nr := <span>len</span>(xk)/<span>4</span> - <span>2</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//4表示已使用了4个字子密钥</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;k := <span>4</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>for</span> r := <span>0</span>; r &lt; nr; r++ {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//此处代码包括字节代替、行移位、列混淆、轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+<span>0</span>] ^ te0[uint8(s0&gt;&gt;<span>24</span>)] ^ te1[uint8(s1&gt;&gt;<span>16</span>)] ^ te2[uint8(s2&gt;&gt;<span>8</span>)] ^ te3[uint8(s3)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+<span>1</span>] ^ te0[uint8(s1&gt;&gt;<span>24</span>)] ^ te1[uint8(s2&gt;&gt;<span>16</span>)] ^ te2[uint8(s3&gt;&gt;<span>8</span>)] ^ te3[uint8(s0)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+<span>2</span>] ^ te0[uint8(s2&gt;&gt;<span>24</span>)] ^ te1[uint8(s3&gt;&gt;<span>16</span>)] ^ te2[uint8(s0&gt;&gt;<span>8</span>)] ^ te3[uint8(s1)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+<span>3</span>] ^ te0[uint8(s3&gt;&gt;<span>24</span>)] ^ te1[uint8(s0&gt;&gt;<span>16</span>)] ^ te2[uint8(s1&gt;&gt;<span>8</span>)] ^ te3[uint8(s2)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += <span>4</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//最后一轮仅包括字节代替、行移位、轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//此处为字节代替和行移位</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox0[t0&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox0[t1&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox0[t2&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox0[t3&amp;<span>0xff</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox0[t1&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox0[t2&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox0[t3&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox0[t0&amp;<span>0xff</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox0[t2&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox0[t3&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox0[t0&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox0[t1&amp;<span>0xff</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox0[t3&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox0[t0&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox0[t1&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox0[t2&amp;<span>0xff</span>])</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+<span>0</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+<span>1</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+<span>2</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+<span>3</span>]</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//输出</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>0</span>], dst[<span>1</span>], dst[<span>2</span>], dst[<span>3</span>] = byte(s0&gt;&gt;<span>24</span>), byte(s0&gt;&gt;<span>16</span>), byte(s0&gt;&gt;<span>8</span>), byte(s0)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>4</span>], dst[<span>5</span>], dst[<span>6</span>], dst[<span>7</span>] = byte(s1&gt;&gt;<span>24</span>), byte(s1&gt;&gt;<span>16</span>), byte(s1&gt;&gt;<span>8</span>), byte(s1)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>8</span>], dst[<span>9</span>], dst[<span>10</span>], dst[<span>11</span>] = byte(s2&gt;&gt;<span>24</span>), byte(s2&gt;&gt;<span>16</span>), byte(s2&gt;&gt;<span>8</span>), byte(s2)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>12</span>], dst[<span>13</span>], dst[<span>14</span>], dst[<span>15</span>] = byte(s3&gt;&gt;<span>24</span>), byte(s3&gt;&gt;<span>16</span>), byte(s3&gt;&gt;<span>8</span>), byte(s3)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">}</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//解密</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//xk即子密钥组</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;"><span>func</span> decryptBlockGo(xk []<span>uint32</span>, dst, src []<span>byte</span>) {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>var</span> s0, s1, s2, s3, t0, t1, t2, t3 uint32</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//按4x4矩阵排列</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(src[<span>0</span>])&lt;&lt;<span>24</span> | uint32(src[<span>1</span>])&lt;&lt;<span>16</span> | uint32(src[<span>2</span>])&lt;&lt;<span>8</span> | uint32(src[<span>3</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(src[<span>4</span>])&lt;&lt;<span>24</span> | uint32(src[<span>5</span>])&lt;&lt;<span>16</span> | uint32(src[<span>6</span>])&lt;&lt;<span>8</span> | uint32(src[<span>7</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(src[<span>8</span>])&lt;&lt;<span>24</span> | uint32(src[<span>9</span>])&lt;&lt;<span>16</span> | uint32(src[<span>10</span>])&lt;&lt;<span>8</span> | uint32(src[<span>11</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(src[<span>12</span>])&lt;&lt;<span>24</span> | uint32(src[<span>13</span>])&lt;&lt;<span>16</span> | uint32(src[<span>14</span>])&lt;&lt;<span>8</span> | uint32(src[<span>15</span>])</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//第1次轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[<span>0</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[<span>1</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[<span>2</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[<span>3</span>]</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//nr为中间重复轮数</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//例如128位密钥，44字子密钥，此处为9轮</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//-2位去除开头和结尾轮</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;nr := <span>len</span>(xk)/<span>4</span> - <span>2</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//4表示已使用了4个字子密钥</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;k := <span>4</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>for</span> r := <span>0</span>; r &lt; nr; r++ {</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>//此处代码包括逆向字节代替、逆向行移位、逆向列混淆、轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t0 = xk[k+<span>0</span>] ^ td0[uint8(s0&gt;&gt;<span>24</span>)] ^ td1[uint8(s3&gt;&gt;<span>16</span>)] ^ td2[uint8(s2&gt;&gt;<span>8</span>)] ^ td3[uint8(s1)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1 = xk[k+<span>1</span>] ^ td0[uint8(s1&gt;&gt;<span>24</span>)] ^ td1[uint8(s0&gt;&gt;<span>16</span>)] ^ td2[uint8(s3&gt;&gt;<span>8</span>)] ^ td3[uint8(s2)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2 = xk[k+<span>2</span>] ^ td0[uint8(s2&gt;&gt;<span>24</span>)] ^ td1[uint8(s1&gt;&gt;<span>16</span>)] ^ td2[uint8(s0&gt;&gt;<span>8</span>)] ^ td3[uint8(s3)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3 = xk[k+<span>3</span>] ^ td0[uint8(s3&gt;&gt;<span>24</span>)] ^ td1[uint8(s2&gt;&gt;<span>16</span>)] ^ td2[uint8(s1&gt;&gt;<span>8</span>)] ^ td3[uint8(s0)]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k += <span>4</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s0, s1, s2, s3 = t0, t1, t2, t3</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//最后一轮仅包括逆向字节代替、逆向行移位、轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//此处为逆向字节代替和逆向行移位</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 = uint32(sbox1[t0&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox1[t3&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox1[t2&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox1[t1&amp;<span>0xff</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 = uint32(sbox1[t1&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox1[t0&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox1[t3&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox1[t2&amp;<span>0xff</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 = uint32(sbox1[t2&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox1[t1&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox1[t0&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox1[t3&amp;<span>0xff</span>])</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 = uint32(sbox1[t3&gt;&gt;<span>24</span>])&lt;&lt;<span>24</span> | uint32(sbox1[t2&gt;&gt;<span>16</span>&amp;<span>0xff</span>])&lt;&lt;<span>16</span> | uint32(sbox1[t1&gt;&gt;<span>8</span>&amp;<span>0xff</span>])&lt;&lt;<span>8</span> | uint32(sbox1[t0&amp;<span>0xff</span>])</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//轮密钥加</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s0 ^= xk[k+<span>0</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s1 ^= xk[k+<span>1</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s2 ^= xk[k+<span>2</span>]</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;s3 ^= xk[k+<span>3</span>]</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;<span>//输出</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>0</span>], dst[<span>1</span>], dst[<span>2</span>], dst[<span>3</span>] = byte(s0&gt;&gt;<span>24</span>), byte(s0&gt;&gt;<span>16</span>), byte(s0&gt;&gt;<span>8</span>), byte(s0)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>4</span>], dst[<span>5</span>], dst[<span>6</span>], dst[<span>7</span>] = byte(s1&gt;&gt;<span>24</span>), byte(s1&gt;&gt;<span>16</span>), byte(s1&gt;&gt;<span>8</span>), byte(s1)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>8</span>], dst[<span>9</span>], dst[<span>10</span>], dst[<span>11</span>] = byte(s2&gt;&gt;<span>24</span>), byte(s2&gt;&gt;<span>16</span>), byte(s2&gt;&gt;<span>8</span>), byte(s2)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;dst[<span>12</span>], dst[<span>13</span>], dst[<span>14</span>], dst[<span>15</span>] = byte(s3&gt;&gt;<span>24</span>), byte(s3&gt;&gt;<span>16</span>), byte(s3&gt;&gt;<span>8</span>), byte(s3)</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">}</span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;">//代码位置src/crypto/aes/block.go</span></span>
  </div>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span style="color:#000000;">```</span>
  </div>
  <span style="color:#000000;"><br style="font-family:Consolas, 'Courier New', monospace;font-size:14px;"></span>
  <div style="font-family:Consolas, 'Courier New', monospace;font-size:14px;">
   <span><span style="color:#000000;"><br style="background-color:rgb(255,255,255);"><br style="background-color:rgb(255,255,255);"></span></span>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180425001235188?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180425001144107?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;">网址：http://www.qukuailianxueyuan.io/<br></span></p>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180426145827720?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018042614570887?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;">欲领取造币技术与全套虚拟机资料</span></p>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;"><span>区块链技术交流QQ群：</span><span>756146052&nbsp;&nbsp;</span><span>备注：CSDN</span></span></p>
   <p style="background-color:rgb(255,255,255);"><span style="color:#000000;">尹成学院微信：备注：CSDN</span></p>
   <p style="text-align:center;background-color:rgb(255,255,255);"><span style="color:#000000;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180425000635656?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></span></p>
  </div> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/itcastcpp/article/details/80391309,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/itcastcpp/article/details/80391309,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

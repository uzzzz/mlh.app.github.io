<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>套利、投资、创业，从0到1打造更好的点对点交易协议 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="套利、投资、创业，从0到1打造更好的点对点交易协议" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="由CSDN主办，区块链大本营、EthFans、PDJ、极客帮创投协办的第7期CSDN区块链技术沙龙上，Hydro Protocol及DDEX技术负责人 David Qin带来题为《点对点交易技术与实践》的分享，从自身的区块链技术创业历程，解读以太坊上点对点交易的技术实践。 Hydro Protocol及DDEX点对点交易所 技术负责人 David Qin 整理 | 王国玺 &nbsp;&nbsp;&nbsp; 一、从套利开始，发现中心化交易所的安全危机 从套利引擎开始，我们需要接多家交易所API，我们需要把这些单糅到一起，糅成一个引擎，从中发现一些套利的机会。什么是套利机会？我们的引擎，类似一个撮合引擎，它不停扫描当前币种，哪个地方价格最低，哪个地方价格最高，如果这两个地方不是同一交易所，刨除掉持仓风险、平仓风险、滑点概率，如果仍然有套利利润在，那我们就把这个单吃掉。 当时市场分为两种币：公链币（比特币、以太坊）、ERC20。90%货币基本基于以太坊，比如基于ERC20的代币，所以我们选择基于ERC20开始套利。 首先，当时没有点对点交换的概念，我们只能接中心交易所。发现资产不安全。中心交易所的本质把所有钱充值到交易所一个钱包，然后它来负责所有人的资产安全。 当资产转移时，在数据库里给记了一笔账，比如说张三的钱给了李四，但实际在区块链上没有任何表示，只有提现时资产才真正结算。 在套利时，因为对接是多家交易所，所以资产存在了多家交易所上，我们特别担心自己的资产。 其次，API质量也是问题。有些交易所提供了WebAPI，但有些交易所只提供了WebSocket API。WebAPI的响应时间、质量以及变动，都会影响套利的滑点概率。 关于充值提现速度慢的问题。好的交易所，在提币时可能两个小时就能完成提币，把仓位重新弄平，套利机制重新跑起来。但有些交易所可能两天或一周都不会放币。这里面肯定有些技术问题，比如中心交易所使用小额充值的方式，它要把币汇总后，才能给别人提币。但这不是提现时间慢的借口。问题由于中心化导致，因为权限太高。 &nbsp; 二、从参与投资，发现点对点交易的创业机会 套利之余，我参与了一个朋友之间组织的数字货币基金。当时主要针对的方向是数字货币，和点对点交换协议，发现了点对点交换协议后，加上底层套利逻辑，以及对中心版本的种种不满，我们发现点对点交换是强需求。我们为什么不自己做一个？就针对ERC20，只要我们支持ERC20的点对点交换，就能覆盖90%的交易币种需求。 &nbsp; 常用钱包里有卡、现金、信用卡、存折。以太坊的钱包是是系统给我们私钥，对应着一份公钥，公钥对应着一份地址。钱包的功能仅仅是用这个私钥去产生数字签名，证明你拥有某个地址，仅此而已，其实它里面没存任何东西。 什么是ERC20？首先是合约，ERC20其实是个标准，凡是符合ERC20标准的代币都会支持几个接口，比如name、symbol、decimals以及用来转账和代理转账的transfer、transferFrom的接口，类似于类中的抽象类，它是一个标准。所有满足ERC20的货币，都可通过一个标准方式进行转账。 &nbsp; 点对点交易，可以解决中心化问题，但是，点对点交易完美吗？会有什么问题？ 钱包与合约很繁琐。在2017年6月，市面上还没有现在这么多的钱包，只能下以太坊官方的钱包Mist，下载Mist需要同步几十G数据的节点，这样才能跑起这个钱包。 用惯了中心化交易所的人肯定会对交易需求工具要求特别多。但在点对点交换版本里，目前只能实现一个limit order，market order还不成熟，这就是基本交易工具上的缺失。 现在以太坊每秒钟的节点吞吐量是每秒钟20-30笔交易。这个速度意味着每交换一笔资产，都会占以太坊区块链上每秒20笔交易中的一份，所以交易速度特别慢。 以上的种种难度决定了用户入门的门槛极高，所以没有人参与、挂买、挂卖，导致了流动性差的问题。 &nbsp; EtherDelta是典型的点对点交易所。它除了满足上述的去点对点交换不足的特性外，还有些弊端，比如充值就很危险，因为钱要从钱包转到另外一个地方。The DAO事件是2016年特别典型的一个事件。因为合约出了问题，所以导致以太坊分拆，分拆成ETH和ETC。Polkadot-Multisig也出了一些问题，现在你去以太坊区块链上看，Top Accounts里面的第二页，Polkadot-Multisig锁了30万个以太坊在钱包里。原因是它所依赖的以太坊合约库被调到suicide，自己依赖的一个lib已经被kill掉，然后导致30万个以太坊永远锁在虚空中，没有人能提走。 Partiy的多签名钱包同样也出现了问题。它把一些方法代理到自己的依赖库上，包括构造函数，而构造函数是可以声明钱包主人的。由此引发了一系列的资产丢失，大概都在千万美元级别，而Polkadot可能是上亿美元级别的。所以充值是一件很危险的事。 &nbsp; 三、ZRX是点对点交换协议的升级版，但它还不够好 &nbsp;&nbsp; 链上撤单是一个特别严重的问题，会贯穿整个点对点交换，它会直接导致被front run以及没办法做市。 经常在盘口大量的移动价格，如果撤单成本高，事情基本不可能完成。没有做事也会导致流动性差，流动性差就没有用户，没有用户就什么都转不起来，这会恶性循环。 &nbsp; 上图ZRX是点对点交换协议的升级版。它的出现给很多点对点交换带来曙光。针对需要充值的问题，ZRX解决的办法是用转账的授权来替代充值。 首先要把资产授权给Proxy，Proxy权限很高，但逻辑很蠢，什么都不会，唯一干的就是把钱从A转到B。因为足够简单，很难出现bug，它是一个永远不会升级的东西。 Exchange封装了所有的交易逻辑、是Proxy的调用方。用户就可以通过DAPP，调用Exchange里面的函数，通过Proxy转移用户的资产，完成一个区块链的交易。 但是ZRX机制没有解决链上撤单问题，这是DDEX团队首先发现的：在ZRX的核心数据结构里有一个taker属性，这个taker属性有两种设置方法： 1. 固定的地址； 2. Open的地址。 open的地址就是Open Match，Open Match意思就是单可被任何人吃，卖单时候，别人可跑在你的前面，front run的问题依然存在。然后，当你去撤销这单的时候，依然需要链上确认。 DDEX采用Closed Match，taker的永远是固定的地址，这个单只有DDEX可以去taker这个单，然后取消这个单子仅需要在DDEX上把单从数据库里面撤掉，就可以去撤单，而且保证区块链没有任何人可以在你之前去take，所以说这样就完全避免了front run的问题，然后对做市商是友好的，因为做市商可以随时下单、撤单，整个过程只要这单没有被撮合，没有进入最终结算阶段，都是不消耗任何手续费，仅消耗的就是流量和数据库空间而已，跟一个普通的中心化交易下单、撤单的感觉是一样。 &nbsp; DDEX选用了这种权限的办法，解决了front runing的问题。但仍然有一些新的挑战。现在的0X协议使用代币来交手续费的，这事极其不合理，具体体现比如说我想完成一笔交易，我说你必须握着一些0X，这个就特别不合理。 &nbsp; 用现在的点对点交换协议，来完成一个交易所的事情仍然很困难。还要要理解什么叫Exchange里面的一个基本交易单元，了解怎么签名、下单、授权，这些事情都很繁琐。 closed match导致单只能被自己吃，怎么才能让流动性共享起来，让更多人参与点对点交换。 &nbsp;&nbsp; 四、我们想要做更好的点对点交易协议——Hydro 经过思考，我们决定自己设计一个协议。链下撮合，链上成交。流动性的奖励机制。为提供高流动性的个体提供奖励。 Hydro是一个流体，类似于water、流动性。一个交易所没有流动性就永远没有人用。 这协议很抽象，但我们不想做一个抽象、不具化的东西。于是我们决定先做一家交易所，让这家交易所成为Hydro协议的第一个用户。如果把交易所做成了，才能证明这个协议可以成功，别人也会加入这个协议。顺理成章的，我们做了这家交易所叫DDEX （Decentralized Digital Exchange）。点对点交易是我们的第一版模型，经历了10周开发上线，今年1月份上线，现在已支持多个钱包。每笔交易都可以在链上看到，没有任何东西是不公开不透明的。 上图我们初做的版本，现在有一些UI和功能上的迭代。架构分为三部分：DAPP、Backend、Services。 DAPP是一个React项目。 Backend分为的API、Engine和Watcher。Engine与普通交易所的Engine有差别，不仅仅是记账，它还需要把所有用户的交易发到链上。 Watcher用来监视区块链变化，并通知其他服务。 底层的Services会有一些基础的东西，比如说PostgreSQL、Redis和Geth Node。Geth Node是一个以太坊节点。 &nbsp; Watcher不能以一个结点目前的最新信息来当成判断依据，因为区块链最新的几个节点总是处于混沌状态，这也是为什么比特币的转账交易需要6个区块确认，而以太坊可能需要更多。因为以太坊的块时间更短，比如至少60个区块，资产量越大，需要确认的区块就越多。 然后Watcher将进行一系列的改变。蓝色区块是指已经确认相对久远的区块，这个虚线的区块就证明可能刚被挖出来的，这个区块可能是不太安全的区块。 所以说我们会用刚挖出来的区块通知用户，让他感到交易运算的发生。然后用一些更久远的块来确认区块链最终的交易状态，用这些来最终决定用户的一笔交易是不是真正的发生了。 由于SSR的需求，前端框架从多次切换。 DAPP运行需要一个钱包的环境。目前的钱包有MetaMask、Mist，这些wap3钱包实现的基本上没有一个完全符合标准的，因为MetaMask它在签名的时候没有加上Ethereum的send message签名消息头。当在前端去匹配不同的钱包的时候，会有一些冲突，需要特殊处理。 后端针对之前的版本做了一些重构，从一个单人的开发模式换成Gitlab CI + docker + kubernetes来压缩运维成本。 Engine当时做了很多事情，Engine不仅要撮合交易，要落库，而且还要跟以太坊之间打交道，这个Engine的代码就会越来越耦合，所以用微服务的方式拆分逻辑，用kafka做消息队列。 Log收集是为了方便后期debug，所有的后面这些架构其实在一些通常的开发里面都是很常见的。 &nbsp; 五、丢失了122个以太坊后，我意识到资产安全的重要性 安全问题很严重，由此我们也付出了一些代价。常规的安全项目，比如2018年，EtherDelta出了一些问题，他们的域名过期了，被别人买了，搭了一个一模一样的节点，然后大家把钱充进去就没了。 去年有一个项目叫Decentraland，特别火，据我所知有无数人要抢他们的ICO，但是特别难抢。它的合约写的是当在第41万多少个区块开始，它这个合约开始接受往里面转以太坊，然后会往外转Decentraland的币叫MANA。 这件事是不可能通过手动来完成，一是找不到好的时间点，可能很快就结束了。所以说我就决定用他们本身的代码来去抢ICO，我把我的私钥放到了一个以太坊节点上，打开了rpc的默认端口，为提前测试，我解密了私钥，我两个账号里面一个有100个以太坊，一个有22个以太坊， 10分钟以后，我的钱包里一分钱也没有了。我就开始翻etherscan上的一些消息，一个叫bruce的人就提供了一些线索，我也回忆了一下我到底都做了什么。 以太坊钱包的节点其实相当于它会负责同步数据，如果你解锁私钥了以后，凡是能访问你节点的方式，都能去转走你的钱，这件是一个特别大的坑，我也认为这是以太坊bug，前一段我也看了一个文章在介绍这个事情。 那如何管理好自己的以太坊节点？首先，能用内网绝对不用外网。如果说你不想给大众做一个公用节点的话，永远不要开公网，还有一个从根本上解决的办法，就是永远不要把私钥和任何私钥相关的东西存到以太坊节点上，用一个新的东西ProviderEngine，让我们的私钥永远都在我们的项目里面，自己来保护。 所有的交易都是只要签过名之后，把签名的消息发到公网的节点上。这样的好处就是说最终的权限全留在代码里，出代码的东西都是可以见光的，这个就是在部署以太坊节点的时候的一些经验。 &nbsp; 六、想写自己的DAPP，我的建议是什么 刚开发时候，会有一些测试的需求，还有部署合约的需求，就是很麻烦，因为当时用主网测的话太贵，用测试网来测的话太慢，然后就开始寻找各种各样的工具，然后就找到了这个Truffle。 Truffle主要提供了一套合约、部署和测试的框架，它会提供一套类似于Migration的机制，可以频繁部署更多的合约，不用操心合约部署到哪。然后在测试的时候可以写一个Contract来测试Contract，也可以用JS来测试Contract。 Ganache是一个node.js版本的以太坊虚拟机，它启动的时候会启动有10个有钱的以太坊账号，产生区块的方式也特别特殊，它的区块产生是同步的，把一笔交易发到这个测试区块上，它会严格的把这笔交易打包成一个新的区块，然后返回。这对于测试和开发极其友好。 Ropsten几乎像素级的模拟了以太坊的官方节点，然后上面的币基本上是免费的，拿一个GTX1070挖一天，就能挖出个100币，所以它基本上可以在项目想要上线之前提供一个比较好的，相对真实的测试环境。 如果想写DAPP， smart-contract-best-practices很有参考价值。Rops比如写合约时候，什么时候开始用什么函数，在处理外部调用和内部状态时候，应该先处理外部依赖还是先处理内部的状态。在网上随便一搜就可以搜到它的官网，包括里面有好多合约的实践。 &nbsp; 目前Hydro协议已正式开源 Hydro 1.0 代码库，未来会把做点对点交易所的更多代码开源。通过 Hydro开源代码库，节点可以在Hydro 协议上开发自己的点对点化交易所(Relayer)，赋能流量入口、Dapp 部署自己的 DEX , 实现界面内无缝的原子级别币币交换（Atomic Swap）。 &nbsp; 通过Hydro协议，我们提供节点一个没有技术门槛的交易平台和一个完全的点对点的交易的整体解决方案。比如你想开一个点对点交易的交易平台，所需要的只是在阿里云、腾讯云、亚马逊云或者谷歌的数据中心买一个服务器，我们就可以给他做一个私有化部署，你就可以成为一个hydro协议上的节点，通过共享流动性来保护这个网络的强劲跟安全。作为一个hydro节点，永远都是让用户保护资金同时点对点交易。最重要的一点是APP内嵌，比如我们CSDN有一个自己的app，然后这个app是我们所有咨询平台，然后这些咨询平台会有一个tap，这个tap里面会有钱包，点对点交易的界面，这个时候在任何的app里面就会直接进行点对点的交易，依靠以太坊网络。 &nbsp; &nbsp; 热门文章 CSDN蒋涛：从产品经理到通证设计师 80%开发者都不知道的以太坊骚操作：「事件」和「日志」还可以这么玩！ 五一结束，是该活跃一下大脑了：证券型代币合法吗？ 五一出游，“我”的隐私被扒干净了 营长招人啦 CSDN区块链大本营招采编2名： 1. 对区块链技术有一定的理解，对大公司动态有极强敏感性，且有深度剖析的楞劲儿。 2. 出稿速度快，具有每天报题和出稿的能力。 3. 有能力采访行业高端人物，能将其观点进行深刻呈现。 4. 相关媒体经验2年以上。 5. 英语6级以上，能快速编译。 6. 本科以上 待遇： 绝不低于行业水平，只要有才，我们愿意给你一切资源。 邮件发送：puge@csdn.net 邮件注明：姓名+区块链+采编应聘 阅读更多" />
<meta property="og:description" content="由CSDN主办，区块链大本营、EthFans、PDJ、极客帮创投协办的第7期CSDN区块链技术沙龙上，Hydro Protocol及DDEX技术负责人 David Qin带来题为《点对点交易技术与实践》的分享，从自身的区块链技术创业历程，解读以太坊上点对点交易的技术实践。 Hydro Protocol及DDEX点对点交易所 技术负责人 David Qin 整理 | 王国玺 &nbsp;&nbsp;&nbsp; 一、从套利开始，发现中心化交易所的安全危机 从套利引擎开始，我们需要接多家交易所API，我们需要把这些单糅到一起，糅成一个引擎，从中发现一些套利的机会。什么是套利机会？我们的引擎，类似一个撮合引擎，它不停扫描当前币种，哪个地方价格最低，哪个地方价格最高，如果这两个地方不是同一交易所，刨除掉持仓风险、平仓风险、滑点概率，如果仍然有套利利润在，那我们就把这个单吃掉。 当时市场分为两种币：公链币（比特币、以太坊）、ERC20。90%货币基本基于以太坊，比如基于ERC20的代币，所以我们选择基于ERC20开始套利。 首先，当时没有点对点交换的概念，我们只能接中心交易所。发现资产不安全。中心交易所的本质把所有钱充值到交易所一个钱包，然后它来负责所有人的资产安全。 当资产转移时，在数据库里给记了一笔账，比如说张三的钱给了李四，但实际在区块链上没有任何表示，只有提现时资产才真正结算。 在套利时，因为对接是多家交易所，所以资产存在了多家交易所上，我们特别担心自己的资产。 其次，API质量也是问题。有些交易所提供了WebAPI，但有些交易所只提供了WebSocket API。WebAPI的响应时间、质量以及变动，都会影响套利的滑点概率。 关于充值提现速度慢的问题。好的交易所，在提币时可能两个小时就能完成提币，把仓位重新弄平，套利机制重新跑起来。但有些交易所可能两天或一周都不会放币。这里面肯定有些技术问题，比如中心交易所使用小额充值的方式，它要把币汇总后，才能给别人提币。但这不是提现时间慢的借口。问题由于中心化导致，因为权限太高。 &nbsp; 二、从参与投资，发现点对点交易的创业机会 套利之余，我参与了一个朋友之间组织的数字货币基金。当时主要针对的方向是数字货币，和点对点交换协议，发现了点对点交换协议后，加上底层套利逻辑，以及对中心版本的种种不满，我们发现点对点交换是强需求。我们为什么不自己做一个？就针对ERC20，只要我们支持ERC20的点对点交换，就能覆盖90%的交易币种需求。 &nbsp; 常用钱包里有卡、现金、信用卡、存折。以太坊的钱包是是系统给我们私钥，对应着一份公钥，公钥对应着一份地址。钱包的功能仅仅是用这个私钥去产生数字签名，证明你拥有某个地址，仅此而已，其实它里面没存任何东西。 什么是ERC20？首先是合约，ERC20其实是个标准，凡是符合ERC20标准的代币都会支持几个接口，比如name、symbol、decimals以及用来转账和代理转账的transfer、transferFrom的接口，类似于类中的抽象类，它是一个标准。所有满足ERC20的货币，都可通过一个标准方式进行转账。 &nbsp; 点对点交易，可以解决中心化问题，但是，点对点交易完美吗？会有什么问题？ 钱包与合约很繁琐。在2017年6月，市面上还没有现在这么多的钱包，只能下以太坊官方的钱包Mist，下载Mist需要同步几十G数据的节点，这样才能跑起这个钱包。 用惯了中心化交易所的人肯定会对交易需求工具要求特别多。但在点对点交换版本里，目前只能实现一个limit order，market order还不成熟，这就是基本交易工具上的缺失。 现在以太坊每秒钟的节点吞吐量是每秒钟20-30笔交易。这个速度意味着每交换一笔资产，都会占以太坊区块链上每秒20笔交易中的一份，所以交易速度特别慢。 以上的种种难度决定了用户入门的门槛极高，所以没有人参与、挂买、挂卖，导致了流动性差的问题。 &nbsp; EtherDelta是典型的点对点交易所。它除了满足上述的去点对点交换不足的特性外，还有些弊端，比如充值就很危险，因为钱要从钱包转到另外一个地方。The DAO事件是2016年特别典型的一个事件。因为合约出了问题，所以导致以太坊分拆，分拆成ETH和ETC。Polkadot-Multisig也出了一些问题，现在你去以太坊区块链上看，Top Accounts里面的第二页，Polkadot-Multisig锁了30万个以太坊在钱包里。原因是它所依赖的以太坊合约库被调到suicide，自己依赖的一个lib已经被kill掉，然后导致30万个以太坊永远锁在虚空中，没有人能提走。 Partiy的多签名钱包同样也出现了问题。它把一些方法代理到自己的依赖库上，包括构造函数，而构造函数是可以声明钱包主人的。由此引发了一系列的资产丢失，大概都在千万美元级别，而Polkadot可能是上亿美元级别的。所以充值是一件很危险的事。 &nbsp; 三、ZRX是点对点交换协议的升级版，但它还不够好 &nbsp;&nbsp; 链上撤单是一个特别严重的问题，会贯穿整个点对点交换，它会直接导致被front run以及没办法做市。 经常在盘口大量的移动价格，如果撤单成本高，事情基本不可能完成。没有做事也会导致流动性差，流动性差就没有用户，没有用户就什么都转不起来，这会恶性循环。 &nbsp; 上图ZRX是点对点交换协议的升级版。它的出现给很多点对点交换带来曙光。针对需要充值的问题，ZRX解决的办法是用转账的授权来替代充值。 首先要把资产授权给Proxy，Proxy权限很高，但逻辑很蠢，什么都不会，唯一干的就是把钱从A转到B。因为足够简单，很难出现bug，它是一个永远不会升级的东西。 Exchange封装了所有的交易逻辑、是Proxy的调用方。用户就可以通过DAPP，调用Exchange里面的函数，通过Proxy转移用户的资产，完成一个区块链的交易。 但是ZRX机制没有解决链上撤单问题，这是DDEX团队首先发现的：在ZRX的核心数据结构里有一个taker属性，这个taker属性有两种设置方法： 1. 固定的地址； 2. Open的地址。 open的地址就是Open Match，Open Match意思就是单可被任何人吃，卖单时候，别人可跑在你的前面，front run的问题依然存在。然后，当你去撤销这单的时候，依然需要链上确认。 DDEX采用Closed Match，taker的永远是固定的地址，这个单只有DDEX可以去taker这个单，然后取消这个单子仅需要在DDEX上把单从数据库里面撤掉，就可以去撤单，而且保证区块链没有任何人可以在你之前去take，所以说这样就完全避免了front run的问题，然后对做市商是友好的，因为做市商可以随时下单、撤单，整个过程只要这单没有被撮合，没有进入最终结算阶段，都是不消耗任何手续费，仅消耗的就是流量和数据库空间而已，跟一个普通的中心化交易下单、撤单的感觉是一样。 &nbsp; DDEX选用了这种权限的办法，解决了front runing的问题。但仍然有一些新的挑战。现在的0X协议使用代币来交手续费的，这事极其不合理，具体体现比如说我想完成一笔交易，我说你必须握着一些0X，这个就特别不合理。 &nbsp; 用现在的点对点交换协议，来完成一个交易所的事情仍然很困难。还要要理解什么叫Exchange里面的一个基本交易单元，了解怎么签名、下单、授权，这些事情都很繁琐。 closed match导致单只能被自己吃，怎么才能让流动性共享起来，让更多人参与点对点交换。 &nbsp;&nbsp; 四、我们想要做更好的点对点交易协议——Hydro 经过思考，我们决定自己设计一个协议。链下撮合，链上成交。流动性的奖励机制。为提供高流动性的个体提供奖励。 Hydro是一个流体，类似于water、流动性。一个交易所没有流动性就永远没有人用。 这协议很抽象，但我们不想做一个抽象、不具化的东西。于是我们决定先做一家交易所，让这家交易所成为Hydro协议的第一个用户。如果把交易所做成了，才能证明这个协议可以成功，别人也会加入这个协议。顺理成章的，我们做了这家交易所叫DDEX （Decentralized Digital Exchange）。点对点交易是我们的第一版模型，经历了10周开发上线，今年1月份上线，现在已支持多个钱包。每笔交易都可以在链上看到，没有任何东西是不公开不透明的。 上图我们初做的版本，现在有一些UI和功能上的迭代。架构分为三部分：DAPP、Backend、Services。 DAPP是一个React项目。 Backend分为的API、Engine和Watcher。Engine与普通交易所的Engine有差别，不仅仅是记账，它还需要把所有用户的交易发到链上。 Watcher用来监视区块链变化，并通知其他服务。 底层的Services会有一些基础的东西，比如说PostgreSQL、Redis和Geth Node。Geth Node是一个以太坊节点。 &nbsp; Watcher不能以一个结点目前的最新信息来当成判断依据，因为区块链最新的几个节点总是处于混沌状态，这也是为什么比特币的转账交易需要6个区块确认，而以太坊可能需要更多。因为以太坊的块时间更短，比如至少60个区块，资产量越大，需要确认的区块就越多。 然后Watcher将进行一系列的改变。蓝色区块是指已经确认相对久远的区块，这个虚线的区块就证明可能刚被挖出来的，这个区块可能是不太安全的区块。 所以说我们会用刚挖出来的区块通知用户，让他感到交易运算的发生。然后用一些更久远的块来确认区块链最终的交易状态，用这些来最终决定用户的一笔交易是不是真正的发生了。 由于SSR的需求，前端框架从多次切换。 DAPP运行需要一个钱包的环境。目前的钱包有MetaMask、Mist，这些wap3钱包实现的基本上没有一个完全符合标准的，因为MetaMask它在签名的时候没有加上Ethereum的send message签名消息头。当在前端去匹配不同的钱包的时候，会有一些冲突，需要特殊处理。 后端针对之前的版本做了一些重构，从一个单人的开发模式换成Gitlab CI + docker + kubernetes来压缩运维成本。 Engine当时做了很多事情，Engine不仅要撮合交易，要落库，而且还要跟以太坊之间打交道，这个Engine的代码就会越来越耦合，所以用微服务的方式拆分逻辑，用kafka做消息队列。 Log收集是为了方便后期debug，所有的后面这些架构其实在一些通常的开发里面都是很常见的。 &nbsp; 五、丢失了122个以太坊后，我意识到资产安全的重要性 安全问题很严重，由此我们也付出了一些代价。常规的安全项目，比如2018年，EtherDelta出了一些问题，他们的域名过期了，被别人买了，搭了一个一模一样的节点，然后大家把钱充进去就没了。 去年有一个项目叫Decentraland，特别火，据我所知有无数人要抢他们的ICO，但是特别难抢。它的合约写的是当在第41万多少个区块开始，它这个合约开始接受往里面转以太坊，然后会往外转Decentraland的币叫MANA。 这件事是不可能通过手动来完成，一是找不到好的时间点，可能很快就结束了。所以说我就决定用他们本身的代码来去抢ICO，我把我的私钥放到了一个以太坊节点上，打开了rpc的默认端口，为提前测试，我解密了私钥，我两个账号里面一个有100个以太坊，一个有22个以太坊， 10分钟以后，我的钱包里一分钱也没有了。我就开始翻etherscan上的一些消息，一个叫bruce的人就提供了一些线索，我也回忆了一下我到底都做了什么。 以太坊钱包的节点其实相当于它会负责同步数据，如果你解锁私钥了以后，凡是能访问你节点的方式，都能去转走你的钱，这件是一个特别大的坑，我也认为这是以太坊bug，前一段我也看了一个文章在介绍这个事情。 那如何管理好自己的以太坊节点？首先，能用内网绝对不用外网。如果说你不想给大众做一个公用节点的话，永远不要开公网，还有一个从根本上解决的办法，就是永远不要把私钥和任何私钥相关的东西存到以太坊节点上，用一个新的东西ProviderEngine，让我们的私钥永远都在我们的项目里面，自己来保护。 所有的交易都是只要签过名之后，把签名的消息发到公网的节点上。这样的好处就是说最终的权限全留在代码里，出代码的东西都是可以见光的，这个就是在部署以太坊节点的时候的一些经验。 &nbsp; 六、想写自己的DAPP，我的建议是什么 刚开发时候，会有一些测试的需求，还有部署合约的需求，就是很麻烦，因为当时用主网测的话太贵，用测试网来测的话太慢，然后就开始寻找各种各样的工具，然后就找到了这个Truffle。 Truffle主要提供了一套合约、部署和测试的框架，它会提供一套类似于Migration的机制，可以频繁部署更多的合约，不用操心合约部署到哪。然后在测试的时候可以写一个Contract来测试Contract，也可以用JS来测试Contract。 Ganache是一个node.js版本的以太坊虚拟机，它启动的时候会启动有10个有钱的以太坊账号，产生区块的方式也特别特殊，它的区块产生是同步的，把一笔交易发到这个测试区块上，它会严格的把这笔交易打包成一个新的区块，然后返回。这对于测试和开发极其友好。 Ropsten几乎像素级的模拟了以太坊的官方节点，然后上面的币基本上是免费的，拿一个GTX1070挖一天，就能挖出个100币，所以它基本上可以在项目想要上线之前提供一个比较好的，相对真实的测试环境。 如果想写DAPP， smart-contract-best-practices很有参考价值。Rops比如写合约时候，什么时候开始用什么函数，在处理外部调用和内部状态时候，应该先处理外部依赖还是先处理内部的状态。在网上随便一搜就可以搜到它的官网，包括里面有好多合约的实践。 &nbsp; 目前Hydro协议已正式开源 Hydro 1.0 代码库，未来会把做点对点交易所的更多代码开源。通过 Hydro开源代码库，节点可以在Hydro 协议上开发自己的点对点化交易所(Relayer)，赋能流量入口、Dapp 部署自己的 DEX , 实现界面内无缝的原子级别币币交换（Atomic Swap）。 &nbsp; 通过Hydro协议，我们提供节点一个没有技术门槛的交易平台和一个完全的点对点的交易的整体解决方案。比如你想开一个点对点交易的交易平台，所需要的只是在阿里云、腾讯云、亚马逊云或者谷歌的数据中心买一个服务器，我们就可以给他做一个私有化部署，你就可以成为一个hydro协议上的节点，通过共享流动性来保护这个网络的强劲跟安全。作为一个hydro节点，永远都是让用户保护资金同时点对点交易。最重要的一点是APP内嵌，比如我们CSDN有一个自己的app，然后这个app是我们所有咨询平台，然后这些咨询平台会有一个tap，这个tap里面会有钱包，点对点交易的界面，这个时候在任何的app里面就会直接进行点对点的交易，依靠以太坊网络。 &nbsp; &nbsp; 热门文章 CSDN蒋涛：从产品经理到通证设计师 80%开发者都不知道的以太坊骚操作：「事件」和「日志」还可以这么玩！ 五一结束，是该活跃一下大脑了：证券型代币合法吗？ 五一出游，“我”的隐私被扒干净了 营长招人啦 CSDN区块链大本营招采编2名： 1. 对区块链技术有一定的理解，对大公司动态有极强敏感性，且有深度剖析的楞劲儿。 2. 出稿速度快，具有每天报题和出稿的能力。 3. 有能力采访行业高端人物，能将其观点进行深刻呈现。 4. 相关媒体经验2年以上。 5. 英语6级以上，能快速编译。 6. 本科以上 待遇： 绝不低于行业水平，只要有才，我们愿意给你一切资源。 邮件发送：puge@csdn.net 邮件注明：姓名+区块链+采编应聘 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-04T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"由CSDN主办，区块链大本营、EthFans、PDJ、极客帮创投协办的第7期CSDN区块链技术沙龙上，Hydro Protocol及DDEX技术负责人 David Qin带来题为《点对点交易技术与实践》的分享，从自身的区块链技术创业历程，解读以太坊上点对点交易的技术实践。 Hydro Protocol及DDEX点对点交易所 技术负责人 David Qin 整理 | 王国玺 &nbsp;&nbsp;&nbsp; 一、从套利开始，发现中心化交易所的安全危机 从套利引擎开始，我们需要接多家交易所API，我们需要把这些单糅到一起，糅成一个引擎，从中发现一些套利的机会。什么是套利机会？我们的引擎，类似一个撮合引擎，它不停扫描当前币种，哪个地方价格最低，哪个地方价格最高，如果这两个地方不是同一交易所，刨除掉持仓风险、平仓风险、滑点概率，如果仍然有套利利润在，那我们就把这个单吃掉。 当时市场分为两种币：公链币（比特币、以太坊）、ERC20。90%货币基本基于以太坊，比如基于ERC20的代币，所以我们选择基于ERC20开始套利。 首先，当时没有点对点交换的概念，我们只能接中心交易所。发现资产不安全。中心交易所的本质把所有钱充值到交易所一个钱包，然后它来负责所有人的资产安全。 当资产转移时，在数据库里给记了一笔账，比如说张三的钱给了李四，但实际在区块链上没有任何表示，只有提现时资产才真正结算。 在套利时，因为对接是多家交易所，所以资产存在了多家交易所上，我们特别担心自己的资产。 其次，API质量也是问题。有些交易所提供了WebAPI，但有些交易所只提供了WebSocket API。WebAPI的响应时间、质量以及变动，都会影响套利的滑点概率。 关于充值提现速度慢的问题。好的交易所，在提币时可能两个小时就能完成提币，把仓位重新弄平，套利机制重新跑起来。但有些交易所可能两天或一周都不会放币。这里面肯定有些技术问题，比如中心交易所使用小额充值的方式，它要把币汇总后，才能给别人提币。但这不是提现时间慢的借口。问题由于中心化导致，因为权限太高。 &nbsp; 二、从参与投资，发现点对点交易的创业机会 套利之余，我参与了一个朋友之间组织的数字货币基金。当时主要针对的方向是数字货币，和点对点交换协议，发现了点对点交换协议后，加上底层套利逻辑，以及对中心版本的种种不满，我们发现点对点交换是强需求。我们为什么不自己做一个？就针对ERC20，只要我们支持ERC20的点对点交换，就能覆盖90%的交易币种需求。 &nbsp; 常用钱包里有卡、现金、信用卡、存折。以太坊的钱包是是系统给我们私钥，对应着一份公钥，公钥对应着一份地址。钱包的功能仅仅是用这个私钥去产生数字签名，证明你拥有某个地址，仅此而已，其实它里面没存任何东西。 什么是ERC20？首先是合约，ERC20其实是个标准，凡是符合ERC20标准的代币都会支持几个接口，比如name、symbol、decimals以及用来转账和代理转账的transfer、transferFrom的接口，类似于类中的抽象类，它是一个标准。所有满足ERC20的货币，都可通过一个标准方式进行转账。 &nbsp; 点对点交易，可以解决中心化问题，但是，点对点交易完美吗？会有什么问题？ 钱包与合约很繁琐。在2017年6月，市面上还没有现在这么多的钱包，只能下以太坊官方的钱包Mist，下载Mist需要同步几十G数据的节点，这样才能跑起这个钱包。 用惯了中心化交易所的人肯定会对交易需求工具要求特别多。但在点对点交换版本里，目前只能实现一个limit order，market order还不成熟，这就是基本交易工具上的缺失。 现在以太坊每秒钟的节点吞吐量是每秒钟20-30笔交易。这个速度意味着每交换一笔资产，都会占以太坊区块链上每秒20笔交易中的一份，所以交易速度特别慢。 以上的种种难度决定了用户入门的门槛极高，所以没有人参与、挂买、挂卖，导致了流动性差的问题。 &nbsp; EtherDelta是典型的点对点交易所。它除了满足上述的去点对点交换不足的特性外，还有些弊端，比如充值就很危险，因为钱要从钱包转到另外一个地方。The DAO事件是2016年特别典型的一个事件。因为合约出了问题，所以导致以太坊分拆，分拆成ETH和ETC。Polkadot-Multisig也出了一些问题，现在你去以太坊区块链上看，Top Accounts里面的第二页，Polkadot-Multisig锁了30万个以太坊在钱包里。原因是它所依赖的以太坊合约库被调到suicide，自己依赖的一个lib已经被kill掉，然后导致30万个以太坊永远锁在虚空中，没有人能提走。 Partiy的多签名钱包同样也出现了问题。它把一些方法代理到自己的依赖库上，包括构造函数，而构造函数是可以声明钱包主人的。由此引发了一系列的资产丢失，大概都在千万美元级别，而Polkadot可能是上亿美元级别的。所以充值是一件很危险的事。 &nbsp; 三、ZRX是点对点交换协议的升级版，但它还不够好 &nbsp;&nbsp; 链上撤单是一个特别严重的问题，会贯穿整个点对点交换，它会直接导致被front run以及没办法做市。 经常在盘口大量的移动价格，如果撤单成本高，事情基本不可能完成。没有做事也会导致流动性差，流动性差就没有用户，没有用户就什么都转不起来，这会恶性循环。 &nbsp; 上图ZRX是点对点交换协议的升级版。它的出现给很多点对点交换带来曙光。针对需要充值的问题，ZRX解决的办法是用转账的授权来替代充值。 首先要把资产授权给Proxy，Proxy权限很高，但逻辑很蠢，什么都不会，唯一干的就是把钱从A转到B。因为足够简单，很难出现bug，它是一个永远不会升级的东西。 Exchange封装了所有的交易逻辑、是Proxy的调用方。用户就可以通过DAPP，调用Exchange里面的函数，通过Proxy转移用户的资产，完成一个区块链的交易。 但是ZRX机制没有解决链上撤单问题，这是DDEX团队首先发现的：在ZRX的核心数据结构里有一个taker属性，这个taker属性有两种设置方法： 1. 固定的地址； 2. Open的地址。 open的地址就是Open Match，Open Match意思就是单可被任何人吃，卖单时候，别人可跑在你的前面，front run的问题依然存在。然后，当你去撤销这单的时候，依然需要链上确认。 DDEX采用Closed Match，taker的永远是固定的地址，这个单只有DDEX可以去taker这个单，然后取消这个单子仅需要在DDEX上把单从数据库里面撤掉，就可以去撤单，而且保证区块链没有任何人可以在你之前去take，所以说这样就完全避免了front run的问题，然后对做市商是友好的，因为做市商可以随时下单、撤单，整个过程只要这单没有被撮合，没有进入最终结算阶段，都是不消耗任何手续费，仅消耗的就是流量和数据库空间而已，跟一个普通的中心化交易下单、撤单的感觉是一样。 &nbsp; DDEX选用了这种权限的办法，解决了front runing的问题。但仍然有一些新的挑战。现在的0X协议使用代币来交手续费的，这事极其不合理，具体体现比如说我想完成一笔交易，我说你必须握着一些0X，这个就特别不合理。 &nbsp; 用现在的点对点交换协议，来完成一个交易所的事情仍然很困难。还要要理解什么叫Exchange里面的一个基本交易单元，了解怎么签名、下单、授权，这些事情都很繁琐。 closed match导致单只能被自己吃，怎么才能让流动性共享起来，让更多人参与点对点交换。 &nbsp;&nbsp; 四、我们想要做更好的点对点交易协议——Hydro 经过思考，我们决定自己设计一个协议。链下撮合，链上成交。流动性的奖励机制。为提供高流动性的个体提供奖励。 Hydro是一个流体，类似于water、流动性。一个交易所没有流动性就永远没有人用。 这协议很抽象，但我们不想做一个抽象、不具化的东西。于是我们决定先做一家交易所，让这家交易所成为Hydro协议的第一个用户。如果把交易所做成了，才能证明这个协议可以成功，别人也会加入这个协议。顺理成章的，我们做了这家交易所叫DDEX （Decentralized Digital Exchange）。点对点交易是我们的第一版模型，经历了10周开发上线，今年1月份上线，现在已支持多个钱包。每笔交易都可以在链上看到，没有任何东西是不公开不透明的。 上图我们初做的版本，现在有一些UI和功能上的迭代。架构分为三部分：DAPP、Backend、Services。 DAPP是一个React项目。 Backend分为的API、Engine和Watcher。Engine与普通交易所的Engine有差别，不仅仅是记账，它还需要把所有用户的交易发到链上。 Watcher用来监视区块链变化，并通知其他服务。 底层的Services会有一些基础的东西，比如说PostgreSQL、Redis和Geth Node。Geth Node是一个以太坊节点。 &nbsp; Watcher不能以一个结点目前的最新信息来当成判断依据，因为区块链最新的几个节点总是处于混沌状态，这也是为什么比特币的转账交易需要6个区块确认，而以太坊可能需要更多。因为以太坊的块时间更短，比如至少60个区块，资产量越大，需要确认的区块就越多。 然后Watcher将进行一系列的改变。蓝色区块是指已经确认相对久远的区块，这个虚线的区块就证明可能刚被挖出来的，这个区块可能是不太安全的区块。 所以说我们会用刚挖出来的区块通知用户，让他感到交易运算的发生。然后用一些更久远的块来确认区块链最终的交易状态，用这些来最终决定用户的一笔交易是不是真正的发生了。 由于SSR的需求，前端框架从多次切换。 DAPP运行需要一个钱包的环境。目前的钱包有MetaMask、Mist，这些wap3钱包实现的基本上没有一个完全符合标准的，因为MetaMask它在签名的时候没有加上Ethereum的send message签名消息头。当在前端去匹配不同的钱包的时候，会有一些冲突，需要特殊处理。 后端针对之前的版本做了一些重构，从一个单人的开发模式换成Gitlab CI + docker + kubernetes来压缩运维成本。 Engine当时做了很多事情，Engine不仅要撮合交易，要落库，而且还要跟以太坊之间打交道，这个Engine的代码就会越来越耦合，所以用微服务的方式拆分逻辑，用kafka做消息队列。 Log收集是为了方便后期debug，所有的后面这些架构其实在一些通常的开发里面都是很常见的。 &nbsp; 五、丢失了122个以太坊后，我意识到资产安全的重要性 安全问题很严重，由此我们也付出了一些代价。常规的安全项目，比如2018年，EtherDelta出了一些问题，他们的域名过期了，被别人买了，搭了一个一模一样的节点，然后大家把钱充进去就没了。 去年有一个项目叫Decentraland，特别火，据我所知有无数人要抢他们的ICO，但是特别难抢。它的合约写的是当在第41万多少个区块开始，它这个合约开始接受往里面转以太坊，然后会往外转Decentraland的币叫MANA。 这件事是不可能通过手动来完成，一是找不到好的时间点，可能很快就结束了。所以说我就决定用他们本身的代码来去抢ICO，我把我的私钥放到了一个以太坊节点上，打开了rpc的默认端口，为提前测试，我解密了私钥，我两个账号里面一个有100个以太坊，一个有22个以太坊， 10分钟以后，我的钱包里一分钱也没有了。我就开始翻etherscan上的一些消息，一个叫bruce的人就提供了一些线索，我也回忆了一下我到底都做了什么。 以太坊钱包的节点其实相当于它会负责同步数据，如果你解锁私钥了以后，凡是能访问你节点的方式，都能去转走你的钱，这件是一个特别大的坑，我也认为这是以太坊bug，前一段我也看了一个文章在介绍这个事情。 那如何管理好自己的以太坊节点？首先，能用内网绝对不用外网。如果说你不想给大众做一个公用节点的话，永远不要开公网，还有一个从根本上解决的办法，就是永远不要把私钥和任何私钥相关的东西存到以太坊节点上，用一个新的东西ProviderEngine，让我们的私钥永远都在我们的项目里面，自己来保护。 所有的交易都是只要签过名之后，把签名的消息发到公网的节点上。这样的好处就是说最终的权限全留在代码里，出代码的东西都是可以见光的，这个就是在部署以太坊节点的时候的一些经验。 &nbsp; 六、想写自己的DAPP，我的建议是什么 刚开发时候，会有一些测试的需求，还有部署合约的需求，就是很麻烦，因为当时用主网测的话太贵，用测试网来测的话太慢，然后就开始寻找各种各样的工具，然后就找到了这个Truffle。 Truffle主要提供了一套合约、部署和测试的框架，它会提供一套类似于Migration的机制，可以频繁部署更多的合约，不用操心合约部署到哪。然后在测试的时候可以写一个Contract来测试Contract，也可以用JS来测试Contract。 Ganache是一个node.js版本的以太坊虚拟机，它启动的时候会启动有10个有钱的以太坊账号，产生区块的方式也特别特殊，它的区块产生是同步的，把一笔交易发到这个测试区块上，它会严格的把这笔交易打包成一个新的区块，然后返回。这对于测试和开发极其友好。 Ropsten几乎像素级的模拟了以太坊的官方节点，然后上面的币基本上是免费的，拿一个GTX1070挖一天，就能挖出个100币，所以它基本上可以在项目想要上线之前提供一个比较好的，相对真实的测试环境。 如果想写DAPP， smart-contract-best-practices很有参考价值。Rops比如写合约时候，什么时候开始用什么函数，在处理外部调用和内部状态时候，应该先处理外部依赖还是先处理内部的状态。在网上随便一搜就可以搜到它的官网，包括里面有好多合约的实践。 &nbsp; 目前Hydro协议已正式开源 Hydro 1.0 代码库，未来会把做点对点交易所的更多代码开源。通过 Hydro开源代码库，节点可以在Hydro 协议上开发自己的点对点化交易所(Relayer)，赋能流量入口、Dapp 部署自己的 DEX , 实现界面内无缝的原子级别币币交换（Atomic Swap）。 &nbsp; 通过Hydro协议，我们提供节点一个没有技术门槛的交易平台和一个完全的点对点的交易的整体解决方案。比如你想开一个点对点交易的交易平台，所需要的只是在阿里云、腾讯云、亚马逊云或者谷歌的数据中心买一个服务器，我们就可以给他做一个私有化部署，你就可以成为一个hydro协议上的节点，通过共享流动性来保护这个网络的强劲跟安全。作为一个hydro节点，永远都是让用户保护资金同时点对点交易。最重要的一点是APP内嵌，比如我们CSDN有一个自己的app，然后这个app是我们所有咨询平台，然后这些咨询平台会有一个tap，这个tap里面会有钱包，点对点交易的界面，这个时候在任何的app里面就会直接进行点对点的交易，依靠以太坊网络。 &nbsp; &nbsp; 热门文章 CSDN蒋涛：从产品经理到通证设计师 80%开发者都不知道的以太坊骚操作：「事件」和「日志」还可以这么玩！ 五一结束，是该活跃一下大脑了：证券型代币合法吗？ 五一出游，“我”的隐私被扒干净了 营长招人啦 CSDN区块链大本营招采编2名： 1. 对区块链技术有一定的理解，对大公司动态有极强敏感性，且有深度剖析的楞劲儿。 2. 出稿速度快，具有每天报题和出稿的能力。 3. 有能力采访行业高端人物，能将其观点进行深刻呈现。 4. 相关媒体经验2年以上。 5. 英语6级以上，能快速编译。 6. 本科以上 待遇： 绝不低于行业水平，只要有才，我们愿意给你一切资源。 邮件发送：puge@csdn.net 邮件注明：姓名+区块链+采编应聘 阅读更多","@type":"BlogPosting","url":"/2018/05/04/3d15dfc9158efef390dc48ef7b23f040.html","headline":"套利、投资、创业，从0到1打造更好的点对点交易协议","dateModified":"2018-05-04T00:00:00+08:00","datePublished":"2018-05-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/05/04/3d15dfc9158efef390dc48ef7b23f040.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>套利、投资、创业，从0到1打造更好的点对点交易协议</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <div class="rich_media_content"> 
   <blockquote>
    <p style="text-align:justify;margin-left:8px;"><strong style="text-align:justify;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">由CSDN主办，区块链大本营、EthFans、PDJ、极客帮创投协办的第7期CSDN区块链技术沙龙上，Hydro Protocol及DDEX技术负责人 David Qin带来题为《点对点交易技术与实践》的分享，从自身的区块链技术创业历程，解读以太坊上点对点交易的技术实践。</span></strong><br></p>
   </blockquote>
   <p style="text-align:left;margin-left:8px;"><br></p>
   <p style="text-align:center;margin-left:8px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIAcOTiamypFftpHJYpib14qzdrsTCNHrs0zamJicpgnykRFU2sU5hcp32w/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1" alt="640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;line-height:normal;"><span style="font-size:12px;color:rgb(136,136,136);">Hydro Protocol及DDEX点对点交易所</span></p>
   <p style="text-align:center;line-height:normal;"><span style="font-size:12px;color:rgb(136,136,136);">技术负责人 David Qin</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(136,136,136);">整理 | 王国玺</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span><span style="font-size:15px;letter-spacing:.5px;">&nbsp;</span><strong style="font-size:15px;letter-spacing:.5px;"><span style="color:rgb(251,0,7);">&nbsp;</span></strong></p>
   <p style="text-align:left;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);"><strong>一、从套利开始，发现中心化交易所的安全危机</strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:#000000;"><br></span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:#000000;"></span></strong></span></p>
   <p style="text-align:center;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIF1FlGyL4zXTT1awu2txYicZOzGrb6JmI6YFiaK6g1CYibgLAYYRicvoeJQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1" alt="640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:#000000;"></span></strong></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">从套利引擎开始，我们需要接多家交易所API，我们需要把这些单糅到一起，糅成一个引擎，从中发现一些套利的机会。什么是套利机会？我们的引擎，类似一个撮合引擎，它不停扫描当前币种，哪个地方价格最低，哪个地方价格最高，如果这两个地方不是同一交易所，刨除掉持仓风险、平仓风险、滑点概率，如果仍然有套利利润在，那我们就把这个单吃掉。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">当时市场分为两种币：公链币（比特币、以太坊）、ERC20。90%货币基本基于以太坊，比如基于ERC20的代币，所以我们选择基于ERC20开始套利。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIBh8CL0icc2U2stII3LYnkcsGicPq2weULBmeD3RZRBicc3Zib4c4aibeicbQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(251,0,7);"></span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">首先，当时没有点对点交换的概念，我们只能接中心交易所。发现资产不安全。中心交易所的本质把所有钱充值到交易所一个钱包，然后它来负责所有人的资产安全。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">当资产转移时，在数据库里给记了一笔账，比如说张三的钱给了李四，但实际在区块链上没有任何表示，只有提现时资产才真正结算。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">在套利时，因为对接是多家交易所，所以资产存在了多家交易所上，我们特别担心自己的资产。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">其次，API质量也是问题。有些交易所提供了WebAPI，但有些交易所只提供了WebSocket API。WebAPI的响应时间、质量以及变动，都会影响套利的滑点概率。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">关于充值提现速度慢的问题。好的交易所，在提币时可能两个小时就能完成提币，把仓位重新弄平，套利机制重新跑起来。但有些交易所可能两天或一周都不会放币。这里面肯定有些技术问题，比如中心交易所使用小额充值的方式，它要把币汇总后，才能给别人提币。但这不是提现时间慢的借口。问题由于中心化导致，因为权限太高。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:rgb(0,122,170);"><strong><span style="font-size:15px;letter-spacing:.5px;">二、从参与投资，发现点对点交易的创业机会</span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">套利之余，我参与了一个朋友之间组织的数字货币基金。当时主要针对的方向是数字货币，和点对点交换协议，发现了点对点交换协议后，加上底层套利逻辑，以及对中心版本的种种不满，我们发现点对点交换是强需求。我们为什么不自己做一个？就针对ERC20，只要我们支持ERC20的点对点交换，就能覆盖90%的交易币种需求。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIXGmUSTOtsvYHvB8qptpj8DjibQLeialulkYykd6Ech2rqG7b0icib3hu2Q/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">常用钱包里有卡、现金、信用卡、存折。以太坊的钱包是是系统给我们私钥，对应着一份公钥，公钥对应着一份地址。</span><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">钱包的功能仅仅是用这个私钥去产生数字签名，证明你拥有某个地址，仅此而已，其实它里面没存任何东西。</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">什么是ERC20？首先是合约，ERC20其实是个标准，凡是符合ERC20标准的代币都会支持几个接口，比如name、symbol、decimals以及用来转账和代理转账的transfer、transferFrom的接口，类似于类中的抽象类，它是一个标准。所有满足ERC20的货币，都可通过一个标准方式进行转账。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(251,0,7);">&nbsp;</span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(251,0,7);"></span></strong></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:412px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdI65wZngOoKeCSKbibOuibTwpkZklcBMpcYl3NITvRnzwXTuv7BT1xTfMg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(251,0,7);"></span></strong></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">点对点交易，可以解决中心化问题，但是，点对点交易完美吗？会有什么问题？</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">钱包与合约很繁琐。在2017年6月，市面上还没有现在这么多的钱包，只能下以太坊官方的钱包Mist，下载Mist需要同步几十G数据的节点，这样才能跑起这个钱包。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">用惯了中心化交易所的人肯定会对交易需求工具要求特别多。但在点对点交换版本里，目前只能实现一个limit order，market order还不成熟，这就是基本交易工具上的缺失。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">现在以太坊每秒钟的节点吞吐量是每秒钟20-30笔交易。这个速度意味着每交换一笔资产，都会占以太坊区块链上每秒20笔交易中的一份，所以交易速度特别慢。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">以上的种种难度决定了用户入门的门槛极高，所以没有人参与、挂买、挂卖，导致了流动性差的问题。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">EtherDelta是典型的点对点交易所。它除了满足上述的去点对点交换不足的特性外，还有些弊端，比如充值就很危险，因为钱要从钱包转到另外一个地方。The DAO事件是2016年特别典型的一个事件。因为合约出了问题，所以导致以太坊分拆，分拆成ETH和ETC。Polkadot-Multisig也出了一些问题，现在你去以太坊区块链上看，Top Accounts里面的第二页，Polkadot-Multisig锁了30万个以太坊在钱包里。原因是它所依赖的以太坊合约库被调到suicide，自己依赖的一个lib已经被kill掉，然后导致30万个以太坊永远锁在虚空中，没有人能提走。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Partiy的多签名钱包同样也出现了问题。它把一些方法代理到自己的依赖库上，包括构造函数，而构造函数是可以声明钱包主人的。由此引发了一系列的资产丢失，大概都在千万美元级别，而Polkadot可能是上亿美元级别的。所以充值是一件很危险的事。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:#000000;">&nbsp;</span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:rgb(0,122,170);"><strong><span style="font-size:15px;letter-spacing:.5px;">三、ZRX是点对点交换协议的升级版，但它还不够好</span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span><span style="font-size:15px;letter-spacing:.5px;text-indent:0em;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">链上撤单是一个特别严重的问题，会贯穿整个点对点交换，它会直接导致被front run以及没办法做市。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">经常在盘口大量的移动价格，如果撤单成本高，事情基本不可能完成。没有做事也会导致流动性差，流动性差就没有用户，没有用户就什么都转不起来，这会恶性循环。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIicLHjuzZKhP5LzicBLBxAI2mJrK0Bwr7MbHRjvg8kUCicZqJwJibo2S9ow/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">上图ZRX是点对点交换协议的升级版。它的出现给很多点对点交换带来曙光。针对需要充值的问题，ZRX解决的办法是用转账的授权来替代充值。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">首先要把资产授权给Proxy，Proxy权限很高，但逻辑很蠢，什么都不会，唯一干的就是把钱从A转到B。因为足够简单，很难出现bug，它是一个永远不会升级的东西。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Exchange封装了所有的交易逻辑、是Proxy的调用方。用户就可以通过DAPP，调用Exchange里面的函数，通过Proxy转移用户的资产，完成一个区块链的交易。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIHVvoLmIzvX4mO7qkzwib4xGnDu6xFQXgOt3F6euBuKxXIw0eTGO3rDg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(251,0,7);"></span></strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);"><strong>但是</strong><strong>ZRX</strong><strong>机制没有解决链上撤单问题，这是</strong><strong>DDEX</strong><strong>团队首先发现的：</strong></span><span style="font-size:15px;letter-spacing:.5px;color:#000000;">在ZRX的核心数据结构里有一个taker属性，这个taker属性有两种设置方法：</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;color:#000000;">1. 固定的地址；</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;color:#000000;">2. Open的地址。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;color:#000000;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">open的地址就是Open Match，Open Match意思就是单可被任何人吃，卖单时候，别人可跑在你的前面，front run的问题依然存在。然后，当你去撤销这单的时候，依然需要链上确认。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;"><span style="font-size:15px;letter-spacing:.5px;color:#000000;">DDEX采用Closed Match，taker的永远是固定的地址，这个单只有DDEX可以去taker这个单，然后取消这个单子仅需要在DDEX上把单从数据库里面撤掉，就可以去撤单，而且保证区块链没有任何人可以在你之前去take</span><strong><span style="font-size:15px;letter-spacing:.5px;color:#000000;">，</span></strong><span style="font-size:15px;letter-spacing:.5px;color:#000000;">所以说这样就完全避免了front run的问题，然后对做市商是友好的，因为做市商可以随时下单、撤单，整个过程只要这单没有被撮合，没有进入最终结算阶段，都是不消耗任何手续费，仅消耗的就是流量和数据库空间而已，跟一个普通的中心化交易下单、撤单的感觉是一样。</span></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">DDEX选用了这种权限的办法，解决了front runing的问题。但仍然有一些新的挑战。现在的0X协议使用代币来交手续费的，这事极其不合理，具体体现比如说我想完成一笔交易，我说你必须握着一些0X，这个就特别不合理。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIPwj6O1NUajJ5MuH1RHB2QzbRcWfWk84erqVD3O1nLagSlgQZ3hWJXA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">用现在的点对点交换协议，来完成一个交易所的事情仍然很困难。还要要理解什么叫Exchange里面的一个基本交易单元，了解怎么签名、下单、授权，这些事情都很繁琐。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">closed match导致单只能被自己吃，怎么才能让流动性共享起来，让更多人参与点对点交换。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span><strong style="font-size:15px;letter-spacing:.5px;text-indent:0em;">&nbsp;</strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);"><strong>四、</strong><strong>我们想要做更好的点对点交易协议——</strong><strong>Hydro</strong></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdInCQjcAc7RgdMFcA4ibeHfYsZ3ibQvwicDN39Eia4hkib6aWvpk2wFNBbsKQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">经过思考，我们决定自己设计一个协议。链下撮合，链上成交。流动性的奖励机制。为提供高流动性的个体提供奖励。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdINewcb28SKI5cyR4msStcoxXYIdbdFwDW2TmLVXUlSvGUXjaxm5dR1w/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Hydro是一个流体，类似于water、流动性。一个交易所没有流动性就永远没有人用。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIvG9tXu3jh6k9WRtoQc4JicX8hBhHMSq3JdNxlPRKdqJtgoBGHLq77dw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">这协议很抽象，但我们不想做一个抽象、不具化的东西。于是我们决定先做一家交易所，让这家交易所成为Hydro协议的第一个用户。如果把交易所做成了，才能证明这个协议可以成功，别人也会加入这个协议。顺理成章的，我们做了这家交易所叫DDEX （Decentralized Digital Exchange）。点对点交易是我们的第一版模型，经历了10周开发上线，今年1月份上线，现在已支持多个钱包。每笔交易都可以在链上看到，没有任何东西是不公开不透明的。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIuDQlPIc2QwzPEaAM0RRsZrvMQXySicMqctdyOJJJ4XAuZyLISK6yJvg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">上图我们初做的版本，现在有一些UI和功能上的迭代。架构分为三部分：DAPP、Backend、Services。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">DAPP是一个React项目。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Backend分为的API、Engine和Watcher。Engine与普通交易所的Engine有差别，不仅仅是记账，它还需要把所有用户的交易发到链上。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Watcher用来监视区块链变化，并通知其他服务。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">底层的Services会有一些基础的东西，比如说PostgreSQL、Redis和Geth Node。Geth Node是一个以太坊节点。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIwNZibAboZ5eImYGDWwRg8VNnMVjQlryWeUicar6FQTT62MOJaUCcDNhQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Watcher不能以一个结点目前的最新信息来当成判断依据，因为区块链最新的几个节点总是处于混沌状态，这也是为什么比特币的转账交易需要6个区块确认，而以太坊可能需要更多。因为以太坊的块时间更短，比如至少60个区块，资产量越大，需要确认的区块就越多。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIx4TfI8aErm3yEs6Z0B1EMfxgynnRMaB52hek7gLickefQGN3iclv2VGA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">然后Watcher将进行一系列的改变。蓝色区块是指已经确认相对久远的区块，这个虚线的区块就证明可能刚被挖出来的，这个区块可能是不太安全的区块。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">所以说我们会用刚挖出来的区块通知用户，让他感到交易运算的发生。然后用一些更久远的块来确认区块链最终的交易状态，用这些来最终决定用户的一笔交易是不是真正的发生了。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdILt4Tpkg38RDS2Wj4ibwOTaX6q0lrxBMRiafia9Qqxlyl24rSiacKFw5ticw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">由于SSR的需求，前端框架从多次切换。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">DAPP运行需要一个钱包的环境。目前的钱包有MetaMask、Mist，这些wap3钱包实现的基本上没有一个完全符合标准的，因为MetaMask它在签名的时候没有加上Ethereum的send message签名消息头。当在前端去匹配不同的钱包的时候，会有一些冲突，需要特殊处理。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIlQwlkTNt170WHdiaZZrMQWyAYdRD5GoFtMKZVLmBIoicdXLr3ApqhCGA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">后端针对之前的版本做了一些重构，从一个单人的开发模式换成Gitlab CI + docker + kubernetes来压缩运维成本。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Engine当时做了很多事情，Engine不仅要撮合交易，要落库，而且还要跟以太坊之间打交道，这个Engine的代码就会越来越耦合，所以用微服务的方式拆分逻辑，用kafka做消息队列。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Log收集是为了方便后期debug，所有的后面这些架构其实在一些通常的开发里面都是很常见的。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">五、丢失了122个以太坊后，我意识到资产安全的重要性</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdIpuialnWbxibzSOtB6X5riawbOY87WJwmZpfsOSoS1IwVx6Z60AUxbXN2g/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">安全问题很严重，由此我们也付出了一些代价。常规的安全项目，比如2018年，EtherDelta出了一些问题，他们的域名过期了，被别人买了，搭了一个一模一样的节点，然后大家把钱充进去就没了。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">去年有一个项目叫Decentraland，特别火，据我所知有无数人要抢他们的ICO，但是特别难抢。它的合约写的是当在第41万多少个区块开始，它这个合约开始接受往里面转以太坊，然后会往外转Decentraland的币叫MANA。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">这件事是不可能通过手动来完成，一是找不到好的时间点，可能很快就结束了。所以说我就决定用他们本身的代码来去抢ICO，我把我的私钥放到了一个以太坊节点上，打开了rpc的默认端口，为提前测试，我解密了私钥，我两个账号里面一个有100个以太坊，一个有22个以太坊， 10分钟以后，我的钱包里一分钱也没有了。我就开始翻etherscan上的一些消息，一个叫bruce的人就提供了一些线索，我也回忆了一下我到底都做了什么。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">以太坊钱包的节点其实相当于它会负责同步数据，如果你解锁私钥了以后，凡是能访问你节点的方式，都能去转走你的钱，这件是一个特别大的坑，我也认为这是以太坊bug，前一段我也看了一个文章在介绍这个事情。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">那如何管理好自己的以太坊节点？首先，能用内网绝对不用外网。如果说你不想给大众做一个公用节点的话，永远不要开公网，还有一个从根本上解决的办法，就是永远不要把私钥和任何私钥相关的东西存到以太坊节点上，用一个新的东西ProviderEngine，让我们的私钥永远都在我们的项目里面，自己来保护。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">所有的交易都是只要签过名之后，把签名的消息发到公网的节点上。这样的好处就是说最终的权限全留在代码里，出代码的东西都是可以见光的，这个就是在部署以太坊节点的时候的一些经验。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">六、想写自己的DAPP，我的建议是什么</span></strong></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:center;margin-left:8px;"><img class="img_loading" style="width:415px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kSokia1AtT7AjB6C4q7ficdITtfEUpaPcNchNqsiaIml7mP3PSbD4vMSL6qektGibEjHib9uNxd6LbleQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span><br></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">刚开发时候，会有一些测试的需求，还有部署合约的需求，就是很麻烦，因为当时用主网测的话太贵，用测试网来测的话太慢，然后就开始寻找各种各样的工具，然后就找到了这个Truffle。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Truffle主要提供了一套合约、部署和测试的框架，它会提供一套类似于Migration的机制，可以频繁部署更多的合约，不用操心合约部署到哪。然后在测试的时候可以写一个Contract来测试Contract，也可以用JS来测试Contract。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Ganache是一个node.js版本的以太坊虚拟机，它启动的时候会启动有10个有钱的以太坊账号，产生区块的方式也特别特殊，它的区块产生是同步的，把一笔交易发到这个测试区块上，它会严格的把这笔交易打包成一个新的区块，然后返回。这对于测试和开发极其友好。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">Ropsten几乎像素级的模拟了以太坊的官方节点，然后上面的币基本上是免费的，拿一个GTX1070挖一天，就能挖出个100币，所以它基本上可以在项目想要上线之前提供一个比较好的，相对真实的测试环境。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;"><br></span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">如果想写DAPP， smart-contract-best-practices很有参考价值。Rops比如写合约时候，什么时候开始用什么函数，在处理外部调用和内部状态时候，应该先处理外部依赖还是先处理内部的状态。在网上随便一搜就可以搜到它的官网<strong>，</strong>包括里面有好多合约的实践。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">目前Hydro协议已正式开源 Hydro 1.0 代码库，未来会把做点对点交易所的更多代码开源。通过 Hydro开源代码库，节点可以在Hydro 协议上开发自己的点对点化交易所(Relayer)，赋能流量入口、Dapp 部署自己的 DEX , 实现界面内无缝的原子级别币币交换（Atomic Swap）。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><span style="color:#000000;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;text-indent:0em;"><strong><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">通过Hydro协议，我们提供节点一个没有技术门槛的交易平台和一个完全的点对点的交易的整体解决方案。</span></strong><span style="color:#000000;font-size:15px;letter-spacing:.5px;">比如你想开一个点对点交易的交易平台，所需要的只是在阿里云、腾讯云、亚马逊云或者谷歌的数据中心买一个服务器，我们就可以给他做一个私有化部署，你就可以成为一个hydro协议上的节点，通过共享流动性来保护这个网络的强劲跟安全。作为一个hydro节点，永远都是让用户保护资金同时点对点交易。最重要的一点是APP内嵌，比如我们CSDN有一个自己的app，然后这个app是我们所有咨询平台，然后这些咨询平台会有一个tap，这个tap里面会有钱包，点对点交易的界面，这个时候在任何的app里面就会直接进行点对点的交易，依靠以太坊网络。</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="color:rgb(62,62,62);background:#FFFFFF;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="text-align:justify;margin-left:8px;line-height:1.75em;"><span style="color:rgb(62,62,62);background:#FFFFFF;font-size:15px;letter-spacing:.5px;">&nbsp;</span></p>
   <p style="line-height:22px;font-size:18px;"><span style="letter-spacing:.5px;">热门文章</span></p>
   <p><br></p>
   <p><br></p>
   <ul class="list-paddingleft-2" style="margin-left:8px;">
    <li><p><span style="font-size:15px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247486078&amp;idx=2&amp;sn=2a072c23583d678730411b9cb4920655&amp;chksm=fc7c5483cb0bdd95ced2b598be865263598cd2a04dfbc279871a3eb70eadd8848a1b3efe6401&amp;scene=21#wechat_redirect" rel="nofollow">CSDN蒋涛：从产品经理到通证设计师</a></span></p></li>
    <li><p><span style="font-size:15px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247486061&amp;idx=1&amp;sn=95dd2099579617a6356855ba17a9ad4a&amp;chksm=fc7c5490cb0bdd860da0ae8cdf95e580a570262ab107891e9e158dfb1c1b2d1ea91b15d983c1&amp;scene=21#wechat_redirect" rel="nofollow">80%开发者都不知道的以太坊骚操作：「事件」和「日志」还可以这么玩！</a></span><br></p></li>
    <li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247486036&amp;idx=1&amp;sn=3f2c35d5d8df21f211a0d669cdd7e923&amp;chksm=fc7c54a9cb0bddbf00153f505e8f46b01f0c250e6cc7a9d4be16b8e00c409c1dcb35142aa6d5&amp;mpshare=1&amp;scene=21&amp;srcid=0502mPgKrkCC0CMnSXasm1pG&amp;key=f4a3d578d71832a2959774eb68b7842beae2e2da7f5b1b862ed93b8bc455ba4a4cc33ae9c6ad27bd03e2d8a1fd89c05994726c1331a7b007c70e918bc4f034f66d1eb78344fd4b808cb5a3a5979c3158&amp;ascene=0&amp;uin=MjQ0ODA5ODUwMQ==&amp;devicetype=iMac%20MacBookAir7,2%20OSX%20OSX%2010.12.4%20build(16E195)&amp;version=11020201&amp;lang=zh_CN&amp;pass_ticket=M6DVIvxD4uqyhHtxoW4M4B6fTwhScvhpGgJEoX08Z4vqHA07s0jZTQoiPOSV/liO#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:15px;">五一结束，是该活跃一下大脑了：证券型代币合法吗？</span></a><br></p></li>
    <li><p><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247486024&amp;idx=1&amp;sn=f85eb25e63e173eccd768deeb247f999&amp;chksm=fc7c54b5cb0bdda372f8c3b80137e885ec6aa84fae507d6fe4fb9a4ff98b881a3ee972f78dfc&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:15px;">五一出游，“我”的隐私被扒干净了</a></p></li>
   </ul>
   <p><br></p>
   <p><br></p>
   <p><img class="__bg_gif img_loading" style="margin-left:auto;width:558px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9m9HsNlmyk04zcwv28mjS39KU4UkntEhV4mp0b9fYrFwrTqhUT7KtalmiaZCgn86xrRETpzBP5BOrA/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
   <p><br></p>
   <p><br></p>
   <p style="margin-left:8px;border-style:none;line-height:1.4;"><br></p>
   <span style="font-size:18px;color:rgb(0,122,170);"><strong>营长招人啦</strong></span>
   <p><br></p>
   <p style="margin-left:8px;"><span style="font-size:15px;"></span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><strong><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">CSDN区块链大本营招采编2名：</span></strong></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">1. 对区块链技术有一定的理解，对大公司动态有极强敏感性，且有深度剖析的楞劲儿。</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">2. 出稿速度快，具有每天报题和出稿的能力。</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">3. 有能力采访行业高端人物，能将其观点进行深刻呈现。</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">4. 相关媒体经验2年以上。</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">5. 英语6级以上，能快速编译。</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">6. 本科以上</span></p>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><strong><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">待遇：</span></strong></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">绝不低于行业水平，只要有才，我们愿意给你一切资源。</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">邮件发送：</span><span style="font-size:15px;letter-spacing:.5px;color:rgb(0,122,170);">puge@csdn.net</span></p>
   <p style="margin-left:8px;line-height:1.75em;text-align:justify;"><span style="font-size:15px;color:rgb(63,63,63);letter-spacing:.5px;">邮件注明：姓名+区块链+采编应聘</span></p>
  </div> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/80202956,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/80202956,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

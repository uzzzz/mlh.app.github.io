<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊分析之 以太坊网络 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊分析之 以太坊网络" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="以太坊介绍 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊（Ethereum）是一个建立在区块链技术之上，去中心化应用平台。它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。 &nbsp; 以太坊网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊区块链的基础是参与节点的点对点网络，以太坊节点加入到以太坊网络形成去中心化的共识系统。以太坊网络有以下几种： 生产环境网络: 以太坊的生产网络顾名思义，也就是产生真正有价值的&nbsp;的以太币的网络。目前生产网络目前已经生成了300万以上的区块，还在持续生成中。 测试网络: 以太坊的测试网络也是官方提供的，顾名思义就是专供用户来开发、调试和测试的。上面的合约执行不消耗真实的以太币。 私有网络：以太坊的私有网络，顾名思义就是由用户自己创建的私有网络。 &nbsp; &nbsp; 生产环境网络对应的是以太坊共有链，私有网络对应的是以太坊私有链或联盟链， 公有链：世界上所有人都可以阅读和发送交易，世界上任何人都能参与到共识形成过程——决定在链条上添加什么区块以及现状是怎样的。公有链受加密经济的保护，用类似工作量证明或权益证明的机制。这类区块链通常被认为是&quot;完全去中心化&quot;。 联盟链：共识形成过程由预先选择的一系列的节点所掌控，例如，设想一个有15个金融机构的团体，每个机构都操作一个节点，为了使区块生效，其中的10个必须签署那个区块。这类区块链被认为是&quot;部分去中心化&quot;。 私有链： 只限于私人或者私有组织连接。 &nbsp; Geth &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Geth是Go Ethereum开源项目的简称，它是使用Go语言编写且实现了Ethereum协议的客户端软件，也是目前用户最多，使用最广泛的客户端。通过Geth客户端与以太坊网络进行连接和交互可以实现账户管理、合约部署、挖矿等众多有趣且实用的功能。 Geth的安装方法： $ gitclone https://github.com/ethereum/go-ethereum.git $ cd go-ethereum $ git checkout v1.7.2 $ make geth $ make all$ cp ./build/bin/geth/usr/bin &nbsp; 安装成功后执行： $ geth version Geth Version: 1.7.2-stable Git Commit: 1db4ecdc0b9e828ff65777fb466fc7c1d04e0de9 Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 &nbsp; &nbsp; 搭建以太坊私有网络 1.初始化一个创世区块 初始化创世区块时，要先创建一个genesis.json文件， genesis.json： { &nbsp;&nbsp;&nbsp;&nbsp; &quot;config&quot;: { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;chainId&quot;: 10, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;homesteadBlock&quot;: 0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;eip155Block&quot;: 0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;eip158Block&quot;: 0 &nbsp;&nbsp;&nbsp;&nbsp; }, &nbsp;&nbsp;&nbsp;&nbsp; &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;difficulty&quot;: &quot;0x20000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;extraData&quot;: &quot;&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;: &quot;0x2fefd8&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;nonce&quot;: &quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;timestamp&quot;: &quot;0x00&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;alloc&quot;: {} } mixhash&nbsp;&nbsp; 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 nonce&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty&nbsp;&nbsp; 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase&nbsp; 矿工的账号，随便填 timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设置创世块的时间戳 parentHash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上一个区块的hash值，因为是创世块，所以这个值是0 extraData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 附加信息，随便填，可以填你的个性信息 gasLimit&nbsp;&nbsp; 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 然后进行创世区块的初始化： $ geth init ./genesis.json --datadir ./chain WARN [05-22|11:16:36] No etherbase set and no accounts found as default INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/chaindata cache=16 handles=16 INFO [05-22|11:16:36] Writing custom genesis block INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=chaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0 INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/lightchaindata cache=16 handles=16 INFO [05-22|11:16:36] Writing custom genesis block INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=lightchaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0 &nbsp; 2.启动私有网络 执行命令，其中参数nodiscover表示私有链地址，不会被网上看到，命令congsole表示同时会启动Geth的JavaScript控制台 $ geth --datadir ./chain --nodiscover console 2&gt;&gt;eth_output.log Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.2-stable-1db4ecdc/linux-amd64/go1.9.2 &nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &nbsp; &gt;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 启动Geth的控制台后就可以进行操作，Geth的控制台是JavaScript开发的，实现了web3.jsAPI。web3.js 是一个通过RPC 调用&nbsp;和本地以太坊节点进行通信的js库。web3.js可以与任何暴露了RPC接口的以太坊节点连接。web3中提供了eth对象 - web3.eth来与以太坊区块链进行交互。 &nbsp; 备注： web3 API =》 http://web3js.readthedocs.io/en/1.0/index.html 中文版：http://web3.tryblockchain.org/Web3.js-api-refrence.html#toc_22 &nbsp; 账户 创建帐户： &gt; &nbsp;web3.personal.newAccount(&quot;password&quot;) &quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot; 返回的字符串就是账户 &nbsp; 查询账户： &gt;&nbsp; web3.eth.accounts [&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;] &nbsp; 挖矿 挖矿执行以下命令： &gt;&nbsp; miner.start(1) null &nbsp; 执行成功后，控制台范围null，通过日志可以看到已经在进行挖矿： $ tailf eth_output.log INFO [05-22|13:17:36] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60 INFO [05-22|13:17:36]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60 INFO [05-22|13:17:36] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 txs=0 uncles=0 elapsed=163.749µs INFO [05-22|13:17:37] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3 INFO [05-22|13:17:37]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3 INFO [05-22|13:17:37] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 txs=0 uncles=0 elapsed=241.586µs INFO [05-22|13:17:39] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004 INFO [05-22|13:17:39]  block reached canonical chain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=1 hash=377d55…8d0308 INFO [05-22|13:17:39]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004 INFO [05-22|13:17:39] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=7 txs=0 uncles=0 elapsed=155.252µs &nbsp; 如果要停止挖矿的话，可以执行命令： &gt;&nbsp; miner.stop() null &nbsp; 备注：停止挖矿后，以太币则不会产生，同样智能合约、转帐等操作也不会起作用。 &nbsp; 账户余额 执行挖矿后，挖矿产生的以太币会默认保持到创建的第一个账户（也就是0xb518124a8e586b18cb16bf4a6a74b376f48db2cd），我们可以查询账户余额： &gt;&nbsp; web3.eth.getBalance(&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;) 555000000000000000000 &nbsp; #查看格式化的以太币 &gt;&nbsp; web3.fromWei(web3.eth.getBalance(&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;)) 555 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为GethJavascript Console是基于Javascript的，所以也可以创建js函数，查看所有帐户余额: &gt; function checkAllBalances() { ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var totalBal = 0; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var acctNum in eth.accounts) { ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acct = eth.accounts[acctNum]; ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acctBal = web3.fromWei(eth.getBalance(acct), &quot;ether&quot;); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; totalBal += parseFloat(acctBal); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&quot;&nbsp; eth.accounts[&quot; + acctNum + &quot;]: \t&quot; + acct + &quot; \tbalance: &quot; + acctBal + &quot; ether&quot;); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&quot;&nbsp; Total balance: &quot; + totalBal + &quot; ether&quot;); ...&nbsp; }; &gt; checkAllBalances() &nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp; balance: 715 ether &nbsp; Total balance: 715 ether &nbsp; 转账 转账至少需要2个账户，所以首先再创建一个账户： &gt; &nbsp;web3.personal.newAccount(&quot;password&quot;) &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot; &gt; &nbsp;web3.eth.accounts [&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;, &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot;] &nbsp; 支持操作账户字符串比较麻烦，可以复制给变量： &gt; &nbsp;account0 = web3.eth.accounts[0] &quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot; &gt; &nbsp;account1 = web3.eth.accounts[1] &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot; 然后从账户1转账给账户2，注意转账前需要先解锁被转账的账户： &gt; &nbsp;web3.personal.unlockAccount(account0,&quot;password&quot;) true &nbsp; &gt;&nbsp; web3.eth.sendTransaction({from:account0,to:account1,value:web3.toWei(3,&quot;ether&quot;)}) &quot;0xd9f95d44de1f4858f23f9e326859713a527922498955cf84eb8bb75296b35fd6&quot; &nbsp; 查询账户余额： &gt; &nbsp;checkAllBalances() &nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balance: 1832 ether &nbsp; eth.accounts[1]: &nbsp;&nbsp;&nbsp;&nbsp; 0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75 &nbsp; balance: 3 ether &nbsp; Total balance: 1835 ether &nbsp; &nbsp; &nbsp; 可以到账户2的余额正是3 ether，说明转账成功。如果把挖矿命令停了以后，再进行转账的话将不会成功。 &nbsp; 连接以太网测试网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊是一个去中心化的平台，往往需要较多节点共同运作才能得到理想的测试效果，搭建私有网络比较难构建多节点，所以可以连接以太网提供的测试网络，以太坊公开的测试网络共有4个，目前仍在运行的有3个。每个网络都有自己的创世区块和名字，按开始运行时间的早晚，依次为： Morden(已退役) Morden是以太坊官方提供的测试网络，自2015年7月开始运行。到2016年11月时，由于难度炸弹已经严重影响出块速度，不得不退役，重新开启一条新的区块链。Morden的共识机制为PoW。 Ropsten https://ropsten.etherscan.io/ Ropsten也是以太坊官方提供的测试网络，是为了解决Morden难度炸弹问题而重新启动的一条区块链，目前仍在运行，共识机制为PoW。测试网络上的以太币并无实际价值，因此Ropsten的挖矿难度很低，目前在755M左右，仅仅只有主网络的0.07%。这样低的难度一方面使一台普通笔记本电脑的CPU也可以挖出区块，获得测试网络上的以太币，方便开发人员测试软件，但是却不能阻止攻击。 Kovan https://kovan.etherscan.io/ 为了解决测试网络中PoW共识机制的问题，以太坊钱包Parity的开发团队发起了一个新的测试网络Kovan。Kovan使用了权威证明(Proof-of-Authority)的共识机制，简称PoA。 Kovan目前仍在运行，但仅有Parity钱包客户端可以使用这个测试网络。 Rinkeby https://rinkeby.etherscan.io/ Rinkeby也是以太坊官方提供的测试网络，使用PoA共识机制。与Kovan不同，以太坊团队提供了Rinkeby的PoA共识机制说明文档，理论上任何以太坊钱包都可以根据这个说明文档，支持Rinkeby测试网络，目前Rinkeby已经开始运行。 目前开发人员最常用的测试网络是Rinkeby，本文说明连接到Rinkeby 连接Rinkeby测试网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用Geth连接到Rinkeby测试网络，加上参数--rinkeby,或者指定--networkid=4(1=Frontier, 2=Morden (disused),3=Ropsten, 4=Rinkeby)。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为连接测试网络就需要同步区块链数据，Geth的参数可以指定--syncmode来设置同步模块： full&nbsp;模式，从开始到结束，获取区块的header，获取区块的body，从创始块开始校验每一个元素，需要下载所有区块数据信息。速度最慢，但是能获取到所有的历史数据。 fast模式，获取区块的header，获取区块的body，在同步到当前块之前不处理任何事务。然后获得一个快照，此后，像full节点一样进行后面的同步操作。这种方法用得最多，目的在不要在意历史数据，将历史数据按照快照的方式，不逐一验证，沿着区块下载最近数据库中的交易，有可能丢失历史数据。此方法可能会对历史数据有部分丢失，但是不影响今后的使用。 light模式，仅获取当前状态。验证元素需要向full节点发起相应的请求。 &nbsp; 本文采用ligth模式进行同步Rinkeyby测试网络： $&nbsp; geth --datadir ./rinkeby_light \ --rinkeby \ --syncmode light \ --rpc console 2&gt;eth_rinkeby_out.log &nbsp; 同步需要花点时间，同步情况可以通过web3.eth.syncing查询： &gt; &nbsp;web3.eth.syncing { &nbsp; currentBlock: 168256,&nbsp;&nbsp; //已经同步的区块数 &nbsp;&nbsp;highestBlock: 2331548,&nbsp; //总共的区块数 &nbsp; knownStates: 0, &nbsp; pulledStates: 0, &nbsp; startingBlock: 74688 } &nbsp;当web3.eth.syncing返回false说明同步完成，要等同步完成后才能进行账户余额查询和转账的操作 使用以太坊测试网络同样需要创建账号： &gt;&nbsp; web3.personal.newAccount(&quot;password&quot;) &quot;0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf&quot; &nbsp; 申请Rinkeby以太币 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rinkeby测试网络使用的是PoA共识机制，我们不能通过挖矿来获取以太币。想获取Rinkeby测试网络中的以太币，需要去申请，这个申请Rinkeby以太币的功能被称为水龙头(Faucet)，水龙头会源源不断的产生以太币，并且受到权威节点控制，以确保不会被滥用。 水龙头网站：https://www.rinkeby.io/#faucet &nbsp; 获取方法：有三种在推特、脸书、google+等上发布消息，并将消息的网址粘贴到上面截图的输入框中选个获取就可以。本文采用google+的方式，在google+发布一条消息，消息内容就是你的账号： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 然后将这个消息的连接输入到水龙头网站的输入框，并点击“Give me Ether”，有三种选项，前面是获得的以太币数量，后面是冷却时间，在冷却时间过后才能进行下一次以太币申请。例如第一项是生成3个以太币，8小时后才能再次申请。本文选择的就是第一项3个以太币。 &nbsp; 申请成功后，可以在https://rinkeby.etherscan.io查到转账记录： https://rinkeby.etherscan.io/tx/0x2caf8eb8e6b90a4577c80ff17165e36cdf3a9f8d71bba25539a2fc5af5814144 &nbsp; 然后我们查询账户余额，可以查询到是3000000000000000000Wei=3以太币 &gt; &nbsp;web3.eth.getBalance(&quot;0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf&quot;) 3000000000000000000 &nbsp; &nbsp; 参考 https://blog.csdn.net/ethchinese/article/details/62220851 https://www.cnblogs.com/lion.net/p/7809862.html http://wiki.jikexueyuan.com/project/ethereum/public-chain-chain.html https://zhuanlan.zhihu.com/p/29010231 作者简介 吴龙辉，《Kubernetes实战》作者，活跃于技术开源社区，贡献代码和撰写技术文档。&nbsp; 邮箱： wlh6666@qq.com 阅读更多" />
<meta property="og:description" content="以太坊介绍 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊（Ethereum）是一个建立在区块链技术之上，去中心化应用平台。它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。 &nbsp; 以太坊网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊区块链的基础是参与节点的点对点网络，以太坊节点加入到以太坊网络形成去中心化的共识系统。以太坊网络有以下几种： 生产环境网络: 以太坊的生产网络顾名思义，也就是产生真正有价值的&nbsp;的以太币的网络。目前生产网络目前已经生成了300万以上的区块，还在持续生成中。 测试网络: 以太坊的测试网络也是官方提供的，顾名思义就是专供用户来开发、调试和测试的。上面的合约执行不消耗真实的以太币。 私有网络：以太坊的私有网络，顾名思义就是由用户自己创建的私有网络。 &nbsp; &nbsp; 生产环境网络对应的是以太坊共有链，私有网络对应的是以太坊私有链或联盟链， 公有链：世界上所有人都可以阅读和发送交易，世界上任何人都能参与到共识形成过程——决定在链条上添加什么区块以及现状是怎样的。公有链受加密经济的保护，用类似工作量证明或权益证明的机制。这类区块链通常被认为是&quot;完全去中心化&quot;。 联盟链：共识形成过程由预先选择的一系列的节点所掌控，例如，设想一个有15个金融机构的团体，每个机构都操作一个节点，为了使区块生效，其中的10个必须签署那个区块。这类区块链被认为是&quot;部分去中心化&quot;。 私有链： 只限于私人或者私有组织连接。 &nbsp; Geth &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Geth是Go Ethereum开源项目的简称，它是使用Go语言编写且实现了Ethereum协议的客户端软件，也是目前用户最多，使用最广泛的客户端。通过Geth客户端与以太坊网络进行连接和交互可以实现账户管理、合约部署、挖矿等众多有趣且实用的功能。 Geth的安装方法： $ gitclone https://github.com/ethereum/go-ethereum.git $ cd go-ethereum $ git checkout v1.7.2 $ make geth $ make all$ cp ./build/bin/geth/usr/bin &nbsp; 安装成功后执行： $ geth version Geth Version: 1.7.2-stable Git Commit: 1db4ecdc0b9e828ff65777fb466fc7c1d04e0de9 Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 &nbsp; &nbsp; 搭建以太坊私有网络 1.初始化一个创世区块 初始化创世区块时，要先创建一个genesis.json文件， genesis.json： { &nbsp;&nbsp;&nbsp;&nbsp; &quot;config&quot;: { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;chainId&quot;: 10, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;homesteadBlock&quot;: 0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;eip155Block&quot;: 0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;eip158Block&quot;: 0 &nbsp;&nbsp;&nbsp;&nbsp; }, &nbsp;&nbsp;&nbsp;&nbsp; &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;difficulty&quot;: &quot;0x20000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;extraData&quot;: &quot;&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;: &quot;0x2fefd8&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;nonce&quot;: &quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;timestamp&quot;: &quot;0x00&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;alloc&quot;: {} } mixhash&nbsp;&nbsp; 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 nonce&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty&nbsp;&nbsp; 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase&nbsp; 矿工的账号，随便填 timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设置创世块的时间戳 parentHash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上一个区块的hash值，因为是创世块，所以这个值是0 extraData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 附加信息，随便填，可以填你的个性信息 gasLimit&nbsp;&nbsp; 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 然后进行创世区块的初始化： $ geth init ./genesis.json --datadir ./chain WARN [05-22|11:16:36] No etherbase set and no accounts found as default INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/chaindata cache=16 handles=16 INFO [05-22|11:16:36] Writing custom genesis block INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=chaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0 INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/lightchaindata cache=16 handles=16 INFO [05-22|11:16:36] Writing custom genesis block INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=lightchaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0 &nbsp; 2.启动私有网络 执行命令，其中参数nodiscover表示私有链地址，不会被网上看到，命令congsole表示同时会启动Geth的JavaScript控制台 $ geth --datadir ./chain --nodiscover console 2&gt;&gt;eth_output.log Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.2-stable-1db4ecdc/linux-amd64/go1.9.2 &nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &nbsp; &gt;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 启动Geth的控制台后就可以进行操作，Geth的控制台是JavaScript开发的，实现了web3.jsAPI。web3.js 是一个通过RPC 调用&nbsp;和本地以太坊节点进行通信的js库。web3.js可以与任何暴露了RPC接口的以太坊节点连接。web3中提供了eth对象 - web3.eth来与以太坊区块链进行交互。 &nbsp; 备注： web3 API =》 http://web3js.readthedocs.io/en/1.0/index.html 中文版：http://web3.tryblockchain.org/Web3.js-api-refrence.html#toc_22 &nbsp; 账户 创建帐户： &gt; &nbsp;web3.personal.newAccount(&quot;password&quot;) &quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot; 返回的字符串就是账户 &nbsp; 查询账户： &gt;&nbsp; web3.eth.accounts [&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;] &nbsp; 挖矿 挖矿执行以下命令： &gt;&nbsp; miner.start(1) null &nbsp; 执行成功后，控制台范围null，通过日志可以看到已经在进行挖矿： $ tailf eth_output.log INFO [05-22|13:17:36] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60 INFO [05-22|13:17:36]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60 INFO [05-22|13:17:36] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 txs=0 uncles=0 elapsed=163.749µs INFO [05-22|13:17:37] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3 INFO [05-22|13:17:37]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3 INFO [05-22|13:17:37] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 txs=0 uncles=0 elapsed=241.586µs INFO [05-22|13:17:39] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004 INFO [05-22|13:17:39]  block reached canonical chain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=1 hash=377d55…8d0308 INFO [05-22|13:17:39]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004 INFO [05-22|13:17:39] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=7 txs=0 uncles=0 elapsed=155.252µs &nbsp; 如果要停止挖矿的话，可以执行命令： &gt;&nbsp; miner.stop() null &nbsp; 备注：停止挖矿后，以太币则不会产生，同样智能合约、转帐等操作也不会起作用。 &nbsp; 账户余额 执行挖矿后，挖矿产生的以太币会默认保持到创建的第一个账户（也就是0xb518124a8e586b18cb16bf4a6a74b376f48db2cd），我们可以查询账户余额： &gt;&nbsp; web3.eth.getBalance(&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;) 555000000000000000000 &nbsp; #查看格式化的以太币 &gt;&nbsp; web3.fromWei(web3.eth.getBalance(&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;)) 555 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为GethJavascript Console是基于Javascript的，所以也可以创建js函数，查看所有帐户余额: &gt; function checkAllBalances() { ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var totalBal = 0; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var acctNum in eth.accounts) { ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acct = eth.accounts[acctNum]; ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acctBal = web3.fromWei(eth.getBalance(acct), &quot;ether&quot;); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; totalBal += parseFloat(acctBal); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&quot;&nbsp; eth.accounts[&quot; + acctNum + &quot;]: \t&quot; + acct + &quot; \tbalance: &quot; + acctBal + &quot; ether&quot;); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&quot;&nbsp; Total balance: &quot; + totalBal + &quot; ether&quot;); ...&nbsp; }; &gt; checkAllBalances() &nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp; balance: 715 ether &nbsp; Total balance: 715 ether &nbsp; 转账 转账至少需要2个账户，所以首先再创建一个账户： &gt; &nbsp;web3.personal.newAccount(&quot;password&quot;) &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot; &gt; &nbsp;web3.eth.accounts [&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;, &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot;] &nbsp; 支持操作账户字符串比较麻烦，可以复制给变量： &gt; &nbsp;account0 = web3.eth.accounts[0] &quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot; &gt; &nbsp;account1 = web3.eth.accounts[1] &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot; 然后从账户1转账给账户2，注意转账前需要先解锁被转账的账户： &gt; &nbsp;web3.personal.unlockAccount(account0,&quot;password&quot;) true &nbsp; &gt;&nbsp; web3.eth.sendTransaction({from:account0,to:account1,value:web3.toWei(3,&quot;ether&quot;)}) &quot;0xd9f95d44de1f4858f23f9e326859713a527922498955cf84eb8bb75296b35fd6&quot; &nbsp; 查询账户余额： &gt; &nbsp;checkAllBalances() &nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balance: 1832 ether &nbsp; eth.accounts[1]: &nbsp;&nbsp;&nbsp;&nbsp; 0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75 &nbsp; balance: 3 ether &nbsp; Total balance: 1835 ether &nbsp; &nbsp; &nbsp; 可以到账户2的余额正是3 ether，说明转账成功。如果把挖矿命令停了以后，再进行转账的话将不会成功。 &nbsp; 连接以太网测试网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊是一个去中心化的平台，往往需要较多节点共同运作才能得到理想的测试效果，搭建私有网络比较难构建多节点，所以可以连接以太网提供的测试网络，以太坊公开的测试网络共有4个，目前仍在运行的有3个。每个网络都有自己的创世区块和名字，按开始运行时间的早晚，依次为： Morden(已退役) Morden是以太坊官方提供的测试网络，自2015年7月开始运行。到2016年11月时，由于难度炸弹已经严重影响出块速度，不得不退役，重新开启一条新的区块链。Morden的共识机制为PoW。 Ropsten https://ropsten.etherscan.io/ Ropsten也是以太坊官方提供的测试网络，是为了解决Morden难度炸弹问题而重新启动的一条区块链，目前仍在运行，共识机制为PoW。测试网络上的以太币并无实际价值，因此Ropsten的挖矿难度很低，目前在755M左右，仅仅只有主网络的0.07%。这样低的难度一方面使一台普通笔记本电脑的CPU也可以挖出区块，获得测试网络上的以太币，方便开发人员测试软件，但是却不能阻止攻击。 Kovan https://kovan.etherscan.io/ 为了解决测试网络中PoW共识机制的问题，以太坊钱包Parity的开发团队发起了一个新的测试网络Kovan。Kovan使用了权威证明(Proof-of-Authority)的共识机制，简称PoA。 Kovan目前仍在运行，但仅有Parity钱包客户端可以使用这个测试网络。 Rinkeby https://rinkeby.etherscan.io/ Rinkeby也是以太坊官方提供的测试网络，使用PoA共识机制。与Kovan不同，以太坊团队提供了Rinkeby的PoA共识机制说明文档，理论上任何以太坊钱包都可以根据这个说明文档，支持Rinkeby测试网络，目前Rinkeby已经开始运行。 目前开发人员最常用的测试网络是Rinkeby，本文说明连接到Rinkeby 连接Rinkeby测试网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用Geth连接到Rinkeby测试网络，加上参数--rinkeby,或者指定--networkid=4(1=Frontier, 2=Morden (disused),3=Ropsten, 4=Rinkeby)。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为连接测试网络就需要同步区块链数据，Geth的参数可以指定--syncmode来设置同步模块： full&nbsp;模式，从开始到结束，获取区块的header，获取区块的body，从创始块开始校验每一个元素，需要下载所有区块数据信息。速度最慢，但是能获取到所有的历史数据。 fast模式，获取区块的header，获取区块的body，在同步到当前块之前不处理任何事务。然后获得一个快照，此后，像full节点一样进行后面的同步操作。这种方法用得最多，目的在不要在意历史数据，将历史数据按照快照的方式，不逐一验证，沿着区块下载最近数据库中的交易，有可能丢失历史数据。此方法可能会对历史数据有部分丢失，但是不影响今后的使用。 light模式，仅获取当前状态。验证元素需要向full节点发起相应的请求。 &nbsp; 本文采用ligth模式进行同步Rinkeyby测试网络： $&nbsp; geth --datadir ./rinkeby_light \ --rinkeby \ --syncmode light \ --rpc console 2&gt;eth_rinkeby_out.log &nbsp; 同步需要花点时间，同步情况可以通过web3.eth.syncing查询： &gt; &nbsp;web3.eth.syncing { &nbsp; currentBlock: 168256,&nbsp;&nbsp; //已经同步的区块数 &nbsp;&nbsp;highestBlock: 2331548,&nbsp; //总共的区块数 &nbsp; knownStates: 0, &nbsp; pulledStates: 0, &nbsp; startingBlock: 74688 } &nbsp;当web3.eth.syncing返回false说明同步完成，要等同步完成后才能进行账户余额查询和转账的操作 使用以太坊测试网络同样需要创建账号： &gt;&nbsp; web3.personal.newAccount(&quot;password&quot;) &quot;0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf&quot; &nbsp; 申请Rinkeby以太币 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rinkeby测试网络使用的是PoA共识机制，我们不能通过挖矿来获取以太币。想获取Rinkeby测试网络中的以太币，需要去申请，这个申请Rinkeby以太币的功能被称为水龙头(Faucet)，水龙头会源源不断的产生以太币，并且受到权威节点控制，以确保不会被滥用。 水龙头网站：https://www.rinkeby.io/#faucet &nbsp; 获取方法：有三种在推特、脸书、google+等上发布消息，并将消息的网址粘贴到上面截图的输入框中选个获取就可以。本文采用google+的方式，在google+发布一条消息，消息内容就是你的账号： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 然后将这个消息的连接输入到水龙头网站的输入框，并点击“Give me Ether”，有三种选项，前面是获得的以太币数量，后面是冷却时间，在冷却时间过后才能进行下一次以太币申请。例如第一项是生成3个以太币，8小时后才能再次申请。本文选择的就是第一项3个以太币。 &nbsp; 申请成功后，可以在https://rinkeby.etherscan.io查到转账记录： https://rinkeby.etherscan.io/tx/0x2caf8eb8e6b90a4577c80ff17165e36cdf3a9f8d71bba25539a2fc5af5814144 &nbsp; 然后我们查询账户余额，可以查询到是3000000000000000000Wei=3以太币 &gt; &nbsp;web3.eth.getBalance(&quot;0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf&quot;) 3000000000000000000 &nbsp; &nbsp; 参考 https://blog.csdn.net/ethchinese/article/details/62220851 https://www.cnblogs.com/lion.net/p/7809862.html http://wiki.jikexueyuan.com/project/ethereum/public-chain-chain.html https://zhuanlan.zhihu.com/p/29010231 作者简介 吴龙辉，《Kubernetes实战》作者，活跃于技术开源社区，贡献代码和撰写技术文档。&nbsp; 邮箱： wlh6666@qq.com 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/05/23/1bad3eabe061c992166d205795f33533.html" />
<meta property="og:url" content="https://mlh.app/2018/05/23/1bad3eabe061c992166d205795f33533.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-23T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"以太坊介绍 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊（Ethereum）是一个建立在区块链技术之上，去中心化应用平台。它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。 &nbsp; 以太坊网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊区块链的基础是参与节点的点对点网络，以太坊节点加入到以太坊网络形成去中心化的共识系统。以太坊网络有以下几种： 生产环境网络: 以太坊的生产网络顾名思义，也就是产生真正有价值的&nbsp;的以太币的网络。目前生产网络目前已经生成了300万以上的区块，还在持续生成中。 测试网络: 以太坊的测试网络也是官方提供的，顾名思义就是专供用户来开发、调试和测试的。上面的合约执行不消耗真实的以太币。 私有网络：以太坊的私有网络，顾名思义就是由用户自己创建的私有网络。 &nbsp; &nbsp; 生产环境网络对应的是以太坊共有链，私有网络对应的是以太坊私有链或联盟链， 公有链：世界上所有人都可以阅读和发送交易，世界上任何人都能参与到共识形成过程——决定在链条上添加什么区块以及现状是怎样的。公有链受加密经济的保护，用类似工作量证明或权益证明的机制。这类区块链通常被认为是&quot;完全去中心化&quot;。 联盟链：共识形成过程由预先选择的一系列的节点所掌控，例如，设想一个有15个金融机构的团体，每个机构都操作一个节点，为了使区块生效，其中的10个必须签署那个区块。这类区块链被认为是&quot;部分去中心化&quot;。 私有链： 只限于私人或者私有组织连接。 &nbsp; Geth &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Geth是Go Ethereum开源项目的简称，它是使用Go语言编写且实现了Ethereum协议的客户端软件，也是目前用户最多，使用最广泛的客户端。通过Geth客户端与以太坊网络进行连接和交互可以实现账户管理、合约部署、挖矿等众多有趣且实用的功能。 Geth的安装方法： $ gitclone https://github.com/ethereum/go-ethereum.git $ cd go-ethereum $ git checkout v1.7.2 $ make geth $ make all$ cp ./build/bin/geth/usr/bin &nbsp; 安装成功后执行： $ geth version Geth Version: 1.7.2-stable Git Commit: 1db4ecdc0b9e828ff65777fb466fc7c1d04e0de9 Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 &nbsp; &nbsp; 搭建以太坊私有网络 1.初始化一个创世区块 初始化创世区块时，要先创建一个genesis.json文件， genesis.json： { &nbsp;&nbsp;&nbsp;&nbsp; &quot;config&quot;: { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;chainId&quot;: 10, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;homesteadBlock&quot;: 0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;eip155Block&quot;: 0, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;eip158Block&quot;: 0 &nbsp;&nbsp;&nbsp;&nbsp; }, &nbsp;&nbsp;&nbsp;&nbsp; &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;difficulty&quot;: &quot;0x20000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;extraData&quot;: &quot;&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;: &quot;0x2fefd8&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;nonce&quot;: &quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;timestamp&quot;: &quot;0x00&quot;, &nbsp;&nbsp;&nbsp;&nbsp; &quot;alloc&quot;: {} } mixhash&nbsp;&nbsp; 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 nonce&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty&nbsp;&nbsp; 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase&nbsp; 矿工的账号，随便填 timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设置创世块的时间戳 parentHash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上一个区块的hash值，因为是创世块，所以这个值是0 extraData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 附加信息，随便填，可以填你的个性信息 gasLimit&nbsp;&nbsp; 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 然后进行创世区块的初始化： $ geth init ./genesis.json --datadir ./chain WARN [05-22|11:16:36] No etherbase set and no accounts found as default INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/chaindata cache=16 handles=16 INFO [05-22|11:16:36] Writing custom genesis block INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=chaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0 INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/lightchaindata cache=16 handles=16 INFO [05-22|11:16:36] Writing custom genesis block INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=lightchaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0 &nbsp; 2.启动私有网络 执行命令，其中参数nodiscover表示私有链地址，不会被网上看到，命令congsole表示同时会启动Geth的JavaScript控制台 $ geth --datadir ./chain --nodiscover console 2&gt;&gt;eth_output.log Welcome to the Geth JavaScript console! &nbsp; instance: Geth/v1.7.2-stable-1db4ecdc/linux-amd64/go1.9.2 &nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &nbsp; &gt;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 启动Geth的控制台后就可以进行操作，Geth的控制台是JavaScript开发的，实现了web3.jsAPI。web3.js 是一个通过RPC 调用&nbsp;和本地以太坊节点进行通信的js库。web3.js可以与任何暴露了RPC接口的以太坊节点连接。web3中提供了eth对象 - web3.eth来与以太坊区块链进行交互。 &nbsp; 备注： web3 API =》 http://web3js.readthedocs.io/en/1.0/index.html 中文版：http://web3.tryblockchain.org/Web3.js-api-refrence.html#toc_22 &nbsp; 账户 创建帐户： &gt; &nbsp;web3.personal.newAccount(&quot;password&quot;) &quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot; 返回的字符串就是账户 &nbsp; 查询账户： &gt;&nbsp; web3.eth.accounts [&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;] &nbsp; 挖矿 挖矿执行以下命令： &gt;&nbsp; miner.start(1) null &nbsp; 执行成功后，控制台范围null，通过日志可以看到已经在进行挖矿： $ tailf eth_output.log INFO [05-22|13:17:36] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60 INFO [05-22|13:17:36]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60 INFO [05-22|13:17:36] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 txs=0 uncles=0 elapsed=163.749µs INFO [05-22|13:17:37] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3 INFO [05-22|13:17:37]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3 INFO [05-22|13:17:37] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 txs=0 uncles=0 elapsed=241.586µs INFO [05-22|13:17:39] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004 INFO [05-22|13:17:39]  block reached canonical chain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=1 hash=377d55…8d0308 INFO [05-22|13:17:39]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004 INFO [05-22|13:17:39] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=7 txs=0 uncles=0 elapsed=155.252µs &nbsp; 如果要停止挖矿的话，可以执行命令： &gt;&nbsp; miner.stop() null &nbsp; 备注：停止挖矿后，以太币则不会产生，同样智能合约、转帐等操作也不会起作用。 &nbsp; 账户余额 执行挖矿后，挖矿产生的以太币会默认保持到创建的第一个账户（也就是0xb518124a8e586b18cb16bf4a6a74b376f48db2cd），我们可以查询账户余额： &gt;&nbsp; web3.eth.getBalance(&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;) 555000000000000000000 &nbsp; #查看格式化的以太币 &gt;&nbsp; web3.fromWei(web3.eth.getBalance(&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;)) 555 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为GethJavascript Console是基于Javascript的，所以也可以创建js函数，查看所有帐户余额: &gt; function checkAllBalances() { ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var totalBal = 0; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var acctNum in eth.accounts) { ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acct = eth.accounts[acctNum]; ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acctBal = web3.fromWei(eth.getBalance(acct), &quot;ether&quot;); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; totalBal += parseFloat(acctBal); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&quot;&nbsp; eth.accounts[&quot; + acctNum + &quot;]: \\t&quot; + acct + &quot; \\tbalance: &quot; + acctBal + &quot; ether&quot;); ......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&quot;&nbsp; Total balance: &quot; + totalBal + &quot; ether&quot;); ...&nbsp; }; &gt; checkAllBalances() &nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp; balance: 715 ether &nbsp; Total balance: 715 ether &nbsp; 转账 转账至少需要2个账户，所以首先再创建一个账户： &gt; &nbsp;web3.personal.newAccount(&quot;password&quot;) &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot; &gt; &nbsp;web3.eth.accounts [&quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot;, &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot;] &nbsp; 支持操作账户字符串比较麻烦，可以复制给变量： &gt; &nbsp;account0 = web3.eth.accounts[0] &quot;0xb518124a8e586b18cb16bf4a6a74b376f48db2cd&quot; &gt; &nbsp;account1 = web3.eth.accounts[1] &quot;0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75&quot; 然后从账户1转账给账户2，注意转账前需要先解锁被转账的账户： &gt; &nbsp;web3.personal.unlockAccount(account0,&quot;password&quot;) true &nbsp; &gt;&nbsp; web3.eth.sendTransaction({from:account0,to:account1,value:web3.toWei(3,&quot;ether&quot;)}) &quot;0xd9f95d44de1f4858f23f9e326859713a527922498955cf84eb8bb75296b35fd6&quot; &nbsp; 查询账户余额： &gt; &nbsp;checkAllBalances() &nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balance: 1832 ether &nbsp; eth.accounts[1]: &nbsp;&nbsp;&nbsp;&nbsp; 0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75 &nbsp; balance: 3 ether &nbsp; Total balance: 1835 ether &nbsp; &nbsp; &nbsp; 可以到账户2的余额正是3 ether，说明转账成功。如果把挖矿命令停了以后，再进行转账的话将不会成功。 &nbsp; 连接以太网测试网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊是一个去中心化的平台，往往需要较多节点共同运作才能得到理想的测试效果，搭建私有网络比较难构建多节点，所以可以连接以太网提供的测试网络，以太坊公开的测试网络共有4个，目前仍在运行的有3个。每个网络都有自己的创世区块和名字，按开始运行时间的早晚，依次为： Morden(已退役) Morden是以太坊官方提供的测试网络，自2015年7月开始运行。到2016年11月时，由于难度炸弹已经严重影响出块速度，不得不退役，重新开启一条新的区块链。Morden的共识机制为PoW。 Ropsten https://ropsten.etherscan.io/ Ropsten也是以太坊官方提供的测试网络，是为了解决Morden难度炸弹问题而重新启动的一条区块链，目前仍在运行，共识机制为PoW。测试网络上的以太币并无实际价值，因此Ropsten的挖矿难度很低，目前在755M左右，仅仅只有主网络的0.07%。这样低的难度一方面使一台普通笔记本电脑的CPU也可以挖出区块，获得测试网络上的以太币，方便开发人员测试软件，但是却不能阻止攻击。 Kovan https://kovan.etherscan.io/ 为了解决测试网络中PoW共识机制的问题，以太坊钱包Parity的开发团队发起了一个新的测试网络Kovan。Kovan使用了权威证明(Proof-of-Authority)的共识机制，简称PoA。 Kovan目前仍在运行，但仅有Parity钱包客户端可以使用这个测试网络。 Rinkeby https://rinkeby.etherscan.io/ Rinkeby也是以太坊官方提供的测试网络，使用PoA共识机制。与Kovan不同，以太坊团队提供了Rinkeby的PoA共识机制说明文档，理论上任何以太坊钱包都可以根据这个说明文档，支持Rinkeby测试网络，目前Rinkeby已经开始运行。 目前开发人员最常用的测试网络是Rinkeby，本文说明连接到Rinkeby 连接Rinkeby测试网络 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用Geth连接到Rinkeby测试网络，加上参数--rinkeby,或者指定--networkid=4(1=Frontier, 2=Morden (disused),3=Ropsten, 4=Rinkeby)。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为连接测试网络就需要同步区块链数据，Geth的参数可以指定--syncmode来设置同步模块： full&nbsp;模式，从开始到结束，获取区块的header，获取区块的body，从创始块开始校验每一个元素，需要下载所有区块数据信息。速度最慢，但是能获取到所有的历史数据。 fast模式，获取区块的header，获取区块的body，在同步到当前块之前不处理任何事务。然后获得一个快照，此后，像full节点一样进行后面的同步操作。这种方法用得最多，目的在不要在意历史数据，将历史数据按照快照的方式，不逐一验证，沿着区块下载最近数据库中的交易，有可能丢失历史数据。此方法可能会对历史数据有部分丢失，但是不影响今后的使用。 light模式，仅获取当前状态。验证元素需要向full节点发起相应的请求。 &nbsp; 本文采用ligth模式进行同步Rinkeyby测试网络： $&nbsp; geth --datadir ./rinkeby_light \\ --rinkeby \\ --syncmode light \\ --rpc console 2&gt;eth_rinkeby_out.log &nbsp; 同步需要花点时间，同步情况可以通过web3.eth.syncing查询： &gt; &nbsp;web3.eth.syncing { &nbsp; currentBlock: 168256,&nbsp;&nbsp; //已经同步的区块数 &nbsp;&nbsp;highestBlock: 2331548,&nbsp; //总共的区块数 &nbsp; knownStates: 0, &nbsp; pulledStates: 0, &nbsp; startingBlock: 74688 } &nbsp;当web3.eth.syncing返回false说明同步完成，要等同步完成后才能进行账户余额查询和转账的操作 使用以太坊测试网络同样需要创建账号： &gt;&nbsp; web3.personal.newAccount(&quot;password&quot;) &quot;0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf&quot; &nbsp; 申请Rinkeby以太币 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rinkeby测试网络使用的是PoA共识机制，我们不能通过挖矿来获取以太币。想获取Rinkeby测试网络中的以太币，需要去申请，这个申请Rinkeby以太币的功能被称为水龙头(Faucet)，水龙头会源源不断的产生以太币，并且受到权威节点控制，以确保不会被滥用。 水龙头网站：https://www.rinkeby.io/#faucet &nbsp; 获取方法：有三种在推特、脸书、google+等上发布消息，并将消息的网址粘贴到上面截图的输入框中选个获取就可以。本文采用google+的方式，在google+发布一条消息，消息内容就是你的账号： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 然后将这个消息的连接输入到水龙头网站的输入框，并点击“Give me Ether”，有三种选项，前面是获得的以太币数量，后面是冷却时间，在冷却时间过后才能进行下一次以太币申请。例如第一项是生成3个以太币，8小时后才能再次申请。本文选择的就是第一项3个以太币。 &nbsp; 申请成功后，可以在https://rinkeby.etherscan.io查到转账记录： https://rinkeby.etherscan.io/tx/0x2caf8eb8e6b90a4577c80ff17165e36cdf3a9f8d71bba25539a2fc5af5814144 &nbsp; 然后我们查询账户余额，可以查询到是3000000000000000000Wei=3以太币 &gt; &nbsp;web3.eth.getBalance(&quot;0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf&quot;) 3000000000000000000 &nbsp; &nbsp; 参考 https://blog.csdn.net/ethchinese/article/details/62220851 https://www.cnblogs.com/lion.net/p/7809862.html http://wiki.jikexueyuan.com/project/ethereum/public-chain-chain.html https://zhuanlan.zhihu.com/p/29010231 作者简介 吴龙辉，《Kubernetes实战》作者，活跃于技术开源社区，贡献代码和撰写技术文档。&nbsp; 邮箱： wlh6666@qq.com 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/05/23/1bad3eabe061c992166d205795f33533.html","headline":"以太坊分析之 以太坊网络","dateModified":"2018-05-23T00:00:00+08:00","datePublished":"2018-05-23T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/05/23/1bad3eabe061c992166d205795f33533.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊分析之 以太坊网络</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h1>以太坊介绍</h1>
  <p><span style="color:#000000;background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#000000;background:#FFFFFF;">以太坊（</span><span style="color:#000000;background:#FFFFFF;">Ethereum</span><span style="color:#000000;background:#FFFFFF;">）是一个建立在区块链技术之上，</span><span style="color:#000000;background:#FFFFFF;">去中心化应用平台。它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。</span></p>
  <p style="background:#FFFFFF;">&nbsp;</p>
  <h1>以太坊网络</h1>
  <p><span style="color:#000000;background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#000000;background:#FFFFFF;">以太坊区块链的基础是参与节点的点对点网络，以太坊节点加入到以太坊网络形成去中心化的共识系统。以太坊网络</span>有以下几种：</p>
  <p></p>
  <ul>
   <li>生产环境网络<span style="color:#000000;background:#FFFFFF;">: </span><span style="color:#000000;background:#FFFFFF;">以太坊的生产网络顾名思义，也就是产生</span>真正有价值的<span style="color:#000000;background:#FFFFFF;">&nbsp;</span><span style="color:#000000;background:#FFFFFF;">的以太币的网络。</span><span style="color:#000000;background:#FFFFFF;">目前生产网络目前已经生成了</span><span style="color:#000000;background:#FFFFFF;">300</span><span style="color:#000000;background:#FFFFFF;">万以上的区块，还在持续生成中。</span></li>
   <li>测试网络<span style="color:#000000;background:#FFFFFF;">: </span><span style="color:#000000;background:#FFFFFF;">以太坊的测试网络也是官方提供的，顾名思义就是专供用户来开发、调试和测试的。</span><span style="color:#000000;background:#FFFFFF;">上面的合约执行不消耗真实的以太币。</span></li>
   <li>私有网络：以太坊的私有网络，顾名思义就是由用户自己创建的私有网络。</li>
  </ul>
  <p style="background:#FFFFFF;">&nbsp;</p>
  <p style="background:#FFFFFF;">&nbsp;</p>
  <p><span style="background:#FFFFFF;">生产环境网络对应的是以太坊共有链，私有网络对应的是以太坊私有链</span><span style="background:#FFFFFF;">或联盟链</span>，</p>
  <p align="left" style="background:#FFFFFF;"></p>
  <ul>
   <li>公有链：世界上所有人都可以阅读和发送交易，世界上任何人都能参与到共识形成过程——决定在链条上添加什么区块以及现状是怎样的。公有链受加密经济的保护，用类似工作量证明或权益证明的机制。这类区块链通常被认为是"完全去中心化"。</li>
   <li>联盟链：共识形成过程由预先选择的一系列的节点所掌控，例如，设想一个有15个金融机构的团体，每个机构都操作一个节点，为了使区块生效，其中的10个必须签署那个区块。这类区块链被认为是"部分去中心化"。</li>
   <li>私有链： 只限于私人或者私有组织连接。</li>
  </ul>
  <p>&nbsp;</p>
  <h1>Geth</h1>
  <p><span style="color:#333333;background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Geth</span><span style="color:#333333;background:#FFFFFF;">是</span><span style="color:#333333;background:#FFFFFF;">Go Ethereum</span><span style="color:#333333;background:#FFFFFF;">开源项目的简称，它是使用</span><span style="color:#333333;background:#FFFFFF;">Go</span><span style="color:#333333;background:#FFFFFF;">语言编写且实现了</span><span style="color:#333333;background:#FFFFFF;">Ethereum</span><span style="color:#333333;background:#FFFFFF;">协议的客户端软件，也是目前用户最多，使用最广泛的客户端。通过</span><span style="color:#333333;background:#FFFFFF;">Geth</span><span style="color:#333333;background:#FFFFFF;">客户端与以太坊网络进行连接和交互可以实现账户管理、合约部署、挖矿等众多有趣且实用的功能。</span></p>
  <p><span style="color:#000000;background:#FFFFFF;">Geth</span><span style="color:#000000;background:#FFFFFF;">的安装方法：</span></p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">$ git</span><span style="color:#FF0000;">clone</span><span style="color:#FF0000;"> https://github.com/ethereum/go-ethereum.git </span></strong></p> <p><strong><span style="color:#FF0000;">$ cd</span><span style="color:#FF0000;"> go-ethereum</span></strong></p> <p><strong><span style="color:#FF0000;">$ git</span><span style="color:#FF0000;"> checkout v1.7.2 </span></strong></p> <p><strong><span style="color:#FF0000;">$ make</span><span style="color:#FF0000;"> geth </span></strong></p> <p><strong><span style="color:#FF0000;">$ make</span><span style="color:#FF0000;"> all</span></strong></p><p><strong><span style="color:#FF0000;"><strong><span style="color:#FF0000;">$ cp ./build/bin/geth/usr/bin</span></strong><br></span></strong></p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>安装成功后执行：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">$ geth version</span></strong></p> <p><span style="color:#000000;">Geth</span></p> <p><span style="color:#000000;">Version: 1.7.2-stable</span></p> <p><span style="color:#000000;">Git Commit: 1db4ecdc0b9e828ff65777fb466fc7c1d04e0de9</span></p> <p><span style="color:#000000;">Architecture: amd64</span></p> <p><span style="color:#000000;">Protocol Versions: [63 62]</span></p> <p><span style="color:#000000;">Network Id: 1</span></p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  <h1><a href="http://www.cnblogs.com/lion.net/p/7809862.html" rel="nofollow"><span>搭建以太坊私有</span><span>网络</span></a></h1>
  <p>1.初始化一个创世区块</p>
  <p><span style="color:#000000;background:#FFFFFF;">初始化创世区块时，要先创建一个</span><code><span style="color:#000000;">genesis.json</span></code><span style="color:#000000;background:#FFFFFF;">文件，</span></p>
  <p><span style="color:#000000;background:#FFFFFF;">genesis.json</span><span style="color:#000000;background:#FFFFFF;">：</span></p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><span style="color:#000000;">{</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "config": {</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "chainId": 10,</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "homesteadBlock": 0,</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "eip155Block": 0,</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "eip158Block": 0</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; },</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "coinbase": "0x0000000000000000000000000000000000000000",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "difficulty": "0x20000",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "extraData": "",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "gasLimit": "0x2fefd8",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "nonce": "0x0000000000000042",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "timestamp": "0x00",</span></p> <p align="left"><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp; "alloc": {}</span></p> <p align="left"><span style="color:#000000;">}</span></p></td>
    </tr>
   </tbody>
  </table>
  <p align="left"></p>
  <ul>
   <li>mixhash&nbsp;&nbsp; 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。</li>
   <li>nonce&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。</li>
   <li>difficulty&nbsp;&nbsp; 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度</li>
   <li>alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。</li>
   <li>coinbase&nbsp; 矿工的账号，随便填</li>
   <li>timestamp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 设置创世块的时间戳</li>
   <li>parentHash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上一个区块的hash值，因为是创世块，所以这个值是0</li>
   <li>extraData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 附加信息，随便填，可以填你的个性信息</li>
   <li>gasLimit&nbsp;&nbsp; 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。</li>
  </ul>
  <br clear="all">
  <p align="left"><br></p>
  <p align="left"><span style="color:#000000;background:#FFFFFF;">然后进行创世区块的初始化</span>：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="color:#FF0000;">$ geth init ./genesis.json --datadir ./chain</span></strong></p> <p align="left">WARN [05-22|11:16:36] No etherbase set and no accounts found as default </p> <p align="left">INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/chaindata cache=16 handles=16</p> <p align="left">INFO [05-22|11:16:36] Writing custom genesis block </p> <p align="left">INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=chaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0</p> <p align="left">INFO [05-22|11:16:36] Allocated cache and file handles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=/home/geth/chain/geth/lightchaindata cache=16 handles=16</p> <p align="left">INFO [05-22|11:16:36] Writing custom genesis block </p> <p align="left">INFO [05-22|11:16:36] Successfully wrote genesis state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=lightchaindata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash=5e1fc7…d790e0</p></td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p>
  <p align="left">2.启动私有网络</p>
  <p align="left">执行命令，其中参数<span style="color:#000000;background:#FFFFFF;">nodiscover</span><span style="color:#000000;background:#FFFFFF;">表示私有链地址，不会被网上看到</span>，命令congsole表示同时会启动Geth的JavaScript控制台</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="color:#FF0000;">$ geth --datadir ./chain --nodiscover console 2&gt;&gt;eth_output.log</span></strong></p> <p align="left">Welcome to the Geth JavaScript console!</p> <p align="left">&nbsp;</p> <p align="left">instance: Geth/v1.7.2-stable-1db4ecdc/linux-amd64/go1.9.2</p> <p align="left">&nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</p> <p align="left">&nbsp;</p> <p align="left">&gt;&nbsp;</p></td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p>
  <p align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 启动Geth的控制台后就可以进行操作，Geth的控制台是JavaScript开发的，实现了web3.jsAPI。<span style="color:#2F2F2F;background:#FFFFFF;">web3.js </span><span style="color:#2F2F2F;background:#FFFFFF;">是一个通过</span><a href="https://link.jianshu.com/?t=https%3A%2F%2Fgithub.com%2Fethereum%2Fwiki%2Fwiki%2FJSON-RPC" rel="nofollow"><span style="color:#3194D0;background:#FFFFFF;">RPC </span><span style="color:#3194D0;background:#FFFFFF;">调用</span></a><span style="color:#2F2F2F;background:#FFFFFF;">&nbsp;</span><span style="color:#2F2F2F;background:#FFFFFF;">和本地以太坊节点进行通信的</span><span style="color:#2F2F2F;background:#FFFFFF;">js</span><span style="color:#2F2F2F;background:#FFFFFF;">库。</span><span style="color:#2F2F2F;background:#FFFFFF;">web3.js</span><span style="color:#2F2F2F;background:#FFFFFF;">可以与任何暴露了</span><span style="color:#2F2F2F;background:#FFFFFF;">RPC</span><span style="color:#2F2F2F;background:#FFFFFF;">接口的以太坊节点连接。</span><span style="color:#2F2F2F;background:#FFFFFF;">web3</span><span style="color:#2F2F2F;background:#FFFFFF;">中提供了</span><span style="color:#2F2F2F;background:#FFFFFF;">eth</span><span style="color:#2F2F2F;background:#FFFFFF;">对象</span><span style="color:#2F2F2F;background:#FFFFFF;"> - web3.eth</span><span style="color:#2F2F2F;background:#FFFFFF;">来与以太坊区块链进行交互。</span></p>
  <p align="left"><span style="color:#2F2F2F;background:#FFFFFF;">&nbsp;</span></p>
  <p align="left"><span style="color:#2f2f2f;"><span style="background-color:rgb(255,255,255);">备注：</span></span></p>
  <p align="left"><span style="color:#2F2F2F;background:#FFFFFF;">web3 API =</span><span style="color:#2F2F2F;background:#FFFFFF;">》</span> <span style="color:#2F2F2F;background:#FFFFFF;">http://web3js.readthedocs.io/en/1.0/index.html</span></p>
  <p align="left"><span style="color:#2F2F2F;background:#FFFFFF;">中文版：</span><span style="color:#2F2F2F;background:#FFFFFF;">http://web3.tryblockchain.org/Web3.js-api-refrence.html#toc_22</span></p>
  <br clear="all">
  <p align="left">&nbsp;</p>
  <h2>账户</h2>
  <p align="left"><span style="color:#000000;background:#FFFFFF;">创建帐户</span>：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="color:#FF0000;">&gt; &nbsp;web3.personal.newAccount("password")</span></strong></p> <p align="left">"0xb518124a8e586b18cb16bf4a6a74b376f48db2cd"</p></td> 
    </tr>
   </tbody>
  </table>
  <p align="left"><span style="color:#000000;background:#EEEEEE;">返回的字符串就是账户</span></p>
  <p align="left">&nbsp;</p>
  <p align="left">查询账户：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="color:#FF0000;">&gt;&nbsp; web3.eth.accounts </span></strong></p> <p align="left">["0xb518124a8e586b18cb16bf4a6a74b376f48db2cd"]</p></td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p>
  <h2>挖矿</h2>
  <p><span style="background:#FFFFFF;">挖矿执行以下命令</span>：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt;&nbsp; miner.start(1)</span></strong></p> <p>null</p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>执行成功后，控制台范围null，通过日志可以看到已经在进行挖矿：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">$ tailf eth_output.log </span></strong></p> <p>INFO [05-22|13:17:36] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60</p> <p>INFO [05-22|13:17:36]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=4 hash=4c2ded…26ee60</p> <p>INFO [05-22|13:17:36] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 txs=0 uncles=0 elapsed=163.749µs</p> <p>INFO [05-22|13:17:37] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3</p> <p>INFO [05-22|13:17:37]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=5 hash=f30c33…e14fb3</p> <p>INFO [05-22|13:17:37] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 txs=0 uncles=0 elapsed=241.586µs</p> <p>INFO [05-22|13:17:39] Successfully sealed new block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004</p> <p>INFO [05-22|13:17:39]  block reached canonical chain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=1 hash=377d55…8d0308</p> <p>INFO [05-22|13:17:39]  mined potential block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=6 hash=76363f…460004</p> <p>INFO [05-22|13:17:39] Commit new mining work&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number=7 txs=0 uncles=0 elapsed=155.252µs</p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>如果要停止挖矿的话，可以执行命令：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt;&nbsp; miner.</span>stop()</strong></p> <p>null</p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>备注：停止挖矿后，以太币则不会产生，同样智能合约、转帐等操作也不会起作用。</p>
  <br clear="all">
  <p align="left">&nbsp;</p>
  <h2>账户余额</h2>
  <p>执行挖矿后，挖矿产生的以太币会默认保持到创建的第一个账户（也就是0xb518124a8e586b18cb16bf4a6a74b376f48db2cd），我们可以查询账户余额：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt;&nbsp; web3.eth.getBalance("0xb518124a8e586b18cb16bf4a6a74b376f48db2cd")</span></strong></p> <p>555000000000000000000</p> <p>&nbsp;</p> <p>#查看格式化的以太币</p> <p><strong><span style="color:#FF0000;">&gt;&nbsp; web3.fromWei(web3.eth.getBalance("0xb518124a8e586b18cb16bf4a6a74b376f48db2cd"))</span></strong></p> <p><span style="color:#000000;">555</span></p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 因为GethJavascript Console是基于Javascript的，所以也可以创建js函数，查看所有帐户余额:</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt; function checkAllBalances() {</span></strong></p> <p><strong><span style="color:#FF0000;">...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var totalBal = 0;</span></strong></p> <p><strong><span style="color:#FF0000;">...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var acctNum in eth.accounts) {</span></strong></p> <p><strong><span style="color:#FF0000;">......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acct = eth.accounts[acctNum];</span></strong></p> <p><strong><span style="color:#FF0000;">......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var acctBal = web3.fromWei(eth.getBalance(acct), "ether");</span></strong></p> <p><strong><span style="color:#FF0000;">......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; totalBal += parseFloat(acctBal);</span></strong></p> <p><strong><span style="color:#FF0000;">......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log("&nbsp; eth.accounts[" + acctNum + "]: \t" + acct + " \tbalance: " + acctBal + " ether");</span></strong></p> <p><strong><span style="color:#FF0000;">......&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></strong></p> <p><strong><span style="color:#FF0000;">...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log("&nbsp; Total balance: " + totalBal + " ether");</span></strong></p> <p><strong><span style="color:#FF0000;">...&nbsp; };</span></strong></p> <p><strong><span style="color:#FF0000;">&gt; checkAllBalances()</span></strong></p> <p><span style="color:#000000;">&nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp; balance: 715 ether</span></p> <p><span style="color:#000000;">&nbsp; Total balance: 715 ether</span></p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <h2>转账</h2>
  <p>转账至少需要2个账户，所以首先再创建一个账户：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt; &nbsp;web3.personal.newAccount("password")</span></strong></p> <p>"0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75"</p> <p><strong><span style="color:#FF0000;">&gt; &nbsp;web3.eth.accounts </span></strong></p> <p>["0xb518124a8e586b18cb16bf4a6a74b376f48db2cd", "0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75"]</p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>支持操作账户字符串比较麻烦，可以复制给变量：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt; &nbsp;account0 = web3.eth.accounts[0]</span></strong></p> <p>"0xb518124a8e586b18cb16bf4a6a74b376f48db2cd"</p> <p><strong><span style="color:#FF0000;">&gt; &nbsp;account1 = web3.eth.accounts[1]</span></strong></p> <p>"0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75"</p></td> 
    </tr>
   </tbody>
  </table>
  <p>然后从账户1转账给账户2，注意转账前需要先解锁被转账的账户：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt; &nbsp;web3.personal.unlockAccount(account0,"password")</span></strong></p> <p>true</p> <p>&nbsp;</p> <p><strong><span style="color:#FF0000;">&gt;&nbsp; web3.</span>eth.sendTransaction({from:account0,to:account1,value:web3.toWei(3,"ether")})</strong></p> <p>"0xd9f95d44de1f4858f23f9e326859713a527922498955cf84eb8bb75296b35fd6"</p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>查询账户余额：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt; &nbsp;checkAllBalances()</span></strong></p> <p>&nbsp; eth.accounts[0]: &nbsp;&nbsp;&nbsp;&nbsp; 0xb518124a8e586b18cb16bf4a6a74b376f48db2cd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balance: 1832 ether</p> <p>&nbsp; eth.accounts[1]: &nbsp;&nbsp;&nbsp;&nbsp; 0xbd4a62c2832b3ef2205c23cfec8ba3dacc875b75 &nbsp; balance: 3 ether</p> <p>&nbsp; Total balance: 1835 ether</p></td>
    </tr>
   </tbody>
  </table>
  <p><br>&nbsp; &nbsp; &nbsp; 可以到账户2的余额正是3 ether，说明转账成功。如果把挖矿命令停了以后，再进行转账的话将不会成功。</p>
  <p>&nbsp;</p>
  <h1>连接以太网测试网络</h1>
  <p align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以太坊是一个去中心化的平台，往往需要较多节点共同运作才能得到理想的测试效果，搭建私有网络比较难构建多节点，所以可以连接以太网提供的测试网络，以太坊公开的测试网络共有4个，目前仍在运行的有3个。每个网络都有自己的创世区块和名字，按开始运行时间的早晚，依次为：</p>
  <p align="left" style="background:#FFFFFF;"></p>
  <ul>
   <li>Morden(已退役)</li>
  </ul>
  <p align="left" style="background:#FFFFFF;">Morden是以太坊官方提供的测试网络，自2015年7月开始运行。到2016年11月时，由于难度炸弹已经严重影响出块速度，不得不退役，重新开启一条新的区块链。Morden的共识机制为PoW。</p>
  <p align="left" style="background:#FFFFFF;"></p>
  <ul>
   <li>Ropsten</li>
  </ul>
  <p align="left" style="background:#FFFFFF;"><em><u><span style="color:#1F497D;">https://ropsten.etherscan.io/</span></u></em></p>
  <p>Ropsten也是以太坊官方提供的测试网络，是为了解决Morden难度炸弹问题而重新启动的一条区块链，目前仍在运行，共识机制为PoW。测试网络上的以太币并无实际价值，因此Ropsten的挖矿难度很低，目前在755M左右，仅仅只有主网络的0.07%。这样低的难度一方面使一台普通笔记本电脑的CPU也可以挖出区块，获得测试网络上的以太币，方便开发人员测试软件，但是却不能阻止攻击。</p>
  <p align="left" style="background:#FFFFFF;"></p>
  <ul>
   <li>Kovan</li>
  </ul>
  <p align="left" style="background:#FFFFFF;"><em><u><span style="color:#1F497D;">https://kovan.etherscan.io/</span></u></em></p>
  <p align="left" style="background:#FFFFFF;">为了解决测试网络中PoW共识机制的问题，以太坊钱包Parity的开发团队发起了一个新的测试网络Kovan。Kovan使用了权威证明(Proof-of-Authority)的共识机制，简称PoA。</p>
  <p align="left" style="background:#FFFFFF;">Kovan目前仍在运行，但仅有Parity钱包客户端可以使用这个测试网络。</p>
  <p align="left" style="background:#FFFFFF;"></p>
  <ul>
   <li>Rinkeby</li>
  </ul>
  <p align="left" style="background:#FFFFFF;"><em><u><span style="color:#1F497D;">https://rinkeby.etherscan.io/</span></u></em></p>
  <p align="left" style="background:#FFFFFF;">Rinkeby也是以太坊官方提供的测试网络，使用PoA共识机制。与Kovan不同，以太坊团队提供了Rinkeby的PoA共识机制说明文档，理论上任何以太坊钱包都可以根据这个说明文档，支持Rinkeby测试网络，目前Rinkeby已经开始运行。</p>
  <p align="left"><span style="color:#1A1A1A;background:#FFFFFF;">目前开发人员最常用的测试网络是Rinkeby</span>，本文说明连接到Rinkeby</p>
  <p align="left"><br></p>
  <h2><span style="background:#FFFFFF;">连接Rinkeby</span>测试网络</h2>
  <p><span style="background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="background:#FFFFFF;">使用</span><span style="background:#FFFFFF;">Geth</span><span style="background:#FFFFFF;">连接到</span><span style="background:#FFFFFF;">Rinkeby</span><span style="background:#FFFFFF;">测试网络，加上参数</span><span style="background:#FFFFFF;">--rinkeby,</span><span style="background:#FFFFFF;">或者指定</span><span style="background:#FFFFFF;">--networkid=4(1=Frontier, 2=Morden (disused),3=Ropsten, 4=Rinkeby)</span><span style="background:#FFFFFF;">。</span></p>
  <p><span style="background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="background:#FFFFFF;">因为连接测试网络就需要同步区块链数据，</span><span style="background:#FFFFFF;">Geth</span><span style="background:#FFFFFF;">的参数可以指定</span><span style="color:#000000;background:#F6F8FA;">--syncmode</span><span style="background:#FFFFFF;">来设置同步模块：</span></p>
  <p align="left" style="background:#FFFFFF;"></p>
  <ul>
   <li>full&nbsp;模式，从开始到结束，获取区块的header，获取区块的body，从创始块开始校验每一个元素，需要下载所有区块数据信息。速度最慢，但是能获取到所有的历史数据。</li>
   <li>fast模式，获取区块的header，获取区块的body，在同步到当前块之前不处理任何事务。然后获得一个快照，此后，像full节点一样进行后面的同步操作。这种方法用得最多，目的在不要在意历史数据，将历史数据按照快照的方式，不逐一验证，沿着区块下载最近数据库中的交易，有可能丢失历史数据。此方法可能会对历史数据有部分丢失，但是不影响今后的使用。</li>
   <li>light模式，仅获取当前状态。验证元素需要向full节点发起相应的请求。</li>
  </ul>
  <p><span style="color:#333333;">&nbsp;</span></p>
  <p>本文采用ligth模式进行同步Rinkeyby测试网络：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">$&nbsp; geth --datadir ./rinkeby_light \</span></strong></p> <p><strong><span style="color:#FF0000;">--rinkeby \</span></strong></p> <p><strong><span style="color:#FF0000;">--syncmode light \</span></strong></p> <p><strong><span style="color:#FF0000;">--rpc console 2&gt;eth_rinkeby_out.log</span></strong></p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <p>同步需要花点时间，同步情况可以通过web3.eth.syncing查询：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt; &nbsp;web3.eth.syncing</span></strong></p> <p>{</p> <p>&nbsp; currentBlock: 168256,&nbsp;&nbsp; //已经同步的区块数</p> <p>&nbsp;&nbsp;highestBlock: 2331548,&nbsp; //总共的区块数</p> <p>&nbsp; knownStates: 0,</p> <p>&nbsp; pulledStates: 0,</p> <p>&nbsp; startingBlock: 74688</p> <p>}</p></td>
    </tr>
   </tbody>
  </table>
  <p>&nbsp;当web3.eth.syncing返回false说明同步完成，要等同步完成后才能进行账户余额查询和转账的操作</p>
  <p><br></p>
  <p>使用以太坊测试网络同样需要创建账号：</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p><strong><span style="color:#FF0000;">&gt;&nbsp; web3.personal.newAccount("password")</span></strong></p> <p>"0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf"</p></td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p>
  <h2><span style="background:#FFFFFF;">申请Rinkeby</span>以太币</h2>
  <p><span style="color:#1A1A1A;background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Rinkeby</span><span style="color:#1A1A1A;background:#FFFFFF;">测试网络使用的是PoA</span>共识机制，我们不能通过挖矿来获取以太币。想获取Rinkeby测试网络中的以太币，需要去申请，这个申请Rinkeby以太币的功能被称为水龙头(Faucet)，水龙头会源源不断的产生以太币，并且受到权威节点控制，以确保不会被滥用。</p>
  <p><span style="color:#1A1A1A;background:#FFFFFF;">水龙头网站：https://www.rinkeby.io/#faucet</span></p>
  <p><span style="color:#1A1A1A;background:#FFFFFF;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180523123912490?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsaGRvNzE5MjAxNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p>
  <p><span style="color:#3D464D;background:#FFFFFF;">&nbsp; </span><span style="color:#3D464D;background:#FFFFFF;">获取方法：有三种在推特、脸书、</span><span style="color:#3D464D;background:#FFFFFF;">google+</span><span style="color:#3D464D;background:#FFFFFF;">等上发布消息，并将消息的网址粘贴到上面截图的输入框中选个获取就可以。</span>本文采用<span style="color:#3D464D;background:#FFFFFF;">google+</span><span style="color:#3D464D;background:#FFFFFF;">的方式，在</span><span style="color:#3D464D;background:#FFFFFF;">google+</span><span style="color:#3D464D;background:#FFFFFF;">发布一条消息，消息内容就是你的账号：</span></p>
  <p><span style="color:#3D464D;background:#FFFFFF;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180523123924845?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsaGRvNzE5MjAxNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p>
  <p><span style="color:#1A1A1A;background:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:#1A1A1A;background:#FFFFFF;">然后将这个消息的连接输入到水龙头网站的输入框，并点击“Give me Ether”</span>，有三种选项，前面是获得的以太币数量，后面是冷却时间，在冷却时间过后才能进行下一次以太币申请。例如第一项是生成3个以太币，8小时后才能再次申请。本文选择的就是第一项3个以太币。</p>
  <p><span style="color:#1A1A1A;background:#FFFFFF;">&nbsp;</span></p>
  <p><span style="color:#1A1A1A;background:#FFFFFF;">申请成功后，可以在https://rinkeby.etherscan.io</span>查到转账记录：</p>
  <p><span style="color:#1A1A1A;background:#FFFFFF;">https://rinkeby.etherscan.io/tx/0x2caf8eb8e6b90a4577c80ff17165e36cdf3a9f8d71bba25539a2fc5af5814144</span></p>
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180523123934286?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsaGRvNzE5MjAxNDU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="">
  <br clear="all">
  <p align="left">&nbsp;</p>
  <p align="left"><span style="color:#1A1A1A;background:#FFFFFF;">然后我们查询账户余额，可以查询到是</span>3000000000000000000Wei=3以太币</p>
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="color:#FF0000;">&gt; &nbsp;web3.eth.getBalance("0xb2e149dc56c65bd0ee10c76fb7a92b140cec1adf")</span></strong></p> <p align="left">3000000000000000000</p></td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p>
  <p>&nbsp;</p>
  <h1>参考</h1>
  <p></p>
  <ul>
   <li>https://blog.csdn.net/ethchinese/article/details/62220851</li>
   <li>https://www.cnblogs.com/lion.net/p/7809862.html</li>
   <li>http://wiki.jikexueyuan.com/project/ethereum/public-chain-chain.html</li>
   <li>https://zhuanlan.zhihu.com/p/29010231</li>
  </ul>
  <p></p>
  <h2 style="font-size:1.75em;color:rgb(51,51,51);font-weight:500;line-height:30px;font-family:'Helvetica Neue', STHeiti, 'Microsoft YaHei', Helvetica, Arial, sans-serif;background-color:rgb(255,255,255);"><br></h2>
  <h2 style="font-size:1.75em;color:rgb(51,51,51);font-weight:500;line-height:30px;font-family:'Helvetica Neue', STHeiti, 'Microsoft YaHei', Helvetica, Arial, sans-serif;background-color:rgb(255,255,255);">作者简介</h2>
  <span style="font-size:14px;color:rgb(102,102,102);font-family:'Helvetica Neue', STHeiti, 'Microsoft YaHei', Helvetica, Arial, sans-serif;background-color:rgb(255,255,255);">吴龙辉，《Kubernetes实战》作者，活跃于技术开源社区，贡献代码和撰写技术文档。&nbsp;</span>
  <br style="font-size:14px;color:rgb(102,102,102);font-family:'Helvetica Neue', STHeiti, 'Microsoft YaHei', Helvetica, Arial, sans-serif;background-color:rgb(255,255,255);">
  <span style="font-size:14px;color:rgb(102,102,102);font-family:'Helvetica Neue', STHeiti, 'Microsoft YaHei', Helvetica, Arial, sans-serif;background-color:rgb(255,255,255);">邮箱：</span>
  <a href="mailto:wlh6666@qq.com" rel="nofollow" style="color:rgb(21,95,170);font-size:14px;background:rgb(255,255,255) 0px 0px;font-family:'Helvetica Neue', STHeiti, 'Microsoft YaHei', Helvetica, Arial, sans-serif;">wlh6666@qq.com</a>
  <br>
  <p></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wlhdo71920145/article/details/80418321,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wlhdo71920145/article/details/80418321,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

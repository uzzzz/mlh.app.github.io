<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>基于智能合约建立简易代币 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="基于智能合约建立简易代币" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="接上一篇编写智能合约的教程带你玩转以太坊智能合约的”Hello World”，我们现在要建立一个简单的代币系统，具备最简单的转账和查询功能。 启动testrpc测试环境 建立项目 编写智能合约 编译部署 合约验证 1.启动testrpc测试环境 sily@lyg-sily:~$ testrpc EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e (1) 0xfdc2bb26d860ac1f84f3f06826ab1da4b3ef30b6 (2) 0x60e468066c781c1864479fb20cae2698eacc784b (3) 0x2ea86e060b90cbe10cdba24e79496e6c46a483c7 (4) 0x51ada420bddc3a03c1294645784096bf663545b3 (5) 0xb8eaaf1449510e6d91229ddc6561d54a5dabef84 (6) 0xa1ab09f35f701ca1b91a8ae6ac800305a078e5ae (7) 0xc84468b9c9f2a3d4e9c3a7861caa77a7f12593dd (8) 0xd671b2eb8b0d0425b9dcc764bfee4fc8f19e6d5a (9) 0x0351bb8bd2033ae15b8aee1ddf7d037fe12fd88c Private Keys ================== (0) eee65f7557d7c1271a2cf5848d816770bfcb18dab7c353858487299be4cf3f71 (1) 4391df2085e6c810c5b3125f37c81287e4697ed4076f2cfbe10f90cc23ac15e7 (2) 0ef1c08f8be81d79420ee3af55e657716ad79a9495c24e10a6ff8864c141c0fc (3) da5766fd22e3b53b395d32ec9e544a15169f3ec54a1332c2146acf0002b37326 (4) fc4440a9fdc2e3bf9c6ab20107ef567433eaff1133d703c83fd26efb8b727ed3 (5) 88230785f8b2814659bc824b93e29bcf928e1af4371d53180fb276e8c8592402 (6) 3ce639e515d36811e45ccdd578732ec0799ba09156419d9c09a8b4a7029d70de (7) 59ca1ade2f0a701a7d1e14ec5b886e9a835fea7d0aedf7226fa83cfe52c1e1fd (8) c819bd2bdaeb8cc84f8b79ee0ff9089b99c725d6aca91ff793f2bc9c4df82243 (9) 376d808c1b708c126c45aa890ad4d208ac24cbe922fe5c97c952022e153423b4 HD Wallet ================== Mnemonic: negative sea robot enforce tube cattle public engage jewel grit install fatigue Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 2.建立项目 前面我们搭建了智能合约的testrpc测试环境，并通过truffle框架进行了简单的HelloWorld代码开发、编译、部署以及调用合约。接下来，我们要创建一个简单的代币，以继续熟悉truffle框架和solidity语法。 首先，回顾一下上次建立HelloWorld项目的命令： sily@lyg-sily:~$ mkdir SmartContractDemo sily@lyg-sily:~$ cd SmartContractDemo/ sily@lyg-sily:~/SmartContractDemo$ mkdir HelloWorld sily@lyg-sily:~/SmartContractDemo$ cd HelloWorld/ sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle init Downloading... Unpacking... Setting up... Unbox successful. Sweet! Commands: Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test sily@lyg-sily:~/SmartContractDemo/HelloWorld$ ls contracts migrations test truffle-config.js truffle.js sily@lyg-sily:~/SmartContractDemo/HelloWorld$ 3.编写智能合约 在项目下的contracts/文件夹中新建EncryptedToken.sol，内容如下： pragma solidity ^0.4.17; contract EncryptedToken { uint256 INITIAL_SUPPLY = 21000000; mapping (address =&gt; uint256) balances; function EncryptedToken() { balances[msg.sender] = INITIAL_SUPPLY; } //转帐到一个指定的地址 function transfer(address _to, uint256 _amount) { assert(balances[msg.sender] &gt;= _amount); balances[msg.sender] -= _amount; balances[_to] += _amount; } //查看指定地址的余额 function balanceOf(address _owner) constant returns (uint256) { return balances[_owner]; } } uint256 INITIAL_SUPPLY = 21000000声明变量,将当前合约的钱包地址代币数设置为21000000。 mapping(address =&gt; uint256) balances;声明了balances是一个key类型为address、value类型为uint256的键值对(mapping)。 function EncryptedToken()函数是EncryptedToken合约的构造函数(contructor)，当EncryptedToken合约调用时，会先执行构造函数中的内容。在构造函数中，会以当前部署合约的钱包地址为key，以INITIAL_SUPPLY为value初始化一个键值对。 transfer函数声明了转账到指定钱包地址的函数，_to是转账的目标地址，_amount表示转账金额。 assert断言确保当前钱包余额不少于要转账的金额时才能进行转账，否则会抛出异常。 balanceOf(address _owner)函数是用来查询指定钱包地址的余额，_owner即是指定的钱包地址，return (uint256)代表返回值的类型是uint256，constant关键字说明了函数是只读的，调用时不会消耗手续费。 4.编译部署 在migrations/目录下创建一个3_deploy_contract.js的文件。内容如下： var EncryptedToken = artifacts.require(&quot;./EncryptedToken.sol&quot;); module.exports = function(deployer) { deployer.deploy(EncryptedToken); } 然后我们执行truffle compile和truffle migrate命令： sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle compile Compiling ./contracts/EncryptedToken.sol... Compiling ./contracts/HelloWorld.sol... Compiling ./contracts/Migrations.sol... Compilation warnings encountered: /home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:6:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function EncryptedToken() { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:11:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function transfer(address _to, uint256 _amount) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:18:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function balanceOf(address _owner) constant returns (uint256) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:4:3: Warning: Function state mutability can be restricted to pure function sayHello() public constant returns (string) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:8:3: Warning: Function state mutability can be restricted to pure function echo(string name) public constant returns (string) { ^ Spanning multiple lines. Writing artifacts to ./build/contracts sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle migrate --reset Using network &#39;development&#39;. Running migration: 1_initial_migration.js Replacing Migrations... ... 0xfc5af4b443dcae96f96206e26d2bc93b9699e7d14980dd0247baea112bd04c44 Migrations: 0x9681bbaee9346afe05e7ceaf72b32d433b329090 Saving successful migration to network... ... 0x2155887e4c7037d33fbfbec1df073152ac72784a6a594886a066d412cf105b66 Saving artifacts... Running migration: 2_deploy_contracts.js Replacing HelloWorld... ... 0x9a4cd911a85438c4087ee7144dc2b0eeb9bf88f7985fcf56f9949b41b02f936a HelloWorld: 0x644fad81bc1075e4f39dc765f671f81ad363317c Saving successful migration to network... ... 0x19e5b97d493c652fc8f67c53c7a56899c8285127b2e70a1bfd41f7b8d35c067d Saving artifacts... Running migration: 3_deploy_contracts.js Deploying EncryptedToken... ... 0x3206c798ab3d0e0ca5e49865bb0cbd207513c1907539c5c921cc027125639a4e EncryptedToken: 0xeff776cc1aa2f01c40e638538fdfaadbfb179b00 Saving successful migration to network... ... 0x4fb48f957d364f77510f2acc82467dca4e70d268078db8418dfae78000523cd9 Saving artifacts... 5.合约验证 合约部署完成后，输入truffle console命令开启console控制台。在控制台中对已部署的合约进行验证。 web3.eth.coinbase或web3.eth.accounts[0]表示testrpc环境初始分配的首个钱包地址，也可以通过索引值获取其他9个钱包地址。 EncryptedToken.deployed().then(instance =&gt; contract = instance)声明了合约变量contract来存储EncryptedToken合约实例。 sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle console truffle(development)&gt; let contract; undefined truffle(development)&gt; EncryptedToken.deployed().then(instance =&gt; contract = instance) TruffleContract { constructor: { [Function: TruffleContract] _static_methods: { setProvider: [Function: setProvider], new: [Function: new], at: [Function: at], deployed: [Function: deployed], defaults: [Function: defaults], hasNetwork: [Function: hasNetwork], isDeployed: [Function: isDeployed], detectNetwork: [Function: detectNetwork], setNetwork: [Function: setNetwork], resetAddress: [Function: resetAddress], link: [Function: link], clone: [Function: clone], addProp: [Function: addProp], toJSON: [Function: toJSON] }, _properties: { contract_name: [Object], contractName: [Object], abi: [Object], network: [Function: network], networks: [Function: networks], address: [Object], links: [Function: links], events: [Function: events], binary: [Function: binary], deployedBinary: [Function: deployedBinary], unlinked_binary: [Object], bytecode: [Object], deployedBytecode: [Object], sourceMap: [Object], deployedSourceMap: [Object], source: [Object], sourcePath: [Object], ast: [Object], compiler: [Object], schema_version: [Function: schema_version], schemaVersion: [Function: schemaVersion], updated_at: [Function: updated_at], updatedAt: [Function: updatedAt] }, _property_values: {}, _json: { contractName: &#39;EncryptedToken&#39;, abi: [Array], bytecode: &#39;0x60606040526301406f40600055341561001757600080fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061023e8061006c6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029&#39;, deployedBytecode: &#39;0x60606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029&#39;, sourceMap: &#39;26:518:0:-;;;79:8;54:33;;132:74;;;;;;;;187:14;;164:8;:20;173:10;164:20;;;;;;;;;;;;;;;:37;;;;26:518;;;;;;&#39;, deployedSourceMap: &#39;26:518:0:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;245:165;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;499:7;521:8;:16;530:6;521:16;;;;;;;;;;;;;;;;514:23;;446:96;;;:::o;245:165::-;330:7;306:8;:20;315:10;306:20;;;;;;;;;;;;;;;;:31;;299:39;;;;;;368:7;344:8;:20;353:10;344:20;;;;;;;;;;;;;;;;:31;;;;;;;;;;;398:7;381:8;:13;390:3;381:13;;;;;;;;;;;;;;;;:24;;;;;;;;;;;245:165;;:::o&#39;, source: &#39;pragma solidity ^0.4.17;\n\ncontract EncryptedToken {\n uint256 INITIAL_SUPPLY = 21000000;\n mapping (address =&gt; uint256) balances;\n function EncryptedToken() {\n balances[msg.sender] = INITIAL_SUPPLY;\n }\n\n //转帐到一个指定的地址\n function transfer(address _to, uint256 _amount) {\n assert(balances[msg.sender] &gt;= _amount);\n balances[msg.sender] -= _amount;\n balances[_to] += _amount;\n }\n\n //查看指定地址的余额\n function balanceOf(address _owner) constant returns (uint256) {\n return balances[_owner];\n }\n}\n&#39;, sourcePath: &#39;/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol&#39;, ast: [Object], compiler: [Object], networks: [Object], schemaVersion: &#39;1.0.1&#39;, updatedAt: &#39;2018-01-11T08:57:36.557Z&#39; }, setProvider: [Function: bound setProvider], new: [Function: bound new], at: [Function: bound at], deployed: [Function: bound deployed], defaults: [Function: bound defaults], hasNetwork: [Function: bound hasNetwork], isDeployed: [Function: bound isDeployed], detectNetwork: [Function: bound detectNetwork], setNetwork: [Function: bound setNetwork], resetAddress: [Function: bound resetAddress], link: [Function: bound link], clone: [Function: bound clone], addProp: [Function: bound addProp], toJSON: [Function: bound toJSON], web3: Web3 { _requestManager: [RequestManager], currentProvider: [Provider], eth: [Eth], db: [DB], shh: [Shh], net: [Net], personal: [Personal], bzz: [Swarm], settings: [Settings], version: [Object], providers: [Object], _extend: [Function] }, class_defaults: { from: &#39;0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e&#39;, gas: 6721975, gasPrice: 100000000000 }, currentProvider: HttpProvider { host: &#39;http://localhost:8545&#39;, timeout: 0, user: undefined, password: undefined, send: [Function], sendAsync: [Function], _alreadyWrapped: true }, network_id: &#39;1515660380238&#39; }, abi: [ { constant: true, inputs: [Array], name: &#39;balanceOf&#39;, outputs: [Array], payable: false, stateMutability: &#39;view&#39;, type: &#39;function&#39; }, { constant: false, inputs: [Array], name: &#39;transfer&#39;, outputs: [], payable: false, stateMutability: &#39;nonpayable&#39;, type: &#39;function&#39; }, { inputs: [], payable: false, stateMutability: &#39;nonpayable&#39;, type: &#39;constructor&#39; } ], contract: Contract { _eth: Eth { _requestManager: [RequestManager], getBalance: [Function], getStorageAt: [Function], getCode: [Function], getBlock: [Function], getUncle: [Function], getCompilers: [Function], getBlockTransactionCount: [Function], getBlockUncleCount: [Function], getTransaction: [Function], getTransactionFromBlock: [Function], getTransactionReceipt: [Function], getTransactionCount: [Function], call: [Function], estimateGas: [Function], sendRawTransaction: [Function], signTransaction: [Function], sendTransaction: [Function], sign: [Function], compile: [Object], submitWork: [Function], getWork: [Function], coinbase: [Getter], getCoinbase: [Function], mining: [Getter], getMining: [Function], hashrate: [Getter], getHashrate: [Function], syncing: [Getter], getSyncing: [Function], gasPrice: [Getter], getGasPrice: [Function], accounts: [Getter], getAccounts: [Function], blockNumber: [Getter], getBlockNumber: [Function], protocolVersion: [Getter], getProtocolVersion: [Function], iban: [Function], sendIBANTransaction: [Function: bound transfer] }, transactionHash: null, address: &#39;0xeff776cc1aa2f01c40e638538fdfaadbfb179b00&#39;, abi: [ [Object], [Object], [Object] ], balanceOf: { [Function: bound ] request: [Function: bound ], call: [Function: bound ], sendTransaction: [Function: bound ], estimateGas: [Function: bound ], getData: [Function: bound ], address: [Circular] }, transfer: { [Function: bound ] request: [Function: bound ], call: [Function: bound ], sendTransaction: [Function: bound ], estimateGas: [Function: bound ], getData: [Function: bound ], &#39;address,uint256&#39;: [Circular] }, allEvents: [Function: bound ] }, balanceOf: { [Function] call: [Function], sendTransaction: [Function], request: [Function: bound ], estimateGas: [Function] }, transfer: { [Function] call: [Function], sendTransaction: [Function], request: [Function: bound ], estimateGas: [Function] }, sendTransaction: [Function], send: [Function], allEvents: [Function: bound ], address: &#39;0xeff776cc1aa2f01c40e638538fdfaadbfb179b00&#39;, transactionHash: null } 接下来，调用contract合约的balanceOf()函数和transfer()函数，验证结果正确。 truffle(development)&gt; contract.balanceOf(web3.eth.coinbase) BigNumber { s: 1, e: 7, c: [ 21000000 ] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[1]) BigNumber { s: 1, e: 0, c: [ 0 ] } truffle(development)&gt; contract.trans contract.transactionHash contract.transfer truffle(development)&gt; contract.transfer(web3.eth.accounts[1],100000000) Error: VM Exception while processing transaction: invalid opcode at Object.InvalidResponse (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:41484:16) at /home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:329530:36 at /home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:325200:9 at XMLHttpRequest.request.onreadystatechange (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:328229:7) at XMLHttpRequestEventTarget.dispatchEvent (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176415:18) at XMLHttpRequest._setReadyState (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176705:12) at XMLHttpRequest._onHttpResponseEnd (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176860:12) truffle(development)&gt; contract.transfer(web3.eth.accounts[1],100) { tx: &#39;0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339&#39;, receipt: { transactionHash: &#39;0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339&#39;, transactionIndex: 0, blockHash: &#39;0x430cd8a197cd900e20374d14e20ad655fa82d456ca31e896c937e3f2cb6b9005&#39;, blockNumber: 12, gasUsed: 49056, cumulativeGasUsed: 49056, contractAddress: null, logs: [], status: 1 }, logs: [] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[0]) BigNumber { s: 1, e: 7, c: [ 20999900 ] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[1]) BigNumber { s: 1, e: 2, c: [ 100 ] } truffle(development)&gt; 以上就是基于智能合约建立最简单的具有转账和查询钱包地址余额功能的代币教程。但是，逻辑中并没有对安全相关的操作进行处理，比如当余额不够时或者地址不合法等。 文章参考： http://blog.csdn.net/liyuechun520/article/details/78049950 阅读更多" />
<meta property="og:description" content="接上一篇编写智能合约的教程带你玩转以太坊智能合约的”Hello World”，我们现在要建立一个简单的代币系统，具备最简单的转账和查询功能。 启动testrpc测试环境 建立项目 编写智能合约 编译部署 合约验证 1.启动testrpc测试环境 sily@lyg-sily:~$ testrpc EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e (1) 0xfdc2bb26d860ac1f84f3f06826ab1da4b3ef30b6 (2) 0x60e468066c781c1864479fb20cae2698eacc784b (3) 0x2ea86e060b90cbe10cdba24e79496e6c46a483c7 (4) 0x51ada420bddc3a03c1294645784096bf663545b3 (5) 0xb8eaaf1449510e6d91229ddc6561d54a5dabef84 (6) 0xa1ab09f35f701ca1b91a8ae6ac800305a078e5ae (7) 0xc84468b9c9f2a3d4e9c3a7861caa77a7f12593dd (8) 0xd671b2eb8b0d0425b9dcc764bfee4fc8f19e6d5a (9) 0x0351bb8bd2033ae15b8aee1ddf7d037fe12fd88c Private Keys ================== (0) eee65f7557d7c1271a2cf5848d816770bfcb18dab7c353858487299be4cf3f71 (1) 4391df2085e6c810c5b3125f37c81287e4697ed4076f2cfbe10f90cc23ac15e7 (2) 0ef1c08f8be81d79420ee3af55e657716ad79a9495c24e10a6ff8864c141c0fc (3) da5766fd22e3b53b395d32ec9e544a15169f3ec54a1332c2146acf0002b37326 (4) fc4440a9fdc2e3bf9c6ab20107ef567433eaff1133d703c83fd26efb8b727ed3 (5) 88230785f8b2814659bc824b93e29bcf928e1af4371d53180fb276e8c8592402 (6) 3ce639e515d36811e45ccdd578732ec0799ba09156419d9c09a8b4a7029d70de (7) 59ca1ade2f0a701a7d1e14ec5b886e9a835fea7d0aedf7226fa83cfe52c1e1fd (8) c819bd2bdaeb8cc84f8b79ee0ff9089b99c725d6aca91ff793f2bc9c4df82243 (9) 376d808c1b708c126c45aa890ad4d208ac24cbe922fe5c97c952022e153423b4 HD Wallet ================== Mnemonic: negative sea robot enforce tube cattle public engage jewel grit install fatigue Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 2.建立项目 前面我们搭建了智能合约的testrpc测试环境，并通过truffle框架进行了简单的HelloWorld代码开发、编译、部署以及调用合约。接下来，我们要创建一个简单的代币，以继续熟悉truffle框架和solidity语法。 首先，回顾一下上次建立HelloWorld项目的命令： sily@lyg-sily:~$ mkdir SmartContractDemo sily@lyg-sily:~$ cd SmartContractDemo/ sily@lyg-sily:~/SmartContractDemo$ mkdir HelloWorld sily@lyg-sily:~/SmartContractDemo$ cd HelloWorld/ sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle init Downloading... Unpacking... Setting up... Unbox successful. Sweet! Commands: Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test sily@lyg-sily:~/SmartContractDemo/HelloWorld$ ls contracts migrations test truffle-config.js truffle.js sily@lyg-sily:~/SmartContractDemo/HelloWorld$ 3.编写智能合约 在项目下的contracts/文件夹中新建EncryptedToken.sol，内容如下： pragma solidity ^0.4.17; contract EncryptedToken { uint256 INITIAL_SUPPLY = 21000000; mapping (address =&gt; uint256) balances; function EncryptedToken() { balances[msg.sender] = INITIAL_SUPPLY; } //转帐到一个指定的地址 function transfer(address _to, uint256 _amount) { assert(balances[msg.sender] &gt;= _amount); balances[msg.sender] -= _amount; balances[_to] += _amount; } //查看指定地址的余额 function balanceOf(address _owner) constant returns (uint256) { return balances[_owner]; } } uint256 INITIAL_SUPPLY = 21000000声明变量,将当前合约的钱包地址代币数设置为21000000。 mapping(address =&gt; uint256) balances;声明了balances是一个key类型为address、value类型为uint256的键值对(mapping)。 function EncryptedToken()函数是EncryptedToken合约的构造函数(contructor)，当EncryptedToken合约调用时，会先执行构造函数中的内容。在构造函数中，会以当前部署合约的钱包地址为key，以INITIAL_SUPPLY为value初始化一个键值对。 transfer函数声明了转账到指定钱包地址的函数，_to是转账的目标地址，_amount表示转账金额。 assert断言确保当前钱包余额不少于要转账的金额时才能进行转账，否则会抛出异常。 balanceOf(address _owner)函数是用来查询指定钱包地址的余额，_owner即是指定的钱包地址，return (uint256)代表返回值的类型是uint256，constant关键字说明了函数是只读的，调用时不会消耗手续费。 4.编译部署 在migrations/目录下创建一个3_deploy_contract.js的文件。内容如下： var EncryptedToken = artifacts.require(&quot;./EncryptedToken.sol&quot;); module.exports = function(deployer) { deployer.deploy(EncryptedToken); } 然后我们执行truffle compile和truffle migrate命令： sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle compile Compiling ./contracts/EncryptedToken.sol... Compiling ./contracts/HelloWorld.sol... Compiling ./contracts/Migrations.sol... Compilation warnings encountered: /home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:6:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function EncryptedToken() { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:11:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function transfer(address _to, uint256 _amount) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:18:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function balanceOf(address _owner) constant returns (uint256) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:4:3: Warning: Function state mutability can be restricted to pure function sayHello() public constant returns (string) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:8:3: Warning: Function state mutability can be restricted to pure function echo(string name) public constant returns (string) { ^ Spanning multiple lines. Writing artifacts to ./build/contracts sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle migrate --reset Using network &#39;development&#39;. Running migration: 1_initial_migration.js Replacing Migrations... ... 0xfc5af4b443dcae96f96206e26d2bc93b9699e7d14980dd0247baea112bd04c44 Migrations: 0x9681bbaee9346afe05e7ceaf72b32d433b329090 Saving successful migration to network... ... 0x2155887e4c7037d33fbfbec1df073152ac72784a6a594886a066d412cf105b66 Saving artifacts... Running migration: 2_deploy_contracts.js Replacing HelloWorld... ... 0x9a4cd911a85438c4087ee7144dc2b0eeb9bf88f7985fcf56f9949b41b02f936a HelloWorld: 0x644fad81bc1075e4f39dc765f671f81ad363317c Saving successful migration to network... ... 0x19e5b97d493c652fc8f67c53c7a56899c8285127b2e70a1bfd41f7b8d35c067d Saving artifacts... Running migration: 3_deploy_contracts.js Deploying EncryptedToken... ... 0x3206c798ab3d0e0ca5e49865bb0cbd207513c1907539c5c921cc027125639a4e EncryptedToken: 0xeff776cc1aa2f01c40e638538fdfaadbfb179b00 Saving successful migration to network... ... 0x4fb48f957d364f77510f2acc82467dca4e70d268078db8418dfae78000523cd9 Saving artifacts... 5.合约验证 合约部署完成后，输入truffle console命令开启console控制台。在控制台中对已部署的合约进行验证。 web3.eth.coinbase或web3.eth.accounts[0]表示testrpc环境初始分配的首个钱包地址，也可以通过索引值获取其他9个钱包地址。 EncryptedToken.deployed().then(instance =&gt; contract = instance)声明了合约变量contract来存储EncryptedToken合约实例。 sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle console truffle(development)&gt; let contract; undefined truffle(development)&gt; EncryptedToken.deployed().then(instance =&gt; contract = instance) TruffleContract { constructor: { [Function: TruffleContract] _static_methods: { setProvider: [Function: setProvider], new: [Function: new], at: [Function: at], deployed: [Function: deployed], defaults: [Function: defaults], hasNetwork: [Function: hasNetwork], isDeployed: [Function: isDeployed], detectNetwork: [Function: detectNetwork], setNetwork: [Function: setNetwork], resetAddress: [Function: resetAddress], link: [Function: link], clone: [Function: clone], addProp: [Function: addProp], toJSON: [Function: toJSON] }, _properties: { contract_name: [Object], contractName: [Object], abi: [Object], network: [Function: network], networks: [Function: networks], address: [Object], links: [Function: links], events: [Function: events], binary: [Function: binary], deployedBinary: [Function: deployedBinary], unlinked_binary: [Object], bytecode: [Object], deployedBytecode: [Object], sourceMap: [Object], deployedSourceMap: [Object], source: [Object], sourcePath: [Object], ast: [Object], compiler: [Object], schema_version: [Function: schema_version], schemaVersion: [Function: schemaVersion], updated_at: [Function: updated_at], updatedAt: [Function: updatedAt] }, _property_values: {}, _json: { contractName: &#39;EncryptedToken&#39;, abi: [Array], bytecode: &#39;0x60606040526301406f40600055341561001757600080fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061023e8061006c6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029&#39;, deployedBytecode: &#39;0x60606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029&#39;, sourceMap: &#39;26:518:0:-;;;79:8;54:33;;132:74;;;;;;;;187:14;;164:8;:20;173:10;164:20;;;;;;;;;;;;;;;:37;;;;26:518;;;;;;&#39;, deployedSourceMap: &#39;26:518:0:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;245:165;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;499:7;521:8;:16;530:6;521:16;;;;;;;;;;;;;;;;514:23;;446:96;;;:::o;245:165::-;330:7;306:8;:20;315:10;306:20;;;;;;;;;;;;;;;;:31;;299:39;;;;;;368:7;344:8;:20;353:10;344:20;;;;;;;;;;;;;;;;:31;;;;;;;;;;;398:7;381:8;:13;390:3;381:13;;;;;;;;;;;;;;;;:24;;;;;;;;;;;245:165;;:::o&#39;, source: &#39;pragma solidity ^0.4.17;\n\ncontract EncryptedToken {\n uint256 INITIAL_SUPPLY = 21000000;\n mapping (address =&gt; uint256) balances;\n function EncryptedToken() {\n balances[msg.sender] = INITIAL_SUPPLY;\n }\n\n //转帐到一个指定的地址\n function transfer(address _to, uint256 _amount) {\n assert(balances[msg.sender] &gt;= _amount);\n balances[msg.sender] -= _amount;\n balances[_to] += _amount;\n }\n\n //查看指定地址的余额\n function balanceOf(address _owner) constant returns (uint256) {\n return balances[_owner];\n }\n}\n&#39;, sourcePath: &#39;/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol&#39;, ast: [Object], compiler: [Object], networks: [Object], schemaVersion: &#39;1.0.1&#39;, updatedAt: &#39;2018-01-11T08:57:36.557Z&#39; }, setProvider: [Function: bound setProvider], new: [Function: bound new], at: [Function: bound at], deployed: [Function: bound deployed], defaults: [Function: bound defaults], hasNetwork: [Function: bound hasNetwork], isDeployed: [Function: bound isDeployed], detectNetwork: [Function: bound detectNetwork], setNetwork: [Function: bound setNetwork], resetAddress: [Function: bound resetAddress], link: [Function: bound link], clone: [Function: bound clone], addProp: [Function: bound addProp], toJSON: [Function: bound toJSON], web3: Web3 { _requestManager: [RequestManager], currentProvider: [Provider], eth: [Eth], db: [DB], shh: [Shh], net: [Net], personal: [Personal], bzz: [Swarm], settings: [Settings], version: [Object], providers: [Object], _extend: [Function] }, class_defaults: { from: &#39;0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e&#39;, gas: 6721975, gasPrice: 100000000000 }, currentProvider: HttpProvider { host: &#39;http://localhost:8545&#39;, timeout: 0, user: undefined, password: undefined, send: [Function], sendAsync: [Function], _alreadyWrapped: true }, network_id: &#39;1515660380238&#39; }, abi: [ { constant: true, inputs: [Array], name: &#39;balanceOf&#39;, outputs: [Array], payable: false, stateMutability: &#39;view&#39;, type: &#39;function&#39; }, { constant: false, inputs: [Array], name: &#39;transfer&#39;, outputs: [], payable: false, stateMutability: &#39;nonpayable&#39;, type: &#39;function&#39; }, { inputs: [], payable: false, stateMutability: &#39;nonpayable&#39;, type: &#39;constructor&#39; } ], contract: Contract { _eth: Eth { _requestManager: [RequestManager], getBalance: [Function], getStorageAt: [Function], getCode: [Function], getBlock: [Function], getUncle: [Function], getCompilers: [Function], getBlockTransactionCount: [Function], getBlockUncleCount: [Function], getTransaction: [Function], getTransactionFromBlock: [Function], getTransactionReceipt: [Function], getTransactionCount: [Function], call: [Function], estimateGas: [Function], sendRawTransaction: [Function], signTransaction: [Function], sendTransaction: [Function], sign: [Function], compile: [Object], submitWork: [Function], getWork: [Function], coinbase: [Getter], getCoinbase: [Function], mining: [Getter], getMining: [Function], hashrate: [Getter], getHashrate: [Function], syncing: [Getter], getSyncing: [Function], gasPrice: [Getter], getGasPrice: [Function], accounts: [Getter], getAccounts: [Function], blockNumber: [Getter], getBlockNumber: [Function], protocolVersion: [Getter], getProtocolVersion: [Function], iban: [Function], sendIBANTransaction: [Function: bound transfer] }, transactionHash: null, address: &#39;0xeff776cc1aa2f01c40e638538fdfaadbfb179b00&#39;, abi: [ [Object], [Object], [Object] ], balanceOf: { [Function: bound ] request: [Function: bound ], call: [Function: bound ], sendTransaction: [Function: bound ], estimateGas: [Function: bound ], getData: [Function: bound ], address: [Circular] }, transfer: { [Function: bound ] request: [Function: bound ], call: [Function: bound ], sendTransaction: [Function: bound ], estimateGas: [Function: bound ], getData: [Function: bound ], &#39;address,uint256&#39;: [Circular] }, allEvents: [Function: bound ] }, balanceOf: { [Function] call: [Function], sendTransaction: [Function], request: [Function: bound ], estimateGas: [Function] }, transfer: { [Function] call: [Function], sendTransaction: [Function], request: [Function: bound ], estimateGas: [Function] }, sendTransaction: [Function], send: [Function], allEvents: [Function: bound ], address: &#39;0xeff776cc1aa2f01c40e638538fdfaadbfb179b00&#39;, transactionHash: null } 接下来，调用contract合约的balanceOf()函数和transfer()函数，验证结果正确。 truffle(development)&gt; contract.balanceOf(web3.eth.coinbase) BigNumber { s: 1, e: 7, c: [ 21000000 ] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[1]) BigNumber { s: 1, e: 0, c: [ 0 ] } truffle(development)&gt; contract.trans contract.transactionHash contract.transfer truffle(development)&gt; contract.transfer(web3.eth.accounts[1],100000000) Error: VM Exception while processing transaction: invalid opcode at Object.InvalidResponse (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:41484:16) at /home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:329530:36 at /home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:325200:9 at XMLHttpRequest.request.onreadystatechange (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:328229:7) at XMLHttpRequestEventTarget.dispatchEvent (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176415:18) at XMLHttpRequest._setReadyState (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176705:12) at XMLHttpRequest._onHttpResponseEnd (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176860:12) truffle(development)&gt; contract.transfer(web3.eth.accounts[1],100) { tx: &#39;0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339&#39;, receipt: { transactionHash: &#39;0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339&#39;, transactionIndex: 0, blockHash: &#39;0x430cd8a197cd900e20374d14e20ad655fa82d456ca31e896c937e3f2cb6b9005&#39;, blockNumber: 12, gasUsed: 49056, cumulativeGasUsed: 49056, contractAddress: null, logs: [], status: 1 }, logs: [] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[0]) BigNumber { s: 1, e: 7, c: [ 20999900 ] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[1]) BigNumber { s: 1, e: 2, c: [ 100 ] } truffle(development)&gt; 以上就是基于智能合约建立最简单的具有转账和查询钱包地址余额功能的代币教程。但是，逻辑中并没有对安全相关的操作进行处理，比如当余额不够时或者地址不合法等。 文章参考： http://blog.csdn.net/liyuechun520/article/details/78049950 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/01/11/e93d30aff484f0e55e7bf639f919e2c3.html" />
<meta property="og:url" content="https://mlh.app/2018/01/11/e93d30aff484f0e55e7bf639f919e2c3.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-11T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"接上一篇编写智能合约的教程带你玩转以太坊智能合约的”Hello World”，我们现在要建立一个简单的代币系统，具备最简单的转账和查询功能。 启动testrpc测试环境 建立项目 编写智能合约 编译部署 合约验证 1.启动testrpc测试环境 sily@lyg-sily:~$ testrpc EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e (1) 0xfdc2bb26d860ac1f84f3f06826ab1da4b3ef30b6 (2) 0x60e468066c781c1864479fb20cae2698eacc784b (3) 0x2ea86e060b90cbe10cdba24e79496e6c46a483c7 (4) 0x51ada420bddc3a03c1294645784096bf663545b3 (5) 0xb8eaaf1449510e6d91229ddc6561d54a5dabef84 (6) 0xa1ab09f35f701ca1b91a8ae6ac800305a078e5ae (7) 0xc84468b9c9f2a3d4e9c3a7861caa77a7f12593dd (8) 0xd671b2eb8b0d0425b9dcc764bfee4fc8f19e6d5a (9) 0x0351bb8bd2033ae15b8aee1ddf7d037fe12fd88c Private Keys ================== (0) eee65f7557d7c1271a2cf5848d816770bfcb18dab7c353858487299be4cf3f71 (1) 4391df2085e6c810c5b3125f37c81287e4697ed4076f2cfbe10f90cc23ac15e7 (2) 0ef1c08f8be81d79420ee3af55e657716ad79a9495c24e10a6ff8864c141c0fc (3) da5766fd22e3b53b395d32ec9e544a15169f3ec54a1332c2146acf0002b37326 (4) fc4440a9fdc2e3bf9c6ab20107ef567433eaff1133d703c83fd26efb8b727ed3 (5) 88230785f8b2814659bc824b93e29bcf928e1af4371d53180fb276e8c8592402 (6) 3ce639e515d36811e45ccdd578732ec0799ba09156419d9c09a8b4a7029d70de (7) 59ca1ade2f0a701a7d1e14ec5b886e9a835fea7d0aedf7226fa83cfe52c1e1fd (8) c819bd2bdaeb8cc84f8b79ee0ff9089b99c725d6aca91ff793f2bc9c4df82243 (9) 376d808c1b708c126c45aa890ad4d208ac24cbe922fe5c97c952022e153423b4 HD Wallet ================== Mnemonic: negative sea robot enforce tube cattle public engage jewel grit install fatigue Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 2.建立项目 前面我们搭建了智能合约的testrpc测试环境，并通过truffle框架进行了简单的HelloWorld代码开发、编译、部署以及调用合约。接下来，我们要创建一个简单的代币，以继续熟悉truffle框架和solidity语法。 首先，回顾一下上次建立HelloWorld项目的命令： sily@lyg-sily:~$ mkdir SmartContractDemo sily@lyg-sily:~$ cd SmartContractDemo/ sily@lyg-sily:~/SmartContractDemo$ mkdir HelloWorld sily@lyg-sily:~/SmartContractDemo$ cd HelloWorld/ sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle init Downloading... Unpacking... Setting up... Unbox successful. Sweet! Commands: Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test sily@lyg-sily:~/SmartContractDemo/HelloWorld$ ls contracts migrations test truffle-config.js truffle.js sily@lyg-sily:~/SmartContractDemo/HelloWorld$ 3.编写智能合约 在项目下的contracts/文件夹中新建EncryptedToken.sol，内容如下： pragma solidity ^0.4.17; contract EncryptedToken { uint256 INITIAL_SUPPLY = 21000000; mapping (address =&gt; uint256) balances; function EncryptedToken() { balances[msg.sender] = INITIAL_SUPPLY; } //转帐到一个指定的地址 function transfer(address _to, uint256 _amount) { assert(balances[msg.sender] &gt;= _amount); balances[msg.sender] -= _amount; balances[_to] += _amount; } //查看指定地址的余额 function balanceOf(address _owner) constant returns (uint256) { return balances[_owner]; } } uint256 INITIAL_SUPPLY = 21000000声明变量,将当前合约的钱包地址代币数设置为21000000。 mapping(address =&gt; uint256) balances;声明了balances是一个key类型为address、value类型为uint256的键值对(mapping)。 function EncryptedToken()函数是EncryptedToken合约的构造函数(contructor)，当EncryptedToken合约调用时，会先执行构造函数中的内容。在构造函数中，会以当前部署合约的钱包地址为key，以INITIAL_SUPPLY为value初始化一个键值对。 transfer函数声明了转账到指定钱包地址的函数，_to是转账的目标地址，_amount表示转账金额。 assert断言确保当前钱包余额不少于要转账的金额时才能进行转账，否则会抛出异常。 balanceOf(address _owner)函数是用来查询指定钱包地址的余额，_owner即是指定的钱包地址，return (uint256)代表返回值的类型是uint256，constant关键字说明了函数是只读的，调用时不会消耗手续费。 4.编译部署 在migrations/目录下创建一个3_deploy_contract.js的文件。内容如下： var EncryptedToken = artifacts.require(&quot;./EncryptedToken.sol&quot;); module.exports = function(deployer) { deployer.deploy(EncryptedToken); } 然后我们执行truffle compile和truffle migrate命令： sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle compile Compiling ./contracts/EncryptedToken.sol... Compiling ./contracts/HelloWorld.sol... Compiling ./contracts/Migrations.sol... Compilation warnings encountered: /home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:6:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function EncryptedToken() { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:11:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function transfer(address _to, uint256 _amount) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:18:3: Warning: No visibility specified. Defaulting to &quot;public&quot;. function balanceOf(address _owner) constant returns (uint256) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:4:3: Warning: Function state mutability can be restricted to pure function sayHello() public constant returns (string) { ^ Spanning multiple lines. ,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:8:3: Warning: Function state mutability can be restricted to pure function echo(string name) public constant returns (string) { ^ Spanning multiple lines. Writing artifacts to ./build/contracts sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle migrate --reset Using network &#39;development&#39;. Running migration: 1_initial_migration.js Replacing Migrations... ... 0xfc5af4b443dcae96f96206e26d2bc93b9699e7d14980dd0247baea112bd04c44 Migrations: 0x9681bbaee9346afe05e7ceaf72b32d433b329090 Saving successful migration to network... ... 0x2155887e4c7037d33fbfbec1df073152ac72784a6a594886a066d412cf105b66 Saving artifacts... Running migration: 2_deploy_contracts.js Replacing HelloWorld... ... 0x9a4cd911a85438c4087ee7144dc2b0eeb9bf88f7985fcf56f9949b41b02f936a HelloWorld: 0x644fad81bc1075e4f39dc765f671f81ad363317c Saving successful migration to network... ... 0x19e5b97d493c652fc8f67c53c7a56899c8285127b2e70a1bfd41f7b8d35c067d Saving artifacts... Running migration: 3_deploy_contracts.js Deploying EncryptedToken... ... 0x3206c798ab3d0e0ca5e49865bb0cbd207513c1907539c5c921cc027125639a4e EncryptedToken: 0xeff776cc1aa2f01c40e638538fdfaadbfb179b00 Saving successful migration to network... ... 0x4fb48f957d364f77510f2acc82467dca4e70d268078db8418dfae78000523cd9 Saving artifacts... 5.合约验证 合约部署完成后，输入truffle console命令开启console控制台。在控制台中对已部署的合约进行验证。 web3.eth.coinbase或web3.eth.accounts[0]表示testrpc环境初始分配的首个钱包地址，也可以通过索引值获取其他9个钱包地址。 EncryptedToken.deployed().then(instance =&gt; contract = instance)声明了合约变量contract来存储EncryptedToken合约实例。 sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle console truffle(development)&gt; let contract; undefined truffle(development)&gt; EncryptedToken.deployed().then(instance =&gt; contract = instance) TruffleContract { constructor: { [Function: TruffleContract] _static_methods: { setProvider: [Function: setProvider], new: [Function: new], at: [Function: at], deployed: [Function: deployed], defaults: [Function: defaults], hasNetwork: [Function: hasNetwork], isDeployed: [Function: isDeployed], detectNetwork: [Function: detectNetwork], setNetwork: [Function: setNetwork], resetAddress: [Function: resetAddress], link: [Function: link], clone: [Function: clone], addProp: [Function: addProp], toJSON: [Function: toJSON] }, _properties: { contract_name: [Object], contractName: [Object], abi: [Object], network: [Function: network], networks: [Function: networks], address: [Object], links: [Function: links], events: [Function: events], binary: [Function: binary], deployedBinary: [Function: deployedBinary], unlinked_binary: [Object], bytecode: [Object], deployedBytecode: [Object], sourceMap: [Object], deployedSourceMap: [Object], source: [Object], sourcePath: [Object], ast: [Object], compiler: [Object], schema_version: [Function: schema_version], schemaVersion: [Function: schemaVersion], updated_at: [Function: updated_at], updatedAt: [Function: updatedAt] }, _property_values: {}, _json: { contractName: &#39;EncryptedToken&#39;, abi: [Array], bytecode: &#39;0x60606040526301406f40600055341561001757600080fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061023e8061006c6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029&#39;, deployedBytecode: &#39;0x60606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029&#39;, sourceMap: &#39;26:518:0:-;;;79:8;54:33;;132:74;;;;;;;;187:14;;164:8;:20;173:10;164:20;;;;;;;;;;;;;;;:37;;;;26:518;;;;;;&#39;, deployedSourceMap: &#39;26:518:0:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;245:165;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;499:7;521:8;:16;530:6;521:16;;;;;;;;;;;;;;;;514:23;;446:96;;;:::o;245:165::-;330:7;306:8;:20;315:10;306:20;;;;;;;;;;;;;;;;:31;;299:39;;;;;;368:7;344:8;:20;353:10;344:20;;;;;;;;;;;;;;;;:31;;;;;;;;;;;398:7;381:8;:13;390:3;381:13;;;;;;;;;;;;;;;;:24;;;;;;;;;;;245:165;;:::o&#39;, source: &#39;pragma solidity ^0.4.17;\\n\\ncontract EncryptedToken {\\n uint256 INITIAL_SUPPLY = 21000000;\\n mapping (address =&gt; uint256) balances;\\n function EncryptedToken() {\\n balances[msg.sender] = INITIAL_SUPPLY;\\n }\\n\\n //转帐到一个指定的地址\\n function transfer(address _to, uint256 _amount) {\\n assert(balances[msg.sender] &gt;= _amount);\\n balances[msg.sender] -= _amount;\\n balances[_to] += _amount;\\n }\\n\\n //查看指定地址的余额\\n function balanceOf(address _owner) constant returns (uint256) {\\n return balances[_owner];\\n }\\n}\\n&#39;, sourcePath: &#39;/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol&#39;, ast: [Object], compiler: [Object], networks: [Object], schemaVersion: &#39;1.0.1&#39;, updatedAt: &#39;2018-01-11T08:57:36.557Z&#39; }, setProvider: [Function: bound setProvider], new: [Function: bound new], at: [Function: bound at], deployed: [Function: bound deployed], defaults: [Function: bound defaults], hasNetwork: [Function: bound hasNetwork], isDeployed: [Function: bound isDeployed], detectNetwork: [Function: bound detectNetwork], setNetwork: [Function: bound setNetwork], resetAddress: [Function: bound resetAddress], link: [Function: bound link], clone: [Function: bound clone], addProp: [Function: bound addProp], toJSON: [Function: bound toJSON], web3: Web3 { _requestManager: [RequestManager], currentProvider: [Provider], eth: [Eth], db: [DB], shh: [Shh], net: [Net], personal: [Personal], bzz: [Swarm], settings: [Settings], version: [Object], providers: [Object], _extend: [Function] }, class_defaults: { from: &#39;0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e&#39;, gas: 6721975, gasPrice: 100000000000 }, currentProvider: HttpProvider { host: &#39;http://localhost:8545&#39;, timeout: 0, user: undefined, password: undefined, send: [Function], sendAsync: [Function], _alreadyWrapped: true }, network_id: &#39;1515660380238&#39; }, abi: [ { constant: true, inputs: [Array], name: &#39;balanceOf&#39;, outputs: [Array], payable: false, stateMutability: &#39;view&#39;, type: &#39;function&#39; }, { constant: false, inputs: [Array], name: &#39;transfer&#39;, outputs: [], payable: false, stateMutability: &#39;nonpayable&#39;, type: &#39;function&#39; }, { inputs: [], payable: false, stateMutability: &#39;nonpayable&#39;, type: &#39;constructor&#39; } ], contract: Contract { _eth: Eth { _requestManager: [RequestManager], getBalance: [Function], getStorageAt: [Function], getCode: [Function], getBlock: [Function], getUncle: [Function], getCompilers: [Function], getBlockTransactionCount: [Function], getBlockUncleCount: [Function], getTransaction: [Function], getTransactionFromBlock: [Function], getTransactionReceipt: [Function], getTransactionCount: [Function], call: [Function], estimateGas: [Function], sendRawTransaction: [Function], signTransaction: [Function], sendTransaction: [Function], sign: [Function], compile: [Object], submitWork: [Function], getWork: [Function], coinbase: [Getter], getCoinbase: [Function], mining: [Getter], getMining: [Function], hashrate: [Getter], getHashrate: [Function], syncing: [Getter], getSyncing: [Function], gasPrice: [Getter], getGasPrice: [Function], accounts: [Getter], getAccounts: [Function], blockNumber: [Getter], getBlockNumber: [Function], protocolVersion: [Getter], getProtocolVersion: [Function], iban: [Function], sendIBANTransaction: [Function: bound transfer] }, transactionHash: null, address: &#39;0xeff776cc1aa2f01c40e638538fdfaadbfb179b00&#39;, abi: [ [Object], [Object], [Object] ], balanceOf: { [Function: bound ] request: [Function: bound ], call: [Function: bound ], sendTransaction: [Function: bound ], estimateGas: [Function: bound ], getData: [Function: bound ], address: [Circular] }, transfer: { [Function: bound ] request: [Function: bound ], call: [Function: bound ], sendTransaction: [Function: bound ], estimateGas: [Function: bound ], getData: [Function: bound ], &#39;address,uint256&#39;: [Circular] }, allEvents: [Function: bound ] }, balanceOf: { [Function] call: [Function], sendTransaction: [Function], request: [Function: bound ], estimateGas: [Function] }, transfer: { [Function] call: [Function], sendTransaction: [Function], request: [Function: bound ], estimateGas: [Function] }, sendTransaction: [Function], send: [Function], allEvents: [Function: bound ], address: &#39;0xeff776cc1aa2f01c40e638538fdfaadbfb179b00&#39;, transactionHash: null } 接下来，调用contract合约的balanceOf()函数和transfer()函数，验证结果正确。 truffle(development)&gt; contract.balanceOf(web3.eth.coinbase) BigNumber { s: 1, e: 7, c: [ 21000000 ] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[1]) BigNumber { s: 1, e: 0, c: [ 0 ] } truffle(development)&gt; contract.trans contract.transactionHash contract.transfer truffle(development)&gt; contract.transfer(web3.eth.accounts[1],100000000) Error: VM Exception while processing transaction: invalid opcode at Object.InvalidResponse (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:41484:16) at /home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:329530:36 at /home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:325200:9 at XMLHttpRequest.request.onreadystatechange (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:328229:7) at XMLHttpRequestEventTarget.dispatchEvent (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176415:18) at XMLHttpRequest._setReadyState (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176705:12) at XMLHttpRequest._onHttpResponseEnd (/home/sily/.nvm/nvm/versions/node/v9.3.0/lib/node_modules/truffle/build/cli.bundled.js:176860:12) truffle(development)&gt; contract.transfer(web3.eth.accounts[1],100) { tx: &#39;0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339&#39;, receipt: { transactionHash: &#39;0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339&#39;, transactionIndex: 0, blockHash: &#39;0x430cd8a197cd900e20374d14e20ad655fa82d456ca31e896c937e3f2cb6b9005&#39;, blockNumber: 12, gasUsed: 49056, cumulativeGasUsed: 49056, contractAddress: null, logs: [], status: 1 }, logs: [] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[0]) BigNumber { s: 1, e: 7, c: [ 20999900 ] } truffle(development)&gt; contract.balanceOf(web3.eth.accounts[1]) BigNumber { s: 1, e: 2, c: [ 100 ] } truffle(development)&gt; 以上就是基于智能合约建立最简单的具有转账和查询钱包地址余额功能的代币教程。但是，逻辑中并没有对安全相关的操作进行处理，比如当余额不够时或者地址不合法等。 文章参考： http://blog.csdn.net/liyuechun520/article/details/78049950 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/01/11/e93d30aff484f0e55e7bf639f919e2c3.html","headline":"基于智能合约建立简易代币","dateModified":"2018-01-11T00:00:00+08:00","datePublished":"2018-01-11T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/01/11/e93d30aff484f0e55e7bf639f919e2c3.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>基于智能合约建立简易代币</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>接上一篇编写智能合约的教程<a href="http://blog.csdn.net/rectsuly/article/details/79028766" rel="nofollow">带你玩转以太坊智能合约的”Hello World”</a>，我们现在要建立一个简单的代币系统，具备最简单的转账和查询功能。</p> 
  <p></p>
  <div class="toc"> 
   <ul> 
    <li>
     <ul> 
      <li><a href="#1启动testrpc测试环境" rel="nofollow">启动testrpc测试环境</a></li> 
      <li><a href="#2建立项目" rel="nofollow">建立项目</a></li> 
      <li><a href="#3编写智能合约" rel="nofollow">编写智能合约</a></li> 
      <li><a href="#4编译部署" rel="nofollow">编译部署</a></li> 
      <li><a href="#5合约验证" rel="nofollow">合约验证</a></li> 
     </ul> </li> 
   </ul> 
  </div> 
  <p></p> 
  <h2 id="1启动testrpc测试环境">1.启动testrpc测试环境</h2> 
  <pre class="prettyprint"><code class=" hljs asciidoc">sily@lyg-sily:~$ testrpc
EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2)

<span class="hljs-header">Available Accounts ==================</span>
(0) 0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e
(1) 0xfdc2bb26d860ac1f84f3f06826ab1da4b3ef30b6
(2) 0x60e468066c781c1864479fb20cae2698eacc784b
(3) 0x2ea86e060b90cbe10cdba24e79496e6c46a483c7
(4) 0x51ada420bddc3a03c1294645784096bf663545b3
(5) 0xb8eaaf1449510e6d91229ddc6561d54a5dabef84
(6) 0xa1ab09f35f701ca1b91a8ae6ac800305a078e5ae
(7) 0xc84468b9c9f2a3d4e9c3a7861caa77a7f12593dd
(8) 0xd671b2eb8b0d0425b9dcc764bfee4fc8f19e6d5a
(9) 0x0351bb8bd2033ae15b8aee1ddf7d037fe12fd88c

<span class="hljs-header">Private Keys ==================</span>
(0) eee65f7557d7c1271a2cf5848d816770bfcb18dab7c353858487299be4cf3f71
(1) 4391df2085e6c810c5b3125f37c81287e4697ed4076f2cfbe10f90cc23ac15e7
(2) 0ef1c08f8be81d79420ee3af55e657716ad79a9495c24e10a6ff8864c141c0fc
(3) da5766fd22e3b53b395d32ec9e544a15169f3ec54a1332c2146acf0002b37326
(4) fc4440a9fdc2e3bf9c6ab20107ef567433eaff1133d703c83fd26efb8b727ed3
(5) 88230785f8b2814659bc824b93e29bcf928e1af4371d53180fb276e8c8592402
(6) 3ce639e515d36811e45ccdd578732ec0799ba09156419d9c09a8b4a7029d70de
(7) 59ca1ade2f0a701a7d1e14ec5b886e9a835fea7d0aedf7226fa83cfe52c1e1fd
(8) c819bd2bdaeb8cc84f8b79ee0ff9089b99c725d6aca91ff793f2bc9c4df82243
(9) 376d808c1b708c126c45aa890ad4d208ac24cbe922fe5c97c952022e153423b4

<span class="hljs-header">HD Wallet ==================</span>
Mnemonic:      negative sea robot enforce tube cattle public engage jewel grit install fatigue
Base HD Path:  m/44'/60'/0'/0/{account<span class="hljs-emphasis">_index} </span>Listening on localhost:8545</code></pre> 
  <h2 id="2建立项目">2.建立项目</h2> 
  <p>前面我们搭建了智能合约的<code>testrpc</code>测试环境，并通过<code>truffle</code>框架进行了简单的<code>HelloWorld</code>代码开发、编译、部署以及调用合约。接下来，我们要创建一个简单的代币，以继续熟悉<code>truffle</code>框架和<code>solidity</code>语法。</p> 
  <p>首先，回顾一下上次建立<code>HelloWorld</code>项目的命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">sily@lyg<span class="hljs-attribute">-sily</span>:~$ mkdir SmartContractDemo
sily@lyg<span class="hljs-attribute">-sily</span>:~$ cd SmartContractDemo<span class="hljs-subst">/</span>
sily@lyg<span class="hljs-attribute">-sily</span>:~/SmartContractDemo$ mkdir HelloWorld
sily@lyg<span class="hljs-attribute">-sily</span>:~/SmartContractDemo$ cd HelloWorld<span class="hljs-subst">/</span>
sily@lyg<span class="hljs-attribute">-sily</span>:~/SmartContractDemo/HelloWorld$ truffle init
Downloading<span class="hljs-attribute">...</span>
Unpacking<span class="hljs-attribute">...</span>
Setting up<span class="hljs-attribute">...</span>
Unbox successful<span class="hljs-built_in">.</span> Sweet<span class="hljs-subst">!</span>

Commands:

  Compile:        truffle compile
  Migrate:        truffle migrate
  Test contracts: truffle test
sily@lyg<span class="hljs-attribute">-sily</span>:~/SmartContractDemo/HelloWorld$ ls
contracts  migrations  test  truffle<span class="hljs-attribute">-config</span><span class="hljs-built_in">.</span>js  truffle<span class="hljs-built_in">.</span>js
sily@lyg<span class="hljs-attribute">-sily</span>:~/SmartContractDemo/HelloWorld$ </code></pre> 
  <h2 id="3编写智能合约">3.编写智能合约</h2> 
  <p>在项目下的<code>contracts/</code>文件夹中新建<code>EncryptedToken.sol</code>，内容如下：</p> 
  <pre class="prettyprint"><code class=" hljs php">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.17</span>;

contract EncryptedToken {
  uint256 INITIAL_SUPPLY = <span class="hljs-number">21000000</span>;
  mapping (address =&gt; uint256) balances;
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EncryptedToken</span><span class="hljs-params">()</span> {</span>
    balances[msg.sender] = INITIAL_SUPPLY;
  }

  <span class="hljs-comment">//转帐到一个指定的地址</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transfer</span><span class="hljs-params">(address _to, uint256 _amount)</span> {</span>
    assert(balances[msg.sender] &gt;= _amount);
    balances[msg.sender] -= _amount;
    balances[_to] += _amount;
  }

  <span class="hljs-comment">//查看指定地址的余额</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">balanceOf</span><span class="hljs-params">(address _owner)</span> <span class="hljs-title">constant</span> <span class="hljs-title">returns</span> <span class="hljs-params">(uint256)</span> {</span>
    <span class="hljs-keyword">return</span> balances[_owner];
  }
}</code></pre> 
  <p><code>uint256 INITIAL_SUPPLY = 21000000</code>声明变量,将当前合约的钱包地址代币数设置为21000000。</p> 
  <p><code>mapping(address =&gt; uint256) balances;</code>声明了<code>balances</code>是一个<code>key</code>类型为<code>address</code>、<code>value</code>类型为<code>uint256</code>的键值对(mapping)。</p> 
  <p><code>function EncryptedToken()</code>函数是<code>EncryptedToken</code>合约的构造函数(contructor)，当<code>EncryptedToken</code>合约调用时，会先执行构造函数中的内容。在构造函数中，会以当前部署合约的钱包地址为<code>key</code>，以<code>INITIAL_SUPPLY</code>为<code>value</code>初始化一个键值对。</p> 
  <p><code>transfer</code>函数声明了转账到指定钱包地址的函数，<code>_to</code>是转账的目标地址，<code>_amount</code>表示转账金额。</p> 
  <p><code>assert</code>断言确保当前钱包余额不少于要转账的金额时才能进行转账，否则会抛出异常。</p> 
  <p><code>balanceOf(address _owner)</code>函数是用来查询指定钱包地址的余额，<code>_owner</code>即是指定的钱包地址，<code>return (uint256)</code>代表返回值的类型是<code>uint256</code>，<code>constant</code>关键字说明了函数是只读的，调用时不会消耗手续费。</p> 
  <h2 id="4编译部署">4.编译部署</h2> 
  <p>在<code>migrations/</code>目录下创建一个<code>3_deploy_contract.js</code>的文件。内容如下：</p> 
  <pre class="prettyprint"><code class=" hljs lua">var EncryptedToken = artifacts.<span class="hljs-built_in">require</span>(<span class="hljs-string">"./EncryptedToken.sol"</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(deployer)</span></span> {
    deployer.deploy(EncryptedToken);
}</code></pre> 
  <p>然后我们执行<code>truffle compile</code>和<code>truffle migrate</code>命令：</p> 
  <pre class="prettyprint"><code class=" hljs r">sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle compile
Compiling ./contracts/EncryptedToken.sol...
Compiling ./contracts/HelloWorld.sol...
Compiling ./contracts/Migrations.sol...

Compilation warnings encountered:

/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:<span class="hljs-number">6</span>:<span class="hljs-number">3</span>: Warning: No visibility specified. Defaulting to <span class="hljs-string">"public"</span>.
  <span class="hljs-keyword">function</span> EncryptedToken() {
  ^
Spanning multiple lines.
,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:<span class="hljs-number">11</span>:<span class="hljs-number">3</span>: Warning: No visibility specified. Defaulting to <span class="hljs-string">"public"</span>.
  <span class="hljs-keyword">function</span> transfer(address _to, uint256 _amount) {
  ^
Spanning multiple lines.
,/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol:<span class="hljs-number">18</span>:<span class="hljs-number">3</span>: Warning: No visibility specified. Defaulting to <span class="hljs-string">"public"</span>.
  <span class="hljs-keyword">function</span> balanceOf(address _owner) constant returns (uint256) {
  ^
Spanning multiple lines.
,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:<span class="hljs-number">4</span>:<span class="hljs-number">3</span>: Warning: Function state mutability can be restricted to pure
  <span class="hljs-keyword">function</span> sayHello() public constant returns (string) {
  ^
Spanning multiple lines.
,/home/sily/SmartContractDemo/HelloWorld/contracts/HelloWorld.sol:<span class="hljs-number">8</span>:<span class="hljs-number">3</span>: Warning: Function state mutability can be restricted to pure
  <span class="hljs-keyword">function</span> echo(string name) public constant returns (string) {
  ^
Spanning multiple lines.

Writing artifacts to ./build/contracts

sily@lyg-sily:~/SmartContractDemo/HelloWorld$ truffle migrate --reset
Using network <span class="hljs-string">'development'</span>.

Running migration: 1_initial_migration.js
  Replacing Migrations...
  <span class="hljs-keyword">...</span> <span class="hljs-number">0xfc5af4b443dcae96f96206e26d2bc93b9699e7d14980dd0247baea112bd04c44</span>
  Migrations: <span class="hljs-number">0x9681bbaee9346afe05e7ceaf72b32d433b329090</span>
Saving successful migration to network...
  <span class="hljs-keyword">...</span> <span class="hljs-number">0x2155887e4c7037d33fbfbec1df073152ac72784a6a594886a066d412cf105b66</span>
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing HelloWorld...
  <span class="hljs-keyword">...</span> <span class="hljs-number">0x9a4cd911a85438c4087ee7144dc2b0eeb9bf88f7985fcf56f9949b41b02f936a</span>
  HelloWorld: <span class="hljs-number">0x644fad81bc1075e4f39dc765f671f81ad363317c</span>
Saving successful migration to network...
  <span class="hljs-keyword">...</span> <span class="hljs-number">0x19e5b97d493c652fc8f67c53c7a56899c8285127b2e70a1bfd41f7b8d35c067d</span>
Saving artifacts...
Running migration: 3_deploy_contracts.js
  Deploying EncryptedToken...
  <span class="hljs-keyword">...</span> <span class="hljs-number">0x3206c798ab3d0e0ca5e49865bb0cbd207513c1907539c5c921cc027125639a4e</span>
  EncryptedToken: <span class="hljs-number">0xeff776cc1aa2f01c40e638538fdfaadbfb179b00</span>
Saving successful migration to network...
  <span class="hljs-keyword">...</span> <span class="hljs-number">0x4fb48f957d364f77510f2acc82467dca4e70d268078db8418dfae78000523cd9</span>
Saving artifacts...</code></pre> 
  <h2 id="5合约验证">5.合约验证</h2> 
  <p>合约部署完成后，输入<code>truffle console</code>命令开启<code>console</code>控制台。在控制台中对已部署的合约进行验证。</p> 
  <p><code>web3.eth.coinbase</code>或<code>web3.eth.accounts[0]</code>表示<code>testrpc</code>环境初始分配的首个钱包地址，也可以通过索引值获取其他9个钱包地址。</p> 
  <p><code>EncryptedToken.deployed().then(instance =&gt; contract = instance)</code>声明了合约变量<code>contract</code>来存储<code>EncryptedToken</code>合约实例。</p> 
  <pre class="prettyprint"><code class=" hljs javascript">sily@lyg-sily:~<span class="hljs-regexp">/SmartContractDemo/</span>HelloWorld$ truffle console
truffle(development)&gt; <span class="hljs-keyword">let</span> contract;
<span class="hljs-literal">undefined</span>
truffle(development)&gt; EncryptedToken.deployed().then(instance =&gt; contract = instance)
TruffleContract {
  constructor: 
   { [<span class="hljs-built_in">Function</span>: TruffleContract]
     _static_methods: 
      { setProvider: [<span class="hljs-built_in">Function</span>: setProvider],
        <span class="hljs-keyword">new</span>: [<span class="hljs-built_in">Function</span>: <span class="hljs-keyword">new</span>],
        at: [<span class="hljs-built_in">Function</span>: at],
        deployed: [<span class="hljs-built_in">Function</span>: deployed],
        defaults: [<span class="hljs-built_in">Function</span>: defaults],
        hasNetwork: [<span class="hljs-built_in">Function</span>: hasNetwork],
        isDeployed: [<span class="hljs-built_in">Function</span>: isDeployed],
        detectNetwork: [<span class="hljs-built_in">Function</span>: detectNetwork],
        setNetwork: [<span class="hljs-built_in">Function</span>: setNetwork],
        resetAddress: [<span class="hljs-built_in">Function</span>: resetAddress],
        link: [<span class="hljs-built_in">Function</span>: link],
        clone: [<span class="hljs-built_in">Function</span>: clone],
        addProp: [<span class="hljs-built_in">Function</span>: addProp],
        toJSON: [<span class="hljs-built_in">Function</span>: toJSON] },
     _properties: 
      { contract_name: [<span class="hljs-built_in">Object</span>],
        contractName: [<span class="hljs-built_in">Object</span>],
        abi: [<span class="hljs-built_in">Object</span>],
        network: [<span class="hljs-built_in">Function</span>: network],
        networks: [<span class="hljs-built_in">Function</span>: networks],
        address: [<span class="hljs-built_in">Object</span>],
        links: [<span class="hljs-built_in">Function</span>: links],
        events: [<span class="hljs-built_in">Function</span>: events],
        binary: [<span class="hljs-built_in">Function</span>: binary],
        deployedBinary: [<span class="hljs-built_in">Function</span>: deployedBinary],
        unlinked_binary: [<span class="hljs-built_in">Object</span>],
        bytecode: [<span class="hljs-built_in">Object</span>],
        deployedBytecode: [<span class="hljs-built_in">Object</span>],
        sourceMap: [<span class="hljs-built_in">Object</span>],
        deployedSourceMap: [<span class="hljs-built_in">Object</span>],
        source: [<span class="hljs-built_in">Object</span>],
        sourcePath: [<span class="hljs-built_in">Object</span>],
        ast: [<span class="hljs-built_in">Object</span>],
        compiler: [<span class="hljs-built_in">Object</span>],
        schema_version: [<span class="hljs-built_in">Function</span>: schema_version],
        schemaVersion: [<span class="hljs-built_in">Function</span>: schemaVersion],
        updated_at: [<span class="hljs-built_in">Function</span>: updated_at],
        updatedAt: [<span class="hljs-built_in">Function</span>: updatedAt] },
     _property_values: {},
     _json: 
      { contractName: <span class="hljs-string">'EncryptedToken'</span>,
        abi: [<span class="hljs-built_in">Array</span>],
        bytecode: <span class="hljs-string">'0x60606040526301406f40600055341561001757600080fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061023e8061006c6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029'</span>,
        deployedBytecode: <span class="hljs-string">'0x60606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806370a0823114610051578063a9059cbb1461009e575b600080fd5b341561005c57600080fd5b610088600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506100e0565b6040518082815260200191505060405180910390f35b34156100a957600080fd5b6100de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610129565b005b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561017457fe5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555050505600a165627a7a723058205d5ccad9a01715b15d2733b795c870b25b04f5c79d10389a89ed6342e1e2b7ed0029'</span>,
        sourceMap: <span class="hljs-string">'26:518:0:-;;;79:8;54:33;;132:74;;;;;;;;187:14;;164:8;:20;173:10;164:20;;;;;;;;;;;;;;;:37;;;;26:518;;;;;;'</span>,
        deployedSourceMap: <span class="hljs-string">'26:518:0:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;245:165;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;446:96;499:7;521:8;:16;530:6;521:16;;;;;;;;;;;;;;;;514:23;;446:96;;;:::o;245:165::-;330:7;306:8;:20;315:10;306:20;;;;;;;;;;;;;;;;:31;;299:39;;;;;;368:7;344:8;:20;353:10;344:20;;;;;;;;;;;;;;;;:31;;;;;;;;;;;398:7;381:8;:13;390:3;381:13;;;;;;;;;;;;;;;;:24;;;;;;;;;;;245:165;;:::o'</span>,
        source: <span class="hljs-string">'pragma solidity ^0.4.17;\n\ncontract EncryptedToken {\n uint256 INITIAL_SUPPLY = 21000000;\n mapping (address =&gt; uint256) balances;\n function EncryptedToken() {\n balances[msg.sender] = INITIAL_SUPPLY;\n }\n\n //转帐到一个指定的地址\n function transfer(address _to, uint256 _amount) {\n assert(balances[msg.sender] &gt;= _amount);\n balances[msg.sender] -= _amount;\n balances[_to] += _amount;\n }\n\n //查看指定地址的余额\n function balanceOf(address _owner) constant returns (uint256) {\n return balances[_owner];\n }\n}\n'</span>,
        sourcePath: <span class="hljs-string">'/home/sily/SmartContractDemo/HelloWorld/contracts/EncryptedToken.sol'</span>,
        ast: [<span class="hljs-built_in">Object</span>],
        compiler: [<span class="hljs-built_in">Object</span>],
        networks: [<span class="hljs-built_in">Object</span>],
        schemaVersion: <span class="hljs-string">'1.0.1'</span>,
        updatedAt: <span class="hljs-string">'2018-01-11T08:57:36.557Z'</span> },
     setProvider: [<span class="hljs-built_in">Function</span>: bound setProvider],
     <span class="hljs-keyword">new</span>: [<span class="hljs-built_in">Function</span>: bound <span class="hljs-keyword">new</span>],
     at: [<span class="hljs-built_in">Function</span>: bound at],
     deployed: [<span class="hljs-built_in">Function</span>: bound deployed],
     defaults: [<span class="hljs-built_in">Function</span>: bound defaults],
     hasNetwork: [<span class="hljs-built_in">Function</span>: bound hasNetwork],
     isDeployed: [<span class="hljs-built_in">Function</span>: bound isDeployed],
     detectNetwork: [<span class="hljs-built_in">Function</span>: bound detectNetwork],
     setNetwork: [<span class="hljs-built_in">Function</span>: bound setNetwork],
     resetAddress: [<span class="hljs-built_in">Function</span>: bound resetAddress],
     link: [<span class="hljs-built_in">Function</span>: bound link],
     clone: [<span class="hljs-built_in">Function</span>: bound clone],
     addProp: [<span class="hljs-built_in">Function</span>: bound addProp],
     toJSON: [<span class="hljs-built_in">Function</span>: bound toJSON],
     web3: 
      Web3 {
        _requestManager: [RequestManager],
        currentProvider: [Provider],
        eth: [Eth],
        db: [DB],
        shh: [Shh],
        net: [Net],
        personal: [Personal],
        bzz: [Swarm],
        settings: [Settings],
        version: [<span class="hljs-built_in">Object</span>],
        providers: [<span class="hljs-built_in">Object</span>],
        _extend: [<span class="hljs-built_in">Function</span>] },
     class_defaults: 
      { from: <span class="hljs-string">'0x73b5b6e153e03ec11eeeb3d623e50867a5e5227e'</span>,
        gas: <span class="hljs-number">6721975</span>,
        gasPrice: <span class="hljs-number">100000000000</span> },
     currentProvider: 
      HttpProvider {
        host: <span class="hljs-string">'http://localhost:8545'</span>,
        timeout: <span class="hljs-number">0</span>,
        user: <span class="hljs-literal">undefined</span>,
        password: <span class="hljs-literal">undefined</span>,
        send: [<span class="hljs-built_in">Function</span>],
        sendAsync: [<span class="hljs-built_in">Function</span>],
        _alreadyWrapped: <span class="hljs-literal">true</span> },
     network_id: <span class="hljs-string">'1515660380238'</span> },
  abi: 
   [ { constant: <span class="hljs-literal">true</span>,
       inputs: [<span class="hljs-built_in">Array</span>],
       name: <span class="hljs-string">'balanceOf'</span>,
       outputs: [<span class="hljs-built_in">Array</span>],
       payable: <span class="hljs-literal">false</span>,
       stateMutability: <span class="hljs-string">'view'</span>,
       type: <span class="hljs-string">'function'</span> },
     { constant: <span class="hljs-literal">false</span>,
       inputs: [<span class="hljs-built_in">Array</span>],
       name: <span class="hljs-string">'transfer'</span>,
       outputs: [],
       payable: <span class="hljs-literal">false</span>,
       stateMutability: <span class="hljs-string">'nonpayable'</span>,
       type: <span class="hljs-string">'function'</span> },
     { inputs: [],
       payable: <span class="hljs-literal">false</span>,
       stateMutability: <span class="hljs-string">'nonpayable'</span>,
       type: <span class="hljs-string">'constructor'</span> } ],
  contract: 
   Contract {
     _eth: 
      Eth {
        _requestManager: [RequestManager],
        getBalance: [<span class="hljs-built_in">Function</span>],
        getStorageAt: [<span class="hljs-built_in">Function</span>],
        getCode: [<span class="hljs-built_in">Function</span>],
        getBlock: [<span class="hljs-built_in">Function</span>],
        getUncle: [<span class="hljs-built_in">Function</span>],
        getCompilers: [<span class="hljs-built_in">Function</span>],
        getBlockTransactionCount: [<span class="hljs-built_in">Function</span>],
        getBlockUncleCount: [<span class="hljs-built_in">Function</span>],
        getTransaction: [<span class="hljs-built_in">Function</span>],
        getTransactionFromBlock: [<span class="hljs-built_in">Function</span>],
        getTransactionReceipt: [<span class="hljs-built_in">Function</span>],
        getTransactionCount: [<span class="hljs-built_in">Function</span>],
        call: [<span class="hljs-built_in">Function</span>],
        estimateGas: [<span class="hljs-built_in">Function</span>],
        sendRawTransaction: [<span class="hljs-built_in">Function</span>],
        signTransaction: [<span class="hljs-built_in">Function</span>],
        sendTransaction: [<span class="hljs-built_in">Function</span>],
        sign: [<span class="hljs-built_in">Function</span>],
        compile: [<span class="hljs-built_in">Object</span>],
        submitWork: [<span class="hljs-built_in">Function</span>],
        getWork: [<span class="hljs-built_in">Function</span>],
        coinbase: [Getter],
        getCoinbase: [<span class="hljs-built_in">Function</span>],
        mining: [Getter],
        getMining: [<span class="hljs-built_in">Function</span>],
        hashrate: [Getter],
        getHashrate: [<span class="hljs-built_in">Function</span>],
        syncing: [Getter],
        getSyncing: [<span class="hljs-built_in">Function</span>],
        gasPrice: [Getter],
        getGasPrice: [<span class="hljs-built_in">Function</span>],
        accounts: [Getter],
        getAccounts: [<span class="hljs-built_in">Function</span>],
        blockNumber: [Getter],
        getBlockNumber: [<span class="hljs-built_in">Function</span>],
        protocolVersion: [Getter],
        getProtocolVersion: [<span class="hljs-built_in">Function</span>],
        iban: [<span class="hljs-built_in">Function</span>],
        sendIBANTransaction: [<span class="hljs-built_in">Function</span>: bound transfer] },
     transactionHash: <span class="hljs-literal">null</span>,
     address: <span class="hljs-string">'0xeff776cc1aa2f01c40e638538fdfaadbfb179b00'</span>,
     abi: [ [<span class="hljs-built_in">Object</span>], [<span class="hljs-built_in">Object</span>], [<span class="hljs-built_in">Object</span>] ],
     balanceOf: 
      { [<span class="hljs-built_in">Function</span>: bound ]
        request: [<span class="hljs-built_in">Function</span>: bound ],
        call: [<span class="hljs-built_in">Function</span>: bound ],
        sendTransaction: [<span class="hljs-built_in">Function</span>: bound ],
        estimateGas: [<span class="hljs-built_in">Function</span>: bound ],
        getData: [<span class="hljs-built_in">Function</span>: bound ],
        address: [Circular] },
     transfer: 
      { [<span class="hljs-built_in">Function</span>: bound ]
        request: [<span class="hljs-built_in">Function</span>: bound ],
        call: [<span class="hljs-built_in">Function</span>: bound ],
        sendTransaction: [<span class="hljs-built_in">Function</span>: bound ],
        estimateGas: [<span class="hljs-built_in">Function</span>: bound ],
        getData: [<span class="hljs-built_in">Function</span>: bound ],
        <span class="hljs-string">'address,uint256'</span>: [Circular] },
     allEvents: [<span class="hljs-built_in">Function</span>: bound ] },
  balanceOf: 
   { [<span class="hljs-built_in">Function</span>]
     call: [<span class="hljs-built_in">Function</span>],
     sendTransaction: [<span class="hljs-built_in">Function</span>],
     request: [<span class="hljs-built_in">Function</span>: bound ],
     estimateGas: [<span class="hljs-built_in">Function</span>] },
  transfer: 
   { [<span class="hljs-built_in">Function</span>]
     call: [<span class="hljs-built_in">Function</span>],
     sendTransaction: [<span class="hljs-built_in">Function</span>],
     request: [<span class="hljs-built_in">Function</span>: bound ],
     estimateGas: [<span class="hljs-built_in">Function</span>] },
  sendTransaction: [<span class="hljs-built_in">Function</span>],
  send: [<span class="hljs-built_in">Function</span>],
  allEvents: [<span class="hljs-built_in">Function</span>: bound ],
  address: <span class="hljs-string">'0xeff776cc1aa2f01c40e638538fdfaadbfb179b00'</span>,
  transactionHash: <span class="hljs-literal">null</span> }</code></pre> 
  <p>接下来，调用contract合约的<code>balanceOf</code>()函数和<code>transfer</code>()函数，验证结果正确。</p> 
  <pre class="prettyprint"><code class=" hljs ruby">truffle(development)&gt; contract.balanceOf(web3.eth.coinbase)
<span class="hljs-constant">BigNumber</span> { <span class="hljs-symbol">s:</span> <span class="hljs-number">1</span>, <span class="hljs-symbol">e:</span> <span class="hljs-number">7</span>, <span class="hljs-symbol">c:</span> [ <span class="hljs-number">21000000</span> ] }
truffle(development)&gt; contract.balanceOf(web3.eth.accounts[<span class="hljs-number">1</span>])
<span class="hljs-constant">BigNumber</span> { <span class="hljs-symbol">s:</span> <span class="hljs-number">1</span>, <span class="hljs-symbol">e:</span> <span class="hljs-number">0</span>, <span class="hljs-symbol">c:</span> [ <span class="hljs-number">0</span> ] }
truffle(development)&gt; contract.trans
contract.transactionHash  contract.transfer         

truffle(development)&gt; contract.transfer(web3.eth.accounts[<span class="hljs-number">1</span>],<span class="hljs-number">100000000</span>)
<span class="hljs-constant">Error</span><span class="hljs-symbol">:</span> <span class="hljs-constant">VM</span> <span class="hljs-constant">Exception</span> <span class="hljs-keyword">while</span> processing <span class="hljs-symbol">transaction:</span> invalid opcode
    at <span class="hljs-constant">Object</span>.<span class="hljs-constant">InvalidResponse</span> (<span class="hljs-regexp">/home/sily</span><span class="hljs-regexp">/.nvm/nvm</span><span class="hljs-regexp">/versions/node</span><span class="hljs-regexp">/v9.3.0/lib</span><span class="hljs-regexp">/node_modules/truffle</span><span class="hljs-regexp">/build/cli</span>.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">41484</span><span class="hljs-symbol">:</span><span class="hljs-number">16</span>)
    at /home/sily/.nvm/nvm/versions/node/v9.<span class="hljs-number">3.0</span>/lib/node_modules/truffle/build/cli.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">329530</span><span class="hljs-symbol">:</span><span class="hljs-number">36</span>
    at /home/sily/.nvm/nvm/versions/node/v9.<span class="hljs-number">3.0</span>/lib/node_modules/truffle/build/cli.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">325200</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span>
    at <span class="hljs-constant">XMLHttpRequest</span>.request.onreadystatechange (<span class="hljs-regexp">/home/sily</span><span class="hljs-regexp">/.nvm/nvm</span><span class="hljs-regexp">/versions/node</span><span class="hljs-regexp">/v9.3.0/lib</span><span class="hljs-regexp">/node_modules/truffle</span><span class="hljs-regexp">/build/cli</span>.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">328229</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span>)
    at <span class="hljs-constant">XMLHttpRequestEventTarget</span>.dispatchEvent (<span class="hljs-regexp">/home/sily</span><span class="hljs-regexp">/.nvm/nvm</span><span class="hljs-regexp">/versions/node</span><span class="hljs-regexp">/v9.3.0/lib</span><span class="hljs-regexp">/node_modules/truffle</span><span class="hljs-regexp">/build/cli</span>.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">176415</span><span class="hljs-symbol">:</span><span class="hljs-number">18</span>)
    at <span class="hljs-constant">XMLHttpRequest</span>._setReadyState (<span class="hljs-regexp">/home/sily</span><span class="hljs-regexp">/.nvm/nvm</span><span class="hljs-regexp">/versions/node</span><span class="hljs-regexp">/v9.3.0/lib</span><span class="hljs-regexp">/node_modules/truffle</span><span class="hljs-regexp">/build/cli</span>.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">176705</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span>)
    at <span class="hljs-constant">XMLHttpRequest</span>._onHttpResponseEnd (<span class="hljs-regexp">/home/sily</span><span class="hljs-regexp">/.nvm/nvm</span><span class="hljs-regexp">/versions/node</span><span class="hljs-regexp">/v9.3.0/lib</span><span class="hljs-regexp">/node_modules/truffle</span><span class="hljs-regexp">/build/cli</span>.bundled.<span class="hljs-symbol">js:</span><span class="hljs-number">176860</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span>)
truffle(development)&gt; contract.transfer(web3.eth.accounts[<span class="hljs-number">1</span>],<span class="hljs-number">100</span>)
{ <span class="hljs-symbol">tx:</span> <span class="hljs-string">'0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339'</span>,
  <span class="hljs-symbol">receipt:</span> 
   { <span class="hljs-symbol">transactionHash:</span> <span class="hljs-string">'0x5de889a31a95a7971439c54659b91f95dce1103359527ad270cc8d507246c339'</span>,
     <span class="hljs-symbol">transactionIndex:</span> <span class="hljs-number">0</span>,
     <span class="hljs-symbol">blockHash:</span> <span class="hljs-string">'0x430cd8a197cd900e20374d14e20ad655fa82d456ca31e896c937e3f2cb6b9005'</span>,
     <span class="hljs-symbol">blockNumber:</span> <span class="hljs-number">12</span>,
     <span class="hljs-symbol">gasUsed:</span> <span class="hljs-number">49056</span>,
     <span class="hljs-symbol">cumulativeGasUsed:</span> <span class="hljs-number">49056</span>,
     <span class="hljs-symbol">contractAddress:</span> null,
     <span class="hljs-symbol">logs:</span> [],
     <span class="hljs-symbol">status:</span> <span class="hljs-number">1</span> },
  <span class="hljs-symbol">logs:</span> [] }
truffle(development)&gt; contract.balanceOf(web3.eth.accounts[<span class="hljs-number">0</span>])
<span class="hljs-constant">BigNumber</span> { <span class="hljs-symbol">s:</span> <span class="hljs-number">1</span>, <span class="hljs-symbol">e:</span> <span class="hljs-number">7</span>, <span class="hljs-symbol">c:</span> [ <span class="hljs-number">20999900</span> ] }
truffle(development)&gt; contract.balanceOf(web3.eth.accounts[<span class="hljs-number">1</span>])
<span class="hljs-constant">BigNumber</span> { <span class="hljs-symbol">s:</span> <span class="hljs-number">1</span>, <span class="hljs-symbol">e:</span> <span class="hljs-number">2</span>, <span class="hljs-symbol">c:</span> [ <span class="hljs-number">100</span> ] }
truffle(development)&gt; </code></pre> 
  <p>以上就是基于智能合约建立最简单的具有转账和查询钱包地址余额功能的代币教程。但是，逻辑中并没有对安全相关的操作进行处理，比如当余额不够时或者地址不合法等。</p> 
  <p>文章参考： <br> <a href="http://blog.csdn.net/liyuechun520/article/details/78049950" rel="nofollow">http://blog.csdn.net/liyuechun520/article/details/78049950</a></p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/rectsuly/article/details/79037878,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/rectsuly/article/details/79037878,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用Hyperledger Composer将业务网络部署到单个组织的Hyperledger Fabric区块链上-bigmaning的博客(积水成渊，蛟龙生焉；) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用Hyperledger Composer将业务网络部署到单个组织的Hyperledger Fabric区块链上-bigmaning的博客(积水成渊，蛟龙生焉；)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727076 本文已在我的公众号Fabric技术分享原创首发。 转载请标明出处： http://blog.csdn.net/qq_27818541/article/details/78727076 本文出自:【BigManing的博客】 前言 先前准备 1、先满足下列环境要求 2、安装Hyperledger Composer开发工具 3、下载Hyperledger Fabric网络相关工具 一、 开启Fabric区块链网络 1、执行下面命令启动网络 2、删除以前的 business network card（新增的特性） 二、 详解Fabric区块链网络 1、配置文件 2、组织 3、网络组件 4、用户 5、channel 三、 生成连接Fabric区块链网络的配置文件 四、 找到Fabric网络的管理员证书以及私钥 1、管理员证书 2、管理员私钥 3、把上面的两个文件复制到配置文件所在的目录 五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card） 1、card介绍 2、生成card 3、生成card命令的详解 六、 为Hyperledger Fabric管理员导入业务网卡 七、 安装 Hyperledger Composer runtime 八、 运行区块链业务网络（blockchain business network） 1、准备BNA文件（业务网络文件） 2、运行业务网络（初始化chaincode） 九、 导入业务网络管理员身份 十、 测试下到业务网络的连接是否通常 十一、 生成REST API 前言 Hyperledger Composer官方一直在维护更新中，写作本文时最新release版本为0.16，从0.15的更新带来了新的特性：card，也就是对用户身份的封装。如果你在以前的版本中使用过composer，你对身份并不会陌生，例如部署到fabric网络时需要用到PeerAdmin身份。这篇文章的目的就是使用最新版本的composer部署业务网络，我会详细记录操作流程，以便他人或者自查，对于你熟知的步骤，可以跳过。 我的环境： Ubuntu 16.04 //我的操作系统 Hyperledger Composer 0.16 Hyperledger Fabric 1.0.4 先前准备 1、先满足下列环境要求 Operating Systems: Ubuntu Linux 14.04 / 16.04 LTS (both 64-bit), or Mac OS 10.12 Docker Engine: Version 17.03 or higher Docker-Compose: Version 1.8 or higher Node: 8.9 or higher (note version 9 is not supported) npm: v5.x git: 2.9.x or higher Python: 2.7.x A code editor of your choice, we recommend VSCode.推荐 VSCode. 2、安装Hyperledger Composer开发工具 Composer相关工具： npm install -g composer-cli npm install -g generator-hyperledger-composer npm install -g composer-rest-server npm install -g yo 3、下载Hyperledger Fabric网络相关工具 mkdir ~/fabric-tools &amp;&amp; cd ~/fabric-tools curl -O https://raw.githubusercontent.com/hyperledger/composer-tools/master/packages/fabric-dev-servers/fabric-dev-servers.zip unzip fabric-dev-servers.zip 一、 开启Fabric区块链网络 1、执行下面命令启动网络 cd ~/fabric-tools ./stopFabric.sh ./teardownFabric.sh ./downloadFabric.sh ./startFabric.sh 2、删除以前的 business network card（新增的特性） composer card delete -n PeerAdmin@fabric-network composer card delete -n admin@tutorial-network 二、 详解Fabric区块链网络 这部分主要是了解区块链网络的相关配置以各个组件的作用，如果你很熟悉这部分知识，可以跳过。 1、配置文件 使用Hyperledger Fabric配置工具cryptogen和configtxgen配置开发环境中提供的简单Hyperledger Fabric网络。 cryptogen需要用到的配置文件： ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config.yaml configtxgen需要用到的配置文件： ~/fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml 2、组织 本文中的Fabric网络只有一个组织Org1，域名为org1.example.com。此外，该组织的成员资格服务提供商（MSP）称为Org1MSP。 在本事例中，您将部署只有组织Org1可以与之交互的区块链业务网络。 3、网络组件 docker ps 如下： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4730f8767eac hyperledger/fabric-peer:x86_64-1.0.4 &quot;peer node start -...&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com 2c55a035a7dc hyperledger/fabric-orderer:x86_64-1.0.4 &quot;orderer&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 02ca6ce17128 hyperledger/fabric-couchdb:x86_64-1.0.4 &quot;tini -- /docker-e...&quot; 10 minutes ago Up 10 minutes 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb 83f3fe63f43a hyperledger/fabric-ca:x86_64-1.0.4 &quot;sh -c &#39;fabric-ca-...&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7054-&gt;7054/tcp ca.org1.example.com peer 这个peer节点是org1的，而且只有这一个节点。多个端口号以，分开。 ca 为org1服务的证书颁发机构。 order 交易排序的节点。 couchdb 数据存储的媒介，如果没有配置这个 默认是leveldb。 4、用户 Admin@org1.example.com org1中配置的管理员用户，他的证书材料以及私钥在~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp路径里。 他拥有的权限： 可以部署BNA代码 可以运行BNA业务网络 admin CA（证书机构）服务中默认的用户，他就没有部署BNA的权限。 5、channel 定义： fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml Profiles: ...... ComposerChannel: Consortium: ComposerConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 // 可以看出这个只有`org1`的成员可以加入 ...... 生成channel 在实例中channel文件已经被生成好了，channelId为composerchannel，文件地址：~/fabric-tools/fabric-scripts/hlfv1/composer/composer-channel.tx。 生成channel的命令： configtxgen -profile ComposerChannel -outputCreateChannelTx ./composer-channel.tx -channelID composerchannel 三、 生成连接Fabric区块链网络的配置文件 新建一个文件夹（connection）： cd ~/fabric-tools/fabric-scripts/hlfv1 mkdir connection 创建配置文件connection.json： cd connection/ touch connection.json 打开connection.json，配置内容如下： { &quot;name&quot;: &quot;fabric-network&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpc://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpc://localhost:7053&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;http://localhost:7054&quot;, &quot;name&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpc://localhost:7050&quot; } ], &quot;channel&quot;: &quot;composerchannel&quot;, &quot;timeout&quot;: 300 } 字段详解请看这里 四、 找到Fabric网络的管理员证书以及私钥 前面已经说过了，只有Fabric的管理员身份才能部署BNA文件（业务网络），我们来看看他长什么样子吧。 1、管理员证书 ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem 这个是用户身份的公共部分： 2、管理员私钥 ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk 签名交易时使用： 3、把上面的两个文件复制到配置文件所在的目录 cp ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem ~/fabric-tools/fabric-scripts/hlfv1/connection cp ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk ~/fabric-tools/fabric-scripts/hlfv1/connection 五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card） 1、card介绍 目前在~/fabric-tools/fabric-scripts/hlfv1/connection目录中有如下文件： . // 管理员私钥 ├── 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk // 管理员证书 ├── Admin@org1.example.com-cert.pem // 连接配置文件 └── connection.json 使用这些文件可以生成business network card，其作用为： // 1 可以连接Fabric区块链网络 // 2 可以连接`business network `（业务网络） 2、生成card 执行如下命令： cd ~/fabric-tools/fabric-scripts/hlfv1/connection composer card create \ -p connection.json \ -u PeerAdmin \ -c Admin@org1.example.com-cert.pem \ -k 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk \ -r PeerAdmin -r ChannelAdmin 执行成功后，在当前目录（connection）下会多出一个.card文件： 3、生成card命令的详解 生成card命令的详细介绍请看这里。 六、 为Hyperledger Fabric管理员导入业务网卡 执行下面命令： cd ~/fabric-tools/fabric-scripts/hlfv1/connection composer card import -f PeerAdmin@fabric-network.card 导入成功后，使用composer card list 查看详情： 七、 安装 Hyperledger Composer runtime 这一步骤的操作如同Hyperledger Fabric 术语里面的安装chaincode 根据官网的描述，Hyperledger Composer runtime 就是一个chaincode，需要把它安装到peer节点（配置文件上定义的）上。同时需要为区块链业务网络（blockchain business network）定义一个名称。 执行下面命令： composer runtime install -c PeerAdmin@fabric-network -n tutorial-network 安装成功： 八、 运行区块链业务网络（blockchain business network） 1、准备BNA文件（业务网络文件） 这里借用下官方示例basic-sample-network。 执行下面命令： cd ~ # git官方示例 git clone https://github.com/hyperledger/composer-sample-networks.git # 使用其中的一个示例 cp -r ./composer-sample-networks/packages/basic-sample-network/ ./ # 进入到这个目录 cd basic-sample-network #安装依赖 # npm install 修改package.json里面的两个地方： 生成bna文件： 复制bna文件到connection文件夹下： cp ~/basic-sample-network/dist/tutorial-network.bna ~/fabric-tools/fabric-scripts/hlfv1/connection/ 2、运行业务网络（初始化chaincode） 这一步骤的操作如同Hyperledger Fabric 术语里面的初始化chaincode composer network start -c PeerAdmin@fabric-network -a tutorial-network.bna -A admin -S adminpw 运行结果： docker ps 查看此时的容器： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES // 这个步骤 就相当于 初始化 chaincode 自动生成合约镜像 e3df6b05dc64 dev-peer0.org1.example.com-tutorial-network-0.16.2-3f443591c7f8b7c2cfb3c343bf26b99fd7c39b97ca8327bd8c07ee99460b01d4 &quot;chaincode -peer.a...&quot; 4 hours ago Up 4 hours dev-peer0.org1.example.com-tutorial-network-0.16.2 195793779b99 hyperledger/fabric-peer:x86_64-1.0.4 &quot;peer node start -...&quot; 4 days ago Up 4 days 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com 98ad2ad2224d hyperledger/fabric-ca:x86_64-1.0.4 &quot;sh -c &#39;fabric-ca-...&quot; 4 days ago Up 4 days 0.0.0.0:7054-&gt;7054/tcp ca.org1.example.com 2907f48a3f02 hyperledger/fabric-orderer:x86_64-1.0.4 &quot;orderer&quot; 4 days ago Up 4 days 0.0.0.0:7050-&gt;7050/tcp orderer.example.com d00f2d5fcc28 hyperledger/fabric-couchdb:x86_64-1.0.4 &quot;tini -- /docker-e...&quot; 4 days ago Up 4 days 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb 九、 导入业务网络管理员身份 composer card import -f admin@tutorial-network.card 导入后，我们查看下钱包中维护的身份: 十、 测试下到业务网络的连接是否通常 composer network ping -c admin@tutorial-network 十一、 生成REST API composer-rest-server 执行效果： 进入http://localhost:3000/explorer ，每个模块都可以CRUD，你可以愉快的编写WEB应用或者移动应用了： 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727076 本文已在我的公众号Fabric技术分享原创首发。 转载请标明出处： http://blog.csdn.net/qq_27818541/article/details/78727076 本文出自:【BigManing的博客】 前言 先前准备 1、先满足下列环境要求 2、安装Hyperledger Composer开发工具 3、下载Hyperledger Fabric网络相关工具 一、 开启Fabric区块链网络 1、执行下面命令启动网络 2、删除以前的 business network card（新增的特性） 二、 详解Fabric区块链网络 1、配置文件 2、组织 3、网络组件 4、用户 5、channel 三、 生成连接Fabric区块链网络的配置文件 四、 找到Fabric网络的管理员证书以及私钥 1、管理员证书 2、管理员私钥 3、把上面的两个文件复制到配置文件所在的目录 五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card） 1、card介绍 2、生成card 3、生成card命令的详解 六、 为Hyperledger Fabric管理员导入业务网卡 七、 安装 Hyperledger Composer runtime 八、 运行区块链业务网络（blockchain business network） 1、准备BNA文件（业务网络文件） 2、运行业务网络（初始化chaincode） 九、 导入业务网络管理员身份 十、 测试下到业务网络的连接是否通常 十一、 生成REST API 前言 Hyperledger Composer官方一直在维护更新中，写作本文时最新release版本为0.16，从0.15的更新带来了新的特性：card，也就是对用户身份的封装。如果你在以前的版本中使用过composer，你对身份并不会陌生，例如部署到fabric网络时需要用到PeerAdmin身份。这篇文章的目的就是使用最新版本的composer部署业务网络，我会详细记录操作流程，以便他人或者自查，对于你熟知的步骤，可以跳过。 我的环境： Ubuntu 16.04 //我的操作系统 Hyperledger Composer 0.16 Hyperledger Fabric 1.0.4 先前准备 1、先满足下列环境要求 Operating Systems: Ubuntu Linux 14.04 / 16.04 LTS (both 64-bit), or Mac OS 10.12 Docker Engine: Version 17.03 or higher Docker-Compose: Version 1.8 or higher Node: 8.9 or higher (note version 9 is not supported) npm: v5.x git: 2.9.x or higher Python: 2.7.x A code editor of your choice, we recommend VSCode.推荐 VSCode. 2、安装Hyperledger Composer开发工具 Composer相关工具： npm install -g composer-cli npm install -g generator-hyperledger-composer npm install -g composer-rest-server npm install -g yo 3、下载Hyperledger Fabric网络相关工具 mkdir ~/fabric-tools &amp;&amp; cd ~/fabric-tools curl -O https://raw.githubusercontent.com/hyperledger/composer-tools/master/packages/fabric-dev-servers/fabric-dev-servers.zip unzip fabric-dev-servers.zip 一、 开启Fabric区块链网络 1、执行下面命令启动网络 cd ~/fabric-tools ./stopFabric.sh ./teardownFabric.sh ./downloadFabric.sh ./startFabric.sh 2、删除以前的 business network card（新增的特性） composer card delete -n PeerAdmin@fabric-network composer card delete -n admin@tutorial-network 二、 详解Fabric区块链网络 这部分主要是了解区块链网络的相关配置以各个组件的作用，如果你很熟悉这部分知识，可以跳过。 1、配置文件 使用Hyperledger Fabric配置工具cryptogen和configtxgen配置开发环境中提供的简单Hyperledger Fabric网络。 cryptogen需要用到的配置文件： ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config.yaml configtxgen需要用到的配置文件： ~/fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml 2、组织 本文中的Fabric网络只有一个组织Org1，域名为org1.example.com。此外，该组织的成员资格服务提供商（MSP）称为Org1MSP。 在本事例中，您将部署只有组织Org1可以与之交互的区块链业务网络。 3、网络组件 docker ps 如下： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4730f8767eac hyperledger/fabric-peer:x86_64-1.0.4 &quot;peer node start -...&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com 2c55a035a7dc hyperledger/fabric-orderer:x86_64-1.0.4 &quot;orderer&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 02ca6ce17128 hyperledger/fabric-couchdb:x86_64-1.0.4 &quot;tini -- /docker-e...&quot; 10 minutes ago Up 10 minutes 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb 83f3fe63f43a hyperledger/fabric-ca:x86_64-1.0.4 &quot;sh -c &#39;fabric-ca-...&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7054-&gt;7054/tcp ca.org1.example.com peer 这个peer节点是org1的，而且只有这一个节点。多个端口号以，分开。 ca 为org1服务的证书颁发机构。 order 交易排序的节点。 couchdb 数据存储的媒介，如果没有配置这个 默认是leveldb。 4、用户 Admin@org1.example.com org1中配置的管理员用户，他的证书材料以及私钥在~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp路径里。 他拥有的权限： 可以部署BNA代码 可以运行BNA业务网络 admin CA（证书机构）服务中默认的用户，他就没有部署BNA的权限。 5、channel 定义： fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml Profiles: ...... ComposerChannel: Consortium: ComposerConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 // 可以看出这个只有`org1`的成员可以加入 ...... 生成channel 在实例中channel文件已经被生成好了，channelId为composerchannel，文件地址：~/fabric-tools/fabric-scripts/hlfv1/composer/composer-channel.tx。 生成channel的命令： configtxgen -profile ComposerChannel -outputCreateChannelTx ./composer-channel.tx -channelID composerchannel 三、 生成连接Fabric区块链网络的配置文件 新建一个文件夹（connection）： cd ~/fabric-tools/fabric-scripts/hlfv1 mkdir connection 创建配置文件connection.json： cd connection/ touch connection.json 打开connection.json，配置内容如下： { &quot;name&quot;: &quot;fabric-network&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpc://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpc://localhost:7053&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;http://localhost:7054&quot;, &quot;name&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpc://localhost:7050&quot; } ], &quot;channel&quot;: &quot;composerchannel&quot;, &quot;timeout&quot;: 300 } 字段详解请看这里 四、 找到Fabric网络的管理员证书以及私钥 前面已经说过了，只有Fabric的管理员身份才能部署BNA文件（业务网络），我们来看看他长什么样子吧。 1、管理员证书 ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem 这个是用户身份的公共部分： 2、管理员私钥 ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk 签名交易时使用： 3、把上面的两个文件复制到配置文件所在的目录 cp ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem ~/fabric-tools/fabric-scripts/hlfv1/connection cp ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk ~/fabric-tools/fabric-scripts/hlfv1/connection 五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card） 1、card介绍 目前在~/fabric-tools/fabric-scripts/hlfv1/connection目录中有如下文件： . // 管理员私钥 ├── 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk // 管理员证书 ├── Admin@org1.example.com-cert.pem // 连接配置文件 └── connection.json 使用这些文件可以生成business network card，其作用为： // 1 可以连接Fabric区块链网络 // 2 可以连接`business network `（业务网络） 2、生成card 执行如下命令： cd ~/fabric-tools/fabric-scripts/hlfv1/connection composer card create \ -p connection.json \ -u PeerAdmin \ -c Admin@org1.example.com-cert.pem \ -k 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk \ -r PeerAdmin -r ChannelAdmin 执行成功后，在当前目录（connection）下会多出一个.card文件： 3、生成card命令的详解 生成card命令的详细介绍请看这里。 六、 为Hyperledger Fabric管理员导入业务网卡 执行下面命令： cd ~/fabric-tools/fabric-scripts/hlfv1/connection composer card import -f PeerAdmin@fabric-network.card 导入成功后，使用composer card list 查看详情： 七、 安装 Hyperledger Composer runtime 这一步骤的操作如同Hyperledger Fabric 术语里面的安装chaincode 根据官网的描述，Hyperledger Composer runtime 就是一个chaincode，需要把它安装到peer节点（配置文件上定义的）上。同时需要为区块链业务网络（blockchain business network）定义一个名称。 执行下面命令： composer runtime install -c PeerAdmin@fabric-network -n tutorial-network 安装成功： 八、 运行区块链业务网络（blockchain business network） 1、准备BNA文件（业务网络文件） 这里借用下官方示例basic-sample-network。 执行下面命令： cd ~ # git官方示例 git clone https://github.com/hyperledger/composer-sample-networks.git # 使用其中的一个示例 cp -r ./composer-sample-networks/packages/basic-sample-network/ ./ # 进入到这个目录 cd basic-sample-network #安装依赖 # npm install 修改package.json里面的两个地方： 生成bna文件： 复制bna文件到connection文件夹下： cp ~/basic-sample-network/dist/tutorial-network.bna ~/fabric-tools/fabric-scripts/hlfv1/connection/ 2、运行业务网络（初始化chaincode） 这一步骤的操作如同Hyperledger Fabric 术语里面的初始化chaincode composer network start -c PeerAdmin@fabric-network -a tutorial-network.bna -A admin -S adminpw 运行结果： docker ps 查看此时的容器： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES // 这个步骤 就相当于 初始化 chaincode 自动生成合约镜像 e3df6b05dc64 dev-peer0.org1.example.com-tutorial-network-0.16.2-3f443591c7f8b7c2cfb3c343bf26b99fd7c39b97ca8327bd8c07ee99460b01d4 &quot;chaincode -peer.a...&quot; 4 hours ago Up 4 hours dev-peer0.org1.example.com-tutorial-network-0.16.2 195793779b99 hyperledger/fabric-peer:x86_64-1.0.4 &quot;peer node start -...&quot; 4 days ago Up 4 days 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com 98ad2ad2224d hyperledger/fabric-ca:x86_64-1.0.4 &quot;sh -c &#39;fabric-ca-...&quot; 4 days ago Up 4 days 0.0.0.0:7054-&gt;7054/tcp ca.org1.example.com 2907f48a3f02 hyperledger/fabric-orderer:x86_64-1.0.4 &quot;orderer&quot; 4 days ago Up 4 days 0.0.0.0:7050-&gt;7050/tcp orderer.example.com d00f2d5fcc28 hyperledger/fabric-couchdb:x86_64-1.0.4 &quot;tini -- /docker-e...&quot; 4 days ago Up 4 days 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb 九、 导入业务网络管理员身份 composer card import -f admin@tutorial-network.card 导入后，我们查看下钱包中维护的身份: 十、 测试下到业务网络的连接是否通常 composer network ping -c admin@tutorial-network 十一、 生成REST API composer-rest-server 执行效果： 进入http://localhost:3000/explorer ，每个模块都可以CRUD，你可以愉快的编写WEB应用或者移动应用了： 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-03T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727076 本文已在我的公众号Fabric技术分享原创首发。 转载请标明出处： http://blog.csdn.net/qq_27818541/article/details/78727076 本文出自:【BigManing的博客】 前言 先前准备 1、先满足下列环境要求 2、安装Hyperledger Composer开发工具 3、下载Hyperledger Fabric网络相关工具 一、 开启Fabric区块链网络 1、执行下面命令启动网络 2、删除以前的 business network card（新增的特性） 二、 详解Fabric区块链网络 1、配置文件 2、组织 3、网络组件 4、用户 5、channel 三、 生成连接Fabric区块链网络的配置文件 四、 找到Fabric网络的管理员证书以及私钥 1、管理员证书 2、管理员私钥 3、把上面的两个文件复制到配置文件所在的目录 五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card） 1、card介绍 2、生成card 3、生成card命令的详解 六、 为Hyperledger Fabric管理员导入业务网卡 七、 安装 Hyperledger Composer runtime 八、 运行区块链业务网络（blockchain business network） 1、准备BNA文件（业务网络文件） 2、运行业务网络（初始化chaincode） 九、 导入业务网络管理员身份 十、 测试下到业务网络的连接是否通常 十一、 生成REST API 前言 Hyperledger Composer官方一直在维护更新中，写作本文时最新release版本为0.16，从0.15的更新带来了新的特性：card，也就是对用户身份的封装。如果你在以前的版本中使用过composer，你对身份并不会陌生，例如部署到fabric网络时需要用到PeerAdmin身份。这篇文章的目的就是使用最新版本的composer部署业务网络，我会详细记录操作流程，以便他人或者自查，对于你熟知的步骤，可以跳过。 我的环境： Ubuntu 16.04 //我的操作系统 Hyperledger Composer 0.16 Hyperledger Fabric 1.0.4 先前准备 1、先满足下列环境要求 Operating Systems: Ubuntu Linux 14.04 / 16.04 LTS (both 64-bit), or Mac OS 10.12 Docker Engine: Version 17.03 or higher Docker-Compose: Version 1.8 or higher Node: 8.9 or higher (note version 9 is not supported) npm: v5.x git: 2.9.x or higher Python: 2.7.x A code editor of your choice, we recommend VSCode.推荐 VSCode. 2、安装Hyperledger Composer开发工具 Composer相关工具： npm install -g composer-cli npm install -g generator-hyperledger-composer npm install -g composer-rest-server npm install -g yo 3、下载Hyperledger Fabric网络相关工具 mkdir ~/fabric-tools &amp;&amp; cd ~/fabric-tools curl -O https://raw.githubusercontent.com/hyperledger/composer-tools/master/packages/fabric-dev-servers/fabric-dev-servers.zip unzip fabric-dev-servers.zip 一、 开启Fabric区块链网络 1、执行下面命令启动网络 cd ~/fabric-tools ./stopFabric.sh ./teardownFabric.sh ./downloadFabric.sh ./startFabric.sh 2、删除以前的 business network card（新增的特性） composer card delete -n PeerAdmin@fabric-network composer card delete -n admin@tutorial-network 二、 详解Fabric区块链网络 这部分主要是了解区块链网络的相关配置以各个组件的作用，如果你很熟悉这部分知识，可以跳过。 1、配置文件 使用Hyperledger Fabric配置工具cryptogen和configtxgen配置开发环境中提供的简单Hyperledger Fabric网络。 cryptogen需要用到的配置文件： ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config.yaml configtxgen需要用到的配置文件： ~/fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml 2、组织 本文中的Fabric网络只有一个组织Org1，域名为org1.example.com。此外，该组织的成员资格服务提供商（MSP）称为Org1MSP。 在本事例中，您将部署只有组织Org1可以与之交互的区块链业务网络。 3、网络组件 docker ps 如下： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4730f8767eac hyperledger/fabric-peer:x86_64-1.0.4 &quot;peer node start -...&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com 2c55a035a7dc hyperledger/fabric-orderer:x86_64-1.0.4 &quot;orderer&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 02ca6ce17128 hyperledger/fabric-couchdb:x86_64-1.0.4 &quot;tini -- /docker-e...&quot; 10 minutes ago Up 10 minutes 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb 83f3fe63f43a hyperledger/fabric-ca:x86_64-1.0.4 &quot;sh -c &#39;fabric-ca-...&quot; 10 minutes ago Up 10 minutes 0.0.0.0:7054-&gt;7054/tcp ca.org1.example.com peer 这个peer节点是org1的，而且只有这一个节点。多个端口号以，分开。 ca 为org1服务的证书颁发机构。 order 交易排序的节点。 couchdb 数据存储的媒介，如果没有配置这个 默认是leveldb。 4、用户 Admin@org1.example.com org1中配置的管理员用户，他的证书材料以及私钥在~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp路径里。 他拥有的权限： 可以部署BNA代码 可以运行BNA业务网络 admin CA（证书机构）服务中默认的用户，他就没有部署BNA的权限。 5、channel 定义： fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml Profiles: ...... ComposerChannel: Consortium: ComposerConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 // 可以看出这个只有`org1`的成员可以加入 ...... 生成channel 在实例中channel文件已经被生成好了，channelId为composerchannel，文件地址：~/fabric-tools/fabric-scripts/hlfv1/composer/composer-channel.tx。 生成channel的命令： configtxgen -profile ComposerChannel -outputCreateChannelTx ./composer-channel.tx -channelID composerchannel 三、 生成连接Fabric区块链网络的配置文件 新建一个文件夹（connection）： cd ~/fabric-tools/fabric-scripts/hlfv1 mkdir connection 创建配置文件connection.json： cd connection/ touch connection.json 打开connection.json，配置内容如下： { &quot;name&quot;: &quot;fabric-network&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpc://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpc://localhost:7053&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;http://localhost:7054&quot;, &quot;name&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpc://localhost:7050&quot; } ], &quot;channel&quot;: &quot;composerchannel&quot;, &quot;timeout&quot;: 300 } 字段详解请看这里 四、 找到Fabric网络的管理员证书以及私钥 前面已经说过了，只有Fabric的管理员身份才能部署BNA文件（业务网络），我们来看看他长什么样子吧。 1、管理员证书 ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem 这个是用户身份的公共部分： 2、管理员私钥 ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk 签名交易时使用： 3、把上面的两个文件复制到配置文件所在的目录 cp ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem ~/fabric-tools/fabric-scripts/hlfv1/connection cp ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk ~/fabric-tools/fabric-scripts/hlfv1/connection 五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card） 1、card介绍 目前在~/fabric-tools/fabric-scripts/hlfv1/connection目录中有如下文件： . // 管理员私钥 ├── 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk // 管理员证书 ├── Admin@org1.example.com-cert.pem // 连接配置文件 └── connection.json 使用这些文件可以生成business network card，其作用为： // 1 可以连接Fabric区块链网络 // 2 可以连接`business network `（业务网络） 2、生成card 执行如下命令： cd ~/fabric-tools/fabric-scripts/hlfv1/connection composer card create \\ -p connection.json \\ -u PeerAdmin \\ -c Admin@org1.example.com-cert.pem \\ -k 114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk \\ -r PeerAdmin -r ChannelAdmin 执行成功后，在当前目录（connection）下会多出一个.card文件： 3、生成card命令的详解 生成card命令的详细介绍请看这里。 六、 为Hyperledger Fabric管理员导入业务网卡 执行下面命令： cd ~/fabric-tools/fabric-scripts/hlfv1/connection composer card import -f PeerAdmin@fabric-network.card 导入成功后，使用composer card list 查看详情： 七、 安装 Hyperledger Composer runtime 这一步骤的操作如同Hyperledger Fabric 术语里面的安装chaincode 根据官网的描述，Hyperledger Composer runtime 就是一个chaincode，需要把它安装到peer节点（配置文件上定义的）上。同时需要为区块链业务网络（blockchain business network）定义一个名称。 执行下面命令： composer runtime install -c PeerAdmin@fabric-network -n tutorial-network 安装成功： 八、 运行区块链业务网络（blockchain business network） 1、准备BNA文件（业务网络文件） 这里借用下官方示例basic-sample-network。 执行下面命令： cd ~ # git官方示例 git clone https://github.com/hyperledger/composer-sample-networks.git # 使用其中的一个示例 cp -r ./composer-sample-networks/packages/basic-sample-network/ ./ # 进入到这个目录 cd basic-sample-network #安装依赖 # npm install 修改package.json里面的两个地方： 生成bna文件： 复制bna文件到connection文件夹下： cp ~/basic-sample-network/dist/tutorial-network.bna ~/fabric-tools/fabric-scripts/hlfv1/connection/ 2、运行业务网络（初始化chaincode） 这一步骤的操作如同Hyperledger Fabric 术语里面的初始化chaincode composer network start -c PeerAdmin@fabric-network -a tutorial-network.bna -A admin -S adminpw 运行结果： docker ps 查看此时的容器： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES // 这个步骤 就相当于 初始化 chaincode 自动生成合约镜像 e3df6b05dc64 dev-peer0.org1.example.com-tutorial-network-0.16.2-3f443591c7f8b7c2cfb3c343bf26b99fd7c39b97ca8327bd8c07ee99460b01d4 &quot;chaincode -peer.a...&quot; 4 hours ago Up 4 hours dev-peer0.org1.example.com-tutorial-network-0.16.2 195793779b99 hyperledger/fabric-peer:x86_64-1.0.4 &quot;peer node start -...&quot; 4 days ago Up 4 days 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com 98ad2ad2224d hyperledger/fabric-ca:x86_64-1.0.4 &quot;sh -c &#39;fabric-ca-...&quot; 4 days ago Up 4 days 0.0.0.0:7054-&gt;7054/tcp ca.org1.example.com 2907f48a3f02 hyperledger/fabric-orderer:x86_64-1.0.4 &quot;orderer&quot; 4 days ago Up 4 days 0.0.0.0:7050-&gt;7050/tcp orderer.example.com d00f2d5fcc28 hyperledger/fabric-couchdb:x86_64-1.0.4 &quot;tini -- /docker-e...&quot; 4 days ago Up 4 days 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb 九、 导入业务网络管理员身份 composer card import -f admin@tutorial-network.card 导入后，我们查看下钱包中维护的身份: 十、 测试下到业务网络的连接是否通常 composer network ping -c admin@tutorial-network 十一、 生成REST API composer-rest-server 执行效果： 进入http://localhost:3000/explorer ，每个模块都可以CRUD，你可以愉快的编写WEB应用或者移动应用了： 阅读更多","@type":"BlogPosting","url":"/2018/01/03/f54cecc71c00e79258e0987be2a46ed2.html","headline":"使用Hyperledger Composer将业务网络部署到单个组织的Hyperledger Fabric区块链上-bigmaning的博客(积水成渊，蛟龙生焉；)","dateModified":"2018-01-03T00:00:00+08:00","datePublished":"2018-01-03T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/01/03/f54cecc71c00e79258e0987be2a46ed2.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用Hyperledger Composer将业务网络部署到单个组织的Hyperledger Fabric区块链上-bigmaning的博客(积水成渊，蛟龙生焉；)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727076 
 </div> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <blockquote> 
   <p>本文已在我的公众号<strong>Fabric技术分享</strong>原创首发。 <br> 转载请标明出处： <br> <a href="http://blog.csdn.net/qq_27818541/article/details/78727076" rel="nofollow">http://blog.csdn.net/qq_27818541/article/details/78727076</a> <br> 本文出自:<a href="http://blog.csdn.net/qq_27818541" rel="nofollow">【BigManing的博客】</a></p> 
  </blockquote> 
  <p></p>
  <div class="toc"> 
   <ul> 
    <li>
     <ul> 
      <li>
       <ul> 
        <li><a href="#前言" rel="nofollow">前言</a></li> 
        <li><a href="#先前准备" rel="nofollow">先前准备</a>
         <ul> 
          <li><a href="#1先满足下列环境要求" rel="nofollow">1、先满足下列环境要求</a></li> 
          <li><a href="#2安装hyperledger-composer开发工具" rel="nofollow">2、安装Hyperledger Composer开发工具</a></li> 
          <li><a href="#3下载hyperledger-fabric网络相关工具" rel="nofollow">3、下载Hyperledger Fabric网络相关工具</a></li> 
         </ul> </li> 
        <li><a href="#一-开启fabric区块链网络" rel="nofollow">一、 开启Fabric区块链网络</a>
         <ul> 
          <li><a href="#1执行下面命令启动网络" rel="nofollow">1、执行下面命令启动网络</a></li> 
          <li><a href="#2删除以前的-business-network-card新增的特性" rel="nofollow">2、删除以前的 business network card（新增的特性）</a></li> 
         </ul> </li> 
        <li><a href="#二-详解fabric区块链网络" rel="nofollow">二、 详解Fabric区块链网络</a>
         <ul> 
          <li><a href="#1配置文件" rel="nofollow">1、配置文件</a></li> 
          <li><a href="#2组织" rel="nofollow">2、组织</a></li> 
          <li><a href="#3网络组件" rel="nofollow">3、网络组件</a></li> 
          <li><a href="#4用户" rel="nofollow">4、用户</a></li> 
          <li><a href="#5channel" rel="nofollow">5、channel</a></li> 
         </ul> </li> 
        <li><a href="#三-生成连接fabric区块链网络的配置文件" rel="nofollow">三、 生成连接Fabric区块链网络的配置文件</a></li> 
        <li><a href="#四-找到fabric网络的管理员证书以及私钥" rel="nofollow">四、 找到Fabric网络的管理员证书以及私钥</a>
         <ul> 
          <li><a href="#1管理员证书" rel="nofollow">1、管理员证书</a></li> 
          <li><a href="#2管理员私钥" rel="nofollow">2、管理员私钥</a></li> 
          <li><a href="#3把上面的两个文件复制到配置文件所在的目录" rel="nofollow">3、把上面的两个文件复制到配置文件所在的目录</a></li> 
         </ul> </li> 
        <li><a href="#五-为hyperledger-fabric管理员创建一个业务网络访问卡business-network-card" rel="nofollow">五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card）</a>
         <ul> 
          <li><a href="#1card介绍" rel="nofollow">1、card介绍</a></li> 
          <li><a href="#2生成card" rel="nofollow">2、生成card</a></li> 
          <li><a href="#3生成card命令的详解" rel="nofollow">3、生成card命令的详解</a></li> 
         </ul> </li> 
        <li><a href="#六-为hyperledger-fabric管理员导入业务网卡" rel="nofollow">六、 为Hyperledger Fabric管理员导入业务网卡</a></li> 
        <li><a href="#七-安装-hyperledger-composer-runtime" rel="nofollow">七、 安装 Hyperledger Composer runtime</a></li> 
        <li><a href="#八-运行区块链业务网络blockchain-business-network" rel="nofollow">八、 运行区块链业务网络（blockchain business network）</a>
         <ul> 
          <li><a href="#1准备bna文件业务网络文件" rel="nofollow">1、准备BNA文件（业务网络文件）</a></li> 
          <li><a href="#2运行业务网络初始化chaincode" rel="nofollow">2、运行业务网络（初始化chaincode）</a></li> 
         </ul> </li> 
        <li><a href="#九-导入业务网络管理员身份" rel="nofollow">九、 导入业务网络管理员身份</a></li> 
        <li><a href="#十-测试下到业务网络的连接是否通常" rel="nofollow">十、 测试下到业务网络的连接是否通常</a></li> 
        <li><a href="#十一-生成rest-api" rel="nofollow">十一、 生成REST API</a></li> 
       </ul> </li> 
     </ul> </li> 
   </ul> 
  </div> 
  <p></p> 
  <h3 id="前言">前言</h3> 
  <p>Hyperledger Composer官方一直在维护更新中，写作本文时最新release版本为<code>0.16</code>，从<code>0.15</code>的更新带来了新的特性：<code>card</code>，也就是对用户身份的封装。如果你在以前的版本中使用过composer，你对身份并不会陌生，例如部署到fabric网络时需要用到<code>PeerAdmin</code>身份。这篇文章的目的就是使用最新版本的composer部署业务网络，我会详细记录操作流程，以便他人或者自查，对于你熟知的步骤，可以跳过。</p> 
  <p><strong>我的环境</strong>：</p> 
  <pre class="prettyprint"><code class="language-java hljs ">Ubuntu <span class="hljs-number">16.04</span>   <span class="hljs-comment">//我的操作系统</span>
Hyperledger Composer <span class="hljs-number">0.16</span>      
Hyperledger Fabric <span class="hljs-number">1.0</span><span class="hljs-number">.4</span>    
</code></pre> 
  <h3 id="先前准备">先前准备</h3> 
  <h4 id="1先满足下列环境要求">1、先满足下列环境要求</h4> 
  <pre class="prettyprint"><code class=" hljs avrasm">Operating Systems: Ubuntu Linux <span class="hljs-number">14.04</span> / <span class="hljs-number">16.04</span> LTS (both <span class="hljs-number">64</span>-bit), <span class="hljs-keyword">or</span> Mac OS <span class="hljs-number">10.12</span>
Docker Engine: Version <span class="hljs-number">17.03</span> <span class="hljs-keyword">or</span> higher
Docker-Compose: Version <span class="hljs-number">1.8</span> <span class="hljs-keyword">or</span> higher
<span class="hljs-label">Node:</span> <span class="hljs-number">8.9</span> <span class="hljs-keyword">or</span> higher (note version <span class="hljs-number">9</span> is not supported)
<span class="hljs-label">npm:</span> v5<span class="hljs-preprocessor">.x</span>
<span class="hljs-label">git:</span> <span class="hljs-number">2.9</span><span class="hljs-preprocessor">.x</span> <span class="hljs-keyword">or</span> higher
<span class="hljs-label">Python:</span> <span class="hljs-number">2.7</span><span class="hljs-preprocessor">.x</span>
A code editor of your choice, we recommend VSCode.推荐 VSCode. </code></pre> 
  <h4 id="2安装hyperledger-composer开发工具">2、安装Hyperledger Composer开发工具</h4> 
  <p>Composer相关工具：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">npm install <span class="hljs-attribute">-g</span> composer<span class="hljs-attribute">-cli</span>
npm install <span class="hljs-attribute">-g</span> generator<span class="hljs-attribute">-hyperledger</span><span class="hljs-attribute">-composer</span>
npm install <span class="hljs-attribute">-g</span> composer<span class="hljs-attribute">-rest</span><span class="hljs-attribute">-server</span>
npm install <span class="hljs-attribute">-g</span> yo</code></pre> 
  <h4 id="3下载hyperledger-fabric网络相关工具">3、下载Hyperledger Fabric网络相关工具</h4> 
  <pre class="prettyprint"><code class=" hljs lasso">mkdir ~/fabric<span class="hljs-attribute">-tools</span> <span class="hljs-subst">&amp;&amp;</span> cd ~/fabric<span class="hljs-attribute">-tools</span>

curl <span class="hljs-attribute">-O</span> https:<span class="hljs-comment">//raw.githubusercontent.com/hyperledger/composer-tools/master/packages/fabric-dev-servers/fabric-dev-servers.zip</span>

unzip fabric<span class="hljs-attribute">-dev</span><span class="hljs-attribute">-servers</span><span class="hljs-built_in">.</span>zip
</code></pre> 
  <h3 id="一-开启fabric区块链网络">一、 开启Fabric区块链网络</h3> 
  <h4 id="1执行下面命令启动网络">1、执行下面命令启动网络</h4> 
  <pre class="prettyprint"><code class=" hljs avrasm">cd ~/fabric-tools
./stopFabric<span class="hljs-preprocessor">.sh</span>
./teardownFabric<span class="hljs-preprocessor">.sh</span>
./downloadFabric<span class="hljs-preprocessor">.sh</span>
./startFabric<span class="hljs-preprocessor">.sh</span></code></pre> 
  <h4 id="2删除以前的-business-network-card新增的特性">2、删除以前的 business network card（新增的特性）</h4> 
  <pre class="prettyprint"><code class=" hljs d">composer card <span class="hljs-keyword">delete</span> -n PeerAdmin<span class="hljs-keyword">@fabric</span>-network
composer card <span class="hljs-keyword">delete</span> -n admin<span class="hljs-keyword">@tutorial</span>-network</code></pre> 
  <h3 id="二-详解fabric区块链网络">二、 详解Fabric区块链网络</h3> 
  <p>这部分主要是了解区块链网络的相关配置以各个组件的作用，如果你很熟悉这部分知识，可以跳过。</p> 
  <h4 id="1配置文件">1、配置文件</h4> 
  <p>使用Hyperledger Fabric配置工具<a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html#crypto-generator" rel="nofollow">cryptogen</a>和<a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html#configuration-transaction-generator" rel="nofollow">configtxgen</a>配置开发环境中提供的简单Hyperledger Fabric网络。 <br> <code>cryptogen</code>需要用到的配置文件：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">~/fabric<span class="hljs-attribute">-tools</span>/fabric<span class="hljs-attribute">-scripts</span>/hlfv1/composer/crypto<span class="hljs-attribute">-config</span><span class="hljs-built_in">.</span>yaml</code></pre> 
  <p><code>configtxgen</code>需要用到的配置文件：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">~/fabric<span class="hljs-attribute">-tools</span>/fabric<span class="hljs-attribute">-scripts</span>/hlfv1/composer/configtx<span class="hljs-built_in">.</span>yaml</code></pre> 
  <h4 id="2组织">2、组织</h4> 
  <p>本文中的Fabric网络只有一个组织<code>Org1</code>，域名为<code>org1.example.com</code>。此外，该组织的成员资格服务提供商（MSP）称为<code>Org1MSP</code>。 在本事例中，您将部署只有组织<code>Org1</code>可以与之交互的区块链业务网络。</p> 
  <h4 id="3网络组件">3、网络组件</h4> 
  <p><code>docker ps</code> 如下：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">CONTAINER ID        IMAGE                                     COMMAND                  CREATED             STATUS              PORTS                                            NAMES
<span class="hljs-number">4730</span>f8767eac        hyperledger/fabric<span class="hljs-attribute">-peer</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>      <span class="hljs-string">"peer node start -..."</span>   <span class="hljs-number">10</span> minutes ago      Up <span class="hljs-number">10</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp   peer0<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">2</span>c55a035a7dc        hyperledger/fabric<span class="hljs-attribute">-orderer</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>   <span class="hljs-string">"orderer"</span>                <span class="hljs-number">10</span> minutes ago      Up <span class="hljs-number">10</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7050</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7050</span>/tcp                           orderer<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">02</span>ca6ce17128        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>   <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">10</span> minutes ago      Up <span class="hljs-number">10</span> minutes       <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">5984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp       couchdb
<span class="hljs-number">83</span>f3fe63f43a        hyperledger/fabric<span class="hljs-attribute">-ca</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>        <span class="hljs-string">"sh -c 'fabric-ca-..."</span>   <span class="hljs-number">10</span> minutes ago      Up <span class="hljs-number">10</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7054</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7054</span>/tcp                           ca<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com

</code></pre> 
  <ul> 
   <li><strong>peer</strong> <br> 
    <ul>
     <li>这个peer节点是<code>org1</code>的，而且只有这一个节点。多个端口号以<code>，</code>分开。</li>
    </ul></li> 
   <li><strong>ca</strong> <br> 
    <ul>
     <li>为<code>org1</code>服务的证书颁发机构。</li>
    </ul></li> 
   <li><strong>order</strong> <br> 
    <ul>
     <li>交易排序的节点。</li>
    </ul></li> 
   <li><strong>couchdb</strong> <br> 
    <ul>
     <li>数据存储的媒介，如果没有配置这个 默认是<code>leveldb</code>。</li>
    </ul></li> 
  </ul> 
  <h4 id="4用户">4、用户</h4> 
  <blockquote> 
   <p><strong>Admin@org1.example.com</strong></p> 
  </blockquote> 
  <p><code>org1</code>中配置的管理员用户，他的证书材料以及私钥在<code>~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</code>路径里。</p> 
  <p>他拥有的权限：</p> 
  <ul> 
   <li>可以部署BNA代码</li> 
   <li>可以运行BNA业务网络</li> 
  </ul> 
  <blockquote> 
   <p><strong>admin</strong></p> 
  </blockquote> 
  <p>CA（证书机构）服务中默认的用户，他就没有部署BNA的权限。</p> 
  <h4 id="5channel">5、channel</h4> 
  <p><strong>定义</strong>：</p> 
  <p><code>fabric-tools/fabric-scripts/hlfv1/composer/configtx.yaml</code></p> 
  <pre class="prettyprint"><code class="language-java hljs ">Profiles:

    ......

    ComposerChannel:
        Consortium: ComposerConsortium
        Application:
            &lt;&lt;: *ApplicationDefaults
            Organizations:
                - *Org1   <span class="hljs-comment">// 可以看出这个只有`org1`的成员可以加入</span>

    ......
</code></pre> 
  <p><strong>生成channel</strong></p> 
  <p>在实例中channel文件已经被生成好了，channelId为<code>composerchannel</code>，文件地址：<code>~/fabric-tools/fabric-scripts/hlfv1/composer/composer-channel.tx</code>。</p> 
  <p>生成channel的命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">configtxgen <span class="hljs-attribute">-profile</span> ComposerChannel <span class="hljs-attribute">-outputCreateChannelTx</span> <span class="hljs-built_in">.</span>/composer<span class="hljs-attribute">-channel</span><span class="hljs-built_in">.</span>tx <span class="hljs-attribute">-channelID</span> composerchannel</code></pre> 
  <h3 id="三-生成连接fabric区块链网络的配置文件">三、 生成连接Fabric区块链网络的配置文件</h3> 
  <p>新建一个文件夹（<code>connection</code>）：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">cd ~/fabric<span class="hljs-attribute">-tools</span>/fabric<span class="hljs-attribute">-scripts</span>/hlfv1
mkdir connection</code></pre> 
  <p>创建配置文件<code>connection.json</code>：</p> 
  <pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-built_in">cd</span> connection/
touch connection.json</code></pre> 
  <p>打开<code>connection.json</code>，配置内容如下：</p> 
  <pre class="prettyprint"><code class=" hljs json">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"fabric-network"</span></span>,
  "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"hlfv1"</span></span>,
  "<span class="hljs-attribute">mspID</span>": <span class="hljs-value"><span class="hljs-string">"Org1MSP"</span></span>,
  "<span class="hljs-attribute">peers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpc://localhost:7051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpc://localhost:7053"</span> </span>} ]</span>,
  "<span class="hljs-attribute">ca</span>": <span class="hljs-value">{ "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"http://localhost:7054"</span></span>, "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"ca.org1.example.com"</span> </span>}</span>,
  "<span class="hljs-attribute">orderers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">url</span>" : <span class="hljs-value"><span class="hljs-string">"grpc://localhost:7050"</span> </span>} ]</span>,
  "<span class="hljs-attribute">channel</span>": <span class="hljs-value"><span class="hljs-string">"composerchannel"</span></span>,
  "<span class="hljs-attribute">timeout</span>": <span class="hljs-value"><span class="hljs-number">300</span> </span>}</code></pre> 
  <p><a href="http://blog.csdn.net/qq_27818541/article/details/78923921" rel="nofollow">字段详解请看这里</a></p> 
  <h3 id="四-找到fabric网络的管理员证书以及私钥">四、 找到Fabric网络的管理员证书以及私钥</h3> 
  <p>前面已经说过了，只有Fabric的管理员身份才能部署BNA文件（业务网络），我们来看看他长什么样子吧。</p> 
  <h4 id="1管理员证书">1、管理员证书</h4> 
  <blockquote> 
   <p>~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem</p> 
  </blockquote> 
  <p>这个是用户身份的公共部分：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171228154343470?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h4 id="2管理员私钥">2、管理员私钥</h4> 
  <blockquote> 
   <p>~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/114aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk</p> 
  </blockquote> 
  <p>签名交易时使用：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171228155702710?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" title=""></p> 
  <h4 id="3把上面的两个文件复制到配置文件所在的目录">3、把上面的两个文件复制到配置文件所在的目录</h4> 
  <pre class="prettyprint"><code class=" hljs avrasm"> <span class="hljs-keyword">cp</span>   ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>/users/Admin@org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>/msp/signcerts/Admin@org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>-cert<span class="hljs-preprocessor">.pem</span>    ~/fabric-tools/fabric-scripts/hlfv1/connection
 <span class="hljs-keyword">cp</span>   ~/fabric-tools/fabric-scripts/hlfv1/composer/crypto-config/peerOrganizations/org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>/users/Admin@org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>/msp/keystore/<span class="hljs-number">114</span>aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk   ~/fabric-tools/fabric-scripts/hlfv1/connection</code></pre> 
  <h3 id="五-为hyperledger-fabric管理员创建一个业务网络访问卡business-network-card">五、 为Hyperledger Fabric管理员创建一个业务网络访问卡（business network card）</h3> 
  <h4 id="1card介绍">1、card介绍</h4> 
  <p>目前在<code>~/fabric-tools/fabric-scripts/hlfv1/connection</code>目录中有如下文件：</p> 
  <pre class="prettyprint"><code class="language-java hljs ">.    <span class="hljs-comment">// 管理员私钥</span>
├── <span class="hljs-number">114</span>aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk
    <span class="hljs-comment">// 管理员证书</span>
├── Admin<span class="hljs-annotation">@org</span>1.example.com-cert.pem
    <span class="hljs-comment">// 连接配置文件</span>
└── connection.json</code></pre> 
  <p>使用这些文件可以生成<code>business network card</code>，其作用为：</p> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-comment">// 1 可以连接Fabric区块链网络</span>
<span class="hljs-comment">// 2 可以连接`business network `（业务网络）</span></code></pre> 
  <h4 id="2生成card">2、生成card</h4> 
  <p>执行如下命令：</p> 
  <pre class="prettyprint"><code class="language-shell hljs haml">cd  ~/fabric-tools/fabric-scripts/hlfv1/connection

composer card create \
-<span class="ruby">p connection.json \ </span>-<span class="ruby">u <span class="hljs-constant">PeerAdmin</span> \ </span>-<span class="ruby">c <span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com-cert.pem \ </span>-<span class="ruby">k <span class="hljs-number">114</span>aab0e76bf0c78308f89efc4b8c9423e31568da0c340ca187a9b17aa9a4457_sk \ </span>-<span class="ruby">r <span class="hljs-constant">PeerAdmin</span> -r <span class="hljs-constant">ChannelAdmin</span></span></code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171229133358958?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>执行成功后，在当前目录（<code>connection</code>）下会多出一个<code>.card</code>文件：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171229133751108?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h4 id="3生成card命令的详解">3、生成card命令的详解</h4> 
  <p><a href="http://blog.csdn.net/qq_27818541/article/details/78930686" rel="nofollow">生成card命令的详细介绍请看这里。</a></p> 
  <h3 id="六-为hyperledger-fabric管理员导入业务网卡">六、 为Hyperledger Fabric管理员导入业务网卡</h3> 
  <p>执行下面命令：</p> 
  <pre class="prettyprint"><code class="language-shell hljs lasso">cd ~/fabric<span class="hljs-attribute">-tools</span>/fabric<span class="hljs-attribute">-scripts</span>/hlfv1/connection

composer card <span class="hljs-keyword">import</span> <span class="hljs-attribute">-f</span> PeerAdmin@fabric<span class="hljs-attribute">-network</span><span class="hljs-built_in">.</span>card</code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171229160850297?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>导入成功后，使用<code>composer card list</code> 查看详情：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171229155959435?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="七-安装-hyperledger-composer-runtime">七、 安装 Hyperledger Composer runtime</h3> 
  <blockquote> 
   <p>这一步骤的操作如同<a href="http://blog.csdn.net/qq_27818541/article/details/77847483#install-%E5%AE%89%E8%A3%85" rel="nofollow">Hyperledger Fabric 术语里面的安装chaincode</a></p> 
  </blockquote> 
  <p>根据官网的描述，Hyperledger Composer runtime 就是一个chaincode，需要把它安装到peer节点（配置文件上定义的）上。同时需要为区块链业务网络（blockchain business network）定义一个名称。 <br> 执行下面命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">composer runtime install <span class="hljs-attribute">-c</span> PeerAdmin@fabric<span class="hljs-attribute">-network</span> <span class="hljs-attribute">-n</span> tutorial<span class="hljs-attribute">-network</span></code></pre> 
  <p>安装成功：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171229161541358?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="八-运行区块链业务网络blockchain-business-network">八、 运行区块链业务网络（blockchain business network）</h3> 
  <h4 id="1准备bna文件业务网络文件">1、准备BNA文件（业务网络文件）</h4> 
  <p>这里借用下官方示例<code>basic-sample-network</code>。</p> 
  <p>执行下面命令：</p> 
  <pre class="prettyprint"><code class="language-shell hljs vala">cd ~

<span class="hljs-preprocessor"># git官方示例</span>
git clone https:<span class="hljs-comment">//github.com/hyperledger/composer-sample-networks.git</span>

<span class="hljs-preprocessor"># 使用其中的一个示例</span>
cp -r ./composer-sample-networks/packages/basic-sample-network/  ./

<span class="hljs-preprocessor"># 进入到这个目录</span>
cd basic-sample-network

<span class="hljs-preprocessor">#安装依赖 </span>
<span class="hljs-preprocessor"># npm install</span>
</code></pre> 
  <p>修改<code>package.json</code>里面的两个地方：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180102140416771?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180102140825491?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>生成bna文件：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180102141025277?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>复制<code>bna</code>文件到<code>connection</code>文件夹下：</p> 
  <pre class="prettyprint"><code class="language-java hljs ">
cp  ~/basic-sample-network/dist/tutorial-network.bna  ~/fabric-tools/fabric-scripts/hlfv1/connection/</code></pre> 
  <h4 id="2运行业务网络初始化chaincode">2、运行业务网络（初始化chaincode）</h4> 
  <blockquote> 
   <p>这一步骤的操作如同<a href="http://blog.csdn.net/qq_27818541/article/details/77847483#instantiate-%E5%AE%9E%E4%BE%8B" rel="nofollow">Hyperledger Fabric 术语里面的初始化chaincode</a></p> 
  </blockquote> 
  <pre class="prettyprint"><code class=" hljs lasso">composer network start <span class="hljs-attribute">-c</span> PeerAdmin@fabric<span class="hljs-attribute">-network</span> <span class="hljs-attribute">-a</span> tutorial<span class="hljs-attribute">-network</span><span class="hljs-built_in">.</span>bna <span class="hljs-attribute">-A</span> admin <span class="hljs-attribute">-S</span> adminpw</code></pre> 
  <p>运行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180102141506774?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><code>docker ps</code> 查看此时的容器：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">CONTAINER ID        IMAGE                                                                                                                 COMMAND                  CREATED             STATUS              PORTS                                            NAMES
<span class="hljs-comment">// 这个步骤 就相当于 初始化 chaincode 自动生成合约镜像</span>
e3df6b05dc64        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span><span class="hljs-subst">-</span><span class="hljs-number">3</span>f443591c7f8b7c2cfb3c343bf26b99fd7c39b97ca8327bd8c07ee99460b01d4   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">4</span> hours ago         Up <span class="hljs-number">4</span> hours                                                           dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>
<span class="hljs-number">195793779</span>b99        hyperledger/fabric<span class="hljs-attribute">-peer</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>                                                                                  <span class="hljs-string">"peer node start -..."</span>   <span class="hljs-number">4</span> days ago          Up <span class="hljs-number">4</span> days           <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp   peer0<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">98</span>ad2ad2224d        hyperledger/fabric<span class="hljs-attribute">-ca</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>                                                                                    <span class="hljs-string">"sh -c 'fabric-ca-..."</span>   <span class="hljs-number">4</span> days ago          Up <span class="hljs-number">4</span> days           <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7054</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7054</span>/tcp                           ca<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">2907</span>f48a3f02        hyperledger/fabric<span class="hljs-attribute">-orderer</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>                                                                               <span class="hljs-string">"orderer"</span>                <span class="hljs-number">4</span> days ago          Up <span class="hljs-number">4</span> days           <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7050</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7050</span>/tcp                           orderer<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
d00f2d5fcc28        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.4</span>                                                                               <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">4</span> days ago          Up <span class="hljs-number">4</span> days           <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">5984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp       couchdb
</code></pre> 
  <h3 id="九-导入业务网络管理员身份">九、 导入业务网络管理员身份</h3> 
  <pre class="prettyprint"><code class=" hljs lasso">composer card <span class="hljs-keyword">import</span> <span class="hljs-attribute">-f</span> admin@tutorial<span class="hljs-attribute">-network</span><span class="hljs-built_in">.</span>card</code></pre> 
  <p>导入后，我们查看下钱包中维护的身份:</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180102141853391?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="十-测试下到业务网络的连接是否通常">十、 测试下到业务网络的连接是否通常</h3> 
  <pre class="prettyprint"><code class=" hljs lasso">composer network ping <span class="hljs-attribute">-c</span> admin@tutorial<span class="hljs-attribute">-network</span></code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180102173010335?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="十一-生成rest-api">十一、 生成REST API</h3> 
  <pre class="prettyprint"><code class="language-shell hljs lasso"> composer<span class="hljs-attribute">-rest</span><span class="hljs-attribute">-server</span></code></pre> 
  <p>执行效果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105114217822?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>进入<code>http://localhost:3000/explorer</code> ，每个模块都可以CRUD，你可以愉快的编写WEB应用或者移动应用了：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105114544276?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_27818541/article/details/78727076,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_27818541/article/details/78727076,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用Hyperledger Composer将业务网络部署到多个组织的Hyperledger Fabric区块链上 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用Hyperledger Composer将业务网络部署到多个组织的Hyperledger Fabric区块链上" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727086 本文已在我的公众号Fabric技术分享原创首发。 转载请标明出处： http://blog.csdn.net/qq_27818541/article/details/78727086 本文出自:【BigManing的博客】 前言 准备 一 、启动Fabric网络 二 、创建连接配置文件 三 、认识下每个组织的管理员 1、org1的管理员 2、org2的管理员 三 、为Org1的Hyperledger Fabric管理员创建business network card 1、 使用connection-org1-only.json配置文件 2、 使用connection-org1.json配置文件 四 、为Org2的Hyperledger Fabric管理员创建business network card 1、 使用connection-org2-only.json配置文件 2、 使用connection-org2.json配置文件 五 、 导入business network cards 六、 每个组织分别安装Hyperledger Composer runtime 七、 定义业务网络的认证策略 八、 生成各组织的业务网络管理员证书材料 九、 启动业务网络（business network） 1、 准备BNA文件，这里使用先前的文件 2、执行命令 十、 为各个组织生成访问业务网络的Business Network Card 1、org1 2、org2 3、查看此时的card列表 十一、生成REST API 前言 首先你必须有单组织部署的经验，然后再继续下面的文章。文中和单组织部署相同的部分，就不做详细解析了，直接用代码来展示。 这个功能差不多是从Composer v0.15开始支持的， 官方的更新还是很给力的。它主要解决了多组织的 如何连接到网络 如何部署chaincode 如何设置认证策略 我的环境： Ubuntu 16.04 //我的操作系统 Hyperledger Composer 0.16 Hyperledger Fabric 1.0.4 准备 停止以前的Fabric网络 cd ~/fabric-tools ./stopFabric.sh ./teardownFabric.sh 下载fabric-samples ，这个是sstone1维护的示例 cd ~ git clone -b issue-6978 https://github.com/sstone1/fabric-samples.git 一 、启动Fabric网络 定位到first-network目录，启动网络： # 生成证书材料、channel材料 ./byfn.sh -m generate #启用couchdb作为world state 存储的媒介 ./byfn.sh -m up -s couchdb -a 运行成功后，docker ps： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES a618b05fe741 dev-peer1.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 28 minutes ago Up 28 minutes dev-peer1.org2.example.com-mycc-1.0 076e43320a44 dev-peer0.org1.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 28 minutes ago Up 28 minutes dev-peer0.org1.example.com-mycc-1.0 d29a758de28d dev-peer0.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 29 minutes ago Up 29 minutes dev-peer0.org2.example.com-mycc-1.0 a38167d7a39b hyperledger/fabric-tools &quot;/bin/bash -c &#39;./s...&quot; 29 minutes ago Up 29 minutes cli 8682cd2d0c1f hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer1.org2.example.com 1cbe73e3cf71 hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer0.org2.example.com a946a790f0d5 hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com c00f8a69b38b hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 30 minutes 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer1.org1.example.com c4d17a0b2305 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 30 minutes ago Up 30 minutes 0.0.0.0:8054-&gt;7054/tcp ca_peerOrg2 2dd80d092779 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp couchdb2 54a410b83a23 hyperledger/fabric-orderer &quot;orderer&quot; 30 minutes ago Up 30 minutes 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 8e5dbf668466 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:6984-&gt;5984/tcp couchdb1 245dc07d87c5 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb0 fbc846f192e5 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 30 minutes ago Up 30 minutes 0.0.0.0:7054-&gt;7054/tcp ca_peerOrg1 d9bbd213a460 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:8984-&gt;5984/tcp 为了避免错误，清理缓存的card 身份： composer card delete -n PeerAdmin@byfn-network-org1-only composer card delete -n PeerAdmin@byfn-network-org1 composer card delete -n PeerAdmin@byfn-network-org2-only composer card delete -n PeerAdmin@byfn-network-org2 composer card delete -n alice@tutorial-network composer card delete -n bob@tutorial-network composer card delete -n admin@tutorial-network composer card delete -n PeerAdmin@fabric-network 二 、创建连接配置文件 和单组织的配置文件不同，这里的每个组织需要两个配置文件。一个是只包含自己节点的配置文件，一个是包含org1和org2所有节点的配置文件。 定位到first-network目录下，新建connection文件夹并根据组织分别来创建配置文件： org1对应的配置文件 connection-org1-only.json { &quot;name&quot;: &quot;byfn-network-org1-only&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:7053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:8053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:7054&quot;, &quot;name&quot;: &quot;ca-org1&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } connection-org1.json { &quot;name&quot;: &quot;byfn-network-org1&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:7053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:8053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:7054&quot;, &quot;name&quot;: &quot;ca-org1&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } org2对应的配置文件 connection-org2-only.json { &quot;name&quot;: &quot;byfn-network-org2-only&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org2MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:9053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:10053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:8054&quot;, &quot;name&quot;: &quot;ca-org2&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org2.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } connection-org2.json { &quot;name&quot;: &quot;byfn-network-org2&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org2MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:9053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:10053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:8054&quot;, &quot;name&quot;: &quot;ca-org2&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org2.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } 三 、认识下每个组织的管理员 记住下面的证书材料、私钥的位置，后续有用。 1、org1的管理员 2、org2的管理员 三 、为Org1的Hyperledger Fabric管理员创建business network card 1、 使用connection-org1-only.json配置文件 composer card create \ -p connection-org1-only.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \ -r PeerAdmin -r ChannelAdmin 运行结果： 2、 使用connection-org1.json配置文件 composer card create \ -p connection-org1.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \ -r PeerAdmin -r ChannelAdmin 运行结果： 四 、为Org2的Hyperledger Fabric管理员创建business network card 1、 使用connection-org2-only.json配置文件 composer card create \ -p connection-org2-only.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/434a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \ -r PeerAdmin -r ChannelAdmin 2、 使用connection-org2.json配置文件 composer card create \ -p connection-org2.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/434a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \ -r PeerAdmin -r ChannelAdmin 运行结果： 最终多出了下面几个文件： 五 、 导入business network cards 上面生成的card并没有在composer维护的wallet中： 通过下面命令,把card导入到wallet中： composer card import -f PeerAdmin@byfn-network-org1-only.card composer card import -f PeerAdmin@byfn-network-org1.card composer card import -f PeerAdmin@byfn-network-org2-only.card composer card import -f PeerAdmin@byfn-network-org2.card 执行成功后，查看card： 六、 每个组织分别安装Hyperledger Composer runtime 每个组织使用自己的管理员身份，同时指定一个业务网络的名称： composer runtime install -c PeerAdmin@byfn-network-org1-only -n tutorial-network composer runtime install -c PeerAdmin@byfn-network-org2-only -n tutorial-network 运行结果： 七、 定义业务网络的认证策略 请注意，用于业务网络的认可政策必须采用Hyperledger Fabric Node.js SDK使用的JSON格式。这与Hyperledger Fabric CLI使用的简单批注策略格式有所不同，您可以在Hyperledger Fabric文档中看到这种格式。 在v0.15之前是没有这个功能的，新增的这个功能更加贴近现实场景，使得composer功能更加强大。 在connection目录下新建文件endorsement-policy.json，编辑内容如下： { &quot;identities&quot;: [ { &quot;role&quot;: { &quot;name&quot;: &quot;member&quot;, &quot;mspId&quot;: &quot;Org1MSP&quot; } }, { &quot;role&quot;: { &quot;name&quot;: &quot;member&quot;, &quot;mspId&quot;: &quot;Org2MSP&quot; } } ], &quot;policy&quot;: { &quot;2-of&quot;: [ { &quot;signed-by&quot;: 0 }, { &quot;signed-by&quot;: 1 } ] } } 这个认证策略是所有的交易必须经过org1和org2成员的背书，然后才能被提交到区块链上。 八、 生成各组织的业务网络管理员证书材料 业务网络启动时，业务网络必须配置一组初始参与者。这些参与者将负责引导业务网络，并将其他参与者引入业务网络。在Hyperledger Composer中，我们将这些初始参与者称为业务网络管理员。 我们要设定 Org1的业务网络管理员将是Alice，而Org2的业务网络管理员将是Bob。 当业务网络启动时，所有业务网络管理员的证书（身份的公共部分）必须传递给执行命令的组织以启动业务网络。业务网络启动后，所有业务网络管理员都可以使用自己的身份与业务网络进行交互。 执行命令： composer identity request -c PeerAdmin@byfn-network-org1-only -u admin -s adminpw -d alice composer identity request -c PeerAdmin@byfn-network-org2-only -u admin -s adminpw -d bob 运行结果： 九、 启动业务网络（business network） 1、 准备BNA文件，这里使用先前的文件 2、执行命令 只让org1来启动业务网络即可： composer network start \ -c PeerAdmin@byfn-network-org1 \ -a tutorial-network.bna \ -o endorsementPolicyFile=endorsement-policy.json \ -A alice -C alice/admin-pub.pem \ -A bob -C bob/admin-pub.pem 执行结果： docker ps 查看，多出了四个镜像。 这四个是composer部署的智能合约（业务网络），分别对应每个peer。 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 667218cb17b6 dev-peer0.org2.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer0.org2.example.com-tutorial-network-0.16.2 561aa195fbca dev-peer1.org2.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer1.org2.example.com-tutorial-network-0.16.2 f58e51bcb8fd dev-peer1.org1.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer1.org1.example.com-tutorial-network-0.16.2 9d84d7f04295 dev-peer0.org1.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer0.org1.example.com-tutorial-network-0.16.2 3c914b2745b0 dev-peer1.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer1.org2.example.com-mycc-1.0 6b8c7ad3de63 dev-peer0.org1.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer0.org1.example.com-mycc-1.0 eecfcd21c857 dev-peer0.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer0.org2.example.com-mycc-1.0 ec4e856f351a hyperledger/fabric-tools &quot;/bin/bash -c &#39;./s...&quot; 3 hours ago Up 3 hours cli 6c390e2db6f2 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer0.org2.example.com 65ad7c67e695 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer1.org2.example.com 3edfd4635d79 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com d7e3bd8f3e02 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer1.org1.example.com 426be6f24ce8 hyperledger/fabric-orderer &quot;orderer&quot; 3 hours ago Up 3 hours 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 1fb18693331d hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp couchdb2 b7d5da5434b7 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 3 hours ago Up 3 hours 0.0.0.0:8054-&gt;7054/tcp ca_peerOrg2 46eb39200ee3 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:8984-&gt;5984/tcp couchdb3 993a8a9ab5f7 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb0 7d15e8dfd210 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 3 hours ago Up 3 hours 0.0.0.0:7054-&gt;7054/tcp ca_peerOrg1 bfc01df48996 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:6984-&gt;5984/tcp couchdb1 十、 为各个组织生成访问业务网络的Business Network Card 业务网络启动后，Alice和Bob都能够访问业务网络，可以从其各自的组织中接受其他参与者。但是，Alice和Bob都必须创建新的业务网卡（需要第八步骤生成的证书），以便他们可以访问业务网络。 接下来的流程：生成Card–&gt;导入Card–&gt;测试是否通畅 1、org1 执行命令： composer card create -p connection-org1.json -u alice -n tutorial-network -c alice/admin-pub.pem -k alice/admin-priv.pem composer card import -f alice@tutorial-network.card composer network ping -c alice@tutorial-network 执行结果： 2、org2 执行命令： composer card create -p connection-org2.json -u bob -n tutorial-network -c bob/admin-pub.pem -k bob/admin-priv.pem composer card import -f bob@tutorial-network.card composer network ping -c bob@tutorial-network 执行结果： 3、查看此时的card列表 图中那两个card是专门访问业务网络 十一、生成REST API 使用官方命令 ： composer-rest-server 执行结果： rest api ： 阅读更多 登录后自动展开" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727086 本文已在我的公众号Fabric技术分享原创首发。 转载请标明出处： http://blog.csdn.net/qq_27818541/article/details/78727086 本文出自:【BigManing的博客】 前言 准备 一 、启动Fabric网络 二 、创建连接配置文件 三 、认识下每个组织的管理员 1、org1的管理员 2、org2的管理员 三 、为Org1的Hyperledger Fabric管理员创建business network card 1、 使用connection-org1-only.json配置文件 2、 使用connection-org1.json配置文件 四 、为Org2的Hyperledger Fabric管理员创建business network card 1、 使用connection-org2-only.json配置文件 2、 使用connection-org2.json配置文件 五 、 导入business network cards 六、 每个组织分别安装Hyperledger Composer runtime 七、 定义业务网络的认证策略 八、 生成各组织的业务网络管理员证书材料 九、 启动业务网络（business network） 1、 准备BNA文件，这里使用先前的文件 2、执行命令 十、 为各个组织生成访问业务网络的Business Network Card 1、org1 2、org2 3、查看此时的card列表 十一、生成REST API 前言 首先你必须有单组织部署的经验，然后再继续下面的文章。文中和单组织部署相同的部分，就不做详细解析了，直接用代码来展示。 这个功能差不多是从Composer v0.15开始支持的， 官方的更新还是很给力的。它主要解决了多组织的 如何连接到网络 如何部署chaincode 如何设置认证策略 我的环境： Ubuntu 16.04 //我的操作系统 Hyperledger Composer 0.16 Hyperledger Fabric 1.0.4 准备 停止以前的Fabric网络 cd ~/fabric-tools ./stopFabric.sh ./teardownFabric.sh 下载fabric-samples ，这个是sstone1维护的示例 cd ~ git clone -b issue-6978 https://github.com/sstone1/fabric-samples.git 一 、启动Fabric网络 定位到first-network目录，启动网络： # 生成证书材料、channel材料 ./byfn.sh -m generate #启用couchdb作为world state 存储的媒介 ./byfn.sh -m up -s couchdb -a 运行成功后，docker ps： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES a618b05fe741 dev-peer1.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 28 minutes ago Up 28 minutes dev-peer1.org2.example.com-mycc-1.0 076e43320a44 dev-peer0.org1.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 28 minutes ago Up 28 minutes dev-peer0.org1.example.com-mycc-1.0 d29a758de28d dev-peer0.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 29 minutes ago Up 29 minutes dev-peer0.org2.example.com-mycc-1.0 a38167d7a39b hyperledger/fabric-tools &quot;/bin/bash -c &#39;./s...&quot; 29 minutes ago Up 29 minutes cli 8682cd2d0c1f hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer1.org2.example.com 1cbe73e3cf71 hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer0.org2.example.com a946a790f0d5 hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com c00f8a69b38b hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 30 minutes 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer1.org1.example.com c4d17a0b2305 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 30 minutes ago Up 30 minutes 0.0.0.0:8054-&gt;7054/tcp ca_peerOrg2 2dd80d092779 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp couchdb2 54a410b83a23 hyperledger/fabric-orderer &quot;orderer&quot; 30 minutes ago Up 30 minutes 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 8e5dbf668466 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:6984-&gt;5984/tcp couchdb1 245dc07d87c5 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb0 fbc846f192e5 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 30 minutes ago Up 30 minutes 0.0.0.0:7054-&gt;7054/tcp ca_peerOrg1 d9bbd213a460 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:8984-&gt;5984/tcp 为了避免错误，清理缓存的card 身份： composer card delete -n PeerAdmin@byfn-network-org1-only composer card delete -n PeerAdmin@byfn-network-org1 composer card delete -n PeerAdmin@byfn-network-org2-only composer card delete -n PeerAdmin@byfn-network-org2 composer card delete -n alice@tutorial-network composer card delete -n bob@tutorial-network composer card delete -n admin@tutorial-network composer card delete -n PeerAdmin@fabric-network 二 、创建连接配置文件 和单组织的配置文件不同，这里的每个组织需要两个配置文件。一个是只包含自己节点的配置文件，一个是包含org1和org2所有节点的配置文件。 定位到first-network目录下，新建connection文件夹并根据组织分别来创建配置文件： org1对应的配置文件 connection-org1-only.json { &quot;name&quot;: &quot;byfn-network-org1-only&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:7053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:8053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:7054&quot;, &quot;name&quot;: &quot;ca-org1&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } connection-org1.json { &quot;name&quot;: &quot;byfn-network-org1&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:7053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:8053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:7054&quot;, &quot;name&quot;: &quot;ca-org1&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } org2对应的配置文件 connection-org2-only.json { &quot;name&quot;: &quot;byfn-network-org2-only&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org2MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:9053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:10053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:8054&quot;, &quot;name&quot;: &quot;ca-org2&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org2.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } connection-org2.json { &quot;name&quot;: &quot;byfn-network-org2&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org2MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:9053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:10053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:8054&quot;, &quot;name&quot;: &quot;ca-org2&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org2.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } 三 、认识下每个组织的管理员 记住下面的证书材料、私钥的位置，后续有用。 1、org1的管理员 2、org2的管理员 三 、为Org1的Hyperledger Fabric管理员创建business network card 1、 使用connection-org1-only.json配置文件 composer card create \ -p connection-org1-only.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \ -r PeerAdmin -r ChannelAdmin 运行结果： 2、 使用connection-org1.json配置文件 composer card create \ -p connection-org1.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \ -r PeerAdmin -r ChannelAdmin 运行结果： 四 、为Org2的Hyperledger Fabric管理员创建business network card 1、 使用connection-org2-only.json配置文件 composer card create \ -p connection-org2-only.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/434a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \ -r PeerAdmin -r ChannelAdmin 2、 使用connection-org2.json配置文件 composer card create \ -p connection-org2.json \ -u PeerAdmin \ -c ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem \ -k ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/434a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \ -r PeerAdmin -r ChannelAdmin 运行结果： 最终多出了下面几个文件： 五 、 导入business network cards 上面生成的card并没有在composer维护的wallet中： 通过下面命令,把card导入到wallet中： composer card import -f PeerAdmin@byfn-network-org1-only.card composer card import -f PeerAdmin@byfn-network-org1.card composer card import -f PeerAdmin@byfn-network-org2-only.card composer card import -f PeerAdmin@byfn-network-org2.card 执行成功后，查看card： 六、 每个组织分别安装Hyperledger Composer runtime 每个组织使用自己的管理员身份，同时指定一个业务网络的名称： composer runtime install -c PeerAdmin@byfn-network-org1-only -n tutorial-network composer runtime install -c PeerAdmin@byfn-network-org2-only -n tutorial-network 运行结果： 七、 定义业务网络的认证策略 请注意，用于业务网络的认可政策必须采用Hyperledger Fabric Node.js SDK使用的JSON格式。这与Hyperledger Fabric CLI使用的简单批注策略格式有所不同，您可以在Hyperledger Fabric文档中看到这种格式。 在v0.15之前是没有这个功能的，新增的这个功能更加贴近现实场景，使得composer功能更加强大。 在connection目录下新建文件endorsement-policy.json，编辑内容如下： { &quot;identities&quot;: [ { &quot;role&quot;: { &quot;name&quot;: &quot;member&quot;, &quot;mspId&quot;: &quot;Org1MSP&quot; } }, { &quot;role&quot;: { &quot;name&quot;: &quot;member&quot;, &quot;mspId&quot;: &quot;Org2MSP&quot; } } ], &quot;policy&quot;: { &quot;2-of&quot;: [ { &quot;signed-by&quot;: 0 }, { &quot;signed-by&quot;: 1 } ] } } 这个认证策略是所有的交易必须经过org1和org2成员的背书，然后才能被提交到区块链上。 八、 生成各组织的业务网络管理员证书材料 业务网络启动时，业务网络必须配置一组初始参与者。这些参与者将负责引导业务网络，并将其他参与者引入业务网络。在Hyperledger Composer中，我们将这些初始参与者称为业务网络管理员。 我们要设定 Org1的业务网络管理员将是Alice，而Org2的业务网络管理员将是Bob。 当业务网络启动时，所有业务网络管理员的证书（身份的公共部分）必须传递给执行命令的组织以启动业务网络。业务网络启动后，所有业务网络管理员都可以使用自己的身份与业务网络进行交互。 执行命令： composer identity request -c PeerAdmin@byfn-network-org1-only -u admin -s adminpw -d alice composer identity request -c PeerAdmin@byfn-network-org2-only -u admin -s adminpw -d bob 运行结果： 九、 启动业务网络（business network） 1、 准备BNA文件，这里使用先前的文件 2、执行命令 只让org1来启动业务网络即可： composer network start \ -c PeerAdmin@byfn-network-org1 \ -a tutorial-network.bna \ -o endorsementPolicyFile=endorsement-policy.json \ -A alice -C alice/admin-pub.pem \ -A bob -C bob/admin-pub.pem 执行结果： docker ps 查看，多出了四个镜像。 这四个是composer部署的智能合约（业务网络），分别对应每个peer。 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 667218cb17b6 dev-peer0.org2.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer0.org2.example.com-tutorial-network-0.16.2 561aa195fbca dev-peer1.org2.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer1.org2.example.com-tutorial-network-0.16.2 f58e51bcb8fd dev-peer1.org1.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer1.org1.example.com-tutorial-network-0.16.2 9d84d7f04295 dev-peer0.org1.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer0.org1.example.com-tutorial-network-0.16.2 3c914b2745b0 dev-peer1.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer1.org2.example.com-mycc-1.0 6b8c7ad3de63 dev-peer0.org1.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer0.org1.example.com-mycc-1.0 eecfcd21c857 dev-peer0.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer0.org2.example.com-mycc-1.0 ec4e856f351a hyperledger/fabric-tools &quot;/bin/bash -c &#39;./s...&quot; 3 hours ago Up 3 hours cli 6c390e2db6f2 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer0.org2.example.com 65ad7c67e695 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer1.org2.example.com 3edfd4635d79 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com d7e3bd8f3e02 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer1.org1.example.com 426be6f24ce8 hyperledger/fabric-orderer &quot;orderer&quot; 3 hours ago Up 3 hours 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 1fb18693331d hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp couchdb2 b7d5da5434b7 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 3 hours ago Up 3 hours 0.0.0.0:8054-&gt;7054/tcp ca_peerOrg2 46eb39200ee3 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:8984-&gt;5984/tcp couchdb3 993a8a9ab5f7 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb0 7d15e8dfd210 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 3 hours ago Up 3 hours 0.0.0.0:7054-&gt;7054/tcp ca_peerOrg1 bfc01df48996 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:6984-&gt;5984/tcp couchdb1 十、 为各个组织生成访问业务网络的Business Network Card 业务网络启动后，Alice和Bob都能够访问业务网络，可以从其各自的组织中接受其他参与者。但是，Alice和Bob都必须创建新的业务网卡（需要第八步骤生成的证书），以便他们可以访问业务网络。 接下来的流程：生成Card–&gt;导入Card–&gt;测试是否通畅 1、org1 执行命令： composer card create -p connection-org1.json -u alice -n tutorial-network -c alice/admin-pub.pem -k alice/admin-priv.pem composer card import -f alice@tutorial-network.card composer network ping -c alice@tutorial-network 执行结果： 2、org2 执行命令： composer card create -p connection-org2.json -u bob -n tutorial-network -c bob/admin-pub.pem -k bob/admin-priv.pem composer card import -f bob@tutorial-network.card composer network ping -c bob@tutorial-network 执行结果： 3、查看此时的card列表 图中那两个card是专门访问业务网络 十一、生成REST API 使用官方命令 ： composer-rest-server 执行结果： rest api ： 阅读更多 登录后自动展开" />
<link rel="canonical" href="https://mlh.app/2018/01/15/1e38fa65e910af105599d819a8041c59.html" />
<meta property="og:url" content="https://mlh.app/2018/01/15/1e38fa65e910af105599d819a8041c59.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-15T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727086 本文已在我的公众号Fabric技术分享原创首发。 转载请标明出处： http://blog.csdn.net/qq_27818541/article/details/78727086 本文出自:【BigManing的博客】 前言 准备 一 、启动Fabric网络 二 、创建连接配置文件 三 、认识下每个组织的管理员 1、org1的管理员 2、org2的管理员 三 、为Org1的Hyperledger Fabric管理员创建business network card 1、 使用connection-org1-only.json配置文件 2、 使用connection-org1.json配置文件 四 、为Org2的Hyperledger Fabric管理员创建business network card 1、 使用connection-org2-only.json配置文件 2、 使用connection-org2.json配置文件 五 、 导入business network cards 六、 每个组织分别安装Hyperledger Composer runtime 七、 定义业务网络的认证策略 八、 生成各组织的业务网络管理员证书材料 九、 启动业务网络（business network） 1、 准备BNA文件，这里使用先前的文件 2、执行命令 十、 为各个组织生成访问业务网络的Business Network Card 1、org1 2、org2 3、查看此时的card列表 十一、生成REST API 前言 首先你必须有单组织部署的经验，然后再继续下面的文章。文中和单组织部署相同的部分，就不做详细解析了，直接用代码来展示。 这个功能差不多是从Composer v0.15开始支持的， 官方的更新还是很给力的。它主要解决了多组织的 如何连接到网络 如何部署chaincode 如何设置认证策略 我的环境： Ubuntu 16.04 //我的操作系统 Hyperledger Composer 0.16 Hyperledger Fabric 1.0.4 准备 停止以前的Fabric网络 cd ~/fabric-tools ./stopFabric.sh ./teardownFabric.sh 下载fabric-samples ，这个是sstone1维护的示例 cd ~ git clone -b issue-6978 https://github.com/sstone1/fabric-samples.git 一 、启动Fabric网络 定位到first-network目录，启动网络： # 生成证书材料、channel材料 ./byfn.sh -m generate #启用couchdb作为world state 存储的媒介 ./byfn.sh -m up -s couchdb -a 运行成功后，docker ps： CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES a618b05fe741 dev-peer1.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 28 minutes ago Up 28 minutes dev-peer1.org2.example.com-mycc-1.0 076e43320a44 dev-peer0.org1.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 28 minutes ago Up 28 minutes dev-peer0.org1.example.com-mycc-1.0 d29a758de28d dev-peer0.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 29 minutes ago Up 29 minutes dev-peer0.org2.example.com-mycc-1.0 a38167d7a39b hyperledger/fabric-tools &quot;/bin/bash -c &#39;./s...&quot; 29 minutes ago Up 29 minutes cli 8682cd2d0c1f hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer1.org2.example.com 1cbe73e3cf71 hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer0.org2.example.com a946a790f0d5 hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 29 minutes 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com c00f8a69b38b hyperledger/fabric-peer &quot;peer node start&quot; 30 minutes ago Up 30 minutes 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer1.org1.example.com c4d17a0b2305 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 30 minutes ago Up 30 minutes 0.0.0.0:8054-&gt;7054/tcp ca_peerOrg2 2dd80d092779 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp couchdb2 54a410b83a23 hyperledger/fabric-orderer &quot;orderer&quot; 30 minutes ago Up 30 minutes 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 8e5dbf668466 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:6984-&gt;5984/tcp couchdb1 245dc07d87c5 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb0 fbc846f192e5 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 30 minutes ago Up 30 minutes 0.0.0.0:7054-&gt;7054/tcp ca_peerOrg1 d9bbd213a460 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 30 minutes ago Up 30 minutes 4369/tcp, 9100/tcp, 0.0.0.0:8984-&gt;5984/tcp 为了避免错误，清理缓存的card 身份： composer card delete -n PeerAdmin@byfn-network-org1-only composer card delete -n PeerAdmin@byfn-network-org1 composer card delete -n PeerAdmin@byfn-network-org2-only composer card delete -n PeerAdmin@byfn-network-org2 composer card delete -n alice@tutorial-network composer card delete -n bob@tutorial-network composer card delete -n admin@tutorial-network composer card delete -n PeerAdmin@fabric-network 二 、创建连接配置文件 和单组织的配置文件不同，这里的每个组织需要两个配置文件。一个是只包含自己节点的配置文件，一个是包含org1和org2所有节点的配置文件。 定位到first-network目录下，新建connection文件夹并根据组织分别来创建配置文件： org1对应的配置文件 connection-org1-only.json { &quot;name&quot;: &quot;byfn-network-org1-only&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:7053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:8053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:7054&quot;, &quot;name&quot;: &quot;ca-org1&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } connection-org1.json { &quot;name&quot;: &quot;byfn-network-org1&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org1MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:7053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:8053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:7054&quot;, &quot;name&quot;: &quot;ca-org1&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org1.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } org2对应的配置文件 connection-org2-only.json { &quot;name&quot;: &quot;byfn-network-org2-only&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org2MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:9053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:10053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:8054&quot;, &quot;name&quot;: &quot;ca-org2&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org2.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } connection-org2.json { &quot;name&quot;: &quot;byfn-network-org2&quot;, &quot;type&quot;: &quot;hlfv1&quot;, &quot;mspID&quot;: &quot;Org2MSP&quot;, &quot;peers&quot;: [ { &quot;requestURL&quot;: &quot;grpcs://localhost:9051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:9053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:10051&quot;, &quot;eventURL&quot;: &quot;grpcs://localhost:10053&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org2.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:7051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer0.org1.example.com&quot; }, { &quot;requestURL&quot;: &quot;grpcs://localhost:8051&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;peer1.org1.example.com&quot; } ], &quot;ca&quot;: { &quot;url&quot;: &quot;https://localhost:8054&quot;, &quot;name&quot;: &quot;ca-org2&quot;, &quot;cert&quot;: &quot;../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;ca.org2.example.com&quot; }, &quot;orderers&quot;: [ { &quot;url&quot; : &quot;grpcs://localhost:7050&quot;, &quot;cert&quot;: &quot;../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt&quot;, &quot;hostnameOverride&quot;: &quot;orderer.example.com&quot; } ], &quot;channel&quot;: &quot;mychannel&quot;, &quot;timeout&quot;: 300 } 三 、认识下每个组织的管理员 记住下面的证书材料、私钥的位置，后续有用。 1、org1的管理员 2、org2的管理员 三 、为Org1的Hyperledger Fabric管理员创建business network card 1、 使用connection-org1-only.json配置文件 composer card create \\ -p connection-org1-only.json \\ -u PeerAdmin \\ -c ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \\ -k ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \\ -r PeerAdmin -r ChannelAdmin 运行结果： 2、 使用connection-org1.json配置文件 composer card create \\ -p connection-org1.json \\ -u PeerAdmin \\ -c ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \\ -k ../crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \\ -r PeerAdmin -r ChannelAdmin 运行结果： 四 、为Org2的Hyperledger Fabric管理员创建business network card 1、 使用connection-org2-only.json配置文件 composer card create \\ -p connection-org2-only.json \\ -u PeerAdmin \\ -c ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem \\ -k ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/434a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \\ -r PeerAdmin -r ChannelAdmin 2、 使用connection-org2.json配置文件 composer card create \\ -p connection-org2.json \\ -u PeerAdmin \\ -c ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem \\ -k ../crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/434a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \\ -r PeerAdmin -r ChannelAdmin 运行结果： 最终多出了下面几个文件： 五 、 导入business network cards 上面生成的card并没有在composer维护的wallet中： 通过下面命令,把card导入到wallet中： composer card import -f PeerAdmin@byfn-network-org1-only.card composer card import -f PeerAdmin@byfn-network-org1.card composer card import -f PeerAdmin@byfn-network-org2-only.card composer card import -f PeerAdmin@byfn-network-org2.card 执行成功后，查看card： 六、 每个组织分别安装Hyperledger Composer runtime 每个组织使用自己的管理员身份，同时指定一个业务网络的名称： composer runtime install -c PeerAdmin@byfn-network-org1-only -n tutorial-network composer runtime install -c PeerAdmin@byfn-network-org2-only -n tutorial-network 运行结果： 七、 定义业务网络的认证策略 请注意，用于业务网络的认可政策必须采用Hyperledger Fabric Node.js SDK使用的JSON格式。这与Hyperledger Fabric CLI使用的简单批注策略格式有所不同，您可以在Hyperledger Fabric文档中看到这种格式。 在v0.15之前是没有这个功能的，新增的这个功能更加贴近现实场景，使得composer功能更加强大。 在connection目录下新建文件endorsement-policy.json，编辑内容如下： { &quot;identities&quot;: [ { &quot;role&quot;: { &quot;name&quot;: &quot;member&quot;, &quot;mspId&quot;: &quot;Org1MSP&quot; } }, { &quot;role&quot;: { &quot;name&quot;: &quot;member&quot;, &quot;mspId&quot;: &quot;Org2MSP&quot; } } ], &quot;policy&quot;: { &quot;2-of&quot;: [ { &quot;signed-by&quot;: 0 }, { &quot;signed-by&quot;: 1 } ] } } 这个认证策略是所有的交易必须经过org1和org2成员的背书，然后才能被提交到区块链上。 八、 生成各组织的业务网络管理员证书材料 业务网络启动时，业务网络必须配置一组初始参与者。这些参与者将负责引导业务网络，并将其他参与者引入业务网络。在Hyperledger Composer中，我们将这些初始参与者称为业务网络管理员。 我们要设定 Org1的业务网络管理员将是Alice，而Org2的业务网络管理员将是Bob。 当业务网络启动时，所有业务网络管理员的证书（身份的公共部分）必须传递给执行命令的组织以启动业务网络。业务网络启动后，所有业务网络管理员都可以使用自己的身份与业务网络进行交互。 执行命令： composer identity request -c PeerAdmin@byfn-network-org1-only -u admin -s adminpw -d alice composer identity request -c PeerAdmin@byfn-network-org2-only -u admin -s adminpw -d bob 运行结果： 九、 启动业务网络（business network） 1、 准备BNA文件，这里使用先前的文件 2、执行命令 只让org1来启动业务网络即可： composer network start \\ -c PeerAdmin@byfn-network-org1 \\ -a tutorial-network.bna \\ -o endorsementPolicyFile=endorsement-policy.json \\ -A alice -C alice/admin-pub.pem \\ -A bob -C bob/admin-pub.pem 执行结果： docker ps 查看，多出了四个镜像。 这四个是composer部署的智能合约（业务网络），分别对应每个peer。 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 667218cb17b6 dev-peer0.org2.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer0.org2.example.com-tutorial-network-0.16.2 561aa195fbca dev-peer1.org2.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer1.org2.example.com-tutorial-network-0.16.2 f58e51bcb8fd dev-peer1.org1.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer1.org1.example.com-tutorial-network-0.16.2 9d84d7f04295 dev-peer0.org1.example.com-tutorial-network-0.16.2 &quot;chaincode -peer.a...&quot; 14 minutes ago Up 14 minutes dev-peer0.org1.example.com-tutorial-network-0.16.2 3c914b2745b0 dev-peer1.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer1.org2.example.com-mycc-1.0 6b8c7ad3de63 dev-peer0.org1.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer0.org1.example.com-mycc-1.0 eecfcd21c857 dev-peer0.org2.example.com-mycc-1.0 &quot;chaincode -peer.a...&quot; 3 hours ago Up 3 hours dev-peer0.org2.example.com-mycc-1.0 ec4e856f351a hyperledger/fabric-tools &quot;/bin/bash -c &#39;./s...&quot; 3 hours ago Up 3 hours cli 6c390e2db6f2 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp peer0.org2.example.com 65ad7c67e695 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp peer1.org2.example.com 3edfd4635d79 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp peer0.org1.example.com d7e3bd8f3e02 hyperledger/fabric-peer &quot;peer node start&quot; 3 hours ago Up 3 hours 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp peer1.org1.example.com 426be6f24ce8 hyperledger/fabric-orderer &quot;orderer&quot; 3 hours ago Up 3 hours 0.0.0.0:7050-&gt;7050/tcp orderer.example.com 1fb18693331d hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp couchdb2 b7d5da5434b7 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 3 hours ago Up 3 hours 0.0.0.0:8054-&gt;7054/tcp ca_peerOrg2 46eb39200ee3 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:8984-&gt;5984/tcp couchdb3 993a8a9ab5f7 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp couchdb0 7d15e8dfd210 hyperledger/fabric-ca &quot;sh -c &#39;fabric-ca-...&quot; 3 hours ago Up 3 hours 0.0.0.0:7054-&gt;7054/tcp ca_peerOrg1 bfc01df48996 hyperledger/fabric-couchdb &quot;tini -- /docker-e...&quot; 3 hours ago Up 3 hours 4369/tcp, 9100/tcp, 0.0.0.0:6984-&gt;5984/tcp couchdb1 十、 为各个组织生成访问业务网络的Business Network Card 业务网络启动后，Alice和Bob都能够访问业务网络，可以从其各自的组织中接受其他参与者。但是，Alice和Bob都必须创建新的业务网卡（需要第八步骤生成的证书），以便他们可以访问业务网络。 接下来的流程：生成Card–&gt;导入Card–&gt;测试是否通畅 1、org1 执行命令： composer card create -p connection-org1.json -u alice -n tutorial-network -c alice/admin-pub.pem -k alice/admin-priv.pem composer card import -f alice@tutorial-network.card composer network ping -c alice@tutorial-network 执行结果： 2、org2 执行命令： composer card create -p connection-org2.json -u bob -n tutorial-network -c bob/admin-pub.pem -k bob/admin-priv.pem composer card import -f bob@tutorial-network.card composer network ping -c bob@tutorial-network 执行结果： 3、查看此时的card列表 图中那两个card是专门访问业务网络 十一、生成REST API 使用官方命令 ： composer-rest-server 执行结果： rest api ： 阅读更多 登录后自动展开","@type":"BlogPosting","url":"https://mlh.app/2018/01/15/1e38fa65e910af105599d819a8041c59.html","headline":"使用Hyperledger Composer将业务网络部署到多个组织的Hyperledger Fabric区块链上","dateModified":"2018-01-15T00:00:00+08:00","datePublished":"2018-01-15T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/01/15/1e38fa65e910af105599d819a8041c59.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用Hyperledger Composer将业务网络部署到多个组织的Hyperledger Fabric区块链上</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/qq_27818541/article/details/78727086 
 </div> 
 <div class="markdown_views"> 
  <blockquote> 
   <p>本文已在我的公众号<strong>Fabric技术分享</strong>原创首发。 <br> 转载请标明出处： <br> <a href="http://blog.csdn.net/qq_27818541/article/details/78727086" rel="nofollow">http://blog.csdn.net/qq_27818541/article/details/78727086</a> <br> 本文出自:<a href="http://blog.csdn.net/qq_27818541" rel="nofollow">【BigManing的博客】</a></p> 
  </blockquote> 
  <p></p>
  <div class="toc"> 
   <ul> 
    <li>
     <ul> 
      <li>
       <ul> 
        <li><a href="#前言" rel="nofollow">前言</a></li> 
        <li><a href="#准备" rel="nofollow">准备</a></li> 
        <li><a href="#一-启动fabric网络" rel="nofollow">一 、启动Fabric网络</a></li> 
        <li><a href="#二-创建连接配置文件" rel="nofollow">二 、创建连接配置文件</a></li> 
        <li><a href="#三-认识下每个组织的管理员" rel="nofollow">三 、认识下每个组织的管理员</a>
         <ul> 
          <li><a href="#1org1的管理员" rel="nofollow">1、org1的管理员</a></li> 
          <li><a href="#2org2的管理员" rel="nofollow">2、org2的管理员</a></li> 
         </ul> </li> 
        <li><a href="#三-为org1的hyperledger-fabric管理员创建business-network-card" rel="nofollow">三 、为Org1的Hyperledger Fabric管理员创建business network card</a>
         <ul> 
          <li><a href="#1-使用connection-org1-onlyjson配置文件" rel="nofollow">1、 使用connection-org1-only.json配置文件</a></li> 
          <li><a href="#2-使用connection-org1json配置文件" rel="nofollow">2、 使用connection-org1.json配置文件</a></li> 
         </ul> </li> 
        <li><a href="#四-为org2的hyperledger-fabric管理员创建business-network-card" rel="nofollow">四 、为Org2的Hyperledger Fabric管理员创建business network card</a>
         <ul> 
          <li><a href="#1-使用connection-org2-onlyjson配置文件" rel="nofollow">1、 使用connection-org2-only.json配置文件</a></li> 
          <li><a href="#2-使用connection-org2json配置文件" rel="nofollow">2、 使用connection-org2.json配置文件</a></li> 
         </ul> </li> 
        <li><a href="#五-导入business-network-cards" rel="nofollow">五 、 导入business network cards</a></li> 
        <li><a href="#六-每个组织分别安装hyperledger-composer-runtime" rel="nofollow">六、 每个组织分别安装Hyperledger Composer runtime</a></li> 
        <li><a href="#七-定义业务网络的认证策略" rel="nofollow">七、 定义业务网络的认证策略</a></li> 
        <li><a href="#八-生成各组织的业务网络管理员证书材料" rel="nofollow">八、 生成各组织的业务网络管理员证书材料</a></li> 
        <li><a href="#九-启动业务网络business-network" rel="nofollow">九、 启动业务网络（business network）</a>
         <ul> 
          <li><a href="#1-准备bna文件这里使用先前的文件" rel="nofollow">1、 准备BNA文件，这里使用先前的文件</a></li> 
          <li><a href="#2执行命令" rel="nofollow">2、执行命令</a></li> 
         </ul> </li> 
        <li><a href="#十-为各个组织生成访问业务网络的business-network-card" rel="nofollow">十、 为各个组织生成访问业务网络的Business Network Card</a>
         <ul> 
          <li><a href="#1org1" rel="nofollow">1、org1</a></li> 
          <li><a href="#2org2" rel="nofollow">2、org2</a></li> 
          <li><a href="#3查看此时的card列表" rel="nofollow">3、查看此时的card列表</a></li> 
         </ul> </li> 
        <li><a href="#十一生成rest-api" rel="nofollow">十一、生成REST API</a></li> 
       </ul> </li> 
     </ul> </li> 
   </ul> 
  </div> 
  <p></p> 
  <h3 id="前言">前言</h3> 
  <blockquote> 
   <p>首先你必须有<a href="http://blog.csdn.net/qq_27818541/article/details/78727076" rel="nofollow">单组织部署</a>的经验，然后再继续下面的文章。文中和<code>单组织部署</code>相同的部分，就不做详细解析了，直接用代码来展示。</p> 
  </blockquote> 
  <p>这个功能差不多是从<code>Composer v0.15</code>开始支持的， 官方的更新还是很给力的。它主要解决了多组织的</p> 
  <ul> 
   <li>如何连接到网络</li> 
   <li>如何部署chaincode</li> 
   <li>如何设置认证策略</li> 
  </ul> 
  <p><strong>我的环境</strong>：</p> 
  <pre class="prettyprint"><code class="language-java hljs ">Ubuntu <span class="hljs-number">16.04</span>   <span class="hljs-comment">//我的操作系统</span>
Hyperledger Composer <span class="hljs-number">0.16</span>      
Hyperledger Fabric <span class="hljs-number">1.0</span><span class="hljs-number">.4</span>    
</code></pre> 
  <h3 id="准备">准备</h3> 
  <p>停止以前的Fabric网络</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">cd ~/fabric-tools
./stopFabric<span class="hljs-preprocessor">.sh</span>
./teardownFabric<span class="hljs-preprocessor">.sh</span></code></pre> 
  <p>下载<code>fabric-samples</code> ，这个是<code>sstone1</code>维护的示例</p> 
  <pre class="prettyprint"><code class=" hljs php">cd ~
git <span class="hljs-keyword">clone</span> -b issue-<span class="hljs-number">6978</span> https:<span class="hljs-comment">//github.com/sstone1/fabric-samples.git</span></code></pre> 
  <h3 id="一-启动fabric网络">一 、启动Fabric网络</h3> 
  <p>定位到<code>first-network</code>目录，启动网络：</p> 
  <pre class="prettyprint"><code class="language-shell hljs bash"> <span class="hljs-comment"># 生成证书材料、channel材料</span>
./byfn.sh -m generate
<span class="hljs-comment">#启用couchdb作为world state 存储的媒介</span>
./byfn.sh -m up <span class="hljs-operator">-s</span> couchdb <span class="hljs-operator">-a</span></code></pre> 
  <p>运行成功后，<code>docker ps</code>：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">CONTAINER ID        IMAGE                                 COMMAND                  CREATED             STATUS              PORTS                                              NAMES
a618b05fe741        dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">28</span> minutes ago      Up <span class="hljs-number">28</span> minutes                                                          dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>
<span class="hljs-number">076e43320</span>a44        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">28</span> minutes ago      Up <span class="hljs-number">28</span> minutes                                                          dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>
d29a758de28d        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">29</span> minutes ago      Up <span class="hljs-number">29</span> minutes                                                          dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>
a38167d7a39b        hyperledger/fabric<span class="hljs-attribute">-tools</span>              <span class="hljs-string">"/bin/bash -c './s..."</span>   <span class="hljs-number">29</span> minutes ago      Up <span class="hljs-number">29</span> minutes                                                          cli
<span class="hljs-number">8682</span>cd2d0c1f        hyperledger/fabric<span class="hljs-attribute">-peer</span>               <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">29</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">10051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">10053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp   peer1<span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">1</span>cbe73e3cf71        hyperledger/fabric<span class="hljs-attribute">-peer</span>               <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">29</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">9051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">9053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp     peer0<span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
a946a790f0d5        hyperledger/fabric<span class="hljs-attribute">-peer</span>               <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">29</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp     peer0<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
c00f8a69b38b        hyperledger/fabric<span class="hljs-attribute">-peer</span>               <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp     peer1<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
c4d17a0b2305        hyperledger/fabric<span class="hljs-attribute">-ca</span>                 <span class="hljs-string">"sh -c 'fabric-ca-..."</span>   <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8054</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7054</span>/tcp                             ca_peerOrg2
<span class="hljs-number">2</span>dd80d092779        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>            <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb2
<span class="hljs-number">54</span>a410b83a23        hyperledger/fabric<span class="hljs-attribute">-orderer</span>            <span class="hljs-string">"orderer"</span>                <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7050</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7050</span>/tcp                             orderer<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">8e5</span>dbf668466        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>            <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">6984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb1
<span class="hljs-number">245</span>dc07d87c5        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>            <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">5984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb0
fbc846f192e5        hyperledger/fabric<span class="hljs-attribute">-ca</span>                 <span class="hljs-string">"sh -c 'fabric-ca-..."</span>   <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7054</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7054</span>/tcp                             ca_peerOrg1
d9bbd213a460        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>            <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">30</span> minutes ago      Up <span class="hljs-number">30</span> minutes       <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp  </code></pre> 
  <p>为了避免错误，清理缓存的card 身份：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">composer card delete <span class="hljs-attribute">-n</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span><span class="hljs-attribute">-only</span>
composer card delete <span class="hljs-attribute">-n</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span>
composer card delete <span class="hljs-attribute">-n</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org2</span><span class="hljs-attribute">-only</span>
composer card delete <span class="hljs-attribute">-n</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org2</span>
composer card delete <span class="hljs-attribute">-n</span> alice@tutorial<span class="hljs-attribute">-network</span>
composer card delete <span class="hljs-attribute">-n</span> bob@tutorial<span class="hljs-attribute">-network</span>
composer card delete <span class="hljs-attribute">-n</span> admin@tutorial<span class="hljs-attribute">-network</span>
composer card delete <span class="hljs-attribute">-n</span> PeerAdmin@fabric<span class="hljs-attribute">-network</span></code></pre> 
  <h3 id="二-创建连接配置文件">二 、创建连接配置文件</h3> 
  <p>和单组织的配置文件不同，这里的每个组织需要两个配置文件。一个是只包含自己节点的配置文件，一个是包含org1和org2所有节点的配置文件。 <br> 定位到<code>first-network</code>目录下，新建<code>connection</code>文件夹并根据组织分别来创建配置文件：</p> 
  <ul> 
   <li><p><strong>org1对应的配置文件</strong> </p> 
    <ul>
     <li><code>connection-org1-only.json</code></li>
    </ul> <pre class="prettyprint"><code class=" hljs json">{
    "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"byfn-network-org1-only"</span></span>,
    "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"hlfv1"</span></span>,
    "<span class="hljs-attribute">mspID</span>": <span class="hljs-value"><span class="hljs-string">"Org1MSP"</span></span>,
    "<span class="hljs-attribute">peers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer0.org1.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:8051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:8053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer1.org1.example.com"</span> </span>} ]</span>,
    "<span class="hljs-attribute">ca</span>": <span class="hljs-value">{ "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://localhost:7054"</span></span>, "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"ca-org1"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"ca.org1.example.com"</span> </span>}</span>,
    "<span class="hljs-attribute">orderers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">url</span>" : <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7050"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"orderer.example.com"</span> </span>} ]</span>,
    "<span class="hljs-attribute">channel</span>": <span class="hljs-value"><span class="hljs-string">"mychannel"</span></span>,
    "<span class="hljs-attribute">timeout</span>": <span class="hljs-value"><span class="hljs-number">300</span> </span>}</code></pre> 
    <ul>
     <li><code>connection-org1.json</code></li>
    </ul> <pre class="prettyprint"><code class=" hljs json">{
"<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"byfn-network-org1"</span></span>,
"<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"hlfv1"</span></span>,
"<span class="hljs-attribute">mspID</span>": <span class="hljs-value"><span class="hljs-string">"Org1MSP"</span></span>,
"<span class="hljs-attribute">peers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer0.org1.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:8051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:8053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer1.org1.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:9051"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer0.org2.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:10051"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer1.org2.example.com"</span> </span>} ]</span>,
"<span class="hljs-attribute">ca</span>": <span class="hljs-value">{ "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://localhost:7054"</span></span>, "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"ca-org1"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"ca.org1.example.com"</span> </span>}</span>,
"<span class="hljs-attribute">orderers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">url</span>" : <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7050"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"orderer.example.com"</span> </span>} ]</span>,
"<span class="hljs-attribute">channel</span>": <span class="hljs-value"><span class="hljs-string">"mychannel"</span></span>,
"<span class="hljs-attribute">timeout</span>": <span class="hljs-value"><span class="hljs-number">300</span> </span>}</code></pre></li> 
   <li><p>org2对应的配置文件</p> 
    <ul>
     <li><code>connection-org2-only.json</code></li>
    </ul> <pre class="prettyprint"><code class=" hljs json">{
"<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"byfn-network-org2-only"</span></span>,
"<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"hlfv1"</span></span>,
"<span class="hljs-attribute">mspID</span>": <span class="hljs-value"><span class="hljs-string">"Org2MSP"</span></span>,
"<span class="hljs-attribute">peers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:9051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:9053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer0.org2.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:10051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:10053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer1.org2.example.com"</span> </span>} ]</span>,
"<span class="hljs-attribute">ca</span>": <span class="hljs-value">{ "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://localhost:8054"</span></span>, "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"ca-org2"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"ca.org2.example.com"</span> </span>}</span>,
"<span class="hljs-attribute">orderers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">url</span>" : <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7050"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"orderer.example.com"</span> </span>} ]</span>,
"<span class="hljs-attribute">channel</span>": <span class="hljs-value"><span class="hljs-string">"mychannel"</span></span>,
"<span class="hljs-attribute">timeout</span>": <span class="hljs-value"><span class="hljs-number">300</span> </span>}</code></pre> 
    <ul>
     <li><code>connection-org2.json</code></li>
    </ul> <pre class="prettyprint"><code class=" hljs json">{
"<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"byfn-network-org2"</span></span>,
"<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"hlfv1"</span></span>,
"<span class="hljs-attribute">mspID</span>": <span class="hljs-value"><span class="hljs-string">"Org2MSP"</span></span>,
"<span class="hljs-attribute">peers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:9051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:9053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer0.org2.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:10051"</span></span>, "<span class="hljs-attribute">eventURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:10053"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer1.org2.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7051"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer0.org1.example.com"</span> </span>}, { "<span class="hljs-attribute">requestURL</span>": <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:8051"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"peer1.org1.example.com"</span> </span>} ]</span>,
"<span class="hljs-attribute">ca</span>": <span class="hljs-value">{ "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://localhost:8054"</span></span>, "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"ca-org2"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"ca.org2.example.com"</span> </span>}</span>,
"<span class="hljs-attribute">orderers</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">url</span>" : <span class="hljs-value"><span class="hljs-string">"grpcs://localhost:7050"</span></span>, "<span class="hljs-attribute">cert</span>": <span class="hljs-value"><span class="hljs-string">"../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt"</span></span>, "<span class="hljs-attribute">hostnameOverride</span>": <span class="hljs-value"><span class="hljs-string">"orderer.example.com"</span> </span>} ]</span>,
"<span class="hljs-attribute">channel</span>": <span class="hljs-value"><span class="hljs-string">"mychannel"</span></span>,
"<span class="hljs-attribute">timeout</span>": <span class="hljs-value"><span class="hljs-number">300</span> </span>}</code></pre></li> 
  </ul> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105171217891?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="三-认识下每个组织的管理员">三 、认识下每个组织的管理员</h3> 
  <p>记住下面的证书材料、私钥的位置，后续有用。</p> 
  <h4 id="1org1的管理员">1、org1的管理员</h4> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105164648850?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h4 id="2org2的管理员">2、org2的管理员</h4> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105164941250?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="三-为org1的hyperledger-fabric管理员创建business-network-card">三 、为Org1的Hyperledger Fabric管理员创建business network card</h3> 
  <h4 id="1-使用connection-org1-onlyjson配置文件">1、 使用connection-org1-only.json配置文件</h4> 
  <pre class="prettyprint"><code class=" hljs haml">composer card create  \
-<span class="ruby">p connection-org1-only.json \ </span>-<span class="ruby">u <span class="hljs-constant">PeerAdmin</span> \ </span>-<span class="ruby">c ../crypto-config/peerOrganizations/org1.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com/msp/signcerts/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com-cert.pem \ </span>-<span class="ruby">k ../crypto-config/peerOrganizations/org1.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \ </span>-<span class="ruby">r <span class="hljs-constant">PeerAdmin</span> -r <span class="hljs-constant">ChannelAdmin</span></span></code></pre> 
  <p>运行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105171927983?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h4 id="2-使用connection-org1json配置文件">2、 使用connection-org1.json配置文件</h4> 
  <pre class="prettyprint"><code class=" hljs haml">composer card create  \
-<span class="ruby">p connection-org1.json \ </span>-<span class="ruby">u <span class="hljs-constant">PeerAdmin</span> \ </span>-<span class="ruby">c ../crypto-config/peerOrganizations/org1.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com/msp/signcerts/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com-cert.pem \ </span>-<span class="ruby">k ../crypto-config/peerOrganizations/org1.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com/msp/keystore/c1b7ad741cdbd81225bada7fdad24617457864396d81cbbbeebe07530a3cae30_sk \ </span>-<span class="ruby">r <span class="hljs-constant">PeerAdmin</span> -r <span class="hljs-constant">ChannelAdmin</span></span></code></pre> 
  <p>运行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105172903171?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="四-为org2的hyperledger-fabric管理员创建business-network-card">四 、为Org2的Hyperledger Fabric管理员创建business network card</h3> 
  <h4 id="1-使用connection-org2-onlyjson配置文件">1、 使用connection-org2-only.json配置文件</h4> 
  <pre class="prettyprint"><code class=" hljs haml">composer card create  \
-<span class="ruby">p connection-org2-only.json \ </span>-<span class="ruby">u <span class="hljs-constant">PeerAdmin</span> \ </span>-<span class="ruby">c ../crypto-config/peerOrganizations/org2.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com/msp/signcerts/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com-cert.pem \ </span>-<span class="ruby">k ../crypto-config/peerOrganizations/org2.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com/msp/keystore/<span class="hljs-number">434</span>a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \ </span>-<span class="ruby">r <span class="hljs-constant">PeerAdmin</span> -r <span class="hljs-constant">ChannelAdmin</span></span></code></pre> 
  <h4 id="2-使用connection-org2json配置文件">2、 使用connection-org2.json配置文件</h4> 
  <pre class="prettyprint"><code class=" hljs haml">composer card create  \
-<span class="ruby">p connection-org2.json \ </span>-<span class="ruby">u <span class="hljs-constant">PeerAdmin</span> \ </span>-<span class="ruby">c ../crypto-config/peerOrganizations/org2.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com/msp/signcerts/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com-cert.pem \ </span>-<span class="ruby">k ../crypto-config/peerOrganizations/org2.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com/msp/keystore/<span class="hljs-number">434</span>a5f909a77859a6a9dba06648ad828e947571e2f144692e4679b8174d278e7_sk \ </span>-<span class="ruby">r <span class="hljs-constant">PeerAdmin</span> -r <span class="hljs-constant">ChannelAdmin</span></span></code></pre> 
  <p>运行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105173430658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>最终多出了下面几个文件：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105173706587?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="五-导入business-network-cards">五 、 导入business network cards</h3> 
  <p>上面生成的card并没有在composer维护的wallet中：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105174238386?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>通过下面命令,把card导入到wallet中：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">composer card <span class="hljs-keyword">import</span>  <span class="hljs-attribute">-f</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span><span class="hljs-attribute">-only</span><span class="hljs-built_in">.</span>card
composer card <span class="hljs-keyword">import</span>  <span class="hljs-attribute">-f</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span><span class="hljs-built_in">.</span>card
composer card <span class="hljs-keyword">import</span>  <span class="hljs-attribute">-f</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org2</span><span class="hljs-attribute">-only</span><span class="hljs-built_in">.</span>card
composer card <span class="hljs-keyword">import</span>  <span class="hljs-attribute">-f</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org2</span><span class="hljs-built_in">.</span>card</code></pre> 
  <p>执行成功后，查看card：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105174719219?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="六-每个组织分别安装hyperledger-composer-runtime">六、 每个组织分别安装Hyperledger Composer runtime</h3> 
  <p>每个组织使用自己的管理员身份，同时指定一个业务网络的名称：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">composer runtime install <span class="hljs-attribute">-c</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span><span class="hljs-attribute">-only</span> <span class="hljs-attribute">-n</span> tutorial<span class="hljs-attribute">-network</span>
composer runtime install <span class="hljs-attribute">-c</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org2</span><span class="hljs-attribute">-only</span> <span class="hljs-attribute">-n</span> tutorial<span class="hljs-attribute">-network</span>
</code></pre> 
  <p>运行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180105175412749?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="七-定义业务网络的认证策略">七、 定义业务网络的认证策略</h3> 
  <blockquote> 
   <p>请注意，用于业务网络的认可政策必须采用Hyperledger Fabric Node.js SDK使用的JSON格式。这与Hyperledger Fabric CLI使用的简单批注策略格式有所不同，您可以在<a href="https://hyperledger-fabric.readthedocs.io/en/release/endorsement-policies.html" rel="nofollow">Hyperledger Fabric文档中看到这种格式。</a></p> 
  </blockquote> 
  <p>在v0.15之前是没有这个功能的，新增的这个功能更加贴近现实场景，使得composer功能更加强大。</p> 
  <p>在<code>connection</code>目录下新建文件<code>endorsement-policy.json</code>，编辑内容如下：</p> 
  <pre class="prettyprint"><code class="language-json hljs ">{
    "<span class="hljs-attribute">identities</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">role</span>": <span class="hljs-value">{ "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"member"</span></span>, "<span class="hljs-attribute">mspId</span>": <span class="hljs-value"><span class="hljs-string">"Org1MSP"</span> </span>} </span>}, { "<span class="hljs-attribute">role</span>": <span class="hljs-value">{ "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"member"</span></span>, "<span class="hljs-attribute">mspId</span>": <span class="hljs-value"><span class="hljs-string">"Org2MSP"</span> </span>} </span>} ]</span>,
    "<span class="hljs-attribute">policy</span>": <span class="hljs-value">{ "<span class="hljs-attribute">2-of</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">signed-by</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>}, { "<span class="hljs-attribute">signed-by</span>": <span class="hljs-value"><span class="hljs-number">1</span> </span>} ] </span>} </span>}</code></pre> 
  <p>这个认证策略是所有的交易必须经过org1和org2成员的背书，然后才能被提交到区块链上。</p> 
  <h3 id="八-生成各组织的业务网络管理员证书材料">八、 生成各组织的业务网络管理员证书材料</h3> 
  <p>业务网络启动时，业务网络必须配置一组初始参与者。这些参与者将负责引导业务网络，并将其他参与者引入业务网络。在Hyperledger Composer中，我们将这些初始参与者称为业务网络管理员。</p> 
  <p>我们要设定 Org1的业务网络管理员将是Alice，而Org2的业务网络管理员将是Bob。 </p> 
  <p>当业务网络启动时，所有业务网络管理员的证书（身份的公共部分）必须传递给执行命令的组织以启动业务网络。业务网络启动后，所有业务网络管理员都可以使用自己的身份与业务网络进行交互。</p> 
  <p>执行命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">composer  identity  request <span class="hljs-attribute">-c</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span><span class="hljs-attribute">-only</span> <span class="hljs-attribute">-u</span> admin <span class="hljs-attribute">-s</span> adminpw  <span class="hljs-attribute">-d</span> alice
composer  identity  request <span class="hljs-attribute">-c</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org2</span><span class="hljs-attribute">-only</span> <span class="hljs-attribute">-u</span> admin <span class="hljs-attribute">-s</span> adminpw  <span class="hljs-attribute">-d</span> bob</code></pre> 
  <p>运行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108141238953?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="九-启动业务网络business-network">九、 启动业务网络（business network）</h3> 
  <h4 id="1-准备bna文件这里使用先前的文件">1、 <a href="http://blog.csdn.net/qq_27818541/article/details/78727076#1%E5%87%86%E5%A4%87bna%E6%96%87%E4%BB%B6%E4%B8%9A%E5%8A%A1%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6" rel="nofollow">准备BNA文件，这里使用先前的文件</a></h4> 
  <h4 id="2执行命令">2、执行命令</h4> 
  <p>只让<code>org1</code>来启动业务网络即可：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">
composer  network  start <span class="hljs-subst">\</span>
<span class="hljs-attribute">-c</span> PeerAdmin@byfn<span class="hljs-attribute">-network</span><span class="hljs-attribute">-org1</span> <span class="hljs-subst">\</span>
<span class="hljs-attribute">-a</span> tutorial<span class="hljs-attribute">-network</span><span class="hljs-built_in">.</span>bna <span class="hljs-subst">\</span>
<span class="hljs-attribute">-o</span>  endorsementPolicyFile<span class="hljs-subst">=</span>endorsement<span class="hljs-attribute">-policy</span><span class="hljs-built_in">.</span>json  <span class="hljs-subst">\</span>
<span class="hljs-attribute">-A</span>  alice   <span class="hljs-attribute">-C</span>  alice/admin<span class="hljs-attribute">-pub</span><span class="hljs-built_in">.</span>pem <span class="hljs-subst">\</span>
<span class="hljs-attribute">-A</span>  bob  <span class="hljs-attribute">-C</span> bob/admin<span class="hljs-attribute">-pub</span><span class="hljs-built_in">.</span>pem</code></pre> 
  <p>执行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108170659292?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <blockquote> 
   <p><code>docker ps</code> 查看，多出了四个镜像。 这四个是composer部署的智能合约（业务网络），分别对应每个peer。</p> 
  </blockquote> 
  <pre class="prettyprint"><code class=" hljs lasso">CONTAINER ID        IMAGE                                                COMMAND                  CREATED             STATUS              PORTS                                              NAMES
<span class="hljs-number">667218</span>cb17b6        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">14</span> minutes ago      Up <span class="hljs-number">14</span> minutes                                                          dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>
<span class="hljs-number">561</span>aa195fbca        dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">14</span> minutes ago      Up <span class="hljs-number">14</span> minutes                                                          dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>
f58e51bcb8fd        dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">14</span> minutes ago      Up <span class="hljs-number">14</span> minutes                                                          dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>
<span class="hljs-number">9</span>d84d7f04295        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>   <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">14</span> minutes ago      Up <span class="hljs-number">14</span> minutes                                                          dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-tutorial</span><span class="hljs-attribute">-network</span><span class="hljs-subst">-</span><span class="hljs-number">0.16</span><span class="hljs-number">.2</span>
<span class="hljs-number">3</span>c914b2745b0        dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>                  <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours                                                             dev<span class="hljs-attribute">-peer1</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>
<span class="hljs-number">6</span>b8c7ad3de63        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>                  <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours                                                             dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>
eecfcd21c857        dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>                  <span class="hljs-string">"chaincode -peer.a..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours                                                             dev<span class="hljs-attribute">-peer0</span><span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com<span class="hljs-attribute">-mycc</span><span class="hljs-subst">-</span><span class="hljs-number">1.0</span>
ec4e856f351a        hyperledger/fabric<span class="hljs-attribute">-tools</span>                             <span class="hljs-string">"/bin/bash -c './s..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours                                                             cli
<span class="hljs-number">6</span>c390e2db6f2        hyperledger/fabric<span class="hljs-attribute">-peer</span>                              <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">9051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">9053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp     peer0<span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">65</span>ad7c67e695        hyperledger/fabric<span class="hljs-attribute">-peer</span>                              <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">10051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">10053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp   peer1<span class="hljs-built_in">.</span>org2<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">3</span>edfd4635d79        hyperledger/fabric<span class="hljs-attribute">-peer</span>                              <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp     peer0<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
d7e3bd8f3e02        hyperledger/fabric<span class="hljs-attribute">-peer</span>                              <span class="hljs-string">"peer node start"</span>        <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8051</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7051</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8053</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7053</span>/tcp     peer1<span class="hljs-built_in">.</span>org1<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">426</span>be6f24ce8        hyperledger/fabric<span class="hljs-attribute">-orderer</span>                           <span class="hljs-string">"orderer"</span>                <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7050</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7050</span>/tcp                             orderer<span class="hljs-built_in">.</span>example<span class="hljs-built_in">.</span>com
<span class="hljs-number">1</span>fb18693331d        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>                           <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb2
b7d5da5434b7        hyperledger/fabric<span class="hljs-attribute">-ca</span>                                <span class="hljs-string">"sh -c 'fabric-ca-..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8054</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7054</span>/tcp                             ca_peerOrg2
<span class="hljs-number">46</span>eb39200ee3        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>                           <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb3
<span class="hljs-number">993</span>a8a9ab5f7        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>                           <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">5984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb0
<span class="hljs-number">7</span>d15e8dfd210        hyperledger/fabric<span class="hljs-attribute">-ca</span>                                <span class="hljs-string">"sh -c 'fabric-ca-..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">7054</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">7054</span>/tcp                             ca_peerOrg1
bfc01df48996        hyperledger/fabric<span class="hljs-attribute">-couchdb</span>                           <span class="hljs-string">"tini -- /docker-e..."</span>   <span class="hljs-number">3</span> hours ago         Up <span class="hljs-number">3</span> hours          <span class="hljs-number">4369</span>/tcp, <span class="hljs-number">9100</span>/tcp, <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">6984</span><span class="hljs-subst">-&gt;</span><span class="hljs-number">5984</span>/tcp         couchdb1</code></pre> 
  <h3 id="十-为各个组织生成访问业务网络的business-network-card">十、 为各个组织生成访问业务网络的Business Network Card</h3> 
  <p>业务网络启动后，Alice和Bob都能够访问业务网络，可以从其各自的组织中接受其他参与者。但是，Alice和Bob都必须创建新的业务网卡（需要第八步骤生成的证书），以便他们可以访问业务网络。</p> 
  <blockquote> 
   <p>接下来的流程：生成Card–&gt;导入Card–&gt;测试是否通畅</p> 
  </blockquote> 
  <h4 id="1org1">1、org1</h4> 
  <p>执行命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso"> composer card create <span class="hljs-attribute">-p</span> connection<span class="hljs-attribute">-org1</span><span class="hljs-built_in">.</span>json <span class="hljs-attribute">-u</span> alice <span class="hljs-attribute">-n</span> tutorial<span class="hljs-attribute">-network</span> <span class="hljs-attribute">-c</span> alice/admin<span class="hljs-attribute">-pub</span><span class="hljs-built_in">.</span>pem <span class="hljs-attribute">-k</span> alice/admin<span class="hljs-attribute">-priv</span><span class="hljs-built_in">.</span>pem
 composer card <span class="hljs-keyword">import</span> <span class="hljs-attribute">-f</span> alice@tutorial<span class="hljs-attribute">-network</span><span class="hljs-built_in">.</span>card
 composer network ping <span class="hljs-attribute">-c</span> alice@tutorial<span class="hljs-attribute">-network</span></code></pre> 
  <p>执行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108180511465?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h4 id="2org2">2、org2</h4> 
  <p>执行命令：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">composer card create <span class="hljs-attribute">-p</span> connection<span class="hljs-attribute">-org2</span><span class="hljs-built_in">.</span>json <span class="hljs-attribute">-u</span> bob <span class="hljs-attribute">-n</span> tutorial<span class="hljs-attribute">-network</span> <span class="hljs-attribute">-c</span> bob/admin<span class="hljs-attribute">-pub</span><span class="hljs-built_in">.</span>pem <span class="hljs-attribute">-k</span> bob/admin<span class="hljs-attribute">-priv</span><span class="hljs-built_in">.</span>pem
composer card <span class="hljs-keyword">import</span> <span class="hljs-attribute">-f</span> bob@tutorial<span class="hljs-attribute">-network</span><span class="hljs-built_in">.</span>card
composer network ping <span class="hljs-attribute">-c</span> bob@tutorial<span class="hljs-attribute">-network</span>
</code></pre> 
  <p>执行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108180745885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h4 id="3查看此时的card列表">3、查看此时的card列表</h4> 
  <blockquote> 
   <p>图中那两个card是专门访问业务网络</p> 
  </blockquote> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108181604304?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h3 id="十一生成rest-api">十一、生成REST API</h3> 
  <p>使用官方命令 ：</p> 
  <blockquote> 
   <p>composer-rest-server</p> 
  </blockquote> 
  <p>执行结果：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108183453050?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>rest api ：</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108184132378?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180108184153535?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjc4MTg1NDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_27818541/article/details/78727086,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_27818541/article/details/78727086,&quot;}">阅读更多</a> 
 <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_27818541/article/details/78727086,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq_27818541/article/details/78727086,&quot;}">登录后自动展开</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

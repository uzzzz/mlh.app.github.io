<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>如何搭建基于以太坊的私有链 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="如何搭建基于以太坊的私有链" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="搭建基于以太坊的私有链环境 &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; 通过本文所述方法和项目中的脚本，我们可以快速的搭建好自己的私有链进行区块链开发测试，本文基于以太坊技术进行搭建，分两个部分，一个是Ubuntu下搭建方法，另一个是Windwos下搭建方法，&nbsp; 一、&nbsp;&nbsp;&nbsp;Ubuntu下安装Geth客户端 &nbsp; &nbsp; 之所以采用Ubuntu，是因为以太坊的官方对Ubuntu支持的很好，是在各个linux系统中安装最简单。 &nbsp; &nbsp; Geth官方安装指南： &nbsp; &nbsp; https://github.com/ethereum/go-ethereum/wiki/Building-Ethereum &nbsp; &nbsp; 进入ubuntu命令行，执行如下命令&nbsp; sudo apt-get update sudo apt-get installsoftware-properties-common sudo add-apt-repository -yppa:ethereum/ethereum sudo add-apt-repository -yppa:ethereum/ethereum-dev sudo apt-get update sudo apt-get install ethereum &nbsp;&nbsp; &nbsp;系统联网执行后，即完成了安装以太坊客户端，其中包括geth,bootnode, evm, disasm, rlpdump,ethtest &nbsp; &nbsp; 此时如果输入Geth命令，会出现启动以太坊启动的画面 &nbsp;二、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;安装Windows下Geth客户端 &nbsp; &nbsp; Windows必须64位系统，从官方网站下载编译好的win64客户端，解压缩即可运行，下载地址如下： &nbsp; &nbsp;&nbsp;https://github.com/ethereum/go-ethereum/releases/ &nbsp; &nbsp; 下载后，只有一个Geth.exe的文件。 &nbsp; &nbsp; 安装图像化客户端Mist，依然是从官方地址下载编译好的客户端即可，下载地址： &nbsp; &nbsp;&nbsp;https://github.com/ethereum/mist/releases/ &nbsp; &nbsp; 下载解压缩后，Ethereum-Wallet即为以太坊图形化界面。 &nbsp; 三、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;准备创世块文件 &nbsp; &nbsp; 配置自己的创世块是为了区分公有链，同一个网络中，创世块必须是一样的，否则无法联通，此方法在windows和Ubuntu下通用。 &nbsp; &nbsp; 新建文件piccgenesis.json,输入如下内容并保存 { &nbsp;&nbsp;&nbsp; &quot;nonce&quot;:&quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp; &quot;mixhash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;difficulty&quot;: &quot;0x4000&quot;, &nbsp;&nbsp;&nbsp; &quot;alloc&quot;: {}, &nbsp;&nbsp;&nbsp; &quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;timestamp&quot;: &quot;0x00&quot;, &nbsp;&nbsp;&nbsp; &quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;extraData&quot;: &quot;0x888&quot;, &nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;:&quot;0xffffffff&quot; } &nbsp;&nbsp; &nbsp; 解释一下各个参数的作用：&nbsp; mixhash 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。. nonce nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase 矿工的账号，随便填 timestamp 设置创世块的时间戳 parentHash 上一个区块的hash值，因为是创世块，所以这个值是0 extraData 附加信息，随便填，可以填你的个性信息 ，如果最新的geth初始化可能会提示要求以0x开头，可以填入&quot;0x00&quot; 或 “0x123888&quot;等。 gasLimit 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 &nbsp;四、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动私有链节点 &nbsp; &nbsp; 启动Geth即可以启动以太坊的区块链，为了构建私有链 ，需要在Geth启动时加入一些参数，Geth参数含义如下：&nbsp; identity 区块链的标示，随便填写，用于标示目前网络的名字 init 指定创世块文件的位置，并创建初始块 datadir 设置当前区块链网络数据存放的位置 port 网络监听端口 rpc 启动rpc通信，可以进行智能合约的部署和调试 rpcapi 设置允许连接的rpc的客户端，一般为db,eth,net,web3 networkid 设置当前区块链的网络ID，用于区分不同的网络，是一个数字 console 启动命令行模式，可以在Geth中执行命令 &nbsp; 1、&nbsp; 在Ubuntu启动区块链节点 &nbsp; &nbsp; 在Ubuntu下，首先切换到打算运行的目录，目录下应该有配置好的piccgenesis.json文件，执行如下命令 basepath=$(cd `dirname $0`; pwd) 获取当前的目录 geth&nbsp;&nbsp;--datadir &quot;$basepath/chain&quot; init piccgenesis.json&nbsp; 创建数据存放地址并初始化创世块 geth --identity &quot;0x888&quot; &nbsp;--rpc&nbsp; --rpccorsdomain &quot;*&quot; --datadir &quot;$basepath/chain&quot; --port &quot;30303&quot;&nbsp; --rpcapi &quot;db,eth,net,web3&quot;--networkid 95518 console &nbsp; &nbsp; 启动后界面如下，光标停留在最后的命令行上，可以执行以太坊命令。 I0707 00:45:43.680087 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata I0707 00:45:43.726008ethdb/database.go:169] closed db:/home/lihe/桌面/chain/chaindata I0707 00:45:43.728913 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata I0707 00:45:43.908795 ethdb/database.go:82]Alloted 16MB cache and 16 file handles to /home/lihe/桌面/chain/dapp I0707 00:45:43.969506 core/genesis.go:92]Genesis block already in chain. Writing canonical number I0707 00:45:43.980337 eth/backend.go:274]Successfully wrote custom genesis block:6e92f8b23bcdfdf34dc813cfaf1d84b71beac80530506b5d63a2df10fe23a660 I0707 00:45:43.980618 eth/backend.go:184]Protocol Versions: [63 62], Network Id: 95518 I0707 00:45:43.981567core/blockchain.go:204] Last header: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.981645core/blockchain.go:205] Last block: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.981677core/blockchain.go:206] Fast block: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.985253 p2p/server.go:313]Starting Server I0707 00:45:45.834488p2p/discover/udp.go:217] Listening,enode://134881790e54c803955715e3661c27f91caaf499be813e29c9f986e2eac62d47e02b13a8e51776c1caea554655614ed26ce0185d84e626da7ac48a83a60113ff@[::]:30303 I0707 00:45:45.835853 node/node.go:366]HTTP endpoint opened: http://localhost:8545 I0707 00:45:45.848008 p2p/server.go:556]Listening on [::]:30303 I0707 00:45:45.849731 node/node.go:296] IPCendpoint opened: /home/lihe/桌面/chain/geth.ipc Welcome to the Geth JavaScript console! &nbsp; instance:Geth/v1.5.0-unstable/linux/go1.5.1/PICCetherum coinbase:0x93509a2f4b2b974b07ef0b52e07c3992601f5de1 at block: 81 (Tue, 05 Jul 2016 21:02:25CST) &nbsp;datadir: /home/lihe/桌面/chain &nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt;&nbsp; &nbsp; &nbsp; 可以看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功 &nbsp;&nbsp;&nbsp;&nbsp;注意：如果想将Ubuntu作为永久区块链节点使用，当使用nohup命令时，Geth启动参数console必须去掉，否则Geth会自动停止。 &nbsp; 2、&nbsp; 在windows启动区块链节点 &nbsp; &nbsp; 进入Windows下Geth的目录 ，放置配置好的piccgenesis.json文件，执行如下命令： geth&nbsp;&nbsp;--datadir &quot;%cd%\chain&quot; init piccgenesis.json&nbsp; 创建数据存放地址并初始化创世块 geth--identity &quot;0x888&quot; --rpc--rpccorsdomain &quot;*&quot; --datadir &quot;%cd%\chain&quot; --port&quot;30303&quot;&nbsp; --rpcapi&quot;db,eth,net,web3&quot; --networkid 95518 console &nbsp; &nbsp; 当看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功 &nbsp; 五、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点创建账号 &nbsp; &nbsp; 启动节点成功后，会进入Geth的命令行模式，输入如下命令 personal.newAccount() &nbsp; &nbsp; 系统会提示你输入账号密码，并确认，最后会显示一个新生成的账号。 &nbsp;六、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接其他节点 &nbsp; &nbsp; 首先要知道自己的节点信息，在Geth命令行界面下输入命令,注意大小写 admin.nodeInfo &nbsp; &nbsp; 系统会显示 &nbsp;enode:&quot;enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303“ &nbsp; &nbsp; 其中 enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303 &nbsp; &nbsp; 就是自己节点的信息，注意要把“0.0.0.0“换成你自己的IP。将这个信息发送给其他节点，在其他节点的命令行中输入： admin.addPeer(‘enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@192.168.1.101:30303’) &nbsp; &nbsp; 如果添加成功，输入admin.peers会显示出新添加的节点。 &nbsp; 七、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点进行挖矿 账号创建后，还没有以太币，需要在私有链上挖矿，切换到Geth界面，输入 miner.start(1) &nbsp; &nbsp; &nbsp; &nbsp; miner命令括号中的1表示用一个线程进行挖矿，如果不配置，就会让CPU全速运行，影响计算机的使用。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行一会后，主账号就会获取很多以太币，这个时候屏幕会快速刷屏，不用管，输入命令miner.stop()停止挖矿。 &nbsp; &nbsp; &nbsp;到这一步，已经组建一个私有链的网络，可以像其他区块链一样不停的扩充这个网络，接下来，我会介绍如何在私有链上编写、调试和部署智能合约。 八、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在以太坊私有链上部署第一个智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 本文的智能合约采用以太坊官方的示例合约，功能就是在区块链上存储一个数字，并能够读取出来。代码如下： contract SimpleStorage { &nbsp;&nbsp;&nbsp; uint storedData; &nbsp;&nbsp;&nbsp; function set(uint x) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; storedData = x; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function get() constant returns (uintretVal) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return storedData; &nbsp;&nbsp;&nbsp; } } &nbsp; &nbsp; &nbsp; &nbsp; 即使没有学过Solidity语言也可以大致看出，该合约set函数存储一个数字在X变量中，get函数从X变量中读取这个数字出来，下面对这个合约进行部署： 1、&nbsp; 启动私有链 &nbsp; &nbsp;启动后界面如下, Ethereum-Wallet会显示红色的PRIVTE-NET标记。 2、创建两个钱包 &nbsp; &nbsp; &nbsp; &nbsp; 点击”ADD ACCOUNT” 按钮，添加一个钱包，程序会弹出一个对话框，提示输入两遍密码，输入完密码后，账号即创建成功。创建其他的账号，一样的操作，从上面的截图可以看到，有三个账号，一个是MAIN ACCOUNT，一个是ACCOUNT2，一个是ACCOUNT3 3、&nbsp; 将一个钱包的以太币转到另一个钱包中 &nbsp; &nbsp; &nbsp; &nbsp; 先点击ACCOUNT2账号，进入账号详情的界面，点击右侧的“COPY address”，把ACCOUNT2的地址拷贝下来，系统会提示你现在你处在一个测试网络，不要转入真正的以太币到这个账号。 &nbsp; &nbsp; &nbsp; &nbsp; 点击钱包中“SEND”按钮，从MAINACCOUNT给ACCOUNT2转入一定以太币，同时可以看到执行这笔交易的费用是0.00042个以太币。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 点击发送后会提示如输入密码，但这时还没有发送成功，根据区块链的交易规则，需要矿工的确认，并且每笔交易需要确认12个块，一个块是16秒的生成时间。切换到Geth程序，输入挖矿命令，直到ACCOUNT2上显示100个以太币，然后停止挖矿。 4、&nbsp; 部署智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 点“CONTRACTS”，进入智能合约管理界面，点击“DEPOLY NEW CONTRACT”,开始部署智能合约，选择部署智能合约的账号，并输入智能合约的代码后，如下图 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;输入完毕后点击“DEPLOY”，系统会提示输入账号密码，因为部署智能合约是需要费用的。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 这个时候是看不到部署的智能合约的，切换到Geth界面，进行挖矿，在12个块后，智能合约就能确认并显示出来。 九、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;运行智能合约 1、 在本节点上运行智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 点击“CONTRACTS”进入智能合约界面，可以看到刚才部署的智能合约“SimpleStorage”，点击进入该智能合约，进入详情界面，其中有智能合约写入区域和读取区域，首先启动Geth的挖矿，然后在写入区域选择相应的智能合约函数SET，在下面的数值输入框输入想设置的数值，运行一会后就可以在读取区域看到智能合约函数GET中Retval的返回值有变化。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;其他智能合约的运行也是一样，无非就是函数多点，输入多点。 &nbsp; 2、 在其他节点上运行智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 此时的智能合约只能自己能看到，别人是无法看到和运行的，如果其他人要运行你部署好的智能合约需要提供一些信息，就是其他教程中所说的智能合约的ABI和地址。 进入刚部署的“SimpleStorage”智能合约界面，右侧有四个按钮 A．“Deposit Eher”：向该智能合约发送以太币 B.“Copy address”：拷贝该智能合约的地址 C．“Show QR Code”：显示一个二维码，如果用手机扫描的话，显示该智能合约的地址 D．“Show Interface”：显示该智能合约的JSON接口，也就是ABI &nbsp; &nbsp; &nbsp; &nbsp; 首先我们点“Copy address”，拷贝该智能合约的地址，然后点“Show Interface”将智能合约的JSON接口全部拷贝出来，在另一个需要运行智能合约的节点打开Ethereum-Wallet，打开“CONTRACTS”界面点击“WATCH CONTRACTS”添加一个智能合约。 &nbsp; &nbsp; &nbsp; &nbsp; 如上图所示，CONTRACT NAME随便填，CONTRACT ADDRESS填写智能合约地址，JSON INTERFACE填写刚才在”Show Interface “中拷贝的内容。点OK后，就可以看到这个智能合约并运行了。 十、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的部署原理 1、智能合约的部署架构 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;本文介绍的智能合约的部署虽然是在图形化界面编译和执行，但其实最主要的是依赖于后台运行Geth的节点，此时Geth提供了一个RPC的接口向图形化界面的钱包提供区块链的信息。 RPC接口 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Geth在8545端口提供了JSON RPC API ，数据传输采用JSON格式，可以执行Web3库的各种命令，比如向前端，比如mist等图形化客户端提供区块链的信息，默认访问地址为http://localhost:8545。 &nbsp; &nbsp; &nbsp; &nbsp; 我们部署一个智能合约时，首先Ethereum-Wallet调用SOLC智能合约编译器将代码编译成成EVM字节码，然后将EVM字节码通过Geth的RPC接口发送到以太坊网络，经过全网验证后，同时写入到每个Geth管理的区块链中，架构如下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2、 部署的数据流 &nbsp; &nbsp; &nbsp; &nbsp;首先代码先经过SOLC编译变为了二进制码，然后通过一笔交易来创建智能合约，该笔交易包含了创建者账号、智能合约内容、智能合约的地址这几个关键信息，其中智能合约地址的生成是由创建者的账号和发送的交易数作为随机数输入，通过Kecca-256加密算法重新创建一个地址作为账号。 &nbsp; &nbsp; &nbsp; &nbsp;部署过程中，需要通过交易来部署，同时数据要存储到区块链上，这些需要使用到GAS。 交易（Transactions） &nbsp; &nbsp; &nbsp; &nbsp; 一笔交易是一条消息，从一个账户发送到另一个账户。交易可以包含二进制数据（payload）和以太币。 &nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户包含代码，该代码和输入数据会被执行。 &nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户是零账户（账户地址是0），交易将创建一个新合约。正如上文所讲，这个智能合约地址不是零地址，而是由合约创建者的地址和该地址发出过的交易数量计算得到。创建合约交易的payload被当作EVM字节码执行。执行的输出做为合约代码被永久存储。这意味着，为了创建一个合约，你不需要向合约发送真正的合约代码，而是发送能够返回可执行代码的代码。 Gas &nbsp; &nbsp; &nbsp; &nbsp; 以太坊上的每笔交易都会被收取一定数量的gas，gas的目的是限制执行交易所需的工作量，同时为执行支付费用。当EVM执行智能合约时，gas将按照特定规则被逐渐消耗，其实GAS就是以太币的比较小的单位，如果以太币比作100元，那么GAS可以看作是1分钱。如果只有以太币，会有问题，以太币是需要大家买卖的，市场会有价格波动。可能会出现比特币这样的状况，一天跌50%涨50%。这个对计算的成本是不能接受的，例如今天做一个加法需要十块钱，明天做一个加法需要一百块钱。所以这里引入gas来解耦。把市场的波动和计算的开销来解耦，也就是说以太币和gas之间是有汇率的，以太币涨没关系，gas价格下降就可以了。它要保证我做同样的计算，消耗的法币是一致的。 &nbsp; &nbsp; &nbsp; &nbsp; gas price（gas价格，以太币计）是由交易创建者设置的，发送账户需要预付的交易费用 = gas price * gas amount。 如果执行结束还有gas剩余，这些gas将被返还给发送账户。 &nbsp; &nbsp; &nbsp; &nbsp; 前文中曾经提到部署智能合约使用了0.00042个以太币，换算成gas就是21000个gas。 &nbsp; &nbsp; &nbsp; &nbsp; 无论执行到什么位置，一旦gas被耗尽（比如降为负值），将会触发一个out-of-gas异常。当前调用帧所做的所有状态修改都将被回滚。 十一、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的运行原理 &nbsp; &nbsp; &nbsp; &nbsp; 智能合约是部署在区块链的代码，区块链本身不能执行代码，代码的执行是在本地的EVM中，实际上，部署在区块链上代码是能够在本地产生原智能合约代码的代码，可以理解区块链为一个数据库，而客户端从数据库中读取了存储的运行代码，并在本地运行后，将结果写入到了区块链这个数据库中。 &nbsp; &nbsp; &nbsp; &nbsp;本质上，以太坊的钱包也是智能合约的一个应用，以太坊搭建的是一个可供编写各种应用的平台。下一篇，将详细讲述智能合约的开发编写和调试方法 阅读更多" />
<meta property="og:description" content="搭建基于以太坊的私有链环境 &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; 通过本文所述方法和项目中的脚本，我们可以快速的搭建好自己的私有链进行区块链开发测试，本文基于以太坊技术进行搭建，分两个部分，一个是Ubuntu下搭建方法，另一个是Windwos下搭建方法，&nbsp; 一、&nbsp;&nbsp;&nbsp;Ubuntu下安装Geth客户端 &nbsp; &nbsp; 之所以采用Ubuntu，是因为以太坊的官方对Ubuntu支持的很好，是在各个linux系统中安装最简单。 &nbsp; &nbsp; Geth官方安装指南： &nbsp; &nbsp; https://github.com/ethereum/go-ethereum/wiki/Building-Ethereum &nbsp; &nbsp; 进入ubuntu命令行，执行如下命令&nbsp; sudo apt-get update sudo apt-get installsoftware-properties-common sudo add-apt-repository -yppa:ethereum/ethereum sudo add-apt-repository -yppa:ethereum/ethereum-dev sudo apt-get update sudo apt-get install ethereum &nbsp;&nbsp; &nbsp;系统联网执行后，即完成了安装以太坊客户端，其中包括geth,bootnode, evm, disasm, rlpdump,ethtest &nbsp; &nbsp; 此时如果输入Geth命令，会出现启动以太坊启动的画面 &nbsp;二、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;安装Windows下Geth客户端 &nbsp; &nbsp; Windows必须64位系统，从官方网站下载编译好的win64客户端，解压缩即可运行，下载地址如下： &nbsp; &nbsp;&nbsp;https://github.com/ethereum/go-ethereum/releases/ &nbsp; &nbsp; 下载后，只有一个Geth.exe的文件。 &nbsp; &nbsp; 安装图像化客户端Mist，依然是从官方地址下载编译好的客户端即可，下载地址： &nbsp; &nbsp;&nbsp;https://github.com/ethereum/mist/releases/ &nbsp; &nbsp; 下载解压缩后，Ethereum-Wallet即为以太坊图形化界面。 &nbsp; 三、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;准备创世块文件 &nbsp; &nbsp; 配置自己的创世块是为了区分公有链，同一个网络中，创世块必须是一样的，否则无法联通，此方法在windows和Ubuntu下通用。 &nbsp; &nbsp; 新建文件piccgenesis.json,输入如下内容并保存 { &nbsp;&nbsp;&nbsp; &quot;nonce&quot;:&quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp; &quot;mixhash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;difficulty&quot;: &quot;0x4000&quot;, &nbsp;&nbsp;&nbsp; &quot;alloc&quot;: {}, &nbsp;&nbsp;&nbsp; &quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;timestamp&quot;: &quot;0x00&quot;, &nbsp;&nbsp;&nbsp; &quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;extraData&quot;: &quot;0x888&quot;, &nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;:&quot;0xffffffff&quot; } &nbsp;&nbsp; &nbsp; 解释一下各个参数的作用：&nbsp; mixhash 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。. nonce nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase 矿工的账号，随便填 timestamp 设置创世块的时间戳 parentHash 上一个区块的hash值，因为是创世块，所以这个值是0 extraData 附加信息，随便填，可以填你的个性信息 ，如果最新的geth初始化可能会提示要求以0x开头，可以填入&quot;0x00&quot; 或 “0x123888&quot;等。 gasLimit 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 &nbsp;四、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动私有链节点 &nbsp; &nbsp; 启动Geth即可以启动以太坊的区块链，为了构建私有链 ，需要在Geth启动时加入一些参数，Geth参数含义如下：&nbsp; identity 区块链的标示，随便填写，用于标示目前网络的名字 init 指定创世块文件的位置，并创建初始块 datadir 设置当前区块链网络数据存放的位置 port 网络监听端口 rpc 启动rpc通信，可以进行智能合约的部署和调试 rpcapi 设置允许连接的rpc的客户端，一般为db,eth,net,web3 networkid 设置当前区块链的网络ID，用于区分不同的网络，是一个数字 console 启动命令行模式，可以在Geth中执行命令 &nbsp; 1、&nbsp; 在Ubuntu启动区块链节点 &nbsp; &nbsp; 在Ubuntu下，首先切换到打算运行的目录，目录下应该有配置好的piccgenesis.json文件，执行如下命令 basepath=$(cd `dirname $0`; pwd) 获取当前的目录 geth&nbsp;&nbsp;--datadir &quot;$basepath/chain&quot; init piccgenesis.json&nbsp; 创建数据存放地址并初始化创世块 geth --identity &quot;0x888&quot; &nbsp;--rpc&nbsp; --rpccorsdomain &quot;*&quot; --datadir &quot;$basepath/chain&quot; --port &quot;30303&quot;&nbsp; --rpcapi &quot;db,eth,net,web3&quot;--networkid 95518 console &nbsp; &nbsp; 启动后界面如下，光标停留在最后的命令行上，可以执行以太坊命令。 I0707 00:45:43.680087 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata I0707 00:45:43.726008ethdb/database.go:169] closed db:/home/lihe/桌面/chain/chaindata I0707 00:45:43.728913 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata I0707 00:45:43.908795 ethdb/database.go:82]Alloted 16MB cache and 16 file handles to /home/lihe/桌面/chain/dapp I0707 00:45:43.969506 core/genesis.go:92]Genesis block already in chain. Writing canonical number I0707 00:45:43.980337 eth/backend.go:274]Successfully wrote custom genesis block:6e92f8b23bcdfdf34dc813cfaf1d84b71beac80530506b5d63a2df10fe23a660 I0707 00:45:43.980618 eth/backend.go:184]Protocol Versions: [63 62], Network Id: 95518 I0707 00:45:43.981567core/blockchain.go:204] Last header: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.981645core/blockchain.go:205] Last block: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.981677core/blockchain.go:206] Fast block: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.985253 p2p/server.go:313]Starting Server I0707 00:45:45.834488p2p/discover/udp.go:217] Listening,enode://134881790e54c803955715e3661c27f91caaf499be813e29c9f986e2eac62d47e02b13a8e51776c1caea554655614ed26ce0185d84e626da7ac48a83a60113ff@[::]:30303 I0707 00:45:45.835853 node/node.go:366]HTTP endpoint opened: http://localhost:8545 I0707 00:45:45.848008 p2p/server.go:556]Listening on [::]:30303 I0707 00:45:45.849731 node/node.go:296] IPCendpoint opened: /home/lihe/桌面/chain/geth.ipc Welcome to the Geth JavaScript console! &nbsp; instance:Geth/v1.5.0-unstable/linux/go1.5.1/PICCetherum coinbase:0x93509a2f4b2b974b07ef0b52e07c3992601f5de1 at block: 81 (Tue, 05 Jul 2016 21:02:25CST) &nbsp;datadir: /home/lihe/桌面/chain &nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt;&nbsp; &nbsp; &nbsp; 可以看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功 &nbsp;&nbsp;&nbsp;&nbsp;注意：如果想将Ubuntu作为永久区块链节点使用，当使用nohup命令时，Geth启动参数console必须去掉，否则Geth会自动停止。 &nbsp; 2、&nbsp; 在windows启动区块链节点 &nbsp; &nbsp; 进入Windows下Geth的目录 ，放置配置好的piccgenesis.json文件，执行如下命令： geth&nbsp;&nbsp;--datadir &quot;%cd%\chain&quot; init piccgenesis.json&nbsp; 创建数据存放地址并初始化创世块 geth--identity &quot;0x888&quot; --rpc--rpccorsdomain &quot;*&quot; --datadir &quot;%cd%\chain&quot; --port&quot;30303&quot;&nbsp; --rpcapi&quot;db,eth,net,web3&quot; --networkid 95518 console &nbsp; &nbsp; 当看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功 &nbsp; 五、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点创建账号 &nbsp; &nbsp; 启动节点成功后，会进入Geth的命令行模式，输入如下命令 personal.newAccount() &nbsp; &nbsp; 系统会提示你输入账号密码，并确认，最后会显示一个新生成的账号。 &nbsp;六、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接其他节点 &nbsp; &nbsp; 首先要知道自己的节点信息，在Geth命令行界面下输入命令,注意大小写 admin.nodeInfo &nbsp; &nbsp; 系统会显示 &nbsp;enode:&quot;enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303“ &nbsp; &nbsp; 其中 enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303 &nbsp; &nbsp; 就是自己节点的信息，注意要把“0.0.0.0“换成你自己的IP。将这个信息发送给其他节点，在其他节点的命令行中输入： admin.addPeer(‘enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@192.168.1.101:30303’) &nbsp; &nbsp; 如果添加成功，输入admin.peers会显示出新添加的节点。 &nbsp; 七、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点进行挖矿 账号创建后，还没有以太币，需要在私有链上挖矿，切换到Geth界面，输入 miner.start(1) &nbsp; &nbsp; &nbsp; &nbsp; miner命令括号中的1表示用一个线程进行挖矿，如果不配置，就会让CPU全速运行，影响计算机的使用。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行一会后，主账号就会获取很多以太币，这个时候屏幕会快速刷屏，不用管，输入命令miner.stop()停止挖矿。 &nbsp; &nbsp; &nbsp;到这一步，已经组建一个私有链的网络，可以像其他区块链一样不停的扩充这个网络，接下来，我会介绍如何在私有链上编写、调试和部署智能合约。 八、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在以太坊私有链上部署第一个智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 本文的智能合约采用以太坊官方的示例合约，功能就是在区块链上存储一个数字，并能够读取出来。代码如下： contract SimpleStorage { &nbsp;&nbsp;&nbsp; uint storedData; &nbsp;&nbsp;&nbsp; function set(uint x) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; storedData = x; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function get() constant returns (uintretVal) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return storedData; &nbsp;&nbsp;&nbsp; } } &nbsp; &nbsp; &nbsp; &nbsp; 即使没有学过Solidity语言也可以大致看出，该合约set函数存储一个数字在X变量中，get函数从X变量中读取这个数字出来，下面对这个合约进行部署： 1、&nbsp; 启动私有链 &nbsp; &nbsp;启动后界面如下, Ethereum-Wallet会显示红色的PRIVTE-NET标记。 2、创建两个钱包 &nbsp; &nbsp; &nbsp; &nbsp; 点击”ADD ACCOUNT” 按钮，添加一个钱包，程序会弹出一个对话框，提示输入两遍密码，输入完密码后，账号即创建成功。创建其他的账号，一样的操作，从上面的截图可以看到，有三个账号，一个是MAIN ACCOUNT，一个是ACCOUNT2，一个是ACCOUNT3 3、&nbsp; 将一个钱包的以太币转到另一个钱包中 &nbsp; &nbsp; &nbsp; &nbsp; 先点击ACCOUNT2账号，进入账号详情的界面，点击右侧的“COPY address”，把ACCOUNT2的地址拷贝下来，系统会提示你现在你处在一个测试网络，不要转入真正的以太币到这个账号。 &nbsp; &nbsp; &nbsp; &nbsp; 点击钱包中“SEND”按钮，从MAINACCOUNT给ACCOUNT2转入一定以太币，同时可以看到执行这笔交易的费用是0.00042个以太币。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 点击发送后会提示如输入密码，但这时还没有发送成功，根据区块链的交易规则，需要矿工的确认，并且每笔交易需要确认12个块，一个块是16秒的生成时间。切换到Geth程序，输入挖矿命令，直到ACCOUNT2上显示100个以太币，然后停止挖矿。 4、&nbsp; 部署智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 点“CONTRACTS”，进入智能合约管理界面，点击“DEPOLY NEW CONTRACT”,开始部署智能合约，选择部署智能合约的账号，并输入智能合约的代码后，如下图 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;输入完毕后点击“DEPLOY”，系统会提示输入账号密码，因为部署智能合约是需要费用的。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 这个时候是看不到部署的智能合约的，切换到Geth界面，进行挖矿，在12个块后，智能合约就能确认并显示出来。 九、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;运行智能合约 1、 在本节点上运行智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 点击“CONTRACTS”进入智能合约界面，可以看到刚才部署的智能合约“SimpleStorage”，点击进入该智能合约，进入详情界面，其中有智能合约写入区域和读取区域，首先启动Geth的挖矿，然后在写入区域选择相应的智能合约函数SET，在下面的数值输入框输入想设置的数值，运行一会后就可以在读取区域看到智能合约函数GET中Retval的返回值有变化。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;其他智能合约的运行也是一样，无非就是函数多点，输入多点。 &nbsp; 2、 在其他节点上运行智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 此时的智能合约只能自己能看到，别人是无法看到和运行的，如果其他人要运行你部署好的智能合约需要提供一些信息，就是其他教程中所说的智能合约的ABI和地址。 进入刚部署的“SimpleStorage”智能合约界面，右侧有四个按钮 A．“Deposit Eher”：向该智能合约发送以太币 B.“Copy address”：拷贝该智能合约的地址 C．“Show QR Code”：显示一个二维码，如果用手机扫描的话，显示该智能合约的地址 D．“Show Interface”：显示该智能合约的JSON接口，也就是ABI &nbsp; &nbsp; &nbsp; &nbsp; 首先我们点“Copy address”，拷贝该智能合约的地址，然后点“Show Interface”将智能合约的JSON接口全部拷贝出来，在另一个需要运行智能合约的节点打开Ethereum-Wallet，打开“CONTRACTS”界面点击“WATCH CONTRACTS”添加一个智能合约。 &nbsp; &nbsp; &nbsp; &nbsp; 如上图所示，CONTRACT NAME随便填，CONTRACT ADDRESS填写智能合约地址，JSON INTERFACE填写刚才在”Show Interface “中拷贝的内容。点OK后，就可以看到这个智能合约并运行了。 十、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的部署原理 1、智能合约的部署架构 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;本文介绍的智能合约的部署虽然是在图形化界面编译和执行，但其实最主要的是依赖于后台运行Geth的节点，此时Geth提供了一个RPC的接口向图形化界面的钱包提供区块链的信息。 RPC接口 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Geth在8545端口提供了JSON RPC API ，数据传输采用JSON格式，可以执行Web3库的各种命令，比如向前端，比如mist等图形化客户端提供区块链的信息，默认访问地址为http://localhost:8545。 &nbsp; &nbsp; &nbsp; &nbsp; 我们部署一个智能合约时，首先Ethereum-Wallet调用SOLC智能合约编译器将代码编译成成EVM字节码，然后将EVM字节码通过Geth的RPC接口发送到以太坊网络，经过全网验证后，同时写入到每个Geth管理的区块链中，架构如下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2、 部署的数据流 &nbsp; &nbsp; &nbsp; &nbsp;首先代码先经过SOLC编译变为了二进制码，然后通过一笔交易来创建智能合约，该笔交易包含了创建者账号、智能合约内容、智能合约的地址这几个关键信息，其中智能合约地址的生成是由创建者的账号和发送的交易数作为随机数输入，通过Kecca-256加密算法重新创建一个地址作为账号。 &nbsp; &nbsp; &nbsp; &nbsp;部署过程中，需要通过交易来部署，同时数据要存储到区块链上，这些需要使用到GAS。 交易（Transactions） &nbsp; &nbsp; &nbsp; &nbsp; 一笔交易是一条消息，从一个账户发送到另一个账户。交易可以包含二进制数据（payload）和以太币。 &nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户包含代码，该代码和输入数据会被执行。 &nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户是零账户（账户地址是0），交易将创建一个新合约。正如上文所讲，这个智能合约地址不是零地址，而是由合约创建者的地址和该地址发出过的交易数量计算得到。创建合约交易的payload被当作EVM字节码执行。执行的输出做为合约代码被永久存储。这意味着，为了创建一个合约，你不需要向合约发送真正的合约代码，而是发送能够返回可执行代码的代码。 Gas &nbsp; &nbsp; &nbsp; &nbsp; 以太坊上的每笔交易都会被收取一定数量的gas，gas的目的是限制执行交易所需的工作量，同时为执行支付费用。当EVM执行智能合约时，gas将按照特定规则被逐渐消耗，其实GAS就是以太币的比较小的单位，如果以太币比作100元，那么GAS可以看作是1分钱。如果只有以太币，会有问题，以太币是需要大家买卖的，市场会有价格波动。可能会出现比特币这样的状况，一天跌50%涨50%。这个对计算的成本是不能接受的，例如今天做一个加法需要十块钱，明天做一个加法需要一百块钱。所以这里引入gas来解耦。把市场的波动和计算的开销来解耦，也就是说以太币和gas之间是有汇率的，以太币涨没关系，gas价格下降就可以了。它要保证我做同样的计算，消耗的法币是一致的。 &nbsp; &nbsp; &nbsp; &nbsp; gas price（gas价格，以太币计）是由交易创建者设置的，发送账户需要预付的交易费用 = gas price * gas amount。 如果执行结束还有gas剩余，这些gas将被返还给发送账户。 &nbsp; &nbsp; &nbsp; &nbsp; 前文中曾经提到部署智能合约使用了0.00042个以太币，换算成gas就是21000个gas。 &nbsp; &nbsp; &nbsp; &nbsp; 无论执行到什么位置，一旦gas被耗尽（比如降为负值），将会触发一个out-of-gas异常。当前调用帧所做的所有状态修改都将被回滚。 十一、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的运行原理 &nbsp; &nbsp; &nbsp; &nbsp; 智能合约是部署在区块链的代码，区块链本身不能执行代码，代码的执行是在本地的EVM中，实际上，部署在区块链上代码是能够在本地产生原智能合约代码的代码，可以理解区块链为一个数据库，而客户端从数据库中读取了存储的运行代码，并在本地运行后，将结果写入到了区块链这个数据库中。 &nbsp; &nbsp; &nbsp; &nbsp;本质上，以太坊的钱包也是智能合约的一个应用，以太坊搭建的是一个可供编写各种应用的平台。下一篇，将详细讲述智能合约的开发编写和调试方法 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/01/17/afcaf77946bd9f92da1bf7653efad168.html" />
<meta property="og:url" content="https://mlh.app/2018/01/17/afcaf77946bd9f92da1bf7653efad168.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-17T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"搭建基于以太坊的私有链环境 &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; 通过本文所述方法和项目中的脚本，我们可以快速的搭建好自己的私有链进行区块链开发测试，本文基于以太坊技术进行搭建，分两个部分，一个是Ubuntu下搭建方法，另一个是Windwos下搭建方法，&nbsp; 一、&nbsp;&nbsp;&nbsp;Ubuntu下安装Geth客户端 &nbsp; &nbsp; 之所以采用Ubuntu，是因为以太坊的官方对Ubuntu支持的很好，是在各个linux系统中安装最简单。 &nbsp; &nbsp; Geth官方安装指南： &nbsp; &nbsp; https://github.com/ethereum/go-ethereum/wiki/Building-Ethereum &nbsp; &nbsp; 进入ubuntu命令行，执行如下命令&nbsp; sudo apt-get update sudo apt-get installsoftware-properties-common sudo add-apt-repository -yppa:ethereum/ethereum sudo add-apt-repository -yppa:ethereum/ethereum-dev sudo apt-get update sudo apt-get install ethereum &nbsp;&nbsp; &nbsp;系统联网执行后，即完成了安装以太坊客户端，其中包括geth,bootnode, evm, disasm, rlpdump,ethtest &nbsp; &nbsp; 此时如果输入Geth命令，会出现启动以太坊启动的画面 &nbsp;二、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;安装Windows下Geth客户端 &nbsp; &nbsp; Windows必须64位系统，从官方网站下载编译好的win64客户端，解压缩即可运行，下载地址如下： &nbsp; &nbsp;&nbsp;https://github.com/ethereum/go-ethereum/releases/ &nbsp; &nbsp; 下载后，只有一个Geth.exe的文件。 &nbsp; &nbsp; 安装图像化客户端Mist，依然是从官方地址下载编译好的客户端即可，下载地址： &nbsp; &nbsp;&nbsp;https://github.com/ethereum/mist/releases/ &nbsp; &nbsp; 下载解压缩后，Ethereum-Wallet即为以太坊图形化界面。 &nbsp; 三、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;准备创世块文件 &nbsp; &nbsp; 配置自己的创世块是为了区分公有链，同一个网络中，创世块必须是一样的，否则无法联通，此方法在windows和Ubuntu下通用。 &nbsp; &nbsp; 新建文件piccgenesis.json,输入如下内容并保存 { &nbsp;&nbsp;&nbsp; &quot;nonce&quot;:&quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp; &quot;mixhash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;difficulty&quot;: &quot;0x4000&quot;, &nbsp;&nbsp;&nbsp; &quot;alloc&quot;: {}, &nbsp;&nbsp;&nbsp; &quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;timestamp&quot;: &quot;0x00&quot;, &nbsp;&nbsp;&nbsp; &quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp; &quot;extraData&quot;: &quot;0x888&quot;, &nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;:&quot;0xffffffff&quot; } &nbsp;&nbsp; &nbsp; 解释一下各个参数的作用：&nbsp; mixhash 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。. nonce nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase 矿工的账号，随便填 timestamp 设置创世块的时间戳 parentHash 上一个区块的hash值，因为是创世块，所以这个值是0 extraData 附加信息，随便填，可以填你的个性信息 ，如果最新的geth初始化可能会提示要求以0x开头，可以填入&quot;0x00&quot; 或 “0x123888&quot;等。 gasLimit 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 &nbsp;四、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动私有链节点 &nbsp; &nbsp; 启动Geth即可以启动以太坊的区块链，为了构建私有链 ，需要在Geth启动时加入一些参数，Geth参数含义如下：&nbsp; identity 区块链的标示，随便填写，用于标示目前网络的名字 init 指定创世块文件的位置，并创建初始块 datadir 设置当前区块链网络数据存放的位置 port 网络监听端口 rpc 启动rpc通信，可以进行智能合约的部署和调试 rpcapi 设置允许连接的rpc的客户端，一般为db,eth,net,web3 networkid 设置当前区块链的网络ID，用于区分不同的网络，是一个数字 console 启动命令行模式，可以在Geth中执行命令 &nbsp; 1、&nbsp; 在Ubuntu启动区块链节点 &nbsp; &nbsp; 在Ubuntu下，首先切换到打算运行的目录，目录下应该有配置好的piccgenesis.json文件，执行如下命令 basepath=$(cd `dirname $0`; pwd) 获取当前的目录 geth&nbsp;&nbsp;--datadir &quot;$basepath/chain&quot; init piccgenesis.json&nbsp; 创建数据存放地址并初始化创世块 geth --identity &quot;0x888&quot; &nbsp;--rpc&nbsp; --rpccorsdomain &quot;*&quot; --datadir &quot;$basepath/chain&quot; --port &quot;30303&quot;&nbsp; --rpcapi &quot;db,eth,net,web3&quot;--networkid 95518 console &nbsp; &nbsp; 启动后界面如下，光标停留在最后的命令行上，可以执行以太坊命令。 I0707 00:45:43.680087 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata I0707 00:45:43.726008ethdb/database.go:169] closed db:/home/lihe/桌面/chain/chaindata I0707 00:45:43.728913 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata I0707 00:45:43.908795 ethdb/database.go:82]Alloted 16MB cache and 16 file handles to /home/lihe/桌面/chain/dapp I0707 00:45:43.969506 core/genesis.go:92]Genesis block already in chain. Writing canonical number I0707 00:45:43.980337 eth/backend.go:274]Successfully wrote custom genesis block:6e92f8b23bcdfdf34dc813cfaf1d84b71beac80530506b5d63a2df10fe23a660 I0707 00:45:43.980618 eth/backend.go:184]Protocol Versions: [63 62], Network Id: 95518 I0707 00:45:43.981567core/blockchain.go:204] Last header: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.981645core/blockchain.go:205] Last block: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.981677core/blockchain.go:206] Fast block: #81 [6193c4b0…] TD=10836704 I0707 00:45:43.985253 p2p/server.go:313]Starting Server I0707 00:45:45.834488p2p/discover/udp.go:217] Listening,enode://134881790e54c803955715e3661c27f91caaf499be813e29c9f986e2eac62d47e02b13a8e51776c1caea554655614ed26ce0185d84e626da7ac48a83a60113ff@[::]:30303 I0707 00:45:45.835853 node/node.go:366]HTTP endpoint opened: http://localhost:8545 I0707 00:45:45.848008 p2p/server.go:556]Listening on [::]:30303 I0707 00:45:45.849731 node/node.go:296] IPCendpoint opened: /home/lihe/桌面/chain/geth.ipc Welcome to the Geth JavaScript console! &nbsp; instance:Geth/v1.5.0-unstable/linux/go1.5.1/PICCetherum coinbase:0x93509a2f4b2b974b07ef0b52e07c3992601f5de1 at block: 81 (Tue, 05 Jul 2016 21:02:25CST) &nbsp;datadir: /home/lihe/桌面/chain &nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt;&nbsp; &nbsp; &nbsp; 可以看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功 &nbsp;&nbsp;&nbsp;&nbsp;注意：如果想将Ubuntu作为永久区块链节点使用，当使用nohup命令时，Geth启动参数console必须去掉，否则Geth会自动停止。 &nbsp; 2、&nbsp; 在windows启动区块链节点 &nbsp; &nbsp; 进入Windows下Geth的目录 ，放置配置好的piccgenesis.json文件，执行如下命令： geth&nbsp;&nbsp;--datadir &quot;%cd%\\chain&quot; init piccgenesis.json&nbsp; 创建数据存放地址并初始化创世块 geth--identity &quot;0x888&quot; --rpc--rpccorsdomain &quot;*&quot; --datadir &quot;%cd%\\chain&quot; --port&quot;30303&quot;&nbsp; --rpcapi&quot;db,eth,net,web3&quot; --networkid 95518 console &nbsp; &nbsp; 当看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功 &nbsp; 五、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点创建账号 &nbsp; &nbsp; 启动节点成功后，会进入Geth的命令行模式，输入如下命令 personal.newAccount() &nbsp; &nbsp; 系统会提示你输入账号密码，并确认，最后会显示一个新生成的账号。 &nbsp;六、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接其他节点 &nbsp; &nbsp; 首先要知道自己的节点信息，在Geth命令行界面下输入命令,注意大小写 admin.nodeInfo &nbsp; &nbsp; 系统会显示 &nbsp;enode:&quot;enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303“ &nbsp; &nbsp; 其中 enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303 &nbsp; &nbsp; 就是自己节点的信息，注意要把“0.0.0.0“换成你自己的IP。将这个信息发送给其他节点，在其他节点的命令行中输入： admin.addPeer(‘enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@192.168.1.101:30303’) &nbsp; &nbsp; 如果添加成功，输入admin.peers会显示出新添加的节点。 &nbsp; 七、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点进行挖矿 账号创建后，还没有以太币，需要在私有链上挖矿，切换到Geth界面，输入 miner.start(1) &nbsp; &nbsp; &nbsp; &nbsp; miner命令括号中的1表示用一个线程进行挖矿，如果不配置，就会让CPU全速运行，影响计算机的使用。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行一会后，主账号就会获取很多以太币，这个时候屏幕会快速刷屏，不用管，输入命令miner.stop()停止挖矿。 &nbsp; &nbsp; &nbsp;到这一步，已经组建一个私有链的网络，可以像其他区块链一样不停的扩充这个网络，接下来，我会介绍如何在私有链上编写、调试和部署智能合约。 八、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在以太坊私有链上部署第一个智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 本文的智能合约采用以太坊官方的示例合约，功能就是在区块链上存储一个数字，并能够读取出来。代码如下： contract SimpleStorage { &nbsp;&nbsp;&nbsp; uint storedData; &nbsp;&nbsp;&nbsp; function set(uint x) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; storedData = x; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function get() constant returns (uintretVal) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return storedData; &nbsp;&nbsp;&nbsp; } } &nbsp; &nbsp; &nbsp; &nbsp; 即使没有学过Solidity语言也可以大致看出，该合约set函数存储一个数字在X变量中，get函数从X变量中读取这个数字出来，下面对这个合约进行部署： 1、&nbsp; 启动私有链 &nbsp; &nbsp;启动后界面如下, Ethereum-Wallet会显示红色的PRIVTE-NET标记。 2、创建两个钱包 &nbsp; &nbsp; &nbsp; &nbsp; 点击”ADD ACCOUNT” 按钮，添加一个钱包，程序会弹出一个对话框，提示输入两遍密码，输入完密码后，账号即创建成功。创建其他的账号，一样的操作，从上面的截图可以看到，有三个账号，一个是MAIN ACCOUNT，一个是ACCOUNT2，一个是ACCOUNT3 3、&nbsp; 将一个钱包的以太币转到另一个钱包中 &nbsp; &nbsp; &nbsp; &nbsp; 先点击ACCOUNT2账号，进入账号详情的界面，点击右侧的“COPY address”，把ACCOUNT2的地址拷贝下来，系统会提示你现在你处在一个测试网络，不要转入真正的以太币到这个账号。 &nbsp; &nbsp; &nbsp; &nbsp; 点击钱包中“SEND”按钮，从MAINACCOUNT给ACCOUNT2转入一定以太币，同时可以看到执行这笔交易的费用是0.00042个以太币。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 点击发送后会提示如输入密码，但这时还没有发送成功，根据区块链的交易规则，需要矿工的确认，并且每笔交易需要确认12个块，一个块是16秒的生成时间。切换到Geth程序，输入挖矿命令，直到ACCOUNT2上显示100个以太币，然后停止挖矿。 4、&nbsp; 部署智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 点“CONTRACTS”，进入智能合约管理界面，点击“DEPOLY NEW CONTRACT”,开始部署智能合约，选择部署智能合约的账号，并输入智能合约的代码后，如下图 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;输入完毕后点击“DEPLOY”，系统会提示输入账号密码，因为部署智能合约是需要费用的。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 这个时候是看不到部署的智能合约的，切换到Geth界面，进行挖矿，在12个块后，智能合约就能确认并显示出来。 九、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;运行智能合约 1、 在本节点上运行智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 点击“CONTRACTS”进入智能合约界面，可以看到刚才部署的智能合约“SimpleStorage”，点击进入该智能合约，进入详情界面，其中有智能合约写入区域和读取区域，首先启动Geth的挖矿，然后在写入区域选择相应的智能合约函数SET，在下面的数值输入框输入想设置的数值，运行一会后就可以在读取区域看到智能合约函数GET中Retval的返回值有变化。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;其他智能合约的运行也是一样，无非就是函数多点，输入多点。 &nbsp; 2、 在其他节点上运行智能合约 &nbsp; &nbsp; &nbsp; &nbsp; 此时的智能合约只能自己能看到，别人是无法看到和运行的，如果其他人要运行你部署好的智能合约需要提供一些信息，就是其他教程中所说的智能合约的ABI和地址。 进入刚部署的“SimpleStorage”智能合约界面，右侧有四个按钮 A．“Deposit Eher”：向该智能合约发送以太币 B.“Copy address”：拷贝该智能合约的地址 C．“Show QR Code”：显示一个二维码，如果用手机扫描的话，显示该智能合约的地址 D．“Show Interface”：显示该智能合约的JSON接口，也就是ABI &nbsp; &nbsp; &nbsp; &nbsp; 首先我们点“Copy address”，拷贝该智能合约的地址，然后点“Show Interface”将智能合约的JSON接口全部拷贝出来，在另一个需要运行智能合约的节点打开Ethereum-Wallet，打开“CONTRACTS”界面点击“WATCH CONTRACTS”添加一个智能合约。 &nbsp; &nbsp; &nbsp; &nbsp; 如上图所示，CONTRACT NAME随便填，CONTRACT ADDRESS填写智能合约地址，JSON INTERFACE填写刚才在”Show Interface “中拷贝的内容。点OK后，就可以看到这个智能合约并运行了。 十、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的部署原理 1、智能合约的部署架构 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;本文介绍的智能合约的部署虽然是在图形化界面编译和执行，但其实最主要的是依赖于后台运行Geth的节点，此时Geth提供了一个RPC的接口向图形化界面的钱包提供区块链的信息。 RPC接口 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Geth在8545端口提供了JSON RPC API ，数据传输采用JSON格式，可以执行Web3库的各种命令，比如向前端，比如mist等图形化客户端提供区块链的信息，默认访问地址为http://localhost:8545。 &nbsp; &nbsp; &nbsp; &nbsp; 我们部署一个智能合约时，首先Ethereum-Wallet调用SOLC智能合约编译器将代码编译成成EVM字节码，然后将EVM字节码通过Geth的RPC接口发送到以太坊网络，经过全网验证后，同时写入到每个Geth管理的区块链中，架构如下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2、 部署的数据流 &nbsp; &nbsp; &nbsp; &nbsp;首先代码先经过SOLC编译变为了二进制码，然后通过一笔交易来创建智能合约，该笔交易包含了创建者账号、智能合约内容、智能合约的地址这几个关键信息，其中智能合约地址的生成是由创建者的账号和发送的交易数作为随机数输入，通过Kecca-256加密算法重新创建一个地址作为账号。 &nbsp; &nbsp; &nbsp; &nbsp;部署过程中，需要通过交易来部署，同时数据要存储到区块链上，这些需要使用到GAS。 交易（Transactions） &nbsp; &nbsp; &nbsp; &nbsp; 一笔交易是一条消息，从一个账户发送到另一个账户。交易可以包含二进制数据（payload）和以太币。 &nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户包含代码，该代码和输入数据会被执行。 &nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户是零账户（账户地址是0），交易将创建一个新合约。正如上文所讲，这个智能合约地址不是零地址，而是由合约创建者的地址和该地址发出过的交易数量计算得到。创建合约交易的payload被当作EVM字节码执行。执行的输出做为合约代码被永久存储。这意味着，为了创建一个合约，你不需要向合约发送真正的合约代码，而是发送能够返回可执行代码的代码。 Gas &nbsp; &nbsp; &nbsp; &nbsp; 以太坊上的每笔交易都会被收取一定数量的gas，gas的目的是限制执行交易所需的工作量，同时为执行支付费用。当EVM执行智能合约时，gas将按照特定规则被逐渐消耗，其实GAS就是以太币的比较小的单位，如果以太币比作100元，那么GAS可以看作是1分钱。如果只有以太币，会有问题，以太币是需要大家买卖的，市场会有价格波动。可能会出现比特币这样的状况，一天跌50%涨50%。这个对计算的成本是不能接受的，例如今天做一个加法需要十块钱，明天做一个加法需要一百块钱。所以这里引入gas来解耦。把市场的波动和计算的开销来解耦，也就是说以太币和gas之间是有汇率的，以太币涨没关系，gas价格下降就可以了。它要保证我做同样的计算，消耗的法币是一致的。 &nbsp; &nbsp; &nbsp; &nbsp; gas price（gas价格，以太币计）是由交易创建者设置的，发送账户需要预付的交易费用 = gas price * gas amount。 如果执行结束还有gas剩余，这些gas将被返还给发送账户。 &nbsp; &nbsp; &nbsp; &nbsp; 前文中曾经提到部署智能合约使用了0.00042个以太币，换算成gas就是21000个gas。 &nbsp; &nbsp; &nbsp; &nbsp; 无论执行到什么位置，一旦gas被耗尽（比如降为负值），将会触发一个out-of-gas异常。当前调用帧所做的所有状态修改都将被回滚。 十一、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的运行原理 &nbsp; &nbsp; &nbsp; &nbsp; 智能合约是部署在区块链的代码，区块链本身不能执行代码，代码的执行是在本地的EVM中，实际上，部署在区块链上代码是能够在本地产生原智能合约代码的代码，可以理解区块链为一个数据库，而客户端从数据库中读取了存储的运行代码，并在本地运行后，将结果写入到了区块链这个数据库中。 &nbsp; &nbsp; &nbsp; &nbsp;本质上，以太坊的钱包也是智能合约的一个应用，以太坊搭建的是一个可供编写各种应用的平台。下一篇，将详细讲述智能合约的开发编写和调试方法 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/01/17/afcaf77946bd9f92da1bf7653efad168.html","headline":"如何搭建基于以太坊的私有链","dateModified":"2018-01-17T00:00:00+08:00","datePublished":"2018-01-17T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/01/17/afcaf77946bd9f92da1bf7653efad168.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>如何搭建基于以太坊的私有链</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p align="center" style="color:rgb(69,69,69);text-align:center;background-color:rgb(255,255,255);"><span style="font-size:24px;"><strong>搭建基于以太坊的私有链环境</strong></span></p>
  <p align="center" style="color:rgb(69,69,69);text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp;&nbsp;</span></p>
  <p align="center" style="color:rgb(69,69,69);text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 通过本文所述方法和项目中的脚本，我们可以快速的搭建好自己的私有链进行区块链开发测试，本文基于以太坊技术进行搭建，分两个部分，一个是Ubuntu下搭建方法，另一个是Windwos下搭建方法，</span><span style="font-size:18px;text-align:justify;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>一、&nbsp;&nbsp;&nbsp;Ubuntu下安装Geth客户端</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 之所以采用Ubuntu，是因为以太坊的官方对Ubuntu支持的很好，是在各个linux系统中安装最简单。</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; Geth官方安装指南：</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; https://github.com/ethereum/go-ethereum/wiki/Building-Ethereum</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 进入ubuntu命令行，执行如下命令</span><span style="font-size:18px;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">sudo apt-get update</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">sudo apt-get installsoftware-properties-common</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">sudo add-apt-repository -yppa:ethereum/ethereum</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">sudo add-apt-repository -yppa:ethereum/ethereum-dev</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">sudo apt-get update</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">sudo apt-get install ethereum</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span><span style="font-size:18px;">&nbsp; &nbsp;系统联网执行后，即完成了安装以太坊客户端，其中包括geth,bootnode, evm, disasm, rlpdump,ethtest</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 此时如果输入Geth命令，会出现启动以太坊启动的画面</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span><span style="font-size:18px;"><strong>二、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;安装Windows下Geth客户端</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; Windows必须64位系统，从官方网站下载编译好的win64客户端，解压缩即可运行，下载地址如下：</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp;&nbsp;https://github.com/ethereum/go-ethereum/releases/</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 下载后，只有一个Geth.exe的文件。</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 安装图像化客户端Mist，依然是从官方地址下载编译好的客户端即可，下载地址：</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp;&nbsp;https://github.com/ethereum/mist/releases/</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 下载解压缩后，Ethereum-Wallet即为以太坊图形化界面。</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">三、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>准备创世块文件</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 配置自己的创世块是为了区分公有链，同一个网络中，创世块必须是一样的，否则无法联通，此方法在windows和Ubuntu下通用。</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 新建文件piccgenesis.json,输入如下内容并保存</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">{</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "nonce":"0x0000000000000042",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "mixhash":"0x0000000000000000000000000000000000000000000000000000000000000000",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "difficulty": "0x4000",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "alloc": {},</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "coinbase":"0x0000000000000000000000000000000000000000",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "timestamp": "0x00",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "extraData": "0x888",</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; "gasLimit":"0xffffffff"</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">}</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span><span style="font-size:18px;">&nbsp; &nbsp; 解释一下各个参数的作用：</span><span style="font-size:18px;">&nbsp;</span></p>
  <table border="1" cellspacing="0" cellpadding="0" style="color:rgb(69,69,69);font-size:16px;line-height:24px;">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">mixhash</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">与nonce</span>配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。.</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">nonce</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">nonce</span><span style="color:rgb(51,51,51);">就是一个64</span>位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">difficulty</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">设置当前区块的难度，如果难度过大，cpu</span>挖矿就很难，这里设置较小难度</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">alloc</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">coinbase</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">矿工的账号，随便填</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">timestamp</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">设置创世块的时间戳</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">parentHash</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">上一个区块的hash</span>值，因为是创世块，所以这个值是0</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">extraData</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">附加信息，随便填，可以填你的个性信息 ，如果最新的geth初始化可能会提示要求以0x开头，可以填入"0x00" 或 “0x123888"等。</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">gasLimit</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">该值设置对GAS</span>的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。</span></p></td>
    </tr>
   </tbody>
  </table>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><strong><span style="font-weight:400;font-size:18px;">&nbsp;</span></strong><span style="font-size:18px;"><strong>四、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动私有链节点</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 启动Geth即可以启动以太坊的区块链，为了构建私有链 ，需要在Geth启动时加入一些参数，Geth参数含义如下：</span><span style="font-size:18px;">&nbsp;</span></p>
  <table border="1" cellspacing="0" cellpadding="0" style="color:rgb(69,69,69);font-size:16px;line-height:24px;">
   <tbody>
    <tr>
     <td valign="top"><p align="left"><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">identity</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">区块链的标示，随便填写，用于标示目前网络的名字</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;"><strong>init</strong></span></span></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">指定创世块文件的位置，并创建初始块</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">datadir</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">设置当前区块链网络数据存放的位置</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">port</span></span></strong></p></td>
     <td valign="top"><p><span style="color:rgb(51,51,51);"><span style="font-size:18px;">网络监听端口</span></span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">rpc</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">启动rpc</span>通信，可以进行智能合约的部署和调试</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">rpcapi</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">设置允许连接的rpc</span>的客户端，一般为db,eth,net,web3</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;color:rgb(51,51,51);"><span style="font-size:18px;">networkid</span></span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">设置当前区块链的网络ID</span>，用于区分不同的网络，是一个数字</span></p></td>
    </tr>
    <tr>
     <td valign="top"><p><strong><span style="font-weight:400;font-size:18px;">console</span></strong></p></td>
     <td valign="top"><p><span style="font-size:18px;"><span style="color:rgb(51,51,51);">启动命令行模式，可以在Geth</span>中执行命令</span></p></td>
    </tr>
   </tbody>
  </table>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>1、&nbsp; 在Ubuntu启动区块链节点</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 在Ubuntu下，首先切换到打算运行的目录，目录下应该有配置好的piccgenesis.json文件，执行如下命令</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">basepath=$(cd `dirname $0`; pwd)</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">获取当前的目录</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">geth&nbsp;<span>&nbsp;--datadir "$basepath/chain" init piccgenesis.json&nbsp;</span></span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">创建数据存放地址并初始化创世块</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">geth --identity "0x888" &nbsp;--rpc&nbsp; --rpccorsdomain "*" --datadir "$basepath/chain" --port "30303"&nbsp; --rpcapi "db,eth,net,web3"--networkid 95518 console</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 启动后界面如下，光标停留在最后的命令行上，可以执行以太坊命令。</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;">I<span style="color:rgb(255,255,255);">0707 00:45:43.680087 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata</span></span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.726008ethdb/database.go:169] closed db:/home/lihe/桌面/chain/chaindata</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.728913 ethdb/database.go:82]Alloted 128MB cache and 1024 file handles to /home/lihe/桌面/chain/chaindata</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.908795 ethdb/database.go:82]Alloted 16MB cache and 16 file handles to /home/lihe/桌面/chain/dapp</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.969506 core/genesis.go:92]Genesis block already in chain. Writing canonical number</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.980337 eth/backend.go:274]Successfully wrote custom genesis block:6e92f8b23bcdfdf34dc813cfaf1d84b71beac80530506b5d63a2df10fe23a660</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.980618 eth/backend.go:184]Protocol Versions: [63 62], Network Id: 95518</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.981567core/blockchain.go:204] Last header: #81 [6193c4b0…] TD=10836704</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.981645core/blockchain.go:205] Last block: #81 [6193c4b0…] TD=10836704</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.981677core/blockchain.go:206] Fast block: #81 [6193c4b0…] TD=10836704</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:43.985253 p2p/server.go:313]Starting Server</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:45.834488p2p/discover/udp.go:217] Listening,enode://134881790e54c803955715e3661c27f91caaf499be813e29c9f986e2eac62d47e02b13a8e51776c1caea554655614ed26ce0185d84e626da7ac48a83a60113ff@[::]:30303</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:45.835853 node/node.go:366]HTTP endpoint opened: http://localhost:8545</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:45.848008 p2p/server.go:556]Listening on [::]:30303</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">I0707 00:45:45.849731 node/node.go:296] IPCendpoint opened: /home/lihe/桌面/chain/geth.ipc</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">Welcome to the Geth JavaScript console!</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">instance:Geth/v1.5.0-unstable/linux/go1.5.1/PICCetherum</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">coinbase:0x93509a2f4b2b974b07ef0b52e07c3992601f5de1</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">at block: 81 (Tue, 05 Jul 2016 21:02:25CST)</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">&nbsp;datadir: /home/lihe/桌面/chain</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">&nbsp;modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;color:rgb(255,255,255);">&gt;&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 可以看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;</strong>注意：如果想将Ubuntu作为永久区块链节点使用，当使用nohup命令时，Geth启动参数console必须去掉，否则Geth会自动停止。</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>2、&nbsp; 在windows启动区块链节点</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 进入Windows下Geth的目录 ，放置配置好的piccgenesis.json文件，执行如下命令：</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;"></span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">geth&nbsp;&nbsp;--datadir "<span>%cd%\</span>chain" init piccgenesis.json&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">创建数据存放地址并初始化创世块</span></p>
  <p align="left" style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">geth--identity "0x888" --rpc--rpccorsdomain "*" --datadir "%cd%\chain" --port"30303"&nbsp; --rpcapi"db,eth,net,web3" --networkid 95518 console</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 当看到Listening on [::]:30303和Welcome to the Geth JavaScript console!的提示，说明已经启动成功</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>五、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点创建账号</strong></span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 启动节点成功后，会进入Geth的命令行模式，输入如下命令</span></p>
  <p style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">personal.newAccount()</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 系统会提示你输入账号密码，并确认，最后会显示一个新生成的账号。</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span><span style="font-size:18px;text-align:justify;"><strong>六、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接其他节点</strong></span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 首先要知道自己的节点信息，在Geth命令行界面下输入命令,注意大小写</span></p>
  <p style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">admin.nodeInfo</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 系统会显示</span></p>
  <p style="color:rgb(69,69,69);background:rgb(0,0,0);"><span style="font-size:18px;">&nbsp;<span style="color:rgb(255,255,255);">enode:"enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303“</span></span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 其中</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@0.0.0.0:30303</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 就是自己节点的信息，注意要把“0.0.0.0“换成你自己的IP。将这个信息发送给其他节点，在其他节点的命令行中输入：</span></p>
  <p style="color:rgb(69,69,69);background:rgb(222,234,246);"><span style="font-size:18px;">admin.addPeer(‘enode://1e3c1727cd3bee9f25edeb5dbb3b880e03e41f8eec99566557f3ee0422734a8fcad17c161aa93d61bdbfb28ed152c143c7eb501db58bc63502a104a84b62d742@192.168.1.101:30303’)</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 如果添加成功，输入admin.peers会显示出新添加的节点。</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp;</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>七、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用节点进行挖矿</strong></span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;color:rgb(85,85,85);font-family:'microsoft yahei';line-height:35px;">账号创建后，还没有以太币，需要在私有链上挖矿，切换到Geth界面，输入</span></p>
  <p align="left" style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"></span></p>
  <p style="line-height:35px;font-size:15px;color:rgb(85,85,85);font-family:'microsoft yahei';background-color:rgb(255,255,255);"><span style="font-size:18px;">miner.start(1)</span></p>
  <p style="line-height:35px;font-size:15px;color:rgb(85,85,85);font-family:'microsoft yahei';background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; miner命令括号中的1表示用一个线程进行挖矿，如果不配置，就会让CPU全速运行，影响计算机的使用。</span></p>
  <p style="line-height:35px;font-size:15px;color:rgb(85,85,85);text-align:center;font-family:'microsoft yahei';background-color:rgb(255,255,255);"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819111755255?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></p>
  <p style="line-height:35px;font-size:15px;color:rgb(85,85,85);font-family:'microsoft yahei';background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行一会后，主账号就会获取很多以太币，这个时候屏幕会快速刷屏，不用管，输入命令miner.stop()停止挖矿。</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp;到这一步，已经组建一个私有链的网络，可以像其他区块链一样不停的扩充这个网络，接下来，我会介绍如何在私有链上编写、调试和部署智能合约。</span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;color:rgb(85,85,85);font-family:'microsoft yahei';line-height:35px;"><strong>八、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在以太坊私有链上部署第一个智能合约</strong></span></p>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 本文的智能合约采用以太坊官方的示例合约，功能就是在区块链上存储一个数字，并能够读取出来。代码如下：</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">contract SimpleStorage {</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; uint storedData;</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; function set(uint x) {</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; storedData = x;</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; }</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; function get() constant returns (uintretVal) {</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return storedData;</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; }</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background:rgb(222,234,246);"><span style="font-size:18px;">}</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 即使没有学过Solidity语言也可以大致看出，该合约set函数存储一个数字在X变量中，get函数从X变量中读取这个数字出来，下面对这个合约进行部署：</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>1、&nbsp; 启动私有链</strong></span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp;启动后界面如下, Ethereum-Wallet会显示红色的PRIVTE-NET标记。</span></p>
  <p align="left" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819111725982?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><strong><span style="font-size:18px;">2、创建两个钱包</span></strong></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 点击”ADD ACCOUNT” 按钮，添加一个钱包，程序会弹出一个对话框，提示输入两遍密码，输入完密码后，账号即创建成功。创建其他的账号，一样的操作，从上面的截图可以看到，有三个账号，一个是MAIN ACCOUNT，一个是ACCOUNT2，一个是ACCOUNT3</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>3、&nbsp; 将一个钱包的以太币转到另一个钱包中</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 先点击ACCOUNT2账号，进入账号详情的界面，点击右侧的“COPY address”，把ACCOUNT2的地址拷贝下来，系统会提示你现在你处在一个<a href="http://lib.csdn.net/base/softwaretest" rel="nofollow" class="replace_word" title="软件测试知识库" style="color:rgb(223,52,52);font-weight:bold;">测试</a>网络，不要转入真正的以太币到这个账号。</span></p>
  <p align="center" style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819111826061?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 点击钱包中“SEND”按钮，从MAINACCOUNT给ACCOUNT2转入一定以太币，同时可以看到执行这笔交易的费用是0.00042个以太币。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819111852452?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819111926381?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;">&nbsp; &nbsp; &nbsp;</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 点击发送后会提示如输入密码，但这时还没有发送成功，根据区块链的交易规则，需要矿工的确认，并且每笔交易需要确认12个块，一个块是16秒的生成时间。切换到Geth程序，输入挖矿命令，直到ACCOUNT2上显示100个以太币，然后停止挖矿。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>4、&nbsp; 部署智能合约</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 点“CONTRACTS”，进入智能合约管理界面，点击“DEPOLY NEW CONTRACT”,开始部署智能合约，选择部署智能合约的账号，并输入智能合约的代码后，如下图</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112023803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;输入完毕后点击“DEPLOY”，系统会提示输入账号密码，因为部署智能合约是需要费用的。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112045100?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; 这个时候是看不到部署的智能合约的，切换到Geth界面，进行挖矿，在12个块后，智能合约就能确认并显示出来。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>九、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;运行智能合约</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>1、 在本节点上运行智能合约</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 点击“CONTRACTS”进入智能合约界面，可以看到刚才部署的智能合约“<span style="color:rgb(64,64,64);">SimpleStorage</span>”，点击进入该智能合约，进入详情界面，其中有智能合约写入区域和读取区域，首先启动Geth的挖矿，然后在写入区域选择相应的智能合约函数SET，在下面的数值输入框输入想设置的数值，运行一会后就可以在读取区域看到智能合约函数GET中Retval的返回值有变化。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;其他智能合约的运行也是一样，无非就是函数多点，输入多点。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112202113?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;">&nbsp;</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>2、 在其他节点上运行智能合约</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 此时的智能合约只能自己能看到，别人是无法看到和运行的，如果其他人要运行你部署好的智能合约需要提供一些信息，就是其他教程中所说的智能合约的ABI和地址。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">进入刚部署的“<span style="color:rgb(64,64,64);">SimpleStorage</span>”智能合约界面，右侧有四个按钮</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">A．“Deposit Eher”：向该智能合约发送以太币</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">B.“Copy address”：拷贝该智能合约的地址</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">C．“Show QR Code”：显示一个二维码，如果用手机扫描的话，显示该智能合约的地址</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">D．“Show Interface”：显示该智能合约的JSON接口，也就是ABI</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 首先我们点“Copy address”，拷贝该智能合约的地址，然后点“Show Interface”将智能合约的JSON接口全部拷贝出来，在另一个需要运行智能合约的节点打开Ethereum-Wallet，打开“CONTRACTS”界面点击“WATCH CONTRACTS”添加一个智能合约。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112227538?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 如上图所示，CONTRACT NAME随便填，CONTRACT ADDRESS填写智能合约地址，JSON INTERFACE填写刚才在”Show Interface “中拷贝的内容。点OK后，就可以看到这个智能合约并运行了。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>十、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的部署原理</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><strong><span style="font-size:18px;">1、智能合约的部署架构</span></strong></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;本文介绍的智能合约的部署虽然是在图形化界面编译和执行，但其实最主要的是依赖于后台运行Geth的节点，此时Geth提供了一个RPC的接口向图形化界面的钱包提供区块链的信息。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><strong><span style="font-size:18px;">RPC接口</span></strong></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Geth在8545端口提供了JSON RPC API ，数据传输采用JSON格式，可以执行Web3库的各种命令，比如向前端，比如mist等图形化客户端提供区块链的信息，默认访问地址为<a href="http://localhost:8545/" rel="nofollow" style="color:rgb(12,137,207);">http://localhost:8545</a>。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 我们部署一个智能合约时，首先Ethereum-Wallet调用SOLC智能合约编译器将代码编译成成EVM字节码，然后将EVM字节码通过Geth的RPC接口发送到以太坊网络，经过全网验证后，同时写入到每个Geth管理的区块链中，架构如下</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);"><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112303552?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>2、 部署的数据流</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp;首先代码先经过SOLC编译变为了二进制码，然后通过一笔交易来创建智能合约，该笔交易包含了创建者账号、智能合约内容、智能合约的地址这几个关键信息，其中智能合约地址的生成是由创建者的账号和发送的交易数作为随机数输入，通过Kecca-256加密<a href="http://lib.csdn.net/base/datastructure" rel="nofollow" class="replace_word" title="算法与数据结构知识库" style="color:rgb(223,52,52);font-weight:bold;">算法</a>重新创建一个地址作为账号。</span></p>
  <div style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);">
   <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112419117?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br></span>
  </div>
  <span style="color:rgb(85,85,85);font-family:'microsoft yahei';line-height:35px;font-size:18px;background-color:rgb(255,255,255);">&nbsp; &nbsp; &nbsp; &nbsp;部署过程中，需要通过交易来部署，同时数据要存储到区块链上，这些需要使用到GAS。</span>
  <span style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"></span>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><strong><span style="font-size:18px;">交易（Transactions）</span></strong></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 一笔交易是一条消息，从一个账户发送到另一个账户。交易可以包含二进制数据（payload）和以太币。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户包含代码，该代码和输入数据会被执行。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 如果目标账户是零账户（账户地址是0），交易将创建一个新合约。正如上文所讲，这个智能合约地址不是零地址，而是由合约创建者的地址和该地址发出过的交易数量计算得到。创建合约交易的payload被当作EVM字节码执行。执行的输出做为合约代码被永久存储。这意味着，为了创建一个合约，你不需要向合约发送真正的合约代码，而是发送能够返回可执行代码的代码。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><strong><span style="font-size:18px;">Gas</span></strong></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 以太坊上的每笔交易都会被收取一定数量的gas，gas的目的是限制执行交易所需的工作量，同时为执行支付费用。当EVM执行智能合约时，gas将按照特定规则被逐渐消耗，其实GAS就是以太币的比较小的单位，如果以太币比作100元，那么GAS可以看作是1分钱。如果只有以太币，会有问题，以太币是需要大家买卖的，市场会有价格波动。可能会出现比特币这样的状况，一天跌50%涨50%。这个对计算的成本是不能接受的，例如今天做一个加法需要十块钱，明天做一个加法需要一百块钱。所以这里引入gas来解耦。把市场的波动和计算的开销来解耦，也就是说以太币和gas之间是有汇率的，以太币涨没关系，gas价格下降就可以了。它要保证我做同样的计算，消耗的法币是一致的。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; gas price（gas价格，以太币计）是由交易创建者设置的，发送账户需要预付的交易费用 = gas price * gas amount。 如果执行结束还有gas剩余，这些gas将被返还给发送账户。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 前文中曾经提到部署智能合约使用了0.00042个以太币，换算成gas就是<span style="color:rgb(51,51,51);">21000</span><span style="color:rgb(51,51,51);">个</span><span style="color:rgb(51,51,51);">gas</span>。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 无论执行到什么位置，一旦gas被耗尽（比如降为负值），将会触发一个out-of-gas异常。当前调用帧所做的所有状态修改都将被回滚。</span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;"><strong>十一、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智能合约的运行原理</strong></span></p>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 智能合约是部署在区块链的代码，区块链本身不能执行代码，代码的执行是在本地的EVM中，实际上，部署在区块链上代码是能够在本地产生原智能合约代码的代码，可以理解区块链为一个数据库，而客户端从数据库中读取了存储的运行代码，并在本地运行后，将结果写入到了区块链这个数据库中。</span></p>
  <div style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;text-align:center;background-color:rgb(255,255,255);">
   <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20160819112445523?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br></span>
  </div>
  <p style="color:rgb(85,85,85);font-family:'microsoft yahei';font-size:15px;line-height:35px;background-color:rgb(255,255,255);"><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp;本质上，以太坊的钱包也是智能合约的一个应用，以太坊搭建的是一个可供编写各种应用的平台。</span><span style="font-size:18px;">下一篇，将详细讲述智能合约的开发编写和调试方法</span></p>
  <br>
  <p style="color:rgb(69,69,69);background-color:rgb(255,255,255);"><span style="font-size:18px;"><br></span></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sinat_34070003/article/details/79089311,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sinat_34070003/article/details/79089311,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

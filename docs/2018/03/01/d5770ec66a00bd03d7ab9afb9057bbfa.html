<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊源码分析—go-ethereum之p2p通信分析（2） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊源码分析—go-ethereum之p2p通信分析（2）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为作者原创，如需转载请通知本人，并标明出处和作者。擅自转载的，保留追究其侵权的权利。golang群：570992072。qq 29185807 个人公众号：月牙寂道长 公众号微信号yueyajidaozhang https://blog.csdn.net/screscent/article/details/79416318 本文QQ空间链接： http://user.qzone.qq.com/29185807/blog/1519899372 本文csdn博客链接：http://blog.csdn.net/screscent/article/details/79416318 上一篇分析了p2p模块的初始化与start。 &nbsp;继续上一篇分析。 &nbsp; 先回顾下p2p的初始化 github.com/ethereum/go-ethereum/eth/backend.go中 函数 func&nbsp;New(config&nbsp;*Config) (*Ethereum,&nbsp;error) { &nbsp; 下面是start &nbsp; 那现在进入到p2p模块中 github.com/ethereum/go-ethereum/p2p/server.go中 在p2p模块中，大部分的数据是通过chan来进行传输的。以上有7个chan &nbsp; 上面是关键地方，两个入口。 下面分别介绍 &nbsp; Listen部分 继续跟踪 &nbsp; 这里面有slots，是用来做数量限制的。用了一个带缓冲区的chan，先讲token放进去，然后先取出token，接收一个链接，当链接ok了后，将token放回去。 很简单的chan的应用 那么逻辑还是很清晰的，我们继续跟踪 &nbsp; 这里面的东西就比较多了。一个一个来 先看下两个函数的原型doEncHandshake和doProtoHandshake 在 586 行， c&nbsp; := &amp; conn { fd :&nbsp; fd ,&nbsp; transport :&nbsp; srv . newTransport ( fd ) ,&nbsp; flags :&nbsp; flags ,&nbsp; cont :&nbsp; make ( chan&nbsp; error )} &nbsp; 我们看下srv的 然后我们回到 func&nbsp; ( srv&nbsp; * Server )&nbsp; Start () ( err&nbsp; error ) { &nbsp; &nbsp; 那么就知道了 github.com/ethereum/go-ethereum/p2p/rlpx.go中 &nbsp; 真正的处理函数在这里 github.com/ethereum/go-ethereum/p2p/rlpx.go &nbsp; github.com/ethereum/go-ethereum/p2p/rlpx.go &nbsp; 好的回到 func&nbsp; ( srv&nbsp; * Server )&nbsp; setupConn ( fd&nbsp; net . Conn ,&nbsp; flags&nbsp; connFlag ,&nbsp; dialDest&nbsp; * discover . Node ) { 中 github.com/ethereum/go-ethereum/p2p/server.go 我们看下 在函数 func&nbsp; ( srv&nbsp; * Server )&nbsp; setupConn ( fd&nbsp; net . Conn ,&nbsp; flags&nbsp; connFlag ,&nbsp; dialDest&nbsp; * discover . Node ) { &nbsp; &nbsp; if&nbsp; err&nbsp; :=&nbsp; srv . checkpoint ( c ,&nbsp; srv . posthandshake ) ;&nbsp; err&nbsp; !=&nbsp; nil&nbsp; { &nbsp; if&nbsp; err&nbsp; :=&nbsp; srv . checkpoint ( c ,&nbsp; srv . addpeer ) ;&nbsp; err&nbsp; !=&nbsp; nil&nbsp; { &nbsp; 分别传递的是两个 chan ， srv . posthandshak 和 srv . addpee &nbsp; &nbsp; &nbsp; 好的，到这里listen的处理就完了。下面我们看如何通过chan与run进行配合工作的。 &nbsp; github.com/ethereum/go-ethereum/p2p/server.go中 上面的重点到了，通过chan的传送，把数据传到run中，处理 上面才是重点。Addpeer。 github.com/ethereum/go-ethereum/p2p/peer.go 传入的参数，protocol是srv.Protocols。这个我们在第一篇文章中有说到。 &nbsp; 继续跟踪 github.com/ethereum/go-ethereum/p2p/server.go中 &nbsp; 继续 github.com/ethereum/go-ethereum/p2p/peer.go &nbsp; 重点三个地方，慢慢来看 很简单的读信息，然后进行处理 继续 上面的重点处理都在default中，这个就是最上层的入口 好的重点来了。跟踪进去，完了，好像看不懂 &nbsp; 重点是在p.running 我们回过头去看看 我们知道初始化peer的时候，传送的是srv.Protocols。这个在第一篇文章有介绍了， &nbsp; &nbsp; 回到 这个很简单，定时的pingpong &nbsp; 我们看看最初的run在哪里 github.com/ethereum/go-ethereum/eth/handler.go ProtocolManager初始化Protocols的时候 &nbsp; &nbsp; &nbsp; 龚浩华 月牙寂 道长 QQ 29185807 2018年03月01日 阅读更多" />
<meta property="og:description" content="版权声明：本文为作者原创，如需转载请通知本人，并标明出处和作者。擅自转载的，保留追究其侵权的权利。golang群：570992072。qq 29185807 个人公众号：月牙寂道长 公众号微信号yueyajidaozhang https://blog.csdn.net/screscent/article/details/79416318 本文QQ空间链接： http://user.qzone.qq.com/29185807/blog/1519899372 本文csdn博客链接：http://blog.csdn.net/screscent/article/details/79416318 上一篇分析了p2p模块的初始化与start。 &nbsp;继续上一篇分析。 &nbsp; 先回顾下p2p的初始化 github.com/ethereum/go-ethereum/eth/backend.go中 函数 func&nbsp;New(config&nbsp;*Config) (*Ethereum,&nbsp;error) { &nbsp; 下面是start &nbsp; 那现在进入到p2p模块中 github.com/ethereum/go-ethereum/p2p/server.go中 在p2p模块中，大部分的数据是通过chan来进行传输的。以上有7个chan &nbsp; 上面是关键地方，两个入口。 下面分别介绍 &nbsp; Listen部分 继续跟踪 &nbsp; 这里面有slots，是用来做数量限制的。用了一个带缓冲区的chan，先讲token放进去，然后先取出token，接收一个链接，当链接ok了后，将token放回去。 很简单的chan的应用 那么逻辑还是很清晰的，我们继续跟踪 &nbsp; 这里面的东西就比较多了。一个一个来 先看下两个函数的原型doEncHandshake和doProtoHandshake 在 586 行， c&nbsp; := &amp; conn { fd :&nbsp; fd ,&nbsp; transport :&nbsp; srv . newTransport ( fd ) ,&nbsp; flags :&nbsp; flags ,&nbsp; cont :&nbsp; make ( chan&nbsp; error )} &nbsp; 我们看下srv的 然后我们回到 func&nbsp; ( srv&nbsp; * Server )&nbsp; Start () ( err&nbsp; error ) { &nbsp; &nbsp; 那么就知道了 github.com/ethereum/go-ethereum/p2p/rlpx.go中 &nbsp; 真正的处理函数在这里 github.com/ethereum/go-ethereum/p2p/rlpx.go &nbsp; github.com/ethereum/go-ethereum/p2p/rlpx.go &nbsp; 好的回到 func&nbsp; ( srv&nbsp; * Server )&nbsp; setupConn ( fd&nbsp; net . Conn ,&nbsp; flags&nbsp; connFlag ,&nbsp; dialDest&nbsp; * discover . Node ) { 中 github.com/ethereum/go-ethereum/p2p/server.go 我们看下 在函数 func&nbsp; ( srv&nbsp; * Server )&nbsp; setupConn ( fd&nbsp; net . Conn ,&nbsp; flags&nbsp; connFlag ,&nbsp; dialDest&nbsp; * discover . Node ) { &nbsp; &nbsp; if&nbsp; err&nbsp; :=&nbsp; srv . checkpoint ( c ,&nbsp; srv . posthandshake ) ;&nbsp; err&nbsp; !=&nbsp; nil&nbsp; { &nbsp; if&nbsp; err&nbsp; :=&nbsp; srv . checkpoint ( c ,&nbsp; srv . addpeer ) ;&nbsp; err&nbsp; !=&nbsp; nil&nbsp; { &nbsp; 分别传递的是两个 chan ， srv . posthandshak 和 srv . addpee &nbsp; &nbsp; &nbsp; 好的，到这里listen的处理就完了。下面我们看如何通过chan与run进行配合工作的。 &nbsp; github.com/ethereum/go-ethereum/p2p/server.go中 上面的重点到了，通过chan的传送，把数据传到run中，处理 上面才是重点。Addpeer。 github.com/ethereum/go-ethereum/p2p/peer.go 传入的参数，protocol是srv.Protocols。这个我们在第一篇文章中有说到。 &nbsp; 继续跟踪 github.com/ethereum/go-ethereum/p2p/server.go中 &nbsp; 继续 github.com/ethereum/go-ethereum/p2p/peer.go &nbsp; 重点三个地方，慢慢来看 很简单的读信息，然后进行处理 继续 上面的重点处理都在default中，这个就是最上层的入口 好的重点来了。跟踪进去，完了，好像看不懂 &nbsp; 重点是在p.running 我们回过头去看看 我们知道初始化peer的时候，传送的是srv.Protocols。这个在第一篇文章有介绍了， &nbsp; &nbsp; 回到 这个很简单，定时的pingpong &nbsp; 我们看看最初的run在哪里 github.com/ethereum/go-ethereum/eth/handler.go ProtocolManager初始化Protocols的时候 &nbsp; &nbsp; &nbsp; 龚浩华 月牙寂 道长 QQ 29185807 2018年03月01日 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/01/d5770ec66a00bd03d7ab9afb9057bbfa.html" />
<meta property="og:url" content="https://mlh.app/2018/03/01/d5770ec66a00bd03d7ab9afb9057bbfa.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-01T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为作者原创，如需转载请通知本人，并标明出处和作者。擅自转载的，保留追究其侵权的权利。golang群：570992072。qq 29185807 个人公众号：月牙寂道长 公众号微信号yueyajidaozhang https://blog.csdn.net/screscent/article/details/79416318 本文QQ空间链接： http://user.qzone.qq.com/29185807/blog/1519899372 本文csdn博客链接：http://blog.csdn.net/screscent/article/details/79416318 上一篇分析了p2p模块的初始化与start。 &nbsp;继续上一篇分析。 &nbsp; 先回顾下p2p的初始化 github.com/ethereum/go-ethereum/eth/backend.go中 函数 func&nbsp;New(config&nbsp;*Config) (*Ethereum,&nbsp;error) { &nbsp; 下面是start &nbsp; 那现在进入到p2p模块中 github.com/ethereum/go-ethereum/p2p/server.go中 在p2p模块中，大部分的数据是通过chan来进行传输的。以上有7个chan &nbsp; 上面是关键地方，两个入口。 下面分别介绍 &nbsp; Listen部分 继续跟踪 &nbsp; 这里面有slots，是用来做数量限制的。用了一个带缓冲区的chan，先讲token放进去，然后先取出token，接收一个链接，当链接ok了后，将token放回去。 很简单的chan的应用 那么逻辑还是很清晰的，我们继续跟踪 &nbsp; 这里面的东西就比较多了。一个一个来 先看下两个函数的原型doEncHandshake和doProtoHandshake 在 586 行， c&nbsp; := &amp; conn { fd :&nbsp; fd ,&nbsp; transport :&nbsp; srv . newTransport ( fd ) ,&nbsp; flags :&nbsp; flags ,&nbsp; cont :&nbsp; make ( chan&nbsp; error )} &nbsp; 我们看下srv的 然后我们回到 func&nbsp; ( srv&nbsp; * Server )&nbsp; Start () ( err&nbsp; error ) { &nbsp; &nbsp; 那么就知道了 github.com/ethereum/go-ethereum/p2p/rlpx.go中 &nbsp; 真正的处理函数在这里 github.com/ethereum/go-ethereum/p2p/rlpx.go &nbsp; github.com/ethereum/go-ethereum/p2p/rlpx.go &nbsp; 好的回到 func&nbsp; ( srv&nbsp; * Server )&nbsp; setupConn ( fd&nbsp; net . Conn ,&nbsp; flags&nbsp; connFlag ,&nbsp; dialDest&nbsp; * discover . Node ) { 中 github.com/ethereum/go-ethereum/p2p/server.go 我们看下 在函数 func&nbsp; ( srv&nbsp; * Server )&nbsp; setupConn ( fd&nbsp; net . Conn ,&nbsp; flags&nbsp; connFlag ,&nbsp; dialDest&nbsp; * discover . Node ) { &nbsp; &nbsp; if&nbsp; err&nbsp; :=&nbsp; srv . checkpoint ( c ,&nbsp; srv . posthandshake ) ;&nbsp; err&nbsp; !=&nbsp; nil&nbsp; { &nbsp; if&nbsp; err&nbsp; :=&nbsp; srv . checkpoint ( c ,&nbsp; srv . addpeer ) ;&nbsp; err&nbsp; !=&nbsp; nil&nbsp; { &nbsp; 分别传递的是两个 chan ， srv . posthandshak 和 srv . addpee &nbsp; &nbsp; &nbsp; 好的，到这里listen的处理就完了。下面我们看如何通过chan与run进行配合工作的。 &nbsp; github.com/ethereum/go-ethereum/p2p/server.go中 上面的重点到了，通过chan的传送，把数据传到run中，处理 上面才是重点。Addpeer。 github.com/ethereum/go-ethereum/p2p/peer.go 传入的参数，protocol是srv.Protocols。这个我们在第一篇文章中有说到。 &nbsp; 继续跟踪 github.com/ethereum/go-ethereum/p2p/server.go中 &nbsp; 继续 github.com/ethereum/go-ethereum/p2p/peer.go &nbsp; 重点三个地方，慢慢来看 很简单的读信息，然后进行处理 继续 上面的重点处理都在default中，这个就是最上层的入口 好的重点来了。跟踪进去，完了，好像看不懂 &nbsp; 重点是在p.running 我们回过头去看看 我们知道初始化peer的时候，传送的是srv.Protocols。这个在第一篇文章有介绍了， &nbsp; &nbsp; 回到 这个很简单，定时的pingpong &nbsp; 我们看看最初的run在哪里 github.com/ethereum/go-ethereum/eth/handler.go ProtocolManager初始化Protocols的时候 &nbsp; &nbsp; &nbsp; 龚浩华 月牙寂 道长 QQ 29185807 2018年03月01日 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/01/d5770ec66a00bd03d7ab9afb9057bbfa.html","headline":"以太坊源码分析—go-ethereum之p2p通信分析（2）","dateModified":"2018-03-01T00:00:00+08:00","datePublished":"2018-03-01T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/01/d5770ec66a00bd03d7ab9afb9057bbfa.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊源码分析---go-ethereum之p2p通信分析（2）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为作者原创，如需转载请通知本人，并标明出处和作者。擅自转载的，保留追究其侵权的权利。golang群：570992072。qq 29185807 个人公众号：月牙寂道长 公众号微信号yueyajidaozhang https://blog.csdn.net/screscent/article/details/79416318 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e4c7a3727d.css"> 
 <div class="htmledit_views"> 
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">本文QQ空间链接：</span>
  <a href="http://user.qzone.qq.com/29185807/blog/1519899372" rel="nofollow" style="color:rgb(73,139,49);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">http://user.qzone.qq.com/29185807/blog/1519899372</a>
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p>本文csdn博客链接：<a href="http://blog.csdn.net/screscent/article/details/79416318" rel="nofollow">http://blog.csdn.net/screscent/article/details/79416318</a></p> 
  <p><br></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 上一篇分析了<span>p2p</span>模块的初始化与<span>start</span>。<span><br> &nbsp;</span>继续上一篇分析。<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 先回顾下<span>p2p</span>的初始化<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/eth/backend.go</span>中<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 函数<span></span></p> 
  <p align="left" style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>func&nbsp;</span><span style="font-size:10.5pt;">New</span><span style="font-size:10.5pt;">(</span><span style="font-size:10.5pt;">config&nbsp;</span><span style="font-size:10.5pt;">*</span><span style="font-size:10.5pt;">Config</span><span style="font-size:10.5pt;">) (*</span><span style="font-size:10.5pt;">Ethereum</span><span style="font-size:10.5pt;">,&nbsp;</span><span style="font-size:10.5pt;">error</span><span style="font-size:10.5pt;">) {</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190426101" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 下面是<span>start</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190449522" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 那现在进入到<span>p2p</span>模块中<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/server.go</span>中<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190511747" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 在<span>p2p</span>模块中，大部分的数据是通过<span>chan</span>来进行传输的。以上有<span>7</span>个<span>chan</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;<img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190536857" alt=""></span></p> 
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 上面是关键地方，两个入口。<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 下面分别介绍<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>Listen</span>部分<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190605384" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 继续跟踪<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190627469" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 这里面有<span>slots</span>，是用来做数量限制的。用了一个带缓冲区的<span>chan</span>，先讲<span>token</span>放进去，然后先取出<span>token</span>，接收一个链接，当链接<span>ok</span>了后，将<span>token</span>放回去。<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 很简单的<span>chan</span>的应用<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 那么逻辑还是很清晰的，我们继续跟踪<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190653934" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190715914" alt="">&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 这里面的东西就比较多了。一个一个来<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 先看下两个函数的原型<span>doEncHandshake</span>和<span>doProtoHandshake</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190735644" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">在</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">586</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">行，</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">c&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:= &amp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">conn</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">{</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">fd</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">fd</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">transport</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">newTransport</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">fd</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">flags</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">flags</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">cont</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">make</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"><span style="font-size:10.5pt;">chan&nbsp;</span></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">error</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)}</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 我们看下<span>srv</span>的<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190757458" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">然后我们回到</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"><span style="font-size:10.5pt;">func&nbsp;</span></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">*</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Server</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Start</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">() (</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">err&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">error</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">) {</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190829431" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 那么就知道了<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/rlpx.go</span>中<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190852049" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 真正的处理函数在这里<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/rlpx.go</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190916679" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/rlpx.go</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301190937499" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">好的回到</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"><span style="font-size:10.5pt;">func&nbsp;</span></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">*</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Server</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">setupConn</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">fd&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">net</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Conn</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">flags&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">connFlag</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">dialDest&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">*</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">discover</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Node</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">) {</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 中<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/server.go</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 我们看下<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191006625" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">在函数</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"><span style="font-size:10.5pt;">func&nbsp;</span></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">*</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Server</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">setupConn</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">fd&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">net</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Conn</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">flags&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">connFlag</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">dialDest&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">*</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">discover</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">Node</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">) {</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"><span style="font-size:10.5pt;">if&nbsp;</span></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">err&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:=&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">checkpoint</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">c</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">posthandshake</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">;&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">err&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">!=&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">nil&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">{</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"><span style="font-size:10.5pt;">if&nbsp;</span></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">err&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">:=&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">checkpoint</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">(</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">c</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">,&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">addpeer</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">)</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">;&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">err&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">!=&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">nil&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">{</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">分别传递的是两个</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">chan</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">，</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">posthandshak</span>
  <span style="font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;color:rgb(0,198,43);">和</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">srv</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">.</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">addpee</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;"></span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">&nbsp;</span>
  <span style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:10.5pt;">&nbsp;</span> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 好的，到这里<span>listen</span>的处理就完了。下面我们看如何通过<span>chan</span>与<span>run</span>进行配合工作的。<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/server.go</span>中<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191034393" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p><br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191106911" alt=""><br></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 上面的重点到了，通过<span>chan</span>的传送，把数据传到<span>run</span>中，处理<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191129235" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 上面才是重点。<span>Addpeer</span>。<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/peer.go</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191151933" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 传入的参数，<span>protocol</span>是<span>srv.Protocols</span>。这个我们在第一篇文章中有说到。<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 继续跟踪<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/server.go</span>中<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191211956" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 继续<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/p2p/peer.go</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191258368" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 重点三个地方，慢慢来看<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191321369" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 很简单的读信息，然后进行处理<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 继续<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191346321" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 上面的重点处理都在<span>default</span>中，这个就是最上层的入口<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 好的重点来了。跟踪进去，完了，好像看不懂<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191409909" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 重点是在<span>p.running</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 我们回过头去看看<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191430820" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 我们知道初始化<span>peer</span>的时候，传送的是<span>srv.Protocols</span>。这个在第一篇文章有介绍了，<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 回到<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191453124" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191514391" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 这个很简单，定时的<span>pingpong</span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191535611" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 我们看看最初的<span>run</span>在哪里<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>github.com/ethereum/go-ethereum/eth/handler.go</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>ProtocolManager</span>初始化<span>Protocols</span>的时候<span></span></p> 
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301191558667" alt="">
  <br style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;">
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>&nbsp;</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 龚浩华<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> 月牙寂 道长<span></span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>QQ 29185807</span></p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <span>2018</span>年<span>03</span>月<span>01</span>日</p> 
  <p style="color:rgb(84,84,84);font-family:punctuation, '微软雅黑', Tohoma;font-size:14px;"> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180319165054174" alt=""><br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/screscent/article/details/79416318,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/screscent/article/details/79416318,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

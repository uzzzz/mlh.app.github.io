<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊部署简单智能合约记录 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊部署简单智能合约记录" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="最近学习以太坊，以太坊最重要的就是部署合约，部署合约的方式有很多种，最常用的就是truffle框架，部署也比较方便，简单，但是我用truffle的 truffle test却一直超时..不懂为啥,这里记录下使用在线编译智能合约的步骤。 solidity在线编译地址 以太坊solidity在线编译地址 开始步骤 geth的搭建环境和构建私有连比较简单，csdn博客很多，自行看下就好了啦 1、启动两个console 第一个启动以太坊的console控制台,启动参数可参考如下 mygeth.exe --identity &quot;newEth&quot; --rpc --rpccorsdomain &quot;*&quot; --datadir &quot;%cd%\chain&quot; --port 30303 --rpcapi &quot;db,eth,net,web3&quot; --networkid 9999 console 大概是这样的 第二个 新开一个终端连接以太坊的console，参考命令 geth attach http://127.0.0.1:8545,通过geth attach来连接，后面就是ip和端口，默认端口是8545，可通过第一个启动进行自定义。 连接上之后大概是这样的 部署之前的准备 必须有一个账户，并且账户里面要有etc web3.js的API 创建账户命令 personal.newAccount(&#39;aaa111&#39;)单引号里面的是密码 查看账户命令 personal.listAccounts 查看默认挖矿的账号命令 web3.eth.coinbase 启动挖矿的命令 miner.start(1) 总的来说 就是部署合约的前提条件是你必须要有一个账户，并且账户里面要有钱（多点好），然后再部署合约的时候需要解锁账户，只有解锁了账户才能把合约部署上去 开发准备 下面这段代码是个很简单的智能合约代码 pragma solidity ^0.4.4; contract test { function multiply(uint a) returns(uint d){ return a * 6; } } 编译合约 把上述代码拷贝到solidity在线编译器上面进行编译，如下图 把代码拷贝到中间，然后点击Start to compile按钮，右边会出现警告，忽略没有关系，我们测试的很简单，编译完成之后，点开旁边的Details。大概的图是这样的，这里只截取了一小部分，具体的点开看一下里面的注释就知道了.. 开始部署合约 我们找到Detail中的WEB3DEPLOY段落，这个就说怎么用web3进行部署，下面有两个命令，我们一次执行下 var testContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); var test = testContract.new( { from: web3.eth.accounts[0], data: &#39;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&#39;, gas: &#39;4700000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !== &#39;undefined&#39;) { console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) 执行效果 &gt; var testContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); undefined &gt; var test = testContract.new( ... { ...... from: web3.eth.accounts[0], ...... data: &#39;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&#39;, ...... gas: &#39;4700000&#39; ...... }, function (e, contract){ ...... console.log(e, contract); ...... if (typeof contract.address !== &#39;undefined&#39;) { ......... console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); ......... } ...... }) Error: authentication needed: password or unlock undefined undefined &gt; 我们看到执行第二条命令的时候报错了，Error: authentication needed: password or unlock undefinedu,这是因为账户没有解锁，那我们就解锁下 &gt; personal.unlockAccount(eth.accounts[0],&quot;aaa111&quot;,1000000) true &gt; 返回true解锁成功，然后再执行上面命令中的第二条命令，这个时候就没有报错了,, 执行命令之后会出现这样的一段文字（出现这段文字的前提是你的第一个终端是在挖矿状态），address就是合约地址 Contract mined! address: 0xd26db0df7644ed6b1e46839273591bcd67cbcefd transactionHash: 0xde6570c862fff92f282fddf84901a0e376a3f972e7be8831eccbe2b2220a8e4a 调用合约 在第二个终端执行，引号里面的值就是合约的地址，这里定义了一个tt变量，然后通过tt调用方法multiply(),后面的call(3)大概就是调用的意思。 &gt; tt=eth.contract(test.abi).at(&quot;0xd26db0df7644ed6b1e46839273591bcd67cbcefd&quot;) &gt; tt.multiply.call(3) 18 这个合约我们写的是一个数字乘以6，3*6结果是18，测试就调用成功了。 补充说明 查看合约的字节码和abi bytecode在detail的BYTECODE框框里面，点击旁边的copy按钮可复制出来，json中的object就是字节码。 { &quot;linkReferences&quot;: {}, &quot;object&quot;: &quot;6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&quot;, &quot;opcodes&quot;: &quot;PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH2 0xF JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0xB1 DUP1 PUSH2 0x1D PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3F JUMPI PUSH1 0x0 CALLDATALOAD PUSH29 0x100000000000000000000000000000000000000000000000000000000 SWAP1 DIV PUSH4 0xFFFFFFFF AND DUP1 PUSH4 0xC6888FA1 EQ PUSH1 0x44 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0x62 PUSH1 0x4 DUP1 DUP1 CALLDATALOAD SWAP1 PUSH1 0x20 ADD SWAP1 SWAP2 SWAP1 POP POP PUSH1 0x78 JUMP JUMPDEST PUSH1 0x40 MLOAD DUP1 DUP3 DUP2 MSTORE PUSH1 0x20 ADD SWAP2 POP POP PUSH1 0x40 MLOAD DUP1 SWAP2 SUB SWAP1 RETURN JUMPDEST PUSH1 0x0 PUSH1 0x6 DUP3 MUL SWAP1 POP SWAP2 SWAP1 POP JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xbf 0xce BLOCKHASH PUSH20 0xE896A63A9888320F0D5D07C04954FDB3C0420F79 0xe3 OR SMOD DUP7 0xb0 DUP7 0xc9 SELFDESTRUCT STOP 0x29 &quot;, &quot;sourceMap&quot;: &quot;27:103:0:-;;;;;;;;;;;;;;;;;&quot; } abi在detail的ABI框框里面，点击旁边的copy按钮可复制出来，在remix的在线编译器中，看不到具体的abi的值，只能复制出来才能看到。案例的abi值大概是这样的 [{ &quot;constant&quot;: false, &quot;inputs&quot;: [{ &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;uint256&quot; }], &quot;name&quot;: &quot;multiply&quot;, &quot;outputs&quot;: [{ &quot;name&quot;: &quot;d&quot;, &quot;type&quot;: &quot;uint256&quot; }], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }] 预估手续费 bytecode=&quot;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&quot; 查看手续费命令 web3.eth.estimateGas({data: bytecode})//bytecode就是上面定义的（注意前面需要加0x） call的原因是因为multiply函数没有添加constant。 参考博客： http://www.8btc.com/ethereum-private-chain http://blog.csdn.net/u013096666/article/details/72765491 阅读更多" />
<meta property="og:description" content="最近学习以太坊，以太坊最重要的就是部署合约，部署合约的方式有很多种，最常用的就是truffle框架，部署也比较方便，简单，但是我用truffle的 truffle test却一直超时..不懂为啥,这里记录下使用在线编译智能合约的步骤。 solidity在线编译地址 以太坊solidity在线编译地址 开始步骤 geth的搭建环境和构建私有连比较简单，csdn博客很多，自行看下就好了啦 1、启动两个console 第一个启动以太坊的console控制台,启动参数可参考如下 mygeth.exe --identity &quot;newEth&quot; --rpc --rpccorsdomain &quot;*&quot; --datadir &quot;%cd%\chain&quot; --port 30303 --rpcapi &quot;db,eth,net,web3&quot; --networkid 9999 console 大概是这样的 第二个 新开一个终端连接以太坊的console，参考命令 geth attach http://127.0.0.1:8545,通过geth attach来连接，后面就是ip和端口，默认端口是8545，可通过第一个启动进行自定义。 连接上之后大概是这样的 部署之前的准备 必须有一个账户，并且账户里面要有etc web3.js的API 创建账户命令 personal.newAccount(&#39;aaa111&#39;)单引号里面的是密码 查看账户命令 personal.listAccounts 查看默认挖矿的账号命令 web3.eth.coinbase 启动挖矿的命令 miner.start(1) 总的来说 就是部署合约的前提条件是你必须要有一个账户，并且账户里面要有钱（多点好），然后再部署合约的时候需要解锁账户，只有解锁了账户才能把合约部署上去 开发准备 下面这段代码是个很简单的智能合约代码 pragma solidity ^0.4.4; contract test { function multiply(uint a) returns(uint d){ return a * 6; } } 编译合约 把上述代码拷贝到solidity在线编译器上面进行编译，如下图 把代码拷贝到中间，然后点击Start to compile按钮，右边会出现警告，忽略没有关系，我们测试的很简单，编译完成之后，点开旁边的Details。大概的图是这样的，这里只截取了一小部分，具体的点开看一下里面的注释就知道了.. 开始部署合约 我们找到Detail中的WEB3DEPLOY段落，这个就说怎么用web3进行部署，下面有两个命令，我们一次执行下 var testContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); var test = testContract.new( { from: web3.eth.accounts[0], data: &#39;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&#39;, gas: &#39;4700000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !== &#39;undefined&#39;) { console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) 执行效果 &gt; var testContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); undefined &gt; var test = testContract.new( ... { ...... from: web3.eth.accounts[0], ...... data: &#39;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&#39;, ...... gas: &#39;4700000&#39; ...... }, function (e, contract){ ...... console.log(e, contract); ...... if (typeof contract.address !== &#39;undefined&#39;) { ......... console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); ......... } ...... }) Error: authentication needed: password or unlock undefined undefined &gt; 我们看到执行第二条命令的时候报错了，Error: authentication needed: password or unlock undefinedu,这是因为账户没有解锁，那我们就解锁下 &gt; personal.unlockAccount(eth.accounts[0],&quot;aaa111&quot;,1000000) true &gt; 返回true解锁成功，然后再执行上面命令中的第二条命令，这个时候就没有报错了,, 执行命令之后会出现这样的一段文字（出现这段文字的前提是你的第一个终端是在挖矿状态），address就是合约地址 Contract mined! address: 0xd26db0df7644ed6b1e46839273591bcd67cbcefd transactionHash: 0xde6570c862fff92f282fddf84901a0e376a3f972e7be8831eccbe2b2220a8e4a 调用合约 在第二个终端执行，引号里面的值就是合约的地址，这里定义了一个tt变量，然后通过tt调用方法multiply(),后面的call(3)大概就是调用的意思。 &gt; tt=eth.contract(test.abi).at(&quot;0xd26db0df7644ed6b1e46839273591bcd67cbcefd&quot;) &gt; tt.multiply.call(3) 18 这个合约我们写的是一个数字乘以6，3*6结果是18，测试就调用成功了。 补充说明 查看合约的字节码和abi bytecode在detail的BYTECODE框框里面，点击旁边的copy按钮可复制出来，json中的object就是字节码。 { &quot;linkReferences&quot;: {}, &quot;object&quot;: &quot;6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&quot;, &quot;opcodes&quot;: &quot;PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH2 0xF JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0xB1 DUP1 PUSH2 0x1D PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3F JUMPI PUSH1 0x0 CALLDATALOAD PUSH29 0x100000000000000000000000000000000000000000000000000000000 SWAP1 DIV PUSH4 0xFFFFFFFF AND DUP1 PUSH4 0xC6888FA1 EQ PUSH1 0x44 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0x62 PUSH1 0x4 DUP1 DUP1 CALLDATALOAD SWAP1 PUSH1 0x20 ADD SWAP1 SWAP2 SWAP1 POP POP PUSH1 0x78 JUMP JUMPDEST PUSH1 0x40 MLOAD DUP1 DUP3 DUP2 MSTORE PUSH1 0x20 ADD SWAP2 POP POP PUSH1 0x40 MLOAD DUP1 SWAP2 SUB SWAP1 RETURN JUMPDEST PUSH1 0x0 PUSH1 0x6 DUP3 MUL SWAP1 POP SWAP2 SWAP1 POP JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xbf 0xce BLOCKHASH PUSH20 0xE896A63A9888320F0D5D07C04954FDB3C0420F79 0xe3 OR SMOD DUP7 0xb0 DUP7 0xc9 SELFDESTRUCT STOP 0x29 &quot;, &quot;sourceMap&quot;: &quot;27:103:0:-;;;;;;;;;;;;;;;;;&quot; } abi在detail的ABI框框里面，点击旁边的copy按钮可复制出来，在remix的在线编译器中，看不到具体的abi的值，只能复制出来才能看到。案例的abi值大概是这样的 [{ &quot;constant&quot;: false, &quot;inputs&quot;: [{ &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;uint256&quot; }], &quot;name&quot;: &quot;multiply&quot;, &quot;outputs&quot;: [{ &quot;name&quot;: &quot;d&quot;, &quot;type&quot;: &quot;uint256&quot; }], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }] 预估手续费 bytecode=&quot;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&quot; 查看手续费命令 web3.eth.estimateGas({data: bytecode})//bytecode就是上面定义的（注意前面需要加0x） call的原因是因为multiply函数没有添加constant。 参考博客： http://www.8btc.com/ethereum-private-chain http://blog.csdn.net/u013096666/article/details/72765491 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/20/8b703b32feb34f8b6719bb918eee033f.html" />
<meta property="og:url" content="https://mlh.app/2018/03/20/8b703b32feb34f8b6719bb918eee033f.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-20T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"最近学习以太坊，以太坊最重要的就是部署合约，部署合约的方式有很多种，最常用的就是truffle框架，部署也比较方便，简单，但是我用truffle的 truffle test却一直超时..不懂为啥,这里记录下使用在线编译智能合约的步骤。 solidity在线编译地址 以太坊solidity在线编译地址 开始步骤 geth的搭建环境和构建私有连比较简单，csdn博客很多，自行看下就好了啦 1、启动两个console 第一个启动以太坊的console控制台,启动参数可参考如下 mygeth.exe --identity &quot;newEth&quot; --rpc --rpccorsdomain &quot;*&quot; --datadir &quot;%cd%\\chain&quot; --port 30303 --rpcapi &quot;db,eth,net,web3&quot; --networkid 9999 console 大概是这样的 第二个 新开一个终端连接以太坊的console，参考命令 geth attach http://127.0.0.1:8545,通过geth attach来连接，后面就是ip和端口，默认端口是8545，可通过第一个启动进行自定义。 连接上之后大概是这样的 部署之前的准备 必须有一个账户，并且账户里面要有etc web3.js的API 创建账户命令 personal.newAccount(&#39;aaa111&#39;)单引号里面的是密码 查看账户命令 personal.listAccounts 查看默认挖矿的账号命令 web3.eth.coinbase 启动挖矿的命令 miner.start(1) 总的来说 就是部署合约的前提条件是你必须要有一个账户，并且账户里面要有钱（多点好），然后再部署合约的时候需要解锁账户，只有解锁了账户才能把合约部署上去 开发准备 下面这段代码是个很简单的智能合约代码 pragma solidity ^0.4.4; contract test { function multiply(uint a) returns(uint d){ return a * 6; } } 编译合约 把上述代码拷贝到solidity在线编译器上面进行编译，如下图 把代码拷贝到中间，然后点击Start to compile按钮，右边会出现警告，忽略没有关系，我们测试的很简单，编译完成之后，点开旁边的Details。大概的图是这样的，这里只截取了一小部分，具体的点开看一下里面的注释就知道了.. 开始部署合约 我们找到Detail中的WEB3DEPLOY段落，这个就说怎么用web3进行部署，下面有两个命令，我们一次执行下 var testContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); var test = testContract.new( { from: web3.eth.accounts[0], data: &#39;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&#39;, gas: &#39;4700000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !== &#39;undefined&#39;) { console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) 执行效果 &gt; var testContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); undefined &gt; var test = testContract.new( ... { ...... from: web3.eth.accounts[0], ...... data: &#39;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&#39;, ...... gas: &#39;4700000&#39; ...... }, function (e, contract){ ...... console.log(e, contract); ...... if (typeof contract.address !== &#39;undefined&#39;) { ......... console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); ......... } ...... }) Error: authentication needed: password or unlock undefined undefined &gt; 我们看到执行第二条命令的时候报错了，Error: authentication needed: password or unlock undefinedu,这是因为账户没有解锁，那我们就解锁下 &gt; personal.unlockAccount(eth.accounts[0],&quot;aaa111&quot;,1000000) true &gt; 返回true解锁成功，然后再执行上面命令中的第二条命令，这个时候就没有报错了,, 执行命令之后会出现这样的一段文字（出现这段文字的前提是你的第一个终端是在挖矿状态），address就是合约地址 Contract mined! address: 0xd26db0df7644ed6b1e46839273591bcd67cbcefd transactionHash: 0xde6570c862fff92f282fddf84901a0e376a3f972e7be8831eccbe2b2220a8e4a 调用合约 在第二个终端执行，引号里面的值就是合约的地址，这里定义了一个tt变量，然后通过tt调用方法multiply(),后面的call(3)大概就是调用的意思。 &gt; tt=eth.contract(test.abi).at(&quot;0xd26db0df7644ed6b1e46839273591bcd67cbcefd&quot;) &gt; tt.multiply.call(3) 18 这个合约我们写的是一个数字乘以6，3*6结果是18，测试就调用成功了。 补充说明 查看合约的字节码和abi bytecode在detail的BYTECODE框框里面，点击旁边的copy按钮可复制出来，json中的object就是字节码。 { &quot;linkReferences&quot;: {}, &quot;object&quot;: &quot;6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&quot;, &quot;opcodes&quot;: &quot;PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH2 0xF JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0xB1 DUP1 PUSH2 0x1D PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3F JUMPI PUSH1 0x0 CALLDATALOAD PUSH29 0x100000000000000000000000000000000000000000000000000000000 SWAP1 DIV PUSH4 0xFFFFFFFF AND DUP1 PUSH4 0xC6888FA1 EQ PUSH1 0x44 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0x62 PUSH1 0x4 DUP1 DUP1 CALLDATALOAD SWAP1 PUSH1 0x20 ADD SWAP1 SWAP2 SWAP1 POP POP PUSH1 0x78 JUMP JUMPDEST PUSH1 0x40 MLOAD DUP1 DUP3 DUP2 MSTORE PUSH1 0x20 ADD SWAP2 POP POP PUSH1 0x40 MLOAD DUP1 SWAP2 SUB SWAP1 RETURN JUMPDEST PUSH1 0x0 PUSH1 0x6 DUP3 MUL SWAP1 POP SWAP2 SWAP1 POP JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xbf 0xce BLOCKHASH PUSH20 0xE896A63A9888320F0D5D07C04954FDB3C0420F79 0xe3 OR SMOD DUP7 0xb0 DUP7 0xc9 SELFDESTRUCT STOP 0x29 &quot;, &quot;sourceMap&quot;: &quot;27:103:0:-;;;;;;;;;;;;;;;;;&quot; } abi在detail的ABI框框里面，点击旁边的copy按钮可复制出来，在remix的在线编译器中，看不到具体的abi的值，只能复制出来才能看到。案例的abi值大概是这样的 [{ &quot;constant&quot;: false, &quot;inputs&quot;: [{ &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;uint256&quot; }], &quot;name&quot;: &quot;multiply&quot;, &quot;outputs&quot;: [{ &quot;name&quot;: &quot;d&quot;, &quot;type&quot;: &quot;uint256&quot; }], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }] 预估手续费 bytecode=&quot;0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029&quot; 查看手续费命令 web3.eth.estimateGas({data: bytecode})//bytecode就是上面定义的（注意前面需要加0x） call的原因是因为multiply函数没有添加constant。 参考博客： http://www.8btc.com/ethereum-private-chain http://blog.csdn.net/u013096666/article/details/72765491 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/20/8b703b32feb34f8b6719bb918eee033f.html","headline":"以太坊部署简单智能合约记录","dateModified":"2018-03-20T00:00:00+08:00","datePublished":"2018-03-20T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/20/8b703b32feb34f8b6719bb918eee033f.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊部署简单智能合约记录</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <blockquote> 
   <p>最近学习以太坊，以太坊最重要的就是部署合约，部署合约的方式有很多种，最常用的就是truffle框架，部署也比较方便，简单，但是我用truffle的 truffle test却一直超时..不懂为啥,这里记录下使用在线编译智能合约的步骤。</p> 
  </blockquote> 
  <h4 id="solidity在线编译地址">solidity在线编译地址</h4> 
  <p><a href="https://remix.ethereum.org/" rel="nofollow">以太坊solidity在线编译地址</a></p> 
  <h4 id="开始步骤">开始步骤</h4> 
  <blockquote> 
   <p>geth的搭建环境和构建私有连比较简单，csdn博客很多，自行看下就好了啦</p> 
  </blockquote> 
  <h4 id="1启动两个console">1、启动两个console</h4> 
  <p>第一个启动以太坊的console控制台,启动参数可参考如下 <br> <code>mygeth.exe --identity "newEth" --rpc --rpccorsdomain "*" --datadir "%cd%\chain" --port 30303 --rpcapi "db,eth,net,web3" --networkid 9999 console</code> <br> 大概是这样的 <br> <img src="//img-blog.csdn.net/20180320112906633?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L3UwMTAzMTYxODg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="启动第一个console" title=""> <br> 第二个 新开一个终端连接以太坊的console，参考命令 <br> <code>geth attach http://127.0.0.1:8545</code>,通过geth attach来连接，后面就是ip和端口，默认端口是8545，可通过第一个启动进行自定义。 <br> 连接上之后大概是这样的 <br> <img src="//img-blog.csdn.net/20180320113003781?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L3UwMTAzMTYxODg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="第二个console通过geth attach 连接" title=""></p> 
  <h4 id="部署之前的准备">部署之前的准备</h4> 
  <p><strong>必须有一个账户，并且账户里面要有etc</strong> <br> <a href="https://ethereumbuilders.gitbooks.io/guide/content/en/ethereum_javascript_api.html" rel="nofollow">web3.js的API</a> <br> 创建账户命令 <br> <code>personal.newAccount('aaa111')</code>单引号里面的是密码 <br> 查看账户命令 <br> <code>personal.listAccounts</code> <br> 查看默认挖矿的账号命令 <br> <code>web3.eth.coinbase</code> <br> 启动挖矿的命令 <br> <code>miner.start(1)</code> <br> <strong>总的来说 就是部署合约的前提条件是你必须要有一个账户，并且账户里面要有钱（多点好），然后再部署合约的时候需要解锁账户，只有解锁了账户才能把合约部署上去</strong></p> 
  <h4 id="开发准备">开发准备</h4> 
  <p>下面这段代码是个很简单的智能合约代码</p> 
  <pre class="prettyprint"><code class=" hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.4</span>;
contract test { 
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span><span class="hljs-params">(uint a)</span> <span class="hljs-title">returns</span><span class="hljs-params">(uint d)</span>{</span>
        <span class="hljs-keyword">return</span> a * <span class="hljs-number">6</span>;
    }
}</code></pre> 
  <h5 id="编译合约">编译合约</h5> 
  <p>把上述代码拷贝到<a href="https://remix.ethereum.org" rel="nofollow">solidity在线编译器</a>上面进行编译，如下图 <br> <img src="//img-blog.csdn.net/2018032011413484?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L3UwMTAzMTYxODg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="编译图" title=""> <br> 把代码拷贝到中间，然后点击Start to compile按钮，右边会出现警告，忽略没有关系，我们测试的很简单，编译完成之后，点开旁边的Details。大概的图是这样的，这里只截取了一小部分，具体的点开看一下里面的注释就知道了.. <br> <img src="//img-blog.csdn.net/20180320114431575?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L3UwMTAzMTYxODg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="编译的结果图" title=""></p> 
  <h4 id="开始部署合约">开始部署合约</h4> 
  <p>我们找到Detail中的WEB3DEPLOY段落，这个就说怎么用web3进行部署，下面有两个命令，我们一次执行下</p> 
  <pre class="prettyprint"><code class=" hljs actionscript"><span class="hljs-keyword">var</span> testContract = web3.eth.contract([{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"a"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"multiply"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"d"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>}]);
<span class="hljs-keyword">var</span> test = testContract.<span class="hljs-keyword">new</span>(
   {
     from: web3.eth.accounts[<span class="hljs-number">0</span>], 
     data: <span class="hljs-string">'0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029'</span>, 
     gas: <span class="hljs-string">'4700000'</span>
   }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, contract)</span>{</span>
    console.log(e, contract);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> contract.address !== <span class="hljs-string">'undefined'</span>) {
         console.log(<span class="hljs-string">'Contract mined! address: '</span> + contract.address + <span class="hljs-string">' transactionHash: '</span> + contract.transactionHash);
    }
 })</code></pre> 
  <p><strong>执行效果</strong></p> 
  <pre class="prettyprint"><code class=" hljs coffeescript">&gt; <span class="hljs-reserved">var</span> testContract = web3.eth.contract([{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"a"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"multiply"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"d"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>}]);
<span class="hljs-literal">undefined</span>
&gt; <span class="hljs-reserved">var</span> test = testContract.<span class="hljs-keyword">new</span>(
...    {
......      <span class="hljs-attribute">from</span>: web3.eth.accounts[<span class="hljs-number">0</span>],
......      <span class="hljs-attribute">data</span>: <span class="hljs-string">'0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029'</span>,
......      <span class="hljs-attribute">gas</span>: <span class="hljs-string">'4700000'</span>
......    }, <span class="hljs-reserved">function</span> (e, contract){
......     <span class="hljs-built_in">console</span>.log(e, contract);
......     <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> contract.address !== <span class="hljs-string">'undefined'</span>) {
.........          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Contract mined! address: '</span> + contract.address + <span class="hljs-string">' transactionHash: '</span> + contract.transactionHash);
.........     }
......  })
<span class="hljs-attribute">Error</span>: authentication <span class="hljs-attribute">needed</span>: password <span class="hljs-keyword">or</span> unlock <span class="hljs-literal">undefined</span>
<span class="hljs-literal">undefined</span>
&gt;</code></pre> 
  <p>我们看到执行第二条命令的时候报错了，<code>Error: authentication needed: password or unlock undefinedu</code>,这是因为账户没有解锁，那我们就解锁下</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; personal<span class="hljs-preprocessor">.unlockAccount</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>],<span class="hljs-string">"aaa111"</span>,<span class="hljs-number">1000000</span>)
true
&gt;</code></pre> 
  <p>返回true解锁成功，然后再执行上面命令中的第二条命令，这个时候就没有报错了,,</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">执行命令之后会出现这样的一段文字（出现这段文字的前提是你的第一个终端是在挖矿状态），address就是合约地址
Contract mined! address: <span class="hljs-number">0xd26db0df7644ed6b1e46839273591bcd67cbcefd</span> 
<span class="hljs-label">transactionHash:</span> <span class="hljs-number">0xde6570c862fff92f282fddf84901a0e376a3f972e7be8831eccbe2b2220a8e4a</span></code></pre> 
  <h4 id="调用合约">调用合约</h4> 
  <p>在第二个终端执行，引号里面的值就是合约的地址，这里定义了一个tt变量，然后通过tt调用方法multiply(),后面的call(3)大概就是调用的意思。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; tt=eth<span class="hljs-preprocessor">.contract</span>(test<span class="hljs-preprocessor">.abi</span>)<span class="hljs-preprocessor">.at</span>(<span class="hljs-string">"0xd26db0df7644ed6b1e46839273591bcd67cbcefd"</span>)
&gt; tt<span class="hljs-preprocessor">.multiply</span><span class="hljs-preprocessor">.call</span>(<span class="hljs-number">3</span>)
<span class="hljs-number">18</span></code></pre> 
  <p>这个合约我们写的是一个数字乘以6，3*6结果是18，测试就调用成功了。</p> 
  <hr> 
  <h4 id="补充说明">补充说明</h4> 
  <p>查看合约的字节码和abi <br> bytecode在detail的BYTECODE框框里面，点击旁边的copy按钮可复制出来，json中的object就是字节码。</p> 
  <pre class="prettyprint"><code class=" hljs json">{
    "<span class="hljs-attribute">linkReferences</span>": <span class="hljs-value">{}</span>,
    "<span class="hljs-attribute">object</span>": <span class="hljs-value"><span class="hljs-string">"6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029"</span></span>,
    "<span class="hljs-attribute">opcodes</span>": <span class="hljs-value"><span class="hljs-string">"PUSH1 0x60 PUSH1 0x40 MSTORE CALLVALUE ISZERO PUSH2 0xF JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0xB1 DUP1 PUSH2 0x1D PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x60 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH1 0x3F JUMPI PUSH1 0x0 CALLDATALOAD PUSH29 0x100000000000000000000000000000000000000000000000000000000 SWAP1 DIV PUSH4 0xFFFFFFFF AND DUP1 PUSH4 0xC6888FA1 EQ PUSH1 0x44 JUMPI JUMPDEST PUSH1 0x0 DUP1 REVERT JUMPDEST CALLVALUE ISZERO PUSH1 0x4E JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST PUSH1 0x62 PUSH1 0x4 DUP1 DUP1 CALLDATALOAD SWAP1 PUSH1 0x20 ADD SWAP1 SWAP2 SWAP1 POP POP PUSH1 0x78 JUMP JUMPDEST PUSH1 0x40 MLOAD DUP1 DUP3 DUP2 MSTORE PUSH1 0x20 ADD SWAP2 POP POP PUSH1 0x40 MLOAD DUP1 SWAP2 SUB SWAP1 RETURN JUMPDEST PUSH1 0x0 PUSH1 0x6 DUP3 MUL SWAP1 POP SWAP2 SWAP1 POP JUMP STOP LOG1 PUSH6 0x627A7A723058 KECCAK256 0xbf 0xce BLOCKHASH PUSH20 0xE896A63A9888320F0D5D07C04954FDB3C0420F79 0xe3 OR SMOD DUP7 0xb0 DUP7 0xc9 SELFDESTRUCT STOP 0x29 "</span></span>,
    "<span class="hljs-attribute">sourceMap</span>": <span class="hljs-value"><span class="hljs-string">"27:103:0:-;;;;;;;;;;;;;;;;;"</span> </span>}</code></pre> 
  <p>abi在detail的ABI框框里面，点击旁边的copy按钮可复制出来，在remix的在线编译器中，看不到具体的abi的值，只能复制出来才能看到。案例的abi值大概是这样的</p> 
  <pre class="prettyprint"><code class=" hljs json">[{
    "<span class="hljs-attribute">constant</span>": <span class="hljs-value"><span class="hljs-literal">false</span></span>,
    "<span class="hljs-attribute">inputs</span>": <span class="hljs-value">[{ "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"a"</span></span>, "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"uint256"</span> </span>}]</span>,
    "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"multiply"</span></span>,
    "<span class="hljs-attribute">outputs</span>": <span class="hljs-value">[{ "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"d"</span></span>, "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"uint256"</span> </span>}]</span>,
    "<span class="hljs-attribute">payable</span>": <span class="hljs-value"><span class="hljs-literal">false</span></span>,
    "<span class="hljs-attribute">stateMutability</span>": <span class="hljs-value"><span class="hljs-string">"nonpayable"</span></span>,
    "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"function"</span> </span>}]</code></pre> 
  <p>预估手续费</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">bytecode</span>=<span class="hljs-string">"0x6060604052341561000f57600080fd5b60b18061001d6000396000f300606060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b3415604e57600080fd5b606260048080359060200190919050506078565b6040518082815260200191505060405180910390f35b60006006820290509190505600a165627a7a72305820bfce4073e896a63a9888320f0d5d07c04954fdb3c0420f79e3170786b086c9ff0029"</span>
查看手续费命令
<span class="hljs-title">web3</span>.eth.estimateGas({<span class="hljs-typedef"><span class="hljs-keyword">data</span>: bytecode})//bytecode就是上面定义的（注意前面需要加0x）</span></code></pre> 
  <blockquote> 
   <p>call的原因是因为multiply函数没有添加constant。 <br> 参考博客： <br> <a href="http://www.8btc.com/ethereum-private-chain" rel="nofollow">http://www.8btc.com/ethereum-private-chain</a> <br> <a href="http://blog.csdn.net/u013096666/article/details/72765491" rel="nofollow">http://blog.csdn.net/u013096666/article/details/72765491</a></p> 
  </blockquote> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/u010316188/article/details/79623144,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/u010316188/article/details/79623144,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

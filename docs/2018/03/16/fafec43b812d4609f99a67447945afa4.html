<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>各区块链底层数据存储分析 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="各区块链底层数据存储分析" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="互联网的中心化发展模式是传统网络安全的的软肋，区块链作为一种去中心化、集体维护、不可篡改的新兴技术，是对互联网底层架构的革新，是对当今生产力和生产关系的变革。区块链也被誉为是继蒸汽机、电力、信息和互联网科技之后，目前最有潜力触发第五轮颠覆性革命浪潮的核心技术。 目前市场上主流的区块链系统有比特币，Ripple，以太坊和 Hyperledger Fabric 。本文的主要目的就是分析当前主要流行的区块链的存储技术以及他们之间的不同。 区块链简介 区块链（英语：blockchain&nbsp;或&nbsp;block chain）是用分布式数据库识别、传播和记载信息的智能化对等网络,&nbsp;也称为价值互联网。中本聪于2008年在《比特币白皮书》中提出“区块链”概念，并在2009年创立了比特币社会网络，开发出第一个区块，即“创世区块”。区块链包含一张被称为区块的列表，有着持续增长并且排列整齐的记录。每个区块都包含一个时间戳和一个与前一区块的链接，这样设计区块链使得数据不可篡改，一旦记录下来，在一个区块中的数据将不可逆。 其数据结构大致如下： （区块链结构） 数据存储 比特币 比特币（英语：Bitcoin）是一种去中心化、全球通用、不需第三方机构或个人，基于区块链作为支付技术的电子加密货币。它由中本聪于2009年1月3日，基于无国界的对等网络，用共识主动性开源软件发明创立，是加密货币及区块链的始祖，也是目前知名度与市场总值最高的加密货币。 比特币存储系统由普通文件和 kv 数据库(levelDB)组成。普通文件用于存储区块链数据，kv 数据库用于存储区块链元数据。 用于存储区块链数据的普通文件以 blk00000.dat , blk00001.dat 文件名格式组成，如图2所示，其中 index 目录存储用于存储区块元数据。 （图2） 为了快速检索区块数据每个文件的大小是128 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 dat 文件中。 在序列化的过程中，如果检测到当前写入文件尺寸加上区块尺寸大于 128 M Bytes，则会重新生成一个 dat 文件。具体的序列化过程如下所述： •获取当前 dat 文件大小 npos，并将区块大小追加写入至 dat 文件中 •序列化区块数据和区块中的交易数据，并将序列化的数据追加至 dat 文件中。 •&nbsp;在写入数据的过程中，会生成区块和交易相关的元数据。 区块的元数据格式如 &lt;blockHash,xxxxx+npos&gt; 格式， 其中 xxxxx 为 dat 文件序号，npos 为区块写入 dat 文件的起始位置。 &nbsp;交易的元数据格式如 &lt;txHash, xxxxx+npos+nTxOffset&gt; 格式， 其中 xxxxx、npos 和上面的描述一致，nTxOffset 为写入 dat 文件的起始位置（基于npos 位置）。 上述所有元数据都将写入 kv 数据库中，其中 blockhash/txHash 将作为后续查询具体数据在 dat 文件中的索引使用。 综上所述，在获取链数据的时候只需传入区哈希或是交易哈希，就能很容易的定位到区块数据或是交易数据。 2瑞波币 Ripple 是世界上第一个开放的支付网络，通过这个支付网络可以转账任意一种货币，包括美元、欧元、人民币、日元或者比特币，简便易行快捷，交易确认在几秒以内完成，交易费用几乎是零，没有所谓的跨行异地以及跨国支付费用。 Ripple 的区块链数据存储系统是由关系型数据库(sqlite)和 kv 数据库组成，其中关系型数据库用来存储区块头信息和每笔交易的具体信息， kv 数据库主要存储区块头、交易和状态表序列化后的数据。 Ripple 这样处理的主要目的是单纯在查询区块头信息和具体每笔交易的时候，可以直接从关系型数据库中查找；而要构造整个区块数据的时候，除了从关系型数据库构造区块头信息外，还要依据区块头里的交易根哈希和状态表根哈希从 kv 数据库中获取具体的交易和状态表信息。这是 Ripple 和其他三种类型区块链系统唯一最大的不同。 区块头信息的序列化具体步骤： •用区块的哈希作为 Key； •序列化区块高度、区块哈希、前一个区块哈希、交易根哈希、状态表根哈希等生成的数据作为 value； •将 &lt;key, value&gt; 存储至 kv 数据库中。 交易的序列化具体步骤： •用区块头中的交易根哈希作为 Key； •序列化交易哈希、交易类型、交易数据和 MetaData 等生成的数据作为 value； •&nbsp;将 &lt;Key, value&gt; 存储至 kv 数据库中。 下表分别是 Ledgers 和 Transactions 表结构。 列名 类型 含义 LedgerHash CHARACTER 哈希值 LedgerSeq BIGINT UNSIGNED Ledger 序号 PrevHash CHARACTER 前个 Ledger 的 Hash 值 TotalCoins BIGINT UNSIGNED 当前网络上的 XR P总数（交易会销毁 XRP ） ClosingTime BIGINT UNSIGNED 关闭时间 PrevClosingTime BIGINT UNSIGNED 前一个区块的关闭时间 CloseTimeRes BIGINT UNSIGNED ledger 关闭时间的解决方案（2-120 S） CloseFlags BIGINT UNSIGNED 标识 ledger 的关闭方式，一般都是0 AccountSetHash CHARACTER stateMap 根结点 hash TransSetHash CHARACTER txMap 根节点哈希 （表1：Ledgers ） 列名 类型 含义 TransID CHARACTER 交易 hash TransType CHARACTER 交易类型 FromAcct CHARACTER 交易的发起账户 FromSeq BIGINT UNSIGNED 交易在账户中的序号 LedgerSeq BIGINT UNSIGNED 交易落在哪个区块上 Status CHARACTER 交易的状态 V 表示“共识过” RawTxn BLOB 交易序列化数据 TxnMeta BLOB 交易 metaData 的序列化数据 （表2：Transactions ）3以太坊 以太坊是一个开源的有智能合约功能的公共区块链平台。通过其专用加密货币以太币（Ether，又称为「以太币」）提供去中心化的虚拟机（称为「以太虚拟机」Ethereum Virtual Machine）来处理点对点合约。 以太坊的区块主要由区块头和交易组成，区块在存储的过程中分别将区块头和交易体经过 RLP 编码后存入至 KV 数据当中。以太坊在数据存储的过程中，每个 value 对应的key 都有相对应的前缀，不同类型的 value 对应不同的前缀。 区块交易体的存储过程如下： 1. 将区块中的交易数据和叔块头信息进行 RLP 编码从而生成存储值 value； 2. 将数据类型前缀，编码后的区块高度和区块哈希拼接生成 key； 3. 将 &lt;key, value&gt; 存储至 db 数据库中。 区块的信息可以通过区块哈希和区块高度进行检索，其存储过程如下： 1. 将区块头信息进行 RLP 编码从而生成存储值 value 2. 将区块高度进行编码(转发成大端格式数据)生成 encNum 3. 将数据类型前缀 (headerPrefix) 和 encNum 生成以区块高度为检索信息的 key 4. 将 &lt;key, value&gt; 存储至 db 数据库中，从而生成以区块高度为检索的信息 5. 将数据类型前缀 (blockHashPrefix) 和区块哈希生成以区块哈希为检索信息的 key 6. 将 &lt;key, value&gt; 存储至 db 数据库中，从生成区块哈希为检索的信息 &nbsp; 在数据查询的时候，应用层只需要提供交易 hash、区块高度和区块哈希就能得到交易 key，从而查询到相关的交易信息。 4Hyperledger Fabric Hyperledger fabric （HLF）是由Linux基金会主导推广的区块链开源项目。在Hyperledger Fabric的基础上又衍生出了其他一些相关的项目。HyperLedger项目汇集了金融、银行、物联网、供应链、制造等各界开发人员的心血。目的是为了打造一个跨领域的区块链应用。 HLF 的存储系统和比特币一样，也是由普通的文件和 kv 的数据库（levelDB/couchDB）组成。在 HLF 中，每个 channel 对应一个账本目录，在账本目录中由 blockfile_000000、blockfile_000001 命名格式的文件名组成。为了快速检索区块数据每个文件的大小是64 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 blockfile 文件中。 HLF 存储区块数据的文件名格式如图所示： HLF 检索信息文件如图所示： 在序列化的过程中，程序以 append 方式打开 blockfile 文件，然后将区块大小和和区块数据写入至 blockfile 文件中。 以下是区块数据写入的具体描述： 1. 写入区块头数据，依次写入的数据为区块高度、交易哈希和前一个区块哈希； 2. 写入交易数据，依次写入的数据为区块包含交易总量和每笔交易详细数据； 3. 写入区块的 Metadata 数据，依次写入的数据为 Metadata 数据总量和每个 Metadata 项的数据详细信息。 在写入数据的过程中会以 kv 的形式保存区块和交易在 blockfile 文件中的索引信息，以方便 HLF 的快速查询。 HLF 区块索引信息格式在 kv 数据库中存储的最终的 LevelKey 值有前缀标志和区块 hash 组成，而 LevelValue 的值由区块高度，区块 hash，本地文件信息(文件名，文件偏移等信息)，每个交易在文件中的偏移列表和区块的 MetaData 组成， HLF 按照特定的编码方式将上述的信息拼接成 db 数据库中的 value 。 HLF 交易索引信息格式在 kv 数据库中存储最终的 LevelKey 值由channel_name，chaincode_name 和 chaincode 中的 key 值组合而成： LevelKey = &nbsp;channel_name + []byte{0x00} + chaincode_name + []byte{0x00} + key 而 LevelValue 的值由BlockNum 区块号，TxNum 交易在区块中的编号组成， HLF 通过将区块号和交易编号按照特定的方式编码，然后与 chaincode 中的 value 相互拼接最终生成 db 数据库中的 value 。 总结 综上所述，本文介绍的主要区块链除了 Ripple 使用的关系型数据库存储、检索区块数据外，其他三种类型的区块链都使用 kv 数据库存储区块链的检索信息。在存储、检索数据上，比特币和 Hyperledger Fabric 高度一致，即使用普通文件存储区块数据，使用 kv 数据库存储检索信息；以太坊的区块数据和检索信息都存储至 kv 数据库中，而 Ripple 的区块数据也会存储至 kv 数据库中。欢迎加入 区块链-瑞波开发专业讨论QQ群 731800148 阅读更多" />
<meta property="og:description" content="互联网的中心化发展模式是传统网络安全的的软肋，区块链作为一种去中心化、集体维护、不可篡改的新兴技术，是对互联网底层架构的革新，是对当今生产力和生产关系的变革。区块链也被誉为是继蒸汽机、电力、信息和互联网科技之后，目前最有潜力触发第五轮颠覆性革命浪潮的核心技术。 目前市场上主流的区块链系统有比特币，Ripple，以太坊和 Hyperledger Fabric 。本文的主要目的就是分析当前主要流行的区块链的存储技术以及他们之间的不同。 区块链简介 区块链（英语：blockchain&nbsp;或&nbsp;block chain）是用分布式数据库识别、传播和记载信息的智能化对等网络,&nbsp;也称为价值互联网。中本聪于2008年在《比特币白皮书》中提出“区块链”概念，并在2009年创立了比特币社会网络，开发出第一个区块，即“创世区块”。区块链包含一张被称为区块的列表，有着持续增长并且排列整齐的记录。每个区块都包含一个时间戳和一个与前一区块的链接，这样设计区块链使得数据不可篡改，一旦记录下来，在一个区块中的数据将不可逆。 其数据结构大致如下： （区块链结构） 数据存储 比特币 比特币（英语：Bitcoin）是一种去中心化、全球通用、不需第三方机构或个人，基于区块链作为支付技术的电子加密货币。它由中本聪于2009年1月3日，基于无国界的对等网络，用共识主动性开源软件发明创立，是加密货币及区块链的始祖，也是目前知名度与市场总值最高的加密货币。 比特币存储系统由普通文件和 kv 数据库(levelDB)组成。普通文件用于存储区块链数据，kv 数据库用于存储区块链元数据。 用于存储区块链数据的普通文件以 blk00000.dat , blk00001.dat 文件名格式组成，如图2所示，其中 index 目录存储用于存储区块元数据。 （图2） 为了快速检索区块数据每个文件的大小是128 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 dat 文件中。 在序列化的过程中，如果检测到当前写入文件尺寸加上区块尺寸大于 128 M Bytes，则会重新生成一个 dat 文件。具体的序列化过程如下所述： •获取当前 dat 文件大小 npos，并将区块大小追加写入至 dat 文件中 •序列化区块数据和区块中的交易数据，并将序列化的数据追加至 dat 文件中。 •&nbsp;在写入数据的过程中，会生成区块和交易相关的元数据。 区块的元数据格式如 &lt;blockHash,xxxxx+npos&gt; 格式， 其中 xxxxx 为 dat 文件序号，npos 为区块写入 dat 文件的起始位置。 &nbsp;交易的元数据格式如 &lt;txHash, xxxxx+npos+nTxOffset&gt; 格式， 其中 xxxxx、npos 和上面的描述一致，nTxOffset 为写入 dat 文件的起始位置（基于npos 位置）。 上述所有元数据都将写入 kv 数据库中，其中 blockhash/txHash 将作为后续查询具体数据在 dat 文件中的索引使用。 综上所述，在获取链数据的时候只需传入区哈希或是交易哈希，就能很容易的定位到区块数据或是交易数据。 2瑞波币 Ripple 是世界上第一个开放的支付网络，通过这个支付网络可以转账任意一种货币，包括美元、欧元、人民币、日元或者比特币，简便易行快捷，交易确认在几秒以内完成，交易费用几乎是零，没有所谓的跨行异地以及跨国支付费用。 Ripple 的区块链数据存储系统是由关系型数据库(sqlite)和 kv 数据库组成，其中关系型数据库用来存储区块头信息和每笔交易的具体信息， kv 数据库主要存储区块头、交易和状态表序列化后的数据。 Ripple 这样处理的主要目的是单纯在查询区块头信息和具体每笔交易的时候，可以直接从关系型数据库中查找；而要构造整个区块数据的时候，除了从关系型数据库构造区块头信息外，还要依据区块头里的交易根哈希和状态表根哈希从 kv 数据库中获取具体的交易和状态表信息。这是 Ripple 和其他三种类型区块链系统唯一最大的不同。 区块头信息的序列化具体步骤： •用区块的哈希作为 Key； •序列化区块高度、区块哈希、前一个区块哈希、交易根哈希、状态表根哈希等生成的数据作为 value； •将 &lt;key, value&gt; 存储至 kv 数据库中。 交易的序列化具体步骤： •用区块头中的交易根哈希作为 Key； •序列化交易哈希、交易类型、交易数据和 MetaData 等生成的数据作为 value； •&nbsp;将 &lt;Key, value&gt; 存储至 kv 数据库中。 下表分别是 Ledgers 和 Transactions 表结构。 列名 类型 含义 LedgerHash CHARACTER 哈希值 LedgerSeq BIGINT UNSIGNED Ledger 序号 PrevHash CHARACTER 前个 Ledger 的 Hash 值 TotalCoins BIGINT UNSIGNED 当前网络上的 XR P总数（交易会销毁 XRP ） ClosingTime BIGINT UNSIGNED 关闭时间 PrevClosingTime BIGINT UNSIGNED 前一个区块的关闭时间 CloseTimeRes BIGINT UNSIGNED ledger 关闭时间的解决方案（2-120 S） CloseFlags BIGINT UNSIGNED 标识 ledger 的关闭方式，一般都是0 AccountSetHash CHARACTER stateMap 根结点 hash TransSetHash CHARACTER txMap 根节点哈希 （表1：Ledgers ） 列名 类型 含义 TransID CHARACTER 交易 hash TransType CHARACTER 交易类型 FromAcct CHARACTER 交易的发起账户 FromSeq BIGINT UNSIGNED 交易在账户中的序号 LedgerSeq BIGINT UNSIGNED 交易落在哪个区块上 Status CHARACTER 交易的状态 V 表示“共识过” RawTxn BLOB 交易序列化数据 TxnMeta BLOB 交易 metaData 的序列化数据 （表2：Transactions ）3以太坊 以太坊是一个开源的有智能合约功能的公共区块链平台。通过其专用加密货币以太币（Ether，又称为「以太币」）提供去中心化的虚拟机（称为「以太虚拟机」Ethereum Virtual Machine）来处理点对点合约。 以太坊的区块主要由区块头和交易组成，区块在存储的过程中分别将区块头和交易体经过 RLP 编码后存入至 KV 数据当中。以太坊在数据存储的过程中，每个 value 对应的key 都有相对应的前缀，不同类型的 value 对应不同的前缀。 区块交易体的存储过程如下： 1. 将区块中的交易数据和叔块头信息进行 RLP 编码从而生成存储值 value； 2. 将数据类型前缀，编码后的区块高度和区块哈希拼接生成 key； 3. 将 &lt;key, value&gt; 存储至 db 数据库中。 区块的信息可以通过区块哈希和区块高度进行检索，其存储过程如下： 1. 将区块头信息进行 RLP 编码从而生成存储值 value 2. 将区块高度进行编码(转发成大端格式数据)生成 encNum 3. 将数据类型前缀 (headerPrefix) 和 encNum 生成以区块高度为检索信息的 key 4. 将 &lt;key, value&gt; 存储至 db 数据库中，从而生成以区块高度为检索的信息 5. 将数据类型前缀 (blockHashPrefix) 和区块哈希生成以区块哈希为检索信息的 key 6. 将 &lt;key, value&gt; 存储至 db 数据库中，从生成区块哈希为检索的信息 &nbsp; 在数据查询的时候，应用层只需要提供交易 hash、区块高度和区块哈希就能得到交易 key，从而查询到相关的交易信息。 4Hyperledger Fabric Hyperledger fabric （HLF）是由Linux基金会主导推广的区块链开源项目。在Hyperledger Fabric的基础上又衍生出了其他一些相关的项目。HyperLedger项目汇集了金融、银行、物联网、供应链、制造等各界开发人员的心血。目的是为了打造一个跨领域的区块链应用。 HLF 的存储系统和比特币一样，也是由普通的文件和 kv 的数据库（levelDB/couchDB）组成。在 HLF 中，每个 channel 对应一个账本目录，在账本目录中由 blockfile_000000、blockfile_000001 命名格式的文件名组成。为了快速检索区块数据每个文件的大小是64 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 blockfile 文件中。 HLF 存储区块数据的文件名格式如图所示： HLF 检索信息文件如图所示： 在序列化的过程中，程序以 append 方式打开 blockfile 文件，然后将区块大小和和区块数据写入至 blockfile 文件中。 以下是区块数据写入的具体描述： 1. 写入区块头数据，依次写入的数据为区块高度、交易哈希和前一个区块哈希； 2. 写入交易数据，依次写入的数据为区块包含交易总量和每笔交易详细数据； 3. 写入区块的 Metadata 数据，依次写入的数据为 Metadata 数据总量和每个 Metadata 项的数据详细信息。 在写入数据的过程中会以 kv 的形式保存区块和交易在 blockfile 文件中的索引信息，以方便 HLF 的快速查询。 HLF 区块索引信息格式在 kv 数据库中存储的最终的 LevelKey 值有前缀标志和区块 hash 组成，而 LevelValue 的值由区块高度，区块 hash，本地文件信息(文件名，文件偏移等信息)，每个交易在文件中的偏移列表和区块的 MetaData 组成， HLF 按照特定的编码方式将上述的信息拼接成 db 数据库中的 value 。 HLF 交易索引信息格式在 kv 数据库中存储最终的 LevelKey 值由channel_name，chaincode_name 和 chaincode 中的 key 值组合而成： LevelKey = &nbsp;channel_name + []byte{0x00} + chaincode_name + []byte{0x00} + key 而 LevelValue 的值由BlockNum 区块号，TxNum 交易在区块中的编号组成， HLF 通过将区块号和交易编号按照特定的方式编码，然后与 chaincode 中的 value 相互拼接最终生成 db 数据库中的 value 。 总结 综上所述，本文介绍的主要区块链除了 Ripple 使用的关系型数据库存储、检索区块数据外，其他三种类型的区块链都使用 kv 数据库存储区块链的检索信息。在存储、检索数据上，比特币和 Hyperledger Fabric 高度一致，即使用普通文件存储区块数据，使用 kv 数据库存储检索信息；以太坊的区块数据和检索信息都存储至 kv 数据库中，而 Ripple 的区块数据也会存储至 kv 数据库中。欢迎加入 区块链-瑞波开发专业讨论QQ群 731800148 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/16/fafec43b812d4609f99a67447945afa4.html" />
<meta property="og:url" content="https://mlh.app/2018/03/16/fafec43b812d4609f99a67447945afa4.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"互联网的中心化发展模式是传统网络安全的的软肋，区块链作为一种去中心化、集体维护、不可篡改的新兴技术，是对互联网底层架构的革新，是对当今生产力和生产关系的变革。区块链也被誉为是继蒸汽机、电力、信息和互联网科技之后，目前最有潜力触发第五轮颠覆性革命浪潮的核心技术。 目前市场上主流的区块链系统有比特币，Ripple，以太坊和 Hyperledger Fabric 。本文的主要目的就是分析当前主要流行的区块链的存储技术以及他们之间的不同。 区块链简介 区块链（英语：blockchain&nbsp;或&nbsp;block chain）是用分布式数据库识别、传播和记载信息的智能化对等网络,&nbsp;也称为价值互联网。中本聪于2008年在《比特币白皮书》中提出“区块链”概念，并在2009年创立了比特币社会网络，开发出第一个区块，即“创世区块”。区块链包含一张被称为区块的列表，有着持续增长并且排列整齐的记录。每个区块都包含一个时间戳和一个与前一区块的链接，这样设计区块链使得数据不可篡改，一旦记录下来，在一个区块中的数据将不可逆。 其数据结构大致如下： （区块链结构） 数据存储 比特币 比特币（英语：Bitcoin）是一种去中心化、全球通用、不需第三方机构或个人，基于区块链作为支付技术的电子加密货币。它由中本聪于2009年1月3日，基于无国界的对等网络，用共识主动性开源软件发明创立，是加密货币及区块链的始祖，也是目前知名度与市场总值最高的加密货币。 比特币存储系统由普通文件和 kv 数据库(levelDB)组成。普通文件用于存储区块链数据，kv 数据库用于存储区块链元数据。 用于存储区块链数据的普通文件以 blk00000.dat , blk00001.dat 文件名格式组成，如图2所示，其中 index 目录存储用于存储区块元数据。 （图2） 为了快速检索区块数据每个文件的大小是128 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 dat 文件中。 在序列化的过程中，如果检测到当前写入文件尺寸加上区块尺寸大于 128 M Bytes，则会重新生成一个 dat 文件。具体的序列化过程如下所述： •获取当前 dat 文件大小 npos，并将区块大小追加写入至 dat 文件中 •序列化区块数据和区块中的交易数据，并将序列化的数据追加至 dat 文件中。 •&nbsp;在写入数据的过程中，会生成区块和交易相关的元数据。 区块的元数据格式如 &lt;blockHash,xxxxx+npos&gt; 格式， 其中 xxxxx 为 dat 文件序号，npos 为区块写入 dat 文件的起始位置。 &nbsp;交易的元数据格式如 &lt;txHash, xxxxx+npos+nTxOffset&gt; 格式， 其中 xxxxx、npos 和上面的描述一致，nTxOffset 为写入 dat 文件的起始位置（基于npos 位置）。 上述所有元数据都将写入 kv 数据库中，其中 blockhash/txHash 将作为后续查询具体数据在 dat 文件中的索引使用。 综上所述，在获取链数据的时候只需传入区哈希或是交易哈希，就能很容易的定位到区块数据或是交易数据。 2瑞波币 Ripple 是世界上第一个开放的支付网络，通过这个支付网络可以转账任意一种货币，包括美元、欧元、人民币、日元或者比特币，简便易行快捷，交易确认在几秒以内完成，交易费用几乎是零，没有所谓的跨行异地以及跨国支付费用。 Ripple 的区块链数据存储系统是由关系型数据库(sqlite)和 kv 数据库组成，其中关系型数据库用来存储区块头信息和每笔交易的具体信息， kv 数据库主要存储区块头、交易和状态表序列化后的数据。 Ripple 这样处理的主要目的是单纯在查询区块头信息和具体每笔交易的时候，可以直接从关系型数据库中查找；而要构造整个区块数据的时候，除了从关系型数据库构造区块头信息外，还要依据区块头里的交易根哈希和状态表根哈希从 kv 数据库中获取具体的交易和状态表信息。这是 Ripple 和其他三种类型区块链系统唯一最大的不同。 区块头信息的序列化具体步骤： •用区块的哈希作为 Key； •序列化区块高度、区块哈希、前一个区块哈希、交易根哈希、状态表根哈希等生成的数据作为 value； •将 &lt;key, value&gt; 存储至 kv 数据库中。 交易的序列化具体步骤： •用区块头中的交易根哈希作为 Key； •序列化交易哈希、交易类型、交易数据和 MetaData 等生成的数据作为 value； •&nbsp;将 &lt;Key, value&gt; 存储至 kv 数据库中。 下表分别是 Ledgers 和 Transactions 表结构。 列名 类型 含义 LedgerHash CHARACTER 哈希值 LedgerSeq BIGINT UNSIGNED Ledger 序号 PrevHash CHARACTER 前个 Ledger 的 Hash 值 TotalCoins BIGINT UNSIGNED 当前网络上的 XR P总数（交易会销毁 XRP ） ClosingTime BIGINT UNSIGNED 关闭时间 PrevClosingTime BIGINT UNSIGNED 前一个区块的关闭时间 CloseTimeRes BIGINT UNSIGNED ledger 关闭时间的解决方案（2-120 S） CloseFlags BIGINT UNSIGNED 标识 ledger 的关闭方式，一般都是0 AccountSetHash CHARACTER stateMap 根结点 hash TransSetHash CHARACTER txMap 根节点哈希 （表1：Ledgers ） 列名 类型 含义 TransID CHARACTER 交易 hash TransType CHARACTER 交易类型 FromAcct CHARACTER 交易的发起账户 FromSeq BIGINT UNSIGNED 交易在账户中的序号 LedgerSeq BIGINT UNSIGNED 交易落在哪个区块上 Status CHARACTER 交易的状态 V 表示“共识过” RawTxn BLOB 交易序列化数据 TxnMeta BLOB 交易 metaData 的序列化数据 （表2：Transactions ）3以太坊 以太坊是一个开源的有智能合约功能的公共区块链平台。通过其专用加密货币以太币（Ether，又称为「以太币」）提供去中心化的虚拟机（称为「以太虚拟机」Ethereum Virtual Machine）来处理点对点合约。 以太坊的区块主要由区块头和交易组成，区块在存储的过程中分别将区块头和交易体经过 RLP 编码后存入至 KV 数据当中。以太坊在数据存储的过程中，每个 value 对应的key 都有相对应的前缀，不同类型的 value 对应不同的前缀。 区块交易体的存储过程如下： 1. 将区块中的交易数据和叔块头信息进行 RLP 编码从而生成存储值 value； 2. 将数据类型前缀，编码后的区块高度和区块哈希拼接生成 key； 3. 将 &lt;key, value&gt; 存储至 db 数据库中。 区块的信息可以通过区块哈希和区块高度进行检索，其存储过程如下： 1. 将区块头信息进行 RLP 编码从而生成存储值 value 2. 将区块高度进行编码(转发成大端格式数据)生成 encNum 3. 将数据类型前缀 (headerPrefix) 和 encNum 生成以区块高度为检索信息的 key 4. 将 &lt;key, value&gt; 存储至 db 数据库中，从而生成以区块高度为检索的信息 5. 将数据类型前缀 (blockHashPrefix) 和区块哈希生成以区块哈希为检索信息的 key 6. 将 &lt;key, value&gt; 存储至 db 数据库中，从生成区块哈希为检索的信息 &nbsp; 在数据查询的时候，应用层只需要提供交易 hash、区块高度和区块哈希就能得到交易 key，从而查询到相关的交易信息。 4Hyperledger Fabric Hyperledger fabric （HLF）是由Linux基金会主导推广的区块链开源项目。在Hyperledger Fabric的基础上又衍生出了其他一些相关的项目。HyperLedger项目汇集了金融、银行、物联网、供应链、制造等各界开发人员的心血。目的是为了打造一个跨领域的区块链应用。 HLF 的存储系统和比特币一样，也是由普通的文件和 kv 的数据库（levelDB/couchDB）组成。在 HLF 中，每个 channel 对应一个账本目录，在账本目录中由 blockfile_000000、blockfile_000001 命名格式的文件名组成。为了快速检索区块数据每个文件的大小是64 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 blockfile 文件中。 HLF 存储区块数据的文件名格式如图所示： HLF 检索信息文件如图所示： 在序列化的过程中，程序以 append 方式打开 blockfile 文件，然后将区块大小和和区块数据写入至 blockfile 文件中。 以下是区块数据写入的具体描述： 1. 写入区块头数据，依次写入的数据为区块高度、交易哈希和前一个区块哈希； 2. 写入交易数据，依次写入的数据为区块包含交易总量和每笔交易详细数据； 3. 写入区块的 Metadata 数据，依次写入的数据为 Metadata 数据总量和每个 Metadata 项的数据详细信息。 在写入数据的过程中会以 kv 的形式保存区块和交易在 blockfile 文件中的索引信息，以方便 HLF 的快速查询。 HLF 区块索引信息格式在 kv 数据库中存储的最终的 LevelKey 值有前缀标志和区块 hash 组成，而 LevelValue 的值由区块高度，区块 hash，本地文件信息(文件名，文件偏移等信息)，每个交易在文件中的偏移列表和区块的 MetaData 组成， HLF 按照特定的编码方式将上述的信息拼接成 db 数据库中的 value 。 HLF 交易索引信息格式在 kv 数据库中存储最终的 LevelKey 值由channel_name，chaincode_name 和 chaincode 中的 key 值组合而成： LevelKey = &nbsp;channel_name + []byte{0x00} + chaincode_name + []byte{0x00} + key 而 LevelValue 的值由BlockNum 区块号，TxNum 交易在区块中的编号组成， HLF 通过将区块号和交易编号按照特定的方式编码，然后与 chaincode 中的 value 相互拼接最终生成 db 数据库中的 value 。 总结 综上所述，本文介绍的主要区块链除了 Ripple 使用的关系型数据库存储、检索区块数据外，其他三种类型的区块链都使用 kv 数据库存储区块链的检索信息。在存储、检索数据上，比特币和 Hyperledger Fabric 高度一致，即使用普通文件存储区块数据，使用 kv 数据库存储检索信息；以太坊的区块数据和检索信息都存储至 kv 数据库中，而 Ripple 的区块数据也会存储至 kv 数据库中。欢迎加入 区块链-瑞波开发专业讨论QQ群 731800148 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/16/fafec43b812d4609f99a67447945afa4.html","headline":"各区块链底层数据存储分析","dateModified":"2018-03-16T00:00:00+08:00","datePublished":"2018-03-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/16/fafec43b812d4609f99a67447945afa4.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>各区块链底层数据存储分析</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑', sans-serif;color:rgb(0,0,0);"><span>互联网的中心化发展模式是传统网络安全的的软肋，</span>区块链作为一种去中心化、集体维护、不可篡改的新兴技术，是对互联网底层架构的革新，是对当今生产力和生产关系的变革。区块链也被誉为是<span style="font-size:10.5pt;">继蒸汽机、电力、信息和互联网科技之后，目前最有潜力触发第五轮颠覆性革命浪潮的核心技术。</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;color:rgb(0,0,0);">目前市场上主流的区块链系统有比特币，Ripple，以太坊和 Hyperledger Fabric 。本文的主要目的就是分析当前主要流行的区块链的存储技术以及他们之间的不同。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><img src="https://mmbiz.qpic.cn/mmbiz_jpg/RwXrJ91JYdsl3UIshKcPogObq0V6GVDtGv3A78EwFy7MSN4ILn6Z3s8g16RpdPwkgWJKtZweBiaOtsBgJr6Kxng/?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <span style="border-top:1px solid rgb(95,170,255);color:inherit;width:100px;"><strong>区块链简介</strong></span>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;"></span><span style="color:rgb(85,85,85);font-family:'微软雅黑';font-size:14px;line-height:30px;">区块链（英语：blockchain&nbsp;或&nbsp;block chain）是用分布式数据库识别、传播和记载信息的智能化对等网络,&nbsp;也称为价值互联网。中本聪于2008年在《比特币白皮书》中提出“区块链”概念，并在2009年创立了比特币社会网络，开发出第一个区块，即“创世区块”。区块链包含一张被称为区块的列表，有着持续增长并且排列整齐的记录。每个区块都包含一个时间戳和一个与前一区块的链接，这样设计区块链使得数据不可篡改，一旦记录下来，在一个区块中的数据将不可逆。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(85,85,85);font-family:'微软雅黑';font-size:14px;line-height:30px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(85,85,85);font-family:'微软雅黑';font-size:14px;line-height:30px;">其数据结构大致如下：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(85,85,85);font-family:'微软雅黑';font-size:14px;line-height:30px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><img src="https://mmbiz.qpic.cn/mmbiz_png/RwXrJ91JYdsl3UIshKcPogObq0V6GVDtZ2fPoOJseOoxdEuGuCSZHJYjAyFlIC00icqAhzt6wQ5t2ABaliaYe3ibQ/?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:12px;color:rgb(136,136,136);">（<span style="font-family:'微软雅黑';line-height:30px;">区块链结构</span>）</span><span style="color:rgb(85,85,85);font-family:'微软雅黑';font-size:14px;line-height:30px;"></span><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:12px;color:rgb(136,136,136);"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <span style="border-top:1px solid rgb(95,170,255);color:inherit;width:80px;"><strong>数据存储</strong><br></span>
  <strong><br>比特币</strong>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:12px;color:rgb(136,136,136);"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;text-indent:0em;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">比特币（英语：Bitcoin）是一种去中心化、全球通用、不需第三方机构或个人，基于区块链作为支付技术的电子加密货币。它由中本聪于2009年1月3日，基于无国界的对等网络，用共识主动性开源软件发明创立，<span>是加密货币及区块链的始祖，也是目前知名度与市场总值最高的加密货币。</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;text-indent:0em;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">比特币存储系统由普通文件和 kv 数据库(levelDB)组成。普通文件用于存储区块链数据，kv 数据库用于存储区块链元数据。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;text-indent:0em;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">用于存储区块链数据的普通文件以 blk00000.dat , blk00001.dat 文件名格式组成，如图2所示，其中 index 目录存储用于存储区块元数据。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><img src="https://mmbiz.qpic.cn/mmbiz_png/RwXrJ91JYdsl3UIshKcPogObq0V6GVDticSGjwcoV7PZn37r7UNr3rUIFUFnfn0ta5Em2CLojWgQrnuwKz9EhVg/?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:12px;color:rgb(136,136,136);">（图2）</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">为了快速检索区块数据每个文件的大小是128 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 dat 文件中。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">在序列化的过程中，如果检测到当前写入文件尺寸加上区块尺寸大于 128 M Bytes，则会重新生成一个 dat 文件。具体的序列化过程如下所述：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">•获取当前 dat 文件大小 npos，并将区块大小追加写入至 dat 文件中</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>序列化区块数据和区块中的交易数据，并将序列化的数据追加至 dat 文件中。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>&nbsp;</span><span style="font-family:'微软雅黑';font-size:14px;">在写入数据的过程中，会生成区块和交易相关的元数据。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">区块的元数据格式如 &lt;blockHash,xxxxx+npos&gt; 格式， 其中 xxxxx 为 dat 文件序号，npos 为区块写入 dat 文件的起始位置。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">&nbsp;交易的元数据格式如 &lt;txHash, xxxxx+npos+nTxOffset&gt; 格式， 其中 xxxxx、npos 和上面的描述一致，nTxOffset 为写入 dat 文件的起始位置（基于npos 位置）。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">上述所有元数据都将写入 kv 数据库中，其中 blockhash/txHash 将作为后续查询具体数据在 dat 文件中的索引使用。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(0,128,255);"><span><span style="font-family:'微软雅黑';font-size:14px;">综上所述，在获取链数据的时候只需传入区哈希或是交易哈希，就能很容易的定位到区块数据或是交易数据。</span></span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <strong><span style="color:rgb(255,255,255);">2</span>瑞波币</strong>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span><span style="font-size:14px;font-family:'微软雅黑';">Ripple 是世界上第一个开放的支付网络</span></span><span style="font-size:14px;font-family:'微软雅黑';">，通过这个支付网络可以转账任意一种货币，包括美元、欧元、人民币、日元或者比特币，简便易行快捷，交易确认在几秒以内完成，交易费用几乎是零，没有所谓的跨行异地以及跨国支付费用。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">Ripple 的区块链数据存储系统是由关系型数据库(sqlite)和 kv 数据库组成，其中关系型数据库用来存储区块头信息和每笔交易的具体信息， kv 数据库主要存储区块头、交易和状态表序列化后的数据。 Ripple 这样处理的主要目的是单纯在查询区块头信息和具体每笔交易的时候，可以直接从关系型数据库中查找；而要构造整个区块数据的时候，除了从关系型数据库构造区块头信息外，还要依据区块头里的交易根哈希和状态表根哈希从 kv 数据库中获取具体的交易和状态表信息。这是 Ripple 和其他三种类型区块链系统唯一最大的不同。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">区块头信息的序列化具体步骤：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>用区块的哈希作为 Key；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>序列化区块高度、区块哈希、前一个区块哈希、交易根哈希、状态表根哈希等生成的数据作为 value；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>将 &lt;key, value&gt; 存储至 kv 数据库中。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:21px;">交易的序列化具体步骤：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>用区块头中的交易根哈希作为 Key；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>序列化交易哈希、交易类型、交易数据和 MetaData 等生成的数据作为 value；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;">•</span>&nbsp;将 &lt;Key, value&gt; 存储至 kv 数据库中。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';line-height:24px;text-indent:28px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span style="line-height:24px;text-indent:28px;">下表分别是</span><span style="line-height:24px;text-indent:28px;"> Ledgers </span><span style="line-height:24px;text-indent:28px;">和</span><span style="line-height:24px;text-indent:28px;"> Transactions </span><span style="line-height:24px;text-indent:28px;">表结构。</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"></span></p>
  <table cellspacing="0" cellpadding="0" style="width:670px;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;background-color:rgb(255,255,255);">
   <tbody>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span><span style="font-size:15px;font-family:'微软雅黑', sans-serif;">列名</span></span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span><span style="font-size:15px;font-family:'微软雅黑', sans-serif;">类型</span></span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:88px;vertical-align:middle;"><span><span style="font-size:15px;font-family:'微软雅黑', sans-serif;">含义</span></span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">LedgerHash</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;line-height:1.5em;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">哈希值</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">LedgerSeq</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">Ledger 序号</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">PrevHash</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">前个 Ledger 的 Hash 值</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">TotalCoins</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">当前网络上的 XR P总数（交易会销毁 XRP ）</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">ClosingTime</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">关闭时间</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">PrevClosingTime</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">前一个区块的关闭时间</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CloseTimeRes</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">ledger 关闭时间的解决方案（2-120 S）</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CloseFlags</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">标识 ledger 的关闭方式，一般都是0</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">AccountSetHash</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">stateMap 根结点 hash</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">TransSetHash</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;text-indent:28px;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">txMap 根节点哈希</span></p></td>
    </tr>
   </tbody>
  </table>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"></span><span style="font-size:12px;color:rgb(136,136,136);">（表1：<span style="font-family:'微软雅黑';line-height:24px;text-indent:28px;">Ledgers </span>）</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:12px;color:rgb(136,136,136);"><br></span></p>
  <table cellspacing="0" cellpadding="0" style="width:670px;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;background-color:rgb(255,255,255);">
   <tbody>
    <tr>
     <td><p style="clear:both;min-height:1em;text-align:center;vertical-align:middle;"><span><span style="font-size:15px;font-family:'微软雅黑', sans-serif;">列名</span></span></p></td>
     <td><p style="clear:both;min-height:1em;text-align:center;vertical-align:middle;"><span><span style="font-size:15px;font-family:'微软雅黑', sans-serif;">类型</span></span></p></td>
     <td><p style="clear:both;min-height:1em;text-align:center;vertical-align:middle;"><span><span style="font-size:15px;font-family:'微软雅黑', sans-serif;">含义</span></span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">TransID</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易 hash</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">TransType</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易类型</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">FromAcct</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易的发起账户</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">FromSeq</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易在账户中的序号</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">LedgerSeq</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BIGINT UNSIGNED</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易落在哪个区块上</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">Status</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">CHARACTER</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易的状态 V 表示“共识过”</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">RawTxn</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BLOB</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易序列化数据</span></p></td>
    </tr>
    <tr>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">TxnMeta</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">BLOB</span></p></td>
     <td><p style="clear:both;min-height:1em;vertical-align:middle;"><span style="font-size:15px;font-family:'微软雅黑', sans-serif;color:rgb(136,136,136);">交易 metaData 的序列化数据</span></p></td>
    </tr>
   </tbody>
  </table>
  <p style="clear:both;min-height:1em;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);color:rgb(62,62,62);"><span style="font-size:12px;color:rgb(136,136,136);">（表2：<span style="font-family:'微软雅黑';line-height:24px;text-indent:28px;">Transactions </span>）<br><br><span style="font-family:'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;font-size:16px;color:rgb(255,255,255);">3</span><span style="color:rgb(79,79,79);font-family:'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;font-size:16px;">以太坊</span></span></p>
  <div>
   <span style="font-family:'微软雅黑';font-size:14px;text-indent:0em;font-weight:normal;">以太坊是一个开源的有智能合约功能的公共区块链平台。通过其专用加密货币以太币（Ether，又称为「以太币」）提供去中心化的虚拟机（称为「以太虚拟机」Ethereum Virtual Machine）来处理点对点合约。</span>
  </div>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><span style="font-size:12px;color:rgb(136,136,136);"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">以太坊的区块主要由区块头和交易组成，区块在存储的过程中分别将区块头和交易体经过 RLP 编码后存入至 KV 数据当中。以太坊在数据存储的过程中，每个 value 对应的key 都有相对应的前缀，不同类型的 value 对应不同的前缀。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">区块交易体的存储过程如下：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">1. 将区块中的交易数据和叔块头信息进行 RLP 编码从而生成存储值<span> v</span>alue；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">2. 将数据类型前缀，编码后的区块高度和区块哈希拼接生成 key；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">3. <span><span>将</span> &lt;key, value&gt; <span>存储至</span> db <span>数据库中。</span></span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">区块的信息可以通过区块哈希和区块高度进行检索，其存储过程如下：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">1. <span>将区块头信息进行 RLP 编码从而生成存储值 va</span><span>lue</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">2. <span><span>将区块高度进行编码</span>(<span>转发成大端格式数据</span>)<span>生成</span> encNu</span>m</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">3. 将数据类型前缀 (headerPrefix) 和 encNum 生成以区块高度为检索信息的 key</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">4. <span><span>将</span> &lt;key, value&gt; <span>存储至</span> db <span>数据库中，从而生成以区块高度为检索的信息</span></span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">5. </span><span style="font-family:'微软雅黑';"><span style="font-size:14px;"><span>将数据类型前缀</span> (blockHashPrefix) <span>和区块哈希生成以区块哈希为检索信</span></span><span style="font-size:14px;"><span>息的</span> key</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">6. <span><span>将</span> &lt;key, value&gt; <span>存储至</span> db <span>数据库中，从生成区块哈希为检索的信息</span></span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);">&nbsp;</p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">在数据查询的时候，应用层只需要提供交易 hash、区块高度和区块哈希就能得到交易 key，从而查询到相关的交易信息。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <strong><span style="color:rgb(255,255,255);">4</span><span style="line-height:24px;text-indent:28px;font-family:'微软雅黑';">Hyperledger Fabric</span></strong>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">Hyperledger fabric （HLF）是由Linux基金会主导推广的区块链开源项目。在Hyperledger Fabric的基础上又衍生出了其他一些相关的项目。HyperLedger项目汇集了金融、银行、物联网、供应链、制造等各界开发人员的心血。目的是为了打造一个跨领域的区块链应用。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">HLF 的存储系统和比特币一样，也是由普通的文件和 kv 的数据库（levelDB/couchDB）组成。在 HLF 中，每个 channel 对应一个账本目录，在账本目录中由 blockfile_000000、blockfile_000001 命名格式的文件名组成。为了快速检索区块数据每个文件的大小是64 M Bytes。每个区块的数据（区块头和区块里的所有交易）都会序列成字节码的形式写入 blockfile 文件中。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;">HLF </span><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;">存储区块数据的文件名格式如图所示：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;"></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><img src="https://mmbiz.qpic.cn/mmbiz_png/RwXrJ91JYdvPbTSYDQUlB1uSHyXFtqYBlSWsUEP9caQmibUo5ADtCiata4EFicYO6tNq3ybkgwrV6geELbRsZiaPZw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;"></span><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;"><span style="line-height:24px;">HLF </span><span style="line-height:24px;">检索信息文件如图所示：</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;"><span style="line-height:24px;"></span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><img src="https://mmbiz.qpic.cn/mmbiz_png/RwXrJ91JYdvPbTSYDQUlB1uSHyXFtqYBkFINmWyLqUdXO9RyiaM4vO87fsU5ZG3l2kwV0RSrJiclc4WEc4yRy3zQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;line-height:25.6px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;text-indent:28px;"><span style="line-height:24px;"></span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">在序列化的过程中，程序以 append 方式打开 blockfile 文件，然后将区块大小和和区块数据写入至 blockfile 文件中。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';">以下是区块数据写入的具体描述：</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span>1. </span>写<span>入区块头数据，依次写入的数据为区块高度、交易哈希和前一个区块哈希；</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">2. 写入交易数据，依次写入的数据为区块包含交易总量和每笔交易详细数据；</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';text-indent:28px;line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span>3. 写入区块的</span> <span>Metadata 数据，依次写入的数据为 Metadata 数据总量和每个 Metadata 项的数据详细信息。</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">在写入数据的过程中会以 kv 的形式保存区块和交易在 blockfile 文件中的索引信息，以方便 HLF 的快速查询。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">HLF 区块索引信息格式在 kv 数据库中存储的最终的 LevelKey 值有前缀标志和区块 hash 组成，而 LevelValue 的值由区块高度，区块 hash，本地文件信息(文件名，文件偏移等信息)，每个交易在文件中的偏移列表和区块的 MetaData 组成， HLF 按照特定的编码方式将上述的信息拼接成 db 数据库中的 value 。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"><br></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);text-indent:0em;font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-size:14px;font-family:'微软雅黑';"><span>HLF </span><span>交易索引信息格式在</span><span> kv </span><span>数据库中存储最终的</span> <span>LevelKey</span> <span>值由</span><span>channel_name</span><span>，</span><span>chaincode_name </span><span>和</span><span> chaincode </span><span>中的</span><span> key </span><span>值组合而成：</span></span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <span style="font-family:'微软雅黑';line-height:24px;text-indent:28px;">LevelKey = &nbsp;channel_name + []byte{0x00} + chaincode_name + []byte{0x00} + key</span>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;">而 LevelValue 的值由BlockNum 区块号，TxNum 交易在区块中的编号组成， HLF 通过将区块号和交易编号按照特定的方式编码，然后与 chaincode 中的 value 相互拼接最终生成 db 数据库中的 value 。</span></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <span style="line-height:24px;text-indent:28px;font-family:'微软雅黑';"><strong>总结</strong></span>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;background-color:rgb(255,255,255);"><br></p>
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'MicroSoft YaHei';line-height:24px;background-color:rgb(255,255,255);"><span style="font-family:'微软雅黑';font-size:14px;"></span><span style="font-family:'微软雅黑';font-size:14px;line-height:24px;">综上所述，本文介绍的主要区块链除了 Ripple 使用的关系型数据库存储、检索区块数据外，其他三种类型的区块链都使用 kv 数据库存储区块链的检索信息。在存储、检索数据上，比特币和 Hyperledger Fabric 高度一致，即使用普通文件存储区块数据，使用 kv 数据库存储检索信息；以太坊的区块数据和检索信息都存储至 kv 数据库中，而 Ripple 的区块数据也会存储至 kv 数据库中。欢迎加入 区块链-瑞波开发专业讨论QQ群 731800148</span></p>
  <div>
   <div>
    <br>
   </div>
  </div> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sinat_34070003/article/details/79586428,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/sinat_34070003/article/details/79586428,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

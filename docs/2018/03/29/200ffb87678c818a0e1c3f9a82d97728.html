<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>用java写一个简单的区块链（下） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="用java写一个简单的区块链（下）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本章目标 创建一个简单的钱包。 使用我们的区块链发送带签名的交易。 这样我们就有自己的加密货币 值得注意的是，这里创建的区块链并不是功能完全的完全适合应用与生产的区块链，相反只是为了帮助你更好的理解区块链的概念。 别担心，这实际上是很简单的，但比上一个教程要长! 在上一章节，我们已经有了一个基本的区块链，但在区块链中存放的是一些无用的信息。今天我们将用交易取代这些信息（我们的区块将能够保存多个交易），允许我们创建一个非常简单的加密货币,我们的货币名字pibigstar。 本教程是在上一边基础上实现的 导入&nbsp;bounceycastle和GSON 准备一个钱包 在加密货币中，在区块链作为交易时，货币所有权可以进行转移，每个参与者都有一个自己私有的地址来发送或者是收取货币。，钱包可以存储这些地址。因此钱包就是可以在区块链上进行新交易的软件。 Don’t worry about the information on the transaction, that will be explained soon 让我们创建一个钱包类来保存公钥和私钥: package noobchain; import java.security.*; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; } 公钥和私钥究竟是起到什么作用呢，其实公钥的作用就是地址，你可以分享你的公钥给别人以此来获取付款，而你的私钥的作用是为了对交易进行签名，这样其他人就不可以花费你的金额除非它拥有你的私钥，所以对于每个人而言我们必须保护好我们的私钥，不能透露我们的私钥信息给其他人。同时在我们进行交易的时候我们也会同时发送我们的公钥由此来验证我们的签名是有效的而且没有数据被篡改。 我们在密钥对KeyPair生成私有和公钥。我们将使用椭圆曲线加密来生成我们的密钥对KeyPair。让我们将generateKeyPair()方法添加到我们的钱包类中，并在构造函数中调用它: 私钥用于签署我们不想被篡改的数据。公钥用于验证签名。 package noobchain; import java.security.*; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; public Wallet(){ generateKeyPair(); } public void generateKeyPair() { try { KeyPairGenerator keyGen = KeyPairGenerator.getInstance(&quot;ECDSA&quot;,&quot;BC&quot;); SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;); ECGenParameterSpec ecSpec = new ECGenParameterSpec(&quot;prime192v1&quot;); // Initialize the key generator and generate a KeyPair keyGen.initialize(ecSpec, random); //256 bytes provides an acceptable security level KeyPair keyPair = keyGen.generateKeyPair(); // Set the public and private keys from the keyPair privateKey = keyPair.getPrivate(); publicKey = keyPair.getPublic(); }catch(Exception e) { throw new RuntimeException(e); } } } 你不需要完全理解椭圆曲线加密算法的核心逻辑究竟是什么，你只需要它是用来创建公钥和私钥，以及公钥和私钥分别所起到的作用是什么就可以了。 现在我们已经又了钱包类的大概框架，下面我们再来看一下交易类。 交易和数字签名 每笔交易将携带一定以下信息： 资金付款人的公匙信息。 资金收款人的公匙信息。 被转移资金的金额。 输入，它是对以前的交易的引用，证明发送者有资金发送。 输出，显示交易中收款方相关地址数量。(这些输出被引用为新交易的输入) 一个加密签名，证明该交易是由地址的发送者是发送的，并且数据没有被更改。(阻止第三方机构更改发送的数量) 让我们创建这个新的交易类： import java.security.*; import java.util.ArrayList; public class Transaction { public String transactionId; // this is also the hash of the transaction. public PublicKey sender; // senders address/public key. public PublicKey reciepient; // Recipients address/public key. public float value; public byte[] signature; // this is to prevent anybody else from spending funds in our wallet. public ArrayList&lt;TransactionInput&gt; inputs = new ArrayList&lt;TransactionInput&gt;(); public ArrayList&lt;TransactionOutput&gt; outputs = new ArrayList&lt;TransactionOutput&gt;(); private static int sequence = 0; // a rough count of how many transactions have been generated. // Constructor: public Transaction(PublicKey from, PublicKey to, float value, ArrayList&lt;TransactionInput&gt; inputs) { this.sender = from; this.reciepient = to; this.value = value; this.inputs = inputs; } // This Calculates the transaction hash (which will be used as its Id) private String calulateHash() { sequence++; //increase the sequence to avoid 2 identical transactions having the same hash return StringUtil.applySha256( StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) + sequence ); } } 我们还应该创建空的transactioninput和transactionoutput类，不要担心我们可以在后面填写它们。 我们的交易类还将包含生成/验证签名和验证交易的相关方法，那么签名的意图是什么？签名在我们的区块链中执行了两个非常重要的任务：第一，签名用来保证只有货币的拥有者才可以用来发送自己的货币，第二，签名用来阻止其他人试图篡改提交的交易。 即私钥被用来签名数据，而公钥用来验证其完整性。 举个例子：Bob 想要发送2个加密货币给Sally，他们用各自的钱包创建了交易，并提交到全网的区块链中作为一个新的区块，一个挖矿者试图篡改接受者把2个加密货币给John，但是幸运的事，Bob在交易数据中已经用私钥进行了签名，这就允许了全网中的任何节点使用小明的公匙进行验证数据是否已经被篡改（因为没有其他人的公钥可以用来验证小明发出的这笔交易）。 从前面的代码中我们可以看到我们的签名将是一堆字符串，所以让我们创建一个方法来生成它们。首先我们在StringUtil类中创建产生签名的方法。 public static byte[] applyECDSASig(PrivateKey privateKey, String input) { Signature dsa; byte[] output = new byte[0]; try { dsa = Signature.getInstance(&quot;ECDSA&quot;, &quot;BC&quot;); dsa.initSign(privateKey); byte[] strByte = input.getBytes(); dsa.update(strByte); byte[] realSig = dsa.sign(); output = realSig; } catch (Exception e) { throw new RuntimeException(e); } return output; } //Verifies a String signature public static boolean verifyECDSASig(PublicKey publicKey, String data, byte[] signature) { try { Signature ecdsaVerify = Signature.getInstance(&quot;ECDSA&quot;, &quot;BC&quot;); ecdsaVerify.initVerify(publicKey); ecdsaVerify.update(data.getBytes()); return ecdsaVerify.verify(signature); }catch(Exception e) { throw new RuntimeException(e); } } public static String getStringFromKey(Key key) { return Base64.getEncoder().encodeToString(key.getEncoded()); } 不用担心你不能理解这些方法的内容，你所需要知道的就是applyECDSASig方法的输入参数为付款人的私钥和需要加密的数据信息，签名后返回字节数组。而verifyECDSASig方法的输入参数为公钥、加密的数据和签名，调用该方法后返回true或false来说明签名是否是有效的。getStringFromKey返回任何key的编码字符串 让我们使用签名的方法在交易类中，增加generatesiganature()&nbsp;和&nbsp;varifiysignature()方法： //Signs all the data we dont wish to be tampered with. public void generateSignature(PrivateKey privateKey) { String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) ; signature = StringUtil.applyECDSASig(privateKey,data); } //Verifies the data we signed hasnt been tampered with public boolean verifiySignature() { String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) ; return StringUtil.verifyECDSASig(sender, data, signature); } 在现实中，您可能希望签名更多信息，例如使用的输出/输入和/或时间戳（现在我们只是签名最低限度的信息） 签名将由矿工验证，只有签名验证成功后交易才能被添加到区块中去。 当我们检查区块链的有效性时，我们也可以检查签名 测试钱包和签名 现在我们简单的进行一些测试，在主方法中，我们增加了一些新的变量也替换了我们之前在主方法中的一些内容。 import java.security.Security; import java.util.ArrayList; import java.util.Base64; import com.google.gson.GsonBuilder; public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static int difficulty = 5; public static Wallet walletA; public static Wallet walletB; public static void main(String[] args) { //Setup Bouncey castle as a Security Provider Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Create the new wallets walletA = new Wallet(); walletB = new Wallet(); //Test public and private keys System.out.println(&quot;Private and public keys:&quot;); System.out.println(StringUtil.getStringFromKey(walletA.privateKey)); System.out.println(StringUtil.getStringFromKey(walletA.publicKey)); //Create a test transaction from WalletA to walletB Transaction transaction = new Transaction(walletA.publicKey, walletB.publicKey, 5, null); transaction.generateSignature(walletA.privateKey); //Verify the signature works and verify it from the public key System.out.println(&quot;Is signature verified&quot;); System.out.println(transaction.verifiySignature()); } 确定要添加bounceycastle依赖 我们创建了两个钱包walleta和walletb，然后打印了walleta的私钥和公钥。生成一个交易并使用walleta的私钥对其进行签名。 打印 Connected to the target VM, address: &#39;127.0.0.1:55757&#39;, transport: &#39;socket&#39; Private and public keys: MHsCAQAwEwYHKoZIzj0CAQYIKoZIzj0DAQEEYTBfAgEBBBiJzZiesBnBWwwB+uog+fJX84mx4lPUTUagCgYIKoZIzj0DAQGhNAMyAAQfPzad0zqBUGQAany2rRZE1+2ml5IOCZST8LywjBQT8ux+3UPVbr2u0+LaExxz1WI= MEkwEwYHKoZIzj0CAQYIKoZIzj0DAQEDMgAEHz82ndM6gVBkAGp8tq0WRNftppeSDgmUk/C8sIwUE/Lsft1D1W69rtPi2hMcc9Vi Is signature verified true 接下来我们将创建并验证输入和输出，并把交易保存到区块链中去。 输入和输出 1：如何验证货币是你的 如果你拥有1比特币，你必须前面就得接收1比特币。比特币的账本不会在你的账户中增加一个比特币也不会从发送者那里减去一个比特币，发送者只能指向他/她之前收到过一个比特币，所以一个交易输出被创建用来显示一个比特币发送给你的地址（交易的输入指向前一个交易的输出）。 你的钱包余额是所有未使用的交易输出的总和 从这一个点出发，我们会依照比特币中的说明，把所有未使用的交易输出称为UTXO. 创建TransactionInput&nbsp;类： public class TransactionInput { public String transactionOutputId; //Reference to TransactionOutputs -&gt; transactionId public TransactionOutput UTXO; //Contains the Unspent transaction output public TransactionInput(String transactionOutputId) { this.transactionOutputId = transactionOutputId; } } 这个类将用于引用尚未使用的transactionoutput。transactionOutputId将用于查找相关的TransactionOutput，允许矿工检查您的所有权。 创建TransactionOutputs&nbsp;类： import java.security.PublicKey; public class TransactionOutput { public String id; public PublicKey reciepient; //also known as the new owner of these coins. public float value; //the amount of coins they own public String parentTransactionId; //the id of the transaction this output was created in //Constructor public TransactionOutput(PublicKey reciepient, float value, String parentTransactionId) { this.reciepient = reciepient; this.value = value; this.parentTransactionId = parentTransactionId; this.id = StringUtil.applySha256(StringUtil.getStringFromKey(reciepient)+Float.toString(value)+parentTransactionId); } //Check if coin belongs to you public boolean isMine(PublicKey publicKey) { return (publicKey == reciepient); } } 交易输出类将显示从交易中发送给每一方的最终金额。这些作为新交易中的输入参考，作为证明你可以发送的金额数量。 输入和输出 2：处理交易 区块链可能会收到很多交易，而区块链可能会非常长，因为我们必须查找并检查其输入，所以可能需要非常长的时间来处理新的交易。为了解决这个问题，我们保存了一个额外的集合称之为为使用的交易作为可用的输入,所以在主函数中增加一个集合称为UTXO。 public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static HashMap&lt;String,TransactionOutputs&gt; UTXOs = new HashMap&lt;String,TransactionOutputs&gt;(); //list of all unspent transactions. public static int difficulty = 5; public static Wallet walletA; public static Wallet walletB; public static void main(String[] args) { hashmap允许我们使用键来查找值，但是您需要导入java.util.hashmap 重点来了，我们在交易类中增加一个processTransaction方法，这个方法是把一切放在一起用来处理交易。 //Returns true if new transaction could be created. public boolean processTransaction() { if(verifiySignature() == false) { System.out.println(&quot;#Transaction Signature failed to verify&quot;); return false; } //gather transaction inputs (Make sure they are unspent): for(TransactionInput i : inputs) { i.UTXO = NoobChain.UTXOs.get(i.transactionOutputId); } //check if transaction is valid: if(getInputsValue() &lt; NoobChain.minimumTransaction) { System.out.println(&quot;#Transaction Inputs to small: &quot; + getInputsValue()); return false; } //generate transaction outputs: float leftOver = getInputsValue() - value; //get value of inputs then the left over change: transactionId = calulateHash(); outputs.add(new TransactionOutput( this.reciepient, value,transactionId)); //send value to recipient outputs.add(new TransactionOutput( this.sender, leftOver,transactionId)); //send the left over &#39;change&#39; back to sender //add outputs to Unspent list for(TransactionOutput o : outputs) { NoobChain.UTXOs.put(o.id , o); } //remove transaction inputs from UTXO lists as spent: for(TransactionInput i : inputs) { if(i.UTXO == null) continue; //if Transaction can&#39;t be found skip it NoobChain.UTXOs.remove(i.UTXO.id); } return true; } //returns sum of inputs(UTXOs) values public float getInputsValue() { float total = 0; for(TransactionInput i : inputs) { if(i.UTXO == null) continue; //if Transaction can&#39;t be found skip it total += i.UTXO.value; } return total; } //returns sum of outputs: public float getOutputsValue() { float total = 0; for(TransactionOutput o : outputs) { total += o.value; } return total; } 我们还添加了getinputsvalue方法 通过这种方法，我们执行一些检查以确保交易有效，然后收集输入并生成输出。最重要的是，最后，我们抛弃了输入在我们的UTXO列表，这就意味着一个可以使用的交易输出必须之前一定是输入，所以输入的值必须被完全使用，所以付款人必须改变它们自身的金额状态。 红色箭头是输出。请注意，绿色输入是对之前输出的参考 最后让我们修改我们的wallet类 搜集余额（通过循环遍历UTXO列表来检查交易的输出是否是我的）并 创建交易 import java.security.*; import java.security.spec.ECGenParameterSpec; import java.util.ArrayList; import java.util.HashMap; import java.util.Map; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; public HashMap&lt;String,TransactionOutput&gt; UTXOs = new HashMap&lt;String,TransactionOutput&gt;(); //only UTXOs owned by this wallet. public Wallet() {... public void generateKeyPair() {... //returns balance and stores the UTXO&#39;s owned by this wallet in this.UTXOs public float getBalance() { float total = 0; for (Map.Entry&lt;String, TransactionOutput&gt; item: NoobChain.UTXOs.entrySet()){ TransactionOutput UTXO = item.getValue(); if(UTXO.isMine(publicKey)) { //if output belongs to me ( if coins belong to me ) UTXOs.put(UTXO.id,UTXO); //add it to our list of unspent transactions. total += UTXO.value ; } } return total; } //Generates and returns a new transaction from this wallet. public Transaction sendFunds(PublicKey _recipient,float value ) { if(getBalance() &lt; value) { //gather balance and check funds. System.out.println(&quot;#Not Enough funds to send transaction. Transaction Discarded.&quot;); return null; } //create array list of inputs ArrayList&lt;TransactionInput&gt; inputs = new ArrayList&lt;TransactionInput&gt;(); float total = 0; for (Map.Entry&lt;String, TransactionOutput&gt; item: UTXOs.entrySet()){ TransactionOutput UTXO = item.getValue(); total += UTXO.value; inputs.add(new TransactionInput(UTXO.id)); if(total &gt; value) break; } Transaction newTransaction = new Transaction(publicKey, _recipient , value, inputs); newTransaction.generateSignature(privateKey); for(TransactionInput input: inputs){ UTXOs.remove(input.transactionOutputId); } return newTransaction; } } 你可以随时为钱包添加一些其他功能，例如记录您的交易历史记录。 添加交易到区块中 现在我们已经有了一个有效的交易系统，我们需要把交易加入到我们的区块链中。我们把交易列表替换我们块中无用的数据，但是在一个单一的区块中可能存放了1000个交易，这就会导致大量的hash计算，不用担心在这里我们使用了交易的merkle root，稍后你会看到。让我们增加一个帮助方法来创建merkle root在StringUtils类中。 在StringUtils类中创建getMerkleRoot方法 //Tacks in array of transactions and returns a merkle root. public static String getMerkleRoot(ArrayList&lt;Transaction&gt; transactions) { int count = transactions.size(); ArrayList&lt;String&gt; previousTreeLayer = new ArrayList&lt;String&gt;(); for(Transaction transaction : transactions) { previousTreeLayer.add(transaction.transactionId); } ArrayList&lt;String&gt; treeLayer = previousTreeLayer; while(count &gt; 1) { treeLayer = new ArrayList&lt;String&gt;(); for(int i=1; i &lt; previousTreeLayer.size(); i++) { treeLayer.add(applySha256(previousTreeLayer.get(i-1) + previousTreeLayer.get(i))); } count = treeLayer.size(); previousTreeLayer = treeLayer; } String merkleRoot = (treeLayer.size() == 1) ? treeLayer.get(0) : &quot;&quot;; return merkleRoot; } 我会尽快用一个实际的merkleroot取代这个方法，但是现在使用这个可以正常运行 修来Block&nbsp;类 import java.util.ArrayList; import java.util.Date; public class Block { public String hash; public String previousHash; public String merkleRoot; public ArrayList&lt;Transaction&gt; transactions = new ArrayList&lt;Transaction&gt;(); //our data will be a simple message. public long timeStamp; //as number of milliseconds since 1/1/1970. public int nonce; //Block Constructor. public Block(String previousHash ) { this.previousHash = previousHash; this.timeStamp = new Date().getTime(); this.hash = calculateHash(); //Making sure we do this after we set the other values. } //Calculate new hash based on blocks contents public String calculateHash() { String calculatedhash = StringUtil.applySha256( previousHash + Long.toString(timeStamp) + Integer.toString(nonce) + merkleRoot ); return calculatedhash; } //Increases nonce value until hash target is reached. public void mineBlock(int difficulty) { merkleRoot = StringUtil.getMerkleRoot(transactions); String target = StringUtil.getDificultyString(difficulty); //Create a string with difficulty * &quot;0&quot; while(!hash.substring( 0, difficulty).equals(target)) { nonce ++; hash = calculateHash(); } System.out.println(&quot;Block Mined!!! : &quot; + hash); } //Add transactions to this block public boolean addTransaction(Transaction transaction) { //process transaction and check if valid, unless block is genesis block then ignore. if(transaction == null) return false; if((previousHash != &quot;0&quot;)) { if((transaction.processTransaction() != true)) { System.out.println(&quot;Transaction failed to process. Discarded.&quot;); return false; } } transactions.add(transaction); System.out.println(&quot;Transaction Successfully added to Block&quot;); return true; } } 需要注意的是我们还更新了Block构造函数，因为我们不再需要传递字符串数据，并将merkle root包含在计算哈希方法中。addTransaction方法用来增加交易，只有满足条件下才可以成功的在区块中增加交易。 我们已经实现了一个可交易的区块链。 最后的测试 我们应该测试从钱包发送货币，更新区块链并进行有效性检查。但首先我们需要一种将新硬币引入混合的方法。有很多方法来创建新的硬币。在比特币区块链上，有很多方法可以创造新的比特币:矿工可以将交易包括在内，作为对每个矿工挖矿的奖励。但在这里我们只希望在创世纪区块中释放货币。就像比特币中一下，所以我们修改我们的主函数以达到下面的目的。 创世纪区块发布100个货币给walletA 一个更新的链有效性检查，考虑到交易。 测试交易看是否一切正常。 public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static HashMap&lt;String,TransactionOutput&gt; UTXOs = new HashMap&lt;String,TransactionOutput&gt;(); public static int difficulty = 3; public static float minimumTransaction = 0.1f; public static Wallet walletA; public static Wallet walletB; public static Transaction genesisTransaction; public static void main(String[] args) { //add our blocks to the blockchain ArrayList: Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Setup Bouncey castle as a Security Provider //Create wallets: walletA = new Wallet(); walletB = new Wallet(); Wallet coinbase = new Wallet(); //create genesis transaction, which sends 100 NoobCoin to walletA: genesisTransaction = new Transaction(coinbase.publicKey, walletA.publicKey, 100f, null); genesisTransaction.generateSignature(coinbase.privateKey); //manually sign the genesis transaction genesisTransaction.transactionId = &quot;0&quot;; //manually set the transaction id genesisTransaction.outputs.add(new TransactionOutput(genesisTransaction.reciepient, genesisTransaction.value, genesisTransaction.transactionId)); //manually add the Transactions Output UTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //its important to store our first transaction in the UTXOs list. System.out.println(&quot;Creating and Mining Genesis block... &quot;); Block genesis = new Block(&quot;0&quot;); genesis.addTransaction(genesisTransaction); addBlock(genesis); //testing Block block1 = new Block(genesis.hash); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;\nWalletA is Attempting to send funds (40) to WalletB...&quot;); block1.addTransaction(walletA.sendFunds(walletB.publicKey, 40f)); addBlock(block1); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); Block block2 = new Block(block1.hash); System.out.println(&quot;\nWalletA Attempting to send more funds (1000) than it has...&quot;); block2.addTransaction(walletA.sendFunds(walletB.publicKey, 1000f)); addBlock(block2); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); Block block3 = new Block(block2.hash); System.out.println(&quot;\nWalletB is Attempting to send funds (20) to WalletA...&quot;); block3.addTransaction(walletB.sendFunds( walletA.publicKey, 20)); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); isChainValid(); } public static Boolean isChainValid() { Block currentBlock; Block previousBlock; String hashTarget = new String(new char[difficulty]).replace(&#39;\0&#39;, &#39;0&#39;); HashMap&lt;String,TransactionOutput&gt; tempUTXOs = new HashMap&lt;String,TransactionOutput&gt;(); //a temporary working list of unspent transactions at a given block state. tempUTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //loop through blockchain to check hashes: for(int i=1; i &lt; blockchain.size(); i++) { currentBlock = blockchain.get(i); previousBlock = blockchain.get(i-1); //compare registered hash and calculated hash: if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){ System.out.println(&quot;#Current Hashes not equal&quot;); return false; } //compare previous hash and registered previous hash if(!previousBlock.hash.equals(currentBlock.previousHash) ) { System.out.println(&quot;#Previous Hashes not equal&quot;); return false; } //check if hash is solved if(!currentBlock.hash.substring( 0, difficulty).equals(hashTarget)) { System.out.println(&quot;#This block hasn&#39;t been mined&quot;); return false; } //loop thru blockchains transactions: TransactionOutput tempOutput; for(int t=0; t &lt;currentBlock.transactions.size(); t++) { Transaction currentTransaction = currentBlock.transactions.get(t); if(!currentTransaction.verifiySignature()) { System.out.println(&quot;#Signature on Transaction(&quot; + t + &quot;) is Invalid&quot;); return false; } if(currentTransaction.getInputsValue() != currentTransaction.getOutputsValue()) { System.out.println(&quot;#Inputs are note equal to outputs on Transaction(&quot; + t + &quot;)&quot;); return false; } for(TransactionInput input: currentTransaction.inputs) { tempOutput = tempUTXOs.get(input.transactionOutputId); if(tempOutput == null) { System.out.println(&quot;#Referenced input on Transaction(&quot; + t + &quot;) is Missing&quot;); return false; } if(input.UTXO.value != tempOutput.value) { System.out.println(&quot;#Referenced input Transaction(&quot; + t + &quot;) value is Invalid&quot;); return false; } tempUTXOs.remove(input.transactionOutputId); } for(TransactionOutput output: currentTransaction.outputs) { tempUTXOs.put(output.id, output); } if( currentTransaction.outputs.get(0).reciepient != currentTransaction.reciepient) { System.out.println(&quot;#Transaction(&quot; + t + &quot;) output reciepient is not who it should be&quot;); return false; } if( currentTransaction.outputs.get(1).reciepient != currentTransaction.sender) { System.out.println(&quot;#Transaction(&quot; + t + &quot;) output &#39;change&#39; is not sender.&quot;); return false; } } } System.out.println(&quot;Blockchain is valid&quot;); return true; } public static void addBlock(Block newBlock) { newBlock.mineBlock(difficulty); blockchain.add(newBlock); } } 打印： Connected to the target VM, address: &#39;127.0.0.1:57085&#39;, transport: &#39;socket&#39; Creating and Mining Genesis block... Transaction Successfully added to Block Block Mined!!! : 000b5a7ca6bf07639122cb31e884996895a482c281dd89c203824f1e93a661bf WalletA&#39;s balance is: 100.0 WalletA is Attempting to send funds (40) to WalletB... Transaction Successfully added to Block Block Mined!!! : 000c7f814357abfea86ad1b38ec1dc3afed2afc9107f2bacc933d8136bf34df0 WalletA&#39;s balance is: 60.0 WalletB&#39;s balance is: 40.0 WalletA Attempting to send more funds (1000) than it has... #Not Enough funds to send transaction. Transaction Discarded. Block Mined!!! : 000b3822fb7985db438712816727d4bc382926a1c4654062aad4071d9b9fad98 WalletA&#39;s balance is: 60.0 WalletB&#39;s balance is: 40.0 WalletB is Attempting to send funds (20) to WalletA... Transaction Successfully added to Block WalletA&#39;s balance is: 80.0 WalletB&#39;s balance is: 20.0 Blockchain is valid 现在钱包能够安全地在您的区块链上发送金额，只要他们有金额发送。这意味着你有你自己的本地加密货币 可以进行交易的区块链 你已经成功地创建了自己的加密货币。你的区块链： 允许用户创建钱包 使用椭圆曲线加密方式为钱包提供公钥和私钥 通过使用数字签名算法证明所有权，确保资金转移 允许用户在区块链上进行交易 项目地址：https://github.com/pibigstar/blockchain 转载自：https://longfeizheng.github.io/2018/03/11/用Java创建你的第一个区块链-part2/ 阅读更多" />
<meta property="og:description" content="本章目标 创建一个简单的钱包。 使用我们的区块链发送带签名的交易。 这样我们就有自己的加密货币 值得注意的是，这里创建的区块链并不是功能完全的完全适合应用与生产的区块链，相反只是为了帮助你更好的理解区块链的概念。 别担心，这实际上是很简单的，但比上一个教程要长! 在上一章节，我们已经有了一个基本的区块链，但在区块链中存放的是一些无用的信息。今天我们将用交易取代这些信息（我们的区块将能够保存多个交易），允许我们创建一个非常简单的加密货币,我们的货币名字pibigstar。 本教程是在上一边基础上实现的 导入&nbsp;bounceycastle和GSON 准备一个钱包 在加密货币中，在区块链作为交易时，货币所有权可以进行转移，每个参与者都有一个自己私有的地址来发送或者是收取货币。，钱包可以存储这些地址。因此钱包就是可以在区块链上进行新交易的软件。 Don’t worry about the information on the transaction, that will be explained soon 让我们创建一个钱包类来保存公钥和私钥: package noobchain; import java.security.*; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; } 公钥和私钥究竟是起到什么作用呢，其实公钥的作用就是地址，你可以分享你的公钥给别人以此来获取付款，而你的私钥的作用是为了对交易进行签名，这样其他人就不可以花费你的金额除非它拥有你的私钥，所以对于每个人而言我们必须保护好我们的私钥，不能透露我们的私钥信息给其他人。同时在我们进行交易的时候我们也会同时发送我们的公钥由此来验证我们的签名是有效的而且没有数据被篡改。 我们在密钥对KeyPair生成私有和公钥。我们将使用椭圆曲线加密来生成我们的密钥对KeyPair。让我们将generateKeyPair()方法添加到我们的钱包类中，并在构造函数中调用它: 私钥用于签署我们不想被篡改的数据。公钥用于验证签名。 package noobchain; import java.security.*; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; public Wallet(){ generateKeyPair(); } public void generateKeyPair() { try { KeyPairGenerator keyGen = KeyPairGenerator.getInstance(&quot;ECDSA&quot;,&quot;BC&quot;); SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;); ECGenParameterSpec ecSpec = new ECGenParameterSpec(&quot;prime192v1&quot;); // Initialize the key generator and generate a KeyPair keyGen.initialize(ecSpec, random); //256 bytes provides an acceptable security level KeyPair keyPair = keyGen.generateKeyPair(); // Set the public and private keys from the keyPair privateKey = keyPair.getPrivate(); publicKey = keyPair.getPublic(); }catch(Exception e) { throw new RuntimeException(e); } } } 你不需要完全理解椭圆曲线加密算法的核心逻辑究竟是什么，你只需要它是用来创建公钥和私钥，以及公钥和私钥分别所起到的作用是什么就可以了。 现在我们已经又了钱包类的大概框架，下面我们再来看一下交易类。 交易和数字签名 每笔交易将携带一定以下信息： 资金付款人的公匙信息。 资金收款人的公匙信息。 被转移资金的金额。 输入，它是对以前的交易的引用，证明发送者有资金发送。 输出，显示交易中收款方相关地址数量。(这些输出被引用为新交易的输入) 一个加密签名，证明该交易是由地址的发送者是发送的，并且数据没有被更改。(阻止第三方机构更改发送的数量) 让我们创建这个新的交易类： import java.security.*; import java.util.ArrayList; public class Transaction { public String transactionId; // this is also the hash of the transaction. public PublicKey sender; // senders address/public key. public PublicKey reciepient; // Recipients address/public key. public float value; public byte[] signature; // this is to prevent anybody else from spending funds in our wallet. public ArrayList&lt;TransactionInput&gt; inputs = new ArrayList&lt;TransactionInput&gt;(); public ArrayList&lt;TransactionOutput&gt; outputs = new ArrayList&lt;TransactionOutput&gt;(); private static int sequence = 0; // a rough count of how many transactions have been generated. // Constructor: public Transaction(PublicKey from, PublicKey to, float value, ArrayList&lt;TransactionInput&gt; inputs) { this.sender = from; this.reciepient = to; this.value = value; this.inputs = inputs; } // This Calculates the transaction hash (which will be used as its Id) private String calulateHash() { sequence++; //increase the sequence to avoid 2 identical transactions having the same hash return StringUtil.applySha256( StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) + sequence ); } } 我们还应该创建空的transactioninput和transactionoutput类，不要担心我们可以在后面填写它们。 我们的交易类还将包含生成/验证签名和验证交易的相关方法，那么签名的意图是什么？签名在我们的区块链中执行了两个非常重要的任务：第一，签名用来保证只有货币的拥有者才可以用来发送自己的货币，第二，签名用来阻止其他人试图篡改提交的交易。 即私钥被用来签名数据，而公钥用来验证其完整性。 举个例子：Bob 想要发送2个加密货币给Sally，他们用各自的钱包创建了交易，并提交到全网的区块链中作为一个新的区块，一个挖矿者试图篡改接受者把2个加密货币给John，但是幸运的事，Bob在交易数据中已经用私钥进行了签名，这就允许了全网中的任何节点使用小明的公匙进行验证数据是否已经被篡改（因为没有其他人的公钥可以用来验证小明发出的这笔交易）。 从前面的代码中我们可以看到我们的签名将是一堆字符串，所以让我们创建一个方法来生成它们。首先我们在StringUtil类中创建产生签名的方法。 public static byte[] applyECDSASig(PrivateKey privateKey, String input) { Signature dsa; byte[] output = new byte[0]; try { dsa = Signature.getInstance(&quot;ECDSA&quot;, &quot;BC&quot;); dsa.initSign(privateKey); byte[] strByte = input.getBytes(); dsa.update(strByte); byte[] realSig = dsa.sign(); output = realSig; } catch (Exception e) { throw new RuntimeException(e); } return output; } //Verifies a String signature public static boolean verifyECDSASig(PublicKey publicKey, String data, byte[] signature) { try { Signature ecdsaVerify = Signature.getInstance(&quot;ECDSA&quot;, &quot;BC&quot;); ecdsaVerify.initVerify(publicKey); ecdsaVerify.update(data.getBytes()); return ecdsaVerify.verify(signature); }catch(Exception e) { throw new RuntimeException(e); } } public static String getStringFromKey(Key key) { return Base64.getEncoder().encodeToString(key.getEncoded()); } 不用担心你不能理解这些方法的内容，你所需要知道的就是applyECDSASig方法的输入参数为付款人的私钥和需要加密的数据信息，签名后返回字节数组。而verifyECDSASig方法的输入参数为公钥、加密的数据和签名，调用该方法后返回true或false来说明签名是否是有效的。getStringFromKey返回任何key的编码字符串 让我们使用签名的方法在交易类中，增加generatesiganature()&nbsp;和&nbsp;varifiysignature()方法： //Signs all the data we dont wish to be tampered with. public void generateSignature(PrivateKey privateKey) { String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) ; signature = StringUtil.applyECDSASig(privateKey,data); } //Verifies the data we signed hasnt been tampered with public boolean verifiySignature() { String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) ; return StringUtil.verifyECDSASig(sender, data, signature); } 在现实中，您可能希望签名更多信息，例如使用的输出/输入和/或时间戳（现在我们只是签名最低限度的信息） 签名将由矿工验证，只有签名验证成功后交易才能被添加到区块中去。 当我们检查区块链的有效性时，我们也可以检查签名 测试钱包和签名 现在我们简单的进行一些测试，在主方法中，我们增加了一些新的变量也替换了我们之前在主方法中的一些内容。 import java.security.Security; import java.util.ArrayList; import java.util.Base64; import com.google.gson.GsonBuilder; public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static int difficulty = 5; public static Wallet walletA; public static Wallet walletB; public static void main(String[] args) { //Setup Bouncey castle as a Security Provider Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Create the new wallets walletA = new Wallet(); walletB = new Wallet(); //Test public and private keys System.out.println(&quot;Private and public keys:&quot;); System.out.println(StringUtil.getStringFromKey(walletA.privateKey)); System.out.println(StringUtil.getStringFromKey(walletA.publicKey)); //Create a test transaction from WalletA to walletB Transaction transaction = new Transaction(walletA.publicKey, walletB.publicKey, 5, null); transaction.generateSignature(walletA.privateKey); //Verify the signature works and verify it from the public key System.out.println(&quot;Is signature verified&quot;); System.out.println(transaction.verifiySignature()); } 确定要添加bounceycastle依赖 我们创建了两个钱包walleta和walletb，然后打印了walleta的私钥和公钥。生成一个交易并使用walleta的私钥对其进行签名。 打印 Connected to the target VM, address: &#39;127.0.0.1:55757&#39;, transport: &#39;socket&#39; Private and public keys: MHsCAQAwEwYHKoZIzj0CAQYIKoZIzj0DAQEEYTBfAgEBBBiJzZiesBnBWwwB+uog+fJX84mx4lPUTUagCgYIKoZIzj0DAQGhNAMyAAQfPzad0zqBUGQAany2rRZE1+2ml5IOCZST8LywjBQT8ux+3UPVbr2u0+LaExxz1WI= MEkwEwYHKoZIzj0CAQYIKoZIzj0DAQEDMgAEHz82ndM6gVBkAGp8tq0WRNftppeSDgmUk/C8sIwUE/Lsft1D1W69rtPi2hMcc9Vi Is signature verified true 接下来我们将创建并验证输入和输出，并把交易保存到区块链中去。 输入和输出 1：如何验证货币是你的 如果你拥有1比特币，你必须前面就得接收1比特币。比特币的账本不会在你的账户中增加一个比特币也不会从发送者那里减去一个比特币，发送者只能指向他/她之前收到过一个比特币，所以一个交易输出被创建用来显示一个比特币发送给你的地址（交易的输入指向前一个交易的输出）。 你的钱包余额是所有未使用的交易输出的总和 从这一个点出发，我们会依照比特币中的说明，把所有未使用的交易输出称为UTXO. 创建TransactionInput&nbsp;类： public class TransactionInput { public String transactionOutputId; //Reference to TransactionOutputs -&gt; transactionId public TransactionOutput UTXO; //Contains the Unspent transaction output public TransactionInput(String transactionOutputId) { this.transactionOutputId = transactionOutputId; } } 这个类将用于引用尚未使用的transactionoutput。transactionOutputId将用于查找相关的TransactionOutput，允许矿工检查您的所有权。 创建TransactionOutputs&nbsp;类： import java.security.PublicKey; public class TransactionOutput { public String id; public PublicKey reciepient; //also known as the new owner of these coins. public float value; //the amount of coins they own public String parentTransactionId; //the id of the transaction this output was created in //Constructor public TransactionOutput(PublicKey reciepient, float value, String parentTransactionId) { this.reciepient = reciepient; this.value = value; this.parentTransactionId = parentTransactionId; this.id = StringUtil.applySha256(StringUtil.getStringFromKey(reciepient)+Float.toString(value)+parentTransactionId); } //Check if coin belongs to you public boolean isMine(PublicKey publicKey) { return (publicKey == reciepient); } } 交易输出类将显示从交易中发送给每一方的最终金额。这些作为新交易中的输入参考，作为证明你可以发送的金额数量。 输入和输出 2：处理交易 区块链可能会收到很多交易，而区块链可能会非常长，因为我们必须查找并检查其输入，所以可能需要非常长的时间来处理新的交易。为了解决这个问题，我们保存了一个额外的集合称之为为使用的交易作为可用的输入,所以在主函数中增加一个集合称为UTXO。 public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static HashMap&lt;String,TransactionOutputs&gt; UTXOs = new HashMap&lt;String,TransactionOutputs&gt;(); //list of all unspent transactions. public static int difficulty = 5; public static Wallet walletA; public static Wallet walletB; public static void main(String[] args) { hashmap允许我们使用键来查找值，但是您需要导入java.util.hashmap 重点来了，我们在交易类中增加一个processTransaction方法，这个方法是把一切放在一起用来处理交易。 //Returns true if new transaction could be created. public boolean processTransaction() { if(verifiySignature() == false) { System.out.println(&quot;#Transaction Signature failed to verify&quot;); return false; } //gather transaction inputs (Make sure they are unspent): for(TransactionInput i : inputs) { i.UTXO = NoobChain.UTXOs.get(i.transactionOutputId); } //check if transaction is valid: if(getInputsValue() &lt; NoobChain.minimumTransaction) { System.out.println(&quot;#Transaction Inputs to small: &quot; + getInputsValue()); return false; } //generate transaction outputs: float leftOver = getInputsValue() - value; //get value of inputs then the left over change: transactionId = calulateHash(); outputs.add(new TransactionOutput( this.reciepient, value,transactionId)); //send value to recipient outputs.add(new TransactionOutput( this.sender, leftOver,transactionId)); //send the left over &#39;change&#39; back to sender //add outputs to Unspent list for(TransactionOutput o : outputs) { NoobChain.UTXOs.put(o.id , o); } //remove transaction inputs from UTXO lists as spent: for(TransactionInput i : inputs) { if(i.UTXO == null) continue; //if Transaction can&#39;t be found skip it NoobChain.UTXOs.remove(i.UTXO.id); } return true; } //returns sum of inputs(UTXOs) values public float getInputsValue() { float total = 0; for(TransactionInput i : inputs) { if(i.UTXO == null) continue; //if Transaction can&#39;t be found skip it total += i.UTXO.value; } return total; } //returns sum of outputs: public float getOutputsValue() { float total = 0; for(TransactionOutput o : outputs) { total += o.value; } return total; } 我们还添加了getinputsvalue方法 通过这种方法，我们执行一些检查以确保交易有效，然后收集输入并生成输出。最重要的是，最后，我们抛弃了输入在我们的UTXO列表，这就意味着一个可以使用的交易输出必须之前一定是输入，所以输入的值必须被完全使用，所以付款人必须改变它们自身的金额状态。 红色箭头是输出。请注意，绿色输入是对之前输出的参考 最后让我们修改我们的wallet类 搜集余额（通过循环遍历UTXO列表来检查交易的输出是否是我的）并 创建交易 import java.security.*; import java.security.spec.ECGenParameterSpec; import java.util.ArrayList; import java.util.HashMap; import java.util.Map; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; public HashMap&lt;String,TransactionOutput&gt; UTXOs = new HashMap&lt;String,TransactionOutput&gt;(); //only UTXOs owned by this wallet. public Wallet() {... public void generateKeyPair() {... //returns balance and stores the UTXO&#39;s owned by this wallet in this.UTXOs public float getBalance() { float total = 0; for (Map.Entry&lt;String, TransactionOutput&gt; item: NoobChain.UTXOs.entrySet()){ TransactionOutput UTXO = item.getValue(); if(UTXO.isMine(publicKey)) { //if output belongs to me ( if coins belong to me ) UTXOs.put(UTXO.id,UTXO); //add it to our list of unspent transactions. total += UTXO.value ; } } return total; } //Generates and returns a new transaction from this wallet. public Transaction sendFunds(PublicKey _recipient,float value ) { if(getBalance() &lt; value) { //gather balance and check funds. System.out.println(&quot;#Not Enough funds to send transaction. Transaction Discarded.&quot;); return null; } //create array list of inputs ArrayList&lt;TransactionInput&gt; inputs = new ArrayList&lt;TransactionInput&gt;(); float total = 0; for (Map.Entry&lt;String, TransactionOutput&gt; item: UTXOs.entrySet()){ TransactionOutput UTXO = item.getValue(); total += UTXO.value; inputs.add(new TransactionInput(UTXO.id)); if(total &gt; value) break; } Transaction newTransaction = new Transaction(publicKey, _recipient , value, inputs); newTransaction.generateSignature(privateKey); for(TransactionInput input: inputs){ UTXOs.remove(input.transactionOutputId); } return newTransaction; } } 你可以随时为钱包添加一些其他功能，例如记录您的交易历史记录。 添加交易到区块中 现在我们已经有了一个有效的交易系统，我们需要把交易加入到我们的区块链中。我们把交易列表替换我们块中无用的数据，但是在一个单一的区块中可能存放了1000个交易，这就会导致大量的hash计算，不用担心在这里我们使用了交易的merkle root，稍后你会看到。让我们增加一个帮助方法来创建merkle root在StringUtils类中。 在StringUtils类中创建getMerkleRoot方法 //Tacks in array of transactions and returns a merkle root. public static String getMerkleRoot(ArrayList&lt;Transaction&gt; transactions) { int count = transactions.size(); ArrayList&lt;String&gt; previousTreeLayer = new ArrayList&lt;String&gt;(); for(Transaction transaction : transactions) { previousTreeLayer.add(transaction.transactionId); } ArrayList&lt;String&gt; treeLayer = previousTreeLayer; while(count &gt; 1) { treeLayer = new ArrayList&lt;String&gt;(); for(int i=1; i &lt; previousTreeLayer.size(); i++) { treeLayer.add(applySha256(previousTreeLayer.get(i-1) + previousTreeLayer.get(i))); } count = treeLayer.size(); previousTreeLayer = treeLayer; } String merkleRoot = (treeLayer.size() == 1) ? treeLayer.get(0) : &quot;&quot;; return merkleRoot; } 我会尽快用一个实际的merkleroot取代这个方法，但是现在使用这个可以正常运行 修来Block&nbsp;类 import java.util.ArrayList; import java.util.Date; public class Block { public String hash; public String previousHash; public String merkleRoot; public ArrayList&lt;Transaction&gt; transactions = new ArrayList&lt;Transaction&gt;(); //our data will be a simple message. public long timeStamp; //as number of milliseconds since 1/1/1970. public int nonce; //Block Constructor. public Block(String previousHash ) { this.previousHash = previousHash; this.timeStamp = new Date().getTime(); this.hash = calculateHash(); //Making sure we do this after we set the other values. } //Calculate new hash based on blocks contents public String calculateHash() { String calculatedhash = StringUtil.applySha256( previousHash + Long.toString(timeStamp) + Integer.toString(nonce) + merkleRoot ); return calculatedhash; } //Increases nonce value until hash target is reached. public void mineBlock(int difficulty) { merkleRoot = StringUtil.getMerkleRoot(transactions); String target = StringUtil.getDificultyString(difficulty); //Create a string with difficulty * &quot;0&quot; while(!hash.substring( 0, difficulty).equals(target)) { nonce ++; hash = calculateHash(); } System.out.println(&quot;Block Mined!!! : &quot; + hash); } //Add transactions to this block public boolean addTransaction(Transaction transaction) { //process transaction and check if valid, unless block is genesis block then ignore. if(transaction == null) return false; if((previousHash != &quot;0&quot;)) { if((transaction.processTransaction() != true)) { System.out.println(&quot;Transaction failed to process. Discarded.&quot;); return false; } } transactions.add(transaction); System.out.println(&quot;Transaction Successfully added to Block&quot;); return true; } } 需要注意的是我们还更新了Block构造函数，因为我们不再需要传递字符串数据，并将merkle root包含在计算哈希方法中。addTransaction方法用来增加交易，只有满足条件下才可以成功的在区块中增加交易。 我们已经实现了一个可交易的区块链。 最后的测试 我们应该测试从钱包发送货币，更新区块链并进行有效性检查。但首先我们需要一种将新硬币引入混合的方法。有很多方法来创建新的硬币。在比特币区块链上，有很多方法可以创造新的比特币:矿工可以将交易包括在内，作为对每个矿工挖矿的奖励。但在这里我们只希望在创世纪区块中释放货币。就像比特币中一下，所以我们修改我们的主函数以达到下面的目的。 创世纪区块发布100个货币给walletA 一个更新的链有效性检查，考虑到交易。 测试交易看是否一切正常。 public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static HashMap&lt;String,TransactionOutput&gt; UTXOs = new HashMap&lt;String,TransactionOutput&gt;(); public static int difficulty = 3; public static float minimumTransaction = 0.1f; public static Wallet walletA; public static Wallet walletB; public static Transaction genesisTransaction; public static void main(String[] args) { //add our blocks to the blockchain ArrayList: Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Setup Bouncey castle as a Security Provider //Create wallets: walletA = new Wallet(); walletB = new Wallet(); Wallet coinbase = new Wallet(); //create genesis transaction, which sends 100 NoobCoin to walletA: genesisTransaction = new Transaction(coinbase.publicKey, walletA.publicKey, 100f, null); genesisTransaction.generateSignature(coinbase.privateKey); //manually sign the genesis transaction genesisTransaction.transactionId = &quot;0&quot;; //manually set the transaction id genesisTransaction.outputs.add(new TransactionOutput(genesisTransaction.reciepient, genesisTransaction.value, genesisTransaction.transactionId)); //manually add the Transactions Output UTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //its important to store our first transaction in the UTXOs list. System.out.println(&quot;Creating and Mining Genesis block... &quot;); Block genesis = new Block(&quot;0&quot;); genesis.addTransaction(genesisTransaction); addBlock(genesis); //testing Block block1 = new Block(genesis.hash); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;\nWalletA is Attempting to send funds (40) to WalletB...&quot;); block1.addTransaction(walletA.sendFunds(walletB.publicKey, 40f)); addBlock(block1); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); Block block2 = new Block(block1.hash); System.out.println(&quot;\nWalletA Attempting to send more funds (1000) than it has...&quot;); block2.addTransaction(walletA.sendFunds(walletB.publicKey, 1000f)); addBlock(block2); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); Block block3 = new Block(block2.hash); System.out.println(&quot;\nWalletB is Attempting to send funds (20) to WalletA...&quot;); block3.addTransaction(walletB.sendFunds( walletA.publicKey, 20)); System.out.println(&quot;\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); isChainValid(); } public static Boolean isChainValid() { Block currentBlock; Block previousBlock; String hashTarget = new String(new char[difficulty]).replace(&#39;\0&#39;, &#39;0&#39;); HashMap&lt;String,TransactionOutput&gt; tempUTXOs = new HashMap&lt;String,TransactionOutput&gt;(); //a temporary working list of unspent transactions at a given block state. tempUTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //loop through blockchain to check hashes: for(int i=1; i &lt; blockchain.size(); i++) { currentBlock = blockchain.get(i); previousBlock = blockchain.get(i-1); //compare registered hash and calculated hash: if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){ System.out.println(&quot;#Current Hashes not equal&quot;); return false; } //compare previous hash and registered previous hash if(!previousBlock.hash.equals(currentBlock.previousHash) ) { System.out.println(&quot;#Previous Hashes not equal&quot;); return false; } //check if hash is solved if(!currentBlock.hash.substring( 0, difficulty).equals(hashTarget)) { System.out.println(&quot;#This block hasn&#39;t been mined&quot;); return false; } //loop thru blockchains transactions: TransactionOutput tempOutput; for(int t=0; t &lt;currentBlock.transactions.size(); t++) { Transaction currentTransaction = currentBlock.transactions.get(t); if(!currentTransaction.verifiySignature()) { System.out.println(&quot;#Signature on Transaction(&quot; + t + &quot;) is Invalid&quot;); return false; } if(currentTransaction.getInputsValue() != currentTransaction.getOutputsValue()) { System.out.println(&quot;#Inputs are note equal to outputs on Transaction(&quot; + t + &quot;)&quot;); return false; } for(TransactionInput input: currentTransaction.inputs) { tempOutput = tempUTXOs.get(input.transactionOutputId); if(tempOutput == null) { System.out.println(&quot;#Referenced input on Transaction(&quot; + t + &quot;) is Missing&quot;); return false; } if(input.UTXO.value != tempOutput.value) { System.out.println(&quot;#Referenced input Transaction(&quot; + t + &quot;) value is Invalid&quot;); return false; } tempUTXOs.remove(input.transactionOutputId); } for(TransactionOutput output: currentTransaction.outputs) { tempUTXOs.put(output.id, output); } if( currentTransaction.outputs.get(0).reciepient != currentTransaction.reciepient) { System.out.println(&quot;#Transaction(&quot; + t + &quot;) output reciepient is not who it should be&quot;); return false; } if( currentTransaction.outputs.get(1).reciepient != currentTransaction.sender) { System.out.println(&quot;#Transaction(&quot; + t + &quot;) output &#39;change&#39; is not sender.&quot;); return false; } } } System.out.println(&quot;Blockchain is valid&quot;); return true; } public static void addBlock(Block newBlock) { newBlock.mineBlock(difficulty); blockchain.add(newBlock); } } 打印： Connected to the target VM, address: &#39;127.0.0.1:57085&#39;, transport: &#39;socket&#39; Creating and Mining Genesis block... Transaction Successfully added to Block Block Mined!!! : 000b5a7ca6bf07639122cb31e884996895a482c281dd89c203824f1e93a661bf WalletA&#39;s balance is: 100.0 WalletA is Attempting to send funds (40) to WalletB... Transaction Successfully added to Block Block Mined!!! : 000c7f814357abfea86ad1b38ec1dc3afed2afc9107f2bacc933d8136bf34df0 WalletA&#39;s balance is: 60.0 WalletB&#39;s balance is: 40.0 WalletA Attempting to send more funds (1000) than it has... #Not Enough funds to send transaction. Transaction Discarded. Block Mined!!! : 000b3822fb7985db438712816727d4bc382926a1c4654062aad4071d9b9fad98 WalletA&#39;s balance is: 60.0 WalletB&#39;s balance is: 40.0 WalletB is Attempting to send funds (20) to WalletA... Transaction Successfully added to Block WalletA&#39;s balance is: 80.0 WalletB&#39;s balance is: 20.0 Blockchain is valid 现在钱包能够安全地在您的区块链上发送金额，只要他们有金额发送。这意味着你有你自己的本地加密货币 可以进行交易的区块链 你已经成功地创建了自己的加密货币。你的区块链： 允许用户创建钱包 使用椭圆曲线加密方式为钱包提供公钥和私钥 通过使用数字签名算法证明所有权，确保资金转移 允许用户在区块链上进行交易 项目地址：https://github.com/pibigstar/blockchain 转载自：https://longfeizheng.github.io/2018/03/11/用Java创建你的第一个区块链-part2/ 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/29/200ffb87678c818a0e1c3f9a82d97728.html" />
<meta property="og:url" content="https://mlh.app/2018/03/29/200ffb87678c818a0e1c3f9a82d97728.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"本章目标 创建一个简单的钱包。 使用我们的区块链发送带签名的交易。 这样我们就有自己的加密货币 值得注意的是，这里创建的区块链并不是功能完全的完全适合应用与生产的区块链，相反只是为了帮助你更好的理解区块链的概念。 别担心，这实际上是很简单的，但比上一个教程要长! 在上一章节，我们已经有了一个基本的区块链，但在区块链中存放的是一些无用的信息。今天我们将用交易取代这些信息（我们的区块将能够保存多个交易），允许我们创建一个非常简单的加密货币,我们的货币名字pibigstar。 本教程是在上一边基础上实现的 导入&nbsp;bounceycastle和GSON 准备一个钱包 在加密货币中，在区块链作为交易时，货币所有权可以进行转移，每个参与者都有一个自己私有的地址来发送或者是收取货币。，钱包可以存储这些地址。因此钱包就是可以在区块链上进行新交易的软件。 Don’t worry about the information on the transaction, that will be explained soon 让我们创建一个钱包类来保存公钥和私钥: package noobchain; import java.security.*; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; } 公钥和私钥究竟是起到什么作用呢，其实公钥的作用就是地址，你可以分享你的公钥给别人以此来获取付款，而你的私钥的作用是为了对交易进行签名，这样其他人就不可以花费你的金额除非它拥有你的私钥，所以对于每个人而言我们必须保护好我们的私钥，不能透露我们的私钥信息给其他人。同时在我们进行交易的时候我们也会同时发送我们的公钥由此来验证我们的签名是有效的而且没有数据被篡改。 我们在密钥对KeyPair生成私有和公钥。我们将使用椭圆曲线加密来生成我们的密钥对KeyPair。让我们将generateKeyPair()方法添加到我们的钱包类中，并在构造函数中调用它: 私钥用于签署我们不想被篡改的数据。公钥用于验证签名。 package noobchain; import java.security.*; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; public Wallet(){ generateKeyPair(); } public void generateKeyPair() { try { KeyPairGenerator keyGen = KeyPairGenerator.getInstance(&quot;ECDSA&quot;,&quot;BC&quot;); SecureRandom random = SecureRandom.getInstance(&quot;SHA1PRNG&quot;); ECGenParameterSpec ecSpec = new ECGenParameterSpec(&quot;prime192v1&quot;); // Initialize the key generator and generate a KeyPair keyGen.initialize(ecSpec, random); //256 bytes provides an acceptable security level KeyPair keyPair = keyGen.generateKeyPair(); // Set the public and private keys from the keyPair privateKey = keyPair.getPrivate(); publicKey = keyPair.getPublic(); }catch(Exception e) { throw new RuntimeException(e); } } } 你不需要完全理解椭圆曲线加密算法的核心逻辑究竟是什么，你只需要它是用来创建公钥和私钥，以及公钥和私钥分别所起到的作用是什么就可以了。 现在我们已经又了钱包类的大概框架，下面我们再来看一下交易类。 交易和数字签名 每笔交易将携带一定以下信息： 资金付款人的公匙信息。 资金收款人的公匙信息。 被转移资金的金额。 输入，它是对以前的交易的引用，证明发送者有资金发送。 输出，显示交易中收款方相关地址数量。(这些输出被引用为新交易的输入) 一个加密签名，证明该交易是由地址的发送者是发送的，并且数据没有被更改。(阻止第三方机构更改发送的数量) 让我们创建这个新的交易类： import java.security.*; import java.util.ArrayList; public class Transaction { public String transactionId; // this is also the hash of the transaction. public PublicKey sender; // senders address/public key. public PublicKey reciepient; // Recipients address/public key. public float value; public byte[] signature; // this is to prevent anybody else from spending funds in our wallet. public ArrayList&lt;TransactionInput&gt; inputs = new ArrayList&lt;TransactionInput&gt;(); public ArrayList&lt;TransactionOutput&gt; outputs = new ArrayList&lt;TransactionOutput&gt;(); private static int sequence = 0; // a rough count of how many transactions have been generated. // Constructor: public Transaction(PublicKey from, PublicKey to, float value, ArrayList&lt;TransactionInput&gt; inputs) { this.sender = from; this.reciepient = to; this.value = value; this.inputs = inputs; } // This Calculates the transaction hash (which will be used as its Id) private String calulateHash() { sequence++; //increase the sequence to avoid 2 identical transactions having the same hash return StringUtil.applySha256( StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) + sequence ); } } 我们还应该创建空的transactioninput和transactionoutput类，不要担心我们可以在后面填写它们。 我们的交易类还将包含生成/验证签名和验证交易的相关方法，那么签名的意图是什么？签名在我们的区块链中执行了两个非常重要的任务：第一，签名用来保证只有货币的拥有者才可以用来发送自己的货币，第二，签名用来阻止其他人试图篡改提交的交易。 即私钥被用来签名数据，而公钥用来验证其完整性。 举个例子：Bob 想要发送2个加密货币给Sally，他们用各自的钱包创建了交易，并提交到全网的区块链中作为一个新的区块，一个挖矿者试图篡改接受者把2个加密货币给John，但是幸运的事，Bob在交易数据中已经用私钥进行了签名，这就允许了全网中的任何节点使用小明的公匙进行验证数据是否已经被篡改（因为没有其他人的公钥可以用来验证小明发出的这笔交易）。 从前面的代码中我们可以看到我们的签名将是一堆字符串，所以让我们创建一个方法来生成它们。首先我们在StringUtil类中创建产生签名的方法。 public static byte[] applyECDSASig(PrivateKey privateKey, String input) { Signature dsa; byte[] output = new byte[0]; try { dsa = Signature.getInstance(&quot;ECDSA&quot;, &quot;BC&quot;); dsa.initSign(privateKey); byte[] strByte = input.getBytes(); dsa.update(strByte); byte[] realSig = dsa.sign(); output = realSig; } catch (Exception e) { throw new RuntimeException(e); } return output; } //Verifies a String signature public static boolean verifyECDSASig(PublicKey publicKey, String data, byte[] signature) { try { Signature ecdsaVerify = Signature.getInstance(&quot;ECDSA&quot;, &quot;BC&quot;); ecdsaVerify.initVerify(publicKey); ecdsaVerify.update(data.getBytes()); return ecdsaVerify.verify(signature); }catch(Exception e) { throw new RuntimeException(e); } } public static String getStringFromKey(Key key) { return Base64.getEncoder().encodeToString(key.getEncoded()); } 不用担心你不能理解这些方法的内容，你所需要知道的就是applyECDSASig方法的输入参数为付款人的私钥和需要加密的数据信息，签名后返回字节数组。而verifyECDSASig方法的输入参数为公钥、加密的数据和签名，调用该方法后返回true或false来说明签名是否是有效的。getStringFromKey返回任何key的编码字符串 让我们使用签名的方法在交易类中，增加generatesiganature()&nbsp;和&nbsp;varifiysignature()方法： //Signs all the data we dont wish to be tampered with. public void generateSignature(PrivateKey privateKey) { String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) ; signature = StringUtil.applyECDSASig(privateKey,data); } //Verifies the data we signed hasnt been tampered with public boolean verifiySignature() { String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value) ; return StringUtil.verifyECDSASig(sender, data, signature); } 在现实中，您可能希望签名更多信息，例如使用的输出/输入和/或时间戳（现在我们只是签名最低限度的信息） 签名将由矿工验证，只有签名验证成功后交易才能被添加到区块中去。 当我们检查区块链的有效性时，我们也可以检查签名 测试钱包和签名 现在我们简单的进行一些测试，在主方法中，我们增加了一些新的变量也替换了我们之前在主方法中的一些内容。 import java.security.Security; import java.util.ArrayList; import java.util.Base64; import com.google.gson.GsonBuilder; public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static int difficulty = 5; public static Wallet walletA; public static Wallet walletB; public static void main(String[] args) { //Setup Bouncey castle as a Security Provider Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Create the new wallets walletA = new Wallet(); walletB = new Wallet(); //Test public and private keys System.out.println(&quot;Private and public keys:&quot;); System.out.println(StringUtil.getStringFromKey(walletA.privateKey)); System.out.println(StringUtil.getStringFromKey(walletA.publicKey)); //Create a test transaction from WalletA to walletB Transaction transaction = new Transaction(walletA.publicKey, walletB.publicKey, 5, null); transaction.generateSignature(walletA.privateKey); //Verify the signature works and verify it from the public key System.out.println(&quot;Is signature verified&quot;); System.out.println(transaction.verifiySignature()); } 确定要添加bounceycastle依赖 我们创建了两个钱包walleta和walletb，然后打印了walleta的私钥和公钥。生成一个交易并使用walleta的私钥对其进行签名。 打印 Connected to the target VM, address: &#39;127.0.0.1:55757&#39;, transport: &#39;socket&#39; Private and public keys: MHsCAQAwEwYHKoZIzj0CAQYIKoZIzj0DAQEEYTBfAgEBBBiJzZiesBnBWwwB+uog+fJX84mx4lPUTUagCgYIKoZIzj0DAQGhNAMyAAQfPzad0zqBUGQAany2rRZE1+2ml5IOCZST8LywjBQT8ux+3UPVbr2u0+LaExxz1WI= MEkwEwYHKoZIzj0CAQYIKoZIzj0DAQEDMgAEHz82ndM6gVBkAGp8tq0WRNftppeSDgmUk/C8sIwUE/Lsft1D1W69rtPi2hMcc9Vi Is signature verified true 接下来我们将创建并验证输入和输出，并把交易保存到区块链中去。 输入和输出 1：如何验证货币是你的 如果你拥有1比特币，你必须前面就得接收1比特币。比特币的账本不会在你的账户中增加一个比特币也不会从发送者那里减去一个比特币，发送者只能指向他/她之前收到过一个比特币，所以一个交易输出被创建用来显示一个比特币发送给你的地址（交易的输入指向前一个交易的输出）。 你的钱包余额是所有未使用的交易输出的总和 从这一个点出发，我们会依照比特币中的说明，把所有未使用的交易输出称为UTXO. 创建TransactionInput&nbsp;类： public class TransactionInput { public String transactionOutputId; //Reference to TransactionOutputs -&gt; transactionId public TransactionOutput UTXO; //Contains the Unspent transaction output public TransactionInput(String transactionOutputId) { this.transactionOutputId = transactionOutputId; } } 这个类将用于引用尚未使用的transactionoutput。transactionOutputId将用于查找相关的TransactionOutput，允许矿工检查您的所有权。 创建TransactionOutputs&nbsp;类： import java.security.PublicKey; public class TransactionOutput { public String id; public PublicKey reciepient; //also known as the new owner of these coins. public float value; //the amount of coins they own public String parentTransactionId; //the id of the transaction this output was created in //Constructor public TransactionOutput(PublicKey reciepient, float value, String parentTransactionId) { this.reciepient = reciepient; this.value = value; this.parentTransactionId = parentTransactionId; this.id = StringUtil.applySha256(StringUtil.getStringFromKey(reciepient)+Float.toString(value)+parentTransactionId); } //Check if coin belongs to you public boolean isMine(PublicKey publicKey) { return (publicKey == reciepient); } } 交易输出类将显示从交易中发送给每一方的最终金额。这些作为新交易中的输入参考，作为证明你可以发送的金额数量。 输入和输出 2：处理交易 区块链可能会收到很多交易，而区块链可能会非常长，因为我们必须查找并检查其输入，所以可能需要非常长的时间来处理新的交易。为了解决这个问题，我们保存了一个额外的集合称之为为使用的交易作为可用的输入,所以在主函数中增加一个集合称为UTXO。 public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static HashMap&lt;String,TransactionOutputs&gt; UTXOs = new HashMap&lt;String,TransactionOutputs&gt;(); //list of all unspent transactions. public static int difficulty = 5; public static Wallet walletA; public static Wallet walletB; public static void main(String[] args) { hashmap允许我们使用键来查找值，但是您需要导入java.util.hashmap 重点来了，我们在交易类中增加一个processTransaction方法，这个方法是把一切放在一起用来处理交易。 //Returns true if new transaction could be created. public boolean processTransaction() { if(verifiySignature() == false) { System.out.println(&quot;#Transaction Signature failed to verify&quot;); return false; } //gather transaction inputs (Make sure they are unspent): for(TransactionInput i : inputs) { i.UTXO = NoobChain.UTXOs.get(i.transactionOutputId); } //check if transaction is valid: if(getInputsValue() &lt; NoobChain.minimumTransaction) { System.out.println(&quot;#Transaction Inputs to small: &quot; + getInputsValue()); return false; } //generate transaction outputs: float leftOver = getInputsValue() - value; //get value of inputs then the left over change: transactionId = calulateHash(); outputs.add(new TransactionOutput( this.reciepient, value,transactionId)); //send value to recipient outputs.add(new TransactionOutput( this.sender, leftOver,transactionId)); //send the left over &#39;change&#39; back to sender //add outputs to Unspent list for(TransactionOutput o : outputs) { NoobChain.UTXOs.put(o.id , o); } //remove transaction inputs from UTXO lists as spent: for(TransactionInput i : inputs) { if(i.UTXO == null) continue; //if Transaction can&#39;t be found skip it NoobChain.UTXOs.remove(i.UTXO.id); } return true; } //returns sum of inputs(UTXOs) values public float getInputsValue() { float total = 0; for(TransactionInput i : inputs) { if(i.UTXO == null) continue; //if Transaction can&#39;t be found skip it total += i.UTXO.value; } return total; } //returns sum of outputs: public float getOutputsValue() { float total = 0; for(TransactionOutput o : outputs) { total += o.value; } return total; } 我们还添加了getinputsvalue方法 通过这种方法，我们执行一些检查以确保交易有效，然后收集输入并生成输出。最重要的是，最后，我们抛弃了输入在我们的UTXO列表，这就意味着一个可以使用的交易输出必须之前一定是输入，所以输入的值必须被完全使用，所以付款人必须改变它们自身的金额状态。 红色箭头是输出。请注意，绿色输入是对之前输出的参考 最后让我们修改我们的wallet类 搜集余额（通过循环遍历UTXO列表来检查交易的输出是否是我的）并 创建交易 import java.security.*; import java.security.spec.ECGenParameterSpec; import java.util.ArrayList; import java.util.HashMap; import java.util.Map; public class Wallet { public PrivateKey privateKey; public PublicKey publicKey; public HashMap&lt;String,TransactionOutput&gt; UTXOs = new HashMap&lt;String,TransactionOutput&gt;(); //only UTXOs owned by this wallet. public Wallet() {... public void generateKeyPair() {... //returns balance and stores the UTXO&#39;s owned by this wallet in this.UTXOs public float getBalance() { float total = 0; for (Map.Entry&lt;String, TransactionOutput&gt; item: NoobChain.UTXOs.entrySet()){ TransactionOutput UTXO = item.getValue(); if(UTXO.isMine(publicKey)) { //if output belongs to me ( if coins belong to me ) UTXOs.put(UTXO.id,UTXO); //add it to our list of unspent transactions. total += UTXO.value ; } } return total; } //Generates and returns a new transaction from this wallet. public Transaction sendFunds(PublicKey _recipient,float value ) { if(getBalance() &lt; value) { //gather balance and check funds. System.out.println(&quot;#Not Enough funds to send transaction. Transaction Discarded.&quot;); return null; } //create array list of inputs ArrayList&lt;TransactionInput&gt; inputs = new ArrayList&lt;TransactionInput&gt;(); float total = 0; for (Map.Entry&lt;String, TransactionOutput&gt; item: UTXOs.entrySet()){ TransactionOutput UTXO = item.getValue(); total += UTXO.value; inputs.add(new TransactionInput(UTXO.id)); if(total &gt; value) break; } Transaction newTransaction = new Transaction(publicKey, _recipient , value, inputs); newTransaction.generateSignature(privateKey); for(TransactionInput input: inputs){ UTXOs.remove(input.transactionOutputId); } return newTransaction; } } 你可以随时为钱包添加一些其他功能，例如记录您的交易历史记录。 添加交易到区块中 现在我们已经有了一个有效的交易系统，我们需要把交易加入到我们的区块链中。我们把交易列表替换我们块中无用的数据，但是在一个单一的区块中可能存放了1000个交易，这就会导致大量的hash计算，不用担心在这里我们使用了交易的merkle root，稍后你会看到。让我们增加一个帮助方法来创建merkle root在StringUtils类中。 在StringUtils类中创建getMerkleRoot方法 //Tacks in array of transactions and returns a merkle root. public static String getMerkleRoot(ArrayList&lt;Transaction&gt; transactions) { int count = transactions.size(); ArrayList&lt;String&gt; previousTreeLayer = new ArrayList&lt;String&gt;(); for(Transaction transaction : transactions) { previousTreeLayer.add(transaction.transactionId); } ArrayList&lt;String&gt; treeLayer = previousTreeLayer; while(count &gt; 1) { treeLayer = new ArrayList&lt;String&gt;(); for(int i=1; i &lt; previousTreeLayer.size(); i++) { treeLayer.add(applySha256(previousTreeLayer.get(i-1) + previousTreeLayer.get(i))); } count = treeLayer.size(); previousTreeLayer = treeLayer; } String merkleRoot = (treeLayer.size() == 1) ? treeLayer.get(0) : &quot;&quot;; return merkleRoot; } 我会尽快用一个实际的merkleroot取代这个方法，但是现在使用这个可以正常运行 修来Block&nbsp;类 import java.util.ArrayList; import java.util.Date; public class Block { public String hash; public String previousHash; public String merkleRoot; public ArrayList&lt;Transaction&gt; transactions = new ArrayList&lt;Transaction&gt;(); //our data will be a simple message. public long timeStamp; //as number of milliseconds since 1/1/1970. public int nonce; //Block Constructor. public Block(String previousHash ) { this.previousHash = previousHash; this.timeStamp = new Date().getTime(); this.hash = calculateHash(); //Making sure we do this after we set the other values. } //Calculate new hash based on blocks contents public String calculateHash() { String calculatedhash = StringUtil.applySha256( previousHash + Long.toString(timeStamp) + Integer.toString(nonce) + merkleRoot ); return calculatedhash; } //Increases nonce value until hash target is reached. public void mineBlock(int difficulty) { merkleRoot = StringUtil.getMerkleRoot(transactions); String target = StringUtil.getDificultyString(difficulty); //Create a string with difficulty * &quot;0&quot; while(!hash.substring( 0, difficulty).equals(target)) { nonce ++; hash = calculateHash(); } System.out.println(&quot;Block Mined!!! : &quot; + hash); } //Add transactions to this block public boolean addTransaction(Transaction transaction) { //process transaction and check if valid, unless block is genesis block then ignore. if(transaction == null) return false; if((previousHash != &quot;0&quot;)) { if((transaction.processTransaction() != true)) { System.out.println(&quot;Transaction failed to process. Discarded.&quot;); return false; } } transactions.add(transaction); System.out.println(&quot;Transaction Successfully added to Block&quot;); return true; } } 需要注意的是我们还更新了Block构造函数，因为我们不再需要传递字符串数据，并将merkle root包含在计算哈希方法中。addTransaction方法用来增加交易，只有满足条件下才可以成功的在区块中增加交易。 我们已经实现了一个可交易的区块链。 最后的测试 我们应该测试从钱包发送货币，更新区块链并进行有效性检查。但首先我们需要一种将新硬币引入混合的方法。有很多方法来创建新的硬币。在比特币区块链上，有很多方法可以创造新的比特币:矿工可以将交易包括在内，作为对每个矿工挖矿的奖励。但在这里我们只希望在创世纪区块中释放货币。就像比特币中一下，所以我们修改我们的主函数以达到下面的目的。 创世纪区块发布100个货币给walletA 一个更新的链有效性检查，考虑到交易。 测试交易看是否一切正常。 public class NoobChain { public static ArrayList&lt;Block&gt; blockchain = new ArrayList&lt;Block&gt;(); public static HashMap&lt;String,TransactionOutput&gt; UTXOs = new HashMap&lt;String,TransactionOutput&gt;(); public static int difficulty = 3; public static float minimumTransaction = 0.1f; public static Wallet walletA; public static Wallet walletB; public static Transaction genesisTransaction; public static void main(String[] args) { //add our blocks to the blockchain ArrayList: Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Setup Bouncey castle as a Security Provider //Create wallets: walletA = new Wallet(); walletB = new Wallet(); Wallet coinbase = new Wallet(); //create genesis transaction, which sends 100 NoobCoin to walletA: genesisTransaction = new Transaction(coinbase.publicKey, walletA.publicKey, 100f, null); genesisTransaction.generateSignature(coinbase.privateKey); //manually sign the genesis transaction genesisTransaction.transactionId = &quot;0&quot;; //manually set the transaction id genesisTransaction.outputs.add(new TransactionOutput(genesisTransaction.reciepient, genesisTransaction.value, genesisTransaction.transactionId)); //manually add the Transactions Output UTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //its important to store our first transaction in the UTXOs list. System.out.println(&quot;Creating and Mining Genesis block... &quot;); Block genesis = new Block(&quot;0&quot;); genesis.addTransaction(genesisTransaction); addBlock(genesis); //testing Block block1 = new Block(genesis.hash); System.out.println(&quot;\\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;\\nWalletA is Attempting to send funds (40) to WalletB...&quot;); block1.addTransaction(walletA.sendFunds(walletB.publicKey, 40f)); addBlock(block1); System.out.println(&quot;\\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); Block block2 = new Block(block1.hash); System.out.println(&quot;\\nWalletA Attempting to send more funds (1000) than it has...&quot;); block2.addTransaction(walletA.sendFunds(walletB.publicKey, 1000f)); addBlock(block2); System.out.println(&quot;\\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); Block block3 = new Block(block2.hash); System.out.println(&quot;\\nWalletB is Attempting to send funds (20) to WalletA...&quot;); block3.addTransaction(walletB.sendFunds( walletA.publicKey, 20)); System.out.println(&quot;\\nWalletA&#39;s balance is: &quot; + walletA.getBalance()); System.out.println(&quot;WalletB&#39;s balance is: &quot; + walletB.getBalance()); isChainValid(); } public static Boolean isChainValid() { Block currentBlock; Block previousBlock; String hashTarget = new String(new char[difficulty]).replace(&#39;\\0&#39;, &#39;0&#39;); HashMap&lt;String,TransactionOutput&gt; tempUTXOs = new HashMap&lt;String,TransactionOutput&gt;(); //a temporary working list of unspent transactions at a given block state. tempUTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //loop through blockchain to check hashes: for(int i=1; i &lt; blockchain.size(); i++) { currentBlock = blockchain.get(i); previousBlock = blockchain.get(i-1); //compare registered hash and calculated hash: if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){ System.out.println(&quot;#Current Hashes not equal&quot;); return false; } //compare previous hash and registered previous hash if(!previousBlock.hash.equals(currentBlock.previousHash) ) { System.out.println(&quot;#Previous Hashes not equal&quot;); return false; } //check if hash is solved if(!currentBlock.hash.substring( 0, difficulty).equals(hashTarget)) { System.out.println(&quot;#This block hasn&#39;t been mined&quot;); return false; } //loop thru blockchains transactions: TransactionOutput tempOutput; for(int t=0; t &lt;currentBlock.transactions.size(); t++) { Transaction currentTransaction = currentBlock.transactions.get(t); if(!currentTransaction.verifiySignature()) { System.out.println(&quot;#Signature on Transaction(&quot; + t + &quot;) is Invalid&quot;); return false; } if(currentTransaction.getInputsValue() != currentTransaction.getOutputsValue()) { System.out.println(&quot;#Inputs are note equal to outputs on Transaction(&quot; + t + &quot;)&quot;); return false; } for(TransactionInput input: currentTransaction.inputs) { tempOutput = tempUTXOs.get(input.transactionOutputId); if(tempOutput == null) { System.out.println(&quot;#Referenced input on Transaction(&quot; + t + &quot;) is Missing&quot;); return false; } if(input.UTXO.value != tempOutput.value) { System.out.println(&quot;#Referenced input Transaction(&quot; + t + &quot;) value is Invalid&quot;); return false; } tempUTXOs.remove(input.transactionOutputId); } for(TransactionOutput output: currentTransaction.outputs) { tempUTXOs.put(output.id, output); } if( currentTransaction.outputs.get(0).reciepient != currentTransaction.reciepient) { System.out.println(&quot;#Transaction(&quot; + t + &quot;) output reciepient is not who it should be&quot;); return false; } if( currentTransaction.outputs.get(1).reciepient != currentTransaction.sender) { System.out.println(&quot;#Transaction(&quot; + t + &quot;) output &#39;change&#39; is not sender.&quot;); return false; } } } System.out.println(&quot;Blockchain is valid&quot;); return true; } public static void addBlock(Block newBlock) { newBlock.mineBlock(difficulty); blockchain.add(newBlock); } } 打印： Connected to the target VM, address: &#39;127.0.0.1:57085&#39;, transport: &#39;socket&#39; Creating and Mining Genesis block... Transaction Successfully added to Block Block Mined!!! : 000b5a7ca6bf07639122cb31e884996895a482c281dd89c203824f1e93a661bf WalletA&#39;s balance is: 100.0 WalletA is Attempting to send funds (40) to WalletB... Transaction Successfully added to Block Block Mined!!! : 000c7f814357abfea86ad1b38ec1dc3afed2afc9107f2bacc933d8136bf34df0 WalletA&#39;s balance is: 60.0 WalletB&#39;s balance is: 40.0 WalletA Attempting to send more funds (1000) than it has... #Not Enough funds to send transaction. Transaction Discarded. Block Mined!!! : 000b3822fb7985db438712816727d4bc382926a1c4654062aad4071d9b9fad98 WalletA&#39;s balance is: 60.0 WalletB&#39;s balance is: 40.0 WalletB is Attempting to send funds (20) to WalletA... Transaction Successfully added to Block WalletA&#39;s balance is: 80.0 WalletB&#39;s balance is: 20.0 Blockchain is valid 现在钱包能够安全地在您的区块链上发送金额，只要他们有金额发送。这意味着你有你自己的本地加密货币 可以进行交易的区块链 你已经成功地创建了自己的加密货币。你的区块链： 允许用户创建钱包 使用椭圆曲线加密方式为钱包提供公钥和私钥 通过使用数字签名算法证明所有权，确保资金转移 允许用户在区块链上进行交易 项目地址：https://github.com/pibigstar/blockchain 转载自：https://longfeizheng.github.io/2018/03/11/用Java创建你的第一个区块链-part2/ 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/29/200ffb87678c818a0e1c3f9a82d97728.html","headline":"用java写一个简单的区块链（下）","dateModified":"2018-03-29T00:00:00+08:00","datePublished":"2018-03-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/29/200ffb87678c818a0e1c3f9a82d97728.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>用java写一个简单的区块链（下）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><strong>本章目标</strong></p>
  <ul style="padding-left:2em;margin-bottom:16px;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <li>创建一个简单的钱包。</li>
   <li>使用我们的区块链发送带签名的交易。</li>
  </ul>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><strong>这样我们就有自己的加密货币</strong></p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><em>值得注意的是，这里创建的区块链并不是功能完全的完全适合应用与生产的区块链，相反只是为了帮助你更好的理解区块链的概念。</em></p>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">别担心，这实际上是很简单的，但比上一个教程要长!</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">在上一章节，我们已经有了一个基本的区块链，但在区块链中存放的是一些无用的信息。今天我们将用交易取代这些信息（我们的区块将能够保存多个交易），允许我们创建一个非常简单的加密货币,我们的货币名字<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">pibigstar</code>。</p>
  <ul style="padding-left:2em;margin-bottom:16px;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <li>本教程是在上一边基础上实现的</li>
   <li>导入<a href="https://www.bouncycastle.org/latest_releases.html" rel="nofollow" style="background-color:transparent;color:rgb(65,131,196);">&nbsp;bounceycastle</a>和<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">GSON</code></li>
  </ul>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">准备一个钱包</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">在加密货币中，在区块链作为交易时，货币所有权可以进行转移，每个参与者都有一个自己私有的地址来发送或者是收取货币。，钱包可以存储这些地址。因此钱包就是可以在区块链上进行新交易的软件。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><a href="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" rel="nofollow" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" style="background-color:transparent;color:rgb(65,131,196);"><img src="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" alt="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" style="border:0px;"></a></p>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">Don’t worry about the information on the transaction, that will be explained soon</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">让我们创建一个钱包类来保存公钥和私钥:</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">package</span> <span class="n" style="color:rgb(51,51,51);">noobchain</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.*</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">Wallet</span> <span class="o" style="font-weight:700;">{</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PrivateKey</span> <span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">;</span>
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">公钥和私钥究竟是起到什么作用呢，其实公钥的作用就是地址，你可以分享你的公钥给别人以此来获取付款，而你的私钥的作用是为了对交易进行签名，这样其他人就不可以花费你的金额除非它拥有你的私钥，所以对于每个人而言我们必须保护好我们的私钥，不能透露我们的私钥信息给其他人。同时在我们进行交易的时候我们也会同时发送我们的公钥由此来验证我们的签名是有效的而且没有数据被篡改。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">我们在密钥对<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">KeyPair</code>生成私有和公钥。我们将使用<a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography" rel="nofollow" style="background-color:transparent;color:rgb(65,131,196);">椭圆曲线加密</a>来生成我们的密钥对<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">KeyPair</code>。让我们将<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">generateKeyPair()</code>方法添加到我们的钱包类中，并在构造函数中调用它:</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><a href="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" rel="nofollow" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" style="background-color:transparent;color:rgb(65,131,196);"><img src="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" alt="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png" style="border:0px;"></a></p>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">私钥用于签署我们不想被篡改的数据。公钥用于验证签名。</p>
  </blockquote>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">package</span> <span class="n" style="color:rgb(51,51,51);">noobchain</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.*</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">Wallet</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PrivateKey</span> <span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">;</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">Wallet</span><span class="o" style="font-weight:700;">(){</span>
		<span class="n" style="color:rgb(51,51,51);">generateKeyPair</span><span class="o" style="font-weight:700;">();</span>	
	<span class="o" style="font-weight:700;">}</span>
		
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">generateKeyPair</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">try</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">KeyPairGenerator</span> <span class="n" style="color:rgb(51,51,51);">keyGen</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">KeyPairGenerator</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getInstance</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"ECDSA"</span><span class="o" style="font-weight:700;">,</span><span class="s" style="color:rgb(221,17,68);">"BC"</span><span class="o" style="font-weight:700;">);</span>
			<span class="n" style="color:rgb(51,51,51);">SecureRandom</span> <span class="n" style="color:rgb(51,51,51);">random</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">SecureRandom</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getInstance</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"SHA1PRNG"</span><span class="o" style="font-weight:700;">);</span>
			<span class="n" style="color:rgb(51,51,51);">ECGenParameterSpec</span> <span class="n" style="color:rgb(51,51,51);">ecSpec</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ECGenParameterSpec</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"prime192v1"</span><span class="o" style="font-weight:700;">);</span>
			<span class="c1" style="font-style:italic;color:rgb(153,153,136);">// Initialize the key generator and generate a KeyPair</span>
			<span class="n" style="color:rgb(51,51,51);">keyGen</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">initialize</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">ecSpec</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">random</span><span class="o" style="font-weight:700;">);</span>   <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//256 bytes provides an acceptable security level</span>
	        	<span class="n" style="color:rgb(51,51,51);">KeyPair</span> <span class="n" style="color:rgb(51,51,51);">keyPair</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">keyGen</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">generateKeyPair</span><span class="o" style="font-weight:700;">();</span>
	        	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">// Set the public and private keys from the keyPair</span>
	        	<span class="n" style="color:rgb(51,51,51);">privateKey</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">keyPair</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getPrivate</span><span class="o" style="font-weight:700;">();</span>
	        	<span class="n" style="color:rgb(51,51,51);">publicKey</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">keyPair</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getPublic</span><span class="o" style="font-weight:700;">();</span>
		<span class="o" style="font-weight:700;">}</span><span class="k" style="font-weight:700;">catch</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Exception</span> <span class="n" style="color:rgb(51,51,51);">e</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="k" style="font-weight:700;">throw</span> <span class="k" style="font-weight:700;">new</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">RuntimeException</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">e</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
	<span class="o" style="font-weight:700;">}</span>
	
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">你不需要完全理解椭圆曲线加密算法的核心逻辑究竟是什么，你只需要它是用来创建公钥和私钥，以及公钥和私钥分别所起到的作用是什么就可以了。</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">现在我们已经又了钱包类的大概框架，下面我们再来看一下交易类。</p>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">交易和数字签名</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">每笔交易将携带一定以下信息：</p>
  <ol style="padding-left:2em;margin-bottom:16px;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <li>资金付款人的公匙信息。</li>
   <li>资金收款人的公匙信息。</li>
   <li>被转移资金的金额。</li>
   <li>输入，它是对以前的交易的引用，证明发送者有资金发送。</li>
   <li>输出，显示交易中收款方相关地址数量。(这些输出被引用为新交易的输入)</li>
   <li>一个加密签名，证明该交易是由地址的发送者是发送的，并且数据没有被更改。(阻止第三方机构更改发送的数量)</li>
  </ol>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">让我们创建这个新的交易类：</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.*</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.ArrayList</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">Transaction</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">transactionId</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">// this is also the hash of the transaction.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">sender</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">// senders address/public key.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">// Recipients address/public key.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">signature</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">// this is to prevent anybody else from spending funds in our wallet.</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">inputs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span><span class="o" style="font-weight:700;">&gt;();</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">outputs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;();</span>
	
	<span class="kd" style="font-weight:700;">private</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">sequence</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">// a rough count of how many transactions have been generated. </span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">// Constructor: </span>
	<span class="kd" style="font-weight:700;">public</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">Transaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">from</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">to</span><span class="o" style="font-weight:700;">,</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">,</span>  <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sender</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">from</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">reciepient</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">to</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">inputs</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">// This Calculates the transaction hash (which will be used as its Id)</span>
	<span class="kd" style="font-weight:700;">private</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">calulateHash</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="n" style="color:rgb(51,51,51);">sequence</span><span class="o" style="font-weight:700;">++;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//increase the sequence to avoid 2 identical transactions having the same hash</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">applySha256</span><span class="o" style="font-weight:700;">(</span>
				<span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">sender</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span>
				<span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span>
				<span class="n" style="color:rgb(51,51,51);">Float</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">toString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">sequence</span>
				<span class="o" style="font-weight:700;">);</span>
	<span class="o" style="font-weight:700;">}</span>
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">我们还应该创建空的<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">transactioninput</code>和<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">transactionoutput</code>类，不要担心我们可以在后面填写它们。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">我们的交易类还将包含生成/验证签名和验证交易的相关方法，那么签名的意图是什么？签名在我们的区块链中执行了两个非常重要的任务：第一，签名用来保证只有货币的拥有者才可以用来发送自己的货币，第二，签名用来阻止其他人试图篡改提交的交易。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><strong>即私钥被用来签名数据，而公钥用来验证其完整性。</strong></p>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">举个例子：Bob 想要发送2个加密货币给Sally，他们用各自的钱包创建了交易，并提交到全网的区块链中作为一个新的区块，一个挖矿者试图篡改接受者把2个加密货币给John，但是幸运的事，Bob在交易数据中已经用私钥进行了签名，这就允许了全网中的任何节点使用小明的公匙进行验证数据是否已经被篡改（因为没有其他人的公钥可以用来验证小明发出的这笔交易）。</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">从前面的代码中我们可以看到我们的签名将是一堆字符串，所以让我们创建一个方法来生成它们。首先我们在<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">StringUtil</code>类中创建产生签名的方法。</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[]</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">applyECDSASig</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PrivateKey</span> <span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">input</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="n" style="color:rgb(51,51,51);">Signature</span> <span class="n" style="color:rgb(51,51,51);">dsa</span><span class="o" style="font-weight:700;">;</span>
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">output</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">];</span>
		<span class="k" style="font-weight:700;">try</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">dsa</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">Signature</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getInstance</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"ECDSA"</span><span class="o" style="font-weight:700;">,</span> <span class="s" style="color:rgb(221,17,68);">"BC"</span><span class="o" style="font-weight:700;">);</span>
			<span class="n" style="color:rgb(51,51,51);">dsa</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">initSign</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">);</span>
			<span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">strByte</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">input</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBytes</span><span class="o" style="font-weight:700;">();</span>
			<span class="n" style="color:rgb(51,51,51);">dsa</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">update</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">strByte</span><span class="o" style="font-weight:700;">);</span>
			<span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">realSig</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">dsa</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sign</span><span class="o" style="font-weight:700;">();</span>
			<span class="n" style="color:rgb(51,51,51);">output</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">realSig</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span> <span class="k" style="font-weight:700;">catch</span> <span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Exception</span> <span class="n" style="color:rgb(51,51,51);">e</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="k" style="font-weight:700;">throw</span> <span class="k" style="font-weight:700;">new</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">RuntimeException</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">e</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">output</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Verifies a String signature </span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">boolean</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">verifyECDSASig</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">data</span><span class="o" style="font-weight:700;">,</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">byte</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">signature</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">try</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">Signature</span> <span class="n" style="color:rgb(51,51,51);">ecdsaVerify</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">Signature</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getInstance</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"ECDSA"</span><span class="o" style="font-weight:700;">,</span> <span class="s" style="color:rgb(221,17,68);">"BC"</span><span class="o" style="font-weight:700;">);</span>
			<span class="n" style="color:rgb(51,51,51);">ecdsaVerify</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">initVerify</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">);</span>
			<span class="n" style="color:rgb(51,51,51);">ecdsaVerify</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">update</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">data</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBytes</span><span class="o" style="font-weight:700;">());</span>
			<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">ecdsaVerify</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">verify</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">signature</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span><span class="k" style="font-weight:700;">catch</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Exception</span> <span class="n" style="color:rgb(51,51,51);">e</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="k" style="font-weight:700;">throw</span> <span class="k" style="font-weight:700;">new</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">RuntimeException</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">e</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
	<span class="o" style="font-weight:700;">}</span>

	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Key</span> <span class="n" style="color:rgb(51,51,51);">key</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">Base64</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getEncoder</span><span class="o" style="font-weight:700;">().</span><span class="na" style="color:#008080;">encodeToString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">key</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getEncoded</span><span class="o" style="font-weight:700;">());</span>
	<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">不用担心你不能理解这些方法的内容，你所需要知道的就是<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">applyECDSASig</code>方法的输入参数为付款人的私钥和需要加密的数据信息，签名后返回字节数组。而<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">verifyECDSASig</code>方法的输入参数为公钥、加密的数据和签名，调用该方法后返回true或false来说明签名是否是有效的。<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">getStringFromKey</code>返回任何<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">key</code>的编码字符串</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">让我们使用签名的方法在交易类中，增加<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">generatesiganature()</code>&nbsp;和&nbsp;<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">varifiysignature()</code>方法：</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Signs all the data we dont wish to be tampered with.</span>
<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">generateSignature</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PrivateKey</span> <span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
	<span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">data</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">sender</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">Float</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">toString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">)</span>	<span class="o" style="font-weight:700;">;</span>
	<span class="n" style="color:rgb(51,51,51);">signature</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">applyECDSASig</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">data</span><span class="o" style="font-weight:700;">);</span>		
<span class="o" style="font-weight:700;">}</span>
<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Verifies the data we signed hasnt been tampered with</span>
<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">boolean</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">verifiySignature</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
	<span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">data</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">sender</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">Float</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">toString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">)</span>	<span class="o" style="font-weight:700;">;</span>
	<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">verifyECDSASig</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">sender</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">data</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">signature</span><span class="o" style="font-weight:700;">);</span>
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">在现实中，您可能希望签名更多信息，例如使用的输出/输入和/或时间戳（现在我们只是签名最低限度的信息）</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">签名将由矿工验证，只有签名验证成功后交易才能被添加到区块中去。</p>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">当我们检查区块链的有效性时，我们也可以检查签名</p>
  </blockquote>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">测试钱包和签名</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">现在我们简单的进行一些测试，在主方法中，我们增加了一些新的变量也替换了我们之前在主方法中的一些内容。</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.Security</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.ArrayList</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.Base64</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">com.google.gson.GsonBuilder</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">NoobChain</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">blockchain</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">&gt;();</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">difficulty</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">5</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">;</span>

	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">main</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">args</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>	
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Setup Bouncey castle as a Security Provider</span>
		<span class="n" style="color:rgb(51,51,51);">Security</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">addProvider</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">org</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">bouncycastle</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">jce</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">provider</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">BouncyCastleProvider</span><span class="o" style="font-weight:700;">());</span> 
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Create the new wallets</span>
		<span class="n" style="color:rgb(51,51,51);">walletA</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span><span class="o" style="font-weight:700;">();</span>
		<span class="n" style="color:rgb(51,51,51);">walletB</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span><span class="o" style="font-weight:700;">();</span>
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Test public and private keys</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Private and public keys:"</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">privateKey</span><span class="o" style="font-weight:700;">));</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">));</span>
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Create a test transaction from WalletA to walletB </span>
		<span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">transaction</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Transaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="mi" style="color:rgb(0,153,153);">5</span><span class="o" style="font-weight:700;">,</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">generateSignature</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">privateKey</span><span class="o" style="font-weight:700;">);</span>
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Verify the signature works and verify it from the public key</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Is signature verified"</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">verifiySignature</span><span class="o" style="font-weight:700;">());</span>
		
	<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">确定要添加<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">bounceycastle</code>依赖</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">我们创建了两个钱包walleta和walletb，然后打印了walleta的私钥和公钥。生成一个交易并使用walleta的私钥对其进行签名。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">打印</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="n" style="color:rgb(51,51,51);">Connected</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">the</span> <span class="n" style="color:rgb(51,51,51);">target</span> <span class="n" style="color:rgb(51,51,51);">VM</span><span class="o" style="font-weight:700;">,</span> <span class="nl">address:</span> <span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="mf" style="color:rgb(0,153,153);">127.0</span><span class="o" style="font-weight:700;">.</span><span class="mf" style="color:rgb(0,153,153);">0.1</span><span class="o" style="font-weight:700;">:</span><span class="mi" style="color:rgb(0,153,153);">55757</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="o" style="font-weight:700;">,</span> <span class="nl">transport:</span> <span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">socket</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span>
<span class="n" style="color:rgb(51,51,51);">Private</span> <span class="n" style="color:rgb(51,51,51);">and</span> <span class="kd" style="font-weight:700;">public</span> <span class="nl">keys:</span>
<span class="n" style="color:rgb(51,51,51);">MHsCAQAwEwYHKoZIzj0CAQYIKoZIzj0DAQEEYTBfAgEBBBiJzZiesBnBWwwB</span><span class="o" style="font-weight:700;">+</span><span class="n" style="color:rgb(51,51,51);">uog</span><span class="o" style="font-weight:700;">+</span><span class="n" style="color:rgb(51,51,51);">fJX84mx4lPUTUagCgYIKoZIzj0DAQGhNAMyAAQfPzad0zqBUGQAany2rRZE1</span><span class="o" style="font-weight:700;">+</span><span class="mi" style="color:rgb(0,153,153);">2</span><span class="n" style="color:rgb(51,51,51);">ml5IOCZST8LywjBQT8ux</span><span class="o" style="font-weight:700;">+</span><span class="mi" style="color:rgb(0,153,153);">3</span><span class="n" style="color:rgb(51,51,51);">UPVbr2u0</span><span class="o" style="font-weight:700;">+</span><span class="n" style="color:rgb(51,51,51);">LaExxz1WI</span><span class="o" style="font-weight:700;">=</span>
<span class="n" style="color:rgb(51,51,51);">MEkwEwYHKoZIzj0CAQYIKoZIzj0DAQEDMgAEHz82ndM6gVBkAGp8tq0WRNftppeSDgmUk</span><span class="o" style="font-weight:700;">/</span><span class="n" style="color:rgb(51,51,51);">C8sIwUE</span><span class="o" style="font-weight:700;">/</span><span class="n" style="color:rgb(51,51,51);">Lsft1D1W69rtPi2hMcc9Vi</span>
<span class="n" style="color:rgb(51,51,51);">Is</span> <span class="n" style="color:rgb(51,51,51);">signature</span> <span class="n" style="color:rgb(51,51,51);">verified</span>
<span class="kc" style="font-weight:700;">true</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">接下来我们将创建并验证输入和输出，并把交易保存到区块链中去。</p>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">输入和输出 1：如何验证货币是你的</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">如果你拥有1比特币，你必须前面就得接收1比特币。比特币的账本不会在你的账户中增加一个比特币也不会从发送者那里减去一个比特币，发送者只能指向他/她之前收到过一个比特币，所以一个交易输出被创建用来显示一个比特币发送给你的地址（交易的输入指向前一个交易的输出）。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><strong>你的钱包余额是所有未使用的交易输出的总和</strong></p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">从这一个点出发，我们会依照比特币中的说明，把所有未使用的交易输出称为<a href="http://8btc.com/article-4381-1.html" rel="nofollow" style="background-color:transparent;color:rgb(65,131,196);">UTXO</a>.</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">创建<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">TransactionInput</code>&nbsp;类：</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">TransactionInput</span> <span class="o" style="font-weight:700;">{</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">transactionOutputId</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Reference to TransactionOutputs -&gt; transactionId</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Contains the Unspent transaction output</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">TransactionInput</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">transactionOutputId</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionOutputId</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">transactionOutputId</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">这个类将用于引用尚未使用的<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">transactionoutput</code>。<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">transactionOutputId</code>将用于查找相关的<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">TransactionOutput</code>，允许矿工检查您的所有权。</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">创建<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">TransactionOutputs&nbsp;</code>类：</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.PublicKey</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">TransactionOutput</span> <span class="o" style="font-weight:700;">{</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">id</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//also known as the new owner of these coins.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//the amount of coins they own</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">parentTransactionId</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//the id of the transaction this output was created in</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Constructor</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">TransactionOutput</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">,</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">parentTransactionId</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">reciepient</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">parentTransactionId</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">parentTransactionId</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">id</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">applySha256</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getStringFromKey</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">)+</span><span class="n" style="color:rgb(51,51,51);">Float</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">toString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">)+</span><span class="n" style="color:rgb(51,51,51);">parentTransactionId</span><span class="o" style="font-weight:700;">);</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Check if coin belongs to you</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">boolean</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">isMine</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">return</span> <span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">publicKey</span> <span class="o" style="font-weight:700;">==</span> <span class="n" style="color:rgb(51,51,51);">reciepient</span><span class="o" style="font-weight:700;">);</span>
	<span class="o" style="font-weight:700;">}</span>
	
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">交易输出类将显示从交易中发送给每一方的最终金额。这些作为新交易中的输入参考，作为证明你可以发送的金额数量。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><br></p>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">输入和输出 2：处理交易</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">区块链可能会收到很多交易，而区块链可能会非常长，因为我们必须查找并检查其输入，所以可能需要非常长的时间来处理新的交易。为了解决这个问题，我们保存了一个额外的集合称之为为使用的交易作为可用的输入,所以在主函数中增加一个集合称为UTXO。</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">NoobChain</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">blockchain</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">&gt;();</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutputs</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">UTXOs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutputs</span><span class="o" style="font-weight:700;">&gt;();</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//list of all unspent transactions. </span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">difficulty</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">5</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">;</span>

	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">main</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">args</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>	
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;"><code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">hashmap</code>允许我们使用键来查找值，但是您需要导入<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">java.util.hashmap</code></p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">重点来了，我们在交易类中增加一个<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">processTransaction</code>方法，这个方法是把一切放在一起用来处理交易。</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Returns true if new transaction could be created. </span>
<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">boolean</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">processTransaction</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		
		<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">verifiySignature</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">==</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Transaction Signature failed to verify"</span><span class="o" style="font-weight:700;">);</span>
			<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
				
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//gather transaction inputs (Make sure they are unspent):</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span> <span class="n" style="color:rgb(51,51,51);">i</span> <span class="o" style="font-weight:700;">:</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXO</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">NoobChain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionOutputId</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>

		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//check if transaction is valid:</span>
		<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">getInputsValue</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">&lt;</span> <span class="n" style="color:rgb(51,51,51);">NoobChain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">minimumTransaction</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Transaction Inputs to small: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">getInputsValue</span><span class="o" style="font-weight:700;">());</span>
			<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
		
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//generate transaction outputs:</span>
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">leftOver</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">getInputsValue</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">-</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//get value of inputs then the left over change:</span>
		<span class="n" style="color:rgb(51,51,51);">transactionId</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">calulateHash</span><span class="o" style="font-weight:700;">();</span>
		<span class="n" style="color:rgb(51,51,51);">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">(</span> <span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">reciepient</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">transactionId</span><span class="o" style="font-weight:700;">));</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//send value to recipient</span>
		<span class="n" style="color:rgb(51,51,51);">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">(</span> <span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sender</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">leftOver</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">transactionId</span><span class="o" style="font-weight:700;">));</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//send the left over 'change' back to sender </span>
				
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//add outputs to Unspent list</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="n" style="color:rgb(51,51,51);">o</span> <span class="o" style="font-weight:700;">:</span> <span class="n" style="color:rgb(51,51,51);">outputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">NoobChain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">put</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">o</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">id</span> <span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">o</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
		
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//remove transaction inputs from UTXO lists as spent:</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span> <span class="n" style="color:rgb(51,51,51);">i</span> <span class="o" style="font-weight:700;">:</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXO</span> <span class="o" style="font-weight:700;">==</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">)</span> <span class="k" style="font-weight:700;">continue</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//if Transaction can't be found skip it </span>
			<span class="n" style="color:rgb(51,51,51);">NoobChain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">remove</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">id</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
		
		<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">true</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//returns sum of inputs(UTXOs) values</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">getInputsValue</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span> <span class="n" style="color:rgb(51,51,51);">i</span> <span class="o" style="font-weight:700;">:</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXO</span> <span class="o" style="font-weight:700;">==</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">)</span> <span class="k" style="font-weight:700;">continue</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//if Transaction can't be found skip it </span>
			<span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">+=</span> <span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">total</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>

<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//returns sum of outputs:</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">getOutputsValue</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="n" style="color:rgb(51,51,51);">o</span> <span class="o" style="font-weight:700;">:</span> <span class="n" style="color:rgb(51,51,51);">outputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">+=</span> <span class="n" style="color:rgb(51,51,51);">o</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">total</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">我们还添加了<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">getinputsvalue</code>方法</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">通过这种方法，我们执行一些检查以确保交易有效，然后收集输入并生成输出。最重要的是，最后，我们抛弃了输入在我们的UTXO列表，这就意味着一个可以使用的交易输出必须之前一定是输入，所以输入的值必须被完全使用，所以付款人必须改变它们自身的金额状态。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><a href="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png" rel="nofollow" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png" style="background-color:transparent;color:rgb(65,131,196);"><img src="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png" alt="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png" style="border:0px;"></a></p>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">红色箭头是输出。请注意，绿色输入是对之前输出的参考</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">最后让我们修改我们的wallet类</p>
  <ul style="padding-left:2em;margin-bottom:16px;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <li>搜集余额（通过循环遍历UTXO列表来检查交易的输出是否是我的）并</li>
   <li>创建交易</li>
  </ul>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.*</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.security.spec.ECGenParameterSpec</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.ArrayList</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.HashMap</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.Map</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">Wallet</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PrivateKey</span> <span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">;</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">UTXOs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;();</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//only UTXOs owned by this wallet.</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">Wallet</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{...</span>
		
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">generateKeyPair</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{...</span>
	
  <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//returns balance and stores the UTXO's owned by this wallet in this.UTXOs</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">getBalance</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">;</span>	
        <span class="k" style="font-weight:700;">for</span> <span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Map</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">Entry</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="nl">item:</span> <span class="n" style="color:rgb(51,51,51);">NoobChain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">entrySet</span><span class="o" style="font-weight:700;">()){</span>
        	<span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="n" style="color:rgb(51,51,51);">UTXO</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">item</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getValue</span><span class="o" style="font-weight:700;">();</span>
            <span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">isMine</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">))</span> <span class="o" style="font-weight:700;">{</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//if output belongs to me ( if coins belong to me )</span>
            	<span class="n" style="color:rgb(51,51,51);">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">put</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">id</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">);</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//add it to our list of unspent transactions.</span>
            	<span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">+=</span> <span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span> <span class="o" style="font-weight:700;">;</span> 
            <span class="o" style="font-weight:700;">}</span>
        <span class="o" style="font-weight:700;">}</span>  
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">total</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Generates and returns a new transaction from this wallet.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">sendFunds</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">PublicKey</span> <span class="n" style="color:rgb(51,51,51);">_recipient</span><span class="o" style="font-weight:700;">,</span><span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">value</span> <span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">getBalance</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">&lt;</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//gather balance and check funds.</span>
			<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Not Enough funds to send transaction. Transaction Discarded."</span><span class="o" style="font-weight:700;">);</span>
			<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
    <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//create array list of inputs</span>
		<span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">inputs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span><span class="o" style="font-weight:700;">&gt;();</span>
    
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">for</span> <span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Map</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">Entry</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="nl">item:</span> <span class="n" style="color:rgb(51,51,51);">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">entrySet</span><span class="o" style="font-weight:700;">()){</span>
			<span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="n" style="color:rgb(51,51,51);">UTXO</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">item</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getValue</span><span class="o" style="font-weight:700;">();</span>
			<span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">+=</span> <span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span><span class="o" style="font-weight:700;">;</span>
			<span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">TransactionInput</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">id</span><span class="o" style="font-weight:700;">));</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">total</span> <span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">)</span> <span class="k" style="font-weight:700;">break</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
		
		<span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">newTransaction</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Transaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">_recipient</span> <span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">value</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">newTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">generateSignature</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">privateKey</span><span class="o" style="font-weight:700;">);</span>
		
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span> <span class="nl">input:</span> <span class="n" style="color:rgb(51,51,51);">inputs</span><span class="o" style="font-weight:700;">){</span>
			<span class="n" style="color:rgb(51,51,51);">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">remove</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">input</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionOutputId</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">newTransaction</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">你可以随时为钱包添加一些其他功能，例如记录您的交易历史记录。</p>
  </blockquote>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">添加交易到区块中</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">现在我们已经有了一个有效的交易系统，我们需要把交易加入到我们的区块链中。我们把交易列表替换我们块中无用的数据，但是在一个单一的区块中可能存放了1000个交易，这就会导致大量的hash计算，不用担心在这里我们使用了交易的<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">merkle root</code>，稍后你会看到。让我们增加一个帮助方法来创建<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">merkle root</code>在<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">StringUtils</code>类中。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">在<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">StringUtils</code>类中创建<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">getMerkleRoot</code>方法</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Tacks in array of transactions and returns a merkle root.</span>
<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">getMerkleRoot</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Transaction</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">transactions</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">count</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">transactions</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">size</span><span class="o" style="font-weight:700;">();</span>
		<span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">&gt;();</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">transaction</span> <span class="o" style="font-weight:700;">:</span> <span class="n" style="color:rgb(51,51,51);">transactions</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionId</span><span class="o" style="font-weight:700;">);</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">treeLayer</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">while</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">count</span> <span class="o" style="font-weight:700;">&gt;</span> <span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">treeLayer</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">&gt;();</span>
			<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">=</span><span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">;</span> <span class="n" style="color:rgb(51,51,51);">i</span> <span class="o" style="font-weight:700;">&lt;</span> <span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">size</span><span class="o" style="font-weight:700;">();</span> <span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">++)</span> <span class="o" style="font-weight:700;">{</span>
				<span class="n" style="color:rgb(51,51,51);">treeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">applySha256</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">-</span><span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">)));</span>
			<span class="o" style="font-weight:700;">}</span>
			<span class="n" style="color:rgb(51,51,51);">count</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">treeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">size</span><span class="o" style="font-weight:700;">();</span>
			<span class="n" style="color:rgb(51,51,51);">previousTreeLayer</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">treeLayer</span><span class="o" style="font-weight:700;">;</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">merkleRoot</span> <span class="o" style="font-weight:700;">=</span> <span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">treeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">size</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">==</span> <span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">?</span> <span class="n" style="color:rgb(51,51,51);">treeLayer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">:</span> <span class="s" style="color:rgb(221,17,68);">""</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">merkleRoot</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <blockquote style="margin-bottom:16px;padding:0px 15px;color:rgb(119,119,119);border-left:4px solid rgb(221,221,221);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <p style="margin-bottom:0px;">我会尽快用一个实际的merkleroot取代这个方法，但是现在使用这个可以正常运行</p>
  </blockquote>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">修来<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">Block</code>&nbsp;类</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.ArrayList</span><span class="o" style="font-weight:700;">;</span>
<span class="kn" style="font-weight:700;">import</span> <span class="nn" style="color:rgb(85,85,85);">java.util.Date</span><span class="o" style="font-weight:700;">;</span>

<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">Block</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">hash</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">previousHash</span><span class="o" style="font-weight:700;">;</span> 
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">merkleRoot</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Transaction</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">transactions</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Transaction</span><span class="o" style="font-weight:700;">&gt;();</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//our data will be a simple message.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">long</span> <span class="n" style="color:rgb(51,51,51);">timeStamp</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//as number of milliseconds since 1/1/1970.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">nonce</span><span class="o" style="font-weight:700;">;</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Block Constructor. </span>
	<span class="kd" style="font-weight:700;">public</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">Block</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">previousHash</span> <span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">previousHash</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">previousHash</span><span class="o" style="font-weight:700;">;</span>
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">timeStamp</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Date</span><span class="o" style="font-weight:700;">().</span><span class="na" style="color:#008080;">getTime</span><span class="o" style="font-weight:700;">();</span>
		
		<span class="k" style="font-weight:700;">this</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">calculateHash</span><span class="o" style="font-weight:700;">();</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Making sure we do this after we set the other values.</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Calculate new hash based on blocks contents</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="n" style="color:rgb(51,51,51);">String</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">calculateHash</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">calculatedhash</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">applySha256</span><span class="o" style="font-weight:700;">(</span> 
				<span class="n" style="color:rgb(51,51,51);">previousHash</span> <span class="o" style="font-weight:700;">+</span>
				<span class="n" style="color:rgb(51,51,51);">Long</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">toString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">timeStamp</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span>
				<span class="n" style="color:rgb(51,51,51);">Integer</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">toString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">nonce</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">+</span> 
				<span class="n" style="color:rgb(51,51,51);">merkleRoot</span>
				<span class="o" style="font-weight:700;">);</span>
		<span class="k" style="font-weight:700;">return</span> <span class="n" style="color:rgb(51,51,51);">calculatedhash</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Increases nonce value until hash target is reached.</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">mineBlock</span><span class="o" style="font-weight:700;">(</span><span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">difficulty</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="n" style="color:rgb(51,51,51);">merkleRoot</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getMerkleRoot</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">transactions</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">target</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">StringUtil</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getDificultyString</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">difficulty</span><span class="o" style="font-weight:700;">);</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Create a string with difficulty * "0" </span>
		<span class="k" style="font-weight:700;">while</span><span class="o" style="font-weight:700;">(!</span><span class="n" style="color:rgb(51,51,51);">hash</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">substring</span><span class="o" style="font-weight:700;">(</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">difficulty</span><span class="o" style="font-weight:700;">).</span><span class="na" style="color:#008080;">equals</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">target</span><span class="o" style="font-weight:700;">))</span> <span class="o" style="font-weight:700;">{</span>
			<span class="n" style="color:rgb(51,51,51);">nonce</span> <span class="o" style="font-weight:700;">++;</span>
			<span class="n" style="color:rgb(51,51,51);">hash</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">calculateHash</span><span class="o" style="font-weight:700;">();</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Block Mined!!! : "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">hash</span><span class="o" style="font-weight:700;">);</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Add transactions to this block</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">boolean</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">addTransaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//process transaction and check if valid, unless block is genesis block then ignore.</span>
		<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">transaction</span> <span class="o" style="font-weight:700;">==</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">)</span> <span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>		
		<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">((</span><span class="n" style="color:rgb(51,51,51);">previousHash</span> <span class="o" style="font-weight:700;">!=</span> <span class="s" style="color:rgb(221,17,68);">"0"</span><span class="o" style="font-weight:700;">))</span> <span class="o" style="font-weight:700;">{</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">((</span><span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">processTransaction</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">!=</span> <span class="kc" style="font-weight:700;">true</span><span class="o" style="font-weight:700;">))</span> <span class="o" style="font-weight:700;">{</span>
				<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Transaction failed to process. Discarded."</span><span class="o" style="font-weight:700;">);</span>
				<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
			<span class="o" style="font-weight:700;">}</span>
		<span class="o" style="font-weight:700;">}</span>
		<span class="n" style="color:rgb(51,51,51);">transactions</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Transaction Successfully added to Block"</span><span class="o" style="font-weight:700;">);</span>
		<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">true</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">需要注意的是我们还更新了<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">Block</code>构造函数，因为我们不再需要传递字符串数据，并将<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">merkle root</code>包含在计算哈希方法中。<code class="highlighter-rouge" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;padding:.2em 0px;margin:0px;background-color:rgba(0,0,0,.0392157);">addTransaction</code>方法用来增加交易，只有满足条件下才可以成功的在区块中增加交易。</p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">我们已经实现了一个可交易的区块链。</p>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">最后的测试</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">我们应该测试从钱包发送货币，更新区块链并进行有效性检查。但首先我们需要一种将新硬币引入混合的方法。有很多方法来创建新的硬币。在比特币区块链上，有很多方法可以创造新的比特币:矿工可以将交易包括在内，作为对每个矿工挖矿的奖励。但在这里我们只希望在创世纪区块中释放货币。就像比特币中一下，所以我们修改我们的主函数以达到下面的目的。</p>
  <ol style="padding-left:2em;margin-bottom:16px;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <li>创世纪区块发布100个货币给walletA</li>
   <li>一个更新的链有效性检查，考虑到交易。</li>
   <li>测试交易看是否一切正常。</li>
  </ol>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">class</span> <span class="nc" style="font-weight:700;color:rgb(68,85,136);">NoobChain</span> <span class="o" style="font-weight:700;">{</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">blockchain</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">ArrayList</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">&gt;();</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">UTXOs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;();</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">difficulty</span> <span class="o" style="font-weight:700;">=</span> <span class="mi" style="color:rgb(0,153,153);">3</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">float</span> <span class="n" style="color:rgb(51,51,51);">minimumTransaction</span> <span class="o" style="font-weight:700;">=</span> <span class="mf" style="color:rgb(0,153,153);">0.1f</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">;</span>
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">;</span>

	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">main</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">[]</span> <span class="n" style="color:rgb(51,51,51);">args</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>	
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//add our blocks to the blockchain ArrayList:</span>
		<span class="n" style="color:rgb(51,51,51);">Security</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">addProvider</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">org</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">bouncycastle</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">jce</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">provider</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">BouncyCastleProvider</span><span class="o" style="font-weight:700;">());</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Setup Bouncey castle as a Security Provider</span>
		
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//Create wallets:</span>
		<span class="n" style="color:rgb(51,51,51);">walletA</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span><span class="o" style="font-weight:700;">();</span>
		<span class="n" style="color:rgb(51,51,51);">walletB</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span><span class="o" style="font-weight:700;">();</span>		
		<span class="n" style="color:rgb(51,51,51);">Wallet</span> <span class="n" style="color:rgb(51,51,51);">coinbase</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Wallet</span><span class="o" style="font-weight:700;">();</span>
		
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//create genesis transaction, which sends 100 NoobCoin to walletA: </span>
		<span class="n" style="color:rgb(51,51,51);">genesisTransaction</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Transaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">coinbase</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="mi" style="color:rgb(0,153,153);">100</span><span class="n" style="color:rgb(51,51,51);">f</span><span class="o" style="font-weight:700;">,</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">generateSignature</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">coinbase</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">privateKey</span><span class="o" style="font-weight:700;">);</span>	 <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//manually sign the genesis transaction </span>
		<span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionId</span> <span class="o" style="font-weight:700;">=</span> <span class="s" style="color:rgb(221,17,68);">"0"</span><span class="o" style="font-weight:700;">;</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//manually set the transaction id</span>
		<span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">reciepient</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionId</span><span class="o" style="font-weight:700;">));</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//manually add the Transactions Output</span>
		<span class="n" style="color:rgb(51,51,51);">UTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">put</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">).</span><span class="na" style="color:#008080;">id</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">));</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//its important to store our first transaction in the UTXOs list.</span>
		
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Creating and Mining Genesis block... "</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">genesis</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"0"</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">genesis</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">addTransaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">addBlock</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">genesis</span><span class="o" style="font-weight:700;">);</span>
		
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//testing</span>
		<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">block1</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">genesis</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletA's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletA is Attempting to send funds (40) to WalletB..."</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">block1</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">addTransaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sendFunds</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="mi" style="color:rgb(0,153,153);">40</span><span class="n" style="color:rgb(51,51,51);">f</span><span class="o" style="font-weight:700;">));</span>
		<span class="n" style="color:rgb(51,51,51);">addBlock</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">block1</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletA's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"WalletB's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		
		<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">block2</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">block1</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletA Attempting to send more funds (1000) than it has..."</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">block2</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">addTransaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sendFunds</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="mi" style="color:rgb(0,153,153);">1000</span><span class="n" style="color:rgb(51,51,51);">f</span><span class="o" style="font-weight:700;">));</span>
		<span class="n" style="color:rgb(51,51,51);">addBlock</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">block2</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletA's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"WalletB's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		
		<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">block3</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">Block</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">block2</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletB is Attempting to send funds (20) to WalletA..."</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">block3</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">addTransaction</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sendFunds</span><span class="o" style="font-weight:700;">(</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">publicKey</span><span class="o" style="font-weight:700;">,</span> <span class="mi" style="color:rgb(0,153,153);">20</span><span class="o" style="font-weight:700;">));</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"\nWalletA's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletA</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"WalletB's balance is: "</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">walletB</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getBalance</span><span class="o" style="font-weight:700;">());</span>
		
		<span class="n" style="color:rgb(51,51,51);">isChainValid</span><span class="o" style="font-weight:700;">();</span>
		
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="n" style="color:rgb(51,51,51);">Boolean</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">isChainValid</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">{</span>
		<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">;</span> 
		<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">previousBlock</span><span class="o" style="font-weight:700;">;</span>
		<span class="n" style="color:rgb(51,51,51);">String</span> <span class="n" style="color:rgb(51,51,51);">hashTarget</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">(</span><span class="k" style="font-weight:700;">new</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">char</span><span class="o" style="font-weight:700;">[</span><span class="n" style="color:rgb(51,51,51);">difficulty</span><span class="o" style="font-weight:700;">]).</span><span class="na" style="color:#008080;">replace</span><span class="o" style="font-weight:700;">(</span><span class="sc" style="color:rgb(221,17,68);">'\0'</span><span class="o" style="font-weight:700;">,</span> <span class="sc" style="color:rgb(221,17,68);">'0'</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;</span> <span class="n" style="color:rgb(51,51,51);">tempUTXOs</span> <span class="o" style="font-weight:700;">=</span> <span class="k" style="font-weight:700;">new</span> <span class="n" style="color:rgb(51,51,51);">HashMap</span><span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">String</span><span class="o" style="font-weight:700;">,</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span><span class="o" style="font-weight:700;">&gt;();</span> <span class="c1" style="font-style:italic;color:rgb(153,153,136);">//a temporary working list of unspent transactions at a given block state.</span>
		<span class="n" style="color:rgb(51,51,51);">tempUTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">put</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">).</span><span class="na" style="color:#008080;">id</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">genesisTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">));</span>
		
		<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//loop through blockchain to check hashes:</span>
		<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">=</span><span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">;</span> <span class="n" style="color:rgb(51,51,51);">i</span> <span class="o" style="font-weight:700;">&lt;</span> <span class="n" style="color:rgb(51,51,51);">blockchain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">size</span><span class="o" style="font-weight:700;">();</span> <span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">++)</span> <span class="o" style="font-weight:700;">{</span>
			
			<span class="n" style="color:rgb(51,51,51);">currentBlock</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">blockchain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">);</span>
			<span class="n" style="color:rgb(51,51,51);">previousBlock</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">blockchain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">i</span><span class="o" style="font-weight:700;">-</span><span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">);</span>
			<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//compare registered hash and calculated hash:</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(!</span><span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">equals</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">calculateHash</span><span class="o" style="font-weight:700;">())</span> <span class="o" style="font-weight:700;">){</span>
				<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Current Hashes not equal"</span><span class="o" style="font-weight:700;">);</span>
				<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
			<span class="o" style="font-weight:700;">}</span>
			<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//compare previous hash and registered previous hash</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(!</span><span class="n" style="color:rgb(51,51,51);">previousBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">equals</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">previousHash</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
				<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Previous Hashes not equal"</span><span class="o" style="font-weight:700;">);</span>
				<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
			<span class="o" style="font-weight:700;">}</span>
			<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//check if hash is solved</span>
			<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(!</span><span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">hash</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">substring</span><span class="o" style="font-weight:700;">(</span> <span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">difficulty</span><span class="o" style="font-weight:700;">).</span><span class="na" style="color:#008080;">equals</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">hashTarget</span><span class="o" style="font-weight:700;">))</span> <span class="o" style="font-weight:700;">{</span>
				<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#This block hasn't been mined"</span><span class="o" style="font-weight:700;">);</span>
				<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
			<span class="o" style="font-weight:700;">}</span>
			
			<span class="c1" style="font-style:italic;color:rgb(153,153,136);">//loop thru blockchains transactions:</span>
			<span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="n" style="color:rgb(51,51,51);">tempOutput</span><span class="o" style="font-weight:700;">;</span>
			<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="kt" style="font-weight:700;color:rgb(68,85,136);">int</span> <span class="n" style="color:rgb(51,51,51);">t</span><span class="o" style="font-weight:700;">=</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">;</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">&lt;</span><span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactions</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">size</span><span class="o" style="font-weight:700;">();</span> <span class="n" style="color:rgb(51,51,51);">t</span><span class="o" style="font-weight:700;">++)</span> <span class="o" style="font-weight:700;">{</span>
				<span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">currentBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactions</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">t</span><span class="o" style="font-weight:700;">);</span>
				
				<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(!</span><span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">verifiySignature</span><span class="o" style="font-weight:700;">())</span> <span class="o" style="font-weight:700;">{</span>
					<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Signature on Transaction("</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">+</span> <span class="s" style="color:rgb(221,17,68);">") is Invalid"</span><span class="o" style="font-weight:700;">);</span>
					<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span> 
				<span class="o" style="font-weight:700;">}</span>
				<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getInputsValue</span><span class="o" style="font-weight:700;">()</span> <span class="o" style="font-weight:700;">!=</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">getOutputsValue</span><span class="o" style="font-weight:700;">())</span> <span class="o" style="font-weight:700;">{</span>
					<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Inputs are note equal to outputs on Transaction("</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">+</span> <span class="s" style="color:rgb(221,17,68);">")"</span><span class="o" style="font-weight:700;">);</span>
					<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span> 
				<span class="o" style="font-weight:700;">}</span>
				
				<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionInput</span> <span class="nl">input:</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">inputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>	
					<span class="n" style="color:rgb(51,51,51);">tempOutput</span> <span class="o" style="font-weight:700;">=</span> <span class="n" style="color:rgb(51,51,51);">tempUTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">input</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionOutputId</span><span class="o" style="font-weight:700;">);</span>
					
					<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">tempOutput</span> <span class="o" style="font-weight:700;">==</span> <span class="kc" style="font-weight:700;">null</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
						<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Referenced input on Transaction("</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">+</span> <span class="s" style="color:rgb(221,17,68);">") is Missing"</span><span class="o" style="font-weight:700;">);</span>
						<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
					<span class="o" style="font-weight:700;">}</span>
					
					<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">input</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">UTXO</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span> <span class="o" style="font-weight:700;">!=</span> <span class="n" style="color:rgb(51,51,51);">tempOutput</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">value</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
						<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Referenced input Transaction("</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">+</span> <span class="s" style="color:rgb(221,17,68);">") value is Invalid"</span><span class="o" style="font-weight:700;">);</span>
						<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
					<span class="o" style="font-weight:700;">}</span>
					
					<span class="n" style="color:rgb(51,51,51);">tempUTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">remove</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">input</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">transactionOutputId</span><span class="o" style="font-weight:700;">);</span>
				<span class="o" style="font-weight:700;">}</span>
				
				<span class="k" style="font-weight:700;">for</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">TransactionOutput</span> <span class="nl">output:</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
					<span class="n" style="color:rgb(51,51,51);">tempUTXOs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">put</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">output</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">id</span><span class="o" style="font-weight:700;">,</span> <span class="n" style="color:rgb(51,51,51);">output</span><span class="o" style="font-weight:700;">);</span>
				<span class="o" style="font-weight:700;">}</span>
				
				<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">0</span><span class="o" style="font-weight:700;">).</span><span class="na" style="color:#008080;">reciepient</span> <span class="o" style="font-weight:700;">!=</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">reciepient</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
					<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Transaction("</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">+</span> <span class="s" style="color:rgb(221,17,68);">") output reciepient is not who it should be"</span><span class="o" style="font-weight:700;">);</span>
					<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
				<span class="o" style="font-weight:700;">}</span>
				<span class="k" style="font-weight:700;">if</span><span class="o" style="font-weight:700;">(</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">outputs</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">get</span><span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">1</span><span class="o" style="font-weight:700;">).</span><span class="na" style="color:#008080;">reciepient</span> <span class="o" style="font-weight:700;">!=</span> <span class="n" style="color:rgb(51,51,51);">currentTransaction</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">sender</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
					<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"#Transaction("</span> <span class="o" style="font-weight:700;">+</span> <span class="n" style="color:rgb(51,51,51);">t</span> <span class="o" style="font-weight:700;">+</span> <span class="s" style="color:rgb(221,17,68);">") output 'change' is not sender."</span><span class="o" style="font-weight:700;">);</span>
					<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">false</span><span class="o" style="font-weight:700;">;</span>
				<span class="o" style="font-weight:700;">}</span>
				
			<span class="o" style="font-weight:700;">}</span>
			
		<span class="o" style="font-weight:700;">}</span>
		<span class="n" style="color:rgb(51,51,51);">System</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">out</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">println</span><span class="o" style="font-weight:700;">(</span><span class="s" style="color:rgb(221,17,68);">"Blockchain is valid"</span><span class="o" style="font-weight:700;">);</span>
		<span class="k" style="font-weight:700;">return</span> <span class="kc" style="font-weight:700;">true</span><span class="o" style="font-weight:700;">;</span>
	<span class="o" style="font-weight:700;">}</span>
	
	<span class="kd" style="font-weight:700;">public</span> <span class="kd" style="font-weight:700;">static</span> <span class="kt" style="font-weight:700;color:rgb(68,85,136);">void</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">addBlock</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">newBlock</span><span class="o" style="font-weight:700;">)</span> <span class="o" style="font-weight:700;">{</span>
		<span class="n" style="color:rgb(51,51,51);">newBlock</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">mineBlock</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">difficulty</span><span class="o" style="font-weight:700;">);</span>
		<span class="n" style="color:rgb(51,51,51);">blockchain</span><span class="o" style="font-weight:700;">.</span><span class="na" style="color:#008080;">add</span><span class="o" style="font-weight:700;">(</span><span class="n" style="color:rgb(51,51,51);">newBlock</span><span class="o" style="font-weight:700;">);</span>
	<span class="o" style="font-weight:700;">}</span>
<span class="o" style="font-weight:700;">}</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">打印：</p>
  <div class="language-java highlighter-rouge" style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <div class="highlight" style="margin-bottom:16px;">
    <pre class="highlight" style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin-bottom:0px;line-height:1.45;background:rgb(247,247,247);padding-top:16px;padding-bottom:16px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;margin:0px;background:transparent 0px 0px;border:0px;line-height:inherit;"><span class="n" style="color:rgb(51,51,51);">Connected</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">the</span> <span class="n" style="color:rgb(51,51,51);">target</span> <span class="n" style="color:rgb(51,51,51);">VM</span><span class="o" style="font-weight:700;">,</span> <span class="nl">address:</span> <span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="mf" style="color:rgb(0,153,153);">127.0</span><span class="o" style="font-weight:700;">.</span><span class="mf" style="color:rgb(0,153,153);">0.1</span><span class="o" style="font-weight:700;">:</span><span class="mi" style="color:rgb(0,153,153);">57085</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="o" style="font-weight:700;">,</span> <span class="nl">transport:</span> <span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">socket</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span>
<span class="n" style="color:rgb(51,51,51);">Creating</span> <span class="n" style="color:rgb(51,51,51);">and</span> <span class="n" style="color:rgb(51,51,51);">Mining</span> <span class="n" style="color:rgb(51,51,51);">Genesis</span> <span class="n" style="color:rgb(51,51,51);">block</span><span class="o" style="font-weight:700;">...</span> 
<span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">Successfully</span> <span class="n" style="color:rgb(51,51,51);">added</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">Block</span>
<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">Mined</span><span class="o" style="font-weight:700;">!!!</span> <span class="o" style="font-weight:700;">:</span> <span class="mo" style="color:rgb(0,153,153);">000</span><span class="n" style="color:rgb(51,51,51);">b5a7ca6bf07639122cb31e884996895a482c281dd89c203824f1e93a661bf</span>

<span class="n" style="color:rgb(51,51,51);">WalletA</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">100.0</span>

<span class="n" style="color:rgb(51,51,51);">WalletA</span> <span class="n" style="color:rgb(51,51,51);">is</span> <span class="n" style="color:rgb(51,51,51);">Attempting</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">send</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">funds</span> <span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">40</span><span class="o" style="font-weight:700;">)</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">WalletB</span><span class="o" style="font-weight:700;">...</span>
<span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">Successfully</span> <span class="n" style="color:rgb(51,51,51);">added</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">Block</span>
<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">Mined</span><span class="o" style="font-weight:700;">!!!</span> <span class="o" style="font-weight:700;">:</span> <span class="mo" style="color:rgb(0,153,153);">000</span><span class="n" style="color:rgb(51,51,51);">c7f814357abfea86ad1b38ec1dc3afed2afc9107f2bacc933d8136bf34df0</span>

<span class="n" style="color:rgb(51,51,51);">WalletA</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">60.0</span>
<span class="n" style="color:rgb(51,51,51);">WalletB</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">40.0</span>

<span class="n" style="color:rgb(51,51,51);">WalletA</span> <span class="n" style="color:rgb(51,51,51);">Attempting</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">send</span> <span class="n" style="color:rgb(51,51,51);">more</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">funds</span> <span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">1000</span><span class="o" style="font-weight:700;">)</span> <span class="n" style="color:rgb(51,51,51);">than</span> <span class="n" style="color:rgb(51,51,51);">it</span> <span class="n" style="color:rgb(51,51,51);">has</span><span class="o" style="font-weight:700;">...</span>
<span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">#</span><span class="n" style="color:rgb(51,51,51);">Not</span> <span class="n" style="color:rgb(51,51,51);">Enough</span> <span class="n" style="color:rgb(51,51,51);">funds</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">send</span> <span class="n" style="color:rgb(51,51,51);">transaction</span><span class="o" style="font-weight:700;">.</span> <span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">Discarded</span><span class="o" style="font-weight:700;">.</span>
<span class="n" style="color:rgb(51,51,51);">Block</span> <span class="n" style="color:rgb(51,51,51);">Mined</span><span class="o" style="font-weight:700;">!!!</span> <span class="o" style="font-weight:700;">:</span> <span class="mo" style="color:rgb(0,153,153);">000</span><span class="n" style="color:rgb(51,51,51);">b3822fb7985db438712816727d4bc382926a1c4654062aad4071d9b9fad98</span>

<span class="n" style="color:rgb(51,51,51);">WalletA</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">60.0</span>
<span class="n" style="color:rgb(51,51,51);">WalletB</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">40.0</span>

<span class="n" style="color:rgb(51,51,51);">WalletB</span> <span class="n" style="color:rgb(51,51,51);">is</span> <span class="n" style="color:rgb(51,51,51);">Attempting</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">send</span> <span class="nf" style="font-weight:700;color:rgb(153,0,0);">funds</span> <span class="o" style="font-weight:700;">(</span><span class="mi" style="color:rgb(0,153,153);">20</span><span class="o" style="font-weight:700;">)</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">WalletA</span><span class="o" style="font-weight:700;">...</span>
<span class="n" style="color:rgb(51,51,51);">Transaction</span> <span class="n" style="color:rgb(51,51,51);">Successfully</span> <span class="n" style="color:rgb(51,51,51);">added</span> <span class="n" style="color:rgb(51,51,51);">to</span> <span class="n" style="color:rgb(51,51,51);">Block</span>

<span class="n" style="color:rgb(51,51,51);">WalletA</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">80.0</span>
<span class="n" style="color:rgb(51,51,51);">WalletB</span><span class="err" style="color:rgb(166,23,23);background-color:rgb(227,210,210);">'</span><span class="n" style="color:rgb(51,51,51);">s</span> <span class="n" style="color:rgb(51,51,51);">balance</span> <span class="nl">is:</span> <span class="mf" style="color:rgb(0,153,153);">20.0</span>
<span class="n" style="color:rgb(51,51,51);">Blockchain</span> <span class="n" style="color:rgb(51,51,51);">is</span> <span class="n" style="color:rgb(51,51,51);">valid</span>
</code></pre>
   </div>
  </div>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">现在钱包能够安全地在您的区块链上发送金额，只要他们有金额发送。这意味着你有你自己的本地加密货币</p>
  <h3 class="clickable-header" style="margin-top:1em;line-height:1.43;font-size:1.5em;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">可以进行交易的区块链</h3>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);"><a href="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif" rel="nofollow" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif" style="background-color:transparent;color:rgb(65,131,196);"><img src="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif" alt="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif" title="https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif" style="border:0px;"></a></p>
  <p style="color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">你已经成功地创建了自己的加密货币。你的区块链：</p>
  <ul style="padding-left:2em;margin-bottom:16px;color:rgb(51,51,51);font-family:Arial, 'Hiragino Sans GB', '冬青黑', 'Microsoft YaHei', '微软雅黑', SimSun, '宋体', Helvetica, Tahoma, 'Arial sans-serif';background-color:rgb(255,255,255);">
   <li>允许用户创建钱包</li>
   <li>使用椭圆曲线加密方式为钱包提供公钥和私钥</li>
   <li>通过使用数字签名算法证明所有权，确保资金转移</li>
   <li>允许用户在区块链上进行交易</li>
  </ul>
  <p>项目地址：<a href="https://github.com/pibigstar/blockchain" rel="nofollow">https://github.com/pibigstar/blockchain</a></p>
  <p>转载自：<a href="https://longfeizheng.github.io/2018/03/11/%E7%94%A8Java%E5%88%9B%E5%BB%BA%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%E9%93%BE-part2/" rel="nofollow">https://longfeizheng.github.io/2018/03/11/用Java创建你的第一个区块链-part2/</a></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/junmoxi/article/details/79749744,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/junmoxi/article/details/79749744,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链开发实战：如何从零打造一个去中心化应用 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链开发实战：如何从零打造一个去中心化应用" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/Blockchain_lemon/article/details/79466131 编译 | 区块链大本营 整理 |&nbsp;reason_W 区块链会是一场革命吗？ 今天，很多成功的互联网企业都是在以中介者的形式存在。比如Google——你和互联网之间的中介，比如亚马逊——买家和卖家之间的中介。但区块链——以“去中心化”为最基本特征的技术的发展却很有可能破坏这些互联网巨头赖以成功的结构。 互联网巨头的事咱们暂且不操心，那么从一个开发者的角度呢？我们需要关心什么呢？作为一个开发者，我们该如何使用区块链构建应用程序？ 我们可以在这么复杂的基础概念之上创造出非常易用的工具吗？这个工具的开发体验又有多友好呢？ 我们知道，最好的教程就是带你去从头开发一个应用程序。所以我们将使用区块链技术制作一个简单的去中心化广告服务器，称为“零美元主页”。本文将告诉你一群开发者在摸索使用区块链技术时最完整的试错经过和心路历程。 什么是区块链应用？ 要做区块链应用，首先要知道区块链有什么特性。而它最突出的特性就是“去中心化”。简单来说，就是不再像以前的技术一样需要一个中心节点负责管理，而是通过一系列复杂且可靠的技术，由网络中所有的节点共同认可，共同记录，共同维护，解决网络中交易双方的信任问题。这是一条神奇的链，有了这个链就真的可以实现没有中间商赚差价了。 回到正文，区块链正在以去中心化的特质威胁着互联网巨头们的基础。而本文将集中于广告平台。广告平台是广告位购买方和广告渠道提供商之间的中介。我们的项目是通过区块链技术建立一个去中心化的广告平台。也就是跳过广告中间商，通过利用区块链技术本身的特性解决在互联网环境中进行交易时相互之间的信任问题。 自著名的百万美元主页实验以来，想要在付费广告领域通过创新变的富有已经越来越困难了。 The Million Dollar Homepage&nbsp; http://www.milliondollarhomepage.com/ ﻿﻿﻿ 2005年，一个21岁的英国男孩Alex创建了一个名为“百万美元主页”的网站，将页面做成100万个小格子组成的广告牌，每个格子售价1美元。这一别出心裁的创意吸引了不少广告商注意，不到一年时间内，100万个格子全部售出。 相反，我们选择建立一个允许免费展示广告的平台——零美元主页。 免费，但并不代表什么都不付出：广告商需要通过开源贡献来换取广告位。因此，我们构建了一个去中心化的应用来管理广告在特定网页上的展示方式。 广告商需要具备编程能力，以便能够将他们的广告放在此页面上。 用户工作流程 具体而言，当我们在marmelab的开源库（https://github.com/marmelab）之一合并Pull请求（PR）时，会有一个GitHub机器人对PR进行评论，并邀请PR作者在广告平台管理面板上发布他们的广告。 ﻿﻿ 打开评论中包含的链接之后，PR作者会被要求使用他们的GitHub凭证进行登录。然后，他们可以上传广告——实际上就是一张简单的图片。此图片将按照时间顺序添加到同样由其他PR作者上传的图片队列中。 ﻿﻿ 每天半夜的时候，脚本都会自动地获取下一个图像（使用先进先出排序），并在接下来的24小时内将其显示在http://marmelab.com/ZeroDollarHomepage/ 上。 ﻿﻿ 注意：这整个过程不需要中介参与，但为了避免在网站上出现成人内容，我们会在图像上传之后，发布之前通过Google Vision API进行验证。 应用架构 以下是我们广告平台的四步的架构： ﻿﻿ 开源贡献者通知 只要开源PR合并到了我们的某个存储库中，GitHub就会将PR详细信息发送给负责管理的app。app会在PR下方进行评论以通知贡献者。该评论包含一个可以进入管理界面的链接，以及PR的详细信息。 声明和图片上传 在打开评论链接之后，贡献者会转到管理员界面。他必须使用他的GitHub凭证登录才能通过身份验证。管理程序然后会通过GitHub获取PR详细信息，并检查贡献者是否是PR作者。如果没有问题，管理程序会显示图片上传栏。当贡献者上传图片时，管理程序会将PR ID推送到区块链，并将图片上传到CDN（以PR id命名）。管理程序同时会根据区块链中仍在等待发布的图像的有效PR数量计算并显示图像发布的大致日期。 广告位置 每隔24小时，cron（一个执行周期性任务计划的程序）就会要求区块链查找尚未发布的下一个PR。 区块链将此PR标记为已发布并发送该ID。 cron将以PR id命名的图像重命名为“current image”。 广告显示 每次访问者想要在“零美元主页”中发布广告，该主页都会向CDN询问当前图像。如果它恰好是区块链上最新发布的广告，那么该广告就会至少保留1天（直到另一个贡献者声明了一个PR为止）。 看起来有点意外的是，区块链在这个过程中起着非常小的作用。这是因为在实际编程过程中，我们发现无法把广告平台的整个代码都建立在区块链之上。事实上，区块链在连接互联网和处理方面的能力都非常有限。所以我们只用区块链来实现最关键的广告投放任务： 注册经过认证的贡献者的Pull请求 获取最后一次没有发布的Pull请求，并将其标记为发布 由于各种原因，管理程序中的其他任务最终没有使用区块链： 从webhook对Pull的请求进行注册 在Pull请求之前进行注册是没有用的，因为Pull作者可能从未声明它。此外，将数据存储在区块链中并不是没有代价的，所以我们只存储我们必须存储的数据。但这样做的缺点是，我们的公共软件仓库（包括在此实验之前创建的公共软件仓库）中的任何公共资源都有资格进行下一步操作。 通过在GitHub发布评论来通知用户 智能合约不能调用外部API，所以我们不能通过这项技术来实现本项任务。因此，我们将此任务交给管理程序来完成。 验证声明的PR的作者 同样是因为智能合约不能调用GitHub API。所以，我们也把这个逻辑任务移至管理程序，并将其作为调用区块链的先决条件。 存储图像 理论上，我们可以将任何东西存储在区块链中，包括图像。 但实际而言，图像需要很多存储空间，而且我们没有办法在我们的智能合约中存储多个“表格”（数据阵列）。 将显示的广告更新为队列中的下一个 区块链中没有与setTimeout函数或cron工具等类似的功能。然而，你可能每隔x个区块就需要执行一次代码，不过这与时间无关。所以，我们在API上使用了类似cron的库。 研究，记录和第一次尝试 考虑到区块链网络的成熟度和设计目的，我们在选择要开发的区块链网络时最终选择了以太坊。 很快，我们就遇到了第一个困难。直到几个星期前，哪怕只是简单的测试，如果没有购买以太币，我们也无法使用以太坊区块链。此外，以太坊在之前的版本（名为Frontier）中并没有真正许可私有链，这就使开发变得非常复杂。因为没有私有链，只能在公共网络上进行开发，任何访问以太坊网络的人都可能会调用你的测试合约。更重要的是，这份文件只是一个志愿倡议，并且与发展状态不同步。 注：在我们开始开发程序后，以太坊就发布了新版本，从Frontier切换到Homestead，并且改善了Homestead的文档质量。 Homestead&nbsp;http://www.ethdocs.org/en/latest/introduction/contributors.html ﻿﻿ 尽管存在这些缺陷，我们仍然在Nancy，Paris和Dijon的以太网网络上成功注册了三个节点，并在这些节点之间共享ping。 在文档搜索中，我们最终找到了 Eris 文档（https://docs.erisindustries.com/）。Eris在解释区块链和合约方面做得非常出色。此外，他们专门在以太坊之上建立了一个层级，并开源了一系列工具以简化智能合约的开发过程。 Eris是一个命令行工具，你可以使用它来初始化你需要的任意数量的本地区块链。 如何操作智能合约 智能合约与API非常相似。它有几个公共函数，可以被在区块链网络上注册过的任何人调用。但与API不同的是，智能合约不能调用外部Web API（区块链是封闭的生态系统）。但是，智能合约可能会调用其他智能合约，只要知道他们的地址。 与API一样，公共函数只是它们的冰山一角。实际上合约可能由许多私有函数，变量等组成。 智能合约按照以太坊专有的二进制格式托管在区块链中，可由以太坊虚拟机执行。用于编写合约的语言和编辑器有： Serpent，跟Python很像（https://github.com/ethereum/wiki/wiki/Serpent） Solidity，跟Javascript很像（http://solidity.readthedocs.org/en/latest/） 在marmelab中，我们已经使用Javascript编写了很多代码，因此在编写合约时，我们选择了与Javascript类似的Solidity。Solidity合约存储在.sol文件中。 “零美元主页”合约 “零美元主页”合约存储了已声明的Pull请求，以及待发布的请求队列。 Solidity合约的第一个版本如下所示： // in src/ethereum/ZeroDollarHomePage.solcontract ZeroDollarHomePage { &nbsp; &nbsp;uint constant ShaLength = 40; &nbsp; &nbsp;enum ResponseCodes { &nbsp; &nbsp; &nbsp; &nbsp;Ok, &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequestId, &nbsp; &nbsp; &nbsp; &nbsp;InvalidAuthorName, &nbsp; &nbsp; &nbsp; &nbsp;InvalidImageUrl, &nbsp; &nbsp; &nbsp; &nbsp;RequestNotFound, &nbsp; &nbsp; &nbsp; &nbsp;EmptyQueue, &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed &nbsp; &nbsp;} &nbsp; &nbsp;struct Request { &nbsp; &nbsp; &nbsp; &nbsp;uint id; &nbsp; &nbsp; &nbsp; &nbsp;string authorName; &nbsp; &nbsp; &nbsp; &nbsp;string imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;uint createdAt; &nbsp; &nbsp; &nbsp; &nbsp;uint displayedAt; &nbsp; &nbsp;} &nbsp; &nbsp;// what the contract stores &nbsp; &nbsp;mapping (uint =&gt; Request) _requests; // key is the pull request id &nbsp; &nbsp;uint public numberOfRequests; &nbsp; &nbsp;uint[] _queue; &nbsp; &nbsp;uint public queueLength; &nbsp; &nbsp;uint _current; &nbsp; &nbsp;address owner; &nbsp; &nbsp;// constructor &nbsp; &nbsp;function ZeroDollarHomePage() { &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender; &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests = 0; &nbsp; &nbsp; &nbsp; &nbsp;queueLength = 0; &nbsp; &nbsp; &nbsp; &nbsp;_current = 0; &nbsp; &nbsp;} &nbsp; &nbsp;// a contract must give a way to destroy itself once uploaded to the blockchain &nbsp; &nbsp;function remove() { &nbsp; &nbsp; &nbsp; &nbsp;if (msg.sender == owner){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp;} &nbsp; &nbsp;// the following three methods are public contracts entry points &nbsp; &nbsp;function newRequest(uint pullRequestId, string authorName, string imageUrl) returns (uint8 code, uint displayDate) { &nbsp; &nbsp; &nbsp; &nbsp;if (pullRequestId &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Solidity is a strong typed language. You get compilation errors when types mismatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidPullRequestId); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (_requests[pullRequestId].id == pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.PullRequestAlreadyClaimed); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (bytes(authorName).length &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidAuthorName); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (bytes(imageUrl).length &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidImageUrl); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;// store new pull request details &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests += 1; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].id = pullRequestId; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].authorName = authorName; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].imageUrl = imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].createdAt = now; &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp;queueLength += 1; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.Ok); &nbsp; &nbsp; &nbsp; &nbsp;displayDate = now + (queueLength * 1 days); &nbsp; &nbsp; &nbsp; &nbsp;// no need to explicitly return code and displayDate as they are in the method signature &nbsp; &nbsp;} &nbsp; &nbsp;function closeRequest() returns (uint8) { &nbsp; &nbsp; &nbsp; &nbsp;if (queueLength == 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return uint8(ResponseCodes.EmptyQueue); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_requests[_queue[_current]].displayedAt = now; &nbsp; &nbsp; &nbsp; &nbsp;delete _queue[0]; &nbsp; &nbsp; &nbsp; &nbsp;queueLength -= 1; &nbsp; &nbsp; &nbsp; &nbsp;_current = _current + 1; &nbsp; &nbsp; &nbsp; &nbsp;return uint8(ResponseCodes.Ok); &nbsp; &nbsp;} &nbsp; &nbsp;function getLastNonPublished() returns (uint8 code, uint id, string authorName, string imageUrl, uint createdAt) { &nbsp; &nbsp; &nbsp; &nbsp;if (queueLength == 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.EmptyQueue); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;var request = _requests[_queue[_current]]; &nbsp; &nbsp; &nbsp; &nbsp;id = request.id; &nbsp; &nbsp; &nbsp; &nbsp;authorName = request.authorName; &nbsp; &nbsp; &nbsp; &nbsp;imageUrl = request.imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;createdAt = request.createdAt; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.Ok); &nbsp; &nbsp;}} 在第一次尝试时，我们使用Eris JS库与我们的区块链进行通信。从Node.js文件中解析合约就变得非常简单： import eris from &#39;eris&#39;;function getContract(url, account) { &nbsp; &nbsp;const address = // Read address file stored on disk by the eris CLI; &nbsp; &nbsp;const abi = // Read abi file stored on disk by the eris CLI; &nbsp; &nbsp;const manager = eris.newContractManagerDev(url, account); &nbsp; &nbsp;return manager.newContractFactory(abi).at(address);} 而且它的调用也不困难： function* newRequest(pullrequestId, authorName, imageUrl) { &nbsp; &nbsp;const contract = getContract(url, account); &nbsp; &nbsp;// First gotcha, when a function returns several named variables, they are returned as an Arrays &nbsp; &nbsp;// Second gotcha, numbers are returned as instances of BigNumber, do not forget to convert when standard numbers are expected &nbsp; &nbsp;const [codeAsBigNumber, displayDateAsBigNumber] = yield contract.newRequest(pullrequestId, authorName, imageUrl); &nbsp; &nbsp;const code = codeAsBigNumber.toNumber(); &nbsp; &nbsp;if (code !== 0) { &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(getErrorMessageFromCode(code)); &nbsp; &nbsp;} &nbsp; &nbsp;// Return the displayDate for UI confirmation screen &nbsp; &nbsp;return displayDate.toNumber();} 有关Eris JS库的更多信息，可以参阅Eris文档（https://docs.erisindustries.com/）。 单元测试合约 我们非常喜欢测试驱动开发，但遇到的第一个问题就是：我们如何测试Solidity智能合约？ Eris的项目成员也为此提供了一个工具：sol-unit（https://github.com/smartcontractproduction/sol-unit）。 它在Docker容器中（确保每次测试都在干净的环境中运行）为每次测试运行一个新的本地区块链网络，并执行测试。测试也会写成一个合约。 当然，这个工具也没那么快就能用。 sol-unit是一个npm软件包，为了使用测试功能（assertions，等），我们必须在测试合约中导入由这个软件包提供的合约。这可以用一个简单的Solidity语法实现： import &quot;../node_modules/sol-unit/.../Asserter.sol&quot;; 实际的编译过程并没有看起来那么顺利。编译合约时我们遇到了一个奇怪的情形。即，不能用上面这样的路径导入合约。 我们最终在测试的makefile目标中添加了一个命令，将这些sol-unit&nbsp;合约复制到跟我们的项目相同的文件夹中。之后再运行sol-unit就很简单了，我们可以开始继续写代码了。 copy-sol-unit: &nbsp; &nbsp;@cp -f ./node_modules/sol-unit/contracts/src/* ./src/ethereum/compile-contract: &nbsp; &nbsp;solc --bin --abi -o ./src/ethereum ./src/ethereum/ZeroDollarHomePage.sol ./src/ethereum/ZeroDollarHomePageTest.soltest-ethereum: copy-sol-unit compile-contract &nbsp; &nbsp;./node_modules/.bin/solunit --dir ./src/ethereum 运行测试区块链 运行区块链和部署我们的合约只要按照Eris文档就会非常简单。通过使用之前已经集成在makefile中的一些命令，我们又进一步解决了遇到的一些麻烦。基于我们的合约运行新区块链的整个过程如下所示： 重置任何正在运行的eris docker容器，并删除一些临时文件 启动eris密钥服务 生成我们的账户密钥，并将其地址存储在一个便于稍后由JS API加载的文件中， 生成genesis.json，这是区块链的“区块0” 创建并启动新的区块链 将合约上传至区块链并保存其地址，以便在需要时调用 几天的工作之后，我们就能够在本地的Eris区块链上运行合约了。 从Eris到以太坊 我们希望可以在本地以太坊区块链上尝试我们的合约。 要与以太坊区块链内的合约进行通信，我们必须使用Web3库。在尝试使用它们的过程中，我们也学到了很多，并意识到了Eris的许多潜在的复杂性。 首先，之前假设合约与API类似的想法是不正确的。我们必须区分仅从区块链读取数据的函数，以及将数据写入区块链的函数。 第一种（只读函数），像API所做的那样，会异步返回结果数据。第二种（写入函数）只会返回一个交易散列。并且在相应的块被开采之前（这可能需要一些时间，最差情况是在10秒到1分钟之间），写入函数的预期副作用（区块链内部的更改）不会生效。另外，让这些写入函数返回值的能力我们也还没有。所以我们不得不改变我们的solidity代码来首先调用写入函数，然后调用只读函数来获得结果。 我们还发现了一些事件，可以在智能合约中发生情况时进行通知。智能合约负责触发事件。它们在solidity的代码可以这样写： event PullRequestClaimed(unit pullRequestId, uint estimatedDisplayDate); 他们可以在任何智能合约函数中触发，例如： PullRequestClaimed(pullRequestId, estimatedDisplayDate); 这些事件会被永久存储在区块链中。这意味着我们可以使用区块链存储事件。这可能是判断函数调用是否已成功执行的最简单方法：智能合约可以在其进程结束时触发事件，触发条件包括执行失败、计算结果等等。值得注意的是，Meteor&nbsp;的某些集成包已经可以直接用了。 最终，虽然实现的功能几乎相同，但我们已经可以将我们的智能合约重构的相当简单。我们必须摆脱映射（这些映射无法使用——因为我们的交易不是由以太坊网络开采的）。 solidity这种语言可能和JavaScript很接近，但它仍然非常年轻，并且不完整。数组对象还没有我们在JavaScript中使用的那些函数（甚至没有indexOf），字符串对象也没有任何函数。这在不久的将来或许可以通过社区的贡献来解决。 以太坊的操作如下： // in src/ethereum/ZeroDollarHomePage.solcontract ZeroDollarHomePage { &nbsp; &nbsp;event InvalidPullRequest(uint indexed pullRequestId); &nbsp; &nbsp;event PullRequestAlreadyClaimed(uint indexed pullRequestId, uint timeBeforeDisplay, bool past); &nbsp; &nbsp;event PullRequestClaimed(uint indexed pullRequestId, uint timeBeforeDisplay); &nbsp; &nbsp;event QueueIsEmpty(); &nbsp; &nbsp;bool _handledFirst; &nbsp; &nbsp;uint[] _queue; &nbsp; &nbsp;uint _current; &nbsp; &nbsp;address owner; &nbsp; &nbsp;function ZeroDollarHomePage() { &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender; &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = false; &nbsp; &nbsp; &nbsp; &nbsp;_current = 0; &nbsp; &nbsp;} &nbsp; &nbsp;function remove() { &nbsp; &nbsp; &nbsp; &nbsp;if (msg.sender == owner){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp;} &nbsp; &nbsp;function newRequest(uint pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp;if (pullRequestId &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequest(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;// Check that the pr hasn&#39;t already been claimed &nbsp; &nbsp; &nbsp; &nbsp;bool found = false; &nbsp; &nbsp; &nbsp; &nbsp;uint index = 0; &nbsp; &nbsp; &nbsp; &nbsp;while (!found &amp;&amp; index &lt; _queue.length) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (_queue[index] == pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;found = true; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;index++; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (found) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed(pullRequestId, (index - _current) * 1 days, _current &gt; index); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp;PullRequestClaimed(pullRequestId, (_queue.length - _current) * 1 days); &nbsp; &nbsp;} &nbsp; &nbsp;function closeRequest() { &nbsp; &nbsp; &nbsp; &nbsp;if (_handledFirst &amp;&amp; _current &lt; _queue.length - 1) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_current += 1; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = true; &nbsp; &nbsp;} &nbsp; &nbsp;function getLastNonPublished() constant returns (uint pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp;if (_current &gt;= _queue.length) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return 0; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;return _queue[_current]; &nbsp; &nbsp;}} 对Pull的请求进行声明并返回估计的显示日期的演变过程为： // make a [transaction](https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethsendtransaction) call to our smart-contract write functioncontract.newRequest.sendTransaction(pullrequestId, { &nbsp; &nbsp;to: client.eth.coinbase,}, (err, tx) =&gt; { &nbsp; &nbsp;if (err) { &nbsp; &nbsp; &nbsp; &nbsp;throw error; &nbsp; &nbsp;} &nbsp; &nbsp;// wait for it to be mined using [code](https://github.com/ethereum/web3.js/issues/393) from [@croqaz](https://github.com/croqaz) &nbsp; &nbsp;return waitForTransationToBeMined(client, tx) &nbsp; &nbsp; &nbsp; &nbsp;.then(txHash =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!txHash) throw new Error(&#39;Transaction failed (no transaction hash)&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// get its receipt which might contains informations about event triggered by the contract&#39;s code &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// this function might also check wether the transaction was successful by analyzing the receipt for ethereum specific error cases (insufficient funds, etc.) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return getReceipt(client, txHash); &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp; &nbsp; &nbsp; &nbsp;.then(receipt =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// parse those logs to extract only event data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return parseReceiptLogs(receipt.logs, contractAbi)); &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp; &nbsp; &nbsp; &nbsp;.then(logs =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (logs.length === 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(&#39;Transaction failed (Invalid logs)&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const log = logs[0]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;PullRequestClaimed&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return log.args.timeBeforeDisplay.toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;PullRequestAlreadyClaimed&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const number = log.args.timeBeforeDisplay; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.args.past) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return number.negated().toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return number.toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;InvalidPullRequest&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(&#39;Invalid pull request id&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;});}) 通过上面的代码，我们的去中心化应用就可以在本地以太坊网络中工作了。 部署到生产环境 如果说在本地环境中运行我们的应用是一项挑战，那么将其部署到真正的以太坊网络中的生产就是一场战斗。 这其中有几点非常值得注意。最重要的一点是合约在代码中是不可变的。这意味着： 你部署到区块链的合约会永远保持在那里。如果你发现你的合约存在缺陷，那也无法修复——必须部署新的合约。 部署现有合约的新版本时，以前合约中存储的任何数据都不会自动传输过去——除非你主动使用过去的数据初始化新合约。在我们的案例中，纠正合约中的错误实际上是抹去了已记录的PR（无论是已发布的广告还是待发布的广告）。 每个合约版本都有一个id（例如，我们的“零美元主页”合约id是0xd18e21bb13d154a16793c6f89186a034a8116b74）。 由于过去的版本也可能包含数据，如果你不想丢失数据（我们也一样），请继续跟踪过去的合约ID。 由于你无法更新合约，因此也无法回滚更新。在重新部署之前需要确保合约有效。 当你部署现有合约的新版本时，旧的（错误的）合约仍然可以被调用。 任何引用合约的区块链以外的系统（例如我们在零美元主页中的节点管理应用）都必须更新为指向新合约。我们一开始忘了这么做，还非常困惑为什么我们的新代码没有运行，后来才明白。 如果在代码中包含自杀（suicide&nbsp;）调用，合约作者可以终止合约。但合约的所有现有交易都会保留在区块链中——永远存在。如果不希望它消失，请确保终止开关已经处理了合约中的其余以太币。 还有一个问题是，区块链中的每个合约部署和写入操作都会产生数量不一的以太网络。我们设法获得了5个以太币，但并不知道到底需要多少以太币才能够部署我们的合约或者调用一个交易。要测试出来每次失败产生的成本是很难的。 对于Node.js部分，像前面大部分的项目一样，我们决定在AWS EC2实例上运行它。为此，我们必须： 在服务器上运行以太坊节点 将整个区块链下载到此服务器 在节点上使用一些以太币解锁一个帐户 部署我们的应用程序并将其链接到节点 通过节点将我们的智能合约注册到区块链中 确保你的区块链节点服务器有充足的存储空间。目前区块链的大小约为15GB。 EC2实例的默认卷大小为8GB，确实也很大。因为一开始没有下载完整的区块链（我们也没有马上意识到），所以我们遇到了很多麻烦。例如，我们有一个有5个以太币的帐户，但很长一段时间，系统的状态都会显示我们没有解锁帐户，或者好像我们没有以太币。 直到我们将区块链的其余部分下载下来才解决了这个问题。 同样，解锁我们那个包含5个以太币的宝贵账户也不是一件容易的事。我们不想在应用程序中对我们的密码进行硬编码，而是想用supervisord运行节点来简化部署。艰辛的摸索之后（唉，累啊），我们终于找到了一种方式，可以在改变配置的同时，不会暴露密码。以下就是我们所用的supervisord配置： [program:geth]command=geth --ipcdisable --rpc --fast --unlock 0 --password /path/to/our/password/in/a/fileautostart=falseautorestart=truestartsecs=10stopsignal=TERMuser=ubuntustdout_logfile=/var/log/ethereum-node.out.logstderr_logfile=/var/log/ethereum-node.err.log 最后一个安全提示：区块链的远程过程调用（RPC）端口为8545。请勿在EC2实例上打开此端口！否则任何知道实例IP的人都可以控制你的以太坊节点，并窃取你的以太网。 以太币和瓦斯（Gas） 在以太坊区块链中部署和调用合约并不是免费的，需要承担一定的计算代价。而且由于区块链运行代价高昂，任何写入操作都要承担代价。在以太网中，调用写入合约的方法的代价取决于方法的复杂性。以太坊附带了一份瓦斯费用列表（http://ether.fund/tool/gas-fees），告诉你应该在合约调用时需要添加多少以太币才能让它执行。 实际上，这里的以太币消耗量其实非常小，只占一个以太币的一小部分。以太坊区块链还引入了另一种运行合约的货币：瓦斯（Gas）。 1瓦斯= 0.00001以太币 1 以太币= 100,000瓦斯 根据计算能力的供应情况和计算需求，未来瓦斯和以太币的转化率会有所不同。 ﻿﻿ 处理一次交易的费用并不是强制收取的，但却非常推荐。以太坊的文件中说：“矿工可以选择忽略瓦斯价格太低的交易”。成功开采好一个新区块会给矿工奖励5个以太币。 为了调用我们自己的合约，以太坊区块链大概需要0.00045个到0.00098个以太币（这个实际价格取决于瓦斯价格和交易使用的瓦斯）。 那么怎样才能获得以太币和瓦斯呢？你可以购买以太币（当然主要是通过交换比特币获得），也可以自己去挖矿。在法国，比特币或以太币的购买需要的程序几乎和开设银行账户一样麻烦。这个过程很慢（大概要几天），也很痛苦，取决于由报价和需求确定的汇率。 挖矿以太币 最后我们决定自己挖掘以太币。如果想了解一下在以太坊挖矿到底是不是有利可图，自己挖确实也是一个很好的方法。我们制作了一个非常大的亚马逊EC2实例，它具有强大的GPU计算能力（是一个g2.2xlarge实例）。这个实例的价格是每天17美元。我们安装了以太网，并启动了我们的节点。由于高内存和存储需求，我们很快就必须增强这个实例。加入区块链时节点做的第一件事就是下载过去交易的全部历史记录。这需要大量的存储空间：区块链历史记录超过14GB，Ethash工作证明大约需要3GB。 一旦以太坊节点启动，我们就必须要挖掘3天才能创建出一个有效的区块： ﻿﻿ 提醒一下，以太坊区块链每10秒钟挖一块。开采一个区块可以获得5个以太币，售价大约为55美元（作者写文章时的价格）。我们的增强版EC2实例运行3天的成本约为51美元。总而言之，在AWS上挖以太币比直接买以太币更便宜。但是我们非常幸运：我们开发这个区块的时候挖掘难度并不很大，在开发完之后，网络的挖掘难度就增加了三倍。 5个以太币可以让我们运行“零美元主页”多长时间呢？现在我们来计算一下。 “零美元主页”的工作流程意味着每天都会有一笔交易，另外每个声明的PR都会有一笔交易。假设贡献者每天声明一个PR，那么运行该平台每年最多将花费365 * 2 * 0.00098 = 0.72 以太币。5个以太币可以让我们运行该平台近7年。 正如你所看到的，在以太坊运行合约并不是免费的，不过以目前的价格来说，它仍然很便宜。当然，以太币价值的变化很大。由于挖比特币的利润越来越低，一些大型比特币矿场开始转向以太坊。这也让采矿变得越来越困难，并且使得以太网每天都在变得更加昂贵。 最终的惊喜 最终，我们的智能合约在EC2上托管的现实世界以太坊节点中运行非常好。 但当我们完成这个项目的时候，以太坊发布了它们的Homestead版本，这带来了很多新东西，完全破坏了我们的代码。我们花了大约一个星期的时间才明白，并且通过反复试验修复了因不明原因而不兼容的代码。 Tip Homestead发布了一个隐藏的以太坊功能——私有网络——来简化开发。之前以太坊缺乏私有网络是我们当时选择使用Eris的原因之一。 “零美元主页”平台现在已经启动并且开始运行了。你可以通过在GitHub上的marmelab的开源库之一上开一个Pull请求来使用它，查看http://marmelab.com/ZeroDollarHomepage/ 上当前显示的广告，或浏览marmelab / ZeroDollarHomePage上的应用程序代码。是的，我们正在开源整个广告平台，以便你可以详细了解其工作原理，并在本地进行复制。 ﻿﻿ 调试 以太坊留给开发者的体验其实是非常糟糕的。想象一下没有日志，也没有调试工具，你发现程序失败的唯一方法是通过一行一行输出“I&#39;m here”字符串来查找问题。甚至有时（例如在Solidity合约中），你都不能这样做。或者某些在开发环境中完美工作的程序在生产环境中却无法实现。这就是以太坊的开发者体验。 如果你将数据存储在智能合约中，是没有内置的方式可以在交易后显示此数据当前状态的。这意味着你需要构建自己的可视化工具来排除错误。 可用于跟踪以太坊合约和交易的工具有： etherscan.io：显示有关合约，交易，区块的数据 etherchain.org：区块和以太网信息 你还可以获得有关网络和节点的汇总统计信息 例如，这是我们的合约在etherscan上的可视化界面： ﻿﻿ 每次交易（对合约方法的调用）以及合约执行的痕迹都会用机器语言记录下来。除了用于确保你调用到了合约之外，这个工具不能用于调试的其他部分。 而且，这些工具只能监视公共以太坊网络。所以你不能用它们来调试本地的区块链。 如果你曾经见过比特币交易审计网站，千万不要以为以太坊可以达到相同的复杂程度。此外，比特币网络只有一种交易，因此比设计用于运行智能合约的网络更容易监控。 文档 这还不是全部：以太坊文档与代码不同步（至少在Frontier版本中），所以大多数时候我们必须要通过查看这些库的源代码来了解如何写代码。由于有些出问题的库使用的语言（Solidity）很少人用，所以我们在这里只能祝福它们的工作方式不出问题了。还有，也不要指望Stack Overflow的帮助。像我们这样敢于做一些认真的事情来为社区提供支持的人太少了。 不过这里需要明确的是：我们不是在批评以太坊社区缺乏努力。以太坊背后的发展势头巨大，事情进展迅速。所有文档贡献者的工作都值得赞赏。但还是要承认在我们开发应用程序时，现有文档状态不足以让新的以太坊开发人员启动一个项目。 在网上搜索以太坊的教程很容易，但大多数时候，这些教程中复制粘贴的代码根本无法使用。 如果你想自己动手开发智能合约，以下是一些值得一看的资源： A 101 Noob Intro to Programming Smart Contracts on Ethereum&nbsp;https://medium.com/@ConsenSys/a-101-noob-intro-to-programming-smart-contracts-on-ethereum-695d15c1dab4 以太坊指南&nbsp;https://ethereum-homestead.readthedocs.org/en/latest/ 以太坊 Github wiki&nbsp;https://github.com/ethereum/wiki 结论 经过两位经验丰富的开发人员4周的艰苦努力，我们的代码终于可以在公有以太坊网络中工作了（心累）。在Frontier和Homestead版本之间的以太坊库中的回归和兼容性中断也并没有起到什么作用。查看marmelab / ZeroDollarHomePage上的项目源代码可以详细了解其内部工作原理。因为确实是第一次开发，我们在这方面的经验也实在有限，请原谅我们代码中的潜在错误，以及本文中的不准确之处。请随时在GitHub向我们提交更正或评论。 我们不喜欢这段经历。通过糟糕的文档和不成熟的软件库摸索编程的方式并不是很让人开心。用半熟的语言来实现简单的功能（如字符串操作）也不好玩。尤其是意识到自己尽管有着多年丰富的脚本语言编程经验，但却无法编写简单的可靠合约，这就更令人沮丧。最重要的是，以太坊生态系统的年轻人完全无法预测他们实现一个简单的功能所需的时间。由于时间就是金钱，目前我们还无法确定开发去中心化应用到底需要多少代价。 在时间和资源方面，“零美元主页”代表着超过20,000欧元的开发成本——即使它是一个非常简单的系统。与我们在其他项目中使用的工具（Node.js，Koa，React.js，PostgreSQL等）相比，在区块链上开发非常昂贵。对于开发团队来说，这也是非常令人失望的。我们还可以从中发现一个很强烈的信号：这个生态系统还没有准备好！ 对区块链的看法 在探索了区块链的理论，并真正开发之后，我们已经对它的优缺点有了切身的体会。但令人惊讶的是，我们的大部分结论都和媒体上一直吹捧的不太一样。或许这是因为我们并没有迷信比特币和其他人的疯狂估值，也可能是因为区块链确实面临着不够成熟的现状。 区块链确实是一个非常聪明的想法，具有巨大的潜在影响。但是目前的方案究竟能否为下一个十年颠覆性应用的诞生提供动力还尚未可知。 在技术方面，它的一些基本特征根本不可行。区块链效率不够高，对开发人员不够友好，而且它的技术特性很有可能被恐怖分子或地下黑市利用，用于非法毒品、武器、人口等的贩卖，而难以监管。 在商业方面，区块链变化速度过快，价格昂贵。费用可能会无缘无故地变化数十倍。在这样一个不稳定的平台上开展业务是非常危险的。 我的意思是，我们必须等待。区块链还没有准备好。它需要更成熟些，需要成为另一个杀手级应用而不是成为一个投机引擎，需要更大的开发者社区，需要承担更多的生态和经济责任。这需要多长时间？也许一年或两年？没人能说出来。 说实话，最后得出这样的看法也让我感到很惊讶。关于区块链的大部分出版物都表明了相反的情况。他们说“现在正是时候”，“不要错过火车”，或者“下一个十年的巨型企业正在区块链上建立”。也许他们是错的，也许我们是错的。我们正在试图用更有力的证据来论证这一分析。如果您有不同的意见，欢迎和我们沟通交流。我们将密切关注不同区块链项目的发展。 原文： https://marmelab.com/blog/2016/05/20/blockchain-for-web-developers-in-practice.html 推荐阅读 了解更多区块链技术及应用内容 敬请关注： 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/Blockchain_lemon/article/details/79466131 编译 | 区块链大本营 整理 |&nbsp;reason_W 区块链会是一场革命吗？ 今天，很多成功的互联网企业都是在以中介者的形式存在。比如Google——你和互联网之间的中介，比如亚马逊——买家和卖家之间的中介。但区块链——以“去中心化”为最基本特征的技术的发展却很有可能破坏这些互联网巨头赖以成功的结构。 互联网巨头的事咱们暂且不操心，那么从一个开发者的角度呢？我们需要关心什么呢？作为一个开发者，我们该如何使用区块链构建应用程序？ 我们可以在这么复杂的基础概念之上创造出非常易用的工具吗？这个工具的开发体验又有多友好呢？ 我们知道，最好的教程就是带你去从头开发一个应用程序。所以我们将使用区块链技术制作一个简单的去中心化广告服务器，称为“零美元主页”。本文将告诉你一群开发者在摸索使用区块链技术时最完整的试错经过和心路历程。 什么是区块链应用？ 要做区块链应用，首先要知道区块链有什么特性。而它最突出的特性就是“去中心化”。简单来说，就是不再像以前的技术一样需要一个中心节点负责管理，而是通过一系列复杂且可靠的技术，由网络中所有的节点共同认可，共同记录，共同维护，解决网络中交易双方的信任问题。这是一条神奇的链，有了这个链就真的可以实现没有中间商赚差价了。 回到正文，区块链正在以去中心化的特质威胁着互联网巨头们的基础。而本文将集中于广告平台。广告平台是广告位购买方和广告渠道提供商之间的中介。我们的项目是通过区块链技术建立一个去中心化的广告平台。也就是跳过广告中间商，通过利用区块链技术本身的特性解决在互联网环境中进行交易时相互之间的信任问题。 自著名的百万美元主页实验以来，想要在付费广告领域通过创新变的富有已经越来越困难了。 The Million Dollar Homepage&nbsp; http://www.milliondollarhomepage.com/ ﻿﻿﻿ 2005年，一个21岁的英国男孩Alex创建了一个名为“百万美元主页”的网站，将页面做成100万个小格子组成的广告牌，每个格子售价1美元。这一别出心裁的创意吸引了不少广告商注意，不到一年时间内，100万个格子全部售出。 相反，我们选择建立一个允许免费展示广告的平台——零美元主页。 免费，但并不代表什么都不付出：广告商需要通过开源贡献来换取广告位。因此，我们构建了一个去中心化的应用来管理广告在特定网页上的展示方式。 广告商需要具备编程能力，以便能够将他们的广告放在此页面上。 用户工作流程 具体而言，当我们在marmelab的开源库（https://github.com/marmelab）之一合并Pull请求（PR）时，会有一个GitHub机器人对PR进行评论，并邀请PR作者在广告平台管理面板上发布他们的广告。 ﻿﻿ 打开评论中包含的链接之后，PR作者会被要求使用他们的GitHub凭证进行登录。然后，他们可以上传广告——实际上就是一张简单的图片。此图片将按照时间顺序添加到同样由其他PR作者上传的图片队列中。 ﻿﻿ 每天半夜的时候，脚本都会自动地获取下一个图像（使用先进先出排序），并在接下来的24小时内将其显示在http://marmelab.com/ZeroDollarHomepage/ 上。 ﻿﻿ 注意：这整个过程不需要中介参与，但为了避免在网站上出现成人内容，我们会在图像上传之后，发布之前通过Google Vision API进行验证。 应用架构 以下是我们广告平台的四步的架构： ﻿﻿ 开源贡献者通知 只要开源PR合并到了我们的某个存储库中，GitHub就会将PR详细信息发送给负责管理的app。app会在PR下方进行评论以通知贡献者。该评论包含一个可以进入管理界面的链接，以及PR的详细信息。 声明和图片上传 在打开评论链接之后，贡献者会转到管理员界面。他必须使用他的GitHub凭证登录才能通过身份验证。管理程序然后会通过GitHub获取PR详细信息，并检查贡献者是否是PR作者。如果没有问题，管理程序会显示图片上传栏。当贡献者上传图片时，管理程序会将PR ID推送到区块链，并将图片上传到CDN（以PR id命名）。管理程序同时会根据区块链中仍在等待发布的图像的有效PR数量计算并显示图像发布的大致日期。 广告位置 每隔24小时，cron（一个执行周期性任务计划的程序）就会要求区块链查找尚未发布的下一个PR。 区块链将此PR标记为已发布并发送该ID。 cron将以PR id命名的图像重命名为“current image”。 广告显示 每次访问者想要在“零美元主页”中发布广告，该主页都会向CDN询问当前图像。如果它恰好是区块链上最新发布的广告，那么该广告就会至少保留1天（直到另一个贡献者声明了一个PR为止）。 看起来有点意外的是，区块链在这个过程中起着非常小的作用。这是因为在实际编程过程中，我们发现无法把广告平台的整个代码都建立在区块链之上。事实上，区块链在连接互联网和处理方面的能力都非常有限。所以我们只用区块链来实现最关键的广告投放任务： 注册经过认证的贡献者的Pull请求 获取最后一次没有发布的Pull请求，并将其标记为发布 由于各种原因，管理程序中的其他任务最终没有使用区块链： 从webhook对Pull的请求进行注册 在Pull请求之前进行注册是没有用的，因为Pull作者可能从未声明它。此外，将数据存储在区块链中并不是没有代价的，所以我们只存储我们必须存储的数据。但这样做的缺点是，我们的公共软件仓库（包括在此实验之前创建的公共软件仓库）中的任何公共资源都有资格进行下一步操作。 通过在GitHub发布评论来通知用户 智能合约不能调用外部API，所以我们不能通过这项技术来实现本项任务。因此，我们将此任务交给管理程序来完成。 验证声明的PR的作者 同样是因为智能合约不能调用GitHub API。所以，我们也把这个逻辑任务移至管理程序，并将其作为调用区块链的先决条件。 存储图像 理论上，我们可以将任何东西存储在区块链中，包括图像。 但实际而言，图像需要很多存储空间，而且我们没有办法在我们的智能合约中存储多个“表格”（数据阵列）。 将显示的广告更新为队列中的下一个 区块链中没有与setTimeout函数或cron工具等类似的功能。然而，你可能每隔x个区块就需要执行一次代码，不过这与时间无关。所以，我们在API上使用了类似cron的库。 研究，记录和第一次尝试 考虑到区块链网络的成熟度和设计目的，我们在选择要开发的区块链网络时最终选择了以太坊。 很快，我们就遇到了第一个困难。直到几个星期前，哪怕只是简单的测试，如果没有购买以太币，我们也无法使用以太坊区块链。此外，以太坊在之前的版本（名为Frontier）中并没有真正许可私有链，这就使开发变得非常复杂。因为没有私有链，只能在公共网络上进行开发，任何访问以太坊网络的人都可能会调用你的测试合约。更重要的是，这份文件只是一个志愿倡议，并且与发展状态不同步。 注：在我们开始开发程序后，以太坊就发布了新版本，从Frontier切换到Homestead，并且改善了Homestead的文档质量。 Homestead&nbsp;http://www.ethdocs.org/en/latest/introduction/contributors.html ﻿﻿ 尽管存在这些缺陷，我们仍然在Nancy，Paris和Dijon的以太网网络上成功注册了三个节点，并在这些节点之间共享ping。 在文档搜索中，我们最终找到了 Eris 文档（https://docs.erisindustries.com/）。Eris在解释区块链和合约方面做得非常出色。此外，他们专门在以太坊之上建立了一个层级，并开源了一系列工具以简化智能合约的开发过程。 Eris是一个命令行工具，你可以使用它来初始化你需要的任意数量的本地区块链。 如何操作智能合约 智能合约与API非常相似。它有几个公共函数，可以被在区块链网络上注册过的任何人调用。但与API不同的是，智能合约不能调用外部Web API（区块链是封闭的生态系统）。但是，智能合约可能会调用其他智能合约，只要知道他们的地址。 与API一样，公共函数只是它们的冰山一角。实际上合约可能由许多私有函数，变量等组成。 智能合约按照以太坊专有的二进制格式托管在区块链中，可由以太坊虚拟机执行。用于编写合约的语言和编辑器有： Serpent，跟Python很像（https://github.com/ethereum/wiki/wiki/Serpent） Solidity，跟Javascript很像（http://solidity.readthedocs.org/en/latest/） 在marmelab中，我们已经使用Javascript编写了很多代码，因此在编写合约时，我们选择了与Javascript类似的Solidity。Solidity合约存储在.sol文件中。 “零美元主页”合约 “零美元主页”合约存储了已声明的Pull请求，以及待发布的请求队列。 Solidity合约的第一个版本如下所示： // in src/ethereum/ZeroDollarHomePage.solcontract ZeroDollarHomePage { &nbsp; &nbsp;uint constant ShaLength = 40; &nbsp; &nbsp;enum ResponseCodes { &nbsp; &nbsp; &nbsp; &nbsp;Ok, &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequestId, &nbsp; &nbsp; &nbsp; &nbsp;InvalidAuthorName, &nbsp; &nbsp; &nbsp; &nbsp;InvalidImageUrl, &nbsp; &nbsp; &nbsp; &nbsp;RequestNotFound, &nbsp; &nbsp; &nbsp; &nbsp;EmptyQueue, &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed &nbsp; &nbsp;} &nbsp; &nbsp;struct Request { &nbsp; &nbsp; &nbsp; &nbsp;uint id; &nbsp; &nbsp; &nbsp; &nbsp;string authorName; &nbsp; &nbsp; &nbsp; &nbsp;string imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;uint createdAt; &nbsp; &nbsp; &nbsp; &nbsp;uint displayedAt; &nbsp; &nbsp;} &nbsp; &nbsp;// what the contract stores &nbsp; &nbsp;mapping (uint =&gt; Request) _requests; // key is the pull request id &nbsp; &nbsp;uint public numberOfRequests; &nbsp; &nbsp;uint[] _queue; &nbsp; &nbsp;uint public queueLength; &nbsp; &nbsp;uint _current; &nbsp; &nbsp;address owner; &nbsp; &nbsp;// constructor &nbsp; &nbsp;function ZeroDollarHomePage() { &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender; &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests = 0; &nbsp; &nbsp; &nbsp; &nbsp;queueLength = 0; &nbsp; &nbsp; &nbsp; &nbsp;_current = 0; &nbsp; &nbsp;} &nbsp; &nbsp;// a contract must give a way to destroy itself once uploaded to the blockchain &nbsp; &nbsp;function remove() { &nbsp; &nbsp; &nbsp; &nbsp;if (msg.sender == owner){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp;} &nbsp; &nbsp;// the following three methods are public contracts entry points &nbsp; &nbsp;function newRequest(uint pullRequestId, string authorName, string imageUrl) returns (uint8 code, uint displayDate) { &nbsp; &nbsp; &nbsp; &nbsp;if (pullRequestId &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Solidity is a strong typed language. You get compilation errors when types mismatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidPullRequestId); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (_requests[pullRequestId].id == pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.PullRequestAlreadyClaimed); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (bytes(authorName).length &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidAuthorName); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (bytes(imageUrl).length &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidImageUrl); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;// store new pull request details &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests += 1; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].id = pullRequestId; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].authorName = authorName; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].imageUrl = imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].createdAt = now; &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp;queueLength += 1; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.Ok); &nbsp; &nbsp; &nbsp; &nbsp;displayDate = now + (queueLength * 1 days); &nbsp; &nbsp; &nbsp; &nbsp;// no need to explicitly return code and displayDate as they are in the method signature &nbsp; &nbsp;} &nbsp; &nbsp;function closeRequest() returns (uint8) { &nbsp; &nbsp; &nbsp; &nbsp;if (queueLength == 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return uint8(ResponseCodes.EmptyQueue); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_requests[_queue[_current]].displayedAt = now; &nbsp; &nbsp; &nbsp; &nbsp;delete _queue[0]; &nbsp; &nbsp; &nbsp; &nbsp;queueLength -= 1; &nbsp; &nbsp; &nbsp; &nbsp;_current = _current + 1; &nbsp; &nbsp; &nbsp; &nbsp;return uint8(ResponseCodes.Ok); &nbsp; &nbsp;} &nbsp; &nbsp;function getLastNonPublished() returns (uint8 code, uint id, string authorName, string imageUrl, uint createdAt) { &nbsp; &nbsp; &nbsp; &nbsp;if (queueLength == 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.EmptyQueue); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;var request = _requests[_queue[_current]]; &nbsp; &nbsp; &nbsp; &nbsp;id = request.id; &nbsp; &nbsp; &nbsp; &nbsp;authorName = request.authorName; &nbsp; &nbsp; &nbsp; &nbsp;imageUrl = request.imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;createdAt = request.createdAt; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.Ok); &nbsp; &nbsp;}} 在第一次尝试时，我们使用Eris JS库与我们的区块链进行通信。从Node.js文件中解析合约就变得非常简单： import eris from &#39;eris&#39;;function getContract(url, account) { &nbsp; &nbsp;const address = // Read address file stored on disk by the eris CLI; &nbsp; &nbsp;const abi = // Read abi file stored on disk by the eris CLI; &nbsp; &nbsp;const manager = eris.newContractManagerDev(url, account); &nbsp; &nbsp;return manager.newContractFactory(abi).at(address);} 而且它的调用也不困难： function* newRequest(pullrequestId, authorName, imageUrl) { &nbsp; &nbsp;const contract = getContract(url, account); &nbsp; &nbsp;// First gotcha, when a function returns several named variables, they are returned as an Arrays &nbsp; &nbsp;// Second gotcha, numbers are returned as instances of BigNumber, do not forget to convert when standard numbers are expected &nbsp; &nbsp;const [codeAsBigNumber, displayDateAsBigNumber] = yield contract.newRequest(pullrequestId, authorName, imageUrl); &nbsp; &nbsp;const code = codeAsBigNumber.toNumber(); &nbsp; &nbsp;if (code !== 0) { &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(getErrorMessageFromCode(code)); &nbsp; &nbsp;} &nbsp; &nbsp;// Return the displayDate for UI confirmation screen &nbsp; &nbsp;return displayDate.toNumber();} 有关Eris JS库的更多信息，可以参阅Eris文档（https://docs.erisindustries.com/）。 单元测试合约 我们非常喜欢测试驱动开发，但遇到的第一个问题就是：我们如何测试Solidity智能合约？ Eris的项目成员也为此提供了一个工具：sol-unit（https://github.com/smartcontractproduction/sol-unit）。 它在Docker容器中（确保每次测试都在干净的环境中运行）为每次测试运行一个新的本地区块链网络，并执行测试。测试也会写成一个合约。 当然，这个工具也没那么快就能用。 sol-unit是一个npm软件包，为了使用测试功能（assertions，等），我们必须在测试合约中导入由这个软件包提供的合约。这可以用一个简单的Solidity语法实现： import &quot;../node_modules/sol-unit/.../Asserter.sol&quot;; 实际的编译过程并没有看起来那么顺利。编译合约时我们遇到了一个奇怪的情形。即，不能用上面这样的路径导入合约。 我们最终在测试的makefile目标中添加了一个命令，将这些sol-unit&nbsp;合约复制到跟我们的项目相同的文件夹中。之后再运行sol-unit就很简单了，我们可以开始继续写代码了。 copy-sol-unit: &nbsp; &nbsp;@cp -f ./node_modules/sol-unit/contracts/src/* ./src/ethereum/compile-contract: &nbsp; &nbsp;solc --bin --abi -o ./src/ethereum ./src/ethereum/ZeroDollarHomePage.sol ./src/ethereum/ZeroDollarHomePageTest.soltest-ethereum: copy-sol-unit compile-contract &nbsp; &nbsp;./node_modules/.bin/solunit --dir ./src/ethereum 运行测试区块链 运行区块链和部署我们的合约只要按照Eris文档就会非常简单。通过使用之前已经集成在makefile中的一些命令，我们又进一步解决了遇到的一些麻烦。基于我们的合约运行新区块链的整个过程如下所示： 重置任何正在运行的eris docker容器，并删除一些临时文件 启动eris密钥服务 生成我们的账户密钥，并将其地址存储在一个便于稍后由JS API加载的文件中， 生成genesis.json，这是区块链的“区块0” 创建并启动新的区块链 将合约上传至区块链并保存其地址，以便在需要时调用 几天的工作之后，我们就能够在本地的Eris区块链上运行合约了。 从Eris到以太坊 我们希望可以在本地以太坊区块链上尝试我们的合约。 要与以太坊区块链内的合约进行通信，我们必须使用Web3库。在尝试使用它们的过程中，我们也学到了很多，并意识到了Eris的许多潜在的复杂性。 首先，之前假设合约与API类似的想法是不正确的。我们必须区分仅从区块链读取数据的函数，以及将数据写入区块链的函数。 第一种（只读函数），像API所做的那样，会异步返回结果数据。第二种（写入函数）只会返回一个交易散列。并且在相应的块被开采之前（这可能需要一些时间，最差情况是在10秒到1分钟之间），写入函数的预期副作用（区块链内部的更改）不会生效。另外，让这些写入函数返回值的能力我们也还没有。所以我们不得不改变我们的solidity代码来首先调用写入函数，然后调用只读函数来获得结果。 我们还发现了一些事件，可以在智能合约中发生情况时进行通知。智能合约负责触发事件。它们在solidity的代码可以这样写： event PullRequestClaimed(unit pullRequestId, uint estimatedDisplayDate); 他们可以在任何智能合约函数中触发，例如： PullRequestClaimed(pullRequestId, estimatedDisplayDate); 这些事件会被永久存储在区块链中。这意味着我们可以使用区块链存储事件。这可能是判断函数调用是否已成功执行的最简单方法：智能合约可以在其进程结束时触发事件，触发条件包括执行失败、计算结果等等。值得注意的是，Meteor&nbsp;的某些集成包已经可以直接用了。 最终，虽然实现的功能几乎相同，但我们已经可以将我们的智能合约重构的相当简单。我们必须摆脱映射（这些映射无法使用——因为我们的交易不是由以太坊网络开采的）。 solidity这种语言可能和JavaScript很接近，但它仍然非常年轻，并且不完整。数组对象还没有我们在JavaScript中使用的那些函数（甚至没有indexOf），字符串对象也没有任何函数。这在不久的将来或许可以通过社区的贡献来解决。 以太坊的操作如下： // in src/ethereum/ZeroDollarHomePage.solcontract ZeroDollarHomePage { &nbsp; &nbsp;event InvalidPullRequest(uint indexed pullRequestId); &nbsp; &nbsp;event PullRequestAlreadyClaimed(uint indexed pullRequestId, uint timeBeforeDisplay, bool past); &nbsp; &nbsp;event PullRequestClaimed(uint indexed pullRequestId, uint timeBeforeDisplay); &nbsp; &nbsp;event QueueIsEmpty(); &nbsp; &nbsp;bool _handledFirst; &nbsp; &nbsp;uint[] _queue; &nbsp; &nbsp;uint _current; &nbsp; &nbsp;address owner; &nbsp; &nbsp;function ZeroDollarHomePage() { &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender; &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = false; &nbsp; &nbsp; &nbsp; &nbsp;_current = 0; &nbsp; &nbsp;} &nbsp; &nbsp;function remove() { &nbsp; &nbsp; &nbsp; &nbsp;if (msg.sender == owner){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp;} &nbsp; &nbsp;function newRequest(uint pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp;if (pullRequestId &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequest(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;// Check that the pr hasn&#39;t already been claimed &nbsp; &nbsp; &nbsp; &nbsp;bool found = false; &nbsp; &nbsp; &nbsp; &nbsp;uint index = 0; &nbsp; &nbsp; &nbsp; &nbsp;while (!found &amp;&amp; index &lt; _queue.length) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (_queue[index] == pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;found = true; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;index++; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (found) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed(pullRequestId, (index - _current) * 1 days, _current &gt; index); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp;PullRequestClaimed(pullRequestId, (_queue.length - _current) * 1 days); &nbsp; &nbsp;} &nbsp; &nbsp;function closeRequest() { &nbsp; &nbsp; &nbsp; &nbsp;if (_handledFirst &amp;&amp; _current &lt; _queue.length - 1) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_current += 1; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = true; &nbsp; &nbsp;} &nbsp; &nbsp;function getLastNonPublished() constant returns (uint pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp;if (_current &gt;= _queue.length) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return 0; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;return _queue[_current]; &nbsp; &nbsp;}} 对Pull的请求进行声明并返回估计的显示日期的演变过程为： // make a [transaction](https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethsendtransaction) call to our smart-contract write functioncontract.newRequest.sendTransaction(pullrequestId, { &nbsp; &nbsp;to: client.eth.coinbase,}, (err, tx) =&gt; { &nbsp; &nbsp;if (err) { &nbsp; &nbsp; &nbsp; &nbsp;throw error; &nbsp; &nbsp;} &nbsp; &nbsp;// wait for it to be mined using [code](https://github.com/ethereum/web3.js/issues/393) from [@croqaz](https://github.com/croqaz) &nbsp; &nbsp;return waitForTransationToBeMined(client, tx) &nbsp; &nbsp; &nbsp; &nbsp;.then(txHash =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!txHash) throw new Error(&#39;Transaction failed (no transaction hash)&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// get its receipt which might contains informations about event triggered by the contract&#39;s code &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// this function might also check wether the transaction was successful by analyzing the receipt for ethereum specific error cases (insufficient funds, etc.) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return getReceipt(client, txHash); &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp; &nbsp; &nbsp; &nbsp;.then(receipt =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// parse those logs to extract only event data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return parseReceiptLogs(receipt.logs, contractAbi)); &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp; &nbsp; &nbsp; &nbsp;.then(logs =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (logs.length === 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(&#39;Transaction failed (Invalid logs)&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const log = logs[0]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;PullRequestClaimed&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return log.args.timeBeforeDisplay.toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;PullRequestAlreadyClaimed&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const number = log.args.timeBeforeDisplay; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.args.past) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return number.negated().toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return number.toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;InvalidPullRequest&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(&#39;Invalid pull request id&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;});}) 通过上面的代码，我们的去中心化应用就可以在本地以太坊网络中工作了。 部署到生产环境 如果说在本地环境中运行我们的应用是一项挑战，那么将其部署到真正的以太坊网络中的生产就是一场战斗。 这其中有几点非常值得注意。最重要的一点是合约在代码中是不可变的。这意味着： 你部署到区块链的合约会永远保持在那里。如果你发现你的合约存在缺陷，那也无法修复——必须部署新的合约。 部署现有合约的新版本时，以前合约中存储的任何数据都不会自动传输过去——除非你主动使用过去的数据初始化新合约。在我们的案例中，纠正合约中的错误实际上是抹去了已记录的PR（无论是已发布的广告还是待发布的广告）。 每个合约版本都有一个id（例如，我们的“零美元主页”合约id是0xd18e21bb13d154a16793c6f89186a034a8116b74）。 由于过去的版本也可能包含数据，如果你不想丢失数据（我们也一样），请继续跟踪过去的合约ID。 由于你无法更新合约，因此也无法回滚更新。在重新部署之前需要确保合约有效。 当你部署现有合约的新版本时，旧的（错误的）合约仍然可以被调用。 任何引用合约的区块链以外的系统（例如我们在零美元主页中的节点管理应用）都必须更新为指向新合约。我们一开始忘了这么做，还非常困惑为什么我们的新代码没有运行，后来才明白。 如果在代码中包含自杀（suicide&nbsp;）调用，合约作者可以终止合约。但合约的所有现有交易都会保留在区块链中——永远存在。如果不希望它消失，请确保终止开关已经处理了合约中的其余以太币。 还有一个问题是，区块链中的每个合约部署和写入操作都会产生数量不一的以太网络。我们设法获得了5个以太币，但并不知道到底需要多少以太币才能够部署我们的合约或者调用一个交易。要测试出来每次失败产生的成本是很难的。 对于Node.js部分，像前面大部分的项目一样，我们决定在AWS EC2实例上运行它。为此，我们必须： 在服务器上运行以太坊节点 将整个区块链下载到此服务器 在节点上使用一些以太币解锁一个帐户 部署我们的应用程序并将其链接到节点 通过节点将我们的智能合约注册到区块链中 确保你的区块链节点服务器有充足的存储空间。目前区块链的大小约为15GB。 EC2实例的默认卷大小为8GB，确实也很大。因为一开始没有下载完整的区块链（我们也没有马上意识到），所以我们遇到了很多麻烦。例如，我们有一个有5个以太币的帐户，但很长一段时间，系统的状态都会显示我们没有解锁帐户，或者好像我们没有以太币。 直到我们将区块链的其余部分下载下来才解决了这个问题。 同样，解锁我们那个包含5个以太币的宝贵账户也不是一件容易的事。我们不想在应用程序中对我们的密码进行硬编码，而是想用supervisord运行节点来简化部署。艰辛的摸索之后（唉，累啊），我们终于找到了一种方式，可以在改变配置的同时，不会暴露密码。以下就是我们所用的supervisord配置： [program:geth]command=geth --ipcdisable --rpc --fast --unlock 0 --password /path/to/our/password/in/a/fileautostart=falseautorestart=truestartsecs=10stopsignal=TERMuser=ubuntustdout_logfile=/var/log/ethereum-node.out.logstderr_logfile=/var/log/ethereum-node.err.log 最后一个安全提示：区块链的远程过程调用（RPC）端口为8545。请勿在EC2实例上打开此端口！否则任何知道实例IP的人都可以控制你的以太坊节点，并窃取你的以太网。 以太币和瓦斯（Gas） 在以太坊区块链中部署和调用合约并不是免费的，需要承担一定的计算代价。而且由于区块链运行代价高昂，任何写入操作都要承担代价。在以太网中，调用写入合约的方法的代价取决于方法的复杂性。以太坊附带了一份瓦斯费用列表（http://ether.fund/tool/gas-fees），告诉你应该在合约调用时需要添加多少以太币才能让它执行。 实际上，这里的以太币消耗量其实非常小，只占一个以太币的一小部分。以太坊区块链还引入了另一种运行合约的货币：瓦斯（Gas）。 1瓦斯= 0.00001以太币 1 以太币= 100,000瓦斯 根据计算能力的供应情况和计算需求，未来瓦斯和以太币的转化率会有所不同。 ﻿﻿ 处理一次交易的费用并不是强制收取的，但却非常推荐。以太坊的文件中说：“矿工可以选择忽略瓦斯价格太低的交易”。成功开采好一个新区块会给矿工奖励5个以太币。 为了调用我们自己的合约，以太坊区块链大概需要0.00045个到0.00098个以太币（这个实际价格取决于瓦斯价格和交易使用的瓦斯）。 那么怎样才能获得以太币和瓦斯呢？你可以购买以太币（当然主要是通过交换比特币获得），也可以自己去挖矿。在法国，比特币或以太币的购买需要的程序几乎和开设银行账户一样麻烦。这个过程很慢（大概要几天），也很痛苦，取决于由报价和需求确定的汇率。 挖矿以太币 最后我们决定自己挖掘以太币。如果想了解一下在以太坊挖矿到底是不是有利可图，自己挖确实也是一个很好的方法。我们制作了一个非常大的亚马逊EC2实例，它具有强大的GPU计算能力（是一个g2.2xlarge实例）。这个实例的价格是每天17美元。我们安装了以太网，并启动了我们的节点。由于高内存和存储需求，我们很快就必须增强这个实例。加入区块链时节点做的第一件事就是下载过去交易的全部历史记录。这需要大量的存储空间：区块链历史记录超过14GB，Ethash工作证明大约需要3GB。 一旦以太坊节点启动，我们就必须要挖掘3天才能创建出一个有效的区块： ﻿﻿ 提醒一下，以太坊区块链每10秒钟挖一块。开采一个区块可以获得5个以太币，售价大约为55美元（作者写文章时的价格）。我们的增强版EC2实例运行3天的成本约为51美元。总而言之，在AWS上挖以太币比直接买以太币更便宜。但是我们非常幸运：我们开发这个区块的时候挖掘难度并不很大，在开发完之后，网络的挖掘难度就增加了三倍。 5个以太币可以让我们运行“零美元主页”多长时间呢？现在我们来计算一下。 “零美元主页”的工作流程意味着每天都会有一笔交易，另外每个声明的PR都会有一笔交易。假设贡献者每天声明一个PR，那么运行该平台每年最多将花费365 * 2 * 0.00098 = 0.72 以太币。5个以太币可以让我们运行该平台近7年。 正如你所看到的，在以太坊运行合约并不是免费的，不过以目前的价格来说，它仍然很便宜。当然，以太币价值的变化很大。由于挖比特币的利润越来越低，一些大型比特币矿场开始转向以太坊。这也让采矿变得越来越困难，并且使得以太网每天都在变得更加昂贵。 最终的惊喜 最终，我们的智能合约在EC2上托管的现实世界以太坊节点中运行非常好。 但当我们完成这个项目的时候，以太坊发布了它们的Homestead版本，这带来了很多新东西，完全破坏了我们的代码。我们花了大约一个星期的时间才明白，并且通过反复试验修复了因不明原因而不兼容的代码。 Tip Homestead发布了一个隐藏的以太坊功能——私有网络——来简化开发。之前以太坊缺乏私有网络是我们当时选择使用Eris的原因之一。 “零美元主页”平台现在已经启动并且开始运行了。你可以通过在GitHub上的marmelab的开源库之一上开一个Pull请求来使用它，查看http://marmelab.com/ZeroDollarHomepage/ 上当前显示的广告，或浏览marmelab / ZeroDollarHomePage上的应用程序代码。是的，我们正在开源整个广告平台，以便你可以详细了解其工作原理，并在本地进行复制。 ﻿﻿ 调试 以太坊留给开发者的体验其实是非常糟糕的。想象一下没有日志，也没有调试工具，你发现程序失败的唯一方法是通过一行一行输出“I&#39;m here”字符串来查找问题。甚至有时（例如在Solidity合约中），你都不能这样做。或者某些在开发环境中完美工作的程序在生产环境中却无法实现。这就是以太坊的开发者体验。 如果你将数据存储在智能合约中，是没有内置的方式可以在交易后显示此数据当前状态的。这意味着你需要构建自己的可视化工具来排除错误。 可用于跟踪以太坊合约和交易的工具有： etherscan.io：显示有关合约，交易，区块的数据 etherchain.org：区块和以太网信息 你还可以获得有关网络和节点的汇总统计信息 例如，这是我们的合约在etherscan上的可视化界面： ﻿﻿ 每次交易（对合约方法的调用）以及合约执行的痕迹都会用机器语言记录下来。除了用于确保你调用到了合约之外，这个工具不能用于调试的其他部分。 而且，这些工具只能监视公共以太坊网络。所以你不能用它们来调试本地的区块链。 如果你曾经见过比特币交易审计网站，千万不要以为以太坊可以达到相同的复杂程度。此外，比特币网络只有一种交易，因此比设计用于运行智能合约的网络更容易监控。 文档 这还不是全部：以太坊文档与代码不同步（至少在Frontier版本中），所以大多数时候我们必须要通过查看这些库的源代码来了解如何写代码。由于有些出问题的库使用的语言（Solidity）很少人用，所以我们在这里只能祝福它们的工作方式不出问题了。还有，也不要指望Stack Overflow的帮助。像我们这样敢于做一些认真的事情来为社区提供支持的人太少了。 不过这里需要明确的是：我们不是在批评以太坊社区缺乏努力。以太坊背后的发展势头巨大，事情进展迅速。所有文档贡献者的工作都值得赞赏。但还是要承认在我们开发应用程序时，现有文档状态不足以让新的以太坊开发人员启动一个项目。 在网上搜索以太坊的教程很容易，但大多数时候，这些教程中复制粘贴的代码根本无法使用。 如果你想自己动手开发智能合约，以下是一些值得一看的资源： A 101 Noob Intro to Programming Smart Contracts on Ethereum&nbsp;https://medium.com/@ConsenSys/a-101-noob-intro-to-programming-smart-contracts-on-ethereum-695d15c1dab4 以太坊指南&nbsp;https://ethereum-homestead.readthedocs.org/en/latest/ 以太坊 Github wiki&nbsp;https://github.com/ethereum/wiki 结论 经过两位经验丰富的开发人员4周的艰苦努力，我们的代码终于可以在公有以太坊网络中工作了（心累）。在Frontier和Homestead版本之间的以太坊库中的回归和兼容性中断也并没有起到什么作用。查看marmelab / ZeroDollarHomePage上的项目源代码可以详细了解其内部工作原理。因为确实是第一次开发，我们在这方面的经验也实在有限，请原谅我们代码中的潜在错误，以及本文中的不准确之处。请随时在GitHub向我们提交更正或评论。 我们不喜欢这段经历。通过糟糕的文档和不成熟的软件库摸索编程的方式并不是很让人开心。用半熟的语言来实现简单的功能（如字符串操作）也不好玩。尤其是意识到自己尽管有着多年丰富的脚本语言编程经验，但却无法编写简单的可靠合约，这就更令人沮丧。最重要的是，以太坊生态系统的年轻人完全无法预测他们实现一个简单的功能所需的时间。由于时间就是金钱，目前我们还无法确定开发去中心化应用到底需要多少代价。 在时间和资源方面，“零美元主页”代表着超过20,000欧元的开发成本——即使它是一个非常简单的系统。与我们在其他项目中使用的工具（Node.js，Koa，React.js，PostgreSQL等）相比，在区块链上开发非常昂贵。对于开发团队来说，这也是非常令人失望的。我们还可以从中发现一个很强烈的信号：这个生态系统还没有准备好！ 对区块链的看法 在探索了区块链的理论，并真正开发之后，我们已经对它的优缺点有了切身的体会。但令人惊讶的是，我们的大部分结论都和媒体上一直吹捧的不太一样。或许这是因为我们并没有迷信比特币和其他人的疯狂估值，也可能是因为区块链确实面临着不够成熟的现状。 区块链确实是一个非常聪明的想法，具有巨大的潜在影响。但是目前的方案究竟能否为下一个十年颠覆性应用的诞生提供动力还尚未可知。 在技术方面，它的一些基本特征根本不可行。区块链效率不够高，对开发人员不够友好，而且它的技术特性很有可能被恐怖分子或地下黑市利用，用于非法毒品、武器、人口等的贩卖，而难以监管。 在商业方面，区块链变化速度过快，价格昂贵。费用可能会无缘无故地变化数十倍。在这样一个不稳定的平台上开展业务是非常危险的。 我的意思是，我们必须等待。区块链还没有准备好。它需要更成熟些，需要成为另一个杀手级应用而不是成为一个投机引擎，需要更大的开发者社区，需要承担更多的生态和经济责任。这需要多长时间？也许一年或两年？没人能说出来。 说实话，最后得出这样的看法也让我感到很惊讶。关于区块链的大部分出版物都表明了相反的情况。他们说“现在正是时候”，“不要错过火车”，或者“下一个十年的巨型企业正在区块链上建立”。也许他们是错的，也许我们是错的。我们正在试图用更有力的证据来论证这一分析。如果您有不同的意见，欢迎和我们沟通交流。我们将密切关注不同区块链项目的发展。 原文： https://marmelab.com/blog/2016/05/20/blockchain-for-web-developers-in-practice.html 推荐阅读 了解更多区块链技术及应用内容 敬请关注： 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/06/95818c6fbb3ef9664c17fe9d8289ded2.html" />
<meta property="og:url" content="https://mlh.app/2018/03/06/95818c6fbb3ef9664c17fe9d8289ded2.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-06T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/Blockchain_lemon/article/details/79466131 编译 | 区块链大本营 整理 |&nbsp;reason_W 区块链会是一场革命吗？ 今天，很多成功的互联网企业都是在以中介者的形式存在。比如Google——你和互联网之间的中介，比如亚马逊——买家和卖家之间的中介。但区块链——以“去中心化”为最基本特征的技术的发展却很有可能破坏这些互联网巨头赖以成功的结构。 互联网巨头的事咱们暂且不操心，那么从一个开发者的角度呢？我们需要关心什么呢？作为一个开发者，我们该如何使用区块链构建应用程序？ 我们可以在这么复杂的基础概念之上创造出非常易用的工具吗？这个工具的开发体验又有多友好呢？ 我们知道，最好的教程就是带你去从头开发一个应用程序。所以我们将使用区块链技术制作一个简单的去中心化广告服务器，称为“零美元主页”。本文将告诉你一群开发者在摸索使用区块链技术时最完整的试错经过和心路历程。 什么是区块链应用？ 要做区块链应用，首先要知道区块链有什么特性。而它最突出的特性就是“去中心化”。简单来说，就是不再像以前的技术一样需要一个中心节点负责管理，而是通过一系列复杂且可靠的技术，由网络中所有的节点共同认可，共同记录，共同维护，解决网络中交易双方的信任问题。这是一条神奇的链，有了这个链就真的可以实现没有中间商赚差价了。 回到正文，区块链正在以去中心化的特质威胁着互联网巨头们的基础。而本文将集中于广告平台。广告平台是广告位购买方和广告渠道提供商之间的中介。我们的项目是通过区块链技术建立一个去中心化的广告平台。也就是跳过广告中间商，通过利用区块链技术本身的特性解决在互联网环境中进行交易时相互之间的信任问题。 自著名的百万美元主页实验以来，想要在付费广告领域通过创新变的富有已经越来越困难了。 The Million Dollar Homepage&nbsp; http://www.milliondollarhomepage.com/ ﻿﻿﻿ 2005年，一个21岁的英国男孩Alex创建了一个名为“百万美元主页”的网站，将页面做成100万个小格子组成的广告牌，每个格子售价1美元。这一别出心裁的创意吸引了不少广告商注意，不到一年时间内，100万个格子全部售出。 相反，我们选择建立一个允许免费展示广告的平台——零美元主页。 免费，但并不代表什么都不付出：广告商需要通过开源贡献来换取广告位。因此，我们构建了一个去中心化的应用来管理广告在特定网页上的展示方式。 广告商需要具备编程能力，以便能够将他们的广告放在此页面上。 用户工作流程 具体而言，当我们在marmelab的开源库（https://github.com/marmelab）之一合并Pull请求（PR）时，会有一个GitHub机器人对PR进行评论，并邀请PR作者在广告平台管理面板上发布他们的广告。 ﻿﻿ 打开评论中包含的链接之后，PR作者会被要求使用他们的GitHub凭证进行登录。然后，他们可以上传广告——实际上就是一张简单的图片。此图片将按照时间顺序添加到同样由其他PR作者上传的图片队列中。 ﻿﻿ 每天半夜的时候，脚本都会自动地获取下一个图像（使用先进先出排序），并在接下来的24小时内将其显示在http://marmelab.com/ZeroDollarHomepage/ 上。 ﻿﻿ 注意：这整个过程不需要中介参与，但为了避免在网站上出现成人内容，我们会在图像上传之后，发布之前通过Google Vision API进行验证。 应用架构 以下是我们广告平台的四步的架构： ﻿﻿ 开源贡献者通知 只要开源PR合并到了我们的某个存储库中，GitHub就会将PR详细信息发送给负责管理的app。app会在PR下方进行评论以通知贡献者。该评论包含一个可以进入管理界面的链接，以及PR的详细信息。 声明和图片上传 在打开评论链接之后，贡献者会转到管理员界面。他必须使用他的GitHub凭证登录才能通过身份验证。管理程序然后会通过GitHub获取PR详细信息，并检查贡献者是否是PR作者。如果没有问题，管理程序会显示图片上传栏。当贡献者上传图片时，管理程序会将PR ID推送到区块链，并将图片上传到CDN（以PR id命名）。管理程序同时会根据区块链中仍在等待发布的图像的有效PR数量计算并显示图像发布的大致日期。 广告位置 每隔24小时，cron（一个执行周期性任务计划的程序）就会要求区块链查找尚未发布的下一个PR。 区块链将此PR标记为已发布并发送该ID。 cron将以PR id命名的图像重命名为“current image”。 广告显示 每次访问者想要在“零美元主页”中发布广告，该主页都会向CDN询问当前图像。如果它恰好是区块链上最新发布的广告，那么该广告就会至少保留1天（直到另一个贡献者声明了一个PR为止）。 看起来有点意外的是，区块链在这个过程中起着非常小的作用。这是因为在实际编程过程中，我们发现无法把广告平台的整个代码都建立在区块链之上。事实上，区块链在连接互联网和处理方面的能力都非常有限。所以我们只用区块链来实现最关键的广告投放任务： 注册经过认证的贡献者的Pull请求 获取最后一次没有发布的Pull请求，并将其标记为发布 由于各种原因，管理程序中的其他任务最终没有使用区块链： 从webhook对Pull的请求进行注册 在Pull请求之前进行注册是没有用的，因为Pull作者可能从未声明它。此外，将数据存储在区块链中并不是没有代价的，所以我们只存储我们必须存储的数据。但这样做的缺点是，我们的公共软件仓库（包括在此实验之前创建的公共软件仓库）中的任何公共资源都有资格进行下一步操作。 通过在GitHub发布评论来通知用户 智能合约不能调用外部API，所以我们不能通过这项技术来实现本项任务。因此，我们将此任务交给管理程序来完成。 验证声明的PR的作者 同样是因为智能合约不能调用GitHub API。所以，我们也把这个逻辑任务移至管理程序，并将其作为调用区块链的先决条件。 存储图像 理论上，我们可以将任何东西存储在区块链中，包括图像。 但实际而言，图像需要很多存储空间，而且我们没有办法在我们的智能合约中存储多个“表格”（数据阵列）。 将显示的广告更新为队列中的下一个 区块链中没有与setTimeout函数或cron工具等类似的功能。然而，你可能每隔x个区块就需要执行一次代码，不过这与时间无关。所以，我们在API上使用了类似cron的库。 研究，记录和第一次尝试 考虑到区块链网络的成熟度和设计目的，我们在选择要开发的区块链网络时最终选择了以太坊。 很快，我们就遇到了第一个困难。直到几个星期前，哪怕只是简单的测试，如果没有购买以太币，我们也无法使用以太坊区块链。此外，以太坊在之前的版本（名为Frontier）中并没有真正许可私有链，这就使开发变得非常复杂。因为没有私有链，只能在公共网络上进行开发，任何访问以太坊网络的人都可能会调用你的测试合约。更重要的是，这份文件只是一个志愿倡议，并且与发展状态不同步。 注：在我们开始开发程序后，以太坊就发布了新版本，从Frontier切换到Homestead，并且改善了Homestead的文档质量。 Homestead&nbsp;http://www.ethdocs.org/en/latest/introduction/contributors.html ﻿﻿ 尽管存在这些缺陷，我们仍然在Nancy，Paris和Dijon的以太网网络上成功注册了三个节点，并在这些节点之间共享ping。 在文档搜索中，我们最终找到了 Eris 文档（https://docs.erisindustries.com/）。Eris在解释区块链和合约方面做得非常出色。此外，他们专门在以太坊之上建立了一个层级，并开源了一系列工具以简化智能合约的开发过程。 Eris是一个命令行工具，你可以使用它来初始化你需要的任意数量的本地区块链。 如何操作智能合约 智能合约与API非常相似。它有几个公共函数，可以被在区块链网络上注册过的任何人调用。但与API不同的是，智能合约不能调用外部Web API（区块链是封闭的生态系统）。但是，智能合约可能会调用其他智能合约，只要知道他们的地址。 与API一样，公共函数只是它们的冰山一角。实际上合约可能由许多私有函数，变量等组成。 智能合约按照以太坊专有的二进制格式托管在区块链中，可由以太坊虚拟机执行。用于编写合约的语言和编辑器有： Serpent，跟Python很像（https://github.com/ethereum/wiki/wiki/Serpent） Solidity，跟Javascript很像（http://solidity.readthedocs.org/en/latest/） 在marmelab中，我们已经使用Javascript编写了很多代码，因此在编写合约时，我们选择了与Javascript类似的Solidity。Solidity合约存储在.sol文件中。 “零美元主页”合约 “零美元主页”合约存储了已声明的Pull请求，以及待发布的请求队列。 Solidity合约的第一个版本如下所示： // in src/ethereum/ZeroDollarHomePage.solcontract ZeroDollarHomePage { &nbsp; &nbsp;uint constant ShaLength = 40; &nbsp; &nbsp;enum ResponseCodes { &nbsp; &nbsp; &nbsp; &nbsp;Ok, &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequestId, &nbsp; &nbsp; &nbsp; &nbsp;InvalidAuthorName, &nbsp; &nbsp; &nbsp; &nbsp;InvalidImageUrl, &nbsp; &nbsp; &nbsp; &nbsp;RequestNotFound, &nbsp; &nbsp; &nbsp; &nbsp;EmptyQueue, &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed &nbsp; &nbsp;} &nbsp; &nbsp;struct Request { &nbsp; &nbsp; &nbsp; &nbsp;uint id; &nbsp; &nbsp; &nbsp; &nbsp;string authorName; &nbsp; &nbsp; &nbsp; &nbsp;string imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;uint createdAt; &nbsp; &nbsp; &nbsp; &nbsp;uint displayedAt; &nbsp; &nbsp;} &nbsp; &nbsp;// what the contract stores &nbsp; &nbsp;mapping (uint =&gt; Request) _requests; // key is the pull request id &nbsp; &nbsp;uint public numberOfRequests; &nbsp; &nbsp;uint[] _queue; &nbsp; &nbsp;uint public queueLength; &nbsp; &nbsp;uint _current; &nbsp; &nbsp;address owner; &nbsp; &nbsp;// constructor &nbsp; &nbsp;function ZeroDollarHomePage() { &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender; &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests = 0; &nbsp; &nbsp; &nbsp; &nbsp;queueLength = 0; &nbsp; &nbsp; &nbsp; &nbsp;_current = 0; &nbsp; &nbsp;} &nbsp; &nbsp;// a contract must give a way to destroy itself once uploaded to the blockchain &nbsp; &nbsp;function remove() { &nbsp; &nbsp; &nbsp; &nbsp;if (msg.sender == owner){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp;} &nbsp; &nbsp;// the following three methods are public contracts entry points &nbsp; &nbsp;function newRequest(uint pullRequestId, string authorName, string imageUrl) returns (uint8 code, uint displayDate) { &nbsp; &nbsp; &nbsp; &nbsp;if (pullRequestId &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Solidity is a strong typed language. You get compilation errors when types mismatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidPullRequestId); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (_requests[pullRequestId].id == pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.PullRequestAlreadyClaimed); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (bytes(authorName).length &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidAuthorName); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (bytes(imageUrl).length &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.InvalidImageUrl); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;// store new pull request details &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests += 1; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].id = pullRequestId; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].authorName = authorName; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].imageUrl = imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].createdAt = now; &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp;queueLength += 1; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.Ok); &nbsp; &nbsp; &nbsp; &nbsp;displayDate = now + (queueLength * 1 days); &nbsp; &nbsp; &nbsp; &nbsp;// no need to explicitly return code and displayDate as they are in the method signature &nbsp; &nbsp;} &nbsp; &nbsp;function closeRequest() returns (uint8) { &nbsp; &nbsp; &nbsp; &nbsp;if (queueLength == 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return uint8(ResponseCodes.EmptyQueue); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_requests[_queue[_current]].displayedAt = now; &nbsp; &nbsp; &nbsp; &nbsp;delete _queue[0]; &nbsp; &nbsp; &nbsp; &nbsp;queueLength -= 1; &nbsp; &nbsp; &nbsp; &nbsp;_current = _current + 1; &nbsp; &nbsp; &nbsp; &nbsp;return uint8(ResponseCodes.Ok); &nbsp; &nbsp;} &nbsp; &nbsp;function getLastNonPublished() returns (uint8 code, uint id, string authorName, string imageUrl, uint createdAt) { &nbsp; &nbsp; &nbsp; &nbsp;if (queueLength == 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.EmptyQueue); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;var request = _requests[_queue[_current]]; &nbsp; &nbsp; &nbsp; &nbsp;id = request.id; &nbsp; &nbsp; &nbsp; &nbsp;authorName = request.authorName; &nbsp; &nbsp; &nbsp; &nbsp;imageUrl = request.imageUrl; &nbsp; &nbsp; &nbsp; &nbsp;createdAt = request.createdAt; &nbsp; &nbsp; &nbsp; &nbsp;code = uint8(ResponseCodes.Ok); &nbsp; &nbsp;}} 在第一次尝试时，我们使用Eris JS库与我们的区块链进行通信。从Node.js文件中解析合约就变得非常简单： import eris from &#39;eris&#39;;function getContract(url, account) { &nbsp; &nbsp;const address = // Read address file stored on disk by the eris CLI; &nbsp; &nbsp;const abi = // Read abi file stored on disk by the eris CLI; &nbsp; &nbsp;const manager = eris.newContractManagerDev(url, account); &nbsp; &nbsp;return manager.newContractFactory(abi).at(address);} 而且它的调用也不困难： function* newRequest(pullrequestId, authorName, imageUrl) { &nbsp; &nbsp;const contract = getContract(url, account); &nbsp; &nbsp;// First gotcha, when a function returns several named variables, they are returned as an Arrays &nbsp; &nbsp;// Second gotcha, numbers are returned as instances of BigNumber, do not forget to convert when standard numbers are expected &nbsp; &nbsp;const [codeAsBigNumber, displayDateAsBigNumber] = yield contract.newRequest(pullrequestId, authorName, imageUrl); &nbsp; &nbsp;const code = codeAsBigNumber.toNumber(); &nbsp; &nbsp;if (code !== 0) { &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(getErrorMessageFromCode(code)); &nbsp; &nbsp;} &nbsp; &nbsp;// Return the displayDate for UI confirmation screen &nbsp; &nbsp;return displayDate.toNumber();} 有关Eris JS库的更多信息，可以参阅Eris文档（https://docs.erisindustries.com/）。 单元测试合约 我们非常喜欢测试驱动开发，但遇到的第一个问题就是：我们如何测试Solidity智能合约？ Eris的项目成员也为此提供了一个工具：sol-unit（https://github.com/smartcontractproduction/sol-unit）。 它在Docker容器中（确保每次测试都在干净的环境中运行）为每次测试运行一个新的本地区块链网络，并执行测试。测试也会写成一个合约。 当然，这个工具也没那么快就能用。 sol-unit是一个npm软件包，为了使用测试功能（assertions，等），我们必须在测试合约中导入由这个软件包提供的合约。这可以用一个简单的Solidity语法实现： import &quot;../node_modules/sol-unit/.../Asserter.sol&quot;; 实际的编译过程并没有看起来那么顺利。编译合约时我们遇到了一个奇怪的情形。即，不能用上面这样的路径导入合约。 我们最终在测试的makefile目标中添加了一个命令，将这些sol-unit&nbsp;合约复制到跟我们的项目相同的文件夹中。之后再运行sol-unit就很简单了，我们可以开始继续写代码了。 copy-sol-unit: &nbsp; &nbsp;@cp -f ./node_modules/sol-unit/contracts/src/* ./src/ethereum/compile-contract: &nbsp; &nbsp;solc --bin --abi -o ./src/ethereum ./src/ethereum/ZeroDollarHomePage.sol ./src/ethereum/ZeroDollarHomePageTest.soltest-ethereum: copy-sol-unit compile-contract &nbsp; &nbsp;./node_modules/.bin/solunit --dir ./src/ethereum 运行测试区块链 运行区块链和部署我们的合约只要按照Eris文档就会非常简单。通过使用之前已经集成在makefile中的一些命令，我们又进一步解决了遇到的一些麻烦。基于我们的合约运行新区块链的整个过程如下所示： 重置任何正在运行的eris docker容器，并删除一些临时文件 启动eris密钥服务 生成我们的账户密钥，并将其地址存储在一个便于稍后由JS API加载的文件中， 生成genesis.json，这是区块链的“区块0” 创建并启动新的区块链 将合约上传至区块链并保存其地址，以便在需要时调用 几天的工作之后，我们就能够在本地的Eris区块链上运行合约了。 从Eris到以太坊 我们希望可以在本地以太坊区块链上尝试我们的合约。 要与以太坊区块链内的合约进行通信，我们必须使用Web3库。在尝试使用它们的过程中，我们也学到了很多，并意识到了Eris的许多潜在的复杂性。 首先，之前假设合约与API类似的想法是不正确的。我们必须区分仅从区块链读取数据的函数，以及将数据写入区块链的函数。 第一种（只读函数），像API所做的那样，会异步返回结果数据。第二种（写入函数）只会返回一个交易散列。并且在相应的块被开采之前（这可能需要一些时间，最差情况是在10秒到1分钟之间），写入函数的预期副作用（区块链内部的更改）不会生效。另外，让这些写入函数返回值的能力我们也还没有。所以我们不得不改变我们的solidity代码来首先调用写入函数，然后调用只读函数来获得结果。 我们还发现了一些事件，可以在智能合约中发生情况时进行通知。智能合约负责触发事件。它们在solidity的代码可以这样写： event PullRequestClaimed(unit pullRequestId, uint estimatedDisplayDate); 他们可以在任何智能合约函数中触发，例如： PullRequestClaimed(pullRequestId, estimatedDisplayDate); 这些事件会被永久存储在区块链中。这意味着我们可以使用区块链存储事件。这可能是判断函数调用是否已成功执行的最简单方法：智能合约可以在其进程结束时触发事件，触发条件包括执行失败、计算结果等等。值得注意的是，Meteor&nbsp;的某些集成包已经可以直接用了。 最终，虽然实现的功能几乎相同，但我们已经可以将我们的智能合约重构的相当简单。我们必须摆脱映射（这些映射无法使用——因为我们的交易不是由以太坊网络开采的）。 solidity这种语言可能和JavaScript很接近，但它仍然非常年轻，并且不完整。数组对象还没有我们在JavaScript中使用的那些函数（甚至没有indexOf），字符串对象也没有任何函数。这在不久的将来或许可以通过社区的贡献来解决。 以太坊的操作如下： // in src/ethereum/ZeroDollarHomePage.solcontract ZeroDollarHomePage { &nbsp; &nbsp;event InvalidPullRequest(uint indexed pullRequestId); &nbsp; &nbsp;event PullRequestAlreadyClaimed(uint indexed pullRequestId, uint timeBeforeDisplay, bool past); &nbsp; &nbsp;event PullRequestClaimed(uint indexed pullRequestId, uint timeBeforeDisplay); &nbsp; &nbsp;event QueueIsEmpty(); &nbsp; &nbsp;bool _handledFirst; &nbsp; &nbsp;uint[] _queue; &nbsp; &nbsp;uint _current; &nbsp; &nbsp;address owner; &nbsp; &nbsp;function ZeroDollarHomePage() { &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender; &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = false; &nbsp; &nbsp; &nbsp; &nbsp;_current = 0; &nbsp; &nbsp;} &nbsp; &nbsp;function remove() { &nbsp; &nbsp; &nbsp; &nbsp;if (msg.sender == owner){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner); &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp;} &nbsp; &nbsp;function newRequest(uint pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp;if (pullRequestId &lt;= 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequest(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;// Check that the pr hasn&#39;t already been claimed &nbsp; &nbsp; &nbsp; &nbsp;bool found = false; &nbsp; &nbsp; &nbsp; &nbsp;uint index = 0; &nbsp; &nbsp; &nbsp; &nbsp;while (!found &amp;&amp; index &lt; _queue.length) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (_queue[index] == pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;found = true; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;index++; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if (found) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed(pullRequestId, (index - _current) * 1 days, _current &gt; index); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId); &nbsp; &nbsp; &nbsp; &nbsp;PullRequestClaimed(pullRequestId, (_queue.length - _current) * 1 days); &nbsp; &nbsp;} &nbsp; &nbsp;function closeRequest() { &nbsp; &nbsp; &nbsp; &nbsp;if (_handledFirst &amp;&amp; _current &lt; _queue.length - 1) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_current += 1; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = true; &nbsp; &nbsp;} &nbsp; &nbsp;function getLastNonPublished() constant returns (uint pullRequestId) { &nbsp; &nbsp; &nbsp; &nbsp;if (_current &gt;= _queue.length) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return 0; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;return _queue[_current]; &nbsp; &nbsp;}} 对Pull的请求进行声明并返回估计的显示日期的演变过程为： // make a [transaction](https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethsendtransaction) call to our smart-contract write functioncontract.newRequest.sendTransaction(pullrequestId, { &nbsp; &nbsp;to: client.eth.coinbase,}, (err, tx) =&gt; { &nbsp; &nbsp;if (err) { &nbsp; &nbsp; &nbsp; &nbsp;throw error; &nbsp; &nbsp;} &nbsp; &nbsp;// wait for it to be mined using [code](https://github.com/ethereum/web3.js/issues/393) from [@croqaz](https://github.com/croqaz) &nbsp; &nbsp;return waitForTransationToBeMined(client, tx) &nbsp; &nbsp; &nbsp; &nbsp;.then(txHash =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!txHash) throw new Error(&#39;Transaction failed (no transaction hash)&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// get its receipt which might contains informations about event triggered by the contract&#39;s code &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// this function might also check wether the transaction was successful by analyzing the receipt for ethereum specific error cases (insufficient funds, etc.) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return getReceipt(client, txHash); &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp; &nbsp; &nbsp; &nbsp;.then(receipt =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// parse those logs to extract only event data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return parseReceiptLogs(receipt.logs, contractAbi)); &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp; &nbsp; &nbsp; &nbsp;.then(logs =&gt; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (logs.length === 0) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(&#39;Transaction failed (Invalid logs)&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const log = logs[0]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;PullRequestClaimed&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return log.args.timeBeforeDisplay.toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;PullRequestAlreadyClaimed&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const number = log.args.timeBeforeDisplay; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.args.past) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return number.negated().toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// timeBeforeDisplay is a BigNumber instance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return number.toNumber(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (log.event === &#39;InvalidPullRequest&#39;) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(&#39;Invalid pull request id&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;});}) 通过上面的代码，我们的去中心化应用就可以在本地以太坊网络中工作了。 部署到生产环境 如果说在本地环境中运行我们的应用是一项挑战，那么将其部署到真正的以太坊网络中的生产就是一场战斗。 这其中有几点非常值得注意。最重要的一点是合约在代码中是不可变的。这意味着： 你部署到区块链的合约会永远保持在那里。如果你发现你的合约存在缺陷，那也无法修复——必须部署新的合约。 部署现有合约的新版本时，以前合约中存储的任何数据都不会自动传输过去——除非你主动使用过去的数据初始化新合约。在我们的案例中，纠正合约中的错误实际上是抹去了已记录的PR（无论是已发布的广告还是待发布的广告）。 每个合约版本都有一个id（例如，我们的“零美元主页”合约id是0xd18e21bb13d154a16793c6f89186a034a8116b74）。 由于过去的版本也可能包含数据，如果你不想丢失数据（我们也一样），请继续跟踪过去的合约ID。 由于你无法更新合约，因此也无法回滚更新。在重新部署之前需要确保合约有效。 当你部署现有合约的新版本时，旧的（错误的）合约仍然可以被调用。 任何引用合约的区块链以外的系统（例如我们在零美元主页中的节点管理应用）都必须更新为指向新合约。我们一开始忘了这么做，还非常困惑为什么我们的新代码没有运行，后来才明白。 如果在代码中包含自杀（suicide&nbsp;）调用，合约作者可以终止合约。但合约的所有现有交易都会保留在区块链中——永远存在。如果不希望它消失，请确保终止开关已经处理了合约中的其余以太币。 还有一个问题是，区块链中的每个合约部署和写入操作都会产生数量不一的以太网络。我们设法获得了5个以太币，但并不知道到底需要多少以太币才能够部署我们的合约或者调用一个交易。要测试出来每次失败产生的成本是很难的。 对于Node.js部分，像前面大部分的项目一样，我们决定在AWS EC2实例上运行它。为此，我们必须： 在服务器上运行以太坊节点 将整个区块链下载到此服务器 在节点上使用一些以太币解锁一个帐户 部署我们的应用程序并将其链接到节点 通过节点将我们的智能合约注册到区块链中 确保你的区块链节点服务器有充足的存储空间。目前区块链的大小约为15GB。 EC2实例的默认卷大小为8GB，确实也很大。因为一开始没有下载完整的区块链（我们也没有马上意识到），所以我们遇到了很多麻烦。例如，我们有一个有5个以太币的帐户，但很长一段时间，系统的状态都会显示我们没有解锁帐户，或者好像我们没有以太币。 直到我们将区块链的其余部分下载下来才解决了这个问题。 同样，解锁我们那个包含5个以太币的宝贵账户也不是一件容易的事。我们不想在应用程序中对我们的密码进行硬编码，而是想用supervisord运行节点来简化部署。艰辛的摸索之后（唉，累啊），我们终于找到了一种方式，可以在改变配置的同时，不会暴露密码。以下就是我们所用的supervisord配置： [program:geth]command=geth --ipcdisable --rpc --fast --unlock 0 --password /path/to/our/password/in/a/fileautostart=falseautorestart=truestartsecs=10stopsignal=TERMuser=ubuntustdout_logfile=/var/log/ethereum-node.out.logstderr_logfile=/var/log/ethereum-node.err.log 最后一个安全提示：区块链的远程过程调用（RPC）端口为8545。请勿在EC2实例上打开此端口！否则任何知道实例IP的人都可以控制你的以太坊节点，并窃取你的以太网。 以太币和瓦斯（Gas） 在以太坊区块链中部署和调用合约并不是免费的，需要承担一定的计算代价。而且由于区块链运行代价高昂，任何写入操作都要承担代价。在以太网中，调用写入合约的方法的代价取决于方法的复杂性。以太坊附带了一份瓦斯费用列表（http://ether.fund/tool/gas-fees），告诉你应该在合约调用时需要添加多少以太币才能让它执行。 实际上，这里的以太币消耗量其实非常小，只占一个以太币的一小部分。以太坊区块链还引入了另一种运行合约的货币：瓦斯（Gas）。 1瓦斯= 0.00001以太币 1 以太币= 100,000瓦斯 根据计算能力的供应情况和计算需求，未来瓦斯和以太币的转化率会有所不同。 ﻿﻿ 处理一次交易的费用并不是强制收取的，但却非常推荐。以太坊的文件中说：“矿工可以选择忽略瓦斯价格太低的交易”。成功开采好一个新区块会给矿工奖励5个以太币。 为了调用我们自己的合约，以太坊区块链大概需要0.00045个到0.00098个以太币（这个实际价格取决于瓦斯价格和交易使用的瓦斯）。 那么怎样才能获得以太币和瓦斯呢？你可以购买以太币（当然主要是通过交换比特币获得），也可以自己去挖矿。在法国，比特币或以太币的购买需要的程序几乎和开设银行账户一样麻烦。这个过程很慢（大概要几天），也很痛苦，取决于由报价和需求确定的汇率。 挖矿以太币 最后我们决定自己挖掘以太币。如果想了解一下在以太坊挖矿到底是不是有利可图，自己挖确实也是一个很好的方法。我们制作了一个非常大的亚马逊EC2实例，它具有强大的GPU计算能力（是一个g2.2xlarge实例）。这个实例的价格是每天17美元。我们安装了以太网，并启动了我们的节点。由于高内存和存储需求，我们很快就必须增强这个实例。加入区块链时节点做的第一件事就是下载过去交易的全部历史记录。这需要大量的存储空间：区块链历史记录超过14GB，Ethash工作证明大约需要3GB。 一旦以太坊节点启动，我们就必须要挖掘3天才能创建出一个有效的区块： ﻿﻿ 提醒一下，以太坊区块链每10秒钟挖一块。开采一个区块可以获得5个以太币，售价大约为55美元（作者写文章时的价格）。我们的增强版EC2实例运行3天的成本约为51美元。总而言之，在AWS上挖以太币比直接买以太币更便宜。但是我们非常幸运：我们开发这个区块的时候挖掘难度并不很大，在开发完之后，网络的挖掘难度就增加了三倍。 5个以太币可以让我们运行“零美元主页”多长时间呢？现在我们来计算一下。 “零美元主页”的工作流程意味着每天都会有一笔交易，另外每个声明的PR都会有一笔交易。假设贡献者每天声明一个PR，那么运行该平台每年最多将花费365 * 2 * 0.00098 = 0.72 以太币。5个以太币可以让我们运行该平台近7年。 正如你所看到的，在以太坊运行合约并不是免费的，不过以目前的价格来说，它仍然很便宜。当然，以太币价值的变化很大。由于挖比特币的利润越来越低，一些大型比特币矿场开始转向以太坊。这也让采矿变得越来越困难，并且使得以太网每天都在变得更加昂贵。 最终的惊喜 最终，我们的智能合约在EC2上托管的现实世界以太坊节点中运行非常好。 但当我们完成这个项目的时候，以太坊发布了它们的Homestead版本，这带来了很多新东西，完全破坏了我们的代码。我们花了大约一个星期的时间才明白，并且通过反复试验修复了因不明原因而不兼容的代码。 Tip Homestead发布了一个隐藏的以太坊功能——私有网络——来简化开发。之前以太坊缺乏私有网络是我们当时选择使用Eris的原因之一。 “零美元主页”平台现在已经启动并且开始运行了。你可以通过在GitHub上的marmelab的开源库之一上开一个Pull请求来使用它，查看http://marmelab.com/ZeroDollarHomepage/ 上当前显示的广告，或浏览marmelab / ZeroDollarHomePage上的应用程序代码。是的，我们正在开源整个广告平台，以便你可以详细了解其工作原理，并在本地进行复制。 ﻿﻿ 调试 以太坊留给开发者的体验其实是非常糟糕的。想象一下没有日志，也没有调试工具，你发现程序失败的唯一方法是通过一行一行输出“I&#39;m here”字符串来查找问题。甚至有时（例如在Solidity合约中），你都不能这样做。或者某些在开发环境中完美工作的程序在生产环境中却无法实现。这就是以太坊的开发者体验。 如果你将数据存储在智能合约中，是没有内置的方式可以在交易后显示此数据当前状态的。这意味着你需要构建自己的可视化工具来排除错误。 可用于跟踪以太坊合约和交易的工具有： etherscan.io：显示有关合约，交易，区块的数据 etherchain.org：区块和以太网信息 你还可以获得有关网络和节点的汇总统计信息 例如，这是我们的合约在etherscan上的可视化界面： ﻿﻿ 每次交易（对合约方法的调用）以及合约执行的痕迹都会用机器语言记录下来。除了用于确保你调用到了合约之外，这个工具不能用于调试的其他部分。 而且，这些工具只能监视公共以太坊网络。所以你不能用它们来调试本地的区块链。 如果你曾经见过比特币交易审计网站，千万不要以为以太坊可以达到相同的复杂程度。此外，比特币网络只有一种交易，因此比设计用于运行智能合约的网络更容易监控。 文档 这还不是全部：以太坊文档与代码不同步（至少在Frontier版本中），所以大多数时候我们必须要通过查看这些库的源代码来了解如何写代码。由于有些出问题的库使用的语言（Solidity）很少人用，所以我们在这里只能祝福它们的工作方式不出问题了。还有，也不要指望Stack Overflow的帮助。像我们这样敢于做一些认真的事情来为社区提供支持的人太少了。 不过这里需要明确的是：我们不是在批评以太坊社区缺乏努力。以太坊背后的发展势头巨大，事情进展迅速。所有文档贡献者的工作都值得赞赏。但还是要承认在我们开发应用程序时，现有文档状态不足以让新的以太坊开发人员启动一个项目。 在网上搜索以太坊的教程很容易，但大多数时候，这些教程中复制粘贴的代码根本无法使用。 如果你想自己动手开发智能合约，以下是一些值得一看的资源： A 101 Noob Intro to Programming Smart Contracts on Ethereum&nbsp;https://medium.com/@ConsenSys/a-101-noob-intro-to-programming-smart-contracts-on-ethereum-695d15c1dab4 以太坊指南&nbsp;https://ethereum-homestead.readthedocs.org/en/latest/ 以太坊 Github wiki&nbsp;https://github.com/ethereum/wiki 结论 经过两位经验丰富的开发人员4周的艰苦努力，我们的代码终于可以在公有以太坊网络中工作了（心累）。在Frontier和Homestead版本之间的以太坊库中的回归和兼容性中断也并没有起到什么作用。查看marmelab / ZeroDollarHomePage上的项目源代码可以详细了解其内部工作原理。因为确实是第一次开发，我们在这方面的经验也实在有限，请原谅我们代码中的潜在错误，以及本文中的不准确之处。请随时在GitHub向我们提交更正或评论。 我们不喜欢这段经历。通过糟糕的文档和不成熟的软件库摸索编程的方式并不是很让人开心。用半熟的语言来实现简单的功能（如字符串操作）也不好玩。尤其是意识到自己尽管有着多年丰富的脚本语言编程经验，但却无法编写简单的可靠合约，这就更令人沮丧。最重要的是，以太坊生态系统的年轻人完全无法预测他们实现一个简单的功能所需的时间。由于时间就是金钱，目前我们还无法确定开发去中心化应用到底需要多少代价。 在时间和资源方面，“零美元主页”代表着超过20,000欧元的开发成本——即使它是一个非常简单的系统。与我们在其他项目中使用的工具（Node.js，Koa，React.js，PostgreSQL等）相比，在区块链上开发非常昂贵。对于开发团队来说，这也是非常令人失望的。我们还可以从中发现一个很强烈的信号：这个生态系统还没有准备好！ 对区块链的看法 在探索了区块链的理论，并真正开发之后，我们已经对它的优缺点有了切身的体会。但令人惊讶的是，我们的大部分结论都和媒体上一直吹捧的不太一样。或许这是因为我们并没有迷信比特币和其他人的疯狂估值，也可能是因为区块链确实面临着不够成熟的现状。 区块链确实是一个非常聪明的想法，具有巨大的潜在影响。但是目前的方案究竟能否为下一个十年颠覆性应用的诞生提供动力还尚未可知。 在技术方面，它的一些基本特征根本不可行。区块链效率不够高，对开发人员不够友好，而且它的技术特性很有可能被恐怖分子或地下黑市利用，用于非法毒品、武器、人口等的贩卖，而难以监管。 在商业方面，区块链变化速度过快，价格昂贵。费用可能会无缘无故地变化数十倍。在这样一个不稳定的平台上开展业务是非常危险的。 我的意思是，我们必须等待。区块链还没有准备好。它需要更成熟些，需要成为另一个杀手级应用而不是成为一个投机引擎，需要更大的开发者社区，需要承担更多的生态和经济责任。这需要多长时间？也许一年或两年？没人能说出来。 说实话，最后得出这样的看法也让我感到很惊讶。关于区块链的大部分出版物都表明了相反的情况。他们说“现在正是时候”，“不要错过火车”，或者“下一个十年的巨型企业正在区块链上建立”。也许他们是错的，也许我们是错的。我们正在试图用更有力的证据来论证这一分析。如果您有不同的意见，欢迎和我们沟通交流。我们将密切关注不同区块链项目的发展。 原文： https://marmelab.com/blog/2016/05/20/blockchain-for-web-developers-in-practice.html 推荐阅读 了解更多区块链技术及应用内容 敬请关注： 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/06/95818c6fbb3ef9664c17fe9d8289ded2.html","headline":"区块链开发实战：如何从零打造一个去中心化应用","dateModified":"2018-03-06T00:00:00+08:00","datePublished":"2018-03-06T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/06/95818c6fbb3ef9664c17fe9d8289ded2.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链开发实战：如何从零打造一个去中心化应用</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/Blockchain_lemon/article/details/79466131 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views">   
  <div class="rich_media_content " id="js_content"> 
   <p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class=" " data-copyright="0" data-ratio="0.555" data-s="300,640" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsTje6eQPr4SbLkFnGldPNI3ibPfxuDl9oJVXV8EZgAFLJHC0RWIWRJmQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="800" style="width: auto !important; height: auto !important; visibility: visible !important;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_jpg/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsTje6eQPr4SbLkFnGldPNI3ibPfxuDl9oJVXV8EZgAFLJHC0RWIWRJmQ/640?wx_fmt=jpeg&amp;wxfrom=5&amp;wx_lazy=1" data-fail="0"></p>
   <p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;font-size: 14px;color: rgb(136, 136, 136);">编译 | 区块链大本营</span></p>
   <p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;font-size: 14px;color: rgb(136, 136, 136);">整理 |&nbsp;reason_W</span></p>
   <p style="margin-left: 8px;margin-right: 8px;text-align: justify;"><span style="letter-spacing: 0.5px;font-size: 14px;color: rgb(136, 136, 136);"><br></span></p>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">区块链会是一场革命吗？</strong></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438"><br></strong></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">今天，很多成功的互联网企业都是在以中介者的形式存在。比如Google——你和互联网之间的中介，比如亚马逊——买家和卖家之间的中介。但区块链——以“去中心化”为最基本特征的技术的发展却很有可能破坏这些互联网巨头赖以成功的结构。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">互联网巨头的事咱们暂且不操心，那么从一个开发者的角度呢？我们需要关心什么呢？作为一个开发者，我们该如何使用区块链构建应用程序？ 我们可以在这么复杂的基础概念之上创造出非常易用的工具吗？这个工具的开发体验又有多友好呢？</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">我们知道，最好的教程就是带你去从头开发一个应用程序。所以我们将使用区块链技术制作一个简单的去中心化广告服务器，称为“零美元主页”。本文将告诉你一群开发者在<strong class="ql-author-5006438">摸索使用区块链技术时最完整的试错经过和心路历程</strong>。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p line="EjVW" class="ql-text-indent-1 ql-long-5006438"><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>什么是区块链应用？</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">要做区块链应用，首先要知道区块链有什么特性。而它最突出的特性就是“去中心化”。简单来说，就是不再像以前的技术一样需要一个中心节点负责管理，而是通过一系列复杂且可靠的技术，由网络中所有的节点共同认可，共同记录，共同维护，解决网络中交易双方的信任问题。这是一条神奇的链，有了这个链就真的可以实现没有中间商赚差价了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">回到正文，区块链正在以去中心化的特质威胁着互联网巨头们的基础。而本文将集中于广告平台。广告平台是广告位购买方和广告渠道提供商之间的中介。我们的项目是通过区块链技术建立一个去中心化的广告平台。也就是跳过广告中间商，通过利用区块链技术本身的特性解决在互联网环境中进行交易时相互之间的信任问题。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">自著名的百万美元主页实验以来，想要在付费广告领域通过创新变的富有已经越来越困难了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">The Million Dollar Homepage&nbsp; </span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">http://www.milliondollarhomepage.com/</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.737" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsygf2MjQQqevP5lJcx5gSXHqLnUOMRdkaVtAj0ts9KvVqWLIpGb1mbw/640?wx_fmt=png" data-type="png" data-w="1000" data-width="415px" height="auto" style="width: 649px !important; height: 478.313px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsygf2MjQQqevP5lJcx5gSXHqLnUOMRdkaVtAj0ts9KvVqWLIpGb1mbw/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">2005年，一个21岁的英国男孩Alex创建了一个名为“百万美元主页”的网站，将页面做成100万个小格子组成的广告牌，每个格子售价1美元。这一别出心裁的创意吸引了不少广告商注意，不到一年时间内，100万个格子全部售出。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">相反，我们选择建立一个允许免费展示广告的平台——<strong class="ql-author-5006438">零美元主页</strong>。 免费，但并不代表什么都不付出：广告商需要通过开源贡献来换取广告位。因此，我们构建了一个去中心化的应用来管理广告在特定网页上的展示方式。 广告商需要具备编程能力，以便能够将他们的广告放在此页面上。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>用户工作流程</strong></p>
    </section>
   </section>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">具体而言，当我们在marmelab的开源库（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://github.com/marmelab</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">）之一合并Pull请求（PR）时，会有一个GitHub机器人对PR进行评论，并邀请PR作者在广告平台管理面板上发布他们的广告。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.761723700887199" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTssa4SLTkAQsAmiafNlM5pg45ef9OOlVaOPicicbyOopBBibROXHEWRt5FeQ/640?wx_fmt=png" data-type="png" data-w="789" data-width="415px" height="auto" style="width: 649px !important; height: 494.3586818757921px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTssa4SLTkAQsAmiafNlM5pg45ef9OOlVaOPicicbyOopBBibROXHEWRt5FeQ/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">打开评论中包含的链接之后，PR作者会被要求使用他们的GitHub凭证进行登录。然后，他们可以上传广告——实际上就是一张简单的图片。此图片将按照时间顺序添加到同样由其他PR作者上传的图片队列中。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.9462759462759462" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTseWricjXdicDs1huFNDJkBYF2H47PzCUGBIy1hZUazKwxW0NvJe8Zss7A/640?wx_fmt=png" data-type="png" data-w="819" data-width="353px" height="auto" style="width: 649px !important; height: 614.1330891330891px !important;" width="353px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTseWricjXdicDs1huFNDJkBYF2H47PzCUGBIy1hZUazKwxW0NvJe8Zss7A/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">每天半夜的时候，脚本都会自动地获取下一个图像（使用先进先出排序），并在接下来的24小时内将其显示在</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">http://marmelab.com/ZeroDollarHomepage/ </span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">上。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.9528535980148883" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsNRrTf25zY4LtmewuJk1xbuBTRicW5RLvAlrNq26m7PfldNq9d8T3LibA/640?wx_fmt=png" data-type="png" data-w="806" data-width="415px" height="auto" style="width: 649px !important; height: 618.4019851116625px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsNRrTf25zY4LtmewuJk1xbuBTRicW5RLvAlrNq26m7PfldNq9d8T3LibA/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438"><br></strong></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">注意</strong>：这整个过程不需要中介参与，但为了避免在网站上出现成人内容，我们会在图像上传之后，发布之前通过Google Vision API进行验证。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>应用架构</strong></p>
    </section>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">以下是我们广告平台的四步的架构：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.8502080443828016" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsufJHT5j8hSzicrEBIMS2XmAazZceE8bpybOUL3l9RsaoZx6Kknl4bwA/640?wx_fmt=png" data-type="png" data-w="721" data-width="415px" height="auto" style="width: 649px !important; height: 551.7850208044382px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsufJHT5j8hSzicrEBIMS2XmAazZceE8bpybOUL3l9RsaoZx6Kknl4bwA/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">开源贡献者通知 </strong>只要开源PR合并到了我们的某个存储库中，GitHub就会将PR详细信息发送给负责管理的app。app会在PR下方进行评论以通知贡献者。该评论包含一个可以进入管理界面的链接，以及PR的详细信息。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">声明和图片上传</strong> 在打开评论链接之后，贡献者会转到管理员界面。他必须使用他的GitHub凭证登录才能通过身份验证。管理程序然后会通过GitHub获取PR详细信息，并检查贡献者是否是PR作者。如果没有问题，管理程序会显示图片上传栏。当贡献者上传图片时，管理程序会将PR ID推送到区块链，并将图片上传到CDN（以PR id命名）。管理程序同时会根据区块链中仍在等待发布的图像的有效PR数量计算并显示图像发布的大致日期。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">广告位置</strong> 每隔24小时，cron（一个执行周期性任务计划的程序）就会要求区块链查找尚未发布的下一个PR。 区块链将此PR标记为已发布并发送该ID。 cron将以PR id命名的图像重命名为“current image”。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">广告显示</strong> 每次访问者想要在“零美元主页”中发布广告，该主页都会向CDN询问当前图像。如果它恰好是区块链上最新发布的广告，那么该广告就会至少保留1天（直到另一个贡献者声明了一个PR为止）。</span></p></li>
   </ul>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">看起来有点意外的是，区块链在这个过程中起着非常小的作用。这是因为在实际编程过程中，我们发现无法把广告平台的整个代码都建立在区块链之上。事实上，区块链在连接互联网和处理方面的能力都非常有限。所以我们只用区块链来实现最关键的广告投放任务：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">注册经过认证的贡献者的Pull请求</span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">获取最后一次没有发布的Pull请求，并将其标记为发布</span></p></li>
   </ul>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">由于各种原因，管理程序中的其他任务最终没有使用区块链：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">从webhook对Pull的请求进行注册</strong> 在Pull请求之前进行注册是没有用的，因为Pull作者可能从未声明它。此外，将数据存储在区块链中并不是没有代价的，所以我们只存储我们必须存储的数据。但这样做的缺点是，我们的公共软件仓库（包括在此实验之前创建的公共软件仓库）中的任何公共资源都有资格进行下一步操作。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">通过在GitHub发布评论来通知用户</strong> 智能合约不能调用外部API，所以我们不能通过这项技术来实现本项任务。因此，我们将此任务交给管理程序来完成。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">验证声明的PR的作者</strong> 同样是因为智能合约不能调用GitHub API。所以，我们也把这个逻辑任务移至管理程序，并将其作为调用区块链的先决条件。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">存储图像</strong> 理论上，我们可以将任何东西存储在区块链中，包括图像。 但实际而言，图像需要很多存储空间，而且我们没有办法在我们的智能合约中存储多个“表格”（数据阵列）。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">将显示的广告更新为队列中的下一个</strong> 区块链中没有与setTimeout函数或cron工具等类似的功能。然而，你可能每隔x个区块就需要执行一次代码，不过这与时间无关。所以，我们在API上使用了类似cron的库。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>研究，记录和第一次尝试</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">考虑到区块链网络的成熟度和设计目的，我们在选择要开发的区块链网络时最终选择了以太坊。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">很快，我们就遇到了第一个困难。直到几个星期前，哪怕只是简单的测试，如果没有购买以太币，我们也无法使用以太坊区块链。此外，以太坊在之前的版本（名为Frontier）中并没有真正许可私有链，这就使开发变得非常复杂。因为没有私有链，只能在公共网络上进行开发，任何访问以太坊网络的人都可能会调用你的测试合约。更重要的是，这份文件只是一个志愿倡议，并且与发展状态不同步。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">注：在我们开始开发程序后，以太坊就发布了新版本，从Frontier切换到Homestead，并且改善了Homestead的文档质量。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);"><span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 0.5px;text-align: justify;">Homestead&nbsp;</span>http://www.ethdocs.org/en/latest/introduction/contributors.html</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.6383347788378144" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsjcymUbHmDP8RibFk5nTvQSI5hlcoTeueZsN0W2V6ia5PZZydIW1mgHWw/640?wx_fmt=png" data-type="png" data-w="1153" data-width="415px" height="auto" style="width: 649px !important; height: 414.27927146574154px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsjcymUbHmDP8RibFk5nTvQSI5hlcoTeueZsN0W2V6ia5PZZydIW1mgHWw/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">尽管存在这些缺陷，我们仍然在Nancy，Paris和Dijon的以太网网络上成功注册了三个节点，并在这些节点之间共享ping。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在文档搜索中，我们最终找到了 Eris 文档（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://docs.erisindustries.com/</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">）。Eris在解释区块链和合约方面做得非常出色。此外，他们专门在以太坊之上建立了一个层级，并开源了一系列工具以简化智能合约的开发过程。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">Eris是一个命令行工具，你可以使用它来初始化你需要的任意数量的本地区块链。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>如何操作智能合约</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">智能合约与API非常相似。它有几个公共函数，可以被在区块链网络上注册过的任何人调用。但与API不同的是，智能合约不能调用外部Web API（区块链是封闭的生态系统）。但是，智能合约可能会调用其他智能合约，只要知道他们的地址。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">与API一样，公共函数只是它们的冰山一角。实际上合约可能由许多私有函数，变量等组成。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">智能合约按照以太坊专有的二进制格式托管在区块链中，可由以太坊虚拟机执行。用于编写合约的语言和编辑器有：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">Serpent，跟Python很像（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://github.com/ethereum/wiki/wiki/Serpent</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">）</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">Solidity，跟Javascript很像（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">http://solidity.readthedocs.org/en/latest/</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">）</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在marmelab中，我们已经使用Javascript编写了很多代码，因此在编写合约时，我们选择了与Javascript类似的Solidity。Solidity合约存储在.sol文件中。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>“零美元主页”合约</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">“零美元主页”合约存储了已声明的Pull请求，以及待发布的请求队列。 Solidity合约的第一个版本如下所示：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// in src/ethereum/ZeroDollarHomePage.sol</span><br>contract ZeroDollarHomePage {<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> constant ShaLength = <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">40</span>;<br> &nbsp; &nbsp;enum ResponseCodes {<br> &nbsp; &nbsp; &nbsp; &nbsp;Ok,<br> &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequestId,<br> &nbsp; &nbsp; &nbsp; &nbsp;InvalidAuthorName,<br> &nbsp; &nbsp; &nbsp; &nbsp;InvalidImageUrl,<br> &nbsp; &nbsp; &nbsp; &nbsp;RequestNotFound,<br> &nbsp; &nbsp; &nbsp; &nbsp;EmptyQueue,<br> &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">struct</span> Request {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> id;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">string</span> authorName;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">string</span> imageUrl;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> createdAt;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> displayedAt;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// what the contract stores</span><br> &nbsp; &nbsp;mapping (<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> =&gt; Request) _requests; <span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// key is the pull request id</span><br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> public numberOfRequests;<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span>[] _queue;<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> public queueLength;<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> _current;<br> &nbsp; &nbsp;address owner;<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// constructor</span><br> &nbsp; &nbsp;function ZeroDollarHomePage() {<br> &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender;<br> &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests = <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;queueLength = <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;_current = <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// a contract must give a way to destroy itself once uploaded to the blockchain</span><br> &nbsp; &nbsp;function remove() {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (msg.sender == owner){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// the following three methods are public contracts entry points</span><br> &nbsp; &nbsp;function newRequest(<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> pullRequestId, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">string</span> authorName, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">string</span> imageUrl) returns (<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span> code, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> displayDate) {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (pullRequestId &lt;= <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// Solidity is a strong typed language. You get compilation errors when types mismatch</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.InvalidPullRequestId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (_requests[pullRequestId].id == pullRequestId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.PullRequestAlreadyClaimed);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (bytes(authorName).length &lt;= <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.InvalidAuthorName);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (bytes(imageUrl).length &lt;= <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.InvalidImageUrl);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// store new pull request details</span><br> &nbsp; &nbsp; &nbsp; &nbsp;numberOfRequests += <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].id = pullRequestId;<br> &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].authorName = authorName;<br> &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].imageUrl = imageUrl;<br> &nbsp; &nbsp; &nbsp; &nbsp;_requests[pullRequestId].createdAt = now;<br> &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId);<br> &nbsp; &nbsp; &nbsp; &nbsp;queueLength += <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.Ok);<br> &nbsp; &nbsp; &nbsp; &nbsp;displayDate = now + (queueLength * <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span> days);<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// no need to explicitly return code and displayDate as they are in the method signature</span><br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;function closeRequest() returns (<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (queueLength == <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.EmptyQueue);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;_requests[_queue[_current]].displayedAt = now;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-built_in" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">delete</span> _queue[<span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>];<br> &nbsp; &nbsp; &nbsp; &nbsp;queueLength -= <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;_current = _current + <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.Ok);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;function getLastNonPublished() returns (<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span> code, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> id, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">string</span> authorName, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">string</span> imageUrl, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> createdAt) {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (queueLength == <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.EmptyQueue);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">var</span> request = _requests[_queue[_current]];<br> &nbsp; &nbsp; &nbsp; &nbsp;id = request.id;<br> &nbsp; &nbsp; &nbsp; &nbsp;authorName = request.authorName;<br> &nbsp; &nbsp; &nbsp; &nbsp;imageUrl = request.imageUrl;<br> &nbsp; &nbsp; &nbsp; &nbsp;createdAt = request.createdAt;<br> &nbsp; &nbsp; &nbsp; &nbsp;code = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint8</span>(ResponseCodes.Ok);<br> &nbsp; &nbsp;}<br>}</span><br></p></pre>
   </section>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在第一次尝试时，我们使用Eris JS库与我们的区块链进行通信。从Node.js文件中解析合约就变得非常简单：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">import</span> eris <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">from</span> <span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'eris'</span>;<br><span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">function</span> <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">getContract</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">url, account</span>) </span>{<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> address = <span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// Read address file stored on disk by the eris CLI;</span><br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> abi = <span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// Read abi file stored on disk by the eris CLI;</span><br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> manager = eris.newContractManagerDev(url, account);<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> manager.newContractFactory(abi).at(address);<br>}</span><br></p></pre>
   </section>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">而且它的调用也不困难：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">function</span>* <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">newRequest</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">pullrequestId, authorName, imageUrl</span>) </span>{<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> contract = getContract(url, account);<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// First gotcha, when a function returns several named variables, they are returned as an Arrays</span><br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// Second gotcha, numbers are returned as instances of BigNumber, do not forget to convert when standard numbers are expected</span><br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> [codeAsBigNumber, displayDateAsBigNumber] = <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">yield</span> contract.newRequest(pullrequestId, authorName, imageUrl);<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> code = codeAsBigNumber.toNumber();<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (code !== <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">throw</span> <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">new</span> <span class="hljs-built_in" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">Error</span>(getErrorMessageFromCode(code));<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// Return the displayDate for UI confirmation screen</span><br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> displayDate.toNumber();<br>}</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">有关Eris JS库的更多信息，可以参阅Eris文档（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://docs.erisindustries.com/</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">）。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="margin-left: 8px;margin-right: 8px;text-align: justify;line-height: 1.75em;"><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>单元测试合约</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">我们非常喜欢测试驱动开发，但遇到的第一个问题就是：我们如何测试Solidity智能合约？</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">Eris的项目成员也为此提供了一个工具：sol-unit（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://github.com/smartcontractproduction/sol-unit</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">）。 它在Docker容器中（确保每次测试都在干净的环境中运行）为每次测试运行一个新的本地区块链网络，并执行测试。测试也会写成一个合约。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">当然，这个工具也没那么快就能用。 sol-unit是一个npm软件包，为了使用测试功能（assertions，等），我们必须在测试合约中导入由这个软件包提供的合约。这可以用一个简单的Solidity语法实现：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">import</span> <span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">"../node_modules/sol-unit/.../Asserter.sol"</span>;</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">实际的编译过程并没有看起来那么顺利。编译合约时我们遇到了一个奇怪的情形。即，不能用上面这样的路径导入合约。 我们最终在测试的makefile目标中添加了一个命令，将这些sol-unit&nbsp;合约复制到跟我们的项目相同的文件夹中。之后再运行sol-unit就很简单了，我们可以开始继续写代码了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;">copy-sol-unit:<br> &nbsp; &nbsp;@cp -f .<span class="hljs-regexp" style="color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">/node_modules/sol-unit/contracts/src/</span>* .<span class="hljs-regexp" style="color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">/src/ethereum/</span><br>compile-contract:<br> &nbsp; &nbsp;solc --bin --abi -o ./src/ethereum ./src/ethereum/ZeroDollarHomePage.sol ./src/ethereum/ZeroDollarHomePageTest.sol<br>test-ethereum: copy-sol-unit compile-contract<br> &nbsp; &nbsp;.<span class="hljs-regexp" style="color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">/node_modules/</span>.bin/solunit --dir ./src/ethereum</span><br></p></pre>
   </section>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>运行测试区块链</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">运行区块链和部署我们的合约只要按照Eris文档就会非常简单。通过使用之前已经集成在makefile中的一些命令，我们又进一步解决了遇到的一些麻烦。基于我们的合约运行新区块链的整个过程如下所示：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">重置任何正在运行的eris docker容器，并删除一些临时文件</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">启动eris密钥服务</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">生成我们的账户密钥，并将其地址存储在一个便于稍后由JS API加载的文件中， </span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">生成genesis.json，这是区块链的“区块0”</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">创建并启动新的区块链</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">将合约上传至区块链并保存其地址，以便在需要时调用</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">几天的工作之后，我们就能够在本地的Eris区块链上运行合约了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>从Eris到以太坊</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">我们希望可以在本地以太坊区块链上尝试我们的合约。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">要与以太坊区块链内的合约进行通信，我们必须使用Web3库。在尝试使用它们的过程中，我们也学到了很多，并意识到了Eris的许多潜在的复杂性。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">首先，之前假设合约与API类似的想法是不正确的。我们必须区分仅从区块链读取数据的函数，以及将数据写入区块链的函数。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">第一种（只读函数），像API所做的那样，会异步返回结果数据。第二种（写入函数）只会返回一个交易散列。并且在相应的块被开采之前（这可能需要一些时间，最差情况是在10秒到1分钟之间），写入函数的预期副作用（区块链内部的更改）不会生效。另外，让这些写入函数返回值的能力我们也还没有。所以我们不得不改变我们的solidity代码来首先调用写入函数，然后调用只读函数来获得结果。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">我们还发现了一些事件，可以在智能合约中发生情况时进行通知。智能合约负责触发事件。它们在solidity的代码可以这样写：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">event</span> <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">PullRequestClaimed</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">unit pullRequestId, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> estimatedDisplayDate</span>)</span>;</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">他们可以在任何智能合约函数中触发，例如：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;">PullRequestClaimed(pullRequestId, estimatedDisplayDate);</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">这些事件会被永久存储在区块链中。这意味着我们可以使用区块链存储事件。这可能是判断函数调用是否已成功执行的最简单方法：智能合约可以在其进程结束时触发事件，触发条件包括执行失败、计算结果等等。值得注意的是，Meteor&nbsp;的某些集成包已经可以直接用了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">最终，虽然实现的功能几乎相同，但我们已经可以将我们的智能合约重构的相当简单。我们必须摆脱映射（这些映射无法使用——因为我们的交易不是由以太坊网络开采的）。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">solidity这种语言可能和JavaScript很接近，但它仍然非常年轻，并且不完整。数组对象还没有我们在JavaScript中使用的那些函数（甚至没有indexOf），字符串对象也没有任何函数。这在不久的将来或许可以通过社区的贡献来解决。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">以太坊的操作如下：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// in src/ethereum/ZeroDollarHomePage.sol</span><br>contract ZeroDollarHomePage {<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">event</span> <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">InvalidPullRequest</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> indexed pullRequestId</span>)</span>;<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">event</span> <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">PullRequestAlreadyClaimed</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> indexed pullRequestId, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> timeBeforeDisplay, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">bool</span> past</span>)</span>;<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">event</span> <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">PullRequestClaimed</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> indexed pullRequestId, <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> timeBeforeDisplay</span>)</span>;<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">event</span> <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">QueueIsEmpty</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"></span>)</span>;<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">bool</span> _handledFirst;<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span>[] _queue;<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> _current;<br> &nbsp; &nbsp;address owner;<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">function <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">ZeroDollarHomePage</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"></span>) </span>{<br> &nbsp; &nbsp; &nbsp; &nbsp;owner = msg.sender;<br> &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = <span class="hljs-literal" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">false</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;_current = <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">function <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">remove</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"></span>) </span>{<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (msg.sender == owner){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suicide(owner);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">function <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">newRequest</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> pullRequestId</span>) </span>{<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (pullRequestId &lt;= <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InvalidPullRequest(pullRequestId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// Check that the pr hasn't already been claimed</span><br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">bool</span> found = <span class="hljs-literal" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">false</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> index = <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">while</span> (!found &amp;&amp; index &lt; _queue.length) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (_queue[index] == pullRequestId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;found = <span class="hljs-literal" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">true</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">else</span> {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;index++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (found) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PullRequestAlreadyClaimed(pullRequestId, (index - _current) * <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span> days, _current &gt; index);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;_queue.push(pullRequestId);<br> &nbsp; &nbsp; &nbsp; &nbsp;PullRequestClaimed(pullRequestId, (_queue.length - _current) * <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span> days);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">function <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">closeRequest</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"></span>) </span>{<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (_handledFirst &amp;&amp; _current &lt; _queue.length - <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_current += <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;_handledFirst = <span class="hljs-literal" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">true</span>;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">function <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">getLastNonPublished</span>(<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"></span>) constant <span class="hljs-title" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">returns</span> (<span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">uint</span> pullRequestId</span>) </span>{<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (_current &gt;= _queue.length) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> _queue[_current];<br> &nbsp; &nbsp;}<br>}</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">对Pull的请求进行声明并返回估计的显示日期的演变过程为：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// make a [transaction](https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethsendtransaction) call to our smart-contract write function</span><br>contract.newRequest.sendTransaction(pullrequestId, {<br> &nbsp; &nbsp;<span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">to</span>: client.eth.coinbase,<br>}, (err, tx) =&gt; {<br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (err) {<br> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">throw</span> error;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// wait for it to be mined using [code](https://github.com/ethereum/web3.js/issues/393) from [@croqaz](https://github.com/croqaz)</span><br> &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> waitForTransationToBeMined(client, tx)<br> &nbsp; &nbsp; &nbsp; &nbsp;.then(<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">txHash</span> =&gt;</span> {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (!txHash) <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">throw</span> <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">new</span> <span class="hljs-built_in" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">Error</span>(<span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'Transaction failed (no transaction hash)'</span>);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// get its receipt which might contains informations about event triggered by the contract's code</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// this function might also check wether the transaction was successful by analyzing the receipt for ethereum specific error cases (insufficient funds, etc.)</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> getReceipt(client, txHash);<br> &nbsp; &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp; &nbsp; &nbsp;.then(<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">receipt</span> =&gt;</span> {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// parse those logs to extract only event data</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> parseReceiptLogs(receipt.logs, contractAbi));<br> &nbsp; &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp; &nbsp; &nbsp;.then(<span class="hljs-function" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-params" style="line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">logs</span> =&gt;</span> {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (logs.length === <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">throw</span> <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">new</span> <span class="hljs-built_in" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">Error</span>(<span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'Transaction failed (Invalid logs)'</span>);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> log = logs[<span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (log.event === <span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'PullRequestClaimed'</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// timeBeforeDisplay is a BigNumber instance</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> log.args.timeBeforeDisplay.toNumber();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (log.event === <span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'PullRequestAlreadyClaimed'</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> number = log.args.timeBeforeDisplay;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (log.args.past) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// timeBeforeDisplay is a BigNumber instance</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> number.negated().toNumber();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment" style="line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// timeBeforeDisplay is a BigNumber instance</span><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">return</span> number.toNumber();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span> (log.event === <span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'InvalidPullRequest'</span>) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">throw</span> <span class="hljs-keyword" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">new</span> <span class="hljs-built_in" style="line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">Error</span>(<span class="hljs-string" style="line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'Invalid pull request id'</span>);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;});<br>})</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">通过上面的代码，我们的去中心化应用就可以在本地以太坊网络中工作了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>部署到生产环境</strong></p>
    </section>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">如果说在本地环境中运行我们的应用是一项挑战，那么将其部署到真正的以太坊网络中的生产就是一场战斗。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">这其中有几点非常值得注意。最重要的一点是<strong class="ql-author-5006438">合约在代码中是不可变</strong>的。这意味着：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">你部署到区块链的合约会永远保持在那里。如果你发现你的合约存在缺陷，那也无法修复——必须部署新的合约。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">部署现有合约的新版本时，以前合约中存储的任何数据都不会自动传输过去——除非你主动使用过去的数据初始化新合约。在我们的案例中，纠正合约中的错误实际上是抹去了已记录的PR（无论是已发布的广告还是待发布的广告）。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">每个合约版本都有一个id（例如，我们的“零美元主页”合约id是0xd18e21bb13d154a16793c6f89186a034a8116b74）。 由于过去的版本也可能包含数据，如果你不想丢失数据（我们也一样），请继续跟踪过去的合约ID。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">由于你无法更新合约，因此也无法回滚更新。在重新部署之前需要确保合约有效。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;"><br></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">当你部署现有合约的新版本时，旧的（错误的）合约仍然可以被调用。 任何引用合约的区块链以外的系统（例如我们在零美元主页中的节点管理应用）都必须更新为指向新合约。我们一开始忘了这么做，还非常困惑为什么我们的新代码没有运行，后来才明白。</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">如果在代码中包含自杀（suicide&nbsp;）调用，合约作者可以终止合约。但合约的所有现有交易都会保留在区块链中——永远存在。如果不希望它消失，请确保终止开关已经处理了合约中的其余以太币。</span></p></li>
   </ul>
   <p><br></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">还有一个问题是，区块链中的每个合约部署和写入操作都会产生数量不一的以太网络。我们设法获得了5个以太币，但并不知道到底需要多少以太币才能够部署我们的合约或者调用一个交易。要测试出来每次失败产生的成本是很难的。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">对于Node.js部分，像前面大部分的项目一样，我们决定在AWS EC2实例上运行它。为此，我们必须：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在服务器上运行以太坊节点</span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">将整个区块链下载到此服务器</strong></span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在节点上使用一些以太币解锁一个帐户</span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">部署我们的应用程序并将其链接到节点</span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">通过节点将我们的智能合约注册到区块链中</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">确保你的区块链节点服务器有充足的存储空间。目前区块链的大小约为15GB。 EC2实例的默认卷大小为8GB，确实也很大。因为一开始没有下载完整的区块链（我们也没有马上意识到），所以我们遇到了很多麻烦。例如，我们有一个有5个以太币的帐户，但很长一段时间，系统的状态都会显示我们没有解锁帐户，或者好像我们没有以太币。 直到我们将区块链的其余部分下载下来才解决了这个问题。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">同样，解锁我们那个包含5个以太币的宝贵账户也不是一件容易的事。我们不想在应用程序中对我们的密码进行硬编码，而是想用supervisord运行节点来简化部署。艰辛的摸索之后（唉，累啊），我们终于找到了一种方式，可以在改变配置的同时，不会暴露密码。以下就是我们所用的supervisord配置：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 122, 170);"><strong><span style="font-size: 15px;letter-spacing: 0.5px;"></span></strong></span></p>
   <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
    <pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><p style="line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span style="font-size: 12px;"><span class="hljs-section" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">[program:geth]</span><br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">command</span>=geth --ipcdisable --rpc --fast --unlock <span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span> --password /path/to/our/password/in/a/file<br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">autostart</span>=<span class="hljs-literal" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">false</span><br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">autorestart</span>=<span class="hljs-literal" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">true</span><br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">startsecs</span>=<span class="hljs-number" style="line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">10</span><br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">stopsignal</span>=TERM<br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">user</span>=ubuntu<br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">stdout_logfile</span>=/var/log/ethereum-node.out.log<br><span class="hljs-attr" style="line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">stderr_logfile</span>=/var/log/ethereum-node.err.log</span></p></pre>
   </section>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">最后一个安全提示：</strong>区块链的远程过程调用（RPC）端口为8545。请勿在EC2实例上打开此端口！否则任何知道实例IP的人都可以控制你的以太坊节点，并窃取你的以太网。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>以太币和瓦斯（Gas）</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在以太坊区块链中部署和调用合约并不是免费的，需要承担一定的计算代价。而且由于区块链运行代价高昂，任何写入操作都要承担代价。在以太网中，调用写入合约的方法的代价取决于方法的复杂性。以太坊附带了一份瓦斯费用列表（</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">http://ether.fund/tool/gas-fees</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">），告诉你应该在合约调用时需要添加多少以太币才能让它执行。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">实际上，这里的以太币消耗量其实非常小，只占一个以太币的一小部分。以太坊区块链还引入了另一种运行合约的货币：瓦斯（Gas）。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <blockquote class="ql-long-5006438">
    <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">1瓦斯= 0.00001以太币</span></p>
   </blockquote>
   <blockquote class="ql-long-5006438">
    <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">1 以太币= 100,000瓦斯</span></p>
   </blockquote>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">根据计算能力的供应情况和计算需求，未来瓦斯和以太币的转化率会有所不同。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.7267267267267268" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsaDd47pKWZiaPgsb6V1s3MbSPZNLTXK96MyNDdp5pVyzmsN8EHvHkicXg/640?wx_fmt=png" data-type="png" data-w="999" data-width="415px" height="auto" style="width: 649px !important; height: 471.6456456456457px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsaDd47pKWZiaPgsb6V1s3MbSPZNLTXK96MyNDdp5pVyzmsN8EHvHkicXg/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">处理一次交易的费用并不是强制收取的，但却非常推荐。以太坊的文件中说：“矿工可以选择忽略瓦斯价格太低的交易”。成功开采好一个新区块会给矿工奖励5个以太币。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">为了调用我们自己的合约，以太坊区块链大概需要0.00045个到0.00098个以太币（这个实际价格取决于瓦斯价格和交易使用的瓦斯）。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">那么怎样才能获得以太币和瓦斯呢？你可以购买以太币（当然主要是通过交换比特币获得），也可以自己去挖矿。在法国，比特币或以太币的购买需要的程序几乎和开设银行账户一样麻烦。这个过程很慢（大概要几天），也很痛苦，取决于由报价和需求确定的汇率。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>挖矿以太币</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">最后我们决定自己挖掘以太币。如果想了解一下在以太坊挖矿到底是不是有利可图，自己挖确实也是一个很好的方法。我们制作了一个非常大的亚马逊EC2实例，它具有强大的GPU计算能力（是一个g2.2xlarge实例）。这个实例的价格是每天17美元。我们安装了以太网，并启动了我们的节点。由于高内存和存储需求，我们很快就必须增强这个实例。加入区块链时节点做的第一件事就是下载过去交易的全部历史记录。这需要大量的存储空间：区块链历史记录超过14GB，Ethash工作证明大约需要3GB。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">一旦以太坊节点启动，我们就必须要挖掘3天才能创建出一个有效的区块：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.5392976588628763" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsjJhicO8IoCHZQcKC5ar3C0PTkTEFgVvxscs8bmAV1S7rYGbdO59EB9g/640?wx_fmt=png" data-type="png" data-w="1196" data-width="415px" height="auto" style="width: 649px !important; height: 350.0041806020067px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsjJhicO8IoCHZQcKC5ar3C0PTkTEFgVvxscs8bmAV1S7rYGbdO59EB9g/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">提醒一下，以太坊区块链每10秒钟挖一块。开采一个区块可以获得5个以太币，售价大约为55美元（作者写文章时的价格）。我们的增强版EC2实例运行3天的成本约为51美元。总而言之，<strong class="ql-author-5006438">在AWS上挖以太币比直接买以太币更便宜</strong>。但是我们非常幸运：我们开发这个区块的时候挖掘难度并不很大，在开发完之后，网络的挖掘难度就增加了三倍。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">5个以太币可以让我们运行“零美元主页”多长时间呢？现在我们来计算一下。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">“零美元主页”的工作流程意味着每天都会有一笔交易，另外每个声明的PR都会有一笔交易。假设贡献者每天声明一个PR，那么运行该平台每年最多将花费365 * 2 * 0.00098 = 0.72 以太币。5个以太币可以让我们运行该平台近7年。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">正如你所看到的，在以太坊运行合约并不是免费的，不过以目前的价格来说，它仍然很便宜。当然，以太币价值的变化很大。由于挖比特币的利润越来越低，一些大型比特币矿场开始转向以太坊。这也让采矿变得越来越困难，并且使得以太网每天都在变得更加昂贵。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>最终的惊喜</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">最终，我们的智能合约在EC2上托管的现实世界以太坊节点中运行非常好。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">但当我们完成这个项目的时候，以太坊发布了它们的<em>Homestead</em>版本，这带来了很多新东西，完全破坏了我们的代码。我们花了大约一个星期的时间才明白，并且通过反复试验修复了因不明原因而不兼容的代码。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h3 class="ql-long-5006438"></h3>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 122, 170);"><strong><span style="font-size: 15px;letter-spacing: 0.5px;">Tip</span></strong></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">Homestead发布了一个隐藏的以太坊功能——私有网络——来简化开发。之前以太坊缺乏私有网络是我们当时选择使用Eris的原因之一。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">“零美元主页”平台现在已经启动并且开始运行了。你可以通过在GitHub上的marmelab的开源库之一上开一个Pull请求来使用它，查看http://marmelab.com/ZeroDollarHomepage/ 上当前显示的广告，或浏览marmelab / ZeroDollarHomePage上的应用程序代码。是的，我们正在开源整个广告平台，以便你可以详细了解其工作原理，并在本地进行复制。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.8507821901323707" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTs2uo379h2taataMpVe7lbOu6qu63dh2tgbmpQickSs6aXibuZYBlCq1Rw/640?wx_fmt=png" data-type="png" data-w="831" data-width="415px" height="auto" style="width: 649px !important; height: 552.1576413959085px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTs2uo379h2taataMpVe7lbOu6qu63dh2tgbmpQickSs6aXibuZYBlCq1Rw/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 122, 170);"><strong><span style="font-size: 15px;letter-spacing: 0.5px;">调试</span></strong></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">以太坊留给开发者的体验其实是非常糟糕的。想象一下没有日志，也没有调试工具，你发现程序失败的唯一方法是通过一行一行输出“I'm here”字符串来查找问题。甚至有时（例如在Solidity合约中），你都不能这样做。或者某些在开发环境中完美工作的程序在生产环境中却无法实现。这就是以太坊的开发者体验。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">如果你将数据存储在智能合约中，是没有内置的方式可以在交易后显示此数据当前状态的。这意味着你需要构建自己的可视化工具来排除错误。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">可用于跟踪以太坊合约和交易的工具有：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul class=" list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">etherscan.io：显示有关合约，交易，区块的数据</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">etherchain.org：区块和以太网信息</span></p></li>
    <li><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">你还可以获得有关网络和节点的汇总统计信息</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">例如，这是我们的合约在etherscan上的可视化界面：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: center;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">﻿<span style="color: rgb(63, 63, 63);letter-spacing: 0.5px;margin-right: 3px;margin-left: 2px;font-size: 15px;width: inherit;height: inherit;"><img class="gallery-image img_loading" data-height="auto" data-ratio="0.6491666666666667" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsm8vkJR1EAz6Q4yibP6gf76am7q278nxZiaHptuUW6mQZ2R7XUvX2yHdQ/640?wx_fmt=png" data-type="png" data-w="1200" data-width="415px" height="auto" style="width: 649px !important; height: 421.30916666666667px !important;" width="415px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsm8vkJR1EAz6Q4yibP6gf76am7q278nxZiaHptuUW6mQZ2R7XUvX2yHdQ/640?wx_fmt=png"></span>﻿</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">每次交易（对合约方法的调用）以及合约执行的痕迹都会用机器语言记录下来。除了用于确保你调用到了合约之外，这个工具不能用于调试的其他部分。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">而且，这些工具只能监视公共以太坊网络。所以你不能用它们来调试本地的区块链。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">如果你曾经见过比特币交易审计网站，千万不要以为以太坊可以达到相同的复杂程度。此外，比特币网络只有一种交易，因此比设计用于运行智能合约的网络更容易监控。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">文档</span></strong></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">这还不是全部：以太坊文档与代码不同步（至少在Frontier版本中），所以大多数时候我们必须要通过查看这些库的源代码来了解如何写代码。由于有些出问题的库使用的语言（Solidity）很少人用，所以我们在这里只能祝福它们的工作方式不出问题了。还有，也不要指望Stack Overflow的帮助。像我们这样敢于做一些认真的事情来为社区提供支持的人太少了。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">不过这里需要明确的是：我们不是在批评以太坊社区缺乏努力。以太坊背后的发展势头巨大，事情进展迅速。所有文档贡献者的工作都值得赞赏。但还是要承认在我们开发应用程序时，现有文档状态不足以让新的以太坊开发人员启动一个项目。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在网上搜索以太坊的教程很容易，但大多数时候，这些教程中复制粘贴的代码根本无法使用。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">如果你想自己动手开发智能合约，以下是一些值得一看的资源：</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">A 101 Noob Intro to Programming Smart Contracts on Ethereum</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">&nbsp;</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://medium.com/@ConsenSys/a-101-noob-intro-to-programming-smart-contracts-on-ethereum-695d15c1dab4</span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">以太坊指南</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">&nbsp;</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://ethereum-homestead.readthedocs.org/en/latest/</span></p></li>
   </ul>
   <ul data-list-style="circle" class="ql-long-5006438 list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;">
    <li><p style="text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">以太坊</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"> Github wiki&nbsp;</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://github.com/ethereum/wiki</span></p></li>
   </ul>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">结论</span></strong></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">经过<strong class="ql-author-5006438">两位经验丰富的开发人员4周的艰苦努力</strong>，我们的代码终于可以在公有以太坊网络中工作了（心累）。在Frontier和Homestead版本之间的以太坊库中的回归和兼容性中断也并没有起到什么作用。查看marmelab / ZeroDollarHomePage上的项目源代码可以详细了解其内部工作原理。因为确实是第一次开发，我们在这方面的经验也实在有限，请原谅我们代码中的潜在错误，以及本文中的不准确之处。请随时在GitHub向我们提交更正或评论。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><strong class="ql-author-5006438">我们不喜欢这段经历。</strong>通过糟糕的文档和不成熟的软件库摸索编程的方式并不是很让人开心。用半熟的语言来实现简单的功能（如字符串操作）也不好玩。尤其是意识到自己尽管有着多年丰富的脚本语言编程经验，但却无法编写简单的可靠合约，这就更令人沮丧。最重要的是，以太坊生态系统的年轻人完全无法预测他们实现一个简单的功能所需的时间。由于时间就是金钱，目前我们还无法确定开发去中心化应用到底需要多少代价。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在时间和资源方面，“零美元主页”代表着超过20,000欧元的开发成本——即使它是一个非常简单的系统。与我们在其他项目中使用的工具（Node.js，Koa，React.js，PostgreSQL等）相比，在区块链上开发非常昂贵。对于开发团队来说，这也是非常令人失望的。我们还可以从中发现一个很强烈的信号：这个生态系统还没有准备好！</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <h2 class="ql-long-5006438"></h2>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <section class="_135editor" data-tools="135编辑器" data-id="86516" data-color="rgb(30, 155, 232)" style="border-width: 0px;border-style: none;border-color: initial;box-sizing: border-box;">
    <section style="border-bottom: 1px solid rgb(221, 221, 221);margin-right: auto;margin-bottom: 10px;margin-left: auto;box-sizing: border-box;">
     <p style="padding-right: 5px;padding-bottom: 6px;padding-left: 5px;border-bottom: 2px solid rgb(30, 155, 232);display: inline-block;margin-bottom: -1px;line-height: 1.1;font-size: 18px;margin-left: 8px;margin-right: 8px;"><strong>对区块链的看法</strong></p>
    </section>
   </section>
   <br>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在探索了区块链的理论，并真正开发之后，我们已经对它的优缺点有了切身的体会。但令人惊讶的是，我们的大部分结论都和媒体上一直吹捧的不太一样。或许这是因为我们并没有迷信比特币和其他人的疯狂估值，也可能是因为区块链确实面临着不够成熟的现状。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">区块链确实是一个非常聪明的想法，具有巨大的潜在影响。但是目前的方案究竟能否为下一个十年颠覆性应用的诞生提供动力还尚未可知。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在技术方面，它的一些基本特征根本不可行。区块链效率不够高，对开发人员不够友好，而且它的技术特性很有可能被恐怖分子或地下黑市利用，<strong class="ql-author-5006438">用于非法毒品、武器、人口等的贩卖</strong>，而难以监管。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">在商业方面，区块链变化速度过快，价格昂贵。费用可能会无缘无故地变化数十倍。在这样一个不稳定的平台上开展业务是非常危险的。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">我的意思是，我们必须等待。<strong class="ql-author-5006438">区块链还没有准备好。</strong>它需要更成熟些，需要成为另一个杀手级应用而不是成为一个投机引擎，需要更大的开发者社区，需要承担更多的生态和经济责任。这需要多长时间？也许一年或两年？没人能说出来。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);">说实话，最后得出这样的看法也让我感到很惊讶。关于区块链的大部分出版物都表明了相反的情况。他们说“现在正是时候”，“不要错过火车”，或者“下一个十年的巨型企业正在区块链上建立”。也许他们是错的，也许我们是错的。我们正在试图用更有力的证据来论证这一分析。如果您有不同的意见，欢迎和我们沟通交流。我们将密切关注不同区块链项目的发展。</span></p>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <blockquote>
    <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">原文：</span></strong></p>
    <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(136, 136, 136);">https://marmelab.com/blog/2016/05/20/blockchain-for-web-developers-in-practice.html</span></p>
   </blockquote>
   <p style="text-align: justify;line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(63, 63, 63);"><br></span></p>
   <p><br></p>
   <p style="font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="__bg_gif" data-ratio="0.45454545454545453" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9kuuGYcoeg06IYM4TSEE1eCF4aiadptTMnNFDia5JfEBLuUslraYtDcYbKr2b4takjM2MfqeZYcVqkQ/640?wx_fmt=gif" data-type="gif" data-w="22" width="22px" style="margin-right: auto; margin-left: auto; line-height: 28px; display: block; box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 22px !important; height: 10px !important;" _width="22px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9kuuGYcoeg06IYM4TSEE1eCF4aiadptTMnNFDia5JfEBLuUslraYtDcYbKr2b4takjM2MfqeZYcVqkQ/640?wx_fmt=gif" data-order="0"></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 25.6px;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.5px;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 25.6px;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.5px;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;">推荐阅读</span></strong></span></p>
   <p style="font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.5px;color: rgb(0, 122, 170);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 0.5px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p>
   <p style="margin-right: 8px;margin-left: 8px;white-space: normal;text-align: center;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247484485&amp;idx=1&amp;sn=71357349c7eeaf775f3d94226b0d5d40&amp;chksm=fc7c5ab8cb0bd3ae998b54e4e3a70ac1243798212965c95597340d10fc4a708c579dc0f80d99&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank"><img class=" img_loading" data-copyright="0" data-ratio="0.5555555555555556" data-s="300,640" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsFLTqlBEzCg590rTokRzbq2zMNpGctCwYmWFVRib1xIC5UQFviced9ibJw/640?wx_fmt=png" data-type="png" data-w="900" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9nDibgM7whdnic7FslMOZicNTsFLTqlBEzCg590rTokRzbq2zMNpGctCwYmWFVRib1xIC5UQFviced9ibJw/640?wx_fmt=png" style="width: 654px !important; height: 363.33333333333337px !important;"></a></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247484478&amp;idx=1&amp;sn=75fd29b0eeb573c48cf05628b7f836fa&amp;chksm=fc7c5ac3cb0bd3d5846f65bbb40da2be842066d63d61ee315ed1be5f1c6dc6a30c24dfe9b58f&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><img class=" img_loading" data-copyright="0" data-ratio="0.5555555555555556" data-s="300,640" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9n56Ik9SiaEDibKDZDiaicgXTNwXicbxiadyOxT3BH7xb4Nu58t7z0QP7cgsC30Bib2khEQe7UbNkrNBUlEQ/640?wx_fmt=png" data-type="png" data-w="900" style="box-sizing: border-box !important; word-wrap: break-word !important; width: 654px !important; visibility: visible !important; height: 363.33333333333337px !important;" _width="auto" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9n56Ik9SiaEDibKDZDiaicgXTNwXicbxiadyOxT3BH7xb4Nu58t7z0QP7cgsC30Bib2khEQe7UbNkrNBUlEQ/640?wx_fmt=png"></a></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247484454&amp;idx=1&amp;sn=959ec66eeb550c69959a1ae677fe2cd7&amp;chksm=fc7c5adbcb0bd3cd232fc058f99101a24ec3f3cdb989aaf2200015545d0e3c365b5e7e1eaf5b&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><img class=" img_loading" data-copyright="0" data-ratio="0.5555555555555556" data-s="300,640" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9lvpR3Vb3s3u7ict3DEx5RZgLmiaCiaBLiagiaWHZ42PMYJIY14zecQRVfshicibKBOoUyxQrlxzjeFyMvAQ/640?wx_fmt=png" data-type="png" data-w="900" width="auto" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 654px !important; height: 363.33333333333337px !important;" _width="auto" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9lvpR3Vb3s3u7ict3DEx5RZgLmiaCiaBLiagiaWHZ42PMYJIY14zecQRVfshicibKBOoUyxQrlxzjeFyMvAQ/640?wx_fmt=png"></a></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 25.6px;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></p>
   <p style="font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="__bg_gif" data-ratio="0.45454545454545453" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9kuuGYcoeg06IYM4TSEE1eCF4aiadptTMnNFDia5JfEBLuUslraYtDcYbKr2b4takjM2MfqeZYcVqkQ/640?wx_fmt=gif" data-type="gif" data-w="22" width="22px" style="margin-right: auto; margin-left: auto; line-height: 28px; display: block; box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 22px !important; height: 10px !important;" _width="22px" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/trm5VMeFp9kuuGYcoeg06IYM4TSEE1eCF4aiadptTMnNFDia5JfEBLuUslraYtDcYbKr2b4takjM2MfqeZYcVqkQ/640?wx_fmt=gif" data-order="1"></p>
   <p style="font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 25.6px;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;line-height: 1.75em;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 0.5px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;">了解更多区块链技术及应用内容</span></strong></span></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;line-height: 1.75em;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 0.5px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;">敬请关注：</span></strong></span></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;line-height: 1.75em;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 0.5px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p>
   <p style="margin-right: 8px;margin-left: 8px;font-size: 16px;white-space: normal;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;line-height: 1.75em;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class=" img_loading" data-ratio="0.5533453887884268" data-s="300,640" data-src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kMArZVQnH795V0mV4yvUe1XtHHYaiaODQx4GJyntPliboaekBhP7QtR0HABz9opVdhALLJRg0gJUPA/640?wx_fmt=png" data-type="png" data-w="553" width="auto" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 553px !important; height: 306px !important;" _width="auto" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/trm5VMeFp9kMArZVQnH795V0mV4yvUe1XtHHYaiaODQx4GJyntPliboaekBhP7QtR0HABz9opVdhALLJRg0gJUPA/640?wx_fmt=png"></p> 
  </div>   
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/79466131,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/79466131,&quot;}">阅读更多</a> 
 <!-- <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view='{"mod":"popu_557","con":",https://blog.csdn.net/Blockchain_lemon/article/details/79466131,"}' data-track-click='{"mod":"popu_557","con":",https://blog.csdn.net/Blockchain_lemon/article/details/79466131,"}'>登录后自动展开</a> --> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

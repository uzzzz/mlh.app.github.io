<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>web3 编译以太坊智能合约流程 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="web3 编译以太坊智能合约流程" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="简介 本文适合已经对以太坊有所了解，并自己动手做过一些测试的读者。 本文使用的代码来源于 http://blog.csdn.net/daichunkai123/article/details/78112640 ，但我在根据文章实践的过程中发现这篇文章中有一些坑，我将在本文中予以修正。 环境安装（也是本人测试使用环境） 安装并启动testrpc npm install -g ethereumjs-testrpc@6.0.3 //安装 testrpc //启动 如果没有问题的话应该能看到如下启动结果 EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0xfdf80a012e7f10d37fec96a2a433873fa280e87f (1) 0x5151266599202047bcefd9781e8a8a8106215a04 (2) 0xf1f1b589cc5c30c2c1201b068c03234350c965ee (3) 0xeeddf154340918413342847b211ed7cdfd93b4ab (4) 0xf424bd1614f8f0f1c373c9786ce8843f9ea876b1 (5) 0x495ed606355c6641db65b79d2141b2e5335b9152 (6) 0xb852b04ee986134dfb4d45c04e706191c9fad98a (7) 0xa0f9447b3b3c185dcbb9233d87324ccb93fa63a5 (8) 0xed17431844db4397bf306cd7ae52bbf4205049c7 (9) 0x4319490601a39ab02115b857e97b4d387fbc8ebc Private Keys ================== (0) f6332a202237d5cd3ab933d6e14495bcf3cb3c27b60db49a1cddfe5233845322 (1) edd9e00b182bcd38e757695e1515846738974688013d5f4f8891b7735f75538e (2) 33119eb84f9c4412e89d4808240eb9f984a96ddfe0d6c83da5b970071da59fbd (3) 818cbe48dc54f2709eb5be6f0251ffad5816e83f6835ece6bb9b4cc7399e62b8 (4) 6ddc5d434aa1753b5646b1d515f5e34b35f8774b7e56ddae26d0f60c79f33ecf (5) 75c9a353b2bcf788d0059f13ce2955c13eddb3cd519ce96ddbe720dd02e7b119 (6) beb73e4ec6153a777d112a60aee1267885d4dbdce72490075801059b5907225e (7) 93acdb0c7563d689ea905317db2efcf7f76436b88945196fc1b999c378726818 (8) 13ed28f25756aaaa526fddcfb41c265edcc3ffd73ccfdd4162014679e7f7d818 (9) 6d78f5cfd9f5333d6fa316a0a890d1850aef5efb83768e00d6f29b7ba061882d HD Wallet ================== Mnemonic: salad embrace pass fatal anger sadness apart plunge kidney liar abstract hockey Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 2、安装web3test mkdir web3test cd web3test npm install web3@0.20.0 --save npm install solc@0.4.21 --save 注：可使用npm view web3 versions 查看所有可用的web3.js版本。使用npm view web3 version查看当前安装的版本。注意web3.js版本非常重要，据我测试以下内容在web3@1.x.x上是会报错的。 准备合约源文件 //FILE:HelloWorldContract.sol pragma solidity ^0.4.0; contract HelloWorldContract { function sayHi() constant returns (string){ return &#39;Hello World&#39;; } } 测试编译脚本 //FILE:compile.js const fs = require (&#39;fs&#39;); const solc = require (&#39;solc&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); const output = solc.compile(input.toString(), 1); for (var contractName in output.contracts){ console.log(contractName + &#39;: &#39; + output.contracts[contractName].bytecode) } 我本地运行该脚本看到如下结果（输出结果可能会不同但以不报错为准）： $node compile.js :HelloWorldContract: 6060604052341561000f57600080fd5b61014e8061001e6000396000f3006060604052600436106100405763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c49c36c8114610045575b600080fd5b341561005057600080fd5b6100586100cf565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561009457808201518382015260200161007c565b50505050905090810190601f1680156100c15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100d7610110565b60408051908101604052600b81527f48656c6c6f20576f726c640000000000000000000000000000000000000000006020820152905090565b602060405190810160405260008152905600a165627a7a7230582053f213cf29e3a3510df6454588fab2d1eade12af4f8424d8a26974f5a23db8770029 部署合约 //FILE:compileDeploy.js console.log(&#39;Setting up ...&#39;); const fs = require(&#39;fs&#39;); const solc = require(&#39;solc&#39;); const Web3 = require(&#39;web3&#39;); const web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); console.log(&#39;Reading Contract...&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); console.log(&#39;Compiling Contract...&#39;); const output = solc.compile(input.toString(),1); const bytecode = output.contracts[&#39;:HelloWorldContract&#39;].bytecode; const abi = output.contracts[&#39;:HelloWorldContract&#39;].interface; //Contract Object const helloWorldContract = web3.eth.contract(JSON.parse(abi)); var account = web3.eth.accounts[0]; console.log(&quot;Deploying the contract&quot;); const helloWorldContractInstance = helloWorldContract.new({ data: &#39;0x&#39; + bytecode, from: account, gas: 1000000 }, (err, res) =&gt; { if (err) { console.log(err); return; } console.log(res.transactionHash); // If we have an address property, the contract was deployed if (res.address) { console.log(&#39;Contract address: &#39; + res.address); } }); 运行脚本 $node compileDeploy.js Setting up ... Reading Contract... Compiling Contract... Deploying the contract 0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0 0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0 Contract address: 0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf 合约交互 导出ABI文件 // FILE: exportABI.js console.log(&#39;Setting up...&#39;); const fs = require (&#39;fs&#39;); const solc = require (&#39;solc&#39;); const Web3 = require (&#39;web3&#39;); console.log(&#39;Reading Contract...&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); console.log(&#39;Compiling Contract...&#39;); const output = solc.compile(input.toString(), 1); const bytecode = output.contracts[&#39;:HelloWorldContract&#39;].bytecode; console.log(&#39;Generating ABI...&#39;); const abi = output.contracts[&#39;:HelloWorldContract&#39;].interface; fs.writeFile(&quot;./HelloWorldABI.JSON&quot;, abi, function(err) { if(err) { return console.log(err); } console.log(&quot;ABI Saved&quot;); }); $node exportABI.json Setting up... Reading Contract... Compiling Contract... Generating ABI... ABI Saved $cat HelloWorldABI.json [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;sayHi&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot; 调用合约方法 //FILE: callContract.js console.log(&#39;Setting up...&#39;); const solc = require (&#39;solc&#39;); const Web3 = require (&#39;web3&#39;); const fs = require (&#39;fs&#39;); console.log(&#39;Reading abi&#39;); const HelloWorldABI = fs.readFileSync(&quot;./HelloWorldABI.JSON&quot;); console.log(&#39;Connecting&#39;); const web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); console.log(&#39;Creating contract instance&#39;); const helloWorldContract = web3.eth.contract(JSON.parse(HelloWorldABI)); var helloWorldContractInstance = helloWorldContract.at(&quot;0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf&quot;); //此处0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf 为部署合约的输出Contract address: 0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf console.log (&#39;calling the contract locally&#39;); console.log(helloWorldContractInstance.sayHi.call()); 运行 $node callContract.js Setting up... Reading abi Connecting Creating contract instance calling the contract locally Hello World 可以看到输出结果“Hello World” 其他环境 node v 6.9.5 阅读更多" />
<meta property="og:description" content="简介 本文适合已经对以太坊有所了解，并自己动手做过一些测试的读者。 本文使用的代码来源于 http://blog.csdn.net/daichunkai123/article/details/78112640 ，但我在根据文章实践的过程中发现这篇文章中有一些坑，我将在本文中予以修正。 环境安装（也是本人测试使用环境） 安装并启动testrpc npm install -g ethereumjs-testrpc@6.0.3 //安装 testrpc //启动 如果没有问题的话应该能看到如下启动结果 EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0xfdf80a012e7f10d37fec96a2a433873fa280e87f (1) 0x5151266599202047bcefd9781e8a8a8106215a04 (2) 0xf1f1b589cc5c30c2c1201b068c03234350c965ee (3) 0xeeddf154340918413342847b211ed7cdfd93b4ab (4) 0xf424bd1614f8f0f1c373c9786ce8843f9ea876b1 (5) 0x495ed606355c6641db65b79d2141b2e5335b9152 (6) 0xb852b04ee986134dfb4d45c04e706191c9fad98a (7) 0xa0f9447b3b3c185dcbb9233d87324ccb93fa63a5 (8) 0xed17431844db4397bf306cd7ae52bbf4205049c7 (9) 0x4319490601a39ab02115b857e97b4d387fbc8ebc Private Keys ================== (0) f6332a202237d5cd3ab933d6e14495bcf3cb3c27b60db49a1cddfe5233845322 (1) edd9e00b182bcd38e757695e1515846738974688013d5f4f8891b7735f75538e (2) 33119eb84f9c4412e89d4808240eb9f984a96ddfe0d6c83da5b970071da59fbd (3) 818cbe48dc54f2709eb5be6f0251ffad5816e83f6835ece6bb9b4cc7399e62b8 (4) 6ddc5d434aa1753b5646b1d515f5e34b35f8774b7e56ddae26d0f60c79f33ecf (5) 75c9a353b2bcf788d0059f13ce2955c13eddb3cd519ce96ddbe720dd02e7b119 (6) beb73e4ec6153a777d112a60aee1267885d4dbdce72490075801059b5907225e (7) 93acdb0c7563d689ea905317db2efcf7f76436b88945196fc1b999c378726818 (8) 13ed28f25756aaaa526fddcfb41c265edcc3ffd73ccfdd4162014679e7f7d818 (9) 6d78f5cfd9f5333d6fa316a0a890d1850aef5efb83768e00d6f29b7ba061882d HD Wallet ================== Mnemonic: salad embrace pass fatal anger sadness apart plunge kidney liar abstract hockey Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 2、安装web3test mkdir web3test cd web3test npm install web3@0.20.0 --save npm install solc@0.4.21 --save 注：可使用npm view web3 versions 查看所有可用的web3.js版本。使用npm view web3 version查看当前安装的版本。注意web3.js版本非常重要，据我测试以下内容在web3@1.x.x上是会报错的。 准备合约源文件 //FILE:HelloWorldContract.sol pragma solidity ^0.4.0; contract HelloWorldContract { function sayHi() constant returns (string){ return &#39;Hello World&#39;; } } 测试编译脚本 //FILE:compile.js const fs = require (&#39;fs&#39;); const solc = require (&#39;solc&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); const output = solc.compile(input.toString(), 1); for (var contractName in output.contracts){ console.log(contractName + &#39;: &#39; + output.contracts[contractName].bytecode) } 我本地运行该脚本看到如下结果（输出结果可能会不同但以不报错为准）： $node compile.js :HelloWorldContract: 6060604052341561000f57600080fd5b61014e8061001e6000396000f3006060604052600436106100405763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c49c36c8114610045575b600080fd5b341561005057600080fd5b6100586100cf565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561009457808201518382015260200161007c565b50505050905090810190601f1680156100c15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100d7610110565b60408051908101604052600b81527f48656c6c6f20576f726c640000000000000000000000000000000000000000006020820152905090565b602060405190810160405260008152905600a165627a7a7230582053f213cf29e3a3510df6454588fab2d1eade12af4f8424d8a26974f5a23db8770029 部署合约 //FILE:compileDeploy.js console.log(&#39;Setting up ...&#39;); const fs = require(&#39;fs&#39;); const solc = require(&#39;solc&#39;); const Web3 = require(&#39;web3&#39;); const web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); console.log(&#39;Reading Contract...&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); console.log(&#39;Compiling Contract...&#39;); const output = solc.compile(input.toString(),1); const bytecode = output.contracts[&#39;:HelloWorldContract&#39;].bytecode; const abi = output.contracts[&#39;:HelloWorldContract&#39;].interface; //Contract Object const helloWorldContract = web3.eth.contract(JSON.parse(abi)); var account = web3.eth.accounts[0]; console.log(&quot;Deploying the contract&quot;); const helloWorldContractInstance = helloWorldContract.new({ data: &#39;0x&#39; + bytecode, from: account, gas: 1000000 }, (err, res) =&gt; { if (err) { console.log(err); return; } console.log(res.transactionHash); // If we have an address property, the contract was deployed if (res.address) { console.log(&#39;Contract address: &#39; + res.address); } }); 运行脚本 $node compileDeploy.js Setting up ... Reading Contract... Compiling Contract... Deploying the contract 0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0 0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0 Contract address: 0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf 合约交互 导出ABI文件 // FILE: exportABI.js console.log(&#39;Setting up...&#39;); const fs = require (&#39;fs&#39;); const solc = require (&#39;solc&#39;); const Web3 = require (&#39;web3&#39;); console.log(&#39;Reading Contract...&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); console.log(&#39;Compiling Contract...&#39;); const output = solc.compile(input.toString(), 1); const bytecode = output.contracts[&#39;:HelloWorldContract&#39;].bytecode; console.log(&#39;Generating ABI...&#39;); const abi = output.contracts[&#39;:HelloWorldContract&#39;].interface; fs.writeFile(&quot;./HelloWorldABI.JSON&quot;, abi, function(err) { if(err) { return console.log(err); } console.log(&quot;ABI Saved&quot;); }); $node exportABI.json Setting up... Reading Contract... Compiling Contract... Generating ABI... ABI Saved $cat HelloWorldABI.json [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;sayHi&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot; 调用合约方法 //FILE: callContract.js console.log(&#39;Setting up...&#39;); const solc = require (&#39;solc&#39;); const Web3 = require (&#39;web3&#39;); const fs = require (&#39;fs&#39;); console.log(&#39;Reading abi&#39;); const HelloWorldABI = fs.readFileSync(&quot;./HelloWorldABI.JSON&quot;); console.log(&#39;Connecting&#39;); const web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); console.log(&#39;Creating contract instance&#39;); const helloWorldContract = web3.eth.contract(JSON.parse(HelloWorldABI)); var helloWorldContractInstance = helloWorldContract.at(&quot;0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf&quot;); //此处0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf 为部署合约的输出Contract address: 0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf console.log (&#39;calling the contract locally&#39;); console.log(helloWorldContractInstance.sayHi.call()); 运行 $node callContract.js Setting up... Reading abi Connecting Creating contract instance calling the contract locally Hello World 可以看到输出结果“Hello World” 其他环境 node v 6.9.5 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-08T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"简介 本文适合已经对以太坊有所了解，并自己动手做过一些测试的读者。 本文使用的代码来源于 http://blog.csdn.net/daichunkai123/article/details/78112640 ，但我在根据文章实践的过程中发现这篇文章中有一些坑，我将在本文中予以修正。 环境安装（也是本人测试使用环境） 安装并启动testrpc npm install -g ethereumjs-testrpc@6.0.3 //安装 testrpc //启动 如果没有问题的话应该能看到如下启动结果 EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0xfdf80a012e7f10d37fec96a2a433873fa280e87f (1) 0x5151266599202047bcefd9781e8a8a8106215a04 (2) 0xf1f1b589cc5c30c2c1201b068c03234350c965ee (3) 0xeeddf154340918413342847b211ed7cdfd93b4ab (4) 0xf424bd1614f8f0f1c373c9786ce8843f9ea876b1 (5) 0x495ed606355c6641db65b79d2141b2e5335b9152 (6) 0xb852b04ee986134dfb4d45c04e706191c9fad98a (7) 0xa0f9447b3b3c185dcbb9233d87324ccb93fa63a5 (8) 0xed17431844db4397bf306cd7ae52bbf4205049c7 (9) 0x4319490601a39ab02115b857e97b4d387fbc8ebc Private Keys ================== (0) f6332a202237d5cd3ab933d6e14495bcf3cb3c27b60db49a1cddfe5233845322 (1) edd9e00b182bcd38e757695e1515846738974688013d5f4f8891b7735f75538e (2) 33119eb84f9c4412e89d4808240eb9f984a96ddfe0d6c83da5b970071da59fbd (3) 818cbe48dc54f2709eb5be6f0251ffad5816e83f6835ece6bb9b4cc7399e62b8 (4) 6ddc5d434aa1753b5646b1d515f5e34b35f8774b7e56ddae26d0f60c79f33ecf (5) 75c9a353b2bcf788d0059f13ce2955c13eddb3cd519ce96ddbe720dd02e7b119 (6) beb73e4ec6153a777d112a60aee1267885d4dbdce72490075801059b5907225e (7) 93acdb0c7563d689ea905317db2efcf7f76436b88945196fc1b999c378726818 (8) 13ed28f25756aaaa526fddcfb41c265edcc3ffd73ccfdd4162014679e7f7d818 (9) 6d78f5cfd9f5333d6fa316a0a890d1850aef5efb83768e00d6f29b7ba061882d HD Wallet ================== Mnemonic: salad embrace pass fatal anger sadness apart plunge kidney liar abstract hockey Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 2、安装web3test mkdir web3test cd web3test npm install web3@0.20.0 --save npm install solc@0.4.21 --save 注：可使用npm view web3 versions 查看所有可用的web3.js版本。使用npm view web3 version查看当前安装的版本。注意web3.js版本非常重要，据我测试以下内容在web3@1.x.x上是会报错的。 准备合约源文件 //FILE:HelloWorldContract.sol pragma solidity ^0.4.0; contract HelloWorldContract { function sayHi() constant returns (string){ return &#39;Hello World&#39;; } } 测试编译脚本 //FILE:compile.js const fs = require (&#39;fs&#39;); const solc = require (&#39;solc&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); const output = solc.compile(input.toString(), 1); for (var contractName in output.contracts){ console.log(contractName + &#39;: &#39; + output.contracts[contractName].bytecode) } 我本地运行该脚本看到如下结果（输出结果可能会不同但以不报错为准）： $node compile.js :HelloWorldContract: 6060604052341561000f57600080fd5b61014e8061001e6000396000f3006060604052600436106100405763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c49c36c8114610045575b600080fd5b341561005057600080fd5b6100586100cf565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561009457808201518382015260200161007c565b50505050905090810190601f1680156100c15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100d7610110565b60408051908101604052600b81527f48656c6c6f20576f726c640000000000000000000000000000000000000000006020820152905090565b602060405190810160405260008152905600a165627a7a7230582053f213cf29e3a3510df6454588fab2d1eade12af4f8424d8a26974f5a23db8770029 部署合约 //FILE:compileDeploy.js console.log(&#39;Setting up ...&#39;); const fs = require(&#39;fs&#39;); const solc = require(&#39;solc&#39;); const Web3 = require(&#39;web3&#39;); const web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); console.log(&#39;Reading Contract...&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); console.log(&#39;Compiling Contract...&#39;); const output = solc.compile(input.toString(),1); const bytecode = output.contracts[&#39;:HelloWorldContract&#39;].bytecode; const abi = output.contracts[&#39;:HelloWorldContract&#39;].interface; //Contract Object const helloWorldContract = web3.eth.contract(JSON.parse(abi)); var account = web3.eth.accounts[0]; console.log(&quot;Deploying the contract&quot;); const helloWorldContractInstance = helloWorldContract.new({ data: &#39;0x&#39; + bytecode, from: account, gas: 1000000 }, (err, res) =&gt; { if (err) { console.log(err); return; } console.log(res.transactionHash); // If we have an address property, the contract was deployed if (res.address) { console.log(&#39;Contract address: &#39; + res.address); } }); 运行脚本 $node compileDeploy.js Setting up ... Reading Contract... Compiling Contract... Deploying the contract 0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0 0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0 Contract address: 0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf 合约交互 导出ABI文件 // FILE: exportABI.js console.log(&#39;Setting up...&#39;); const fs = require (&#39;fs&#39;); const solc = require (&#39;solc&#39;); const Web3 = require (&#39;web3&#39;); console.log(&#39;Reading Contract...&#39;); const input = fs.readFileSync(&#39;HelloWorldContract.sol&#39;); console.log(&#39;Compiling Contract...&#39;); const output = solc.compile(input.toString(), 1); const bytecode = output.contracts[&#39;:HelloWorldContract&#39;].bytecode; console.log(&#39;Generating ABI...&#39;); const abi = output.contracts[&#39;:HelloWorldContract&#39;].interface; fs.writeFile(&quot;./HelloWorldABI.JSON&quot;, abi, function(err) { if(err) { return console.log(err); } console.log(&quot;ABI Saved&quot;); }); $node exportABI.json Setting up... Reading Contract... Compiling Contract... Generating ABI... ABI Saved $cat HelloWorldABI.json [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;sayHi&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot; 调用合约方法 //FILE: callContract.js console.log(&#39;Setting up...&#39;); const solc = require (&#39;solc&#39;); const Web3 = require (&#39;web3&#39;); const fs = require (&#39;fs&#39;); console.log(&#39;Reading abi&#39;); const HelloWorldABI = fs.readFileSync(&quot;./HelloWorldABI.JSON&quot;); console.log(&#39;Connecting&#39;); const web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); console.log(&#39;Creating contract instance&#39;); const helloWorldContract = web3.eth.contract(JSON.parse(HelloWorldABI)); var helloWorldContractInstance = helloWorldContract.at(&quot;0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf&quot;); //此处0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf 为部署合约的输出Contract address: 0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf console.log (&#39;calling the contract locally&#39;); console.log(helloWorldContractInstance.sayHi.call()); 运行 $node callContract.js Setting up... Reading abi Connecting Creating contract instance calling the contract locally Hello World 可以看到输出结果“Hello World” 其他环境 node v 6.9.5 阅读更多","@type":"BlogPosting","url":"/2018/03/08/d26b09d8966fdb0531939d0cf70bd892.html","headline":"web3 编译以太坊智能合约流程","dateModified":"2018-03-08T00:00:00+08:00","datePublished":"2018-03-08T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/03/08/d26b09d8966fdb0531939d0cf70bd892.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>web3 编译以太坊智能合约流程</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h1 id="简介">简介</h1> 
  <p>本文适合已经对以太坊有所了解，并自己动手做过一些测试的读者。 <br> 本文使用的代码来源于 <a href="http://blog.csdn.net/daichunkai123/article/details/78112640" rel="nofollow">http://blog.csdn.net/daichunkai123/article/details/78112640</a> ，但我在根据文章实践的过程中发现这篇文章中有一些坑，我将在本文中予以修正。</p> 
  <h1 id="环境安装也是本人测试使用环境">环境安装（也是本人测试使用环境）</h1> 
  <ol> 
   <li>安装并启动testrpc </li> 
  </ol> 
  <pre class="prettyprint"><code class=" hljs lasso">npm install <span class="hljs-attribute">-g</span> ethereumjs<span class="hljs-attribute">-testrpc</span>@<span class="hljs-number">6.0</span><span class="hljs-number">.3</span>  <span class="hljs-comment">//安装</span>

testrpc <span class="hljs-comment">//启动</span></code></pre> 
  <p>如果没有问题的话应该能看到如下启动结果</p> 
  <pre class="prettyprint"><code class=" hljs asciidoc">EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2)

<span class="hljs-header">Available Accounts ==================</span>
(0) 0xfdf80a012e7f10d37fec96a2a433873fa280e87f
(1) 0x5151266599202047bcefd9781e8a8a8106215a04
(2) 0xf1f1b589cc5c30c2c1201b068c03234350c965ee
(3) 0xeeddf154340918413342847b211ed7cdfd93b4ab
(4) 0xf424bd1614f8f0f1c373c9786ce8843f9ea876b1
(5) 0x495ed606355c6641db65b79d2141b2e5335b9152
(6) 0xb852b04ee986134dfb4d45c04e706191c9fad98a
(7) 0xa0f9447b3b3c185dcbb9233d87324ccb93fa63a5
(8) 0xed17431844db4397bf306cd7ae52bbf4205049c7
(9) 0x4319490601a39ab02115b857e97b4d387fbc8ebc

<span class="hljs-header">Private Keys ==================</span>
(0) f6332a202237d5cd3ab933d6e14495bcf3cb3c27b60db49a1cddfe5233845322
(1) edd9e00b182bcd38e757695e1515846738974688013d5f4f8891b7735f75538e
(2) 33119eb84f9c4412e89d4808240eb9f984a96ddfe0d6c83da5b970071da59fbd
(3) 818cbe48dc54f2709eb5be6f0251ffad5816e83f6835ece6bb9b4cc7399e62b8
(4) 6ddc5d434aa1753b5646b1d515f5e34b35f8774b7e56ddae26d0f60c79f33ecf
(5) 75c9a353b2bcf788d0059f13ce2955c13eddb3cd519ce96ddbe720dd02e7b119
(6) beb73e4ec6153a777d112a60aee1267885d4dbdce72490075801059b5907225e
(7) 93acdb0c7563d689ea905317db2efcf7f76436b88945196fc1b999c378726818
(8) 13ed28f25756aaaa526fddcfb41c265edcc3ffd73ccfdd4162014679e7f7d818
(9) 6d78f5cfd9f5333d6fa316a0a890d1850aef5efb83768e00d6f29b7ba061882d

<span class="hljs-header">HD Wallet ==================</span>
Mnemonic:      salad embrace pass fatal anger sadness apart plunge kidney liar abstract hockey
Base HD Path:  m/44'/60'/0'/0/{account<span class="hljs-emphasis">_index} </span>Listening on localhost:8545</code></pre> 
  <p>2、安装web3test</p> 
  <pre class="prettyprint"><code class=" hljs perl"><span class="hljs-keyword">mkdir</span> web3test
cd web3test
npm install web3<span class="hljs-variable">@0</span>.<span class="hljs-number">20.0</span> --save
npm install solc<span class="hljs-variable">@0</span>.<span class="hljs-number">4.21</span> --save</code></pre> 
  <p>注：可使用<code>npm view web3 versions</code> 查看所有可用的web3.js版本。使用<code>npm view web3 version</code>查看当前安装的版本。注意web3.js版本非常重要，据我测试以下内容在web3@1.x.x上是会报错的。</p> 
  <h1 id="准备合约源文件">准备合约源文件</h1> 
  <pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-comment">//FILE:HelloWorldContract.sol</span>
pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;
contract HelloWorldContract {
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sayHi</span><span class="hljs-params">()</span> <span class="hljs-title">constant</span> <span class="hljs-title">returns</span> <span class="hljs-params">(string)</span>{</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello World'</span>;
  }
}</code></pre> 
  <h1 id="测试编译脚本">测试编译脚本</h1> 
  <pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-comment">//FILE:compile.js</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span> (<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> solc = <span class="hljs-built_in">require</span> (<span class="hljs-string">'solc'</span>);
<span class="hljs-keyword">const</span> input = fs.readFileSync(<span class="hljs-string">'HelloWorldContract.sol'</span>);
<span class="hljs-keyword">const</span> output = solc.compile(input.toString(), <span class="hljs-number">1</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> contractName <span class="hljs-keyword">in</span> output.contracts){
 console.log(contractName + <span class="hljs-string">': '</span> + output.contracts[contractName].bytecode)
}</code></pre> 
  <p>我本地运行该脚本看到如下结果（输出结果可能会不同但以不报错为准）：</p> 
  <pre class="prettyprint"><code class=" hljs asciidoc">$node compile.js
<span class="hljs-attribute">:HelloWorldContract:</span> 6060604052341561000f57600080fd5b61014e8061001e6000396000f3006060604052600436106100405763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c49c36c8114610045575b600080fd5b341561005057600080fd5b6100586100cf565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561009457808201518382015260200161007c565b50505050905090810190601f1680156100c15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100d7610110565b60408051908101604052600b81527f48656c6c6f20576f726c640000000000000000000000000000000000000000006020820152905090565b602060405190810160405260008152905600a165627a7a7230582053f213cf29e3a3510df6454588fab2d1eade12af4f8424d8a26974f5a23db8770029</code></pre> 
  <h1 id="部署合约">部署合约</h1> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-regexp">//</span><span class="hljs-attribute">FILE</span>:compileDeploy.js
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Setting up ...'</span>);
<span class="hljs-reserved">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-reserved">const</span> solc = <span class="hljs-built_in">require</span>(<span class="hljs-string">'solc'</span>);
<span class="hljs-reserved">const</span> Web3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'web3'</span>);
<span class="hljs-reserved">const</span> web3 = <span class="hljs-keyword">new</span> Web3(<span class="hljs-keyword">new</span> Web3.providers.HttpProvider(<span class="hljs-string">"http://localhost:8545"</span>));
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Reading Contract...'</span>);
<span class="hljs-reserved">const</span> input = fs.readFileSync(<span class="hljs-string">'HelloWorldContract.sol'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Compiling Contract...'</span>);
<span class="hljs-reserved">const</span> output = solc.compile(input.toString(),<span class="hljs-number">1</span>);
<span class="hljs-reserved">const</span> bytecode = output.contracts[<span class="hljs-string">':HelloWorldContract'</span>].bytecode;
<span class="hljs-reserved">const</span> abi = output.contracts[<span class="hljs-string">':HelloWorldContract'</span>].interface;

<span class="hljs-regexp">//</span>Contract Object

<span class="hljs-reserved">const</span> helloWorldContract = web3.eth.contract(JSON.parse(abi));

<span class="hljs-reserved">var</span> account = web3.eth.accounts[<span class="hljs-number">0</span>];

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Deploying the contract"</span>);

<span class="hljs-reserved">const</span> helloWorldContractInstance = helloWorldContract.<span class="hljs-keyword">new</span>({
    <span class="hljs-attribute">data</span>: <span class="hljs-string">'0x'</span> + bytecode,
    <span class="hljs-attribute">from</span>: account,
    <span class="hljs-attribute">gas</span>: <span class="hljs-number">1000000</span>
}, <span class="hljs-function"><span class="hljs-params">(err, res)</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-built_in">console</span>.log(err);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-built_in">console</span>.log(res.transactionHash);
    <span class="hljs-regexp">//</span> If we have an address property, the contract was deployed
    <span class="hljs-keyword">if</span> (res.address) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Contract address: '</span> + res.address);
    }
});
</code></pre> 
  <p>运行脚本</p> 
  <pre class="prettyprint"><code class=" hljs r">$node compileDeploy.js
Setting up <span class="hljs-keyword">...</span>
Reading Contract...
Compiling Contract...
Deploying the contract
<span class="hljs-number">0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0</span>
<span class="hljs-number">0x0ee6ba6651e6e44497325441ac073e190e0ff405837204d1da465f049710adf0</span>
Contract address: <span class="hljs-number">0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf</span></code></pre> 
  <h1 id="合约交互">合约交互</h1> 
  <h2 id="导出abi文件">导出ABI文件</h2> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-regexp">//</span> <span class="hljs-attribute">FILE</span>: exportABI.js
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Setting up...'</span>);
<span class="hljs-reserved">const</span> fs = <span class="hljs-built_in">require</span> (<span class="hljs-string">'fs'</span>);
<span class="hljs-reserved">const</span> solc = <span class="hljs-built_in">require</span> (<span class="hljs-string">'solc'</span>);
<span class="hljs-reserved">const</span> Web3 = <span class="hljs-built_in">require</span> (<span class="hljs-string">'web3'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Reading Contract...'</span>);
<span class="hljs-reserved">const</span> input = fs.readFileSync(<span class="hljs-string">'HelloWorldContract.sol'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Compiling Contract...'</span>);
<span class="hljs-reserved">const</span> output = solc.compile(input.toString(), <span class="hljs-number">1</span>);
<span class="hljs-reserved">const</span> bytecode = output.contracts[<span class="hljs-string">':HelloWorldContract'</span>].bytecode;
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Generating ABI...'</span>);
<span class="hljs-reserved">const</span> abi = output.contracts[<span class="hljs-string">':HelloWorldContract'</span>].interface;
fs.writeFile(<span class="hljs-string">"./HelloWorldABI.JSON"</span>, abi, <span class="hljs-reserved">function</span>(err) {
    <span class="hljs-keyword">if</span>(err) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(err);
    }
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ABI Saved"</span>);
});</code></pre> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-variable">$node</span> <span class="hljs-keyword">export</span>ABI.json
Setting up...
Reading Contract...
Compiling Contract...
Generating ABI...
ABI Saved
<span class="hljs-variable">$cat</span> HelloWorldABI.json
[{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"inputs"</span>:[],<span class="hljs-string">"name"</span>:<span class="hljs-string">"sayHi"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"string"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"view"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"</span></code></pre> 
  <h2 id="调用合约方法">调用合约方法</h2> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-regexp">//</span><span class="hljs-attribute">FILE</span>: callContract.js
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Setting up...'</span>);
<span class="hljs-reserved">const</span> solc = <span class="hljs-built_in">require</span> (<span class="hljs-string">'solc'</span>);
<span class="hljs-reserved">const</span> Web3 = <span class="hljs-built_in">require</span> (<span class="hljs-string">'web3'</span>);
<span class="hljs-reserved">const</span> fs = <span class="hljs-built_in">require</span> (<span class="hljs-string">'fs'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Reading abi'</span>);
<span class="hljs-reserved">const</span> HelloWorldABI = fs.readFileSync(<span class="hljs-string">"./HelloWorldABI.JSON"</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting'</span>);
<span class="hljs-reserved">const</span> web3 = <span class="hljs-keyword">new</span> Web3(<span class="hljs-keyword">new</span> Web3.providers.HttpProvider(<span class="hljs-string">"http://localhost:8545"</span>));
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Creating contract instance'</span>);
<span class="hljs-reserved">const</span> helloWorldContract = web3.eth.contract(JSON.parse(HelloWorldABI));
<span class="hljs-reserved">var</span> helloWorldContractInstance = helloWorldContract.at(<span class="hljs-string">"0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf"</span>);  <span class="hljs-regexp">//</span>此处<span class="hljs-number">0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf</span> 为部署合约的输出Contract <span class="hljs-attribute">address</span>: <span class="hljs-number">0x6406fbd7ebe94dccf40b52fb8e71555a91f282bf</span>
<span class="hljs-built_in">console</span>.log (<span class="hljs-string">'calling the contract locally'</span>);
<span class="hljs-built_in">console</span>.log(helloWorldContractInstance.sayHi.call());</code></pre> 
  <p>运行</p> 
  <pre class="prettyprint"><code class=" hljs mel"><span class="hljs-variable">$node</span> callContract.js

Setting up...
Reading abi
Connecting
Creating contract <span class="hljs-keyword">instance</span>
calling the contract locally
Hello World</code></pre> 
  <p>可以看到输出结果“Hello World”</p> 
  <h1 id="其他环境">其他环境</h1> 
  <p>node v 6.9.5</p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/alphags/article/details/79489100,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/alphags/article/details/79489100,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

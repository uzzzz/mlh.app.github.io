<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>用Python做证券指数的三种策略分析 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="用Python做证券指数的三种策略分析" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="用Python做证券指数的三种策略分析 这两天恰好看到一本比较有趣的书，《FOF组合基金》。讲的是Fund of Fund,讲的是组合基金的理论，架构和实践。可以说是有既有理论高度，又有实践的策略。 其中有段话比较值得玩味。“可行集中包括无数个可供投资者选择的证券投资组合。投资者可通过有效集定理来找到最佳的投资组合。所谓最佳投资组合。。。。。满足两个条件： 1、相同风险下具有最大收益率的投资组合 2、同样收益率的水平下具有最小风险的投资组合 实践中还有另外一个很重要的因子，资金容量 所有人都在寻找高收益率，低风险，大容量的策略。但遗憾的是三者不可兼得。。。。共有8种类型的策略。其中比较有代表性的是相对价值策略，事件驱动策略，宏观因素策略。 上周股市大涨，本周股市大跌。那么，现在以2月1日的收盘数据来看，指数中有哪些符合中三种策略的指数？ 我尝试用Python和手中的数据做了一个简单基于Z值的分析，自我学习和分享讨论。 1 、相对价值策略。（低收益，低风险，高容量） 书中谈的相对价值策略主要是类固定收益（银行理财，货币基金，债卷，对冲套利等），代价是牺牲”收益率“，从而保证风险可控，和规模扩大。 书中谈的方法。基本上需要通过期货，期限套利，跨期套利，分级基金折价，溢价，ETF套利，可转债，波动率，期权等方式。也许这种方式就是雪球上 低风险投资的策略吧。 相对价值策略需要拥有广阔的知识面和大额的资金。而且2015年后，卷商的ETF交易系统接口已经关闭,ETF套利很难运行。未来发展有赖于接口系统重新开放。 既然那么复杂，我就把问题简单化。 1.容量： 设为 500亿以上~5000亿日交易额规模。（盘子必须要大，流动性要好） 2.风险： 设为该日市盈率和市净率为Z值之和最小的5个指数。（风险要低） 3.收益率： 无所谓，可以牺牲。 结果如下： 找到的这5个指数的净资产收益率较低（小于10%），相对风险释放比较多（市盈率和市净率的Z值都是历史中的非常低位置），（盘子比较大（超过500亿）。其中以中证1000为最甚。 不过这里的风险最小，只是指数自己和自己历史比较的Z值。Z值可以衡量相对风险。绝对风险，也许只有FOF组合基金中讲的对冲，和组合等策略才能做到。 2、宏观因素策略。（高收益，高风险，高容量） 以牺牲风险为代价。。。也称择时策略。。。做对，自然收益会搞；但是如果做错，则损失也会很大。。。总的来说可以分成两类：拐点择时和趋势择时。 注： 这种策略应该就是人们常说的”投机“。 这些策略是技术流。利用了SVM(支持向量机）挖掘历史模型，Hurst指数，情绪指数，噪声指数等或者是各种均线等。 技术流暂且不研究，我们可以先看看市场中那些是宏观因素策略指数。把问题简化为： 1.高收益：ROE(PB/PB) 等级为高（15%~21%)（收益率必须要高。注：这里的收益率是长期的） 2.高容量： 50亿~500亿日交易额 （盘子必须要大，流动性要好） 3.高风险：（风险无所谓，可以适当放宽） 结果如下： 消费，食品，饮料等净资产回报率很高在20%左右，但是相对价格，市盈率，市净率的Z值有的都已经超过了3，或者4. 当这些指数回归均值时，估计要“疑似银河落九天” 不过创业成长指数，近资产汇报率19%，但是PB,PE的Z值都非常地。日后好好研究，看看是否是一支被错杀的创业板指数。 3、事件驱动策略（低风险，高收益，资金容量比较小） 把问题简化为： 1.低风险：当市净率，市盈率Z值最低 2.高收益： ROE(PB/PB) 较高的5只指数（收益率必须要高。注：这里的收益率是长期的） 3.容量： 不设限制 他们分别是创业成长，新能源车，和文化类指数。 新能源车由于补贴政策的变化，不断的估值调整，下滑。 文化类指数，由于乐视这个老鼠屎，整个系列都在过去两年垫底。 不过创业成长指数净资产回报率非常高，却估值很低，风险释放充分。 代码在后面： 1、初始化环境 主要用到了Python numpy,Pandas, Scipy.stats, Matplotlib,还有seaborn 等包. 证券投资的机器学习预测，通常需要准备大量数据进行回测。 本文不包含预测和回测部分。 注：预测和回测也没用。看了FOF组合基金一书才知道，2015年卷商交易接口已经关闭。估计ETF高频套利也不能做了。 此处如果理解有误，还请高人指点。 import pandas as pd import numpy as np from scipy import stats import matplotlib.pyplot as plt import seaborn as sns %matplotlib inline !free -h # 以下代码是为了显示正文正常 import matplotlib as mpl import matplotlib.font_manager as font_manager path_eng = &#39;/usr/share/fonts/chinese/REFSAN.TTF&#39; path_CHN = &quot;/usr/share/fonts/chinese/simhei.ttf&quot; prop = font_manager.FontProperties(fname=path_CHN) #Set the microsoft sans serief as default font family. if show chinese test, set path_CHN instead. #prop.set_weight = &#39;light&#39; mpl.rcParams[&#39;font.family&#39;] = prop.get_name() Today = &quot;2018-02-01&quot; 数据概览 def view_data(): print(&quot;数据载入中...&quot;) sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) # sec_map 包含了约2800多个指数,实际指数约550只 history = pd.read_hdf(&quot;uqer/uq_history.h5&quot;,&quot;history&quot;) #hisotry 包含了从2004年到2017年11月16日的指数数据( 大约86万条数据). #history = history.sort_index(level=0) ntickers = history.index.levshape[0] nTradeDate =history.index.levshape[1]/250 nRecords = history.shape[0]/10**4 print(&quot;交易历史数据库包含了:\n\t{1:,.0f}万条日交易数据.\n\t{0}只指数，\n\t单只指数最长交易记录为{2:.1f}年.&quot;.format(ntickers,nRecords,nTradeDate)) print(&quot;\n注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。\n\n&quot;) print(&quot;历史交易数据：\n 特征列表：{0}&quot;.format(history.columns.tolist())) print(&quot;股指名称数据：\n 特征列表：{0}&quot;.format(sec_map.columns.tolist())) view_data() map_E2C = {&quot;ticker&quot;:&quot;指数代码&quot;,&quot;secShortName&quot;:&quot;指数名称&quot;, &#39;tradeDate&#39;:&quot;日期&quot;, &#39;Close&#39;:&quot;收盘价-Close&quot;, &#39;PB1&#39;:&quot;市净率-PB&quot;, &#39;PE1&#39;:&quot;市盈率-PE&quot;, &#39;TurnoverValue&#39;:&quot;成交额&quot;, &#39;TurnoverVol&#39;:&quot;成交量&quot;,&quot;ROE&quot;:&quot;净资产回报率-ROE&quot;} print(&quot;\n本文使用的特征为：{0}&quot;.format(list(map_E2C.values()))) 数据载入中... 交易历史数据库包含了: 91万条日交易数据. 550只指数， 单只指数最长交易记录为10.8年. 注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。 历史交易数据： 特征列表：[&#39;secID&#39;, &#39;Close&#39;, &#39;PB1&#39;, &#39;PB2&#39;, &#39;PE1&#39;, &#39;PE2&#39;, &#39;TurnoverValue&#39;, &#39;TurnoverVol&#39;] 股指名称数据： 特征列表：[&#39;baseDate&#39;, &#39;basePoint&#39;, &#39;endDate&#39;, &#39;indexType&#39;, &#39;indexTypeCD&#39;, &#39;porgFullName&#39;, &#39;pubOrgCD&#39;, &#39;publishDate&#39;, &#39;secID&#39;, &#39;secShortName&#39;] 本文使用的特征为：[&#39;指数代码&#39;, &#39;指数名称&#39;, &#39;日期&#39;, &#39;收盘价-Close&#39;, &#39;市净率-PB&#39;, &#39;市盈率-PE&#39;, &#39;成交额&#39;, &#39;成交量&#39;, &#39;净资产回报率-ROE&#39;] 特征工程 1.2.1 筛选有效数据 数据中存在缺失，故只筛选截至2018年1月25日有交易记录的数据。 历史交易数据过少，没有统计意义（暂定至少3年） def filter_history(): def ticker_filter(x): ntradedays_annual = 250 # 假设一年交易日为250天 nyear=3 # 假设至少需要3年数据 checkday=Today # Checkday是设定有效的交易日期。默认为Today, 全局变量 mask_years = x.shape[0]&gt;(ntradedays_annual*nyear) mask_checkday = x.index.isin([checkday],level=&quot;tradeDate&quot;).any() mask = mask_years &amp; mask_checkday return mask history = pd.read_hdf(&quot;uqer/uq_history.h5&quot;,&quot;history&quot;) #hisotry 包含了从2004年到2017年11月16日的指数数据( 大约86万条数据). history= history.loc(axis=0)[:,:Today] history_filtered= history.groupby(level=0).filter(ticker_filter) ntickers = len(history_filtered.groupby(level=0).groups) print(&quot;{0}只指数交易时间超过了3年 且在{1}日有交易记录&quot;.format(ntickers,Today)) return history_filtered history =filter_history() 483只指数交易时间超过了3年 且在2018-02-01日有交易记录 1.2.2 添加ROE（净资产回报率）特征 history[&quot;ROE&quot;] = history[&quot;PB1&quot;]/history[&quot;PE1&quot;] 1.2.3 特征提取 交易日最新数据汇总。 取指定交易日因子数据 净资产回报率特征。 取一年的数据平均值，然后按回报率分成4个级别。级别(超低，低，中，高） 交易额规模特征。取一年的数据平均值，然后按日平均交易额分成4个级别（小于5亿，小于50亿，小于500亿，小于5000亿） Z值（各个指标的标准差倍数）。 针对所有历史数据，计算Zscore(标准差倍数）。 def Check_summary(): def lastz(x): freedom = 1 # it is sample, so the sample std degree of freedome should not be 0 but 1 Arry=x.values zscore = stats.zmap(Arry[-1],Arry,ddof=freedom) return zscore def recent_mean(x): mean = x.tail(250).sum()/250 return mean grp = history.groupby(level=0) grp_last = grp.agg({&quot;Close&quot;:&quot;last&quot;,&quot;PE1&quot;:&quot;last&quot;,&quot;PB1&quot;:&quot;last&quot;,&quot;ROE&quot;:&quot;last&quot;,&quot;TurnoverValue&quot;:&quot;last&quot;}) grp_last[&quot;TurnoverValue&quot;] =grp_last[&quot;TurnoverValue&quot;] grp_rank = grp.agg({&quot;ROE&quot;:recent_mean,&quot;TurnoverValue&quot;:recent_mean}) grp_z = grp.agg({&quot;Close&quot;:lastz,&quot;PE1&quot;:lastz,&quot;PB1&quot;:lastz,&quot;ROE&quot;:lastz,&quot;TurnoverValue&quot;:lastz}) ROE_rank = pd.cut(grp_rank.ROE,bins=4,labels=[&quot;超低&quot;,&quot;低&quot;,&quot;中&quot;,&quot;高&quot;]) TV_rank = pd.cut(grp_rank.TurnoverValue,bins=5*np.logspace(7,11,5),labels=[&quot;5亿&quot;,&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;]) ROE_rank.name = &quot;净资产回报率等级&quot; TV_rank.name =&quot;日交易额规模&quot; sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) # sec_map 包含了约2800多个指数,实际指数约550只{} #decimals = pd.Series([1,1,1,2,1 ], index=[&quot;Close&quot;,&quot;PE1&quot;,&quot;PB1&quot;,&quot;ROE&quot;,&quot;TurnoverValue&quot;]) combined = sec_map[[&quot;secShortName&quot;]].join(grp_last,how=&quot;right&quot;).join(ROE_rank,rsuffix=&quot;_R&quot;).join(TV_rank,rsuffix=&quot;_R&quot;) combined = combined.join(grp_z,rsuffix=&quot;_Z&quot;) return combined checkday_summary = Check_summary() checkday_summary.columns Index([&#39;secShortName&#39;, &#39;Close&#39;, &#39;PE1&#39;, &#39;PB1&#39;, &#39;ROE&#39;, &#39;TurnoverValue&#39;, &#39;净资产回报率等级&#39;, &#39;日交易额规模&#39;, &#39;CloseZ&#39;, &#39;PE1Z&#39;, &#39;PB1Z&#39;, &#39;ROEZ&#39;, &#39;TurnoverValue_Z&#39;], dtype=&#39;object&#39;) 1.3 数据探索 1.3.1 不同日交易额的指数群中指数的数量 tmp=sns.countplot(&#39;日交易额规模&#39;,data=checkday_summary) checkday_summary.groupby(by=&quot;日交易额规模&quot;)[[&quot;ROE&quot;]].mean().rename(columns={&quot;ROE&quot;:&quot;平均净资产回报率&quot;}) 1.3.2 收盘价（Close) col=&quot;Close&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 指定日收盘价汇总箱形图 展现不同指数的收盘价差异： 左图是绝对值：不同规模的指数在该日收盘价价值不同。 右图是相对值：用Z值（即几个标准差）来衡量不同规模指数群的收盘价和各指数自己历史相比的差异。（500亿规模的指数收盘价差异比较大，Z指在4和-1之间。 从右图可以看出， 除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在1附近。 各个日交易规模的指数群都有些Z值在（-1，1）之外的指数，这中间也许存在机会和风险。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 注：考虑到通货膨胀和指数内股票的增长，通常指数收盘价会出现Z值小于-1的情况。收盘价Z值&gt;1甚至大于2都是比较常见的情况。 1.3.3 市盈率（PE1) col=&quot;PE1&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 指定日市盈率汇总箱形图 展现不同指数的市盈率差异： 左图是绝对值：不同规模的指数在该日市盈率估值不同。 注：由于市盈率计算方法不一样，例如：加权，等权，算术平均等模式。故不同数据源的市盈率，市净率差异比较大。指数官网的市盈率和市净率比较权威。不过使用费用比较高。本文使用的是免费数据。因此可以看出这一天5亿规模指数群中有一个指数的市盈率小于-150倍。这是明显错误的。需要过滤掉。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市盈率和各自历史相比差异。 由于Z值计算是用全部历史数据来计算，故历史上的错误数据（如果数量不大的话，例如小于1%），对整理影响不大。只要将异常点过滤即可。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市盈率存在低估？ def show_min_PE_Z(): col=&quot;PE1&quot; def get_max(x): colz= col+&quot;_Z&quot; index =x[colz].idxmax() return x.loc[index][[&quot;secShortName&quot;,col,colz]] def get_min(x): colz= col+&quot;_Z&quot; index =x[colz].idxmin() return x.loc[index][[&quot;secShortName&quot;,col,colz]] print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_max).round(1)) print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_min).round(1)) show_min_PE_Z() 如上表中，所展示， 低估指数： Z值小于-1。 例如：中证1000(000852)，新能源车（399417），文化指数分别是日交易规模（大盘，中盘，小盘）中Z值最低的指数。 高估指数：Z值大于2。 例如： 中经GDP,央视50（399550），水电指数分别是日交易规模（大盘，中盘，小盘）中Z值最高的指数。 如果这些指数的历史分布是正态， 那么根据经验法则，就存在较大的机会（针对低估）和风险（针对高估） 接下来，看看500亿日交易额规模指数群中新能源车和央视50这两个比较常见的指数历史数据的市盈率的波动。 tickers=[&quot;399417&quot;,&quot;399550&quot;] sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) for ticker in tickers: print(&quot;{0} base day is {1}&quot;.format(ticker,sec_map.loc[ticker].baseDate)) fig,ax = plt.subplots(1,2,figsize=(6,3)) fig.suptitle(ticker) PE1 = history.loc[ticker][&quot;PE1&quot;] PE1_Z = history.loc[ticker][[&quot;PE1&quot;]].apply(stats.zscore) PE1.plot(ax=ax[0]) sns.distplot(PE1_Z,ax=ax[1],vertical=True) 从上图可以看出，2018年2月1日的市盈率图 新能源市盈率为22倍，绝对值不算高。但是Z指接近-1.5，相对值比较低，未来有很大的机会。 央视50市盈率为13倍，绝对值比较低。但是Z值接近4，相对值极度高，未来存在回归历史均值的风险 1.3.4 市净率 （PB1) col=&quot;PB1&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 与市盈率数据类似 指定日市净率汇总箱形图 展现不同指数的市净率差异： 左图是绝对值：不同规模的指数在该日市净率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市净率和各自历史相比差异。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市净率存在低估计算机学校？ def show_min_PB_Z(): col=&quot;PB1&quot; def get_max(x): colz= col+&quot;_Z&quot; index =x[colz].idxmax() return x.loc[index][[&quot;secShortName&quot;,col,colz]] def get_min(x): colz= col+&quot;_Z&quot; index =x[colz].idxmin() return x.loc[index][[&quot;secShortName&quot;,col,colz]] print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_max).round(1)) print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_min).round(1)) show_min_PB_Z() 从上图可以看出，2018年2月1日的市盈率图 新能源车市盈率为2.7倍，绝对值不算高。而且Z指接近-1.5，相对值比较低，未来有很大的机会。 国证食品市盈率为6.7倍，绝对值非常高。而且Z值接近3.2，相对值极度高，未来存在回归历史均值（3年历史）的风险。 注：由于国证食品指数在2004年就成立，缺少之前近十年历史数据。无法完全确定是否高估 1.3.5 净资产回报率（ROE） col=&quot;ROE&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 与市盈率数据类似 指定日净资产回报率汇总箱形图 展现不同指数的净资产回报率差异： 左图是绝对值：不同规模的指数在该日净资产回报率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的净资产回报率和各自历史相比差异。 和市盈率与市净率不同，净资产回报率（ROE=PB/PE= profit/equity)排除了收盘价的短期波动影响，是比较长期的指标。我个人认为，长期指标稳健比较好。即ROE&gt;0.1 而且Z指在（-1，1）之间的指数。 1.3.6 综合分析 - 流动性 + 风险 + 收益 前面已经单独对4个因子作了分析。他们分别代表了 流动性(日交易额规模)， 风险（市盈率和市净率） 收益（净资产回报） 现在，让我们试着把这四个因子综合起来看看。 mask_scale= checkday_summary[&quot;日交易额规模&quot;].isin([&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;]) print(&quot;满足流动性规模的指数有{0}只&quot;.format(mask_scale.sum())) risk_zscore= -1.4 #注 z值小于 -1 的 指数太少，故改设为-0.3 mask_risk= (checkday_summary[&quot;PE1_Z&quot;]&lt;0) &amp; (checkday_summary[&quot;PB1_Z&quot;]&lt;0)\ &amp;((checkday_summary[&quot;PE1_Z&quot;] + checkday_summary[&quot;PB1_Z&quot;]&lt;risk_zscore)) print(&quot;满足低风险要求的指数有{0}只&quot;.format(mask_risk.sum())) roe_score =[&quot;中&quot;,&quot;高&quot;] roe_zscore =[-2,2] mask_roe = checkday_summary[&quot;净资产回报率等级&quot;].isin(roe_score) &amp; checkday_summary[&quot;ROE_Z&quot;].between(roe_zscore[0],roe_zscore[-1]) print(&quot;满足收益率要求的指数有{0}只&quot;.format(mask_roe.sum())) mask_all = mask_scale &amp; mask_risk &amp; mask_roe result =checkday_summary[mask_all].drop_duplicates(subset=[&quot;secShortName&quot;]) print(&quot;满足高流动性，低风险，较好收益率要求的指数有{0}只&quot;.format(result.shape[0])) 满足流动性规模的指数有478只 满足低风险要求的指数有59只 满足收益率要求的指数有310只 满足高流动性，低风险，较好收益率要求的指数有24只 投资策略 def strategy_tickers_today(strategy=&quot;customize&quot;,scale_score =None,risk_zscore =None,roe_score =None): if strategy ==&quot;customize&quot;: scale_score =[&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;] scale_zscore=(-1,1) risk_zscore= -1.4 #注 z值小于 -1 的 指数太少，故改设为-0.3 roe_score =[&quot;中&quot;,&quot;高&quot;] roe_zscore =[-2,2] elif strategy ==&quot;ROE&quot;: scale_score =None risk_zscore= None roe_score =[&quot;高&quot;] elif strategy ==&quot;RISK&quot;: risk_zscore= -2 #PE &amp; PB Z值小于-2， 如果是 正态分布，这风险小于95% elif strategy ==&quot;TURNOVER&quot;: scale_score =[&quot;5000亿&quot;] scale_zscore=(-1,1) #交易规模过滤 if scale_score ==None: mask_scale =True else: mask_scale= (checkday_summary[&quot;日交易额规模&quot;].isin(scale_score)) \ &amp; ( checkday_summary[&#39;TurnoverValue_Z&#39;].between(scale_zscore[0],scale_zscore[-1])) #风险指标过滤 if risk_zscore ==None: mask_risk =True else: risk_zscore= -1.4 mask_risk= (checkday_summary[&quot;PE1_Z&quot;]&lt;0) &amp; (checkday_summary[&quot;PB1_Z&quot;]&lt;0)\ &amp;((checkday_summary[&quot;PE1_Z&quot;] + checkday_summary[&quot;PB1_Z&quot;]&lt;risk_zscore)) #投资回报率过滤 if roe_score ==None: mask_roe=True else: mask_roe = checkday_summary[&quot;净资产回报率等级&quot;].isin(roe_score) mask_all = mask_scale &amp; mask_risk &amp; mask_roe result =checkday_summary[mask_all].drop_duplicates(subset=[&quot;secShortName&quot;]) return result def show_tickers_color(tickers= None): if (tickers is None) or (tickers.shape[0]==0): print(&quot;Pls prepare the checkday_summary dataframe&quot;) return else: html =tickers[[&#39;secShortName&#39;,&#39;Close&#39;, &#39;PE1&#39;, &#39;PB1&#39;, &#39;ROE&#39;,&#39;Close_Z&#39;, &#39;PE1_Z&#39;, &#39;PB1_Z&#39;, &#39;ROE_Z&#39;,&#39;净资产回报率等级&#39;, &#39;日交易额规模&#39;]]\ .round(2).rename(columns=map_E2C).style.bar(subset=[&#39;Close_Z&#39;, &#39;PE1_Z&#39;, &#39;PB1_Z&#39;],\ align=&quot;zero&quot;, color=[ &#39;#5fba7d&#39;,&#39;#d65f5f&#39;,],width=100/2) return html 低风险策略 tmp = strategy_tickers_today(&quot;RISK&quot;) tmp[&quot;RISK&quot;] = tmp[&quot;PE1_Z&quot;] + tmp[&quot;PB1_Z&quot;]+tmp[&quot;Close_Z&quot;]*0.2 show_tickers_color(tmp.sort_values(by=[&quot;ROE&quot;],ascending=False).head(5)) 根据不同的Z值组合和因子组合，高收益策略或者高容量策略也很容易合成。 衡量市场，指数高低是一个难题! 价值投资者很难判断， 现在是高估，还是低估? 买的是便宜还是，贵了? 应该现在买/卖，还是再等等？ 针对这个问题，我在网上看到了一些量化的处理方法。例如：平均数法，中位数法，比例法等等。这种方法往往过于简单，只能衡量集中度。不能衡量离散度和概率。 也许统计方法中的标准差Z值法更加适合。既可以衡量某个指数的指标的集中度，还可以衡量离散度，和风险情况。尽管指数的数据也不是完美的正态分布，但Z值法依然存在较大参考意义。 我的观点: Z值越大，越高估。因为大数定理认为： Z&gt;1, Z&gt;2,意味着继续变大的可能性小于16%, 5%。Z值越小，越低估。 因为大数定理认为：Z&lt;-1, Z&lt;-2,意味着继续变小的可能性小于16%, 5% 综观550多只指数的历史数据。绝大部分指数的Z值都在-2，3之间。注：少数的能源，金属类指数曾经出现过短暂疯狂的。Z值法就不太适用。 我使用Python的Pandas 和 Matplotlib 等工具，加上一些渠道获得的指数数据（尤其是市盈率），发布热门指数Ｚ值表。 今天又结合了不可能三角形思路做了一些投资策略的基本探索。 主要目的是： 方便自己定投使用。知道何时开始定投，何时停止定投，何时止盈。（目前还没有止盈过） 结合统计学，熟悉Python的基本数据分析方法。 网上分享给愿意参考的人,交流和学习 文章来源：北大青鸟官网 阅读更多" />
<meta property="og:description" content="用Python做证券指数的三种策略分析 这两天恰好看到一本比较有趣的书，《FOF组合基金》。讲的是Fund of Fund,讲的是组合基金的理论，架构和实践。可以说是有既有理论高度，又有实践的策略。 其中有段话比较值得玩味。“可行集中包括无数个可供投资者选择的证券投资组合。投资者可通过有效集定理来找到最佳的投资组合。所谓最佳投资组合。。。。。满足两个条件： 1、相同风险下具有最大收益率的投资组合 2、同样收益率的水平下具有最小风险的投资组合 实践中还有另外一个很重要的因子，资金容量 所有人都在寻找高收益率，低风险，大容量的策略。但遗憾的是三者不可兼得。。。。共有8种类型的策略。其中比较有代表性的是相对价值策略，事件驱动策略，宏观因素策略。 上周股市大涨，本周股市大跌。那么，现在以2月1日的收盘数据来看，指数中有哪些符合中三种策略的指数？ 我尝试用Python和手中的数据做了一个简单基于Z值的分析，自我学习和分享讨论。 1 、相对价值策略。（低收益，低风险，高容量） 书中谈的相对价值策略主要是类固定收益（银行理财，货币基金，债卷，对冲套利等），代价是牺牲”收益率“，从而保证风险可控，和规模扩大。 书中谈的方法。基本上需要通过期货，期限套利，跨期套利，分级基金折价，溢价，ETF套利，可转债，波动率，期权等方式。也许这种方式就是雪球上 低风险投资的策略吧。 相对价值策略需要拥有广阔的知识面和大额的资金。而且2015年后，卷商的ETF交易系统接口已经关闭,ETF套利很难运行。未来发展有赖于接口系统重新开放。 既然那么复杂，我就把问题简单化。 1.容量： 设为 500亿以上~5000亿日交易额规模。（盘子必须要大，流动性要好） 2.风险： 设为该日市盈率和市净率为Z值之和最小的5个指数。（风险要低） 3.收益率： 无所谓，可以牺牲。 结果如下： 找到的这5个指数的净资产收益率较低（小于10%），相对风险释放比较多（市盈率和市净率的Z值都是历史中的非常低位置），（盘子比较大（超过500亿）。其中以中证1000为最甚。 不过这里的风险最小，只是指数自己和自己历史比较的Z值。Z值可以衡量相对风险。绝对风险，也许只有FOF组合基金中讲的对冲，和组合等策略才能做到。 2、宏观因素策略。（高收益，高风险，高容量） 以牺牲风险为代价。。。也称择时策略。。。做对，自然收益会搞；但是如果做错，则损失也会很大。。。总的来说可以分成两类：拐点择时和趋势择时。 注： 这种策略应该就是人们常说的”投机“。 这些策略是技术流。利用了SVM(支持向量机）挖掘历史模型，Hurst指数，情绪指数，噪声指数等或者是各种均线等。 技术流暂且不研究，我们可以先看看市场中那些是宏观因素策略指数。把问题简化为： 1.高收益：ROE(PB/PB) 等级为高（15%~21%)（收益率必须要高。注：这里的收益率是长期的） 2.高容量： 50亿~500亿日交易额 （盘子必须要大，流动性要好） 3.高风险：（风险无所谓，可以适当放宽） 结果如下： 消费，食品，饮料等净资产回报率很高在20%左右，但是相对价格，市盈率，市净率的Z值有的都已经超过了3，或者4. 当这些指数回归均值时，估计要“疑似银河落九天” 不过创业成长指数，近资产汇报率19%，但是PB,PE的Z值都非常地。日后好好研究，看看是否是一支被错杀的创业板指数。 3、事件驱动策略（低风险，高收益，资金容量比较小） 把问题简化为： 1.低风险：当市净率，市盈率Z值最低 2.高收益： ROE(PB/PB) 较高的5只指数（收益率必须要高。注：这里的收益率是长期的） 3.容量： 不设限制 他们分别是创业成长，新能源车，和文化类指数。 新能源车由于补贴政策的变化，不断的估值调整，下滑。 文化类指数，由于乐视这个老鼠屎，整个系列都在过去两年垫底。 不过创业成长指数净资产回报率非常高，却估值很低，风险释放充分。 代码在后面： 1、初始化环境 主要用到了Python numpy,Pandas, Scipy.stats, Matplotlib,还有seaborn 等包. 证券投资的机器学习预测，通常需要准备大量数据进行回测。 本文不包含预测和回测部分。 注：预测和回测也没用。看了FOF组合基金一书才知道，2015年卷商交易接口已经关闭。估计ETF高频套利也不能做了。 此处如果理解有误，还请高人指点。 import pandas as pd import numpy as np from scipy import stats import matplotlib.pyplot as plt import seaborn as sns %matplotlib inline !free -h # 以下代码是为了显示正文正常 import matplotlib as mpl import matplotlib.font_manager as font_manager path_eng = &#39;/usr/share/fonts/chinese/REFSAN.TTF&#39; path_CHN = &quot;/usr/share/fonts/chinese/simhei.ttf&quot; prop = font_manager.FontProperties(fname=path_CHN) #Set the microsoft sans serief as default font family. if show chinese test, set path_CHN instead. #prop.set_weight = &#39;light&#39; mpl.rcParams[&#39;font.family&#39;] = prop.get_name() Today = &quot;2018-02-01&quot; 数据概览 def view_data(): print(&quot;数据载入中...&quot;) sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) # sec_map 包含了约2800多个指数,实际指数约550只 history = pd.read_hdf(&quot;uqer/uq_history.h5&quot;,&quot;history&quot;) #hisotry 包含了从2004年到2017年11月16日的指数数据( 大约86万条数据). #history = history.sort_index(level=0) ntickers = history.index.levshape[0] nTradeDate =history.index.levshape[1]/250 nRecords = history.shape[0]/10**4 print(&quot;交易历史数据库包含了:\n\t{1:,.0f}万条日交易数据.\n\t{0}只指数，\n\t单只指数最长交易记录为{2:.1f}年.&quot;.format(ntickers,nRecords,nTradeDate)) print(&quot;\n注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。\n\n&quot;) print(&quot;历史交易数据：\n 特征列表：{0}&quot;.format(history.columns.tolist())) print(&quot;股指名称数据：\n 特征列表：{0}&quot;.format(sec_map.columns.tolist())) view_data() map_E2C = {&quot;ticker&quot;:&quot;指数代码&quot;,&quot;secShortName&quot;:&quot;指数名称&quot;, &#39;tradeDate&#39;:&quot;日期&quot;, &#39;Close&#39;:&quot;收盘价-Close&quot;, &#39;PB1&#39;:&quot;市净率-PB&quot;, &#39;PE1&#39;:&quot;市盈率-PE&quot;, &#39;TurnoverValue&#39;:&quot;成交额&quot;, &#39;TurnoverVol&#39;:&quot;成交量&quot;,&quot;ROE&quot;:&quot;净资产回报率-ROE&quot;} print(&quot;\n本文使用的特征为：{0}&quot;.format(list(map_E2C.values()))) 数据载入中... 交易历史数据库包含了: 91万条日交易数据. 550只指数， 单只指数最长交易记录为10.8年. 注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。 历史交易数据： 特征列表：[&#39;secID&#39;, &#39;Close&#39;, &#39;PB1&#39;, &#39;PB2&#39;, &#39;PE1&#39;, &#39;PE2&#39;, &#39;TurnoverValue&#39;, &#39;TurnoverVol&#39;] 股指名称数据： 特征列表：[&#39;baseDate&#39;, &#39;basePoint&#39;, &#39;endDate&#39;, &#39;indexType&#39;, &#39;indexTypeCD&#39;, &#39;porgFullName&#39;, &#39;pubOrgCD&#39;, &#39;publishDate&#39;, &#39;secID&#39;, &#39;secShortName&#39;] 本文使用的特征为：[&#39;指数代码&#39;, &#39;指数名称&#39;, &#39;日期&#39;, &#39;收盘价-Close&#39;, &#39;市净率-PB&#39;, &#39;市盈率-PE&#39;, &#39;成交额&#39;, &#39;成交量&#39;, &#39;净资产回报率-ROE&#39;] 特征工程 1.2.1 筛选有效数据 数据中存在缺失，故只筛选截至2018年1月25日有交易记录的数据。 历史交易数据过少，没有统计意义（暂定至少3年） def filter_history(): def ticker_filter(x): ntradedays_annual = 250 # 假设一年交易日为250天 nyear=3 # 假设至少需要3年数据 checkday=Today # Checkday是设定有效的交易日期。默认为Today, 全局变量 mask_years = x.shape[0]&gt;(ntradedays_annual*nyear) mask_checkday = x.index.isin([checkday],level=&quot;tradeDate&quot;).any() mask = mask_years &amp; mask_checkday return mask history = pd.read_hdf(&quot;uqer/uq_history.h5&quot;,&quot;history&quot;) #hisotry 包含了从2004年到2017年11月16日的指数数据( 大约86万条数据). history= history.loc(axis=0)[:,:Today] history_filtered= history.groupby(level=0).filter(ticker_filter) ntickers = len(history_filtered.groupby(level=0).groups) print(&quot;{0}只指数交易时间超过了3年 且在{1}日有交易记录&quot;.format(ntickers,Today)) return history_filtered history =filter_history() 483只指数交易时间超过了3年 且在2018-02-01日有交易记录 1.2.2 添加ROE（净资产回报率）特征 history[&quot;ROE&quot;] = history[&quot;PB1&quot;]/history[&quot;PE1&quot;] 1.2.3 特征提取 交易日最新数据汇总。 取指定交易日因子数据 净资产回报率特征。 取一年的数据平均值，然后按回报率分成4个级别。级别(超低，低，中，高） 交易额规模特征。取一年的数据平均值，然后按日平均交易额分成4个级别（小于5亿，小于50亿，小于500亿，小于5000亿） Z值（各个指标的标准差倍数）。 针对所有历史数据，计算Zscore(标准差倍数）。 def Check_summary(): def lastz(x): freedom = 1 # it is sample, so the sample std degree of freedome should not be 0 but 1 Arry=x.values zscore = stats.zmap(Arry[-1],Arry,ddof=freedom) return zscore def recent_mean(x): mean = x.tail(250).sum()/250 return mean grp = history.groupby(level=0) grp_last = grp.agg({&quot;Close&quot;:&quot;last&quot;,&quot;PE1&quot;:&quot;last&quot;,&quot;PB1&quot;:&quot;last&quot;,&quot;ROE&quot;:&quot;last&quot;,&quot;TurnoverValue&quot;:&quot;last&quot;}) grp_last[&quot;TurnoverValue&quot;] =grp_last[&quot;TurnoverValue&quot;] grp_rank = grp.agg({&quot;ROE&quot;:recent_mean,&quot;TurnoverValue&quot;:recent_mean}) grp_z = grp.agg({&quot;Close&quot;:lastz,&quot;PE1&quot;:lastz,&quot;PB1&quot;:lastz,&quot;ROE&quot;:lastz,&quot;TurnoverValue&quot;:lastz}) ROE_rank = pd.cut(grp_rank.ROE,bins=4,labels=[&quot;超低&quot;,&quot;低&quot;,&quot;中&quot;,&quot;高&quot;]) TV_rank = pd.cut(grp_rank.TurnoverValue,bins=5*np.logspace(7,11,5),labels=[&quot;5亿&quot;,&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;]) ROE_rank.name = &quot;净资产回报率等级&quot; TV_rank.name =&quot;日交易额规模&quot; sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) # sec_map 包含了约2800多个指数,实际指数约550只{} #decimals = pd.Series([1,1,1,2,1 ], index=[&quot;Close&quot;,&quot;PE1&quot;,&quot;PB1&quot;,&quot;ROE&quot;,&quot;TurnoverValue&quot;]) combined = sec_map[[&quot;secShortName&quot;]].join(grp_last,how=&quot;right&quot;).join(ROE_rank,rsuffix=&quot;_R&quot;).join(TV_rank,rsuffix=&quot;_R&quot;) combined = combined.join(grp_z,rsuffix=&quot;_Z&quot;) return combined checkday_summary = Check_summary() checkday_summary.columns Index([&#39;secShortName&#39;, &#39;Close&#39;, &#39;PE1&#39;, &#39;PB1&#39;, &#39;ROE&#39;, &#39;TurnoverValue&#39;, &#39;净资产回报率等级&#39;, &#39;日交易额规模&#39;, &#39;CloseZ&#39;, &#39;PE1Z&#39;, &#39;PB1Z&#39;, &#39;ROEZ&#39;, &#39;TurnoverValue_Z&#39;], dtype=&#39;object&#39;) 1.3 数据探索 1.3.1 不同日交易额的指数群中指数的数量 tmp=sns.countplot(&#39;日交易额规模&#39;,data=checkday_summary) checkday_summary.groupby(by=&quot;日交易额规模&quot;)[[&quot;ROE&quot;]].mean().rename(columns={&quot;ROE&quot;:&quot;平均净资产回报率&quot;}) 1.3.2 收盘价（Close) col=&quot;Close&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 指定日收盘价汇总箱形图 展现不同指数的收盘价差异： 左图是绝对值：不同规模的指数在该日收盘价价值不同。 右图是相对值：用Z值（即几个标准差）来衡量不同规模指数群的收盘价和各指数自己历史相比的差异。（500亿规模的指数收盘价差异比较大，Z指在4和-1之间。 从右图可以看出， 除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在1附近。 各个日交易规模的指数群都有些Z值在（-1，1）之外的指数，这中间也许存在机会和风险。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 注：考虑到通货膨胀和指数内股票的增长，通常指数收盘价会出现Z值小于-1的情况。收盘价Z值&gt;1甚至大于2都是比较常见的情况。 1.3.3 市盈率（PE1) col=&quot;PE1&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 指定日市盈率汇总箱形图 展现不同指数的市盈率差异： 左图是绝对值：不同规模的指数在该日市盈率估值不同。 注：由于市盈率计算方法不一样，例如：加权，等权，算术平均等模式。故不同数据源的市盈率，市净率差异比较大。指数官网的市盈率和市净率比较权威。不过使用费用比较高。本文使用的是免费数据。因此可以看出这一天5亿规模指数群中有一个指数的市盈率小于-150倍。这是明显错误的。需要过滤掉。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市盈率和各自历史相比差异。 由于Z值计算是用全部历史数据来计算，故历史上的错误数据（如果数量不大的话，例如小于1%），对整理影响不大。只要将异常点过滤即可。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市盈率存在低估？ def show_min_PE_Z(): col=&quot;PE1&quot; def get_max(x): colz= col+&quot;_Z&quot; index =x[colz].idxmax() return x.loc[index][[&quot;secShortName&quot;,col,colz]] def get_min(x): colz= col+&quot;_Z&quot; index =x[colz].idxmin() return x.loc[index][[&quot;secShortName&quot;,col,colz]] print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_max).round(1)) print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_min).round(1)) show_min_PE_Z() 如上表中，所展示， 低估指数： Z值小于-1。 例如：中证1000(000852)，新能源车（399417），文化指数分别是日交易规模（大盘，中盘，小盘）中Z值最低的指数。 高估指数：Z值大于2。 例如： 中经GDP,央视50（399550），水电指数分别是日交易规模（大盘，中盘，小盘）中Z值最高的指数。 如果这些指数的历史分布是正态， 那么根据经验法则，就存在较大的机会（针对低估）和风险（针对高估） 接下来，看看500亿日交易额规模指数群中新能源车和央视50这两个比较常见的指数历史数据的市盈率的波动。 tickers=[&quot;399417&quot;,&quot;399550&quot;] sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) for ticker in tickers: print(&quot;{0} base day is {1}&quot;.format(ticker,sec_map.loc[ticker].baseDate)) fig,ax = plt.subplots(1,2,figsize=(6,3)) fig.suptitle(ticker) PE1 = history.loc[ticker][&quot;PE1&quot;] PE1_Z = history.loc[ticker][[&quot;PE1&quot;]].apply(stats.zscore) PE1.plot(ax=ax[0]) sns.distplot(PE1_Z,ax=ax[1],vertical=True) 从上图可以看出，2018年2月1日的市盈率图 新能源市盈率为22倍，绝对值不算高。但是Z指接近-1.5，相对值比较低，未来有很大的机会。 央视50市盈率为13倍，绝对值比较低。但是Z值接近4，相对值极度高，未来存在回归历史均值的风险 1.3.4 市净率 （PB1) col=&quot;PB1&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 与市盈率数据类似 指定日市净率汇总箱形图 展现不同指数的市净率差异： 左图是绝对值：不同规模的指数在该日市净率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市净率和各自历史相比差异。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市净率存在低估计算机学校？ def show_min_PB_Z(): col=&quot;PB1&quot; def get_max(x): colz= col+&quot;_Z&quot; index =x[colz].idxmax() return x.loc[index][[&quot;secShortName&quot;,col,colz]] def get_min(x): colz= col+&quot;_Z&quot; index =x[colz].idxmin() return x.loc[index][[&quot;secShortName&quot;,col,colz]] print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_max).round(1)) print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_min).round(1)) show_min_PB_Z() 从上图可以看出，2018年2月1日的市盈率图 新能源车市盈率为2.7倍，绝对值不算高。而且Z指接近-1.5，相对值比较低，未来有很大的机会。 国证食品市盈率为6.7倍，绝对值非常高。而且Z值接近3.2，相对值极度高，未来存在回归历史均值（3年历史）的风险。 注：由于国证食品指数在2004年就成立，缺少之前近十年历史数据。无法完全确定是否高估 1.3.5 净资产回报率（ROE） col=&quot;ROE&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 与市盈率数据类似 指定日净资产回报率汇总箱形图 展现不同指数的净资产回报率差异： 左图是绝对值：不同规模的指数在该日净资产回报率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的净资产回报率和各自历史相比差异。 和市盈率与市净率不同，净资产回报率（ROE=PB/PE= profit/equity)排除了收盘价的短期波动影响，是比较长期的指标。我个人认为，长期指标稳健比较好。即ROE&gt;0.1 而且Z指在（-1，1）之间的指数。 1.3.6 综合分析 - 流动性 + 风险 + 收益 前面已经单独对4个因子作了分析。他们分别代表了 流动性(日交易额规模)， 风险（市盈率和市净率） 收益（净资产回报） 现在，让我们试着把这四个因子综合起来看看。 mask_scale= checkday_summary[&quot;日交易额规模&quot;].isin([&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;]) print(&quot;满足流动性规模的指数有{0}只&quot;.format(mask_scale.sum())) risk_zscore= -1.4 #注 z值小于 -1 的 指数太少，故改设为-0.3 mask_risk= (checkday_summary[&quot;PE1_Z&quot;]&lt;0) &amp; (checkday_summary[&quot;PB1_Z&quot;]&lt;0)\ &amp;((checkday_summary[&quot;PE1_Z&quot;] + checkday_summary[&quot;PB1_Z&quot;]&lt;risk_zscore)) print(&quot;满足低风险要求的指数有{0}只&quot;.format(mask_risk.sum())) roe_score =[&quot;中&quot;,&quot;高&quot;] roe_zscore =[-2,2] mask_roe = checkday_summary[&quot;净资产回报率等级&quot;].isin(roe_score) &amp; checkday_summary[&quot;ROE_Z&quot;].between(roe_zscore[0],roe_zscore[-1]) print(&quot;满足收益率要求的指数有{0}只&quot;.format(mask_roe.sum())) mask_all = mask_scale &amp; mask_risk &amp; mask_roe result =checkday_summary[mask_all].drop_duplicates(subset=[&quot;secShortName&quot;]) print(&quot;满足高流动性，低风险，较好收益率要求的指数有{0}只&quot;.format(result.shape[0])) 满足流动性规模的指数有478只 满足低风险要求的指数有59只 满足收益率要求的指数有310只 满足高流动性，低风险，较好收益率要求的指数有24只 投资策略 def strategy_tickers_today(strategy=&quot;customize&quot;,scale_score =None,risk_zscore =None,roe_score =None): if strategy ==&quot;customize&quot;: scale_score =[&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;] scale_zscore=(-1,1) risk_zscore= -1.4 #注 z值小于 -1 的 指数太少，故改设为-0.3 roe_score =[&quot;中&quot;,&quot;高&quot;] roe_zscore =[-2,2] elif strategy ==&quot;ROE&quot;: scale_score =None risk_zscore= None roe_score =[&quot;高&quot;] elif strategy ==&quot;RISK&quot;: risk_zscore= -2 #PE &amp; PB Z值小于-2， 如果是 正态分布，这风险小于95% elif strategy ==&quot;TURNOVER&quot;: scale_score =[&quot;5000亿&quot;] scale_zscore=(-1,1) #交易规模过滤 if scale_score ==None: mask_scale =True else: mask_scale= (checkday_summary[&quot;日交易额规模&quot;].isin(scale_score)) \ &amp; ( checkday_summary[&#39;TurnoverValue_Z&#39;].between(scale_zscore[0],scale_zscore[-1])) #风险指标过滤 if risk_zscore ==None: mask_risk =True else: risk_zscore= -1.4 mask_risk= (checkday_summary[&quot;PE1_Z&quot;]&lt;0) &amp; (checkday_summary[&quot;PB1_Z&quot;]&lt;0)\ &amp;((checkday_summary[&quot;PE1_Z&quot;] + checkday_summary[&quot;PB1_Z&quot;]&lt;risk_zscore)) #投资回报率过滤 if roe_score ==None: mask_roe=True else: mask_roe = checkday_summary[&quot;净资产回报率等级&quot;].isin(roe_score) mask_all = mask_scale &amp; mask_risk &amp; mask_roe result =checkday_summary[mask_all].drop_duplicates(subset=[&quot;secShortName&quot;]) return result def show_tickers_color(tickers= None): if (tickers is None) or (tickers.shape[0]==0): print(&quot;Pls prepare the checkday_summary dataframe&quot;) return else: html =tickers[[&#39;secShortName&#39;,&#39;Close&#39;, &#39;PE1&#39;, &#39;PB1&#39;, &#39;ROE&#39;,&#39;Close_Z&#39;, &#39;PE1_Z&#39;, &#39;PB1_Z&#39;, &#39;ROE_Z&#39;,&#39;净资产回报率等级&#39;, &#39;日交易额规模&#39;]]\ .round(2).rename(columns=map_E2C).style.bar(subset=[&#39;Close_Z&#39;, &#39;PE1_Z&#39;, &#39;PB1_Z&#39;],\ align=&quot;zero&quot;, color=[ &#39;#5fba7d&#39;,&#39;#d65f5f&#39;,],width=100/2) return html 低风险策略 tmp = strategy_tickers_today(&quot;RISK&quot;) tmp[&quot;RISK&quot;] = tmp[&quot;PE1_Z&quot;] + tmp[&quot;PB1_Z&quot;]+tmp[&quot;Close_Z&quot;]*0.2 show_tickers_color(tmp.sort_values(by=[&quot;ROE&quot;],ascending=False).head(5)) 根据不同的Z值组合和因子组合，高收益策略或者高容量策略也很容易合成。 衡量市场，指数高低是一个难题! 价值投资者很难判断， 现在是高估，还是低估? 买的是便宜还是，贵了? 应该现在买/卖，还是再等等？ 针对这个问题，我在网上看到了一些量化的处理方法。例如：平均数法，中位数法，比例法等等。这种方法往往过于简单，只能衡量集中度。不能衡量离散度和概率。 也许统计方法中的标准差Z值法更加适合。既可以衡量某个指数的指标的集中度，还可以衡量离散度，和风险情况。尽管指数的数据也不是完美的正态分布，但Z值法依然存在较大参考意义。 我的观点: Z值越大，越高估。因为大数定理认为： Z&gt;1, Z&gt;2,意味着继续变大的可能性小于16%, 5%。Z值越小，越低估。 因为大数定理认为：Z&lt;-1, Z&lt;-2,意味着继续变小的可能性小于16%, 5% 综观550多只指数的历史数据。绝大部分指数的Z值都在-2，3之间。注：少数的能源，金属类指数曾经出现过短暂疯狂的。Z值法就不太适用。 我使用Python的Pandas 和 Matplotlib 等工具，加上一些渠道获得的指数数据（尤其是市盈率），发布热门指数Ｚ值表。 今天又结合了不可能三角形思路做了一些投资策略的基本探索。 主要目的是： 方便自己定投使用。知道何时开始定投，何时停止定投，何时止盈。（目前还没有止盈过） 结合统计学，熟悉Python的基本数据分析方法。 网上分享给愿意参考的人,交流和学习 文章来源：北大青鸟官网 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/07/de17c1676b8cec8275efb4788dd469c1.html" />
<meta property="og:url" content="https://mlh.app/2018/03/07/de17c1676b8cec8275efb4788dd469c1.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-07T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"用Python做证券指数的三种策略分析 这两天恰好看到一本比较有趣的书，《FOF组合基金》。讲的是Fund of Fund,讲的是组合基金的理论，架构和实践。可以说是有既有理论高度，又有实践的策略。 其中有段话比较值得玩味。“可行集中包括无数个可供投资者选择的证券投资组合。投资者可通过有效集定理来找到最佳的投资组合。所谓最佳投资组合。。。。。满足两个条件： 1、相同风险下具有最大收益率的投资组合 2、同样收益率的水平下具有最小风险的投资组合 实践中还有另外一个很重要的因子，资金容量 所有人都在寻找高收益率，低风险，大容量的策略。但遗憾的是三者不可兼得。。。。共有8种类型的策略。其中比较有代表性的是相对价值策略，事件驱动策略，宏观因素策略。 上周股市大涨，本周股市大跌。那么，现在以2月1日的收盘数据来看，指数中有哪些符合中三种策略的指数？ 我尝试用Python和手中的数据做了一个简单基于Z值的分析，自我学习和分享讨论。 1 、相对价值策略。（低收益，低风险，高容量） 书中谈的相对价值策略主要是类固定收益（银行理财，货币基金，债卷，对冲套利等），代价是牺牲”收益率“，从而保证风险可控，和规模扩大。 书中谈的方法。基本上需要通过期货，期限套利，跨期套利，分级基金折价，溢价，ETF套利，可转债，波动率，期权等方式。也许这种方式就是雪球上 低风险投资的策略吧。 相对价值策略需要拥有广阔的知识面和大额的资金。而且2015年后，卷商的ETF交易系统接口已经关闭,ETF套利很难运行。未来发展有赖于接口系统重新开放。 既然那么复杂，我就把问题简单化。 1.容量： 设为 500亿以上~5000亿日交易额规模。（盘子必须要大，流动性要好） 2.风险： 设为该日市盈率和市净率为Z值之和最小的5个指数。（风险要低） 3.收益率： 无所谓，可以牺牲。 结果如下： 找到的这5个指数的净资产收益率较低（小于10%），相对风险释放比较多（市盈率和市净率的Z值都是历史中的非常低位置），（盘子比较大（超过500亿）。其中以中证1000为最甚。 不过这里的风险最小，只是指数自己和自己历史比较的Z值。Z值可以衡量相对风险。绝对风险，也许只有FOF组合基金中讲的对冲，和组合等策略才能做到。 2、宏观因素策略。（高收益，高风险，高容量） 以牺牲风险为代价。。。也称择时策略。。。做对，自然收益会搞；但是如果做错，则损失也会很大。。。总的来说可以分成两类：拐点择时和趋势择时。 注： 这种策略应该就是人们常说的”投机“。 这些策略是技术流。利用了SVM(支持向量机）挖掘历史模型，Hurst指数，情绪指数，噪声指数等或者是各种均线等。 技术流暂且不研究，我们可以先看看市场中那些是宏观因素策略指数。把问题简化为： 1.高收益：ROE(PB/PB) 等级为高（15%~21%)（收益率必须要高。注：这里的收益率是长期的） 2.高容量： 50亿~500亿日交易额 （盘子必须要大，流动性要好） 3.高风险：（风险无所谓，可以适当放宽） 结果如下： 消费，食品，饮料等净资产回报率很高在20%左右，但是相对价格，市盈率，市净率的Z值有的都已经超过了3，或者4. 当这些指数回归均值时，估计要“疑似银河落九天” 不过创业成长指数，近资产汇报率19%，但是PB,PE的Z值都非常地。日后好好研究，看看是否是一支被错杀的创业板指数。 3、事件驱动策略（低风险，高收益，资金容量比较小） 把问题简化为： 1.低风险：当市净率，市盈率Z值最低 2.高收益： ROE(PB/PB) 较高的5只指数（收益率必须要高。注：这里的收益率是长期的） 3.容量： 不设限制 他们分别是创业成长，新能源车，和文化类指数。 新能源车由于补贴政策的变化，不断的估值调整，下滑。 文化类指数，由于乐视这个老鼠屎，整个系列都在过去两年垫底。 不过创业成长指数净资产回报率非常高，却估值很低，风险释放充分。 代码在后面： 1、初始化环境 主要用到了Python numpy,Pandas, Scipy.stats, Matplotlib,还有seaborn 等包. 证券投资的机器学习预测，通常需要准备大量数据进行回测。 本文不包含预测和回测部分。 注：预测和回测也没用。看了FOF组合基金一书才知道，2015年卷商交易接口已经关闭。估计ETF高频套利也不能做了。 此处如果理解有误，还请高人指点。 import pandas as pd import numpy as np from scipy import stats import matplotlib.pyplot as plt import seaborn as sns %matplotlib inline !free -h # 以下代码是为了显示正文正常 import matplotlib as mpl import matplotlib.font_manager as font_manager path_eng = &#39;/usr/share/fonts/chinese/REFSAN.TTF&#39; path_CHN = &quot;/usr/share/fonts/chinese/simhei.ttf&quot; prop = font_manager.FontProperties(fname=path_CHN) #Set the microsoft sans serief as default font family. if show chinese test, set path_CHN instead. #prop.set_weight = &#39;light&#39; mpl.rcParams[&#39;font.family&#39;] = prop.get_name() Today = &quot;2018-02-01&quot; 数据概览 def view_data(): print(&quot;数据载入中...&quot;) sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) # sec_map 包含了约2800多个指数,实际指数约550只 history = pd.read_hdf(&quot;uqer/uq_history.h5&quot;,&quot;history&quot;) #hisotry 包含了从2004年到2017年11月16日的指数数据( 大约86万条数据). #history = history.sort_index(level=0) ntickers = history.index.levshape[0] nTradeDate =history.index.levshape[1]/250 nRecords = history.shape[0]/10**4 print(&quot;交易历史数据库包含了:\\n\\t{1:,.0f}万条日交易数据.\\n\\t{0}只指数，\\n\\t单只指数最长交易记录为{2:.1f}年.&quot;.format(ntickers,nRecords,nTradeDate)) print(&quot;\\n注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。\\n\\n&quot;) print(&quot;历史交易数据：\\n 特征列表：{0}&quot;.format(history.columns.tolist())) print(&quot;股指名称数据：\\n 特征列表：{0}&quot;.format(sec_map.columns.tolist())) view_data() map_E2C = {&quot;ticker&quot;:&quot;指数代码&quot;,&quot;secShortName&quot;:&quot;指数名称&quot;, &#39;tradeDate&#39;:&quot;日期&quot;, &#39;Close&#39;:&quot;收盘价-Close&quot;, &#39;PB1&#39;:&quot;市净率-PB&quot;, &#39;PE1&#39;:&quot;市盈率-PE&quot;, &#39;TurnoverValue&#39;:&quot;成交额&quot;, &#39;TurnoverVol&#39;:&quot;成交量&quot;,&quot;ROE&quot;:&quot;净资产回报率-ROE&quot;} print(&quot;\\n本文使用的特征为：{0}&quot;.format(list(map_E2C.values()))) 数据载入中... 交易历史数据库包含了: 91万条日交易数据. 550只指数， 单只指数最长交易记录为10.8年. 注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。 历史交易数据： 特征列表：[&#39;secID&#39;, &#39;Close&#39;, &#39;PB1&#39;, &#39;PB2&#39;, &#39;PE1&#39;, &#39;PE2&#39;, &#39;TurnoverValue&#39;, &#39;TurnoverVol&#39;] 股指名称数据： 特征列表：[&#39;baseDate&#39;, &#39;basePoint&#39;, &#39;endDate&#39;, &#39;indexType&#39;, &#39;indexTypeCD&#39;, &#39;porgFullName&#39;, &#39;pubOrgCD&#39;, &#39;publishDate&#39;, &#39;secID&#39;, &#39;secShortName&#39;] 本文使用的特征为：[&#39;指数代码&#39;, &#39;指数名称&#39;, &#39;日期&#39;, &#39;收盘价-Close&#39;, &#39;市净率-PB&#39;, &#39;市盈率-PE&#39;, &#39;成交额&#39;, &#39;成交量&#39;, &#39;净资产回报率-ROE&#39;] 特征工程 1.2.1 筛选有效数据 数据中存在缺失，故只筛选截至2018年1月25日有交易记录的数据。 历史交易数据过少，没有统计意义（暂定至少3年） def filter_history(): def ticker_filter(x): ntradedays_annual = 250 # 假设一年交易日为250天 nyear=3 # 假设至少需要3年数据 checkday=Today # Checkday是设定有效的交易日期。默认为Today, 全局变量 mask_years = x.shape[0]&gt;(ntradedays_annual*nyear) mask_checkday = x.index.isin([checkday],level=&quot;tradeDate&quot;).any() mask = mask_years &amp; mask_checkday return mask history = pd.read_hdf(&quot;uqer/uq_history.h5&quot;,&quot;history&quot;) #hisotry 包含了从2004年到2017年11月16日的指数数据( 大约86万条数据). history= history.loc(axis=0)[:,:Today] history_filtered= history.groupby(level=0).filter(ticker_filter) ntickers = len(history_filtered.groupby(level=0).groups) print(&quot;{0}只指数交易时间超过了3年 且在{1}日有交易记录&quot;.format(ntickers,Today)) return history_filtered history =filter_history() 483只指数交易时间超过了3年 且在2018-02-01日有交易记录 1.2.2 添加ROE（净资产回报率）特征 history[&quot;ROE&quot;] = history[&quot;PB1&quot;]/history[&quot;PE1&quot;] 1.2.3 特征提取 交易日最新数据汇总。 取指定交易日因子数据 净资产回报率特征。 取一年的数据平均值，然后按回报率分成4个级别。级别(超低，低，中，高） 交易额规模特征。取一年的数据平均值，然后按日平均交易额分成4个级别（小于5亿，小于50亿，小于500亿，小于5000亿） Z值（各个指标的标准差倍数）。 针对所有历史数据，计算Zscore(标准差倍数）。 def Check_summary(): def lastz(x): freedom = 1 # it is sample, so the sample std degree of freedome should not be 0 but 1 Arry=x.values zscore = stats.zmap(Arry[-1],Arry,ddof=freedom) return zscore def recent_mean(x): mean = x.tail(250).sum()/250 return mean grp = history.groupby(level=0) grp_last = grp.agg({&quot;Close&quot;:&quot;last&quot;,&quot;PE1&quot;:&quot;last&quot;,&quot;PB1&quot;:&quot;last&quot;,&quot;ROE&quot;:&quot;last&quot;,&quot;TurnoverValue&quot;:&quot;last&quot;}) grp_last[&quot;TurnoverValue&quot;] =grp_last[&quot;TurnoverValue&quot;] grp_rank = grp.agg({&quot;ROE&quot;:recent_mean,&quot;TurnoverValue&quot;:recent_mean}) grp_z = grp.agg({&quot;Close&quot;:lastz,&quot;PE1&quot;:lastz,&quot;PB1&quot;:lastz,&quot;ROE&quot;:lastz,&quot;TurnoverValue&quot;:lastz}) ROE_rank = pd.cut(grp_rank.ROE,bins=4,labels=[&quot;超低&quot;,&quot;低&quot;,&quot;中&quot;,&quot;高&quot;]) TV_rank = pd.cut(grp_rank.TurnoverValue,bins=5*np.logspace(7,11,5),labels=[&quot;5亿&quot;,&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;]) ROE_rank.name = &quot;净资产回报率等级&quot; TV_rank.name =&quot;日交易额规模&quot; sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) # sec_map 包含了约2800多个指数,实际指数约550只{} #decimals = pd.Series([1,1,1,2,1 ], index=[&quot;Close&quot;,&quot;PE1&quot;,&quot;PB1&quot;,&quot;ROE&quot;,&quot;TurnoverValue&quot;]) combined = sec_map[[&quot;secShortName&quot;]].join(grp_last,how=&quot;right&quot;).join(ROE_rank,rsuffix=&quot;_R&quot;).join(TV_rank,rsuffix=&quot;_R&quot;) combined = combined.join(grp_z,rsuffix=&quot;_Z&quot;) return combined checkday_summary = Check_summary() checkday_summary.columns Index([&#39;secShortName&#39;, &#39;Close&#39;, &#39;PE1&#39;, &#39;PB1&#39;, &#39;ROE&#39;, &#39;TurnoverValue&#39;, &#39;净资产回报率等级&#39;, &#39;日交易额规模&#39;, &#39;CloseZ&#39;, &#39;PE1Z&#39;, &#39;PB1Z&#39;, &#39;ROEZ&#39;, &#39;TurnoverValue_Z&#39;], dtype=&#39;object&#39;) 1.3 数据探索 1.3.1 不同日交易额的指数群中指数的数量 tmp=sns.countplot(&#39;日交易额规模&#39;,data=checkday_summary) checkday_summary.groupby(by=&quot;日交易额规模&quot;)[[&quot;ROE&quot;]].mean().rename(columns={&quot;ROE&quot;:&quot;平均净资产回报率&quot;}) 1.3.2 收盘价（Close) col=&quot;Close&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 指定日收盘价汇总箱形图 展现不同指数的收盘价差异： 左图是绝对值：不同规模的指数在该日收盘价价值不同。 右图是相对值：用Z值（即几个标准差）来衡量不同规模指数群的收盘价和各指数自己历史相比的差异。（500亿规模的指数收盘价差异比较大，Z指在4和-1之间。 从右图可以看出， 除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在1附近。 各个日交易规模的指数群都有些Z值在（-1，1）之外的指数，这中间也许存在机会和风险。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 注：考虑到通货膨胀和指数内股票的增长，通常指数收盘价会出现Z值小于-1的情况。收盘价Z值&gt;1甚至大于2都是比较常见的情况。 1.3.3 市盈率（PE1) col=&quot;PE1&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 指定日市盈率汇总箱形图 展现不同指数的市盈率差异： 左图是绝对值：不同规模的指数在该日市盈率估值不同。 注：由于市盈率计算方法不一样，例如：加权，等权，算术平均等模式。故不同数据源的市盈率，市净率差异比较大。指数官网的市盈率和市净率比较权威。不过使用费用比较高。本文使用的是免费数据。因此可以看出这一天5亿规模指数群中有一个指数的市盈率小于-150倍。这是明显错误的。需要过滤掉。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市盈率和各自历史相比差异。 由于Z值计算是用全部历史数据来计算，故历史上的错误数据（如果数量不大的话，例如小于1%），对整理影响不大。只要将异常点过滤即可。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市盈率存在低估？ def show_min_PE_Z(): col=&quot;PE1&quot; def get_max(x): colz= col+&quot;_Z&quot; index =x[colz].idxmax() return x.loc[index][[&quot;secShortName&quot;,col,colz]] def get_min(x): colz= col+&quot;_Z&quot; index =x[colz].idxmin() return x.loc[index][[&quot;secShortName&quot;,col,colz]] print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_max).round(1)) print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_min).round(1)) show_min_PE_Z() 如上表中，所展示， 低估指数： Z值小于-1。 例如：中证1000(000852)，新能源车（399417），文化指数分别是日交易规模（大盘，中盘，小盘）中Z值最低的指数。 高估指数：Z值大于2。 例如： 中经GDP,央视50（399550），水电指数分别是日交易规模（大盘，中盘，小盘）中Z值最高的指数。 如果这些指数的历史分布是正态， 那么根据经验法则，就存在较大的机会（针对低估）和风险（针对高估） 接下来，看看500亿日交易额规模指数群中新能源车和央视50这两个比较常见的指数历史数据的市盈率的波动。 tickers=[&quot;399417&quot;,&quot;399550&quot;] sec_map = pd.read_hdf(&quot;uqer/sec_map.h5&quot;,&quot;map&quot;) for ticker in tickers: print(&quot;{0} base day is {1}&quot;.format(ticker,sec_map.loc[ticker].baseDate)) fig,ax = plt.subplots(1,2,figsize=(6,3)) fig.suptitle(ticker) PE1 = history.loc[ticker][&quot;PE1&quot;] PE1_Z = history.loc[ticker][[&quot;PE1&quot;]].apply(stats.zscore) PE1.plot(ax=ax[0]) sns.distplot(PE1_Z,ax=ax[1],vertical=True) 从上图可以看出，2018年2月1日的市盈率图 新能源市盈率为22倍，绝对值不算高。但是Z指接近-1.5，相对值比较低，未来有很大的机会。 央视50市盈率为13倍，绝对值比较低。但是Z值接近4，相对值极度高，未来存在回归历史均值的风险 1.3.4 市净率 （PB1) col=&quot;PB1&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 与市盈率数据类似 指定日市净率汇总箱形图 展现不同指数的市净率差异： 左图是绝对值：不同规模的指数在该日市净率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市净率和各自历史相比差异。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市净率存在低估计算机学校？ def show_min_PB_Z(): col=&quot;PB1&quot; def get_max(x): colz= col+&quot;_Z&quot; index =x[colz].idxmax() return x.loc[index][[&quot;secShortName&quot;,col,colz]] def get_min(x): colz= col+&quot;_Z&quot; index =x[colz].idxmin() return x.loc[index][[&quot;secShortName&quot;,col,colz]] print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_max).round(1)) print(checkday_summary.groupby(&quot;日交易额规模&quot;).apply(get_min).round(1)) show_min_PB_Z() 从上图可以看出，2018年2月1日的市盈率图 新能源车市盈率为2.7倍，绝对值不算高。而且Z指接近-1.5，相对值比较低，未来有很大的机会。 国证食品市盈率为6.7倍，绝对值非常高。而且Z值接近3.2，相对值极度高，未来存在回归历史均值（3年历史）的风险。 注：由于国证食品指数在2004年就成立，缺少之前近十年历史数据。无法完全确定是否高估 1.3.5 净资产回报率（ROE） col=&quot;ROE&quot; fig,ax = plt.subplots(1,2,figsize=(10,5)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col,ax=ax[0],data=checkday_summary) ax[0].set_title(&quot;不同规模指数 - {0}({1})箱体图&quot;.format(map_E2C[col],col)) sns.boxplot(x=&#39;日交易额规模&#39;,y=col+&quot;_Z&quot;,ax=ax[1],data=checkday_summary) ax[1].set_title(&quot;不同规模指数 - {0}({1})-Z值 箱体图&quot;.format(map_E2C[col],col)) 与市盈率数据类似 指定日净资产回报率汇总箱形图 展现不同指数的净资产回报率差异： 左图是绝对值：不同规模的指数在该日净资产回报率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的净资产回报率和各自历史相比差异。 和市盈率与市净率不同，净资产回报率（ROE=PB/PE= profit/equity)排除了收盘价的短期波动影响，是比较长期的指标。我个人认为，长期指标稳健比较好。即ROE&gt;0.1 而且Z指在（-1，1）之间的指数。 1.3.6 综合分析 - 流动性 + 风险 + 收益 前面已经单独对4个因子作了分析。他们分别代表了 流动性(日交易额规模)， 风险（市盈率和市净率） 收益（净资产回报） 现在，让我们试着把这四个因子综合起来看看。 mask_scale= checkday_summary[&quot;日交易额规模&quot;].isin([&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;]) print(&quot;满足流动性规模的指数有{0}只&quot;.format(mask_scale.sum())) risk_zscore= -1.4 #注 z值小于 -1 的 指数太少，故改设为-0.3 mask_risk= (checkday_summary[&quot;PE1_Z&quot;]&lt;0) &amp; (checkday_summary[&quot;PB1_Z&quot;]&lt;0)\\ &amp;((checkday_summary[&quot;PE1_Z&quot;] + checkday_summary[&quot;PB1_Z&quot;]&lt;risk_zscore)) print(&quot;满足低风险要求的指数有{0}只&quot;.format(mask_risk.sum())) roe_score =[&quot;中&quot;,&quot;高&quot;] roe_zscore =[-2,2] mask_roe = checkday_summary[&quot;净资产回报率等级&quot;].isin(roe_score) &amp; checkday_summary[&quot;ROE_Z&quot;].between(roe_zscore[0],roe_zscore[-1]) print(&quot;满足收益率要求的指数有{0}只&quot;.format(mask_roe.sum())) mask_all = mask_scale &amp; mask_risk &amp; mask_roe result =checkday_summary[mask_all].drop_duplicates(subset=[&quot;secShortName&quot;]) print(&quot;满足高流动性，低风险，较好收益率要求的指数有{0}只&quot;.format(result.shape[0])) 满足流动性规模的指数有478只 满足低风险要求的指数有59只 满足收益率要求的指数有310只 满足高流动性，低风险，较好收益率要求的指数有24只 投资策略 def strategy_tickers_today(strategy=&quot;customize&quot;,scale_score =None,risk_zscore =None,roe_score =None): if strategy ==&quot;customize&quot;: scale_score =[&quot;50亿&quot;,&quot;500亿&quot;,&quot;5000亿&quot;] scale_zscore=(-1,1) risk_zscore= -1.4 #注 z值小于 -1 的 指数太少，故改设为-0.3 roe_score =[&quot;中&quot;,&quot;高&quot;] roe_zscore =[-2,2] elif strategy ==&quot;ROE&quot;: scale_score =None risk_zscore= None roe_score =[&quot;高&quot;] elif strategy ==&quot;RISK&quot;: risk_zscore= -2 #PE &amp; PB Z值小于-2， 如果是 正态分布，这风险小于95% elif strategy ==&quot;TURNOVER&quot;: scale_score =[&quot;5000亿&quot;] scale_zscore=(-1,1) #交易规模过滤 if scale_score ==None: mask_scale =True else: mask_scale= (checkday_summary[&quot;日交易额规模&quot;].isin(scale_score)) \\ &amp; ( checkday_summary[&#39;TurnoverValue_Z&#39;].between(scale_zscore[0],scale_zscore[-1])) #风险指标过滤 if risk_zscore ==None: mask_risk =True else: risk_zscore= -1.4 mask_risk= (checkday_summary[&quot;PE1_Z&quot;]&lt;0) &amp; (checkday_summary[&quot;PB1_Z&quot;]&lt;0)\\ &amp;((checkday_summary[&quot;PE1_Z&quot;] + checkday_summary[&quot;PB1_Z&quot;]&lt;risk_zscore)) #投资回报率过滤 if roe_score ==None: mask_roe=True else: mask_roe = checkday_summary[&quot;净资产回报率等级&quot;].isin(roe_score) mask_all = mask_scale &amp; mask_risk &amp; mask_roe result =checkday_summary[mask_all].drop_duplicates(subset=[&quot;secShortName&quot;]) return result def show_tickers_color(tickers= None): if (tickers is None) or (tickers.shape[0]==0): print(&quot;Pls prepare the checkday_summary dataframe&quot;) return else: html =tickers[[&#39;secShortName&#39;,&#39;Close&#39;, &#39;PE1&#39;, &#39;PB1&#39;, &#39;ROE&#39;,&#39;Close_Z&#39;, &#39;PE1_Z&#39;, &#39;PB1_Z&#39;, &#39;ROE_Z&#39;,&#39;净资产回报率等级&#39;, &#39;日交易额规模&#39;]]\\ .round(2).rename(columns=map_E2C).style.bar(subset=[&#39;Close_Z&#39;, &#39;PE1_Z&#39;, &#39;PB1_Z&#39;],\\ align=&quot;zero&quot;, color=[ &#39;#5fba7d&#39;,&#39;#d65f5f&#39;,],width=100/2) return html 低风险策略 tmp = strategy_tickers_today(&quot;RISK&quot;) tmp[&quot;RISK&quot;] = tmp[&quot;PE1_Z&quot;] + tmp[&quot;PB1_Z&quot;]+tmp[&quot;Close_Z&quot;]*0.2 show_tickers_color(tmp.sort_values(by=[&quot;ROE&quot;],ascending=False).head(5)) 根据不同的Z值组合和因子组合，高收益策略或者高容量策略也很容易合成。 衡量市场，指数高低是一个难题! 价值投资者很难判断， 现在是高估，还是低估? 买的是便宜还是，贵了? 应该现在买/卖，还是再等等？ 针对这个问题，我在网上看到了一些量化的处理方法。例如：平均数法，中位数法，比例法等等。这种方法往往过于简单，只能衡量集中度。不能衡量离散度和概率。 也许统计方法中的标准差Z值法更加适合。既可以衡量某个指数的指标的集中度，还可以衡量离散度，和风险情况。尽管指数的数据也不是完美的正态分布，但Z值法依然存在较大参考意义。 我的观点: Z值越大，越高估。因为大数定理认为： Z&gt;1, Z&gt;2,意味着继续变大的可能性小于16%, 5%。Z值越小，越低估。 因为大数定理认为：Z&lt;-1, Z&lt;-2,意味着继续变小的可能性小于16%, 5% 综观550多只指数的历史数据。绝大部分指数的Z值都在-2，3之间。注：少数的能源，金属类指数曾经出现过短暂疯狂的。Z值法就不太适用。 我使用Python的Pandas 和 Matplotlib 等工具，加上一些渠道获得的指数数据（尤其是市盈率），发布热门指数Ｚ值表。 今天又结合了不可能三角形思路做了一些投资策略的基本探索。 主要目的是： 方便自己定投使用。知道何时开始定投，何时停止定投，何时止盈。（目前还没有止盈过） 结合统计学，熟悉Python的基本数据分析方法。 网上分享给愿意参考的人,交流和学习 文章来源：北大青鸟官网 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/07/de17c1676b8cec8275efb4788dd469c1.html","headline":"用Python做证券指数的三种策略分析","dateModified":"2018-03-07T00:00:00+08:00","datePublished":"2018-03-07T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/07/de17c1676b8cec8275efb4788dd469c1.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>用Python做证券指数的三种策略分析</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h1 class="col-article-title" style="margin-top:0px;margin-bottom:30px;padding:0px;font-size:30px;color:rgb(0,0,0);font-family:'PingFangSC-Light', 'hiragino sans gb', 'helvetica neue', 'microsoft yahei ui', 'microsoft yahei', simsun, arial, sans-serif;">用Python做证券指数的三种策略分析</h1>
  <div class="c-markdown" style="margin:0px;padding:0px;line-height:1.8;list-style:outside;white-space:pre-wrap;font-family:'PingFangSC-Light', 'hiragino sans gb', 'helvetica neue', 'microsoft yahei ui', 'microsoft yahei', simsun, arial, sans-serif;">
   这两天恰好看到一本比较有趣的书，《FOF组合基金》。讲的是Fund of Fund,讲的是组合基金的理论，架构和实践。可以说是有既有理论高度，又有实践的策略。
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">其中有段话比较值得玩味。“可行集中包括无数个可供投资者选择的证券投资组合。投资者可通过有效集定理来找到最佳的投资组合。所谓最佳投资组合。。。。。满足两个条件：</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">1、相同风险下具有最大收益率的投资组合</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">2、同样收益率的水平下具有最小风险的投资组合</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">实践中还有另外一个很重要的因子，资金容量</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">所有人都在寻找高收益率，低风险，大容量的策略。但遗憾的是三者不可兼得。。。。共有8种类型的策略。其中比较有代表性的是相对价值策略，事件驱动策略，宏观因素策略。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">上周股市大涨，本周股市大跌。那么，现在以2月1日的收盘数据来看，指数中有哪些符合中三种策略的指数？</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">我尝试用Python和手中的数据做了一个简单基于Z值的分析，自我学习和分享讨论。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1 、相对价值策略。（低收益，低风险，高容量）</span></p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">书中谈的相对价值策略主要是类固定收益（银行理财，货币基金，债卷，对冲套利等），代价是牺牲”收益率“，从而保证风险可控，和规模扩大。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">书中谈的方法。基本上需要通过期货，期限套利，跨期套利，分级基金折价，溢价，ETF套利，可转债，波动率，期权等方式。也许这种方式就是雪球上 低风险投资的策略吧。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">相对价值策略需要拥有广阔的知识面和大额的资金。而且2015年后，卷商的ETF交易系统接口已经关闭,ETF套利很难运行。未来发展有赖于接口系统重新开放。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">既然那么复杂，我就把问题简单化。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">1.容量： 设为 500亿以上~5000亿日交易额规模。（盘子必须要大，流动性要好）</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">2.风险： 设为该日市盈率和市净率为Z值之和最小的5个指数。（风险要低）</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">3.收益率： 无所谓，可以牺牲。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">结果如下： 找到的这5个指数的净资产收益率较低（小于10%），相对风险释放比较多（市盈率和市净率的Z值都是历史中的非常低位置），（盘子比较大（超过500亿）。其中以中证1000为最甚。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">不过这里的风险最小，只是指数自己和自己历史比较的Z值。Z值可以衡量相对风险。绝对风险，也许只有FOF组合基金中讲的对冲，和组合等策略才能做到。</p>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/bxakao86k9.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">2、宏观因素策略。（高收益，高风险，高容量）</span></p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">以牺牲风险为代价。。。也称择时策略。。。做对，自然收益会搞；但是如果做错，则损失也会很大。。。总的来说可以分成两类：拐点择时和趋势择时。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">注： 这种策略应该就是人们常说的”投机“。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">这些策略是技术流。利用了SVM(支持向量机）挖掘历史模型，Hurst指数，情绪指数，噪声指数等或者是各种均线等。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">技术流暂且不研究，我们可以先看看市场中那些是宏观因素策略指数。把问题简化为：</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">1.高收益：ROE(PB/PB) 等级为高（15%~21%)（收益率必须要高。注：这里的收益率是长期的）</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">2.高容量： 50亿~500亿日交易额 （盘子必须要大，流动性要好）</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">3.高风险：（风险无所谓，可以适当放宽）</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">结果如下：</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">消费，食品，饮料等净资产回报率很高在20%左右，但是相对价格，市盈率，市净率的Z值有的都已经超过了3，或者4. 当这些指数回归均值时，估计要“疑似银河落九天”</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">不过创业成长指数，近资产汇报率19%，但是PB,PE的Z值都非常地。日后好好研究，看看是否是一支被错杀的创业板指数。</p>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/gcw6knuvf3.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">3、事件驱动策略（低风险，高收益，资金容量比较小）</span></p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">把问题简化为：</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">1.低风险：当市净率，市盈率Z值最低</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">2.高收益： ROE(PB/PB) 较高的5只指数（收益率必须要高。注：这里的收益率是长期的）</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">3.容量： 不设限制</p>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/v19cuahdzx.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">他们分别是创业成长，新能源车，和文化类指数。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">新能源车由于补贴政策的变化，不断的估值调整，下滑。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">文化类指数，由于乐视这个老鼠屎，整个系列都在过去两年垫底。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">不过创业成长指数净资产回报率非常高，却估值很低，风险释放充分。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">代码在后面：</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">1、初始化环境 主要用到了Python numpy,Pandas, Scipy.stats, Matplotlib,还有seaborn 等包. 证券投资的机器学习预测，通常需要准备大量数据进行回测。 本文不包含预测和回测部分。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">注：预测和回测也没用。看了FOF组合基金一书才知道，2015年卷商交易接口已经关闭。估计ETF高频套利也不能做了。 此处如果理解有误，还请高人指点。</p>
   <pre><code class="language-javascript"><span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> pandas <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> pd
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> numpy <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> np
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">from</span> scipy <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> stats
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> matplotlib<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>pyplot <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> plt
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> seaborn <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> sns
<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">%</span>matplotlib inline
<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">!</span>free <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span>h

# 以下代码是为了显示正文正常
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> matplotlib <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> mpl
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">import</span> matplotlib<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>font_manager <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> font_manager
path_eng <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'/usr/share/fonts/chinese/REFSAN.TTF'</span>
path_CHN <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"/usr/share/fonts/chinese/simhei.ttf"</span>
prop <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> font_manager<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">FontProperties</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>fname<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>path_CHN<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>  #Set the microsoft sans serief <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">as</span> <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">default</span> font family<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span> <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">if</span> show chinese test<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">set</span> path_CHN instead<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>
#prop<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>set_weight <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'light'</span>
mpl<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>rcParams<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'font.family'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> prop<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">get_name</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

Today <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"2018-02-01"</span></code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">数据概览</p>
   <pre><code class="language-javascript">def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">view_data</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"数据载入中..."</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    sec_map <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">read_hdf</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"uqer/sec_map.h5"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"map"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> # sec_map 包含了约<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2800</span>多个指数<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>实际指数约<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">550</span>只
    history <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">read_hdf</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"uqer/uq_history.h5"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"history"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> #hisotry <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">包含了从2004年到2017年11月16日的指数数据</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span> 大约<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">86</span>万条数据<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>
    #history <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">sort_index</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>level<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    ntickers <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>levshape<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    nTradeDate <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>levshape<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">/</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">250</span>
    nRecords <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>shape<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">/</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">10</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">**</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">4</span>

    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"交易历史数据库包含了:\n\t{1:,.0f}万条日交易数据.\n\t{0}只指数，\n\t单只指数最长交易记录为{2:.1f}年."</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ntickers<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>nRecords<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>nTradeDate<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"\n注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。\n\n"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"历史交易数据：\n 特征列表：{0}"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>columns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">tolist</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"股指名称数据：\n 特征列表：{0}"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>sec_map<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>columns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">tolist</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">view_data</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
map_E2C <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">{</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ticker"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"指数代码"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"指数名称"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>
            <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'tradeDate'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日期"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'Close'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"收盘价-Close"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> 
             <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PB1'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"市净率-PB"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PE1'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"市盈率-PE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> 
             <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'TurnoverValue'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"成交额"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'TurnoverVol'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"成交量"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"净资产回报率-ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">}</span>

<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"\n本文使用的特征为：{0}"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">list</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">values</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">数据载入中... 交易历史数据库包含了: 91万条日交易数据. 550只指数， 单只指数最长交易记录为10.8年.</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">注 ： 数据源基于Uqer,作了初步校对和修正，后存储在 History_fixed.h5 。例如：中证传媒2017年12月~1月的市盈率数据修正为choice的数据。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">历史交易数据： 特征列表：['secID', 'Close', 'PB1', 'PB2', 'PE1', 'PE2', 'TurnoverValue', 'TurnoverVol'] 股指名称数据： 特征列表：['baseDate', 'basePoint', 'endDate', 'indexType', 'indexTypeCD', 'porgFullName', 'pubOrgCD', 'publishDate', 'secID', 'secShortName']</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">本文使用的特征为：['指数代码', '指数名称', '日期', '收盘价-Close', '市净率-PB', '市盈率-PE', '成交额', '成交量', '净资产回报率-ROE']</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">特征工程</span></p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.2.1 筛选有效数据</span></p>
   <ul class="ul-level-0" style="color:rgb(51,51,51);margin-top:10px;margin-bottom:10px;margin-left:20px;padding-left:17px;list-style:inherit;">
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">数据中存在缺失，故只筛选截至2018年1月25日有交易记录的数据。</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">历史交易数据过少，没有统计意义（暂定至少3年）</li>
   </ul>
   <pre><code class="language-javascript">def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">filter_history</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>

    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">ticker_filter</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        ntradedays_annual <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token number" style="list-style:inherit;color:rgb(153,0,85);">250</span>  # 假设一年交易日为<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">250</span>天
        nyear<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">3</span>                 # 假设至少需要<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">3</span>年数据
        checkday<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>Today          # Checkday是设定有效的交易日期。默认为Today<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> 全局变量 
        mask_years    <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>shape<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&gt;</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ntradedays_annual<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">*</span>nyear<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> 
        mask_checkday <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">isin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>checkday<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>level<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"tradeDate"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">any</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        mask <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> mask_years <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> mask_checkday
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> mask

    history <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">read_hdf</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"uqer/uq_history.h5"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"history"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> #hisotry <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">包含了从2004年到2017年11月16日的指数数据</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span> 大约<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">86</span>万条数据<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>
    history<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">loc</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>axis<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>Today<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    history_filtered<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>level<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">filter</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ticker_filter<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    ntickers <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">len</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>history_filtered<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>level<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>groups<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"{0}只指数交易时间超过了3年 且在{1}日有交易记录"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ntickers<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>Today<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> history_filtered

history <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">filter_history</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">483只指数交易时间超过了3年 且在2018-02-01日有交易记录</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.2.2 添加ROE（净资产回报率）特征</span></p>
   <pre><code class="language-javascript">history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">/</span>history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span></code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.2.3 特征提取</span></p>
   <ul class="ul-level-0" style="color:rgb(51,51,51);margin-top:10px;margin-bottom:10px;margin-left:20px;padding-left:17px;list-style:inherit;">
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">交易日最新数据汇总。 取指定交易日因子数据</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">净资产回报率特征。 取一年的数据平均值，然后按回报率分成4个级别。级别(超低，低，中，高）</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">交易额规模特征。取一年的数据平均值，然后按日平均交易额分成4个级别（小于5亿，小于50亿，小于500亿，小于5000亿）</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">Z值（各个指标的标准差倍数）。 针对所有历史数据，计算Zscore(标准差倍数）。</li>
   </ul>
   <pre><code class="language-javascript">def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">Check_summary</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">lastz</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        freedom <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span> # it is sample<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> so the sample std degree <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">of</span> freedome should not be <span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span> but <span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span>
        Arry<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>values
        zscore <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> stats<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">zmap</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>Arry<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>Arry<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ddof<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>freedom<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> zscore
    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">recent_mean</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        mean <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">tail</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">250</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">sum</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">/</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">250</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> mean

    grp <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>level<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    grp_last <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> grp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">agg</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">{</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"Close"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"last"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"last"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"last"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"last"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TurnoverValue"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"last"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">}</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    grp_last<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TurnoverValue"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>grp_last<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TurnoverValue"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>

    grp_rank <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> grp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">agg</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">{</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>recent_mean<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TurnoverValue"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>recent_mean<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">}</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    grp_z <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> grp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">agg</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">{</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"Close"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>lastz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>lastz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>lastz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>lastz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TurnoverValue"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>lastz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">}</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    ROE_rank <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">cut</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>grp_rank<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>ROE<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>bins<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">4</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>labels<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"超低"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"低"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"中"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"高"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    TV_rank <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">cut</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>grp_rank<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>TurnoverValue<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>bins<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">*</span>np<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">logspace</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">7</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">11</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>labels<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"5亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"50亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"500亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"5000亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    ROE_rank<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>name <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"净资产回报率等级"</span>
    TV_rank<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>name <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span>    
    sec_map <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">read_hdf</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"uqer/sec_map.h5"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"map"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> # sec_map 包含了约<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2800</span>多个指数<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>实际指数约<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">550</span>只<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">{</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">}</span>
    #decimals <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">Series</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> index<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"Close"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TurnoverValue"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    combined <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> sec_map<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">join</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>grp_last<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>how<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"right"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">join</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ROE_rank<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>rsuffix<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_R"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">join</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>TV_rank<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>rsuffix<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_R"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    combined <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> combined<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">join</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>grp_z<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>rsuffix<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> combined

checkday_summary <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">Check_summary</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>columns</code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">Index(['secShortName', 'Close', 'PE1', 'PB1', 'ROE', 'TurnoverValue', '净资产回报率等级', '日交易额规模', 'CloseZ', 'PE1Z', 'PB1Z', 'ROEZ', 'TurnoverValue_Z'], dtype='object')</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3 数据探索</span></p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3.1 不同日交易额的指数群中指数的数量</span></p>
   <pre><code class="language-javascript">tmp<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">countplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <pre><code class="language-javascript">checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>by<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">mean</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">rename</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>columns<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">{</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"平均净资产回报率"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">}</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/fnh5lc0hf4.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3.2 收盘价（Close)</span></p>
   <pre><code class="language-javascript">col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"Close"</span>

fig<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> plt<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">subplots</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>figsize<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">10</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})-Z值 箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/nkt96n24i7.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">指定日收盘价汇总箱形图 展现不同指数的收盘价差异： 左图是绝对值：不同规模的指数在该日收盘价价值不同。 右图是相对值：用Z值（即几个标准差）来衡量不同规模指数群的收盘价和各指数自己历史相比的差异。（500亿规模的指数收盘价差异比较大，Z指在4和-1之间。 从右图可以看出， 除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在1附近。 各个日交易规模的指数群都有些Z值在（-1，1）之外的指数，这中间也许存在机会和风险。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">注：考虑到通货膨胀和指数内股票的增长，通常指数收盘价会出现Z值小于-1的情况。收盘价Z值&gt;1甚至大于2都是比较常见的情况。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3.3 市盈率（PE1)</span></p>
   <pre><code class="language-javascript">col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span>

fig<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> plt<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">subplots</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>figsize<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">10</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})-Z值 箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/rwka661lsl.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">指定日市盈率汇总箱形图 展现不同指数的市盈率差异： 左图是绝对值：不同规模的指数在该日市盈率估值不同。 注：由于市盈率计算方法不一样，例如：加权，等权，算术平均等模式。故不同数据源的市盈率，市净率差异比较大。指数官网的市盈率和市净率比较权威。不过使用费用比较高。本文使用的是免费数据。因此可以看出这一天5亿规模指数群中有一个指数的市盈率小于-150倍。这是明显错误的。需要过滤掉。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市盈率和各自历史相比差异。 由于Z值计算是用全部历史数据来计算，故历史上的错误数据（如果数量不大的话，例如小于1%），对整理影响不大。只要将异常点过滤即可。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市盈率存在低估？</p>
   <pre><code class="language-javascript">def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">show_min_PE_Z</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span>
    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">get_max</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        colz<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span>
        index <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">idxmax</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">get_min</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        colz<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span>
        index <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">idxmin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>

    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">apply</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>get_max<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">round</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">apply</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>get_min<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">round</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">show_min_PE_Z</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/mwgw9q9090.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">如上表中，所展示， 低估指数： Z值小于-1。 例如：中证1000(000852)，新能源车（399417），文化指数分别是日交易规模（大盘，中盘，小盘）中Z值最低的指数。 高估指数：Z值大于2。 例如： 中经GDP,央视50（399550），水电指数分别是日交易规模（大盘，中盘，小盘）中Z值最高的指数。 如果这些指数的历史分布是正态， 那么根据经验法则，就存在较大的机会（针对低估）和风险（针对高估） 接下来，看看500亿日交易额规模指数群中新能源车和央视50这两个比较常见的指数历史数据的市盈率的波动。</p>
   <pre><code class="language-javascript">tickers<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"399417"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"399550"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
sec_map <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> pd<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">read_hdf</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"uqer/sec_map.h5"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"map"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
<span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">for</span> ticker <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">in</span> tickers<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"{0} base day is {1}"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ticker<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>sec_map<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>ticker<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>baseDate<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    fig<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> plt<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">subplots</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>figsize<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">6</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">3</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    fig<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">suptitle</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ticker<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    PE1 <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>ticker<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    PE1_Z <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> history<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>ticker<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">apply</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>stats<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    PE1<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">plot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">distplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>PE1_Z<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>vertical<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>True<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/gm1hkqznuu.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">从上图可以看出，2018年2月1日的市盈率图 新能源市盈率为22倍，绝对值不算高。但是Z指接近-1.5，相对值比较低，未来有很大的机会。 央视50市盈率为13倍，绝对值比较低。但是Z值接近4，相对值极度高，未来存在回归历史均值的风险</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3.4 市净率 （PB1)</span></p>
   <pre><code class="language-javascript">col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1"</span>

fig<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> plt<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">subplots</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>figsize<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">10</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})-Z值 箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/gwbdbm49yp.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="color:#333333;">与市盈率数据类似 指定日市净率汇总箱形图 展现不同指数的市净率差异： 左图是绝对值：不同规模的指数在该日市净率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的市净率和各自历史相比差异。 从右图可以看出，除了交易规模为50亿的小盘指数外，其他指数的日收盘价的Z值均值都在0附近。但是也有一些指数群中有（-1，1）之外的Z值。 Z值&lt;-1, 有低估的可能。 可以考虑定投的方式逐步买入。 Z值&gt;1, 有高估的可能。可以考虑逐步买出。 接下来，我们来看看都有哪些指数市净率存在低估</span><a href="http://www.beidaqingniaowang.com/" rel="nofollow"><span style="color:#666666;">计算机学校</span></a><span style="color:#333333;">？</span></p>
   <pre><code class="language-javascript">def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">show_min_PB_Z</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1"</span>
    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">get_max</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        colz<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span>
        index <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">idxmax</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">get_min</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        colz<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span>
        index <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">idxmin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> x<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>loc<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>index<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>colz<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>

    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">apply</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>get_max<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">round</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">groupby</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">apply</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>get_min<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">round</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">show_min_PB_Z</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/9aferhu2jo.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">从上图可以看出，2018年2月1日的市盈率图 新能源车市盈率为2.7倍，绝对值不算高。而且Z指接近-1.5，相对值比较低，未来有很大的机会。 国证食品市盈率为6.7倍，绝对值非常高。而且Z值接近3.2，相对值极度高，未来存在回归历史均值（3年历史）的风险。 注：由于国证食品指数在2004年就成立，缺少之前近十年历史数据。无法完全确定是否高估</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3.5 净资产回报率（ROE）</span></p>
   <pre><code class="language-javascript">col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span>

fig<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> plt<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">subplots</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>figsize<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">10</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
sns<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">boxplot</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>x<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>y<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>col<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ax<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>data<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
ax<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">set_title</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"不同规模指数 - {0}({1})-Z值 箱体图"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>col<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/xtirlmj6ix.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">与市盈率数据类似 指定日净资产回报率汇总箱形图 展现不同指数的净资产回报率差异： 左图是绝对值：不同规模的指数在该日净资产回报率估值不同。 右图是相关值：用Z值（即几个标准差）来衡量不同规模指数的净资产回报率和各自历史相比差异。 和市盈率与市净率不同，净资产回报率（ROE=PB/PE= profit/equity)排除了收盘价的短期波动影响，是比较长期的指标。我个人认为，长期指标稳健比较好。即ROE&gt;0.1 而且Z指在（-1，1）之间的指数。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">1.3.6 综合分析 - 流动性 + 风险 + 收益</span></p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">前面已经单独对4个因子作了分析。他们分别代表了</p>
   <ul class="ul-level-0" style="color:rgb(51,51,51);margin-top:10px;margin-bottom:10px;margin-left:20px;padding-left:17px;list-style:inherit;">
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">流动性(日交易额规模)，</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">风险（市盈率和市净率）</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">收益（净资产回报）</li>
   </ul>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">现在，让我们试着把这四个因子综合起来看看。</p>
   <pre><code class="language-javascript">mask_scale<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">isin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"50亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"500亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"5000亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"满足流动性规模的指数有{0}只"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>mask_scale<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">sum</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

risk_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1.4</span>  #注 z值小于 <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span> 的 指数太少，故改设为<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0.3</span>
mask_risk<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&lt;</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&lt;</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>\
    <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&lt;</span>risk_zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"满足低风险要求的指数有{0}只"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>mask_risk<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">sum</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

roe_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"中"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"高"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
roe_zscore <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
mask_roe <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"净资产回报率等级"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">isin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>roe_score<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">between</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>roe_zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>roe_zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"满足收益率要求的指数有{0}只"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>mask_roe<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">sum</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

mask_all <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> mask_scale <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> mask_risk <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> mask_roe
result <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>mask_all<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">drop_duplicates</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>subset<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"满足高流动性，低风险，较好收益率要求的指数有{0}只"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">format</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>result<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>shape<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">满足流动性规模的指数有478只 满足低风险要求的指数有59只 满足收益率要求的指数有310只 满足高流动性，低风险，较好收益率要求的指数有24只</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">投资策略</span></p>
   <pre><code class="language-javascript">def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">strategy_tickers_today</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>strategy<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"customize"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>scale_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>risk_zscore <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>roe_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">if</span> strategy <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"customize"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        scale_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"50亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"500亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"5000亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
        scale_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

        risk_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1.4</span>  #注 z值小于 <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span> 的 指数太少，故改设为<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0.3</span>

        roe_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"中"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"高"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
        roe_zscore <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    elif strategy <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        scale_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>None
        risk_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> None
        roe_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"高"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
    elif strategy <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"RISK"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
         risk_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span> #PE <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> PB Z值小于<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span>， 如果是 正态分布，这风险小于<span class="token number" style="list-style:inherit;color:rgb(153,0,85);">95</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">%</span>
    elif strategy <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"TURNOVER"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        scale_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"5000亿"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>
        scale_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    #交易规模过滤  
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">if</span> scale_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span>None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        mask_scale <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>True
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">else</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        mask_scale<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"日交易额规模"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">isin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>scale_score<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> \
        <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'TurnoverValue_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">between</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>scale_zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>scale_zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    #风险指标过滤 
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">if</span> risk_zscore <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span>None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        mask_risk <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>True
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">else</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        risk_zscore<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">-</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">1.4</span>
        mask_risk<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&lt;</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&lt;</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>\
        <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&lt;</span>risk_zscore<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>

    #投资回报率过滤 
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">if</span> roe_score <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span>None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        mask_roe<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>True
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">else</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        mask_roe <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"净资产回报率等级"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">isin</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>roe_score<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
    mask_all <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> mask_scale <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> mask_risk <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">&amp;</span> mask_roe
    result <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>checkday_summary<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span>mask_all<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">drop_duplicates</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>subset<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"secShortName"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>



    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> result

def <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">show_tickers_color</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>tickers<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">if</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>tickers is None<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span> <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">or</span> <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>tickers<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>shape<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">==</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">print</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"Pls prepare the checkday_summary dataframe"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span>
    <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">else</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">:</span>
        html <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>tickers<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'secShortName'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'Close'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PE1'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PB1'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'ROE'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'Close_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PE1_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PB1_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'ROE_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'净资产回报率等级'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'日交易额规模'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span>\
     <span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">round</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">rename</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>columns<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>map_E2C<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span>style<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">bar</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>subset<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'Close_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PE1_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'PB1_Z'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>\
             align<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"zero"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span> color<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span> <span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'#5fba7d'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">'#d65f5f'</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>width<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">100</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">/</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">2</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
        <span class="token keyword" style="list-style:inherit;color:rgb(0,119,170);">return</span> html</code></pre>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;"><span style="list-style:inherit;font-weight:700;">低风险策略</span></p>
   <pre><code class="language-javascript">tmp <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> <span class="token function" style="list-style:inherit;color:rgb(221,74,104);">strategy_tickers_today</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"RISK"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span>
tmp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"RISK"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span> tmp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PE1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span> <span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span> tmp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"PB1_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">+</span>tmp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"Close_Z"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">*</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">0.2</span>
<span class="token function" style="list-style:inherit;color:rgb(221,74,104);">show_tickers_color</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>tmp<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">sort_values</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span>by<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">[</span><span class="token string" style="list-style:inherit;color:rgb(102,153,0);">"ROE"</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">]</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">,</span>ascending<span class="token operator" style="list-style:inherit;color:rgb(166,127,89);background:rgba(255,255,255,.498039);">=</span>False<span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">.</span><span class="token function" style="list-style:inherit;color:rgb(221,74,104);">head</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">(</span><span class="token number" style="list-style:inherit;color:rgb(153,0,85);">5</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span><span class="token punctuation" style="list-style:inherit;color:rgb(153,153,153);">)</span></code></pre>
   <span style="list-style:inherit;"><img src="https://ask.qcloudimg.com/http-save/yehe-1227999/7bzcry23yu.jpeg?imageView2/0/w/1620" style="border:0px;list-style:inherit;height:auto;background-color:rgb(255,255,255);margin-right:auto;margin-bottom:0px;margin-left:auto;" alt=""></span>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">根据不同的Z值组合和因子组合，高收益策略或者高容量策略也很容易合成。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">衡量市场，指数高低是一个难题! 价值投资者很难判断，</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">现在是高估，还是低估?</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">买的是便宜还是，贵了?</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">应该现在买/卖，还是再等等？</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">针对这个问题，我在网上看到了一些量化的处理方法。例如：平均数法，中位数法，比例法等等。这种方法往往过于简单，只能衡量集中度。不能衡量离散度和概率。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">也许统计方法中的标准差Z值法更加适合。既可以衡量某个指数的指标的集中度，还可以衡量离散度，和风险情况。尽管指数的数据也不是完美的正态分布，但Z值法依然存在较大参考意义。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">我的观点:</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">Z值越大，越高估。因为大数定理认为：</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">Z&gt;1, Z&gt;2,意味着继续变大的可能性小于16%, 5%。Z值越小，越低估。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">因为大数定理认为：Z&lt;-1, Z&lt;-2,意味着继续变小的可能性小于16%, 5%</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">综观550多只指数的历史数据。绝大部分指数的Z值都在-2，3之间。注：少数的能源，金属类指数曾经出现过短暂疯狂的。Z值法就不太适用。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">我使用Python的Pandas 和 Matplotlib 等工具，加上一些渠道获得的指数数据（尤其是市盈率），发布热门指数Ｚ值表。 今天又结合了不可能三角形思路做了一些投资策略的基本探索。</p>
   <p style="color:rgb(51,51,51);margin-top:15px;margin-bottom:15px;list-style:inherit;min-height:1.8em;">主要目的是：</p>
   <ul class="ul-level-0" style="color:rgb(51,51,51);margin-top:10px;margin-bottom:10px;margin-left:20px;padding-left:17px;list-style:inherit;">
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">方便自己定投使用。知道何时开始定投，何时停止定投，何时止盈。（目前还没有止盈过）</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">结合统计学，熟悉Python的基本数据分析方法。</li>
    <li style="margin-top:0px;margin-left:0px;padding:0px;list-style:inherit;">网上分享给愿意参考的人,交流和学习</li>
   </ul>
  </div>
  <p>文章来源：<a href="http://m.okbdqn.com" rel="nofollow"><span style="color:#333333;">北大青鸟官网</span></a></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/yulianxuan/article/details/79470048,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/yulianxuan/article/details/79470048,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>【区块链】利用Node.js开发与合约交互的Web界面 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="【区块链】利用Node.js开发与合约交互的Web界面" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/loy_184548/article/details/79517264 利用Node.js开发与合约交互的Web界面 参考地址：here and here 零、在私有链上部署合约 // 本文中用到的MetaCoin合约 pragma solidity ^0.4.2; contract MetaCoin { mapping (address =&gt; uint) balances; event Transfer(address indexed _from, address indexed _to, uint256 _value); function MetaCoin() { balances[tx.origin] = 10000; } function sendCoin(address receiver, uint amount) returns(bool sufficient) { if (balances[msg.sender] &lt; amount) return false; balances[msg.sender] -= amount; balances[receiver] += amount; Transfer(msg.sender, receiver, amount); return true; } function getBalance(address addr) returns(uint) { return balances[addr]; } } 一、新建一个项目 新建一个node.js项目并初始化 $ mkdir web3test &amp;&amp; cd web3test $ npm init 二、导入web3.js npm install web3 --save 三、创建web3对象 var Web3 = require(&quot;web3&quot;); //创建web3对象 var web3 = new Web3(); // 连接到以太坊节点 web3.setProvider(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); 可以测试一下: var version = web3.version.node; console.log(version); ==&gt; 在app目录下，终端输入： prodeMacBook-Pro:web3test pro$ node app.js 输出： Geth/linoy/v1.6.5-stable-cf87713d/darwin-amd64/go1.8.3 四、调用合约 部署合约： 私有链上查看地址，abi可以通过here获取 var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; var address = &quot;0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b&quot;; var metacoin = web3.eth.contract(abi).at(address); 调用合约： /* 查看账户余额 */ var account_one = web3.eth.accounts[0]; var account_one_balance = metacoin.getBalance.call(account_one); console.log(&quot;account one balance: &quot;, account_one_balance.toNumber()); ===&gt; 终端查看： prodeMacBook-Pro:web3test pro$ node app.js account one balance: 10000 /* 转账操作 */ var account_one = web3.eth.accounts[0]; var account_two = web3.eth.accounts[1]; var txhash = metacoin.sendCoin.sendTransaction(account_two, 100, { from: account_one }); var myEvent = metacoin.Transfer(); myEvent.watch(function (err, result) { if (!err) { if (result.transactionHash == txhash) { var account_one_balance = metacoin.getBalance.call(account_one); console.log(&quot;account one balance after sendCoin:&quot;, account_one_balance.toNumber()); } } else { console.log(err); } myEvent.stopWatching(); }); ====&gt; 这里可能会遇到错误：Error: authentication needed: password or unlock 原因是账户没有解锁：在终端，personal.unlockAccount(user1, &quot;123456&quot;) 然后再次尝试可以看到： account one balance: 10000 account one balance after sendCoin: 9900 创建账户： var account_three = web3.personal.newAccount(&quot;123456&quot;); console.log(account_three); 五、与web界面交互 1 . 安装express 查看：here npm install express --save 2 . 导入BigNumber.js 处理大数字需要使用BigNumber库 npm install --save bignumber.js ===&gt; var BigNumber = require(&#39;bignumber.js&#39;); 3 . 调用合约 a. call var returnValue = metacoin.getBalance.call(address).toString(); b. sendTransaction var txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a}); 4 . 界面 六、代码部分 1 . app.js代码 /* 现连接到geth节点，并获取已部署合约的引用 */ var express = require(&quot;express&quot;); var app = express(); var server = require(&quot;http&quot;).createServer(app); var io = require(&quot;socket.io&quot;)(server); var BigNumber = require(&#39;bignumber.js&#39;); app.use(express.static(&quot;public&quot;)); app.get(&quot;/&quot;, function(req, res){ res.sendFile(__dirname + &quot;/index.html&quot;); }) // 现连接到geth节点 var Web3 = require(&quot;web3&quot;); web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); /* 部署合约 */ var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; var address = &quot;0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b&quot;; var metacoin = web3.eth.contract(abi).at(address); app.get(&quot;/register&quot;, function(req, res){ //获取输入的密码 var password = req.query.password; //创建账户 var account = web3.personal.newAccount(password); res.send(account); }) app.get(&quot;/getBalance&quot;, function(req, res){ var address = req.query.address; //获取address的余额 var returnValue = metacoin.getBalance.call(address).toString(); res.send(returnValue); }) app.get(&quot;/sendcoin&quot;, function(req, res){ var address_a = req.query.address_a; var address_b = req.query.address_b; var trans_value = req.query.trans_value; //转账操作 var txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a}); res.send(txhash); }) server.listen(8080); 2 . html代码 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;title&gt;转账操作&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;&quot;&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt; &lt;div&gt; &lt;h3&gt;注册：&lt;/h3&gt;&lt;br&gt; &lt;label for=&quot;identity&quot;&gt;请输入密码：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;password&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;register()&quot;&gt;注册&lt;/button&gt; &lt;p id = &quot;address_test&quot;&gt;地址：&lt;/p&gt; &lt;/div&gt; &lt;div&gt; &lt;h3&gt;查询余额：&lt;/h3&gt;&lt;br&gt; &lt;label for=&quot;identity&quot;&gt;请输入地址：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;getBalance()&quot;&gt;查询余额&lt;/button&gt; &lt;p id = &quot;address_balance&quot;&gt;余额：&lt;/p&gt; &lt;/div&gt; &lt;div&gt; &lt;h3&gt;转账&lt;/h3&gt; &lt;label for=&quot;identity&quot;&gt;转出用户地址&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address_a&quot; &gt;&lt;/input&gt; &lt;br&gt;&lt;label for=&quot;identity&quot;&gt;转入用户地址&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address_b&quot; &gt;&lt;/input&gt; &lt;br&gt;&lt;label for=&quot;identity&quot;&gt;金额&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;trans_value&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;sendcoin()&quot;&gt;确定&lt;/button&gt; &lt;p id = &quot;tx_hash&quot;&gt;交易：&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/sha1.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/main.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/bignumber.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 3 . main.js代码 function register() { var password = document.getElementById(&quot;password&quot;).value; $.get(&quot;/register?password=&quot; + password, function(data){ if(data == &quot;Error&quot;) { $(&quot;#address_test&quot;).text(&quot;An error occured.&quot;); } else { $(&quot;#address_test&quot;).html(&quot;地址: &quot; + data); } }); } function getBalance() { var address = document.getElementById(&quot;address&quot;).value; $.get(&quot;/getBalance?address=&quot; + address, function(data){ if(data == &quot;Error&quot;) { $(&quot;#address_balance&quot;).text(&quot;An error occured.&quot;); } else { $(&quot;#address_balance&quot;).html(&quot;余额: &quot; + data); } }); } function sendcoin() { var address_a = document.getElementById(&quot;address_a&quot;).value; var address_b = document.getElementById(&quot;address_b&quot;).value; var trans_value = document.getElementById(&quot;trans_value&quot;).value; var tx_hash = document.getElementById(&quot;tx_hash&quot;).value; //转账 $.get(&quot;/sendcoin?address_a=&quot; + address_a + &quot;&amp;address_b=&quot; + address_b + &quot;&amp;trans_value=&quot; + trans_value, function(data){ $(&quot;#tx_hash&quot;).html(&quot;交易: &quot; + data); }); } 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/loy_184548/article/details/79517264 利用Node.js开发与合约交互的Web界面 参考地址：here and here 零、在私有链上部署合约 // 本文中用到的MetaCoin合约 pragma solidity ^0.4.2; contract MetaCoin { mapping (address =&gt; uint) balances; event Transfer(address indexed _from, address indexed _to, uint256 _value); function MetaCoin() { balances[tx.origin] = 10000; } function sendCoin(address receiver, uint amount) returns(bool sufficient) { if (balances[msg.sender] &lt; amount) return false; balances[msg.sender] -= amount; balances[receiver] += amount; Transfer(msg.sender, receiver, amount); return true; } function getBalance(address addr) returns(uint) { return balances[addr]; } } 一、新建一个项目 新建一个node.js项目并初始化 $ mkdir web3test &amp;&amp; cd web3test $ npm init 二、导入web3.js npm install web3 --save 三、创建web3对象 var Web3 = require(&quot;web3&quot;); //创建web3对象 var web3 = new Web3(); // 连接到以太坊节点 web3.setProvider(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); 可以测试一下: var version = web3.version.node; console.log(version); ==&gt; 在app目录下，终端输入： prodeMacBook-Pro:web3test pro$ node app.js 输出： Geth/linoy/v1.6.5-stable-cf87713d/darwin-amd64/go1.8.3 四、调用合约 部署合约： 私有链上查看地址，abi可以通过here获取 var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; var address = &quot;0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b&quot;; var metacoin = web3.eth.contract(abi).at(address); 调用合约： /* 查看账户余额 */ var account_one = web3.eth.accounts[0]; var account_one_balance = metacoin.getBalance.call(account_one); console.log(&quot;account one balance: &quot;, account_one_balance.toNumber()); ===&gt; 终端查看： prodeMacBook-Pro:web3test pro$ node app.js account one balance: 10000 /* 转账操作 */ var account_one = web3.eth.accounts[0]; var account_two = web3.eth.accounts[1]; var txhash = metacoin.sendCoin.sendTransaction(account_two, 100, { from: account_one }); var myEvent = metacoin.Transfer(); myEvent.watch(function (err, result) { if (!err) { if (result.transactionHash == txhash) { var account_one_balance = metacoin.getBalance.call(account_one); console.log(&quot;account one balance after sendCoin:&quot;, account_one_balance.toNumber()); } } else { console.log(err); } myEvent.stopWatching(); }); ====&gt; 这里可能会遇到错误：Error: authentication needed: password or unlock 原因是账户没有解锁：在终端，personal.unlockAccount(user1, &quot;123456&quot;) 然后再次尝试可以看到： account one balance: 10000 account one balance after sendCoin: 9900 创建账户： var account_three = web3.personal.newAccount(&quot;123456&quot;); console.log(account_three); 五、与web界面交互 1 . 安装express 查看：here npm install express --save 2 . 导入BigNumber.js 处理大数字需要使用BigNumber库 npm install --save bignumber.js ===&gt; var BigNumber = require(&#39;bignumber.js&#39;); 3 . 调用合约 a. call var returnValue = metacoin.getBalance.call(address).toString(); b. sendTransaction var txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a}); 4 . 界面 六、代码部分 1 . app.js代码 /* 现连接到geth节点，并获取已部署合约的引用 */ var express = require(&quot;express&quot;); var app = express(); var server = require(&quot;http&quot;).createServer(app); var io = require(&quot;socket.io&quot;)(server); var BigNumber = require(&#39;bignumber.js&#39;); app.use(express.static(&quot;public&quot;)); app.get(&quot;/&quot;, function(req, res){ res.sendFile(__dirname + &quot;/index.html&quot;); }) // 现连接到geth节点 var Web3 = require(&quot;web3&quot;); web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); /* 部署合约 */ var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; var address = &quot;0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b&quot;; var metacoin = web3.eth.contract(abi).at(address); app.get(&quot;/register&quot;, function(req, res){ //获取输入的密码 var password = req.query.password; //创建账户 var account = web3.personal.newAccount(password); res.send(account); }) app.get(&quot;/getBalance&quot;, function(req, res){ var address = req.query.address; //获取address的余额 var returnValue = metacoin.getBalance.call(address).toString(); res.send(returnValue); }) app.get(&quot;/sendcoin&quot;, function(req, res){ var address_a = req.query.address_a; var address_b = req.query.address_b; var trans_value = req.query.trans_value; //转账操作 var txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a}); res.send(txhash); }) server.listen(8080); 2 . html代码 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;title&gt;转账操作&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;&quot;&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt; &lt;div&gt; &lt;h3&gt;注册：&lt;/h3&gt;&lt;br&gt; &lt;label for=&quot;identity&quot;&gt;请输入密码：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;password&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;register()&quot;&gt;注册&lt;/button&gt; &lt;p id = &quot;address_test&quot;&gt;地址：&lt;/p&gt; &lt;/div&gt; &lt;div&gt; &lt;h3&gt;查询余额：&lt;/h3&gt;&lt;br&gt; &lt;label for=&quot;identity&quot;&gt;请输入地址：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;getBalance()&quot;&gt;查询余额&lt;/button&gt; &lt;p id = &quot;address_balance&quot;&gt;余额：&lt;/p&gt; &lt;/div&gt; &lt;div&gt; &lt;h3&gt;转账&lt;/h3&gt; &lt;label for=&quot;identity&quot;&gt;转出用户地址&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address_a&quot; &gt;&lt;/input&gt; &lt;br&gt;&lt;label for=&quot;identity&quot;&gt;转入用户地址&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address_b&quot; &gt;&lt;/input&gt; &lt;br&gt;&lt;label for=&quot;identity&quot;&gt;金额&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;trans_value&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;sendcoin()&quot;&gt;确定&lt;/button&gt; &lt;p id = &quot;tx_hash&quot;&gt;交易：&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/sha1.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/main.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/bignumber.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 3 . main.js代码 function register() { var password = document.getElementById(&quot;password&quot;).value; $.get(&quot;/register?password=&quot; + password, function(data){ if(data == &quot;Error&quot;) { $(&quot;#address_test&quot;).text(&quot;An error occured.&quot;); } else { $(&quot;#address_test&quot;).html(&quot;地址: &quot; + data); } }); } function getBalance() { var address = document.getElementById(&quot;address&quot;).value; $.get(&quot;/getBalance?address=&quot; + address, function(data){ if(data == &quot;Error&quot;) { $(&quot;#address_balance&quot;).text(&quot;An error occured.&quot;); } else { $(&quot;#address_balance&quot;).html(&quot;余额: &quot; + data); } }); } function sendcoin() { var address_a = document.getElementById(&quot;address_a&quot;).value; var address_b = document.getElementById(&quot;address_b&quot;).value; var trans_value = document.getElementById(&quot;trans_value&quot;).value; var tx_hash = document.getElementById(&quot;tx_hash&quot;).value; //转账 $.get(&quot;/sendcoin?address_a=&quot; + address_a + &quot;&amp;address_b=&quot; + address_b + &quot;&amp;trans_value=&quot; + trans_value, function(data){ $(&quot;#tx_hash&quot;).html(&quot;交易: &quot; + data); }); } 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/03/11/06ad035fe565f491adc9d2a11e7df6ee.html" />
<meta property="og:url" content="https://mlh.app/2018/03/11/06ad035fe565f491adc9d2a11e7df6ee.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-11T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/loy_184548/article/details/79517264 利用Node.js开发与合约交互的Web界面 参考地址：here and here 零、在私有链上部署合约 // 本文中用到的MetaCoin合约 pragma solidity ^0.4.2; contract MetaCoin { mapping (address =&gt; uint) balances; event Transfer(address indexed _from, address indexed _to, uint256 _value); function MetaCoin() { balances[tx.origin] = 10000; } function sendCoin(address receiver, uint amount) returns(bool sufficient) { if (balances[msg.sender] &lt; amount) return false; balances[msg.sender] -= amount; balances[receiver] += amount; Transfer(msg.sender, receiver, amount); return true; } function getBalance(address addr) returns(uint) { return balances[addr]; } } 一、新建一个项目 新建一个node.js项目并初始化 $ mkdir web3test &amp;&amp; cd web3test $ npm init 二、导入web3.js npm install web3 --save 三、创建web3对象 var Web3 = require(&quot;web3&quot;); //创建web3对象 var web3 = new Web3(); // 连接到以太坊节点 web3.setProvider(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); 可以测试一下: var version = web3.version.node; console.log(version); ==&gt; 在app目录下，终端输入： prodeMacBook-Pro:web3test pro$ node app.js 输出： Geth/linoy/v1.6.5-stable-cf87713d/darwin-amd64/go1.8.3 四、调用合约 部署合约： 私有链上查看地址，abi可以通过here获取 var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; var address = &quot;0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b&quot;; var metacoin = web3.eth.contract(abi).at(address); 调用合约： /* 查看账户余额 */ var account_one = web3.eth.accounts[0]; var account_one_balance = metacoin.getBalance.call(account_one); console.log(&quot;account one balance: &quot;, account_one_balance.toNumber()); ===&gt; 终端查看： prodeMacBook-Pro:web3test pro$ node app.js account one balance: 10000 /* 转账操作 */ var account_one = web3.eth.accounts[0]; var account_two = web3.eth.accounts[1]; var txhash = metacoin.sendCoin.sendTransaction(account_two, 100, { from: account_one }); var myEvent = metacoin.Transfer(); myEvent.watch(function (err, result) { if (!err) { if (result.transactionHash == txhash) { var account_one_balance = metacoin.getBalance.call(account_one); console.log(&quot;account one balance after sendCoin:&quot;, account_one_balance.toNumber()); } } else { console.log(err); } myEvent.stopWatching(); }); ====&gt; 这里可能会遇到错误：Error: authentication needed: password or unlock 原因是账户没有解锁：在终端，personal.unlockAccount(user1, &quot;123456&quot;) 然后再次尝试可以看到： account one balance: 10000 account one balance after sendCoin: 9900 创建账户： var account_three = web3.personal.newAccount(&quot;123456&quot;); console.log(account_three); 五、与web界面交互 1 . 安装express 查看：here npm install express --save 2 . 导入BigNumber.js 处理大数字需要使用BigNumber库 npm install --save bignumber.js ===&gt; var BigNumber = require(&#39;bignumber.js&#39;); 3 . 调用合约 a. call var returnValue = metacoin.getBalance.call(address).toString(); b. sendTransaction var txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a}); 4 . 界面 六、代码部分 1 . app.js代码 /* 现连接到geth节点，并获取已部署合约的引用 */ var express = require(&quot;express&quot;); var app = express(); var server = require(&quot;http&quot;).createServer(app); var io = require(&quot;socket.io&quot;)(server); var BigNumber = require(&#39;bignumber.js&#39;); app.use(express.static(&quot;public&quot;)); app.get(&quot;/&quot;, function(req, res){ res.sendFile(__dirname + &quot;/index.html&quot;); }) // 现连接到geth节点 var Web3 = require(&quot;web3&quot;); web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;)); /* 部署合约 */ var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; var address = &quot;0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b&quot;; var metacoin = web3.eth.contract(abi).at(address); app.get(&quot;/register&quot;, function(req, res){ //获取输入的密码 var password = req.query.password; //创建账户 var account = web3.personal.newAccount(password); res.send(account); }) app.get(&quot;/getBalance&quot;, function(req, res){ var address = req.query.address; //获取address的余额 var returnValue = metacoin.getBalance.call(address).toString(); res.send(returnValue); }) app.get(&quot;/sendcoin&quot;, function(req, res){ var address_a = req.query.address_a; var address_b = req.query.address_b; var trans_value = req.query.trans_value; //转账操作 var txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a}); res.send(txhash); }) server.listen(8080); 2 . html代码 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;title&gt;转账操作&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;&quot;&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt; &lt;div&gt; &lt;h3&gt;注册：&lt;/h3&gt;&lt;br&gt; &lt;label for=&quot;identity&quot;&gt;请输入密码：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;password&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;register()&quot;&gt;注册&lt;/button&gt; &lt;p id = &quot;address_test&quot;&gt;地址：&lt;/p&gt; &lt;/div&gt; &lt;div&gt; &lt;h3&gt;查询余额：&lt;/h3&gt;&lt;br&gt; &lt;label for=&quot;identity&quot;&gt;请输入地址：&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;getBalance()&quot;&gt;查询余额&lt;/button&gt; &lt;p id = &quot;address_balance&quot;&gt;余额：&lt;/p&gt; &lt;/div&gt; &lt;div&gt; &lt;h3&gt;转账&lt;/h3&gt; &lt;label for=&quot;identity&quot;&gt;转出用户地址&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address_a&quot; &gt;&lt;/input&gt; &lt;br&gt;&lt;label for=&quot;identity&quot;&gt;转入用户地址&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;address_b&quot; &gt;&lt;/input&gt; &lt;br&gt;&lt;label for=&quot;identity&quot;&gt;金额&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;trans_value&quot; &gt;&lt;/input&gt; &lt;button type = &quot;submit&quot; onclick=&quot;sendcoin()&quot;&gt;确定&lt;/button&gt; &lt;p id = &quot;tx_hash&quot;&gt;交易：&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/sha1.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/main.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;/bignumber.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 3 . main.js代码 function register() { var password = document.getElementById(&quot;password&quot;).value; $.get(&quot;/register?password=&quot; + password, function(data){ if(data == &quot;Error&quot;) { $(&quot;#address_test&quot;).text(&quot;An error occured.&quot;); } else { $(&quot;#address_test&quot;).html(&quot;地址: &quot; + data); } }); } function getBalance() { var address = document.getElementById(&quot;address&quot;).value; $.get(&quot;/getBalance?address=&quot; + address, function(data){ if(data == &quot;Error&quot;) { $(&quot;#address_balance&quot;).text(&quot;An error occured.&quot;); } else { $(&quot;#address_balance&quot;).html(&quot;余额: &quot; + data); } }); } function sendcoin() { var address_a = document.getElementById(&quot;address_a&quot;).value; var address_b = document.getElementById(&quot;address_b&quot;).value; var trans_value = document.getElementById(&quot;trans_value&quot;).value; var tx_hash = document.getElementById(&quot;tx_hash&quot;).value; //转账 $.get(&quot;/sendcoin?address_a=&quot; + address_a + &quot;&amp;address_b=&quot; + address_b + &quot;&amp;trans_value=&quot; + trans_value, function(data){ $(&quot;#tx_hash&quot;).html(&quot;交易: &quot; + data); }); } 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/03/11/06ad035fe565f491adc9d2a11e7df6ee.html","headline":"【区块链】利用Node.js开发与合约交互的Web界面","dateModified":"2018-03-11T00:00:00+08:00","datePublished":"2018-03-11T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/03/11/06ad035fe565f491adc9d2a11e7df6ee.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>【区块链】利用Node.js开发与合约交互的Web界面</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/loy_184548/article/details/79517264 
 </div> 
 <div class="markdown_views"> 
  <h1 id="利用nodejs开发与合约交互的web界面">利用Node.js开发与合约交互的Web界面</h1> 
  <p>参考地址：<a href="http://blog.csdn.net/ddffr/article/details/73771940" rel="nofollow">here</a> and <a href="https://github.com/ethereum/web3.js" rel="nofollow">here</a></p> 
  <h3 id="零在私有链上部署合约">零、在私有链上部署合约</h3> 
  <pre class="prettyprint"><code class=" hljs php"><span class="hljs-comment">// 本文中用到的MetaCoin合约</span>
pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.2</span>;

contract MetaCoin {
    mapping (address =&gt; uint) balances;

    event Transfer(address indexed _from, address indexed _to, uint256 _value);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MetaCoin</span><span class="hljs-params">()</span> {</span>
        balances[tx.origin] = <span class="hljs-number">10000</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendCoin</span><span class="hljs-params">(address receiver, uint amount)</span> <span class="hljs-title">returns</span><span class="hljs-params">(bool sufficient)</span> {</span>
        <span class="hljs-keyword">if</span> (balances[msg.sender] &lt; amount) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        balances[msg.sender] -= amount;
        balances[receiver] += amount;
        Transfer(msg.sender, receiver, amount);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBalance</span><span class="hljs-params">(address addr)</span> <span class="hljs-title">returns</span><span class="hljs-params">(uint)</span> {</span>
        <span class="hljs-keyword">return</span> balances[addr];
    }
}</code></pre> 
  <h3 id="一新建一个项目">一、新建一个项目</h3> 
  <p>新建一个node.js项目并初始化</p> 
  <pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-variable">$ </span>mkdir web3test &amp;&amp; cd web3test
<span class="hljs-variable">$ </span>npm init</code></pre> 
  <h3 id="二导入web3js">二、导入web3.js</h3> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">web3</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span></code></pre> 
  <h3 id="三创建web3对象">三、创建web3对象</h3> 
  <pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-keyword">var</span> Web3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"web3"</span>);
<span class="hljs-comment">//创建web3对象</span>
<span class="hljs-keyword">var</span> web3 = <span class="hljs-keyword">new</span> Web3();
<span class="hljs-comment">// 连接到以太坊节点</span>
web3.setProvider(<span class="hljs-keyword">new</span> Web3.providers.HttpProvider(<span class="hljs-string">"http://localhost:8545"</span>));</code></pre> 
  <p>可以测试一下:</p> 
  <pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-built_in">var</span> version <span class="hljs-subst">=</span> web3<span class="hljs-built_in">.</span>version<span class="hljs-built_in">.</span>node;
console<span class="hljs-built_in">.</span><span class="hljs-keyword">log</span>(version);
<span class="hljs-subst">==&gt;</span>
在app目录下，终端输入：
prodeMacBook<span class="hljs-attribute">-Pro</span>:web3test pro$ node app<span class="hljs-built_in">.</span>js
输出：
Geth/linoy/v1<span class="hljs-number">.6</span><span class="hljs-number">.5</span><span class="hljs-attribute">-stable</span><span class="hljs-attribute">-cf87713d</span>/darwin<span class="hljs-attribute">-amd64</span>/go1<span class="hljs-number">.8</span><span class="hljs-number">.3</span>
</code></pre> 
  <h3 id="四调用合约">四、调用合约</h3> 
  <p>部署合约： <br> 私有链上查看地址，abi可以通过<a href="https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.16+commit.d7661dd9.js&amp;optimize=false" rel="nofollow">here</a>获取</p> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">var</span> abi = [{<span class="hljs-string">"constant"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"receiver"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"amount"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"sendCoin"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"sufficient"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"bool"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"constant"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"addr"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"getBalance"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"inputs"</span>:[],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"constructor"</span>},{<span class="hljs-string">"anonymous"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"indexed"</span>:<span class="hljs-keyword">true</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"_from"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-keyword">true</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"_to"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"_value"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"Transfer"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"event"</span>}];

<span class="hljs-keyword">var</span> address = <span class="hljs-string">"0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b"</span>;

<span class="hljs-keyword">var</span> metacoin = web3.eth.contract(abi).at(address);</code></pre> 
  <p>调用合约：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-comment">/* 查看账户余额 */</span>
var account_one = web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
var account_one_balance = metacoin<span class="hljs-preprocessor">.getBalance</span><span class="hljs-preprocessor">.call</span>(account_one)<span class="hljs-comment">;</span>
console<span class="hljs-preprocessor">.log</span>(<span class="hljs-string">"account one balance: "</span>, account_one_balance<span class="hljs-preprocessor">.toNumber</span>())<span class="hljs-comment">;</span>
===&gt;
终端查看：
prodeMacBook-Pro:web3test pro$ node app<span class="hljs-preprocessor">.js</span>
account one balance:  <span class="hljs-number">10000</span>

<span class="hljs-comment">/* 转账操作 */</span>
var account_one = web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
var account_two = web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>]<span class="hljs-comment">;</span>

var txhash = metacoin<span class="hljs-preprocessor">.sendCoin</span><span class="hljs-preprocessor">.sendTransaction</span>(account_two, <span class="hljs-number">100</span>, { from: account_one })<span class="hljs-comment">;</span>

var myEvent = metacoin<span class="hljs-preprocessor">.Transfer</span>()<span class="hljs-comment">;</span>
myEvent<span class="hljs-preprocessor">.watch</span>(function (err, result) {
    if (!err) {
        if (result<span class="hljs-preprocessor">.transactionHash</span> == txhash) {
            var account_one_balance = metacoin<span class="hljs-preprocessor">.getBalance</span><span class="hljs-preprocessor">.call</span>(account_one)<span class="hljs-comment">;</span>
            console<span class="hljs-preprocessor">.log</span>(<span class="hljs-string">"account one balance after sendCoin:"</span>, account_one_balance<span class="hljs-preprocessor">.toNumber</span>())<span class="hljs-comment">;</span>
        }
    } else {
        console<span class="hljs-preprocessor">.log</span>(err)<span class="hljs-comment">;</span>
    }
    myEvent<span class="hljs-preprocessor">.stopWatching</span>()<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
====&gt;
这里可能会遇到错误：Error: authentication needed: password <span class="hljs-keyword">or</span> unlock
原因是账户没有解锁：在终端，personal<span class="hljs-preprocessor">.unlockAccount</span>(user1, <span class="hljs-string">"123456"</span>)
然后再次尝试可以看到：
account one balance:  <span class="hljs-number">10000</span>
account one balance after sendCoin: <span class="hljs-number">9900</span></code></pre> 
  <p>创建账户：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">var account_three = web3<span class="hljs-preprocessor">.personal</span><span class="hljs-preprocessor">.newAccount</span>(<span class="hljs-string">"123456"</span>)<span class="hljs-comment">;</span>
console<span class="hljs-preprocessor">.log</span>(account_three)<span class="hljs-comment">;</span></code></pre> 
  <h3 id="五与web界面交互">五、与web界面交互</h3> 
  <p>1 . 安装express</p> 
  <p>查看：<a href="http://www.runoob.com/nodejs/nodejs-express-framework.html" rel="nofollow">here</a></p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">express</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span></code></pre> 
  <p>2 . 导入BigNumber.js</p> 
  <p>处理大数字需要使用BigNumber库</p> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-built_in">npm</span> install --save bignumber.js
==<span class="hljs-function">=&gt;</span>
<span class="hljs-reserved">var</span> BigNumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bignumber.js'</span>);</code></pre> 
  <p>3 . 调用合约</p> 
  <p>a. call </p> 
  <pre class="prettyprint"><code class=" hljs avrasm">var returnValue = metacoin<span class="hljs-preprocessor">.getBalance</span><span class="hljs-preprocessor">.call</span>(address)<span class="hljs-preprocessor">.toString</span>()<span class="hljs-comment">;</span></code></pre> 
  <p>b. sendTransaction</p> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">var</span> txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {<span class="hljs-keyword">from</span>:address_a});</code></pre> 
  <p>4 . 界面</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180318162053599?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L2xveV8xODQ1NDg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/" width="400dp"> <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180318162122269?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L2xveV8xODQ1NDg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width="400dp"> <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180318162044210?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L2xveV8xODQ1NDg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width="400dp"></p> 
  <h3 id="六代码部分">六、代码部分</h3> 
  <p>1 . app.js代码</p> 
  <pre class="prettyprint"><code class=" hljs php"><span class="hljs-comment">/* 现连接到geth节点，并获取已部署合约的引用 */</span>
<span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">"express"</span>);  
<span class="hljs-keyword">var</span> app = express();  
<span class="hljs-keyword">var</span> server = <span class="hljs-keyword">require</span>(<span class="hljs-string">"http"</span>).createServer(app);
<span class="hljs-keyword">var</span> io = <span class="hljs-keyword">require</span>(<span class="hljs-string">"socket.io"</span>)(server);
<span class="hljs-keyword">var</span> BigNumber = <span class="hljs-keyword">require</span>(<span class="hljs-string">'bignumber.js'</span>);

app.<span class="hljs-keyword">use</span>(express.<span class="hljs-keyword">static</span>(<span class="hljs-string">"public"</span>));

app.get(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span>{</span>
    res.sendFile(__dirname + <span class="hljs-string">"/index.html"</span>);
})

<span class="hljs-comment">// 现连接到geth节点</span>
<span class="hljs-keyword">var</span> Web3 = <span class="hljs-keyword">require</span>(<span class="hljs-string">"web3"</span>);
web3 = <span class="hljs-keyword">new</span> Web3(<span class="hljs-keyword">new</span> Web3.providers.HttpProvider(<span class="hljs-string">"http://localhost:8545"</span>));  


<span class="hljs-comment">/* 部署合约 */</span>
<span class="hljs-keyword">var</span> abi = [{<span class="hljs-string">"constant"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"receiver"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"amount"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"sendCoin"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"sufficient"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"bool"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"constant"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"addr"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"getBalance"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"inputs"</span>:[],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"constructor"</span>},{<span class="hljs-string">"anonymous"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"indexed"</span>:<span class="hljs-keyword">true</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"_from"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-keyword">true</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"_to"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"_value"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"Transfer"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"event"</span>}];

<span class="hljs-keyword">var</span> address = <span class="hljs-string">"0x6a0a87bd4da65b39a1b27597edb1a5b505a55a0b"</span>;

<span class="hljs-keyword">var</span> metacoin = web3.eth.contract(abi).at(address);

app.get(<span class="hljs-string">"/register"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span>{</span>

    <span class="hljs-comment">//获取输入的密码</span>
    <span class="hljs-keyword">var</span> password = req.query.password;
    <span class="hljs-comment">//创建账户</span>
    <span class="hljs-keyword">var</span> account = web3.personal.newAccount(password);
    res.send(account);

})

app.get(<span class="hljs-string">"/getBalance"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span>{</span>

    <span class="hljs-keyword">var</span> address = req.query.address;

    <span class="hljs-comment">//获取address的余额</span>
    <span class="hljs-keyword">var</span> returnValue = metacoin.getBalance.call(address).toString();
    res.send(returnValue);

})

app.get(<span class="hljs-string">"/sendcoin"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span>{</span>

    <span class="hljs-keyword">var</span> address_a = req.query.address_a;
    <span class="hljs-keyword">var</span> address_b = req.query.address_b;
    <span class="hljs-keyword">var</span> trans_value = req.query.trans_value;

    <span class="hljs-comment">//转账操作</span>
    <span class="hljs-keyword">var</span> txhash = metacoin.sendCoin.sendTransaction(address_b, trans_value, {from:address_a});
    res.send(txhash);

})
server.listen(<span class="hljs-number">8080</span>);</code></pre> 
  <p>2 . html代码</p> 
  <pre class="prettyprint"><code class=" hljs xml"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>转账操作<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">""</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span> 
            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>注册：<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"identity"</span>&gt;</span>请输入密码：<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"password"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span> = "<span class="hljs-attribute">submit</span>" <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"register()"</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">id</span> = "<span class="hljs-attribute">address_test</span>"&gt;</span>地址：<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span> 
            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>查询余额：<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"identity"</span>&gt;</span>请输入地址：<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"address"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span> = "<span class="hljs-attribute">submit</span>" <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"getBalance()"</span>&gt;</span>查询余额<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">id</span> = "<span class="hljs-attribute">address_balance</span>"&gt;</span>余额：<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h3</span>&gt;</span>转账<span class="hljs-tag">&lt;/<span class="hljs-title">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"identity"</span>&gt;</span>转出用户地址<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"address_a"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"identity"</span>&gt;</span>转入用户地址<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"address_b"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">label</span> <span class="hljs-attribute">for</span>=<span class="hljs-value">"identity"</span>&gt;</span>金额<span class="hljs-tag">&lt;/<span class="hljs-title">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"trans_value"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">input</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span> = "<span class="hljs-attribute">submit</span>" <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"sendcoin()"</span>&gt;</span>确定<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">id</span> = "<span class="hljs-attribute">tx_hash</span>"&gt;</span>交易：<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/sha1.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/socket.io.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/main.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/bignumber.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre> 
  <p>3 . main.js代码</p> 
  <pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> password = document.getElementById(<span class="hljs-string">"password"</span>).value;

    $.get(<span class="hljs-string">"/register?password="</span> + password, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span>{</span>
        <span class="hljs-keyword">if</span>(data == <span class="hljs-string">"Error"</span>)
        {
            $(<span class="hljs-string">"#address_test"</span>).text(<span class="hljs-string">"An error occured."</span>);
        }
        <span class="hljs-keyword">else</span>
        {
            $(<span class="hljs-string">"#address_test"</span>).html(<span class="hljs-string">"地址: "</span> + data);
        }
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> address = document.getElementById(<span class="hljs-string">"address"</span>).value;

    $.get(<span class="hljs-string">"/getBalance?address="</span> + address, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span>{</span>

        <span class="hljs-keyword">if</span>(data == <span class="hljs-string">"Error"</span>)
        {
            $(<span class="hljs-string">"#address_balance"</span>).text(<span class="hljs-string">"An error occured."</span>);
        }
        <span class="hljs-keyword">else</span>
        {
            $(<span class="hljs-string">"#address_balance"</span>).html(<span class="hljs-string">"余额: "</span> + data);
        }
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendcoin</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> address_a = document.getElementById(<span class="hljs-string">"address_a"</span>).value;
    <span class="hljs-keyword">var</span> address_b = document.getElementById(<span class="hljs-string">"address_b"</span>).value;
    <span class="hljs-keyword">var</span> trans_value = document.getElementById(<span class="hljs-string">"trans_value"</span>).value;

    <span class="hljs-keyword">var</span> tx_hash = document.getElementById(<span class="hljs-string">"tx_hash"</span>).value;

    <span class="hljs-comment">//转账</span>
    $.get(<span class="hljs-string">"/sendcoin?address_a="</span> + address_a + <span class="hljs-string">"&amp;address_b="</span> + address_b + <span class="hljs-string">"&amp;trans_value="</span> + trans_value, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span>{</span>

        $(<span class="hljs-string">"#tx_hash"</span>).html(<span class="hljs-string">"交易: "</span> + data);

    });

}</code></pre> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/loy_184548/article/details/79517264,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/loy_184548/article/details/79517264,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>001 以太坊钱包开发-下载、编译 go-ethereum，搭建 eth 私有链 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="001 以太坊钱包开发-下载、编译 go-ethereum，搭建 eth 私有链" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="下载 $ mkdir -p $GOPATH/src/github.com/ethereum $ cd $GOPATH/src/github.com/ethereum $ git clone https://github.com/ethereum/go-ethereum.git 编译 $ cd go-ethereum $ make geth 将 geth 添加到环境变量中 vi ~/.bashrc export GETH=&quot;$GOPATH/src/github.com/ethereum/go-ethereum/build&quot; export PATH=&quot;$PATH:$GETH/bin&quot; 然后执行 source ~/.bashrc，使配置生效。 检查是否安装成功 geth --help 如果输出一些帮助提示命令，则说明安装成功。 搭建私有链 配置初始状态 要运行以太坊私有链，需要定义自己的创世区块，创世区块信息写在一个 JSON 格式的配置文件中。首先将下面的内容保存到一个 JSON 文件中，例如 genesis.json $ mkdir ~/privatechain $ cd privatechain $ mkdir data0 $ vi genesis.json genesis.json 的代码 { &quot;config&quot;: { &quot;chainId&quot;: 110, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;alloc&quot; : {}, &quot;coinbase&quot; : &quot;0x0000000000000000000000000000000000000000&quot;, &quot;difficulty&quot; : &quot;0x20000&quot;, &quot;extraData&quot; : &quot;&quot;, &quot;gasLimit&quot; : &quot;0x2fefd8&quot;, &quot;nonce&quot; : &quot;0x0000000000000042&quot;, &quot;mixhash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;parentHash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;timestamp&quot; : &quot;0x00&quot; } 其中，chainID 指定了独立的区块链网络 ID。网络 ID 在连接到其他节点的时候会用到，以太坊公网的网络 ID 是 1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络 ID。不同 ID 网络的节点无法相互连接。配置文件还对当前挖矿难度 difficulty、区块 Gas 消耗限制 gasLimit 等参数进行了设置。 初始化：写入创世区块 准备好创世区块配置文件后，需要初始化区块链，将上面的创世区块信息写入到区块链中。首先要新建一个目录用来存放区块链数据，假设新建的数据目录为 ~/privatechain/data0，genesis.json 保存在 ~/privatechain 中，此时目录结构应该是这样的： privatechain ├── data0 └── genesis.json 执行初始化命令： geth --datadir data0 init genesis.json 上面的命令的主体是 geth init，表示初始化区块链，命令可以带有选项和参数，其中 --datadir 选项后面跟一个目录名，这里为 data0，表示指定数据存放目录为 data0，genesis.json 是 init 命令的参数。 运行上面的命令，会读取 genesis.json 文件，根据其中的内容，将创世区块写入到区块链中。如果看到以下的输出内容，说明初始化成功了。 INFO [01-29|21:21:13] Maximum peer count ETH=25 LES=0 total=25 INFO [01-29|21:21:13] Allocated cache and file handles database=/Users/fujinliang/privatechain/data0/geth/chaindata cache=16 handles=16 INFO [01-29|21:21:13] Writing custom genesis block INFO [01-29|21:21:13] Persisted trie from memory database nodes=0 size=0.00B time=358.89µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [01-29|21:21:13] Successfully wrote genesis state database=chaindata hash=5e1fc7…d790e0 INFO [01-29|21:21:13] Allocated cache and file handles database=/Users/fujinliang/privatechain/data0/geth/lightchaindata cache=16 handles=16 INFO [01-29|21:21:13] Writing custom genesis block INFO [01-29|21:21:13] Persisted trie from memory database nodes=0 size=0.00B time=2.633µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [01-29|21:21:13] Successfully wrote genesis state database=lightchaindata hash=5e1fc7…d790e0 初始化成功后，会在数据目录 data0 中生成 geth 和 keystore 两个文件夹，此时目录结构如下： privatechain ├── data0 │ ├── geth │ │ ├── chaindata │ │ │ ├── 000001.log │ │ │ ├── CURRENT │ │ │ ├── LOCK │ │ │ ├── LOG │ │ │ └── MANIFEST-000000 │ │ └── lightchaindata │ │ ├── 000001.log │ │ ├── CURRENT │ │ ├── LOCK │ │ ├── LOG │ │ └── MANIFEST-000000 │ └── keystore └── genesis.json 其中 geth/chaindata 中存放的是区块数据，keystore 中存放的是账户数据。 启动私有链节点 geth --datadir data0 --networkid 110 console 上面命令的主体是 geth console，表示启动节点并进入交互式控制台，–datadir选项指定使用data0作为数据目录，--networkid 选项后面跟一个数字，这里是110，表示指定这个私有链的网络id为110。网络id在连接到其他节点的时候会用到，以太坊公网的网络id是1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络id。 运行上面的命令后，就启动了区块链节点并进入了该节点的控制台： ... Welcome to the Geth JavaScript console! instance: Geth/v1.8.10-unstable-ccc0debb/darwin-amd64/go1.10.2 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 控制台操作 进入以太坊 Javascript Console 后，就可以使用里面的内置对象做一些操作，这些内置对象提供的功能很丰富，比如查看区块和交易、创建账户、挖矿、发送交易、部署智能合约等。 常用命令有： personal.newAccount()：创建账户； personal.unlockAccount()：解锁账户； eth.accounts：枚举系统中的账户； eth.getBalance()：查看账户余额，返回值的单位是 Wei（Wei 是以太坊中最小货币面额单位，类似比特币中的聪，1 ether = 10^18 Wei）； eth.blockNumber：列出区块总数； eth.getTransaction()：获取交易； eth.getBlock()：获取区块； miner.start()：开始挖矿； miner.stop()：停止挖矿； eth.coinbase：挖矿奖励的账户 web3.fromWei()：Wei 换算成以太币； web3.toWei()：以太币换算成 Wei； txpool.status：交易池中的状态； admin.addPeer()：连接到其他节点； 创建账户 输入 eth.accounts 查询系统中的账户： &gt; eth.accounts [] 显示为 []，表示没有账户，接下来使用 personal.newAccount() 来创建一个账户： &gt; personal.newAccount() Passphrase: Repeat passphrase: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot; Passphrase 表示输入密码，Repeat passphrase 表示输入确认密码 再次创建一个账户 &gt; personal.newAccount() Passphrase: Repeat passphrase: &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot; 查看刚刚创建的用户： &gt; eth.accounts [&quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot;] 账户默认会保存在数据目录的 data0/keystore 文件夹中。可以查看其中的文件 { &quot;address&quot;: &quot;b5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, &quot;crypto&quot;: { &quot;cipher&quot;: &quot;aes-128-ctr&quot;, &quot;ciphertext&quot;: &quot;10206abe254d60e220ca788043bcd9a62c5d080f7310621c8f492237476dbd52&quot;, &quot;cipherparams&quot;: { &quot;iv&quot;: &quot;ca32c24a39f8af68d400a0351755ac9b&quot; }, &quot;kdf&quot;: &quot;scrypt&quot;, &quot;kdfparams&quot;: { &quot;dklen&quot;: 32, &quot;n&quot;: 262144, &quot;p&quot;: 1, &quot;r&quot;: 8, &quot;salt&quot;: &quot;3c2070da854a2a45ba0c770d78bd92207e64e3bf247ca47ad834c098b3b38478&quot; }, &quot;mac&quot;: &quot;a76a269824d16343a07893dc42ec14cbf477311968b1abc6927a088c39d750d7&quot; }, &quot;id&quot;: &quot;6419c0bd-be7e-4f78-a500-e2d345f6fd3f&quot;, &quot;version&quot;: 3 } 查看账户余额 通过 eth.getBalance() 可以查看账户余额 &gt; eth.getBalance(eth.accounts[0]) 0 &gt; eth.getBalance(eth.accounts[1]) 0 目前两个账户的以太币余额都是0，要使账户有余额，可以从其他账户转账过来，或者通过挖矿来获得以太币奖励。 启动&amp;停止挖矿 通过 miner.start() 启动挖矿 &gt; miner.start(3) 其中 start 的参数表示挖矿使用的线程数。第一次启动挖矿会先生成挖矿所需的 DAG 文件，这个过程有点慢，等进度达到 100% 后，就会开始挖矿，此时屏幕会被挖矿信息刷屏。 停止挖矿，在 console 中输入： miner.stop() 挖到一个区块会奖励5个以太币，挖矿所得的奖励会进入矿工的账户，这个账户叫做coinbase，默认情况下coinbase是本地账户中的第一个账户： &gt; eth.coinbase &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot; 可以通过 miner.setEtherbase() 将其他账户设置成 coinbase 即可 &gt; miner.setEtherbase(eth.accounts[1]) true &gt; eth.coinbase &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot; 重新启动挖矿，查看 eth.accounts[1] 是否可以获得以太币 &gt; miner.start(3) //等待几秒后 &gt; miner.stop() 查询账户余额： &gt; eth.getBalance(eth.accounts[0]) 55000000000000000000 &gt; eth.getBalance(eth.accounts[1]) 35000000000000000000 发现账户0 和 账号1 都有以太币，说明 miner.setEtherbase() 设置成功。 getBalance() 返回值的单位是wei，wei是以太币的最小单位，1个以太币=10的18次方个wei。要查看有多少个以太币，可以用web3.fromWei()将返回值换算成以太币： &gt; web3.fromWei(eth.getBalance(eth.accounts[0]),&#39;ether&#39;) 55 &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 35 发送交易 我们从账户0转移10个以太币到账户1,首先要解锁账户 0，才能发起交易： &gt; personal.unlockAccount(eth.accounts[0]) Unlock account 0xb5154c433e9bedabfdb3452c10114d5589b4b62f Passphrase: true 发起交易 &gt; amount = web3.toWei(10,&#39;ether&#39;) &quot;10000000000000000000&quot; &gt; eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:amount}) INFO [05-04|10:14:12.015] Submitted transaction fullhash=0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619 recipient=0xf4E122E28c5C6A84a20C1321147453cd46182464 &quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot; 查询 账户1 的余额： &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 35 发现账户余额没有发生改变，此时交易已经提交到区块链，但还未被处理，这可以通过用 txpool.status 命令可以看到本地交易池中有一个待确认的交易： &gt; txpool.status { pending: 1, queued: 0 } 其中有一条pending的交易，pending表示已提交但还未被处理的交易。 &gt; miner.start(1);admin.sleepBlocks(1);miner.stop(); 要使交易被处理，必须要挖矿。这里我们启动挖矿，然后等待挖到一个区块之后就停止挖矿： &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 50.000378 发现账户收到了账户的钱，还多了5个以太币。其实多出的5个以太币是挖矿奖励。 查看交易和区块 查看当前区块总数： &gt; eth.blockNumber 19 通过区块号查看区块： &gt; eth.getBlock(6) { difficulty: 131328, extraData: &quot;0xd98301080c846765746888676f312e31302e328664617277696e&quot;, gasLimit: 3160033, gasUsed: 0, hash: &quot;0x024dab0d1bb5da444b783bbc675940bdf92ea2c08c9eb6fb56db07740e47e57d&quot;, logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, miner: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, mixHash: &quot;0xc162ad888f90774d2b2acf1400e97a783d2a38b35d3e3498c3610adba54064dc&quot;, nonce: &quot;0x4898be8dcf2226ec&quot;, number: 6, parentHash: &quot;0x8788ca04121376a99d220621e0bc1a22a3d04d3e642fe0cb42fa8e5f3843cff0&quot;, receiptsRoot: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, size: 537, stateRoot: &quot;0x56abb05e0ca732749d0ee044e68d044b2a53cbd2570386f6537dd6682d409e73&quot;, timestamp: 1530670072, totalDifficulty: 918144, transactions: [], transactionsRoot: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, uncles: [] } 通过交易hash（hash 值包含在上面交易返回值中）查看交易： &gt; eth.getTransaction(&quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot;) { blockHash: &quot;0xfbc1a5183feec436f73c181e8f359cf55da6d45a1cb48c82da7c8678eee54a91&quot;, blockNumber: 19, from: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot;, input: &quot;0x&quot;, nonce: 0, r: &quot;0xd7c160e09190400d8d3139570f59b722c599f19f130bd317b4603452add36a84&quot;, s: &quot;0x3358fe8a438bd2645fa5bc4ea3ac55d213559c19493920d345685244b1408c0c&quot;, to: &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot;, transactionIndex: 0, v: &quot;0x100&quot;, value: 10000000000000000000 } 关注公众号 阅读更多" />
<meta property="og:description" content="下载 $ mkdir -p $GOPATH/src/github.com/ethereum $ cd $GOPATH/src/github.com/ethereum $ git clone https://github.com/ethereum/go-ethereum.git 编译 $ cd go-ethereum $ make geth 将 geth 添加到环境变量中 vi ~/.bashrc export GETH=&quot;$GOPATH/src/github.com/ethereum/go-ethereum/build&quot; export PATH=&quot;$PATH:$GETH/bin&quot; 然后执行 source ~/.bashrc，使配置生效。 检查是否安装成功 geth --help 如果输出一些帮助提示命令，则说明安装成功。 搭建私有链 配置初始状态 要运行以太坊私有链，需要定义自己的创世区块，创世区块信息写在一个 JSON 格式的配置文件中。首先将下面的内容保存到一个 JSON 文件中，例如 genesis.json $ mkdir ~/privatechain $ cd privatechain $ mkdir data0 $ vi genesis.json genesis.json 的代码 { &quot;config&quot;: { &quot;chainId&quot;: 110, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;alloc&quot; : {}, &quot;coinbase&quot; : &quot;0x0000000000000000000000000000000000000000&quot;, &quot;difficulty&quot; : &quot;0x20000&quot;, &quot;extraData&quot; : &quot;&quot;, &quot;gasLimit&quot; : &quot;0x2fefd8&quot;, &quot;nonce&quot; : &quot;0x0000000000000042&quot;, &quot;mixhash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;parentHash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;timestamp&quot; : &quot;0x00&quot; } 其中，chainID 指定了独立的区块链网络 ID。网络 ID 在连接到其他节点的时候会用到，以太坊公网的网络 ID 是 1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络 ID。不同 ID 网络的节点无法相互连接。配置文件还对当前挖矿难度 difficulty、区块 Gas 消耗限制 gasLimit 等参数进行了设置。 初始化：写入创世区块 准备好创世区块配置文件后，需要初始化区块链，将上面的创世区块信息写入到区块链中。首先要新建一个目录用来存放区块链数据，假设新建的数据目录为 ~/privatechain/data0，genesis.json 保存在 ~/privatechain 中，此时目录结构应该是这样的： privatechain ├── data0 └── genesis.json 执行初始化命令： geth --datadir data0 init genesis.json 上面的命令的主体是 geth init，表示初始化区块链，命令可以带有选项和参数，其中 --datadir 选项后面跟一个目录名，这里为 data0，表示指定数据存放目录为 data0，genesis.json 是 init 命令的参数。 运行上面的命令，会读取 genesis.json 文件，根据其中的内容，将创世区块写入到区块链中。如果看到以下的输出内容，说明初始化成功了。 INFO [01-29|21:21:13] Maximum peer count ETH=25 LES=0 total=25 INFO [01-29|21:21:13] Allocated cache and file handles database=/Users/fujinliang/privatechain/data0/geth/chaindata cache=16 handles=16 INFO [01-29|21:21:13] Writing custom genesis block INFO [01-29|21:21:13] Persisted trie from memory database nodes=0 size=0.00B time=358.89µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [01-29|21:21:13] Successfully wrote genesis state database=chaindata hash=5e1fc7…d790e0 INFO [01-29|21:21:13] Allocated cache and file handles database=/Users/fujinliang/privatechain/data0/geth/lightchaindata cache=16 handles=16 INFO [01-29|21:21:13] Writing custom genesis block INFO [01-29|21:21:13] Persisted trie from memory database nodes=0 size=0.00B time=2.633µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [01-29|21:21:13] Successfully wrote genesis state database=lightchaindata hash=5e1fc7…d790e0 初始化成功后，会在数据目录 data0 中生成 geth 和 keystore 两个文件夹，此时目录结构如下： privatechain ├── data0 │ ├── geth │ │ ├── chaindata │ │ │ ├── 000001.log │ │ │ ├── CURRENT │ │ │ ├── LOCK │ │ │ ├── LOG │ │ │ └── MANIFEST-000000 │ │ └── lightchaindata │ │ ├── 000001.log │ │ ├── CURRENT │ │ ├── LOCK │ │ ├── LOG │ │ └── MANIFEST-000000 │ └── keystore └── genesis.json 其中 geth/chaindata 中存放的是区块数据，keystore 中存放的是账户数据。 启动私有链节点 geth --datadir data0 --networkid 110 console 上面命令的主体是 geth console，表示启动节点并进入交互式控制台，–datadir选项指定使用data0作为数据目录，--networkid 选项后面跟一个数字，这里是110，表示指定这个私有链的网络id为110。网络id在连接到其他节点的时候会用到，以太坊公网的网络id是1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络id。 运行上面的命令后，就启动了区块链节点并进入了该节点的控制台： ... Welcome to the Geth JavaScript console! instance: Geth/v1.8.10-unstable-ccc0debb/darwin-amd64/go1.10.2 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 控制台操作 进入以太坊 Javascript Console 后，就可以使用里面的内置对象做一些操作，这些内置对象提供的功能很丰富，比如查看区块和交易、创建账户、挖矿、发送交易、部署智能合约等。 常用命令有： personal.newAccount()：创建账户； personal.unlockAccount()：解锁账户； eth.accounts：枚举系统中的账户； eth.getBalance()：查看账户余额，返回值的单位是 Wei（Wei 是以太坊中最小货币面额单位，类似比特币中的聪，1 ether = 10^18 Wei）； eth.blockNumber：列出区块总数； eth.getTransaction()：获取交易； eth.getBlock()：获取区块； miner.start()：开始挖矿； miner.stop()：停止挖矿； eth.coinbase：挖矿奖励的账户 web3.fromWei()：Wei 换算成以太币； web3.toWei()：以太币换算成 Wei； txpool.status：交易池中的状态； admin.addPeer()：连接到其他节点； 创建账户 输入 eth.accounts 查询系统中的账户： &gt; eth.accounts [] 显示为 []，表示没有账户，接下来使用 personal.newAccount() 来创建一个账户： &gt; personal.newAccount() Passphrase: Repeat passphrase: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot; Passphrase 表示输入密码，Repeat passphrase 表示输入确认密码 再次创建一个账户 &gt; personal.newAccount() Passphrase: Repeat passphrase: &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot; 查看刚刚创建的用户： &gt; eth.accounts [&quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot;] 账户默认会保存在数据目录的 data0/keystore 文件夹中。可以查看其中的文件 { &quot;address&quot;: &quot;b5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, &quot;crypto&quot;: { &quot;cipher&quot;: &quot;aes-128-ctr&quot;, &quot;ciphertext&quot;: &quot;10206abe254d60e220ca788043bcd9a62c5d080f7310621c8f492237476dbd52&quot;, &quot;cipherparams&quot;: { &quot;iv&quot;: &quot;ca32c24a39f8af68d400a0351755ac9b&quot; }, &quot;kdf&quot;: &quot;scrypt&quot;, &quot;kdfparams&quot;: { &quot;dklen&quot;: 32, &quot;n&quot;: 262144, &quot;p&quot;: 1, &quot;r&quot;: 8, &quot;salt&quot;: &quot;3c2070da854a2a45ba0c770d78bd92207e64e3bf247ca47ad834c098b3b38478&quot; }, &quot;mac&quot;: &quot;a76a269824d16343a07893dc42ec14cbf477311968b1abc6927a088c39d750d7&quot; }, &quot;id&quot;: &quot;6419c0bd-be7e-4f78-a500-e2d345f6fd3f&quot;, &quot;version&quot;: 3 } 查看账户余额 通过 eth.getBalance() 可以查看账户余额 &gt; eth.getBalance(eth.accounts[0]) 0 &gt; eth.getBalance(eth.accounts[1]) 0 目前两个账户的以太币余额都是0，要使账户有余额，可以从其他账户转账过来，或者通过挖矿来获得以太币奖励。 启动&amp;停止挖矿 通过 miner.start() 启动挖矿 &gt; miner.start(3) 其中 start 的参数表示挖矿使用的线程数。第一次启动挖矿会先生成挖矿所需的 DAG 文件，这个过程有点慢，等进度达到 100% 后，就会开始挖矿，此时屏幕会被挖矿信息刷屏。 停止挖矿，在 console 中输入： miner.stop() 挖到一个区块会奖励5个以太币，挖矿所得的奖励会进入矿工的账户，这个账户叫做coinbase，默认情况下coinbase是本地账户中的第一个账户： &gt; eth.coinbase &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot; 可以通过 miner.setEtherbase() 将其他账户设置成 coinbase 即可 &gt; miner.setEtherbase(eth.accounts[1]) true &gt; eth.coinbase &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot; 重新启动挖矿，查看 eth.accounts[1] 是否可以获得以太币 &gt; miner.start(3) //等待几秒后 &gt; miner.stop() 查询账户余额： &gt; eth.getBalance(eth.accounts[0]) 55000000000000000000 &gt; eth.getBalance(eth.accounts[1]) 35000000000000000000 发现账户0 和 账号1 都有以太币，说明 miner.setEtherbase() 设置成功。 getBalance() 返回值的单位是wei，wei是以太币的最小单位，1个以太币=10的18次方个wei。要查看有多少个以太币，可以用web3.fromWei()将返回值换算成以太币： &gt; web3.fromWei(eth.getBalance(eth.accounts[0]),&#39;ether&#39;) 55 &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 35 发送交易 我们从账户0转移10个以太币到账户1,首先要解锁账户 0，才能发起交易： &gt; personal.unlockAccount(eth.accounts[0]) Unlock account 0xb5154c433e9bedabfdb3452c10114d5589b4b62f Passphrase: true 发起交易 &gt; amount = web3.toWei(10,&#39;ether&#39;) &quot;10000000000000000000&quot; &gt; eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:amount}) INFO [05-04|10:14:12.015] Submitted transaction fullhash=0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619 recipient=0xf4E122E28c5C6A84a20C1321147453cd46182464 &quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot; 查询 账户1 的余额： &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 35 发现账户余额没有发生改变，此时交易已经提交到区块链，但还未被处理，这可以通过用 txpool.status 命令可以看到本地交易池中有一个待确认的交易： &gt; txpool.status { pending: 1, queued: 0 } 其中有一条pending的交易，pending表示已提交但还未被处理的交易。 &gt; miner.start(1);admin.sleepBlocks(1);miner.stop(); 要使交易被处理，必须要挖矿。这里我们启动挖矿，然后等待挖到一个区块之后就停止挖矿： &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 50.000378 发现账户收到了账户的钱，还多了5个以太币。其实多出的5个以太币是挖矿奖励。 查看交易和区块 查看当前区块总数： &gt; eth.blockNumber 19 通过区块号查看区块： &gt; eth.getBlock(6) { difficulty: 131328, extraData: &quot;0xd98301080c846765746888676f312e31302e328664617277696e&quot;, gasLimit: 3160033, gasUsed: 0, hash: &quot;0x024dab0d1bb5da444b783bbc675940bdf92ea2c08c9eb6fb56db07740e47e57d&quot;, logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, miner: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, mixHash: &quot;0xc162ad888f90774d2b2acf1400e97a783d2a38b35d3e3498c3610adba54064dc&quot;, nonce: &quot;0x4898be8dcf2226ec&quot;, number: 6, parentHash: &quot;0x8788ca04121376a99d220621e0bc1a22a3d04d3e642fe0cb42fa8e5f3843cff0&quot;, receiptsRoot: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, size: 537, stateRoot: &quot;0x56abb05e0ca732749d0ee044e68d044b2a53cbd2570386f6537dd6682d409e73&quot;, timestamp: 1530670072, totalDifficulty: 918144, transactions: [], transactionsRoot: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, uncles: [] } 通过交易hash（hash 值包含在上面交易返回值中）查看交易： &gt; eth.getTransaction(&quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot;) { blockHash: &quot;0xfbc1a5183feec436f73c181e8f359cf55da6d45a1cb48c82da7c8678eee54a91&quot;, blockNumber: 19, from: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot;, input: &quot;0x&quot;, nonce: 0, r: &quot;0xd7c160e09190400d8d3139570f59b722c599f19f130bd317b4603452add36a84&quot;, s: &quot;0x3358fe8a438bd2645fa5bc4ea3ac55d213559c19493920d345685244b1408c0c&quot;, to: &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot;, transactionIndex: 0, v: &quot;0x100&quot;, value: 10000000000000000000 } 关注公众号 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/07/24/a7cb150f0e7f610766c2692da2fc9046.html" />
<meta property="og:url" content="https://mlh.app/2018/07/24/a7cb150f0e7f610766c2692da2fc9046.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-24T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"下载 $ mkdir -p $GOPATH/src/github.com/ethereum $ cd $GOPATH/src/github.com/ethereum $ git clone https://github.com/ethereum/go-ethereum.git 编译 $ cd go-ethereum $ make geth 将 geth 添加到环境变量中 vi ~/.bashrc export GETH=&quot;$GOPATH/src/github.com/ethereum/go-ethereum/build&quot; export PATH=&quot;$PATH:$GETH/bin&quot; 然后执行 source ~/.bashrc，使配置生效。 检查是否安装成功 geth --help 如果输出一些帮助提示命令，则说明安装成功。 搭建私有链 配置初始状态 要运行以太坊私有链，需要定义自己的创世区块，创世区块信息写在一个 JSON 格式的配置文件中。首先将下面的内容保存到一个 JSON 文件中，例如 genesis.json $ mkdir ~/privatechain $ cd privatechain $ mkdir data0 $ vi genesis.json genesis.json 的代码 { &quot;config&quot;: { &quot;chainId&quot;: 110, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;alloc&quot; : {}, &quot;coinbase&quot; : &quot;0x0000000000000000000000000000000000000000&quot;, &quot;difficulty&quot; : &quot;0x20000&quot;, &quot;extraData&quot; : &quot;&quot;, &quot;gasLimit&quot; : &quot;0x2fefd8&quot;, &quot;nonce&quot; : &quot;0x0000000000000042&quot;, &quot;mixhash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;parentHash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;timestamp&quot; : &quot;0x00&quot; } 其中，chainID 指定了独立的区块链网络 ID。网络 ID 在连接到其他节点的时候会用到，以太坊公网的网络 ID 是 1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络 ID。不同 ID 网络的节点无法相互连接。配置文件还对当前挖矿难度 difficulty、区块 Gas 消耗限制 gasLimit 等参数进行了设置。 初始化：写入创世区块 准备好创世区块配置文件后，需要初始化区块链，将上面的创世区块信息写入到区块链中。首先要新建一个目录用来存放区块链数据，假设新建的数据目录为 ~/privatechain/data0，genesis.json 保存在 ~/privatechain 中，此时目录结构应该是这样的： privatechain ├── data0 └── genesis.json 执行初始化命令： geth --datadir data0 init genesis.json 上面的命令的主体是 geth init，表示初始化区块链，命令可以带有选项和参数，其中 --datadir 选项后面跟一个目录名，这里为 data0，表示指定数据存放目录为 data0，genesis.json 是 init 命令的参数。 运行上面的命令，会读取 genesis.json 文件，根据其中的内容，将创世区块写入到区块链中。如果看到以下的输出内容，说明初始化成功了。 INFO [01-29|21:21:13] Maximum peer count ETH=25 LES=0 total=25 INFO [01-29|21:21:13] Allocated cache and file handles database=/Users/fujinliang/privatechain/data0/geth/chaindata cache=16 handles=16 INFO [01-29|21:21:13] Writing custom genesis block INFO [01-29|21:21:13] Persisted trie from memory database nodes=0 size=0.00B time=358.89µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [01-29|21:21:13] Successfully wrote genesis state database=chaindata hash=5e1fc7…d790e0 INFO [01-29|21:21:13] Allocated cache and file handles database=/Users/fujinliang/privatechain/data0/geth/lightchaindata cache=16 handles=16 INFO [01-29|21:21:13] Writing custom genesis block INFO [01-29|21:21:13] Persisted trie from memory database nodes=0 size=0.00B time=2.633µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [01-29|21:21:13] Successfully wrote genesis state database=lightchaindata hash=5e1fc7…d790e0 初始化成功后，会在数据目录 data0 中生成 geth 和 keystore 两个文件夹，此时目录结构如下： privatechain ├── data0 │ ├── geth │ │ ├── chaindata │ │ │ ├── 000001.log │ │ │ ├── CURRENT │ │ │ ├── LOCK │ │ │ ├── LOG │ │ │ └── MANIFEST-000000 │ │ └── lightchaindata │ │ ├── 000001.log │ │ ├── CURRENT │ │ ├── LOCK │ │ ├── LOG │ │ └── MANIFEST-000000 │ └── keystore └── genesis.json 其中 geth/chaindata 中存放的是区块数据，keystore 中存放的是账户数据。 启动私有链节点 geth --datadir data0 --networkid 110 console 上面命令的主体是 geth console，表示启动节点并进入交互式控制台，–datadir选项指定使用data0作为数据目录，--networkid 选项后面跟一个数字，这里是110，表示指定这个私有链的网络id为110。网络id在连接到其他节点的时候会用到，以太坊公网的网络id是1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络id。 运行上面的命令后，就启动了区块链节点并进入了该节点的控制台： ... Welcome to the Geth JavaScript console! instance: Geth/v1.8.10-unstable-ccc0debb/darwin-amd64/go1.10.2 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 控制台操作 进入以太坊 Javascript Console 后，就可以使用里面的内置对象做一些操作，这些内置对象提供的功能很丰富，比如查看区块和交易、创建账户、挖矿、发送交易、部署智能合约等。 常用命令有： personal.newAccount()：创建账户； personal.unlockAccount()：解锁账户； eth.accounts：枚举系统中的账户； eth.getBalance()：查看账户余额，返回值的单位是 Wei（Wei 是以太坊中最小货币面额单位，类似比特币中的聪，1 ether = 10^18 Wei）； eth.blockNumber：列出区块总数； eth.getTransaction()：获取交易； eth.getBlock()：获取区块； miner.start()：开始挖矿； miner.stop()：停止挖矿； eth.coinbase：挖矿奖励的账户 web3.fromWei()：Wei 换算成以太币； web3.toWei()：以太币换算成 Wei； txpool.status：交易池中的状态； admin.addPeer()：连接到其他节点； 创建账户 输入 eth.accounts 查询系统中的账户： &gt; eth.accounts [] 显示为 []，表示没有账户，接下来使用 personal.newAccount() 来创建一个账户： &gt; personal.newAccount() Passphrase: Repeat passphrase: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot; Passphrase 表示输入密码，Repeat passphrase 表示输入确认密码 再次创建一个账户 &gt; personal.newAccount() Passphrase: Repeat passphrase: &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot; 查看刚刚创建的用户： &gt; eth.accounts [&quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot;] 账户默认会保存在数据目录的 data0/keystore 文件夹中。可以查看其中的文件 { &quot;address&quot;: &quot;b5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, &quot;crypto&quot;: { &quot;cipher&quot;: &quot;aes-128-ctr&quot;, &quot;ciphertext&quot;: &quot;10206abe254d60e220ca788043bcd9a62c5d080f7310621c8f492237476dbd52&quot;, &quot;cipherparams&quot;: { &quot;iv&quot;: &quot;ca32c24a39f8af68d400a0351755ac9b&quot; }, &quot;kdf&quot;: &quot;scrypt&quot;, &quot;kdfparams&quot;: { &quot;dklen&quot;: 32, &quot;n&quot;: 262144, &quot;p&quot;: 1, &quot;r&quot;: 8, &quot;salt&quot;: &quot;3c2070da854a2a45ba0c770d78bd92207e64e3bf247ca47ad834c098b3b38478&quot; }, &quot;mac&quot;: &quot;a76a269824d16343a07893dc42ec14cbf477311968b1abc6927a088c39d750d7&quot; }, &quot;id&quot;: &quot;6419c0bd-be7e-4f78-a500-e2d345f6fd3f&quot;, &quot;version&quot;: 3 } 查看账户余额 通过 eth.getBalance() 可以查看账户余额 &gt; eth.getBalance(eth.accounts[0]) 0 &gt; eth.getBalance(eth.accounts[1]) 0 目前两个账户的以太币余额都是0，要使账户有余额，可以从其他账户转账过来，或者通过挖矿来获得以太币奖励。 启动&amp;停止挖矿 通过 miner.start() 启动挖矿 &gt; miner.start(3) 其中 start 的参数表示挖矿使用的线程数。第一次启动挖矿会先生成挖矿所需的 DAG 文件，这个过程有点慢，等进度达到 100% 后，就会开始挖矿，此时屏幕会被挖矿信息刷屏。 停止挖矿，在 console 中输入： miner.stop() 挖到一个区块会奖励5个以太币，挖矿所得的奖励会进入矿工的账户，这个账户叫做coinbase，默认情况下coinbase是本地账户中的第一个账户： &gt; eth.coinbase &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot; 可以通过 miner.setEtherbase() 将其他账户设置成 coinbase 即可 &gt; miner.setEtherbase(eth.accounts[1]) true &gt; eth.coinbase &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot; 重新启动挖矿，查看 eth.accounts[1] 是否可以获得以太币 &gt; miner.start(3) //等待几秒后 &gt; miner.stop() 查询账户余额： &gt; eth.getBalance(eth.accounts[0]) 55000000000000000000 &gt; eth.getBalance(eth.accounts[1]) 35000000000000000000 发现账户0 和 账号1 都有以太币，说明 miner.setEtherbase() 设置成功。 getBalance() 返回值的单位是wei，wei是以太币的最小单位，1个以太币=10的18次方个wei。要查看有多少个以太币，可以用web3.fromWei()将返回值换算成以太币： &gt; web3.fromWei(eth.getBalance(eth.accounts[0]),&#39;ether&#39;) 55 &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 35 发送交易 我们从账户0转移10个以太币到账户1,首先要解锁账户 0，才能发起交易： &gt; personal.unlockAccount(eth.accounts[0]) Unlock account 0xb5154c433e9bedabfdb3452c10114d5589b4b62f Passphrase: true 发起交易 &gt; amount = web3.toWei(10,&#39;ether&#39;) &quot;10000000000000000000&quot; &gt; eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:amount}) INFO [05-04|10:14:12.015] Submitted transaction fullhash=0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619 recipient=0xf4E122E28c5C6A84a20C1321147453cd46182464 &quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot; 查询 账户1 的余额： &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 35 发现账户余额没有发生改变，此时交易已经提交到区块链，但还未被处理，这可以通过用 txpool.status 命令可以看到本地交易池中有一个待确认的交易： &gt; txpool.status { pending: 1, queued: 0 } 其中有一条pending的交易，pending表示已提交但还未被处理的交易。 &gt; miner.start(1);admin.sleepBlocks(1);miner.stop(); 要使交易被处理，必须要挖矿。这里我们启动挖矿，然后等待挖到一个区块之后就停止挖矿： &gt; web3.fromWei(eth.getBalance(eth.accounts[1]),&#39;ether&#39;) 50.000378 发现账户收到了账户的钱，还多了5个以太币。其实多出的5个以太币是挖矿奖励。 查看交易和区块 查看当前区块总数： &gt; eth.blockNumber 19 通过区块号查看区块： &gt; eth.getBlock(6) { difficulty: 131328, extraData: &quot;0xd98301080c846765746888676f312e31302e328664617277696e&quot;, gasLimit: 3160033, gasUsed: 0, hash: &quot;0x024dab0d1bb5da444b783bbc675940bdf92ea2c08c9eb6fb56db07740e47e57d&quot;, logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, miner: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, mixHash: &quot;0xc162ad888f90774d2b2acf1400e97a783d2a38b35d3e3498c3610adba54064dc&quot;, nonce: &quot;0x4898be8dcf2226ec&quot;, number: 6, parentHash: &quot;0x8788ca04121376a99d220621e0bc1a22a3d04d3e642fe0cb42fa8e5f3843cff0&quot;, receiptsRoot: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, size: 537, stateRoot: &quot;0x56abb05e0ca732749d0ee044e68d044b2a53cbd2570386f6537dd6682d409e73&quot;, timestamp: 1530670072, totalDifficulty: 918144, transactions: [], transactionsRoot: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;, uncles: [] } 通过交易hash（hash 值包含在上面交易返回值中）查看交易： &gt; eth.getTransaction(&quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot;) { blockHash: &quot;0xfbc1a5183feec436f73c181e8f359cf55da6d45a1cb48c82da7c8678eee54a91&quot;, blockNumber: 19, from: &quot;0xb5154c433e9bedabfdb3452c10114d5589b4b62f&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619&quot;, input: &quot;0x&quot;, nonce: 0, r: &quot;0xd7c160e09190400d8d3139570f59b722c599f19f130bd317b4603452add36a84&quot;, s: &quot;0x3358fe8a438bd2645fa5bc4ea3ac55d213559c19493920d345685244b1408c0c&quot;, to: &quot;0xf4e122e28c5c6a84a20c1321147453cd46182464&quot;, transactionIndex: 0, v: &quot;0x100&quot;, value: 10000000000000000000 } 关注公众号 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/07/24/a7cb150f0e7f610766c2692da2fc9046.html","headline":"001 以太坊钱包开发-下载、编译 go-ethereum，搭建 eth 私有链","dateModified":"2018-07-24T00:00:00+08:00","datePublished":"2018-07-24T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/07/24/a7cb150f0e7f610766c2692da2fc9046.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>001 以太坊钱包开发-下载、编译 go-ethereum，搭建 eth 私有链</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h2 id="下载">下载</h2> 
  <pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-variable">$ </span>mkdir -p <span class="hljs-variable">$GOPATH</span>/src/github.com/ethereum
<span class="hljs-variable">$ </span>cd <span class="hljs-variable">$GOPATH</span>/src/github.com/ethereum
<span class="hljs-variable">$ </span>git clone <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/ethereum</span><span class="hljs-regexp">/go-ethereum.git</span></code></pre> 
  <h2 id="编译">编译</h2> 
  <pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-variable">$ </span>cd go-ethereum
<span class="hljs-variable">$ </span>make geth </code></pre> 
  <p>将 <code>geth</code> 添加到环境变量中 <code>vi ~/.bashrc</code></p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-keyword">export</span> GETH=<span class="hljs-string">"<span class="hljs-variable">$GOPATH</span>/src/github.com/ethereum/go-ethereum/build"</span>
<span class="hljs-keyword">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$GETH</span>/bin"</span></code></pre> 
  <p>然后执行 <code>source ~/.bashrc</code>，使配置生效。</p> 
  <p>检查是否安装成功</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">help</span></code></pre> 
  <p>如果输出一些帮助提示命令，则说明安装成功。</p> 
  <h2 id="搭建私有链">搭建私有链</h2> 
  <h3 id="配置初始状态">配置初始状态</h3> 
  <p>要运行以太坊私有链，需要定义自己的创世区块，创世区块信息写在一个 JSON 格式的配置文件中。首先将下面的内容保存到一个 JSON 文件中，例如 <code>genesis.json</code></p> 
  <pre class="prettyprint"><code class=" hljs smalltalk"><span class="hljs-char">$ </span>mkdir ~/privatechain
<span class="hljs-char">$ </span>cd privatechain
<span class="hljs-char">$ </span>mkdir data0
<span class="hljs-char">$ </span>vi genesis.json </code></pre> 
  <p><strong>genesis.json 的代码</strong></p> 
  <pre class="prettyprint"><code class=" hljs json">{
  "<span class="hljs-attribute">config</span>": <span class="hljs-value">{ "<span class="hljs-attribute">chainId</span>": <span class="hljs-value"><span class="hljs-number">110</span></span>, "<span class="hljs-attribute">homesteadBlock</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">eip155Block</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">eip158Block</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>}</span>,
  "<span class="hljs-attribute">alloc</span>"      : <span class="hljs-value">{}</span>,
  "<span class="hljs-attribute">coinbase</span>"   : <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000"</span></span>,
  "<span class="hljs-attribute">difficulty</span>" : <span class="hljs-value"><span class="hljs-string">"0x20000"</span></span>,
  "<span class="hljs-attribute">extraData</span>"  : <span class="hljs-value"><span class="hljs-string">""</span></span>,
  "<span class="hljs-attribute">gasLimit</span>"   : <span class="hljs-value"><span class="hljs-string">"0x2fefd8"</span></span>,
  "<span class="hljs-attribute">nonce</span>"      : <span class="hljs-value"><span class="hljs-string">"0x0000000000000042"</span></span>,
  "<span class="hljs-attribute">mixhash</span>"    : <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span></span>,
  "<span class="hljs-attribute">parentHash</span>" : <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span></span>,
  "<span class="hljs-attribute">timestamp</span>"  : <span class="hljs-value"><span class="hljs-string">"0x00"</span> </span>}</code></pre> 
  <p>其中，chainID 指定了独立的区块链网络 ID。网络 ID 在连接到其他节点的时候会用到，以太坊公网的网络 ID 是 1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络 ID。不同 ID 网络的节点无法相互连接。配置文件还对当前挖矿难度 difficulty、区块 Gas 消耗限制 gasLimit 等参数进行了设置。</p> 
  <h3 id="初始化写入创世区块">初始化：写入创世区块</h3> 
  <p>准备好创世区块配置文件后，需要初始化区块链，将上面的创世区块信息写入到区块链中。首先要新建一个目录用来存放区块链数据，假设新建的数据目录为 ~/privatechain/data0，genesis.json 保存在 ~/privatechain 中，此时目录结构应该是这样的：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">privatechain
├── data0
└── genesis<span class="hljs-preprocessor">.json</span></code></pre> 
  <p>执行初始化命令：</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-comment">data0</span> <span class="hljs-comment">init</span> <span class="hljs-comment">genesis</span><span class="hljs-string">.</span><span class="hljs-comment">json</span></code></pre> 
  <p>上面的命令的主体是 <code>geth init</code>，表示初始化区块链，命令可以带有选项和参数，其中 <code>--datadir</code> 选项后面跟一个目录名，这里为 <code>data0</code>，表示指定数据存放目录为 <code>data0</code>，<code>genesis.json</code> 是 <code>init</code> 命令的参数。</p> 
  <p>运行上面的命令，会读取 <code>genesis.json</code> 文件，根据其中的内容，将创世区块写入到区块链中。如果看到以下的输出内容，说明初始化成功了。</p> 
  <pre class="prettyprint"><code class=" hljs vbnet">INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Maximum peer count                       ETH=<span class="hljs-number">25</span> LES=<span class="hljs-number">0</span> total=<span class="hljs-number">25</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Allocated cache <span class="hljs-keyword">and</span> file <span class="hljs-keyword">handles</span>         database=/Users/fujinliang/privatechain/data0/geth/chaindata cache=<span class="hljs-number">16</span> <span class="hljs-keyword">handles</span>=<span class="hljs-number">16</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Writing <span class="hljs-keyword">custom</span> genesis block 
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Persisted trie <span class="hljs-keyword">from</span> memory database      nodes=<span class="hljs-number">0</span> size=<span class="hljs-number">0.00</span>B time=<span class="hljs-number">358.89</span>µs gcnodes=<span class="hljs-number">0</span> gcsize=<span class="hljs-number">0.00</span>B gctime=<span class="hljs-number">0</span>s livenodes=<span class="hljs-number">1</span> livesize=<span class="hljs-number">0.00</span>B
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Successfully wrote genesis state         database=chaindata                                           hash=<span class="hljs-number">5e1</span>fc7…d790e0
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Allocated cache <span class="hljs-keyword">and</span> file <span class="hljs-keyword">handles</span>         database=/Users/fujinliang/privatechain/data0/geth/lightchaindata cache=<span class="hljs-number">16</span> <span class="hljs-keyword">handles</span>=<span class="hljs-number">16</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Writing <span class="hljs-keyword">custom</span> genesis block 
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Persisted trie <span class="hljs-keyword">from</span> memory database      nodes=<span class="hljs-number">0</span> size=<span class="hljs-number">0.00</span>B time=<span class="hljs-number">2.633</span>µs  gcnodes=<span class="hljs-number">0</span> gcsize=<span class="hljs-number">0.00</span>B gctime=<span class="hljs-number">0</span>s livenodes=<span class="hljs-number">1</span> livesize=<span class="hljs-number">0.00</span>B
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">29</span>|<span class="hljs-number">21</span>:<span class="hljs-number">21</span>:<span class="hljs-number">13</span>] Successfully wrote genesis state         database=lightchaindata                                           hash=<span class="hljs-number">5e1</span>fc7…d790e0</code></pre> 
  <p>初始化成功后，会在数据目录 data0 中生成 geth 和 keystore 两个文件夹，此时目录结构如下：</p> 
  <pre class="prettyprint"><code class=" hljs vbscript">privatechain
├── data0
│   ├── geth
│   │   ├── chaindata
│   │   │   ├── <span class="hljs-number">000001.</span><span class="hljs-built_in">log</span>
│   │   │   ├── CURRENT
│   │   │   ├── LOCK
│   │   │   ├── <span class="hljs-built_in">LOG</span>
│   │   │   └── MANIFEST-<span class="hljs-number">000000</span>
│   │   └── lightchaindata
│   │       ├── <span class="hljs-number">000001.</span><span class="hljs-built_in">log</span>
│   │       ├── CURRENT
│   │       ├── LOCK
│   │       ├── <span class="hljs-built_in">LOG</span>
│   │       └── MANIFEST-<span class="hljs-number">000000</span>
│   └── keystore
└── genesis.json</code></pre> 
  <p>其中 <code>geth/chaindata</code> 中存放的是区块数据，<code>keystore</code> 中存放的是账户数据。</p> 
  <h3 id="启动私有链节点">启动私有链节点</h3> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-comment">data0</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">networkid</span> <span class="hljs-comment">110</span> <span class="hljs-comment">console</span></code></pre> 
  <p>上面命令的主体是 <code>geth console</code>，表示启动节点并进入交互式控制台，–datadir选项指定使用data0作为数据目录，<code>--networkid</code> 选项后面跟一个数字，这里是110，表示指定这个私有链的网络id为110。网络id在连接到其他节点的时候会用到，以太坊公网的网络id是1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络id。</p> 
  <p>运行上面的命令后，就启动了区块链节点并进入了该节点的控制台：</p> 
  <pre class="prettyprint"><code class=" hljs r"><span class="hljs-keyword">...</span>
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.10-unstable-ccc0debb/darwin-amd64/go1.10.2
 modules: admin:<span class="hljs-number">1.0</span> debug:<span class="hljs-number">1.0</span> eth:<span class="hljs-number">1.0</span> miner:<span class="hljs-number">1.0</span> net:<span class="hljs-number">1.0</span> personal:<span class="hljs-number">1.0</span> rpc:<span class="hljs-number">1.0</span> txpool:<span class="hljs-number">1.0</span> web3:<span class="hljs-number">1.0</span>

&gt; </code></pre> 
  <p>这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括：</p> 
  <ul> 
   <li>eth：包含一些跟操作区块链相关的方法；</li> 
   <li>net：包含一些查看p2p网络状态的方法；</li> 
   <li>admin：包含一些与管理节点相关的方法；</li> 
   <li>miner：包含启动&amp;停止挖矿的一些方法；</li> 
   <li>personal：主要包含一些管理账户的方法；</li> 
   <li>txpool：包含一些查看交易内存池的方法；</li> 
   <li>web3：包含了以上对象，还包含一些单位换算的方法。</li> 
  </ul> 
  <h2 id="控制台操作">控制台操作</h2> 
  <p>进入以太坊 Javascript Console 后，就可以使用里面的内置对象做一些操作，这些内置对象提供的功能很丰富，比如查看区块和交易、创建账户、挖矿、发送交易、部署智能合约等。</p> 
  <p>常用命令有：</p> 
  <ul> 
   <li>personal.newAccount()：创建账户；</li> 
   <li>personal.unlockAccount()：解锁账户；</li> 
   <li>eth.accounts：枚举系统中的账户；</li> 
   <li>eth.getBalance()：查看账户余额，返回值的单位是 Wei（Wei 是以太坊中最小货币面额单位，类似比特币中的聪，1 ether = 10^18 Wei）；</li> 
   <li>eth.blockNumber：列出区块总数；</li> 
   <li>eth.getTransaction()：获取交易；</li> 
   <li>eth.getBlock()：获取区块；</li> 
   <li>miner.start()：开始挖矿；</li> 
   <li>miner.stop()：停止挖矿；</li> 
   <li>eth.coinbase：挖矿奖励的账户</li> 
   <li>web3.fromWei()：Wei 换算成以太币；</li> 
   <li>web3.toWei()：以太币换算成 Wei；</li> 
   <li>txpool.status：交易池中的状态；</li> 
   <li>admin.addPeer()：连接到其他节点；</li> 
  </ul> 
  <h3 id="创建账户">创建账户</h3> 
  <p>输入 <code>eth.accounts</code> 查询系统中的账户：</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; eth.accounts</span>
[]</code></pre> 
  <p>显示为 <code>[]</code>，表示没有账户，接下来使用 <code>personal.newAccount()</code> 来创建一个账户：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; personal<span class="hljs-preprocessor">.newAccount</span>()
<span class="hljs-label">Passphrase:</span> 
Repeat passphrase: 
<span class="hljs-string">"0xb5154c433e9bedabfdb3452c10114d5589b4b62f"</span></code></pre> 
  <p><code>Passphrase</code> 表示输入密码，<code>Repeat passphrase</code> 表示输入确认密码</p> 
  <p>再次创建一个账户</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; personal<span class="hljs-preprocessor">.newAccount</span>()
<span class="hljs-label">Passphrase:</span> 
Repeat passphrase: 
<span class="hljs-string">"0xf4e122e28c5c6a84a20c1321147453cd46182464"</span></code></pre> 
  <p>查看刚刚创建的用户：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.accounts</span>
[<span class="hljs-string">"0xb5154c433e9bedabfdb3452c10114d5589b4b62f"</span>, <span class="hljs-string">"0xf4e122e28c5c6a84a20c1321147453cd46182464"</span>]</code></pre> 
  <p>账户默认会保存在数据目录的 <code>data0/keystore</code> 文件夹中。可以查看其中的文件</p> 
  <pre class="prettyprint"><code class=" hljs json">{
    "<span class="hljs-attribute">address</span>": <span class="hljs-value"><span class="hljs-string">"b5154c433e9bedabfdb3452c10114d5589b4b62f"</span></span>, 
    "<span class="hljs-attribute">crypto</span>": <span class="hljs-value">{ "<span class="hljs-attribute">cipher</span>": <span class="hljs-value"><span class="hljs-string">"aes-128-ctr"</span></span>, "<span class="hljs-attribute">ciphertext</span>": <span class="hljs-value"><span class="hljs-string">"10206abe254d60e220ca788043bcd9a62c5d080f7310621c8f492237476dbd52"</span></span>, "<span class="hljs-attribute">cipherparams</span>": <span class="hljs-value">{ "<span class="hljs-attribute">iv</span>": <span class="hljs-value"><span class="hljs-string">"ca32c24a39f8af68d400a0351755ac9b"</span> </span>}</span>, "<span class="hljs-attribute">kdf</span>": <span class="hljs-value"><span class="hljs-string">"scrypt"</span></span>, "<span class="hljs-attribute">kdfparams</span>": <span class="hljs-value">{ "<span class="hljs-attribute">dklen</span>": <span class="hljs-value"><span class="hljs-number">32</span></span>, "<span class="hljs-attribute">n</span>": <span class="hljs-value"><span class="hljs-number">262144</span></span>, "<span class="hljs-attribute">p</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>, "<span class="hljs-attribute">r</span>": <span class="hljs-value"><span class="hljs-number">8</span></span>, "<span class="hljs-attribute">salt</span>": <span class="hljs-value"><span class="hljs-string">"3c2070da854a2a45ba0c770d78bd92207e64e3bf247ca47ad834c098b3b38478"</span> </span>}</span>, "<span class="hljs-attribute">mac</span>": <span class="hljs-value"><span class="hljs-string">"a76a269824d16343a07893dc42ec14cbf477311968b1abc6927a088c39d750d7"</span> </span>}</span>, 
    "<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-string">"6419c0bd-be7e-4f78-a500-e2d345f6fd3f"</span></span>, 
    "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-number">3</span> </span>}</code></pre> 
  <h3 id="查看账户余额">查看账户余额</h3> 
  <p>通过 <code>eth.getBalance()</code> 可以查看账户余额</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
<span class="hljs-number">0</span>
&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>])
<span class="hljs-number">0</span></code></pre> 
  <p>目前两个账户的以太币余额都是0，要使账户有余额，可以从其他账户转账过来，或者通过挖矿来获得以太币奖励。</p> 
  <h3 id="启动停止挖矿">启动&amp;停止挖矿</h3> 
  <p>通过 <code>miner.start()</code> 启动挖矿</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start(3)</span></code></pre> 
  <p>其中 start 的参数表示挖矿使用的线程数。第一次启动挖矿会先生成挖矿所需的 DAG 文件，这个过程有点慢，等进度达到 100% 后，就会开始挖矿，此时屏幕会被挖矿信息刷屏。</p> 
  <p>停止挖矿，在 console 中输入：</p> 
  <pre class="prettyprint"><code class=" hljs vbnet">miner.<span class="hljs-keyword">stop</span>()</code></pre> 
  <p>挖到一个区块会奖励5个以太币，挖矿所得的奖励会进入矿工的账户，这个账户叫做coinbase，默认情况下coinbase是本地账户中的第一个账户：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0xb5154c433e9bedabfdb3452c10114d5589b4b62f"</span></code></pre> 
  <p>可以通过 <code>miner.setEtherbase()</code> 将其他账户设置成 <code>coinbase</code> 即可</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; miner<span class="hljs-preprocessor">.setEtherbase</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>])
true
&gt; eth<span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0xf4e122e28c5c6a84a20c1321147453cd46182464"</span></code></pre> 
  <p>重新启动挖矿，查看 <code>eth.accounts[1]</code> 是否可以获得以太币</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start(3)</span>

//等待几秒后
<span class="hljs-blockquote">&gt; miner.stop()</span></code></pre> 
  <p>查询账户余额：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
<span class="hljs-number">55000000000000000000</span>
&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>])
<span class="hljs-number">35000000000000000000</span></code></pre> 
  <p>发现账户0 和 账号1 都有以太币，说明 <code>miner.setEtherbase()</code> 设置成功。</p> 
  <p><code>getBalance()</code> 返回值的单位是wei，wei是以太币的最小单位，1个以太币=10的18次方个wei。要查看有多少个以太币，可以用web3.fromWei()将返回值换算成以太币：</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; web3.fromWei(eth.getBalance(eth.accounts[<span class="hljs-number">0</span>]),<span class="hljs-string">'ether'</span>)
<span class="hljs-number">55</span>

&gt; web3.fromWei(eth.getBalance(eth.accounts[<span class="hljs-number">1</span>]),<span class="hljs-string">'ether'</span>)
<span class="hljs-number">35</span></code></pre> 
  <h3 id="发送交易">发送交易</h3> 
  <p>我们从账户0转移10个以太币到账户1,首先要解锁账户 0，才能发起交易：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; personal<span class="hljs-preprocessor">.unlockAccount</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
Unlock account <span class="hljs-number">0xb5154c433e9bedabfdb3452c10114d5589b4b62f</span>
<span class="hljs-label">Passphrase:</span> 
true</code></pre> 
  <p>发起交易</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; amount = web3.toWei(<span class="hljs-number">10</span>,<span class="hljs-string">'ether'</span>)
<span class="hljs-string">"10000000000000000000"</span>
&gt; eth.sendTransaction({<span class="hljs-built_in">from</span>:eth.accounts[<span class="hljs-number">0</span>],<span class="hljs-built_in">to</span>:eth.accounts[<span class="hljs-number">1</span>],<span class="hljs-built_in">value</span>:amount})

INFO [<span class="hljs-number">05</span>-<span class="hljs-number">04</span>|<span class="hljs-number">10</span>:<span class="hljs-number">14</span>:<span class="hljs-number">12.015</span>] Submitted transaction                    fullhash=<span class="hljs-number">0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619</span> recipient=<span class="hljs-number">0xf4E122E28c5C6A84a20C1321147453cd46182464</span>
<span class="hljs-string">"0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619"</span></code></pre> 
  <p>查询 账户1 的余额：</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; web3.fromWei(eth.getBalance(eth.accounts[<span class="hljs-number">1</span>]),<span class="hljs-string">'ether'</span>)
<span class="hljs-number">35</span></code></pre> 
  <p>发现账户余额没有发生改变，此时交易已经提交到区块链，但还未被处理，这可以通过用 <code>txpool.status</code> 命令可以看到本地交易池中有一个待确认的交易：</p> 
  <pre class="prettyprint"><code class=" hljs css">&gt; <span class="hljs-tag">txpool</span><span class="hljs-class">.status</span>
<span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">pending</span>:<span class="hljs-value"> <span class="hljs-number">1</span>, queued: <span class="hljs-number">0</span> </span></span></span>}</code></pre> 
  <p>其中有一条pending的交易，pending表示已提交但还未被处理的交易。</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start(1);admin.sleepBlocks(1);miner.stop();</span></code></pre> 
  <p>要使交易被处理，必须要挖矿。这里我们启动挖矿，然后等待挖到一个区块之后就停止挖矿：</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; web3.fromWei(eth.getBalance(eth.accounts[<span class="hljs-number">1</span>]),<span class="hljs-string">'ether'</span>)

<span class="hljs-number">50.000378</span></code></pre> 
  <p>发现账户收到了账户的钱，还多了5个以太币。其实多出的5个以太币是挖矿奖励。</p> 
  <h3 id="查看交易和区块">查看交易和区块</h3> 
  <p>查看当前区块总数：</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; eth.blockNumber</span>
19</code></pre> 
  <p>通过区块号查看区块：</p> 
  <pre class="prettyprint"><code class=" hljs css">&gt; <span class="hljs-tag">eth</span><span class="hljs-class">.getBlock</span>(6)

<span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">difficulty</span>:<span class="hljs-value"> <span class="hljs-number">131328</span>, extraData: <span class="hljs-string">"0xd98301080c846765746888676f312e31302e328664617277696e"</span>, gasLimit: <span class="hljs-number">3160033</span>, gasUsed: <span class="hljs-number">0</span>, hash: <span class="hljs-string">"0x024dab0d1bb5da444b783bbc675940bdf92ea2c08c9eb6fb56db07740e47e57d"</span>, logsBloom: <span class="hljs-string">"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>, miner: <span class="hljs-string">"0xb5154c433e9bedabfdb3452c10114d5589b4b62f"</span>, mixHash: <span class="hljs-string">"0xc162ad888f90774d2b2acf1400e97a783d2a38b35d3e3498c3610adba54064dc"</span>, nonce: <span class="hljs-string">"0x4898be8dcf2226ec"</span>, number: <span class="hljs-number">6</span>, parentHash: <span class="hljs-string">"0x8788ca04121376a99d220621e0bc1a22a3d04d3e642fe0cb42fa8e5f3843cff0"</span>, receiptsRoot: <span class="hljs-string">"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421"</span>, sha3Uncles: <span class="hljs-string">"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"</span>, size: <span class="hljs-number">537</span>, stateRoot: <span class="hljs-string">"0x56abb05e0ca732749d0ee044e68d044b2a53cbd2570386f6537dd6682d409e73"</span>, timestamp: <span class="hljs-number">1530670072</span>, totalDifficulty: <span class="hljs-number">918144</span>, transactions: [], transactionsRoot: <span class="hljs-string">"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421"</span>, uncles: [] </span></span></span>}</code></pre> 
  <p>通过交易hash（hash 值包含在上面交易返回值中）查看交易：</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; eth.getTransaction(<span class="hljs-string">"0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619"</span>)
{
  blockHash: <span class="hljs-string">"0xfbc1a5183feec436f73c181e8f359cf55da6d45a1cb48c82da7c8678eee54a91"</span>,
  blockNumber: <span class="hljs-number">19</span>,
  <span class="hljs-built_in">from</span>: <span class="hljs-string">"0xb5154c433e9bedabfdb3452c10114d5589b4b62f"</span>,
  gas: <span class="hljs-number">90000</span>,
  gasPrice: <span class="hljs-number">18000000000</span>,
  hash: <span class="hljs-string">"0x947b2a4e384b9ba110b05b8e150d6a28fb7c9354f50cc532e494a9b338774619"</span>,
  input: <span class="hljs-string">"0x"</span>,
  nonce: <span class="hljs-number">0</span>,
  r: <span class="hljs-string">"0xd7c160e09190400d8d3139570f59b722c599f19f130bd317b4603452add36a84"</span>,
  s: <span class="hljs-string">"0x3358fe8a438bd2645fa5bc4ea3ac55d213559c19493920d345685244b1408c0c"</span>,
  <span class="hljs-built_in">to</span>: <span class="hljs-string">"0xf4e122e28c5c6a84a20c1321147453cd46182464"</span>,
  transactionIndex: <span class="hljs-number">0</span>,
  v: <span class="hljs-string">"0x100"</span>,
  <span class="hljs-built_in">value</span>: <span class="hljs-number">10000000000000000000</span>
}</code></pre> 
  <blockquote> 
   <p>关注公众号 <br> <img src="http://olgjbx93m.bkt.clouddn.com/wx_1.jpg" alt="关注公众号" title=""></p> 
  </blockquote> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lengxue789/article/details/81178314,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lengxue789/article/details/81178314,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

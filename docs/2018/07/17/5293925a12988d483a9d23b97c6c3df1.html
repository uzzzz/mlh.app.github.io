<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>用java手把手教你写比特币底层源码 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="用java手把手教你写比特币底层源码" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一丶区块链V1保存字符串 本模块实现简单功能, 使用传统技术实现一个账本功能 1.实现添加和查询功能 // 生活中的账本 = 区块链 public class NoteBook { &nbsp;&nbsp;&nbsp; // 用于保存数据的集合 &nbsp;&nbsp;&nbsp; private ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); &nbsp;&nbsp;&nbsp; // 添加封面 = 创世区块 &nbsp;&nbsp;&nbsp; // 添加封面的时候,必须保证账本是新的 &nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 添加交易记录 = 普通区块 &nbsp;&nbsp;&nbsp; // 添加交易记录的时候,必须保证账本已经有封面了 &nbsp;&nbsp;&nbsp; private void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp; private void showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String s : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(s); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 保存到本地硬盘 &nbsp;&nbsp;&nbsp; private void save2Disk() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = new NoteBook(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addGenesis(&quot;封面&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addNote(&quot;222给2转账了一百块钱&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.showlist(); &nbsp;&nbsp;&nbsp; } } 2.实现保存功能 增加加载本地数据的方法 &nbsp;private void loadFile() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File(&quot;a.json&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断文件是否存在 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (file.exists() &amp;&amp; file.length() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; 如果文件存在,读取之前的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javatype = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, String.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = objectMapper.readValue(file, javatype); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 在构造函数中加载本地数据 &nbsp;&nbsp;&nbsp; public NoteBook() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile(); &nbsp;&nbsp;&nbsp; } 增加保存数据到本地的方法 &nbsp;&nbsp;&nbsp; // 保存数据到本地硬盘 &nbsp;&nbsp;&nbsp; private void save2Disk() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File(&quot;a.json&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objectMapper.writeValue(file, list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 在添加数据时, 调用保存方法 &nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } &nbsp;&nbsp;&nbsp; private void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } 二丶区块链V2增加Http访问接口 本模块为账本功能提供网络接口, 使用户可以通过页面对账本进行增删改查的操作 1.增加网络访问接口 @RestController public class BlockController { &nbsp;&nbsp;&nbsp; private NoteBook book = new NoteBook(); &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addGenesis&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addGenesis(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/showlist&quot;, method = RequestMethod.GET) &nbsp;&nbsp;&nbsp; public ArrayList&lt;String&gt; showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return book.showlist(); &nbsp;&nbsp;&nbsp; } } 2.增加前台页面 引入资料中的静态资源 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &nbsp;&nbsp;&nbsp; &lt;meta charset=&quot;utf-8&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;title&gt;&lt;/title&gt; &nbsp;&nbsp;&nbsp; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/bootstrap.css&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/pb.css&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;style type=&quot;text/css&quot;&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; body { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; margin: 30px; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #result { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; padding: 15px; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;!--输入框--&gt; &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;inputCtr&quot; placeholder=&quot;请输入内容&quot; style=&quot;width: 600px&quot;&gt; &lt;br&gt; &lt;!--按钮组--&gt; &lt;div class=&quot;btn-group btn-group-lg&quot; role=&quot;group&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;addGenesis()&quot;&gt;添加封面&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;addNote()&quot;&gt;添加记录&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;showlist()&quot;&gt;展示数据&lt;/button&gt; &lt;/div&gt; &lt;br&gt; &lt;!--用于展示结果--&gt; &lt;p class=&quot;bg-info&quot; id=&quot;result&quot;&gt; &lt;/p&gt; &lt;script src=&quot;js/jquery-1.12.4.min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/bootstrap.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/pb.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/jsrsasign-all-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; // 添加封面 &nbsp;&nbsp;&nbsp; function addGenesis() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;/addGenesis&quot;, &quot;genesis=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;$(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 添加记录 &nbsp;&nbsp;&nbsp; function addNote() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;/addNote&quot;, &quot;note=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp; function showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;/showlist&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 页面加载成功后,查询已有数据 &nbsp;&nbsp;&nbsp; $(function () { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp; }) &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 3.进度条控件的使用 拷贝资源pb.css和pb.js 将CSS和Js文件引入页面 示例代码 loading.baosight.showPageLoadingMsg(false) // 显示进度条 loading.baosight.hidePageLoadingMsg() // 隐藏进度条 三丶区块链V3增加Hash校验 上一小节实现的功能,很容易导致黑客攻击,篡改数据,这一小节,为数据增加Hash校验功能,增加黑客攻击的难度. 1.创建Block实体类 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp; } } 2.Notebook中增加校验方法 &nbsp;&nbsp;&nbsp; // 校验数据 &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + block.id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); } 3.Controller中增加方法 &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/check&quot;, method = RequestMethod.GET) &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String check = book.check(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (StringUtils.isEmpty(check)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;数据是安全的&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return check; &nbsp;&nbsp;&nbsp; } 4.页面中增加表格用于展示数据 &lt;table class=&quot;table&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;thead&gt; &nbsp;&nbsp;&nbsp; &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; &nbsp;&nbsp;&nbsp; &lt;/thead&gt; &nbsp;&nbsp;&nbsp; &lt;tbody id=&quot;idTbody&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;/tbody&gt; &lt;/table&gt; 5.修改页面显示数据的逻辑 function showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idInput&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;showlist&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idTbody&quot;).html(&quot;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历数据,添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var i = 0; i &lt; data.length; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var id = data[i].id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = data[i].content &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var hash = data[i].hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } 6.页面中增加校验数据的逻辑 &nbsp;// 校验数据 &nbsp;&nbsp;&nbsp; function check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;// 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;check&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 四丶区块链V4增加工作量证明 上一小节增加Hash校验后,如果黑客在篡改数据的同时,又修改了Hash,就无法达到保护数据的目的.因此本节,增加工作量证明,即生成的Hash必须符合特定的规则,如必须以0000开头.这个获取特定Hash的过程就是比特币中的挖矿. 1.修改实体类,增加工作量证明字段 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public int nonce; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce; &nbsp;&nbsp;&nbsp; } } 2.Notebook中增加挖矿方法 &nbsp;// 挖矿 &nbsp;&nbsp;&nbsp; private int mine(String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 求取一个符合特定规则的hash值,并将运算次数返回 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String s = HashUtils.sha256(i + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (s.startsWith(&quot;0000&quot;)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;挖矿成功:&quot; + i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return i; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;挖矿失败:&quot; + i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;挖矿失败&quot;); &nbsp;&nbsp;&nbsp; } 3.Notebook中修改添加的逻辑 &nbsp;int nonce = mine(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + genesis), nonce); 4.Notebook中修改校验的逻辑 &nbsp;// 校验数据 &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 工作量证明 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = block.nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(nonce + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;sb.append(&quot;编号为&quot; + block.id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); } 5.修改页面,表格增加列 &lt;table class=&quot;table&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;thead&gt; &nbsp;&nbsp;&nbsp; &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; &nbsp;&nbsp;&nbsp; &lt;/thead&gt; &nbsp;&nbsp;&nbsp; &lt;tbody id=&quot;idTbody&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;/tbody&gt; &lt;/table&gt; 6.修改页面,展示数据的逻辑 $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;td&gt;&quot; + nonce + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) 五丶区块链V4形成区块链 本节继续增加黑客攻击的难度, 每个区块都持有上个区块的Hash值,互相咬合,形成一个链条.这样当链条足够长的时候,会大大增加黑客攻击的难度. 1.修改实体类,增加preHash字段 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public int nonce; &nbsp;&nbsp;&nbsp; public String preHash; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce, String preHash) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.preHash = preHash; &nbsp;&nbsp;&nbsp; } } 2.Notebook中修改添加的逻辑 &nbsp;public void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + preHash + genesis), nonce, preHash); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } &nbsp;&nbsp;&nbsp; public void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(list.size() - 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = preBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, note, HashUtils.sha256(nonce + preHash + note), nonce, preHash); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); &nbsp;&nbsp;&nbsp; } 3.Notebook中修改校验的逻辑 public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; list.size(); i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block currentBlock = list.get(i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String savedHash = currentBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = currentBlock.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = currentBlock.nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = currentBlock.preHash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int id = currentBlock.id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (i == 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创世区块,校验hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preHash = &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 其他区块,校验hash,preHash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的hash有问题,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(i - 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preBlockHash = preBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!preBlockHash.equals(preHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的preHash有问题,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); &nbsp;&nbsp;&nbsp; } 4.修改页面,表格增加列 &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;上一个Hash&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; 5.修改页面,展示数据的逻辑 $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;td&gt;&quot; + nonce + &quot;&lt;/td&gt;&lt;td&gt;&quot; + preHash + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) 六丶钱包功能 前面的章节,存储数据时,直接可见转账双方的信息,本节通过非对称加密技术和签名技术隐藏交易双方的真实信息. 可以简单理解为 非对称加密中的公钥就是钱包地址,非对称加密中的私钥就是钱包的密码. 1.钱包实体类 public class Wallet { &nbsp;&nbsp;&nbsp; // 公钥 &nbsp;&nbsp;&nbsp; public PublicKey publicKey; &nbsp;&nbsp;&nbsp; // 私钥 &nbsp;&nbsp;&nbsp; public PrivateKey privateKey;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; public Wallet(String name) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 保存公私钥的文件 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File pubFile = new File(name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File priFile = new File(name + &quot;.pri&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 如果文件不存在,说明没有公私钥,就创建公私钥文件 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!pubFile.exists() || pubFile.length() == 0 || !priFile.exists() || priFile.length() == 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSAUtils.generateKeys(&quot;RSA&quot;, name + &quot;.pri&quot;, name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 从文件中读取公私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; publicKey = RSAUtils.getPublicKeyFromFile(&quot;RSA&quot;, name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privateKey = RSAUtils.getPrivateKey(&quot;RSA&quot;, name + &quot;.pri&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 转账 &nbsp;&nbsp;&nbsp; public Transaction sendMoney(String receiverPublickKey, String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将公钥转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String publicKeyEncode = Base64.encode(publicKey.getEncoded()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String signature = RSAUtils.getSignature(&quot;SHA256withRSA&quot;, privateKey, content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成交易对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = new Transaction(publicKeyEncode, receiverPublickKey, signature, content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return transaction; &nbsp;&nbsp;&nbsp; } } 2.交易实体类 public class Transaction { &nbsp;&nbsp;&nbsp; // 付款方的公钥 &nbsp;&nbsp;&nbsp; public String senderPublickKey; &nbsp;&nbsp;&nbsp; // 收款方的公钥 &nbsp;&nbsp;&nbsp; public String receiverPublickKey; &nbsp;&nbsp;&nbsp; // 签名 &nbsp;&nbsp;&nbsp; public String signature; &nbsp;&nbsp;&nbsp; // 转账信息 &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public Transaction() { &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public Transaction(String senderPublickKey, String receiverPublickKey, String signature, String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 校验交易是否正确 &nbsp;&nbsp;&nbsp; public boolean verify() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey sender = RSAUtils.getPublicKeyFromString(&quot;RSA&quot;, senderPublickKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return RSAUtils.verify(&quot;SHA256withRSA&quot;, sender, content, signature); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getSenderPublickKey() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return senderPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setSenderPublickKey(String senderPublickKey) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getReceiverPublickKey() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return receiverPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setReceiverPublickKey(String receiverPublickKey) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getSignature() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setSignature(String signature) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getContent() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setContent(String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public String toString() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;Transaction{&quot; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;senderPublickKey=&#39;&quot; + senderPublickKey + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, receiverPublickKey=&#39;&quot; + receiverPublickKey + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, signature=&#39;&quot; + signature + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;}&#39;; &nbsp;&nbsp;&nbsp; } } 七丶区块链V5增加转账功能 本小节实现网页转账的功能 jsrsasign插件 : https://github.com/kjur/jsrsasign 1.在页面引入插件 &lt;script src=&quot;js/jsrsasign-all-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; 2.修改页面,增加输入key的文本域 &lt;label&gt; &nbsp;&nbsp;&nbsp; 发送方的私钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;senderPrivateKey&quot;&gt; &lt;/textarea&gt; &lt;label&gt; &nbsp;&nbsp;&nbsp; 发送方的公钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;senderPublicKey&quot;&gt; &lt;/textarea&gt;&lt;label&gt; &nbsp;&nbsp;&nbsp; 接收方的公钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;receiverPublicKey&quot;&gt; &lt;/textarea&gt; &lt;label&gt; &nbsp;&nbsp;&nbsp; 转账信息 &lt;/label&gt; 3.修改页面添加记录的逻辑 &nbsp;function addNote() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取输入框的内容 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var senderPrivateKey = $(&quot;#senderPrivateKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var senderPublicKey = $(&quot;#senderPublicKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var receiverPublicKey = $(&quot;#receiverPublicKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idInput&quot;).val() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var prvKey = KEYUTIL.getKey(senderPrivateKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定生成签名使用的算法 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sig = new KJUR.crypto.Signature({&quot;alg&quot;: &quot;SHA256withRSA&quot;}); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 初始化私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.init(prvKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.updateString(content) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sigValueHex = sig.sign() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;addNote&quot;, { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; senderPublickKey: senderPublicKey, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; receiverPublickKey: receiverPublicKey, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature: sigValueHex, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: content, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idInput&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 4.修改RsaUtils,增加js生成签名,验证签名的方法 &nbsp;/** &nbsp;&nbsp;&nbsp;&nbsp; * 生成公私钥,并保存在文件中,JS版本 &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 算法 &nbsp;&nbsp;&nbsp;&nbsp; * @param privateKeyPath : 保存私钥的文件路径 &nbsp;&nbsp;&nbsp;&nbsp; * @param publicKeyPath&nbsp; : 保存公钥的文件路径 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public static void generateKeysJS(String algorithm, String privateKeyPath, String publicKeyPath) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPair keyPair = keyPairGenerator.generateKeyPair(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PrivateKey privateKey = keyPair.getPrivate(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey publicKey = keyPair.getPublic(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] privateKeyEncoded = privateKey.getEncoded(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] publicKeyEncoded = publicKey.getEncoded(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePrivateKey = Base64.encode(privateKeyEncoded); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePublicKey = Base64.encode(publicKeyEncoded); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(privateKeyPath), &quot;-----BEGIN PRIVATE KEY-----\n&quot; + encodePrivateKey + &quot;\n-----END PRIVATE KEY-----&quot;, &quot;UTF-8&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(publicKeyPath), encodePublicKey, &quot;UTF-8&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; /** &nbsp;&nbsp;&nbsp;&nbsp; * 校验签名,JS版本 &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 加密算法(SHA256withRSA) &nbsp;&nbsp;&nbsp;&nbsp; * @param publicKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 公钥 &nbsp;&nbsp;&nbsp;&nbsp; * @param originalData&nbsp;&nbsp; : 原文 &nbsp;&nbsp;&nbsp;&nbsp; * @param signaturedData : 签名 &nbsp;&nbsp;&nbsp;&nbsp; * @return : 签名是否正确 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public static boolean verifyDataJS(String algorithm, PublicKey publicKey, String originalData, String signaturedData) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取签名对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Signature signature = Signature.getInstance(algorithm); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入公钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.initVerify(publicKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.update(originalData.getBytes()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature.verify(toBytes(signaturedData)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; //转换方法 &nbsp;&nbsp;&nbsp; public static byte[] toBytes(String str) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (str == null || trim(str) == &quot;&quot;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new byte[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] bytes = new byte[str.length() / 2]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; str.length() / 2; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String subStr = str.substring(i * 2, i * 2 + 2); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes[i] = (byte) Integer.parseInt(subStr, 16); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return bytes; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public static String trim(String str) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int startIndex = 0; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int endIndex = str.length() - 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean startFound = false; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (startIndex &lt;= endIndex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int index; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = startIndex; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = endIndex; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char it = str.charAt(index); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean match = it &lt;= &#39; &#39;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startFound = true; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startIndex += 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endIndex -= 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return str.substring(startIndex, endIndex + 1); &nbsp;&nbsp;&nbsp; } 修改Controller,添加记录的逻辑 &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;交易数据校验失败&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } } 八丶WebSocket简介 &nbsp; 前面的章节章节中,我们的转账信息和生成的区块只是保存在本地,事实上我们需要把这些信息广播出去,告知其他节点.其他节点上的转账信息和生成的区块也要告知我们,这样我们就需要通过WebSocket和其他节点之间进行通信. WebSocket是一种通信协议,可以实现双向通信. 具体介绍 : http://www.ruanyifeng.com/blog/2017/05/websocket.html 本项目使用Java WebSockets框架. https://github.com/TooTallNate/Java-WebSocket 快速入门案例 1.引入坐标 compile &quot;org.java-websocket:Java-WebSocket:1.3.8&quot; 2.创建Server public class MyServer extends WebSocketServer { &nbsp;&nbsp;&nbsp; // 服务器端口 &nbsp;&nbsp;&nbsp; private int port; &nbsp;&nbsp;&nbsp; public MyServer(int port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(new InetSocketAddress(port)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.port = port; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onOpen(WebSocket conn, ClientHandshake handshake) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__打开了一个连接,对方是:&quot; + conn.getRemoteSocketAddress().toString()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onClose(WebSocket conn, int code, String reason, boolean remote) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__关闭了一个连接,对方是:&quot; + conn.getRemoteSocketAddress().toString()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onMessage(WebSocket conn, String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__收到了消息,对方是:&quot; + conn.getRemoteSocketAddress().toString() + &quot;__消息的内容是:&quot; + message); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onError(WebSocket conn, Exception ex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__发生了错误__原因:&quot; + ex.getMessage()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onStart() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__启动成功&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 开启服务器 &nbsp;&nbsp;&nbsp; public void startServer() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new Thread(this).start(); &nbsp;&nbsp;&nbsp; } } 3.创建Client public class MyClient extends WebSocketClient { &nbsp;&nbsp;&nbsp; private String name; &nbsp;&nbsp;&nbsp; /** &nbsp;&nbsp;&nbsp;&nbsp; * @param serverUri : 要连接的服务器的地址 &nbsp;&nbsp;&nbsp;&nbsp; * @param name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 本客户端的名字 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public MyClient(URI serverUri, String name) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(serverUri); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.name = name; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onOpen(ServerHandshake handshakedata) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_连接成功&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onClose(int code, String reason, boolean remote) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_连接关闭&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onError(Exception ex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_发生错误&quot;); &nbsp;&nbsp;&nbsp; } } 4.创建测试类 public class MyTest { &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建并开启服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyServer server = new MyServer(8000); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定服务器地址 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI(&quot;ws://localhost:8000&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建客户端 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client1 = new MyClient(uri, &quot;1111&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client2 = new MyClient(uri, &quot;2222&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端连接服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client2.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 避免连接尚未成功,就发送消息,导致的发送失败 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 服务器发送广播 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; server.broadcast(&quot;这是来自服务器的广播&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端发送消息给服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.send(&quot;这是一号客户端发送的消息&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } } 九丶SpringBoot集成WebSocket 1.修改Application类,可以手动指定启动端口号 public class WsdemoApplication { &nbsp;&nbsp;&nbsp; public static String port; &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户输入的内容,作为端口号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scanner scanner = new Scanner(System.in); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = scanner.nextLine(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 启动应用 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new SpringApplicationBuilder(WsdemoApplication.class).properties(&quot;server.port=&quot; + port).run(args); &nbsp;&nbsp;&nbsp; } } 2.修改Springboot配置,使其可以开启多实例 编辑配置 &nbsp; 找到对应的Application类,修改配置 3.创建Controller,实现注册节点 / 连接 / 广播功能 @RestController public class DemoController { &nbsp;&nbsp;&nbsp; private MyServer server; &nbsp;&nbsp;&nbsp; // 创建服务器,开启服务器 &nbsp;&nbsp;&nbsp; @PostConstruct// 创建Controller后调用该方法 &nbsp;&nbsp;&nbsp; public void init() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // webSocket服务器占用的端口号 = SpringBoot占用的端口号 +&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server = new MyServer(Integer.parseInt(WsdemoApplication.port) + 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer(); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; private HashSet&lt;String&gt; set = new HashSet&lt;&gt;(); &nbsp;&nbsp;&nbsp; // 注册节点 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/regist&quot;) &nbsp;&nbsp;&nbsp; public String regist(String port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set.add(port); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;节点:&quot; + port + &quot;注册成功&quot;; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 连接 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/conn&quot;) &nbsp;&nbsp;&nbsp; public String conn() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历集合,连接其他WebSocket服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String port : set) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI(&quot;ws://localhost:&quot; + port); &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyClient client = new MyClient(uri, &quot;连接到__&quot;+port+&quot;__服务器的客户端&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;连接成功&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (URISyntaxException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;连接失败:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; &nbsp;// 广播 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/broadcast&quot;) &nbsp;&nbsp;&nbsp; public String broadcast(String msg) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;发送消息成功&quot;; &nbsp;&nbsp;&nbsp; } } 十丶本项目集成WebSocket 1.参考上例将WebSocket集成进本项目 2.修改页面,增加对应的按钮 &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;idNode&quot;&gt; &lt;br&gt; &lt;div class=&quot;btn-group btn-group-lg&quot; role=&quot;group&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;regist()&quot;&gt;注册节点&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;conn()&quot;&gt;连接&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;broadcast()&quot;&gt;发送广播&lt;/button&gt; &lt;/div&gt; 3.修改页面,增加对应的点击事件 function regist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idNode&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;regist&quot;, &quot;port=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idNode&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function conn() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;conn&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function broadcast() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idNode&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;broadcast&quot;, &quot;msg=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(&quot;#idNode&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 十一丶同步区块链数据 当一个新节点启动的时候,是没有任何数据的,此时可以发送同步请求,从其他节点获取区块链数据.本节实现垓功能. 1.页面上增加同步按钮,并实现点击事件 &nbsp;function syncData() { &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;syncData&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } 2.修改Notebook,使其为单例模式 &nbsp;private NoteBook() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile(); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; private static volatile NoteBook instance; &nbsp;&nbsp;&nbsp; public static NoteBook getInstance() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; synchronized (NoteBook.class) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = new NoteBook(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return&nbsp; instance; &nbsp;&nbsp;&nbsp; } 3.修改Controller,增加同步方法 &nbsp;// 向其他节点发起请求,要求获取区块链的数据 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/syncData&quot;) &nbsp;&nbsp;&nbsp; public String syncData() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;for (MyClient client : clients) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.send(&quot;请把你最新的区块链数据发给我一份&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;发送消息成功&quot;; } 4.增加MessageBean,用于传递数据 public class MessageBean { &nbsp;&nbsp;&nbsp; // 1 ,服务器发送给客户端的最新的区块链数据 &nbsp;&nbsp;&nbsp; public int type; &nbsp;&nbsp;&nbsp; public String msg; &nbsp;&nbsp;&nbsp; public MessageBean() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public MessageBean(int type, String msg) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.type = type; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.msg = msg; &nbsp;&nbsp;&nbsp; } } 5.修改Server接收消息的方法 &nbsp;public void onMessage(WebSocket conn, String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__收到了消息,对方是:&quot; + conn.getRemoteSocketAddress().toString() + &quot;__消息的内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (&quot;请把你最新的区块链数据发给我一份&quot;.equals(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取本地区块链数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = noteBook.showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String chain = objectMapper.writeValueAsString(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = new MessageBean(1, chain); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String msg = objectMapper.writeValueAsString(bean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; broadcast(msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (JsonProcessingException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 6.修改Client接收消息的方法 &nbsp; public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;book.compareList(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 7.修改Notebook,增加比对数据的方法 &nbsp;// 比对数据,如果新的数据长度更长,就替换掉本地数据 &nbsp;&nbsp;&nbsp; public void compareList(ArrayList&lt;Block&gt; newList) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;参数:&quot; + newList.size()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newList.size() &gt; list.size()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = newList; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;list:&quot; + list.size()); } 十二丶广播交易数据 我们添加完交易后,将交易数据广播给其他节点 1.修改Controller,添加记录的方法 &nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装消息Bean &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean messageBean = new MessageBean(2, note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String bean = objectMapper.writeValueAsString(messageBean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(bean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;交易数据校验失败&quot;); &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 2.修改Client,接收消息的方法 public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.compareList(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (bean.type == 2) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = objectMapper.readValue(bean.msg, Transaction.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 验证交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加到区块 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(bean.msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 以上实现了比特币的简单实现,如果对你有帮助请帮我点赞谢谢. 阅读更多" />
<meta property="og:description" content="一丶区块链V1保存字符串 本模块实现简单功能, 使用传统技术实现一个账本功能 1.实现添加和查询功能 // 生活中的账本 = 区块链 public class NoteBook { &nbsp;&nbsp;&nbsp; // 用于保存数据的集合 &nbsp;&nbsp;&nbsp; private ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); &nbsp;&nbsp;&nbsp; // 添加封面 = 创世区块 &nbsp;&nbsp;&nbsp; // 添加封面的时候,必须保证账本是新的 &nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 添加交易记录 = 普通区块 &nbsp;&nbsp;&nbsp; // 添加交易记录的时候,必须保证账本已经有封面了 &nbsp;&nbsp;&nbsp; private void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp; private void showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String s : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(s); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 保存到本地硬盘 &nbsp;&nbsp;&nbsp; private void save2Disk() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = new NoteBook(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addGenesis(&quot;封面&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addNote(&quot;222给2转账了一百块钱&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.showlist(); &nbsp;&nbsp;&nbsp; } } 2.实现保存功能 增加加载本地数据的方法 &nbsp;private void loadFile() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File(&quot;a.json&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断文件是否存在 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (file.exists() &amp;&amp; file.length() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; 如果文件存在,读取之前的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javatype = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, String.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = objectMapper.readValue(file, javatype); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 在构造函数中加载本地数据 &nbsp;&nbsp;&nbsp; public NoteBook() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile(); &nbsp;&nbsp;&nbsp; } 增加保存数据到本地的方法 &nbsp;&nbsp;&nbsp; // 保存数据到本地硬盘 &nbsp;&nbsp;&nbsp; private void save2Disk() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File(&quot;a.json&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objectMapper.writeValue(file, list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 在添加数据时, 调用保存方法 &nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } &nbsp;&nbsp;&nbsp; private void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } 二丶区块链V2增加Http访问接口 本模块为账本功能提供网络接口, 使用户可以通过页面对账本进行增删改查的操作 1.增加网络访问接口 @RestController public class BlockController { &nbsp;&nbsp;&nbsp; private NoteBook book = new NoteBook(); &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addGenesis&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addGenesis(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/showlist&quot;, method = RequestMethod.GET) &nbsp;&nbsp;&nbsp; public ArrayList&lt;String&gt; showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return book.showlist(); &nbsp;&nbsp;&nbsp; } } 2.增加前台页面 引入资料中的静态资源 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &nbsp;&nbsp;&nbsp; &lt;meta charset=&quot;utf-8&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;title&gt;&lt;/title&gt; &nbsp;&nbsp;&nbsp; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/bootstrap.css&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/pb.css&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;style type=&quot;text/css&quot;&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; body { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; margin: 30px; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #result { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; padding: 15px; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;!--输入框--&gt; &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;inputCtr&quot; placeholder=&quot;请输入内容&quot; style=&quot;width: 600px&quot;&gt; &lt;br&gt; &lt;!--按钮组--&gt; &lt;div class=&quot;btn-group btn-group-lg&quot; role=&quot;group&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;addGenesis()&quot;&gt;添加封面&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;addNote()&quot;&gt;添加记录&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;showlist()&quot;&gt;展示数据&lt;/button&gt; &lt;/div&gt; &lt;br&gt; &lt;!--用于展示结果--&gt; &lt;p class=&quot;bg-info&quot; id=&quot;result&quot;&gt; &lt;/p&gt; &lt;script src=&quot;js/jquery-1.12.4.min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/bootstrap.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/pb.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/jsrsasign-all-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; // 添加封面 &nbsp;&nbsp;&nbsp; function addGenesis() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;/addGenesis&quot;, &quot;genesis=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;$(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 添加记录 &nbsp;&nbsp;&nbsp; function addNote() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;/addNote&quot;, &quot;note=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp; function showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;/showlist&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 页面加载成功后,查询已有数据 &nbsp;&nbsp;&nbsp; $(function () { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp; }) &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 3.进度条控件的使用 拷贝资源pb.css和pb.js 将CSS和Js文件引入页面 示例代码 loading.baosight.showPageLoadingMsg(false) // 显示进度条 loading.baosight.hidePageLoadingMsg() // 隐藏进度条 三丶区块链V3增加Hash校验 上一小节实现的功能,很容易导致黑客攻击,篡改数据,这一小节,为数据增加Hash校验功能,增加黑客攻击的难度. 1.创建Block实体类 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp; } } 2.Notebook中增加校验方法 &nbsp;&nbsp;&nbsp; // 校验数据 &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + block.id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); } 3.Controller中增加方法 &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/check&quot;, method = RequestMethod.GET) &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String check = book.check(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (StringUtils.isEmpty(check)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;数据是安全的&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return check; &nbsp;&nbsp;&nbsp; } 4.页面中增加表格用于展示数据 &lt;table class=&quot;table&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;thead&gt; &nbsp;&nbsp;&nbsp; &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; &nbsp;&nbsp;&nbsp; &lt;/thead&gt; &nbsp;&nbsp;&nbsp; &lt;tbody id=&quot;idTbody&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;/tbody&gt; &lt;/table&gt; 5.修改页面显示数据的逻辑 function showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idInput&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;showlist&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idTbody&quot;).html(&quot;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历数据,添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var i = 0; i &lt; data.length; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var id = data[i].id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = data[i].content &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var hash = data[i].hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } 6.页面中增加校验数据的逻辑 &nbsp;// 校验数据 &nbsp;&nbsp;&nbsp; function check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;// 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;check&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 四丶区块链V4增加工作量证明 上一小节增加Hash校验后,如果黑客在篡改数据的同时,又修改了Hash,就无法达到保护数据的目的.因此本节,增加工作量证明,即生成的Hash必须符合特定的规则,如必须以0000开头.这个获取特定Hash的过程就是比特币中的挖矿. 1.修改实体类,增加工作量证明字段 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public int nonce; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce; &nbsp;&nbsp;&nbsp; } } 2.Notebook中增加挖矿方法 &nbsp;// 挖矿 &nbsp;&nbsp;&nbsp; private int mine(String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 求取一个符合特定规则的hash值,并将运算次数返回 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String s = HashUtils.sha256(i + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (s.startsWith(&quot;0000&quot;)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;挖矿成功:&quot; + i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return i; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;挖矿失败:&quot; + i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;挖矿失败&quot;); &nbsp;&nbsp;&nbsp; } 3.Notebook中修改添加的逻辑 &nbsp;int nonce = mine(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + genesis), nonce); 4.Notebook中修改校验的逻辑 &nbsp;// 校验数据 &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 工作量证明 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = block.nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(nonce + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;sb.append(&quot;编号为&quot; + block.id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); } 5.修改页面,表格增加列 &lt;table class=&quot;table&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;thead&gt; &nbsp;&nbsp;&nbsp; &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; &nbsp;&nbsp;&nbsp; &lt;/thead&gt; &nbsp;&nbsp;&nbsp; &lt;tbody id=&quot;idTbody&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;/tbody&gt; &lt;/table&gt; 6.修改页面,展示数据的逻辑 $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;td&gt;&quot; + nonce + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) 五丶区块链V4形成区块链 本节继续增加黑客攻击的难度, 每个区块都持有上个区块的Hash值,互相咬合,形成一个链条.这样当链条足够长的时候,会大大增加黑客攻击的难度. 1.修改实体类,增加preHash字段 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public int nonce; &nbsp;&nbsp;&nbsp; public String preHash; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce, String preHash) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.preHash = preHash; &nbsp;&nbsp;&nbsp; } } 2.Notebook中修改添加的逻辑 &nbsp;public void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + preHash + genesis), nonce, preHash); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } &nbsp;&nbsp;&nbsp; public void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(list.size() - 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = preBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, note, HashUtils.sha256(nonce + preHash + note), nonce, preHash); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); &nbsp;&nbsp;&nbsp; } 3.Notebook中修改校验的逻辑 public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; list.size(); i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block currentBlock = list.get(i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String savedHash = currentBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = currentBlock.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = currentBlock.nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = currentBlock.preHash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int id = currentBlock.id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (i == 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创世区块,校验hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preHash = &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 其他区块,校验hash,preHash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的hash有问题,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(i - 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preBlockHash = preBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!preBlockHash.equals(preHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的preHash有问题,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); &nbsp;&nbsp;&nbsp; } 4.修改页面,表格增加列 &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;上一个Hash&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; 5.修改页面,展示数据的逻辑 $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;td&gt;&quot; + nonce + &quot;&lt;/td&gt;&lt;td&gt;&quot; + preHash + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) 六丶钱包功能 前面的章节,存储数据时,直接可见转账双方的信息,本节通过非对称加密技术和签名技术隐藏交易双方的真实信息. 可以简单理解为 非对称加密中的公钥就是钱包地址,非对称加密中的私钥就是钱包的密码. 1.钱包实体类 public class Wallet { &nbsp;&nbsp;&nbsp; // 公钥 &nbsp;&nbsp;&nbsp; public PublicKey publicKey; &nbsp;&nbsp;&nbsp; // 私钥 &nbsp;&nbsp;&nbsp; public PrivateKey privateKey;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; public Wallet(String name) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 保存公私钥的文件 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File pubFile = new File(name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File priFile = new File(name + &quot;.pri&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 如果文件不存在,说明没有公私钥,就创建公私钥文件 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!pubFile.exists() || pubFile.length() == 0 || !priFile.exists() || priFile.length() == 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSAUtils.generateKeys(&quot;RSA&quot;, name + &quot;.pri&quot;, name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 从文件中读取公私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; publicKey = RSAUtils.getPublicKeyFromFile(&quot;RSA&quot;, name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privateKey = RSAUtils.getPrivateKey(&quot;RSA&quot;, name + &quot;.pri&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 转账 &nbsp;&nbsp;&nbsp; public Transaction sendMoney(String receiverPublickKey, String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将公钥转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String publicKeyEncode = Base64.encode(publicKey.getEncoded()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String signature = RSAUtils.getSignature(&quot;SHA256withRSA&quot;, privateKey, content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成交易对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = new Transaction(publicKeyEncode, receiverPublickKey, signature, content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return transaction; &nbsp;&nbsp;&nbsp; } } 2.交易实体类 public class Transaction { &nbsp;&nbsp;&nbsp; // 付款方的公钥 &nbsp;&nbsp;&nbsp; public String senderPublickKey; &nbsp;&nbsp;&nbsp; // 收款方的公钥 &nbsp;&nbsp;&nbsp; public String receiverPublickKey; &nbsp;&nbsp;&nbsp; // 签名 &nbsp;&nbsp;&nbsp; public String signature; &nbsp;&nbsp;&nbsp; // 转账信息 &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public Transaction() { &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public Transaction(String senderPublickKey, String receiverPublickKey, String signature, String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 校验交易是否正确 &nbsp;&nbsp;&nbsp; public boolean verify() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey sender = RSAUtils.getPublicKeyFromString(&quot;RSA&quot;, senderPublickKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return RSAUtils.verify(&quot;SHA256withRSA&quot;, sender, content, signature); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getSenderPublickKey() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return senderPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setSenderPublickKey(String senderPublickKey) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getReceiverPublickKey() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return receiverPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setReceiverPublickKey(String receiverPublickKey) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getSignature() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setSignature(String signature) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getContent() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setContent(String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public String toString() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;Transaction{&quot; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;senderPublickKey=&#39;&quot; + senderPublickKey + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, receiverPublickKey=&#39;&quot; + receiverPublickKey + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, signature=&#39;&quot; + signature + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;}&#39;; &nbsp;&nbsp;&nbsp; } } 七丶区块链V5增加转账功能 本小节实现网页转账的功能 jsrsasign插件 : https://github.com/kjur/jsrsasign 1.在页面引入插件 &lt;script src=&quot;js/jsrsasign-all-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; 2.修改页面,增加输入key的文本域 &lt;label&gt; &nbsp;&nbsp;&nbsp; 发送方的私钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;senderPrivateKey&quot;&gt; &lt;/textarea&gt; &lt;label&gt; &nbsp;&nbsp;&nbsp; 发送方的公钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;senderPublicKey&quot;&gt; &lt;/textarea&gt;&lt;label&gt; &nbsp;&nbsp;&nbsp; 接收方的公钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;receiverPublicKey&quot;&gt; &lt;/textarea&gt; &lt;label&gt; &nbsp;&nbsp;&nbsp; 转账信息 &lt;/label&gt; 3.修改页面添加记录的逻辑 &nbsp;function addNote() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取输入框的内容 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var senderPrivateKey = $(&quot;#senderPrivateKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var senderPublicKey = $(&quot;#senderPublicKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var receiverPublicKey = $(&quot;#receiverPublicKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idInput&quot;).val() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var prvKey = KEYUTIL.getKey(senderPrivateKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定生成签名使用的算法 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sig = new KJUR.crypto.Signature({&quot;alg&quot;: &quot;SHA256withRSA&quot;}); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 初始化私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.init(prvKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.updateString(content) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sigValueHex = sig.sign() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;addNote&quot;, { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; senderPublickKey: senderPublicKey, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; receiverPublickKey: receiverPublicKey, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature: sigValueHex, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: content, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idInput&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 4.修改RsaUtils,增加js生成签名,验证签名的方法 &nbsp;/** &nbsp;&nbsp;&nbsp;&nbsp; * 生成公私钥,并保存在文件中,JS版本 &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 算法 &nbsp;&nbsp;&nbsp;&nbsp; * @param privateKeyPath : 保存私钥的文件路径 &nbsp;&nbsp;&nbsp;&nbsp; * @param publicKeyPath&nbsp; : 保存公钥的文件路径 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public static void generateKeysJS(String algorithm, String privateKeyPath, String publicKeyPath) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPair keyPair = keyPairGenerator.generateKeyPair(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PrivateKey privateKey = keyPair.getPrivate(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey publicKey = keyPair.getPublic(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] privateKeyEncoded = privateKey.getEncoded(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] publicKeyEncoded = publicKey.getEncoded(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePrivateKey = Base64.encode(privateKeyEncoded); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePublicKey = Base64.encode(publicKeyEncoded); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(privateKeyPath), &quot;-----BEGIN PRIVATE KEY-----\n&quot; + encodePrivateKey + &quot;\n-----END PRIVATE KEY-----&quot;, &quot;UTF-8&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(publicKeyPath), encodePublicKey, &quot;UTF-8&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; /** &nbsp;&nbsp;&nbsp;&nbsp; * 校验签名,JS版本 &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 加密算法(SHA256withRSA) &nbsp;&nbsp;&nbsp;&nbsp; * @param publicKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 公钥 &nbsp;&nbsp;&nbsp;&nbsp; * @param originalData&nbsp;&nbsp; : 原文 &nbsp;&nbsp;&nbsp;&nbsp; * @param signaturedData : 签名 &nbsp;&nbsp;&nbsp;&nbsp; * @return : 签名是否正确 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public static boolean verifyDataJS(String algorithm, PublicKey publicKey, String originalData, String signaturedData) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取签名对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Signature signature = Signature.getInstance(algorithm); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入公钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.initVerify(publicKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.update(originalData.getBytes()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature.verify(toBytes(signaturedData)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; //转换方法 &nbsp;&nbsp;&nbsp; public static byte[] toBytes(String str) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (str == null || trim(str) == &quot;&quot;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new byte[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] bytes = new byte[str.length() / 2]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; str.length() / 2; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String subStr = str.substring(i * 2, i * 2 + 2); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes[i] = (byte) Integer.parseInt(subStr, 16); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return bytes; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public static String trim(String str) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int startIndex = 0; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int endIndex = str.length() - 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean startFound = false; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (startIndex &lt;= endIndex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int index; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = startIndex; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = endIndex; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char it = str.charAt(index); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean match = it &lt;= &#39; &#39;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startFound = true; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startIndex += 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endIndex -= 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return str.substring(startIndex, endIndex + 1); &nbsp;&nbsp;&nbsp; } 修改Controller,添加记录的逻辑 &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;交易数据校验失败&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } } 八丶WebSocket简介 &nbsp; 前面的章节章节中,我们的转账信息和生成的区块只是保存在本地,事实上我们需要把这些信息广播出去,告知其他节点.其他节点上的转账信息和生成的区块也要告知我们,这样我们就需要通过WebSocket和其他节点之间进行通信. WebSocket是一种通信协议,可以实现双向通信. 具体介绍 : http://www.ruanyifeng.com/blog/2017/05/websocket.html 本项目使用Java WebSockets框架. https://github.com/TooTallNate/Java-WebSocket 快速入门案例 1.引入坐标 compile &quot;org.java-websocket:Java-WebSocket:1.3.8&quot; 2.创建Server public class MyServer extends WebSocketServer { &nbsp;&nbsp;&nbsp; // 服务器端口 &nbsp;&nbsp;&nbsp; private int port; &nbsp;&nbsp;&nbsp; public MyServer(int port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(new InetSocketAddress(port)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.port = port; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onOpen(WebSocket conn, ClientHandshake handshake) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__打开了一个连接,对方是:&quot; + conn.getRemoteSocketAddress().toString()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onClose(WebSocket conn, int code, String reason, boolean remote) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__关闭了一个连接,对方是:&quot; + conn.getRemoteSocketAddress().toString()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onMessage(WebSocket conn, String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__收到了消息,对方是:&quot; + conn.getRemoteSocketAddress().toString() + &quot;__消息的内容是:&quot; + message); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onError(WebSocket conn, Exception ex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__发生了错误__原因:&quot; + ex.getMessage()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onStart() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__启动成功&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 开启服务器 &nbsp;&nbsp;&nbsp; public void startServer() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new Thread(this).start(); &nbsp;&nbsp;&nbsp; } } 3.创建Client public class MyClient extends WebSocketClient { &nbsp;&nbsp;&nbsp; private String name; &nbsp;&nbsp;&nbsp; /** &nbsp;&nbsp;&nbsp;&nbsp; * @param serverUri : 要连接的服务器的地址 &nbsp;&nbsp;&nbsp;&nbsp; * @param name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 本客户端的名字 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public MyClient(URI serverUri, String name) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(serverUri); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.name = name; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onOpen(ServerHandshake handshakedata) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_连接成功&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onClose(int code, String reason, boolean remote) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_连接关闭&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onError(Exception ex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_发生错误&quot;); &nbsp;&nbsp;&nbsp; } } 4.创建测试类 public class MyTest { &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建并开启服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyServer server = new MyServer(8000); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定服务器地址 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI(&quot;ws://localhost:8000&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建客户端 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client1 = new MyClient(uri, &quot;1111&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client2 = new MyClient(uri, &quot;2222&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端连接服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client2.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 避免连接尚未成功,就发送消息,导致的发送失败 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 服务器发送广播 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; server.broadcast(&quot;这是来自服务器的广播&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端发送消息给服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.send(&quot;这是一号客户端发送的消息&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } } 九丶SpringBoot集成WebSocket 1.修改Application类,可以手动指定启动端口号 public class WsdemoApplication { &nbsp;&nbsp;&nbsp; public static String port; &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户输入的内容,作为端口号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scanner scanner = new Scanner(System.in); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = scanner.nextLine(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 启动应用 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new SpringApplicationBuilder(WsdemoApplication.class).properties(&quot;server.port=&quot; + port).run(args); &nbsp;&nbsp;&nbsp; } } 2.修改Springboot配置,使其可以开启多实例 编辑配置 &nbsp; 找到对应的Application类,修改配置 3.创建Controller,实现注册节点 / 连接 / 广播功能 @RestController public class DemoController { &nbsp;&nbsp;&nbsp; private MyServer server; &nbsp;&nbsp;&nbsp; // 创建服务器,开启服务器 &nbsp;&nbsp;&nbsp; @PostConstruct// 创建Controller后调用该方法 &nbsp;&nbsp;&nbsp; public void init() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // webSocket服务器占用的端口号 = SpringBoot占用的端口号 +&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server = new MyServer(Integer.parseInt(WsdemoApplication.port) + 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer(); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; private HashSet&lt;String&gt; set = new HashSet&lt;&gt;(); &nbsp;&nbsp;&nbsp; // 注册节点 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/regist&quot;) &nbsp;&nbsp;&nbsp; public String regist(String port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set.add(port); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;节点:&quot; + port + &quot;注册成功&quot;; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 连接 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/conn&quot;) &nbsp;&nbsp;&nbsp; public String conn() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历集合,连接其他WebSocket服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String port : set) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI(&quot;ws://localhost:&quot; + port); &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyClient client = new MyClient(uri, &quot;连接到__&quot;+port+&quot;__服务器的客户端&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;连接成功&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (URISyntaxException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;连接失败:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; &nbsp;// 广播 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/broadcast&quot;) &nbsp;&nbsp;&nbsp; public String broadcast(String msg) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;发送消息成功&quot;; &nbsp;&nbsp;&nbsp; } } 十丶本项目集成WebSocket 1.参考上例将WebSocket集成进本项目 2.修改页面,增加对应的按钮 &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;idNode&quot;&gt; &lt;br&gt; &lt;div class=&quot;btn-group btn-group-lg&quot; role=&quot;group&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;regist()&quot;&gt;注册节点&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;conn()&quot;&gt;连接&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;broadcast()&quot;&gt;发送广播&lt;/button&gt; &lt;/div&gt; 3.修改页面,增加对应的点击事件 function regist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idNode&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;regist&quot;, &quot;port=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idNode&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function conn() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;conn&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function broadcast() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idNode&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;broadcast&quot;, &quot;msg=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(&quot;#idNode&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 十一丶同步区块链数据 当一个新节点启动的时候,是没有任何数据的,此时可以发送同步请求,从其他节点获取区块链数据.本节实现垓功能. 1.页面上增加同步按钮,并实现点击事件 &nbsp;function syncData() { &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;syncData&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } 2.修改Notebook,使其为单例模式 &nbsp;private NoteBook() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile(); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; private static volatile NoteBook instance; &nbsp;&nbsp;&nbsp; public static NoteBook getInstance() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; synchronized (NoteBook.class) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = new NoteBook(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return&nbsp; instance; &nbsp;&nbsp;&nbsp; } 3.修改Controller,增加同步方法 &nbsp;// 向其他节点发起请求,要求获取区块链的数据 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/syncData&quot;) &nbsp;&nbsp;&nbsp; public String syncData() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;for (MyClient client : clients) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.send(&quot;请把你最新的区块链数据发给我一份&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;发送消息成功&quot;; } 4.增加MessageBean,用于传递数据 public class MessageBean { &nbsp;&nbsp;&nbsp; // 1 ,服务器发送给客户端的最新的区块链数据 &nbsp;&nbsp;&nbsp; public int type; &nbsp;&nbsp;&nbsp; public String msg; &nbsp;&nbsp;&nbsp; public MessageBean() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public MessageBean(int type, String msg) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.type = type; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.msg = msg; &nbsp;&nbsp;&nbsp; } } 5.修改Server接收消息的方法 &nbsp;public void onMessage(WebSocket conn, String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__收到了消息,对方是:&quot; + conn.getRemoteSocketAddress().toString() + &quot;__消息的内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (&quot;请把你最新的区块链数据发给我一份&quot;.equals(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取本地区块链数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = noteBook.showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String chain = objectMapper.writeValueAsString(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = new MessageBean(1, chain); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String msg = objectMapper.writeValueAsString(bean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; broadcast(msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (JsonProcessingException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 6.修改Client接收消息的方法 &nbsp; public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;book.compareList(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 7.修改Notebook,增加比对数据的方法 &nbsp;// 比对数据,如果新的数据长度更长,就替换掉本地数据 &nbsp;&nbsp;&nbsp; public void compareList(ArrayList&lt;Block&gt; newList) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;参数:&quot; + newList.size()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newList.size() &gt; list.size()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = newList; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;list:&quot; + list.size()); } 十二丶广播交易数据 我们添加完交易后,将交易数据广播给其他节点 1.修改Controller,添加记录的方法 &nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装消息Bean &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean messageBean = new MessageBean(2, note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String bean = objectMapper.writeValueAsString(messageBean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(bean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;交易数据校验失败&quot;); &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 2.修改Client,接收消息的方法 public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.compareList(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (bean.type == 2) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = objectMapper.readValue(bean.msg, Transaction.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 验证交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加到区块 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(bean.msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 以上实现了比特币的简单实现,如果对你有帮助请帮我点赞谢谢. 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/07/17/5293925a12988d483a9d23b97c6c3df1.html" />
<meta property="og:url" content="https://mlh.app/2018/07/17/5293925a12988d483a9d23b97c6c3df1.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-17T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"一丶区块链V1保存字符串 本模块实现简单功能, 使用传统技术实现一个账本功能 1.实现添加和查询功能 // 生活中的账本 = 区块链 public class NoteBook { &nbsp;&nbsp;&nbsp; // 用于保存数据的集合 &nbsp;&nbsp;&nbsp; private ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); &nbsp;&nbsp;&nbsp; // 添加封面 = 创世区块 &nbsp;&nbsp;&nbsp; // 添加封面的时候,必须保证账本是新的 &nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 添加交易记录 = 普通区块 &nbsp;&nbsp;&nbsp; // 添加交易记录的时候,必须保证账本已经有封面了 &nbsp;&nbsp;&nbsp; private void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp; private void showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String s : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(s); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 保存到本地硬盘 &nbsp;&nbsp;&nbsp; private void save2Disk() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = new NoteBook(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addGenesis(&quot;封面&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addNote(&quot;222给2转账了一百块钱&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.showlist(); &nbsp;&nbsp;&nbsp; } } 2.实现保存功能 增加加载本地数据的方法 &nbsp;private void loadFile() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File(&quot;a.json&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断文件是否存在 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (file.exists() &amp;&amp; file.length() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; 如果文件存在,读取之前的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javatype = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, String.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = objectMapper.readValue(file, javatype); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 在构造函数中加载本地数据 &nbsp;&nbsp;&nbsp; public NoteBook() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile(); &nbsp;&nbsp;&nbsp; } 增加保存数据到本地的方法 &nbsp;&nbsp;&nbsp; // 保存数据到本地硬盘 &nbsp;&nbsp;&nbsp; private void save2Disk() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File(&quot;a.json&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objectMapper.writeValue(file, list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 在添加数据时, 调用保存方法 &nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } &nbsp;&nbsp;&nbsp; private void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } 二丶区块链V2增加Http访问接口 本模块为账本功能提供网络接口, 使用户可以通过页面对账本进行增删改查的操作 1.增加网络访问接口 @RestController public class BlockController { &nbsp;&nbsp;&nbsp; private NoteBook book = new NoteBook(); &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addGenesis&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addGenesis(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/showlist&quot;, method = RequestMethod.GET) &nbsp;&nbsp;&nbsp; public ArrayList&lt;String&gt; showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return book.showlist(); &nbsp;&nbsp;&nbsp; } } 2.增加前台页面 引入资料中的静态资源 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &nbsp;&nbsp;&nbsp; &lt;meta charset=&quot;utf-8&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;title&gt;&lt;/title&gt; &nbsp;&nbsp;&nbsp; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/bootstrap.css&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/pb.css&quot;/&gt; &nbsp;&nbsp;&nbsp; &lt;style type=&quot;text/css&quot;&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; body { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; margin: 30px; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #result { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; padding: 15px; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;!--输入框--&gt; &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;inputCtr&quot; placeholder=&quot;请输入内容&quot; style=&quot;width: 600px&quot;&gt; &lt;br&gt; &lt;!--按钮组--&gt; &lt;div class=&quot;btn-group btn-group-lg&quot; role=&quot;group&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;addGenesis()&quot;&gt;添加封面&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;addNote()&quot;&gt;添加记录&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;showlist()&quot;&gt;展示数据&lt;/button&gt; &lt;/div&gt; &lt;br&gt; &lt;!--用于展示结果--&gt; &lt;p class=&quot;bg-info&quot; id=&quot;result&quot;&gt; &lt;/p&gt; &lt;script src=&quot;js/jquery-1.12.4.min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/bootstrap.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/pb.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script src=&quot;js/jsrsasign-all-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; // 添加封面 &nbsp;&nbsp;&nbsp; function addGenesis() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;/addGenesis&quot;, &quot;genesis=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;$(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 添加记录 &nbsp;&nbsp;&nbsp; function addNote() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;/addNote&quot;, &quot;note=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#inputCtr&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp; function showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;/showlist&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 页面加载成功后,查询已有数据 &nbsp;&nbsp;&nbsp; $(function () { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist(); &nbsp;&nbsp;&nbsp; }) &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 3.进度条控件的使用 拷贝资源pb.css和pb.js 将CSS和Js文件引入页面 示例代码 loading.baosight.showPageLoadingMsg(false) // 显示进度条 loading.baosight.hidePageLoadingMsg() // 隐藏进度条 三丶区块链V3增加Hash校验 上一小节实现的功能,很容易导致黑客攻击,篡改数据,这一小节,为数据增加Hash校验功能,增加黑客攻击的难度. 1.创建Block实体类 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp; } } 2.Notebook中增加校验方法 &nbsp;&nbsp;&nbsp; // 校验数据 &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + block.id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); } 3.Controller中增加方法 &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/check&quot;, method = RequestMethod.GET) &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String check = book.check(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (StringUtils.isEmpty(check)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;数据是安全的&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return check; &nbsp;&nbsp;&nbsp; } 4.页面中增加表格用于展示数据 &lt;table class=&quot;table&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;thead&gt; &nbsp;&nbsp;&nbsp; &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; &nbsp;&nbsp;&nbsp; &lt;/thead&gt; &nbsp;&nbsp;&nbsp; &lt;tbody id=&quot;idTbody&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;/tbody&gt; &lt;/table&gt; 5.修改页面显示数据的逻辑 function showlist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idInput&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;showlist&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idTbody&quot;).html(&quot;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历数据,添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var i = 0; i &lt; data.length; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var id = data[i].id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = data[i].content &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var hash = data[i].hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } 6.页面中增加校验数据的逻辑 &nbsp;// 校验数据 &nbsp;&nbsp;&nbsp; function check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;// 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get(&quot;check&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 四丶区块链V4增加工作量证明 上一小节增加Hash校验后,如果黑客在篡改数据的同时,又修改了Hash,就无法达到保护数据的目的.因此本节,增加工作量证明,即生成的Hash必须符合特定的规则,如必须以0000开头.这个获取特定Hash的过程就是比特币中的挖矿. 1.修改实体类,增加工作量证明字段 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public int nonce; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce; &nbsp;&nbsp;&nbsp; } } 2.Notebook中增加挖矿方法 &nbsp;// 挖矿 &nbsp;&nbsp;&nbsp; private int mine(String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 求取一个符合特定规则的hash值,并将运算次数返回 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String s = HashUtils.sha256(i + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (s.startsWith(&quot;0000&quot;)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;挖矿成功:&quot; + i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return i; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;挖矿失败:&quot; + i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;挖矿失败&quot;); &nbsp;&nbsp;&nbsp; } 3.Notebook中修改添加的逻辑 &nbsp;int nonce = mine(genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + genesis), nonce); 4.Notebook中修改校验的逻辑 &nbsp;// 校验数据 &nbsp;&nbsp;&nbsp; public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 工作量证明 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = block.nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(nonce + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;sb.append(&quot;编号为&quot; + block.id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); } 5.修改页面,表格增加列 &lt;table class=&quot;table&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;thead&gt; &nbsp;&nbsp;&nbsp; &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; &nbsp;&nbsp;&nbsp; &lt;/thead&gt; &nbsp;&nbsp;&nbsp; &lt;tbody id=&quot;idTbody&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;/tbody&gt; &lt;/table&gt; 6.修改页面,展示数据的逻辑 $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;td&gt;&quot; + nonce + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) 五丶区块链V4形成区块链 本节继续增加黑客攻击的难度, 每个区块都持有上个区块的Hash值,互相咬合,形成一个链条.这样当链条足够长的时候,会大大增加黑客攻击的难度. 1.修改实体类,增加preHash字段 public class Block { &nbsp;&nbsp;&nbsp; public int id; &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public String hash; &nbsp;&nbsp;&nbsp; public int nonce; &nbsp;&nbsp;&nbsp; public String preHash; &nbsp;&nbsp;&nbsp; public Block() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce, String preHash) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.preHash = preHash; &nbsp;&nbsp;&nbsp; } } 2.Notebook中修改添加的逻辑 &nbsp;public void addGenesis(String genesis) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加封面的时候,必须保证账本是新的&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + genesis); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + preHash + genesis), nonce, preHash); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); } &nbsp;&nbsp;&nbsp; public void addNote(String note) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;添加交易记录的时候,必须保证账本已经有封面了&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(list.size() - 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = preBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, note, HashUtils.sha256(nonce + preHash + note), nonce, preHash); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk(); &nbsp;&nbsp;&nbsp; } 3.Notebook中修改校验的逻辑 public String check() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; list.size(); i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block currentBlock = list.get(i); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String savedHash = currentBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = currentBlock.content; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = currentBlock.nonce; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = currentBlock.preHash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int id = currentBlock.id; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (i == 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创世区块,校验hash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preHash = &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的数据有可能被篡改了,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 其他区块,校验hash,preHash &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的hash有问题,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(i - 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preBlockHash = preBlock.hash; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!preBlockHash.equals(preHash)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append(&quot;编号为&quot; + id + &quot;的preHash有问题,请注意防范黑客&lt;br&gt;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString(); &nbsp;&nbsp;&nbsp; } 4.修改页面,表格增加列 &lt;tr&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;上一个Hash&lt;/th&gt; &nbsp;&nbsp;&nbsp; &lt;/tr&gt; 5.修改页面,展示数据的逻辑 $(&quot;#idTbody&quot;).append(&quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + content + &quot;&lt;/td&gt;&lt;td&gt;&quot; + hash + &quot;&lt;/td&gt;&lt;td&gt;&quot; + nonce + &quot;&lt;/td&gt;&lt;td&gt;&quot; + preHash + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;) 六丶钱包功能 前面的章节,存储数据时,直接可见转账双方的信息,本节通过非对称加密技术和签名技术隐藏交易双方的真实信息. 可以简单理解为 非对称加密中的公钥就是钱包地址,非对称加密中的私钥就是钱包的密码. 1.钱包实体类 public class Wallet { &nbsp;&nbsp;&nbsp; // 公钥 &nbsp;&nbsp;&nbsp; public PublicKey publicKey; &nbsp;&nbsp;&nbsp; // 私钥 &nbsp;&nbsp;&nbsp; public PrivateKey privateKey;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; public Wallet(String name) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 保存公私钥的文件 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File pubFile = new File(name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File priFile = new File(name + &quot;.pri&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 如果文件不存在,说明没有公私钥,就创建公私钥文件 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!pubFile.exists() || pubFile.length() == 0 || !priFile.exists() || priFile.length() == 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSAUtils.generateKeys(&quot;RSA&quot;, name + &quot;.pri&quot;, name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 从文件中读取公私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; publicKey = RSAUtils.getPublicKeyFromFile(&quot;RSA&quot;, name + &quot;.pub&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privateKey = RSAUtils.getPrivateKey(&quot;RSA&quot;, name + &quot;.pri&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 转账 &nbsp;&nbsp;&nbsp; public Transaction sendMoney(String receiverPublickKey, String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将公钥转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String publicKeyEncode = Base64.encode(publicKey.getEncoded()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String signature = RSAUtils.getSignature(&quot;SHA256withRSA&quot;, privateKey, content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成交易对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = new Transaction(publicKeyEncode, receiverPublickKey, signature, content); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return transaction; &nbsp;&nbsp;&nbsp; } } 2.交易实体类 public class Transaction { &nbsp;&nbsp;&nbsp; // 付款方的公钥 &nbsp;&nbsp;&nbsp; public String senderPublickKey; &nbsp;&nbsp;&nbsp; // 收款方的公钥 &nbsp;&nbsp;&nbsp; public String receiverPublickKey; &nbsp;&nbsp;&nbsp; // 签名 &nbsp;&nbsp;&nbsp; public String signature; &nbsp;&nbsp;&nbsp; // 转账信息 &nbsp;&nbsp;&nbsp; public String content; &nbsp;&nbsp;&nbsp; public Transaction() { &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; public Transaction(String senderPublickKey, String receiverPublickKey, String signature, String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 校验交易是否正确 &nbsp;&nbsp;&nbsp; public boolean verify() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey sender = RSAUtils.getPublicKeyFromString(&quot;RSA&quot;, senderPublickKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return RSAUtils.verify(&quot;SHA256withRSA&quot;, sender, content, signature); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getSenderPublickKey() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return senderPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setSenderPublickKey(String senderPublickKey) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getReceiverPublickKey() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return receiverPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setReceiverPublickKey(String receiverPublickKey) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getSignature() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setSignature(String signature) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public String getContent() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public void setContent(String content) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public String toString() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;Transaction{&quot; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;senderPublickKey=&#39;&quot; + senderPublickKey + &#39;\\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, receiverPublickKey=&#39;&quot; + receiverPublickKey + &#39;\\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, signature=&#39;&quot; + signature + &#39;\\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;, content=&#39;&quot; + content + &#39;\\&#39;&#39; + &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;}&#39;; &nbsp;&nbsp;&nbsp; } } 七丶区块链V5增加转账功能 本小节实现网页转账的功能 jsrsasign插件 : https://github.com/kjur/jsrsasign 1.在页面引入插件 &lt;script src=&quot;js/jsrsasign-all-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt; 2.修改页面,增加输入key的文本域 &lt;label&gt; &nbsp;&nbsp;&nbsp; 发送方的私钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;senderPrivateKey&quot;&gt; &lt;/textarea&gt; &lt;label&gt; &nbsp;&nbsp;&nbsp; 发送方的公钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;senderPublicKey&quot;&gt; &lt;/textarea&gt;&lt;label&gt; &nbsp;&nbsp;&nbsp; 接收方的公钥 &lt;/label&gt; &lt;textarea class=&quot;form-control&quot; id=&quot;receiverPublicKey&quot;&gt; &lt;/textarea&gt; &lt;label&gt; &nbsp;&nbsp;&nbsp; 转账信息 &lt;/label&gt; 3.修改页面添加记录的逻辑 &nbsp;function addNote() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取输入框的内容 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var senderPrivateKey = $(&quot;#senderPrivateKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var senderPublicKey = $(&quot;#senderPublicKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var receiverPublicKey = $(&quot;#receiverPublicKey&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idInput&quot;).val() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var prvKey = KEYUTIL.getKey(senderPrivateKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定生成签名使用的算法 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sig = new KJUR.crypto.Signature({&quot;alg&quot;: &quot;SHA256withRSA&quot;}); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 初始化私钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.init(prvKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.updateString(content) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sigValueHex = sig.sign() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;addNote&quot;, { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; senderPublickKey: senderPublicKey, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; receiverPublickKey: receiverPublicKey, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature: sigValueHex, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: content, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idInput&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示最新的数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 4.修改RsaUtils,增加js生成签名,验证签名的方法 &nbsp;/** &nbsp;&nbsp;&nbsp;&nbsp; * 生成公私钥,并保存在文件中,JS版本 &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 算法 &nbsp;&nbsp;&nbsp;&nbsp; * @param privateKeyPath : 保存私钥的文件路径 &nbsp;&nbsp;&nbsp;&nbsp; * @param publicKeyPath&nbsp; : 保存公钥的文件路径 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public static void generateKeysJS(String algorithm, String privateKeyPath, String publicKeyPath) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPair keyPair = keyPairGenerator.generateKeyPair(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PrivateKey privateKey = keyPair.getPrivate(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey publicKey = keyPair.getPublic(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] privateKeyEncoded = privateKey.getEncoded(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] publicKeyEncoded = publicKey.getEncoded(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePrivateKey = Base64.encode(privateKeyEncoded); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePublicKey = Base64.encode(publicKeyEncoded); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(privateKeyPath), &quot;-----BEGIN PRIVATE KEY-----\\n&quot; + encodePrivateKey + &quot;\\n-----END PRIVATE KEY-----&quot;, &quot;UTF-8&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(publicKeyPath), encodePublicKey, &quot;UTF-8&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; /** &nbsp;&nbsp;&nbsp;&nbsp; * 校验签名,JS版本 &nbsp;&nbsp;&nbsp;&nbsp; * &nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 加密算法(SHA256withRSA) &nbsp;&nbsp;&nbsp;&nbsp; * @param publicKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 公钥 &nbsp;&nbsp;&nbsp;&nbsp; * @param originalData&nbsp;&nbsp; : 原文 &nbsp;&nbsp;&nbsp;&nbsp; * @param signaturedData : 签名 &nbsp;&nbsp;&nbsp;&nbsp; * @return : 签名是否正确 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public static boolean verifyDataJS(String algorithm, PublicKey publicKey, String originalData, String signaturedData) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取签名对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Signature signature = Signature.getInstance(algorithm); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入公钥 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.initVerify(publicKey); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.update(originalData.getBytes()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature.verify(toBytes(signaturedData)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; //转换方法 &nbsp;&nbsp;&nbsp; public static byte[] toBytes(String str) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (str == null || trim(str) == &quot;&quot;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new byte[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] bytes = new byte[str.length() / 2]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; str.length() / 2; i++) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String subStr = str.substring(i * 2, i * 2 + 2); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes[i] = (byte) Integer.parseInt(subStr, 16); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return bytes; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public static String trim(String str) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int startIndex = 0; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int endIndex = str.length() - 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean startFound = false; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (startIndex &lt;= endIndex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int index; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = startIndex; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = endIndex; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char it = str.charAt(index); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean match = it &lt;= &#39; &#39;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startFound = true; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startIndex += 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endIndex -= 1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return str.substring(startIndex, endIndex + 1); &nbsp;&nbsp;&nbsp; } 修改Controller,添加记录的逻辑 &nbsp;&nbsp;&nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;交易数据校验失败&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } } 八丶WebSocket简介 &nbsp; 前面的章节章节中,我们的转账信息和生成的区块只是保存在本地,事实上我们需要把这些信息广播出去,告知其他节点.其他节点上的转账信息和生成的区块也要告知我们,这样我们就需要通过WebSocket和其他节点之间进行通信. WebSocket是一种通信协议,可以实现双向通信. 具体介绍 : http://www.ruanyifeng.com/blog/2017/05/websocket.html 本项目使用Java WebSockets框架. https://github.com/TooTallNate/Java-WebSocket 快速入门案例 1.引入坐标 compile &quot;org.java-websocket:Java-WebSocket:1.3.8&quot; 2.创建Server public class MyServer extends WebSocketServer { &nbsp;&nbsp;&nbsp; // 服务器端口 &nbsp;&nbsp;&nbsp; private int port; &nbsp;&nbsp;&nbsp; public MyServer(int port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(new InetSocketAddress(port)); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.port = port; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onOpen(WebSocket conn, ClientHandshake handshake) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__打开了一个连接,对方是:&quot; + conn.getRemoteSocketAddress().toString()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onClose(WebSocket conn, int code, String reason, boolean remote) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__关闭了一个连接,对方是:&quot; + conn.getRemoteSocketAddress().toString()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onMessage(WebSocket conn, String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__收到了消息,对方是:&quot; + conn.getRemoteSocketAddress().toString() + &quot;__消息的内容是:&quot; + message); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onError(WebSocket conn, Exception ex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__发生了错误__原因:&quot; + ex.getMessage()); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onStart() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__启动成功&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 开启服务器 &nbsp;&nbsp;&nbsp; public void startServer() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new Thread(this).start(); &nbsp;&nbsp;&nbsp; } } 3.创建Client public class MyClient extends WebSocketClient { &nbsp;&nbsp;&nbsp; private String name; &nbsp;&nbsp;&nbsp; /** &nbsp;&nbsp;&nbsp;&nbsp; * @param serverUri : 要连接的服务器的地址 &nbsp;&nbsp;&nbsp;&nbsp; * @param name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 本客户端的名字 &nbsp;&nbsp;&nbsp;&nbsp; */ &nbsp;&nbsp;&nbsp; public MyClient(URI serverUri, String name) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(serverUri); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.name = name; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onOpen(ServerHandshake handshakedata) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_连接成功&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onClose(int code, String reason, boolean remote) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_连接关闭&quot;); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; @Override &nbsp;&nbsp;&nbsp; public void onError(Exception ex) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_发生错误&quot;); &nbsp;&nbsp;&nbsp; } } 4.创建测试类 public class MyTest { &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建并开启服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyServer server = new MyServer(8000); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定服务器地址 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI(&quot;ws://localhost:8000&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建客户端 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client1 = new MyClient(uri, &quot;1111&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client2 = new MyClient(uri, &quot;2222&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端连接服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client2.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 避免连接尚未成功,就发送消息,导致的发送失败 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 服务器发送广播 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; server.broadcast(&quot;这是来自服务器的广播&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端发送消息给服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.send(&quot;这是一号客户端发送的消息&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } } 九丶SpringBoot集成WebSocket 1.修改Application类,可以手动指定启动端口号 public class WsdemoApplication { &nbsp;&nbsp;&nbsp; public static String port; &nbsp;&nbsp;&nbsp; public static void main(String[] args) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户输入的内容,作为端口号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scanner scanner = new Scanner(System.in); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = scanner.nextLine(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 启动应用 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new SpringApplicationBuilder(WsdemoApplication.class).properties(&quot;server.port=&quot; + port).run(args); &nbsp;&nbsp;&nbsp; } } 2.修改Springboot配置,使其可以开启多实例 编辑配置 &nbsp; 找到对应的Application类,修改配置 3.创建Controller,实现注册节点 / 连接 / 广播功能 @RestController public class DemoController { &nbsp;&nbsp;&nbsp; private MyServer server; &nbsp;&nbsp;&nbsp; // 创建服务器,开启服务器 &nbsp;&nbsp;&nbsp; @PostConstruct// 创建Controller后调用该方法 &nbsp;&nbsp;&nbsp; public void init() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // webSocket服务器占用的端口号 = SpringBoot占用的端口号 +&nbsp; 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server = new MyServer(Integer.parseInt(WsdemoApplication.port) + 1); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer(); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; private HashSet&lt;String&gt; set = new HashSet&lt;&gt;(); &nbsp;&nbsp;&nbsp; // 注册节点 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/regist&quot;) &nbsp;&nbsp;&nbsp; public String regist(String port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set.add(port); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;节点:&quot; + port + &quot;注册成功&quot;; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; // 连接 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/conn&quot;) &nbsp;&nbsp;&nbsp; public String conn() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历集合,连接其他WebSocket服务器 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String port : set) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI(&quot;ws://localhost:&quot; + port); &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyClient client = new MyClient(uri, &quot;连接到__&quot;+port+&quot;__服务器的客户端&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.connect(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;连接成功&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (URISyntaxException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;连接失败:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; &nbsp;// 广播 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/broadcast&quot;) &nbsp;&nbsp;&nbsp; public String broadcast(String msg) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;发送消息成功&quot;; &nbsp;&nbsp;&nbsp; } } 十丶本项目集成WebSocket 1.参考上例将WebSocket集成进本项目 2.修改页面,增加对应的按钮 &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;idNode&quot;&gt; &lt;br&gt; &lt;div class=&quot;btn-group btn-group-lg&quot; role=&quot;group&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;regist()&quot;&gt;注册节点&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;conn()&quot;&gt;连接&lt;/button&gt; &nbsp;&nbsp;&nbsp; &lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; onclick=&quot;broadcast()&quot;&gt;发送广播&lt;/button&gt; &lt;/div&gt; 3.修改页面,增加对应的点击事件 function regist() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idNode&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;regist&quot;, &quot;port=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#idNode&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function conn() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;conn&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; function broadcast() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $(&quot;#idNode&quot;).val(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;broadcast&quot;, &quot;msg=&quot; + content, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(&quot;#idNode&quot;).val(&quot;&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) } 十一丶同步区块链数据 当一个新节点启动的时候,是没有任何数据的,此时可以发送同步请求,从其他节点获取区块链数据.本节实现垓功能. 1.页面上增加同步按钮,并实现点击事件 &nbsp;function syncData() { &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 打开进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post(&quot;syncData&quot;, function (data) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(&quot;#result&quot;).html(data) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }) &nbsp;&nbsp;&nbsp; } 2.修改Notebook,使其为单例模式 &nbsp;private NoteBook() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile(); &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; private static volatile NoteBook instance; &nbsp;&nbsp;&nbsp; public static NoteBook getInstance() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; synchronized (NoteBook.class) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = new NoteBook(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return&nbsp; instance; &nbsp;&nbsp;&nbsp; } 3.修改Controller,增加同步方法 &nbsp;// 向其他节点发起请求,要求获取区块链的数据 &nbsp;&nbsp;&nbsp; @RequestMapping(&quot;/syncData&quot;) &nbsp;&nbsp;&nbsp; public String syncData() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;for (MyClient client : clients) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.send(&quot;请把你最新的区块链数据发给我一份&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;发送消息成功&quot;; } 4.增加MessageBean,用于传递数据 public class MessageBean { &nbsp;&nbsp;&nbsp; // 1 ,服务器发送给客户端的最新的区块链数据 &nbsp;&nbsp;&nbsp; public int type; &nbsp;&nbsp;&nbsp; public String msg; &nbsp;&nbsp;&nbsp; public MessageBean() { &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; public MessageBean(int type, String msg) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.type = type; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.msg = msg; &nbsp;&nbsp;&nbsp; } } 5.修改Server接收消息的方法 &nbsp;public void onMessage(WebSocket conn, String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket服务器__&quot; + port + &quot;__收到了消息,对方是:&quot; + conn.getRemoteSocketAddress().toString() + &quot;__消息的内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (&quot;请把你最新的区块链数据发给我一份&quot;.equals(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取本地区块链数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = noteBook.showlist(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String chain = objectMapper.writeValueAsString(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = new MessageBean(1, chain); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String msg = objectMapper.writeValueAsString(bean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; broadcast(msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (JsonProcessingException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 6.修改Client接收消息的方法 &nbsp; public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;book.compareList(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 7.修改Notebook,增加比对数据的方法 &nbsp;// 比对数据,如果新的数据长度更长,就替换掉本地数据 &nbsp;&nbsp;&nbsp; public void compareList(ArrayList&lt;Block&gt; newList) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;参数:&quot; + newList.size()); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newList.size() &gt; list.size()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = newList; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;list:&quot; + list.size()); } 十二丶广播交易数据 我们添加完交易后,将交易数据广播给其他节点 1.修改Controller,添加记录的方法 &nbsp; @RequestMapping(value = &quot;/addNote&quot;, method = RequestMethod.POST) &nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装消息Bean &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean messageBean = new MessageBean(2, note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String bean = objectMapper.writeValueAsString(messageBean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(bean); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;success&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException(&quot;交易数据校验失败&quot;); &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;fail:&quot; + e.getMessage(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 2.修改Client,接收消息的方法 public void onMessage(String message) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;WebSocket客户端__&quot; + name + &quot;_收到消息,内容是:&quot; + message); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.compareList(list); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (bean.type == 2) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = objectMapper.readValue(bean.msg, Transaction.class); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 验证交易数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加到区块 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(bean.msg); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; } 以上实现了比特币的简单实现,如果对你有帮助请帮我点赞谢谢. 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/07/17/5293925a12988d483a9d23b97c6c3df1.html","headline":"用java手把手教你写比特币底层源码","dateModified":"2018-07-17T00:00:00+08:00","datePublished":"2018-07-17T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/07/17/5293925a12988d483a9d23b97c6c3df1.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>用java手把手教你写比特币底层源码</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><strong>一丶区块链V1保存字符串</strong></p> 
  <p>本模块实现简单功能, 使用传统技术实现一个账本功能</p> 
  <p>1.<strong>实现添加和查询功能</strong></p> 
  <p style="margin-left:0cm;">// 生活中的账本 = 区块链</p> 
  <p style="margin-left:0cm;">public class NoteBook {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 用于保存数据的集合</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 添加封面 = 创世区块</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 添加封面的时候,必须保证账本是新的</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("添加封面的时候,必须保证账本是新的");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 添加交易记录 = 普通区块</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 添加交易记录的时候,必须保证账本已经有封面了</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private void addNote(String note) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("添加交易记录的时候,必须保证账本已经有封面了");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 展示数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private void showlist() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String s : list) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(s);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 保存到本地硬盘</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private void save2Disk() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static void main(String[] args) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = new NoteBook();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addGenesis("封面");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.addNote("222给2转账了一百块钱");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noteBook.showlist();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.实现保存功能</strong></p> 
  <p>增加加载本地数据的方法</p> 
  <p style="margin-left:0cm;">&nbsp;private void loadFile() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File("a.json");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断文件是否存在</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (file.exists() &amp;&amp; file.length() &gt; 0) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; 如果文件存在,读取之前的数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javatype = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, String.class);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = objectMapper.readValue(file, javatype);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">在构造函数中加载本地数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public NoteBook() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">增加保存数据到本地的方法</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 保存数据到本地硬盘</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private void save2Disk() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File file = new File("a.json");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objectMapper.writeValue(file, list);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">在添加数据时, 调用保存方法</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private void addGenesis(String genesis) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("添加封面的时候,必须保证账本是新的");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(genesis);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk();</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">private void addNote(String note) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("添加交易记录的时候,必须保证账本已经有封面了");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk();</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>二丶区块链V2增加Http访问接口</strong></p> 
  <p>本模块为账本功能提供网络接口, 使用户可以通过页面对账本进行增删改查的操作</p> 
  <p>1.<strong>增加网络访问接口</strong></p> 
  <p style="margin-left:0cm;">@RestController</p> 
  <p style="margin-left:0cm;">public class BlockController {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private NoteBook book = new NoteBook();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping(value = "/addGenesis", method = RequestMethod.POST)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String addGenesis(String genesis) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addGenesis(genesis);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "success";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "fail:" + e.getMessage();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping(value = "/addNote", method = RequestMethod.POST)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String addNote(String note) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "success";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "fail:" + e.getMessage();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping(value = "/showlist", method = RequestMethod.GET)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public ArrayList&lt;String&gt; showlist() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return book.showlist();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.增加前台页面</strong></p> 
  <p>引入资料中的静态资源</p> 
  <p style="margin-left:0cm;">&lt;!DOCTYPE html&gt;</p> 
  <p style="margin-left:0cm;">&lt;html&gt;</p> 
  <p style="margin-left:0cm;">&lt;head&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;meta charset="utf-8"/&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;title&gt;&lt;/title&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;link rel="stylesheet" type="text/css" href="css/bootstrap.css"/&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;link rel="stylesheet" type="text/css" href="css/pb.css"/&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;style type="text/css"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; body {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; margin: 30px;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #result {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; padding: 15px;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/style&gt;</p> 
  <p style="margin-left:0cm;">&lt;/head&gt;</p> 
  <p style="margin-left:0cm;">&lt;body&gt;</p> 
  <p style="margin-left:0cm;">&lt;!--输入框--&gt;</p> 
  <p style="margin-left:0cm;">&lt;input type="text" class="form-control" id="inputCtr" placeholder="请输入内容" style="width: 600px"&gt; &lt;br&gt;</p> 
  <p style="margin-left:0cm;">&lt;!--按钮组--&gt;</p> 
  <p style="margin-left:0cm;">&lt;div class="btn-group btn-group-lg" role="group"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;button type="button" class="btn btn-default" onclick="addGenesis()"&gt;添加封面&lt;/button&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;button type="button" class="btn btn-default" onclick="addNote()"&gt;添加记录&lt;/button&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;button type="button" class="btn btn-default" onclick="showlist()"&gt;展示数据&lt;/button&gt;</p> 
  <p style="margin-left:0cm;">&lt;/div&gt;</p> 
  <p style="margin-left:0cm;">&lt;br&gt;</p> 
  <p style="margin-left:0cm;">&lt;!--用于展示结果--&gt;</p> 
  <p style="margin-left:0cm;">&lt;p class="bg-info" id="result"&gt;</p> 
  <p style="margin-left:0cm;">&lt;/p&gt;</p> 
  <p style="margin-left:0cm;">&lt;script src="js/jquery-1.12.4.min.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</p> 
  <p style="margin-left:0cm;">&lt;script src="js/bootstrap.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</p> 
  <p style="margin-left:0cm;">&lt;script src="js/pb.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</p> 
  <p style="margin-left:0cm;">&lt;script src="js/jsrsasign-all-min.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</p> 
  <p style="margin-left:0cm;">&lt;script&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 添加封面</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function addGenesis() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $("#inputCtr").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("/addGenesis", "genesis=" + content, function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;$("#inputCtr").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 添加记录</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function addNote() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 用户输入的内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $("#inputCtr").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("/addNote", "note=" + content, function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //清空输入框</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#inputCtr").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示结果</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 查询最新的数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 展示数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function showlist() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 显示进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get("/showlist", function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 页面加载成功后,查询已有数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; $(function () {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&lt;/script&gt;</p> 
  <p style="margin-left:0cm;">&lt;/body&gt;</p> 
  <p style="margin-left:0cm;">&lt;/html&gt;</p> 
  <p><strong>3.进度条控件的使用</strong></p> 
  <ol>
   <li>拷贝资源pb.css和pb.js</li> 
   <li>将CSS和Js文件引入页面</li> 
   <li>示例代码</li> 
  </ol>
  <p style="margin-left:0cm;">loading.baosight.showPageLoadingMsg(false) // 显示进度条</p> 
  <p style="margin-left:0cm;">loading.baosight.hidePageLoadingMsg() // 隐藏进度条</p> 
  <p style="margin-left:0cm;">三丶<strong>区块链V3增加Hash校验</strong></p> 
  <p style="margin-left:0cm;">上一小节实现的功能,很容易导致黑客攻击,篡改数据,这一小节,为数据增加Hash校验功能,增加黑客攻击的难度.</p> 
  <p><strong>1.创建Block实体类</strong></p> 
  <p style="margin-left:0cm;">public class Block {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public int id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Block() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.Notebook中增加校验方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 校验数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String check() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append("编号为" + block.id + "的数据有可能被篡改了,请注意防范黑客&lt;br&gt;");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString();</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>3.Controller中增加方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping(value = "/check", method = RequestMethod.GET)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String check() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String check = book.check();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (StringUtils.isEmpty(check)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "数据是安全的";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return check;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">4.<strong>页面中增加表格用于展示数据</strong></p> 
  <p style="margin-left:0cm;">&lt;table class="table"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;thead&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;tr&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/tr&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/thead&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;tbody id="idTbody"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/tbody&gt;</p> 
  <p style="margin-left:0cm;">&lt;/table&gt;</p> 
  <p style="margin-left:0cm;"><strong>5.修改页面显示数据的逻辑</strong></p> 
  <p style="margin-left:0cm;">function showlist() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $("#idInput").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get("showlist", function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#idTbody").html("")</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历数据,添加数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (var i = 0; i &lt; data.length; i++) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var id = data[i].id</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = data[i].content</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var hash = data[i].hash</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#idTbody").append("&lt;tr&gt;&lt;th&gt;" + id + "&lt;/th&gt;&lt;td&gt;" + content + "&lt;/td&gt;&lt;td&gt;" + hash + "&lt;/td&gt;&lt;/tr&gt;")</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;"><strong>6.页面中增加校验数据的逻辑</strong></p> 
  <p style="margin-left:0cm;">&nbsp;// 校验数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function check() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;// 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.get("check", function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>四丶区块链V4增加工作量证明</strong></p> 
  <p>上一小节增加Hash校验后,如果黑客在篡改数据的同时,又修改了Hash,就无法达到保护数据的目的.因此本节,增加工作量证明,即生成的Hash必须符合特定的规则,如必须以0000开头.这个获取特定Hash的过程就是比特币中的挖矿.</p> 
  <p><strong>1.修改实体类,增加工作量证明字段</strong></p> 
  <p style="margin-left:0cm;">public class Block {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public int id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public int nonce;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Block() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.Notebook中增加挖矿方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;// 挖矿</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private int mine(String content) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 求取一个符合特定规则的hash值,并将运算次数返回</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String s = HashUtils.sha256(i + content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (s.startsWith("0000")) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("挖矿成功:" + i);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return i;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("挖矿失败:" + i);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("挖矿失败");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">3.<strong>Notebook中修改添加的逻辑</strong></p> 
  <p style="margin-left:0cm;">&nbsp;int nonce = mine(genesis);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + genesis), nonce);</p> 
  <p><strong>4.Notebook中修改校验的逻辑</strong></p> 
  <p style="margin-left:0cm;">&nbsp;// 校验数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String check() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (Block block : list) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = block.content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 工作量证明</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = block.nonce;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成Hash</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String hashNew = HashUtils.sha256(nonce + content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 比对hash,如果不一样说明数据内篡改</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!hashNew.equals(block.hash)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;sb.append("编号为" + block.id + "的数据有可能被篡改了,请注意防范黑客&lt;br&gt;");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString();</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>5.修改页面,表格增加列</strong></p> 
  <p style="margin-left:0cm;">&lt;table class="table"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;thead&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;tr&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/tr&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/thead&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;tbody id="idTbody"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/tbody&gt;</p> 
  <p style="margin-left:0cm;">&lt;/table&gt;</p> 
  <p><strong>6.修改页面,展示数据的逻辑</strong></p> 
  <p>$("#idTbody").append("&lt;tr&gt;&lt;th&gt;" + id + "&lt;/th&gt;&lt;td&gt;" + content + "&lt;/td&gt;&lt;td&gt;" + hash + "&lt;/td&gt;&lt;td&gt;" + nonce + "&lt;/td&gt;&lt;/tr&gt;")</p> 
  <p><strong>五丶区块链V4形成区块链</strong></p> 
  <p>本节继续增加黑客攻击的难度, 每个区块都持有上个区块的Hash值,互相咬合,形成一个链条.这样当链条足够长的时候,会大大增加黑客攻击的难度.</p> 
  <p><strong>1.修改实体类,增加preHash字段</strong></p> 
  <p style="margin-left:0cm;">public class Block {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public int id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public int nonce;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String preHash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Block() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Block(int id, String content, String hash, int nonce, String preHash) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.id = id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.hash = hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.nonce = nonce;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.preHash = preHash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.Notebook中修改添加的逻辑</strong></p> 
  <p style="margin-left:0cm;">&nbsp;public void addGenesis(String genesis) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &gt; 0) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("添加封面的时候,必须保证账本是新的");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = "0000000000000000000000000000000000000000000000000000000000000000";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + genesis);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, genesis, HashUtils.sha256(nonce + preHash + genesis), nonce, preHash);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk();</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void addNote(String note) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (list.size() &lt; 1) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("添加交易记录的时候,必须保证账本已经有封面了");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(list.size() - 1);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = preBlock.hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = mine(preHash + note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block block = new Block(list.size() + 1, note, HashUtils.sha256(nonce + preHash + note), nonce, preHash);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list.add(block);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save2Disk();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p><strong>3.Notebook中修改校验的逻辑</strong></p> 
  <p style="margin-left:0cm;">public String check() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; list.size(); i++) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block currentBlock = list.get(i);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String savedHash = currentBlock.hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String content = currentBlock.content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int nonce = currentBlock.nonce;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preHash = currentBlock.preHash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int id = currentBlock.id;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (i == 0) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创世区块,校验hash</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; preHash = "0000000000000000000000000000000000000000000000000000000000000000";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append("编号为" + id + "的数据有可能被篡改了,请注意防范黑客&lt;br&gt;");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 其他区块,校验hash,preHash</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String caculatedHash = HashUtils.sha256(nonce + preHash + content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!savedHash.equals(caculatedHash)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append("编号为" + id + "的hash有问题,请注意防范黑客&lt;br&gt;");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Block preBlock = list.get(i - 1);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String preBlockHash = preBlock.hash;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!preBlockHash.equals(preHash)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.append("编号为" + id + "的preHash有问题,请注意防范黑客&lt;br&gt;");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sb.toString();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">4.<strong>修改页面,表格增加列</strong></p> 
  <p style="margin-left:0cm;">&lt;tr&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;编号&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;内容&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;哈希值&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;工作量&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;th&gt;上一个Hash&lt;/th&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;/tr&gt;</p> 
  <p><strong>5.修改页面,展示数据的逻辑</strong></p> 
  <p>$("#idTbody").append("&lt;tr&gt;&lt;th&gt;" + id + "&lt;/th&gt;&lt;td&gt;" + content + "&lt;/td&gt;&lt;td&gt;" + hash + "&lt;/td&gt;&lt;td&gt;" + nonce + "&lt;/td&gt;&lt;td&gt;" + preHash + "&lt;/td&gt;&lt;/tr&gt;")</p> 
  <p><strong>六丶钱包功能</strong></p> 
  <p style="margin-left:0cm;">前面的章节,存储数据时,直接可见转账双方的信息,本节通过非对称加密技术和签名技术隐藏交易双方的真实信息.</p> 
  <p style="margin-left:0cm;">可以简单理解为 非对称加密中的公钥就是钱包地址,非对称加密中的私钥就是钱包的密码.</p> 
  <p style="margin-left:0cm;">1.<strong>钱包实体类</strong></p> 
  <p style="margin-left:0cm;">public class Wallet {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 公钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public PublicKey publicKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 私钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public PrivateKey privateKey;&nbsp; &nbsp; &nbsp; &nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Wallet(String name) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 保存公私钥的文件</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File pubFile = new File(name + ".pub");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File priFile = new File(name + ".pri");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 如果文件不存在,说明没有公私钥,就创建公私钥文件</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!pubFile.exists() || pubFile.length() == 0 || !priFile.exists() || priFile.length() == 0) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSAUtils.generateKeys("RSA", name + ".pri", name + ".pub");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 从文件中读取公私钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; publicKey = RSAUtils.getPublicKeyFromFile("RSA", name + ".pub");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privateKey = RSAUtils.getPrivateKey("RSA", name + ".pri");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 转账</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Transaction sendMoney(String receiverPublickKey, String content) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将公钥转为字符串</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String publicKeyEncode = Base64.encode(publicKey.getEncoded());</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String signature = RSAUtils.getSignature("SHA256withRSA", privateKey, content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成交易对象</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = new Transaction(publicKeyEncode, receiverPublickKey, signature, content);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return transaction;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.交易实体类</strong></p> 
  <p style="margin-left:0cm;">public class Transaction {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 付款方的公钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String senderPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 收款方的公钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String receiverPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 签名</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String signature;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 转账信息</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Transaction() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public Transaction(String senderPublickKey, String receiverPublickKey, String signature, String content) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 校验交易是否正确</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public boolean verify() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey sender = RSAUtils.getPublicKeyFromString("RSA", senderPublickKey);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return RSAUtils.verify("SHA256withRSA", sender, content, signature);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String getSenderPublickKey() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return senderPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void setSenderPublickKey(String senderPublickKey) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.senderPublickKey = senderPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String getReceiverPublickKey() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return receiverPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void setReceiverPublickKey(String receiverPublickKey) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.receiverPublickKey = receiverPublickKey;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String getSignature() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void setSignature(String signature) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.signature = signature;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String getContent() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void setContent(String content) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.content = content;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String toString() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "Transaction{" +</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "senderPublickKey='" + senderPublickKey + '\'' +</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ", receiverPublickKey='" + receiverPublickKey + '\'' +</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ", signature='" + signature + '\'' +</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ", content='" + content + '\'' +</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '}';</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>七丶区块链V5增加转账功能</strong></p> 
  <p style="margin-left:0cm;">本小节实现网页转账的功能</p> 
  <p style="margin-left:0cm;">jsrsasign插件 : <a href="https://github.com/kjur/jsrsasign" rel="nofollow">https://github.com/kjur/jsrsasign</a></p> 
  <p><strong>1.在页面引入插件</strong></p> 
  <p>&lt;script src="js/jsrsasign-all-min.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</p> 
  <p><strong>2.修改页面,增加输入key的文本域</strong></p> 
  <p style="margin-left:0cm;">&lt;label&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; 发送方的私钥</p> 
  <p style="margin-left:0cm;">&lt;/label&gt;</p> 
  <p style="margin-left:0cm;">&lt;textarea class="form-control" id="senderPrivateKey"&gt;</p> 
  <p style="margin-left:0cm;">&lt;/textarea&gt;</p> 
  <p style="margin-left:0cm;">&lt;label&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; 发送方的公钥</p> 
  <p style="margin-left:0cm;">&lt;/label&gt;</p> 
  <p style="margin-left:0cm;">&lt;textarea class="form-control" id="senderPublicKey"&gt;</p> 
  <p style="margin-left:0cm;">&lt;/textarea&gt;&lt;label&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; 接收方的公钥</p> 
  <p style="margin-left:0cm;">&lt;/label&gt;</p> 
  <p style="margin-left:0cm;">&lt;textarea class="form-control" id="receiverPublicKey"&gt;</p> 
  <p style="margin-left:0cm;">&lt;/textarea&gt;</p> 
  <p style="margin-left:0cm;">&lt;label&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; 转账信息</p> 
  <p style="margin-left:0cm;">&lt;/label&gt;</p> 
  <p><strong>3.修改页面添加记录的逻辑</strong></p> 
  <p style="margin-left:0cm;">&nbsp;function addNote() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取输入框的内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var senderPrivateKey = $("#senderPrivateKey").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var senderPublicKey = $("#senderPublicKey").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var receiverPublicKey = $("#receiverPublicKey").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $("#idInput").val()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成私钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var prvKey = KEYUTIL.getKey(senderPrivateKey);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定生成签名使用的算法</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sig = new KJUR.crypto.Signature({"alg": "SHA256withRSA"});</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 初始化私钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.init(prvKey);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sig.updateString(content)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 生成签名数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var sigValueHex = sig.sign()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("addNote", {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; senderPublickKey: senderPublicKey,</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; receiverPublickKey: receiverPublicKey,</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature: sigValueHex,</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content: content,</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#idInput").val("");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 展示最新的数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; showlist()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>4.修改RsaUtils,增加js生成签名,验证签名的方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;/**</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * 生成公私钥,并保存在文件中,JS版本</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; *</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 算法</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param privateKeyPath : 保存私钥的文件路径</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param publicKeyPath&nbsp; : 保存公钥的文件路径</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; */</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static void generateKeysJS(String algorithm, String privateKeyPath, String publicKeyPath) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(algorithm);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KeyPair keyPair = keyPairGenerator.generateKeyPair();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PrivateKey privateKey = keyPair.getPrivate();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PublicKey publicKey = keyPair.getPublic();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] privateKeyEncoded = privateKey.getEncoded();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] publicKeyEncoded = publicKey.getEncoded();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePrivateKey = Base64.encode(privateKeyEncoded);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String encodePublicKey = Base64.encode(publicKeyEncoded);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(privateKeyPath), "-----BEGIN PRIVATE KEY-----\n" + encodePrivateKey + "\n-----END PRIVATE KEY-----", "UTF-8");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtils.writeStringToFile(new File(publicKeyPath), encodePublicKey, "UTF-8");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; /**</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * 校验签名,JS版本</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; *</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param algorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 加密算法(SHA256withRSA)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param publicKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 公钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param originalData&nbsp;&nbsp; : 原文</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param signaturedData : 签名</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @return : 签名是否正确</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; */</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static boolean verifyDataJS(String algorithm, PublicKey publicKey, String originalData, String signaturedData) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取签名对象</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Signature signature = Signature.getInstance(algorithm);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入公钥</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.initVerify(publicKey);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 传入原文</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; signature.update(originalData.getBytes());</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return signature.verify(toBytes(signaturedData));</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; //转换方法</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static byte[] toBytes(String str) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (str == null || trim(str) == "") {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new byte[0];</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] bytes = new byte[str.length() / 2];</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; str.length() / 2; i++) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String subStr = str.substring(i * 2, i * 2 + 2);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes[i] = (byte) Integer.parseInt(subStr, 16);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return bytes;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static String trim(String str) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int startIndex = 0;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int endIndex = str.length() - 1;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean startFound = false;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (startIndex &lt;= endIndex) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int index;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = startIndex;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = endIndex;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char it = str.charAt(index);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boolean match = it &lt;= ' ';</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!startFound) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startFound = true;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; startIndex += 1;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!match)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; endIndex -= 1;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return str.substring(startIndex, endIndex + 1);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">修改Controller,添加记录的逻辑</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping(value = "/addNote", method = RequestMethod.POST)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "success";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("交易数据校验失败");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "fail:" + e.getMessage();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">八丶<strong>WebSocket简介</strong></p> 
  <p style="margin-left:0cm;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018071714053386?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1hpTWVuQ2h1aVh1ZW5nbHM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;">前面的章节章节中,我们的转账信息和生成的区块只是保存在本地,事实上我们需要把这些信息广播出去,告知其他节点.其他节点上的转账信息和生成的区块也要告知我们,这样我们就需要通过WebSocket和其他节点之间进行通信.</p> 
  <p style="margin-left:0cm;">WebSocket是一种通信协议,可以实现双向通信.</p> 
  <p style="margin-left:0cm;">具体介绍 : <a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" rel="nofollow">http://www.ruanyifeng.com/blog/2017/05/websocket.html</a></p> 
  <p style="margin-left:0cm;">本项目使用Java WebSockets框架. <a href="https://github.com/TooTallNate/Java-WebSocket" rel="nofollow">https://github.com/TooTallNate/Java-WebSocket</a></p> 
  <p><strong>快速入门案例</strong></p> 
  <p><strong>1.引入坐标</strong></p> 
  <p>compile "org.java-websocket:Java-WebSocket:1.3.8"</p> 
  <p><strong>2.创建Server</strong></p> 
  <p style="margin-left:0cm;">public class MyServer extends WebSocketServer {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 服务器端口</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private int port;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public MyServer(int port) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(new InetSocketAddress(port));</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.port = port;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onOpen(WebSocket conn, ClientHandshake handshake) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket服务器__" + port + "__打开了一个连接,对方是:" + conn.getRemoteSocketAddress().toString());</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onClose(WebSocket conn, int code, String reason, boolean remote) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket服务器__" + port + "__关闭了一个连接,对方是:" + conn.getRemoteSocketAddress().toString());</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onMessage(WebSocket conn, String message) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket服务器__" + port + "__收到了消息,对方是:" + conn.getRemoteSocketAddress().toString() + "__消息的内容是:" + message);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onError(WebSocket conn, Exception ex) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket服务器__" + port + "__发生了错误__原因:" + ex.getMessage());</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onStart() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket服务器__" + port + "__启动成功");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 开启服务器</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void startServer() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new Thread(this).start();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>3.创建Client</strong></p> 
  <p style="margin-left:0cm;">public class MyClient extends WebSocketClient {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private String name;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; /**</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param serverUri : 要连接的服务器的地址</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; * @param name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 本客户端的名字</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; */</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public MyClient(URI serverUri, String name) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(serverUri);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.name = name;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onOpen(ServerHandshake handshakedata) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket客户端__" + name + "_连接成功");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onMessage(String message) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket客户端__" + name + "_收到消息,内容是:" + message);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onClose(int code, String reason, boolean remote) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket客户端__" + name + "_连接关闭");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @Override</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void onError(Exception ex) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket客户端__" + name + "_发生错误");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>4.创建测试类</strong></p> 
  <p style="margin-left:0cm;">public class MyTest {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static void main(String[] args) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建并开启服务器</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyServer server = new MyServer(8000);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 指定服务器地址</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI("ws://localhost:8000");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 创建客户端</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client1 = new MyClient(uri, "1111");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyClient client2 = new MyClient(uri, "2222");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端连接服务器</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.connect();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client2.connect();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 避免连接尚未成功,就发送消息,导致的发送失败</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thread.sleep(1000);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 服务器发送广播</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; server.broadcast("这是来自服务器的广播");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 客户端发送消息给服务器</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client1.send("这是一号客户端发送的消息");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">九丶<strong>SpringBoot集成WebSocket</strong></p> 
  <p><strong>1.修改Application类,可以手动指定启动端口号</strong></p> 
  <p style="margin-left:0cm;">public class WsdemoApplication {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static String port;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static void main(String[] args) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户输入的内容,作为端口号</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scanner scanner = new Scanner(System.in);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = scanner.nextLine();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 启动应用</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new SpringApplicationBuilder(WsdemoApplication.class).properties("server.port=" + port).run(args);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>2.修改Springboot配置,使其可以开启多实例</strong></p> 
  <p style="margin-left:0cm;">编辑配置</p> 
  <p style="margin-left:0cm;">&nbsp;</p> 
  <p style="margin-left:0cm;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018071714094789?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1hpTWVuQ2h1aVh1ZW5nbHM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p style="margin-left:0cm;">找到对应的Application类,修改配置</p> 
  <p style="margin-left:0cm;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180717140947420?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1hpTWVuQ2h1aVh1ZW5nbHM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>3.创建Controller,实现注册节点 / 连接 / 广播功能</strong></p> 
  <p style="margin-left:0cm;">@RestController</p> 
  <p style="margin-left:0cm;">public class DemoController {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private MyServer server;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 创建服务器,开启服务器</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @PostConstruct// 创建Controller后调用该方法</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void init() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // webSocket服务器占用的端口号 = SpringBoot占用的端口号 +&nbsp; 1</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server = new MyServer(Integer.parseInt(WsdemoApplication.port) + 1);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.startServer();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private HashSet&lt;String&gt; set = new HashSet&lt;&gt;();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 注册节点</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping("/regist")</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String regist(String port) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set.add(port);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "节点:" + port + "注册成功";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 连接</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping("/conn")</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String conn() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 遍历集合,连接其他WebSocket服务器</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (String port : set) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URI uri = new URI("ws://localhost:" + port);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyClient client = new MyClient(uri, "连接到__"+port+"__服务器的客户端");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.connect();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "连接成功";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (URISyntaxException e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "连接失败:" + e.getMessage();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;// 广播</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping("/broadcast")</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String broadcast(String msg) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(msg);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "发送消息成功";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p style="margin-left:0cm;">十丶<strong>本项目集成WebSocket</strong></p> 
  <p><strong>1.参考上例将WebSocket集成进本项目</strong></p> 
  <p><strong>2.修改页面,增加对应的按钮</strong></p> 
  <p style="margin-left:0cm;">&lt;input type="text" class="form-control" id="idNode"&gt; &lt;br&gt;</p> 
  <p style="margin-left:0cm;">&lt;div class="btn-group btn-group-lg" role="group"&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;button type="button" class="btn btn-default" onclick="regist()"&gt;注册节点&lt;/button&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;button type="button" class="btn btn-default" onclick="conn()"&gt;连接&lt;/button&gt;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; &lt;button type="button" class="btn btn-default" onclick="broadcast()"&gt;发送广播&lt;/button&gt;</p> 
  <p style="margin-left:0cm;">&lt;/div&gt;</p> 
  <p><strong>3.修改页面,增加对应的点击事件</strong></p> 
  <p style="margin-left:0cm;">function regist() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $("#idNode").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("regist", "port=" + content, function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#idNode").val("");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function conn() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("conn", function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; function broadcast() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取用户在输入框中输入的内容</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var content = $("#idNode").val();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("broadcast", "msg=" + content, function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 清空输入框</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$("#idNode").val("");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>十一丶同步区块链数据</strong></p> 
  <p>当一个新节点启动的时候,是没有任何数据的,此时可以发送同步请求,从其他节点获取区块链数据.本节实现垓功能.</p> 
  <p><strong>1.页面上增加同步按钮,并实现点击事件</strong></p> 
  <p style="margin-left:0cm;">&nbsp;function syncData() {</p> 
  <p style="margin-left:0cm;">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 打开进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.showPageLoadingMsg(false);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 发起请求</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.post("syncData", function (data) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 隐藏进度条</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loading.baosight.hidePageLoadingMsg()</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $("#result").html(data)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p><strong>2.修改Notebook,使其为单例模式</strong></p> 
  <p style="margin-left:0cm;">&nbsp;private NoteBook() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadFile();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; private static volatile NoteBook instance;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public static NoteBook getInstance() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; synchronized (NoteBook.class) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (instance == null) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; instance = new NoteBook();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return&nbsp; instance;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p><strong>3.修改Controller,增加同步方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;// 向其他节点发起请求,要求获取区块链的数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; @RequestMapping("/syncData")</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String syncData() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;for (MyClient client : clients) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.send("请把你最新的区块链数据发给我一份");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "发送消息成功";</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>4.增加MessageBean,用于传递数据</strong></p> 
  <p style="margin-left:0cm;">public class MessageBean {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; // 1 ,服务器发送给客户端的最新的区块链数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public int type;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String msg;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public MessageBean() {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public MessageBean(int type, String msg) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.type = type;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.msg = msg;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>5.修改Server接收消息的方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;public void onMessage(WebSocket conn, String message) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket服务器__" + port + "__收到了消息,对方是:" + conn.getRemoteSocketAddress().toString() + "__消息的内容是:" + message);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ("请把你最新的区块链数据发给我一份".equals(message)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取本地区块链数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook noteBook = NoteBook.getInstance();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = noteBook.showlist();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String chain = objectMapper.writeValueAsString(list);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = new MessageBean(1, chain);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String msg = objectMapper.writeValueAsString(bean);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; broadcast(msg);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (JsonProcessingException e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p><strong>6.修改Client接收消息的方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp; public void onMessage(String message) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket客户端__" + name + "_收到消息,内容是:" + message);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;book.compareList(list);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (IOException e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p><strong>7.修改Notebook,增加比对数据的方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp;// 比对数据,如果新的数据长度更长,就替换掉本地数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public void compareList(ArrayList&lt;Block&gt; newList) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("参数:" + newList.size());</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (newList.size() &gt; list.size()) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list = newList;</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("list:" + list.size());</p> 
  <p style="margin-left:0cm;">}</p> 
  <p><strong>十二丶广播交易数据</strong></p> 
  <p>我们添加完交易后,将交易数据广播给其他节点</p> 
  <p><strong>1.修改Controller,添加记录的方法</strong></p> 
  <p style="margin-left:0cm;">&nbsp; @RequestMapping(value = "/addNote", method = RequestMethod.POST)</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; public String addNote(Transaction transaction) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 校验交易数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 将交易数据转为字符串</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String note = objectMapper.writeValueAsString(transaction);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 封装消息Bean</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean messageBean = new MessageBean(2, note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String bean = objectMapper.writeValueAsString(messageBean);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 广播交易数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server.broadcast(bean);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(note);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "success";</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new RuntimeException("交易数据校验失败");</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return "fail:" + e.getMessage();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p><strong>2.修改Client,接收消息的方法</strong></p> 
  <p style="margin-left:0cm;">public void onMessage(String message) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("WebSocket客户端__" + name + "_收到消息,内容是:" + message);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!StringUtils.isEmpty(message)) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NoteBook book = NoteBook.getInstance();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 解析消息对象</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ObjectMapper objectMapper = new ObjectMapper();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBean bean = objectMapper.readValue(message, MessageBean.class);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 判断消息类型</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (bean.type == 1) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; JavaType javaType = objectMapper.getTypeFactory().constructParametricType(ArrayList.class, Block.class);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ArrayList&lt;Block&gt; list = objectMapper.readValue(bean.msg, javaType);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 对数据进行比对</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.compareList(list);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (bean.type == 2) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 获取交易数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transaction transaction = objectMapper.readValue(bean.msg, Transaction.class);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 验证交易数据</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (transaction.verify()) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 添加到区块</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.addNote(bean.msg);</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception e) {</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e.printStackTrace();</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">&nbsp;&nbsp;&nbsp; }</p> 
  <p style="margin-left:0cm;">以上实现了比特币的简单实现,如果对你有帮助请帮我点赞谢谢.</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/XiMenChuiXuengls/article/details/81079887,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/XiMenChuiXuengls/article/details/81079887,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>基于星云链的智能合约与Dapp（三）——在星云链上发送交易 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="基于星云链的智能合约与Dapp（三）——在星云链上发送交易" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Nebulas提供给了我们三种方式去发送交易： 签名 &amp; 发送 密码 &amp; 发送 解锁 &amp; 发送 下面我们分别介绍如何通过以上三种方式在nebulas中发送一笔交易，并验证交易是否成功。 准备账户 在星云链上，每个地址表示一个唯一的账户。 在发送交易前，我们需要准备两个账户：一个账户用来发送代币 (称为”from”) 和另一个账户来接受代币 (称为”to”)。 发送者账户（from） 在这里，我们将会使用配置文件conf/default/genesis.conf中预分配过代币的账户中选择一个作为发送者账户，默认选择n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE。 接受者账户（to） 我们先创建一个全新的账户来作为接受者，一定不要忘记自己的密码 cd $GOPATH/src/github.com/nebulasio/go-nebulas/ ./neb account new Your new account is locked with a passphrase. Please give a passphrase. Do not forget this passphrase. Passphrase: Repeat passphrase: Address: n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6 提示：你创建的新账户和上面的不一样，请以创建的账户做为接受者继续接下来的实验。 新账户的keystore文件将会被放置在$GOPATH/src/github.com/nebulasio/go-nebulas/keydir/内。 启动私有链 具体的操作这里就不在重复，上篇文章运行星云链已经讲过。 补充： 多久会产生一个新的区块？ 在星云链上, 在贡献度证明（Proof-of-Devotion， 技术白皮书中有详细描述）被充分验证前，DPoS被选择作为一个过渡方案。DPoS共识算法中，总共有21个矿工，每个矿工会轮流每15s出一个新区块。 在目前的测试环境中，由于我们只启动了21个矿工中的一个，所以需要等待15*21s才会出一个新区块。 一旦一个新区块被挖出，挖块奖励将会被自动发送到当前矿工配置的Coinbase账户中，在conf/example/miner.conf里，该账户就是n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE. 星云链交互 星云链提供给开发者HTTP API, RPC API和CLI来和运行中的星云节点交互。我们将会基于HTTP API（API Module| Admin Module）来介绍三种发送交易的方法。 提示：星云链的HTTP服务默认端口号为8685。 首先，在发送新交易前，我们检查下发送者账户的状态。 检查账户状态 每个交易如果需要上链，都需要给矿工缴纳一部分手续费，所以发送者账户中需要有一部分钱才能成功发送交易。一般一个普通转账交易，手续费在0.000000002NAS左右，非常少。 我们可以通过API Module中的/v1/user/accountstate接口来获取发送者账户n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE的账户信息，检查下是否有足够的钱支付上链手续费。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:08:55 GMT Content-Length: 74 { &quot;result&quot;: { &quot;balance&quot;: &quot;5000023999997020942000000&quot;, &quot;nonce&quot;: &quot;137&quot;, &quot;type&quot;: 87 } } 提示： Type用于标记账户类型。88表示该账户为智能合约账户，部署一个合约之后，就可以得到一个合约账户。87表示非合约账户，我们通过./neb account new创建的账户就是非合约账户，用户存储链上资产。 Nonce用于标记账户发起的所有交易的顺序。同一个账户，每发起一个新的交易，Nonce就加一，初始为0，第一个交易的Nonce为1。 发送者账户在预分配后拥有5000000000000000000000000(5 * 10^24 )个代币，我的账户用来挖过矿所以大于这个值，1个NAS是1000000000000000000（10^18）个代币，用于支付交易上链的手续费绰绰有余。 然后我们检查接受者账户的状态。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:16:32 GMT Content-Length: 48 { &quot;result&quot;: { &quot;balance&quot;: &quot;0&quot;, &quot;nonce&quot;: &quot;0&quot;, &quot;type&quot;: 87 } } 正如我们所期望的那样，新账户没有任何代币。 发送交易 接下来，我们将介绍星云链上三种发送交易的方式。 签名 &amp; 发送 使用这种方式，我们可以在离线环境下先使用私钥签名好交易，然后把签好名的交易在联网的机器上发出。这是最安全的发送交易的方式，私钥可以完全离线保存，不触网。Web-Wallet正是基于Neb.js采用这种方法发送的交易。 首先，使用Admin Module中的v1/admin/sign接口给准备发的交易签名，得到交易的二进制数据。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/sign -d &#39;{&quot;transaction&quot;:{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:138,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;}, &quot;passphrase&quot;:&quot;passphrase&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:40:32 GMT Content-Length: 334 { &quot;result&quot;: { &quot;data&quot;: &quot;CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB&quot; } } 提示：在发送交易时，对于同一个账户，只有当他Nonce为N的交易上链后，Nonce为N+1的交易才能上链，有严格的顺序，Nonce必须严格加1。可以通过GetAccountState接口查看最新的Nonce。如果Nonce没有严格加1，就会报如下的错误：{&quot;error&quot;:&quot;transaction&#39;s nonce is invalid, should bigger than the from&#39;s nonce&quot;} 然后，我们将签好名的交易原始数据提交到本地私有链里的星云节点。 curl -i -H &#39;Content-Type: applicatioT http://localhost:8685/v1/user/rawtransaction -d &#39;{&quot;data&quot;:&quot;CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:50:35 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;5c0e30da63e70c1a2cebe73878ea8e23b8bf8f5a8e8cbde6cd046c0c63ae1c3e&quot;, &quot;contract_address&quot;: &quot;&quot; } } 密码 &amp; 发送 如果你信任一个星云节点帮你保存keystore文件，你可以使用第二种方法发送交易。 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。 cp /path/to/keystore.json /path/to/keydir/ 然后，我们发送交易的同时，带上我们keystore的密码，在被信任的节点使用SendTransactionWithPassphrase接口上一次性完成签名和发送过程。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/transactionWithPassphrase -d &#39;{&quot;transaction&quot;:{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:139,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;},&quot;passphrase&quot;:&quot;passphrase&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:22:42 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;b2e82f7704dc91eeefc2226abd2324c767d5ccbda571636cd4078d4a9b37b15e&quot;, &quot;contract_address&quot;: &quot;&quot; } } 提示：因为我们在之前使用n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE发送了一个Nonce为1的交易，所以这里新的交易的Nonce应该增加1，再提交。 解锁 &amp; 发送 这是最危险的发送交易的方法。除非你完全信任一个星云节点，否则不要使用这种方法来发送交易。 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。 cp /path/to/keystore.json /path/to/keydir/ 然后，使用你的keystore文件的密码，在指定的时间范围来在被信任的节点上使用Unlock接口解锁账户。时间单位为纳秒，300000000000为300s。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/account/unlock -d &#39;{&quot;address&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;passphrase&quot;:&quot;passphrase&quot;,&quot;duration&quot;:&quot;300000000000&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:26:04 GMT Content-Length: 26 { &quot;result&quot;: { &quot;result&quot;: true } } 一旦一个账户在节点上被解锁，任何可以访问该机器SendTransaction接口的人，都可以直接使用该账户的身份发送交易。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/transaction -d &#39;{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:140,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:27:30 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;, &quot;contract_address&quot;: &quot;&quot; } } 交易收据 不论使用的哪一种方法发送交易，我们都会得到两个返回值，txhash和contract_address。其中txhash为交易hash，是一个交易的唯一标识。如果当前交易是一个部署合约的交易，contract_address将会是合约地址，调用合约时都会使用这个地址，是合约的唯一标识。 使用txhash我们可以查看交易收据，知道当前交易的状态。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/getTransactionReceipt -d &#39;{&quot;hash&quot;:&quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:30:42 GMT Content-Length: 420 { &quot;result&quot;: { &quot;hash&quot;: &quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;, &quot;chainId&quot;: 100, &quot;from&quot;: &quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;, &quot;to&quot;: &quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;: &quot;1000000000000000000&quot;, &quot;nonce&quot;: &quot;140&quot;, &quot;timestamp&quot;: &quot;1530797250&quot;, &quot;type&quot;: &quot;binary&quot;, &quot;data&quot;: null, &quot;gas_price&quot;: &quot;1000000&quot;, &quot;gas_limit&quot;: &quot;2000000&quot;, &quot;contract_address&quot;: &quot;&quot;, &quot;status&quot;: 1, &quot;gas_used&quot;: &quot;20000&quot;, &quot;execute_error&quot;: &quot;&quot;, &quot;execute_result&quot;: &quot;&quot; } } 这里的status可能有三种状态值：0，1和2。 0: 交易失败. 表示当前交易已经上链，但是执行失败了。可能是因为部署合约或者调用合约参数错误。 1: 交易成功. 表示当前交易已经上链，而且执行成功了。 2: 交易待定. 表示当前交易还没有上链。可能是因为当前交易还没有被打包；如果长时间处于当前状态，可能是因为当前交易的发送者账户的余额不够支付上链手续费。 查询接受者账户余额 我们复查一下接受者账户上的钱是否已经到账了。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:32:30 GMT Content-Length: 66 { &quot;result&quot;: { &quot;balance&quot;: &quot;3000000000000000000&quot;, &quot;nonce&quot;: &quot;0&quot;, &quot;type&quot;: 87 } } 我们用三种方式分别发送了一笔转账，每笔转一个NAS，所以这里看到接受者账户中已经有了3个NAS，即3000000000000000000个代币。 下一章 编写并运行智能合约 阅读更多" />
<meta property="og:description" content="Nebulas提供给了我们三种方式去发送交易： 签名 &amp; 发送 密码 &amp; 发送 解锁 &amp; 发送 下面我们分别介绍如何通过以上三种方式在nebulas中发送一笔交易，并验证交易是否成功。 准备账户 在星云链上，每个地址表示一个唯一的账户。 在发送交易前，我们需要准备两个账户：一个账户用来发送代币 (称为”from”) 和另一个账户来接受代币 (称为”to”)。 发送者账户（from） 在这里，我们将会使用配置文件conf/default/genesis.conf中预分配过代币的账户中选择一个作为发送者账户，默认选择n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE。 接受者账户（to） 我们先创建一个全新的账户来作为接受者，一定不要忘记自己的密码 cd $GOPATH/src/github.com/nebulasio/go-nebulas/ ./neb account new Your new account is locked with a passphrase. Please give a passphrase. Do not forget this passphrase. Passphrase: Repeat passphrase: Address: n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6 提示：你创建的新账户和上面的不一样，请以创建的账户做为接受者继续接下来的实验。 新账户的keystore文件将会被放置在$GOPATH/src/github.com/nebulasio/go-nebulas/keydir/内。 启动私有链 具体的操作这里就不在重复，上篇文章运行星云链已经讲过。 补充： 多久会产生一个新的区块？ 在星云链上, 在贡献度证明（Proof-of-Devotion， 技术白皮书中有详细描述）被充分验证前，DPoS被选择作为一个过渡方案。DPoS共识算法中，总共有21个矿工，每个矿工会轮流每15s出一个新区块。 在目前的测试环境中，由于我们只启动了21个矿工中的一个，所以需要等待15*21s才会出一个新区块。 一旦一个新区块被挖出，挖块奖励将会被自动发送到当前矿工配置的Coinbase账户中，在conf/example/miner.conf里，该账户就是n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE. 星云链交互 星云链提供给开发者HTTP API, RPC API和CLI来和运行中的星云节点交互。我们将会基于HTTP API（API Module| Admin Module）来介绍三种发送交易的方法。 提示：星云链的HTTP服务默认端口号为8685。 首先，在发送新交易前，我们检查下发送者账户的状态。 检查账户状态 每个交易如果需要上链，都需要给矿工缴纳一部分手续费，所以发送者账户中需要有一部分钱才能成功发送交易。一般一个普通转账交易，手续费在0.000000002NAS左右，非常少。 我们可以通过API Module中的/v1/user/accountstate接口来获取发送者账户n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE的账户信息，检查下是否有足够的钱支付上链手续费。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:08:55 GMT Content-Length: 74 { &quot;result&quot;: { &quot;balance&quot;: &quot;5000023999997020942000000&quot;, &quot;nonce&quot;: &quot;137&quot;, &quot;type&quot;: 87 } } 提示： Type用于标记账户类型。88表示该账户为智能合约账户，部署一个合约之后，就可以得到一个合约账户。87表示非合约账户，我们通过./neb account new创建的账户就是非合约账户，用户存储链上资产。 Nonce用于标记账户发起的所有交易的顺序。同一个账户，每发起一个新的交易，Nonce就加一，初始为0，第一个交易的Nonce为1。 发送者账户在预分配后拥有5000000000000000000000000(5 * 10^24 )个代币，我的账户用来挖过矿所以大于这个值，1个NAS是1000000000000000000（10^18）个代币，用于支付交易上链的手续费绰绰有余。 然后我们检查接受者账户的状态。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:16:32 GMT Content-Length: 48 { &quot;result&quot;: { &quot;balance&quot;: &quot;0&quot;, &quot;nonce&quot;: &quot;0&quot;, &quot;type&quot;: 87 } } 正如我们所期望的那样，新账户没有任何代币。 发送交易 接下来，我们将介绍星云链上三种发送交易的方式。 签名 &amp; 发送 使用这种方式，我们可以在离线环境下先使用私钥签名好交易，然后把签好名的交易在联网的机器上发出。这是最安全的发送交易的方式，私钥可以完全离线保存，不触网。Web-Wallet正是基于Neb.js采用这种方法发送的交易。 首先，使用Admin Module中的v1/admin/sign接口给准备发的交易签名，得到交易的二进制数据。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/sign -d &#39;{&quot;transaction&quot;:{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:138,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;}, &quot;passphrase&quot;:&quot;passphrase&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:40:32 GMT Content-Length: 334 { &quot;result&quot;: { &quot;data&quot;: &quot;CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB&quot; } } 提示：在发送交易时，对于同一个账户，只有当他Nonce为N的交易上链后，Nonce为N+1的交易才能上链，有严格的顺序，Nonce必须严格加1。可以通过GetAccountState接口查看最新的Nonce。如果Nonce没有严格加1，就会报如下的错误：{&quot;error&quot;:&quot;transaction&#39;s nonce is invalid, should bigger than the from&#39;s nonce&quot;} 然后，我们将签好名的交易原始数据提交到本地私有链里的星云节点。 curl -i -H &#39;Content-Type: applicatioT http://localhost:8685/v1/user/rawtransaction -d &#39;{&quot;data&quot;:&quot;CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:50:35 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;5c0e30da63e70c1a2cebe73878ea8e23b8bf8f5a8e8cbde6cd046c0c63ae1c3e&quot;, &quot;contract_address&quot;: &quot;&quot; } } 密码 &amp; 发送 如果你信任一个星云节点帮你保存keystore文件，你可以使用第二种方法发送交易。 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。 cp /path/to/keystore.json /path/to/keydir/ 然后，我们发送交易的同时，带上我们keystore的密码，在被信任的节点使用SendTransactionWithPassphrase接口上一次性完成签名和发送过程。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/transactionWithPassphrase -d &#39;{&quot;transaction&quot;:{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:139,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;},&quot;passphrase&quot;:&quot;passphrase&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:22:42 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;b2e82f7704dc91eeefc2226abd2324c767d5ccbda571636cd4078d4a9b37b15e&quot;, &quot;contract_address&quot;: &quot;&quot; } } 提示：因为我们在之前使用n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE发送了一个Nonce为1的交易，所以这里新的交易的Nonce应该增加1，再提交。 解锁 &amp; 发送 这是最危险的发送交易的方法。除非你完全信任一个星云节点，否则不要使用这种方法来发送交易。 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。 cp /path/to/keystore.json /path/to/keydir/ 然后，使用你的keystore文件的密码，在指定的时间范围来在被信任的节点上使用Unlock接口解锁账户。时间单位为纳秒，300000000000为300s。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/account/unlock -d &#39;{&quot;address&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;passphrase&quot;:&quot;passphrase&quot;,&quot;duration&quot;:&quot;300000000000&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:26:04 GMT Content-Length: 26 { &quot;result&quot;: { &quot;result&quot;: true } } 一旦一个账户在节点上被解锁，任何可以访问该机器SendTransaction接口的人，都可以直接使用该账户的身份发送交易。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/transaction -d &#39;{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:140,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:27:30 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;, &quot;contract_address&quot;: &quot;&quot; } } 交易收据 不论使用的哪一种方法发送交易，我们都会得到两个返回值，txhash和contract_address。其中txhash为交易hash，是一个交易的唯一标识。如果当前交易是一个部署合约的交易，contract_address将会是合约地址，调用合约时都会使用这个地址，是合约的唯一标识。 使用txhash我们可以查看交易收据，知道当前交易的状态。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/getTransactionReceipt -d &#39;{&quot;hash&quot;:&quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:30:42 GMT Content-Length: 420 { &quot;result&quot;: { &quot;hash&quot;: &quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;, &quot;chainId&quot;: 100, &quot;from&quot;: &quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;, &quot;to&quot;: &quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;: &quot;1000000000000000000&quot;, &quot;nonce&quot;: &quot;140&quot;, &quot;timestamp&quot;: &quot;1530797250&quot;, &quot;type&quot;: &quot;binary&quot;, &quot;data&quot;: null, &quot;gas_price&quot;: &quot;1000000&quot;, &quot;gas_limit&quot;: &quot;2000000&quot;, &quot;contract_address&quot;: &quot;&quot;, &quot;status&quot;: 1, &quot;gas_used&quot;: &quot;20000&quot;, &quot;execute_error&quot;: &quot;&quot;, &quot;execute_result&quot;: &quot;&quot; } } 这里的status可能有三种状态值：0，1和2。 0: 交易失败. 表示当前交易已经上链，但是执行失败了。可能是因为部署合约或者调用合约参数错误。 1: 交易成功. 表示当前交易已经上链，而且执行成功了。 2: 交易待定. 表示当前交易还没有上链。可能是因为当前交易还没有被打包；如果长时间处于当前状态，可能是因为当前交易的发送者账户的余额不够支付上链手续费。 查询接受者账户余额 我们复查一下接受者账户上的钱是否已经到账了。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:32:30 GMT Content-Length: 66 { &quot;result&quot;: { &quot;balance&quot;: &quot;3000000000000000000&quot;, &quot;nonce&quot;: &quot;0&quot;, &quot;type&quot;: 87 } } 我们用三种方式分别发送了一笔转账，每笔转一个NAS，所以这里看到接受者账户中已经有了3个NAS，即3000000000000000000个代币。 下一章 编写并运行智能合约 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/07/05/4ffe63ae2ab5eba789a79494e8f8bbba.html" />
<meta property="og:url" content="https://mlh.app/2018/07/05/4ffe63ae2ab5eba789a79494e8f8bbba.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"Nebulas提供给了我们三种方式去发送交易： 签名 &amp; 发送 密码 &amp; 发送 解锁 &amp; 发送 下面我们分别介绍如何通过以上三种方式在nebulas中发送一笔交易，并验证交易是否成功。 准备账户 在星云链上，每个地址表示一个唯一的账户。 在发送交易前，我们需要准备两个账户：一个账户用来发送代币 (称为”from”) 和另一个账户来接受代币 (称为”to”)。 发送者账户（from） 在这里，我们将会使用配置文件conf/default/genesis.conf中预分配过代币的账户中选择一个作为发送者账户，默认选择n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE。 接受者账户（to） 我们先创建一个全新的账户来作为接受者，一定不要忘记自己的密码 cd $GOPATH/src/github.com/nebulasio/go-nebulas/ ./neb account new Your new account is locked with a passphrase. Please give a passphrase. Do not forget this passphrase. Passphrase: Repeat passphrase: Address: n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6 提示：你创建的新账户和上面的不一样，请以创建的账户做为接受者继续接下来的实验。 新账户的keystore文件将会被放置在$GOPATH/src/github.com/nebulasio/go-nebulas/keydir/内。 启动私有链 具体的操作这里就不在重复，上篇文章运行星云链已经讲过。 补充： 多久会产生一个新的区块？ 在星云链上, 在贡献度证明（Proof-of-Devotion， 技术白皮书中有详细描述）被充分验证前，DPoS被选择作为一个过渡方案。DPoS共识算法中，总共有21个矿工，每个矿工会轮流每15s出一个新区块。 在目前的测试环境中，由于我们只启动了21个矿工中的一个，所以需要等待15*21s才会出一个新区块。 一旦一个新区块被挖出，挖块奖励将会被自动发送到当前矿工配置的Coinbase账户中，在conf/example/miner.conf里，该账户就是n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE. 星云链交互 星云链提供给开发者HTTP API, RPC API和CLI来和运行中的星云节点交互。我们将会基于HTTP API（API Module| Admin Module）来介绍三种发送交易的方法。 提示：星云链的HTTP服务默认端口号为8685。 首先，在发送新交易前，我们检查下发送者账户的状态。 检查账户状态 每个交易如果需要上链，都需要给矿工缴纳一部分手续费，所以发送者账户中需要有一部分钱才能成功发送交易。一般一个普通转账交易，手续费在0.000000002NAS左右，非常少。 我们可以通过API Module中的/v1/user/accountstate接口来获取发送者账户n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE的账户信息，检查下是否有足够的钱支付上链手续费。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:08:55 GMT Content-Length: 74 { &quot;result&quot;: { &quot;balance&quot;: &quot;5000023999997020942000000&quot;, &quot;nonce&quot;: &quot;137&quot;, &quot;type&quot;: 87 } } 提示： Type用于标记账户类型。88表示该账户为智能合约账户，部署一个合约之后，就可以得到一个合约账户。87表示非合约账户，我们通过./neb account new创建的账户就是非合约账户，用户存储链上资产。 Nonce用于标记账户发起的所有交易的顺序。同一个账户，每发起一个新的交易，Nonce就加一，初始为0，第一个交易的Nonce为1。 发送者账户在预分配后拥有5000000000000000000000000(5 * 10^24 )个代币，我的账户用来挖过矿所以大于这个值，1个NAS是1000000000000000000（10^18）个代币，用于支付交易上链的手续费绰绰有余。 然后我们检查接受者账户的状态。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:16:32 GMT Content-Length: 48 { &quot;result&quot;: { &quot;balance&quot;: &quot;0&quot;, &quot;nonce&quot;: &quot;0&quot;, &quot;type&quot;: 87 } } 正如我们所期望的那样，新账户没有任何代币。 发送交易 接下来，我们将介绍星云链上三种发送交易的方式。 签名 &amp; 发送 使用这种方式，我们可以在离线环境下先使用私钥签名好交易，然后把签好名的交易在联网的机器上发出。这是最安全的发送交易的方式，私钥可以完全离线保存，不触网。Web-Wallet正是基于Neb.js采用这种方法发送的交易。 首先，使用Admin Module中的v1/admin/sign接口给准备发的交易签名，得到交易的二进制数据。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/sign -d &#39;{&quot;transaction&quot;:{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:138,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;}, &quot;passphrase&quot;:&quot;passphrase&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:40:32 GMT Content-Length: 334 { &quot;result&quot;: { &quot;data&quot;: &quot;CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB&quot; } } 提示：在发送交易时，对于同一个账户，只有当他Nonce为N的交易上链后，Nonce为N+1的交易才能上链，有严格的顺序，Nonce必须严格加1。可以通过GetAccountState接口查看最新的Nonce。如果Nonce没有严格加1，就会报如下的错误：{&quot;error&quot;:&quot;transaction&#39;s nonce is invalid, should bigger than the from&#39;s nonce&quot;} 然后，我们将签好名的交易原始数据提交到本地私有链里的星云节点。 curl -i -H &#39;Content-Type: applicatioT http://localhost:8685/v1/user/rawtransaction -d &#39;{&quot;data&quot;:&quot;CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:50:35 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;5c0e30da63e70c1a2cebe73878ea8e23b8bf8f5a8e8cbde6cd046c0c63ae1c3e&quot;, &quot;contract_address&quot;: &quot;&quot; } } 密码 &amp; 发送 如果你信任一个星云节点帮你保存keystore文件，你可以使用第二种方法发送交易。 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。 cp /path/to/keystore.json /path/to/keydir/ 然后，我们发送交易的同时，带上我们keystore的密码，在被信任的节点使用SendTransactionWithPassphrase接口上一次性完成签名和发送过程。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/transactionWithPassphrase -d &#39;{&quot;transaction&quot;:{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:139,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;},&quot;passphrase&quot;:&quot;passphrase&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:22:42 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;b2e82f7704dc91eeefc2226abd2324c767d5ccbda571636cd4078d4a9b37b15e&quot;, &quot;contract_address&quot;: &quot;&quot; } } 提示：因为我们在之前使用n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE发送了一个Nonce为1的交易，所以这里新的交易的Nonce应该增加1，再提交。 解锁 &amp; 发送 这是最危险的发送交易的方法。除非你完全信任一个星云节点，否则不要使用这种方法来发送交易。 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。 cp /path/to/keystore.json /path/to/keydir/ 然后，使用你的keystore文件的密码，在指定的时间范围来在被信任的节点上使用Unlock接口解锁账户。时间单位为纳秒，300000000000为300s。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/account/unlock -d &#39;{&quot;address&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;passphrase&quot;:&quot;passphrase&quot;,&quot;duration&quot;:&quot;300000000000&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:26:04 GMT Content-Length: 26 { &quot;result&quot;: { &quot;result&quot;: true } } 一旦一个账户在节点上被解锁，任何可以访问该机器SendTransaction接口的人，都可以直接使用该账户的身份发送交易。 curl -i -H &#39;Content-Type: application/json&#39; -X POST http://localhost:8685/v1/admin/transaction -d &#39;{&quot;from&quot;:&quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;,&quot;to&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;:&quot;1000000000000000000&quot;,&quot;nonce&quot;:140,&quot;gasPrice&quot;:&quot;1000000&quot;,&quot;gasLimit&quot;:&quot;2000000&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:27:30 GMT Content-Length: 110 { &quot;result&quot;: { &quot;txhash&quot;: &quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;, &quot;contract_address&quot;: &quot;&quot; } } 交易收据 不论使用的哪一种方法发送交易，我们都会得到两个返回值，txhash和contract_address。其中txhash为交易hash，是一个交易的唯一标识。如果当前交易是一个部署合约的交易，contract_address将会是合约地址，调用合约时都会使用这个地址，是合约的唯一标识。 使用txhash我们可以查看交易收据，知道当前交易的状态。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/getTransactionReceipt -d &#39;{&quot;hash&quot;:&quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:30:42 GMT Content-Length: 420 { &quot;result&quot;: { &quot;hash&quot;: &quot;834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d&quot;, &quot;chainId&quot;: 100, &quot;from&quot;: &quot;n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE&quot;, &quot;to&quot;: &quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;, &quot;value&quot;: &quot;1000000000000000000&quot;, &quot;nonce&quot;: &quot;140&quot;, &quot;timestamp&quot;: &quot;1530797250&quot;, &quot;type&quot;: &quot;binary&quot;, &quot;data&quot;: null, &quot;gas_price&quot;: &quot;1000000&quot;, &quot;gas_limit&quot;: &quot;2000000&quot;, &quot;contract_address&quot;: &quot;&quot;, &quot;status&quot;: 1, &quot;gas_used&quot;: &quot;20000&quot;, &quot;execute_error&quot;: &quot;&quot;, &quot;execute_result&quot;: &quot;&quot; } } 这里的status可能有三种状态值：0，1和2。 0: 交易失败. 表示当前交易已经上链，但是执行失败了。可能是因为部署合约或者调用合约参数错误。 1: 交易成功. 表示当前交易已经上链，而且执行成功了。 2: 交易待定. 表示当前交易还没有上链。可能是因为当前交易还没有被打包；如果长时间处于当前状态，可能是因为当前交易的发送者账户的余额不够支付上链手续费。 查询接受者账户余额 我们复查一下接受者账户上的钱是否已经到账了。 curl -i -H Accept:application/json -X POST http://localhost:8685/v1/user/accountstate -d &#39;{&quot;address&quot;:&quot;n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6&quot;}&#39; HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 13:32:30 GMT Content-Length: 66 { &quot;result&quot;: { &quot;balance&quot;: &quot;3000000000000000000&quot;, &quot;nonce&quot;: &quot;0&quot;, &quot;type&quot;: 87 } } 我们用三种方式分别发送了一笔转账，每笔转一个NAS，所以这里看到接受者账户中已经有了3个NAS，即3000000000000000000个代币。 下一章 编写并运行智能合约 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/07/05/4ffe63ae2ab5eba789a79494e8f8bbba.html","headline":"基于星云链的智能合约与Dapp（三）——在星云链上发送交易","dateModified":"2018-07-05T00:00:00+08:00","datePublished":"2018-07-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/07/05/4ffe63ae2ab5eba789a79494e8f8bbba.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>基于星云链的智能合约与Dapp（三）——在星云链上发送交易</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>Nebulas提供给了我们三种方式去发送交易： <br> 签名 &amp; 发送 <br> 密码 &amp; 发送 <br> 解锁 &amp; 发送 <br> 下面我们分别介绍如何通过以上三种方式在nebulas中发送一笔交易，并验证交易是否成功。</p> 
  <h5 id="准备账户">准备账户</h5> 
  <p>在星云链上，每个地址表示一个唯一的账户。 <br> 在发送交易前，我们需要准备两个账户：一个账户用来发送代币 (称为”from”) 和另一个账户来接受代币 (称为”to”)。</p> 
  <h6 id="发送者账户from">发送者账户（from）</h6> 
  <p>在这里，我们将会使用配置文件<code>conf/default/genesis.conf</code>中预分配过代币的账户中选择一个作为发送者账户，默认选择<code>n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE</code>。</p> 
  <h6 id="接受者账户to">接受者账户（to）</h6> 
  <p>我们先创建一个全新的账户来作为接受者，一定不要忘记自己的密码</p> 
  <pre class="prettyprint"><code class=" hljs coffeescript">cd $GOPATH<span class="hljs-regexp">/src/github.com/nebulasio/go-nebulas/</span>
./neb account <span class="hljs-keyword">new</span>
Your <span class="hljs-keyword">new</span> account <span class="hljs-keyword">is</span> locked <span class="hljs-reserved">with</span> a passphrase. Please give a passphrase. Do <span class="hljs-keyword">not</span> forget <span class="hljs-keyword">this</span> passphrase.
<span class="hljs-attribute">Passphrase</span>: 
Repeat <span class="hljs-attribute">passphrase</span>: 
<span class="hljs-attribute">Address</span>: n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6</code></pre> 
  <blockquote> 
   <p>提示：你创建的新账户和上面的不一样，请以创建的账户做为接受者继续接下来的实验。</p> 
  </blockquote> 
  <p>新账户的keystore文件将会被放置在<code>$GOPATH/src/github.com/nebulasio/go-nebulas/keydir/</code>内。</p> 
  <h5 id="启动私有链">启动私有链</h5> 
  <p>具体的操作这里就不在重复，上篇文章<a href="https://www.jianshu.com/p/2f431c925fdb" rel="nofollow">运行星云链</a>已经讲过。</p> 
  <blockquote> 
   <p>补充：</p> 
   <h6 id="多久会产生一个新的区块">多久会产生一个新的区块？</h6> 
   <p>在星云链上, 在贡献度证明（Proof-of-Devotion， <a href="https://nebulas.io/docs/NebulasTechnicalWhitepaper.pdf" rel="nofollow">技术白皮书</a>中有详细描述）被充分验证前，DPoS被选择作为一个过渡方案。DPoS共识算法中，总共有21个矿工，每个矿工会轮流每15s出一个新区块。 <br> 在目前的测试环境中，由于我们只启动了21个矿工中的一个，所以需要等待15*21s才会出一个新区块。</p> 
   <p>一旦一个新区块被挖出，挖块奖励将会被自动发送到当前矿工配置的Coinbase账户中，在conf/example/miner.conf里，该账户就是n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE.</p> 
  </blockquote> 
  <h5 id="星云链交互">星云链交互</h5> 
  <p>星云链提供给开发者HTTP API, RPC API和CLI来和运行中的星云节点交互。我们将会基于HTTP API（<a href="https://github.com/nebulasio/wiki/blob/master/rpc.md" rel="nofollow">API Module</a>| <a href="https://github.com/nebulasio/wiki/blob/master/rpc_admin.md" rel="nofollow">Admin Module</a>）来介绍三种发送交易的方法。</p> 
  <blockquote> 
   <p>提示：星云链的HTTP服务默认端口号为8685。 <br> 首先，在发送新交易前，我们检查下发送者账户的状态。</p> 
  </blockquote> 
  <h6 id="检查账户状态">检查账户状态</h6> 
  <p>每个交易如果需要上链，都需要给矿工缴纳一部分手续费，所以发送者账户中需要有一部分钱才能成功发送交易。一般一个普通转账交易，手续费在0.000000002NAS左右，非常少。 <br> 我们可以通过<a href="https://github.com/nebulasio/wiki/blob/master/rpc.md#getaccountstate" rel="nofollow">API Module</a>中的<code>/v1/user/accountstate</code>接口来获取发送者账户<code>n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE</code>的账户信息，检查下是否有足够的钱支付上链手续费。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">curl <span class="hljs-attribute">-i</span> <span class="hljs-attribute">-H</span> Accept:application/json <span class="hljs-attribute">-X</span> POST http:<span class="hljs-comment">//localhost:8685/v1/user/accountstate -d '{"address":"n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE"}'</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Content<span class="hljs-attribute">-Type</span>: application/json
Vary: Origin
<span class="hljs-built_in">Date</span>: Thu, <span class="hljs-number">05</span> Jul <span class="hljs-number">2018</span> <span class="hljs-number">12</span>:<span class="hljs-number">08</span>:<span class="hljs-number">55</span> GMT
Content<span class="hljs-attribute">-Length</span>: <span class="hljs-number">74</span>

{
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"balance"</span>: <span class="hljs-string">"5000023999997020942000000"</span>,
        <span class="hljs-string">"nonce"</span>: <span class="hljs-string">"137"</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-number">87</span>
    }
}</code></pre> 
  <blockquote> 
   <p>提示： <br> Type用于标记账户类型。88表示该账户为智能合约账户，部署一个合约之后，就可以得到一个合约账户。87表示非合约账户，我们通过./neb account new创建的账户就是非合约账户，用户存储链上资产。</p> 
   <p>Nonce用于标记账户发起的所有交易的顺序。同一个账户，每发起一个新的交易，Nonce就加一，初始为0，第一个交易的Nonce为1。</p> 
  </blockquote> 
  <p>发送者账户在预分配后拥有5000000000000000000000000(5 * 10^24 )个代币，我的账户用来挖过矿所以大于这个值，1个NAS是1000000000000000000（10^18）个代币，用于支付交易上链的手续费绰绰有余。 <br> 然后我们检查接受者账户的状态。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">curl <span class="hljs-attribute">-i</span> <span class="hljs-attribute">-H</span> Accept:application/json <span class="hljs-attribute">-X</span> POST http:<span class="hljs-comment">//localhost:8685/v1/user/accountstate -d '{"address":"n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6"}'</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Content<span class="hljs-attribute">-Type</span>: application/json
Vary: Origin
<span class="hljs-built_in">Date</span>: Thu, <span class="hljs-number">05</span> Jul <span class="hljs-number">2018</span> <span class="hljs-number">12</span>:<span class="hljs-number">16</span>:<span class="hljs-number">32</span> GMT
Content<span class="hljs-attribute">-Length</span>: <span class="hljs-number">48</span>

{
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"balance"</span>: <span class="hljs-string">"0"</span>,
        <span class="hljs-string">"nonce"</span>: <span class="hljs-string">"0"</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-number">87</span>
    }
}</code></pre> 
  <p>正如我们所期望的那样，新账户没有任何代币。</p> 
  <h6 id="发送交易">发送交易</h6> 
  <p>接下来，我们将介绍星云链上三种发送交易的方式。</p> 
  <p>签名 &amp; 发送 <br> 使用这种方式，我们可以在离线环境下先使用私钥签名好交易，然后把签好名的交易在联网的机器上发出。这是最安全的发送交易的方式，私钥可以完全离线保存，不触网。<a href="https://github.com/nebulasio/web-wallet" rel="nofollow">Web-Wallet</a>正是基于<a href="https://github.com/nebulasio/neb.js" rel="nofollow">Neb.js</a>采用这种方法发送的交易。 <br> 首先，使用<a href="https://github.com/nebulasio/wiki/blob/master/rpc_admin.md#signtransactionwithpassphrase" rel="nofollow">Admin Module</a>中的<code>v1/admin/sign</code>接口给准备发的交易签名，得到交易的二进制数据。</p> 
  <pre class="prettyprint"><code class=" hljs erlang">curl -i -<span class="hljs-variable">H</span> '<span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: application/json' -<span class="hljs-variable">X</span> <span class="hljs-variable">POST</span> http://localhost:<span class="hljs-number">8685</span>/v1/admin/sign -d '<span class="hljs-tuple">{<span class="hljs-string">"transaction"</span>:<span class="hljs-tuple">{<span class="hljs-string">"from"</span>:<span class="hljs-string">"n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE"</span>,<span class="hljs-string">"to"</span>:<span class="hljs-string">"n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6"</span>, <span class="hljs-string">"value"</span>:<span class="hljs-string">"1000000000000000000"</span>,<span class="hljs-string">"nonce"</span>:<span class="hljs-number">138</span>,<span class="hljs-string">"gasPrice"</span>:<span class="hljs-string">"1000000"</span>,<span class="hljs-string">"gasLimit"</span>:<span class="hljs-string">"2000000"</span>}</span>, <span class="hljs-string">"passphrase"</span>:<span class="hljs-string">"passphrase"</span>}</span>'
<span class="hljs-variable">HTTP</span>/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> <span class="hljs-variable">OK</span>
<span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: application/json
<span class="hljs-variable">Vary</span>: <span class="hljs-variable">Origin</span>
<span class="hljs-variable">Date</span>: <span class="hljs-variable">Thu</span>, <span class="hljs-number">05</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">2018</span> <span class="hljs-number">12</span>:<span class="hljs-number">40</span>:<span class="hljs-number">32</span> <span class="hljs-variable">GMT</span>
<span class="hljs-variable">Content</span>-<span class="hljs-variable">Length</span>: <span class="hljs-number">334</span>

<span class="hljs-tuple">{ <span class="hljs-string">"result"</span>: <span class="hljs-tuple">{ <span class="hljs-string">"data"</span>: <span class="hljs-string">"CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB"</span> }</span> }</span></code></pre> 
  <blockquote> 
   <p>提示：在发送交易时，对于同一个账户，只有当他<code>Nonce</code>为N的交易上链后，<code>Nonce</code>为N+1的交易才能上链，有严格的顺序，<code>Nonce</code>必须严格加1。可以通过<a href="https://github.com/nebulasio/wiki/blob/master/rpc.md#getaccountstate" rel="nofollow">GetAccountState</a>接口查看最新的Nonce。如果Nonce没有严格加1，就会报如下的错误：<code>{"error":"transaction's nonce is invalid, should bigger than the from's nonce"}</code></p> 
  </blockquote> 
  <p>然后，我们将签好名的交易原始数据提交到本地私有链里的星云节点。</p> 
  <pre class="prettyprint"><code class=" hljs scilab">curl -i -H <span class="hljs-string">'Content-Type: applicatioT http://localhost:8685/v1/user/rawtransaction -d '</span>{<span class="hljs-string">"data"</span>:<span class="hljs-string">"CiBcDjDaY+cMGizr5zh46o4juL+PWo6MvebNBGwMY64cPhIaGVcH+WT/SVMkY18ix7SG4F1+Z8evXJoA35caGhlXzNurq54Vowfvg0i/Tfqnb5rMh5/ZVOwtIhAAAAAAAAAAAA3gtrOnZAAAKIoBMP2n+NkFOggKBmJpbmFyeUBkShAAAAAAAAAAAAAAAAAAD0JAUhAAAAAAAAAAAAAAAAAAHoSAWAFiQVmw6c4pt2i/FYJXNzW5YR3AqskwScR4WemxaEhmFUdET8VBMfMRMlFuT+C/ieUefWtJ84oRNSI63nFJbrc02aUB"</span>}<span class="hljs-string">' HTTP/1.1 200 OK Content-Type: application/json Vary: Origin Date: Thu, 05 Jul 2018 12:50:35 GMT Content-Length: 110 { "</span>result<span class="hljs-string">": { "</span>txhash<span class="hljs-string">": "</span><span class="hljs-number">5</span>c0e30da63e70c1a2cebe73878ea8e23b8bf8f5a8e8cbde6cd046c0c63ae1c3e<span class="hljs-string">", "</span>contract_address<span class="hljs-string">": "</span><span class="hljs-string">" } }</span></code></pre> 
  <p>密码 &amp; 发送 <br> 如果你信任一个星云节点帮你保存keystore文件，你可以使用第二种方法发送交易。 <br> 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。</p> 
  <pre class="prettyprint"><code class=" hljs fsharp">cp /path/<span class="hljs-keyword">to</span>/keystore.json  /path/<span class="hljs-keyword">to</span>/keydir/</code></pre> 
  <p>然后，我们发送交易的同时，带上我们keystore的密码，在被信任的节点使用<a href="https://github.com/nebulasio/wiki/blob/master/rpc_admin.md#sendtransactionwithpassphrase" rel="nofollow">SendTransactionWithPassphrase</a>接口上一次性完成签名和发送过程。</p> 
  <pre class="prettyprint"><code class=" hljs erlang">curl -i -<span class="hljs-variable">H</span> '<span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: application/json' -<span class="hljs-variable">X</span> <span class="hljs-variable">POST</span> http://localhost:<span class="hljs-number">8685</span>/v1/admin/transaction<span class="hljs-variable">WithPassphrase</span> -d '<span class="hljs-tuple">{<span class="hljs-string">"transaction"</span>:<span class="hljs-tuple">{<span class="hljs-string">"from"</span>:<span class="hljs-string">"n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE"</span>,<span class="hljs-string">"to"</span>:<span class="hljs-string">"n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6"</span>, <span class="hljs-string">"value"</span>:<span class="hljs-string">"1000000000000000000"</span>,<span class="hljs-string">"nonce"</span>:<span class="hljs-number">139</span>,<span class="hljs-string">"gasPrice"</span>:<span class="hljs-string">"1000000"</span>,<span class="hljs-string">"gasLimit"</span>:<span class="hljs-string">"2000000"</span>}</span>,<span class="hljs-string">"passphrase"</span>:<span class="hljs-string">"passphrase"</span>}</span>'
<span class="hljs-variable">HTTP</span>/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> <span class="hljs-variable">OK</span>
<span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: application/json
<span class="hljs-variable">Vary</span>: <span class="hljs-variable">Origin</span>
<span class="hljs-variable">Date</span>: <span class="hljs-variable">Thu</span>, <span class="hljs-number">05</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">2018</span> <span class="hljs-number">13</span>:<span class="hljs-number">22</span>:<span class="hljs-number">42</span> <span class="hljs-variable">GMT</span>
<span class="hljs-variable">Content</span>-<span class="hljs-variable">Length</span>: <span class="hljs-number">110</span>

<span class="hljs-tuple">{ <span class="hljs-string">"result"</span>: <span class="hljs-tuple">{ <span class="hljs-string">"txhash"</span>: <span class="hljs-string">"b2e82f7704dc91eeefc2226abd2324c767d5ccbda571636cd4078d4a9b37b15e"</span>, <span class="hljs-string">"contract_address"</span>: <span class="hljs-string">""</span> }</span> }</span></code></pre> 
  <blockquote> 
   <p>提示：因为我们在之前使用<code>n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE</code>发送了一个<code>Nonce</code>为1的交易，所以这里新的交易的<code>Nonce</code>应该增加1，再提交。</p> 
  </blockquote> 
  <p>解锁 &amp; 发送 <br> 这是最危险的发送交易的方法。除非你完全信任一个星云节点，否则不要使用这种方法来发送交易。 <br> 首先，上传你的keystore文件到你信任的星云节点的keydir文件夹下。如果在节点在本地，可以使用如下指令。</p> 
  <pre class="prettyprint"><code class=" hljs fsharp">cp /path/<span class="hljs-keyword">to</span>/keystore.json /path/<span class="hljs-keyword">to</span>/keydir/</code></pre> 
  <p>然后，使用你的keystore文件的密码，在指定的时间范围来在被信任的节点上使用<a href="https://github.com/nebulasio/wiki/blob/master/rpc_admin.md#unlockaccount" rel="nofollow">Unlock</a>接口解锁账户。时间单位为纳秒，300000000000为300s。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">curl <span class="hljs-attribute">-i</span> <span class="hljs-attribute">-H</span> <span class="hljs-string">'Content-Type: application/json'</span> <span class="hljs-attribute">-X</span> POST http:<span class="hljs-comment">//localhost:8685/v1/admin/account/unlock -d '{"address":"n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE","passphrase":"passphrase","duration":"300000000000"}'</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Content<span class="hljs-attribute">-Type</span>: application/json
Vary: Origin
<span class="hljs-built_in">Date</span>: Thu, <span class="hljs-number">05</span> Jul <span class="hljs-number">2018</span> <span class="hljs-number">13</span>:<span class="hljs-number">26</span>:<span class="hljs-number">04</span> GMT
Content<span class="hljs-attribute">-Length</span>: <span class="hljs-number">26</span>

{
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"result"</span>: <span class="hljs-literal">true</span>
    }
}</code></pre> 
  <p>一旦一个账户在节点上被解锁，任何可以访问该机器<a href="https://github.com/nebulasio/wiki/blob/master/rpc_admin.md#sendtransaction" rel="nofollow">SendTransaction</a>接口的人，都可以直接使用该账户的身份发送交易。</p> 
  <pre class="prettyprint"><code class=" hljs erlang">curl -i -<span class="hljs-variable">H</span> '<span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: application/json' -<span class="hljs-variable">X</span> <span class="hljs-variable">POST</span> http://localhost:<span class="hljs-number">8685</span>/v1/admin/transaction -d '<span class="hljs-tuple">{<span class="hljs-string">"from"</span>:<span class="hljs-string">"n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE"</span>,<span class="hljs-string">"to"</span>:<span class="hljs-string">"n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6"</span>, <span class="hljs-string">"value"</span>:<span class="hljs-string">"1000000000000000000"</span>,<span class="hljs-string">"nonce"</span>:<span class="hljs-number">140</span>,<span class="hljs-string">"gasPrice"</span>:<span class="hljs-string">"1000000"</span>,<span class="hljs-string">"gasLimit"</span>:<span class="hljs-string">"2000000"</span>}</span>'
<span class="hljs-variable">HTTP</span>/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> <span class="hljs-variable">OK</span>
<span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: application/json
<span class="hljs-variable">Vary</span>: <span class="hljs-variable">Origin</span>
<span class="hljs-variable">Date</span>: <span class="hljs-variable">Thu</span>, <span class="hljs-number">05</span> <span class="hljs-variable">Jul</span> <span class="hljs-number">2018</span> <span class="hljs-number">13</span>:<span class="hljs-number">27</span>:<span class="hljs-number">30</span> <span class="hljs-variable">GMT</span>
<span class="hljs-variable">Content</span>-<span class="hljs-variable">Length</span>: <span class="hljs-number">110</span>

<span class="hljs-tuple">{ <span class="hljs-string">"result"</span>: <span class="hljs-tuple">{ <span class="hljs-string">"txhash"</span>: <span class="hljs-string">"834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d"</span>, <span class="hljs-string">"contract_address"</span>: <span class="hljs-string">""</span> }</span> }</span></code></pre> 
  <h5 id="交易收据">交易收据</h5> 
  <p>不论使用的哪一种方法发送交易，我们都会得到两个返回值，<code>txhash</code>和<code>contract_address</code>。其中<code>txhash</code>为交易hash，是一个交易的唯一标识。如果当前交易是一个部署合约的交易，<code>contract_address</code>将会是合约地址，调用合约时都会使用这个地址，是合约的唯一标识。 <br> 使用<code>txhash</code>我们可以查看交易收据，知道当前交易的状态。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">curl <span class="hljs-attribute">-i</span> <span class="hljs-attribute">-H</span> Accept:application/json <span class="hljs-attribute">-X</span> POST http:<span class="hljs-comment">//localhost:8685/v1/user/getTransactionReceipt -d '{"hash":"834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d"}'</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Content<span class="hljs-attribute">-Type</span>: application/json
Vary: Origin
<span class="hljs-built_in">Date</span>: Thu, <span class="hljs-number">05</span> Jul <span class="hljs-number">2018</span> <span class="hljs-number">13</span>:<span class="hljs-number">30</span>:<span class="hljs-number">42</span> GMT
Content<span class="hljs-attribute">-Length</span>: <span class="hljs-number">420</span>

{
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"hash"</span>: <span class="hljs-string">"834203293020737fb39a2ba82c07c4de5cfb4b0fece25c53773800a3b59dc74d"</span>,
        <span class="hljs-string">"chainId"</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">"from"</span>: <span class="hljs-string">"n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE"</span>,
        <span class="hljs-string">"to"</span>: <span class="hljs-string">"n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6"</span>,
        <span class="hljs-string">"value"</span>: <span class="hljs-string">"1000000000000000000"</span>,
        <span class="hljs-string">"nonce"</span>: <span class="hljs-string">"140"</span>,
        <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"1530797250"</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"binary"</span>,
        <span class="hljs-string">"data"</span>: <span class="hljs-built_in">null</span>,
        <span class="hljs-string">"gas_price"</span>: <span class="hljs-string">"1000000"</span>,
        <span class="hljs-string">"gas_limit"</span>: <span class="hljs-string">"2000000"</span>,
        <span class="hljs-string">"contract_address"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-string">"status"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"gas_used"</span>: <span class="hljs-string">"20000"</span>,
        <span class="hljs-string">"execute_error"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-string">"execute_result"</span>: <span class="hljs-string">""</span>
    }
}</code></pre> 
  <p>这里的status可能有三种状态值：0，1和2。 <br> 0: 交易失败. 表示当前交易已经上链，但是执行失败了。可能是因为部署合约或者调用合约参数错误。 <br> 1: 交易成功. 表示当前交易已经上链，而且执行成功了。 <br> 2: 交易待定. 表示当前交易还没有上链。可能是因为当前交易还没有被打包；如果长时间处于当前状态，可能是因为当前交易的发送者账户的余额不够支付上链手续费。</p> 
  <h5 id="查询接受者账户余额">查询接受者账户余额</h5> 
  <p>我们复查一下接受者账户上的钱是否已经到账了。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">curl <span class="hljs-attribute">-i</span> <span class="hljs-attribute">-H</span> Accept:application/json <span class="hljs-attribute">-X</span> POST http:<span class="hljs-comment">//localhost:8685/v1/user/accountstate -d '{"address":"n1ZC3JXAQ7eLt7yXCX61n8AWWJLyztuGRh6"}'</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Content<span class="hljs-attribute">-Type</span>: application/json
Vary: Origin
<span class="hljs-built_in">Date</span>: Thu, <span class="hljs-number">05</span> Jul <span class="hljs-number">2018</span> <span class="hljs-number">13</span>:<span class="hljs-number">32</span>:<span class="hljs-number">30</span> GMT
Content<span class="hljs-attribute">-Length</span>: <span class="hljs-number">66</span>

{
    <span class="hljs-string">"result"</span>: {
        <span class="hljs-string">"balance"</span>: <span class="hljs-string">"3000000000000000000"</span>,
        <span class="hljs-string">"nonce"</span>: <span class="hljs-string">"0"</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-number">87</span>
    }
}</code></pre> 
  <p>我们用三种方式分别发送了一笔转账，每笔转一个NAS，所以这里看到接受者账户中已经有了3个NAS，即3000000000000000000个代币。</p> 
  <h5 id="下一章">下一章</h5> 
  <h6 id="编写并运行智能合约"><a href="https://blog.csdn.net/zhimingshangyan/article/details/80946968" rel="nofollow">编写并运行智能合约</a></h6> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhimingshangyan/article/details/80933517,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhimingshangyan/article/details/80933517,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

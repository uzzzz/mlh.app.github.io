<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Qtum智能合约使用方法及说明 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Qtum智能合约使用方法及说明" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Qtum是一个基于比特币UTXO模型，权益证明机制(pos)和支持EVM智能合约的区块链项目。它通过创新的账户抽象层(Account Abstraction Layer)实现了比特币与以太坊两大生态的融合。如果想了解更多关于Qtum的信息，可以访问我们的官网www.qtum.org，欢迎加入我们的社区。 基于Qtum的智能合约 首先需要说明的是，使用Qtum的智能合约接口仍然需要一定的技术储备。本文对智能合约的操作在命令行中使用qtum-cli，或者在图形钱包qtum-qt的debug窗口中使用。 为了演示如何简单创建和操作一个智能合约，我们将会使用如下的合约代码： pragma solidity ^0.4.0; contract QtumTest { uint storedNumber; function QtumTest() { storedNumber=1; } function setNumber(uint number) public{ storedNumber = number; } function logNumber() constant public{ log1(&quot;storedNumber&quot;, uintToBytes(storedNumber)); } function returnNumber() constant public returns (uint){ return storedNumber; } function deposit() public payable{ } function withdraw() public{ if(!msg.sender.send(this.balance)){ throw; } } //utility function function uintToBytes(uint v) constant returns (bytes32 ret) { if (v == 0) { ret = &#39;0&#39;; } else { while (v &gt; 0) { ret = bytes32(uint(ret) / (2 ** 8)); ret |= bytes32(((v % 10) + 48) * 2 ** (8 * 31)); v /= 10; } } return ret; } } 编译以上的合约代码，生成EVM的bytecode如下： 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 同时还会得到如下的JSON接口文件: [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;returnNumber&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;withdraw&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;number&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;setNumber&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;uintToBytes&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;ret&quot;,&quot;type&quot;:&quot;bytes32&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;logNumber&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;deposit&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:true,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] 任何一个合约的这些信息都可以通过Browser Solidity这个网站获得，输入你的合约代码后，在右方点击&quot;contract details&quot;即可查询。 （提示：如果使用QT钱包中的debug窗口，在以下的命令中都不需要再包含./qtum-cli） 首先我们创建合约： ./qtum-cli createcontract 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 300000 注意，最后的参数300000是表示这笔交易的gas limit，对于这个合约，默认的数值太小，所以我们将其提升到300000。 跑完以上的代码之后，我们将会得到一个如下所示的结果: { &quot;txid&quot;: &quot;72b0e0576d289c1e4e6c777431e4845f77d0884d3b3cff0387a5f4a1a3a874ea&quot;, &quot;sender&quot;: &quot;qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt&quot;, &quot;hash160&quot;: &quot;aff3e34ab836edb8d214a993d9da105915e4a6e9&quot;, &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot; } 现在可以将上面结果中的address保存起来，方便后面使用。 export CONTRACT=5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9 现在需要等待你创建的合约被打包进一个区块，你可以通过如下的方法去确认是否被打包： ./qtum-cli getaccountinfo $CONTRACT 如果提示说Address does not exist，那么不是你的交易还未被打包进新的区块（可以通过getrawtransaction加上你的交易id来确认是否打包），就是你未提供足够多的gas。如果合约被成功的创建并且被打包到区块链上，你将会看到类似如下的结果： { &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;balance&quot;: 0, &quot;storage&quot;: { &quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000001&quot; } }, &quot;code&quot;: &quot;...&quot; } 为了执行合约中的函数，你必须要使用JSON的接口文件来创建ABI数据。有一个简单的工具叫做ethabi可以帮助你实现这个目的。确保JSON文件被保存下来了，假设名字是interface.json 为了得到合约中的变量storedNumber，我们需要调用函数returnNumber()，通过ethabi可以构建出ABI的数值： ethabi encode function ~/interface.json returnNumber 返回的结果是 3450bd6a 因为我们的state还没有发生改变，所以调用命令callcontract: ./qtum-cli callcontract $CONTRACT 3450bd6a 这个命令跑完之后的结果包含了很多有用的字段，但是当前我们只关于字段output，它的数值代表了storedNumber： { &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;executionResult&quot;: { &quot;gasUsed&quot;: 21664, &quot;excepted&quot;: &quot;None&quot;, &quot;newAddress&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;output&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000001&quot;, &quot;codeDeposit&quot;: 0, &quot;gasRefunded&quot;: 0, &quot;depositSize&quot;: 0, &quot;gasForDeposit&quot;: 0 }, &quot;transactionReceipt&quot;: { &quot;stateRoot&quot;: &quot;ffbeb0377d43c6ed443a2840259ff5ead5158016ab54d55ef21b7b11aa71947f&quot;, &quot;gasUsed&quot;: 21664, &quot;bloom&quot;: &quot;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;log&quot;: [ ] } } 为了改变storeNumber的数值，我们可以使用命令sendtocontract来在链上执行合约函数。首先我们还是需要ABI的数据： ethabi encode function ~/interface.json setNumber -p 123456 --lenient 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240 提示，我们加上了--lenient这个选项后，可以不用将参数补齐至256bit。现在我们来调用合约： ./qtum-cli sendtocontract $CONTRACT 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240 同样，做完之后我们可以再次调用&nbsp;returnNumber()来检查output字段： &quot;output&quot;: &quot;000000000000000000000000000000000000000000000000000000000001e240&quot;, 上面的结果是我们设置的数值123456的16进制形式。 此外，你还可以使用logNumber()函数来打印日志。如果你的节点启动的时候有带上参数-record-log-opcodes，那么文件&nbsp;vmExecLogs.json中会包含所有的操作日志。 你还可以通过deposit()&nbsp;和&nbsp;withdraw()&nbsp;这两个函数来从测试合约中存入和提取代币。&nbsp;deposit和withdraw的ABI数值分别是d0e30db0和3ccfd60b。 如下的命令将会向合约中发送10个token： ./qtum-cli sendtocontract $CONTRACT d0e30db0 10 同样，从合约中提取代币也非常的简单，调用如下的命令： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 你也可以手动指定以什么地址为sender调用合约，假设我的一个钱包地址是qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt，我可以使用如下的命令： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 如果你的地址里没有足够的代币，会提示Sender address does not have any unspent outputs，这个时候你需要先向地址内转入一定的代币： ./qtum-cli sendtoaddress qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 0.001 下面就可以调用sendtocontract了： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 等以上的交易被打包进一个区块之后，合约中所有的代币就会被提取到指定的地址qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt中 FAQ Q: 使用&nbsp;createcontract创建了合约，但是无法调用合约或者合约不在合约列表中A：很有可能是你的gas不够，查看vm.log日志可以看到实际需要的gas是多少，然后再手动设置gas limit Q: 我的gas设置的很大，可是多余的却没有退还A: 退款将会在coinstake中生成，需要等待500个区块时间才能被使用 Q: 我开启进程时使用了选项-reindex，然后节点就一直处于同步的状态A: 现在reindex的话，所有的合约都会被重新执行，所以链上的合约越多，需要等待的时间越长。未来我们会加速这个过程，同时也会缩短初始的同步时间。 Q: &quot;我觉得我发现了一个Qtum的bug&quot;A: 欢迎报送到这里&nbsp;https://github.com/qtumproject/qtum/issues Qtum新增的RPC命令 Qtum支持所有比特币的RPC命令，并且还新加了如下的命令： createcontract&nbsp;- 在Qtum上创建和发布智能合约，会消耗gas callcontract&nbsp;- 这是一个与Qtum上已经部署好的合约进行交互的接口，所有的计算都是在链下进行，不需要消耗gas sendtocontract&nbsp;- 这也是一个与Qtum上已经部署好的合约进行交互的接口，但是所有的计算都是在链上进行的，并且所有的状态改变都会同步到链上。这个命令可以向合约发送代币，会消耗gas getaccountinfo&nbsp;- 这个命令可以返回一个合约的基本信息，包括bytecode，存储的数据，合约的余额等 listcontracts&nbsp;- 这个命令会列出当前所有已部署的合约地址和余额，未来这个命令有可能被变更或者删除 reservebalance&nbsp;- 预留一定数额的代币，不用参与staking。如果你的这个数值设置的足够大，超过你的拥有的代币数量，那么你就不会参与到staking和创造新区块的过程中。 getstakinginfo&nbsp;- 显示当前节点的staking状态，包括当前的难度，生成下个区块的期望时间等 Qtum新增命令行参数 Qtum支持所有的比特币命令行参数，另外Qtum新增如下的参数： -record-log-opcodes&nbsp;- 在Qtum的数据目录(一般是在~/.qtum)下新建一个log文件，名字是vmExecLogs.json，所有的EVM LOG操作都会被记录。 阅读更多" />
<meta property="og:description" content="Qtum是一个基于比特币UTXO模型，权益证明机制(pos)和支持EVM智能合约的区块链项目。它通过创新的账户抽象层(Account Abstraction Layer)实现了比特币与以太坊两大生态的融合。如果想了解更多关于Qtum的信息，可以访问我们的官网www.qtum.org，欢迎加入我们的社区。 基于Qtum的智能合约 首先需要说明的是，使用Qtum的智能合约接口仍然需要一定的技术储备。本文对智能合约的操作在命令行中使用qtum-cli，或者在图形钱包qtum-qt的debug窗口中使用。 为了演示如何简单创建和操作一个智能合约，我们将会使用如下的合约代码： pragma solidity ^0.4.0; contract QtumTest { uint storedNumber; function QtumTest() { storedNumber=1; } function setNumber(uint number) public{ storedNumber = number; } function logNumber() constant public{ log1(&quot;storedNumber&quot;, uintToBytes(storedNumber)); } function returnNumber() constant public returns (uint){ return storedNumber; } function deposit() public payable{ } function withdraw() public{ if(!msg.sender.send(this.balance)){ throw; } } //utility function function uintToBytes(uint v) constant returns (bytes32 ret) { if (v == 0) { ret = &#39;0&#39;; } else { while (v &gt; 0) { ret = bytes32(uint(ret) / (2 ** 8)); ret |= bytes32(((v % 10) + 48) * 2 ** (8 * 31)); v /= 10; } } return ret; } } 编译以上的合约代码，生成EVM的bytecode如下： 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 同时还会得到如下的JSON接口文件: [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;returnNumber&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;withdraw&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;number&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;setNumber&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;uintToBytes&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;ret&quot;,&quot;type&quot;:&quot;bytes32&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;logNumber&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;deposit&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:true,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] 任何一个合约的这些信息都可以通过Browser Solidity这个网站获得，输入你的合约代码后，在右方点击&quot;contract details&quot;即可查询。 （提示：如果使用QT钱包中的debug窗口，在以下的命令中都不需要再包含./qtum-cli） 首先我们创建合约： ./qtum-cli createcontract 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 300000 注意，最后的参数300000是表示这笔交易的gas limit，对于这个合约，默认的数值太小，所以我们将其提升到300000。 跑完以上的代码之后，我们将会得到一个如下所示的结果: { &quot;txid&quot;: &quot;72b0e0576d289c1e4e6c777431e4845f77d0884d3b3cff0387a5f4a1a3a874ea&quot;, &quot;sender&quot;: &quot;qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt&quot;, &quot;hash160&quot;: &quot;aff3e34ab836edb8d214a993d9da105915e4a6e9&quot;, &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot; } 现在可以将上面结果中的address保存起来，方便后面使用。 export CONTRACT=5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9 现在需要等待你创建的合约被打包进一个区块，你可以通过如下的方法去确认是否被打包： ./qtum-cli getaccountinfo $CONTRACT 如果提示说Address does not exist，那么不是你的交易还未被打包进新的区块（可以通过getrawtransaction加上你的交易id来确认是否打包），就是你未提供足够多的gas。如果合约被成功的创建并且被打包到区块链上，你将会看到类似如下的结果： { &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;balance&quot;: 0, &quot;storage&quot;: { &quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000001&quot; } }, &quot;code&quot;: &quot;...&quot; } 为了执行合约中的函数，你必须要使用JSON的接口文件来创建ABI数据。有一个简单的工具叫做ethabi可以帮助你实现这个目的。确保JSON文件被保存下来了，假设名字是interface.json 为了得到合约中的变量storedNumber，我们需要调用函数returnNumber()，通过ethabi可以构建出ABI的数值： ethabi encode function ~/interface.json returnNumber 返回的结果是 3450bd6a 因为我们的state还没有发生改变，所以调用命令callcontract: ./qtum-cli callcontract $CONTRACT 3450bd6a 这个命令跑完之后的结果包含了很多有用的字段，但是当前我们只关于字段output，它的数值代表了storedNumber： { &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;executionResult&quot;: { &quot;gasUsed&quot;: 21664, &quot;excepted&quot;: &quot;None&quot;, &quot;newAddress&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;output&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000001&quot;, &quot;codeDeposit&quot;: 0, &quot;gasRefunded&quot;: 0, &quot;depositSize&quot;: 0, &quot;gasForDeposit&quot;: 0 }, &quot;transactionReceipt&quot;: { &quot;stateRoot&quot;: &quot;ffbeb0377d43c6ed443a2840259ff5ead5158016ab54d55ef21b7b11aa71947f&quot;, &quot;gasUsed&quot;: 21664, &quot;bloom&quot;: &quot;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;log&quot;: [ ] } } 为了改变storeNumber的数值，我们可以使用命令sendtocontract来在链上执行合约函数。首先我们还是需要ABI的数据： ethabi encode function ~/interface.json setNumber -p 123456 --lenient 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240 提示，我们加上了--lenient这个选项后，可以不用将参数补齐至256bit。现在我们来调用合约： ./qtum-cli sendtocontract $CONTRACT 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240 同样，做完之后我们可以再次调用&nbsp;returnNumber()来检查output字段： &quot;output&quot;: &quot;000000000000000000000000000000000000000000000000000000000001e240&quot;, 上面的结果是我们设置的数值123456的16进制形式。 此外，你还可以使用logNumber()函数来打印日志。如果你的节点启动的时候有带上参数-record-log-opcodes，那么文件&nbsp;vmExecLogs.json中会包含所有的操作日志。 你还可以通过deposit()&nbsp;和&nbsp;withdraw()&nbsp;这两个函数来从测试合约中存入和提取代币。&nbsp;deposit和withdraw的ABI数值分别是d0e30db0和3ccfd60b。 如下的命令将会向合约中发送10个token： ./qtum-cli sendtocontract $CONTRACT d0e30db0 10 同样，从合约中提取代币也非常的简单，调用如下的命令： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 你也可以手动指定以什么地址为sender调用合约，假设我的一个钱包地址是qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt，我可以使用如下的命令： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 如果你的地址里没有足够的代币，会提示Sender address does not have any unspent outputs，这个时候你需要先向地址内转入一定的代币： ./qtum-cli sendtoaddress qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 0.001 下面就可以调用sendtocontract了： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 等以上的交易被打包进一个区块之后，合约中所有的代币就会被提取到指定的地址qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt中 FAQ Q: 使用&nbsp;createcontract创建了合约，但是无法调用合约或者合约不在合约列表中A：很有可能是你的gas不够，查看vm.log日志可以看到实际需要的gas是多少，然后再手动设置gas limit Q: 我的gas设置的很大，可是多余的却没有退还A: 退款将会在coinstake中生成，需要等待500个区块时间才能被使用 Q: 我开启进程时使用了选项-reindex，然后节点就一直处于同步的状态A: 现在reindex的话，所有的合约都会被重新执行，所以链上的合约越多，需要等待的时间越长。未来我们会加速这个过程，同时也会缩短初始的同步时间。 Q: &quot;我觉得我发现了一个Qtum的bug&quot;A: 欢迎报送到这里&nbsp;https://github.com/qtumproject/qtum/issues Qtum新增的RPC命令 Qtum支持所有比特币的RPC命令，并且还新加了如下的命令： createcontract&nbsp;- 在Qtum上创建和发布智能合约，会消耗gas callcontract&nbsp;- 这是一个与Qtum上已经部署好的合约进行交互的接口，所有的计算都是在链下进行，不需要消耗gas sendtocontract&nbsp;- 这也是一个与Qtum上已经部署好的合约进行交互的接口，但是所有的计算都是在链上进行的，并且所有的状态改变都会同步到链上。这个命令可以向合约发送代币，会消耗gas getaccountinfo&nbsp;- 这个命令可以返回一个合约的基本信息，包括bytecode，存储的数据，合约的余额等 listcontracts&nbsp;- 这个命令会列出当前所有已部署的合约地址和余额，未来这个命令有可能被变更或者删除 reservebalance&nbsp;- 预留一定数额的代币，不用参与staking。如果你的这个数值设置的足够大，超过你的拥有的代币数量，那么你就不会参与到staking和创造新区块的过程中。 getstakinginfo&nbsp;- 显示当前节点的staking状态，包括当前的难度，生成下个区块的期望时间等 Qtum新增命令行参数 Qtum支持所有的比特币命令行参数，另外Qtum新增如下的参数： -record-log-opcodes&nbsp;- 在Qtum的数据目录(一般是在~/.qtum)下新建一个log文件，名字是vmExecLogs.json，所有的EVM LOG操作都会被记录。 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"Qtum是一个基于比特币UTXO模型，权益证明机制(pos)和支持EVM智能合约的区块链项目。它通过创新的账户抽象层(Account Abstraction Layer)实现了比特币与以太坊两大生态的融合。如果想了解更多关于Qtum的信息，可以访问我们的官网www.qtum.org，欢迎加入我们的社区。 基于Qtum的智能合约 首先需要说明的是，使用Qtum的智能合约接口仍然需要一定的技术储备。本文对智能合约的操作在命令行中使用qtum-cli，或者在图形钱包qtum-qt的debug窗口中使用。 为了演示如何简单创建和操作一个智能合约，我们将会使用如下的合约代码： pragma solidity ^0.4.0; contract QtumTest { uint storedNumber; function QtumTest() { storedNumber=1; } function setNumber(uint number) public{ storedNumber = number; } function logNumber() constant public{ log1(&quot;storedNumber&quot;, uintToBytes(storedNumber)); } function returnNumber() constant public returns (uint){ return storedNumber; } function deposit() public payable{ } function withdraw() public{ if(!msg.sender.send(this.balance)){ throw; } } //utility function function uintToBytes(uint v) constant returns (bytes32 ret) { if (v == 0) { ret = &#39;0&#39;; } else { while (v &gt; 0) { ret = bytes32(uint(ret) / (2 ** 8)); ret |= bytes32(((v % 10) + 48) * 2 ** (8 * 31)); v /= 10; } } return ret; } } 编译以上的合约代码，生成EVM的bytecode如下： 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 同时还会得到如下的JSON接口文件: [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;returnNumber&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;withdraw&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;number&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;setNumber&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;uintToBytes&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;ret&quot;,&quot;type&quot;:&quot;bytes32&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;logNumber&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;deposit&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:true,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] 任何一个合约的这些信息都可以通过Browser Solidity这个网站获得，输入你的合约代码后，在右方点击&quot;contract details&quot;即可查询。 （提示：如果使用QT钱包中的debug窗口，在以下的命令中都不需要再包含./qtum-cli） 首先我们创建合约： ./qtum-cli createcontract 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 300000 注意，最后的参数300000是表示这笔交易的gas limit，对于这个合约，默认的数值太小，所以我们将其提升到300000。 跑完以上的代码之后，我们将会得到一个如下所示的结果: { &quot;txid&quot;: &quot;72b0e0576d289c1e4e6c777431e4845f77d0884d3b3cff0387a5f4a1a3a874ea&quot;, &quot;sender&quot;: &quot;qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt&quot;, &quot;hash160&quot;: &quot;aff3e34ab836edb8d214a993d9da105915e4a6e9&quot;, &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot; } 现在可以将上面结果中的address保存起来，方便后面使用。 export CONTRACT=5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9 现在需要等待你创建的合约被打包进一个区块，你可以通过如下的方法去确认是否被打包： ./qtum-cli getaccountinfo $CONTRACT 如果提示说Address does not exist，那么不是你的交易还未被打包进新的区块（可以通过getrawtransaction加上你的交易id来确认是否打包），就是你未提供足够多的gas。如果合约被成功的创建并且被打包到区块链上，你将会看到类似如下的结果： { &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;balance&quot;: 0, &quot;storage&quot;: { &quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000001&quot; } }, &quot;code&quot;: &quot;...&quot; } 为了执行合约中的函数，你必须要使用JSON的接口文件来创建ABI数据。有一个简单的工具叫做ethabi可以帮助你实现这个目的。确保JSON文件被保存下来了，假设名字是interface.json 为了得到合约中的变量storedNumber，我们需要调用函数returnNumber()，通过ethabi可以构建出ABI的数值： ethabi encode function ~/interface.json returnNumber 返回的结果是 3450bd6a 因为我们的state还没有发生改变，所以调用命令callcontract: ./qtum-cli callcontract $CONTRACT 3450bd6a 这个命令跑完之后的结果包含了很多有用的字段，但是当前我们只关于字段output，它的数值代表了storedNumber： { &quot;address&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;executionResult&quot;: { &quot;gasUsed&quot;: 21664, &quot;excepted&quot;: &quot;None&quot;, &quot;newAddress&quot;: &quot;5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9&quot;, &quot;output&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000001&quot;, &quot;codeDeposit&quot;: 0, &quot;gasRefunded&quot;: 0, &quot;depositSize&quot;: 0, &quot;gasForDeposit&quot;: 0 }, &quot;transactionReceipt&quot;: { &quot;stateRoot&quot;: &quot;ffbeb0377d43c6ed443a2840259ff5ead5158016ab54d55ef21b7b11aa71947f&quot;, &quot;gasUsed&quot;: 21664, &quot;bloom&quot;: &quot;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;log&quot;: [ ] } } 为了改变storeNumber的数值，我们可以使用命令sendtocontract来在链上执行合约函数。首先我们还是需要ABI的数据： ethabi encode function ~/interface.json setNumber -p 123456 --lenient 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240 提示，我们加上了--lenient这个选项后，可以不用将参数补齐至256bit。现在我们来调用合约： ./qtum-cli sendtocontract $CONTRACT 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240 同样，做完之后我们可以再次调用&nbsp;returnNumber()来检查output字段： &quot;output&quot;: &quot;000000000000000000000000000000000000000000000000000000000001e240&quot;, 上面的结果是我们设置的数值123456的16进制形式。 此外，你还可以使用logNumber()函数来打印日志。如果你的节点启动的时候有带上参数-record-log-opcodes，那么文件&nbsp;vmExecLogs.json中会包含所有的操作日志。 你还可以通过deposit()&nbsp;和&nbsp;withdraw()&nbsp;这两个函数来从测试合约中存入和提取代币。&nbsp;deposit和withdraw的ABI数值分别是d0e30db0和3ccfd60b。 如下的命令将会向合约中发送10个token： ./qtum-cli sendtocontract $CONTRACT d0e30db0 10 同样，从合约中提取代币也非常的简单，调用如下的命令： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 你也可以手动指定以什么地址为sender调用合约，假设我的一个钱包地址是qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt，我可以使用如下的命令： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 如果你的地址里没有足够的代币，会提示Sender address does not have any unspent outputs，这个时候你需要先向地址内转入一定的代币： ./qtum-cli sendtoaddress qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 0.001 下面就可以调用sendtocontract了： ./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 等以上的交易被打包进一个区块之后，合约中所有的代币就会被提取到指定的地址qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt中 FAQ Q: 使用&nbsp;createcontract创建了合约，但是无法调用合约或者合约不在合约列表中A：很有可能是你的gas不够，查看vm.log日志可以看到实际需要的gas是多少，然后再手动设置gas limit Q: 我的gas设置的很大，可是多余的却没有退还A: 退款将会在coinstake中生成，需要等待500个区块时间才能被使用 Q: 我开启进程时使用了选项-reindex，然后节点就一直处于同步的状态A: 现在reindex的话，所有的合约都会被重新执行，所以链上的合约越多，需要等待的时间越长。未来我们会加速这个过程，同时也会缩短初始的同步时间。 Q: &quot;我觉得我发现了一个Qtum的bug&quot;A: 欢迎报送到这里&nbsp;https://github.com/qtumproject/qtum/issues Qtum新增的RPC命令 Qtum支持所有比特币的RPC命令，并且还新加了如下的命令： createcontract&nbsp;- 在Qtum上创建和发布智能合约，会消耗gas callcontract&nbsp;- 这是一个与Qtum上已经部署好的合约进行交互的接口，所有的计算都是在链下进行，不需要消耗gas sendtocontract&nbsp;- 这也是一个与Qtum上已经部署好的合约进行交互的接口，但是所有的计算都是在链上进行的，并且所有的状态改变都会同步到链上。这个命令可以向合约发送代币，会消耗gas getaccountinfo&nbsp;- 这个命令可以返回一个合约的基本信息，包括bytecode，存储的数据，合约的余额等 listcontracts&nbsp;- 这个命令会列出当前所有已部署的合约地址和余额，未来这个命令有可能被变更或者删除 reservebalance&nbsp;- 预留一定数额的代币，不用参与staking。如果你的这个数值设置的足够大，超过你的拥有的代币数量，那么你就不会参与到staking和创造新区块的过程中。 getstakinginfo&nbsp;- 显示当前节点的staking状态，包括当前的难度，生成下个区块的期望时间等 Qtum新增命令行参数 Qtum支持所有的比特币命令行参数，另外Qtum新增如下的参数： -record-log-opcodes&nbsp;- 在Qtum的数据目录(一般是在~/.qtum)下新建一个log文件，名字是vmExecLogs.json，所有的EVM LOG操作都会被记录。 阅读更多","@type":"BlogPosting","url":"/2018/07/16/f1690e511e64b0b84f645da531a40055.html","headline":"Qtum智能合约使用方法及说明","dateModified":"2018-07-16T00:00:00+08:00","datePublished":"2018-07-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/07/16/f1690e511e64b0b84f645da531a40055.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Qtum智能合约使用方法及说明</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018071614464380?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjY2NzA3OQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="">Qtum是一个基于比特币UTXO模型，权益证明机制(pos)和支持EVM智能合约的区块链项目。它通过创新的账户抽象层(Account Abstraction Layer)实现了比特币与以太坊两大生态的融合。如果想了解更多关于Qtum的信息，可以访问我们的官网<a href="http://docs.qtum.site/zh/www.qtum.org" rel="nofollow" style="color:rgb(65,131,196);background:0px 0px;">www.qtum.org</a>，欢迎加入我们的社区。</p>
  <h2 id="基于qtum的智能合约" style="font-size:1.75em;color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">基于Qtum的智能合约</h2>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">首先需要说明的是，使用Qtum的智能合约接口仍然需要一定的技术储备。本文对智能合约的操作在命令行中使用<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">qtum-cli</code>，或者在图形钱包<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">qtum-qt</code>的debug窗口中使用。 为了演示如何简单创建和操作一个智能合约，我们将会使用如下的合约代码：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">pragma solidity ^0.4.0;
contract QtumTest {
   uint storedNumber;
   function QtumTest() {
       storedNumber=1;
   }
   function setNumber(uint number) public{
       storedNumber = number;
   }
   function logNumber() constant public{
        log1("storedNumber", uintToBytes(storedNumber));
   }
   function returnNumber() constant public returns (uint){
       return storedNumber;
   }
   function deposit() public payable{
   }
   function withdraw() public{
       if(!msg.sender.send(this.balance)){
           throw;
       }
   }
   //utility function
   function uintToBytes(uint v) constant returns (bytes32 ret) {
       if (v == 0) {
           ret = '0';
       }
       else {
           while (v &gt; 0) {
               ret = bytes32(uint(ret) / (2 ** 8));
               ret |= bytes32(((v % 10) + 48) * 2 ** (8 * 31));
               v /= 10;
           }
       }
       return ret;
   }
}
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">编译以上的合约代码，生成EVM的bytecode如下：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">同时还会得到如下的JSON接口文件:</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">[{"constant":true,"inputs":[],"name":"returnNumber","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"number","type":"uint256"}],"name":"setNumber","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"v","type":"uint256"}],"name":"uintToBytes","outputs":[{"name":"ret","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"logNumber","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"deposit","outputs":[],"payable":true,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">任何一个合约的这些信息都可以通过<a href="https://ethereum.github.io/browser-solidity/" rel="nofollow" style="color:rgb(65,131,196);background:0px 0px;">Browser Solidity</a>这个网站获得，输入你的合约代码后，在右方点击"contract details"即可查询。</p>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);"><span>（提示：如果使用QT钱包中的debug窗口，在以下的命令中都不需要再包含<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">./qtum-cli</code>）</span></p>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">首先我们创建合约：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli createcontract 6060604052341561000c57fe5b5b60016000819055505b5b6102bd806100266000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633450bd6a146100785780633ccfd60b1461009e5780633fb5c1cb146100b057806394e8767d146100d05780639f2c436f1461010c578063d0e30db01461011e575bfe5b341561008057fe5b610088610128565b6040518082815260200191505060405180910390f35b34156100a657fe5b6100ae610133565b005b34156100b857fe5b6100ce6004808035906020019091905050610190565b005b34156100d857fe5b6100ee600480803590602001909190505061019b565b60405180826000191660001916815260200191505060405180910390f35b341561011457fe5b61011c610246565b005b61012661028e565b005b600060005490505b90565b3373ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051809050600060405180830381858888f19350505050151561018d57610000565b5b565b806000819055505b50565b600060008214156101ce577f3000000000000000000000000000000000000000000000000000000000000000905061023d565b5b600082111561023c5761010081600190048115156101e957fe5b0460010290507f01000000000000000000000000000000000000000000000000000000000000006030600a8481151561021e57fe5b06010260010281179050600a8281151561023457fe5b0491506101cf565b5b8090505b919050565b61025160005461019b565b6000191660405180807f73746f7265644e756d6265720000000000000000000000000000000000000000815250600c01905060405180910390a15b565b5b5600a165627a7a72305820326efcd34df5fdba07e7a1afe7ffd4b42873ef749ae9a5915db46fd20b9c251c0029 300000
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">注意，最后的参数300000是表示这笔交易的<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">gas limit</code>，对于这个合约，默认的数值太小，所以我们将其提升到300000。</p>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">跑完以上的代码之后，我们将会得到一个如下所示的结果:</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">{
  "txid": "72b0e0576d289c1e4e6c777431e4845f77d0884d3b3cff0387a5f4a1a3a874ea",
  "sender": "qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt",
  "hash160": "aff3e34ab836edb8d214a993d9da105915e4a6e9",
  "address": "5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9"
}
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">现在可以将上面结果中的<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">address</code>保存起来，方便后面使用。</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">export CONTRACT=5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">现在需要等待你创建的合约被打包进一个区块，你可以通过如下的方法去确认是否被打包：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli getaccountinfo $CONTRACT
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">如果提示说<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">Address does not exist</code>，那么不是你的交易还未被打包进新的区块（可以通过<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">getrawtransaction</code>加上你的交易id来确认是否打包），就是你未提供足够多的gas。如果合约被成功的创建并且被打包到区块链上，你将会看到类似如下的结果：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">{
  "address": "5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9",
  "balance": 0,
  "storage": {
    "290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563": {
      "0000000000000000000000000000000000000000000000000000000000000000": "0000000000000000000000000000000000000000000000000000000000000001"
    }
  },
  "code": "..."
}
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">为了执行合约中的函数，你必须要使用JSON的接口文件来创建ABI数据。有一个简单的工具叫做<a href="https://github.com/paritytech/ethabi" rel="nofollow" style="color:rgb(65,131,196);background:0px 0px;">ethabi</a>可以帮助你实现这个目的。确保JSON文件被保存下来了，假设名字是<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">interface.json</code></p>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">为了得到合约中的变量<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">storedNumber</code>，我们需要调用函数<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">returnNumber()</code>，通过ethabi可以构建出ABI的数值：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">ethabi encode function ~/interface.json returnNumber
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">返回的结果是</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">3450bd6a
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">因为我们的state还没有发生改变，所以调用命令<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">callcontract</code>:</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli callcontract $CONTRACT 3450bd6a
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">这个命令跑完之后的结果包含了很多有用的字段，但是当前我们只关于字段<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">output</code>，它的数值代表了<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">storedNumber</code>：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">{
  "address": "5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9",
  "executionResult": {
    "gasUsed": 21664,
    "excepted": "None",
    "newAddress": "5bde092dbecb84ea1a229b4c5b25dfc9cdc674d9",
    "output": "0000000000000000000000000000000000000000000000000000000000000001",
    "codeDeposit": 0,
    "gasRefunded": 0,
    "depositSize": 0,
    "gasForDeposit": 0
  },
  "transactionReceipt": {
    "stateRoot": "ffbeb0377d43c6ed443a2840259ff5ead5158016ab54d55ef21b7b11aa71947f",
    "gasUsed": 21664,
    "bloom": "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    "log": [
    ]
  }
}
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">为了改变<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">storeNumber</code>的数值，我们可以使用命令<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">sendtocontract</code>来在链上执行合约函数。首先我们还是需要ABI的数据：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">ethabi encode function ~/interface.json setNumber -p 123456 --lenient
3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">提示，我们加上了<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">--lenient</code>这个选项后，可以不用将参数补齐至256bit。现在我们来调用合约：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli sendtocontract $CONTRACT 3fb5c1cb000000000000000000000000000000000000000000000000000000000001e240
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">同样，做完之后我们可以再次调用&nbsp;<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">returnNumber()</code>来检查<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">output</code>字段：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">"output": "000000000000000000000000000000000000000000000000000000000001e240",
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">上面的结果是我们设置的数值123456的16进制形式。</p>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">此外，你还可以使用<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">logNumber()</code>函数来打印日志。如果你的节点启动的时候有带上参数<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">-record-log-opcodes</code>，那么文件&nbsp;<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">vmExecLogs.json</code>中会包含所有的操作日志。</p>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">你还可以通过<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">deposit()</code>&nbsp;和&nbsp;<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">withdraw()</code>&nbsp;这两个函数来从测试合约中存入和提取代币。&nbsp;<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">deposit</code>和<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">withdraw</code>的ABI数值分别是d0e30db0和3ccfd60b。 如下的命令将会向合约中发送10个token：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli sendtocontract $CONTRACT d0e30db0 10
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">同样，从合约中提取代币也非常的简单，调用如下的命令：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli sendtocontract $CONTRACT 3ccfd60b
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">你也可以手动指定以什么地址为<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">sender</code>调用合约，假设我的一个钱包地址是<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt</code>，我可以使用如下的命令：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">如果你的地址里没有足够的代币，会提示<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">Sender address does not have any unspent outputs</code>，这个时候你需要先向地址内转入一定的代币：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli sendtoaddress qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt 0.001
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">下面就可以调用<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">sendtocontract</code>了：</p>
  <pre style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:16px;border:none;color:rgb(51,51,51);background:rgb(247,247,247);letter-spacing:.2px;"><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background:0px 0px;line-height:inherit;">./qtum-cli sendtocontract $CONTRACT 3ccfd60b 0 190000 0.0000001 qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt
</code></pre>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">等以上的交易被打包进一个区块之后，合约中所有的代币就会被提取到指定的地址<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">qZbjaE8N18ZU1m7851G7QGhvxKL74SRBTt</code>中</p>
  <h2 id="faq" style="font-size:1.75em;color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">FAQ</h2>
  <ul style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">
   <li><p>Q: 使用&nbsp;<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">createcontract</code>创建了合约，但是无法调用合约或者合约不在合约列表中</p><p>A：很有可能是你的gas不够，查看<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">vm.log</code>日志可以看到实际需要的gas是多少，然后再手动设置gas limit</p></li>
   <li><p>Q: 我的gas设置的很大，可是多余的却没有退还</p><p>A: 退款将会在coinstake中生成，需要等待500个区块时间才能被使用</p></li>
   <li><p>Q: 我开启进程时使用了选项<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">-reindex</code>，然后节点就一直处于同步的状态</p><p>A: 现在reindex的话，所有的合约都会被重新执行，所以链上的合约越多，需要等待的时间越长。未来我们会加速这个过程，同时也会缩短初始的同步时间。</p></li>
   <li><p>Q: "我觉得我发现了一个Qtum的bug"</p><p>A: 欢迎报送到这里&nbsp;<a href="https://github.com/qtumproject/qtum/issues" rel="nofollow" style="color:rgb(65,131,196);background:0px 0px;">https://github.com/qtumproject/qtum/issues</a></p></li>
  </ul>
  <h1 id="qtum新增的rpc命令" style="font-size:2em;color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">Qtum新增的RPC命令</h1>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">Qtum支持所有比特币的RPC命令，并且还新加了如下的命令：</p>
  <ul style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">createcontract</code>&nbsp;- 在Qtum上创建和发布智能合约，会消耗gas</li>
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">callcontract</code>&nbsp;- 这是一个与Qtum上已经部署好的合约进行交互的接口，所有的计算都是在链下进行，不需要消耗gas</li>
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">sendtocontract</code>&nbsp;- 这也是一个与Qtum上已经部署好的合约进行交互的接口，但是所有的计算都是在链上进行的，并且所有的状态改变都会同步到链上。这个命令可以向合约发送代币，会消耗gas</li>
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">getaccountinfo</code>&nbsp;- 这个命令可以返回一个合约的基本信息，包括bytecode，存储的数据，合约的余额等</li>
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">listcontracts</code>&nbsp;- 这个命令会列出当前所有已部署的合约地址和余额，未来这个命令有可能被变更或者删除</li>
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">reservebalance</code>&nbsp;- 预留一定数额的代币，不用参与staking。如果你的这个数值设置的足够大，超过你的拥有的代币数量，那么你就不会参与到staking和创造新区块的过程中。</li>
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">getstakinginfo</code>&nbsp;- 显示当前节点的staking状态，包括当前的难度，生成下个区块的期望时间等</li>
  </ul>
  <h1 id="qtum新增命令行参数" style="font-size:2em;color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">Qtum新增命令行参数</h1>
  <p style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">Qtum支持所有的比特币命令行参数，另外Qtum新增如下的参数：</p>
  <ul style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;letter-spacing:.2px;background-color:rgb(255,255,255);">
   <li><code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">-record-log-opcodes</code>&nbsp;- 在Qtum的数据目录(一般是在~/.qtum)下新建一个log文件，名字是<code style="font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:.85em;border:none;color:inherit;background-color:rgb(247,247,247);">vmExecLogs.json</code>，所有的EVM LOG操作都会被记录。</li>
  </ul> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_42667079/article/details/81065037,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_42667079/article/details/81065037,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

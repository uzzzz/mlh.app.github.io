<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>如何开发以太坊网页钱包·Express + web3.js 实例 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="如何开发以太坊网页钱包·Express + web3.js 实例" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="如何开发以太坊网页钱包·Express + web3.js 实例 &nbsp; 10.15.1.&nbsp;创建项目 安装以太坊环境 curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/gcc/gcc.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/golang/golang-1.10.2.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.7.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/systemd/private.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/node-v10.1.0.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/profile.d.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/truffle/truffle.sh | bash 安装开发包 npm install express npm install web3 npm install ejs 10.15.2.&nbsp;主程序 main.js var express = require(&#39;express&#39;); var app = express(); app.use(express.static(&#39;public&#39;)); app.set(&quot;view engine&quot;,&quot;ejs&quot;); app.set(&#39;views&#39;, __dirname + &#39;/views&#39;); var async = require(&#39;async&#39;); fs = require(&#39;fs&#39;); var net = require(&#39;net&#39;); var Web3 = require(&#39;web3&#39;); var web3 = new Web3(&#39;/home/ethereum/.ethereum/geth.ipc&#39;, net); const abi = fs.readFileSync( __dirname + &#39;/abi/NKC.abi&#39;, &#39;utf-8&#39;); const coinbase = &quot;0xaa96686a050e4916afbe9f6d62fa646dd8c51070&quot; const contractAddress = &quot;0x5F75DA091aBb25e055B91172C04371Ff4Dd563a0&quot;; console.log(web3.version) app.get(&#39;/&#39;, function (req, res) { // res.send(&#39;Hello World&#39;); res.render(&quot;index&quot;,{}); }) app.get(&#39;/account.html&#39;, function (req, res) { var accounts; web3.eth.getAccounts(function(err, acc) { accounts = acc res.render(&quot;account&quot;,{&quot;accounts&quot;:accounts}); }); }) app.get(&#39;/new&#39;, function (req, res) { web3.eth.personal.newAccount(req.query.password).then(function(){ res.redirect(&#39;/account.html&#39;); }); }) app.get(&#39;/balance.html&#39;, function (req, res) { web3.eth.getAccounts(function(err, accounts) { res.render(&quot;balance&quot;,{&quot;accounts&quot;:accounts}); }); }) app.post(&#39;/showbalance.html&#39;, function (req, res) { // web3.eth.getBalance(req.query.account).then(function(balance){ // res.render(&quot;transfer&quot;,{&quot;account&quot;:req.query.account, &quot;balance&quot;: balance}); // }); res.render(&quot;showbalance&quot;,{&quot;account&quot;: &quot;sss&quot;, &quot;balance&quot;: 1000}); }) app.get(&#39;/getbalance.html&#39;, function (req, res) { var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000}); web3.eth.getBalance(req.query.account).then(function(balance){ contract.methods.balanceOf(req.query.account).call().then(function(token){ // console.log(contract.symbol.call()); // contract.methods.symbol().call().then(console.log); contract.methods.symbol().call().then(function(name){ res.render(&quot;showbalance&quot;,{&quot;account&quot;:req.query.account, &quot;balance&quot;: web3.utils.fromWei(balance, &#39;ether&#39;), &quot;token&quot;: token, &quot;name&quot;: name}); }); }); }); }) app.get(&#39;/transfer.html&#39;, function (req, res) { var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000}); web3.eth.getAccounts(function(err, accounts) { contract.methods.symbol().call().then(function(symbol){ res.render(&quot;transfer&quot;,{&quot;accounts&quot;:accounts, &quot;symbol&quot;: symbol}); }); }); }) app.get(&#39;/send&#39;, function (req, res) { // console.log(req.query) web3.eth.personal.unlockAccount(req.query.from, req.query.password).then(function(error){ if(req.query.token == &quot;ETH&quot;){ web3.eth.sendTransaction({ from: req.query.from, to: req.query.to, value: web3.utils.toWei(req.query.amount ,&#39;ether&#39;) }, function(error, result){ if(!error) { console.log(&quot;#&quot; + result + &quot;#&quot;) res.render(&quot;done&quot;,{&quot;hash&quot;:result}); } else { console.error(error); } }); }else{ var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: req.query.from , gas: 1000000}); contract.methods.transfer(req.query.to, req.query.amount).send().then(function(hash){ console.log(hash) res.render(&quot;done&quot;,{&quot;hash&quot;:hash.transactionHash}); }); } }); }) var server = app.listen(8080, function () { var host = server.address().address var port = server.address().port console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port) }) 10.15.3.&nbsp;ABI 文件 abi/NKC.abi [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burn&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burnFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;name&quot;:&quot;_extraData&quot;,&quot;type&quot;:&quot;bytes&quot;}],&quot;name&quot;:&quot;approveAndCall&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;initialSupply&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;name&quot;:&quot;tokenName&quot;,&quot;type&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;tokenSymbol&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Burn&quot;,&quot;type&quot;:&quot;event&quot;}] 10.15.4.&nbsp;页面视图 10.15.4.1.&nbsp;views/account.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Users&lt;/h1&gt; &lt;ul id=&quot;accounts&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;li&gt;&lt;%= index %&gt;, &lt;%= account %&gt;&lt;/li&gt; &lt;% }) %&gt; &lt;/ul&gt; &lt;p&gt; 新建账号 &lt;form method=&quot;get&quot; action=&quot;/new&quot;&gt; 密码：&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;新建账号&quot; /&gt; &lt;/form&gt; &lt;/p&gt; 10.15.4.2.&nbsp;views/balance.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Account&lt;/h1&gt; &lt;form method=&quot;get&quot; action=&quot;/getbalance.html&quot;&gt; &lt;select name=&quot;account&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt; &lt;/form&gt; 10.15.4.3.&nbsp;views/done.ejs &lt;%- include header.ejs %&gt; &lt;p&gt;转账完成&lt;/p&gt; &lt;p&gt;查看交易 &lt;a href=&quot;https://etherscan.io/tx/&lt;%= hash %&gt;&quot; target=&quot;etherscan&quot;&gt;主网&lt;%= hash %&gt;&lt;/a&gt; &lt;br /&gt; &lt;/p&gt; 10.15.4.4.&nbsp;views/header.ejs &lt;a href=&quot;/account.html&quot;&gt;账号&lt;/a&gt; | &lt;a href=&quot;/balance.html&quot;&gt;余额&lt;/a&gt; | &lt;a href=&quot;/transfer.html&quot;&gt;转账&lt;/a&gt; &lt;br /&gt; &lt;hr /&gt; 10.15.4.5.&nbsp;views/index.ejs &lt;%- include header.ejs %&gt; Welcome !!! 10.15.4.6.&nbsp;views/showbalance.ejs &lt;%- include header.ejs %&gt; &lt;p&gt; &lt;h1&gt;Account: &lt;%= account %&gt;, Balance: &lt;%= balance %&gt;&lt;/h1&gt; &lt;/p&gt; &lt;p&gt; Token: &lt;%= token%&gt; &lt;%= name%&gt; &lt;/p&gt; 10.15.4.7.&nbsp;views/transfer.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Account&lt;/h1&gt; &lt;form method=&quot;get&quot; action=&quot;/send&quot;&gt; From： &lt;select name=&quot;from&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;br /&gt; To: &lt;select name=&quot;to&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;select name=&quot;token&quot;&gt; &lt;option value =&quot;ETH&quot;&gt;ETH&lt;/option&gt; &lt;option value =&quot;&lt;%= symbol %&gt;&quot;&gt;&lt;%= symbol %&gt;&lt;/option&gt; &lt;/select&gt; &lt;br /&gt; 金额: &lt;input type=&quot;text&quot; name=&quot;amount&quot; /&gt; ETH &lt;br /&gt; 密码：&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt; &lt;br /&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt; &lt;/form&gt; 10.15.5.&nbsp;启动 Node 服务 neo@MacBook-Pro ~/example % node main.js 浏览器访问 http://localhost:8080/ 可以进入钱包 阅读更多" />
<meta property="og:description" content="如何开发以太坊网页钱包·Express + web3.js 实例 &nbsp; 10.15.1.&nbsp;创建项目 安装以太坊环境 curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/gcc/gcc.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/golang/golang-1.10.2.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.7.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/systemd/private.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/node-v10.1.0.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/profile.d.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/truffle/truffle.sh | bash 安装开发包 npm install express npm install web3 npm install ejs 10.15.2.&nbsp;主程序 main.js var express = require(&#39;express&#39;); var app = express(); app.use(express.static(&#39;public&#39;)); app.set(&quot;view engine&quot;,&quot;ejs&quot;); app.set(&#39;views&#39;, __dirname + &#39;/views&#39;); var async = require(&#39;async&#39;); fs = require(&#39;fs&#39;); var net = require(&#39;net&#39;); var Web3 = require(&#39;web3&#39;); var web3 = new Web3(&#39;/home/ethereum/.ethereum/geth.ipc&#39;, net); const abi = fs.readFileSync( __dirname + &#39;/abi/NKC.abi&#39;, &#39;utf-8&#39;); const coinbase = &quot;0xaa96686a050e4916afbe9f6d62fa646dd8c51070&quot; const contractAddress = &quot;0x5F75DA091aBb25e055B91172C04371Ff4Dd563a0&quot;; console.log(web3.version) app.get(&#39;/&#39;, function (req, res) { // res.send(&#39;Hello World&#39;); res.render(&quot;index&quot;,{}); }) app.get(&#39;/account.html&#39;, function (req, res) { var accounts; web3.eth.getAccounts(function(err, acc) { accounts = acc res.render(&quot;account&quot;,{&quot;accounts&quot;:accounts}); }); }) app.get(&#39;/new&#39;, function (req, res) { web3.eth.personal.newAccount(req.query.password).then(function(){ res.redirect(&#39;/account.html&#39;); }); }) app.get(&#39;/balance.html&#39;, function (req, res) { web3.eth.getAccounts(function(err, accounts) { res.render(&quot;balance&quot;,{&quot;accounts&quot;:accounts}); }); }) app.post(&#39;/showbalance.html&#39;, function (req, res) { // web3.eth.getBalance(req.query.account).then(function(balance){ // res.render(&quot;transfer&quot;,{&quot;account&quot;:req.query.account, &quot;balance&quot;: balance}); // }); res.render(&quot;showbalance&quot;,{&quot;account&quot;: &quot;sss&quot;, &quot;balance&quot;: 1000}); }) app.get(&#39;/getbalance.html&#39;, function (req, res) { var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000}); web3.eth.getBalance(req.query.account).then(function(balance){ contract.methods.balanceOf(req.query.account).call().then(function(token){ // console.log(contract.symbol.call()); // contract.methods.symbol().call().then(console.log); contract.methods.symbol().call().then(function(name){ res.render(&quot;showbalance&quot;,{&quot;account&quot;:req.query.account, &quot;balance&quot;: web3.utils.fromWei(balance, &#39;ether&#39;), &quot;token&quot;: token, &quot;name&quot;: name}); }); }); }); }) app.get(&#39;/transfer.html&#39;, function (req, res) { var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000}); web3.eth.getAccounts(function(err, accounts) { contract.methods.symbol().call().then(function(symbol){ res.render(&quot;transfer&quot;,{&quot;accounts&quot;:accounts, &quot;symbol&quot;: symbol}); }); }); }) app.get(&#39;/send&#39;, function (req, res) { // console.log(req.query) web3.eth.personal.unlockAccount(req.query.from, req.query.password).then(function(error){ if(req.query.token == &quot;ETH&quot;){ web3.eth.sendTransaction({ from: req.query.from, to: req.query.to, value: web3.utils.toWei(req.query.amount ,&#39;ether&#39;) }, function(error, result){ if(!error) { console.log(&quot;#&quot; + result + &quot;#&quot;) res.render(&quot;done&quot;,{&quot;hash&quot;:result}); } else { console.error(error); } }); }else{ var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: req.query.from , gas: 1000000}); contract.methods.transfer(req.query.to, req.query.amount).send().then(function(hash){ console.log(hash) res.render(&quot;done&quot;,{&quot;hash&quot;:hash.transactionHash}); }); } }); }) var server = app.listen(8080, function () { var host = server.address().address var port = server.address().port console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port) }) 10.15.3.&nbsp;ABI 文件 abi/NKC.abi [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burn&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burnFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;name&quot;:&quot;_extraData&quot;,&quot;type&quot;:&quot;bytes&quot;}],&quot;name&quot;:&quot;approveAndCall&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;initialSupply&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;name&quot;:&quot;tokenName&quot;,&quot;type&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;tokenSymbol&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Burn&quot;,&quot;type&quot;:&quot;event&quot;}] 10.15.4.&nbsp;页面视图 10.15.4.1.&nbsp;views/account.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Users&lt;/h1&gt; &lt;ul id=&quot;accounts&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;li&gt;&lt;%= index %&gt;, &lt;%= account %&gt;&lt;/li&gt; &lt;% }) %&gt; &lt;/ul&gt; &lt;p&gt; 新建账号 &lt;form method=&quot;get&quot; action=&quot;/new&quot;&gt; 密码：&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;新建账号&quot; /&gt; &lt;/form&gt; &lt;/p&gt; 10.15.4.2.&nbsp;views/balance.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Account&lt;/h1&gt; &lt;form method=&quot;get&quot; action=&quot;/getbalance.html&quot;&gt; &lt;select name=&quot;account&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt; &lt;/form&gt; 10.15.4.3.&nbsp;views/done.ejs &lt;%- include header.ejs %&gt; &lt;p&gt;转账完成&lt;/p&gt; &lt;p&gt;查看交易 &lt;a href=&quot;https://etherscan.io/tx/&lt;%= hash %&gt;&quot; target=&quot;etherscan&quot;&gt;主网&lt;%= hash %&gt;&lt;/a&gt; &lt;br /&gt; &lt;/p&gt; 10.15.4.4.&nbsp;views/header.ejs &lt;a href=&quot;/account.html&quot;&gt;账号&lt;/a&gt; | &lt;a href=&quot;/balance.html&quot;&gt;余额&lt;/a&gt; | &lt;a href=&quot;/transfer.html&quot;&gt;转账&lt;/a&gt; &lt;br /&gt; &lt;hr /&gt; 10.15.4.5.&nbsp;views/index.ejs &lt;%- include header.ejs %&gt; Welcome !!! 10.15.4.6.&nbsp;views/showbalance.ejs &lt;%- include header.ejs %&gt; &lt;p&gt; &lt;h1&gt;Account: &lt;%= account %&gt;, Balance: &lt;%= balance %&gt;&lt;/h1&gt; &lt;/p&gt; &lt;p&gt; Token: &lt;%= token%&gt; &lt;%= name%&gt; &lt;/p&gt; 10.15.4.7.&nbsp;views/transfer.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Account&lt;/h1&gt; &lt;form method=&quot;get&quot; action=&quot;/send&quot;&gt; From： &lt;select name=&quot;from&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;br /&gt; To: &lt;select name=&quot;to&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;select name=&quot;token&quot;&gt; &lt;option value =&quot;ETH&quot;&gt;ETH&lt;/option&gt; &lt;option value =&quot;&lt;%= symbol %&gt;&quot;&gt;&lt;%= symbol %&gt;&lt;/option&gt; &lt;/select&gt; &lt;br /&gt; 金额: &lt;input type=&quot;text&quot; name=&quot;amount&quot; /&gt; ETH &lt;br /&gt; 密码：&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt; &lt;br /&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt; &lt;/form&gt; 10.15.5.&nbsp;启动 Node 服务 neo@MacBook-Pro ~/example % node main.js 浏览器访问 http://localhost:8080/ 可以进入钱包 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/07/19/8ab2a1f9767eb65551ed6b77e8d24e57.html" />
<meta property="og:url" content="https://mlh.app/2018/07/19/8ab2a1f9767eb65551ed6b77e8d24e57.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-19T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"如何开发以太坊网页钱包·Express + web3.js 实例 &nbsp; 10.15.1.&nbsp;创建项目 安装以太坊环境 curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/gcc/gcc.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/golang/golang-1.10.2.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.7.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/systemd/private.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/node-v10.1.0.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/profile.d.sh | bash curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/truffle/truffle.sh | bash 安装开发包 npm install express npm install web3 npm install ejs 10.15.2.&nbsp;主程序 main.js var express = require(&#39;express&#39;); var app = express(); app.use(express.static(&#39;public&#39;)); app.set(&quot;view engine&quot;,&quot;ejs&quot;); app.set(&#39;views&#39;, __dirname + &#39;/views&#39;); var async = require(&#39;async&#39;); fs = require(&#39;fs&#39;); var net = require(&#39;net&#39;); var Web3 = require(&#39;web3&#39;); var web3 = new Web3(&#39;/home/ethereum/.ethereum/geth.ipc&#39;, net); const abi = fs.readFileSync( __dirname + &#39;/abi/NKC.abi&#39;, &#39;utf-8&#39;); const coinbase = &quot;0xaa96686a050e4916afbe9f6d62fa646dd8c51070&quot; const contractAddress = &quot;0x5F75DA091aBb25e055B91172C04371Ff4Dd563a0&quot;; console.log(web3.version) app.get(&#39;/&#39;, function (req, res) { // res.send(&#39;Hello World&#39;); res.render(&quot;index&quot;,{}); }) app.get(&#39;/account.html&#39;, function (req, res) { var accounts; web3.eth.getAccounts(function(err, acc) { accounts = acc res.render(&quot;account&quot;,{&quot;accounts&quot;:accounts}); }); }) app.get(&#39;/new&#39;, function (req, res) { web3.eth.personal.newAccount(req.query.password).then(function(){ res.redirect(&#39;/account.html&#39;); }); }) app.get(&#39;/balance.html&#39;, function (req, res) { web3.eth.getAccounts(function(err, accounts) { res.render(&quot;balance&quot;,{&quot;accounts&quot;:accounts}); }); }) app.post(&#39;/showbalance.html&#39;, function (req, res) { // web3.eth.getBalance(req.query.account).then(function(balance){ // res.render(&quot;transfer&quot;,{&quot;account&quot;:req.query.account, &quot;balance&quot;: balance}); // }); res.render(&quot;showbalance&quot;,{&quot;account&quot;: &quot;sss&quot;, &quot;balance&quot;: 1000}); }) app.get(&#39;/getbalance.html&#39;, function (req, res) { var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000}); web3.eth.getBalance(req.query.account).then(function(balance){ contract.methods.balanceOf(req.query.account).call().then(function(token){ // console.log(contract.symbol.call()); // contract.methods.symbol().call().then(console.log); contract.methods.symbol().call().then(function(name){ res.render(&quot;showbalance&quot;,{&quot;account&quot;:req.query.account, &quot;balance&quot;: web3.utils.fromWei(balance, &#39;ether&#39;), &quot;token&quot;: token, &quot;name&quot;: name}); }); }); }); }) app.get(&#39;/transfer.html&#39;, function (req, res) { var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000}); web3.eth.getAccounts(function(err, accounts) { contract.methods.symbol().call().then(function(symbol){ res.render(&quot;transfer&quot;,{&quot;accounts&quot;:accounts, &quot;symbol&quot;: symbol}); }); }); }) app.get(&#39;/send&#39;, function (req, res) { // console.log(req.query) web3.eth.personal.unlockAccount(req.query.from, req.query.password).then(function(error){ if(req.query.token == &quot;ETH&quot;){ web3.eth.sendTransaction({ from: req.query.from, to: req.query.to, value: web3.utils.toWei(req.query.amount ,&#39;ether&#39;) }, function(error, result){ if(!error) { console.log(&quot;#&quot; + result + &quot;#&quot;) res.render(&quot;done&quot;,{&quot;hash&quot;:result}); } else { console.error(error); } }); }else{ var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: req.query.from , gas: 1000000}); contract.methods.transfer(req.query.to, req.query.amount).send().then(function(hash){ console.log(hash) res.render(&quot;done&quot;,{&quot;hash&quot;:hash.transactionHash}); }); } }); }) var server = app.listen(8080, function () { var host = server.address().address var port = server.address().port console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port) }) 10.15.3.&nbsp;ABI 文件 abi/NKC.abi [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burn&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burnFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;name&quot;:&quot;_extraData&quot;,&quot;type&quot;:&quot;bytes&quot;}],&quot;name&quot;:&quot;approveAndCall&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;initialSupply&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;name&quot;:&quot;tokenName&quot;,&quot;type&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;tokenSymbol&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Burn&quot;,&quot;type&quot;:&quot;event&quot;}] 10.15.4.&nbsp;页面视图 10.15.4.1.&nbsp;views/account.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Users&lt;/h1&gt; &lt;ul id=&quot;accounts&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;li&gt;&lt;%= index %&gt;, &lt;%= account %&gt;&lt;/li&gt; &lt;% }) %&gt; &lt;/ul&gt; &lt;p&gt; 新建账号 &lt;form method=&quot;get&quot; action=&quot;/new&quot;&gt; 密码：&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt; &lt;input type=&quot;submit&quot; value=&quot;新建账号&quot; /&gt; &lt;/form&gt; &lt;/p&gt; 10.15.4.2.&nbsp;views/balance.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Account&lt;/h1&gt; &lt;form method=&quot;get&quot; action=&quot;/getbalance.html&quot;&gt; &lt;select name=&quot;account&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt; &lt;/form&gt; 10.15.4.3.&nbsp;views/done.ejs &lt;%- include header.ejs %&gt; &lt;p&gt;转账完成&lt;/p&gt; &lt;p&gt;查看交易 &lt;a href=&quot;https://etherscan.io/tx/&lt;%= hash %&gt;&quot; target=&quot;etherscan&quot;&gt;主网&lt;%= hash %&gt;&lt;/a&gt; &lt;br /&gt; &lt;/p&gt; 10.15.4.4.&nbsp;views/header.ejs &lt;a href=&quot;/account.html&quot;&gt;账号&lt;/a&gt; | &lt;a href=&quot;/balance.html&quot;&gt;余额&lt;/a&gt; | &lt;a href=&quot;/transfer.html&quot;&gt;转账&lt;/a&gt; &lt;br /&gt; &lt;hr /&gt; 10.15.4.5.&nbsp;views/index.ejs &lt;%- include header.ejs %&gt; Welcome !!! 10.15.4.6.&nbsp;views/showbalance.ejs &lt;%- include header.ejs %&gt; &lt;p&gt; &lt;h1&gt;Account: &lt;%= account %&gt;, Balance: &lt;%= balance %&gt;&lt;/h1&gt; &lt;/p&gt; &lt;p&gt; Token: &lt;%= token%&gt; &lt;%= name%&gt; &lt;/p&gt; 10.15.4.7.&nbsp;views/transfer.ejs &lt;%- include header.ejs %&gt; &lt;h1&gt;Account&lt;/h1&gt; &lt;form method=&quot;get&quot; action=&quot;/send&quot;&gt; From： &lt;select name=&quot;from&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;br /&gt; To: &lt;select name=&quot;to&quot;&gt; &lt;% accounts.forEach(function(account, index){ %&gt; &lt;option value =&quot;&lt;%= account %&gt;&quot;&gt;&lt;%= account %&gt;&lt;/option&gt; &lt;% }) %&gt; &lt;/select&gt; &lt;select name=&quot;token&quot;&gt; &lt;option value =&quot;ETH&quot;&gt;ETH&lt;/option&gt; &lt;option value =&quot;&lt;%= symbol %&gt;&quot;&gt;&lt;%= symbol %&gt;&lt;/option&gt; &lt;/select&gt; &lt;br /&gt; 金额: &lt;input type=&quot;text&quot; name=&quot;amount&quot; /&gt; ETH &lt;br /&gt; 密码：&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt; &lt;br /&gt; &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt; &lt;/form&gt; 10.15.5.&nbsp;启动 Node 服务 neo@MacBook-Pro ~/example % node main.js 浏览器访问 http://localhost:8080/ 可以进入钱包 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/07/19/8ab2a1f9767eb65551ed6b77e8d24e57.html","headline":"如何开发以太坊网页钱包·Express + web3.js 实例","dateModified":"2018-07-19T00:00:00+08:00","datePublished":"2018-07-19T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/07/19/8ab2a1f9767eb65551ed6b77e8d24e57.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>如何开发以太坊网页钱包·Express + web3.js 实例</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h1>如何开发以太坊网页钱包·Express + web3.js 实例</h1> 
  <h2>&nbsp;</h2> 
  <h3>10.15.1.&nbsp;创建项目</h3> 
  <p>安装以太坊环境</p> 
  <pre>
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/gcc/gcc.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/golang/golang-1.10.2.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.7.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/systemd/private.sh | bash

curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/node-v10.1.0.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/profile.d.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/truffle/truffle.sh | bash</pre> 
  <p>安装开发包</p> 
  <pre>
npm install express
npm install web3
npm install ejs</pre> 
  <h3>10.15.2.&nbsp;主程序 main.js</h3> 
  <pre>
var express = require('express');
var app = express();

app.use(express.static('public'));
app.set("view engine","ejs");
app.set('views', __dirname + '/views');  

var async = require('async');

fs = require('fs');
var net = require('net');
var Web3 = require('web3');
var web3 = new Web3('/home/ethereum/.ethereum/geth.ipc', net);
const abi = fs.readFileSync( __dirname + '/abi/NKC.abi', 'utf-8');
const coinbase = "0xaa96686a050e4916afbe9f6d62fa646dd8c51070"
const contractAddress = "0x5F75DA091aBb25e055B91172C04371Ff4Dd563a0";

console.log(web3.version)


app.get('/', function (req, res) {
  //  res.send('Hello World');
   res.render("index",{}); 
})

app.get('/account.html', function (req, res) {
  var accounts;
  web3.eth.getAccounts(function(err, acc) {
    accounts = acc
    res.render("account",{"accounts":accounts}); 
  });
})

app.get('/new', function (req, res) {
  web3.eth.personal.newAccount(req.query.password).then(function(){
    res.redirect('/account.html');
  });
})

app.get('/balance.html', function (req, res) {

  web3.eth.getAccounts(function(err, accounts) {
    res.render("balance",{"accounts":accounts}); 
  });
})
app.post('/showbalance.html', function (req, res) {
  // web3.eth.getBalance(req.query.account).then(function(balance){
  //   res.render("transfer",{"account":req.query.account, "balance": balance}); 
  // });
  
  res.render("showbalance",{"account": "sss", "balance": 1000}); 
})

app.get('/getbalance.html', function (req, res) {
  var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});
  web3.eth.getBalance(req.query.account).then(function(balance){
    contract.methods.balanceOf(req.query.account).call().then(function(token){
      // console.log(contract.symbol.call());
      // contract.methods.symbol().call().then(console.log);
      contract.methods.symbol().call().then(function(name){
        res.render("showbalance",{"account":req.query.account, "balance": web3.utils.fromWei(balance, 'ether'), "token": token, "name": name}); 
      });
      
    });
    
  });
})

app.get('/transfer.html', function (req, res) {
  var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});
  web3.eth.getAccounts(function(err, accounts) {
    contract.methods.symbol().call().then(function(symbol){
      res.render("transfer",{"accounts":accounts, "symbol": symbol}); 
    });
  });
})

app.get('/send', function (req, res) {
  // console.log(req.query)
  web3.eth.personal.unlockAccount(req.query.from, req.query.password).then(function(error){
    if(req.query.token == "ETH"){  
      web3.eth.sendTransaction({
        from: req.query.from,
        to: req.query.to,
        value: web3.utils.toWei(req.query.amount ,'ether')
      },
      function(error, result){
          if(!error) {
              console.log("#" + result + "#")
              res.render("done",{"hash":result}); 
          } else {
              console.error(error);
          }
      });
      
    }else{
      var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: req.query.from , gas: 1000000});
      contract.methods.transfer(req.query.to, req.query.amount).send().then(function(hash){
        console.log(hash)
        res.render("done",{"hash":hash.transactionHash}); 
      });
    }
  });
})

var server = app.listen(8080, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log("应用实例，访问地址为 http://%s:%s", host, port)
 
})</pre> 
  <h3>10.15.3.&nbsp;ABI 文件 abi/NKC.abi</h3> 
  <pre>
[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"initialSupply","type":"uint256"},{"name":"tokenName","type":"string"},{"name":"tokenSymbol","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"}]			</pre> 
  <h3>10.15.4.&nbsp;页面视图</h3> 
  <p>10.15.4.1.&nbsp;views/account.ejs</p> 
  <pre>
&lt;%- include header.ejs %&gt;

&lt;h1&gt;Users&lt;/h1&gt;
&lt;ul id="accounts"&gt;
    &lt;% accounts.forEach(function(account, index){ %&gt;
    &lt;li&gt;&lt;%= index %&gt;, &lt;%= account %&gt;&lt;/li&gt;
    &lt;% }) %&gt;
&lt;/ul&gt;

&lt;p&gt;
新建账号
&lt;form method="get" action="/new"&gt;
    密码：&lt;input type="password" name="password" /&gt;
    &lt;input type="submit" value="新建账号" /&gt;
&lt;/form&gt;
&lt;/p&gt;</pre> 
  <p>10.15.4.2.&nbsp;views/balance.ejs</p> 
  <pre>
&lt;%- include header.ejs %&gt;

&lt;h1&gt;Account&lt;/h1&gt;
&lt;form method="get" action="/getbalance.html"&gt;

    &lt;select name="account"&gt;
        &lt;% accounts.forEach(function(account, index){ %&gt;
        &lt;option value ="&lt;%= account %&gt;"&gt;&lt;%= account %&gt;&lt;/option&gt;
        &lt;% }) %&gt;
    &lt;/select&gt;
    &lt;input type="submit" value="Submit" /&gt;
&lt;/form&gt;</pre> 
  <p>10.15.4.3.&nbsp;views/done.ejs</p> 
  <pre>
&lt;%- include header.ejs %&gt;

&lt;p&gt;转账完成&lt;/p&gt;
&lt;p&gt;查看交易
&lt;a href="https://etherscan.io/tx/&lt;%= hash %&gt;" target="etherscan"&gt;主网&lt;%= hash %&gt;&lt;/a&gt; &lt;br /&gt;
&lt;/p&gt;</pre> 
  <p>10.15.4.4.&nbsp;views/header.ejs</p> 
  <pre>
&lt;a href="/account.html"&gt;账号&lt;/a&gt; | &lt;a href="/balance.html"&gt;余额&lt;/a&gt; | &lt;a href="/transfer.html"&gt;转账&lt;/a&gt;
&lt;br /&gt; 
&lt;hr /&gt;</pre> 
  <p>10.15.4.5.&nbsp;views/index.ejs</p> 
  <pre>
&lt;%- include header.ejs %&gt;

Welcome !!!</pre> 
  <p>10.15.4.6.&nbsp;views/showbalance.ejs</p> 
  <pre>
&lt;%- include header.ejs %&gt;
&lt;p&gt;
&lt;h1&gt;Account: &lt;%= account %&gt;, Balance: &lt;%= balance %&gt;&lt;/h1&gt;
&lt;/p&gt;

&lt;p&gt;
    Token: &lt;%= token%&gt; &lt;%= name%&gt; 
&lt;/p&gt;</pre> 
  <p>10.15.4.7.&nbsp;views/transfer.ejs</p> 
  <pre>
&lt;%- include header.ejs %&gt;

&lt;h1&gt;Account&lt;/h1&gt;
&lt;form method="get" action="/send"&gt;
    From：
    &lt;select name="from"&gt;
        &lt;% accounts.forEach(function(account, index){ %&gt;
        &lt;option value ="&lt;%= account %&gt;"&gt;&lt;%= account %&gt;&lt;/option&gt;
        &lt;% }) %&gt;
    &lt;/select&gt;
    &lt;br /&gt;
    To:
    &lt;select name="to"&gt;
        &lt;% accounts.forEach(function(account, index){ %&gt;
        &lt;option value ="&lt;%= account %&gt;"&gt;&lt;%= account %&gt;&lt;/option&gt;
        &lt;% }) %&gt;
    &lt;/select&gt;

    &lt;select name="token"&gt;
        &lt;option value ="ETH"&gt;ETH&lt;/option&gt;
        &lt;option value ="&lt;%= symbol %&gt;"&gt;&lt;%= symbol %&gt;&lt;/option&gt;
    &lt;/select&gt;

    &lt;br /&gt;
    金额: &lt;input type="text" name="amount" /&gt; ETH
    &lt;br /&gt;
    密码：&lt;input type="password" name="password" /&gt;
    &lt;br /&gt;
    &lt;input type="submit" value="Submit" /&gt;
&lt;/form&gt;</pre> 
  <h3>10.15.5.&nbsp;启动 Node 服务</h3> 
  <pre>
neo@MacBook-Pro ~/example % node main.js</pre> 
  <p>浏览器访问 http://localhost:8080/ 可以进入钱包</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ffzhihua/article/details/81120344,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ffzhihua/article/details/81120344,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

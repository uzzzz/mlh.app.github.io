<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>eosjs简明使用手册（最新版） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="eosjs简明使用手册（最新版）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="eosjs简明使用手册（最新版） 以下教程用于EOS正式版，已在DEV开发链和EOS1.0.5-1.0.7版本的主链上测试通过。 官方文档因为版本的原因，内容多有错误，仅供参考。 eosjs的API与http-RPC调用一致，如rpc使用get-block，则在eosjs中使用getBlock()方法。即去横岗，首字符大写 eosjs几个容易出错的地方 asset类型，表达方式为字符串，如：100.0000 EOS，千万注意小数点后四位，少一位都不行 与链连接时需要指定chainId，可以通过cleos get info获得 1- 安装eosjs eosjs用于对交易签名、交易等操作。&nbsp;eosjs-api用于读取链上数据，只读，如果只需要读取链上数据的话，只需要使用eosjs-api。 在nodejs中安装： npm install eosjs npm install eosjs-api 注意nodejs需要最新版，如安装过程发生错误，请用node -v和npm -v查看版本。 2- 建立eosjs与链的连接 Eos = require(&#39;eosjs&#39;) // Optional configuration.. config = { keyProvider: [&#39;PrivateKeys...&#39;], // 配置私钥字符串 httpEndpoint: &#39;http://178.62.196.196:8888&#39;, //DEV开发链url与端口 chainId: &quot;0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a&quot;, // 通过cleos get info可以获取chainId mockTransactions: () =&gt; null, // 如果要广播，需要设为null transactionHeaders: (expireInSeconds, callback) =&gt; { callback(null/*error*/, headers) //手动设置交易记录头，该方法中的callback回调函数每次交易都会被调用 }, expireInSeconds: 60, broadcast: true, debug: false, sign: true, authorization: null // 该参数用于在多签名情况下，识别签名帐号与权限,格式如：account@permission } eos = Eos(config) 3- 建立eosjs-api与链的连接 如果加载了eosjs后，默认加载eosjs-api，无需单独链接eosjs-api与链 EosApi = require(&#39;eosjs-api&#39;) // everything is optional options = { httpEndpoint: &#39;http://178.62.196.196:8888&#39;, verbose: false, // API logging logger: { // Default logging functions //log: config.verbose ? console.log : &#39;&#39;, error: console.error }, fetchConfiguration: {} } eos = EosApi(options) 4- 获取帮助 不添加如何参数，可以获取该方法的使用说明，如： eos.getBlock() 5- 获取链上最新出块信息 eos.getInfo({}).then(result =&gt; { console.log(result) }) 返回： { server_version: &#39;b195012b&#39;, chain_id: &#39;0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a&#39;, head_block_num: 209307, last_irreversible_block_num: 209267, last_irreversible_block_id: &#39;00033173a9ccd4bdd60a92d257e9354023b0457b134797be472a236cd908bc31&#39;, head_block_id: &#39;0003319ba8ddc60d80c3cd0c7a70695cfd951f51ace9a798c913384cfbae659c&#39;, head_block_time: &#39;2018-07-15T01:51:07.500&#39;, head_block_producer: &#39;eoshackathon&#39;, virtual_block_cpu_limit: 100000000, virtual_block_net_limit: 1048576000, block_cpu_limit: 99900, block_net_limit: 1048576 } 如果需要拿到某一个数据值，比如：head_block_producer，则使用： eos.getInfo({}).then(result =&gt; { console.log(result.head_block_producer) //以对象属性方式获取head_block_producer }) 6- 获取指定区块信息 eos.getBlock(200000).then(result =&gt; { console.log(result) }) //获取第200000个区块 或者： eos.getBlock({block_num_or_id: 200000}).then(result =&gt; { console.log(result) }) //获取第200000个区块 或者： eos.getBlock(&#39;00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355&#39;).then(result =&gt; { console.log(result) }) //根据id获取区块 或者： eos.getBlock({block_num_or_id: &#39;00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355&#39;}).then(result =&gt; { console.log(result) }) //根据id获取区块 或者将返回值传到回调函数callback中处理： callback = (err, res) =&gt; { err ? console.error(err) : console.log(res) } eos.getBlock(200000, callback) 7- 获取账户余额 eos.getCurrencyBalance({ code: &quot;eosio.token&quot;, account: &quot;eosio&quot;, symbol: &quot;DEV&quot; }).then(result =&gt; console.log(result)) 以上命令相当于 cleos get currency balance eosio.token eosio DEV 8- 获取某代币的信息 eos.getCurrencyStats({code: &quot;eosio.token&quot;, symbol: &quot;DEV&quot;}, callback) //用上面出现的callback，下同 9- 获取账户信息 eos.getAccount({account_name: &quot;eoshackathon&quot;}, callback) //获取eoshackathon账户的信息 相当于： cleos get account eoshackathon 返回： { account_name: &#39;eoshackathon&#39;, head_block_num: 219997, head_block_time: &#39;2018-07-15T03:20:12.500&#39;, privileged: false, last_code_update: &#39;1970-01-01T00:00:00.000&#39;, created: &#39;2018-07-13T20:54:28.000&#39;, ram_quota: 8148, net_weight: 500000, cpu_weight: 500000, net_limit: { used: 145, available: 120795486, max: 120795631 }, cpu_limit: { used: 1511, available: 11518458, max: 11519969 }, ram_usage: 3414, permissions: [ { perm_name: &#39;active&#39;, parent: &#39;owner&#39;, required_auth: [Object] }, { perm_name: &#39;owner&#39;, parent: &#39;&#39;, required_auth: [Object] } ], total_resources: { owner: &#39;eoshackathon&#39;, net_weight: &#39;50.0000 DEV&#39;, cpu_weight: &#39;50.0000 DEV&#39;, ram_bytes: 8148 }, self_delegated_bandwidth: null, refund_request: null, voter_info: null } 10- 获取智能合约代码 eos.getCode({ account_name: &quot;eosio&quot;}, callback) 获取eosio账户的所有合约代码 11- 获取智能合约ABI eos.getAbi({ account_name: &quot;eosio&quot;}, callback) 12- 获取Table行数据 不成熟 13- 获取账户的Actions列表 eos.getActions({account_name: &quot;eoshackathon&quot;, pos: 0, offset: 15}, callback) //pos和offset是指：从第pos条记录开始获取offset条Actions 14- 获取公钥对应的账户 eos.getKeyAccounts({ public_key: 公钥字符串}, callback) 如果查找到帐号，则返回[]，如果该公钥没有对应帐号，则报错。 相当于： cleos get accounts 公钥 15- 获取主账号控制的其他帐号 eos.getControlledAccounts({ controlling_account: &quot;eoshackathon&quot;}, callback) 16- 获取transaction交易细节 该指令有bug，慎用！ eos.getTransaction({id: &quot;xxxx&quot;}, callback) 17- 转账交易 首先，在链接配置config中，keyProvider: [发送方私钥]&nbsp;其次，可以设置options参数如下： options = { authorization: &#39;发送方帐号@active&#39;, broadcast: true, sign: true } 方式1： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;) 如果需要对返回值处理： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, callback) 如果有options参数，则： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, options, callback) 方式2： 使用对象： eos.transfer({ from: &#39;发送方帐号&#39;, to: &#39;接收方帐号&#39;, quantity: &#39;0.1000 DEV&#39;, memo: &#39;备注&#39;, callback }) 如果不想广播交易，可以使用以下简便指令： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, false) //在最后加上false，不广播 方式3： 使用eos.transaction，构造对象执行 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, name: &#39;transfer&#39;, authorization: [{ actor: &#39;发送方帐号&#39;, permission: &#39;active&#39; }], data: { from: &#39;发送方帐号&#39;, to: &#39;接收方帐号&#39;, quantity: &#39;0.3000 DEV&#39;, memo: &#39;备注&#39; } } ] } // options -- example: {broadcast: false} ) 以上命令与以下cleos相同： cleos push action eosio.token transfer &#39;[ &quot;发送方帐号&quot;, &quot;接收方帐号&quot;, &quot;0.3000 DEV&quot;, &quot;备注&quot; ]&#39; -p 发送方帐号 18- 新建帐号 creatoraccount = &quot;testtesttest&quot; //主账号 newaccount = &quot;testtest1113&quot; //新账号 newaccount_pubkey = &quot;EOS5LUYdLZAd3uHF5XGAeE61aTeSXWqvqxBSUq3uhqYH7kY15Drjf&quot; //新账号的公钥 //构建transaction对象 eos.transaction(tr =&gt; { //新建账号 tr.newaccount({ creator: creatoraccount, name: newaccount, owner: newaccount_pubkey, active: newaccount_pubkey }) //为新账号充值RAM tr.buyrambytes({ payer: creatoraccount, receiver: newaccount, bytes: 8192 }) //为新账号抵押CPU和NET资源 tr.delegatebw({ from: creatoraccount, receiver: newaccount, stake_net_quantity: &#39;1.0000 DEV&#39;, stake_cpu_quantity: &#39;1.0000 DEV&#39;, transfer: 0 }) }) 19- 购买RAM creatoraccount = &quot;testtesttest&quot; //主账号 newaccount = &quot;testtest1113&quot; //新账号 eos.transaction(tr =&gt; { tr.buyrambytes({ payer: creatoraccount, receiver: newaccount, bytes: 8192 }) 或者 eos.transaction(tr =&gt; { tr.buyram({ payer: creatoraccount, receiver: newaccount, quant: 8 //以k为单位的内存，8k=8192字节 }) 20- 出售RAM eos.transaction(tr =&gt; { tr.sellram({ account: &#39;testtesttest&#39;, bytes: 1024 //出售1k内存 }) }) 21- 竞拍账号名 eos.transaction(tr =&gt; { tr.bidname ({ bidder: &quot;testtesttest&quot;, newname: &quot;竞拍的名字&quot;, bid: 价格 }) }) 22- 抵押CPU和NET eos.transaction(tr =&gt; { tr.delegatebw({ from: &quot;testtesttest&quot;, receiver: &quot;testtesttest&quot;, //testtesttest账户为自己抵押 stake_net_quantity: &quot;1.0000 DEV&quot;, stake_cpu_quantity: &quot;1.0000 DEV&quot;, transfer: 0 }) }) 23- 取消抵押（赎回）CPU和NET eos.transaction(tr =&gt; { tr.undelegatebw({ from: &quot;testtesttest&quot;, receiver: &quot;testtesttest&quot;, unstake_net_quantity: &quot;0.1000 DEV&quot;, //赎回0.1个DEV unstake_cpu_quantity: &quot;0.1000 DEV&quot; }) }) 24- 智能合约部署 如果是加载wasm合约，不用使用binaryen，如果加载wast合约，需要安装并使用binaryen，如下： npm install binaryen@39.0.0 并用以下方式导入到js binaryen = require(&#39;binaryen&#39;) eos = Eos({keyProvider, binaryen}) 部署合约 以官方自带的hello合约为例 fs = require(&#39;fs&#39;) wasm = fs.readFileSync(`contracts/hello/hello.wasm`) //这个文件在客户端上，而不是在服务器上 abi = fs.readFileSync(`contracts/hello/hello.abi`) eos.setcode(&#39;contract_name&#39;, 0, 0, wasm) // contract_name 为合约名 eos.setabi(&#39;contract_name&#39;, JSON.parse(abi)) // @returns {Promise} 25- 智能合约的执行 方法一： eos.contract(&quot;contract_name&quot;).then(hello =&gt; { //hello随便起的变量名 hello.hi(&#39;axay&#39;, { //hi是方法名, &#39;axay&#39;是该hello合约hi方法的参数 authorization: [&#39;testtesttest&#39;] //testtesttest是建立该合约的用户 }).then(result =&gt; { console.log(result); }); }); 方法二： eos.transaction( { actions: [ { account: &#39;contract_name&#39;, //合约名 name: &#39;hi&#39;, //方法名，该方法在官方的hello合约中有 authorization: [{ actor: &#39;testtesttest&#39;, permission: &#39;active&#39; }], data: { user: &#39;axay&#39; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 26- 通过eosjs发行一个代币 发行代币有两种方式，一种是通过cleos，参考这里，但前提是必须要安装好EOS系统。 另一种方式是通过eosjs，无需在本机安装EOS系统。 注意： 此操作需要以eosio.token账户进行操作，因此需将eosio.token帐号的私钥导入到keyProvider数组中。但如果出于安全原因，不允许将eosio.token账户私钥加到程序中的话，则可以由发币的用户先部署eosio.token合约，然后再做接下去的操作。 第一步：创建代币 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约名 name: &#39;create&#39;, //调用创建代币的方法 authorization: [{ actor: &#39;eosio.token&#39;, //必须是eosio.token permission: &#39;active&#39; }], data: { issuer: &#39;testtesttest&#39;, //代币发行方 maximum_supply: &#39;10000.0000 AAA&#39;, //代币总量与名称 can_freeze: 0, can_recall: 0, can_whitelist: 0 } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 第二步：发行代币 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约名 name: &#39;issue&#39;, //调用发行代币的方法 authorization: [{ actor: &#39;testtesttest&#39;, //必须是代币的发行方 permission: &#39;active&#39; }], data: { to: &#39;testtesttest&#39;, //收到代币的帐号 quantity: &#39;1000.0000 AAA&#39;, memo: &quot;testtesttest issue 1000 AAA&quot; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 也可以将以上两步合在一起操作，如： eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约 name: &#39;create&#39;, //方法 authorization: [{ actor: &#39;eosio.token&#39;, permission: &#39;active&#39; }], data: { issuer: &#39;testtesttest&#39;, maximum_supply: &#39;10000000.0000 GAT&#39;, can_freeze: 0, can_recall: 0, can_whitelist: 0 } }, { account: &#39;eosio.token&#39;, //合约 name: &#39;issue&#39;, //方法 authorization: [{ actor: &#39;testtesttest&#39;, permission: &#39;active&#39; }], data: { to: &#39;testtest1111&#39;, quantity: &#39;1000.0000 GAT&#39;, memo: &quot;testtesttest issue 1000 GAT to testtest1111&quot; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 阅读更多" />
<meta property="og:description" content="eosjs简明使用手册（最新版） 以下教程用于EOS正式版，已在DEV开发链和EOS1.0.5-1.0.7版本的主链上测试通过。 官方文档因为版本的原因，内容多有错误，仅供参考。 eosjs的API与http-RPC调用一致，如rpc使用get-block，则在eosjs中使用getBlock()方法。即去横岗，首字符大写 eosjs几个容易出错的地方 asset类型，表达方式为字符串，如：100.0000 EOS，千万注意小数点后四位，少一位都不行 与链连接时需要指定chainId，可以通过cleos get info获得 1- 安装eosjs eosjs用于对交易签名、交易等操作。&nbsp;eosjs-api用于读取链上数据，只读，如果只需要读取链上数据的话，只需要使用eosjs-api。 在nodejs中安装： npm install eosjs npm install eosjs-api 注意nodejs需要最新版，如安装过程发生错误，请用node -v和npm -v查看版本。 2- 建立eosjs与链的连接 Eos = require(&#39;eosjs&#39;) // Optional configuration.. config = { keyProvider: [&#39;PrivateKeys...&#39;], // 配置私钥字符串 httpEndpoint: &#39;http://178.62.196.196:8888&#39;, //DEV开发链url与端口 chainId: &quot;0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a&quot;, // 通过cleos get info可以获取chainId mockTransactions: () =&gt; null, // 如果要广播，需要设为null transactionHeaders: (expireInSeconds, callback) =&gt; { callback(null/*error*/, headers) //手动设置交易记录头，该方法中的callback回调函数每次交易都会被调用 }, expireInSeconds: 60, broadcast: true, debug: false, sign: true, authorization: null // 该参数用于在多签名情况下，识别签名帐号与权限,格式如：account@permission } eos = Eos(config) 3- 建立eosjs-api与链的连接 如果加载了eosjs后，默认加载eosjs-api，无需单独链接eosjs-api与链 EosApi = require(&#39;eosjs-api&#39;) // everything is optional options = { httpEndpoint: &#39;http://178.62.196.196:8888&#39;, verbose: false, // API logging logger: { // Default logging functions //log: config.verbose ? console.log : &#39;&#39;, error: console.error }, fetchConfiguration: {} } eos = EosApi(options) 4- 获取帮助 不添加如何参数，可以获取该方法的使用说明，如： eos.getBlock() 5- 获取链上最新出块信息 eos.getInfo({}).then(result =&gt; { console.log(result) }) 返回： { server_version: &#39;b195012b&#39;, chain_id: &#39;0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a&#39;, head_block_num: 209307, last_irreversible_block_num: 209267, last_irreversible_block_id: &#39;00033173a9ccd4bdd60a92d257e9354023b0457b134797be472a236cd908bc31&#39;, head_block_id: &#39;0003319ba8ddc60d80c3cd0c7a70695cfd951f51ace9a798c913384cfbae659c&#39;, head_block_time: &#39;2018-07-15T01:51:07.500&#39;, head_block_producer: &#39;eoshackathon&#39;, virtual_block_cpu_limit: 100000000, virtual_block_net_limit: 1048576000, block_cpu_limit: 99900, block_net_limit: 1048576 } 如果需要拿到某一个数据值，比如：head_block_producer，则使用： eos.getInfo({}).then(result =&gt; { console.log(result.head_block_producer) //以对象属性方式获取head_block_producer }) 6- 获取指定区块信息 eos.getBlock(200000).then(result =&gt; { console.log(result) }) //获取第200000个区块 或者： eos.getBlock({block_num_or_id: 200000}).then(result =&gt; { console.log(result) }) //获取第200000个区块 或者： eos.getBlock(&#39;00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355&#39;).then(result =&gt; { console.log(result) }) //根据id获取区块 或者： eos.getBlock({block_num_or_id: &#39;00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355&#39;}).then(result =&gt; { console.log(result) }) //根据id获取区块 或者将返回值传到回调函数callback中处理： callback = (err, res) =&gt; { err ? console.error(err) : console.log(res) } eos.getBlock(200000, callback) 7- 获取账户余额 eos.getCurrencyBalance({ code: &quot;eosio.token&quot;, account: &quot;eosio&quot;, symbol: &quot;DEV&quot; }).then(result =&gt; console.log(result)) 以上命令相当于 cleos get currency balance eosio.token eosio DEV 8- 获取某代币的信息 eos.getCurrencyStats({code: &quot;eosio.token&quot;, symbol: &quot;DEV&quot;}, callback) //用上面出现的callback，下同 9- 获取账户信息 eos.getAccount({account_name: &quot;eoshackathon&quot;}, callback) //获取eoshackathon账户的信息 相当于： cleos get account eoshackathon 返回： { account_name: &#39;eoshackathon&#39;, head_block_num: 219997, head_block_time: &#39;2018-07-15T03:20:12.500&#39;, privileged: false, last_code_update: &#39;1970-01-01T00:00:00.000&#39;, created: &#39;2018-07-13T20:54:28.000&#39;, ram_quota: 8148, net_weight: 500000, cpu_weight: 500000, net_limit: { used: 145, available: 120795486, max: 120795631 }, cpu_limit: { used: 1511, available: 11518458, max: 11519969 }, ram_usage: 3414, permissions: [ { perm_name: &#39;active&#39;, parent: &#39;owner&#39;, required_auth: [Object] }, { perm_name: &#39;owner&#39;, parent: &#39;&#39;, required_auth: [Object] } ], total_resources: { owner: &#39;eoshackathon&#39;, net_weight: &#39;50.0000 DEV&#39;, cpu_weight: &#39;50.0000 DEV&#39;, ram_bytes: 8148 }, self_delegated_bandwidth: null, refund_request: null, voter_info: null } 10- 获取智能合约代码 eos.getCode({ account_name: &quot;eosio&quot;}, callback) 获取eosio账户的所有合约代码 11- 获取智能合约ABI eos.getAbi({ account_name: &quot;eosio&quot;}, callback) 12- 获取Table行数据 不成熟 13- 获取账户的Actions列表 eos.getActions({account_name: &quot;eoshackathon&quot;, pos: 0, offset: 15}, callback) //pos和offset是指：从第pos条记录开始获取offset条Actions 14- 获取公钥对应的账户 eos.getKeyAccounts({ public_key: 公钥字符串}, callback) 如果查找到帐号，则返回[]，如果该公钥没有对应帐号，则报错。 相当于： cleos get accounts 公钥 15- 获取主账号控制的其他帐号 eos.getControlledAccounts({ controlling_account: &quot;eoshackathon&quot;}, callback) 16- 获取transaction交易细节 该指令有bug，慎用！ eos.getTransaction({id: &quot;xxxx&quot;}, callback) 17- 转账交易 首先，在链接配置config中，keyProvider: [发送方私钥]&nbsp;其次，可以设置options参数如下： options = { authorization: &#39;发送方帐号@active&#39;, broadcast: true, sign: true } 方式1： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;) 如果需要对返回值处理： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, callback) 如果有options参数，则： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, options, callback) 方式2： 使用对象： eos.transfer({ from: &#39;发送方帐号&#39;, to: &#39;接收方帐号&#39;, quantity: &#39;0.1000 DEV&#39;, memo: &#39;备注&#39;, callback }) 如果不想广播交易，可以使用以下简便指令： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, false) //在最后加上false，不广播 方式3： 使用eos.transaction，构造对象执行 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, name: &#39;transfer&#39;, authorization: [{ actor: &#39;发送方帐号&#39;, permission: &#39;active&#39; }], data: { from: &#39;发送方帐号&#39;, to: &#39;接收方帐号&#39;, quantity: &#39;0.3000 DEV&#39;, memo: &#39;备注&#39; } } ] } // options -- example: {broadcast: false} ) 以上命令与以下cleos相同： cleos push action eosio.token transfer &#39;[ &quot;发送方帐号&quot;, &quot;接收方帐号&quot;, &quot;0.3000 DEV&quot;, &quot;备注&quot; ]&#39; -p 发送方帐号 18- 新建帐号 creatoraccount = &quot;testtesttest&quot; //主账号 newaccount = &quot;testtest1113&quot; //新账号 newaccount_pubkey = &quot;EOS5LUYdLZAd3uHF5XGAeE61aTeSXWqvqxBSUq3uhqYH7kY15Drjf&quot; //新账号的公钥 //构建transaction对象 eos.transaction(tr =&gt; { //新建账号 tr.newaccount({ creator: creatoraccount, name: newaccount, owner: newaccount_pubkey, active: newaccount_pubkey }) //为新账号充值RAM tr.buyrambytes({ payer: creatoraccount, receiver: newaccount, bytes: 8192 }) //为新账号抵押CPU和NET资源 tr.delegatebw({ from: creatoraccount, receiver: newaccount, stake_net_quantity: &#39;1.0000 DEV&#39;, stake_cpu_quantity: &#39;1.0000 DEV&#39;, transfer: 0 }) }) 19- 购买RAM creatoraccount = &quot;testtesttest&quot; //主账号 newaccount = &quot;testtest1113&quot; //新账号 eos.transaction(tr =&gt; { tr.buyrambytes({ payer: creatoraccount, receiver: newaccount, bytes: 8192 }) 或者 eos.transaction(tr =&gt; { tr.buyram({ payer: creatoraccount, receiver: newaccount, quant: 8 //以k为单位的内存，8k=8192字节 }) 20- 出售RAM eos.transaction(tr =&gt; { tr.sellram({ account: &#39;testtesttest&#39;, bytes: 1024 //出售1k内存 }) }) 21- 竞拍账号名 eos.transaction(tr =&gt; { tr.bidname ({ bidder: &quot;testtesttest&quot;, newname: &quot;竞拍的名字&quot;, bid: 价格 }) }) 22- 抵押CPU和NET eos.transaction(tr =&gt; { tr.delegatebw({ from: &quot;testtesttest&quot;, receiver: &quot;testtesttest&quot;, //testtesttest账户为自己抵押 stake_net_quantity: &quot;1.0000 DEV&quot;, stake_cpu_quantity: &quot;1.0000 DEV&quot;, transfer: 0 }) }) 23- 取消抵押（赎回）CPU和NET eos.transaction(tr =&gt; { tr.undelegatebw({ from: &quot;testtesttest&quot;, receiver: &quot;testtesttest&quot;, unstake_net_quantity: &quot;0.1000 DEV&quot;, //赎回0.1个DEV unstake_cpu_quantity: &quot;0.1000 DEV&quot; }) }) 24- 智能合约部署 如果是加载wasm合约，不用使用binaryen，如果加载wast合约，需要安装并使用binaryen，如下： npm install binaryen@39.0.0 并用以下方式导入到js binaryen = require(&#39;binaryen&#39;) eos = Eos({keyProvider, binaryen}) 部署合约 以官方自带的hello合约为例 fs = require(&#39;fs&#39;) wasm = fs.readFileSync(`contracts/hello/hello.wasm`) //这个文件在客户端上，而不是在服务器上 abi = fs.readFileSync(`contracts/hello/hello.abi`) eos.setcode(&#39;contract_name&#39;, 0, 0, wasm) // contract_name 为合约名 eos.setabi(&#39;contract_name&#39;, JSON.parse(abi)) // @returns {Promise} 25- 智能合约的执行 方法一： eos.contract(&quot;contract_name&quot;).then(hello =&gt; { //hello随便起的变量名 hello.hi(&#39;axay&#39;, { //hi是方法名, &#39;axay&#39;是该hello合约hi方法的参数 authorization: [&#39;testtesttest&#39;] //testtesttest是建立该合约的用户 }).then(result =&gt; { console.log(result); }); }); 方法二： eos.transaction( { actions: [ { account: &#39;contract_name&#39;, //合约名 name: &#39;hi&#39;, //方法名，该方法在官方的hello合约中有 authorization: [{ actor: &#39;testtesttest&#39;, permission: &#39;active&#39; }], data: { user: &#39;axay&#39; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 26- 通过eosjs发行一个代币 发行代币有两种方式，一种是通过cleos，参考这里，但前提是必须要安装好EOS系统。 另一种方式是通过eosjs，无需在本机安装EOS系统。 注意： 此操作需要以eosio.token账户进行操作，因此需将eosio.token帐号的私钥导入到keyProvider数组中。但如果出于安全原因，不允许将eosio.token账户私钥加到程序中的话，则可以由发币的用户先部署eosio.token合约，然后再做接下去的操作。 第一步：创建代币 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约名 name: &#39;create&#39;, //调用创建代币的方法 authorization: [{ actor: &#39;eosio.token&#39;, //必须是eosio.token permission: &#39;active&#39; }], data: { issuer: &#39;testtesttest&#39;, //代币发行方 maximum_supply: &#39;10000.0000 AAA&#39;, //代币总量与名称 can_freeze: 0, can_recall: 0, can_whitelist: 0 } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 第二步：发行代币 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约名 name: &#39;issue&#39;, //调用发行代币的方法 authorization: [{ actor: &#39;testtesttest&#39;, //必须是代币的发行方 permission: &#39;active&#39; }], data: { to: &#39;testtesttest&#39;, //收到代币的帐号 quantity: &#39;1000.0000 AAA&#39;, memo: &quot;testtesttest issue 1000 AAA&quot; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 也可以将以上两步合在一起操作，如： eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约 name: &#39;create&#39;, //方法 authorization: [{ actor: &#39;eosio.token&#39;, permission: &#39;active&#39; }], data: { issuer: &#39;testtesttest&#39;, maximum_supply: &#39;10000000.0000 GAT&#39;, can_freeze: 0, can_recall: 0, can_whitelist: 0 } }, { account: &#39;eosio.token&#39;, //合约 name: &#39;issue&#39;, //方法 authorization: [{ actor: &#39;testtesttest&#39;, permission: &#39;active&#39; }], data: { to: &#39;testtest1111&#39;, quantity: &#39;1000.0000 GAT&#39;, memo: &quot;testtesttest issue 1000 GAT to testtest1111&quot; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/07/18/206946a0e77bb2009b414094c936e9d7.html" />
<meta property="og:url" content="https://mlh.app/2018/07/18/206946a0e77bb2009b414094c936e9d7.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-18T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"eosjs简明使用手册（最新版） 以下教程用于EOS正式版，已在DEV开发链和EOS1.0.5-1.0.7版本的主链上测试通过。 官方文档因为版本的原因，内容多有错误，仅供参考。 eosjs的API与http-RPC调用一致，如rpc使用get-block，则在eosjs中使用getBlock()方法。即去横岗，首字符大写 eosjs几个容易出错的地方 asset类型，表达方式为字符串，如：100.0000 EOS，千万注意小数点后四位，少一位都不行 与链连接时需要指定chainId，可以通过cleos get info获得 1- 安装eosjs eosjs用于对交易签名、交易等操作。&nbsp;eosjs-api用于读取链上数据，只读，如果只需要读取链上数据的话，只需要使用eosjs-api。 在nodejs中安装： npm install eosjs npm install eosjs-api 注意nodejs需要最新版，如安装过程发生错误，请用node -v和npm -v查看版本。 2- 建立eosjs与链的连接 Eos = require(&#39;eosjs&#39;) // Optional configuration.. config = { keyProvider: [&#39;PrivateKeys...&#39;], // 配置私钥字符串 httpEndpoint: &#39;http://178.62.196.196:8888&#39;, //DEV开发链url与端口 chainId: &quot;0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a&quot;, // 通过cleos get info可以获取chainId mockTransactions: () =&gt; null, // 如果要广播，需要设为null transactionHeaders: (expireInSeconds, callback) =&gt; { callback(null/*error*/, headers) //手动设置交易记录头，该方法中的callback回调函数每次交易都会被调用 }, expireInSeconds: 60, broadcast: true, debug: false, sign: true, authorization: null // 该参数用于在多签名情况下，识别签名帐号与权限,格式如：account@permission } eos = Eos(config) 3- 建立eosjs-api与链的连接 如果加载了eosjs后，默认加载eosjs-api，无需单独链接eosjs-api与链 EosApi = require(&#39;eosjs-api&#39;) // everything is optional options = { httpEndpoint: &#39;http://178.62.196.196:8888&#39;, verbose: false, // API logging logger: { // Default logging functions //log: config.verbose ? console.log : &#39;&#39;, error: console.error }, fetchConfiguration: {} } eos = EosApi(options) 4- 获取帮助 不添加如何参数，可以获取该方法的使用说明，如： eos.getBlock() 5- 获取链上最新出块信息 eos.getInfo({}).then(result =&gt; { console.log(result) }) 返回： { server_version: &#39;b195012b&#39;, chain_id: &#39;0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a&#39;, head_block_num: 209307, last_irreversible_block_num: 209267, last_irreversible_block_id: &#39;00033173a9ccd4bdd60a92d257e9354023b0457b134797be472a236cd908bc31&#39;, head_block_id: &#39;0003319ba8ddc60d80c3cd0c7a70695cfd951f51ace9a798c913384cfbae659c&#39;, head_block_time: &#39;2018-07-15T01:51:07.500&#39;, head_block_producer: &#39;eoshackathon&#39;, virtual_block_cpu_limit: 100000000, virtual_block_net_limit: 1048576000, block_cpu_limit: 99900, block_net_limit: 1048576 } 如果需要拿到某一个数据值，比如：head_block_producer，则使用： eos.getInfo({}).then(result =&gt; { console.log(result.head_block_producer) //以对象属性方式获取head_block_producer }) 6- 获取指定区块信息 eos.getBlock(200000).then(result =&gt; { console.log(result) }) //获取第200000个区块 或者： eos.getBlock({block_num_or_id: 200000}).then(result =&gt; { console.log(result) }) //获取第200000个区块 或者： eos.getBlock(&#39;00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355&#39;).then(result =&gt; { console.log(result) }) //根据id获取区块 或者： eos.getBlock({block_num_or_id: &#39;00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355&#39;}).then(result =&gt; { console.log(result) }) //根据id获取区块 或者将返回值传到回调函数callback中处理： callback = (err, res) =&gt; { err ? console.error(err) : console.log(res) } eos.getBlock(200000, callback) 7- 获取账户余额 eos.getCurrencyBalance({ code: &quot;eosio.token&quot;, account: &quot;eosio&quot;, symbol: &quot;DEV&quot; }).then(result =&gt; console.log(result)) 以上命令相当于 cleos get currency balance eosio.token eosio DEV 8- 获取某代币的信息 eos.getCurrencyStats({code: &quot;eosio.token&quot;, symbol: &quot;DEV&quot;}, callback) //用上面出现的callback，下同 9- 获取账户信息 eos.getAccount({account_name: &quot;eoshackathon&quot;}, callback) //获取eoshackathon账户的信息 相当于： cleos get account eoshackathon 返回： { account_name: &#39;eoshackathon&#39;, head_block_num: 219997, head_block_time: &#39;2018-07-15T03:20:12.500&#39;, privileged: false, last_code_update: &#39;1970-01-01T00:00:00.000&#39;, created: &#39;2018-07-13T20:54:28.000&#39;, ram_quota: 8148, net_weight: 500000, cpu_weight: 500000, net_limit: { used: 145, available: 120795486, max: 120795631 }, cpu_limit: { used: 1511, available: 11518458, max: 11519969 }, ram_usage: 3414, permissions: [ { perm_name: &#39;active&#39;, parent: &#39;owner&#39;, required_auth: [Object] }, { perm_name: &#39;owner&#39;, parent: &#39;&#39;, required_auth: [Object] } ], total_resources: { owner: &#39;eoshackathon&#39;, net_weight: &#39;50.0000 DEV&#39;, cpu_weight: &#39;50.0000 DEV&#39;, ram_bytes: 8148 }, self_delegated_bandwidth: null, refund_request: null, voter_info: null } 10- 获取智能合约代码 eos.getCode({ account_name: &quot;eosio&quot;}, callback) 获取eosio账户的所有合约代码 11- 获取智能合约ABI eos.getAbi({ account_name: &quot;eosio&quot;}, callback) 12- 获取Table行数据 不成熟 13- 获取账户的Actions列表 eos.getActions({account_name: &quot;eoshackathon&quot;, pos: 0, offset: 15}, callback) //pos和offset是指：从第pos条记录开始获取offset条Actions 14- 获取公钥对应的账户 eos.getKeyAccounts({ public_key: 公钥字符串}, callback) 如果查找到帐号，则返回[]，如果该公钥没有对应帐号，则报错。 相当于： cleos get accounts 公钥 15- 获取主账号控制的其他帐号 eos.getControlledAccounts({ controlling_account: &quot;eoshackathon&quot;}, callback) 16- 获取transaction交易细节 该指令有bug，慎用！ eos.getTransaction({id: &quot;xxxx&quot;}, callback) 17- 转账交易 首先，在链接配置config中，keyProvider: [发送方私钥]&nbsp;其次，可以设置options参数如下： options = { authorization: &#39;发送方帐号@active&#39;, broadcast: true, sign: true } 方式1： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;) 如果需要对返回值处理： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, callback) 如果有options参数，则： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, options, callback) 方式2： 使用对象： eos.transfer({ from: &#39;发送方帐号&#39;, to: &#39;接收方帐号&#39;, quantity: &#39;0.1000 DEV&#39;, memo: &#39;备注&#39;, callback }) 如果不想广播交易，可以使用以下简便指令： eos.transfer(&#39;发送方帐号&#39;, &#39;接收方帐号&#39;, &#39;0.3000 DEV&#39;,&#39;memo&#39;, false) //在最后加上false，不广播 方式3： 使用eos.transaction，构造对象执行 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, name: &#39;transfer&#39;, authorization: [{ actor: &#39;发送方帐号&#39;, permission: &#39;active&#39; }], data: { from: &#39;发送方帐号&#39;, to: &#39;接收方帐号&#39;, quantity: &#39;0.3000 DEV&#39;, memo: &#39;备注&#39; } } ] } // options -- example: {broadcast: false} ) 以上命令与以下cleos相同： cleos push action eosio.token transfer &#39;[ &quot;发送方帐号&quot;, &quot;接收方帐号&quot;, &quot;0.3000 DEV&quot;, &quot;备注&quot; ]&#39; -p 发送方帐号 18- 新建帐号 creatoraccount = &quot;testtesttest&quot; //主账号 newaccount = &quot;testtest1113&quot; //新账号 newaccount_pubkey = &quot;EOS5LUYdLZAd3uHF5XGAeE61aTeSXWqvqxBSUq3uhqYH7kY15Drjf&quot; //新账号的公钥 //构建transaction对象 eos.transaction(tr =&gt; { //新建账号 tr.newaccount({ creator: creatoraccount, name: newaccount, owner: newaccount_pubkey, active: newaccount_pubkey }) //为新账号充值RAM tr.buyrambytes({ payer: creatoraccount, receiver: newaccount, bytes: 8192 }) //为新账号抵押CPU和NET资源 tr.delegatebw({ from: creatoraccount, receiver: newaccount, stake_net_quantity: &#39;1.0000 DEV&#39;, stake_cpu_quantity: &#39;1.0000 DEV&#39;, transfer: 0 }) }) 19- 购买RAM creatoraccount = &quot;testtesttest&quot; //主账号 newaccount = &quot;testtest1113&quot; //新账号 eos.transaction(tr =&gt; { tr.buyrambytes({ payer: creatoraccount, receiver: newaccount, bytes: 8192 }) 或者 eos.transaction(tr =&gt; { tr.buyram({ payer: creatoraccount, receiver: newaccount, quant: 8 //以k为单位的内存，8k=8192字节 }) 20- 出售RAM eos.transaction(tr =&gt; { tr.sellram({ account: &#39;testtesttest&#39;, bytes: 1024 //出售1k内存 }) }) 21- 竞拍账号名 eos.transaction(tr =&gt; { tr.bidname ({ bidder: &quot;testtesttest&quot;, newname: &quot;竞拍的名字&quot;, bid: 价格 }) }) 22- 抵押CPU和NET eos.transaction(tr =&gt; { tr.delegatebw({ from: &quot;testtesttest&quot;, receiver: &quot;testtesttest&quot;, //testtesttest账户为自己抵押 stake_net_quantity: &quot;1.0000 DEV&quot;, stake_cpu_quantity: &quot;1.0000 DEV&quot;, transfer: 0 }) }) 23- 取消抵押（赎回）CPU和NET eos.transaction(tr =&gt; { tr.undelegatebw({ from: &quot;testtesttest&quot;, receiver: &quot;testtesttest&quot;, unstake_net_quantity: &quot;0.1000 DEV&quot;, //赎回0.1个DEV unstake_cpu_quantity: &quot;0.1000 DEV&quot; }) }) 24- 智能合约部署 如果是加载wasm合约，不用使用binaryen，如果加载wast合约，需要安装并使用binaryen，如下： npm install binaryen@39.0.0 并用以下方式导入到js binaryen = require(&#39;binaryen&#39;) eos = Eos({keyProvider, binaryen}) 部署合约 以官方自带的hello合约为例 fs = require(&#39;fs&#39;) wasm = fs.readFileSync(`contracts/hello/hello.wasm`) //这个文件在客户端上，而不是在服务器上 abi = fs.readFileSync(`contracts/hello/hello.abi`) eos.setcode(&#39;contract_name&#39;, 0, 0, wasm) // contract_name 为合约名 eos.setabi(&#39;contract_name&#39;, JSON.parse(abi)) // @returns {Promise} 25- 智能合约的执行 方法一： eos.contract(&quot;contract_name&quot;).then(hello =&gt; { //hello随便起的变量名 hello.hi(&#39;axay&#39;, { //hi是方法名, &#39;axay&#39;是该hello合约hi方法的参数 authorization: [&#39;testtesttest&#39;] //testtesttest是建立该合约的用户 }).then(result =&gt; { console.log(result); }); }); 方法二： eos.transaction( { actions: [ { account: &#39;contract_name&#39;, //合约名 name: &#39;hi&#39;, //方法名，该方法在官方的hello合约中有 authorization: [{ actor: &#39;testtesttest&#39;, permission: &#39;active&#39; }], data: { user: &#39;axay&#39; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 26- 通过eosjs发行一个代币 发行代币有两种方式，一种是通过cleos，参考这里，但前提是必须要安装好EOS系统。 另一种方式是通过eosjs，无需在本机安装EOS系统。 注意： 此操作需要以eosio.token账户进行操作，因此需将eosio.token帐号的私钥导入到keyProvider数组中。但如果出于安全原因，不允许将eosio.token账户私钥加到程序中的话，则可以由发币的用户先部署eosio.token合约，然后再做接下去的操作。 第一步：创建代币 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约名 name: &#39;create&#39;, //调用创建代币的方法 authorization: [{ actor: &#39;eosio.token&#39;, //必须是eosio.token permission: &#39;active&#39; }], data: { issuer: &#39;testtesttest&#39;, //代币发行方 maximum_supply: &#39;10000.0000 AAA&#39;, //代币总量与名称 can_freeze: 0, can_recall: 0, can_whitelist: 0 } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 第二步：发行代币 eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约名 name: &#39;issue&#39;, //调用发行代币的方法 authorization: [{ actor: &#39;testtesttest&#39;, //必须是代币的发行方 permission: &#39;active&#39; }], data: { to: &#39;testtesttest&#39;, //收到代币的帐号 quantity: &#39;1000.0000 AAA&#39;, memo: &quot;testtesttest issue 1000 AAA&quot; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 也可以将以上两步合在一起操作，如： eos.transaction( { // ...headers, actions: [ { account: &#39;eosio.token&#39;, //合约 name: &#39;create&#39;, //方法 authorization: [{ actor: &#39;eosio.token&#39;, permission: &#39;active&#39; }], data: { issuer: &#39;testtesttest&#39;, maximum_supply: &#39;10000000.0000 GAT&#39;, can_freeze: 0, can_recall: 0, can_whitelist: 0 } }, { account: &#39;eosio.token&#39;, //合约 name: &#39;issue&#39;, //方法 authorization: [{ actor: &#39;testtesttest&#39;, permission: &#39;active&#39; }], data: { to: &#39;testtest1111&#39;, quantity: &#39;1000.0000 GAT&#39;, memo: &quot;testtesttest issue 1000 GAT to testtest1111&quot; } } ] } // options -- example: {broadcast: false} ).then(result =&gt; console.log(result)) 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/07/18/206946a0e77bb2009b414094c936e9d7.html","headline":"eosjs简明使用手册（最新版）","dateModified":"2018-07-18T00:00:00+08:00","datePublished":"2018-07-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/07/18/206946a0e77bb2009b414094c936e9d7.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>eosjs简明使用手册（最新版）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h2>eosjs简明使用手册（最新版）</h2> 
  <p>以下教程用于EOS正式版，已在DEV开发链和EOS1.0.5-1.0.7版本的主链上测试通过。</p> 
  <p><a href="https://github.com/EOSIO/eosjs/blob/master/README.md" rel="nofollow">官方文档</a>因为版本的原因，内容多有错误，仅供参考。</p> 
  <p><em>eosjs的API与http-RPC调用一致，如rpc使用<code>get-block</code>，则在eosjs中使用<code>getBlock()</code>方法。即去横岗，首字符大写</em></p> 
  <h3>eosjs几个容易出错的地方</h3> 
  <ul>
   <li>asset类型，表达方式为字符串，如：<code>100.0000 EOS</code>，千万注意小数点后四位，少一位都不行</li> 
   <li>与链连接时需要指定chainId，可以通过<code>cleos get info</code>获得</li> 
  </ul>
  <h3>1- 安装eosjs</h3> 
  <p><code>eosjs</code>用于对交易签名、交易等操作。&nbsp;<code>eosjs-api</code>用于读取链上数据，只读，如果只需要读取链上数据的话，只需要使用<code>eosjs-api</code>。</p> 
  <p>在nodejs中安装：</p> 
  <pre class="has">
<code>npm install eosjs
npm install eosjs-api
</code></pre> 
  <p>注意<code>nodejs</code>需要最新版，如安装过程发生错误，请用<code>node -v</code>和<code>npm -v</code>查看版本。</p> 
  <h3>2- 建立eosjs与链的连接</h3> 
  <pre class="has">
<code>Eos = require('eosjs')

// Optional configuration..
config = {
  keyProvider: ['PrivateKeys...'], // 配置私钥字符串
  httpEndpoint: 'http://178.62.196.196:8888', //DEV开发链url与端口
  chainId: "0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a", // 通过cleos get info可以获取chainId
  mockTransactions: () =&gt; null, // 如果要广播，需要设为null
  transactionHeaders: (expireInSeconds, callback) =&gt; {
    callback(null/*error*/, headers) //手动设置交易记录头，该方法中的callback回调函数每次交易都会被调用
  },
  expireInSeconds: 60,
  broadcast: true,
  debug: false,
  sign: true,
  authorization: null // 该参数用于在多签名情况下，识别签名帐号与权限,格式如：account@permission
}

eos = Eos(config)
</code></pre> 
  <h3>3- 建立eosjs-api与链的连接</h3> 
  <p>如果加载了eosjs后，默认加载eosjs-api，无需单独链接<code>eosjs-api</code>与链</p> 
  <pre class="has">
<code>EosApi = require('eosjs-api')

// everything is optional
options = {
  httpEndpoint: 'http://178.62.196.196:8888',
  verbose: false, // API logging
  logger: { // Default logging functions
    //log: config.verbose ? console.log : '',
    error: console.error
  },
  fetchConfiguration: {}
}

eos = EosApi(options)

</code></pre> 
  <h3>4- 获取帮助</h3> 
  <p>不添加如何参数，可以获取该方法的使用说明，如：</p> 
  <pre class="has">
<code>eos.getBlock()
</code></pre> 
  <h3>5- 获取链上最新出块信息</h3> 
  <pre class="has">
<code>eos.getInfo({}).then(result =&gt; { 
	console.log(result) 
})
</code></pre> 
  <p>返回：</p> 
  <pre class="has">
<code>{ server_version: 'b195012b',
  chain_id: '0b08e71a2f8caaccc2dc13244b788f5eba29462ecd5d5dea1ad8cbe9581e885a',
  head_block_num: 209307,
  last_irreversible_block_num: 209267,
  last_irreversible_block_id: '00033173a9ccd4bdd60a92d257e9354023b0457b134797be472a236cd908bc31',
  head_block_id: '0003319ba8ddc60d80c3cd0c7a70695cfd951f51ace9a798c913384cfbae659c',
  head_block_time: '2018-07-15T01:51:07.500',
  head_block_producer: 'eoshackathon',
  virtual_block_cpu_limit: 100000000,
  virtual_block_net_limit: 1048576000,
  block_cpu_limit: 99900,
  block_net_limit: 1048576 
}
</code></pre> 
  <p>如果需要拿到某一个数据值，比如：<code>head_block_producer</code>，则使用：</p> 
  <pre class="has">
<code>eos.getInfo({}).then(result =&gt; { 
	console.log(result.head_block_producer) //以对象属性方式获取head_block_producer
})
</code></pre> 
  <h3>6- 获取指定区块信息</h3> 
  <pre class="has">
<code>eos.getBlock(200000).then(result =&gt; { console.log(result) }) //获取第200000个区块
</code></pre> 
  <p>或者：</p> 
  <pre class="has">
<code>eos.getBlock({block_num_or_id: 200000}).then(result =&gt; { console.log(result) }) //获取第200000个区块
</code></pre> 
  <p>或者：</p> 
  <pre class="has">
<code>eos.getBlock('00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355').then(result =&gt; { console.log(result) }) //根据id获取区块
</code></pre> 
  <p>或者：</p> 
  <pre class="has">
<code>eos.getBlock({block_num_or_id: '00030d4011a6744857533a6e6d907037a94c27a2dc006b4d28125f76bed2b355'}).then(result =&gt; { console.log(result) }) //根据id获取区块
</code></pre> 
  <p>或者将返回值传到回调函数callback中处理：</p> 
  <pre class="has">
<code>callback = (err, res) =&gt; { err ? console.error(err) : console.log(res) }
eos.getBlock(200000, callback)
</code></pre> 
  <h3>7- 获取账户余额</h3> 
  <pre class="has">
<code>eos.getCurrencyBalance({ code: "eosio.token", account: "eosio", symbol: "DEV" }).then(result =&gt; console.log(result))
</code></pre> 
  <p>以上命令相当于</p> 
  <pre class="has">
<code>cleos get currency balance eosio.token eosio DEV
</code></pre> 
  <h3>8- 获取某代币的信息</h3> 
  <pre class="has">
<code>eos.getCurrencyStats({code: "eosio.token", symbol: "DEV"}, callback) //用上面出现的callback，下同
</code></pre> 
  <h3>9- 获取账户信息</h3> 
  <pre class="has">
<code>eos.getAccount({account_name: "eoshackathon"}, callback) //获取eoshackathon账户的信息
</code></pre> 
  <p>相当于：</p> 
  <pre class="has">
<code>cleos get account eoshackathon
</code></pre> 
  <p>返回：</p> 
  <pre class="has">
<code>{ account_name: 'eoshackathon',
  head_block_num: 219997,
  head_block_time: '2018-07-15T03:20:12.500',
  privileged: false,
  last_code_update: '1970-01-01T00:00:00.000',
  created: '2018-07-13T20:54:28.000',
  ram_quota: 8148,
  net_weight: 500000,
  cpu_weight: 500000,
  net_limit: { used: 145, available: 120795486, max: 120795631 },
  cpu_limit: { used: 1511, available: 11518458, max: 11519969 },
  ram_usage: 3414,
  permissions:
   [ { perm_name: 'active', parent: 'owner', required_auth: [Object] },
     { perm_name: 'owner', parent: '', required_auth: [Object] } ],
  total_resources:
   { owner: 'eoshackathon',
     net_weight: '50.0000 DEV',
     cpu_weight: '50.0000 DEV',
     ram_bytes: 8148 },
  self_delegated_bandwidth: null,
  refund_request: null,
  voter_info: null 
}
</code></pre> 
  <h3>10- 获取智能合约代码</h3> 
  <pre class="has">
<code>eos.getCode({ account_name: "eosio"}, callback)
</code></pre> 
  <p>获取<code>eosio</code>账户的所有合约代码</p> 
  <h3>11- 获取智能合约ABI</h3> 
  <pre class="has">
<code>eos.getAbi({ account_name: "eosio"}, callback)

</code></pre> 
  <h3>12- 获取Table行数据</h3> 
  <pre class="has">
<code>不成熟
</code></pre> 
  <h3>13- 获取账户的Actions列表</h3> 
  <pre class="has">
<code>eos.getActions({account_name: "eoshackathon", pos: 0, offset: 15}, callback) //pos和offset是指：从第pos条记录开始获取offset条Actions
</code></pre> 
  <h3>14- 获取公钥对应的账户</h3> 
  <pre class="has">
<code>eos.getKeyAccounts({ public_key: 公钥字符串}, callback)
</code></pre> 
  <p>如果查找到帐号，则返回<code>[]</code>，如果该公钥没有对应帐号，则报错。 相当于：</p> 
  <pre class="has">
<code>cleos get accounts 公钥
</code></pre> 
  <h3>15- 获取主账号控制的其他帐号</h3> 
  <pre class="has">
<code>eos.getControlledAccounts({ controlling_account: "eoshackathon"}, callback)
</code></pre> 
  <h3>16- 获取transaction交易细节</h3> 
  <p>该指令有bug，慎用！</p> 
  <pre class="has">
<code>eos.getTransaction({id: "xxxx"}, callback)
</code></pre> 
  <h3>17- 转账交易</h3> 
  <p>首先，在链接配置<code>config</code>中，<code>keyProvider: [发送方私钥]</code>&nbsp;其次，可以设置<code>options</code>参数如下：</p> 
  <pre class="has">
<code>options = {
    authorization: '发送方帐号@active',
    broadcast: true,
    sign: true
}
</code></pre> 
  <p>方式1：</p> 
  <pre class="has">
<code>eos.transfer('发送方帐号', '接收方帐号', '0.3000 DEV','memo')
</code></pre> 
  <p>如果需要对返回值处理：</p> 
  <pre class="has">
<code>eos.transfer('发送方帐号', '接收方帐号', '0.3000 DEV','memo', callback)
</code></pre> 
  <p>如果有<code>options</code>参数，则：</p> 
  <pre class="has">
<code>eos.transfer('发送方帐号', '接收方帐号', '0.3000 DEV','memo', options, callback)
</code></pre> 
  <p>方式2：</p> 
  <p>使用对象：</p> 
  <pre class="has">
<code>eos.transfer({ from: '发送方帐号', to: '接收方帐号', quantity: '0.1000 DEV', memo: '备注', callback })
</code></pre> 
  <p>如果不想广播交易，可以使用以下简便指令：</p> 
  <pre class="has">
<code>eos.transfer('发送方帐号', '接收方帐号', '0.3000 DEV','memo', false) //在最后加上false，不广播
</code></pre> 
  <p>方式3：</p> 
  <p>使用<code>eos.transaction</code>，构造对象执行</p> 
  <pre class="has">
<code>eos.transaction(
	{
        // ...headers,
        actions: [
            {
                account: 'eosio.token',
                name: 'transfer',
                authorization: [{
                    actor: '发送方帐号',
                    permission: 'active'
                }],
                data: {
                    from: '发送方帐号',
                    to: '接收方帐号',
                    quantity: '0.3000 DEV',
                    memo: '备注'
                }
            }
        ]
    }
    // options -- example: {broadcast: false}
)
</code></pre> 
  <p>以上命令与以下<code>cleos</code>相同：</p> 
  <pre class="has">
<code>cleos push action eosio.token transfer '[ "发送方帐号", "接收方帐号",  "0.3000 DEV", "备注" ]' -p 发送方帐号
</code></pre> 
  <h3>18- 新建帐号</h3> 
  <pre class="has">
<code>creatoraccount = "testtesttest" //主账号
newaccount = "testtest1113" //新账号
newaccount_pubkey = "EOS5LUYdLZAd3uHF5XGAeE61aTeSXWqvqxBSUq3uhqYH7kY15Drjf" //新账号的公钥

//构建transaction对象
eos.transaction(tr =&gt; {
    //新建账号
    tr.newaccount({
        creator: creatoraccount,
        name: newaccount,
        owner: newaccount_pubkey,
        active: newaccount_pubkey
    })
    
    //为新账号充值RAM
    tr.buyrambytes({
        payer: creatoraccount,
        receiver: newaccount,
        bytes: 8192
    })

    //为新账号抵押CPU和NET资源
    tr.delegatebw({
        from: creatoraccount,
        receiver: newaccount,
        stake_net_quantity: '1.0000 DEV',
        stake_cpu_quantity: '1.0000 DEV',
        transfer: 0
    })
})

</code></pre> 
  <h3>19- 购买RAM</h3> 
  <pre class="has">
<code>creatoraccount = "testtesttest" //主账号
newaccount = "testtest1113" //新账号

eos.transaction(tr =&gt; {
    tr.buyrambytes({
        payer: creatoraccount,
        receiver: newaccount,
        bytes: 8192 
    })
</code></pre> 
  <p>或者</p> 
  <pre class="has">
<code>eos.transaction(tr =&gt; {
    tr.buyram({
        payer: creatoraccount,
        receiver: newaccount,
        quant: 8 //以k为单位的内存，8k=8192字节
    })

</code></pre> 
  <h3>20- 出售RAM</h3> 
  <pre class="has">
<code>eos.transaction(tr =&gt; {
    tr.sellram({
        account: 'testtesttest',
        bytes: 1024 //出售1k内存
    })
})

</code></pre> 
  <h3>21- 竞拍账号名</h3> 
  <pre class="has">
<code>eos.transaction(tr =&gt; {
    tr.bidname ({
        bidder: "testtesttest",
        newname: "竞拍的名字",
        bid: 价格
    })
})
</code></pre> 
  <h3>22- 抵押CPU和NET</h3> 
  <pre class="has">
<code>eos.transaction(tr =&gt; {
    tr.delegatebw({
        from: "testtesttest",
        receiver: "testtesttest", //testtesttest账户为自己抵押
        stake_net_quantity: "1.0000 DEV",
        stake_cpu_quantity: "1.0000 DEV",
        transfer: 0
    })
})

</code></pre> 
  <h3>23- 取消抵押（赎回）CPU和NET</h3> 
  <pre class="has">
<code>eos.transaction(tr =&gt; {
    tr.undelegatebw({
        from: "testtesttest",
        receiver: "testtesttest",
        unstake_net_quantity: "0.1000 DEV", //赎回0.1个DEV
        unstake_cpu_quantity: "0.1000 DEV"
    })
})
</code></pre> 
  <h3>24- 智能合约部署</h3> 
  <p>如果是加载<code>wasm</code>合约，不用使用<code>binaryen</code>，如果加载<code>wast</code>合约，需要安装并使用<code>binaryen</code>，如下：</p> 
  <pre class="has">
<code>npm install binaryen@39.0.0
</code></pre> 
  <p>并用以下方式导入到js</p> 
  <pre class="has">
<code>binaryen = require('binaryen')
eos = Eos({keyProvider, binaryen})
</code></pre> 
  <p>部署合约</p> 
  <p>以官方自带的hello合约为例</p> 
  <pre class="has">
<code>fs = require('fs')
wasm = fs.readFileSync(`contracts/hello/hello.wasm`) //这个文件在客户端上，而不是在服务器上
abi = fs.readFileSync(`contracts/hello/hello.abi`)

eos.setcode('contract_name', 0, 0, wasm) // contract_name 为合约名
eos.setabi('contract_name', JSON.parse(abi)) // @returns {Promise}
</code></pre> 
  <h3>25- 智能合约的执行</h3> 
  <p>方法一：</p> 
  <pre class="has">
<code>eos.contract("contract_name").then(hello =&gt; {  //hello随便起的变量名
    hello.hi('axay', {                         //hi是方法名, 'axay'是该hello合约hi方法的参数
    	authorization: ['testtesttest']        //testtesttest是建立该合约的用户
    }).then(result =&gt; {
        console.log(result);
    });
});
</code></pre> 
  <p>方法二：</p> 
  <pre class="has">
<code>eos.transaction(
    {
        actions: [
            {
                account: 'contract_name',  //合约名
                name: 'hi',               //方法名，该方法在官方的hello合约中有
                authorization: [{
                    actor: 'testtesttest',
                    permission: 'active'
                }],
                data: {
                    user: 'axay'
                }
            }
        ]
    }
    // options -- example: {broadcast: false}
).then(result =&gt; console.log(result))
</code></pre> 
  <h3>26- 通过eosjs发行一个代币</h3> 
  <p>发行代币有两种方式，一种是通过<code>cleos</code>，<a href="https://github.com/eoshackathon/eos_dapp_development_cn/blob/master/docs/token_exchange_msig.md" rel="nofollow">参考这里</a>，但前提是必须要安装好EOS系统。 另一种方式是通过<code>eosjs</code>，无需在本机安装EOS系统。</p> 
  <p>注意：</p> 
  <p>此操作需要以<code>eosio.token</code>账户进行操作，因此需将<code>eosio.token</code>帐号的私钥导入到<code>keyProvider</code>数组中。但如果出于安全原因，不允许将<code>eosio.token</code>账户私钥加到程序中的话，则可以由发币的用户先部署<code>eosio.token</code>合约，然后再做接下去的操作。</p> 
  <p>第一步：创建代币</p> 
  <pre class="has">
<code>eos.transaction(
    {
        // ...headers,
        actions: [
            {
                account: 'eosio.token',       //合约名
                name: 'create',               //调用创建代币的方法
                authorization: [{
                    actor: 'eosio.token',     //必须是eosio.token
                    permission: 'active'
                }],
                data: {
                    issuer: 'testtesttest',   //代币发行方
                    maximum_supply: '10000.0000 AAA', //代币总量与名称
                    can_freeze: 0,
                    can_recall: 0,
                    can_whitelist: 0
                }
            }
        ]
    }
    // options -- example: {broadcast: false}
).then(result =&gt; console.log(result))
</code></pre> 
  <p>第二步：发行代币</p> 
  <pre class="has">
<code>eos.transaction(
    {
        // ...headers,
        actions: [
            {
                account: 'eosio.token',      //合约名
                name: 'issue',               //调用发行代币的方法
                authorization: [{
                    actor: 'testtesttest',   //必须是代币的发行方
                    permission: 'active'
                }],
                data: {
                    to: 'testtesttest',      //收到代币的帐号
                    quantity: '1000.0000 AAA',
                    memo: "testtesttest issue 1000 AAA"
                }
            }
        ]
    }
    // options -- example: {broadcast: false}
).then(result =&gt; console.log(result))
</code></pre> 
  <p>也可以将以上两步合在一起操作，如：</p> 
  <pre class="has">
<code>eos.transaction(
    {
        // ...headers,
        actions: [
            {
                account: 'eosio.token',  //合约
                name: 'create',               //方法
                authorization: [{
                    actor: 'eosio.token',
                    permission: 'active'
                }],
                data: {
                    issuer: 'testtesttest',
                    maximum_supply: '10000000.0000 GAT',
                    can_freeze: 0,
                    can_recall: 0,
                    can_whitelist: 0
                }
            },
            {
                account: 'eosio.token',  //合约
                name: 'issue',               //方法
                authorization: [{
                    actor: 'testtesttest',
                    permission: 'active'
                }],
                data: {
                    to: 'testtest1111',
                    quantity: '1000.0000 GAT',
                    memo: "testtesttest issue 1000 GAT to testtest1111"
                }
            }
        ]
    }
    // options -- example: {broadcast: false}
).then(result =&gt; console.log(result))</code></pre> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_39842528/article/details/81098715,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_39842528/article/details/81098715,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

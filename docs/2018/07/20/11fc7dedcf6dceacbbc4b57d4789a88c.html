<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用Web3.js查询以太币和代币余额以及转账-ffzhihua的博客(勤奋、努力、孜孜不倦) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用Web3.js查询以太币和代币余额以及转账-ffzhihua的博客(勤奋、努力、孜孜不倦)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="前言 web3.js文档http://web3js.readthedocs.io/en/1.0/ 前面的文章也提到了，使用web3.js可以与以太坊进行互动。这篇文章的主要内容如下： 解决web3.js版本问题 2.使用web3.js查询以太币及代币余额，以及进行以太币和代币转账 1.web3.js版本问题 现在使用npm install web3安装的web3.js，会发现node_modules中的web3文件夹中，没有dist文件夹，而查看package.json内容如下： { &quot;name&quot;: &quot;111&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;&quot;, &quot;main&quot;: &quot;index.js&quot;, &quot;scripts&quot;: { &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot; }, &quot;author&quot;: &quot;&quot;, &quot;license&quot;: &quot;ISC&quot;, &quot;dependencies&quot;: { &quot;web3&quot;: &quot;^1.0.0-beta.34&quot; } } 会发现web3的版本为&quot;^1.0.0-beta.34&quot;。 官方文档有这么一句话： &nbsp; 大意是这篇文档还在补全中，并且1.0版本的包还没放出。如果要查看当前的0.x.x版本的文档，请戳这里https://github.com/ethereum/wiki/wiki/JavaScript-API。我估计这是web3文件夹没有dist文件夹以及web3.min.js的原因。 之前的文章《以太开发交互实战》也有提供了下载缺失包的地址，但是下载下来的web3.min.js很可能是0.20.6版本的。因为根据当前1.0官方文档进行使用，很多方法运行会出现找不到此方法的错误信息。而我们的package.json的web3的版本又是&quot;^1.0.0-beta.34&quot;，所以干脆直接去下载1.0.0-beta.34版本的缺失包使用，还可以就着1.0版本的文档食用。 1.1 下载1.0.0-beta.34版本的web3.min.js 首先进入https://github.com/ethereum/web3.js，点击Branch，切换到Tags选项，点击v1.0.0-beta.34，然后download代码，将dist文件夹拷贝到自己项目的moudles的web3文件夹下即可。 2. 使用web3.js查询以太币及代币余额以及进行以太币和代币转账 2.1 在私链和主链上查询以太币及代币余额 查询类方法在私链和主链上的方法都是一样的，说明以下几点： 主链地址。可以去infura申请 contractAbi。合约的abi。可以去https://etherscan.io获取，如果代币合约提供了code，就会有abi // 引入web3 var Web3 = require(&#39;web3&#39;); if (typeof web3 !== &#39;undefined&#39;) { web3 = new Web3(web3.currentProvider); } else { // web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:7545&quot;)); web3 = new Web3(new Web3.providers.HttpProvider(&quot;https://mainnet.infura.io/yourAddress&quot;)); } // 定义合约abi var contractAbi = [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;mintingFinished&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;cap&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;unpause&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;mint&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burn&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;paused&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_subtractedValue&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;decreaseApproval&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;balance&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;finishMinting&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;pause&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;owner&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_addedValue&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;increaseApproval&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;newOwner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;transferOwnership&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;burner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Burn&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;Pause&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;Unpause&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Mint&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;MintFinished&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Approval&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; // 合约地址 var contractAddress = &quot;0x7FCCF800568747b178c6cBbe4Bf3d147df75ac61&quot;; // 账号 var currentAccount = &quot;0x4e9d5c58d8d6f02FFe5A6EF10CB804FfFB556bBb&quot;; // 定义合约 var myContract = new web3.eth.Contract(contractAbi, contractAddress, { from: currentAccount, // default from address gasPrice: &#39;10000000000&#39; // default gas price in wei, 10 gwei in this case }); // 查询以太币余额 web3.eth.getBalance(currentAccount).then(console.log); // 查看某个账号的代币余额 myContract.methods.balanceOf(contractAddress).call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); 举一反三，这里还可以查询代币的名称，符号，小数位，发行总量等等，因为代币合约一般都符合ERC标准，都有这些基本方法。甚至如果你有合约代码和abi，还可以调用合约的其他方法，当然调用有些方法需要权限及前置条件。 // 获得代币名称 myContract.methods.name().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 获取代币符号 myContract.methods.symbol().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 获取代币总量 myContract.methods.totalSupply().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 查看某个账号允许另一个账号可使用的代币数量 myContract.methods.allowance(sender, spender).call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); 2.2 在私链上转账以太币及代币 // 以太币转账 web3.eth.sendTransaction({ from: currentAccount, to: receiverAccount, value: &#39;1000000000000000&#39; }) .then(function(receipt){ console.log(receipt); }); // 代币转账 myContract.methods.transfer(to, amount).send({from: currentAccount}), function(error, transactionHash){ if(!error) { console.log(&#39;transactionHash is &#39; + transactionHash); } else { console.log(error); } }); 2.2 在主链上转账以太币及代币 上面的方法只适用于私链。因为你在私链的账户在本地是有私钥的。而在主链上要进行写入数据的方法，是需要获取账户的私钥并对交易进行签名的，所以要用到web3.eth.sendSignedTransaction方法。 文档http://web3js.readthedocs.io/en/1.0/web3-eth.html#sendsignedtransaction 方法稍微有点复杂，建议先查看底部的参考文章。因为有些重复的内容这里就不再解释了。 需要npm安裝&#39;ethereumjs-tx&#39; npm install ethereumjs-tx 以太币转账 // 引入ethereumjs-tx var Tx = require(&#39;ethereumjs-tx&#39;); // 以太币转账 // 先获取当前账号交易的nonce web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){ // 获取交易数据 var txData = { // nonce每次++，以免覆盖之前pending中的交易 nonce: web3.utils.toHex(nonce++), // 设置gasLimit和gasPrice gasLimit: web3.utils.toHex(99000), gasPrice: web3.utils.toHex(10e9), // 要转账的哪个账号 to: &#39;0x3b11f5CAB8362807273e1680890A802c5F1B15a8&#39;, // 从哪个账号转 from: currentAccount, // 0.001 以太币 value: web3.utils.toHex(10e14), data: &#39;&#39; } var tx = new Tx(txData); // 引入私钥，并转换为16进制 const privateKey = new Buffer(&#39;your account privateKey&#39;, &#39;hex&#39;); // 用私钥签署交易 tx.sign(privateKey); // 序列化 var serializedTx = tx.serialize().toString(&#39;hex&#39;); web3.eth.sendSignedTransaction(&#39;0x&#39; + serializedTx.toString(&#39;hex&#39;), function(err, hash) { if (!err) { console.log(hash); } else { console.error(err); } }); }); 代币转账 // 补齐64位，不够前面用0补齐 function addPreZero(num){ var t = (num+&#39;&#39;).length, s = &#39;&#39;; for(var i=0; i&lt;64-t; i++){ s += &#39;0&#39;; } return s+num; } web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){ // 获取交易数据 var txData = { nonce: web3.utils.toHex(nonce++), gasLimit: web3.utils.toHex(99000), gasPrice: web3.utils.toHex(10e9), // 注意这里是代币合约地址 to: contractAddress, from: currentAccount, // 调用合约转账value这里留空 value: &#39;0x00&#39;, // data的组成，由：0x + 要调用的合约方法的function signature + 要传递的方法参数，每个参数都为64位(对transfer来说，第一个是接收人的地址去掉0x，第二个是代币数量的16进制表示，去掉前面0x，然后补齐为64位) data: &#39;0x&#39; + &#39;a9059cbb&#39; + addPreZero(&#39;3b11f5CAB8362807273e1680890A802c5F1B15a8&#39;) + addPreZero(web3.utils.toHex(1000000000000000000).substr(2)) } var tx = new Tx(txData); const privateKey = new Buffer(&#39;your account privateKey&#39;, &#39;hex&#39;); tx.sign(privateKey); var serializedTx = tx.serialize().toString(&#39;hex&#39;); web3.eth.sendSignedTransaction(&#39;0x&#39; + serializedTx.toString(&#39;hex&#39;), function(err, hash) { if (!err) { console.log(hash); } else { console.error(err); } }); }); &nbsp; 阅读更多" />
<meta property="og:description" content="前言 web3.js文档http://web3js.readthedocs.io/en/1.0/ 前面的文章也提到了，使用web3.js可以与以太坊进行互动。这篇文章的主要内容如下： 解决web3.js版本问题 2.使用web3.js查询以太币及代币余额，以及进行以太币和代币转账 1.web3.js版本问题 现在使用npm install web3安装的web3.js，会发现node_modules中的web3文件夹中，没有dist文件夹，而查看package.json内容如下： { &quot;name&quot;: &quot;111&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;&quot;, &quot;main&quot;: &quot;index.js&quot;, &quot;scripts&quot;: { &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot; }, &quot;author&quot;: &quot;&quot;, &quot;license&quot;: &quot;ISC&quot;, &quot;dependencies&quot;: { &quot;web3&quot;: &quot;^1.0.0-beta.34&quot; } } 会发现web3的版本为&quot;^1.0.0-beta.34&quot;。 官方文档有这么一句话： &nbsp; 大意是这篇文档还在补全中，并且1.0版本的包还没放出。如果要查看当前的0.x.x版本的文档，请戳这里https://github.com/ethereum/wiki/wiki/JavaScript-API。我估计这是web3文件夹没有dist文件夹以及web3.min.js的原因。 之前的文章《以太开发交互实战》也有提供了下载缺失包的地址，但是下载下来的web3.min.js很可能是0.20.6版本的。因为根据当前1.0官方文档进行使用，很多方法运行会出现找不到此方法的错误信息。而我们的package.json的web3的版本又是&quot;^1.0.0-beta.34&quot;，所以干脆直接去下载1.0.0-beta.34版本的缺失包使用，还可以就着1.0版本的文档食用。 1.1 下载1.0.0-beta.34版本的web3.min.js 首先进入https://github.com/ethereum/web3.js，点击Branch，切换到Tags选项，点击v1.0.0-beta.34，然后download代码，将dist文件夹拷贝到自己项目的moudles的web3文件夹下即可。 2. 使用web3.js查询以太币及代币余额以及进行以太币和代币转账 2.1 在私链和主链上查询以太币及代币余额 查询类方法在私链和主链上的方法都是一样的，说明以下几点： 主链地址。可以去infura申请 contractAbi。合约的abi。可以去https://etherscan.io获取，如果代币合约提供了code，就会有abi // 引入web3 var Web3 = require(&#39;web3&#39;); if (typeof web3 !== &#39;undefined&#39;) { web3 = new Web3(web3.currentProvider); } else { // web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:7545&quot;)); web3 = new Web3(new Web3.providers.HttpProvider(&quot;https://mainnet.infura.io/yourAddress&quot;)); } // 定义合约abi var contractAbi = [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;mintingFinished&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;cap&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;unpause&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;mint&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burn&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;paused&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_subtractedValue&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;decreaseApproval&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;balance&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;finishMinting&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;pause&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;owner&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_addedValue&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;increaseApproval&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;newOwner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;transferOwnership&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;burner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Burn&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;Pause&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;Unpause&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Mint&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;MintFinished&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Approval&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; // 合约地址 var contractAddress = &quot;0x7FCCF800568747b178c6cBbe4Bf3d147df75ac61&quot;; // 账号 var currentAccount = &quot;0x4e9d5c58d8d6f02FFe5A6EF10CB804FfFB556bBb&quot;; // 定义合约 var myContract = new web3.eth.Contract(contractAbi, contractAddress, { from: currentAccount, // default from address gasPrice: &#39;10000000000&#39; // default gas price in wei, 10 gwei in this case }); // 查询以太币余额 web3.eth.getBalance(currentAccount).then(console.log); // 查看某个账号的代币余额 myContract.methods.balanceOf(contractAddress).call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); 举一反三，这里还可以查询代币的名称，符号，小数位，发行总量等等，因为代币合约一般都符合ERC标准，都有这些基本方法。甚至如果你有合约代码和abi，还可以调用合约的其他方法，当然调用有些方法需要权限及前置条件。 // 获得代币名称 myContract.methods.name().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 获取代币符号 myContract.methods.symbol().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 获取代币总量 myContract.methods.totalSupply().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 查看某个账号允许另一个账号可使用的代币数量 myContract.methods.allowance(sender, spender).call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); 2.2 在私链上转账以太币及代币 // 以太币转账 web3.eth.sendTransaction({ from: currentAccount, to: receiverAccount, value: &#39;1000000000000000&#39; }) .then(function(receipt){ console.log(receipt); }); // 代币转账 myContract.methods.transfer(to, amount).send({from: currentAccount}), function(error, transactionHash){ if(!error) { console.log(&#39;transactionHash is &#39; + transactionHash); } else { console.log(error); } }); 2.2 在主链上转账以太币及代币 上面的方法只适用于私链。因为你在私链的账户在本地是有私钥的。而在主链上要进行写入数据的方法，是需要获取账户的私钥并对交易进行签名的，所以要用到web3.eth.sendSignedTransaction方法。 文档http://web3js.readthedocs.io/en/1.0/web3-eth.html#sendsignedtransaction 方法稍微有点复杂，建议先查看底部的参考文章。因为有些重复的内容这里就不再解释了。 需要npm安裝&#39;ethereumjs-tx&#39; npm install ethereumjs-tx 以太币转账 // 引入ethereumjs-tx var Tx = require(&#39;ethereumjs-tx&#39;); // 以太币转账 // 先获取当前账号交易的nonce web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){ // 获取交易数据 var txData = { // nonce每次++，以免覆盖之前pending中的交易 nonce: web3.utils.toHex(nonce++), // 设置gasLimit和gasPrice gasLimit: web3.utils.toHex(99000), gasPrice: web3.utils.toHex(10e9), // 要转账的哪个账号 to: &#39;0x3b11f5CAB8362807273e1680890A802c5F1B15a8&#39;, // 从哪个账号转 from: currentAccount, // 0.001 以太币 value: web3.utils.toHex(10e14), data: &#39;&#39; } var tx = new Tx(txData); // 引入私钥，并转换为16进制 const privateKey = new Buffer(&#39;your account privateKey&#39;, &#39;hex&#39;); // 用私钥签署交易 tx.sign(privateKey); // 序列化 var serializedTx = tx.serialize().toString(&#39;hex&#39;); web3.eth.sendSignedTransaction(&#39;0x&#39; + serializedTx.toString(&#39;hex&#39;), function(err, hash) { if (!err) { console.log(hash); } else { console.error(err); } }); }); 代币转账 // 补齐64位，不够前面用0补齐 function addPreZero(num){ var t = (num+&#39;&#39;).length, s = &#39;&#39;; for(var i=0; i&lt;64-t; i++){ s += &#39;0&#39;; } return s+num; } web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){ // 获取交易数据 var txData = { nonce: web3.utils.toHex(nonce++), gasLimit: web3.utils.toHex(99000), gasPrice: web3.utils.toHex(10e9), // 注意这里是代币合约地址 to: contractAddress, from: currentAccount, // 调用合约转账value这里留空 value: &#39;0x00&#39;, // data的组成，由：0x + 要调用的合约方法的function signature + 要传递的方法参数，每个参数都为64位(对transfer来说，第一个是接收人的地址去掉0x，第二个是代币数量的16进制表示，去掉前面0x，然后补齐为64位) data: &#39;0x&#39; + &#39;a9059cbb&#39; + addPreZero(&#39;3b11f5CAB8362807273e1680890A802c5F1B15a8&#39;) + addPreZero(web3.utils.toHex(1000000000000000000).substr(2)) } var tx = new Tx(txData); const privateKey = new Buffer(&#39;your account privateKey&#39;, &#39;hex&#39;); tx.sign(privateKey); var serializedTx = tx.serialize().toString(&#39;hex&#39;); web3.eth.sendSignedTransaction(&#39;0x&#39; + serializedTx.toString(&#39;hex&#39;), function(err, hash) { if (!err) { console.log(hash); } else { console.error(err); } }); }); &nbsp; 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-20T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"前言 web3.js文档http://web3js.readthedocs.io/en/1.0/ 前面的文章也提到了，使用web3.js可以与以太坊进行互动。这篇文章的主要内容如下： 解决web3.js版本问题 2.使用web3.js查询以太币及代币余额，以及进行以太币和代币转账 1.web3.js版本问题 现在使用npm install web3安装的web3.js，会发现node_modules中的web3文件夹中，没有dist文件夹，而查看package.json内容如下： { &quot;name&quot;: &quot;111&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;&quot;, &quot;main&quot;: &quot;index.js&quot;, &quot;scripts&quot;: { &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot; }, &quot;author&quot;: &quot;&quot;, &quot;license&quot;: &quot;ISC&quot;, &quot;dependencies&quot;: { &quot;web3&quot;: &quot;^1.0.0-beta.34&quot; } } 会发现web3的版本为&quot;^1.0.0-beta.34&quot;。 官方文档有这么一句话： &nbsp; 大意是这篇文档还在补全中，并且1.0版本的包还没放出。如果要查看当前的0.x.x版本的文档，请戳这里https://github.com/ethereum/wiki/wiki/JavaScript-API。我估计这是web3文件夹没有dist文件夹以及web3.min.js的原因。 之前的文章《以太开发交互实战》也有提供了下载缺失包的地址，但是下载下来的web3.min.js很可能是0.20.6版本的。因为根据当前1.0官方文档进行使用，很多方法运行会出现找不到此方法的错误信息。而我们的package.json的web3的版本又是&quot;^1.0.0-beta.34&quot;，所以干脆直接去下载1.0.0-beta.34版本的缺失包使用，还可以就着1.0版本的文档食用。 1.1 下载1.0.0-beta.34版本的web3.min.js 首先进入https://github.com/ethereum/web3.js，点击Branch，切换到Tags选项，点击v1.0.0-beta.34，然后download代码，将dist文件夹拷贝到自己项目的moudles的web3文件夹下即可。 2. 使用web3.js查询以太币及代币余额以及进行以太币和代币转账 2.1 在私链和主链上查询以太币及代币余额 查询类方法在私链和主链上的方法都是一样的，说明以下几点： 主链地址。可以去infura申请 contractAbi。合约的abi。可以去https://etherscan.io获取，如果代币合约提供了code，就会有abi // 引入web3 var Web3 = require(&#39;web3&#39;); if (typeof web3 !== &#39;undefined&#39;) { web3 = new Web3(web3.currentProvider); } else { // web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:7545&quot;)); web3 = new Web3(new Web3.providers.HttpProvider(&quot;https://mainnet.infura.io/yourAddress&quot;)); } // 定义合约abi var contractAbi = [{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;mintingFinished&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;cap&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;unpause&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;mint&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;burn&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;paused&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_subtractedValue&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;decreaseApproval&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;balance&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;finishMinting&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;pause&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;owner&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_addedValue&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;increaseApproval&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;success&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;newOwner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;transferOwnership&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;burner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Burn&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;Pause&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;Unpause&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Mint&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;MintFinished&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Approval&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]; // 合约地址 var contractAddress = &quot;0x7FCCF800568747b178c6cBbe4Bf3d147df75ac61&quot;; // 账号 var currentAccount = &quot;0x4e9d5c58d8d6f02FFe5A6EF10CB804FfFB556bBb&quot;; // 定义合约 var myContract = new web3.eth.Contract(contractAbi, contractAddress, { from: currentAccount, // default from address gasPrice: &#39;10000000000&#39; // default gas price in wei, 10 gwei in this case }); // 查询以太币余额 web3.eth.getBalance(currentAccount).then(console.log); // 查看某个账号的代币余额 myContract.methods.balanceOf(contractAddress).call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); 举一反三，这里还可以查询代币的名称，符号，小数位，发行总量等等，因为代币合约一般都符合ERC标准，都有这些基本方法。甚至如果你有合约代码和abi，还可以调用合约的其他方法，当然调用有些方法需要权限及前置条件。 // 获得代币名称 myContract.methods.name().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 获取代币符号 myContract.methods.symbol().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 获取代币总量 myContract.methods.totalSupply().call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); // 查看某个账号允许另一个账号可使用的代币数量 myContract.methods.allowance(sender, spender).call({from: currentAccount}, function(error, result){ if(!error) { console.log(result); } else { console.log(error); } }); 2.2 在私链上转账以太币及代币 // 以太币转账 web3.eth.sendTransaction({ from: currentAccount, to: receiverAccount, value: &#39;1000000000000000&#39; }) .then(function(receipt){ console.log(receipt); }); // 代币转账 myContract.methods.transfer(to, amount).send({from: currentAccount}), function(error, transactionHash){ if(!error) { console.log(&#39;transactionHash is &#39; + transactionHash); } else { console.log(error); } }); 2.2 在主链上转账以太币及代币 上面的方法只适用于私链。因为你在私链的账户在本地是有私钥的。而在主链上要进行写入数据的方法，是需要获取账户的私钥并对交易进行签名的，所以要用到web3.eth.sendSignedTransaction方法。 文档http://web3js.readthedocs.io/en/1.0/web3-eth.html#sendsignedtransaction 方法稍微有点复杂，建议先查看底部的参考文章。因为有些重复的内容这里就不再解释了。 需要npm安裝&#39;ethereumjs-tx&#39; npm install ethereumjs-tx 以太币转账 // 引入ethereumjs-tx var Tx = require(&#39;ethereumjs-tx&#39;); // 以太币转账 // 先获取当前账号交易的nonce web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){ // 获取交易数据 var txData = { // nonce每次++，以免覆盖之前pending中的交易 nonce: web3.utils.toHex(nonce++), // 设置gasLimit和gasPrice gasLimit: web3.utils.toHex(99000), gasPrice: web3.utils.toHex(10e9), // 要转账的哪个账号 to: &#39;0x3b11f5CAB8362807273e1680890A802c5F1B15a8&#39;, // 从哪个账号转 from: currentAccount, // 0.001 以太币 value: web3.utils.toHex(10e14), data: &#39;&#39; } var tx = new Tx(txData); // 引入私钥，并转换为16进制 const privateKey = new Buffer(&#39;your account privateKey&#39;, &#39;hex&#39;); // 用私钥签署交易 tx.sign(privateKey); // 序列化 var serializedTx = tx.serialize().toString(&#39;hex&#39;); web3.eth.sendSignedTransaction(&#39;0x&#39; + serializedTx.toString(&#39;hex&#39;), function(err, hash) { if (!err) { console.log(hash); } else { console.error(err); } }); }); 代币转账 // 补齐64位，不够前面用0补齐 function addPreZero(num){ var t = (num+&#39;&#39;).length, s = &#39;&#39;; for(var i=0; i&lt;64-t; i++){ s += &#39;0&#39;; } return s+num; } web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){ // 获取交易数据 var txData = { nonce: web3.utils.toHex(nonce++), gasLimit: web3.utils.toHex(99000), gasPrice: web3.utils.toHex(10e9), // 注意这里是代币合约地址 to: contractAddress, from: currentAccount, // 调用合约转账value这里留空 value: &#39;0x00&#39;, // data的组成，由：0x + 要调用的合约方法的function signature + 要传递的方法参数，每个参数都为64位(对transfer来说，第一个是接收人的地址去掉0x，第二个是代币数量的16进制表示，去掉前面0x，然后补齐为64位) data: &#39;0x&#39; + &#39;a9059cbb&#39; + addPreZero(&#39;3b11f5CAB8362807273e1680890A802c5F1B15a8&#39;) + addPreZero(web3.utils.toHex(1000000000000000000).substr(2)) } var tx = new Tx(txData); const privateKey = new Buffer(&#39;your account privateKey&#39;, &#39;hex&#39;); tx.sign(privateKey); var serializedTx = tx.serialize().toString(&#39;hex&#39;); web3.eth.sendSignedTransaction(&#39;0x&#39; + serializedTx.toString(&#39;hex&#39;), function(err, hash) { if (!err) { console.log(hash); } else { console.error(err); } }); }); &nbsp; 阅读更多","@type":"BlogPosting","url":"/2018/07/20/11fc7dedcf6dceacbbc4b57d4789a88c.html","headline":"使用Web3.js查询以太币和代币余额以及转账-ffzhihua的博客(勤奋、努力、孜孜不倦)","dateModified":"2018-07-20T00:00:00+08:00","datePublished":"2018-07-20T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/07/20/11fc7dedcf6dceacbbc4b57d4789a88c.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用Web3.js查询以太币和代币余额以及转账-ffzhihua的博客(勤奋、努力、孜孜不倦)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-7f5a1a725b.css"> 
 <div class="htmledit_views"> 
  <h1>前言</h1> 
  <p><code>web3.js</code>文档<br><a href="http://web3js.readthedocs.io/en/1.0/" rel="nofollow">http://web3js.readthedocs.io/en/1.0/</a></p> 
  <p>前面的文章也提到了，使用<code>web3.js</code>可以与以太坊进行互动。这篇文章的主要内容如下：</p> 
  <ol>
   <li>解决<code>web3.js</code>版本问题</li> 
  </ol>
  <p>2.使用<code>web3.js</code>查询以太币及代币余额，以及进行以太币和代币转账</p> 
  <h1>1.web3.js版本问题</h1> 
  <p>现在使用<code>npm install web3</code>安装的<code>web3.js</code>，会发现<code>node_modules</code>中的<code>web3</code>文件夹中，没有<code>dist</code>文件夹，而查看<code>package.json</code>内容如下：</p> 
  <pre class="has">
<code>{
  "name": "111",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "web3": "^1.0.0-beta.34"
  }
}
</code></pre> 
  <p>会发现<code>web3</code>的版本为<code>"^1.0.0-beta.34"</code>。</p> 
  <p>官方文档有这么一句话：</p> 
  <p>&nbsp;</p> 
  <p><img alt="" class="has" src="https://upload-images.jianshu.io/upload_images/10729287-28fc145f68538718.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p> 
  <p>大意是这篇文档还在补全中，并且1.0版本的包还没放出。如果要查看当前的0.x.x版本的文档，请戳这里<a href="https://github.com/ethereum/wiki/wiki/JavaScript-API" rel="nofollow">https://github.com/ethereum/wiki/wiki/JavaScript-API</a>。我估计这是<code>web3</code>文件夹没有<code>dist</code>文件夹以及<code>web3.min.js</code>的原因。</p> 
  <p><a href="https://blog.csdn.net/ffzhihua/article/details/81127007" rel="nofollow">之前的文章《以太开发交互实战》</a>也有提供了下载缺失包的地址，但是下载下来的<code>web3.min.js</code>很可能是<code>0.20.6</code>版本的。因为根据当前<code>1.0</code>官方文档进行使用，很多方法运行会出现找不到此方法的错误信息。而我们的<code>package.json</code>的<code>web3</code>的版本又是<code>"^1.0.0-beta.34"</code>，所以干脆直接去下载<code>1.0.0-beta.34</code>版本的缺失包使用，还可以就着<code>1.0</code>版本的文档食用。</p> 
  <h2>1.1 下载1.0.0-beta.34版本的web3.min.js</h2> 
  <p>首先进入<a href="https://github.com/ethereum/web3.js" rel="nofollow">https://github.com/ethereum/web3.js</a>，点击<code>Branch</code>，切换到<code>Tags</code>选项，点击<code>v1.0.0-beta.34</code>，然后<code>download</code>代码，将<code>dist</code>文件夹拷贝到自己项目的<code>moudles</code>的<code>web3</code>文件夹下即可。</p> 
  <h1>2. 使用web3.js查询以太币及代币余额以及进行以太币和代币转账</h1> 
  <h2>2.1 在私链和主链上查询以太币及代币余额</h2> 
  <p>查询类方法在私链和主链上的方法都是一样的，说明以下几点：</p> 
  <ul>
   <li> <p>主链地址。可以去<code>infura</code>申请</p> </li> 
   <li> <p><code>contractAbi</code>。合约的abi。可以去<a href="https://etherscan.io/" rel="nofollow">https://etherscan.io</a>获取，如果代币合约提供了<code>code</code>，就会有<code>abi</code></p> </li> 
  </ul>
  <pre class="has">
<code>// 引入web3
var Web3 = require('web3');
if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7545"));
    web3 = new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/yourAddress"));
}

// 定义合约abi
var contractAbi = [{"constant":true,"inputs":[],"name":"mintingFinished","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"cap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"unpause","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"mint","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"paused","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"}],"name":"decreaseApproval","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"finishMinting","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"pause","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"}],"name":"increaseApproval","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"burner","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"},{"anonymous":false,"inputs":[],"name":"Pause","type":"event"},{"anonymous":false,"inputs":[],"name":"Unpause","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Mint","type":"event"},{"anonymous":false,"inputs":[],"name":"MintFinished","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"}];

// 合约地址
var contractAddress = "0x7FCCF800568747b178c6cBbe4Bf3d147df75ac61";

// 账号
var currentAccount = "0x4e9d5c58d8d6f02FFe5A6EF10CB804FfFB556bBb";

// 定义合约
var myContract = new web3.eth.Contract(contractAbi, contractAddress, {
    from: currentAccount, // default from address
    gasPrice: '10000000000' // default gas price in wei, 10 gwei in this case
});

// 查询以太币余额
web3.eth.getBalance(currentAccount).then(console.log);

// 查看某个账号的代币余额
myContract.methods.balanceOf(contractAddress).call({from: currentAccount}, function(error, result){
    if(!error) {
        console.log(result);
    } else {
        console.log(error);
    }
});
</code></pre> 
  <p>举一反三，这里还可以查询代币的名称，符号，小数位，发行总量等等，因为代币合约一般都符合<code>ERC</code>标准，都有这些基本方法。甚至如果你有合约代码和<code>abi</code>，还可以调用合约的其他方法，当然调用有些方法需要权限及前置条件。</p> 
  <pre class="has">
<code>// 获得代币名称
myContract.methods.name().call({from: currentAccount}, function(error, result){
    if(!error) {
          console.log(result);
    } else {
      console.log(error);
    }
});

// 获取代币符号
myContract.methods.symbol().call({from: currentAccount}, function(error, result){
    if(!error) {
      console.log(result);
     } else {
      console.log(error);
     }
});

// 获取代币总量
myContract.methods.totalSupply().call({from: currentAccount}, function(error, result){
    if(!error) {
      console.log(result);
     } else {
      console.log(error);
     }
});

// 查看某个账号允许另一个账号可使用的代币数量
myContract.methods.allowance(sender, spender).call({from: currentAccount}, function(error, result){
    if(!error) {
      console.log(result);
     } else {
      console.log(error);
     }
});
</code></pre> 
  <h2>2.2 在私链上转账以太币及代币</h2> 
  <pre class="has">
<code>// 以太币转账
web3.eth.sendTransaction({
    from: currentAccount,
    to: receiverAccount,
    value: '1000000000000000'
})
.then(function(receipt){
    console.log(receipt);
});

// 代币转账
myContract.methods.transfer(to, amount).send({from: currentAccount}), function(error, transactionHash){
    if(!error) {
       console.log('transactionHash is ' + transactionHash);
    } else {
       console.log(error);
    }
});
</code></pre> 
  <h2>2.2 在主链上转账以太币及代币</h2> 
  <p>上面的方法只适用于私链。因为你在私链的账户在本地是有私钥的。而在主链上要进行写入数据的方法，是需要获取账户的私钥并对交易进行签名的，所以要用到<code>web3.eth.sendSignedTransaction</code>方法。</p> 
  <p>文档<a href="http://web3js.readthedocs.io/en/1.0/web3-eth.html#sendsignedtransaction" rel="nofollow">http://web3js.readthedocs.io/en/1.0/web3-eth.html#sendsignedtransaction</a></p> 
  <blockquote> 
   <p>方法稍微有点复杂，建议先查看底部的参考文章。因为有些重复的内容这里就不再解释了。</p> 
  </blockquote> 
  <p>需要<code>npm</code>安裝'ethereumjs-tx'</p> 
  <pre class="has">
<code>npm install ethereumjs-tx
</code></pre> 
  <p>以太币转账</p> 
  <pre class="has">
<code>// 引入ethereumjs-tx
var Tx = require('ethereumjs-tx');

// 以太币转账    
// 先获取当前账号交易的nonce
web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){

    
    // 获取交易数据
    var txData = {
        // nonce每次++，以免覆盖之前pending中的交易
        nonce: web3.utils.toHex(nonce++),
        // 设置gasLimit和gasPrice
        gasLimit: web3.utils.toHex(99000),   
        gasPrice: web3.utils.toHex(10e9),  
        // 要转账的哪个账号  
        to: '0x3b11f5CAB8362807273e1680890A802c5F1B15a8',
        // 从哪个账号转
        from: currentAccount,
        // 0.001 以太币
        value: web3.utils.toHex(10e14),         
        data: ''
    }

    var tx = new Tx(txData);

    // 引入私钥，并转换为16进制
    const privateKey = new Buffer('your account privateKey', 'hex'); 

    // 用私钥签署交易
    tx.sign(privateKey);

    // 序列化
    var serializedTx = tx.serialize().toString('hex');

    web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex'), function(err, hash) {
        if (!err) {
            console.log(hash);
        } else {
            console.error(err);
        }
    });
});
</code></pre> 
  <p>代币转账</p> 
  <pre class="has">
<code>// 补齐64位，不够前面用0补齐
function addPreZero(num){
  var t = (num+'').length,
  s = '';
  for(var i=0; i&lt;64-t; i++){
    s += '0';
  }
  return s+num;
}

web3.eth.getTransactionCount(currentAccount, web3.eth.defaultBlock.pending).then(function(nonce){

    // 获取交易数据
    var txData = {
        nonce: web3.utils.toHex(nonce++),
        gasLimit: web3.utils.toHex(99000),   
        gasPrice: web3.utils.toHex(10e9),
        // 注意这里是代币合约地址    
        to: contractAddress,
        from: currentAccount,
        // 调用合约转账value这里留空
        value: '0x00',         
        // data的组成，由：0x + 要调用的合约方法的function signature + 要传递的方法参数，每个参数都为64位(对transfer来说，第一个是接收人的地址去掉0x，第二个是代币数量的16进制表示，去掉前面0x，然后补齐为64位)
        data: '0x' + 'a9059cbb' + addPreZero('3b11f5CAB8362807273e1680890A802c5F1B15a8') + addPreZero(web3.utils.toHex(1000000000000000000).substr(2))
    }

    var tx = new Tx(txData);

    const privateKey = new Buffer('your account privateKey', 'hex'); 

    tx.sign(privateKey);

    var serializedTx = tx.serialize().toString('hex');

    web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex'), function(err, hash) {
        if (!err) {
            console.log(hash);
        } else {
            console.error(err);
        }
    });
});
</code></pre> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ffzhihua/article/details/81126932,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ffzhihua/article/details/81126932,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

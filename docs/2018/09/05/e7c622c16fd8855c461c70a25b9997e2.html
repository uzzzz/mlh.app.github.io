<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链：以太坊私链搭建 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链：以太坊私链搭建" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wtdask/article/details/82424476 In me the tiger sniffs the rose. 心有猛虎，细嗅蔷薇 一、为什么用到私有链？ 在以太坊的共有链上部署智能合约、发起交易需要花费以太币。而通过修改配置，可以在本机搭建一套以太坊私有链，因为与公有链没关系，既不用同步公有链庞大的数据，也不用花钱购买以太币，很好地满足了智能合约开发和测试的要求，开发好的智能合约也可以很容易地切换接口部署到以太坊公有链上。 二、开源工具和语言 1、brewMacOS包管理器 打开终端执行下面的命令 /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; macdeiMac:Downloads mac$ /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; ==&gt; This script will install: /usr/local/bin/brew /usr/local/share/doc/homebrew /usr/local/share/man/man1/brew.1 /usr/local/share/zsh/site-functions/_brew /usr/local/etc/bash_completion.d/brew /usr/local/Homebrew ==&gt; The Xcode Command Line Tools will be installed. Press RETURN to continue or any other key to abort ==&gt; Searching online for the Command Line Tools ==&gt; /usr/bin/sudo /usr/bin/touch /tmp/.com.apple.dt.CommandLineTools.installondemand.in-progress Password: ==&gt; Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode-9.4 ==&gt; /usr/bin/sudo /usr/sbin/softwareupdate -i Command\ Line\ Tools\ (macOS\ High\ Sierra\ version\ 10.13)\ for\ Xcode-9.4 Software Update Tool Downloading Command Line Tools (macOS High Sierra version 10.13) for Xcode Downloaded Command Line Tools (macOS High Sierra version 10.13) for Xcode Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode Done with Command Line Tools (macOS High Sierra version 10.13) for Xcode Done. ==&gt; /usr/bin/sudo /bin/rm -f /tmp/.com.apple.dt.CommandLineTools.installondemand.in-progress Password: Sorry, try again. Password: ==&gt; /usr/bin/sudo /usr/bin/xcode-select --switch /Library/Developer/CommandLineTools ==&gt; Downloading and installing Homebrew... HEAD is now at 9777b278 Merge pull request #4810 from MikeMcQuaid/mojave-mmacosx-version-min ==&gt; Homebrew is run entirely by unpaid volunteers. Please consider donating: https://github.com/Homebrew/brew#donations ==&gt; Migrating /Library/Caches/Homebrew to /Users/mac/Library/Caches/Homebrew... ==&gt; Deleting /Library/Caches/Homebrew... Already up-to-date. ==&gt; Installation successful! ==&gt; Homebrew has enabled anonymous aggregate formulae and cask analytics. Read the analytics documentation (and how to opt-out) here: https://docs.brew.sh/Analytics.html ==&gt; Homebrew is run entirely by unpaid volunteers. Please consider donating: https://github.com/Homebrew/brew#donations ==&gt; Next steps: - Run `brew help` to get started - Further documentation: https://docs.brew.sh 2、install Go compiler brew install go macdeiMac:Downloads mac$ brew install go Updating Homebrew... ==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.11.high_sierra.bottle. ######################################################################## 100.0% ==&gt; Pouring go-1.11.high_sierra.bottle.tar.gz ==&gt; Caveats A valid GOPATH is required to use the `go get` command. If $GOPATH is not specified, $HOME/go will be used by default: https://golang.org/doc/code.html#GOPATH You may wish to add the GOROOT-based install location to your PATH: export PATH=$PATH:/usr/local/opt/go/libexec/bin ==&gt; Summary �� /usr/local/Cellar/go/1.11: 9,273 files, 403.9MB macdeiMac:Downloads mac$ 3、geth建立以太坊安装说明geth运行以太坊节点 下载Source code(tar.gz) macdeiMac:Downloads mac$ cd go-ethereum-1.5.9 macdeiMac:go-ethereum-1.5.9 mac$ pwd /Users/mac/Downloads/go-ethereum-1.5.9 macdeiMac:go-ethereum-1.5.9 mac$ make geth 4、Solidity以太坊智能合约语言 brew install solidity 三、建立私链 1. 创建一个文件夹来存储你的私链数据 macdeiMac:go-ethereum-1.5.9 mac$ cd /Users/mac/Desktop/GitHub/Solidity/learn macdeiMac:learn mac$ mkdir privatechain macdeiMac:learn mac$ pwd /Users/mac/Desktop/GitHub/Solidity/learn macdeiMac:learn mac$ ls BLC attributesMethod.sol method.sol Person.sol attributesaccess.sol method1.sol SmartContractDemo inherit.sol privatechain macdeiMac:learn mac$ 2. 使用geth来加载 geth --networkid 123 --dev --datadir data1 --rpc --rpcaddr 192.168.1.5 --rpcport 8989 --port 3000 各选项含义如下： –identity：指定节点 ID； –rpc：表示开启 HTTP-RPC 服务； –rpcaddr：HTTP-RPC 服务ip地址； –rpcport：指定 HTTP-RPC 服务监听端口号（默认为 8545）； –datadir：指定区块链数据的存储位置； –port：指定和其他节点连接所用的端口号（默认为 30303）； –nodiscover：关闭节点发现机制，防止加入有同样初始配置的陌生节点。 如果你切换到data1文件夹里面，你会看到geth, geth.ipc, 和 keystore。 保持节点的运行，不要关闭终端，重新打开一个终端，使用geth attach连接节点，并且打开geth console geth attach ipc:/Users/mac/Desktop/GitHub/Solidity/learn/privatechain/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.1-stable-05101641/darwin-amd64/go1.9.1 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 shh:1.0 txpool:1.0 web3:1.0 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 相关api命令 查看账户 &gt; personal.listAccounts [] &gt; 创建账户 &gt; personal.newAccount(&#39;wt&#39;) &quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot; &gt; PS：里面的wt是你账户的密码，输入你自己喜欢的密码。 查看账户 &gt; personal.listAccounts [&quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot;] &gt; web3命令 &gt; web3.eth.coinbase &quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot; &gt; 编写智能合约代码 pragma solidity ^0.4.4; contract test { function multiply(uint a) returns(uint d){ return a * 7; } } 获取智能合约字节码和abi 代码拷贝到https://remix.ethereum.org，编译，然后拷贝字节码和ABI。 字节码 6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029 ABI [ { &quot;constant&quot;: true, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;multiply&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;d&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;payable&quot;: false, &quot;type&quot;: &quot;function&quot;, &quot;stateMutability&quot;: &quot;view&quot; } ] 在bejson中转义成字符串 http://www.bejson.com [{\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;a\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;name\&quot;:\&quot;multiply\&quot;,\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;d\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;payable\&quot;:false,\&quot;type\&quot;:\&quot;function\&quot;,\&quot;stateMutability\&quot;:\&quot;view\&quot;}] 通过abi创建合约对象 &gt; var abi = JSON.parse(&#39;[{\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;a\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;name\&quot;:\&quot;multiply\&quot;,\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;d\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;payable\&quot;:false,\&quot;type\&quot;:\&quot;function\&quot;,\&quot;stateMutability\&quot;:\&quot;view\&quot;}]&#39;) &gt; myContract = web3.eth.contract(abi) { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], eth: { accounts: [&quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot;], blockNumber: 384, coinbase: &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 0, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 检查coinbase账号余额 &gt; account1 = web3.eth.coinbase &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot; &gt; web3.eth.getBalance(account1) 0 &gt; 如果余额大于0，继续，否则，开始挖矿。 &gt; miner.start(); null &gt; 停止挖矿。 miner.stop(); 停止挖矿，并且查余额 &gt; miner.start(); null &gt; miner.stop(); true &gt; web3.eth.getBalance(account1) 1.152e+21 &gt; 解锁coinbase账号，我们通过coinbase账号来付费部署合约 wt: 换成你的密码。 &gt; personal.unlockAccount(account1, &#39;wt&#39;) true &gt; 预估手续费 &gt; bytecode = &quot;6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &quot;6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; web3.eth.estimateGas({data: bytecode}) Error: invalid argument 0: json: cannot unmarshal hex string without 0x prefix into Go struct field CallArgs.data of type hexutil.Bytes at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 &gt; bytecode = &quot;0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &quot;0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; web3.eth.estimateGas({data: bytecode}) 98391 &gt; 备注：字节码前面需要添加0x。手续费大概为98391gas。 部署合约，为了方便理解，设置一个回调函数 &gt; contractInstance = myContract.new({data: bytecode gas: 1000000, from: account1}, function(e, contract){ if(!e){ if(!contract.address){ console.log(&quot;Contract transaction send: Transaction Hash: &quot;+contract.transactionHash+&quot; waiting to be mined...&quot;); }else{ console.log(&quot;Contract mined! Address: &quot;+contract.address); console.log(contract); } }else{ console.log(e) } }) Contract transaction send: Transaction Hash: 0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d waiting to be mined... { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], address: undefined, transactionHash: &quot;0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d&quot; } &gt; 你的合约等待挖矿，开始挖矿，等一会儿，停止 &gt; miner.start() null &gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db [object Object] &gt; miner.stop() true &gt; 检查合约是否部署成功 &gt; eth.getCode(contractInstance.address) &quot;0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; 调用合约方法 &gt; contractInstance.multiply(6) 42 &gt; 阅读更多 登录后自动展开" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wtdask/article/details/82424476 In me the tiger sniffs the rose. 心有猛虎，细嗅蔷薇 一、为什么用到私有链？ 在以太坊的共有链上部署智能合约、发起交易需要花费以太币。而通过修改配置，可以在本机搭建一套以太坊私有链，因为与公有链没关系，既不用同步公有链庞大的数据，也不用花钱购买以太币，很好地满足了智能合约开发和测试的要求，开发好的智能合约也可以很容易地切换接口部署到以太坊公有链上。 二、开源工具和语言 1、brewMacOS包管理器 打开终端执行下面的命令 /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; macdeiMac:Downloads mac$ /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; ==&gt; This script will install: /usr/local/bin/brew /usr/local/share/doc/homebrew /usr/local/share/man/man1/brew.1 /usr/local/share/zsh/site-functions/_brew /usr/local/etc/bash_completion.d/brew /usr/local/Homebrew ==&gt; The Xcode Command Line Tools will be installed. Press RETURN to continue or any other key to abort ==&gt; Searching online for the Command Line Tools ==&gt; /usr/bin/sudo /usr/bin/touch /tmp/.com.apple.dt.CommandLineTools.installondemand.in-progress Password: ==&gt; Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode-9.4 ==&gt; /usr/bin/sudo /usr/sbin/softwareupdate -i Command\ Line\ Tools\ (macOS\ High\ Sierra\ version\ 10.13)\ for\ Xcode-9.4 Software Update Tool Downloading Command Line Tools (macOS High Sierra version 10.13) for Xcode Downloaded Command Line Tools (macOS High Sierra version 10.13) for Xcode Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode Done with Command Line Tools (macOS High Sierra version 10.13) for Xcode Done. ==&gt; /usr/bin/sudo /bin/rm -f /tmp/.com.apple.dt.CommandLineTools.installondemand.in-progress Password: Sorry, try again. Password: ==&gt; /usr/bin/sudo /usr/bin/xcode-select --switch /Library/Developer/CommandLineTools ==&gt; Downloading and installing Homebrew... HEAD is now at 9777b278 Merge pull request #4810 from MikeMcQuaid/mojave-mmacosx-version-min ==&gt; Homebrew is run entirely by unpaid volunteers. Please consider donating: https://github.com/Homebrew/brew#donations ==&gt; Migrating /Library/Caches/Homebrew to /Users/mac/Library/Caches/Homebrew... ==&gt; Deleting /Library/Caches/Homebrew... Already up-to-date. ==&gt; Installation successful! ==&gt; Homebrew has enabled anonymous aggregate formulae and cask analytics. Read the analytics documentation (and how to opt-out) here: https://docs.brew.sh/Analytics.html ==&gt; Homebrew is run entirely by unpaid volunteers. Please consider donating: https://github.com/Homebrew/brew#donations ==&gt; Next steps: - Run `brew help` to get started - Further documentation: https://docs.brew.sh 2、install Go compiler brew install go macdeiMac:Downloads mac$ brew install go Updating Homebrew... ==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.11.high_sierra.bottle. ######################################################################## 100.0% ==&gt; Pouring go-1.11.high_sierra.bottle.tar.gz ==&gt; Caveats A valid GOPATH is required to use the `go get` command. If $GOPATH is not specified, $HOME/go will be used by default: https://golang.org/doc/code.html#GOPATH You may wish to add the GOROOT-based install location to your PATH: export PATH=$PATH:/usr/local/opt/go/libexec/bin ==&gt; Summary �� /usr/local/Cellar/go/1.11: 9,273 files, 403.9MB macdeiMac:Downloads mac$ 3、geth建立以太坊安装说明geth运行以太坊节点 下载Source code(tar.gz) macdeiMac:Downloads mac$ cd go-ethereum-1.5.9 macdeiMac:go-ethereum-1.5.9 mac$ pwd /Users/mac/Downloads/go-ethereum-1.5.9 macdeiMac:go-ethereum-1.5.9 mac$ make geth 4、Solidity以太坊智能合约语言 brew install solidity 三、建立私链 1. 创建一个文件夹来存储你的私链数据 macdeiMac:go-ethereum-1.5.9 mac$ cd /Users/mac/Desktop/GitHub/Solidity/learn macdeiMac:learn mac$ mkdir privatechain macdeiMac:learn mac$ pwd /Users/mac/Desktop/GitHub/Solidity/learn macdeiMac:learn mac$ ls BLC attributesMethod.sol method.sol Person.sol attributesaccess.sol method1.sol SmartContractDemo inherit.sol privatechain macdeiMac:learn mac$ 2. 使用geth来加载 geth --networkid 123 --dev --datadir data1 --rpc --rpcaddr 192.168.1.5 --rpcport 8989 --port 3000 各选项含义如下： –identity：指定节点 ID； –rpc：表示开启 HTTP-RPC 服务； –rpcaddr：HTTP-RPC 服务ip地址； –rpcport：指定 HTTP-RPC 服务监听端口号（默认为 8545）； –datadir：指定区块链数据的存储位置； –port：指定和其他节点连接所用的端口号（默认为 30303）； –nodiscover：关闭节点发现机制，防止加入有同样初始配置的陌生节点。 如果你切换到data1文件夹里面，你会看到geth, geth.ipc, 和 keystore。 保持节点的运行，不要关闭终端，重新打开一个终端，使用geth attach连接节点，并且打开geth console geth attach ipc:/Users/mac/Desktop/GitHub/Solidity/learn/privatechain/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.1-stable-05101641/darwin-amd64/go1.9.1 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 shh:1.0 txpool:1.0 web3:1.0 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 相关api命令 查看账户 &gt; personal.listAccounts [] &gt; 创建账户 &gt; personal.newAccount(&#39;wt&#39;) &quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot; &gt; PS：里面的wt是你账户的密码，输入你自己喜欢的密码。 查看账户 &gt; personal.listAccounts [&quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot;] &gt; web3命令 &gt; web3.eth.coinbase &quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot; &gt; 编写智能合约代码 pragma solidity ^0.4.4; contract test { function multiply(uint a) returns(uint d){ return a * 7; } } 获取智能合约字节码和abi 代码拷贝到https://remix.ethereum.org，编译，然后拷贝字节码和ABI。 字节码 6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029 ABI [ { &quot;constant&quot;: true, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;multiply&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;d&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;payable&quot;: false, &quot;type&quot;: &quot;function&quot;, &quot;stateMutability&quot;: &quot;view&quot; } ] 在bejson中转义成字符串 http://www.bejson.com [{\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;a\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;name\&quot;:\&quot;multiply\&quot;,\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;d\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;payable\&quot;:false,\&quot;type\&quot;:\&quot;function\&quot;,\&quot;stateMutability\&quot;:\&quot;view\&quot;}] 通过abi创建合约对象 &gt; var abi = JSON.parse(&#39;[{\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;a\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;name\&quot;:\&quot;multiply\&quot;,\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;d\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;}],\&quot;payable\&quot;:false,\&quot;type\&quot;:\&quot;function\&quot;,\&quot;stateMutability\&quot;:\&quot;view\&quot;}]&#39;) &gt; myContract = web3.eth.contract(abi) { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], eth: { accounts: [&quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot;], blockNumber: 384, coinbase: &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 0, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 检查coinbase账号余额 &gt; account1 = web3.eth.coinbase &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot; &gt; web3.eth.getBalance(account1) 0 &gt; 如果余额大于0，继续，否则，开始挖矿。 &gt; miner.start(); null &gt; 停止挖矿。 miner.stop(); 停止挖矿，并且查余额 &gt; miner.start(); null &gt; miner.stop(); true &gt; web3.eth.getBalance(account1) 1.152e+21 &gt; 解锁coinbase账号，我们通过coinbase账号来付费部署合约 wt: 换成你的密码。 &gt; personal.unlockAccount(account1, &#39;wt&#39;) true &gt; 预估手续费 &gt; bytecode = &quot;6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &quot;6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; web3.eth.estimateGas({data: bytecode}) Error: invalid argument 0: json: cannot unmarshal hex string without 0x prefix into Go struct field CallArgs.data of type hexutil.Bytes at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 &gt; bytecode = &quot;0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &quot;0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; web3.eth.estimateGas({data: bytecode}) 98391 &gt; 备注：字节码前面需要添加0x。手续费大概为98391gas。 部署合约，为了方便理解，设置一个回调函数 &gt; contractInstance = myContract.new({data: bytecode gas: 1000000, from: account1}, function(e, contract){ if(!e){ if(!contract.address){ console.log(&quot;Contract transaction send: Transaction Hash: &quot;+contract.transactionHash+&quot; waiting to be mined...&quot;); }else{ console.log(&quot;Contract mined! Address: &quot;+contract.address); console.log(contract); } }else{ console.log(e) } }) Contract transaction send: Transaction Hash: 0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d waiting to be mined... { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], address: undefined, transactionHash: &quot;0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d&quot; } &gt; 你的合约等待挖矿，开始挖矿，等一会儿，停止 &gt; miner.start() null &gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db [object Object] &gt; miner.stop() true &gt; 检查合约是否部署成功 &gt; eth.getCode(contractInstance.address) &quot;0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; 调用合约方法 &gt; contractInstance.multiply(6) 42 &gt; 阅读更多 登录后自动展开" />
<link rel="canonical" href="https://mlh.app/2018/09/05/e7c622c16fd8855c461c70a25b9997e2.html" />
<meta property="og:url" content="https://mlh.app/2018/09/05/e7c622c16fd8855c461c70a25b9997e2.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wtdask/article/details/82424476 In me the tiger sniffs the rose. 心有猛虎，细嗅蔷薇 一、为什么用到私有链？ 在以太坊的共有链上部署智能合约、发起交易需要花费以太币。而通过修改配置，可以在本机搭建一套以太坊私有链，因为与公有链没关系，既不用同步公有链庞大的数据，也不用花钱购买以太币，很好地满足了智能合约开发和测试的要求，开发好的智能合约也可以很容易地切换接口部署到以太坊公有链上。 二、开源工具和语言 1、brewMacOS包管理器 打开终端执行下面的命令 /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; macdeiMac:Downloads mac$ /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; ==&gt; This script will install: /usr/local/bin/brew /usr/local/share/doc/homebrew /usr/local/share/man/man1/brew.1 /usr/local/share/zsh/site-functions/_brew /usr/local/etc/bash_completion.d/brew /usr/local/Homebrew ==&gt; The Xcode Command Line Tools will be installed. Press RETURN to continue or any other key to abort ==&gt; Searching online for the Command Line Tools ==&gt; /usr/bin/sudo /usr/bin/touch /tmp/.com.apple.dt.CommandLineTools.installondemand.in-progress Password: ==&gt; Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode-9.4 ==&gt; /usr/bin/sudo /usr/sbin/softwareupdate -i Command\\ Line\\ Tools\\ (macOS\\ High\\ Sierra\\ version\\ 10.13)\\ for\\ Xcode-9.4 Software Update Tool Downloading Command Line Tools (macOS High Sierra version 10.13) for Xcode Downloaded Command Line Tools (macOS High Sierra version 10.13) for Xcode Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode Done with Command Line Tools (macOS High Sierra version 10.13) for Xcode Done. ==&gt; /usr/bin/sudo /bin/rm -f /tmp/.com.apple.dt.CommandLineTools.installondemand.in-progress Password: Sorry, try again. Password: ==&gt; /usr/bin/sudo /usr/bin/xcode-select --switch /Library/Developer/CommandLineTools ==&gt; Downloading and installing Homebrew... HEAD is now at 9777b278 Merge pull request #4810 from MikeMcQuaid/mojave-mmacosx-version-min ==&gt; Homebrew is run entirely by unpaid volunteers. Please consider donating: https://github.com/Homebrew/brew#donations ==&gt; Migrating /Library/Caches/Homebrew to /Users/mac/Library/Caches/Homebrew... ==&gt; Deleting /Library/Caches/Homebrew... Already up-to-date. ==&gt; Installation successful! ==&gt; Homebrew has enabled anonymous aggregate formulae and cask analytics. Read the analytics documentation (and how to opt-out) here: https://docs.brew.sh/Analytics.html ==&gt; Homebrew is run entirely by unpaid volunteers. Please consider donating: https://github.com/Homebrew/brew#donations ==&gt; Next steps: - Run `brew help` to get started - Further documentation: https://docs.brew.sh 2、install Go compiler brew install go macdeiMac:Downloads mac$ brew install go Updating Homebrew... ==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.11.high_sierra.bottle. ######################################################################## 100.0% ==&gt; Pouring go-1.11.high_sierra.bottle.tar.gz ==&gt; Caveats A valid GOPATH is required to use the `go get` command. If $GOPATH is not specified, $HOME/go will be used by default: https://golang.org/doc/code.html#GOPATH You may wish to add the GOROOT-based install location to your PATH: export PATH=$PATH:/usr/local/opt/go/libexec/bin ==&gt; Summary �� /usr/local/Cellar/go/1.11: 9,273 files, 403.9MB macdeiMac:Downloads mac$ 3、geth建立以太坊安装说明geth运行以太坊节点 下载Source code(tar.gz) macdeiMac:Downloads mac$ cd go-ethereum-1.5.9 macdeiMac:go-ethereum-1.5.9 mac$ pwd /Users/mac/Downloads/go-ethereum-1.5.9 macdeiMac:go-ethereum-1.5.9 mac$ make geth 4、Solidity以太坊智能合约语言 brew install solidity 三、建立私链 1. 创建一个文件夹来存储你的私链数据 macdeiMac:go-ethereum-1.5.9 mac$ cd /Users/mac/Desktop/GitHub/Solidity/learn macdeiMac:learn mac$ mkdir privatechain macdeiMac:learn mac$ pwd /Users/mac/Desktop/GitHub/Solidity/learn macdeiMac:learn mac$ ls BLC attributesMethod.sol method.sol Person.sol attributesaccess.sol method1.sol SmartContractDemo inherit.sol privatechain macdeiMac:learn mac$ 2. 使用geth来加载 geth --networkid 123 --dev --datadir data1 --rpc --rpcaddr 192.168.1.5 --rpcport 8989 --port 3000 各选项含义如下： –identity：指定节点 ID； –rpc：表示开启 HTTP-RPC 服务； –rpcaddr：HTTP-RPC 服务ip地址； –rpcport：指定 HTTP-RPC 服务监听端口号（默认为 8545）； –datadir：指定区块链数据的存储位置； –port：指定和其他节点连接所用的端口号（默认为 30303）； –nodiscover：关闭节点发现机制，防止加入有同样初始配置的陌生节点。 如果你切换到data1文件夹里面，你会看到geth, geth.ipc, 和 keystore。 保持节点的运行，不要关闭终端，重新打开一个终端，使用geth attach连接节点，并且打开geth console geth attach ipc:/Users/mac/Desktop/GitHub/Solidity/learn/privatechain/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.1-stable-05101641/darwin-amd64/go1.9.1 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 shh:1.0 txpool:1.0 web3:1.0 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 相关api命令 查看账户 &gt; personal.listAccounts [] &gt; 创建账户 &gt; personal.newAccount(&#39;wt&#39;) &quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot; &gt; PS：里面的wt是你账户的密码，输入你自己喜欢的密码。 查看账户 &gt; personal.listAccounts [&quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot;] &gt; web3命令 &gt; web3.eth.coinbase &quot;0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8&quot; &gt; 编写智能合约代码 pragma solidity ^0.4.4; contract test { function multiply(uint a) returns(uint d){ return a * 7; } } 获取智能合约字节码和abi 代码拷贝到https://remix.ethereum.org，编译，然后拷贝字节码和ABI。 字节码 6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029 ABI [ { &quot;constant&quot;: true, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;a&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;multiply&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;d&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;payable&quot;: false, &quot;type&quot;: &quot;function&quot;, &quot;stateMutability&quot;: &quot;view&quot; } ] 在bejson中转义成字符串 http://www.bejson.com [{\\&quot;constant\\&quot;:true,\\&quot;inputs\\&quot;:[{\\&quot;name\\&quot;:\\&quot;a\\&quot;,\\&quot;type\\&quot;:\\&quot;uint256\\&quot;}],\\&quot;name\\&quot;:\\&quot;multiply\\&quot;,\\&quot;outputs\\&quot;:[{\\&quot;name\\&quot;:\\&quot;d\\&quot;,\\&quot;type\\&quot;:\\&quot;uint256\\&quot;}],\\&quot;payable\\&quot;:false,\\&quot;type\\&quot;:\\&quot;function\\&quot;,\\&quot;stateMutability\\&quot;:\\&quot;view\\&quot;}] 通过abi创建合约对象 &gt; var abi = JSON.parse(&#39;[{\\&quot;constant\\&quot;:true,\\&quot;inputs\\&quot;:[{\\&quot;name\\&quot;:\\&quot;a\\&quot;,\\&quot;type\\&quot;:\\&quot;uint256\\&quot;}],\\&quot;name\\&quot;:\\&quot;multiply\\&quot;,\\&quot;outputs\\&quot;:[{\\&quot;name\\&quot;:\\&quot;d\\&quot;,\\&quot;type\\&quot;:\\&quot;uint256\\&quot;}],\\&quot;payable\\&quot;:false,\\&quot;type\\&quot;:\\&quot;function\\&quot;,\\&quot;stateMutability\\&quot;:\\&quot;view\\&quot;}]&#39;) &gt; myContract = web3.eth.contract(abi) { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], eth: { accounts: [&quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot;], blockNumber: 384, coinbase: &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 0, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 检查coinbase账号余额 &gt; account1 = web3.eth.coinbase &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot; &gt; web3.eth.getBalance(account1) 0 &gt; 如果余额大于0，继续，否则，开始挖矿。 &gt; miner.start(); null &gt; 停止挖矿。 miner.stop(); 停止挖矿，并且查余额 &gt; miner.start(); null &gt; miner.stop(); true &gt; web3.eth.getBalance(account1) 1.152e+21 &gt; 解锁coinbase账号，我们通过coinbase账号来付费部署合约 wt: 换成你的密码。 &gt; personal.unlockAccount(account1, &#39;wt&#39;) true &gt; 预估手续费 &gt; bytecode = &quot;6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &quot;6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; web3.eth.estimateGas({data: bytecode}) Error: invalid argument 0: json: cannot unmarshal hex string without 0x prefix into Go struct field CallArgs.data of type hexutil.Bytes at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 &gt; bytecode = &quot;0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &quot;0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; web3.eth.estimateGas({data: bytecode}) 98391 &gt; 备注：字节码前面需要添加0x。手续费大概为98391gas。 部署合约，为了方便理解，设置一个回调函数 &gt; contractInstance = myContract.new({data: bytecode gas: 1000000, from: account1}, function(e, contract){ if(!e){ if(!contract.address){ console.log(&quot;Contract transaction send: Transaction Hash: &quot;+contract.transactionHash+&quot; waiting to be mined...&quot;); }else{ console.log(&quot;Contract mined! Address: &quot;+contract.address); console.log(contract); } }else{ console.log(e) } }) Contract transaction send: Transaction Hash: 0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d waiting to be mined... { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], address: undefined, transactionHash: &quot;0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d&quot; } &gt; 你的合约等待挖矿，开始挖矿，等一会儿，停止 &gt; miner.start() null &gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db [object Object] &gt; miner.stop() true &gt; 检查合约是否部署成功 &gt; eth.getCode(contractInstance.address) &quot;0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; 调用合约方法 &gt; contractInstance.multiply(6) 42 &gt; 阅读更多 登录后自动展开","@type":"BlogPosting","url":"https://mlh.app/2018/09/05/e7c622c16fd8855c461c70a25b9997e2.html","headline":"区块链：以太坊私链搭建","dateModified":"2018-09-05T00:00:00+08:00","datePublished":"2018-09-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/09/05/e7c622c16fd8855c461c70a25b9997e2.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链：以太坊私链搭建</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/wtdask/article/details/82424476 
 </div> 
 <div class="markdown_views"> 
  <p><strong>In me the tiger sniffs the rose.</strong> <br> 心有猛虎，细嗅蔷薇</p> 
  <hr> 
  <h2 id="一为什么用到私有链">一、为什么用到私有链？</h2> 
  <p>在以太坊的共有链上部署智能合约、发起交易需要花费以太币。而通过修改配置，可以在本机搭建一套以太坊私有链，因为与公有链没关系，既不用同步公有链庞大的数据，也不用花钱购买以太币，很好地满足了智能合约开发和测试的要求，开发好的智能合约也可以很容易地切换接口部署到以太坊公有链上。</p> 
  <h2 id="二开源工具和语言">二、开源工具和语言</h2> 
  <h3 id="1brewmacos包管理器">1、brewMacOS包管理器</h3> 
  <p>打开终端执行下面的命令</p> 
  <pre class="prettyprint"><code class=" hljs bash">/usr/bin/ruby <span class="hljs-operator">-e</span> <span class="hljs-string">"<span class="hljs-variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></code></pre> 
  <pre class="prettyprint"><code class=" hljs haml">macdeiMac:Downloads mac$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
=<span class="ruby">=&gt; <span class="hljs-constant">This</span> script will <span class="hljs-symbol">install:</span> </span><span class="hljs-comment">/usr/local/bin/brew</span>
<span class="hljs-comment">/usr/local/share/doc/homebrew</span>
<span class="hljs-comment">/usr/local/share/man/man1/brew.1</span>
<span class="hljs-comment">/usr/local/share/zsh/site-functions/_brew</span>
<span class="hljs-comment">/usr/local/etc/bash_completion.d/brew</span>
<span class="hljs-comment">/usr/local/Homebrew</span>
=<span class="ruby">=&gt; <span class="hljs-constant">The</span> <span class="hljs-constant">Xcode</span> <span class="hljs-constant">Command</span> <span class="hljs-constant">Line</span> <span class="hljs-constant">Tools</span> will be installed. </span>
Press RETURN to continue or any other key to abort
=<span class="ruby">=&gt; <span class="hljs-constant">Searching</span> online <span class="hljs-keyword">for</span> the <span class="hljs-constant">Command</span> <span class="hljs-constant">Line</span> <span class="hljs-constant">Tools</span> </span>=<span class="ruby">=&gt; <span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/sudo /usr</span><span class="hljs-regexp">/bin/touch</span> /tmp/.com.apple.dt.<span class="hljs-constant">CommandLineTools</span>.installondemand.<span class="hljs-keyword">in</span>-progress </span>Password:
=<span class="ruby">=&gt; <span class="hljs-constant">Installing</span> <span class="hljs-constant">Command</span> <span class="hljs-constant">Line</span> <span class="hljs-constant">Tools</span> (macOS <span class="hljs-constant">High</span> <span class="hljs-constant">Sierra</span> version <span class="hljs-number">10.13</span>) <span class="hljs-keyword">for</span> <span class="hljs-constant">Xcode</span>-<span class="hljs-number">9.4</span> </span>=<span class="ruby">=&gt; <span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/sudo /usr</span><span class="hljs-regexp">/sbin/softwareupdate</span> -i <span class="hljs-constant">Command</span>\ <span class="hljs-constant">Line</span>\ <span class="hljs-constant">Tools</span>\ (macOS\ <span class="hljs-constant">High</span>\ <span class="hljs-constant">Sierra</span>\ version\ <span class="hljs-number">10.13</span>)\ <span class="hljs-keyword">for</span>\ <span class="hljs-constant">Xcode</span>-<span class="hljs-number">9.4</span> </span>Software Update Tool


Downloading Command Line Tools (macOS High Sierra version 10.13) for Xcode

Downloaded Command Line Tools (macOS High Sierra version 10.13) for Xcode
Installing Command Line Tools (macOS High Sierra version 10.13) for Xcode
Done with Command Line Tools (macOS High Sierra version 10.13) for Xcode
Done.
=<span class="ruby">=&gt; <span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/sudo /bin</span><span class="hljs-regexp">/rm -f /tmp</span><span class="hljs-regexp">/.com.apple.dt.CommandLineTools.installondemand.in-progress </span></span>Password:
Sorry, try again.
Password:
=<span class="ruby">=&gt; <span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/sudo /usr</span><span class="hljs-regexp">/bin/xcode</span>-select --switch /<span class="hljs-constant">Library</span>/<span class="hljs-constant">Developer</span>/<span class="hljs-constant">CommandLineTools</span> </span>=<span class="ruby">=&gt; <span class="hljs-constant">Downloading</span> <span class="hljs-keyword">and</span> installing <span class="hljs-constant">Homebrew</span>... </span>HEAD is now at 9777b278 Merge pull request #4810 from MikeMcQuaid/mojave-mmacosx-version-min
=<span class="ruby">=&gt; <span class="hljs-constant">Homebrew</span> is run entirely by unpaid volunteers. <span class="hljs-constant">Please</span> consider <span class="hljs-symbol">donating:</span> </span>  https://github.com/Homebrew/brew#donations
=<span class="ruby">=&gt; <span class="hljs-constant">Migrating</span> /<span class="hljs-constant">Library</span>/<span class="hljs-constant">Caches</span>/<span class="hljs-constant">Homebrew</span> to /<span class="hljs-constant">Users</span>/mac/<span class="hljs-constant">Library</span>/<span class="hljs-constant">Caches</span>/<span class="hljs-constant">Homebrew</span>... </span>=<span class="ruby">=&gt; <span class="hljs-constant">Deleting</span> /<span class="hljs-constant">Library</span>/<span class="hljs-constant">Caches</span>/<span class="hljs-constant">Homebrew</span>... </span>Already up-to-date.
=<span class="ruby">=&gt; <span class="hljs-constant">Installation</span> successful! </span>
=<span class="ruby">=&gt; <span class="hljs-constant">Homebrew</span> has enabled anonymous aggregate formulae <span class="hljs-keyword">and</span> cask analytics. </span>Read the analytics documentation (and how to opt-out) here:
  https://docs.brew.sh/Analytics.html

=<span class="ruby">=&gt; <span class="hljs-constant">Homebrew</span> is run entirely by unpaid volunteers. <span class="hljs-constant">Please</span> consider <span class="hljs-symbol">donating:</span> </span>  https://github.com/Homebrew/brew#donations
=<span class="ruby">=&gt; <span class="hljs-constant">Next</span> <span class="hljs-symbol">steps:</span> </span>-<span class="ruby"> <span class="hljs-constant">Run</span> `brew help` to get started </span>-<span class="ruby"> <span class="hljs-constant">Further</span> <span class="hljs-symbol">documentation:</span> </span>    https://docs.brew.sh</code></pre> 
  <h3 id="2install-go-compiler">2、install Go compiler</h3> 
  <pre class="prettyprint"><code class=" hljs cmake">brew <span class="hljs-keyword">install</span> go</code></pre> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-attribute">macdeiMac</span>:Downloads mac$ brew install go
Updating Homebrew...
=<span class="hljs-function">=&gt;</span> Downloading <span class="hljs-attribute">https</span>:<span class="hljs-regexp">//</span>homebrew.bintray.com/bottles/go-<span class="hljs-number">1.11</span>.high_sierra.bottle.
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span> <span class="hljs-number">100.0</span>%
=<span class="hljs-function">=&gt;</span> Pouring go-<span class="hljs-number">1.11</span>.high_sierra.bottle.tar.<span class="hljs-function"><span class="hljs-title">gz</span> ==&gt;</span> Caveats
A valid GOPATH <span class="hljs-keyword">is</span> required to use the `<span class="javascript">go get</span>` command.
If $GOPATH <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> specified, $HOME/go will be used <span class="hljs-keyword">by</span> <span class="hljs-attribute">default</span>:
  <span class="hljs-attribute">https</span>:<span class="hljs-regexp">//g</span>olang.org/doc/code.html<span class="hljs-comment">#GOPATH</span>

You may wish to add the GOROOT-based install location to your <span class="hljs-attribute">PATH</span>:
  <span class="hljs-reserved">export</span> PATH=<span class="hljs-attribute">$PATH</span>:/usr/local/opt/go/libexec/<span class="hljs-function"><span class="hljs-title">bin</span> ==&gt;</span> Summary
��  /usr/local/Cellar/go/<span class="hljs-number">1.11</span>: <span class="hljs-number">9</span>,<span class="hljs-number">273</span> files, <span class="hljs-number">403.9</span>MB
<span class="hljs-attribute">macdeiMac</span>:Downloads mac$ 
</code></pre> 
  <h3 id="3geth建立以太坊安装说明geth运行以太坊节点">3、<a href="https://github.com/ethereum/go-ethereum/wiki/Building-Ethereum" rel="nofollow">geth建立以太坊安装说明</a>geth运行以太坊节点</h3> 
  <p><a href="https://github.com/ethereum/go-ethereum/archive/v1.5.9.tar.gz" rel="nofollow">下载Source code(tar.gz) <br> </a></p> 
  <pre class="prettyprint"><code class=" hljs go">macdeiMac:Downloads mac$ cd <span class="hljs-keyword">go</span>-ethereum<span class="hljs-number">-1.5</span><span class="hljs-number">.9</span>
macdeiMac:<span class="hljs-keyword">go</span>-ethereum<span class="hljs-number">-1.5</span><span class="hljs-number">.9</span> mac$ pwd
/Users/mac/Downloads/<span class="hljs-keyword">go</span>-ethereum<span class="hljs-number">-1.5</span><span class="hljs-number">.9</span>
macdeiMac:<span class="hljs-keyword">go</span>-ethereum<span class="hljs-number">-1.5</span><span class="hljs-number">.9</span> mac$ <span class="hljs-built_in">make</span> geth</code></pre> 
  <h3 id="4solidity以太坊智能合约语言">4、<a href="https://solidity-cn.readthedocs.io/zh/develop/" rel="nofollow">Solidity</a>以太坊智能合约语言</h3> 
  <pre class="prettyprint"><code class=" hljs cmake">brew <span class="hljs-keyword">install</span> solidity</code></pre> 
  <h2 id="三建立私链">三、建立私链</h2> 
  <h3 id="1-创建一个文件夹来存储你的私链数据">1. 创建一个文件夹来存储你的私链数据</h3> 
  <pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-label">macdeiMac:</span>go-ethereum-<span class="hljs-number">1.5</span><span class="hljs-number">.9</span> mac$ cd /Users/mac/Desktop/GitHub/Solidity/learn 
<span class="hljs-label">macdeiMac:</span>learn mac$ mkdir privatechain
<span class="hljs-label">macdeiMac:</span>learn mac$ pwd
/Users/mac/Desktop/GitHub/Solidity/learn
<span class="hljs-label">macdeiMac:</span>learn mac$ ls
BLC         attributesMethod<span class="hljs-preprocessor">.sol</span>    method<span class="hljs-preprocessor">.sol</span>
Person<span class="hljs-preprocessor">.sol</span>      attributesaccess<span class="hljs-preprocessor">.sol</span>    method1<span class="hljs-preprocessor">.sol</span>
SmartContractDemo   inherit<span class="hljs-preprocessor">.sol</span>     privatechain
<span class="hljs-label">macdeiMac:</span>learn mac$ </code></pre> 
  <h3 id="2-使用geth来加载">2. 使用<code>geth</code>来加载</h3> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">networkid</span> <span class="hljs-comment">123</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">dev</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-comment">data1</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpc</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcaddr</span> <span class="hljs-comment">192</span><span class="hljs-string">.</span><span class="hljs-comment">168</span><span class="hljs-string">.</span><span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">5</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcport</span> <span class="hljs-comment">8989</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">port</span> <span class="hljs-comment">3000</span></code></pre> 
  <p>各选项含义如下：</p> 
  <p>–<code>identity</code>：指定节点 ID； <br> –<code>rpc</code>：表示开启 HTTP-RPC 服务； <br> –<code>rpcaddr</code>：HTTP-RPC 服务ip地址； <br> –<code>rpcport</code>：指定 HTTP-RPC 服务监听端口号（默认为 8545）； <br> –<code>datadir</code>：指定区块链数据的存储位置； <br> –<code>port</code>：指定和其他节点连接所用的端口号（默认为 30303）； <br> –<code>nodiscover</code>：关闭节点发现机制，防止加入有同样初始配置的陌生节点。 <br> 如果你切换到<code>data1</code>文件夹里面，你会看到<code>geth</code>, <code>geth.ipc</code>, 和 <code>keystore</code>。</p> 
  <ul> 
   <li>保持节点的运行，不要关闭终端，重新打开一个终端，使用geth attach连接节点，并且打开geth console</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs lasso">geth attach ipc:/Users/mac/Desktop/GitHub/Solidity/learn/privatechain/geth<span class="hljs-built_in">.</span>ipc 
Welcome <span class="hljs-keyword">to</span> the Geth JavaScript console<span class="hljs-subst">!</span>
instance: Geth/v1<span class="hljs-number">.7</span><span class="hljs-number">.1</span><span class="hljs-attribute">-stable</span><span class="hljs-subst">-</span><span class="hljs-number">05101641</span>/darwin<span class="hljs-attribute">-amd64</span>/go1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>
 modules: admin:<span class="hljs-number">1.0</span> debug:<span class="hljs-number">1.0</span> eth:<span class="hljs-number">1.0</span> miner:<span class="hljs-number">1.0</span> net:<span class="hljs-number">1.0</span> personal:<span class="hljs-number">1.0</span> rpc:<span class="hljs-number">1.0</span> shh:<span class="hljs-number">1.0</span> txpool:<span class="hljs-number">1.0</span> web3:<span class="hljs-number">1.0</span></code></pre> 
  <p>这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括：</p> 
  <p><code>eth</code>：包含一些跟操作区块链相关的方法； <br> <code>net</code>：包含一些查看p2p网络状态的方法； <br> <code>admin</code>：包含一些与管理节点相关的方法； <br> <code>miner</code>：包含启动&amp;停止挖矿的一些方法； <br> <code>personal</code>：主要包含一些管理账户的方法； <br> <code>txpool</code>：包含一些查看交易内存池的方法； <br> <code>web3</code>：包含了以上对象，还包含一些单位换算的方法。</p> 
  <ul> 
   <li>相关api命令</li> 
  </ul> 
  <p><strong>查看账户</strong></p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; personal.listAccounts</span>
[]
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <p><strong>创建账户</strong></p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; personal.newAccount(<span class="hljs-string">'wt'</span>) 
<span class="hljs-string">"0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8"</span>
&gt; </code></pre> 
  <p>PS：里面的wt是你账户的密码，输入你自己喜欢的密码。</p> 
  <p><strong>查看账户</strong></p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; personal.listAccounts </span>
["0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8"]
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <ul> 
   <li>web3命令</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.coinbase</span> 
<span class="hljs-string">"0xb6d7d842e7dc9016fa6900a183b2be26fc90b2d8"</span>
&gt; </code></pre> 
  <ul> 
   <li>编写智能合约代码</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.4</span>;

contract test { 

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span><span class="hljs-params">(uint a)</span> <span class="hljs-title">returns</span><span class="hljs-params">(uint d)</span>{</span>

        <span class="hljs-keyword">return</span> a * <span class="hljs-number">7</span>;
    }

}</code></pre> 
  <ul> 
   <li>获取智能合约字节码和abi <br> 代码拷贝到<a href="https://remix.ethereum.org" rel="nofollow">https://remix.ethereum.org</a>，编译，然后拷贝字节码和ABI。</li> 
   <li>字节码</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-number">6060604052341561000f</span>57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029</code></pre> 
  <ul> 
   <li>ABI</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs json">[
  {
    "<span class="hljs-attribute">constant</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
    "<span class="hljs-attribute">inputs</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"a"</span></span>, "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"uint256"</span> </span>} ]</span>,
    "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"multiply"</span></span>,
    "<span class="hljs-attribute">outputs</span>": <span class="hljs-value">[ { "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"d"</span></span>, "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"uint256"</span> </span>} ]</span>,
    "<span class="hljs-attribute">payable</span>": <span class="hljs-value"><span class="hljs-literal">false</span></span>,
    "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"function"</span></span>,
    "<span class="hljs-attribute">stateMutability</span>": <span class="hljs-value"><span class="hljs-string">"view"</span> </span>}
]</code></pre> 
  <ul> 
   <li>在bejson中转义成字符串</li> 
  </ul> 
  <p><a href="http://www.bejson.com" rel="nofollow">http://www.bejson.com</a></p> 
  <pre class="prettyprint"><code class=" hljs tex"><span class="hljs-special">[</span><span class="hljs-special">{</span><span class="hljs-command">\"</span>constant<span class="hljs-command">\"</span>:true,<span class="hljs-command">\"</span>inputs<span class="hljs-command">\"</span>:<span class="hljs-special">[</span><span class="hljs-special">{</span><span class="hljs-command">\"</span>name<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>a<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>type<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>uint256<span class="hljs-command">\"</span><span class="hljs-special">}</span><span class="hljs-special">]</span>,<span class="hljs-command">\"</span>name<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>multiply<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>outputs<span class="hljs-command">\"</span>:<span class="hljs-special">[</span><span class="hljs-special">{</span><span class="hljs-command">\"</span>name<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>d<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>type<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>uint256<span class="hljs-command">\"</span><span class="hljs-special">}</span><span class="hljs-special">]</span>,<span class="hljs-command">\"</span>payable<span class="hljs-command">\"</span>:false,<span class="hljs-command">\"</span>type<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>function<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>stateMutability<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>view<span class="hljs-command">\"</span><span class="hljs-special">}</span><span class="hljs-special">]</span></code></pre> 
  <ul> 
   <li>通过abi创建合约对象</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs lua">&gt; var abi = JSON.parse(<span class="hljs-string">'[{\"constant\":true,\"inputs\":[{\"name\":\"a\",\"type\":\"uint256\"}],\"name\":\"multiply\",\"outputs\":[{\"name\":\"d\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\",\"stateMutability\":\"view\"}]'</span>)
&gt; myContract = web3.eth.contract(abi)
{
  abi: [{
      constant: <span class="hljs-keyword">false</span>,
      inputs: [{...}],
      name: <span class="hljs-string">"multiply"</span>,
      outputs: [{...}],
      payable: <span class="hljs-keyword">false</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">"function"</span>
  }],
  eth: {
    accounts: [<span class="hljs-string">"0x2abf46d8b0d940cdeedd55872bc0648add40227d"</span>],
    blockNumber: <span class="hljs-number">384</span>,
    coinbase: <span class="hljs-string">"0x2abf46d8b0d940cdeedd55872bc0648add40227d"</span>,
    compile: {
      lll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
      serpent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
      solidity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    },
    defaultAccount: undefined,
    defaultBlock: <span class="hljs-string">"latest"</span>,
    gasPrice: <span class="hljs-number">0</span>,
    hashrate: <span class="hljs-number">0</span>,
    mining: <span class="hljs-keyword">false</span>,
    pendingTransactions: [],
    protocolVersion: <span class="hljs-string">"0x3f"</span>,
    syncing: <span class="hljs-keyword">false</span>,
    call: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    contract: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(abi)</span></span>,
    estimateGas: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    filter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fil, callback)</span></span>,
    getAccounts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getBalance: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlockNumber: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getBlockTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlockUncleCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getCode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getCoinbase: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getCompilers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getGasPrice: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getHashrate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getMining: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getPendingTransactions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getProtocolVersion: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getRawTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getStorageAt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionReceipt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getUncle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    iban: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iban)</span></span>,
    icapNamereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    isSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    namereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    resend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendIBANTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sign: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    signTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    submitTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    submitWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
  },
  at: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(address, callback)</span></span>,
  getData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
  new: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
}</code></pre> 
  <ul> 
   <li>检查coinbase账号余额</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; account1 = web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0x2abf46d8b0d940cdeedd55872bc0648add40227d"</span>
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.getBalance</span>(account1)
<span class="hljs-number">0</span>
&gt; </code></pre> 
  <p>如果余额大于0，继续，否则，开始挖矿。</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start();</span>
null
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <ul> 
   <li>停止挖矿。</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs vbnet">miner.<span class="hljs-keyword">stop</span>();</code></pre> 
  <ul> 
   <li>停止挖矿，并且查余额</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start();</span>
null
<span class="hljs-blockquote">&gt; miner.stop();</span>
true
<span class="hljs-blockquote">&gt; web3.eth.getBalance(account1)</span>
1.152e+21
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <ul> 
   <li>解锁coinbase账号，我们通过coinbase账号来付费部署合约</li> 
  </ul> 
  <p><code>wt</code>: 换成你的密码。</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; personal.unlockAccount(account1, <span class="hljs-string">'wt'</span>) 
<span class="hljs-literal">true</span>
&gt; </code></pre> 
  <ul> 
   <li>预估手续费</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; bytecode = <span class="hljs-string">"6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029"</span>
<span class="hljs-string">"6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029"</span>
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.estimateGas</span>({data: bytecode})
<span class="hljs-label">Error:</span> invalid argument <span class="hljs-number">0</span>: json: cannot unmarshal hex string without <span class="hljs-number">0</span><span class="hljs-built_in">x</span> prefix into Go struct field CallArgs<span class="hljs-preprocessor">.data</span> of type hexutil<span class="hljs-preprocessor">.Bytes</span>
    at web3<span class="hljs-preprocessor">.js</span>:<span class="hljs-number">3104</span>:<span class="hljs-number">20</span>
    at web3<span class="hljs-preprocessor">.js</span>:<span class="hljs-number">6191</span>:<span class="hljs-number">15</span>
    at web3<span class="hljs-preprocessor">.js</span>:<span class="hljs-number">5004</span>:<span class="hljs-number">36</span>
    at &lt;anonymous&gt;:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>

&gt; bytecode = <span class="hljs-string">"0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029"</span>
<span class="hljs-string">"0x6060604052341561000f57600080fd5b5b60ab8061001e6000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029"</span>
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.estimateGas</span>({data: bytecode})
<span class="hljs-number">98391</span>
&gt; </code></pre> 
  <p>备注：字节码前面需要添加<code>0x</code>。手续费大概为<code>98391gas</code>。</p> 
  <ul> 
   <li>部署合约，为了方便理解，设置一个回调函数</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs r">&gt; contractInstance = myContract.new({data: bytecode gas: <span class="hljs-number">1000000</span>, from: account1}, <span class="hljs-keyword">function</span>(e, contract){
  <span class="hljs-keyword">if</span>(!e){
    <span class="hljs-keyword">if</span>(!contract.address){
      console.log(<span class="hljs-string">"Contract transaction send: Transaction Hash: "</span>+contract.transactionHash+<span class="hljs-string">" waiting to be mined..."</span>);
    }<span class="hljs-keyword">else</span>{
      console.log(<span class="hljs-string">"Contract mined! Address: "</span>+contract.address);
      console.log(contract);
    }
  }<span class="hljs-keyword">else</span>{
    console.log(e)
  }
})
Contract transaction send: Transaction Hash: <span class="hljs-number">0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d</span> waiting to be mined...
{
  abi: [{
      constant: false,
      inputs: [{<span class="hljs-keyword">...</span>}],
      name: <span class="hljs-string">"multiply"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }],
  address: undefined,
  transactionHash: <span class="hljs-string">"0x5e2aebbf400d71a32e807dc3f11f1053b6ee3b2a81435ed8ace2fa54eebb9f3d"</span>
}
&gt; </code></pre> 
  <ul> 
   <li>你的合约等待挖矿，开始挖矿，等一会儿，停止</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start()</span>
null
<span class="hljs-blockquote">&gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db</span>
[object Object]
<span class="hljs-blockquote">&gt; miner.stop()</span>
true
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <ul> 
   <li>检查合约是否部署成功</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getCode</span>(contractInstance<span class="hljs-preprocessor">.address</span>)
<span class="hljs-string">"0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029"</span>
&gt; </code></pre> 
  <ul> 
   <li>调用合约方法</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; contractInstance.multiply(6)</span>
42
<span class="hljs-blockquote">&gt; </span></code></pre> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wtdask/article/details/82424476,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wtdask/article/details/82424476,&quot;}">阅读更多</a> 
 <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wtdask/article/details/82424476,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_557&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wtdask/article/details/82424476,&quot;}">登录后自动展开</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

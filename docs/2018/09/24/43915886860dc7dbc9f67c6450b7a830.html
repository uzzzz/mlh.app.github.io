<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>【数据】【自动化交易】Python获取中国股市行情和指数 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="【数据】【自动化交易】Python获取中国股市行情和指数" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanss2/article/details/82826832 【数据】【自动化交易】Python获取中国股市行情和指数 一般来说获取股市行情和指数都是需要付费的，并且这些数据你根本无法导出，比如早年看我妈他们炒股用的大富翁等软件。不过现在可以用诸如腾讯、新浪财经等的网页数据，不过顶多是1s级的，不过免费。所以思路就是使用爬虫扒取。 爬虫也不需要你自己写，这里介绍几种易用的数据lib: Tushare: 内核并非爬虫，好像是C++写的，文档比较老了。印象最深的是它有电影票房数据模块。 easyquotation: 要求 V P y t h o n ≥ 3.5 V_{Python} \ge 3.5 VPython​≥3.5。单只股票数据感觉比Tushare全，小巧易用。 pyalgotrade-cn: 可以和Tushare数据配合回测的lib。 easyquotation 前言 获取新浪的免费实时行情 获取腾讯财经的免费实时行情 获取集思路的分级基金数据 开发环境 : Ubuntu 16.04 / Python 3.5 requirements Python 3.5+ pip install -r requirements.txt 安装 pip install easyquotation 升级 pip install easyquotation --upgrade 用法 引入: import easyquotation 选择行情 quotation = easyquotation.use(&#39;sina&#39;) # 新浪 [&#39;sina&#39;] 腾讯 [&#39;tencent&#39;, &#39;qq&#39;] 获取所有股票行情 quotation.market_snapshot(prefix=True) # prefix 参数指定返回的行情字典中的股票代码 key 是否带 sz/sh 前缀 return {&#39;sh000159&#39;: {&#39;name&#39;: &#39;国际实业&#39;, # 股票名 &#39;buy&#39;: 8.87, # 竞买价 &#39;sell&#39;: 8.88, # 竞卖价 &#39;now&#39;: 8.88, # 现价 &#39;open&#39;: 8.99, # 开盘价 &#39;close&#39;: 8.96, # 昨日收盘价 &#39;high&#39;: 9.15, # 今日最高价 &#39;low&#39;: 8.83, # 今日最低价 &#39;turnover&#39;: 22545048, # 交易股数 &#39;volume&#39;: 202704887.74， # 交易金额 &#39;ask1&#39;: 8.88, # 卖一价 &#39;ask1_volume&#39;: 111900, # 卖一量 &#39;ask2&#39;: 8.89, &#39;ask2_volume&#39;: 54700, &#39;bid1&#39;: 8.87, # 买一价 &#39;bid1_volume&#39;: 21800, # 买一量 ... &#39;bid2&#39;: 8.86, &#39;bid2_volume&#39;: 78400, &#39;date&#39;: &#39;2016-02-19&#39;, &#39;time&#39;: &#39;14:30:00&#39;, ...}, ...... } 单只股票 quotation.real(&#39;162411&#39;) # 支持直接指定前缀，如 &#39;sh000001&#39; 多只股票 quotation.stocks([&#39;000001&#39;, &#39;162411&#39;]) 同时获取指数和行情 quotation.stocks([&#39;sh000001&#39;, &#39;sz000001&#39;], prefix=True) 更新股票代码 easyquotation.update_stock_codes() 选择 jsl 行情 quotation = easyquotation.use(&#39;jsl&#39;) # [&#39;jsl&#39;] 获取分级基金信息 quotation.funda() # 参数可选择利率、折价率、交易量、有无下折、是否永续来过滤 quotation.fundb() # 参数如上 对应的分级 A 数据 return { 150020: {&#39;abrate&#39;: &#39;5:5&#39;, &#39;calc_info&#39;: None, &#39;coupon_descr&#39;: &#39;+3.0%&#39;, &#39;coupon_descr_s&#39;: &#39;+3.0%&#39;, &#39;fund_descr&#39;: &#39;每年第一个工作日定折，无下折，A不参与上折，净值&lt;1元无定折&#39;, &#39;funda_amount&#39;: 178823, &#39;funda_amount_increase&#39;: &#39;0&#39;, &#39;funda_amount_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_base_est_dis_rt&#39;: &#39;2.27%&#39;, &#39;funda_base_est_dis_rt_t1&#39;: &#39;2.27%&#39;, &#39;funda_base_est_dis_rt_t2&#39;: &#39;-0.34%&#39;, &#39;funda_base_est_dis_rt_tip&#39;: &#39;&#39;, &#39;funda_base_fund_id&#39;: &#39;163109&#39;, &#39;funda_coupon&#39;: &#39;5.75&#39;, &#39;funda_coupon_next&#39;: &#39;4.75&#39;, &#39;funda_current_price&#39;: &#39;0.783&#39;, &#39;funda_discount_rt&#39;: &#39;24.75%&#39;, &#39;funda_id&#39;: &#39;150022&#39;, &#39;funda_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_index_id&#39;: &#39;399001&#39;, &#39;funda_index_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_index_name&#39;: &#39;深证成指&#39;, &#39;funda_left_year&#39;: &#39;永续&#39;, &#39;funda_lower_recalc_rt&#39;: &#39;1.82%&#39;, &#39;funda_name&#39;: &#39;深成指A&#39;, &#39;funda_nav_dt&#39;: &#39;2015-09-14&#39;, &#39;funda_profit_rt&#39;: &#39;7.74%&#39;, &#39;funda_profit_rt_next&#39;: &#39;6.424%&#39;, &#39;funda_value&#39;: &#39;1.0405&#39;, &#39;funda_volume&#39;: &#39;0.00&#39;, &#39;fundb_upper_recalc_rt&#39;: &#39;244.35%&#39;, &#39;fundb_upper_recalc_rt_info&#39;: &#39;深成指A不参与上折&#39;, &#39;last_time&#39;: &#39;09:18:22&#39;, &#39;left_recalc_year&#39;: &#39;0.30411&#39;, &#39;lower_recalc_profit_rt&#39;: &#39;-&#39;, &#39;next_recalc_dt&#39;: &#39;&lt;span style=&quot;font-style:italic&quot;&gt;2016-01-04&lt;/span&gt;&#39;, &#39;owned&#39;: 0, &#39;status_cd&#39;: &#39;N&#39;}&gt;&#39;}} 分级基金套利接口 quotation.fundarb(jsl_username, jsl_password, avolume=100, bvolume=100, ptype=&#39;price&#39;) jsl_username: 集思录用户名 jsl_password: 集思路登录密码 avolume: A成交额，单位百万 bvolume: B成交额，单位百万 ptype: 溢价计算方式，price=现价，buy=买一，sell=卖一 return { &quot;165511&quot;:{ &#39;base_fund_id&#39;: &#39;165511&#39;, # 母基金代码 &#39;AB_price&#39;: &#39;现价A/B : 1.008/1.329&#39;, &#39;a_profit_rt_next&#39;: &#39;4.705&#39;, &#39;a_ratio&#39;: 4, &#39;abrate&#39;: &#39;4:6&#39;, &#39;apply_fee&#39;: &#39;0&#39;, &#39;apply_fee_tip&#39;: &#39;0&#39;, &#39;apply_sell&#39;: &#39;-0.59&#39;, &#39;asset_ratio&#39;: &#39;95%&#39;, &#39;asset_ratio_last&#39;: &#39;99%&#39;, &#39;asset_ratio_num&#39;: &#39;95.00&#39;, &#39;b_est_val&#39;: &#39;1.340&#39;, &#39;b_gangan&#39;: &#39;1.502&#39;, &#39;b_ratio&#39;: 6, &#39;base_est_dis_rt&#39;: &#39;-0.56%&#39;, &#39;base_est_val&#39;: &#39;1.2073&#39;, &#39;base_fund_nm&#39;: &#39;信诚500&#39;, &#39;base_lower_recalc_rt&#39;: &#39;54.15%&#39;, &#39;base_nav&#39;: &#39;1.1970&#39;, &#39;base_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;buy1A&#39;: &#39;1.007&#39;, &#39;buy1B&#39;: &#39;1.329&#39;, &#39;buy1_amountA&#39;: &#39;0.201&#39;, &#39;buy1_amountB&#39;: &#39;7.123&#39;, &#39;buy_redeem&#39;: &#39;-0.51&#39;, &#39;calc_info&#39;: None, &#39;coupon&#39;: &#39;0.00%&#39;, &#39;coupon_next&#39;: &#39;4.700&#39;, &#39;est_dis_rt&#39;: &#39;-0.55%&#39;, &#39;est_time&#39;: &#39;2016-04-14 15:10:05&#39;, &#39;fundA_amount&#39;: &#39;6667&#39;, &#39;fundA_amount_increase&#39;: &#39;-51&#39;, &#39;fundA_amount_increase_rt&#39;: &#39;-0.76%&#39;, &#39;fundA_amount_tip&#39;: &#39;2016-04-14 A类总份额6667.000万份，份额增长-0.76%&#39;, &#39;fundA_id&#39;: &#39;150028&#39;, &#39;fundA_last_dt&#39;: &#39;2016-04-14&#39;, &#39;fundA_last_time&#39;: &#39;14:57:02&#39;, &#39;fundA_nav&#39;: &#39;1.0090&#39;, &#39;fundA_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;fundA_nm&#39;: &#39;中证500A&#39;, &#39;fundA_stock_volume&#39;: &#39;28.2446&#39;, &#39;fundA_stock_volume_tip&#39;: &#39;A类总份额6667.000万份, 成交28万份&#39;, &#39;fundA_turnover_rt&#39;: &#39;0.42%&#39;, &#39;fundA_volume&#39;: &#39;28.46&#39;, &#39;fundB_amount&#39;: 10000.5, &#39;fundB_amount_increase&#39;: &#39;-76&#39;, &#39;fundB_amount_tip&#39;: &#39;2016-04-14 B类总份额10000万份，份额增长-0.76%&#39;, &#39;fundB_id&#39;: &#39;150029&#39;, &#39;fundB_last_dt&#39;: &#39;2016-04-14&#39;, &#39;fundB_last_time&#39;: &#39;15:00:27&#39;, &#39;fundB_nav&#39;: &#39;1.3220&#39;, &#39;fundB_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;fundB_nm&#39;: &#39;中证500B&#39;, &#39;fundB_stock_volume&#39;: &#39;255.5280&#39;, &#39;fundB_stock_volume_tip&#39;: &#39;B类总份额10000万份, 成交256万份&#39;, &#39;fundB_turnover_rt&#39;: &#39;2.56%&#39;, &#39;fundB_volume&#39;: &#39;337.24&#39;, &#39;fund_company_nm&#39;: &#39;信诚基金&#39;, &#39;funda_name_tip&#39;: &#39;下期利率：4.70，修正收益率：4.71%&#39;, &#39;idx_incr_rt&#39;: &#39;0.91%&#39;, &#39;increase_rtA&#39;: &#39;-0.10%&#39;, &#39;increase_rtB&#39;: &#39;1.06%&#39;, &#39;index_id&#39;: &#39;399905&#39;, &#39;index_nm&#39;: &#39;中证 500&#39;, &#39;is_est_val&#39;: 1, &#39;is_last_nav&#39;: 1, &#39;lower_recalc_rt&#39;: &#39;54.15&#39;, &#39;maturity_dt&#39;: &#39;-&#39;, &#39;merge_price&#39;: &#39;1.2006&#39;, &#39;min_apply_amount&#39;: None, &#39;notes&#39;: &#39;http://www.xcfunds.com/funds_2012/165511/fundinfor.shtml\r\n&#39;, &#39;ownedA&#39;: 0, &#39;ownedM&#39;: 1, &#39;priceA&#39;: &#39;1.008&#39;, &#39;priceB&#39;: &#39;1.329&#39;, &#39;real_idx_increase_rt&#39;: &#39;0.91&#39;, &#39;recalc_to&#39;: None, &#39;redeem_fee&#39;: &#39;0.5%&#39;, &#39;redeem_fee_tip&#39;: &#39;0.5%&#39;, &#39;sell1A&#39;: &#39;1.008&#39;, &#39;sell1B&#39;: &#39;1.330&#39;, &#39;sell1_amountA&#39;: &#39;7.132&#39;, &#39;sell1_amountB&#39;: &#39;16.820&#39;, &#39;status_cd&#39;: &#39;N&#39; } } 指数ETF查询接口 TIP : 尚未包含黄金ETF和货币ETF 集思录ETF源网页 quotation.etfindex(index_id=&quot;&quot;, min_volume=0, max_discount=None, min_discount=None) return { &quot;510050&quot;: { &quot;fund_id&quot;: &quot;510050&quot;, # 代码 &quot;fund_nm&quot;: &quot;50ETF&quot;, # 名称 &quot;price&quot;: &quot;2.066&quot;, # 现价 &quot;increase_rt&quot;: &quot;0.34%&quot;, # 涨幅 &quot;volume&quot;: &quot;71290.96&quot;, # 成交额(万元) &quot;index_nm&quot;: &quot;上证50&quot;, # 指数 &quot;pe&quot;: &quot;9.038&quot;, # 指数PE &quot;pb&quot;: &quot;1.151&quot;, # 指数PB &quot;index_increase_rt&quot;: &quot;0.45%&quot;, # 指数涨幅 &quot;estimate_value&quot;: &quot;2.0733&quot;, # 估值 &quot;fund_nav&quot;: &quot;2.0730&quot;, # 净值 &quot;nav_dt&quot;: &quot;2016-03-11&quot;, # 净值日期 &quot;discount_rt&quot;: &quot;-0.34%&quot;, # 溢价率 &quot;creation_unit&quot;: &quot;90&quot;, # 最小申赎单位(万份) &quot;amount&quot;: &quot;1315800&quot;, # 份额 &quot;unit_total&quot;: &quot;271.84&quot;, # 规模(亿元) &quot;index_id&quot;: &quot;000016&quot;, # 指数代码 &quot;last_time&quot;: &quot;15:00:00&quot;, # 价格最后时间(未确定) &quot;last_est_time&quot;: &quot;23:50:02&quot;, # 估值最后时间(未确定) } } 分数图 腾讯分时图地址 quotation = easyquotation.use(&quot;timekline&quot;) data = quotation.real([&#39;603828&#39;], prefix=True) return { &#39;sh603828&#39;: { &#39;date&#39;: &#39;170721&#39;, #日期 &#39;time_data&#39;: { &#39;201707210930&#39;: [&#39;0930&#39;, &#39;19.42&#39;, &#39;61&#39;], # [时间, 当前价, 上一分钟到这一分钟之间的成交数量] &#39;201707210931&#39;: [&#39;0931&#39;, &#39;19.42&#39;,&#39;122&#39;], &#39;201707210932&#39;: [&#39;0932&#39;, &#39;19.43&#39;, &#39;123&#39;], &#39;201707210933&#39;: [&#39;0933&#39;, &#39;19.48&#39;, &#39;125&#39;], &#39;201707210934&#39;: [&#39;0934&#39;, &#39;19.49&#39;, &#39;133&#39;], &#39;201707210935&#39;: [&#39;0935&#39;, &#39;19.48&#39;, &#39;161&#39;], ... } } 港股日k线图 腾讯日k线图 import easyquotation quotation = easyquotation.use(&quot;daykline&quot;) data = quotation.real([&#39;00001&#39;,&#39;00700&#39;]) print(data) return { &#39;00001&#39;: [ [&#39;2017-10-09&#39;, &#39;352.00&#39;, &#39;349.00&#39;, &#39;353.00&#39;, &#39;348.60&#39;, &#39;13455864.00&#39;], # [日期, 今开, 今收, 最高, 最低, 成交量 ] [&#39;2017-10-10&#39;, &#39;350.80&#39;, &#39;351.20&#39;, &#39;352.60&#39;, &#39;349.80&#39;, &#39;10088970.00&#39;], ] &#39;00700&#39;:[ ] } } 腾讯港股时时行情 腾讯控股时时行情 import easyquotation quotation = easyquotation.use(&quot;hkquote&quot;) data = quotation.real([&#39;00001&#39;,&#39;00700&#39;]) print(data) { &#39;00001&#39;: { &#39;stock_code&#39;: &#39;00001&#39;, # 股票代码 &#39;lotSize&#39;: &#39;&quot;100&#39;, # 每手数量 &#39;name&#39;: &#39;长和&#39;, # 股票名称 &#39;price&#39;: &#39;97.20&#39;, # 股票当前价格 &#39;lastPrice&#39;: &#39;97.75&#39;, # 股票昨天收盘价格 &#39;openPrice&#39;: &#39;97.75&#39;, # 股票今天开盘价格 &#39;amount&#39;: &#39;1641463.0&#39;, # 股票成交量 &#39;time&#39;: &#39;2017/11/29 15:38:58&#39;, # 当前时间 &#39;high&#39;: &#39;98.05&#39;, # 当天最高价格 &#39;low&#39;: &#39;97.15&#39; # 当天最低价格 }, &#39;00700&#39;: { &#39;stock_code&#39;: &#39;00700&#39;, &#39;lotSize&#39;: &#39;&quot;100&#39;, &#39;name&#39;: &#39;腾讯控股&#39;, &#39;price&#39;: &#39;413.20&#39;, &#39;lastPrice&#39;: &#39;419.20&#39;, &#39;openPrice&#39;: &#39;422.20&#39;, &#39;amount&#39;: &#39;21351010.0&#39;, &#39;time&#39;: &#39;2017/11/29 15:39:01&#39;, &#39;high&#39;: &#39;422.80&#39;, &#39;low&#39;: &#39;412.40&#39; } } 开发指南 初始化环境 进入项目目录后运行 make init Tushare TuShare是实现对股票/期货等金融数据从数据采集、清洗加工 到 数据存储过程的工具，满足金融量化分析师和学习数据分析的人在数据获取方面的需求，它的特点是数据覆盖范围广，接口调用简单,响应快速。 Dependencies python 2.x/3.x pandas Installation 方式1：pip install tushare 方式2：python setup.py install 方式3：访问https://pypi.python.org/pypi/tushare/下载安装 Upgrade pip install tushare --upgrade Quick Start Example 1. 获取个股历史交易数据（包括均线数据）： import tushare as ts ts.get_hist_data(&#39;600848&#39;) #一次性获取全部数据 结果显示： 日期 ，开盘价， 最高价， 收盘价， 最低价， 成交量， 价格变动 ，涨跌幅，5日均价，10日均价，20日均价，5日均量，10日均量，20日均量，换手率 open high close low volume p_change ma5 \ date 2012-01-11 6.880 7.380 7.060 6.880 14129.96 2.62 7.060 2012-01-12 7.050 7.100 6.980 6.900 7895.19 -1.13 7.020 2012-01-13 6.950 7.000 6.700 6.690 6611.87 -4.01 6.913 2012-01-16 6.680 6.750 6.510 6.480 2941.63 -2.84 6.813 2012-01-17 6.660 6.880 6.860 6.460 8642.57 5.38 6.822 2012-01-18 7.000 7.300 6.890 6.880 13075.40 0.44 6.788 2012-01-19 6.690 6.950 6.890 6.680 6117.32 0.00 6.770 2012-01-20 6.870 7.080 7.010 6.870 6813.09 1.74 6.832 ma10 ma20 v_ma5 v_ma10 v_ma20 turnover date 2012-01-11 7.060 7.060 14129.96 14129.96 14129.96 0.48 2012-01-12 7.020 7.020 11012.58 11012.58 11012.58 0.27 2012-01-13 6.913 6.913 9545.67 9545.67 9545.67 0.23 2012-01-16 6.813 6.813 7894.66 7894.66 7894.66 0.10 2012-01-17 6.822 6.822 8044.24 8044.24 8044.24 0.30 2012-01-18 6.833 6.833 7833.33 8882.77 8882.77 0.45 2012-01-19 6.841 6.841 7477.76 8487.71 8487.71 0.21 2012-01-20 6.863 6.863 7518.00 8278.38 8278.38 0.23 设定历史数据的时间： ts.get_hist_data(&#39;600848&#39;,start=&#39;2015-01-05&#39;,end=&#39;2015-01-09&#39;) open high close low volume p_change ma5 ma10 \ date 2015-01-05 11.160 11.390 11.260 10.890 46383.57 1.26 11.156 11.212 2015-01-06 11.130 11.660 11.610 11.030 59199.93 3.11 11.182 11.155 2015-01-07 11.580 11.990 11.920 11.480 86681.38 2.67 11.366 11.251 2015-01-08 11.700 11.920 11.670 11.640 56845.71 -2.10 11.516 11.349 2015-01-09 11.680 11.710 11.230 11.190 44851.56 -3.77 11.538 11.363 ma20 v_ma5 v_ma10 v_ma20 turnover date 2015-01-05 11.198 58648.75 68429.87 97141.81 1.59 2015-01-06 11.382 54854.38 63401.05 98686.98 2.03 2015-01-07 11.543 55049.74 61628.07 103010.58 2.97 2015-01-08 11.647 57268.99 61376.00 105823.50 1.95 2015-01-09 11.682 58792.43 60665.93 107924.27 1.54 复权历史数据 获取历史复权数据，分为前复权和后复权数据，接口提供股票上市以来所有历史数据，默认为前复权。如果不设定开始和结束日期，则返回近一年的复权数据，从性能上考虑，推荐设定开始日期和结束日期，而且最好不要超过一年以上，获取到数据后，请及时在本地存储。 ts.get_h_data(&#39;002337&#39;) #前复权 ts.get_h_data(&#39;002337&#39;,autype=&#39;hfq&#39;) #后复权 ts.get_h_data(&#39;002337&#39;,autype=None) #不复权 ts.get_h_data(&#39;002337&#39;,start=&#39;2015-01-01&#39;,end=&#39;2015-03-16&#39;) #两个日期之间的前复权数据 Example 2. 一次性获取最近一个日交易日所有股票的交易数据（结果显示速度取决于网速） ts.get_today_all() 结果显示： 代码，名称，涨跌幅，现价，开盘价，最高价，最低价，最日收盘价，成交量，换手率 code name changepercent trade open high low settlement \ 0 002738 中矿资源 10.023 19.32 19.32 19.32 19.32 17.56 1 300410 正业科技 10.022 25.03 25.03 25.03 25.03 22.75 2 002736 国信证券 10.013 16.37 16.37 16.37 16.37 14.88 3 300412 迦南科技 10.010 31.54 31.54 31.54 31.54 28.67 4 300411 金盾股份 10.007 29.68 29.68 29.68 29.68 26.98 5 603636 南威软件 10.006 38.15 38.15 38.15 38.15 34.68 6 002664 信质电机 10.004 30.68 29.00 30.68 28.30 27.89 7 300367 东方网力 10.004 86.76 78.00 86.76 77.87 78.87 8 601299 中国北车 10.000 11.44 11.44 11.44 11.29 10.40 9 601880 大连港 10.000 5.72 5.34 5.72 5.22 5.20 10 000856 冀东装备 10.000 8.91 8.18 8.91 8.18 8.10 volume turnoverratio 0 375100 1.25033 1 85800 0.57200 2 1058925 0.08824 3 69400 0.51791 4 252220 1.26110 5 1374630 5.49852 6 6448748 9.32700 7 2025030 6.88669 8 433453523 4.28056 9 323469835 9.61735 10 25768152 19.51090 Example 3. 获取历史分笔数据 import tushare as ts df = ts.get_tick_data(&#39;600848&#39;,date=&#39;2014-01-09&#39;) df.head(10) 结果显示： 成交时间、成交价格、价格变动，成交手、成交金额(元)，买卖类型 Out[3]: time price change volume amount type 0 15:00:00 6.05 -- 8 4840 卖盘 1 14:59:55 6.05 -- 50 30250 卖盘 2 14:59:35 6.05 -- 20 12100 卖盘 3 14:59:30 6.05 -0.01 165 99825 卖盘 4 14:59:20 6.06 0.01 4 2424 买盘 5 14:59:05 6.05 -0.01 2 1210 卖盘 6 14:58:55 6.06 -- 4 2424 买盘 7 14:58:45 6.06 -- 2 1212 买盘 8 14:58:35 6.06 0.01 2 1212 买盘 9 14:58:25 6.05 -0.01 20 12100 卖盘 10 14:58:05 6.06 -- 5 3030 买盘 Example 4. 获取实时交易数据(Realtime Quotes Data) df = ts.get_realtime_quotes(&#39;000581&#39;) #Single stock symbol df[[&#39;code&#39;,&#39;name&#39;,&#39;price&#39;,&#39;bid&#39;,&#39;ask&#39;,&#39;volume&#39;,&#39;amount&#39;,&#39;time&#39;]] 结果显示： 名称、开盘价、昨价、现价、最高、最低、买入价、卖出价、成交量、成交金额…more in docs code name price bid ask volume amount time 0 000581 威孚高科 31.15 31.14 31.15 8183020 253494991.16 11:30:36 请求多个股票方法（一次最好不要超过30个）： ts.get_realtime_quotes([&#39;600848&#39;,&#39;000980&#39;,&#39;000981&#39;]) #symbols from a list ts.get_realtime_quotes(df[&#39;code&#39;].tail(10)) #from a Series pyalgotrade-cn 这部分参考了这个博客。 策略可视化 在pyalgotrade中，已经为我们提供了很好用的可视化模块了，plotter。所以，一开始我们先导入模块。 from pyalgotrade import plotter 把策略的净值图、买卖开仓情况绘制出来其实很简单，把我们的策略实例化之后，传给plotter就可以了。 myStrategy = MyStrategy(feed, &quot;fd&quot;)# 策略实例化 plt = plotter.StrategyPlotter(myStrategy) # 传入策略 myStrategy.run()# 运行策略 myStrategy.info(&quot;Final portfolio value: $%.2f&quot; % myStrategy.getResult()) plt.plot()# 绘制 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanss2/article/details/82826832 【数据】【自动化交易】Python获取中国股市行情和指数 一般来说获取股市行情和指数都是需要付费的，并且这些数据你根本无法导出，比如早年看我妈他们炒股用的大富翁等软件。不过现在可以用诸如腾讯、新浪财经等的网页数据，不过顶多是1s级的，不过免费。所以思路就是使用爬虫扒取。 爬虫也不需要你自己写，这里介绍几种易用的数据lib: Tushare: 内核并非爬虫，好像是C++写的，文档比较老了。印象最深的是它有电影票房数据模块。 easyquotation: 要求 V P y t h o n ≥ 3.5 V_{Python} \ge 3.5 VPython​≥3.5。单只股票数据感觉比Tushare全，小巧易用。 pyalgotrade-cn: 可以和Tushare数据配合回测的lib。 easyquotation 前言 获取新浪的免费实时行情 获取腾讯财经的免费实时行情 获取集思路的分级基金数据 开发环境 : Ubuntu 16.04 / Python 3.5 requirements Python 3.5+ pip install -r requirements.txt 安装 pip install easyquotation 升级 pip install easyquotation --upgrade 用法 引入: import easyquotation 选择行情 quotation = easyquotation.use(&#39;sina&#39;) # 新浪 [&#39;sina&#39;] 腾讯 [&#39;tencent&#39;, &#39;qq&#39;] 获取所有股票行情 quotation.market_snapshot(prefix=True) # prefix 参数指定返回的行情字典中的股票代码 key 是否带 sz/sh 前缀 return {&#39;sh000159&#39;: {&#39;name&#39;: &#39;国际实业&#39;, # 股票名 &#39;buy&#39;: 8.87, # 竞买价 &#39;sell&#39;: 8.88, # 竞卖价 &#39;now&#39;: 8.88, # 现价 &#39;open&#39;: 8.99, # 开盘价 &#39;close&#39;: 8.96, # 昨日收盘价 &#39;high&#39;: 9.15, # 今日最高价 &#39;low&#39;: 8.83, # 今日最低价 &#39;turnover&#39;: 22545048, # 交易股数 &#39;volume&#39;: 202704887.74， # 交易金额 &#39;ask1&#39;: 8.88, # 卖一价 &#39;ask1_volume&#39;: 111900, # 卖一量 &#39;ask2&#39;: 8.89, &#39;ask2_volume&#39;: 54700, &#39;bid1&#39;: 8.87, # 买一价 &#39;bid1_volume&#39;: 21800, # 买一量 ... &#39;bid2&#39;: 8.86, &#39;bid2_volume&#39;: 78400, &#39;date&#39;: &#39;2016-02-19&#39;, &#39;time&#39;: &#39;14:30:00&#39;, ...}, ...... } 单只股票 quotation.real(&#39;162411&#39;) # 支持直接指定前缀，如 &#39;sh000001&#39; 多只股票 quotation.stocks([&#39;000001&#39;, &#39;162411&#39;]) 同时获取指数和行情 quotation.stocks([&#39;sh000001&#39;, &#39;sz000001&#39;], prefix=True) 更新股票代码 easyquotation.update_stock_codes() 选择 jsl 行情 quotation = easyquotation.use(&#39;jsl&#39;) # [&#39;jsl&#39;] 获取分级基金信息 quotation.funda() # 参数可选择利率、折价率、交易量、有无下折、是否永续来过滤 quotation.fundb() # 参数如上 对应的分级 A 数据 return { 150020: {&#39;abrate&#39;: &#39;5:5&#39;, &#39;calc_info&#39;: None, &#39;coupon_descr&#39;: &#39;+3.0%&#39;, &#39;coupon_descr_s&#39;: &#39;+3.0%&#39;, &#39;fund_descr&#39;: &#39;每年第一个工作日定折，无下折，A不参与上折，净值&lt;1元无定折&#39;, &#39;funda_amount&#39;: 178823, &#39;funda_amount_increase&#39;: &#39;0&#39;, &#39;funda_amount_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_base_est_dis_rt&#39;: &#39;2.27%&#39;, &#39;funda_base_est_dis_rt_t1&#39;: &#39;2.27%&#39;, &#39;funda_base_est_dis_rt_t2&#39;: &#39;-0.34%&#39;, &#39;funda_base_est_dis_rt_tip&#39;: &#39;&#39;, &#39;funda_base_fund_id&#39;: &#39;163109&#39;, &#39;funda_coupon&#39;: &#39;5.75&#39;, &#39;funda_coupon_next&#39;: &#39;4.75&#39;, &#39;funda_current_price&#39;: &#39;0.783&#39;, &#39;funda_discount_rt&#39;: &#39;24.75%&#39;, &#39;funda_id&#39;: &#39;150022&#39;, &#39;funda_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_index_id&#39;: &#39;399001&#39;, &#39;funda_index_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_index_name&#39;: &#39;深证成指&#39;, &#39;funda_left_year&#39;: &#39;永续&#39;, &#39;funda_lower_recalc_rt&#39;: &#39;1.82%&#39;, &#39;funda_name&#39;: &#39;深成指A&#39;, &#39;funda_nav_dt&#39;: &#39;2015-09-14&#39;, &#39;funda_profit_rt&#39;: &#39;7.74%&#39;, &#39;funda_profit_rt_next&#39;: &#39;6.424%&#39;, &#39;funda_value&#39;: &#39;1.0405&#39;, &#39;funda_volume&#39;: &#39;0.00&#39;, &#39;fundb_upper_recalc_rt&#39;: &#39;244.35%&#39;, &#39;fundb_upper_recalc_rt_info&#39;: &#39;深成指A不参与上折&#39;, &#39;last_time&#39;: &#39;09:18:22&#39;, &#39;left_recalc_year&#39;: &#39;0.30411&#39;, &#39;lower_recalc_profit_rt&#39;: &#39;-&#39;, &#39;next_recalc_dt&#39;: &#39;&lt;span style=&quot;font-style:italic&quot;&gt;2016-01-04&lt;/span&gt;&#39;, &#39;owned&#39;: 0, &#39;status_cd&#39;: &#39;N&#39;}&gt;&#39;}} 分级基金套利接口 quotation.fundarb(jsl_username, jsl_password, avolume=100, bvolume=100, ptype=&#39;price&#39;) jsl_username: 集思录用户名 jsl_password: 集思路登录密码 avolume: A成交额，单位百万 bvolume: B成交额，单位百万 ptype: 溢价计算方式，price=现价，buy=买一，sell=卖一 return { &quot;165511&quot;:{ &#39;base_fund_id&#39;: &#39;165511&#39;, # 母基金代码 &#39;AB_price&#39;: &#39;现价A/B : 1.008/1.329&#39;, &#39;a_profit_rt_next&#39;: &#39;4.705&#39;, &#39;a_ratio&#39;: 4, &#39;abrate&#39;: &#39;4:6&#39;, &#39;apply_fee&#39;: &#39;0&#39;, &#39;apply_fee_tip&#39;: &#39;0&#39;, &#39;apply_sell&#39;: &#39;-0.59&#39;, &#39;asset_ratio&#39;: &#39;95%&#39;, &#39;asset_ratio_last&#39;: &#39;99%&#39;, &#39;asset_ratio_num&#39;: &#39;95.00&#39;, &#39;b_est_val&#39;: &#39;1.340&#39;, &#39;b_gangan&#39;: &#39;1.502&#39;, &#39;b_ratio&#39;: 6, &#39;base_est_dis_rt&#39;: &#39;-0.56%&#39;, &#39;base_est_val&#39;: &#39;1.2073&#39;, &#39;base_fund_nm&#39;: &#39;信诚500&#39;, &#39;base_lower_recalc_rt&#39;: &#39;54.15%&#39;, &#39;base_nav&#39;: &#39;1.1970&#39;, &#39;base_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;buy1A&#39;: &#39;1.007&#39;, &#39;buy1B&#39;: &#39;1.329&#39;, &#39;buy1_amountA&#39;: &#39;0.201&#39;, &#39;buy1_amountB&#39;: &#39;7.123&#39;, &#39;buy_redeem&#39;: &#39;-0.51&#39;, &#39;calc_info&#39;: None, &#39;coupon&#39;: &#39;0.00%&#39;, &#39;coupon_next&#39;: &#39;4.700&#39;, &#39;est_dis_rt&#39;: &#39;-0.55%&#39;, &#39;est_time&#39;: &#39;2016-04-14 15:10:05&#39;, &#39;fundA_amount&#39;: &#39;6667&#39;, &#39;fundA_amount_increase&#39;: &#39;-51&#39;, &#39;fundA_amount_increase_rt&#39;: &#39;-0.76%&#39;, &#39;fundA_amount_tip&#39;: &#39;2016-04-14 A类总份额6667.000万份，份额增长-0.76%&#39;, &#39;fundA_id&#39;: &#39;150028&#39;, &#39;fundA_last_dt&#39;: &#39;2016-04-14&#39;, &#39;fundA_last_time&#39;: &#39;14:57:02&#39;, &#39;fundA_nav&#39;: &#39;1.0090&#39;, &#39;fundA_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;fundA_nm&#39;: &#39;中证500A&#39;, &#39;fundA_stock_volume&#39;: &#39;28.2446&#39;, &#39;fundA_stock_volume_tip&#39;: &#39;A类总份额6667.000万份, 成交28万份&#39;, &#39;fundA_turnover_rt&#39;: &#39;0.42%&#39;, &#39;fundA_volume&#39;: &#39;28.46&#39;, &#39;fundB_amount&#39;: 10000.5, &#39;fundB_amount_increase&#39;: &#39;-76&#39;, &#39;fundB_amount_tip&#39;: &#39;2016-04-14 B类总份额10000万份，份额增长-0.76%&#39;, &#39;fundB_id&#39;: &#39;150029&#39;, &#39;fundB_last_dt&#39;: &#39;2016-04-14&#39;, &#39;fundB_last_time&#39;: &#39;15:00:27&#39;, &#39;fundB_nav&#39;: &#39;1.3220&#39;, &#39;fundB_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;fundB_nm&#39;: &#39;中证500B&#39;, &#39;fundB_stock_volume&#39;: &#39;255.5280&#39;, &#39;fundB_stock_volume_tip&#39;: &#39;B类总份额10000万份, 成交256万份&#39;, &#39;fundB_turnover_rt&#39;: &#39;2.56%&#39;, &#39;fundB_volume&#39;: &#39;337.24&#39;, &#39;fund_company_nm&#39;: &#39;信诚基金&#39;, &#39;funda_name_tip&#39;: &#39;下期利率：4.70，修正收益率：4.71%&#39;, &#39;idx_incr_rt&#39;: &#39;0.91%&#39;, &#39;increase_rtA&#39;: &#39;-0.10%&#39;, &#39;increase_rtB&#39;: &#39;1.06%&#39;, &#39;index_id&#39;: &#39;399905&#39;, &#39;index_nm&#39;: &#39;中证 500&#39;, &#39;is_est_val&#39;: 1, &#39;is_last_nav&#39;: 1, &#39;lower_recalc_rt&#39;: &#39;54.15&#39;, &#39;maturity_dt&#39;: &#39;-&#39;, &#39;merge_price&#39;: &#39;1.2006&#39;, &#39;min_apply_amount&#39;: None, &#39;notes&#39;: &#39;http://www.xcfunds.com/funds_2012/165511/fundinfor.shtml\r\n&#39;, &#39;ownedA&#39;: 0, &#39;ownedM&#39;: 1, &#39;priceA&#39;: &#39;1.008&#39;, &#39;priceB&#39;: &#39;1.329&#39;, &#39;real_idx_increase_rt&#39;: &#39;0.91&#39;, &#39;recalc_to&#39;: None, &#39;redeem_fee&#39;: &#39;0.5%&#39;, &#39;redeem_fee_tip&#39;: &#39;0.5%&#39;, &#39;sell1A&#39;: &#39;1.008&#39;, &#39;sell1B&#39;: &#39;1.330&#39;, &#39;sell1_amountA&#39;: &#39;7.132&#39;, &#39;sell1_amountB&#39;: &#39;16.820&#39;, &#39;status_cd&#39;: &#39;N&#39; } } 指数ETF查询接口 TIP : 尚未包含黄金ETF和货币ETF 集思录ETF源网页 quotation.etfindex(index_id=&quot;&quot;, min_volume=0, max_discount=None, min_discount=None) return { &quot;510050&quot;: { &quot;fund_id&quot;: &quot;510050&quot;, # 代码 &quot;fund_nm&quot;: &quot;50ETF&quot;, # 名称 &quot;price&quot;: &quot;2.066&quot;, # 现价 &quot;increase_rt&quot;: &quot;0.34%&quot;, # 涨幅 &quot;volume&quot;: &quot;71290.96&quot;, # 成交额(万元) &quot;index_nm&quot;: &quot;上证50&quot;, # 指数 &quot;pe&quot;: &quot;9.038&quot;, # 指数PE &quot;pb&quot;: &quot;1.151&quot;, # 指数PB &quot;index_increase_rt&quot;: &quot;0.45%&quot;, # 指数涨幅 &quot;estimate_value&quot;: &quot;2.0733&quot;, # 估值 &quot;fund_nav&quot;: &quot;2.0730&quot;, # 净值 &quot;nav_dt&quot;: &quot;2016-03-11&quot;, # 净值日期 &quot;discount_rt&quot;: &quot;-0.34%&quot;, # 溢价率 &quot;creation_unit&quot;: &quot;90&quot;, # 最小申赎单位(万份) &quot;amount&quot;: &quot;1315800&quot;, # 份额 &quot;unit_total&quot;: &quot;271.84&quot;, # 规模(亿元) &quot;index_id&quot;: &quot;000016&quot;, # 指数代码 &quot;last_time&quot;: &quot;15:00:00&quot;, # 价格最后时间(未确定) &quot;last_est_time&quot;: &quot;23:50:02&quot;, # 估值最后时间(未确定) } } 分数图 腾讯分时图地址 quotation = easyquotation.use(&quot;timekline&quot;) data = quotation.real([&#39;603828&#39;], prefix=True) return { &#39;sh603828&#39;: { &#39;date&#39;: &#39;170721&#39;, #日期 &#39;time_data&#39;: { &#39;201707210930&#39;: [&#39;0930&#39;, &#39;19.42&#39;, &#39;61&#39;], # [时间, 当前价, 上一分钟到这一分钟之间的成交数量] &#39;201707210931&#39;: [&#39;0931&#39;, &#39;19.42&#39;,&#39;122&#39;], &#39;201707210932&#39;: [&#39;0932&#39;, &#39;19.43&#39;, &#39;123&#39;], &#39;201707210933&#39;: [&#39;0933&#39;, &#39;19.48&#39;, &#39;125&#39;], &#39;201707210934&#39;: [&#39;0934&#39;, &#39;19.49&#39;, &#39;133&#39;], &#39;201707210935&#39;: [&#39;0935&#39;, &#39;19.48&#39;, &#39;161&#39;], ... } } 港股日k线图 腾讯日k线图 import easyquotation quotation = easyquotation.use(&quot;daykline&quot;) data = quotation.real([&#39;00001&#39;,&#39;00700&#39;]) print(data) return { &#39;00001&#39;: [ [&#39;2017-10-09&#39;, &#39;352.00&#39;, &#39;349.00&#39;, &#39;353.00&#39;, &#39;348.60&#39;, &#39;13455864.00&#39;], # [日期, 今开, 今收, 最高, 最低, 成交量 ] [&#39;2017-10-10&#39;, &#39;350.80&#39;, &#39;351.20&#39;, &#39;352.60&#39;, &#39;349.80&#39;, &#39;10088970.00&#39;], ] &#39;00700&#39;:[ ] } } 腾讯港股时时行情 腾讯控股时时行情 import easyquotation quotation = easyquotation.use(&quot;hkquote&quot;) data = quotation.real([&#39;00001&#39;,&#39;00700&#39;]) print(data) { &#39;00001&#39;: { &#39;stock_code&#39;: &#39;00001&#39;, # 股票代码 &#39;lotSize&#39;: &#39;&quot;100&#39;, # 每手数量 &#39;name&#39;: &#39;长和&#39;, # 股票名称 &#39;price&#39;: &#39;97.20&#39;, # 股票当前价格 &#39;lastPrice&#39;: &#39;97.75&#39;, # 股票昨天收盘价格 &#39;openPrice&#39;: &#39;97.75&#39;, # 股票今天开盘价格 &#39;amount&#39;: &#39;1641463.0&#39;, # 股票成交量 &#39;time&#39;: &#39;2017/11/29 15:38:58&#39;, # 当前时间 &#39;high&#39;: &#39;98.05&#39;, # 当天最高价格 &#39;low&#39;: &#39;97.15&#39; # 当天最低价格 }, &#39;00700&#39;: { &#39;stock_code&#39;: &#39;00700&#39;, &#39;lotSize&#39;: &#39;&quot;100&#39;, &#39;name&#39;: &#39;腾讯控股&#39;, &#39;price&#39;: &#39;413.20&#39;, &#39;lastPrice&#39;: &#39;419.20&#39;, &#39;openPrice&#39;: &#39;422.20&#39;, &#39;amount&#39;: &#39;21351010.0&#39;, &#39;time&#39;: &#39;2017/11/29 15:39:01&#39;, &#39;high&#39;: &#39;422.80&#39;, &#39;low&#39;: &#39;412.40&#39; } } 开发指南 初始化环境 进入项目目录后运行 make init Tushare TuShare是实现对股票/期货等金融数据从数据采集、清洗加工 到 数据存储过程的工具，满足金融量化分析师和学习数据分析的人在数据获取方面的需求，它的特点是数据覆盖范围广，接口调用简单,响应快速。 Dependencies python 2.x/3.x pandas Installation 方式1：pip install tushare 方式2：python setup.py install 方式3：访问https://pypi.python.org/pypi/tushare/下载安装 Upgrade pip install tushare --upgrade Quick Start Example 1. 获取个股历史交易数据（包括均线数据）： import tushare as ts ts.get_hist_data(&#39;600848&#39;) #一次性获取全部数据 结果显示： 日期 ，开盘价， 最高价， 收盘价， 最低价， 成交量， 价格变动 ，涨跌幅，5日均价，10日均价，20日均价，5日均量，10日均量，20日均量，换手率 open high close low volume p_change ma5 \ date 2012-01-11 6.880 7.380 7.060 6.880 14129.96 2.62 7.060 2012-01-12 7.050 7.100 6.980 6.900 7895.19 -1.13 7.020 2012-01-13 6.950 7.000 6.700 6.690 6611.87 -4.01 6.913 2012-01-16 6.680 6.750 6.510 6.480 2941.63 -2.84 6.813 2012-01-17 6.660 6.880 6.860 6.460 8642.57 5.38 6.822 2012-01-18 7.000 7.300 6.890 6.880 13075.40 0.44 6.788 2012-01-19 6.690 6.950 6.890 6.680 6117.32 0.00 6.770 2012-01-20 6.870 7.080 7.010 6.870 6813.09 1.74 6.832 ma10 ma20 v_ma5 v_ma10 v_ma20 turnover date 2012-01-11 7.060 7.060 14129.96 14129.96 14129.96 0.48 2012-01-12 7.020 7.020 11012.58 11012.58 11012.58 0.27 2012-01-13 6.913 6.913 9545.67 9545.67 9545.67 0.23 2012-01-16 6.813 6.813 7894.66 7894.66 7894.66 0.10 2012-01-17 6.822 6.822 8044.24 8044.24 8044.24 0.30 2012-01-18 6.833 6.833 7833.33 8882.77 8882.77 0.45 2012-01-19 6.841 6.841 7477.76 8487.71 8487.71 0.21 2012-01-20 6.863 6.863 7518.00 8278.38 8278.38 0.23 设定历史数据的时间： ts.get_hist_data(&#39;600848&#39;,start=&#39;2015-01-05&#39;,end=&#39;2015-01-09&#39;) open high close low volume p_change ma5 ma10 \ date 2015-01-05 11.160 11.390 11.260 10.890 46383.57 1.26 11.156 11.212 2015-01-06 11.130 11.660 11.610 11.030 59199.93 3.11 11.182 11.155 2015-01-07 11.580 11.990 11.920 11.480 86681.38 2.67 11.366 11.251 2015-01-08 11.700 11.920 11.670 11.640 56845.71 -2.10 11.516 11.349 2015-01-09 11.680 11.710 11.230 11.190 44851.56 -3.77 11.538 11.363 ma20 v_ma5 v_ma10 v_ma20 turnover date 2015-01-05 11.198 58648.75 68429.87 97141.81 1.59 2015-01-06 11.382 54854.38 63401.05 98686.98 2.03 2015-01-07 11.543 55049.74 61628.07 103010.58 2.97 2015-01-08 11.647 57268.99 61376.00 105823.50 1.95 2015-01-09 11.682 58792.43 60665.93 107924.27 1.54 复权历史数据 获取历史复权数据，分为前复权和后复权数据，接口提供股票上市以来所有历史数据，默认为前复权。如果不设定开始和结束日期，则返回近一年的复权数据，从性能上考虑，推荐设定开始日期和结束日期，而且最好不要超过一年以上，获取到数据后，请及时在本地存储。 ts.get_h_data(&#39;002337&#39;) #前复权 ts.get_h_data(&#39;002337&#39;,autype=&#39;hfq&#39;) #后复权 ts.get_h_data(&#39;002337&#39;,autype=None) #不复权 ts.get_h_data(&#39;002337&#39;,start=&#39;2015-01-01&#39;,end=&#39;2015-03-16&#39;) #两个日期之间的前复权数据 Example 2. 一次性获取最近一个日交易日所有股票的交易数据（结果显示速度取决于网速） ts.get_today_all() 结果显示： 代码，名称，涨跌幅，现价，开盘价，最高价，最低价，最日收盘价，成交量，换手率 code name changepercent trade open high low settlement \ 0 002738 中矿资源 10.023 19.32 19.32 19.32 19.32 17.56 1 300410 正业科技 10.022 25.03 25.03 25.03 25.03 22.75 2 002736 国信证券 10.013 16.37 16.37 16.37 16.37 14.88 3 300412 迦南科技 10.010 31.54 31.54 31.54 31.54 28.67 4 300411 金盾股份 10.007 29.68 29.68 29.68 29.68 26.98 5 603636 南威软件 10.006 38.15 38.15 38.15 38.15 34.68 6 002664 信质电机 10.004 30.68 29.00 30.68 28.30 27.89 7 300367 东方网力 10.004 86.76 78.00 86.76 77.87 78.87 8 601299 中国北车 10.000 11.44 11.44 11.44 11.29 10.40 9 601880 大连港 10.000 5.72 5.34 5.72 5.22 5.20 10 000856 冀东装备 10.000 8.91 8.18 8.91 8.18 8.10 volume turnoverratio 0 375100 1.25033 1 85800 0.57200 2 1058925 0.08824 3 69400 0.51791 4 252220 1.26110 5 1374630 5.49852 6 6448748 9.32700 7 2025030 6.88669 8 433453523 4.28056 9 323469835 9.61735 10 25768152 19.51090 Example 3. 获取历史分笔数据 import tushare as ts df = ts.get_tick_data(&#39;600848&#39;,date=&#39;2014-01-09&#39;) df.head(10) 结果显示： 成交时间、成交价格、价格变动，成交手、成交金额(元)，买卖类型 Out[3]: time price change volume amount type 0 15:00:00 6.05 -- 8 4840 卖盘 1 14:59:55 6.05 -- 50 30250 卖盘 2 14:59:35 6.05 -- 20 12100 卖盘 3 14:59:30 6.05 -0.01 165 99825 卖盘 4 14:59:20 6.06 0.01 4 2424 买盘 5 14:59:05 6.05 -0.01 2 1210 卖盘 6 14:58:55 6.06 -- 4 2424 买盘 7 14:58:45 6.06 -- 2 1212 买盘 8 14:58:35 6.06 0.01 2 1212 买盘 9 14:58:25 6.05 -0.01 20 12100 卖盘 10 14:58:05 6.06 -- 5 3030 买盘 Example 4. 获取实时交易数据(Realtime Quotes Data) df = ts.get_realtime_quotes(&#39;000581&#39;) #Single stock symbol df[[&#39;code&#39;,&#39;name&#39;,&#39;price&#39;,&#39;bid&#39;,&#39;ask&#39;,&#39;volume&#39;,&#39;amount&#39;,&#39;time&#39;]] 结果显示： 名称、开盘价、昨价、现价、最高、最低、买入价、卖出价、成交量、成交金额…more in docs code name price bid ask volume amount time 0 000581 威孚高科 31.15 31.14 31.15 8183020 253494991.16 11:30:36 请求多个股票方法（一次最好不要超过30个）： ts.get_realtime_quotes([&#39;600848&#39;,&#39;000980&#39;,&#39;000981&#39;]) #symbols from a list ts.get_realtime_quotes(df[&#39;code&#39;].tail(10)) #from a Series pyalgotrade-cn 这部分参考了这个博客。 策略可视化 在pyalgotrade中，已经为我们提供了很好用的可视化模块了，plotter。所以，一开始我们先导入模块。 from pyalgotrade import plotter 把策略的净值图、买卖开仓情况绘制出来其实很简单，把我们的策略实例化之后，传给plotter就可以了。 myStrategy = MyStrategy(feed, &quot;fd&quot;)# 策略实例化 plt = plotter.StrategyPlotter(myStrategy) # 传入策略 myStrategy.run()# 运行策略 myStrategy.info(&quot;Final portfolio value: $%.2f&quot; % myStrategy.getResult()) plt.plot()# 绘制 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-24T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanss2/article/details/82826832 【数据】【自动化交易】Python获取中国股市行情和指数 一般来说获取股市行情和指数都是需要付费的，并且这些数据你根本无法导出，比如早年看我妈他们炒股用的大富翁等软件。不过现在可以用诸如腾讯、新浪财经等的网页数据，不过顶多是1s级的，不过免费。所以思路就是使用爬虫扒取。 爬虫也不需要你自己写，这里介绍几种易用的数据lib: Tushare: 内核并非爬虫，好像是C++写的，文档比较老了。印象最深的是它有电影票房数据模块。 easyquotation: 要求 V P y t h o n ≥ 3.5 V_{Python} \\ge 3.5 VPython​≥3.5。单只股票数据感觉比Tushare全，小巧易用。 pyalgotrade-cn: 可以和Tushare数据配合回测的lib。 easyquotation 前言 获取新浪的免费实时行情 获取腾讯财经的免费实时行情 获取集思路的分级基金数据 开发环境 : Ubuntu 16.04 / Python 3.5 requirements Python 3.5+ pip install -r requirements.txt 安装 pip install easyquotation 升级 pip install easyquotation --upgrade 用法 引入: import easyquotation 选择行情 quotation = easyquotation.use(&#39;sina&#39;) # 新浪 [&#39;sina&#39;] 腾讯 [&#39;tencent&#39;, &#39;qq&#39;] 获取所有股票行情 quotation.market_snapshot(prefix=True) # prefix 参数指定返回的行情字典中的股票代码 key 是否带 sz/sh 前缀 return {&#39;sh000159&#39;: {&#39;name&#39;: &#39;国际实业&#39;, # 股票名 &#39;buy&#39;: 8.87, # 竞买价 &#39;sell&#39;: 8.88, # 竞卖价 &#39;now&#39;: 8.88, # 现价 &#39;open&#39;: 8.99, # 开盘价 &#39;close&#39;: 8.96, # 昨日收盘价 &#39;high&#39;: 9.15, # 今日最高价 &#39;low&#39;: 8.83, # 今日最低价 &#39;turnover&#39;: 22545048, # 交易股数 &#39;volume&#39;: 202704887.74， # 交易金额 &#39;ask1&#39;: 8.88, # 卖一价 &#39;ask1_volume&#39;: 111900, # 卖一量 &#39;ask2&#39;: 8.89, &#39;ask2_volume&#39;: 54700, &#39;bid1&#39;: 8.87, # 买一价 &#39;bid1_volume&#39;: 21800, # 买一量 ... &#39;bid2&#39;: 8.86, &#39;bid2_volume&#39;: 78400, &#39;date&#39;: &#39;2016-02-19&#39;, &#39;time&#39;: &#39;14:30:00&#39;, ...}, ...... } 单只股票 quotation.real(&#39;162411&#39;) # 支持直接指定前缀，如 &#39;sh000001&#39; 多只股票 quotation.stocks([&#39;000001&#39;, &#39;162411&#39;]) 同时获取指数和行情 quotation.stocks([&#39;sh000001&#39;, &#39;sz000001&#39;], prefix=True) 更新股票代码 easyquotation.update_stock_codes() 选择 jsl 行情 quotation = easyquotation.use(&#39;jsl&#39;) # [&#39;jsl&#39;] 获取分级基金信息 quotation.funda() # 参数可选择利率、折价率、交易量、有无下折、是否永续来过滤 quotation.fundb() # 参数如上 对应的分级 A 数据 return { 150020: {&#39;abrate&#39;: &#39;5:5&#39;, &#39;calc_info&#39;: None, &#39;coupon_descr&#39;: &#39;+3.0%&#39;, &#39;coupon_descr_s&#39;: &#39;+3.0%&#39;, &#39;fund_descr&#39;: &#39;每年第一个工作日定折，无下折，A不参与上折，净值&lt;1元无定折&#39;, &#39;funda_amount&#39;: 178823, &#39;funda_amount_increase&#39;: &#39;0&#39;, &#39;funda_amount_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_base_est_dis_rt&#39;: &#39;2.27%&#39;, &#39;funda_base_est_dis_rt_t1&#39;: &#39;2.27%&#39;, &#39;funda_base_est_dis_rt_t2&#39;: &#39;-0.34%&#39;, &#39;funda_base_est_dis_rt_tip&#39;: &#39;&#39;, &#39;funda_base_fund_id&#39;: &#39;163109&#39;, &#39;funda_coupon&#39;: &#39;5.75&#39;, &#39;funda_coupon_next&#39;: &#39;4.75&#39;, &#39;funda_current_price&#39;: &#39;0.783&#39;, &#39;funda_discount_rt&#39;: &#39;24.75%&#39;, &#39;funda_id&#39;: &#39;150022&#39;, &#39;funda_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_index_id&#39;: &#39;399001&#39;, &#39;funda_index_increase_rt&#39;: &#39;0.00%&#39;, &#39;funda_index_name&#39;: &#39;深证成指&#39;, &#39;funda_left_year&#39;: &#39;永续&#39;, &#39;funda_lower_recalc_rt&#39;: &#39;1.82%&#39;, &#39;funda_name&#39;: &#39;深成指A&#39;, &#39;funda_nav_dt&#39;: &#39;2015-09-14&#39;, &#39;funda_profit_rt&#39;: &#39;7.74%&#39;, &#39;funda_profit_rt_next&#39;: &#39;6.424%&#39;, &#39;funda_value&#39;: &#39;1.0405&#39;, &#39;funda_volume&#39;: &#39;0.00&#39;, &#39;fundb_upper_recalc_rt&#39;: &#39;244.35%&#39;, &#39;fundb_upper_recalc_rt_info&#39;: &#39;深成指A不参与上折&#39;, &#39;last_time&#39;: &#39;09:18:22&#39;, &#39;left_recalc_year&#39;: &#39;0.30411&#39;, &#39;lower_recalc_profit_rt&#39;: &#39;-&#39;, &#39;next_recalc_dt&#39;: &#39;&lt;span style=&quot;font-style:italic&quot;&gt;2016-01-04&lt;/span&gt;&#39;, &#39;owned&#39;: 0, &#39;status_cd&#39;: &#39;N&#39;}&gt;&#39;}} 分级基金套利接口 quotation.fundarb(jsl_username, jsl_password, avolume=100, bvolume=100, ptype=&#39;price&#39;) jsl_username: 集思录用户名 jsl_password: 集思路登录密码 avolume: A成交额，单位百万 bvolume: B成交额，单位百万 ptype: 溢价计算方式，price=现价，buy=买一，sell=卖一 return { &quot;165511&quot;:{ &#39;base_fund_id&#39;: &#39;165511&#39;, # 母基金代码 &#39;AB_price&#39;: &#39;现价A/B : 1.008/1.329&#39;, &#39;a_profit_rt_next&#39;: &#39;4.705&#39;, &#39;a_ratio&#39;: 4, &#39;abrate&#39;: &#39;4:6&#39;, &#39;apply_fee&#39;: &#39;0&#39;, &#39;apply_fee_tip&#39;: &#39;0&#39;, &#39;apply_sell&#39;: &#39;-0.59&#39;, &#39;asset_ratio&#39;: &#39;95%&#39;, &#39;asset_ratio_last&#39;: &#39;99%&#39;, &#39;asset_ratio_num&#39;: &#39;95.00&#39;, &#39;b_est_val&#39;: &#39;1.340&#39;, &#39;b_gangan&#39;: &#39;1.502&#39;, &#39;b_ratio&#39;: 6, &#39;base_est_dis_rt&#39;: &#39;-0.56%&#39;, &#39;base_est_val&#39;: &#39;1.2073&#39;, &#39;base_fund_nm&#39;: &#39;信诚500&#39;, &#39;base_lower_recalc_rt&#39;: &#39;54.15%&#39;, &#39;base_nav&#39;: &#39;1.1970&#39;, &#39;base_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;buy1A&#39;: &#39;1.007&#39;, &#39;buy1B&#39;: &#39;1.329&#39;, &#39;buy1_amountA&#39;: &#39;0.201&#39;, &#39;buy1_amountB&#39;: &#39;7.123&#39;, &#39;buy_redeem&#39;: &#39;-0.51&#39;, &#39;calc_info&#39;: None, &#39;coupon&#39;: &#39;0.00%&#39;, &#39;coupon_next&#39;: &#39;4.700&#39;, &#39;est_dis_rt&#39;: &#39;-0.55%&#39;, &#39;est_time&#39;: &#39;2016-04-14 15:10:05&#39;, &#39;fundA_amount&#39;: &#39;6667&#39;, &#39;fundA_amount_increase&#39;: &#39;-51&#39;, &#39;fundA_amount_increase_rt&#39;: &#39;-0.76%&#39;, &#39;fundA_amount_tip&#39;: &#39;2016-04-14 A类总份额6667.000万份，份额增长-0.76%&#39;, &#39;fundA_id&#39;: &#39;150028&#39;, &#39;fundA_last_dt&#39;: &#39;2016-04-14&#39;, &#39;fundA_last_time&#39;: &#39;14:57:02&#39;, &#39;fundA_nav&#39;: &#39;1.0090&#39;, &#39;fundA_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;fundA_nm&#39;: &#39;中证500A&#39;, &#39;fundA_stock_volume&#39;: &#39;28.2446&#39;, &#39;fundA_stock_volume_tip&#39;: &#39;A类总份额6667.000万份, 成交28万份&#39;, &#39;fundA_turnover_rt&#39;: &#39;0.42%&#39;, &#39;fundA_volume&#39;: &#39;28.46&#39;, &#39;fundB_amount&#39;: 10000.5, &#39;fundB_amount_increase&#39;: &#39;-76&#39;, &#39;fundB_amount_tip&#39;: &#39;2016-04-14 B类总份额10000万份，份额增长-0.76%&#39;, &#39;fundB_id&#39;: &#39;150029&#39;, &#39;fundB_last_dt&#39;: &#39;2016-04-14&#39;, &#39;fundB_last_time&#39;: &#39;15:00:27&#39;, &#39;fundB_nav&#39;: &#39;1.3220&#39;, &#39;fundB_nav_dt&#39;: &#39;2016-04-13&#39;, &#39;fundB_nm&#39;: &#39;中证500B&#39;, &#39;fundB_stock_volume&#39;: &#39;255.5280&#39;, &#39;fundB_stock_volume_tip&#39;: &#39;B类总份额10000万份, 成交256万份&#39;, &#39;fundB_turnover_rt&#39;: &#39;2.56%&#39;, &#39;fundB_volume&#39;: &#39;337.24&#39;, &#39;fund_company_nm&#39;: &#39;信诚基金&#39;, &#39;funda_name_tip&#39;: &#39;下期利率：4.70，修正收益率：4.71%&#39;, &#39;idx_incr_rt&#39;: &#39;0.91%&#39;, &#39;increase_rtA&#39;: &#39;-0.10%&#39;, &#39;increase_rtB&#39;: &#39;1.06%&#39;, &#39;index_id&#39;: &#39;399905&#39;, &#39;index_nm&#39;: &#39;中证 500&#39;, &#39;is_est_val&#39;: 1, &#39;is_last_nav&#39;: 1, &#39;lower_recalc_rt&#39;: &#39;54.15&#39;, &#39;maturity_dt&#39;: &#39;-&#39;, &#39;merge_price&#39;: &#39;1.2006&#39;, &#39;min_apply_amount&#39;: None, &#39;notes&#39;: &#39;http://www.xcfunds.com/funds_2012/165511/fundinfor.shtml\\r\\n&#39;, &#39;ownedA&#39;: 0, &#39;ownedM&#39;: 1, &#39;priceA&#39;: &#39;1.008&#39;, &#39;priceB&#39;: &#39;1.329&#39;, &#39;real_idx_increase_rt&#39;: &#39;0.91&#39;, &#39;recalc_to&#39;: None, &#39;redeem_fee&#39;: &#39;0.5%&#39;, &#39;redeem_fee_tip&#39;: &#39;0.5%&#39;, &#39;sell1A&#39;: &#39;1.008&#39;, &#39;sell1B&#39;: &#39;1.330&#39;, &#39;sell1_amountA&#39;: &#39;7.132&#39;, &#39;sell1_amountB&#39;: &#39;16.820&#39;, &#39;status_cd&#39;: &#39;N&#39; } } 指数ETF查询接口 TIP : 尚未包含黄金ETF和货币ETF 集思录ETF源网页 quotation.etfindex(index_id=&quot;&quot;, min_volume=0, max_discount=None, min_discount=None) return { &quot;510050&quot;: { &quot;fund_id&quot;: &quot;510050&quot;, # 代码 &quot;fund_nm&quot;: &quot;50ETF&quot;, # 名称 &quot;price&quot;: &quot;2.066&quot;, # 现价 &quot;increase_rt&quot;: &quot;0.34%&quot;, # 涨幅 &quot;volume&quot;: &quot;71290.96&quot;, # 成交额(万元) &quot;index_nm&quot;: &quot;上证50&quot;, # 指数 &quot;pe&quot;: &quot;9.038&quot;, # 指数PE &quot;pb&quot;: &quot;1.151&quot;, # 指数PB &quot;index_increase_rt&quot;: &quot;0.45%&quot;, # 指数涨幅 &quot;estimate_value&quot;: &quot;2.0733&quot;, # 估值 &quot;fund_nav&quot;: &quot;2.0730&quot;, # 净值 &quot;nav_dt&quot;: &quot;2016-03-11&quot;, # 净值日期 &quot;discount_rt&quot;: &quot;-0.34%&quot;, # 溢价率 &quot;creation_unit&quot;: &quot;90&quot;, # 最小申赎单位(万份) &quot;amount&quot;: &quot;1315800&quot;, # 份额 &quot;unit_total&quot;: &quot;271.84&quot;, # 规模(亿元) &quot;index_id&quot;: &quot;000016&quot;, # 指数代码 &quot;last_time&quot;: &quot;15:00:00&quot;, # 价格最后时间(未确定) &quot;last_est_time&quot;: &quot;23:50:02&quot;, # 估值最后时间(未确定) } } 分数图 腾讯分时图地址 quotation = easyquotation.use(&quot;timekline&quot;) data = quotation.real([&#39;603828&#39;], prefix=True) return { &#39;sh603828&#39;: { &#39;date&#39;: &#39;170721&#39;, #日期 &#39;time_data&#39;: { &#39;201707210930&#39;: [&#39;0930&#39;, &#39;19.42&#39;, &#39;61&#39;], # [时间, 当前价, 上一分钟到这一分钟之间的成交数量] &#39;201707210931&#39;: [&#39;0931&#39;, &#39;19.42&#39;,&#39;122&#39;], &#39;201707210932&#39;: [&#39;0932&#39;, &#39;19.43&#39;, &#39;123&#39;], &#39;201707210933&#39;: [&#39;0933&#39;, &#39;19.48&#39;, &#39;125&#39;], &#39;201707210934&#39;: [&#39;0934&#39;, &#39;19.49&#39;, &#39;133&#39;], &#39;201707210935&#39;: [&#39;0935&#39;, &#39;19.48&#39;, &#39;161&#39;], ... } } 港股日k线图 腾讯日k线图 import easyquotation quotation = easyquotation.use(&quot;daykline&quot;) data = quotation.real([&#39;00001&#39;,&#39;00700&#39;]) print(data) return { &#39;00001&#39;: [ [&#39;2017-10-09&#39;, &#39;352.00&#39;, &#39;349.00&#39;, &#39;353.00&#39;, &#39;348.60&#39;, &#39;13455864.00&#39;], # [日期, 今开, 今收, 最高, 最低, 成交量 ] [&#39;2017-10-10&#39;, &#39;350.80&#39;, &#39;351.20&#39;, &#39;352.60&#39;, &#39;349.80&#39;, &#39;10088970.00&#39;], ] &#39;00700&#39;:[ ] } } 腾讯港股时时行情 腾讯控股时时行情 import easyquotation quotation = easyquotation.use(&quot;hkquote&quot;) data = quotation.real([&#39;00001&#39;,&#39;00700&#39;]) print(data) { &#39;00001&#39;: { &#39;stock_code&#39;: &#39;00001&#39;, # 股票代码 &#39;lotSize&#39;: &#39;&quot;100&#39;, # 每手数量 &#39;name&#39;: &#39;长和&#39;, # 股票名称 &#39;price&#39;: &#39;97.20&#39;, # 股票当前价格 &#39;lastPrice&#39;: &#39;97.75&#39;, # 股票昨天收盘价格 &#39;openPrice&#39;: &#39;97.75&#39;, # 股票今天开盘价格 &#39;amount&#39;: &#39;1641463.0&#39;, # 股票成交量 &#39;time&#39;: &#39;2017/11/29 15:38:58&#39;, # 当前时间 &#39;high&#39;: &#39;98.05&#39;, # 当天最高价格 &#39;low&#39;: &#39;97.15&#39; # 当天最低价格 }, &#39;00700&#39;: { &#39;stock_code&#39;: &#39;00700&#39;, &#39;lotSize&#39;: &#39;&quot;100&#39;, &#39;name&#39;: &#39;腾讯控股&#39;, &#39;price&#39;: &#39;413.20&#39;, &#39;lastPrice&#39;: &#39;419.20&#39;, &#39;openPrice&#39;: &#39;422.20&#39;, &#39;amount&#39;: &#39;21351010.0&#39;, &#39;time&#39;: &#39;2017/11/29 15:39:01&#39;, &#39;high&#39;: &#39;422.80&#39;, &#39;low&#39;: &#39;412.40&#39; } } 开发指南 初始化环境 进入项目目录后运行 make init Tushare TuShare是实现对股票/期货等金融数据从数据采集、清洗加工 到 数据存储过程的工具，满足金融量化分析师和学习数据分析的人在数据获取方面的需求，它的特点是数据覆盖范围广，接口调用简单,响应快速。 Dependencies python 2.x/3.x pandas Installation 方式1：pip install tushare 方式2：python setup.py install 方式3：访问https://pypi.python.org/pypi/tushare/下载安装 Upgrade pip install tushare --upgrade Quick Start Example 1. 获取个股历史交易数据（包括均线数据）： import tushare as ts ts.get_hist_data(&#39;600848&#39;) #一次性获取全部数据 结果显示： 日期 ，开盘价， 最高价， 收盘价， 最低价， 成交量， 价格变动 ，涨跌幅，5日均价，10日均价，20日均价，5日均量，10日均量，20日均量，换手率 open high close low volume p_change ma5 \\ date 2012-01-11 6.880 7.380 7.060 6.880 14129.96 2.62 7.060 2012-01-12 7.050 7.100 6.980 6.900 7895.19 -1.13 7.020 2012-01-13 6.950 7.000 6.700 6.690 6611.87 -4.01 6.913 2012-01-16 6.680 6.750 6.510 6.480 2941.63 -2.84 6.813 2012-01-17 6.660 6.880 6.860 6.460 8642.57 5.38 6.822 2012-01-18 7.000 7.300 6.890 6.880 13075.40 0.44 6.788 2012-01-19 6.690 6.950 6.890 6.680 6117.32 0.00 6.770 2012-01-20 6.870 7.080 7.010 6.870 6813.09 1.74 6.832 ma10 ma20 v_ma5 v_ma10 v_ma20 turnover date 2012-01-11 7.060 7.060 14129.96 14129.96 14129.96 0.48 2012-01-12 7.020 7.020 11012.58 11012.58 11012.58 0.27 2012-01-13 6.913 6.913 9545.67 9545.67 9545.67 0.23 2012-01-16 6.813 6.813 7894.66 7894.66 7894.66 0.10 2012-01-17 6.822 6.822 8044.24 8044.24 8044.24 0.30 2012-01-18 6.833 6.833 7833.33 8882.77 8882.77 0.45 2012-01-19 6.841 6.841 7477.76 8487.71 8487.71 0.21 2012-01-20 6.863 6.863 7518.00 8278.38 8278.38 0.23 设定历史数据的时间： ts.get_hist_data(&#39;600848&#39;,start=&#39;2015-01-05&#39;,end=&#39;2015-01-09&#39;) open high close low volume p_change ma5 ma10 \\ date 2015-01-05 11.160 11.390 11.260 10.890 46383.57 1.26 11.156 11.212 2015-01-06 11.130 11.660 11.610 11.030 59199.93 3.11 11.182 11.155 2015-01-07 11.580 11.990 11.920 11.480 86681.38 2.67 11.366 11.251 2015-01-08 11.700 11.920 11.670 11.640 56845.71 -2.10 11.516 11.349 2015-01-09 11.680 11.710 11.230 11.190 44851.56 -3.77 11.538 11.363 ma20 v_ma5 v_ma10 v_ma20 turnover date 2015-01-05 11.198 58648.75 68429.87 97141.81 1.59 2015-01-06 11.382 54854.38 63401.05 98686.98 2.03 2015-01-07 11.543 55049.74 61628.07 103010.58 2.97 2015-01-08 11.647 57268.99 61376.00 105823.50 1.95 2015-01-09 11.682 58792.43 60665.93 107924.27 1.54 复权历史数据 获取历史复权数据，分为前复权和后复权数据，接口提供股票上市以来所有历史数据，默认为前复权。如果不设定开始和结束日期，则返回近一年的复权数据，从性能上考虑，推荐设定开始日期和结束日期，而且最好不要超过一年以上，获取到数据后，请及时在本地存储。 ts.get_h_data(&#39;002337&#39;) #前复权 ts.get_h_data(&#39;002337&#39;,autype=&#39;hfq&#39;) #后复权 ts.get_h_data(&#39;002337&#39;,autype=None) #不复权 ts.get_h_data(&#39;002337&#39;,start=&#39;2015-01-01&#39;,end=&#39;2015-03-16&#39;) #两个日期之间的前复权数据 Example 2. 一次性获取最近一个日交易日所有股票的交易数据（结果显示速度取决于网速） ts.get_today_all() 结果显示： 代码，名称，涨跌幅，现价，开盘价，最高价，最低价，最日收盘价，成交量，换手率 code name changepercent trade open high low settlement \\ 0 002738 中矿资源 10.023 19.32 19.32 19.32 19.32 17.56 1 300410 正业科技 10.022 25.03 25.03 25.03 25.03 22.75 2 002736 国信证券 10.013 16.37 16.37 16.37 16.37 14.88 3 300412 迦南科技 10.010 31.54 31.54 31.54 31.54 28.67 4 300411 金盾股份 10.007 29.68 29.68 29.68 29.68 26.98 5 603636 南威软件 10.006 38.15 38.15 38.15 38.15 34.68 6 002664 信质电机 10.004 30.68 29.00 30.68 28.30 27.89 7 300367 东方网力 10.004 86.76 78.00 86.76 77.87 78.87 8 601299 中国北车 10.000 11.44 11.44 11.44 11.29 10.40 9 601880 大连港 10.000 5.72 5.34 5.72 5.22 5.20 10 000856 冀东装备 10.000 8.91 8.18 8.91 8.18 8.10 volume turnoverratio 0 375100 1.25033 1 85800 0.57200 2 1058925 0.08824 3 69400 0.51791 4 252220 1.26110 5 1374630 5.49852 6 6448748 9.32700 7 2025030 6.88669 8 433453523 4.28056 9 323469835 9.61735 10 25768152 19.51090 Example 3. 获取历史分笔数据 import tushare as ts df = ts.get_tick_data(&#39;600848&#39;,date=&#39;2014-01-09&#39;) df.head(10) 结果显示： 成交时间、成交价格、价格变动，成交手、成交金额(元)，买卖类型 Out[3]: time price change volume amount type 0 15:00:00 6.05 -- 8 4840 卖盘 1 14:59:55 6.05 -- 50 30250 卖盘 2 14:59:35 6.05 -- 20 12100 卖盘 3 14:59:30 6.05 -0.01 165 99825 卖盘 4 14:59:20 6.06 0.01 4 2424 买盘 5 14:59:05 6.05 -0.01 2 1210 卖盘 6 14:58:55 6.06 -- 4 2424 买盘 7 14:58:45 6.06 -- 2 1212 买盘 8 14:58:35 6.06 0.01 2 1212 买盘 9 14:58:25 6.05 -0.01 20 12100 卖盘 10 14:58:05 6.06 -- 5 3030 买盘 Example 4. 获取实时交易数据(Realtime Quotes Data) df = ts.get_realtime_quotes(&#39;000581&#39;) #Single stock symbol df[[&#39;code&#39;,&#39;name&#39;,&#39;price&#39;,&#39;bid&#39;,&#39;ask&#39;,&#39;volume&#39;,&#39;amount&#39;,&#39;time&#39;]] 结果显示： 名称、开盘价、昨价、现价、最高、最低、买入价、卖出价、成交量、成交金额…more in docs code name price bid ask volume amount time 0 000581 威孚高科 31.15 31.14 31.15 8183020 253494991.16 11:30:36 请求多个股票方法（一次最好不要超过30个）： ts.get_realtime_quotes([&#39;600848&#39;,&#39;000980&#39;,&#39;000981&#39;]) #symbols from a list ts.get_realtime_quotes(df[&#39;code&#39;].tail(10)) #from a Series pyalgotrade-cn 这部分参考了这个博客。 策略可视化 在pyalgotrade中，已经为我们提供了很好用的可视化模块了，plotter。所以，一开始我们先导入模块。 from pyalgotrade import plotter 把策略的净值图、买卖开仓情况绘制出来其实很简单，把我们的策略实例化之后，传给plotter就可以了。 myStrategy = MyStrategy(feed, &quot;fd&quot;)# 策略实例化 plt = plotter.StrategyPlotter(myStrategy) # 传入策略 myStrategy.run()# 运行策略 myStrategy.info(&quot;Final portfolio value: $%.2f&quot; % myStrategy.getResult()) plt.plot()# 绘制 阅读更多","@type":"BlogPosting","url":"/2018/09/24/43915886860dc7dbc9f67c6450b7a830.html","headline":"【数据】【自动化交易】Python获取中国股市行情和指数","dateModified":"2018-09-24T00:00:00+08:00","datePublished":"2018-09-24T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/09/24/43915886860dc7dbc9f67c6450b7a830.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>【数据】【自动化交易】Python获取中国股市行情和指数</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanss2/article/details/82826832 
 </div> 
 <div class="markdown_views prism-tomorrow-night"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h1><a id="Python_0"></a>【数据】【自动化交易】Python获取中国股市行情和指数</h1> 
  <blockquote> 
   <p>一般来说获取股市行情和指数都是需要付费的，并且这些数据你根本无法导出，比如早年看我妈他们炒股用的大富翁等软件。不过现在可以用诸如腾讯、新浪财经等的网页数据，不过顶多是1s级的，不过免费。所以思路就是使用爬虫扒取。</p> 
  </blockquote> 
  <p>爬虫也不需要你自己写，这里介绍几种易用的数据lib:</p> 
  <ul> 
   <li><strong>Tushare:</strong> 内核并非爬虫，好像是C++写的，文档比较老了。印象最深的是它有电影票房数据模块。</li> 
   <li><strong>easyquotation:</strong> 要求<span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            V
           </mi>
           <mrow>
            <mi>
             P
            </mi>
            <mi>
             y
            </mi>
            <mi>
             t
            </mi>
            <mi>
             h
            </mi>
            <mi>
             o
            </mi>
            <mi>
             n
            </mi>
           </mrow>
          </msub>
          <mo>
           ≥
          </mo>
          <mn>
           3.5
          </mn>
         </mrow>
         <annotation encoding="application/x-tex">
          V_{Python} \ge 3.5
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathit">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.13889em;" class="mord mathit mtight">P</span><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span><span class="mord mathit mtight">t</span><span class="mord mathit mtight">h</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mord">.</span><span class="mord">5</span></span></span></span></span>。单只股票数据感觉比Tushare全，小巧易用。</li> 
   <li><strong>pyalgotrade-cn:</strong> 可以和Tushare数据配合回测的lib。</li> 
  </ul> 
  <hr> 
  <h2><a id="easyquotation_11"></a>easyquotation</h2> 
  <h4><a id="_12"></a>前言</h4> 
  <ul> 
   <li>获取新浪的免费实时行情</li> 
   <li>获取腾讯财经的免费实时行情</li> 
   <li>获取集思路的分级基金数据</li> 
  </ul> 
  <p><strong>开发环境</strong> : <code>Ubuntu 16.04</code> / <code>Python 3.5</code></p> 
  <h4><a id="requirements_20"></a>requirements</h4> 
  <ul> 
   <li>Python 3.5+</li> 
   <li>pip install -r requirements.txt</li> 
  </ul> 
  <h4><a id="_25"></a>安装</h4> 
  <pre><code>pip install easyquotation
</code></pre> 
  <h5><a id="_31"></a>升级</h5> 
  <pre><code>pip install easyquotation --upgrade
</code></pre> 
  <h4><a id="_37"></a>用法</h4> 
  <h5><a id="_39"></a>引入:</h5> 
  <pre><code>import easyquotation
</code></pre> 
  <h5><a id="_45"></a>选择行情</h5> 
  <pre><code>quotation = easyquotation.use('sina') # 新浪 ['sina'] 腾讯 ['tencent', 'qq'] 
</code></pre> 
  <h5><a id="_51"></a>获取所有股票行情</h5> 
  <pre><code>quotation.market_snapshot(prefix=True) # prefix 参数指定返回的行情字典中的股票代码 key 是否带 sz/sh 前缀
</code></pre> 
  <p><strong>return</strong></p> 
  <pre><code> {'sh000159': {'name': '国际实业', # 股票名
  'buy': 8.87, # 竞买价
  'sell': 8.88, # 竞卖价
  'now': 8.88, # 现价
  'open': 8.99, # 开盘价
  'close': 8.96, # 昨日收盘价
  'high': 9.15, # 今日最高价
  'low': 8.83, # 今日最低价
  'turnover': 22545048, # 交易股数
  'volume': 202704887.74， # 交易金额
  'ask1': 8.88, # 卖一价
  'ask1_volume': 111900, # 卖一量
  'ask2': 8.89,
  'ask2_volume': 54700,
  'bid1': 8.87, # 买一价
  'bid1_volume': 21800, # 买一量
  ...
  'bid2': 8.86, 
  'bid2_volume': 78400,
  'date': '2016-02-19',
  'time': '14:30:00',
  ...},
  ......
}
</code></pre> 
  <h6><a id="_86"></a>单只股票</h6> 
  <pre><code>quotation.real('162411') # 支持直接指定前缀，如 'sh000001'
</code></pre> 
  <h6><a id="_92"></a>多只股票</h6> 
  <pre><code>quotation.stocks(['000001', '162411']) 
</code></pre> 
  <h6><a id="_98"></a>同时获取指数和行情</h6> 
  <pre><code>quotation.stocks(['sh000001', 'sz000001'], prefix=True) 
</code></pre> 
  <h5><a id="_104"></a>更新股票代码</h5> 
  <pre><code>easyquotation.update_stock_codes()
</code></pre> 
  <h5><a id="_jsl__111"></a>选择 jsl 行情</h5> 
  <pre><code>quotation = easyquotation.use('jsl') # ['jsl']
</code></pre> 
  <h6><a id="_117"></a>获取分级基金信息</h6> 
  <pre><code>quotation.funda() # 参数可选择利率、折价率、交易量、有无下折、是否永续来过滤

quotation.fundb() # 参数如上
</code></pre> 
  <p>对应的分级 A 数据</p> 
  <p><strong>return</strong></p> 
  <pre><code>{ 150020:
{'abrate': '5:5',
'calc_info': None,
'coupon_descr': '+3.0%',
'coupon_descr_s': '+3.0%',
'fund_descr': '每年第一个工作日定折，无下折，A不参与上折，净值&lt;1元无定折',
'funda_amount': 178823,
'funda_amount_increase': '0',
'funda_amount_increase_rt': '0.00%',
'funda_base_est_dis_rt': '2.27%',
'funda_base_est_dis_rt_t1': '2.27%',
'funda_base_est_dis_rt_t2': '-0.34%',
'funda_base_est_dis_rt_tip': '',
'funda_base_fund_id': '163109',
'funda_coupon': '5.75',
'funda_coupon_next': '4.75',
'funda_current_price': '0.783',
'funda_discount_rt': '24.75%',
'funda_id': '150022',
'funda_increase_rt': '0.00%',
'funda_index_id': '399001',
'funda_index_increase_rt': '0.00%',
'funda_index_name': '深证成指',
'funda_left_year': '永续',
'funda_lower_recalc_rt': '1.82%',
'funda_name': '深成指A',
'funda_nav_dt': '2015-09-14',
'funda_profit_rt': '7.74%',
'funda_profit_rt_next': '6.424%',
'funda_value': '1.0405',
'funda_volume': '0.00',
'fundb_upper_recalc_rt': '244.35%',
'fundb_upper_recalc_rt_info': '深成指A不参与上折',
'last_time': '09:18:22',
'left_recalc_year': '0.30411',
'lower_recalc_profit_rt': '-',
'next_recalc_dt': '&lt;span style="font-style:italic"&gt;2016-01-04&lt;/span&gt;',
'owned': 0,
'status_cd': 'N'}&gt;'}}
</code></pre> 
  <h6><a id="_171"></a>分级基金套利接口</h6> 
  <pre><code>quotation.fundarb(jsl_username, jsl_password, avolume=100, bvolume=100, ptype='price')
</code></pre> 
  <pre><code>jsl_username: 集思录用户名
jsl_password: 集思路登录密码
avolume: A成交额，单位百万
bvolume: B成交额，单位百万
ptype: 溢价计算方式，price=现价，buy=买一，sell=卖一
</code></pre> 
  <p><strong>return</strong></p> 
  <pre><code>{
    "165511":{
        'base_fund_id': '165511',                         # 母基金代码
        'AB_price': '现价A/B : 1.008/1.329',
        'a_profit_rt_next': '4.705',
        'a_ratio': 4,
        'abrate': '4:6',
        'apply_fee': '0',
        'apply_fee_tip': '0',
        'apply_sell': '-0.59',
        'asset_ratio': '95%',
        'asset_ratio_last': '99%',
        'asset_ratio_num': '95.00',
        'b_est_val': '1.340',
        'b_gangan': '1.502',
        'b_ratio': 6,
        'base_est_dis_rt': '-0.56%',
        'base_est_val': '1.2073',
        'base_fund_nm': '信诚500',
        'base_lower_recalc_rt': '54.15%',
        'base_nav': '1.1970',
        'base_nav_dt': '2016-04-13',
        'buy1A': '1.007',
        'buy1B': '1.329',
        'buy1_amountA': '0.201',
        'buy1_amountB': '7.123',
        'buy_redeem': '-0.51',
        'calc_info': None,
        'coupon': '0.00%',
        'coupon_next': '4.700',
        'est_dis_rt': '-0.55%',
        'est_time': '2016-04-14 15:10:05',
        'fundA_amount': '6667',
        'fundA_amount_increase': '-51',
        'fundA_amount_increase_rt': '-0.76%',
        'fundA_amount_tip': '2016-04-14 A类总份额6667.000万份，份额增长-0.76%',
        'fundA_id': '150028',
        'fundA_last_dt': '2016-04-14',
        'fundA_last_time': '14:57:02',
        'fundA_nav': '1.0090',
        'fundA_nav_dt': '2016-04-13',
        'fundA_nm': '中证500A',
        'fundA_stock_volume': '28.2446',
        'fundA_stock_volume_tip': 'A类总份额6667.000万份, 成交28万份',
        'fundA_turnover_rt': '0.42%',
        'fundA_volume': '28.46',
        'fundB_amount': 10000.5,
        'fundB_amount_increase': '-76',
        'fundB_amount_tip': '2016-04-14 B类总份额10000万份，份额增长-0.76%',
        'fundB_id': '150029',
        'fundB_last_dt': '2016-04-14',
        'fundB_last_time': '15:00:27',
        'fundB_nav': '1.3220',
        'fundB_nav_dt': '2016-04-13',
        'fundB_nm': '中证500B',
        'fundB_stock_volume': '255.5280',
        'fundB_stock_volume_tip': 'B类总份额10000万份, 成交256万份',
        'fundB_turnover_rt': '2.56%',
        'fundB_volume': '337.24',
        'fund_company_nm': '信诚基金',
        'funda_name_tip': '下期利率：4.70，修正收益率：4.71%',
        'idx_incr_rt': '0.91%',
        'increase_rtA': '-0.10%',
        'increase_rtB': '1.06%',
        'index_id': '399905',
        'index_nm': '中证 500',
        'is_est_val': 1,
        'is_last_nav': 1,
        'lower_recalc_rt': '54.15',
        'maturity_dt': '-',
        'merge_price': '1.2006',
        'min_apply_amount': None,
        'notes': 'http://www.xcfunds.com/funds_2012/165511/fundinfor.shtml\r\n',
        'ownedA': 0,
        'ownedM': 1,
        'priceA': '1.008',
        'priceB': '1.329',
        'real_idx_increase_rt': '0.91',
        'recalc_to': None,
        'redeem_fee': '0.5%',
        'redeem_fee_tip': '0.5%',
        'sell1A': '1.008',
        'sell1B': '1.330',
        'sell1_amountA': '7.132',
        'sell1_amountB': '16.820',
        'status_cd': 'N'
    }
}
</code></pre> 
  <h6><a id="ETF_277"></a>指数ETF查询接口</h6> 
  <p><strong>TIP :</strong> 尚未包含黄金ETF和货币ETF</p> 
  <p><em><a href="https://www.jisilu.cn/data/etf/#tlink_2" rel="nofollow">集思录ETF源网页</a></em></p> 
  <pre><code>quotation.etfindex(index_id="", min_volume=0, max_discount=None, min_discount=None)
</code></pre> 
  <p><strong>return</strong></p> 
  <pre><code>{
    "510050": {
        "fund_id": "510050",                # 代码
        "fund_nm": "50ETF",                 # 名称
        "price": "2.066",                   # 现价
        "increase_rt": "0.34%",             # 涨幅
        "volume": "71290.96",               # 成交额(万元)
        "index_nm": "上证50",                # 指数
        "pe": "9.038",                      # 指数PE
        "pb": "1.151",                      # 指数PB
        "index_increase_rt": "0.45%",       # 指数涨幅
        "estimate_value": "2.0733",         # 估值
        "fund_nav": "2.0730",               # 净值
        "nav_dt": "2016-03-11",             # 净值日期
        "discount_rt": "-0.34%",            # 溢价率
        "creation_unit": "90",              # 最小申赎单位(万份)
        "amount": "1315800",                # 份额
        "unit_total": "271.84",             # 规模(亿元)
        "index_id": "000016",               # 指数代码
        "last_time": "15:00:00",            # 价格最后时间(未确定)
        "last_est_time": "23:50:02",        # 估值最后时间(未确定)
    }
}
</code></pre> 
  <h6><a id="_316"></a>分数图</h6> 
  <p><em><a href="http://data.gtimg.cn/flashdata/hushen/minute/sz000001.js" rel="nofollow">腾讯分时图地址</a></em></p> 
  <pre><code>
quotation = easyquotation.use("timekline")
data = quotation.real(['603828'], prefix=True)

</code></pre> 
  <p><strong>return</strong></p> 
  <pre><code>{
   'sh603828': {
        'date': '170721',  #日期 
        'time_data': {
            '201707210930': ['0930', '19.42', '61'], # [时间, 当前价, 上一分钟到这一分钟之间的成交数量]
            '201707210931': ['0931', '19.42','122'], 
            '201707210932': ['0932', '19.43', '123'], 
            '201707210933': ['0933', '19.48', '125'], 
            '201707210934': ['0934', '19.49', '133'], 
            '201707210935': ['0935', '19.48', '161'], 
            ...
    }
}
</code></pre> 
  <h6><a id="k_346"></a>港股日k线图</h6> 
  <p><em><a href="http://web.ifzq.gtimg.cn/appstock/app/hkfqkline/get?_var=kline_dayqfq&amp;param=hk00700,day,,,350,qfq&amp;r=0.7773272375526847" rel="nofollow">腾讯日k线图</a></em></p> 
  <pre><code>
import easyquotation
quotation  = easyquotation.use("daykline")
data = quotation.real(['00001','00700'])
print(data)

</code></pre> 
  <p><em>return</em></p> 
  <pre><code>{
    '00001': [
                ['2017-10-09', '352.00', '349.00', '353.00', '348.60', '13455864.00'], # [日期, 今开, 今收, 最高, 最低, 成交量 ]
                ['2017-10-10', '350.80', '351.20', '352.60', '349.80', '10088970.00'],
               ]
    '00700':[
        
    ]           
     }
}
</code></pre> 
  <h6><a id="_371"></a>腾讯港股时时行情</h6> 
  <p><em><a href="http://sqt.gtimg.cn/utf8/q=r_hk00700" rel="nofollow">腾讯控股时时行情</a></em></p> 
  <pre><code>
import easyquotation
quotation = easyquotation.use("hkquote")
data = quotation.real(['00001','00700'])
print(data)
</code></pre> 
  <pre><code>{
    '00001': 
        {
            'stock_code': '00001', # 股票代码
            'lotSize': '"100', # 每手数量
            'name': '长和', # 股票名称
            'price': '97.20', # 股票当前价格
            'lastPrice': '97.75', # 股票昨天收盘价格
            'openPrice': '97.75', # 股票今天开盘价格
            'amount': '1641463.0', # 股票成交量 
            'time': '2017/11/29 15:38:58', # 当前时间
            'high': '98.05', # 当天最高价格
            'low': '97.15' # 当天最低价格
        }, 
    '00700': 
        {
            'stock_code': '00700', 
            'lotSize': '"100',
            'name': '腾讯控股', 
            'price': '413.20', 
            'lastPrice': '419.20', 
            'openPrice': '422.20', 
            'amount': '21351010.0', 
            'time': '2017/11/29 15:39:01', 
            'high': '422.80',
            'low': '412.40'
        }
}
</code></pre> 
  <h4><a id="_412"></a>开发指南</h4> 
  <h5><a id="_414"></a>初始化环境</h5> 
  <p>进入项目目录后运行</p> 
  <pre><code>make init
</code></pre> 
  <hr> 
  <h2><a id="Tushare_423"></a>Tushare</h2> 
  <p>TuShare是实现对股票/期货等金融数据从<strong>数据采集</strong>、<strong>清洗加工</strong> 到 <strong>数据存储</strong>过程的工具，满足金融量化分析师和学习数据分析的人在数据获取方面的需求，它的特点是数据覆盖范围广，接口调用简单,响应快速。</p> 
  <h4><a id="Dependencies_427"></a>Dependencies</h4> 
  <ul> 
   <li>python 2.x/3.x</li> 
   <li><a href="http://pandas.pydata.org/" rel="nofollow" title="pandas">pandas</a></li> 
  </ul> 
  <h4><a id="Installation_432"></a>Installation</h4> 
  <ul> 
   <li>方式1：pip install tushare</li> 
   <li>方式2：python <a href="http://setup.py" rel="nofollow">setup.py</a> install</li> 
   <li>方式3：访问<a href="https://pypi.python.org/pypi/tushare/" rel="nofollow">https://pypi.python.org/pypi/tushare/</a>下载安装</li> 
  </ul> 
  <h4><a id="Upgrade_440"></a>Upgrade</h4> 
  <pre><code>pip install tushare --upgrade
</code></pre> 
  <h4><a id="Quick_Start_445"></a>Quick Start</h4> 
  <p><strong>Example 1.</strong> 获取个股历史交易数据（包括均线数据）：</p> 
  <pre><code>    import tushare as ts

    ts.get_hist_data('600848') #一次性获取全部数据
</code></pre> 
  <p>结果显示：</p> 
  <blockquote> 
   <p>日期 ，开盘价， 最高价， 收盘价， 最低价， 成交量， 价格变动 ，涨跌幅，5日均价，10日均价，20日均价，5日均量，10日均量，20日均量，换手率</p> 
  </blockquote> 
  <pre><code>                 open    high   close     low     volume    p_change  ma5 \
    date                                                                     
    2012-01-11   6.880   7.380   7.060   6.880   14129.96     2.62   7.060   
    2012-01-12   7.050   7.100   6.980   6.900    7895.19    -1.13   7.020   
    2012-01-13   6.950   7.000   6.700   6.690    6611.87    -4.01   6.913   
    2012-01-16   6.680   6.750   6.510   6.480    2941.63    -2.84   6.813   
    2012-01-17   6.660   6.880   6.860   6.460    8642.57     5.38   6.822   
    2012-01-18   7.000   7.300   6.890   6.880   13075.40     0.44   6.788   
    2012-01-19   6.690   6.950   6.890   6.680    6117.32     0.00   6.770   
    2012-01-20   6.870   7.080   7.010   6.870    6813.09     1.74   6.832 

                 ma10    ma20      v_ma5     v_ma10     v_ma20     turnover  
    date                                                                  
    2012-01-11   7.060   7.060   14129.96   14129.96   14129.96     0.48  
    2012-01-12   7.020   7.020   11012.58   11012.58   11012.58     0.27  
    2012-01-13   6.913   6.913    9545.67    9545.67    9545.67     0.23  
    2012-01-16   6.813   6.813    7894.66    7894.66    7894.66     0.10  
    2012-01-17   6.822   6.822    8044.24    8044.24    8044.24     0.30  
    2012-01-18   6.833   6.833    7833.33    8882.77    8882.77     0.45  
    2012-01-19   6.841   6.841    7477.76    8487.71    8487.71     0.21  
    2012-01-20   6.863   6.863    7518.00    8278.38    8278.38     0.23  
</code></pre> 
  <p>设定历史数据的时间：</p> 
  <pre><code>    ts.get_hist_data('600848',start='2015-01-05',end='2015-01-09')

                open    high   close     low    volume   p_change     ma5    ma10 \  
    date                                                                            
    2015-01-05  11.160  11.390  11.260  10.890  46383.57     1.26  11.156  11.212   
    2015-01-06  11.130  11.660  11.610  11.030  59199.93     3.11  11.182  11.155   
    2015-01-07  11.580  11.990  11.920  11.480  86681.38     2.67  11.366  11.251   
    2015-01-08  11.700  11.920  11.670  11.640  56845.71    -2.10  11.516  11.349   
    2015-01-09  11.680  11.710  11.230  11.190  44851.56    -3.77  11.538  11.363   
                ma20     v_ma5    v_ma10     v_ma20      turnover  
    date                                                        
    2015-01-05  11.198  58648.75  68429.87   97141.81     1.59  
    2015-01-06  11.382  54854.38  63401.05   98686.98     2.03  
    2015-01-07  11.543  55049.74  61628.07  103010.58     2.97  
    2015-01-08  11.647  57268.99  61376.00  105823.50     1.95  
    2015-01-09  11.682  58792.43  60665.93  107924.27     1.54  
</code></pre> 
  <p><strong>复权历史数据</strong><br> 获取历史复权数据，分为前复权和后复权数据，接口提供股票上市以来所有历史数据，默认为前复权。如果不设定开始和结束日期，则返回近一年的复权数据，从性能上考虑，推荐设定开始日期和结束日期，而且最好不要超过一年以上，获取到数据后，请及时在本地存储。</p> 
  <pre><code>    ts.get_h_data('002337') #前复权
    ts.get_h_data('002337',autype='hfq') #后复权
    ts.get_h_data('002337',autype=None) #不复权
    ts.get_h_data('002337',start='2015-01-01',end='2015-03-16') #两个日期之间的前复权数据
</code></pre> 
  <p><strong>Example 2.</strong> 一次性获取最近一个日交易日所有股票的交易数据（结果显示速度取决于网速）</p> 
  <pre><code>    ts.get_today_all()
</code></pre> 
  <p>结果显示：</p> 
  <blockquote> 
   <p>代码，名称，涨跌幅，现价，开盘价，最高价，最低价，最日收盘价，成交量，换手率</p> 
  </blockquote> 
  <pre><code>          code    name     changepercent  trade   open   high    low  settlement \  
    0     002738  中矿资源         10.023  19.32  19.32  19.32  19.32       17.56   
    1     300410  正业科技         10.022  25.03  25.03  25.03  25.03       22.75   
    2     002736  国信证券         10.013  16.37  16.37  16.37  16.37       14.88   
    3     300412  迦南科技         10.010  31.54  31.54  31.54  31.54       28.67   
    4     300411  金盾股份         10.007  29.68  29.68  29.68  29.68       26.98   
    5     603636  南威软件         10.006  38.15  38.15  38.15  38.15       34.68   
    6     002664  信质电机         10.004  30.68  29.00  30.68  28.30       27.89   
    7     300367  东方网力         10.004  86.76  78.00  86.76  77.87       78.87   
    8     601299  中国北车         10.000  11.44  11.44  11.44  11.29       10.40   
    9     601880   大连港         10.000   5.72   5.34   5.72   5.22        5.20   
    10    000856  冀东装备         10.000   8.91   8.18   8.91   8.18        8.10  
            volume       turnoverratio  
    0        375100        1.25033  
    1         85800        0.57200  
    2       1058925        0.08824  
    3         69400        0.51791  
    4        252220        1.26110  
    5       1374630        5.49852  
    6       6448748        9.32700  
    7       2025030        6.88669  
    8     433453523        4.28056  
    9     323469835        9.61735  
    10     25768152       19.51090  
</code></pre> 
  <p><strong>Example 3.</strong> 获取历史分笔数据</p> 
  <pre><code>    import tushare as ts

    df = ts.get_tick_data('600848',date='2014-01-09')
    df.head(10)
</code></pre> 
  <p>结果显示：</p> 
  <blockquote> 
   <p>成交时间、成交价格、价格变动，成交手、成交金额(元)，买卖类型</p> 
  </blockquote> 
  <pre><code>    Out[3]: 
         time       price change  volume  amount  type
    0    15:00:00   6.05     --       8    4840   卖盘
    1    14:59:55   6.05     --      50   30250   卖盘
    2    14:59:35   6.05     --      20   12100   卖盘
    3    14:59:30   6.05  -0.01     165   99825   卖盘
    4    14:59:20   6.06   0.01       4    2424   买盘
    5    14:59:05   6.05  -0.01       2    1210   卖盘
    6    14:58:55   6.06     --       4    2424   买盘
    7    14:58:45   6.06     --       2    1212   买盘
    8    14:58:35   6.06   0.01       2    1212   买盘
    9    14:58:25   6.05  -0.01      20   12100   卖盘
    10   14:58:05   6.06     --       5    3030   买盘

</code></pre> 
  <p><strong>Example 4.</strong> 获取实时交易数据(Realtime Quotes Data)</p> 
  <pre><code>    df = ts.get_realtime_quotes('000581') #Single stock symbol
    df[['code','name','price','bid','ask','volume','amount','time']]
</code></pre> 
  <p>结果显示：</p> 
  <blockquote> 
   <p>名称、开盘价、昨价、现价、最高、最低、买入价、卖出价、成交量、成交金额…more in docs</p> 
  </blockquote> 
  <pre><code>       code    name     price  bid    ask    volume   amount        time
    0  000581  威孚高科  31.15  31.14  31.15  8183020  253494991.16  11:30:36 
</code></pre> 
  <p>请求多个股票方法（一次最好不要超过30个）：</p> 
  <pre><code>    ts.get_realtime_quotes(['600848','000980','000981']) #symbols from a list
    ts.get_realtime_quotes(df['code'].tail(10)) #from a Series
</code></pre> 
  <hr> 
  <h2><a id="pyalgotradecn_595"></a>pyalgotrade-cn</h2> 
  <p>这部分参考了<a href="https://blog.csdn.net/qtlyx" rel="nofollow">这个博客</a>。</p> 
  <h4><a id="_598"></a>策略可视化</h4> 
  <p>在pyalgotrade中，已经为我们提供了很好用的可视化模块了，plotter。所以，一开始我们先导入模块。</p> 
  <pre><code>from pyalgotrade import plotter
</code></pre> 
  <p>把策略的净值图、买卖开仓情况绘制出来其实很简单，把我们的策略实例化之后，传给plotter就可以了。</p> 
  <pre><code>myStrategy = MyStrategy(feed, "fd")# 策略实例化
plt = plotter.StrategyPlotter(myStrategy) # 传入策略
myStrategy.run()# 运行策略
myStrategy.info("Final portfolio value: $%.2f" % myStrategy.getResult())
plt.plot()# 绘制
</code></pre> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180924093141187?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhbnNzMg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="在这里插入图片描述"></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-8cccb36679.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/hanss2/article/details/82826832,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/hanss2/article/details/82826832,&quot;}">阅读更多</a> 
 <!-- <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view='{"mod":"popu_557","con":",https://blog.csdn.net/hanss2/article/details/82826832,"}' data-track-click='{"mod":"popu_557","con":",https://blog.csdn.net/hanss2/article/details/82826832,"}'>登录后自动展开</a> --> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

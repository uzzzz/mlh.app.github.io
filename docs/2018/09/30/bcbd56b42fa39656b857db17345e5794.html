<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Cypherium Java 智能合约编程指南 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Cypherium Java 智能合约编程指南" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="转载请标注原文地址：https://blog.csdn.net/lilyssh/article/details/82911309 代币就是数字货币，比特币、以太币就是一个代币。利用Cypherium的java智能合约可以轻松编写出属于自己的代币。这些代币是建立在区块链之上，代表你拥有并可转让给其他人的数字资产。现在我们就来看看怎样创建一个这样的代币。 准备工作： 下载示例代码。https://github.com/cypherium/ContractExample 目录结构介绍： ├── client //客户端 │ ├── cypher //可执行文件cypher │ ├── jdk //Java Development Kit │ ├── genesis.json //初始化创世区块所需文件 │ ├── db //自定义数据库目录 │ └── executable_file //可执行文件 │ ├── Linux │ │ └── cypher │ ├── Mac │ │ └── cypher │ └── Windows │ └── cypher ├── file2str //class文件生成二进制字符串工具 │ ├── file2str.go //go源码 │ ├── Linux │ │ └── file2str │ ├── Mac │ │ └── file2str │ └── Windows │ └── file2str.exe └── src ├── HelloWorld.java //Java智能合约 ├── index.html //合约部署页面 └── web3.js 接下来的操作步骤，默认在ContractExample/client目录执行。 请根据操作系统，把合适的可执行文件cypher，复制到client下，如： cp executable_file/Mac/cypher ./ 初始化节点的创世区块。datadir为自行指定的数据库目录，如db。 ./cypher --datadir db init genesis.json 启动节点。 ./build/bin/cypher --datadir db --networkid 123666 --port 7000 --rpcport 8000 --rpc --rpccorsdomain &quot;*&quot; --rpcaddr 0.0.0.0 启动节点的js交互窗口(用上一步成的ipc文件)： ./cypher attach db/cypher.ipc 创建账户。 personal.newAccount(&quot;your password&quot;) 请联系我们，给您的测试账户中，转入一些可供测试的代币。邮箱地址：xxx 查看您的账户余额。 cph.getBalance(&quot;your account address&quot;) 您可以通过以下方法，把您账户中的资金转给其他账户。 cph.sendTransaction(from,to,value,gas,gasPrice,data,nonce,Function) from: String - 指定的发送者的地址。 to: String - （可选）交易消息的目标地址，如果是合约创建，则不填。 value: Number|String|BigNumber - （可选）交易携带的货币量，以wei为单位。如果合约创建交易，则为初始的基金。 gas: Number|String|BigNumber - （可选）默认是自动，交易可使用的gas，未使用的gas会退回。 gasPrice: Number|String|BigNumber - （可选）默认是自动确定，交易的gas价格，默认是网络gas价格的平均值 。 data: String - （可选）或者包含相关数据的字节字符串，如果是合约创建，则是初始化要用到的代码。 nonce: Number - （可选）整数，使用此值，可以允许你覆盖你自己的相同nonce的，正在pending中的交易。 Function - 回调函数，用于支持异步的方式执行。 通过以下命令查看现在共识到第几个区块了。 cph.txBlockNumber API ERC20是以太坊定义的一个代币标准。要求我们在实现代币的时候必须要遵守的协议，如指定代币名称、总量、实现代币交易函数等，只有支持了协议才能被以太坊钱包支持。 Cypherium的代币标准接口如下： package javax.cypher; public final class Cypnet { /** * 设置代币信息。 * @param symbol 代币符号 * @param name 代币名称 * @param totalSupply 发行代币总量 * @param _owner 合约拥有者账户地址，传&quot;&quot;空时，代表默认为创建者账户地址 * @return */ public static native boolean setTokenInfo(String symbol, String name, long totalSupply, String _owner); /** * 获取合约创建者的账户地址。 * @param addressType can be &quot;caller&quot;,&quot;self&quot;,&quot;owner&quot; and other filter * @return */ public static native String getAddress(String addressType); /** * 查看对应账号的代币余额。 * @param _address * @return */ public static native long balanceOf(String _address); /** * 修改指定账户余额。 * @param _from * @param _value * @return */ public static native boolean changeBalance(String _from, long _value); /** * 实现代币交易 * @param _from * @param _to * @param _value * @return */ public static native boolean transfer(String _from, String _to, long _value); /** * 设置键值对。 * @param _key * @param _value * @return */ public static native boolean setState(String _key, String _value); /** * 通过键获取值。 * @param _key * @return */ public static native String getState(String _key); static { } } Create contract 现在我们来开始编写第一个Java智能合约，代码如下： import javax.cypher.Cypnet; public class HelloWorld { public static void main(String[] args) { long totalSupply = 10000; //我们创建一个 符号为Hello,名称为Hello world,发行总量为10000的代币。 Cypnet.setTokenInfo(&quot;Hello&quot;, &quot;Hello world&quot;, totalSupply, &quot;&quot;); //把发行的代币全都给合约创建者 Cypnet.changeBalance(&quot;caller&quot;, totalSupply); System.out.println(&quot;Hello&quot;); } public static String transfer(String _to, long _value) { long n = Cypnet.balanceOf(&quot;caller&quot;); if (n &lt; _value) { //throw new Exception(&quot;Insufficient balance&quot;); return &quot;Insufficient balance&quot;; } Cypnet.transfer(&quot;caller&quot;, _to, _value); return null; } public static String getValue(String skey) { String s = Cypnet.getState(skey); return s; } public static String setValue(String skey, String sValue) { Cypnet.setState(skey, sValue); return &quot;ok&quot;; } } 简单解释下，我们定义了一个名为HelloWorld的合约，main方法是Java应用程序的入口方法，导入Cypnet类。 Compile contract 我们来把HelloWorld.java编译成字节码文件HelloWorld.class。编译命令如下： javac -cp jdk/classes ../src/HelloWorld.java 给file2str赋上权限。 chmod -R 777 ../file2str 3.根据操作系统，选择合适的file2str，将 HelloWorld.class文件转成16进制字符串的命令 file2str HelloWorld.class，如Mac版为： ../file2str/Mac/file2str ../src/HelloWorld.class 会看到生成的二进制字符串： 0xcafebabe00000036005a0a001a002d05000000000000271008002e08002f0800300a003100320800330a003100340800350800360a00310037090038003908003a0a003b003c0a0031003d0a0031003e08003f0a003100400800410800420a003b00430800440800450700460700470100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100046d61696e010016285b4c6a6176612f6c616e672f537472696e673b29560100087472616e73666572010027284c6a6176612f6c616e672f537472696e673b4a294c6a6176612f6c616e672f537472696e673b01000d537461636b4d61705461626c6501000867657456616c7565010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000873657456616c7565010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000967657456616c75653101001428294c6a6176612f6c616e672f537472696e673b01000967657456616c75653201000a536f7572636546696c6501000f48656c6c6f576f726c642e6a6176610c001b001c01000548656c6c6f01000b48656c6c6f20776f726c640100000700480c0049004a01000663616c6c65720c004b004c0100047465737401001048656c6c6f20776f726c6420746573740c004d004e07004f0c0050005101001448656c6c6f20776f726c6420436f6e74726163740700520c005300540c005500250c00560057010014496e73756666696369656e742062616c616e63650c00210058010004414141410100026f6b0c0053005901000973647364736473646401000331303001000a48656c6c6f576f726c640100106a6176612f6c616e672f4f626a6563740100136a617661782f6379706865722f4379706e657401000c736574546f6b656e496e666f01003a284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a4c6a6176612f6c616e672f537472696e673b295a01000d6368616e676542616c616e6365010016284c6a6176612f6c616e672f537472696e673b4a295a0100087365745374617465010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b295a0100106a6176612f6c616e672f53797374656d0100036f75740100154c6a6176612f696f2f5072696e7453747265616d3b0100136a6176612f696f2f5072696e7453747265616d0100077072696e746c6e010015284c6a6176612f6c616e672f537472696e673b2956010008676574537461746501000962616c616e63654f66010015284c6a6176612f6c616e672f537472696e673b294a010028284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a295a0100042849295600210019001a0000000000070001001b001c0001001d0000001d00010001000000052ab70001b100000001001e000000060001000000030009001f00200001001d00000068000500040000003414000240120412051f1206b800075712081fb8000957120a120bb8000c57b2000d120eb6000f120ab800104eb2000d2db6000fb100000001001e0000002200080000000500040008000f00090016000b001e000c0026000e002c000f003300100009002100220001001d0000007a00040006000000351208b80011370416041f949c00061212b012082a1fb8001357120ab800104eb2000d2db6000f1214b800104eb2000d2db6000f01b000000002001e0000002600090000001400070015000e0017001100190019001b001f001c0026001e002c001f003300210023000000070001fd001100040009002400250001001d0000002300010002000000072ab800104c2bb000000001001e0000000a000200000025000500260009002600270001001d0000002500020002000000092a2bb8000c571215b000000001001e0000000a0002000000290006002a0009002800290001001d0000004e0002000100000019033b1a112710a20010b2000d1ab60016840001a7ffef1217b000000002001e0000001600050000003e000200400009004100100042001600440023000000070002fc000201130009002a00290001001d0000001b00010000000000031218b000000001001e000000060001000000470001002b00000002002c 部署合约 我们需要用Chrome浏览器打开部署调用页面ContractExample/src/index.html 如下： 如果使用的是其他浏览器，直接打开会有跨域请求问题，所以需要使用http-server来部署该页面,需要自行先安装node和npm，再安装http-server，请依次执行以下命令： npm install http-server -g pm i http-server yarn -g http-server 进入到CypherTestNet/web3-cypher.js目录下，执行 http-server 用浏览器访问http://127.0.0.1:8080 把刚生成的二进制字符串粘到Java contract bytecode文本框。 在From Account账户有余额的情况下，点击Deploy按钮后，会把您的java合约部署到区块链中。并会弹出合约地址信息。 点击Get contract info按钮获取区块链中的合约信息。 在文本框中输入转账金额，并点击Transfer按钮，付款方就会向收款方转账。 点击From’s Balance按钮查看付款账户的余额。 点击To’s Balance按钮查看收款账户的余额。 View deploy contract page 接下来，我们来看看部署调用页面的流程。 web3如何调用java方法 ABI全称Application Binary Interface, 是调用智能合约函数以及合约之间函数调用的消息编码格式定义,也可以理解为智能合约函数调用的接口说明. 类似Webservice里的SOAP协议一样；也就是定义操作函数签名，参数编码，返回结果编码等。使用ABI协议时必须要求在编译时知道类型,即强类型相关. 如果想调用HelloWorld.java中的函数，需要把该函数追加到abi变量中，按照现有格式即可。比如说，我们想要调用HelloWorld.java中的getValue方法，就要把以下内容追加到abi变量中。 var abi= ... , { &quot;constant&quot;:false, //方法修饰符,false表示函数内可以修改状态变量 &quot;inputs&quot;:[ //方法入参，数组里的每个对象都是一个参数说明 { &quot;name&quot;:&quot;skey&quot;, //第一个参数的名字 &quot;type&quot;:&quot;bytes32&quot; //第一个参数的类型 } ], &quot;outputs&quot;:[ //方法返回值，数组里的每个对象都是一个参数说明 { &quot;name&quot;:&quot;value&quot;, //第一个参数的名字 &quot;type&quot;:&quot;bytes32&quot; //第一个参数的类型 } ], &quot;name&quot;:&quot;getValue&quot;, //方法名 &quot;payable&quot;:false, &quot;stateMutability&quot;:&quot;nonpayable&quot;, &quot;type&quot;:&quot;function&quot; //方法类型：function,constructor,fallback,event } ] uint:M为integer类型代表M bits,0 &lt; M &lt;= 256, M % 8 == 0，如uint32，uint8,uint256。 int:同上。同为从8到256位的无符号整数。 uint和int:整型，分别是uint256和int256的别名。这也是上面的例子中函数参数类型是uint，转sha3码时要变成uint256的原因。 address:地址，20个字节，160bits，一个Ethereum地址，地址的类型也可以有成员作为所有合约的base。 bool:布尔类型，1个字节，true：1，false:0。 bytes:固定大小的字节数组，0&lt;M&lt;=32,byte都是bytes1的别名。 bytes:动态分配大小字节数组。不是一个值类型。 String:动态大小UTF8编码的字符串,不是一个值类型。 尽量少用string。 2. 如何发布合约 web3.js对合约的操作进行了封装。发布合约时，可以使用web3.cph.contract的new方法。 部署过程中需要主要的是，new方法的回调会执行两次，第一次是合约的交易创建完成，第二次是在某个地址上完成部署。需要注意的是只有在部署完成后，才能进行方法该用，否则会报错TypeError: javaContract.add is not a function。 阅读更多" />
<meta property="og:description" content="转载请标注原文地址：https://blog.csdn.net/lilyssh/article/details/82911309 代币就是数字货币，比特币、以太币就是一个代币。利用Cypherium的java智能合约可以轻松编写出属于自己的代币。这些代币是建立在区块链之上，代表你拥有并可转让给其他人的数字资产。现在我们就来看看怎样创建一个这样的代币。 准备工作： 下载示例代码。https://github.com/cypherium/ContractExample 目录结构介绍： ├── client //客户端 │ ├── cypher //可执行文件cypher │ ├── jdk //Java Development Kit │ ├── genesis.json //初始化创世区块所需文件 │ ├── db //自定义数据库目录 │ └── executable_file //可执行文件 │ ├── Linux │ │ └── cypher │ ├── Mac │ │ └── cypher │ └── Windows │ └── cypher ├── file2str //class文件生成二进制字符串工具 │ ├── file2str.go //go源码 │ ├── Linux │ │ └── file2str │ ├── Mac │ │ └── file2str │ └── Windows │ └── file2str.exe └── src ├── HelloWorld.java //Java智能合约 ├── index.html //合约部署页面 └── web3.js 接下来的操作步骤，默认在ContractExample/client目录执行。 请根据操作系统，把合适的可执行文件cypher，复制到client下，如： cp executable_file/Mac/cypher ./ 初始化节点的创世区块。datadir为自行指定的数据库目录，如db。 ./cypher --datadir db init genesis.json 启动节点。 ./build/bin/cypher --datadir db --networkid 123666 --port 7000 --rpcport 8000 --rpc --rpccorsdomain &quot;*&quot; --rpcaddr 0.0.0.0 启动节点的js交互窗口(用上一步成的ipc文件)： ./cypher attach db/cypher.ipc 创建账户。 personal.newAccount(&quot;your password&quot;) 请联系我们，给您的测试账户中，转入一些可供测试的代币。邮箱地址：xxx 查看您的账户余额。 cph.getBalance(&quot;your account address&quot;) 您可以通过以下方法，把您账户中的资金转给其他账户。 cph.sendTransaction(from,to,value,gas,gasPrice,data,nonce,Function) from: String - 指定的发送者的地址。 to: String - （可选）交易消息的目标地址，如果是合约创建，则不填。 value: Number|String|BigNumber - （可选）交易携带的货币量，以wei为单位。如果合约创建交易，则为初始的基金。 gas: Number|String|BigNumber - （可选）默认是自动，交易可使用的gas，未使用的gas会退回。 gasPrice: Number|String|BigNumber - （可选）默认是自动确定，交易的gas价格，默认是网络gas价格的平均值 。 data: String - （可选）或者包含相关数据的字节字符串，如果是合约创建，则是初始化要用到的代码。 nonce: Number - （可选）整数，使用此值，可以允许你覆盖你自己的相同nonce的，正在pending中的交易。 Function - 回调函数，用于支持异步的方式执行。 通过以下命令查看现在共识到第几个区块了。 cph.txBlockNumber API ERC20是以太坊定义的一个代币标准。要求我们在实现代币的时候必须要遵守的协议，如指定代币名称、总量、实现代币交易函数等，只有支持了协议才能被以太坊钱包支持。 Cypherium的代币标准接口如下： package javax.cypher; public final class Cypnet { /** * 设置代币信息。 * @param symbol 代币符号 * @param name 代币名称 * @param totalSupply 发行代币总量 * @param _owner 合约拥有者账户地址，传&quot;&quot;空时，代表默认为创建者账户地址 * @return */ public static native boolean setTokenInfo(String symbol, String name, long totalSupply, String _owner); /** * 获取合约创建者的账户地址。 * @param addressType can be &quot;caller&quot;,&quot;self&quot;,&quot;owner&quot; and other filter * @return */ public static native String getAddress(String addressType); /** * 查看对应账号的代币余额。 * @param _address * @return */ public static native long balanceOf(String _address); /** * 修改指定账户余额。 * @param _from * @param _value * @return */ public static native boolean changeBalance(String _from, long _value); /** * 实现代币交易 * @param _from * @param _to * @param _value * @return */ public static native boolean transfer(String _from, String _to, long _value); /** * 设置键值对。 * @param _key * @param _value * @return */ public static native boolean setState(String _key, String _value); /** * 通过键获取值。 * @param _key * @return */ public static native String getState(String _key); static { } } Create contract 现在我们来开始编写第一个Java智能合约，代码如下： import javax.cypher.Cypnet; public class HelloWorld { public static void main(String[] args) { long totalSupply = 10000; //我们创建一个 符号为Hello,名称为Hello world,发行总量为10000的代币。 Cypnet.setTokenInfo(&quot;Hello&quot;, &quot;Hello world&quot;, totalSupply, &quot;&quot;); //把发行的代币全都给合约创建者 Cypnet.changeBalance(&quot;caller&quot;, totalSupply); System.out.println(&quot;Hello&quot;); } public static String transfer(String _to, long _value) { long n = Cypnet.balanceOf(&quot;caller&quot;); if (n &lt; _value) { //throw new Exception(&quot;Insufficient balance&quot;); return &quot;Insufficient balance&quot;; } Cypnet.transfer(&quot;caller&quot;, _to, _value); return null; } public static String getValue(String skey) { String s = Cypnet.getState(skey); return s; } public static String setValue(String skey, String sValue) { Cypnet.setState(skey, sValue); return &quot;ok&quot;; } } 简单解释下，我们定义了一个名为HelloWorld的合约，main方法是Java应用程序的入口方法，导入Cypnet类。 Compile contract 我们来把HelloWorld.java编译成字节码文件HelloWorld.class。编译命令如下： javac -cp jdk/classes ../src/HelloWorld.java 给file2str赋上权限。 chmod -R 777 ../file2str 3.根据操作系统，选择合适的file2str，将 HelloWorld.class文件转成16进制字符串的命令 file2str HelloWorld.class，如Mac版为： ../file2str/Mac/file2str ../src/HelloWorld.class 会看到生成的二进制字符串： 0xcafebabe00000036005a0a001a002d05000000000000271008002e08002f0800300a003100320800330a003100340800350800360a00310037090038003908003a0a003b003c0a0031003d0a0031003e08003f0a003100400800410800420a003b00430800440800450700460700470100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100046d61696e010016285b4c6a6176612f6c616e672f537472696e673b29560100087472616e73666572010027284c6a6176612f6c616e672f537472696e673b4a294c6a6176612f6c616e672f537472696e673b01000d537461636b4d61705461626c6501000867657456616c7565010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000873657456616c7565010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000967657456616c75653101001428294c6a6176612f6c616e672f537472696e673b01000967657456616c75653201000a536f7572636546696c6501000f48656c6c6f576f726c642e6a6176610c001b001c01000548656c6c6f01000b48656c6c6f20776f726c640100000700480c0049004a01000663616c6c65720c004b004c0100047465737401001048656c6c6f20776f726c6420746573740c004d004e07004f0c0050005101001448656c6c6f20776f726c6420436f6e74726163740700520c005300540c005500250c00560057010014496e73756666696369656e742062616c616e63650c00210058010004414141410100026f6b0c0053005901000973647364736473646401000331303001000a48656c6c6f576f726c640100106a6176612f6c616e672f4f626a6563740100136a617661782f6379706865722f4379706e657401000c736574546f6b656e496e666f01003a284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a4c6a6176612f6c616e672f537472696e673b295a01000d6368616e676542616c616e6365010016284c6a6176612f6c616e672f537472696e673b4a295a0100087365745374617465010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b295a0100106a6176612f6c616e672f53797374656d0100036f75740100154c6a6176612f696f2f5072696e7453747265616d3b0100136a6176612f696f2f5072696e7453747265616d0100077072696e746c6e010015284c6a6176612f6c616e672f537472696e673b2956010008676574537461746501000962616c616e63654f66010015284c6a6176612f6c616e672f537472696e673b294a010028284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a295a0100042849295600210019001a0000000000070001001b001c0001001d0000001d00010001000000052ab70001b100000001001e000000060001000000030009001f00200001001d00000068000500040000003414000240120412051f1206b800075712081fb8000957120a120bb8000c57b2000d120eb6000f120ab800104eb2000d2db6000fb100000001001e0000002200080000000500040008000f00090016000b001e000c0026000e002c000f003300100009002100220001001d0000007a00040006000000351208b80011370416041f949c00061212b012082a1fb8001357120ab800104eb2000d2db6000f1214b800104eb2000d2db6000f01b000000002001e0000002600090000001400070015000e0017001100190019001b001f001c0026001e002c001f003300210023000000070001fd001100040009002400250001001d0000002300010002000000072ab800104c2bb000000001001e0000000a000200000025000500260009002600270001001d0000002500020002000000092a2bb8000c571215b000000001001e0000000a0002000000290006002a0009002800290001001d0000004e0002000100000019033b1a112710a20010b2000d1ab60016840001a7ffef1217b000000002001e0000001600050000003e000200400009004100100042001600440023000000070002fc000201130009002a00290001001d0000001b00010000000000031218b000000001001e000000060001000000470001002b00000002002c 部署合约 我们需要用Chrome浏览器打开部署调用页面ContractExample/src/index.html 如下： 如果使用的是其他浏览器，直接打开会有跨域请求问题，所以需要使用http-server来部署该页面,需要自行先安装node和npm，再安装http-server，请依次执行以下命令： npm install http-server -g pm i http-server yarn -g http-server 进入到CypherTestNet/web3-cypher.js目录下，执行 http-server 用浏览器访问http://127.0.0.1:8080 把刚生成的二进制字符串粘到Java contract bytecode文本框。 在From Account账户有余额的情况下，点击Deploy按钮后，会把您的java合约部署到区块链中。并会弹出合约地址信息。 点击Get contract info按钮获取区块链中的合约信息。 在文本框中输入转账金额，并点击Transfer按钮，付款方就会向收款方转账。 点击From’s Balance按钮查看付款账户的余额。 点击To’s Balance按钮查看收款账户的余额。 View deploy contract page 接下来，我们来看看部署调用页面的流程。 web3如何调用java方法 ABI全称Application Binary Interface, 是调用智能合约函数以及合约之间函数调用的消息编码格式定义,也可以理解为智能合约函数调用的接口说明. 类似Webservice里的SOAP协议一样；也就是定义操作函数签名，参数编码，返回结果编码等。使用ABI协议时必须要求在编译时知道类型,即强类型相关. 如果想调用HelloWorld.java中的函数，需要把该函数追加到abi变量中，按照现有格式即可。比如说，我们想要调用HelloWorld.java中的getValue方法，就要把以下内容追加到abi变量中。 var abi= ... , { &quot;constant&quot;:false, //方法修饰符,false表示函数内可以修改状态变量 &quot;inputs&quot;:[ //方法入参，数组里的每个对象都是一个参数说明 { &quot;name&quot;:&quot;skey&quot;, //第一个参数的名字 &quot;type&quot;:&quot;bytes32&quot; //第一个参数的类型 } ], &quot;outputs&quot;:[ //方法返回值，数组里的每个对象都是一个参数说明 { &quot;name&quot;:&quot;value&quot;, //第一个参数的名字 &quot;type&quot;:&quot;bytes32&quot; //第一个参数的类型 } ], &quot;name&quot;:&quot;getValue&quot;, //方法名 &quot;payable&quot;:false, &quot;stateMutability&quot;:&quot;nonpayable&quot;, &quot;type&quot;:&quot;function&quot; //方法类型：function,constructor,fallback,event } ] uint:M为integer类型代表M bits,0 &lt; M &lt;= 256, M % 8 == 0，如uint32，uint8,uint256。 int:同上。同为从8到256位的无符号整数。 uint和int:整型，分别是uint256和int256的别名。这也是上面的例子中函数参数类型是uint，转sha3码时要变成uint256的原因。 address:地址，20个字节，160bits，一个Ethereum地址，地址的类型也可以有成员作为所有合约的base。 bool:布尔类型，1个字节，true：1，false:0。 bytes:固定大小的字节数组，0&lt;M&lt;=32,byte都是bytes1的别名。 bytes:动态分配大小字节数组。不是一个值类型。 String:动态大小UTF8编码的字符串,不是一个值类型。 尽量少用string。 2. 如何发布合约 web3.js对合约的操作进行了封装。发布合约时，可以使用web3.cph.contract的new方法。 部署过程中需要主要的是，new方法的回调会执行两次，第一次是合约的交易创建完成，第二次是在某个地址上完成部署。需要注意的是只有在部署完成后，才能进行方法该用，否则会报错TypeError: javaContract.add is not a function。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/09/30/bcbd56b42fa39656b857db17345e5794.html" />
<meta property="og:url" content="https://mlh.app/2018/09/30/bcbd56b42fa39656b857db17345e5794.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-30T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"转载请标注原文地址：https://blog.csdn.net/lilyssh/article/details/82911309 代币就是数字货币，比特币、以太币就是一个代币。利用Cypherium的java智能合约可以轻松编写出属于自己的代币。这些代币是建立在区块链之上，代表你拥有并可转让给其他人的数字资产。现在我们就来看看怎样创建一个这样的代币。 准备工作： 下载示例代码。https://github.com/cypherium/ContractExample 目录结构介绍： ├── client //客户端 │ ├── cypher //可执行文件cypher │ ├── jdk //Java Development Kit │ ├── genesis.json //初始化创世区块所需文件 │ ├── db //自定义数据库目录 │ └── executable_file //可执行文件 │ ├── Linux │ │ └── cypher │ ├── Mac │ │ └── cypher │ └── Windows │ └── cypher ├── file2str //class文件生成二进制字符串工具 │ ├── file2str.go //go源码 │ ├── Linux │ │ └── file2str │ ├── Mac │ │ └── file2str │ └── Windows │ └── file2str.exe └── src ├── HelloWorld.java //Java智能合约 ├── index.html //合约部署页面 └── web3.js 接下来的操作步骤，默认在ContractExample/client目录执行。 请根据操作系统，把合适的可执行文件cypher，复制到client下，如： cp executable_file/Mac/cypher ./ 初始化节点的创世区块。datadir为自行指定的数据库目录，如db。 ./cypher --datadir db init genesis.json 启动节点。 ./build/bin/cypher --datadir db --networkid 123666 --port 7000 --rpcport 8000 --rpc --rpccorsdomain &quot;*&quot; --rpcaddr 0.0.0.0 启动节点的js交互窗口(用上一步成的ipc文件)： ./cypher attach db/cypher.ipc 创建账户。 personal.newAccount(&quot;your password&quot;) 请联系我们，给您的测试账户中，转入一些可供测试的代币。邮箱地址：xxx 查看您的账户余额。 cph.getBalance(&quot;your account address&quot;) 您可以通过以下方法，把您账户中的资金转给其他账户。 cph.sendTransaction(from,to,value,gas,gasPrice,data,nonce,Function) from: String - 指定的发送者的地址。 to: String - （可选）交易消息的目标地址，如果是合约创建，则不填。 value: Number|String|BigNumber - （可选）交易携带的货币量，以wei为单位。如果合约创建交易，则为初始的基金。 gas: Number|String|BigNumber - （可选）默认是自动，交易可使用的gas，未使用的gas会退回。 gasPrice: Number|String|BigNumber - （可选）默认是自动确定，交易的gas价格，默认是网络gas价格的平均值 。 data: String - （可选）或者包含相关数据的字节字符串，如果是合约创建，则是初始化要用到的代码。 nonce: Number - （可选）整数，使用此值，可以允许你覆盖你自己的相同nonce的，正在pending中的交易。 Function - 回调函数，用于支持异步的方式执行。 通过以下命令查看现在共识到第几个区块了。 cph.txBlockNumber API ERC20是以太坊定义的一个代币标准。要求我们在实现代币的时候必须要遵守的协议，如指定代币名称、总量、实现代币交易函数等，只有支持了协议才能被以太坊钱包支持。 Cypherium的代币标准接口如下： package javax.cypher; public final class Cypnet { /** * 设置代币信息。 * @param symbol 代币符号 * @param name 代币名称 * @param totalSupply 发行代币总量 * @param _owner 合约拥有者账户地址，传&quot;&quot;空时，代表默认为创建者账户地址 * @return */ public static native boolean setTokenInfo(String symbol, String name, long totalSupply, String _owner); /** * 获取合约创建者的账户地址。 * @param addressType can be &quot;caller&quot;,&quot;self&quot;,&quot;owner&quot; and other filter * @return */ public static native String getAddress(String addressType); /** * 查看对应账号的代币余额。 * @param _address * @return */ public static native long balanceOf(String _address); /** * 修改指定账户余额。 * @param _from * @param _value * @return */ public static native boolean changeBalance(String _from, long _value); /** * 实现代币交易 * @param _from * @param _to * @param _value * @return */ public static native boolean transfer(String _from, String _to, long _value); /** * 设置键值对。 * @param _key * @param _value * @return */ public static native boolean setState(String _key, String _value); /** * 通过键获取值。 * @param _key * @return */ public static native String getState(String _key); static { } } Create contract 现在我们来开始编写第一个Java智能合约，代码如下： import javax.cypher.Cypnet; public class HelloWorld { public static void main(String[] args) { long totalSupply = 10000; //我们创建一个 符号为Hello,名称为Hello world,发行总量为10000的代币。 Cypnet.setTokenInfo(&quot;Hello&quot;, &quot;Hello world&quot;, totalSupply, &quot;&quot;); //把发行的代币全都给合约创建者 Cypnet.changeBalance(&quot;caller&quot;, totalSupply); System.out.println(&quot;Hello&quot;); } public static String transfer(String _to, long _value) { long n = Cypnet.balanceOf(&quot;caller&quot;); if (n &lt; _value) { //throw new Exception(&quot;Insufficient balance&quot;); return &quot;Insufficient balance&quot;; } Cypnet.transfer(&quot;caller&quot;, _to, _value); return null; } public static String getValue(String skey) { String s = Cypnet.getState(skey); return s; } public static String setValue(String skey, String sValue) { Cypnet.setState(skey, sValue); return &quot;ok&quot;; } } 简单解释下，我们定义了一个名为HelloWorld的合约，main方法是Java应用程序的入口方法，导入Cypnet类。 Compile contract 我们来把HelloWorld.java编译成字节码文件HelloWorld.class。编译命令如下： javac -cp jdk/classes ../src/HelloWorld.java 给file2str赋上权限。 chmod -R 777 ../file2str 3.根据操作系统，选择合适的file2str，将 HelloWorld.class文件转成16进制字符串的命令 file2str HelloWorld.class，如Mac版为： ../file2str/Mac/file2str ../src/HelloWorld.class 会看到生成的二进制字符串： 0xcafebabe00000036005a0a001a002d05000000000000271008002e08002f0800300a003100320800330a003100340800350800360a00310037090038003908003a0a003b003c0a0031003d0a0031003e08003f0a003100400800410800420a003b00430800440800450700460700470100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100046d61696e010016285b4c6a6176612f6c616e672f537472696e673b29560100087472616e73666572010027284c6a6176612f6c616e672f537472696e673b4a294c6a6176612f6c616e672f537472696e673b01000d537461636b4d61705461626c6501000867657456616c7565010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000873657456616c7565010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000967657456616c75653101001428294c6a6176612f6c616e672f537472696e673b01000967657456616c75653201000a536f7572636546696c6501000f48656c6c6f576f726c642e6a6176610c001b001c01000548656c6c6f01000b48656c6c6f20776f726c640100000700480c0049004a01000663616c6c65720c004b004c0100047465737401001048656c6c6f20776f726c6420746573740c004d004e07004f0c0050005101001448656c6c6f20776f726c6420436f6e74726163740700520c005300540c005500250c00560057010014496e73756666696369656e742062616c616e63650c00210058010004414141410100026f6b0c0053005901000973647364736473646401000331303001000a48656c6c6f576f726c640100106a6176612f6c616e672f4f626a6563740100136a617661782f6379706865722f4379706e657401000c736574546f6b656e496e666f01003a284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a4c6a6176612f6c616e672f537472696e673b295a01000d6368616e676542616c616e6365010016284c6a6176612f6c616e672f537472696e673b4a295a0100087365745374617465010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b295a0100106a6176612f6c616e672f53797374656d0100036f75740100154c6a6176612f696f2f5072696e7453747265616d3b0100136a6176612f696f2f5072696e7453747265616d0100077072696e746c6e010015284c6a6176612f6c616e672f537472696e673b2956010008676574537461746501000962616c616e63654f66010015284c6a6176612f6c616e672f537472696e673b294a010028284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a295a0100042849295600210019001a0000000000070001001b001c0001001d0000001d00010001000000052ab70001b100000001001e000000060001000000030009001f00200001001d00000068000500040000003414000240120412051f1206b800075712081fb8000957120a120bb8000c57b2000d120eb6000f120ab800104eb2000d2db6000fb100000001001e0000002200080000000500040008000f00090016000b001e000c0026000e002c000f003300100009002100220001001d0000007a00040006000000351208b80011370416041f949c00061212b012082a1fb8001357120ab800104eb2000d2db6000f1214b800104eb2000d2db6000f01b000000002001e0000002600090000001400070015000e0017001100190019001b001f001c0026001e002c001f003300210023000000070001fd001100040009002400250001001d0000002300010002000000072ab800104c2bb000000001001e0000000a000200000025000500260009002600270001001d0000002500020002000000092a2bb8000c571215b000000001001e0000000a0002000000290006002a0009002800290001001d0000004e0002000100000019033b1a112710a20010b2000d1ab60016840001a7ffef1217b000000002001e0000001600050000003e000200400009004100100042001600440023000000070002fc000201130009002a00290001001d0000001b00010000000000031218b000000001001e000000060001000000470001002b00000002002c 部署合约 我们需要用Chrome浏览器打开部署调用页面ContractExample/src/index.html 如下： 如果使用的是其他浏览器，直接打开会有跨域请求问题，所以需要使用http-server来部署该页面,需要自行先安装node和npm，再安装http-server，请依次执行以下命令： npm install http-server -g pm i http-server yarn -g http-server 进入到CypherTestNet/web3-cypher.js目录下，执行 http-server 用浏览器访问http://127.0.0.1:8080 把刚生成的二进制字符串粘到Java contract bytecode文本框。 在From Account账户有余额的情况下，点击Deploy按钮后，会把您的java合约部署到区块链中。并会弹出合约地址信息。 点击Get contract info按钮获取区块链中的合约信息。 在文本框中输入转账金额，并点击Transfer按钮，付款方就会向收款方转账。 点击From’s Balance按钮查看付款账户的余额。 点击To’s Balance按钮查看收款账户的余额。 View deploy contract page 接下来，我们来看看部署调用页面的流程。 web3如何调用java方法 ABI全称Application Binary Interface, 是调用智能合约函数以及合约之间函数调用的消息编码格式定义,也可以理解为智能合约函数调用的接口说明. 类似Webservice里的SOAP协议一样；也就是定义操作函数签名，参数编码，返回结果编码等。使用ABI协议时必须要求在编译时知道类型,即强类型相关. 如果想调用HelloWorld.java中的函数，需要把该函数追加到abi变量中，按照现有格式即可。比如说，我们想要调用HelloWorld.java中的getValue方法，就要把以下内容追加到abi变量中。 var abi= ... , { &quot;constant&quot;:false, //方法修饰符,false表示函数内可以修改状态变量 &quot;inputs&quot;:[ //方法入参，数组里的每个对象都是一个参数说明 { &quot;name&quot;:&quot;skey&quot;, //第一个参数的名字 &quot;type&quot;:&quot;bytes32&quot; //第一个参数的类型 } ], &quot;outputs&quot;:[ //方法返回值，数组里的每个对象都是一个参数说明 { &quot;name&quot;:&quot;value&quot;, //第一个参数的名字 &quot;type&quot;:&quot;bytes32&quot; //第一个参数的类型 } ], &quot;name&quot;:&quot;getValue&quot;, //方法名 &quot;payable&quot;:false, &quot;stateMutability&quot;:&quot;nonpayable&quot;, &quot;type&quot;:&quot;function&quot; //方法类型：function,constructor,fallback,event } ] uint:M为integer类型代表M bits,0 &lt; M &lt;= 256, M % 8 == 0，如uint32，uint8,uint256。 int:同上。同为从8到256位的无符号整数。 uint和int:整型，分别是uint256和int256的别名。这也是上面的例子中函数参数类型是uint，转sha3码时要变成uint256的原因。 address:地址，20个字节，160bits，一个Ethereum地址，地址的类型也可以有成员作为所有合约的base。 bool:布尔类型，1个字节，true：1，false:0。 bytes:固定大小的字节数组，0&lt;M&lt;=32,byte都是bytes1的别名。 bytes:动态分配大小字节数组。不是一个值类型。 String:动态大小UTF8编码的字符串,不是一个值类型。 尽量少用string。 2. 如何发布合约 web3.js对合约的操作进行了封装。发布合约时，可以使用web3.cph.contract的new方法。 部署过程中需要主要的是，new方法的回调会执行两次，第一次是合约的交易创建完成，第二次是在某个地址上完成部署。需要注意的是只有在部署完成后，才能进行方法该用，否则会报错TypeError: javaContract.add is not a function。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/09/30/bcbd56b42fa39656b857db17345e5794.html","headline":"Cypherium Java 智能合约编程指南","dateModified":"2018-09-30T00:00:00+08:00","datePublished":"2018-09-30T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/09/30/bcbd56b42fa39656b857db17345e5794.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Cypherium Java 智能合约编程指南</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>转载请标注原文地址：<a href="https://blog.csdn.net/lilyssh/article/details/82911309" rel="nofollow">https://blog.csdn.net/lilyssh/article/details/82911309</a></p> 
  <p>代币就是数字货币，比特币、以太币就是一个代币。利用Cypherium的java智能合约可以轻松编写出属于自己的代币。这些代币是建立在区块链之上，代表你拥有并可转让给其他人的数字资产。现在我们就来看看怎样创建一个这样的代币。</p> 
  <h1><a id="_4"></a>准备工作：</h1> 
  <ol> 
   <li>下载示例代码。<a href="https://github.com/cypherium/ContractExample" rel="nofollow">https://github.com/cypherium/ContractExample</a><br> 目录结构介绍：</li> 
  </ol> 
  <pre><code>├── client              //客户端
│   ├── cypher          //可执行文件cypher
│   ├── jdk             //Java Development Kit
│   ├── genesis.json    //初始化创世区块所需文件
│   ├── db              //自定义数据库目录
│   └── executable_file //可执行文件
│       ├── Linux 
│       │    └── cypher
│       ├── Mac 
│       │    └── cypher
│       └── Windows 
│            └── cypher
├── file2str            //class文件生成二进制字符串工具
│   ├── file2str.go     //go源码
│   ├── Linux  
│   │   └── file2str
│   ├── Mac  
│   │   └── file2str
│   └── Windows     
│       └── file2str.exe
└── src
    ├── HelloWorld.java //Java智能合约
    ├── index.html      //合约部署页面
    └── web3.js
</code></pre> 
  <p>接下来的操作步骤，默认在<code>ContractExample/client</code>目录执行。<br> 请根据操作系统，把合适的可执行文件cypher，复制到client下，如：</p> 
  <pre><code>cp executable_file/Mac/cypher ./
</code></pre> 
  <ol start="2"> 
   <li>初始化节点的创世区块。datadir为自行指定的数据库目录，如db。</li> 
  </ol> 
  <pre><code>./cypher --datadir db init genesis.json
</code></pre> 
  <ol start="3"> 
   <li>启动节点。</li> 
  </ol> 
  <pre><code>./build/bin/cypher --datadir db --networkid 123666 --port 7000 --rpcport 8000  --rpc --rpccorsdomain "*" --rpcaddr 0.0.0.0
</code></pre> 
  <ol start="4"> 
   <li>启动节点的js交互窗口(用上一步成的ipc文件)：</li> 
  </ol> 
  <pre><code>./cypher attach db/cypher.ipc
</code></pre> 
  <ol start="5"> 
   <li>创建账户。</li> 
  </ol> 
  <pre><code>personal.newAccount("your password")
</code></pre> 
  <ol start="6"> 
   <li>请联系我们，给您的测试账户中，转入一些可供测试的代币。邮箱地址：xxx</li> 
   <li>查看您的账户余额。</li> 
  </ol> 
  <pre><code>cph.getBalance("your account address")
</code></pre> 
  <ol start="8"> 
   <li>您可以通过以下方法，把您账户中的资金转给其他账户。</li> 
  </ol> 
  <pre><code>cph.sendTransaction(from,to,value,gas,gasPrice,data,nonce,Function)
</code></pre> 
  <ul> 
   <li>from: String - 指定的发送者的地址。</li> 
   <li>to: String - （可选）交易消息的目标地址，如果是合约创建，则不填。</li> 
   <li>value: Number|String|BigNumber - （可选）交易携带的货币量，以wei为单位。如果合约创建交易，则为初始的基金。</li> 
   <li>gas: Number|String|BigNumber - （可选）默认是自动，交易可使用的gas，未使用的gas会退回。</li> 
   <li>gasPrice: Number|String|BigNumber - （可选）默认是自动确定，交易的gas价格，默认是网络gas价格的平均值 。</li> 
   <li>data: String - （可选）或者包含相关数据的字节字符串，如果是合约创建，则是初始化要用到的代码。</li> 
   <li>nonce: Number - （可选）整数，使用此值，可以允许你覆盖你自己的相同nonce的，正在pending中的交易。</li> 
   <li>Function - 回调函数，用于支持异步的方式执行。</li> 
  </ul> 
  <ol start="9"> 
   <li>通过以下命令查看现在共识到第几个区块了。</li> 
  </ol> 
  <pre><code>cph.txBlockNumber
</code></pre> 
  <h1><a id="API_82"></a>API</h1> 
  <p>ERC20是以太坊定义的一个代币标准。要求我们在实现代币的时候必须要遵守的协议，如指定代币名称、总量、实现代币交易函数等，只有支持了协议才能被以太坊钱包支持。<br> Cypherium的代币标准接口如下：</p> 
  <pre><code class="prism language-java"><span class="token keyword">package</span> javax<span class="token punctuation">.</span>cypher<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Cypnet</span> <span class="token punctuation">{</span>
    <span class="token comment">/** * 设置代币信息。 * @param symbol 代币符号 * @param name 代币名称 * @param totalSupply 发行代币总量 * @param _owner 合约拥有者账户地址，传""空时，代表默认为创建者账户地址 * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">setTokenInfo</span><span class="token punctuation">(</span>String symbol<span class="token punctuation">,</span> String name<span class="token punctuation">,</span> <span class="token keyword">long</span> totalSupply<span class="token punctuation">,</span> String _owner<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** * 获取合约创建者的账户地址。 * @param addressType can be "caller","self","owner" and other filter * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> String <span class="token function">getAddress</span><span class="token punctuation">(</span>String addressType<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">/** * 查看对应账号的代币余额。 * @param _address * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">long</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span>String _address<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** * 修改指定账户余额。 * @param _from * @param _value * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">changeBalance</span><span class="token punctuation">(</span>String _from<span class="token punctuation">,</span> <span class="token keyword">long</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** * 实现代币交易 * @param _from * @param _to * @param _value * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">transfer</span><span class="token punctuation">(</span>String _from<span class="token punctuation">,</span> String _to<span class="token punctuation">,</span> <span class="token keyword">long</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** * 设置键值对。 * @param _key * @param _value * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">setState</span><span class="token punctuation">(</span>String _key<span class="token punctuation">,</span> String _value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** * 通过键获取值。 * @param _key * @return */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> String <span class="token function">getState</span><span class="token punctuation">(</span>String _key<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
  <h1><a id="Create_contract_149"></a>Create contract</h1> 
  <p>现在我们来开始编写第一个<a href="https://github.com/cypherium/ContractExample/blob/master/src/HelloWorld.java" rel="nofollow">Java智能合约</a>，代码如下：</p> 
  <pre><code class="prism language-java"><span class="token keyword">import</span> javax<span class="token punctuation">.</span>cypher<span class="token punctuation">.</span>Cypnet<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> totalSupply <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
        <span class="token comment">//我们创建一个 符号为Hello,名称为Hello world,发行总量为10000的代币。</span>
        Cypnet<span class="token punctuation">.</span><span class="token function">setTokenInfo</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Hello world"</span><span class="token punctuation">,</span> totalSupply<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//把发行的代币全都给合约创建者</span>
        Cypnet<span class="token punctuation">.</span><span class="token function">changeBalance</span><span class="token punctuation">(</span><span class="token string">"caller"</span><span class="token punctuation">,</span> totalSupply<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">transfer</span><span class="token punctuation">(</span>String _to<span class="token punctuation">,</span> <span class="token keyword">long</span> _value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> n <span class="token operator">=</span> Cypnet<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token string">"caller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> _value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//throw new Exception("Insufficient balance");</span>
            <span class="token keyword">return</span> <span class="token string">"Insufficient balance"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Cypnet<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token string">"caller"</span><span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getValue</span><span class="token punctuation">(</span>String skey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String s <span class="token operator">=</span> Cypnet<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span>skey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">setValue</span><span class="token punctuation">(</span>String skey<span class="token punctuation">,</span> String sValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Cypnet<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>skey<span class="token punctuation">,</span> sValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
  <p>简单解释下，我们定义了一个名为HelloWorld的合约，main方法是Java应用程序的入口方法，导入Cypnet类。</p> 
  <h1><a id="Compile_contract_186"></a>Compile contract</h1> 
  <ol> 
   <li>我们来把HelloWorld.java编译成字节码文件HelloWorld.class。编译命令如下：</li> 
  </ol> 
  <pre><code>javac -cp jdk/classes ../src/HelloWorld.java
</code></pre> 
  <ol start="2"> 
   <li>给<a href="https://github.com/cypherium/ContractExample/tree/master/file2str" rel="nofollow">file2str</a>赋上权限。</li> 
  </ol> 
  <pre><code>chmod -R 777 ../file2str
</code></pre> 
  <p>3.根据操作系统，选择合适的<code>file2str</code>，将 HelloWorld.class文件转成16进制字符串的命令 file2str HelloWorld.class，如Mac版为：</p> 
  <pre><code>../file2str/Mac/file2str ../src/HelloWorld.class
</code></pre> 
  <p>会看到生成的二进制字符串：</p> 
  <pre><code>0xcafebabe00000036005a0a001a002d05000000000000271008002e08002f0800300a003100320800330a003100340800350800360a00310037090038003908003a0a003b003c0a0031003d0a0031003e08003f0a003100400800410800420a003b00430800440800450700460700470100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100046d61696e010016285b4c6a6176612f6c616e672f537472696e673b29560100087472616e73666572010027284c6a6176612f6c616e672f537472696e673b4a294c6a6176612f6c616e672f537472696e673b01000d537461636b4d61705461626c6501000867657456616c7565010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000873657456616c7565010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b01000967657456616c75653101001428294c6a6176612f6c616e672f537472696e673b01000967657456616c75653201000a536f7572636546696c6501000f48656c6c6f576f726c642e6a6176610c001b001c01000548656c6c6f01000b48656c6c6f20776f726c640100000700480c0049004a01000663616c6c65720c004b004c0100047465737401001048656c6c6f20776f726c6420746573740c004d004e07004f0c0050005101001448656c6c6f20776f726c6420436f6e74726163740700520c005300540c005500250c00560057010014496e73756666696369656e742062616c616e63650c00210058010004414141410100026f6b0c0053005901000973647364736473646401000331303001000a48656c6c6f576f726c640100106a6176612f6c616e672f4f626a6563740100136a617661782f6379706865722f4379706e657401000c736574546f6b656e496e666f01003a284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a4c6a6176612f6c616e672f537472696e673b295a01000d6368616e676542616c616e6365010016284c6a6176612f6c616e672f537472696e673b4a295a0100087365745374617465010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b295a0100106a6176612f6c616e672f53797374656d0100036f75740100154c6a6176612f696f2f5072696e7453747265616d3b0100136a6176612f696f2f5072696e7453747265616d0100077072696e746c6e010015284c6a6176612f6c616e672f537472696e673b2956010008676574537461746501000962616c616e63654f66010015284c6a6176612f6c616e672f537472696e673b294a010028284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b4a295a0100042849295600210019001a0000000000070001001b001c0001001d0000001d00010001000000052ab70001b100000001001e000000060001000000030009001f00200001001d00000068000500040000003414000240120412051f1206b800075712081fb8000957120a120bb8000c57b2000d120eb6000f120ab800104eb2000d2db6000fb100000001001e0000002200080000000500040008000f00090016000b001e000c0026000e002c000f003300100009002100220001001d0000007a00040006000000351208b80011370416041f949c00061212b012082a1fb8001357120ab800104eb2000d2db6000f1214b800104eb2000d2db6000f01b000000002001e0000002600090000001400070015000e0017001100190019001b001f001c0026001e002c001f003300210023000000070001fd001100040009002400250001001d0000002300010002000000072ab800104c2bb000000001001e0000000a000200000025000500260009002600270001001d0000002500020002000000092a2bb8000c571215b000000001001e0000000a0002000000290006002a0009002800290001001d0000004e0002000100000019033b1a112710a20010b2000d1ab60016840001a7ffef1217b000000002001e0000001600050000003e000200400009004100100042001600440023000000070002fc000201130009002a00290001001d0000001b00010000000000031218b000000001001e000000060001000000470001002b00000002002c
</code></pre> 
  <ol start="4"> 
   <li>部署合约<br> 我们需要用<code>Chrome</code>浏览器打开部署调用页面ContractExample/src/index.html<br> 如下：<br> <img src="https://resource.lilyssh.cn/pic/java_contract_init.png" alt=""></li> 
  </ol> 
  <p>如果使用的是其他浏览器，直接打开会有跨域请求问题，所以需要使用http-server来部署该页面,需要自行先安装node和npm，再安装http-server，请依次执行以下命令：</p> 
  <pre><code>npm install http-server -g 

pm i http-server

yarn -g http-server
</code></pre> 
  <p>进入到CypherTestNet/web3-cypher.js目录下，执行</p> 
  <pre><code>http-server
</code></pre> 
  <p>用浏览器访问http://127.0.0.1:8080 把刚生成的二进制字符串粘到Java contract bytecode文本框。<br> 在From Account账户有余额的情况下，点击Deploy按钮后，会把您的java合约部署到区块链中。并会弹出合约地址信息。</p> 
  <!-- &lt;img src=&#34;https://resource.lilyssh.cn/pic/deploy_submitted.png&#34; width=&#34;896&#34; height=&#34;252&#34; /&gt; --> 
  <p><img src="https://resource.lilyssh.cn/pic/deploy_submitted.png" alt=""><br> <img src="https://resource.lilyssh.cn/pic/contract_address.png" alt=""><br> 点击Get contract info按钮获取区块链中的合约信息。<br> <img src="https://resource.lilyssh.cn/pic/contract_info.png" alt=""><br> 在文本框中输入转账金额，并点击Transfer按钮，付款方就会向收款方转账。<br> <img src="https://resource.lilyssh.cn/pic/transfer.png" alt=""><br> 点击From’s Balance按钮查看付款账户的余额。<br> <img src="https://resource.lilyssh.cn/pic/from_balance.png" alt=""><br> 点击To’s Balance按钮查看收款账户的余额。<br> <img src="https://resource.lilyssh.cn/pic/to_balance.png" alt=""></p> 
  <h1><a id="View_deploy_contract_page_236"></a>View deploy contract page</h1> 
  <p>接下来，我们来看看部署调用页面的流程。</p> 
  <ol> 
   <li>web3如何调用java方法<br> ABI全称Application Binary Interface, 是调用智能合约函数以及合约之间函数调用的消息编码格式定义,也可以理解为智能合约函数调用的接口说明. 类似Webservice里的SOAP协议一样；也就是定义操作函数签名，参数编码，返回结果编码等。使用ABI协议时必须要求在编译时知道类型,即强类型相关.</li> 
  </ol> 
  <p>如果想调用HelloWorld.java中的函数，需要把该函数追加到abi变量中，按照现有格式即可。比如说，我们想要调用HelloWorld.java中的getValue方法，就要把以下内容追加到abi变量中。</p> 
  <pre><code>var abi=
...
,
{
        "constant":false,        //方法修饰符,false表示函数内可以修改状态变量
        "inputs":[               //方法入参，数组里的每个对象都是一个参数说明
            {
                "name":"skey",   //第一个参数的名字
                "type":"bytes32" //第一个参数的类型
            }
        ],
        "outputs":[              //方法返回值，数组里的每个对象都是一个参数说明
            {
                "name":"value",  //第一个参数的名字
                "type":"bytes32" //第一个参数的类型
            }
        ],
        "name":"getValue",       //方法名
        "payable":false,
        "stateMutability":"nonpayable",
        "type":"function"        //方法类型：function,constructor,fallback,event
    }
]
</code></pre> 
  <p>uint:M为integer类型代表M bits,0 &lt; M &lt;= 256, M % 8 == 0，如uint32，uint8,uint256。<br> int:同上。同为从8到256位的无符号整数。<br> uint和int:整型，分别是uint256和int256的别名。这也是上面的例子中函数参数类型是uint，转sha3码时要变成uint256的原因。<br> address:地址，20个字节，160bits，一个Ethereum地址，地址的类型也可以有成员作为所有合约的base。<br> bool:布尔类型，1个字节，true：1，false:0。<br> bytes:固定大小的字节数组，0&lt;M&lt;=32,byte都是bytes1的别名。<br> bytes:动态分配大小字节数组。不是一个值类型。<br> String:动态大小UTF8编码的字符串,不是一个值类型。<br> 尽量少用string。<br> 2. 如何发布合约<br> web3.js对合约的操作进行了封装。发布合约时，可以使用web3.cph.contract的new方法。<br> 部署过程中需要主要的是，new方法的回调会执行两次，第一次是合约的交易创建完成，第二次是在某个地址上完成部署。需要注意的是只有在部署完成后，才能进行方法该用，否则会报错TypeError: javaContract.add is not a function。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lilyssh/article/details/82911309,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lilyssh/article/details/82911309,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

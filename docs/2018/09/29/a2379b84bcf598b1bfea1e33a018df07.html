<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>非对称算法之RSA的签名剖析 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="非对称算法之RSA的签名剖析" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="&nbsp; 数字签名，就是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。&nbsp;不清楚的请自行科普&nbsp;数字签名。本篇主要来讲签名值具体是怎么计算出来的~ 一、动手解密签名值 1）准备测试密钥 //随机产生RSA私钥。因1024位的RSA密钥已不安全，本次测试使用2048长度的RSA密钥。 &gt; openssl genrsa 2048 Generating RSA private key, 2048 bit long modulus .....................+++ ............................................................................................................................+++ e is 65537 (0x10001) -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3 YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0 sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0 /K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH -----END RSA PRIVATE KEY----- // 通过生成的私钥，得到公钥 &gt; openssl rsa -pubout -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3 YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0 sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0 /K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH -----END RSA PRIVATE KEY----- writing RSA key -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqmk7bbqdfdDWgQZ/srfp BurN40Rw8QqBjoE8cujbF8zHrNJcRlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84 xEwHrd5l0t/iMVZxIOoyHk0gHDKvkFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYs l1ktJ05YA4rHSv33Dp5OsPGIlO+HRZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu 3rUOlfdkLQyFmlrVJAMdatpM2pazeSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02Yp DKrO04zHtOxZNnZz7r3YedCgzG4ZuBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA 7wIDAQAB -----END PUBLIC KEY----- 2）编写代码解密 众所周知： &nbsp;* RSA加密解密：私钥解密，公钥加密。 &nbsp;*&nbsp;RSA数字签名-俗称加签验签：私钥加签，公钥验签。&nbsp; 其实： 也是有私钥加密，公钥解密的。&nbsp; 只是因为公钥是公开的，私钥加密后所有人都可以解密，没有意义，所以常用签名，而不是加密。&nbsp; 私钥加签的本质也是私钥加密数据的Hash值。 这里有个小技巧：我们用公钥对签名值解密，使用RSA_NO_PADDING，这样就能得到 签名时私钥加密的数据。 &nbsp; 鉴于篇幅长度，代码只贴出关键部分 代码之PHP： /** * 创建签名 * @param string $data 数据 * @return null|string */ public function createSign($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_sign($data, $sign, self::getPrivateKey(),OPENSSL_ALGO_SHA256); return $sign; } /** * 公钥解密数据 * @param string $data 数据 * @return null|string */ public function decData($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_NO_PADDING); return $encData; } /** * 公钥解密数据 * @param string $data 数据 * @return null|string */ public function decDataPKCS1Padding($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_PKCS1_PADDING); return $encData; } 其他语言代码整理ing... 本次测试 java、js、C#、PHP。结果均一致，如下： 使用示例私钥进行签名，得到如下结果 签名值Base64： UjV/9zDoYcXTKKKDlWhFshQ08ikknKWqhCig8J7VhVrFCF+tFUQ85xnCUA0KR/t9CVFcf7SDA6ntr/T2xJ4T9TiAHEmNIhghZTlOsp+ieyvB5N4jQ6fuK6DjdtK/icklK5fmMozbKKiHwjr33lWY8NTfXydtKgd/5fPIVhUB26TyOKiO7JY3iAlylqfIpEy4g3fsxiiPGe022jIt400re1UCyZWbhXqdr2JUE7hAZEcMcbxvZff4Ilh6hHZ9rAkWBU1E2vsQUnnvdDK3BOQpZQvTtfIHbX+lhT5UcsFJrwOuONo0nG0s7MSjCsjQEf7iucEZpZeUYwOeMexVHsU9rw== 签名值Hex： 52357ff730e861c5d328a283956845b21434f229249ca5aa8428a0f09ed5855ac5085fad15443ce719c2500d0a47fb7d09515c7fb48303a9edaff4f6c49e13f538801c498d22182165394eb29fa27b2bc1e4de2343a7ee2ba0e376d2bf89c9252b97e6328cdb28a887c23af7de5598f0d4df5f276d2a077fe5f3c8561501dba4f238a88eec963788097296a7c8a44cb88377ecc6288f19ed36da322de34d2b7b5502c9959b857a9daf625413b84064470c71bc6f65f7f822587a84767dac0916054d44dafb105279ef7432b704e429650bd3b5f2076d7fa5853e5472c149af03ae38da349c6d2cecc4a30ac8d011fee2b9c119a5979463039e31ec551ec53daf 使用示例公钥进行NOPADDING解密，得到如下结果 原数据Base64： AAH/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ADAxMA0GCWCGSAFlAwQCAQUABCC5TSe5k00+CKUuUtfafav6xITv43pTgO6QiPes4u/N6Q== 原数据Hex： 0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 使用示例公钥进行PKCS1_PADDING解密，得到如下结果 原数据Base64： MDEwDQYJYIZIAWUDBAIBBQAEILlNJ7mTTT4IpS5S19p9q/rEhO/jelOA7pCI96zi783p 原数据Hex： 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 简单分析 1. 字符串&quot;hello world&quot;进行sha256运算得到hash： b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 2. 在Hash结果前数据填充：3031300d060960864801650304020105000420 3. PKCS1 在上一步结果前填充：0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00 二、结合资料分析RSA的补位 1）签名时，对Hash值的数据填充方式&nbsp;&nbsp; 对hash算法id和hash值进行ASN.1的DER编码。如下 &nbsp; &nbsp; &nbsp; DigestInfo ::= SEQUENCE { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digestAlgorithm AlgorithmIdentifier, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digest OCTET STRING &nbsp; &nbsp; &nbsp; } 为方便理解，我们使用ASN1dump对示例中的数据做解析 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 直接上图 &nbsp; &nbsp; 可以看到sha256的算法id，2.16.840.1.101.3.4.2.1 &nbsp; 数据也在其中，另附上部分算法id： &nbsp; 另因为各个hash算法id是固定的，计算的结果也是固定的。所以不同的hash算法的填充也是固定的。如下： md2:&quot;3020300c06082a864886f70d020205000410&quot;, md5:&quot;3020300c06082a864886f70d020505000410&quot;, sha1:&quot;3021300906052b0e03021a05000414&quot;, sha224:&quot;302d300d06096086480165030402040500041c&quot;, sha256:&quot;3031300d060960864801650304020105000420&quot;, sha384:&quot;3041300d060960864801650304020205000430&quot;, sha512:&quot;3051300d060960864801650304020305000440&quot;, ripemd160: &quot;3021300906052b2403020105000414&quot; 2）pkcs1padding V1.5的填充模式&nbsp; &nbsp;参考rfc2312 以下描述均以十六进制字符串来描述。 pkcs1padding V1.5的填充模式方式如下 &nbsp; EB = 00+BT+PS +00 + D 即：加密块=00+块类型+填充字符+00+数据 1. 开头00是为了确保块转换为整数的时候 小于模数 2. BT（Block Type）：当使用私钥操作，块类型为00或01，公钥操作，块类型为02。块类型为00，数据开头必须不能是00，因为填充的也是00，将无法解析。块类型为01或02，块可以被准确解析，因为不会是00来填充。 3. PS（Padding String）：k-3-||D|| 个字节组组成，k表示密钥的字节长度, D表示明文数据D的字节长度 。当BT为01时，填充字节值为FF，BT为00时，填充字节值为00，BT为02时填充随机数（非00）。填充长度至少为8个字节 4. 00,用于分开PS和D 5. D，数据原文（HEX） &nbsp; 注意：2048位的RSA密钥，加密块长度也必须是2048位，也就是256个字节。所以示例中的加密块需要填充202个FF才够256个字节。 故签名的时候，&nbsp; 加密的块 = 00+01+FF（202个） +00 +&nbsp;3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 &nbsp; 三、测试题 最后抛了两个问题，看看大家有没有理解上面所介绍的。&nbsp; 1） RSA签名的时候 值是固定， 公钥加密的结果确实随机的，为什么？ 2）分析如下代码，是否有问题？ 本文来自&nbsp;甜橙安全团队 公司简介：天翼电子商务有限公司（简称“甜橙金融”）是中国电信的全资子公司，2011年3月成立于北京，在上海、广州、西安设有分公司。翼支付是中国人民银行核准的第三方支付机构，是兼具金融、电信、互联网文化的跨界国家高新技术企业，依托“支付+通信+理财”的差异化商业模式、打造“甜橙金融”全新品牌，快速布局移动支付、理财、征信、消费金融等互联网金融业务。账户用户已突破1.5亿，现已成为国内移动支付领域5强、互联网金融领域16强，荣获“年度最佳雇主”、“最受程序员欢迎的IT互联网公司”、“最佳互联网理财APP门户”等荣誉。 阅读更多" />
<meta property="og:description" content="&nbsp; 数字签名，就是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。&nbsp;不清楚的请自行科普&nbsp;数字签名。本篇主要来讲签名值具体是怎么计算出来的~ 一、动手解密签名值 1）准备测试密钥 //随机产生RSA私钥。因1024位的RSA密钥已不安全，本次测试使用2048长度的RSA密钥。 &gt; openssl genrsa 2048 Generating RSA private key, 2048 bit long modulus .....................+++ ............................................................................................................................+++ e is 65537 (0x10001) -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3 YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0 sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0 /K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH -----END RSA PRIVATE KEY----- // 通过生成的私钥，得到公钥 &gt; openssl rsa -pubout -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3 YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0 sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0 /K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH -----END RSA PRIVATE KEY----- writing RSA key -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqmk7bbqdfdDWgQZ/srfp BurN40Rw8QqBjoE8cujbF8zHrNJcRlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84 xEwHrd5l0t/iMVZxIOoyHk0gHDKvkFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYs l1ktJ05YA4rHSv33Dp5OsPGIlO+HRZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu 3rUOlfdkLQyFmlrVJAMdatpM2pazeSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02Yp DKrO04zHtOxZNnZz7r3YedCgzG4ZuBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA 7wIDAQAB -----END PUBLIC KEY----- 2）编写代码解密 众所周知： &nbsp;* RSA加密解密：私钥解密，公钥加密。 &nbsp;*&nbsp;RSA数字签名-俗称加签验签：私钥加签，公钥验签。&nbsp; 其实： 也是有私钥加密，公钥解密的。&nbsp; 只是因为公钥是公开的，私钥加密后所有人都可以解密，没有意义，所以常用签名，而不是加密。&nbsp; 私钥加签的本质也是私钥加密数据的Hash值。 这里有个小技巧：我们用公钥对签名值解密，使用RSA_NO_PADDING，这样就能得到 签名时私钥加密的数据。 &nbsp; 鉴于篇幅长度，代码只贴出关键部分 代码之PHP： /** * 创建签名 * @param string $data 数据 * @return null|string */ public function createSign($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_sign($data, $sign, self::getPrivateKey(),OPENSSL_ALGO_SHA256); return $sign; } /** * 公钥解密数据 * @param string $data 数据 * @return null|string */ public function decData($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_NO_PADDING); return $encData; } /** * 公钥解密数据 * @param string $data 数据 * @return null|string */ public function decDataPKCS1Padding($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_PKCS1_PADDING); return $encData; } 其他语言代码整理ing... 本次测试 java、js、C#、PHP。结果均一致，如下： 使用示例私钥进行签名，得到如下结果 签名值Base64： UjV/9zDoYcXTKKKDlWhFshQ08ikknKWqhCig8J7VhVrFCF+tFUQ85xnCUA0KR/t9CVFcf7SDA6ntr/T2xJ4T9TiAHEmNIhghZTlOsp+ieyvB5N4jQ6fuK6DjdtK/icklK5fmMozbKKiHwjr33lWY8NTfXydtKgd/5fPIVhUB26TyOKiO7JY3iAlylqfIpEy4g3fsxiiPGe022jIt400re1UCyZWbhXqdr2JUE7hAZEcMcbxvZff4Ilh6hHZ9rAkWBU1E2vsQUnnvdDK3BOQpZQvTtfIHbX+lhT5UcsFJrwOuONo0nG0s7MSjCsjQEf7iucEZpZeUYwOeMexVHsU9rw== 签名值Hex： 52357ff730e861c5d328a283956845b21434f229249ca5aa8428a0f09ed5855ac5085fad15443ce719c2500d0a47fb7d09515c7fb48303a9edaff4f6c49e13f538801c498d22182165394eb29fa27b2bc1e4de2343a7ee2ba0e376d2bf89c9252b97e6328cdb28a887c23af7de5598f0d4df5f276d2a077fe5f3c8561501dba4f238a88eec963788097296a7c8a44cb88377ecc6288f19ed36da322de34d2b7b5502c9959b857a9daf625413b84064470c71bc6f65f7f822587a84767dac0916054d44dafb105279ef7432b704e429650bd3b5f2076d7fa5853e5472c149af03ae38da349c6d2cecc4a30ac8d011fee2b9c119a5979463039e31ec551ec53daf 使用示例公钥进行NOPADDING解密，得到如下结果 原数据Base64： AAH/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ADAxMA0GCWCGSAFlAwQCAQUABCC5TSe5k00+CKUuUtfafav6xITv43pTgO6QiPes4u/N6Q== 原数据Hex： 0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 使用示例公钥进行PKCS1_PADDING解密，得到如下结果 原数据Base64： MDEwDQYJYIZIAWUDBAIBBQAEILlNJ7mTTT4IpS5S19p9q/rEhO/jelOA7pCI96zi783p 原数据Hex： 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 简单分析 1. 字符串&quot;hello world&quot;进行sha256运算得到hash： b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 2. 在Hash结果前数据填充：3031300d060960864801650304020105000420 3. PKCS1 在上一步结果前填充：0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00 二、结合资料分析RSA的补位 1）签名时，对Hash值的数据填充方式&nbsp;&nbsp; 对hash算法id和hash值进行ASN.1的DER编码。如下 &nbsp; &nbsp; &nbsp; DigestInfo ::= SEQUENCE { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digestAlgorithm AlgorithmIdentifier, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digest OCTET STRING &nbsp; &nbsp; &nbsp; } 为方便理解，我们使用ASN1dump对示例中的数据做解析 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 直接上图 &nbsp; &nbsp; 可以看到sha256的算法id，2.16.840.1.101.3.4.2.1 &nbsp; 数据也在其中，另附上部分算法id： &nbsp; 另因为各个hash算法id是固定的，计算的结果也是固定的。所以不同的hash算法的填充也是固定的。如下： md2:&quot;3020300c06082a864886f70d020205000410&quot;, md5:&quot;3020300c06082a864886f70d020505000410&quot;, sha1:&quot;3021300906052b0e03021a05000414&quot;, sha224:&quot;302d300d06096086480165030402040500041c&quot;, sha256:&quot;3031300d060960864801650304020105000420&quot;, sha384:&quot;3041300d060960864801650304020205000430&quot;, sha512:&quot;3051300d060960864801650304020305000440&quot;, ripemd160: &quot;3021300906052b2403020105000414&quot; 2）pkcs1padding V1.5的填充模式&nbsp; &nbsp;参考rfc2312 以下描述均以十六进制字符串来描述。 pkcs1padding V1.5的填充模式方式如下 &nbsp; EB = 00+BT+PS +00 + D 即：加密块=00+块类型+填充字符+00+数据 1. 开头00是为了确保块转换为整数的时候 小于模数 2. BT（Block Type）：当使用私钥操作，块类型为00或01，公钥操作，块类型为02。块类型为00，数据开头必须不能是00，因为填充的也是00，将无法解析。块类型为01或02，块可以被准确解析，因为不会是00来填充。 3. PS（Padding String）：k-3-||D|| 个字节组组成，k表示密钥的字节长度, D表示明文数据D的字节长度 。当BT为01时，填充字节值为FF，BT为00时，填充字节值为00，BT为02时填充随机数（非00）。填充长度至少为8个字节 4. 00,用于分开PS和D 5. D，数据原文（HEX） &nbsp; 注意：2048位的RSA密钥，加密块长度也必须是2048位，也就是256个字节。所以示例中的加密块需要填充202个FF才够256个字节。 故签名的时候，&nbsp; 加密的块 = 00+01+FF（202个） +00 +&nbsp;3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 &nbsp; 三、测试题 最后抛了两个问题，看看大家有没有理解上面所介绍的。&nbsp; 1） RSA签名的时候 值是固定， 公钥加密的结果确实随机的，为什么？ 2）分析如下代码，是否有问题？ 本文来自&nbsp;甜橙安全团队 公司简介：天翼电子商务有限公司（简称“甜橙金融”）是中国电信的全资子公司，2011年3月成立于北京，在上海、广州、西安设有分公司。翼支付是中国人民银行核准的第三方支付机构，是兼具金融、电信、互联网文化的跨界国家高新技术企业，依托“支付+通信+理财”的差异化商业模式、打造“甜橙金融”全新品牌，快速布局移动支付、理财、征信、消费金融等互联网金融业务。账户用户已突破1.5亿，现已成为国内移动支付领域5强、互联网金融领域16强，荣获“年度最佳雇主”、“最受程序员欢迎的IT互联网公司”、“最佳互联网理财APP门户”等荣誉。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/09/29/a2379b84bcf598b1bfea1e33a018df07.html" />
<meta property="og:url" content="https://mlh.app/2018/09/29/a2379b84bcf598b1bfea1e33a018df07.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"&nbsp; 数字签名，就是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。&nbsp;不清楚的请自行科普&nbsp;数字签名。本篇主要来讲签名值具体是怎么计算出来的~ 一、动手解密签名值 1）准备测试密钥 //随机产生RSA私钥。因1024位的RSA密钥已不安全，本次测试使用2048长度的RSA密钥。 &gt; openssl genrsa 2048 Generating RSA private key, 2048 bit long modulus .....................+++ ............................................................................................................................+++ e is 65537 (0x10001) -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3 YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0 sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0 /K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH -----END RSA PRIVATE KEY----- // 通过生成的私钥，得到公钥 &gt; openssl rsa -pubout -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3 YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0 sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0 /K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH -----END RSA PRIVATE KEY----- writing RSA key -----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqmk7bbqdfdDWgQZ/srfp BurN40Rw8QqBjoE8cujbF8zHrNJcRlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84 xEwHrd5l0t/iMVZxIOoyHk0gHDKvkFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYs l1ktJ05YA4rHSv33Dp5OsPGIlO+HRZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu 3rUOlfdkLQyFmlrVJAMdatpM2pazeSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02Yp DKrO04zHtOxZNnZz7r3YedCgzG4ZuBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA 7wIDAQAB -----END PUBLIC KEY----- 2）编写代码解密 众所周知： &nbsp;* RSA加密解密：私钥解密，公钥加密。 &nbsp;*&nbsp;RSA数字签名-俗称加签验签：私钥加签，公钥验签。&nbsp; 其实： 也是有私钥加密，公钥解密的。&nbsp; 只是因为公钥是公开的，私钥加密后所有人都可以解密，没有意义，所以常用签名，而不是加密。&nbsp; 私钥加签的本质也是私钥加密数据的Hash值。 这里有个小技巧：我们用公钥对签名值解密，使用RSA_NO_PADDING，这样就能得到 签名时私钥加密的数据。 &nbsp; 鉴于篇幅长度，代码只贴出关键部分 代码之PHP： /** * 创建签名 * @param string $data 数据 * @return null|string */ public function createSign($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_sign($data, $sign, self::getPrivateKey(),OPENSSL_ALGO_SHA256); return $sign; } /** * 公钥解密数据 * @param string $data 数据 * @return null|string */ public function decData($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_NO_PADDING); return $encData; } /** * 公钥解密数据 * @param string $data 数据 * @return null|string */ public function decDataPKCS1Padding($data = &#39;&#39;) { if (!is_string($data)) { return null; } openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_PKCS1_PADDING); return $encData; } 其他语言代码整理ing... 本次测试 java、js、C#、PHP。结果均一致，如下： 使用示例私钥进行签名，得到如下结果 签名值Base64： UjV/9zDoYcXTKKKDlWhFshQ08ikknKWqhCig8J7VhVrFCF+tFUQ85xnCUA0KR/t9CVFcf7SDA6ntr/T2xJ4T9TiAHEmNIhghZTlOsp+ieyvB5N4jQ6fuK6DjdtK/icklK5fmMozbKKiHwjr33lWY8NTfXydtKgd/5fPIVhUB26TyOKiO7JY3iAlylqfIpEy4g3fsxiiPGe022jIt400re1UCyZWbhXqdr2JUE7hAZEcMcbxvZff4Ilh6hHZ9rAkWBU1E2vsQUnnvdDK3BOQpZQvTtfIHbX+lhT5UcsFJrwOuONo0nG0s7MSjCsjQEf7iucEZpZeUYwOeMexVHsU9rw== 签名值Hex： 52357ff730e861c5d328a283956845b21434f229249ca5aa8428a0f09ed5855ac5085fad15443ce719c2500d0a47fb7d09515c7fb48303a9edaff4f6c49e13f538801c498d22182165394eb29fa27b2bc1e4de2343a7ee2ba0e376d2bf89c9252b97e6328cdb28a887c23af7de5598f0d4df5f276d2a077fe5f3c8561501dba4f238a88eec963788097296a7c8a44cb88377ecc6288f19ed36da322de34d2b7b5502c9959b857a9daf625413b84064470c71bc6f65f7f822587a84767dac0916054d44dafb105279ef7432b704e429650bd3b5f2076d7fa5853e5472c149af03ae38da349c6d2cecc4a30ac8d011fee2b9c119a5979463039e31ec551ec53daf 使用示例公钥进行NOPADDING解密，得到如下结果 原数据Base64： AAH/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ADAxMA0GCWCGSAFlAwQCAQUABCC5TSe5k00+CKUuUtfafav6xITv43pTgO6QiPes4u/N6Q== 原数据Hex： 0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 使用示例公钥进行PKCS1_PADDING解密，得到如下结果 原数据Base64： MDEwDQYJYIZIAWUDBAIBBQAEILlNJ7mTTT4IpS5S19p9q/rEhO/jelOA7pCI96zi783p 原数据Hex： 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 简单分析 1. 字符串&quot;hello world&quot;进行sha256运算得到hash： b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 2. 在Hash结果前数据填充：3031300d060960864801650304020105000420 3. PKCS1 在上一步结果前填充：0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00 二、结合资料分析RSA的补位 1）签名时，对Hash值的数据填充方式&nbsp;&nbsp; 对hash算法id和hash值进行ASN.1的DER编码。如下 &nbsp; &nbsp; &nbsp; DigestInfo ::= SEQUENCE { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digestAlgorithm AlgorithmIdentifier, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digest OCTET STRING &nbsp; &nbsp; &nbsp; } 为方便理解，我们使用ASN1dump对示例中的数据做解析 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 直接上图 &nbsp; &nbsp; 可以看到sha256的算法id，2.16.840.1.101.3.4.2.1 &nbsp; 数据也在其中，另附上部分算法id： &nbsp; 另因为各个hash算法id是固定的，计算的结果也是固定的。所以不同的hash算法的填充也是固定的。如下： md2:&quot;3020300c06082a864886f70d020205000410&quot;, md5:&quot;3020300c06082a864886f70d020505000410&quot;, sha1:&quot;3021300906052b0e03021a05000414&quot;, sha224:&quot;302d300d06096086480165030402040500041c&quot;, sha256:&quot;3031300d060960864801650304020105000420&quot;, sha384:&quot;3041300d060960864801650304020205000430&quot;, sha512:&quot;3051300d060960864801650304020305000440&quot;, ripemd160: &quot;3021300906052b2403020105000414&quot; 2）pkcs1padding V1.5的填充模式&nbsp; &nbsp;参考rfc2312 以下描述均以十六进制字符串来描述。 pkcs1padding V1.5的填充模式方式如下 &nbsp; EB = 00+BT+PS +00 + D 即：加密块=00+块类型+填充字符+00+数据 1. 开头00是为了确保块转换为整数的时候 小于模数 2. BT（Block Type）：当使用私钥操作，块类型为00或01，公钥操作，块类型为02。块类型为00，数据开头必须不能是00，因为填充的也是00，将无法解析。块类型为01或02，块可以被准确解析，因为不会是00来填充。 3. PS（Padding String）：k-3-||D|| 个字节组组成，k表示密钥的字节长度, D表示明文数据D的字节长度 。当BT为01时，填充字节值为FF，BT为00时，填充字节值为00，BT为02时填充随机数（非00）。填充长度至少为8个字节 4. 00,用于分开PS和D 5. D，数据原文（HEX） &nbsp; 注意：2048位的RSA密钥，加密块长度也必须是2048位，也就是256个字节。所以示例中的加密块需要填充202个FF才够256个字节。 故签名的时候，&nbsp; 加密的块 = 00+01+FF（202个） +00 +&nbsp;3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9 &nbsp; 三、测试题 最后抛了两个问题，看看大家有没有理解上面所介绍的。&nbsp; 1） RSA签名的时候 值是固定， 公钥加密的结果确实随机的，为什么？ 2）分析如下代码，是否有问题？ 本文来自&nbsp;甜橙安全团队 公司简介：天翼电子商务有限公司（简称“甜橙金融”）是中国电信的全资子公司，2011年3月成立于北京，在上海、广州、西安设有分公司。翼支付是中国人民银行核准的第三方支付机构，是兼具金融、电信、互联网文化的跨界国家高新技术企业，依托“支付+通信+理财”的差异化商业模式、打造“甜橙金融”全新品牌，快速布局移动支付、理财、征信、消费金融等互联网金融业务。账户用户已突破1.5亿，现已成为国内移动支付领域5强、互联网金融领域16强，荣获“年度最佳雇主”、“最受程序员欢迎的IT互联网公司”、“最佳互联网理财APP门户”等荣誉。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/09/29/a2379b84bcf598b1bfea1e33a018df07.html","headline":"非对称算法之RSA的签名剖析","dateModified":"2018-09-29T00:00:00+08:00","datePublished":"2018-09-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/09/29/a2379b84bcf598b1bfea1e33a018df07.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>非对称算法之RSA的签名剖析</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>&nbsp;</p> 
  <p>数字签名，就是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。&nbsp;不清楚的请自行科普&nbsp;<a href="https://baike.baidu.com/item/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D" rel="nofollow">数字签名</a>。本篇主要来讲签名值具体是怎么计算出来的~</p> 
  <h2>一、动手解密签名值</h2> 
  <h3>1）准备测试密钥</h3> 
  <pre class="has">
<code class="language-bash">//随机产生RSA私钥。因1024位的RSA密钥已不安全，本次测试使用2048长度的RSA密钥。
&gt; openssl genrsa  2048
Generating RSA private key, 2048 bit long modulus
.....................+++
............................................................................................................................+++
e is 65537 (0x10001)
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc
RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv
kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H
RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz
eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z
uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL
IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV
v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD
GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW
W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG
gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3
YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB
s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo
CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA
PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC
Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW
tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0
sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL
l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R
xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H
YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0
/K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl
cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp
bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB
EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH
-----END RSA PRIVATE KEY-----

// 通过生成的私钥，得到公钥
&gt; openssl  rsa -pubout
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAqmk7bbqdfdDWgQZ/srfpBurN40Rw8QqBjoE8cujbF8zHrNJc
RlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84xEwHrd5l0t/iMVZxIOoyHk0gHDKv
kFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYsl1ktJ05YA4rHSv33Dp5OsPGIlO+H
RZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu3rUOlfdkLQyFmlrVJAMdatpM2paz
eSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02YpDKrO04zHtOxZNnZz7r3YedCgzG4Z
uBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA7wIDAQABAoIBACS/FGWQ/C0JP3gL
IrYzGji3oTYEqCYSEeXc0GAm/jefnN8TbXptxtP9zT/dr1U5PfXCVxPWh0xrnQZV
v2Xyuxb5Hh7L+kECrg/dh/+FANGv5+CsvVbtLv4fMlG47D61RQzM7PSknXsa5zJD
GIcSEoOAY1A6gJgi8N6m7QNl96oH0TiTbs4xIo8wTgwPR2fkXFB/XySqweOZBeNW
W6cGFb382lM2N51G72ElQe27+O214J/bHKDukoGgJ5GE2uI2r0xkIXYLsy+zeOdG
gi1UEqjLng596wvH55hog+4b2aPQP2yxnzvtzQELb6XY/oApgQQd5HH5JpWa8ec3
YJBmp0ECgYEA2Y9YyGp6zsRRTKFuqt1ISQltlFg6pxSAGJYbUPcLD2x67hXdfnhB
s1fvNvG+hYh65e80/HZca8JKTB4ETU0oOPQfzoGRqa5pIxv37QIruskyu2Skevlo
CMAT7EXO1CT5ewce1We1R3vUVIlBI3/JibsI89VyBlyDK2QnUKltBtkCgYEAyIVA
PWnYt0EsA22LdFLcgOQ/W/LMYRssaxpbde9yXqp7MKhhAGFq33IWWYXaGhBVbslC
Co5cLPrcPiNvB+lFPfFfmBTncU9FGnkDCiAGCufWuqHGSc2mmVnn/pdUdwqI+jSW
tqCYQl5YO5R39sbjTPyilWWAuS0lUS9rLm3juQcCgYEAr6p8II9Bi/SeRIbQqew0
sqyHK1G2QjReXfvOIKjo6FJKTDWhe720JxBome/GS2HxAfoMyZD0fRoLDbzq8lPL
l3keuYqLR/wI7o1luZyYHKDacs8HtDfv1ajqLUwMfeVBACK2tc+gYxDMWFnfG7/R
xoEb8G43PIW0b/PVft7eprkCgYAZK/kTfI0S/CBtUbwW3ywFFiIKBeG4MvQRgd6H
YIan8ZjDU+/RX2lOIYFCvbXSXciLvsIGlzZlAxzQxBv1D0h87ScF7WHcbIoNN7G0
/K4lglMHXLWKoEFQsOOZpx+YTf9CAYYF6QUUF8nVuN6SYQc5q+ExBevx0wQDPAOl
cXAL0wKBgENcM4Gc0yAn8dRP803/I90s9zgHapKTjDCw6o3q331VNq90orWQj4hp
bj2BovL6jH2OatpMEv3lLxHXT+pfG9VMGXV79h6AGo5VrLBAMPzAua1xr3nZTWiB
EQd+4FF41ku94XsCbOwEdNgxtIw33m7OZmgYzajSPILvvI35DNnH
-----END RSA PRIVATE KEY-----
writing RSA key
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqmk7bbqdfdDWgQZ/srfp
BurN40Rw8QqBjoE8cujbF8zHrNJcRlhHVRQ9HRwHAkG0xM5OzZjfzxHseJ+D3v84
xEwHrd5l0t/iMVZxIOoyHk0gHDKvkFAaSk+Rlo61bqxgjcRTNkz9mpA8hmG55fYs
l1ktJ05YA4rHSv33Dp5OsPGIlO+HRZRjdsu8iYfFUrPmfjoVZKPhiRHEeYtDxfyu
3rUOlfdkLQyFmlrVJAMdatpM2pazeSY3ypqR0mClQ3+t4GpGrCjXqkFYOXP/02Yp
DKrO04zHtOxZNnZz7r3YedCgzG4ZuBvZGin3ig/X2fxZLJmmERhv9FizGvM541kA
7wIDAQAB
-----END PUBLIC KEY-----</code></pre> 
  <h3>2）编写代码解密</h3> 
  <p>众所周知：</p> 
  <p>&nbsp;* RSA加密解密：私钥解密，公钥加密。</p> 
  <p>&nbsp;*&nbsp;RSA数字签名-俗称加签验签：私钥加签，公钥验签。&nbsp;</p> 
  <p>其实：</p> 
  <p>也是有私钥加密，公钥解密的。&nbsp; 只是因为公钥是公开的，私钥加密后所有人都可以解密，没有意义，所以常用签名，而不是加密。&nbsp;</p> 
  <p>私钥加签的本质也是私钥加密数据的Hash值。</p> 
  <p>这里有个小技巧：我们用公钥对签名值解密，使用RSA_NO_PADDING，这样就能得到 签名时私钥加密的数据。</p> 
  <p>&nbsp;</p> 
  <p>鉴于篇幅长度，代码只贴出关键部分</p> 
  <p>代码之PHP：</p> 
  <pre class="has">
<code class="language-php">/**
     * 创建签名
     * @param string $data 数据
     * @return null|string
     */
    public function createSign($data = '')
    {
        if (!is_string($data)) {
            return null;
        }
        openssl_sign($data, $sign, self::getPrivateKey(),OPENSSL_ALGO_SHA256);
        return  $sign;
    }

    /**
     * 公钥解密数据
     * @param string $data 数据
     * @return null|string
     */
    public function decData($data = '')
    {
        if (!is_string($data)) {
            return null;
        }
        openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_NO_PADDING);
        return  $encData;
    }

    /**
     * 公钥解密数据
     * @param string $data 数据
     * @return null|string
     */
    public function decDataPKCS1Padding($data = '')
    {
        if (!is_string($data)) {
            return null;
        }
        openssl_public_decrypt($data, $encData, self::getPublicKey(),OPENSSL_PKCS1_PADDING);
        return  $encData;
    }</code></pre> 
  <p>其他语言代码整理ing...</p> 
  <p>本次测试 java、js、C#、PHP。结果均一致，如下：</p> 
  <pre class="has">
<code class="language-html">使用示例私钥进行签名，得到如下结果

</code></pre> 
  <pre class="has">
<code>签名值Base64： UjV/9zDoYcXTKKKDlWhFshQ08ikknKWqhCig8J7VhVrFCF+tFUQ85xnCUA0KR/t9CVFcf7SDA6ntr/T2xJ4T9TiAHEmNIhghZTlOsp+ieyvB5N4jQ6fuK6DjdtK/icklK5fmMozbKKiHwjr33lWY8NTfXydtKgd/5fPIVhUB26TyOKiO7JY3iAlylqfIpEy4g3fsxiiPGe022jIt400re1UCyZWbhXqdr2JUE7hAZEcMcbxvZff4Ilh6hHZ9rAkWBU1E2vsQUnnvdDK3BOQpZQvTtfIHbX+lhT5UcsFJrwOuONo0nG0s7MSjCsjQEf7iucEZpZeUYwOeMexVHsU9rw==
签名值Hex： 52357ff730e861c5d328a283956845b21434f229249ca5aa8428a0f09ed5855ac5085fad15443ce719c2500d0a47fb7d09515c7fb48303a9edaff4f6c49e13f538801c498d22182165394eb29fa27b2bc1e4de2343a7ee2ba0e376d2bf89c9252b97e6328cdb28a887c23af7de5598f0d4df5f276d2a077fe5f3c8561501dba4f238a88eec963788097296a7c8a44cb88377ecc6288f19ed36da322de34d2b7b5502c9959b857a9daf625413b84064470c71bc6f65f7f822587a84767dac0916054d44dafb105279ef7432b704e429650bd3b5f2076d7fa5853e5472c149af03ae38da349c6d2cecc4a30ac8d011fee2b9c119a5979463039e31ec551ec53daf

使用示例公钥进行NOPADDING解密，得到如下结果
原数据Base64： AAH/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ADAxMA0GCWCGSAFlAwQCAQUABCC5TSe5k00+CKUuUtfafav6xITv43pTgO6QiPes4u/N6Q==
原数据Hex： 0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9

使用示例公钥进行PKCS1_PADDING解密，得到如下结果
原数据Base64： MDEwDQYJYIZIAWUDBAIBBQAEILlNJ7mTTT4IpS5S19p9q/rEhO/jelOA7pCI96zi783p
原数据Hex： 3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9
</code></pre> 
  <p>简单分析</p> 
  <p>1. 字符串"hello world"进行sha256运算得到hash： b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9</p> 
  <p>2. 在Hash结果前数据填充：3031300d060960864801650304020105000420</p> 
  <p>3. PKCS1 在上一步结果前填充：0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00</p> 
  <h2>二、结合资料分析RSA的补位</h2> 
  <h3>1）签名时，对Hash值的数据填充方式&nbsp;&nbsp;</h3> 
  <p>对hash算法id和hash值进行ASN.1的DER编码。如下</p> 
  <p>&nbsp; &nbsp; &nbsp; DigestInfo ::= SEQUENCE {</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digestAlgorithm AlgorithmIdentifier,</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digest OCTET STRING</p> 
  <p>&nbsp; &nbsp; &nbsp; }</p> 
  <p>为方便理解，我们使用ASN1dump对示例中的数据做解析</p> 
  <p>3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9</p> 
  <p>直接上图</p> 
  <p>&nbsp;</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180929110658736?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1NzQ1MTg3MzU1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"><br><br> &nbsp;</p> 
  <p>可以看到sha256的算法id，2.16.840.1.101.3.4.2.1</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180929110755122?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1NzQ1MTg3MzU1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>&nbsp;</p> 
  <p>数据也在其中，另附上部分算法id：</p> 
  <p>&nbsp;</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180929110800730?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1NzQ1MTg3MzU1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>另因为各个hash算法id是固定的，计算的结果也是固定的。所以不同的hash算法的填充也是固定的。如下：</p> 
  <pre class="has">
<code>md2:"3020300c06082a864886f70d020205000410",
md5:"3020300c06082a864886f70d020505000410",
sha1:"3021300906052b0e03021a05000414",
sha224:"302d300d06096086480165030402040500041c",
sha256:"3031300d060960864801650304020105000420",
sha384:"3041300d060960864801650304020205000430",
sha512:"3051300d060960864801650304020305000440",
ripemd160: "3021300906052b2403020105000414"</code></pre> 
  <h3>2）pkcs1padding V1.5的填充模式&nbsp; &nbsp;参考<a href="https://tools.ietf.org/html/rfc2313#page-9" rel="nofollow">rfc2312</a></h3> 
  <p>以下描述均以十六进制字符串来描述。</p> 
  <p>pkcs1padding V1.5的填充模式方式如下</p> 
  <p>&nbsp; EB = 00+BT+PS +00 + D</p> 
  <p>即：加密块=00+块类型+填充字符+00+数据</p> 
  <p>1. 开头00是为了确保块转换为整数的时候 小于模数</p> 
  <p>2. BT（Block Type）：当使用私钥操作，块类型为00或01，公钥操作，块类型为02。块类型为00，数据开头必须不能是00，因为填充的也是00，将无法解析。块类型为01或02，块可以被准确解析，因为不会是00来填充。</p> 
  <p>3. PS（Padding String）：k-3-||D|| 个字节组组成，k表示密钥的字节长度, D表示明文数据D的字节长度 。当BT为01时，填充字节值为FF，BT为00时，填充字节值为00，BT为02时填充随机数（非00）。填充长度至少为8个字节</p> 
  <p>4. 00,用于分开PS和D</p> 
  <p>5. D，数据原文（HEX）</p> 
  <p>&nbsp;</p> 
  <p>注意：2048位的RSA密钥，加密块长度也必须是2048位，也就是256个字节。所以示例中的加密块需要填充202个FF才够256个字节。</p> 
  <p>故签名的时候，&nbsp; 加密的块 = 00+01+FF（202个） +00 +&nbsp;3031300d060960864801650304020105000420b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9</p> 
  <p>&nbsp;</p> 
  <h2>三、测试题</h2> 
  <p>最后抛了两个问题，看看大家有没有理解上面所介绍的。&nbsp;</p> 
  <p>1） RSA签名的时候 值是固定， 公钥加密的结果确实随机的，为什么？</p> 
  <p>2）分析如下代码，是否有问题？</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180929110810223?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1NzQ1MTg3MzU1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <blockquote> 
   <p>本文来自&nbsp;甜橙安全团队</p> 
   <p>公司简介：天翼电子商务有限公司（简称“甜橙金融”）是中国电信的全资子公司，2011年3月成立于北京，在上海、广州、西安设有分公司。翼支付是中国人民银行核准的第三方支付机构，是兼具金融、电信、互联网文化的跨界国家高新技术企业，依托“支付+通信+理财”的差异化商业模式、打造“甜橙金融”全新品牌，快速布局移动支付、理财、征信、消费金融等互联网金融业务。账户用户已突破1.5亿，现已成为国内移动支付领域5强、互联网金融领域16强，荣获“年度最佳雇主”、“最受程序员欢迎的IT互联网公司”、“最佳互联网理财APP门户”等荣誉。</p> 
  </blockquote> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wu745187355/article/details/82894500,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wu745187355/article/details/82894500,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

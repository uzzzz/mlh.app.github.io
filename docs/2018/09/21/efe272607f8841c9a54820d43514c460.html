<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>第二十篇 墨客区块链(MOAC BlockChain) 部署FileStorm上篇 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="第二十篇 墨客区块链(MOAC BlockChain) 部署FileStorm上篇" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：Copyright Reserved © 2018-2020 https://blog.csdn.net/lyq13573221675/article/details/82800312 1.安装IPFS 1.1&nbsp;下载go-ipfs 官方下载网址：https://ipfs.io 本文下载版本为：go-ipfs_v0.4.15_windows-amd64.zip。 &nbsp; 1.2 解压 下载之后将go-ipfs解压到自己的工作目录： 1.3 安装 查看帮助： 初始化安装。打开控制台进入到工作目录，执行ipfs init命令，结果如下： 此时，在固定路径会生成一个.ipfs的文件夹： 1.4 启动守护进程daemon &nbsp; 2.启动多个ipfs daemon进程 第一节说明了ipfs的安装和启动过程，默认情况下，ipfs会安装到C:\Users\[userName]\.ipfs目录下。 本文的测试环境需要多个（一般3个）ipfs daemon进程，怎么在windows环境下安装并启动多个ipfs daemon进程呢。 2.1 配置环境变量 进入环境变量配置界面，在“系统变量”里新建一个条目，命名“IPFS_PATH”，取值“C:\Users\lyq2018\.ipfs1”。 保存环境变量。 2.2 安装IPFS 初始化安装。打开控制台进入到工作目录，执行ipfs init命令，ipfs会自动安装到目录“C:\Users\lyq2018\.ipfs1”。 2.3 修改参数 打开目录“C:\Users\lyq2018\.ipfs1”下的文件config，修改端口参数。使得本文所需要的三个ipfs均使用不同的端口。 &quot;Addresses&quot;: { &quot;Swarm&quot;: [ &quot;/ip4/0.0.0.0/tcp/4002&quot;, //默认4001 &quot;/ip6/::/tcp/4002&quot; //默认4001 ], &quot;Announce&quot;: [], &quot;NoAnnounce&quot;: [], &quot;API&quot;: &quot;/ip4/127.0.0.1/tcp/5002&quot;, //默认5001 &quot;Gateway&quot;: &quot;/ip4/127.0.0.1/tcp/8082&quot; //默认8080 }, 2.4 启动守护进程daemon D:\fileStorm\go-ipfs_v0.4.15_windows-amd64\go-ipfs&gt;ipfs daemon 2.5 启动其他两个进程 按照以上步骤，修改变量——启动ipfs——修改参数——启动进程。启动另外两个ipfs daemon进程。 此时，目录下会存在三个ipfs。 同时启动进程后，均工作正常。 &nbsp; 3.安装运行redis Redis 是一个开源的、高性能的、支持网络、可基于内存亦可持久化的日志型、key-value数据库。 到官网https://redis.io/下载即可，本文使用版本为Redis-x64-3.2.100.msi。 3.1 安装 直接在windows下运行安装文件，一路默认。 即可将redis安装到目录“C:\Program Files\Redis”。 3.2 运行 打开cmd，进入目录“C:\Program Files\Redis”，运行 因为本文需要模拟三个SCS，因此，也需要启动三个redis进程与它们对应，用端口号区别它们。 启动另外两个cmd，进入目录“C:\Program Files\Redis”，分别运行 C:\Program Files\Redis&gt;redis-server --port 6373 C:\Program Files\Redis&gt;redis-server --port 6374 &nbsp; 4. 运行monkey 请到墨客官方https://github.com/MOACChain/moac-core/releases下载：monkey-windows-4.0-amd64.exe。 如果下载的文件保存在“D:\fileStorm”，进入目录，运行 D:\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18082 --redis-host-port 127.0.0.1:6372 --ipfs-host-port 127.0.0.1:5002 运行结果： 运行另外两个进程： D:\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18083 --redis-host-port 127.0.0.1:6373 --ipfs-host-port 127.0.0.1:5003 D:\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18084 --redis-host-port 127.0.0.1:6374 --ipfs-host-port 127.0.0.1:5004 &nbsp; 5.启动SCS 5.1 启动Vnode节点 请下载官方版本Nuwa 1.0.3下的nuwa1.0.3.win.zip；本文编辑时，该版本Vnode仅限用于testnet。 解压，里面包含两部分：scs目录为普通SCS代码（fileStrom的SCS可以作为普通SCS使用，反之不可以），vnode为底层节点代码。 Vnode的配置文件vnodeconfig.json需要配置为： { &quot;SCSService&quot;:true, //默认false &quot;ShowToPublic&quot;:false, &quot;VnodeServiceCfg&quot;:&quot;localhost:50062&quot;, &quot;VnodeIp&quot;:&quot;&quot;, &quot;VnodeBeneficialAddress&quot;:&quot;0x7610fd66c272332edd59a43460ad24eee1973bfe&quot; } 启动SCS之前需要启动Vnode节点，本例为测试网本地节点。 D:\nuwa1.0.3.win\vnode&gt;moac –testnet --rpc –rpccorsdomain &quot;http://wallet.moac.io&quot; 该Vnode也就是userconfig.json&nbsp;中配置的VnodeServiceCfg。 &nbsp; 5.2 下载SCS 用于fileStorm的SCS程序跟普通SCS不同，从下载页https://github.com/MOACChain/moac-core/releases下载fileStorm-scs1.0.3版程序。 解压下载的软件包到本地硬盘。目录下包含两个文件夹和一个readme文件： 说明： config/userconfig.json：SCS节点配置文件，需要在启动前配置好； scsserver/scsserver.exe：SCS执行程序； readme：说明文档。 &nbsp; 5.3 配置userconfig.json&nbsp; { &quot;VnodeServiceCfg&quot;: &quot;localhost:50062&quot;, //scs需要连接的Vnode IP地址和端口 &quot;DataDir&quot;: &quot;./scsdata&quot;, //scs数据目录 &quot;LogPath&quot;: &quot;./_logs&quot;, //scs日志目录 &quot;Beneficiary&quot;: &quot;0x7610fd66c272332edd59a43460ad24eee1973bfe&quot;, //scs矿工收益账号 &quot;VnodechainId&quot;: 101, //主链的网络号，miannet = 99，test net = 101 &quot;Capability&quot;: 10, //服务子链的押金上限 &quot;ReconnectInterval&quot;: 5, //设置与vnode连接的间隔，以秒为单位 &quot;LogLevel&quot;: 3, //输出日志级别，数值越大，越详细 &quot;FileStorm&quot;: { &quot;MonkeyPort&quot;: 18082 //monkey端口 }, &quot;BondLimit&quot;:2, //需要支付的押金上限 &quot;ReWardMin&quot;:0.0001 //子链每个区块的最小奖励金额 } 5.4 启动SCS 进入目录scs\scsserver启动scs： D:\fileStorm-scs1.0.3\scsserver&gt;scsserver -p &quot;123456123456&quot; //设定密码为“123456123456” 正常启动，新的SCS会出现如下界面： 同时会在scsserver目录下生成syskeystore目录，里面包含SCS id号，也就是账号。 按照以上步骤，复制两个干净的SCS目录——分别修改userconfig.json的MonkeyPort为18083和18084——运行scsserver，启动另外两个SCS。 5.5 启动一个SCS monitor 使用如下命令，会将SCS设置为monitor。 D:\nuwa1.0.2.win\scs\scsserver&gt;scsserver --rpcaddr 0.0.0.0 --rpcport 2345 该SCS不出块，仅同步子链的数据，并提供调用。 &nbsp; 6.部署子链控制合约 6.1 下载fileStorm子链合约文件 到官网下载子链控制合约文件：File Storm v1.0版下的DeploySubChainBase.sol。 6.2 部署SubChainProtocolBase 登录网页版钱包http://wallet.moac.io/，按照部署合约的步骤，点击合约\部署新合约，将DeploySubChainBase.sol合约内容复制到solidity合约代码区。 在选择合约里选“Sub Chain Protocol Base”，填入三个参数： Protocol = filestorm-test；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\共识协议 Bmin = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\最小押金 protocol type = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\协议类型，0为普通SCS子链，1为fileStorm 6.3 将SCS注册到刚刚部署的SubChainProtocolBase池子 界面使用合约Register函数，注册SCS：参数主要包括SCS id和押金数量，此处写入2mc押金。 重复以上步骤，将3个SCS均注册到池子里去。 执行交易，并完成后，SubChainProtocolBase合约将显示有6mc。 6.4 部署子链控制合约SubChainBase 跟6.2步骤一样； 登录网页版钱包http://wallet.moac.io/，按照部署合约的步骤，点击合约\部署新合约，将DeploySubChainBase.sol合约（仍然是刚才那个合约）内容复制到solidity合约代码区。 在选择合约里选“Sub Chain Base”，填入六个参数： Proto = “0x399c905f438f50eBa82c77B702675DE73047e099”； \\刚刚部署的SubChainProtocolBase合约地址 Vnode protocol base addr = “0x5B43583F33214c790B8206D9B06685c49A1DB455”；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\此处选择一个官方提供的Vnode 协议合约地址 Min = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\最少SCS个数 Max&nbsp; = 10；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\最多SCS个数 Thousandth = 1000；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\从合约池子里选择SCS的千分比，实验环境选择全部3个，所以是1000 Flush round = 100；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\子链刷新周期 6.5 开放注册 使用Register Open函数功能，开放子链控制合约注册。 执行之后，可以通过左边读取合约看到实时注册情况。比如： 通过Node list可以查询已经注册的SCS id，编号从0开始； 通过Node count可以知道已经注册的SCS个数。 6.6 关闭注册 在Node count的数量达到要求后，使用Register Close函数功能，关闭子链控制合约注册。 成功关闭注册后，SCS开始出块： 其中较明显的变化是：MINE SUBCHAIN NUM的值由0变到1。代表该SCS已经为1个子链提供服务。 6.7 注册SCSMonitor 将已经启动的SCS Monitor注册到子链控制合约。 几秒钟后，该SCS Monitor的界面将进行区块同步。 并显示MONITOR SUBCHAIN NUM的值由0变到1。 &nbsp; 本篇总结： 经过以上步骤，fileStorm的子链已经开始出块，下篇将讲解在此基础上部署和使用fileStorm的详细过程。 阅读更多" />
<meta property="og:description" content="版权声明：Copyright Reserved © 2018-2020 https://blog.csdn.net/lyq13573221675/article/details/82800312 1.安装IPFS 1.1&nbsp;下载go-ipfs 官方下载网址：https://ipfs.io 本文下载版本为：go-ipfs_v0.4.15_windows-amd64.zip。 &nbsp; 1.2 解压 下载之后将go-ipfs解压到自己的工作目录： 1.3 安装 查看帮助： 初始化安装。打开控制台进入到工作目录，执行ipfs init命令，结果如下： 此时，在固定路径会生成一个.ipfs的文件夹： 1.4 启动守护进程daemon &nbsp; 2.启动多个ipfs daemon进程 第一节说明了ipfs的安装和启动过程，默认情况下，ipfs会安装到C:\Users\[userName]\.ipfs目录下。 本文的测试环境需要多个（一般3个）ipfs daemon进程，怎么在windows环境下安装并启动多个ipfs daemon进程呢。 2.1 配置环境变量 进入环境变量配置界面，在“系统变量”里新建一个条目，命名“IPFS_PATH”，取值“C:\Users\lyq2018\.ipfs1”。 保存环境变量。 2.2 安装IPFS 初始化安装。打开控制台进入到工作目录，执行ipfs init命令，ipfs会自动安装到目录“C:\Users\lyq2018\.ipfs1”。 2.3 修改参数 打开目录“C:\Users\lyq2018\.ipfs1”下的文件config，修改端口参数。使得本文所需要的三个ipfs均使用不同的端口。 &quot;Addresses&quot;: { &quot;Swarm&quot;: [ &quot;/ip4/0.0.0.0/tcp/4002&quot;, //默认4001 &quot;/ip6/::/tcp/4002&quot; //默认4001 ], &quot;Announce&quot;: [], &quot;NoAnnounce&quot;: [], &quot;API&quot;: &quot;/ip4/127.0.0.1/tcp/5002&quot;, //默认5001 &quot;Gateway&quot;: &quot;/ip4/127.0.0.1/tcp/8082&quot; //默认8080 }, 2.4 启动守护进程daemon D:\fileStorm\go-ipfs_v0.4.15_windows-amd64\go-ipfs&gt;ipfs daemon 2.5 启动其他两个进程 按照以上步骤，修改变量——启动ipfs——修改参数——启动进程。启动另外两个ipfs daemon进程。 此时，目录下会存在三个ipfs。 同时启动进程后，均工作正常。 &nbsp; 3.安装运行redis Redis 是一个开源的、高性能的、支持网络、可基于内存亦可持久化的日志型、key-value数据库。 到官网https://redis.io/下载即可，本文使用版本为Redis-x64-3.2.100.msi。 3.1 安装 直接在windows下运行安装文件，一路默认。 即可将redis安装到目录“C:\Program Files\Redis”。 3.2 运行 打开cmd，进入目录“C:\Program Files\Redis”，运行 因为本文需要模拟三个SCS，因此，也需要启动三个redis进程与它们对应，用端口号区别它们。 启动另外两个cmd，进入目录“C:\Program Files\Redis”，分别运行 C:\Program Files\Redis&gt;redis-server --port 6373 C:\Program Files\Redis&gt;redis-server --port 6374 &nbsp; 4. 运行monkey 请到墨客官方https://github.com/MOACChain/moac-core/releases下载：monkey-windows-4.0-amd64.exe。 如果下载的文件保存在“D:\fileStorm”，进入目录，运行 D:\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18082 --redis-host-port 127.0.0.1:6372 --ipfs-host-port 127.0.0.1:5002 运行结果： 运行另外两个进程： D:\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18083 --redis-host-port 127.0.0.1:6373 --ipfs-host-port 127.0.0.1:5003 D:\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18084 --redis-host-port 127.0.0.1:6374 --ipfs-host-port 127.0.0.1:5004 &nbsp; 5.启动SCS 5.1 启动Vnode节点 请下载官方版本Nuwa 1.0.3下的nuwa1.0.3.win.zip；本文编辑时，该版本Vnode仅限用于testnet。 解压，里面包含两部分：scs目录为普通SCS代码（fileStrom的SCS可以作为普通SCS使用，反之不可以），vnode为底层节点代码。 Vnode的配置文件vnodeconfig.json需要配置为： { &quot;SCSService&quot;:true, //默认false &quot;ShowToPublic&quot;:false, &quot;VnodeServiceCfg&quot;:&quot;localhost:50062&quot;, &quot;VnodeIp&quot;:&quot;&quot;, &quot;VnodeBeneficialAddress&quot;:&quot;0x7610fd66c272332edd59a43460ad24eee1973bfe&quot; } 启动SCS之前需要启动Vnode节点，本例为测试网本地节点。 D:\nuwa1.0.3.win\vnode&gt;moac –testnet --rpc –rpccorsdomain &quot;http://wallet.moac.io&quot; 该Vnode也就是userconfig.json&nbsp;中配置的VnodeServiceCfg。 &nbsp; 5.2 下载SCS 用于fileStorm的SCS程序跟普通SCS不同，从下载页https://github.com/MOACChain/moac-core/releases下载fileStorm-scs1.0.3版程序。 解压下载的软件包到本地硬盘。目录下包含两个文件夹和一个readme文件： 说明： config/userconfig.json：SCS节点配置文件，需要在启动前配置好； scsserver/scsserver.exe：SCS执行程序； readme：说明文档。 &nbsp; 5.3 配置userconfig.json&nbsp; { &quot;VnodeServiceCfg&quot;: &quot;localhost:50062&quot;, //scs需要连接的Vnode IP地址和端口 &quot;DataDir&quot;: &quot;./scsdata&quot;, //scs数据目录 &quot;LogPath&quot;: &quot;./_logs&quot;, //scs日志目录 &quot;Beneficiary&quot;: &quot;0x7610fd66c272332edd59a43460ad24eee1973bfe&quot;, //scs矿工收益账号 &quot;VnodechainId&quot;: 101, //主链的网络号，miannet = 99，test net = 101 &quot;Capability&quot;: 10, //服务子链的押金上限 &quot;ReconnectInterval&quot;: 5, //设置与vnode连接的间隔，以秒为单位 &quot;LogLevel&quot;: 3, //输出日志级别，数值越大，越详细 &quot;FileStorm&quot;: { &quot;MonkeyPort&quot;: 18082 //monkey端口 }, &quot;BondLimit&quot;:2, //需要支付的押金上限 &quot;ReWardMin&quot;:0.0001 //子链每个区块的最小奖励金额 } 5.4 启动SCS 进入目录scs\scsserver启动scs： D:\fileStorm-scs1.0.3\scsserver&gt;scsserver -p &quot;123456123456&quot; //设定密码为“123456123456” 正常启动，新的SCS会出现如下界面： 同时会在scsserver目录下生成syskeystore目录，里面包含SCS id号，也就是账号。 按照以上步骤，复制两个干净的SCS目录——分别修改userconfig.json的MonkeyPort为18083和18084——运行scsserver，启动另外两个SCS。 5.5 启动一个SCS monitor 使用如下命令，会将SCS设置为monitor。 D:\nuwa1.0.2.win\scs\scsserver&gt;scsserver --rpcaddr 0.0.0.0 --rpcport 2345 该SCS不出块，仅同步子链的数据，并提供调用。 &nbsp; 6.部署子链控制合约 6.1 下载fileStorm子链合约文件 到官网下载子链控制合约文件：File Storm v1.0版下的DeploySubChainBase.sol。 6.2 部署SubChainProtocolBase 登录网页版钱包http://wallet.moac.io/，按照部署合约的步骤，点击合约\部署新合约，将DeploySubChainBase.sol合约内容复制到solidity合约代码区。 在选择合约里选“Sub Chain Protocol Base”，填入三个参数： Protocol = filestorm-test；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\共识协议 Bmin = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\最小押金 protocol type = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\协议类型，0为普通SCS子链，1为fileStorm 6.3 将SCS注册到刚刚部署的SubChainProtocolBase池子 界面使用合约Register函数，注册SCS：参数主要包括SCS id和押金数量，此处写入2mc押金。 重复以上步骤，将3个SCS均注册到池子里去。 执行交易，并完成后，SubChainProtocolBase合约将显示有6mc。 6.4 部署子链控制合约SubChainBase 跟6.2步骤一样； 登录网页版钱包http://wallet.moac.io/，按照部署合约的步骤，点击合约\部署新合约，将DeploySubChainBase.sol合约（仍然是刚才那个合约）内容复制到solidity合约代码区。 在选择合约里选“Sub Chain Base”，填入六个参数： Proto = “0x399c905f438f50eBa82c77B702675DE73047e099”； \\刚刚部署的SubChainProtocolBase合约地址 Vnode protocol base addr = “0x5B43583F33214c790B8206D9B06685c49A1DB455”；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\此处选择一个官方提供的Vnode 协议合约地址 Min = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\最少SCS个数 Max&nbsp; = 10；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\最多SCS个数 Thousandth = 1000；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\从合约池子里选择SCS的千分比，实验环境选择全部3个，所以是1000 Flush round = 100；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\子链刷新周期 6.5 开放注册 使用Register Open函数功能，开放子链控制合约注册。 执行之后，可以通过左边读取合约看到实时注册情况。比如： 通过Node list可以查询已经注册的SCS id，编号从0开始； 通过Node count可以知道已经注册的SCS个数。 6.6 关闭注册 在Node count的数量达到要求后，使用Register Close函数功能，关闭子链控制合约注册。 成功关闭注册后，SCS开始出块： 其中较明显的变化是：MINE SUBCHAIN NUM的值由0变到1。代表该SCS已经为1个子链提供服务。 6.7 注册SCSMonitor 将已经启动的SCS Monitor注册到子链控制合约。 几秒钟后，该SCS Monitor的界面将进行区块同步。 并显示MONITOR SUBCHAIN NUM的值由0变到1。 &nbsp; 本篇总结： 经过以上步骤，fileStorm的子链已经开始出块，下篇将讲解在此基础上部署和使用fileStorm的详细过程。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/09/21/efe272607f8841c9a54820d43514c460.html" />
<meta property="og:url" content="https://mlh.app/2018/09/21/efe272607f8841c9a54820d43514c460.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-21T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：Copyright Reserved © 2018-2020 https://blog.csdn.net/lyq13573221675/article/details/82800312 1.安装IPFS 1.1&nbsp;下载go-ipfs 官方下载网址：https://ipfs.io 本文下载版本为：go-ipfs_v0.4.15_windows-amd64.zip。 &nbsp; 1.2 解压 下载之后将go-ipfs解压到自己的工作目录： 1.3 安装 查看帮助： 初始化安装。打开控制台进入到工作目录，执行ipfs init命令，结果如下： 此时，在固定路径会生成一个.ipfs的文件夹： 1.4 启动守护进程daemon &nbsp; 2.启动多个ipfs daemon进程 第一节说明了ipfs的安装和启动过程，默认情况下，ipfs会安装到C:\\Users\\[userName]\\.ipfs目录下。 本文的测试环境需要多个（一般3个）ipfs daemon进程，怎么在windows环境下安装并启动多个ipfs daemon进程呢。 2.1 配置环境变量 进入环境变量配置界面，在“系统变量”里新建一个条目，命名“IPFS_PATH”，取值“C:\\Users\\lyq2018\\.ipfs1”。 保存环境变量。 2.2 安装IPFS 初始化安装。打开控制台进入到工作目录，执行ipfs init命令，ipfs会自动安装到目录“C:\\Users\\lyq2018\\.ipfs1”。 2.3 修改参数 打开目录“C:\\Users\\lyq2018\\.ipfs1”下的文件config，修改端口参数。使得本文所需要的三个ipfs均使用不同的端口。 &quot;Addresses&quot;: { &quot;Swarm&quot;: [ &quot;/ip4/0.0.0.0/tcp/4002&quot;, //默认4001 &quot;/ip6/::/tcp/4002&quot; //默认4001 ], &quot;Announce&quot;: [], &quot;NoAnnounce&quot;: [], &quot;API&quot;: &quot;/ip4/127.0.0.1/tcp/5002&quot;, //默认5001 &quot;Gateway&quot;: &quot;/ip4/127.0.0.1/tcp/8082&quot; //默认8080 }, 2.4 启动守护进程daemon D:\\fileStorm\\go-ipfs_v0.4.15_windows-amd64\\go-ipfs&gt;ipfs daemon 2.5 启动其他两个进程 按照以上步骤，修改变量——启动ipfs——修改参数——启动进程。启动另外两个ipfs daemon进程。 此时，目录下会存在三个ipfs。 同时启动进程后，均工作正常。 &nbsp; 3.安装运行redis Redis 是一个开源的、高性能的、支持网络、可基于内存亦可持久化的日志型、key-value数据库。 到官网https://redis.io/下载即可，本文使用版本为Redis-x64-3.2.100.msi。 3.1 安装 直接在windows下运行安装文件，一路默认。 即可将redis安装到目录“C:\\Program Files\\Redis”。 3.2 运行 打开cmd，进入目录“C:\\Program Files\\Redis”，运行 因为本文需要模拟三个SCS，因此，也需要启动三个redis进程与它们对应，用端口号区别它们。 启动另外两个cmd，进入目录“C:\\Program Files\\Redis”，分别运行 C:\\Program Files\\Redis&gt;redis-server --port 6373 C:\\Program Files\\Redis&gt;redis-server --port 6374 &nbsp; 4. 运行monkey 请到墨客官方https://github.com/MOACChain/moac-core/releases下载：monkey-windows-4.0-amd64.exe。 如果下载的文件保存在“D:\\fileStorm”，进入目录，运行 D:\\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18082 --redis-host-port 127.0.0.1:6372 --ipfs-host-port 127.0.0.1:5002 运行结果： 运行另外两个进程： D:\\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18083 --redis-host-port 127.0.0.1:6373 --ipfs-host-port 127.0.0.1:5003 D:\\fileStorm&gt;monkey --listen-host-port 127.0.0.1:18084 --redis-host-port 127.0.0.1:6374 --ipfs-host-port 127.0.0.1:5004 &nbsp; 5.启动SCS 5.1 启动Vnode节点 请下载官方版本Nuwa 1.0.3下的nuwa1.0.3.win.zip；本文编辑时，该版本Vnode仅限用于testnet。 解压，里面包含两部分：scs目录为普通SCS代码（fileStrom的SCS可以作为普通SCS使用，反之不可以），vnode为底层节点代码。 Vnode的配置文件vnodeconfig.json需要配置为： { &quot;SCSService&quot;:true, //默认false &quot;ShowToPublic&quot;:false, &quot;VnodeServiceCfg&quot;:&quot;localhost:50062&quot;, &quot;VnodeIp&quot;:&quot;&quot;, &quot;VnodeBeneficialAddress&quot;:&quot;0x7610fd66c272332edd59a43460ad24eee1973bfe&quot; } 启动SCS之前需要启动Vnode节点，本例为测试网本地节点。 D:\\nuwa1.0.3.win\\vnode&gt;moac –testnet --rpc –rpccorsdomain &quot;http://wallet.moac.io&quot; 该Vnode也就是userconfig.json&nbsp;中配置的VnodeServiceCfg。 &nbsp; 5.2 下载SCS 用于fileStorm的SCS程序跟普通SCS不同，从下载页https://github.com/MOACChain/moac-core/releases下载fileStorm-scs1.0.3版程序。 解压下载的软件包到本地硬盘。目录下包含两个文件夹和一个readme文件： 说明： config/userconfig.json：SCS节点配置文件，需要在启动前配置好； scsserver/scsserver.exe：SCS执行程序； readme：说明文档。 &nbsp; 5.3 配置userconfig.json&nbsp; { &quot;VnodeServiceCfg&quot;: &quot;localhost:50062&quot;, //scs需要连接的Vnode IP地址和端口 &quot;DataDir&quot;: &quot;./scsdata&quot;, //scs数据目录 &quot;LogPath&quot;: &quot;./_logs&quot;, //scs日志目录 &quot;Beneficiary&quot;: &quot;0x7610fd66c272332edd59a43460ad24eee1973bfe&quot;, //scs矿工收益账号 &quot;VnodechainId&quot;: 101, //主链的网络号，miannet = 99，test net = 101 &quot;Capability&quot;: 10, //服务子链的押金上限 &quot;ReconnectInterval&quot;: 5, //设置与vnode连接的间隔，以秒为单位 &quot;LogLevel&quot;: 3, //输出日志级别，数值越大，越详细 &quot;FileStorm&quot;: { &quot;MonkeyPort&quot;: 18082 //monkey端口 }, &quot;BondLimit&quot;:2, //需要支付的押金上限 &quot;ReWardMin&quot;:0.0001 //子链每个区块的最小奖励金额 } 5.4 启动SCS 进入目录scs\\scsserver启动scs： D:\\fileStorm-scs1.0.3\\scsserver&gt;scsserver -p &quot;123456123456&quot; //设定密码为“123456123456” 正常启动，新的SCS会出现如下界面： 同时会在scsserver目录下生成syskeystore目录，里面包含SCS id号，也就是账号。 按照以上步骤，复制两个干净的SCS目录——分别修改userconfig.json的MonkeyPort为18083和18084——运行scsserver，启动另外两个SCS。 5.5 启动一个SCS monitor 使用如下命令，会将SCS设置为monitor。 D:\\nuwa1.0.2.win\\scs\\scsserver&gt;scsserver --rpcaddr 0.0.0.0 --rpcport 2345 该SCS不出块，仅同步子链的数据，并提供调用。 &nbsp; 6.部署子链控制合约 6.1 下载fileStorm子链合约文件 到官网下载子链控制合约文件：File Storm v1.0版下的DeploySubChainBase.sol。 6.2 部署SubChainProtocolBase 登录网页版钱包http://wallet.moac.io/，按照部署合约的步骤，点击合约\\部署新合约，将DeploySubChainBase.sol合约内容复制到solidity合约代码区。 在选择合约里选“Sub Chain Protocol Base”，填入三个参数： Protocol = filestorm-test；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\\\共识协议 Bmin = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\\\最小押金 protocol type = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\\\协议类型，0为普通SCS子链，1为fileStorm 6.3 将SCS注册到刚刚部署的SubChainProtocolBase池子 界面使用合约Register函数，注册SCS：参数主要包括SCS id和押金数量，此处写入2mc押金。 重复以上步骤，将3个SCS均注册到池子里去。 执行交易，并完成后，SubChainProtocolBase合约将显示有6mc。 6.4 部署子链控制合约SubChainBase 跟6.2步骤一样； 登录网页版钱包http://wallet.moac.io/，按照部署合约的步骤，点击合约\\部署新合约，将DeploySubChainBase.sol合约（仍然是刚才那个合约）内容复制到solidity合约代码区。 在选择合约里选“Sub Chain Base”，填入六个参数： Proto = “0x399c905f438f50eBa82c77B702675DE73047e099”； \\\\刚刚部署的SubChainProtocolBase合约地址 Vnode protocol base addr = “0x5B43583F33214c790B8206D9B06685c49A1DB455”；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\\\此处选择一个官方提供的Vnode 协议合约地址 Min = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\\\最少SCS个数 Max&nbsp; = 10；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\\\最多SCS个数 Thousandth = 1000；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\\\从合约池子里选择SCS的千分比，实验环境选择全部3个，所以是1000 Flush round = 100；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\\\子链刷新周期 6.5 开放注册 使用Register Open函数功能，开放子链控制合约注册。 执行之后，可以通过左边读取合约看到实时注册情况。比如： 通过Node list可以查询已经注册的SCS id，编号从0开始； 通过Node count可以知道已经注册的SCS个数。 6.6 关闭注册 在Node count的数量达到要求后，使用Register Close函数功能，关闭子链控制合约注册。 成功关闭注册后，SCS开始出块： 其中较明显的变化是：MINE SUBCHAIN NUM的值由0变到1。代表该SCS已经为1个子链提供服务。 6.7 注册SCSMonitor 将已经启动的SCS Monitor注册到子链控制合约。 几秒钟后，该SCS Monitor的界面将进行区块同步。 并显示MONITOR SUBCHAIN NUM的值由0变到1。 &nbsp; 本篇总结： 经过以上步骤，fileStorm的子链已经开始出块，下篇将讲解在此基础上部署和使用fileStorm的详细过程。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/09/21/efe272607f8841c9a54820d43514c460.html","headline":"第二十篇 墨客区块链(MOAC BlockChain) 部署FileStorm上篇","dateModified":"2018-09-21T00:00:00+08:00","datePublished":"2018-09-21T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/09/21/efe272607f8841c9a54820d43514c460.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>第二十篇 墨客区块链(MOAC BlockChain) 部署FileStorm上篇</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：Copyright Reserved © 2018-2020 https://blog.csdn.net/lyq13573221675/article/details/82800312 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><strong>1.安装IPFS</strong></p> 
  <p><strong>1.1&nbsp;<span style="color:#000000;">下载</span><span style="color:#000000;">go-</span><span style="color:#000000;">ipfs</span></strong></p> 
  <p>官方下载网址：<span style="color:#000000;"><a href="https://ipfs.io/" rel="nofollow">https://ipfs.io</a></span></p> 
  <p>本文下载版本为：go-ipfs_v0.4.15_windows-amd64.zip。</p> 
  <p>&nbsp;</p> 
  <p><strong>1.2 解压</strong></p> 
  <p><span style="color:#000000;">下载之后将go-ipfs解压到自己的工作目录：</span></p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180921135606289?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>1.3 安装</strong></p> 
  <p>查看帮助：</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180921135746698?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>初始化安装。<span style="color:#000000;">打开控制台进入到工作目录，执行</span><span style="color:#000000;">ipfs</span> <span style="color:#000000;">init</span><span style="color:#000000;">命令，结果如下：</span></p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180921135812269?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><span style="color:#000000;">此时，在固定路径会生成一个</span><span style="color:#000000;">.</span><span style="color:#000000;">ipfs</span><span style="color:#000000;">的文件夹：</span></p> 
  <p><span style="color:#000000;"><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180921135929984?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></span></p> 
  <p><strong>1.4 启动守护进程daemon</strong></p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180921140052202?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>&nbsp;</p> 
  <p><strong>2.启动多个ipfs daemon进程</strong></p> 
  <p>第一节说明了ipfs的安装和启动过程，默认情况下，ipfs会安装到C:\Users\[userName]\.ipfs目录下。</p> 
  <p>本文的测试环境需要多个（一般3个）ipfs daemon进程，怎么在windows环境下安装并启动多个ipfs daemon进程呢。</p> 
  <p><strong>2.1 配置环境变量</strong></p> 
  <p>进入环境变量配置界面，在“系统变量”里新建一个条目，命名“IPFS_PATH”，取值“C:\Users\lyq2018\.ipfs1”。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/201809251407359?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>保存环境变量。</p> 
  <p><strong>2.2 安装IPFS</strong></p> 
  <p>初始化安装。<span style="color:#000000;">打开控制台进入到工作目录，执行</span><span style="color:#000000;">ipfs</span> <span style="color:#000000;">init命令，ipfs会自动安装到目录“</span>C:\Users\lyq2018\.ipfs1<span style="color:#000000;">”。</span></p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180925141121143?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>2.3 修改参数</strong></p> 
  <p>打开目录<span style="color:#000000;">“</span>C:\Users\lyq2018\.ipfs1<span style="color:#000000;">”下的文件config，修改端口参数。使得本文所需要的三个ipfs均使用不同的端口。</span></p> 
  <pre class="has">
<code>  "Addresses": {
    "Swarm": [
      "/ip4/0.0.0.0/tcp/4002",           //默认4001
      "/ip6/::/tcp/4002"                 //默认4001
    ],
    "Announce": [],
    "NoAnnounce": [],
    "API": "/ip4/127.0.0.1/tcp/5002",    //默认5001
    "Gateway": "/ip4/127.0.0.1/tcp/8082" //默认8080
  },</code></pre> 
  <p><strong>2.4 启动守护进程daemon</strong></p> 
  <pre class="has">
<code>D:\fileStorm\go-ipfs_v0.4.15_windows-amd64\go-ipfs&gt;ipfs daemon</code></pre> 
  <p><strong>2.5 启动其他两个进程</strong></p> 
  <p>按照以上步骤，修改变量——启动ipfs——修改参数——启动进程。启动另外两个ipfs daemon进程。</p> 
  <p>此时，目录下会存在三个ipfs。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180925143304833?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>同时启动进程后，均工作正常。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180925143346773?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>&nbsp;</p> 
  <p><strong>3.安装运行redis</strong></p> 
  <p>Redis 是一个开源的、高性能的、支持网络、可基于内存亦可持久化的日志型、key-value数据库。</p> 
  <p>到官网<a href="https://redis.io/" rel="nofollow">https://redis.io/</a>下载即可，本文使用版本为Redis-x64-3.2.100.msi。</p> 
  <p><strong>3.1 安装</strong></p> 
  <p>直接在windows下运行安装文件，一路默认。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180926102032467?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>即可将redis安装到目录“C:\Program Files\Redis”。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180925144013810?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>3.2 运行</strong></p> 
  <p>打开cmd，进入目录“C:\Program Files\Redis”，运行</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180925144547292?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>因为本文需要模拟三个SCS，因此，也需要启动三个redis进程与它们对应，用端口号区别它们。</p> 
  <p>启动另外两个cmd，进入目录“C:\Program Files\Redis”，分别运行</p> 
  <pre class="has">
<code>C:\Program Files\Redis&gt;redis-server  --port 6373</code></pre> 
  <pre class="has">
<code>C:\Program Files\Redis&gt;redis-server  --port 6374</code></pre> 
  <p>&nbsp;</p> 
  <p><strong>4. 运行monkey</strong></p> 
  <p>请到墨客官方<a href="https://github.com/MOACChain/moac-core/releases" rel="nofollow">https://github.com/MOACChain/moac-core/releases</a>下载：monkey-windows-4.0-amd64.exe。</p> 
  <p>如果下载的文件保存在“D:\fileStorm”，进入目录，运行</p> 
  <pre class="has">
<code>D:\fileStorm&gt;monkey  --listen-host-port 127.0.0.1:18082 --redis-host-port 127.0.0.1:6372 --ipfs-host-port 127.0.0.1:5002</code></pre> 
  <p>运行结果：</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180925152625453?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>运行另外两个进程：</p> 
  <pre class="has">
<code>D:\fileStorm&gt;monkey  --listen-host-port 127.0.0.1:18083 --redis-host-port 127.0.0.1:6373 --ipfs-host-port 127.0.0.1:5003</code></pre> 
  <pre class="has">
<code>D:\fileStorm&gt;monkey  --listen-host-port 127.0.0.1:18084 --redis-host-port 127.0.0.1:6374 --ipfs-host-port 127.0.0.1:5004</code></pre> 
  <p>&nbsp;</p> 
  <p><strong>5.启动SCS</strong></p> 
  <p><strong>5.1 启动Vnode节点</strong></p> 
  <p>请下载官方版本Nuwa 1.0.3下的nuwa1.0.3.win.zip；本文编辑时，该版本Vnode仅限用于testnet。</p> 
  <p>解压，里面包含两部分：scs目录为普通SCS代码（fileStrom的SCS可以作为普通SCS使用，反之不可以），vnode为底层节点代码。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930133548391?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>Vnode的配置文件vnodeconfig.json需要配置为：</p> 
  <pre class="has">
<code>{
  "SCSService":true,                  //默认false
  "ShowToPublic":false,
  "VnodeServiceCfg":"localhost:50062",
  "VnodeIp":"",
  "VnodeBeneficialAddress":"0x7610fd66c272332edd59a43460ad24eee1973bfe"
}
</code></pre> 
  <p>启动SCS之前需要启动Vnode节点，本例为测试网本地节点。</p> 
  <pre class="has">
<code>D:\nuwa1.0.3.win\vnode&gt;moac –testnet --rpc –rpccorsdomain "http://wallet.moac.io"</code></pre> 
  <p>该Vnode也就是<strong>userconfig.json&nbsp;</strong>中配置的VnodeServiceCfg。</p> 
  <p>&nbsp;</p> 
  <p><strong>5.2 下载SCS</strong></p> 
  <p>用于fileStorm的SCS程序跟普通SCS不同，从下载页<a href="https://github.com/MOACChain/moac-core/releases" rel="nofollow">https://github.com/MOACChain/moac-core/releases</a>下载fileStorm-scs1.0.3版程序。</p> 
  <p>解压下载的软件包到本地硬盘。目录下包含两个文件夹和一个readme文件：</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930134457638?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>说明：</p> 
  <ol>
   <li>config/userconfig.json：SCS节点配置文件，需要在启动前配置好；</li> 
   <li>scsserver/scsserver.exe：SCS执行程序；</li> 
   <li>readme：说明文档。 &nbsp;</li> 
  </ol>
  <p><strong>5.3 配置userconfig.json&nbsp;</strong></p> 
  <pre class="has">
<code>{
    "VnodeServiceCfg": "localhost:50062",                        //scs需要连接的Vnode IP地址和端口
    "DataDir": "./scsdata",                                      //scs数据目录
    "LogPath": "./_logs",                                        //scs日志目录
    "Beneficiary": "0x7610fd66c272332edd59a43460ad24eee1973bfe", //scs矿工收益账号
    "VnodechainId": 101,                                         //主链的网络号，miannet = 99，test net = 101
    "Capability": 10,                                            //服务子链的押金上限
    "ReconnectInterval": 5,                                      //设置与vnode连接的间隔，以秒为单位
    "LogLevel": 3,                                               //输出日志级别，数值越大，越详细
    "FileStorm": {
        "MonkeyPort": 18082                                      //monkey端口
    },
    "BondLimit":2,                                               //需要支付的押金上限
    "ReWardMin":0.0001                                           //子链每个区块的最小奖励金额
}</code></pre> 
  <p><strong>5.4 启动SCS</strong></p> 
  <p>进入目录scs\scsserver启动scs：</p> 
  <pre class="has">
<code>D:\fileStorm-scs1.0.3\scsserver&gt;scsserver -p "123456123456"   //设定密码为“123456123456”</code></pre> 
  <p>正常启动，新的SCS会出现如下界面：</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180921150707420?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>同时会在scsserver目录下生成syskeystore目录，里面包含SCS id号，也就是账号。</p> 
  <p>按照以上步骤，复制两个干净的SCS目录——分别修改userconfig.json的MonkeyPort为18083和18084——运行scsserver，启动另外两个SCS。</p> 
  <p><strong>5.5 启动一个SCS monitor</strong></p> 
  <p>使用如下命令，会将SCS设置为monitor。</p> 
  <pre class="has">
<code>D:\nuwa1.0.2.win\scs\scsserver&gt;scsserver --rpcaddr 0.0.0.0 --rpcport 2345</code></pre> 
  <p>该SCS不出块，仅同步子链的数据，并提供调用。</p> 
  <p>&nbsp;</p> 
  <p><strong>6.部署子链控制合约</strong></p> 
  <p><strong>6.1 下载fileStorm子链合约文件</strong></p> 
  <p>到官网下载子链控制合约文件：File Storm v1.0版下的DeploySubChainBase.sol。</p> 
  <p><strong>6.2 部署SubChainProtocolBase</strong></p> 
  <p>登录网页版钱包<a href="http://wallet.moac.io/" rel="nofollow">http://wallet.moac.io/</a>，按照部署合约的步骤，点击合约\部署新合约，将DeploySubChainBase.sol合约内容复制到solidity合约代码区。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930141744430?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>在选择合约里选“Sub Chain Protocol Base”，填入三个参数：</p> 
  <ol>
   <li>Protocol = filestorm-test；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\共识协议</li> 
   <li>Bmin = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\最小押金</li> 
   <li>protocol type = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\协议类型，0为普通SCS子链，1为fileStorm</li> 
  </ol>
  <p><strong>6.3 将SCS注册到刚刚部署的SubChainProtocolBase池子</strong></p> 
  <p>界面使用合约Register函数，注册SCS：参数主要包括SCS id和押金数量，此处写入2mc押金。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930144428321?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>重复以上步骤，将3个SCS均注册到池子里去。</p> 
  <p>执行交易，并完成后，SubChainProtocolBase合约将显示有6mc。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930145052625?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>6.4 部署子链控制合约SubChainBase</strong></p> 
  <p>跟<strong>6.2</strong>步骤一样；</p> 
  <p>登录网页版钱包<a href="http://wallet.moac.io/" rel="nofollow">http://wallet.moac.io/</a>，按照部署合约的步骤，点击合约\部署新合约，将DeploySubChainBase.sol合约（仍然是刚才那个合约）内容复制到solidity合约代码区。</p> 
  <p>在选择合约里选“Sub Chain Base”，填入六个参数：</p> 
  <ol>
   <li>Proto = “0x399c905f438f50eBa82c77B702675DE73047e099”； \\刚刚部署的SubChainProtocolBase合约地址</li> 
   <li>Vnode protocol base addr = “0x5B43583F33214c790B8206D9B06685c49A1DB455”；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\此处选择一个官方提供的Vnode 协议合约地址</li> 
   <li>Min = 1；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\最少SCS个数</li> 
   <li>Max&nbsp; = 10；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\\最多SCS个数</li> 
   <li>Thousandth = 1000；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\从合约池子里选择SCS的千分比，实验环境选择全部3个，所以是1000</li> 
   <li>Flush round = 100；&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \\子链刷新周期</li> 
  </ol>
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930150024185?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>6.5 开放注册</strong></p> 
  <p>使用Register Open函数功能，开放子链控制合约注册。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930151933257?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>执行之后，可以通过左边读取合约看到实时注册情况。比如：</p> 
  <ul>
   <li>通过Node list可以查询已经注册的SCS id，编号从0开始；</li> 
   <li>通过Node count可以知道已经注册的SCS个数。</li> 
  </ul>
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930152938150?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930152955202?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><strong>6.6 关闭注册</strong></p> 
  <p>在Node count的数量达到要求后，使用Register Close函数功能，关闭子链控制合约注册。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930153241978?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>成功关闭注册后，SCS开始出块：</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930163451947?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>其中较明显的变化是：MINE SUBCHAIN NUM的值由0变到1。代表该SCS已经为1个子链提供服务。</p> 
  <p><strong>6.7 注册SCSMonitor</strong></p> 
  <p>将已经启动的SCS Monitor注册到子链控制合约。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930164742523?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>几秒钟后，该SCS Monitor的界面将进行区块同步。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930165015206?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>并显示MONITOR SUBCHAIN NUM的值由0变到1。</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180930165043830?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5cTEzNTczMjIxNjc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>&nbsp;</p> 
  <p><strong>本篇总结：</strong></p> 
  <p>经过以上步骤，fileStorm的子链已经开始出块，下篇将讲解在此基础上部署和使用fileStorm的详细过程。</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lyq13573221675/article/details/82800312,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lyq13573221675/article/details/82800312,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

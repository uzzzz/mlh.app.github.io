<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>FISCO-BCOS环境搭建(五)机构证书准入 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="FISCO-BCOS环境搭建(五)机构证书准入" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="FISCO BCOS提供了证书准入的功能。在节点加入网络后，节点间是否能够通信，还可通过证书进行控制。在FISCO BCOS中，节点的证书代表了此节点属于某个机构。FISCO BCOS区块链中的管理者，可以通过配置机构的证书，控制相应证书的节点是否能够与其它节点通信。 机构证书的准入依赖系统合约，在进行机构证书准入操作前，再次请确认： （1）系统合约已经被正确的部署。 （2）所有节点的config.json的systemproxyaddress字段已经配置了相应的系统代理合约地址。 （3）节点在配置了systemproxyaddress字段后，已经重启使得系统合约生效。 （4）/mydata/FISCO-BCOS/systemcontractv2/下的config.js已经正确的配置了节点的RPC端口。 7.1 配置节点证书 节点的证书存放目录在节点文件目录的data文件夹下。包括： ca.crt：根证书公钥，整条区块链共用。 ca.key：根证书私钥，私钥应保密，仅在生成节点证书公私钥时使用。 server.crt：节点证书的公钥。 server.key：节点证书的私钥，私钥应保密。 证书文件应严格按照上述命名方法命名。 FISCO BCOS通过授权某节点对应的公钥server.crt，控制此节点是否能够与其它节点正常通信。 具体配置过程请参考2.4 配置证书 。在配置节点的步骤中已涵盖相关证书的配置方法，若按照步骤部署了节点，则可直接进入下一步骤。 7.2 开启所有节点的SSL验证功能 在进行节点证书授权管理前，需开启区块链上每个节点的SSL验证功能。 此处以创世节点为例，其它节点也应采用相同的操作。 cd /mydata/nodedata-1/ vim config.json 将ssl字段置为1，效果如下。 &quot;ssl&quot;:&quot;1&quot;, 修改完成后重启节点，使其生效。 ./stop.sh ./start.sh 其它节点也采用相同的操作，开启SSL验证功能。 注意：必须所有的节点都开启ssl功能，才能继续下一步骤。 7.3 配置机构证书信息 将节点的证书写入系统合约，为接下来的证书准入做准备。每张证书都应该写入系统合约中。节点的证书若不写入系统合约，相应的节点将不允许通信。 7.3.1 获取证书序列号 获取server.crt的序列号 cd /mydata/nodedata-2/data openssl x509 -noout -in server.crt -serial 可得到证书序列号 serial=8A4B2CDE94348D22 7.3.2 编写证书准入状态文件 在systemcontractv2目录下编写。 cd /mydata/FISCO-BCOS/systemcontractv2 vim ca.json 将序列号填入hash字段。配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书可用。即status置1。 { &quot;hash&quot; : &quot;8A4B2CDE94348D22&quot;, &quot;status&quot; : 1, &quot;pubkey&quot;:&quot;&quot;, &quot;orgname&quot;:&quot;&quot;, &quot;notbefore&quot;:20170223, &quot;notafter&quot;:20180223, &quot;whitelist&quot;:&quot;&quot;, &quot;blacklist&quot;:&quot;&quot; } 证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明 7.3.3 将证书准入状态写入系统合约 执行以下命令，指定证书准入状态文件ca.json，将证书状态写入系统合约。 babel-node tool.js CAAction update ca.json 7.4 设置证书验证开关 证书验证开关能够控制是否采用证书准入机制。开启后，将根据系统合约里的证书状态（status）控制节点间是否能够通信。不在系统合约中的证书对应的节点，将不允许通信。 在打开此开关前，请确认： （1）所有的节点都正确的配置了相应机构的证书（即server.key、server.crt）。 （2）所有节点的SSL验证已经打开。（标志位已经设置，设置后节点已经重启）。 （3）所有机构的证书信息都已经配置入系统合约。 上述条件未达到，会出现节点无法连接，节点无法共识，合约操作无法进行的情况。若出现上述情况，请先关闭所有节点的SSL验证功能，做了正确的配置后，再打开SSL功能。 7.4.1 开启全局开关 执行命令，CAVerify设置为true babel-node tool.js ConfigAction set CAVerify true 查看开关是否生效 babel-node tool.js ConfigAction get CAVerify 输出true，表示开关已打开 CAVerify=true,29 7.4.2 关闭全局开关 开关关闭后，节点间的通信不再验证证书。 执行命令，CAVerify设置为false babel-node tool.js ConfigAction set CAVerify false 7.5 修改节点证书准入状态 已经写入系统合约的证书状态，允许修改（可用/不可用） 7.5.1 修改证书准入状态文件 修改相应证书对应的证书准入状态文件ca.json /mydata/FISCO-BCOS/systemcontractv2 vim ca.json 配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书不可用。即status置0。 { &quot;hash&quot; : &quot;8A4B2CDE94348D22&quot;, &quot;status&quot; : 0, &quot;pubkey&quot;:&quot;&quot;, &quot;orgname&quot;:&quot;&quot;, &quot;notbefore&quot;:20170223, &quot;notafter&quot;:20180223, &quot;whitelist&quot;:&quot;&quot;, &quot;blacklist&quot;:&quot;&quot; } 证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明 7.5.2 更新证书准入状态 执行以下命令，指定证书准入状态文件ca.json，更新证书准入状态。 babel-node tool.js CAAction updateStatus ca.json 查看证书状态 babel-node tool.js CAAction all 可看到证书状态 ----------CA 0--------- hash=8A4B2CDE94348D22 pubkey= orgname= notbefore=20170223 notafter=20180223 status=0 blocknumber=36 whitelist= blacklist= 7.6 证书常见问题FAQ Q:证书验证的原理？&nbsp;&nbsp;A:假设A节点与B节点连接，相互连接的节点把本地的server.crt文件发送到对方节点，对方节点使用本地的ca.crt文件验证server.crt证书文件有效性，验证成功建立连接否则断连。所以要想成功建立连接确保节点的server.crt由同一ca颁发。 Q.CAAction合约验证的原理？A:打开CAVerify开关,节点连接时在CAAction合约中查找节点证书是否在合约中，如果存在节点正常连接否则连接失败。打开CAVerify开关时确保CAAction合约中已经写入区块链上所有节点的证书信息，否则未写入合约的节点无法正常连接。 Q:打开ssl节点无法连接A:1.确保所有节点的data目录下config.json配置文件中的ssl已配置为1。 2.打开CAVerify开关前确保所有节点的证书信息是否已写到CAACtion合约中。 Q:已打开CAVerify开关未写入节点证书信息到CAACtion合约中导致节点无法连接A:在所有节点的data目录下config.json配置文件中ssl设置为0并重启节点，节点正常连接后把CAVerify设置为false，再重新把所有节点的config.json配置文件中的ssl设置为1。再重新把节点证书写入CAACtion合约中再打开CAVerify开关即可。 Q:证书有效期无法设置A:生成证书脚本中ca根证书固定为10年，用户证书固定为1年，如有修改证书有效期需求可修改genkey.sh脚本中的日期即可。 Q:java客户端无法与节点通信问题A:java客户端需使用与节点相同的ca.crt证书。如节点证书自生成则使用以下指令生成java客户端证书：1、openssl pkcs12 -export -name client -in server.crt -inkey server.key -out keystore.p122、keytool -importkeystore -destkeystore client.keystore -srckeystore keystore.p12 -srcstoretype pkcs12 -alias client3、Attention！ Password must be ”123456” 阅读更多" />
<meta property="og:description" content="FISCO BCOS提供了证书准入的功能。在节点加入网络后，节点间是否能够通信，还可通过证书进行控制。在FISCO BCOS中，节点的证书代表了此节点属于某个机构。FISCO BCOS区块链中的管理者，可以通过配置机构的证书，控制相应证书的节点是否能够与其它节点通信。 机构证书的准入依赖系统合约，在进行机构证书准入操作前，再次请确认： （1）系统合约已经被正确的部署。 （2）所有节点的config.json的systemproxyaddress字段已经配置了相应的系统代理合约地址。 （3）节点在配置了systemproxyaddress字段后，已经重启使得系统合约生效。 （4）/mydata/FISCO-BCOS/systemcontractv2/下的config.js已经正确的配置了节点的RPC端口。 7.1 配置节点证书 节点的证书存放目录在节点文件目录的data文件夹下。包括： ca.crt：根证书公钥，整条区块链共用。 ca.key：根证书私钥，私钥应保密，仅在生成节点证书公私钥时使用。 server.crt：节点证书的公钥。 server.key：节点证书的私钥，私钥应保密。 证书文件应严格按照上述命名方法命名。 FISCO BCOS通过授权某节点对应的公钥server.crt，控制此节点是否能够与其它节点正常通信。 具体配置过程请参考2.4 配置证书 。在配置节点的步骤中已涵盖相关证书的配置方法，若按照步骤部署了节点，则可直接进入下一步骤。 7.2 开启所有节点的SSL验证功能 在进行节点证书授权管理前，需开启区块链上每个节点的SSL验证功能。 此处以创世节点为例，其它节点也应采用相同的操作。 cd /mydata/nodedata-1/ vim config.json 将ssl字段置为1，效果如下。 &quot;ssl&quot;:&quot;1&quot;, 修改完成后重启节点，使其生效。 ./stop.sh ./start.sh 其它节点也采用相同的操作，开启SSL验证功能。 注意：必须所有的节点都开启ssl功能，才能继续下一步骤。 7.3 配置机构证书信息 将节点的证书写入系统合约，为接下来的证书准入做准备。每张证书都应该写入系统合约中。节点的证书若不写入系统合约，相应的节点将不允许通信。 7.3.1 获取证书序列号 获取server.crt的序列号 cd /mydata/nodedata-2/data openssl x509 -noout -in server.crt -serial 可得到证书序列号 serial=8A4B2CDE94348D22 7.3.2 编写证书准入状态文件 在systemcontractv2目录下编写。 cd /mydata/FISCO-BCOS/systemcontractv2 vim ca.json 将序列号填入hash字段。配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书可用。即status置1。 { &quot;hash&quot; : &quot;8A4B2CDE94348D22&quot;, &quot;status&quot; : 1, &quot;pubkey&quot;:&quot;&quot;, &quot;orgname&quot;:&quot;&quot;, &quot;notbefore&quot;:20170223, &quot;notafter&quot;:20180223, &quot;whitelist&quot;:&quot;&quot;, &quot;blacklist&quot;:&quot;&quot; } 证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明 7.3.3 将证书准入状态写入系统合约 执行以下命令，指定证书准入状态文件ca.json，将证书状态写入系统合约。 babel-node tool.js CAAction update ca.json 7.4 设置证书验证开关 证书验证开关能够控制是否采用证书准入机制。开启后，将根据系统合约里的证书状态（status）控制节点间是否能够通信。不在系统合约中的证书对应的节点，将不允许通信。 在打开此开关前，请确认： （1）所有的节点都正确的配置了相应机构的证书（即server.key、server.crt）。 （2）所有节点的SSL验证已经打开。（标志位已经设置，设置后节点已经重启）。 （3）所有机构的证书信息都已经配置入系统合约。 上述条件未达到，会出现节点无法连接，节点无法共识，合约操作无法进行的情况。若出现上述情况，请先关闭所有节点的SSL验证功能，做了正确的配置后，再打开SSL功能。 7.4.1 开启全局开关 执行命令，CAVerify设置为true babel-node tool.js ConfigAction set CAVerify true 查看开关是否生效 babel-node tool.js ConfigAction get CAVerify 输出true，表示开关已打开 CAVerify=true,29 7.4.2 关闭全局开关 开关关闭后，节点间的通信不再验证证书。 执行命令，CAVerify设置为false babel-node tool.js ConfigAction set CAVerify false 7.5 修改节点证书准入状态 已经写入系统合约的证书状态，允许修改（可用/不可用） 7.5.1 修改证书准入状态文件 修改相应证书对应的证书准入状态文件ca.json /mydata/FISCO-BCOS/systemcontractv2 vim ca.json 配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书不可用。即status置0。 { &quot;hash&quot; : &quot;8A4B2CDE94348D22&quot;, &quot;status&quot; : 0, &quot;pubkey&quot;:&quot;&quot;, &quot;orgname&quot;:&quot;&quot;, &quot;notbefore&quot;:20170223, &quot;notafter&quot;:20180223, &quot;whitelist&quot;:&quot;&quot;, &quot;blacklist&quot;:&quot;&quot; } 证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明 7.5.2 更新证书准入状态 执行以下命令，指定证书准入状态文件ca.json，更新证书准入状态。 babel-node tool.js CAAction updateStatus ca.json 查看证书状态 babel-node tool.js CAAction all 可看到证书状态 ----------CA 0--------- hash=8A4B2CDE94348D22 pubkey= orgname= notbefore=20170223 notafter=20180223 status=0 blocknumber=36 whitelist= blacklist= 7.6 证书常见问题FAQ Q:证书验证的原理？&nbsp;&nbsp;A:假设A节点与B节点连接，相互连接的节点把本地的server.crt文件发送到对方节点，对方节点使用本地的ca.crt文件验证server.crt证书文件有效性，验证成功建立连接否则断连。所以要想成功建立连接确保节点的server.crt由同一ca颁发。 Q.CAAction合约验证的原理？A:打开CAVerify开关,节点连接时在CAAction合约中查找节点证书是否在合约中，如果存在节点正常连接否则连接失败。打开CAVerify开关时确保CAAction合约中已经写入区块链上所有节点的证书信息，否则未写入合约的节点无法正常连接。 Q:打开ssl节点无法连接A:1.确保所有节点的data目录下config.json配置文件中的ssl已配置为1。 2.打开CAVerify开关前确保所有节点的证书信息是否已写到CAACtion合约中。 Q:已打开CAVerify开关未写入节点证书信息到CAACtion合约中导致节点无法连接A:在所有节点的data目录下config.json配置文件中ssl设置为0并重启节点，节点正常连接后把CAVerify设置为false，再重新把所有节点的config.json配置文件中的ssl设置为1。再重新把节点证书写入CAACtion合约中再打开CAVerify开关即可。 Q:证书有效期无法设置A:生成证书脚本中ca根证书固定为10年，用户证书固定为1年，如有修改证书有效期需求可修改genkey.sh脚本中的日期即可。 Q:java客户端无法与节点通信问题A:java客户端需使用与节点相同的ca.crt证书。如节点证书自生成则使用以下指令生成java客户端证书：1、openssl pkcs12 -export -name client -in server.crt -inkey server.key -out keystore.p122、keytool -importkeystore -destkeystore client.keystore -srckeystore keystore.p12 -srcstoretype pkcs12 -alias client3、Attention！ Password must be ”123456” 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/04/03/afaee1aefee469b88024d17fb40988a5.html" />
<meta property="og:url" content="https://mlh.app/2018/04/03/afaee1aefee469b88024d17fb40988a5.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-03T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"FISCO BCOS提供了证书准入的功能。在节点加入网络后，节点间是否能够通信，还可通过证书进行控制。在FISCO BCOS中，节点的证书代表了此节点属于某个机构。FISCO BCOS区块链中的管理者，可以通过配置机构的证书，控制相应证书的节点是否能够与其它节点通信。 机构证书的准入依赖系统合约，在进行机构证书准入操作前，再次请确认： （1）系统合约已经被正确的部署。 （2）所有节点的config.json的systemproxyaddress字段已经配置了相应的系统代理合约地址。 （3）节点在配置了systemproxyaddress字段后，已经重启使得系统合约生效。 （4）/mydata/FISCO-BCOS/systemcontractv2/下的config.js已经正确的配置了节点的RPC端口。 7.1 配置节点证书 节点的证书存放目录在节点文件目录的data文件夹下。包括： ca.crt：根证书公钥，整条区块链共用。 ca.key：根证书私钥，私钥应保密，仅在生成节点证书公私钥时使用。 server.crt：节点证书的公钥。 server.key：节点证书的私钥，私钥应保密。 证书文件应严格按照上述命名方法命名。 FISCO BCOS通过授权某节点对应的公钥server.crt，控制此节点是否能够与其它节点正常通信。 具体配置过程请参考2.4 配置证书 。在配置节点的步骤中已涵盖相关证书的配置方法，若按照步骤部署了节点，则可直接进入下一步骤。 7.2 开启所有节点的SSL验证功能 在进行节点证书授权管理前，需开启区块链上每个节点的SSL验证功能。 此处以创世节点为例，其它节点也应采用相同的操作。 cd /mydata/nodedata-1/ vim config.json 将ssl字段置为1，效果如下。 &quot;ssl&quot;:&quot;1&quot;, 修改完成后重启节点，使其生效。 ./stop.sh ./start.sh 其它节点也采用相同的操作，开启SSL验证功能。 注意：必须所有的节点都开启ssl功能，才能继续下一步骤。 7.3 配置机构证书信息 将节点的证书写入系统合约，为接下来的证书准入做准备。每张证书都应该写入系统合约中。节点的证书若不写入系统合约，相应的节点将不允许通信。 7.3.1 获取证书序列号 获取server.crt的序列号 cd /mydata/nodedata-2/data openssl x509 -noout -in server.crt -serial 可得到证书序列号 serial=8A4B2CDE94348D22 7.3.2 编写证书准入状态文件 在systemcontractv2目录下编写。 cd /mydata/FISCO-BCOS/systemcontractv2 vim ca.json 将序列号填入hash字段。配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书可用。即status置1。 { &quot;hash&quot; : &quot;8A4B2CDE94348D22&quot;, &quot;status&quot; : 1, &quot;pubkey&quot;:&quot;&quot;, &quot;orgname&quot;:&quot;&quot;, &quot;notbefore&quot;:20170223, &quot;notafter&quot;:20180223, &quot;whitelist&quot;:&quot;&quot;, &quot;blacklist&quot;:&quot;&quot; } 证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明 7.3.3 将证书准入状态写入系统合约 执行以下命令，指定证书准入状态文件ca.json，将证书状态写入系统合约。 babel-node tool.js CAAction update ca.json 7.4 设置证书验证开关 证书验证开关能够控制是否采用证书准入机制。开启后，将根据系统合约里的证书状态（status）控制节点间是否能够通信。不在系统合约中的证书对应的节点，将不允许通信。 在打开此开关前，请确认： （1）所有的节点都正确的配置了相应机构的证书（即server.key、server.crt）。 （2）所有节点的SSL验证已经打开。（标志位已经设置，设置后节点已经重启）。 （3）所有机构的证书信息都已经配置入系统合约。 上述条件未达到，会出现节点无法连接，节点无法共识，合约操作无法进行的情况。若出现上述情况，请先关闭所有节点的SSL验证功能，做了正确的配置后，再打开SSL功能。 7.4.1 开启全局开关 执行命令，CAVerify设置为true babel-node tool.js ConfigAction set CAVerify true 查看开关是否生效 babel-node tool.js ConfigAction get CAVerify 输出true，表示开关已打开 CAVerify=true,29 7.4.2 关闭全局开关 开关关闭后，节点间的通信不再验证证书。 执行命令，CAVerify设置为false babel-node tool.js ConfigAction set CAVerify false 7.5 修改节点证书准入状态 已经写入系统合约的证书状态，允许修改（可用/不可用） 7.5.1 修改证书准入状态文件 修改相应证书对应的证书准入状态文件ca.json /mydata/FISCO-BCOS/systemcontractv2 vim ca.json 配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书不可用。即status置0。 { &quot;hash&quot; : &quot;8A4B2CDE94348D22&quot;, &quot;status&quot; : 0, &quot;pubkey&quot;:&quot;&quot;, &quot;orgname&quot;:&quot;&quot;, &quot;notbefore&quot;:20170223, &quot;notafter&quot;:20180223, &quot;whitelist&quot;:&quot;&quot;, &quot;blacklist&quot;:&quot;&quot; } 证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明 7.5.2 更新证书准入状态 执行以下命令，指定证书准入状态文件ca.json，更新证书准入状态。 babel-node tool.js CAAction updateStatus ca.json 查看证书状态 babel-node tool.js CAAction all 可看到证书状态 ----------CA 0--------- hash=8A4B2CDE94348D22 pubkey= orgname= notbefore=20170223 notafter=20180223 status=0 blocknumber=36 whitelist= blacklist= 7.6 证书常见问题FAQ Q:证书验证的原理？&nbsp;&nbsp;A:假设A节点与B节点连接，相互连接的节点把本地的server.crt文件发送到对方节点，对方节点使用本地的ca.crt文件验证server.crt证书文件有效性，验证成功建立连接否则断连。所以要想成功建立连接确保节点的server.crt由同一ca颁发。 Q.CAAction合约验证的原理？A:打开CAVerify开关,节点连接时在CAAction合约中查找节点证书是否在合约中，如果存在节点正常连接否则连接失败。打开CAVerify开关时确保CAAction合约中已经写入区块链上所有节点的证书信息，否则未写入合约的节点无法正常连接。 Q:打开ssl节点无法连接A:1.确保所有节点的data目录下config.json配置文件中的ssl已配置为1。 2.打开CAVerify开关前确保所有节点的证书信息是否已写到CAACtion合约中。 Q:已打开CAVerify开关未写入节点证书信息到CAACtion合约中导致节点无法连接A:在所有节点的data目录下config.json配置文件中ssl设置为0并重启节点，节点正常连接后把CAVerify设置为false，再重新把所有节点的config.json配置文件中的ssl设置为1。再重新把节点证书写入CAACtion合约中再打开CAVerify开关即可。 Q:证书有效期无法设置A:生成证书脚本中ca根证书固定为10年，用户证书固定为1年，如有修改证书有效期需求可修改genkey.sh脚本中的日期即可。 Q:java客户端无法与节点通信问题A:java客户端需使用与节点相同的ca.crt证书。如节点证书自生成则使用以下指令生成java客户端证书：1、openssl pkcs12 -export -name client -in server.crt -inkey server.key -out keystore.p122、keytool -importkeystore -destkeystore client.keystore -srckeystore keystore.p12 -srcstoretype pkcs12 -alias client3、Attention！ Password must be ”123456” 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/04/03/afaee1aefee469b88024d17fb40988a5.html","headline":"FISCO-BCOS环境搭建(五)机构证书准入","dateModified":"2018-04-03T00:00:00+08:00","datePublished":"2018-04-03T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/04/03/afaee1aefee469b88024d17fb40988a5.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>FISCO-BCOS环境搭建(五)机构证书准入</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">FISCO BCOS提供了证书准入的功能。在节点加入网络后，节点间是否能够通信，还可通过证书进行控制。在FISCO BCOS中，节点的证书代表了此节点属于某个机构。FISCO BCOS区块链中的管理者，可以通过配置机构的证书，控制相应证书的节点是否能够与其它节点通信。</p>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>机构证书的准入依赖系统合约，在进行机构证书准入操作前，再次请确认：</p>
   <p>（1）系统合约已经被正确的部署。</p>
   <p>（2）所有节点的config.json的systemproxyaddress字段已经配置了相应的系统代理合约地址。</p>
   <p>（3）节点在配置了systemproxyaddress字段后，已经重启使得系统合约生效。</p>
   <p>（4）/mydata/FISCO-BCOS/systemcontractv2/下的config.js已经正确的配置了节点的RPC端口。</p>
  </blockquote>
  <h3 style="font-size:1.25em;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#71-%E9%85%8D%E7%BD%AE%E8%8A%82%E7%82%B9%E8%AF%81%E4%B9%A6" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.1 配置节点证书</h3>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">节点的证书存放目录在节点文件目录的data文件夹下。包括：</p>
  <ul style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <li>ca.crt：根证书公钥，整条区块链共用。</li>
   <li>ca.key：根证书私钥，私钥应保密，仅在生成节点证书公私钥时使用。</li>
   <li>server.crt：节点证书的公钥。</li>
   <li>server.key：节点证书的私钥，私钥应保密。</li>
  </ul>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">证书文件应严格按照上述命名方法命名。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">FISCO BCOS通过授权某节点对应的公钥server.crt，控制此节点是否能够与其它节点正常通信。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">具体配置过程请参考2.4 配置证书 。在配置节点的步骤中已涵盖相关证书的配置方法，若按照步骤部署了节点，则可直接进入下一步骤。</p>
  <h3 style="font-size:1.25em;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#72-%E5%BC%80%E5%90%AF%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E7%9A%84ssl%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.2 开启所有节点的SSL验证功能</h3>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">在进行节点证书授权管理前，需开启区块链上<span style="font-weight:600;">每个节点</span>的SSL验证功能。</p>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>此处以创世节点为例，其它节点也应采用相同的操作。</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);"><span class="pl-c1" style="color:rgb(0,92,197);">cd</span> /mydata/nodedata-1/
vim config.json</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>将ssl字段置为1，效果如下。</p>
  </blockquote>
  <div class="highlight highlight-source-json" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);"><span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>ssl<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>,</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>修改完成后重启节点，使其生效。</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">./stop.sh
./start.sh</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>其它节点也采用相同的操作，开启SSL验证功能。</p>
  </blockquote>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">注意：必须所有的节点都开启ssl功能，才能继续下一步骤。</span></p>
  <h3 style="font-size:1.25em;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#73-%E9%85%8D%E7%BD%AE%E6%9C%BA%E6%9E%84%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.3 配置机构证书信息</h3>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">将节点的证书写入系统合约，为接下来的证书准入做准备。每张证书都应该写入系统合约中。节点的证书若不写入系统合约，相应的节点将不允许通信。</p>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#731-%E8%8E%B7%E5%8F%96%E8%AF%81%E4%B9%A6%E5%BA%8F%E5%88%97%E5%8F%B7" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.3.1 获取证书序列号</h4>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>获取server.crt的序列号</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);"><span class="pl-c1" style="color:rgb(0,92,197);">cd</span> /mydata/nodedata-2/data
openssl x509 -noout -in server.crt -serial</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>可得到证书序列号</p>
  </blockquote>
  <pre lang="log" style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);color:rgb(36,41,46);" xml:lang="log"><code style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;background:transparent;border:0px;line-height:inherit;">serial=8A4B2CDE94348D22
</code></pre>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#732-%E7%BC%96%E5%86%99%E8%AF%81%E4%B9%A6%E5%87%86%E5%85%A5%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.3.2 编写证书准入状态文件</h4>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>在systemcontractv2目录下编写。</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);"><span class="pl-c1" style="color:rgb(0,92,197);">cd</span> /mydata/FISCO-BCOS/systemcontractv2
vim ca.json</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>将序列号填入hash字段。配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书可用。即status置1。</p>
  </blockquote>
  <div class="highlight highlight-source-json" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">{
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span> : <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>8A4B2CDE94348D22<span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span> : <span class="pl-c1" style="color:rgb(0,92,197);">1</span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>pubkey<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>orgname<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>notbefore<span class="pl-pds">"</span></span>:<span class="pl-c1" style="color:rgb(0,92,197);">20170223</span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>notafter<span class="pl-pds">"</span></span>:<span class="pl-c1" style="color:rgb(0,92,197);">20180223</span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>whitelist<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>blacklist<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
}</pre>
  </div>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明</p>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#733-%E5%B0%86%E8%AF%81%E4%B9%A6%E5%87%86%E5%85%A5%E7%8A%B6%E6%80%81%E5%86%99%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%90%88%E7%BA%A6" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.3.3 将证书准入状态写入系统合约</h4>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>执行以下命令，指定证书准入状态文件ca.json，将证书状态写入系统合约。</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">babel-node tool.js CAAction update ca.json</pre>
  </div>
  <h3 style="font-size:1.25em;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#74-%E8%AE%BE%E7%BD%AE%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%E5%BC%80%E5%85%B3" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.4 设置证书验证开关</h3>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">证书验证开关能够控制是否采用证书准入机制。开启后，将根据系统合约里的证书状态（status）控制节点间是否能够通信。不在系统合约中的证书对应的节点，将不允许通信。</p>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>在打开此开关前，请确认：</p>
   <p>（1）所有的节点都正确的配置了相应机构的证书（即server.key、server.crt）。</p>
   <p>（2）所有节点的SSL验证已经打开。（标志位已经设置，设置后节点已经重启）。</p>
   <p>（3）所有机构的证书信息都已经配置入系统合约。</p>
   <p>上述条件未达到，会出现节点无法连接，节点无法共识，合约操作无法进行的情况。若出现上述情况，请先关闭所有节点的SSL验证功能，做了正确的配置后，再打开SSL功能。</p>
  </blockquote>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#741-%E5%BC%80%E5%90%AF%E5%85%A8%E5%B1%80%E5%BC%80%E5%85%B3" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.4.1 开启全局开关</h4>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>执行命令，CAVerify设置为true</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">babel-node tool.js ConfigAction <span class="pl-c1" style="color:rgb(0,92,197);">set</span> CAVerify <span class="pl-c1" style="color:rgb(0,92,197);">true</span></pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>查看开关是否生效</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">babel-node tool.js ConfigAction get CAVerify</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>输出true，表示开关已打开</p>
  </blockquote>
  <pre lang="log" style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);color:rgb(36,41,46);" xml:lang="log"><code style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;background:transparent;border:0px;line-height:inherit;">CAVerify=true,29
</code></pre>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#742-%E5%85%B3%E9%97%AD%E5%85%A8%E5%B1%80%E5%BC%80%E5%85%B3" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.4.2 关闭全局开关</h4>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">开关关闭后，节点间的通信不再验证证书。</p>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>执行命令，CAVerify设置为false</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">babel-node tool.js ConfigAction <span class="pl-c1" style="color:rgb(0,92,197);">set</span> CAVerify <span class="pl-c1" style="color:rgb(0,92,197);">false</span></pre>
  </div>
  <h3 style="font-size:1.25em;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#75-%E4%BF%AE%E6%94%B9%E8%8A%82%E7%82%B9%E8%AF%81%E4%B9%A6%E5%87%86%E5%85%A5%E7%8A%B6%E6%80%81" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.5 修改节点证书准入状态</h3>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">已经写入系统合约的证书状态，允许修改（可用/不可用）</p>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#751-%E4%BF%AE%E6%94%B9%E8%AF%81%E4%B9%A6%E5%87%86%E5%85%A5%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.5.1 修改证书准入状态文件</h4>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>修改相应证书对应的证书准入状态文件ca.json</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">/mydata/FISCO-BCOS/systemcontractv2
vim ca.json</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>配置status，0表示不可用，1表示可用。其它字段默认即可。如下，让node2的证书不可用。即status置0。</p>
  </blockquote>
  <div class="highlight highlight-source-json" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">{
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>hash<span class="pl-pds">"</span></span> : <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>8A4B2CDE94348D22<span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span> : <span class="pl-c1" style="color:rgb(0,92,197);">0</span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>pubkey<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>orgname<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>notbefore<span class="pl-pds">"</span></span>:<span class="pl-c1" style="color:rgb(0,92,197);">20170223</span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>notafter<span class="pl-pds">"</span></span>:<span class="pl-c1" style="color:rgb(0,92,197);">20180223</span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>whitelist<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
        <span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span>blacklist<span class="pl-pds">"</span></span>:<span class="pl-s" style="color:rgb(3,47,98);"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
}</pre>
  </div>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">证书准入状态文件其它字段说明请参考11.6 证书准入状态文件说明</p>
  <h4 style="font-size:16px;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#752-%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6%E5%87%86%E5%85%A5%E7%8A%B6%E6%80%81" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.5.2 更新证书准入状态</h4>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>执行以下命令，指定证书准入状态文件ca.json，更新证书准入状态。</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">babel-node tool.js CAAction updateStatus ca.json</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>查看证书状态</p>
  </blockquote>
  <div class="highlight highlight-source-shell" style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);">babel-node tool.js CAAction all</pre>
  </div>
  <blockquote style="color:rgb(106,115,125);border-left:.25em solid rgb(223,226,229);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">
   <p>可看到证书状态</p>
  </blockquote>
  <pre lang="log" style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);color:rgb(36,41,46);" xml:lang="log"><code style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;background:transparent;border:0px;line-height:inherit;">----------CA 0---------
hash=8A4B2CDE94348D22
pubkey=
orgname=
notbefore=20170223
notafter=20180223
status=0
blocknumber=36
whitelist=
blacklist=

</code></pre>
  <h3 style="font-size:1.25em;line-height:1.25;color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><a class="anchor" href="https://github.com/FISCO-BCOS/FISCO-BCOS/tree/master/doc/manual#76-%E8%AF%81%E4%B9%A6%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98faq" rel="nofollow" style="color:rgb(3,102,214);margin-left:-20px;line-height:1;"></a>7.6 证书常见问题FAQ</h3>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">Q:证书验证的原理？</span>&nbsp;&nbsp;<br>A:假设A节点与B节点连接，相互连接的节点把本地的server.crt文件发送到对方节点，对方节点使用本地的ca.crt文件验证server.crt证书文件有效性，验证成功建立连接否则断连。所以要想成功建立连接确保节点的server.crt由同一ca颁发。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">Q.CAAction合约验证的原理？</span><br>A:打开CAVerify开关,节点连接时在CAAction合约中查找节点证书是否在合约中，如果存在节点正常连接否则连接失败。打开CAVerify开关时确保CAAction合约中已经写入区块链上所有节点的证书信息，否则未写入合约的节点无法正常连接。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">Q:打开ssl节点无法连接</span><br>A:1.确保所有节点的data目录下config.json配置文件中的ssl已配置为1。 2.打开CAVerify开关前确保所有节点的证书信息是否已写到CAACtion合约中。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">Q:已打开CAVerify开关未写入节点证书信息到CAACtion合约中导致节点无法连接</span><br>A:在所有节点的data目录下config.json配置文件中ssl设置为0并重启节点，节点正常连接后把CAVerify设置为false，再重新把所有节点的config.json配置文件中的ssl设置为1。再重新把节点证书写入CAACtion合约中再打开CAVerify开关即可。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">Q:证书有效期无法设置</span><br>A:生成证书脚本中ca根证书固定为10年，用户证书固定为1年，如有修改证书有效期需求可修改genkey.sh脚本中的日期即可。</p>
  <p style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';"><span style="font-weight:600;">Q:java客户端无法与节点通信问题</span><br>A:java客户端需使用与节点相同的ca.crt证书。如节点证书自生成则使用以下指令生成java客户端证书：<br>1、openssl pkcs12 -export -name client -in server.crt -inkey server.key -out keystore.p12<br>2、keytool -importkeystore -destkeystore client.keystore -srckeystore keystore.p12 -srcstoretype pkcs12 -alias client<br>3、Attention！ Password must be ”123456”</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/h363659487/article/details/79802418,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/h363659487/article/details/79802418,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

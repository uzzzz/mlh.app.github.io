<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链开发（一）搭建基于以太坊go-ethereum的私有链环境 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链开发（一）搭建基于以太坊go-ethereum的私有链环境" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="通过各方资料了解学习之后，决定自己开始搭建基于以太坊go-ethereum的私有链环境。由于本人的电脑系统为win10，为避免window环境出现过多莫名其妙的问题，特意通过vm搭建了一台ubuntu17.10版本的虚拟系统。以下内容均基于ubuntu17.10系统。 1. go-ethereum客户端 1.1. 下载地址&amp;参考手册 首先，可以查看一下go-ethereum项目在git上的地址： https://github.com/ethereum/Go-ethereum 可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： https://github.com/ethereum/Go-ethereum/wiki/Building-Ethereum 在wiki页面选择ubuntu系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Ubuntu 在wiki页面选择mac系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Mac 在wiki页面选择windows系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-instructions-for-Windows 可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： https://github.com/ethereum/go-ethereum/wiki/private-network 2. 安装步骤 2.1. ubuntu 更换apt-get为国内阿里云源 备份系统默认的源（没有root权限的前面加sudo） cp /etc/apt/sources.list /etc/apt/sources.list.bak 修改/etc/apt/sources.list # deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties deb http://archive.canonical.com/ubuntu xenial partner deb-src http://archive.canonical.com/ubuntu xenial partner deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse 执行更新 sudo apt-get update //不执行是不生效的 2.1.1. 安装 geth sudo apt-get install software-properties-common sudo add-apt-repository -y ppa:ethereum/ethereum sudo apt-get update sudo apt-get install ethereum somnus@ubuntu:~$ geth version Geth Version: 1.8.2-stable Git Commit: b8b9f7f4476a30a0aaf6077daade6ae77f969960 Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 Go Version: go1.9.4 Operating System: linux GOPATH= GOROOT=/usr/lib/go-1.9 somnus@ubuntu:~$ 2.1.2. 安装 solc sudo apt-get install solc -y somnus@ubuntu:~$ solc --version solc, the solidity compiler commandline interface Version: 0.4.19+commit.c4cbbb05.Linux.g++ 2.2. Windows 访问 https://geth.ethereum.org/downloads/ 下载并安装 Geth for Windows 2.3. Mac OS brew tap ethereum/ethereum brew install ethereum 3. 创世区块 创建一个文件夹来存储你的私链数据 mkdir -p ethereum &amp;&amp; cd ethereum 3.1. 初始化创世区块 { &quot;nonce&quot;: &quot;0x0000000000000042&quot;, &quot;difficulty&quot;: &quot;0x0f0000&quot;, &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &quot;timestamp&quot;: &quot;0x00&quot;, &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;extraData&quot;: &quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &quot;gasLimit&quot;: &quot;0x4c4b40&quot;, &quot;config&quot;: { &quot;chainId&quot;: 15, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;alloc&quot;: { } } 参数解释： 参数名称 参数描述 mixhash 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 nonce nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase 矿工的账号，随便填 timestamp 设置创世块的时间戳 parentHash 上一个区块的hash值，因为是创世块，所以这个值是0 extraData 附加信息，随便填，可以填你的个性信息 gasLimit 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 初始化创世区块 默认目录是root/ethereum/ 你可以通过--datadir 参数指定目录 somnus@ubuntu:~/ethereum$ geth --datadir data init genesis.json INFO [04-01|19:53:03] Maximum peer count ETH=25 LES=0 total=25 INFO [04-01|19:53:03] Allocated cache and file handles database=/home/somnus/ethereum/data/geth/chaindata cache=16 handles=16 INFO [04-01|19:53:03] Writing custom genesis block INFO [04-01|19:53:03] Persisted trie from memory database nodes=0 size=0.00B time=2.123µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|19:53:03] Successfully wrote genesis state database=chaindata hash=611596…424d04 INFO [04-01|19:53:03] Allocated cache and file handles database=/home/somnus/ethereum/data/geth/lightchaindata cache=16 handles=16 INFO [04-01|19:53:03] Writing custom genesis block INFO [04-01|19:53:03] Persisted trie from memory database nodes=0 size=0.00B time=2.565µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|19:53:03] Successfully wrote genesis state database=lightchaindata hash=611596…424d04 somnus@ubuntu:~/ethereum$ find data data data/keystore data/geth data/geth/chaindata data/geth/chaindata/LOCK data/geth/chaindata/LOG data/geth/chaindata/MANIFEST-000000 data/geth/chaindata/CURRENT data/geth/chaindata/000001.log data/geth/lightchaindata data/geth/lightchaindata/LOCK data/geth/lightchaindata/LOG data/geth/lightchaindata/MANIFEST-000000 data/geth/lightchaindata/CURRENT data/geth/lightchaindata/000001.log 目录结构 data ├── geth │ ├── chaindata │ │ ├── 000001.log │ │ ├── CURRENT │ │ ├── LOCK │ │ ├── LOG │ │ └── MANIFEST-000000 │ └── lightchaindata │ ├── 000001.log │ ├── CURRENT │ ├── LOCK │ ├── LOG │ └── MANIFEST-000000 └── keystore 3.2. 启动节点 somnus@ubuntu:~/ethereum$ geth --networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console INFO [04-01|20:00:31] Maximum peer count ETH=25 LES=0 total=25 INFO [04-01|20:00:31] Starting peer-to-peer node instance=Geth/v1.8.2-stable-b8b9f7f4/linux-amd64/go1.9.4 INFO [04-01|20:00:31] Allocated cache and file handles database=/home/somnus/.ethereum/geth/chaindata cache=768 handles=512 INFO [04-01|20:00:31] Writing default main-net genesis block INFO [04-01|20:00:31] Persisted trie from memory database nodes=12356 size=2.34mB time=41.622179ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|20:00:31] Initialised chain configuration config=&quot;{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: &lt;nil&gt; Engine: ethash}&quot; INFO [04-01|20:00:31] Disk storage enabled for ethash caches dir=/home/somnus/.ethereum/geth/ethash count=3 INFO [04-01|20:00:31] Disk storage enabled for ethash DAGs dir=/home/somnus/.ethash count=2 INFO [04-01|20:00:31] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=123456 INFO [04-01|20:00:31] Loaded most recent local header number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Loaded most recent local fast block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Regenerated local transaction journal transactions=0 accounts=0 INFO [04-01|20:00:31] Starting P2P networking INFO [04-01|20:00:31] HTTP endpoint opened url=http://127.0.0.1:8545 cors=* vhosts=localhost INFO [04-01|20:00:31] RLPx listener up self=&quot;enode://50e818e4a6ecaba459ebb3edacaaab170e206d16410a52ea67e41324228382ec91dbfea1e324ade4708fc32fa8b952b15b75b0b87cdb307ed8b9629b4d42640d@[::]:30303?discport=0&quot; INFO [04-01|20:00:31] IPC endpoint opened url=/home/somnus/.ethereum/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.8.2-stable-b8b9f7f4/linux-amd64/go1.9.4 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; 启动私有节点所需参数 参数名称 参数描述 identity 区块链的标示，随便填写，用于标示目前网络的名字 init 指定创世块文件的位置，并创建初始块 datadir 设置当前区块链网络数据存放的位置 port 网络监听端口 rpc 启动rpc通信，可以进行智能合约的部署和调试 rpcapi 设置允许连接的rpc的客户端，一般为db,eth,net,web3 rpcaddr HTTP-RPC 服务ip地址（默认127.0.0.1） rpcport 指定 HTTP-RPC 服务监听端口号（默认为 8545）； networkid 设置当前区块链的网络ID，用于区分不同的网络，是一个数字，如果在默认模式下启动，网络ID为1，代码会自动连接到以太坊主链 console 启动命令行模式，可以在Geth中执行命令 nodiscover 关闭节点发现机制，防止加入有同样初始配置的陌生节点。 请注意，在我们的genesis.json文件里networkid（15）和“chainid”必须是相同的。 //在需要日志文件的情况下 geth --networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console 2&gt;&gt;geth.log 在已启动的情况下如何进入终端 geth attach ipc:/usr/local/ethereum/data/geth.ipc 在其它服务器中如何进入终端 geth attach http://121.43.162.28:8545 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 4. 用户 如跳过这一步骤，进入挖矿会报如下错误，需要设置一个挖矿的账号 Error: etherbase missing: etherbase address must be explicitly specified at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 4.1. 查看账户 //方式一 somnus@ubuntu:~/ethereum$ personal.listAccounts //方式二 somnus@ubuntu:~/ethereum$ eth.accounts //方式三 somnus@ubuntu:~/ethereum$ geth account list Account #0: {83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6 Account #1: {e8abf98484325fd6afc59b804ac15804b978e607} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T06-11-23.608902164Z--e8abf98484325fd6afc59b804ac15804b978e607 4.2. 创建用户 //方式一（参数为此账户的密码） personal.newAccount(&quot;123456&quot;) //方式二（也可以先创建账户，然后输入密码：） personal.newAccount() 默认挖矿账号就是第一个设置的账号，当然也可以自行设置 eth.coinbase miner.setEtherbase(eth.accounts[0]) 查看区块数据 eth.blockNumber 5. 余额 &gt; eth.getBalance(eth.accounts[0]) 70000000000000000000 eth.getBalance()返回的余额是以太币的最小面额wei，将wei转换为以太币ether。 //primary = eth.accounts[0] //balance = web3.fromWei(eth.getBalance(primary), &quot;ether&quot;); &gt; web3.fromWei(eth.getBalance(eth.accounts[0]), &quot;ether&quot;) 70 备注eth单位解释： kwei (1000 Wei) mwei (1000 KWei) gwei (1000 mwei) szabo (1000 gwei) finney (1000 szabo) ether (1000 finney) 也就是说ether =wei * 10^18，也就是说精度可以达到18位。 //wei转ether &gt; web3.fromWei(1000000000000000000,&quot;ether&quot;) &quot;1&quot; //ether转wei &gt; web3.toWei(1) &quot;1000000000000000000&quot; ps:web3命令 https://ethereumbuilders.gitbooks.io/guide/content/en/ethereum_javascript_api.html 6. 使用节点进行挖矿 6.1. 启动矿工开始挖矿 miner.start(1) 这里的1表示只使用一个线程运行,第一次运行时将开始创建DAG文件，只需等待进度条到100，则将开始挖矿。 实际你看到的挖矿速度很快，这是因为我们已经在初始化创世区块时配置为:&quot;nonce&quot;: &quot;0x0000000000000042&quot;。 “0x42”难度能让你在私有测试网链上快速挖以太币。 提示 挖矿时必然有矿工账户，而系统默认使用创建的第一个账号。 &gt; miner.start(1) INFO [01-19|21:06:43] Updated mining threads threads=1 INFO [01-19|21:06:43] Transaction pool price threshold updated price=18000000000 INFO [01-19|21:06:43] Starting mining operation null &gt; INFO [01-19|21:06:43] Commit new mining work number=1 txs=0 uncles=0 elapsed=717.552µs INFO [01-19|21:06:46] Generating ethash verification cache epoch=0 percentage=91 elapsed=3.000s INFO [01-19|21:06:46] Generated ethash verification cache epoch=0 elapsed=3.273s INFO [01-19|21:06:51] Generating DAG in progress epoch=0 percentage=0 elapsed=5.056s INFO [01-19|21:06:56] Generating DAG in progress epoch=0 percentage=1 elapsed=10.140s INFO [01-19|21:07:01] Generating DAG in progress epoch=0 percentage=2 elapsed=15.119s INFO [01-19|21:07:06] Generating DAG in progress epoch=0 percentage=3 elapsed=19.924s INFO [01-19|21:07:11] Generating DAG in progress epoch=0 percentage=4 elapsed=24.739s INFO [01-19|21:07:16] Generating DAG in progress epoch=0 percentage=5 elapsed=29.473s INFO [01-19|21:07:22] Generating DAG in progress epoch=0 percentage=6 elapsed=35.641s INFO [01-19|21:07:26] Generating DAG in progress epoch=0 percentage=7 elapsed=40.374s INFO [01-19|21:07:31] Generating DAG in progress epoch=0 percentage=8 elapsed=45.134s INFO [01-19|21:07:36] Generating DAG in progress epoch=0 percentage=9 elapsed=49.908s INFO [01-19|21:07:41] Generating DAG in progress epoch=0 percentage=10 elapsed=54.633s ...... ...... ...... INFO [01-19|21:22:43] Generated ethash verification cache epoch=0 elapsed=15m57.328s INFO [01-19|21:22:47] Generating ethash verification cache epoch=1 percentage=17 elapsed=3.031s INFO [01-19|21:22:50] Generating ethash verification cache epoch=1 percentage=34 elapsed=6.056s INFO [01-19|21:22:53] Generating ethash verification cache epoch=1 percentage=49 elapsed=9.562s INFO [01-19|21:22:57] Generating ethash verification cache epoch=1 percentage=70 elapsed=13.115s INFO [01-19|21:23:00] Generating ethash verification cache epoch=1 percentage=90 elapsed=16.123s INFO [01-19|21:23:01] Generated ethash verification cache epoch=1 elapsed=17.576s INFO [01-19|21:23:19] Generating DAG in progress epoch=1 percentage=0 elapsed=18.198s INFO [01-19|21:23:32] Successfully sealed new block number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:23:32] ? mined potential block number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:23:32] Commit new mining work number=2 txs=0 uncles=0 elapsed=1.188ms INFO [01-19|21:23:37] Generating DAG in progress epoch=1 percentage=1 elapsed=35.913s INFO [01-19|21:23:41] Successfully sealed new block number=2 hash=62db3f…e27b50 INFO [01-19|21:23:41] ? mined potential block number=2 hash=62db3f…e27b50 INFO [01-19|21:23:41] Commit new mining work number=3 txs=0 uncles=0 elapsed=772.239µs INFO [01-19|21:23:43] Successfully sealed new block number=3 hash=34384b…c387f2 INFO [01-19|21:23:43] ? mined potential block number=3 hash=34384b…c387f2 INFO [01-19|21:23:43] Commit new mining work number=4 txs=0 uncles=0 elapsed=1.002ms INFO [01-19|21:23:55] Generating DAG in progress epoch=1 percentage=2 elapsed=53.757s INFO [01-19|21:24:13] Generating DAG in progress epoch=1 percentage=3 elapsed=1m11.561s INFO [01-19|21:24:30] Generating DAG in progress epoch=1 percentage=4 elapsed=1m28.986s INFO [01-19|21:24:30] Successfully sealed new block number=4 hash=681970…462135 INFO [01-19|21:24:30] ? mined potential block number=4 hash=681970…462135 INFO [01-19|21:24:30] Commit new mining work number=5 txs=0 uncles=0 elapsed=833.629µs INFO [01-19|21:24:36] Successfully sealed new block number=5 hash=7b058b…d2f07a INFO [01-19|21:24:36] ? mined potential block number=5 hash=7b058b…d2f07a INFO [01-19|21:24:36] Commit new mining work number=6 txs=0 uncles=0 elapsed=897.815µs INFO [01-19|21:24:43] Successfully sealed new block number=6 hash=a5fc3d…b1221e INFO [01-19|21:24:43] ? block reached canonical chain number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:24:43] ? mined potential block number=6 hash=a5fc3d…b1221e INFO [01-19|21:24:43] Commit new mining work number=7 txs=0 uncles=0 elapsed=758.061µs INFO [01-19|21:24:47] Successfully sealed new block number=7 hash=003b02…e886fd INFO [01-19|21:24:47] ? block reached canonical chain number=2 hash=62db3f…e27b50 INFO [01-19|21:24:47] ? mined potential block number=7 hash=003b02…e886fd INFO [01-19|21:24:47] Commit new mining work number=8 txs=0 uncles=0 elapsed=920.862µs INFO [01-19|21:24:48] Generating DAG in progress epoch=1 percentage=5 elapsed=1m46.827s INFO [01-19|21:25:06] Generating DAG in progress epoch=1 percentage=6 elapsed=2m4.338s INFO [01-19|21:25:23] Successfully sealed new block number=8 hash=fd23c9…361c65 INFO [01-19|21:25:23] ? block reached canonical chain number=3 hash=34384b…c387f2 INFO [01-19|21:25:23] ? mined potential block number=8 hash=fd23c9…361c65 INFO [01-19|21:25:23] Commit new mining work number=9 txs=0 uncles=0 elapsed=825.737µs INFO [01-19|21:25:23] Generating DAG in progress epoch=1 percentage=7 elapsed=2m22.061s 6.2. 停止挖矿 &gt; miner.stop() true &gt; 6.3. 查看所挖金额 &gt; eth.getBalance(eth.accounts[0]) 7000000000000000000 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 6.4. 转账 转出账号中有10000个以太币 &gt; web3.fromWei(eth.getBalance(eth.accounts[0])) 10000 转入账号目前是 100 &gt; web3.fromWei(eth.getBalance(eth.accounts[1])) 100 解锁传出账号，否则不能转出。personal.unlockAccount(账号)或者personal.unlockAccount(账号,&quot;password&quot;, 15000) &gt; personal.unlockAccount(eth.accounts[0]) true 转账操作 &gt; eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[1], value: web3.toWei(10000, &quot;ether&quot;)}) INFO [04-19|12:00:35] Submitted transaction fullhash=0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27 recipient=0x7053133f9C5803a71C1a0FEdAD3E3a3138e2225B &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot; //查看待确认交易的详情 //使用命令web3.eth.getTransaction： &gt; web3.eth.getTransaction(&quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;) { blockHash: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, blockNumber: null, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;, input: &quot;0x&quot;, nonce: 13, r: &quot;0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a&quot;, s: &quot;0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c&quot;, to: &quot;0x7053133f9c5803a71c1a0fedad3e3a3138e2225b&quot;, transactionIndex: 0, v: &quot;0x42&quot;, value: 1e+22 } //由于交易还未确认，所以所属区块为null，blockNumber: null。 //主要参数含义 //gas：需要的gas数量 //gasPrice：交易的gas单价[18,000,000,000(wei)=18(GWei)] //由此可以算出，我们需要交纳的手续费为=90,000*18(GWei)=1620,000(Gwei)=0.00162(ether) 如果你现在查看转入账号，你会发现余额仍然是 0 ，交易还未成功写进区块，写进区块的方式是挖矿，所以你必须执行挖矿 &gt; miner.start(1) null &gt; INFO [04-19|12:51:18] Starting mining operation INFO [04-19|12:51:18] Commit new mining work number=6713 txs=1 uncles=0 elapsed=363.708µs INFO [04-19|12:51:26] Successfully sealed new block number=6713 hash=260c89…44b141 INFO [04-19|12:51:26] mined potential block number=6713 hash=260c89…44b141 INFO [04-19|12:51:26] Commit new mining work number=6714 txs=0 uncles=0 elapsed=196.425µs INFO [04-19|12:51:28] Successfully sealed new block number=6714 hash=b690a2…b38e1a INFO [04-19|12:51:28] mined potential block number=6714 hash=b690a2…b38e1a INFO [04-19|12:51:28] Commit new mining work number=6715 txs=0 uncles=0 elapsed=115.331µs 第三行第四行显示成功密封了一个新的区块。 稍后几分钟，再次查看转入账号，将会看到有10000个以太币入账。传出账号会减少10000个以太币，同时仍然继续挖矿中。 &gt; web3.fromWei(eth.getBalance(eth.accounts[0]), &quot;ether&quot;) 10100 //再次查看交易详情 &gt; web3.eth.getTransaction(&quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;) { blockHash: &quot;0x260c89fdcef4783c22b8cf537fa69c22ee9b7c05bae5ca3aa98c8a3b7944b141&quot;, blockNumber: 6713, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;, input: &quot;0x&quot;, nonce: 13, r: &quot;0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a&quot;, s: &quot;0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c&quot;, to: &quot;0x7053133f9c5803a71c1a0fedad3e3a3138e2225b&quot;, transactionIndex: 0, v: &quot;0x42&quot;, value: 1e+22 } 7. 私有链直接部署智能合约 7.1. 编写智能合约代码 pragma solidity ^0.4.4; contract calculator { function multiply(uint a) returns(uint d){ return a * 7; } } 7.2. 检查coinbase账号余额 &gt; account1 = web3.eth.coinbase &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot; &gt; web3.eth.getBalance(account1) 0 &gt; 如果余额大于0，继续，否则，开始挖矿。 &gt; miner.start(); null &gt; 如果你觉得差不多了，可以运行下面的命令停止挖矿。 &gt; miner.stop(); true 7.3. 解锁coinbase账号，我们通过coinbase账号来付费部署合约 123456: 换成你的密码。 &gt; personal.unlockAccount(web3.eth.coinbase, &#39;123456&#39;) true 7.4. 获取智能合约字节码和abi 代码拷贝到https://remix.ethereum.org 或 https://ethereum.github.io/browser-solidity/，编译，然后点击Details 7.5. 将 Browser-solidity编译后的合约部署到Geth 发送部署合约的交易 var calculatorContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); var calculator = calculatorContract.new( { from: web3.eth.accounts[0], data: &#39;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&#39;, gas: &#39;4700000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !== &#39;undefined&#39;) { console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) from代表合约由哪个账户生成，哪个账户生成，则生成所需的gas就需要该账户承担，默认为eth.accounts[0]，因为所有挖矿所得的以太币也默认都存入该账户中。 data代表的就是bytecode。是编译后的代码，你的代码越长，这块的字符串越多。 gas代表的是为了部署该合约最多准备的gas数量，当然实际上可能用不了这么多gas，具体消耗以实际使用量为准，这里只是设定一个最大量。gas是调用合约要扣除的gas单位，可以理解为以太币，gas和ether之间有个汇率，汇率受矿机的算率影响会有调整，在公网上，这些gas用于奖励给挖矿者。 最后这段是一个典型的javascript的异步调用的写法，将上面的new方法的结果传递给下一个方法function（e,contract)，在下一个方法中处理如果挖矿成功的显示结果。如果合约成功部署在区块上，则在控制台打印出来Contract mined!、contract address、transactionHash等信息。 address表示已经部署智能合约的帐户地址，智能合约也相当于一个帐户。 transactionHash表示智能合约产生时的hash值，会永久保存到区块链条里面。 输入calculator可以看到合约的一些信息 &gt; calculator { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, stateMutability: &quot;nonpayable&quot;, type: &quot;function&quot; }], address: &quot;0x35be144ae869bf8cc7ab83f5dd956898e3b127aa&quot;, transactionHash: &quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;, allEvents: function(), multiply: function() } 7.6. 查看本地交易池中待确认的交易 &gt; txpool.status { pending: 1, queued: 0 } 可以看到交易池中有一个待确认的交易 7.7. 查看待确认交易的详情 使用命令web3.eth.getTransaction，参数为transactionHash： &gt; web3.eth.getTransaction(&quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;) { blockHash: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, blockNumber: null, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 4700000, gasPrice: 18000000000, hash: &quot;0x9bd7fe9080ed20a5fbeaa644ca87614b00fcd15582bff897598d991a680fa5d9&quot;, input: &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f22b1e35f2de2583454229eaa5609b69b3a3628801c59eecb3361299cc2cdc4b0029&quot;, nonce: 20, r: &quot;0xca66158e7abf3582fedf03dd040083a0838370687569a62badb88089a62f77&quot;, s: &quot;0x140d6bd716ec6d137eced02987eccc952065d371030784b661051d6f3f630428&quot;, to: null, transactionIndex: 0, v: &quot;0x41&quot;, value: 0 } &gt; 由于交易还未确认，所以所属区块为null，blockNumber: null。 7.8. 预估手续费 &gt; bytecode = &quot;608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029 &quot; &quot;608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &gt; web3.eth.estimateGas({data: bytecode}) Error: invalid argument 0: json: cannot unmarshal hex string without 0x prefix into Go struct field CallArgs.data of type hexutil.Bytes at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 &gt; bytecode = &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &gt; web3.eth.estimateGas({data: bytecode}) 98391 &gt; 备注：字节码前面需要添加0x。手续费大概为98391gas。 7.9. 你的合约等待挖矿，开始挖矿，等一会儿，停止 &gt; miner.start() null &gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db [object Object] &gt; miner.stop() true &gt; 7.10. 检查合约是否部署成功 &gt; eth.getCode(calculator.address) &quot;0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; 7.11. 调用合约方法 &gt; calculator.multiply.call(6) 42 &gt; //本地调用，不会向区块链网络广播任何东西的合约调用，不会被区块所打包，切记、切记！！！ 如果换做其他人需要运行你的智能合约，还可以用如下方式，但需要两个信息：（后面提到的truffle部署智能合约成功后，私有链就按此方式调用） 智能合约地址Address 智能合约ABI（Application Binary Interface），ABI其实就是一个有序的用户手册，描述了所有方法的名字和如何调用它们。 &gt; var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}] &gt; var calc = eth.contract(abi).at(&quot;0x35be144ae869bf8cc7ab83f5dd956898e3b127aa&quot;) &gt; calc.multiply.call(6) &gt; 42 7.12. 再查询交易详情 &gt; web3.eth.getTransaction(&quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;) { blockHash: &quot;0x23718f944ea863cdae899b7cf85a298e7a3efc70be09364461d0bf4ef90ae4b5&quot;, blockNumber: 5900, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 4700000, gasPrice: 18000000000, hash: &quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;, input: &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot;, nonce: 21, r: &quot;0x2c81c8ff57dfeccf393d7db45a4cee2f66653e80019a26fb3992ece650457d30&quot;, s: &quot;0xf5db5ebebaa82b16136a29274bffd2351782c9be6f6e4059addf52e58219f48&quot;, to: null, transactionIndex: 0, v: &quot;0x41&quot;, value: 0 } 可以看到已经写到编号为5900的区块上了blockNumber: 5900。 8. 创建新节点 都说区块链是去中心化的账本那么可以满足于单机挖矿？说干就干接下来创建一个新节点并将太接入我们的主节点。这里需要注意以下几点： 新节点的 networkid 要与 第一个创建的节点data 一致 需要与 第一个创建的节点data 使用同一个创世区块（也就是同一个genesis.json文件） 如果多个节点都在一台机器上注意端口区分，避免端口冲突 --port 30304 --rpcport 9545 geth --datadir data2 init genesis.json geth --networkid 15 --datadir data2 --rpc --port 30304 --rpcaddr 172.16.61.17 --rpcport 9545 --nodiscover console 8.1.联盟链互通 上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。 &gt; admin.peers [] 发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。 下面就通过分享enode地址的方式来让两个节点建立链接。 &gt; admin.nodeInfo.enode &quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot; &gt; 通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。 其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如： INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; 现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令： &gt; admin.addPeer(&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot;) true 返回true，说明执行成功。再次验证一下： &gt; admin.peers [{ caps: [&quot;eth/63&quot;], id: &quot;aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c&quot;, name: &quot;Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2&quot;, network: { localAddress: &quot;[::1]:49426&quot;, remoteAddress: &quot;[::1]:30306&quot; }, protocols: { eth: { difficulty: 16384, head: &quot;0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a&quot;, version: 63 } } }] &gt; 发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。 查询余额并挖矿 执行查看余额命令： &gt; eth.getBalance(eth.coinbase） 0 在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。 当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息： &gt; INFO [12-28|20:05:32] Block synchronisation started INFO [12-28|20:05:33] Imported new state entries count=1 elapsed=47.661µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 WARN [12-28|20:05:33] Discarded bad propagated block number=1 hash=ab49ba…1cf32f INFO [12-28|20:05:33] Imported new block headers count=2 elapsed=9.208ms number=2 hash=738225…000e3b ignored=0 INFO [12-28|20:05:33] Imported new chain segment blocks=2 txs=0 mgas=0.000 elapsed=1.724ms mgasps=0.000 number=2 hash=738225…000e3b INFO [12-28|20:05:33] Fast sync complete, auto disabling INFO [12-28|20:05:34] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=5.978ms mgasps=0.000 number=3 hash=b069a9…426060 INFO [12-28|20:05:38] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.930ms mgasps=0.000 number=4 hash=21217e…526253 INFO [12-28|20:05:41] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.419ms mgasps=0.000 number=5 hash=3fa6ff…cf2794 INFO [12-28|20:05:43] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.557ms mgasps=0.000 number=6 hash=4c35b9…78b3ec INFO [12-28|20:05:45] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.514ms mgasps=0.000 number=7 hash=328e62…1bd3d3 INFO [12-28|20:05:46] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.513ms mgasps=0.000 number=8 hash=12287e…0465b5 INFO [12-28|20:06:19] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=7.048ms mgasps=0.000 number=9 hash=8e844b…b99d6c INFO [12-28|20:06:22] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=8.156ms mgasps=0.000 number=10 hash=159b36…d4dde5 INFO [12-28|20:06:24] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.549ms mgasps=0.000 number=11 hash=969100…5658a5 也就是说，节点1挖矿，节点2在同步数据信息。 停止节点1的挖矿，并查看coinbase地址金额： &gt; miner.stop() true &gt; eth.getBalance(eth.coinbase) 140000000000000000000 &gt; eth.coinbase &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; 这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息： &gt; eth.getBalance(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) 140000000000000000000 很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。 并且也可以在不同节点运行eth.blockNumber可以查到区块数量是保持一致的 9. How can I run go-ethereum as daemon process on Ubuntu? Create a file geth.service: [Unit] Description=Ethereum go client [Service] Type=simple ExecStart=/usr/bin/geth --networkid 15 --datadir /usr/local/ethereum/data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --nodiscover 2&gt;&gt;/usr/local/ethereum/data/geth.log [Install] WantedBy=default.target Enable service: systemctl --user enable /usr/local/ethereum/geth.service systemctl --user start geth.service test it netstat -tunpl|grep 8545 geth attach ipc:/usr/local/ethereum/data/geth.ipc 阅读更多" />
<meta property="og:description" content="通过各方资料了解学习之后，决定自己开始搭建基于以太坊go-ethereum的私有链环境。由于本人的电脑系统为win10，为避免window环境出现过多莫名其妙的问题，特意通过vm搭建了一台ubuntu17.10版本的虚拟系统。以下内容均基于ubuntu17.10系统。 1. go-ethereum客户端 1.1. 下载地址&amp;参考手册 首先，可以查看一下go-ethereum项目在git上的地址： https://github.com/ethereum/Go-ethereum 可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： https://github.com/ethereum/Go-ethereum/wiki/Building-Ethereum 在wiki页面选择ubuntu系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Ubuntu 在wiki页面选择mac系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Mac 在wiki页面选择windows系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-instructions-for-Windows 可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： https://github.com/ethereum/go-ethereum/wiki/private-network 2. 安装步骤 2.1. ubuntu 更换apt-get为国内阿里云源 备份系统默认的源（没有root权限的前面加sudo） cp /etc/apt/sources.list /etc/apt/sources.list.bak 修改/etc/apt/sources.list # deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties deb http://archive.canonical.com/ubuntu xenial partner deb-src http://archive.canonical.com/ubuntu xenial partner deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse 执行更新 sudo apt-get update //不执行是不生效的 2.1.1. 安装 geth sudo apt-get install software-properties-common sudo add-apt-repository -y ppa:ethereum/ethereum sudo apt-get update sudo apt-get install ethereum somnus@ubuntu:~$ geth version Geth Version: 1.8.2-stable Git Commit: b8b9f7f4476a30a0aaf6077daade6ae77f969960 Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 Go Version: go1.9.4 Operating System: linux GOPATH= GOROOT=/usr/lib/go-1.9 somnus@ubuntu:~$ 2.1.2. 安装 solc sudo apt-get install solc -y somnus@ubuntu:~$ solc --version solc, the solidity compiler commandline interface Version: 0.4.19+commit.c4cbbb05.Linux.g++ 2.2. Windows 访问 https://geth.ethereum.org/downloads/ 下载并安装 Geth for Windows 2.3. Mac OS brew tap ethereum/ethereum brew install ethereum 3. 创世区块 创建一个文件夹来存储你的私链数据 mkdir -p ethereum &amp;&amp; cd ethereum 3.1. 初始化创世区块 { &quot;nonce&quot;: &quot;0x0000000000000042&quot;, &quot;difficulty&quot;: &quot;0x0f0000&quot;, &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &quot;timestamp&quot;: &quot;0x00&quot;, &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;extraData&quot;: &quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &quot;gasLimit&quot;: &quot;0x4c4b40&quot;, &quot;config&quot;: { &quot;chainId&quot;: 15, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;alloc&quot;: { } } 参数解释： 参数名称 参数描述 mixhash 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 nonce nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase 矿工的账号，随便填 timestamp 设置创世块的时间戳 parentHash 上一个区块的hash值，因为是创世块，所以这个值是0 extraData 附加信息，随便填，可以填你的个性信息 gasLimit 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 初始化创世区块 默认目录是root/ethereum/ 你可以通过--datadir 参数指定目录 somnus@ubuntu:~/ethereum$ geth --datadir data init genesis.json INFO [04-01|19:53:03] Maximum peer count ETH=25 LES=0 total=25 INFO [04-01|19:53:03] Allocated cache and file handles database=/home/somnus/ethereum/data/geth/chaindata cache=16 handles=16 INFO [04-01|19:53:03] Writing custom genesis block INFO [04-01|19:53:03] Persisted trie from memory database nodes=0 size=0.00B time=2.123µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|19:53:03] Successfully wrote genesis state database=chaindata hash=611596…424d04 INFO [04-01|19:53:03] Allocated cache and file handles database=/home/somnus/ethereum/data/geth/lightchaindata cache=16 handles=16 INFO [04-01|19:53:03] Writing custom genesis block INFO [04-01|19:53:03] Persisted trie from memory database nodes=0 size=0.00B time=2.565µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|19:53:03] Successfully wrote genesis state database=lightchaindata hash=611596…424d04 somnus@ubuntu:~/ethereum$ find data data data/keystore data/geth data/geth/chaindata data/geth/chaindata/LOCK data/geth/chaindata/LOG data/geth/chaindata/MANIFEST-000000 data/geth/chaindata/CURRENT data/geth/chaindata/000001.log data/geth/lightchaindata data/geth/lightchaindata/LOCK data/geth/lightchaindata/LOG data/geth/lightchaindata/MANIFEST-000000 data/geth/lightchaindata/CURRENT data/geth/lightchaindata/000001.log 目录结构 data ├── geth │ ├── chaindata │ │ ├── 000001.log │ │ ├── CURRENT │ │ ├── LOCK │ │ ├── LOG │ │ └── MANIFEST-000000 │ └── lightchaindata │ ├── 000001.log │ ├── CURRENT │ ├── LOCK │ ├── LOG │ └── MANIFEST-000000 └── keystore 3.2. 启动节点 somnus@ubuntu:~/ethereum$ geth --networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console INFO [04-01|20:00:31] Maximum peer count ETH=25 LES=0 total=25 INFO [04-01|20:00:31] Starting peer-to-peer node instance=Geth/v1.8.2-stable-b8b9f7f4/linux-amd64/go1.9.4 INFO [04-01|20:00:31] Allocated cache and file handles database=/home/somnus/.ethereum/geth/chaindata cache=768 handles=512 INFO [04-01|20:00:31] Writing default main-net genesis block INFO [04-01|20:00:31] Persisted trie from memory database nodes=12356 size=2.34mB time=41.622179ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|20:00:31] Initialised chain configuration config=&quot;{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: &lt;nil&gt; Engine: ethash}&quot; INFO [04-01|20:00:31] Disk storage enabled for ethash caches dir=/home/somnus/.ethereum/geth/ethash count=3 INFO [04-01|20:00:31] Disk storage enabled for ethash DAGs dir=/home/somnus/.ethash count=2 INFO [04-01|20:00:31] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=123456 INFO [04-01|20:00:31] Loaded most recent local header number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Loaded most recent local fast block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Regenerated local transaction journal transactions=0 accounts=0 INFO [04-01|20:00:31] Starting P2P networking INFO [04-01|20:00:31] HTTP endpoint opened url=http://127.0.0.1:8545 cors=* vhosts=localhost INFO [04-01|20:00:31] RLPx listener up self=&quot;enode://50e818e4a6ecaba459ebb3edacaaab170e206d16410a52ea67e41324228382ec91dbfea1e324ade4708fc32fa8b952b15b75b0b87cdb307ed8b9629b4d42640d@[::]:30303?discport=0&quot; INFO [04-01|20:00:31] IPC endpoint opened url=/home/somnus/.ethereum/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.8.2-stable-b8b9f7f4/linux-amd64/go1.9.4 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; 启动私有节点所需参数 参数名称 参数描述 identity 区块链的标示，随便填写，用于标示目前网络的名字 init 指定创世块文件的位置，并创建初始块 datadir 设置当前区块链网络数据存放的位置 port 网络监听端口 rpc 启动rpc通信，可以进行智能合约的部署和调试 rpcapi 设置允许连接的rpc的客户端，一般为db,eth,net,web3 rpcaddr HTTP-RPC 服务ip地址（默认127.0.0.1） rpcport 指定 HTTP-RPC 服务监听端口号（默认为 8545）； networkid 设置当前区块链的网络ID，用于区分不同的网络，是一个数字，如果在默认模式下启动，网络ID为1，代码会自动连接到以太坊主链 console 启动命令行模式，可以在Geth中执行命令 nodiscover 关闭节点发现机制，防止加入有同样初始配置的陌生节点。 请注意，在我们的genesis.json文件里networkid（15）和“chainid”必须是相同的。 //在需要日志文件的情况下 geth --networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console 2&gt;&gt;geth.log 在已启动的情况下如何进入终端 geth attach ipc:/usr/local/ethereum/data/geth.ipc 在其它服务器中如何进入终端 geth attach http://121.43.162.28:8545 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 4. 用户 如跳过这一步骤，进入挖矿会报如下错误，需要设置一个挖矿的账号 Error: etherbase missing: etherbase address must be explicitly specified at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 4.1. 查看账户 //方式一 somnus@ubuntu:~/ethereum$ personal.listAccounts //方式二 somnus@ubuntu:~/ethereum$ eth.accounts //方式三 somnus@ubuntu:~/ethereum$ geth account list Account #0: {83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6 Account #1: {e8abf98484325fd6afc59b804ac15804b978e607} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T06-11-23.608902164Z--e8abf98484325fd6afc59b804ac15804b978e607 4.2. 创建用户 //方式一（参数为此账户的密码） personal.newAccount(&quot;123456&quot;) //方式二（也可以先创建账户，然后输入密码：） personal.newAccount() 默认挖矿账号就是第一个设置的账号，当然也可以自行设置 eth.coinbase miner.setEtherbase(eth.accounts[0]) 查看区块数据 eth.blockNumber 5. 余额 &gt; eth.getBalance(eth.accounts[0]) 70000000000000000000 eth.getBalance()返回的余额是以太币的最小面额wei，将wei转换为以太币ether。 //primary = eth.accounts[0] //balance = web3.fromWei(eth.getBalance(primary), &quot;ether&quot;); &gt; web3.fromWei(eth.getBalance(eth.accounts[0]), &quot;ether&quot;) 70 备注eth单位解释： kwei (1000 Wei) mwei (1000 KWei) gwei (1000 mwei) szabo (1000 gwei) finney (1000 szabo) ether (1000 finney) 也就是说ether =wei * 10^18，也就是说精度可以达到18位。 //wei转ether &gt; web3.fromWei(1000000000000000000,&quot;ether&quot;) &quot;1&quot; //ether转wei &gt; web3.toWei(1) &quot;1000000000000000000&quot; ps:web3命令 https://ethereumbuilders.gitbooks.io/guide/content/en/ethereum_javascript_api.html 6. 使用节点进行挖矿 6.1. 启动矿工开始挖矿 miner.start(1) 这里的1表示只使用一个线程运行,第一次运行时将开始创建DAG文件，只需等待进度条到100，则将开始挖矿。 实际你看到的挖矿速度很快，这是因为我们已经在初始化创世区块时配置为:&quot;nonce&quot;: &quot;0x0000000000000042&quot;。 “0x42”难度能让你在私有测试网链上快速挖以太币。 提示 挖矿时必然有矿工账户，而系统默认使用创建的第一个账号。 &gt; miner.start(1) INFO [01-19|21:06:43] Updated mining threads threads=1 INFO [01-19|21:06:43] Transaction pool price threshold updated price=18000000000 INFO [01-19|21:06:43] Starting mining operation null &gt; INFO [01-19|21:06:43] Commit new mining work number=1 txs=0 uncles=0 elapsed=717.552µs INFO [01-19|21:06:46] Generating ethash verification cache epoch=0 percentage=91 elapsed=3.000s INFO [01-19|21:06:46] Generated ethash verification cache epoch=0 elapsed=3.273s INFO [01-19|21:06:51] Generating DAG in progress epoch=0 percentage=0 elapsed=5.056s INFO [01-19|21:06:56] Generating DAG in progress epoch=0 percentage=1 elapsed=10.140s INFO [01-19|21:07:01] Generating DAG in progress epoch=0 percentage=2 elapsed=15.119s INFO [01-19|21:07:06] Generating DAG in progress epoch=0 percentage=3 elapsed=19.924s INFO [01-19|21:07:11] Generating DAG in progress epoch=0 percentage=4 elapsed=24.739s INFO [01-19|21:07:16] Generating DAG in progress epoch=0 percentage=5 elapsed=29.473s INFO [01-19|21:07:22] Generating DAG in progress epoch=0 percentage=6 elapsed=35.641s INFO [01-19|21:07:26] Generating DAG in progress epoch=0 percentage=7 elapsed=40.374s INFO [01-19|21:07:31] Generating DAG in progress epoch=0 percentage=8 elapsed=45.134s INFO [01-19|21:07:36] Generating DAG in progress epoch=0 percentage=9 elapsed=49.908s INFO [01-19|21:07:41] Generating DAG in progress epoch=0 percentage=10 elapsed=54.633s ...... ...... ...... INFO [01-19|21:22:43] Generated ethash verification cache epoch=0 elapsed=15m57.328s INFO [01-19|21:22:47] Generating ethash verification cache epoch=1 percentage=17 elapsed=3.031s INFO [01-19|21:22:50] Generating ethash verification cache epoch=1 percentage=34 elapsed=6.056s INFO [01-19|21:22:53] Generating ethash verification cache epoch=1 percentage=49 elapsed=9.562s INFO [01-19|21:22:57] Generating ethash verification cache epoch=1 percentage=70 elapsed=13.115s INFO [01-19|21:23:00] Generating ethash verification cache epoch=1 percentage=90 elapsed=16.123s INFO [01-19|21:23:01] Generated ethash verification cache epoch=1 elapsed=17.576s INFO [01-19|21:23:19] Generating DAG in progress epoch=1 percentage=0 elapsed=18.198s INFO [01-19|21:23:32] Successfully sealed new block number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:23:32] ? mined potential block number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:23:32] Commit new mining work number=2 txs=0 uncles=0 elapsed=1.188ms INFO [01-19|21:23:37] Generating DAG in progress epoch=1 percentage=1 elapsed=35.913s INFO [01-19|21:23:41] Successfully sealed new block number=2 hash=62db3f…e27b50 INFO [01-19|21:23:41] ? mined potential block number=2 hash=62db3f…e27b50 INFO [01-19|21:23:41] Commit new mining work number=3 txs=0 uncles=0 elapsed=772.239µs INFO [01-19|21:23:43] Successfully sealed new block number=3 hash=34384b…c387f2 INFO [01-19|21:23:43] ? mined potential block number=3 hash=34384b…c387f2 INFO [01-19|21:23:43] Commit new mining work number=4 txs=0 uncles=0 elapsed=1.002ms INFO [01-19|21:23:55] Generating DAG in progress epoch=1 percentage=2 elapsed=53.757s INFO [01-19|21:24:13] Generating DAG in progress epoch=1 percentage=3 elapsed=1m11.561s INFO [01-19|21:24:30] Generating DAG in progress epoch=1 percentage=4 elapsed=1m28.986s INFO [01-19|21:24:30] Successfully sealed new block number=4 hash=681970…462135 INFO [01-19|21:24:30] ? mined potential block number=4 hash=681970…462135 INFO [01-19|21:24:30] Commit new mining work number=5 txs=0 uncles=0 elapsed=833.629µs INFO [01-19|21:24:36] Successfully sealed new block number=5 hash=7b058b…d2f07a INFO [01-19|21:24:36] ? mined potential block number=5 hash=7b058b…d2f07a INFO [01-19|21:24:36] Commit new mining work number=6 txs=0 uncles=0 elapsed=897.815µs INFO [01-19|21:24:43] Successfully sealed new block number=6 hash=a5fc3d…b1221e INFO [01-19|21:24:43] ? block reached canonical chain number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:24:43] ? mined potential block number=6 hash=a5fc3d…b1221e INFO [01-19|21:24:43] Commit new mining work number=7 txs=0 uncles=0 elapsed=758.061µs INFO [01-19|21:24:47] Successfully sealed new block number=7 hash=003b02…e886fd INFO [01-19|21:24:47] ? block reached canonical chain number=2 hash=62db3f…e27b50 INFO [01-19|21:24:47] ? mined potential block number=7 hash=003b02…e886fd INFO [01-19|21:24:47] Commit new mining work number=8 txs=0 uncles=0 elapsed=920.862µs INFO [01-19|21:24:48] Generating DAG in progress epoch=1 percentage=5 elapsed=1m46.827s INFO [01-19|21:25:06] Generating DAG in progress epoch=1 percentage=6 elapsed=2m4.338s INFO [01-19|21:25:23] Successfully sealed new block number=8 hash=fd23c9…361c65 INFO [01-19|21:25:23] ? block reached canonical chain number=3 hash=34384b…c387f2 INFO [01-19|21:25:23] ? mined potential block number=8 hash=fd23c9…361c65 INFO [01-19|21:25:23] Commit new mining work number=9 txs=0 uncles=0 elapsed=825.737µs INFO [01-19|21:25:23] Generating DAG in progress epoch=1 percentage=7 elapsed=2m22.061s 6.2. 停止挖矿 &gt; miner.stop() true &gt; 6.3. 查看所挖金额 &gt; eth.getBalance(eth.accounts[0]) 7000000000000000000 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 6.4. 转账 转出账号中有10000个以太币 &gt; web3.fromWei(eth.getBalance(eth.accounts[0])) 10000 转入账号目前是 100 &gt; web3.fromWei(eth.getBalance(eth.accounts[1])) 100 解锁传出账号，否则不能转出。personal.unlockAccount(账号)或者personal.unlockAccount(账号,&quot;password&quot;, 15000) &gt; personal.unlockAccount(eth.accounts[0]) true 转账操作 &gt; eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[1], value: web3.toWei(10000, &quot;ether&quot;)}) INFO [04-19|12:00:35] Submitted transaction fullhash=0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27 recipient=0x7053133f9C5803a71C1a0FEdAD3E3a3138e2225B &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot; //查看待确认交易的详情 //使用命令web3.eth.getTransaction： &gt; web3.eth.getTransaction(&quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;) { blockHash: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, blockNumber: null, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;, input: &quot;0x&quot;, nonce: 13, r: &quot;0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a&quot;, s: &quot;0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c&quot;, to: &quot;0x7053133f9c5803a71c1a0fedad3e3a3138e2225b&quot;, transactionIndex: 0, v: &quot;0x42&quot;, value: 1e+22 } //由于交易还未确认，所以所属区块为null，blockNumber: null。 //主要参数含义 //gas：需要的gas数量 //gasPrice：交易的gas单价[18,000,000,000(wei)=18(GWei)] //由此可以算出，我们需要交纳的手续费为=90,000*18(GWei)=1620,000(Gwei)=0.00162(ether) 如果你现在查看转入账号，你会发现余额仍然是 0 ，交易还未成功写进区块，写进区块的方式是挖矿，所以你必须执行挖矿 &gt; miner.start(1) null &gt; INFO [04-19|12:51:18] Starting mining operation INFO [04-19|12:51:18] Commit new mining work number=6713 txs=1 uncles=0 elapsed=363.708µs INFO [04-19|12:51:26] Successfully sealed new block number=6713 hash=260c89…44b141 INFO [04-19|12:51:26] mined potential block number=6713 hash=260c89…44b141 INFO [04-19|12:51:26] Commit new mining work number=6714 txs=0 uncles=0 elapsed=196.425µs INFO [04-19|12:51:28] Successfully sealed new block number=6714 hash=b690a2…b38e1a INFO [04-19|12:51:28] mined potential block number=6714 hash=b690a2…b38e1a INFO [04-19|12:51:28] Commit new mining work number=6715 txs=0 uncles=0 elapsed=115.331µs 第三行第四行显示成功密封了一个新的区块。 稍后几分钟，再次查看转入账号，将会看到有10000个以太币入账。传出账号会减少10000个以太币，同时仍然继续挖矿中。 &gt; web3.fromWei(eth.getBalance(eth.accounts[0]), &quot;ether&quot;) 10100 //再次查看交易详情 &gt; web3.eth.getTransaction(&quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;) { blockHash: &quot;0x260c89fdcef4783c22b8cf537fa69c22ee9b7c05bae5ca3aa98c8a3b7944b141&quot;, blockNumber: 6713, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;, input: &quot;0x&quot;, nonce: 13, r: &quot;0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a&quot;, s: &quot;0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c&quot;, to: &quot;0x7053133f9c5803a71c1a0fedad3e3a3138e2225b&quot;, transactionIndex: 0, v: &quot;0x42&quot;, value: 1e+22 } 7. 私有链直接部署智能合约 7.1. 编写智能合约代码 pragma solidity ^0.4.4; contract calculator { function multiply(uint a) returns(uint d){ return a * 7; } } 7.2. 检查coinbase账号余额 &gt; account1 = web3.eth.coinbase &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot; &gt; web3.eth.getBalance(account1) 0 &gt; 如果余额大于0，继续，否则，开始挖矿。 &gt; miner.start(); null &gt; 如果你觉得差不多了，可以运行下面的命令停止挖矿。 &gt; miner.stop(); true 7.3. 解锁coinbase账号，我们通过coinbase账号来付费部署合约 123456: 换成你的密码。 &gt; personal.unlockAccount(web3.eth.coinbase, &#39;123456&#39;) true 7.4. 获取智能合约字节码和abi 代码拷贝到https://remix.ethereum.org 或 https://ethereum.github.io/browser-solidity/，编译，然后点击Details 7.5. 将 Browser-solidity编译后的合约部署到Geth 发送部署合约的交易 var calculatorContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); var calculator = calculatorContract.new( { from: web3.eth.accounts[0], data: &#39;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&#39;, gas: &#39;4700000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !== &#39;undefined&#39;) { console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) from代表合约由哪个账户生成，哪个账户生成，则生成所需的gas就需要该账户承担，默认为eth.accounts[0]，因为所有挖矿所得的以太币也默认都存入该账户中。 data代表的就是bytecode。是编译后的代码，你的代码越长，这块的字符串越多。 gas代表的是为了部署该合约最多准备的gas数量，当然实际上可能用不了这么多gas，具体消耗以实际使用量为准，这里只是设定一个最大量。gas是调用合约要扣除的gas单位，可以理解为以太币，gas和ether之间有个汇率，汇率受矿机的算率影响会有调整，在公网上，这些gas用于奖励给挖矿者。 最后这段是一个典型的javascript的异步调用的写法，将上面的new方法的结果传递给下一个方法function（e,contract)，在下一个方法中处理如果挖矿成功的显示结果。如果合约成功部署在区块上，则在控制台打印出来Contract mined!、contract address、transactionHash等信息。 address表示已经部署智能合约的帐户地址，智能合约也相当于一个帐户。 transactionHash表示智能合约产生时的hash值，会永久保存到区块链条里面。 输入calculator可以看到合约的一些信息 &gt; calculator { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, stateMutability: &quot;nonpayable&quot;, type: &quot;function&quot; }], address: &quot;0x35be144ae869bf8cc7ab83f5dd956898e3b127aa&quot;, transactionHash: &quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;, allEvents: function(), multiply: function() } 7.6. 查看本地交易池中待确认的交易 &gt; txpool.status { pending: 1, queued: 0 } 可以看到交易池中有一个待确认的交易 7.7. 查看待确认交易的详情 使用命令web3.eth.getTransaction，参数为transactionHash： &gt; web3.eth.getTransaction(&quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;) { blockHash: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, blockNumber: null, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 4700000, gasPrice: 18000000000, hash: &quot;0x9bd7fe9080ed20a5fbeaa644ca87614b00fcd15582bff897598d991a680fa5d9&quot;, input: &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f22b1e35f2de2583454229eaa5609b69b3a3628801c59eecb3361299cc2cdc4b0029&quot;, nonce: 20, r: &quot;0xca66158e7abf3582fedf03dd040083a0838370687569a62badb88089a62f77&quot;, s: &quot;0x140d6bd716ec6d137eced02987eccc952065d371030784b661051d6f3f630428&quot;, to: null, transactionIndex: 0, v: &quot;0x41&quot;, value: 0 } &gt; 由于交易还未确认，所以所属区块为null，blockNumber: null。 7.8. 预估手续费 &gt; bytecode = &quot;608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029 &quot; &quot;608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &gt; web3.eth.estimateGas({data: bytecode}) Error: invalid argument 0: json: cannot unmarshal hex string without 0x prefix into Go struct field CallArgs.data of type hexutil.Bytes at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 &gt; bytecode = &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &gt; web3.eth.estimateGas({data: bytecode}) 98391 &gt; 备注：字节码前面需要添加0x。手续费大概为98391gas。 7.9. 你的合约等待挖矿，开始挖矿，等一会儿，停止 &gt; miner.start() null &gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db [object Object] &gt; miner.stop() true &gt; 7.10. 检查合约是否部署成功 &gt; eth.getCode(calculator.address) &quot;0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; 7.11. 调用合约方法 &gt; calculator.multiply.call(6) 42 &gt; //本地调用，不会向区块链网络广播任何东西的合约调用，不会被区块所打包，切记、切记！！！ 如果换做其他人需要运行你的智能合约，还可以用如下方式，但需要两个信息：（后面提到的truffle部署智能合约成功后，私有链就按此方式调用） 智能合约地址Address 智能合约ABI（Application Binary Interface），ABI其实就是一个有序的用户手册，描述了所有方法的名字和如何调用它们。 &gt; var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}] &gt; var calc = eth.contract(abi).at(&quot;0x35be144ae869bf8cc7ab83f5dd956898e3b127aa&quot;) &gt; calc.multiply.call(6) &gt; 42 7.12. 再查询交易详情 &gt; web3.eth.getTransaction(&quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;) { blockHash: &quot;0x23718f944ea863cdae899b7cf85a298e7a3efc70be09364461d0bf4ef90ae4b5&quot;, blockNumber: 5900, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 4700000, gasPrice: 18000000000, hash: &quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;, input: &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot;, nonce: 21, r: &quot;0x2c81c8ff57dfeccf393d7db45a4cee2f66653e80019a26fb3992ece650457d30&quot;, s: &quot;0xf5db5ebebaa82b16136a29274bffd2351782c9be6f6e4059addf52e58219f48&quot;, to: null, transactionIndex: 0, v: &quot;0x41&quot;, value: 0 } 可以看到已经写到编号为5900的区块上了blockNumber: 5900。 8. 创建新节点 都说区块链是去中心化的账本那么可以满足于单机挖矿？说干就干接下来创建一个新节点并将太接入我们的主节点。这里需要注意以下几点： 新节点的 networkid 要与 第一个创建的节点data 一致 需要与 第一个创建的节点data 使用同一个创世区块（也就是同一个genesis.json文件） 如果多个节点都在一台机器上注意端口区分，避免端口冲突 --port 30304 --rpcport 9545 geth --datadir data2 init genesis.json geth --networkid 15 --datadir data2 --rpc --port 30304 --rpcaddr 172.16.61.17 --rpcport 9545 --nodiscover console 8.1.联盟链互通 上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。 &gt; admin.peers [] 发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。 下面就通过分享enode地址的方式来让两个节点建立链接。 &gt; admin.nodeInfo.enode &quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot; &gt; 通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。 其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如： INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; 现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令： &gt; admin.addPeer(&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot;) true 返回true，说明执行成功。再次验证一下： &gt; admin.peers [{ caps: [&quot;eth/63&quot;], id: &quot;aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c&quot;, name: &quot;Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2&quot;, network: { localAddress: &quot;[::1]:49426&quot;, remoteAddress: &quot;[::1]:30306&quot; }, protocols: { eth: { difficulty: 16384, head: &quot;0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a&quot;, version: 63 } } }] &gt; 发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。 查询余额并挖矿 执行查看余额命令： &gt; eth.getBalance(eth.coinbase） 0 在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。 当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息： &gt; INFO [12-28|20:05:32] Block synchronisation started INFO [12-28|20:05:33] Imported new state entries count=1 elapsed=47.661µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 WARN [12-28|20:05:33] Discarded bad propagated block number=1 hash=ab49ba…1cf32f INFO [12-28|20:05:33] Imported new block headers count=2 elapsed=9.208ms number=2 hash=738225…000e3b ignored=0 INFO [12-28|20:05:33] Imported new chain segment blocks=2 txs=0 mgas=0.000 elapsed=1.724ms mgasps=0.000 number=2 hash=738225…000e3b INFO [12-28|20:05:33] Fast sync complete, auto disabling INFO [12-28|20:05:34] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=5.978ms mgasps=0.000 number=3 hash=b069a9…426060 INFO [12-28|20:05:38] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.930ms mgasps=0.000 number=4 hash=21217e…526253 INFO [12-28|20:05:41] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.419ms mgasps=0.000 number=5 hash=3fa6ff…cf2794 INFO [12-28|20:05:43] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.557ms mgasps=0.000 number=6 hash=4c35b9…78b3ec INFO [12-28|20:05:45] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.514ms mgasps=0.000 number=7 hash=328e62…1bd3d3 INFO [12-28|20:05:46] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.513ms mgasps=0.000 number=8 hash=12287e…0465b5 INFO [12-28|20:06:19] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=7.048ms mgasps=0.000 number=9 hash=8e844b…b99d6c INFO [12-28|20:06:22] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=8.156ms mgasps=0.000 number=10 hash=159b36…d4dde5 INFO [12-28|20:06:24] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.549ms mgasps=0.000 number=11 hash=969100…5658a5 也就是说，节点1挖矿，节点2在同步数据信息。 停止节点1的挖矿，并查看coinbase地址金额： &gt; miner.stop() true &gt; eth.getBalance(eth.coinbase) 140000000000000000000 &gt; eth.coinbase &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; 这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息： &gt; eth.getBalance(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) 140000000000000000000 很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。 并且也可以在不同节点运行eth.blockNumber可以查到区块数量是保持一致的 9. How can I run go-ethereum as daemon process on Ubuntu? Create a file geth.service: [Unit] Description=Ethereum go client [Service] Type=simple ExecStart=/usr/bin/geth --networkid 15 --datadir /usr/local/ethereum/data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --nodiscover 2&gt;&gt;/usr/local/ethereum/data/geth.log [Install] WantedBy=default.target Enable service: systemctl --user enable /usr/local/ethereum/geth.service systemctl --user start geth.service test it netstat -tunpl|grep 8545 geth attach ipc:/usr/local/ethereum/data/geth.ipc 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/04/02/d49d870f285e6c04f2b416ba7f484e49.html" />
<meta property="og:url" content="https://mlh.app/2018/04/02/d49d870f285e6c04f2b416ba7f484e49.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-02T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"通过各方资料了解学习之后，决定自己开始搭建基于以太坊go-ethereum的私有链环境。由于本人的电脑系统为win10，为避免window环境出现过多莫名其妙的问题，特意通过vm搭建了一台ubuntu17.10版本的虚拟系统。以下内容均基于ubuntu17.10系统。 1. go-ethereum客户端 1.1. 下载地址&amp;参考手册 首先，可以查看一下go-ethereum项目在git上的地址： https://github.com/ethereum/Go-ethereum 可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： https://github.com/ethereum/Go-ethereum/wiki/Building-Ethereum 在wiki页面选择ubuntu系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Ubuntu 在wiki页面选择mac系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Mac 在wiki页面选择windows系统的安装说明，也可以直接访问下面链接： https://github.com/ethereum/go-ethereum/wiki/Installation-instructions-for-Windows 可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： https://github.com/ethereum/go-ethereum/wiki/private-network 2. 安装步骤 2.1. ubuntu 更换apt-get为国内阿里云源 备份系统默认的源（没有root权限的前面加sudo） cp /etc/apt/sources.list /etc/apt/sources.list.bak 修改/etc/apt/sources.list # deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties deb http://archive.canonical.com/ubuntu xenial partner deb-src http://archive.canonical.com/ubuntu xenial partner deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse 执行更新 sudo apt-get update //不执行是不生效的 2.1.1. 安装 geth sudo apt-get install software-properties-common sudo add-apt-repository -y ppa:ethereum/ethereum sudo apt-get update sudo apt-get install ethereum somnus@ubuntu:~$ geth version Geth Version: 1.8.2-stable Git Commit: b8b9f7f4476a30a0aaf6077daade6ae77f969960 Architecture: amd64 Protocol Versions: [63 62] Network Id: 1 Go Version: go1.9.4 Operating System: linux GOPATH= GOROOT=/usr/lib/go-1.9 somnus@ubuntu:~$ 2.1.2. 安装 solc sudo apt-get install solc -y somnus@ubuntu:~$ solc --version solc, the solidity compiler commandline interface Version: 0.4.19+commit.c4cbbb05.Linux.g++ 2.2. Windows 访问 https://geth.ethereum.org/downloads/ 下载并安装 Geth for Windows 2.3. Mac OS brew tap ethereum/ethereum brew install ethereum 3. 创世区块 创建一个文件夹来存储你的私链数据 mkdir -p ethereum &amp;&amp; cd ethereum 3.1. 初始化创世区块 { &quot;nonce&quot;: &quot;0x0000000000000042&quot;, &quot;difficulty&quot;: &quot;0x0f0000&quot;, &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &quot;timestamp&quot;: &quot;0x00&quot;, &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;extraData&quot;: &quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &quot;gasLimit&quot;: &quot;0x4c4b40&quot;, &quot;config&quot;: { &quot;chainId&quot;: 15, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;alloc&quot;: { } } 参数解释： 参数名称 参数描述 mixhash 与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 nonce nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 difficulty 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase 矿工的账号，随便填 timestamp 设置创世块的时间戳 parentHash 上一个区块的hash值，因为是创世块，所以这个值是0 extraData 附加信息，随便填，可以填你的个性信息 gasLimit 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。 初始化创世区块 默认目录是root/ethereum/ 你可以通过--datadir 参数指定目录 somnus@ubuntu:~/ethereum$ geth --datadir data init genesis.json INFO [04-01|19:53:03] Maximum peer count ETH=25 LES=0 total=25 INFO [04-01|19:53:03] Allocated cache and file handles database=/home/somnus/ethereum/data/geth/chaindata cache=16 handles=16 INFO [04-01|19:53:03] Writing custom genesis block INFO [04-01|19:53:03] Persisted trie from memory database nodes=0 size=0.00B time=2.123µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|19:53:03] Successfully wrote genesis state database=chaindata hash=611596…424d04 INFO [04-01|19:53:03] Allocated cache and file handles database=/home/somnus/ethereum/data/geth/lightchaindata cache=16 handles=16 INFO [04-01|19:53:03] Writing custom genesis block INFO [04-01|19:53:03] Persisted trie from memory database nodes=0 size=0.00B time=2.565µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|19:53:03] Successfully wrote genesis state database=lightchaindata hash=611596…424d04 somnus@ubuntu:~/ethereum$ find data data data/keystore data/geth data/geth/chaindata data/geth/chaindata/LOCK data/geth/chaindata/LOG data/geth/chaindata/MANIFEST-000000 data/geth/chaindata/CURRENT data/geth/chaindata/000001.log data/geth/lightchaindata data/geth/lightchaindata/LOCK data/geth/lightchaindata/LOG data/geth/lightchaindata/MANIFEST-000000 data/geth/lightchaindata/CURRENT data/geth/lightchaindata/000001.log 目录结构 data ├── geth │ ├── chaindata │ │ ├── 000001.log │ │ ├── CURRENT │ │ ├── LOCK │ │ ├── LOG │ │ └── MANIFEST-000000 │ └── lightchaindata │ ├── 000001.log │ ├── CURRENT │ ├── LOCK │ ├── LOG │ └── MANIFEST-000000 └── keystore 3.2. 启动节点 somnus@ubuntu:~/ethereum$ geth --networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console INFO [04-01|20:00:31] Maximum peer count ETH=25 LES=0 total=25 INFO [04-01|20:00:31] Starting peer-to-peer node instance=Geth/v1.8.2-stable-b8b9f7f4/linux-amd64/go1.9.4 INFO [04-01|20:00:31] Allocated cache and file handles database=/home/somnus/.ethereum/geth/chaindata cache=768 handles=512 INFO [04-01|20:00:31] Writing default main-net genesis block INFO [04-01|20:00:31] Persisted trie from memory database nodes=12356 size=2.34mB time=41.622179ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B INFO [04-01|20:00:31] Initialised chain configuration config=&quot;{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: &lt;nil&gt; Engine: ethash}&quot; INFO [04-01|20:00:31] Disk storage enabled for ethash caches dir=/home/somnus/.ethereum/geth/ethash count=3 INFO [04-01|20:00:31] Disk storage enabled for ethash DAGs dir=/home/somnus/.ethash count=2 INFO [04-01|20:00:31] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=123456 INFO [04-01|20:00:31] Loaded most recent local header number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Loaded most recent local full block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Loaded most recent local fast block number=0 hash=d4e567…cb8fa3 td=17179869184 INFO [04-01|20:00:31] Regenerated local transaction journal transactions=0 accounts=0 INFO [04-01|20:00:31] Starting P2P networking INFO [04-01|20:00:31] HTTP endpoint opened url=http://127.0.0.1:8545 cors=* vhosts=localhost INFO [04-01|20:00:31] RLPx listener up self=&quot;enode://50e818e4a6ecaba459ebb3edacaaab170e206d16410a52ea67e41324228382ec91dbfea1e324ade4708fc32fa8b952b15b75b0b87cdb307ed8b9629b4d42640d@[::]:30303?discport=0&quot; INFO [04-01|20:00:31] IPC endpoint opened url=/home/somnus/.ethereum/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.8.2-stable-b8b9f7f4/linux-amd64/go1.9.4 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; 启动私有节点所需参数 参数名称 参数描述 identity 区块链的标示，随便填写，用于标示目前网络的名字 init 指定创世块文件的位置，并创建初始块 datadir 设置当前区块链网络数据存放的位置 port 网络监听端口 rpc 启动rpc通信，可以进行智能合约的部署和调试 rpcapi 设置允许连接的rpc的客户端，一般为db,eth,net,web3 rpcaddr HTTP-RPC 服务ip地址（默认127.0.0.1） rpcport 指定 HTTP-RPC 服务监听端口号（默认为 8545）； networkid 设置当前区块链的网络ID，用于区分不同的网络，是一个数字，如果在默认模式下启动，网络ID为1，代码会自动连接到以太坊主链 console 启动命令行模式，可以在Geth中执行命令 nodiscover 关闭节点发现机制，防止加入有同样初始配置的陌生节点。 请注意，在我们的genesis.json文件里networkid（15）和“chainid”必须是相同的。 //在需要日志文件的情况下 geth --networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console 2&gt;&gt;geth.log 在已启动的情况下如何进入终端 geth attach ipc:/usr/local/ethereum/data/geth.ipc 在其它服务器中如何进入终端 geth attach http://121.43.162.28:8545 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 4. 用户 如跳过这一步骤，进入挖矿会报如下错误，需要设置一个挖矿的账号 Error: etherbase missing: etherbase address must be explicitly specified at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 4.1. 查看账户 //方式一 somnus@ubuntu:~/ethereum$ personal.listAccounts //方式二 somnus@ubuntu:~/ethereum$ eth.accounts //方式三 somnus@ubuntu:~/ethereum$ geth account list Account #0: {83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6 Account #1: {e8abf98484325fd6afc59b804ac15804b978e607} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T06-11-23.608902164Z--e8abf98484325fd6afc59b804ac15804b978e607 4.2. 创建用户 //方式一（参数为此账户的密码） personal.newAccount(&quot;123456&quot;) //方式二（也可以先创建账户，然后输入密码：） personal.newAccount() 默认挖矿账号就是第一个设置的账号，当然也可以自行设置 eth.coinbase miner.setEtherbase(eth.accounts[0]) 查看区块数据 eth.blockNumber 5. 余额 &gt; eth.getBalance(eth.accounts[0]) 70000000000000000000 eth.getBalance()返回的余额是以太币的最小面额wei，将wei转换为以太币ether。 //primary = eth.accounts[0] //balance = web3.fromWei(eth.getBalance(primary), &quot;ether&quot;); &gt; web3.fromWei(eth.getBalance(eth.accounts[0]), &quot;ether&quot;) 70 备注eth单位解释： kwei (1000 Wei) mwei (1000 KWei) gwei (1000 mwei) szabo (1000 gwei) finney (1000 szabo) ether (1000 finney) 也就是说ether =wei * 10^18，也就是说精度可以达到18位。 //wei转ether &gt; web3.fromWei(1000000000000000000,&quot;ether&quot;) &quot;1&quot; //ether转wei &gt; web3.toWei(1) &quot;1000000000000000000&quot; ps:web3命令 https://ethereumbuilders.gitbooks.io/guide/content/en/ethereum_javascript_api.html 6. 使用节点进行挖矿 6.1. 启动矿工开始挖矿 miner.start(1) 这里的1表示只使用一个线程运行,第一次运行时将开始创建DAG文件，只需等待进度条到100，则将开始挖矿。 实际你看到的挖矿速度很快，这是因为我们已经在初始化创世区块时配置为:&quot;nonce&quot;: &quot;0x0000000000000042&quot;。 “0x42”难度能让你在私有测试网链上快速挖以太币。 提示 挖矿时必然有矿工账户，而系统默认使用创建的第一个账号。 &gt; miner.start(1) INFO [01-19|21:06:43] Updated mining threads threads=1 INFO [01-19|21:06:43] Transaction pool price threshold updated price=18000000000 INFO [01-19|21:06:43] Starting mining operation null &gt; INFO [01-19|21:06:43] Commit new mining work number=1 txs=0 uncles=0 elapsed=717.552µs INFO [01-19|21:06:46] Generating ethash verification cache epoch=0 percentage=91 elapsed=3.000s INFO [01-19|21:06:46] Generated ethash verification cache epoch=0 elapsed=3.273s INFO [01-19|21:06:51] Generating DAG in progress epoch=0 percentage=0 elapsed=5.056s INFO [01-19|21:06:56] Generating DAG in progress epoch=0 percentage=1 elapsed=10.140s INFO [01-19|21:07:01] Generating DAG in progress epoch=0 percentage=2 elapsed=15.119s INFO [01-19|21:07:06] Generating DAG in progress epoch=0 percentage=3 elapsed=19.924s INFO [01-19|21:07:11] Generating DAG in progress epoch=0 percentage=4 elapsed=24.739s INFO [01-19|21:07:16] Generating DAG in progress epoch=0 percentage=5 elapsed=29.473s INFO [01-19|21:07:22] Generating DAG in progress epoch=0 percentage=6 elapsed=35.641s INFO [01-19|21:07:26] Generating DAG in progress epoch=0 percentage=7 elapsed=40.374s INFO [01-19|21:07:31] Generating DAG in progress epoch=0 percentage=8 elapsed=45.134s INFO [01-19|21:07:36] Generating DAG in progress epoch=0 percentage=9 elapsed=49.908s INFO [01-19|21:07:41] Generating DAG in progress epoch=0 percentage=10 elapsed=54.633s ...... ...... ...... INFO [01-19|21:22:43] Generated ethash verification cache epoch=0 elapsed=15m57.328s INFO [01-19|21:22:47] Generating ethash verification cache epoch=1 percentage=17 elapsed=3.031s INFO [01-19|21:22:50] Generating ethash verification cache epoch=1 percentage=34 elapsed=6.056s INFO [01-19|21:22:53] Generating ethash verification cache epoch=1 percentage=49 elapsed=9.562s INFO [01-19|21:22:57] Generating ethash verification cache epoch=1 percentage=70 elapsed=13.115s INFO [01-19|21:23:00] Generating ethash verification cache epoch=1 percentage=90 elapsed=16.123s INFO [01-19|21:23:01] Generated ethash verification cache epoch=1 elapsed=17.576s INFO [01-19|21:23:19] Generating DAG in progress epoch=1 percentage=0 elapsed=18.198s INFO [01-19|21:23:32] Successfully sealed new block number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:23:32] ? mined potential block number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:23:32] Commit new mining work number=2 txs=0 uncles=0 elapsed=1.188ms INFO [01-19|21:23:37] Generating DAG in progress epoch=1 percentage=1 elapsed=35.913s INFO [01-19|21:23:41] Successfully sealed new block number=2 hash=62db3f…e27b50 INFO [01-19|21:23:41] ? mined potential block number=2 hash=62db3f…e27b50 INFO [01-19|21:23:41] Commit new mining work number=3 txs=0 uncles=0 elapsed=772.239µs INFO [01-19|21:23:43] Successfully sealed new block number=3 hash=34384b…c387f2 INFO [01-19|21:23:43] ? mined potential block number=3 hash=34384b…c387f2 INFO [01-19|21:23:43] Commit new mining work number=4 txs=0 uncles=0 elapsed=1.002ms INFO [01-19|21:23:55] Generating DAG in progress epoch=1 percentage=2 elapsed=53.757s INFO [01-19|21:24:13] Generating DAG in progress epoch=1 percentage=3 elapsed=1m11.561s INFO [01-19|21:24:30] Generating DAG in progress epoch=1 percentage=4 elapsed=1m28.986s INFO [01-19|21:24:30] Successfully sealed new block number=4 hash=681970…462135 INFO [01-19|21:24:30] ? mined potential block number=4 hash=681970…462135 INFO [01-19|21:24:30] Commit new mining work number=5 txs=0 uncles=0 elapsed=833.629µs INFO [01-19|21:24:36] Successfully sealed new block number=5 hash=7b058b…d2f07a INFO [01-19|21:24:36] ? mined potential block number=5 hash=7b058b…d2f07a INFO [01-19|21:24:36] Commit new mining work number=6 txs=0 uncles=0 elapsed=897.815µs INFO [01-19|21:24:43] Successfully sealed new block number=6 hash=a5fc3d…b1221e INFO [01-19|21:24:43] ? block reached canonical chain number=1 hash=e2b5b9…9b1bfe INFO [01-19|21:24:43] ? mined potential block number=6 hash=a5fc3d…b1221e INFO [01-19|21:24:43] Commit new mining work number=7 txs=0 uncles=0 elapsed=758.061µs INFO [01-19|21:24:47] Successfully sealed new block number=7 hash=003b02…e886fd INFO [01-19|21:24:47] ? block reached canonical chain number=2 hash=62db3f…e27b50 INFO [01-19|21:24:47] ? mined potential block number=7 hash=003b02…e886fd INFO [01-19|21:24:47] Commit new mining work number=8 txs=0 uncles=0 elapsed=920.862µs INFO [01-19|21:24:48] Generating DAG in progress epoch=1 percentage=5 elapsed=1m46.827s INFO [01-19|21:25:06] Generating DAG in progress epoch=1 percentage=6 elapsed=2m4.338s INFO [01-19|21:25:23] Successfully sealed new block number=8 hash=fd23c9…361c65 INFO [01-19|21:25:23] ? block reached canonical chain number=3 hash=34384b…c387f2 INFO [01-19|21:25:23] ? mined potential block number=8 hash=fd23c9…361c65 INFO [01-19|21:25:23] Commit new mining work number=9 txs=0 uncles=0 elapsed=825.737µs INFO [01-19|21:25:23] Generating DAG in progress epoch=1 percentage=7 elapsed=2m22.061s 6.2. 停止挖矿 &gt; miner.stop() true &gt; 6.3. 查看所挖金额 &gt; eth.getBalance(eth.accounts[0]) 7000000000000000000 这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括： eth：包含一些跟操作区块链相关的方法； net：包含一些查看p2p网络状态的方法； admin：包含一些与管理节点相关的方法； miner：包含启动&amp;停止挖矿的一些方法； personal：主要包含一些管理账户的方法； txpool：包含一些查看交易内存池的方法； web3：包含了以上对象，还包含一些单位换算的方法。 6.4. 转账 转出账号中有10000个以太币 &gt; web3.fromWei(eth.getBalance(eth.accounts[0])) 10000 转入账号目前是 100 &gt; web3.fromWei(eth.getBalance(eth.accounts[1])) 100 解锁传出账号，否则不能转出。personal.unlockAccount(账号)或者personal.unlockAccount(账号,&quot;password&quot;, 15000) &gt; personal.unlockAccount(eth.accounts[0]) true 转账操作 &gt; eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[1], value: web3.toWei(10000, &quot;ether&quot;)}) INFO [04-19|12:00:35] Submitted transaction fullhash=0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27 recipient=0x7053133f9C5803a71C1a0FEdAD3E3a3138e2225B &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot; //查看待确认交易的详情 //使用命令web3.eth.getTransaction： &gt; web3.eth.getTransaction(&quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;) { blockHash: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, blockNumber: null, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;, input: &quot;0x&quot;, nonce: 13, r: &quot;0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a&quot;, s: &quot;0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c&quot;, to: &quot;0x7053133f9c5803a71c1a0fedad3e3a3138e2225b&quot;, transactionIndex: 0, v: &quot;0x42&quot;, value: 1e+22 } //由于交易还未确认，所以所属区块为null，blockNumber: null。 //主要参数含义 //gas：需要的gas数量 //gasPrice：交易的gas单价[18,000,000,000(wei)=18(GWei)] //由此可以算出，我们需要交纳的手续费为=90,000*18(GWei)=1620,000(Gwei)=0.00162(ether) 如果你现在查看转入账号，你会发现余额仍然是 0 ，交易还未成功写进区块，写进区块的方式是挖矿，所以你必须执行挖矿 &gt; miner.start(1) null &gt; INFO [04-19|12:51:18] Starting mining operation INFO [04-19|12:51:18] Commit new mining work number=6713 txs=1 uncles=0 elapsed=363.708µs INFO [04-19|12:51:26] Successfully sealed new block number=6713 hash=260c89…44b141 INFO [04-19|12:51:26] mined potential block number=6713 hash=260c89…44b141 INFO [04-19|12:51:26] Commit new mining work number=6714 txs=0 uncles=0 elapsed=196.425µs INFO [04-19|12:51:28] Successfully sealed new block number=6714 hash=b690a2…b38e1a INFO [04-19|12:51:28] mined potential block number=6714 hash=b690a2…b38e1a INFO [04-19|12:51:28] Commit new mining work number=6715 txs=0 uncles=0 elapsed=115.331µs 第三行第四行显示成功密封了一个新的区块。 稍后几分钟，再次查看转入账号，将会看到有10000个以太币入账。传出账号会减少10000个以太币，同时仍然继续挖矿中。 &gt; web3.fromWei(eth.getBalance(eth.accounts[0]), &quot;ether&quot;) 10100 //再次查看交易详情 &gt; web3.eth.getTransaction(&quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;) { blockHash: &quot;0x260c89fdcef4783c22b8cf537fa69c22ee9b7c05bae5ca3aa98c8a3b7944b141&quot;, blockNumber: 6713, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27&quot;, input: &quot;0x&quot;, nonce: 13, r: &quot;0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a&quot;, s: &quot;0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c&quot;, to: &quot;0x7053133f9c5803a71c1a0fedad3e3a3138e2225b&quot;, transactionIndex: 0, v: &quot;0x42&quot;, value: 1e+22 } 7. 私有链直接部署智能合约 7.1. 编写智能合约代码 pragma solidity ^0.4.4; contract calculator { function multiply(uint a) returns(uint d){ return a * 7; } } 7.2. 检查coinbase账号余额 &gt; account1 = web3.eth.coinbase &quot;0x2abf46d8b0d940cdeedd55872bc0648add40227d&quot; &gt; web3.eth.getBalance(account1) 0 &gt; 如果余额大于0，继续，否则，开始挖矿。 &gt; miner.start(); null &gt; 如果你觉得差不多了，可以运行下面的命令停止挖矿。 &gt; miner.stop(); true 7.3. 解锁coinbase账号，我们通过coinbase账号来付费部署合约 123456: 换成你的密码。 &gt; personal.unlockAccount(web3.eth.coinbase, &#39;123456&#39;) true 7.4. 获取智能合约字节码和abi 代码拷贝到https://remix.ethereum.org 或 https://ethereum.github.io/browser-solidity/，编译，然后点击Details 7.5. 将 Browser-solidity编译后的合约部署到Geth 发送部署合约的交易 var calculatorContract = web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]); var calculator = calculatorContract.new( { from: web3.eth.accounts[0], data: &#39;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&#39;, gas: &#39;4700000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !== &#39;undefined&#39;) { console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) from代表合约由哪个账户生成，哪个账户生成，则生成所需的gas就需要该账户承担，默认为eth.accounts[0]，因为所有挖矿所得的以太币也默认都存入该账户中。 data代表的就是bytecode。是编译后的代码，你的代码越长，这块的字符串越多。 gas代表的是为了部署该合约最多准备的gas数量，当然实际上可能用不了这么多gas，具体消耗以实际使用量为准，这里只是设定一个最大量。gas是调用合约要扣除的gas单位，可以理解为以太币，gas和ether之间有个汇率，汇率受矿机的算率影响会有调整，在公网上，这些gas用于奖励给挖矿者。 最后这段是一个典型的javascript的异步调用的写法，将上面的new方法的结果传递给下一个方法function（e,contract)，在下一个方法中处理如果挖矿成功的显示结果。如果合约成功部署在区块上，则在控制台打印出来Contract mined!、contract address、transactionHash等信息。 address表示已经部署智能合约的帐户地址，智能合约也相当于一个帐户。 transactionHash表示智能合约产生时的hash值，会永久保存到区块链条里面。 输入calculator可以看到合约的一些信息 &gt; calculator { abi: [{ constant: false, inputs: [{...}], name: &quot;multiply&quot;, outputs: [{...}], payable: false, stateMutability: &quot;nonpayable&quot;, type: &quot;function&quot; }], address: &quot;0x35be144ae869bf8cc7ab83f5dd956898e3b127aa&quot;, transactionHash: &quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;, allEvents: function(), multiply: function() } 7.6. 查看本地交易池中待确认的交易 &gt; txpool.status { pending: 1, queued: 0 } 可以看到交易池中有一个待确认的交易 7.7. 查看待确认交易的详情 使用命令web3.eth.getTransaction，参数为transactionHash： &gt; web3.eth.getTransaction(&quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;) { blockHash: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, blockNumber: null, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 4700000, gasPrice: 18000000000, hash: &quot;0x9bd7fe9080ed20a5fbeaa644ca87614b00fcd15582bff897598d991a680fa5d9&quot;, input: &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f22b1e35f2de2583454229eaa5609b69b3a3628801c59eecb3361299cc2cdc4b0029&quot;, nonce: 20, r: &quot;0xca66158e7abf3582fedf03dd040083a0838370687569a62badb88089a62f77&quot;, s: &quot;0x140d6bd716ec6d137eced02987eccc952065d371030784b661051d6f3f630428&quot;, to: null, transactionIndex: 0, v: &quot;0x41&quot;, value: 0 } &gt; 由于交易还未确认，所以所属区块为null，blockNumber: null。 7.8. 预估手续费 &gt; bytecode = &quot;608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029 &quot; &quot;608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &gt; web3.eth.estimateGas({data: bytecode}) Error: invalid argument 0: json: cannot unmarshal hex string without 0x prefix into Go struct field CallArgs.data of type hexutil.Bytes at web3.js:3104:20 at web3.js:6191:15 at web3.js:5004:36 at &lt;anonymous&gt;:1:1 &gt; bytecode = &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot; &gt; web3.eth.estimateGas({data: bytecode}) 98391 &gt; 备注：字节码前面需要添加0x。手续费大概为98391gas。 7.9. 你的合约等待挖矿，开始挖矿，等一会儿，停止 &gt; miner.start() null &gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db [object Object] &gt; miner.stop() true &gt; 7.10. 检查合约是否部署成功 &gt; eth.getCode(calculator.address) &quot;0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029&quot; &gt; 7.11. 调用合约方法 &gt; calculator.multiply.call(6) 42 &gt; //本地调用，不会向区块链网络广播任何东西的合约调用，不会被区块所打包，切记、切记！！！ 如果换做其他人需要运行你的智能合约，还可以用如下方式，但需要两个信息：（后面提到的truffle部署智能合约成功后，私有链就按此方式调用） 智能合约地址Address 智能合约ABI（Application Binary Interface），ABI其实就是一个有序的用户手册，描述了所有方法的名字和如何调用它们。 &gt; var abi = [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;a&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;multiply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;d&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}] &gt; var calc = eth.contract(abi).at(&quot;0x35be144ae869bf8cc7ab83f5dd956898e3b127aa&quot;) &gt; calc.multiply.call(6) &gt; 42 7.12. 再查询交易详情 &gt; web3.eth.getTransaction(&quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;) { blockHash: &quot;0x23718f944ea863cdae899b7cf85a298e7a3efc70be09364461d0bf4ef90ae4b5&quot;, blockNumber: 5900, from: &quot;0x4d047e01cd56f878443b11eb2417a936f40d69f7&quot;, gas: 4700000, gasPrice: 18000000000, hash: &quot;0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed&quot;, input: &quot;0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029&quot;, nonce: 21, r: &quot;0x2c81c8ff57dfeccf393d7db45a4cee2f66653e80019a26fb3992ece650457d30&quot;, s: &quot;0xf5db5ebebaa82b16136a29274bffd2351782c9be6f6e4059addf52e58219f48&quot;, to: null, transactionIndex: 0, v: &quot;0x41&quot;, value: 0 } 可以看到已经写到编号为5900的区块上了blockNumber: 5900。 8. 创建新节点 都说区块链是去中心化的账本那么可以满足于单机挖矿？说干就干接下来创建一个新节点并将太接入我们的主节点。这里需要注意以下几点： 新节点的 networkid 要与 第一个创建的节点data 一致 需要与 第一个创建的节点data 使用同一个创世区块（也就是同一个genesis.json文件） 如果多个节点都在一台机器上注意端口区分，避免端口冲突 --port 30304 --rpcport 9545 geth --datadir data2 init genesis.json geth --networkid 15 --datadir data2 --rpc --port 30304 --rpcaddr 172.16.61.17 --rpcport 9545 --nodiscover console 8.1.联盟链互通 上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。 &gt; admin.peers [] 发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。 下面就通过分享enode地址的方式来让两个节点建立链接。 &gt; admin.nodeInfo.enode &quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot; &gt; 通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。 其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如： INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; 现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令： &gt; admin.addPeer(&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot;) true 返回true，说明执行成功。再次验证一下： &gt; admin.peers [{ caps: [&quot;eth/63&quot;], id: &quot;aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c&quot;, name: &quot;Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2&quot;, network: { localAddress: &quot;[::1]:49426&quot;, remoteAddress: &quot;[::1]:30306&quot; }, protocols: { eth: { difficulty: 16384, head: &quot;0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a&quot;, version: 63 } } }] &gt; 发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。 查询余额并挖矿 执行查看余额命令： &gt; eth.getBalance(eth.coinbase） 0 在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。 当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息： &gt; INFO [12-28|20:05:32] Block synchronisation started INFO [12-28|20:05:33] Imported new state entries count=1 elapsed=47.661µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 WARN [12-28|20:05:33] Discarded bad propagated block number=1 hash=ab49ba…1cf32f INFO [12-28|20:05:33] Imported new block headers count=2 elapsed=9.208ms number=2 hash=738225…000e3b ignored=0 INFO [12-28|20:05:33] Imported new chain segment blocks=2 txs=0 mgas=0.000 elapsed=1.724ms mgasps=0.000 number=2 hash=738225…000e3b INFO [12-28|20:05:33] Fast sync complete, auto disabling INFO [12-28|20:05:34] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=5.978ms mgasps=0.000 number=3 hash=b069a9…426060 INFO [12-28|20:05:38] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.930ms mgasps=0.000 number=4 hash=21217e…526253 INFO [12-28|20:05:41] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.419ms mgasps=0.000 number=5 hash=3fa6ff…cf2794 INFO [12-28|20:05:43] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.557ms mgasps=0.000 number=6 hash=4c35b9…78b3ec INFO [12-28|20:05:45] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.514ms mgasps=0.000 number=7 hash=328e62…1bd3d3 INFO [12-28|20:05:46] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.513ms mgasps=0.000 number=8 hash=12287e…0465b5 INFO [12-28|20:06:19] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=7.048ms mgasps=0.000 number=9 hash=8e844b…b99d6c INFO [12-28|20:06:22] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=8.156ms mgasps=0.000 number=10 hash=159b36…d4dde5 INFO [12-28|20:06:24] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.549ms mgasps=0.000 number=11 hash=969100…5658a5 也就是说，节点1挖矿，节点2在同步数据信息。 停止节点1的挖矿，并查看coinbase地址金额： &gt; miner.stop() true &gt; eth.getBalance(eth.coinbase) 140000000000000000000 &gt; eth.coinbase &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; 这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息： &gt; eth.getBalance(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) 140000000000000000000 很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。 并且也可以在不同节点运行eth.blockNumber可以查到区块数量是保持一致的 9. How can I run go-ethereum as daemon process on Ubuntu? Create a file geth.service: [Unit] Description=Ethereum go client [Service] Type=simple ExecStart=/usr/bin/geth --networkid 15 --datadir /usr/local/ethereum/data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --nodiscover 2&gt;&gt;/usr/local/ethereum/data/geth.log [Install] WantedBy=default.target Enable service: systemctl --user enable /usr/local/ethereum/geth.service systemctl --user start geth.service test it netstat -tunpl|grep 8545 geth attach ipc:/usr/local/ethereum/data/geth.ipc 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/04/02/d49d870f285e6c04f2b416ba7f484e49.html","headline":"区块链开发（一）搭建基于以太坊go-ethereum的私有链环境","dateModified":"2018-04-02T00:00:00+08:00","datePublished":"2018-04-02T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/04/02/d49d870f285e6c04f2b416ba7f484e49.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链开发（一）搭建基于以太坊go-ethereum的私有链环境</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>通过各方资料了解学习之后，决定自己开始搭建基于以太坊go-ethereum的私有链环境。由于本人的电脑系统为win10，为避免window环境出现过多莫名其妙的问题，特意通过vm搭建了一台ubuntu17.10版本的虚拟系统。以下内容均基于ubuntu17.10系统。</p> 
  <h2 id="1-go-ethereum客户端">1. go-ethereum客户端</h2> 
  <h3 id="11-下载地址参考手册">1.1. 下载地址&amp;参考手册</h3> 
  <p>首先，可以查看一下go-ethereum项目在git上的地址： <br> <a href="https://github.com/ethereum/Go-ethereum" rel="nofollow">https://github.com/ethereum/Go-ethereum</a></p> 
  <p>可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： <br> <a href="https://github.com/ethereum/Go-ethereum/wiki/Building-Ethereum" rel="nofollow">https://github.com/ethereum/Go-ethereum/wiki/Building-Ethereum</a></p> 
  <p>在wiki页面选择ubuntu系统的安装说明，也可以直接访问下面链接： <br> <a href="https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Ubuntu" rel="nofollow">https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Ubuntu</a></p> 
  <p>在wiki页面选择mac系统的安装说明，也可以直接访问下面链接： <br> <a href="https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Mac" rel="nofollow">https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Mac</a></p> 
  <p>在wiki页面选择windows系统的安装说明，也可以直接访问下面链接： <br> <a href="https://github.com/ethereum/go-ethereum/wiki/Installation-instructions-for-Windows" rel="nofollow">https://github.com/ethereum/go-ethereum/wiki/Installation-instructions-for-Windows</a></p> 
  <p>可以在点击项目上的wiki标签，也可以通过一下地址访问wiki： <br> <a href="https://github.com/ethereum/go-ethereum/wiki/private-network" rel="nofollow">https://github.com/ethereum/go-ethereum/wiki/private-network</a></p> 
  <h2 id="2-安装步骤">2. 安装步骤</h2> 
  <h3 id="21-ubuntu">2.1. ubuntu</h3> 
  <p>更换<code>apt-get</code>为国内阿里云源</p> 
  <p>备份系统默认的源（没有root权限的前面加sudo）</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-keyword">cp</span> /etc/apt/sources<span class="hljs-preprocessor">.list</span> /etc/apt/sources<span class="hljs-preprocessor">.list</span><span class="hljs-preprocessor">.bak</span></code></pre> 
  <p>修改<code>/etc/apt/sources.list</code></p> 
  <pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted</span>
deb-src http://archive<span class="hljs-preprocessor">.ubuntu</span><span class="hljs-preprocessor">.com</span>/ubuntu xenial main restricted <span class="hljs-preprocessor">#Added by software-properties</span>
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial main restricted
deb-src http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial main restricted multiverse universe <span class="hljs-preprocessor">#Added by software-properties</span>
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-updates main restricted
deb-src http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-updates main restricted multiverse universe <span class="hljs-preprocessor">#Added by software-properties</span>
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial universe
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-updates universe
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial multiverse
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-updates multiverse
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-backports main restricted universe multiverse <span class="hljs-preprocessor">#Added by software-properties</span>
deb http://archive<span class="hljs-preprocessor">.canonical</span><span class="hljs-preprocessor">.com</span>/ubuntu xenial partner
deb-src http://archive<span class="hljs-preprocessor">.canonical</span><span class="hljs-preprocessor">.com</span>/ubuntu xenial partner
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-security main restricted
deb-src http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-security main restricted multiverse universe <span class="hljs-preprocessor">#Added by software-properties</span>
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-security universe
deb http://mirrors<span class="hljs-preprocessor">.aliyun</span><span class="hljs-preprocessor">.com</span>/ubuntu/ xenial-security multiverse</code></pre> 
  <p>执行更新</p> 
  <pre class="prettyprint"><code class=" hljs cs">sudo apt-<span class="hljs-keyword">get</span> update     <span class="hljs-comment">//不执行是不生效的</span></code></pre> 
  <h4 id="211-安装-geth">2.1.1. 安装 geth</h4> 
  <pre class="prettyprint"><code class=" hljs lasso">sudo apt<span class="hljs-attribute">-get</span> install software<span class="hljs-attribute">-properties</span><span class="hljs-attribute">-common</span>
sudo add<span class="hljs-attribute">-apt</span><span class="hljs-attribute">-repository</span> <span class="hljs-attribute">-y</span> ppa:ethereum/ethereum
sudo apt<span class="hljs-attribute">-get</span> update
sudo apt<span class="hljs-attribute">-get</span> install ethereum   </code></pre> 
  <pre class="prettyprint"><code class=" hljs d">somnus<span class="hljs-keyword">@ubuntu</span>:~$ geth <span class="hljs-keyword">version</span>
Geth
Version: <span class="hljs-number">1.8</span>.2-stable
Git Commit: b8b9f7f4476a30a0aaf6077daade6ae77f969960
Architecture: amd64
Protocol Versions: [<span class="hljs-number">63</span> <span class="hljs-number">62</span>]
Network Id: <span class="hljs-number">1</span>
Go Version: go1.9.4
Operating System: linux
GOPATH=
GOROOT=/usr/lib/go-<span class="hljs-number">1.9</span>
somnus<span class="hljs-keyword">@ubuntu</span>:~$ </code></pre> 
  <h4 id="212-安装-solc">2.1.2. 安装 solc</h4> 
  <pre class="prettyprint"><code class=" hljs lasso">sudo apt<span class="hljs-attribute">-get</span> install solc <span class="hljs-attribute">-y</span></code></pre> 
  <pre class="prettyprint"><code class=" hljs avrasm">somnus@ubuntu:~$ solc --version
solc, the solidity compiler commandline interface
<span class="hljs-label">Version:</span> <span class="hljs-number">0.4</span><span class="hljs-number">.19</span>+commit<span class="hljs-preprocessor">.c</span>4cbbb05<span class="hljs-preprocessor">.Linux</span><span class="hljs-preprocessor">.g</span>++               </code></pre> 
  <h3 id="22-windows">2.2. Windows</h3> 
  <pre class="prettyprint"><code class=" hljs cs">访问 https:<span class="hljs-comment">//geth.ethereum.org/downloads/</span>
下载并安装 Geth <span class="hljs-keyword">for</span> Windows      </code></pre> 
  <h3 id="23-mac-os">2.3. Mac OS</h3> 
  <pre class="prettyprint"><code class=" hljs cmake">brew tap ethereum/ethereum
brew <span class="hljs-keyword">install</span> ethereum       </code></pre> 
  <h2 id="3-创世区块">3. 创世区块</h2> 
  <p>创建一个文件夹来存储你的私链数据</p> 
  <pre class="prettyprint"><code class=" hljs bash">mkdir -p ethereum &amp;&amp; <span class="hljs-built_in">cd</span> ethereum    </code></pre> 
  <h3 id="31-初始化创世区块">3.1. 初始化创世区块</h3> 
  <pre class="prettyprint"><code class="language-json hljs ">{
  "<span class="hljs-attribute">nonce</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000042"</span></span>,
  "<span class="hljs-attribute">difficulty</span>": <span class="hljs-value"><span class="hljs-string">"0x0f0000"</span></span>,
  "<span class="hljs-attribute">mixhash</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span></span>,
  "<span class="hljs-attribute">coinbase</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000"</span></span>,
  "<span class="hljs-attribute">timestamp</span>": <span class="hljs-value"><span class="hljs-string">"0x00"</span></span>,
  "<span class="hljs-attribute">parentHash</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span></span>,
  "<span class="hljs-attribute">extraData</span>": <span class="hljs-value"><span class="hljs-string">"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"</span></span>,
  "<span class="hljs-attribute">gasLimit</span>": <span class="hljs-value"><span class="hljs-string">"0x4c4b40"</span></span>,
  "<span class="hljs-attribute">config</span>": <span class="hljs-value">{ "<span class="hljs-attribute">chainId</span>": <span class="hljs-value"><span class="hljs-number">15</span></span>, "<span class="hljs-attribute">homesteadBlock</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">eip155Block</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">eip158Block</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>}</span>,
  "<span class="hljs-attribute">alloc</span>": <span class="hljs-value">{ } </span>}</code></pre> 
  <p><strong>参数解释：</strong></p> 
  <table> 
   <thead> 
    <tr> 
     <th align="center">参数名称</th> 
     <th align="left">参数描述</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td align="center">mixhash</td> 
     <td align="left">与nonce配合用于挖矿，由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。</td> 
    </tr> 
    <tr> 
     <td align="center">nonce</td> 
     <td align="left">nonce就是一个64位随机数，用于挖矿，注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。</td> 
    </tr> 
    <tr> 
     <td align="center">difficulty</td> 
     <td align="left">设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度</td> 
    </tr> 
    <tr> 
     <td align="center">alloc</td> 
     <td align="left">用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。</td> 
    </tr> 
    <tr> 
     <td align="center">coinbase</td> 
     <td align="left">矿工的账号，随便填</td> 
    </tr> 
    <tr> 
     <td align="center">timestamp</td> 
     <td align="left">设置创世块的时间戳</td> 
    </tr> 
    <tr> 
     <td align="center">parentHash</td> 
     <td align="left">上一个区块的hash值，因为是创世块，所以这个值是0</td> 
    </tr> 
    <tr> 
     <td align="center">extraData</td> 
     <td align="left">附加信息，随便填，可以填你的个性信息</td> 
    </tr> 
    <tr> 
     <td align="center">gasLimit</td> 
     <td align="left">该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以填最大。</td> 
    </tr> 
   </tbody>
  </table> 
  <p><strong>初始化创世区块</strong></p> 
  <p>默认目录是<code>root/ethereum/</code> 你可以通过<code>--datadir</code> 参数指定目录</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">somnus</span>@ubuntu:~/ethereum$ geth <span class="hljs-comment">--datadir data init genesis.json</span>
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Maximum</span> peer count                       <span class="hljs-type">ETH</span>=<span class="hljs-number">25</span> <span class="hljs-type">LES</span>=<span class="hljs-number">0</span> total=<span class="hljs-number">25</span>
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Allocated</span> cache and file handles         database=/home/somnus/ethereum/<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata cache=16 handles=16</span>
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Writing</span> custom genesis block 
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Persisted</span> trie from memory database      nodes=<span class="hljs-number">0</span> size=<span class="hljs-number">0.00</span>B time=<span class="hljs-number">2.123</span>µs gcnodes=<span class="hljs-number">0</span> gcsize=<span class="hljs-number">0.00</span>B gctime=<span class="hljs-number">0</span>s livenodes=<span class="hljs-number">1</span> livesize=<span class="hljs-number">0.00</span>B
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Successfully</span> wrote genesis state         database=chaindata                                 hash=<span class="hljs-number">611596</span>…<span class="hljs-number">424</span>d04
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Allocated</span> cache and file handles         database=/home/somnus/ethereum/<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata cache=16 handles=16</span>
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Writing</span> custom genesis block 
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Persisted</span> trie from memory database      nodes=<span class="hljs-number">0</span> size=<span class="hljs-number">0.00</span>B time=<span class="hljs-number">2.565</span>µs gcnodes=<span class="hljs-number">0</span> gcsize=<span class="hljs-number">0.00</span>B gctime=<span class="hljs-number">0</span>s livenodes=<span class="hljs-number">1</span> livesize=<span class="hljs-number">0.00</span>B
<span class="hljs-type">INFO</span> [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">19</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span>] <span class="hljs-type">Successfully</span> wrote genesis state         database=lightchaindata                                 hash=<span class="hljs-number">611596</span>…<span class="hljs-number">424</span>d04

<span class="hljs-title">somnus</span>@ubuntu:~/ethereum$ find <span class="hljs-typedef"><span class="hljs-keyword">data</span> </span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/keystore</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata/<span class="hljs-type">LOCK</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata/<span class="hljs-type">LOG</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata/<span class="hljs-type">MANIFEST</span>-000000</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata/<span class="hljs-type">CURRENT</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/chaindata/000001.log</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata/<span class="hljs-type">LOCK</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata/<span class="hljs-type">LOG</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata/<span class="hljs-type">MANIFEST</span>-000000</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata/<span class="hljs-type">CURRENT</span></span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth/lightchaindata/000001.log </span></code></pre> 
  <p>目录结构</p> 
  <pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-built_in">data</span>
├── geth
│  ├── chaindata
│  │  ├── <span class="hljs-number">000001.</span><span class="hljs-keyword">log</span>
│  │  ├── CURRENT
│  │  ├── LOCK
│  │  ├── <span class="hljs-keyword">LOG</span>
│  │  └── MANIFEST<span class="hljs-subst">-</span><span class="hljs-number">000000</span>
│  └── lightchaindata
│      ├── <span class="hljs-number">000001.</span><span class="hljs-keyword">log</span>
│      ├── CURRENT
│      ├── LOCK
│      ├── <span class="hljs-keyword">LOG</span>
│      └── MANIFEST<span class="hljs-subst">-</span><span class="hljs-number">000000</span>
└── keystore    </code></pre> 
  <h3 id="32-启动节点">3.2. 启动节点</h3> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">somnus@ubuntu:~/ethereum$ geth <span class="hljs-comment">--networkid 15 --datadir data --rpc --rpcaddr 172.16.61.17 --rpcport 8545 --rpcapi web3,eth,personal --nodiscover console </span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Maximum peer count                       ETH=<span class="hljs-number">25</span> LES=<span class="hljs-number">0</span> total=<span class="hljs-number">25</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Starting peer-<span class="hljs-built_in">to</span>-peer node               instance=Geth/v1<span class="hljs-number">.8</span><span class="hljs-number">.2</span>-stable-b8b9f7f4/linux-amd64/go1<span class="hljs-number">.9</span><span class="hljs-number">.4</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Allocated cache <span class="hljs-operator">and</span> <span class="hljs-built_in">file</span> handles         database=/home/somnus/.ethereum/geth/chaindata cache=<span class="hljs-number">768</span> handles=<span class="hljs-number">512</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Writing default main-net genesis block 
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Persisted trie <span class="hljs-built_in">from</span> memory database      nodes=<span class="hljs-number">12356</span> size=<span class="hljs-number">2.34</span>mB <span class="hljs-built_in">time</span>=<span class="hljs-number">41.622179</span>ms gcnodes=<span class="hljs-number">0</span> gcsize=<span class="hljs-number">0.00</span>B gctime=<span class="hljs-number">0</span>s livenodes=<span class="hljs-number">1</span> livesize=<span class="hljs-number">0.00</span>B
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Initialised chain configuration          config=<span class="hljs-string">"{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: &lt;nil&gt; Engine: ethash}"</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Disk storage enabled <span class="hljs-keyword">for</span> ethash caches   dir=/home/somnus/.ethereum/geth/ethash count=<span class="hljs-number">3</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Disk storage enabled <span class="hljs-keyword">for</span> ethash DAGs     dir=/home/somnus/.ethash               count=<span class="hljs-number">2</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Initialising Ethereum protocol           versions=<span class="hljs-string">"[63 62]"</span> network=<span class="hljs-number">123456</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Loaded most recent <span class="hljs-built_in">local</span> header          <span class="hljs-built_in">number</span>=<span class="hljs-number">0</span> hash=d4e567…cb8fa3 td=<span class="hljs-number">17179869184</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Loaded most recent <span class="hljs-built_in">local</span> full block      <span class="hljs-built_in">number</span>=<span class="hljs-number">0</span> hash=d4e567…cb8fa3 td=<span class="hljs-number">17179869184</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Loaded most recent <span class="hljs-built_in">local</span> fast block      <span class="hljs-built_in">number</span>=<span class="hljs-number">0</span> hash=d4e567…cb8fa3 td=<span class="hljs-number">17179869184</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Regenerated <span class="hljs-built_in">local</span> transaction journal    transactions=<span class="hljs-number">0</span> accounts=<span class="hljs-number">0</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] Starting P2P networking 
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] HTTP endpoint opened                     url=<span class="hljs-keyword">http</span>://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8545</span> cors=* vhosts=localhost
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] RLPx listener up                         self=<span class="hljs-string">"enode://50e818e4a6ecaba459ebb3edacaaab170e206d16410a52ea67e41324228382ec91dbfea1e324ade4708fc32fa8b952b15b75b0b87cdb307ed8b9629b4d42640d@[::]:30303?discport=0"</span>
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">01</span>|<span class="hljs-number">20</span>:<span class="hljs-number">00</span>:<span class="hljs-number">31</span>] IPC endpoint opened                      url=/home/somnus/.ethereum/geth.ipc
Welcome <span class="hljs-built_in">to</span> <span class="hljs-operator">the</span> Geth JavaScript console!

instance: Geth/v1<span class="hljs-number">.8</span><span class="hljs-number">.2</span>-stable-b8b9f7f4/linux-amd64/go1<span class="hljs-number">.9</span><span class="hljs-number">.4</span>
 modules: admin:<span class="hljs-number">1.0</span> debug:<span class="hljs-number">1.0</span> eth:<span class="hljs-number">1.0</span> miner:<span class="hljs-number">1.0</span> net:<span class="hljs-number">1.0</span> personal:<span class="hljs-number">1.0</span> rpc:<span class="hljs-number">1.0</span> txpool:<span class="hljs-number">1.0</span> web3:<span class="hljs-number">1.0</span>
 &gt;</code></pre> 
  <p><strong>启动私有节点所需参数</strong></p> 
  <table> 
   <thead> 
    <tr> 
     <th>参数名称</th> 
     <th>参数描述</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td>identity</td> 
     <td>区块链的标示，随便填写，用于标示目前网络的名字</td> 
    </tr> 
    <tr> 
     <td>init</td> 
     <td>指定创世块文件的位置，并创建初始块</td> 
    </tr> 
    <tr> 
     <td>datadir</td> 
     <td>设置当前区块链网络数据存放的位置</td> 
    </tr> 
    <tr> 
     <td>port</td> 
     <td>网络监听端口</td> 
    </tr> 
    <tr> 
     <td>rpc</td> 
     <td>启动rpc通信，可以进行智能合约的部署和调试</td> 
    </tr> 
    <tr> 
     <td>rpcapi</td> 
     <td>设置允许连接的rpc的客户端，一般为db,eth,net,web3</td> 
    </tr> 
    <tr> 
     <td>rpcaddr</td> 
     <td>HTTP-RPC 服务ip地址（默认127.0.0.1）</td> 
    </tr> 
    <tr> 
     <td>rpcport</td> 
     <td>指定 HTTP-RPC 服务监听端口号（默认为 8545）；</td> 
    </tr> 
    <tr> 
     <td>networkid</td> 
     <td>设置当前区块链的网络ID，用于区分不同的网络，是一个数字，<code>如果在默认模式下启动，网络ID为1，代码会自动连接到以太坊主链</code></td> 
    </tr> 
    <tr> 
     <td>console</td> 
     <td>启动命令行模式，可以在Geth中执行命令</td> 
    </tr> 
    <tr> 
     <td>nodiscover</td> 
     <td>关闭节点发现机制，防止加入有同样初始配置的陌生节点。</td> 
    </tr> 
   </tbody>
  </table> 
  <p>请注意，在我们的<code>genesis.json</code>文件里<code>networkid（15）</code>和<code>“chainid”</code>必须是相同的。</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">//在需要日志文件的情况下</span>
<span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">networkid</span> <span class="hljs-comment">15</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-comment">data</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpc</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcaddr</span> <span class="hljs-comment">172</span><span class="hljs-string">.</span><span class="hljs-comment">16</span><span class="hljs-string">.</span><span class="hljs-comment">61</span><span class="hljs-string">.</span><span class="hljs-comment">17</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcport</span> <span class="hljs-comment">8545</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcapi</span> <span class="hljs-comment">web3</span><span class="hljs-string">,</span><span class="hljs-comment">eth</span><span class="hljs-string">,</span><span class="hljs-comment">personal</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">nodiscover</span> <span class="hljs-comment">console</span> <span class="hljs-comment">2</span>&gt;&gt;<span class="hljs-comment">geth</span><span class="hljs-string">.</span><span class="hljs-comment">log</span></code></pre> 
  <p>在已启动的情况下如何进入终端</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">geth</span> attach ipc:/usr/local/ethereum/<span class="hljs-typedef"><span class="hljs-keyword">data</span>/geth.ipc </span></code></pre> 
  <p>在其它服务器中如何进入终端</p> 
  <pre class="prettyprint"><code class=" hljs cs">geth attach http:<span class="hljs-comment">//121.43.162.28:8545 </span></code></pre> 
  <p>这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括：</p> 
  <ul> 
   <li><code>eth</code>：包含一些跟操作区块链相关的方法；</li> 
   <li><code>net</code>：包含一些查看p2p网络状态的方法；</li> 
   <li><code>admin</code>：包含一些与管理节点相关的方法；</li> 
   <li><code>miner</code>：包含启动&amp;停止挖矿的一些方法；</li> 
   <li><code>personal</code>：主要包含一些管理账户的方法；</li> 
   <li><code>txpool</code>：包含一些查看交易内存池的方法；</li> 
   <li><code>web3</code>：包含了以上对象，还包含一些单位换算的方法。</li> 
  </ul> 
  <h2 id="4-用户">4. 用户</h2> 
  <p>如跳过这一步骤，进入挖矿会报如下错误，需要设置一个挖矿的账号</p> 
  <pre class="prettyprint"><code class=" hljs css"><span class="hljs-tag">Error</span>: <span class="hljs-tag">etherbase</span> <span class="hljs-tag">missing</span>: <span class="hljs-tag">etherbase</span> <span class="hljs-tag">address</span> <span class="hljs-tag">must</span> <span class="hljs-tag">be</span> <span class="hljs-tag">explicitly</span> <span class="hljs-tag">specified</span>  
    <span class="hljs-tag">at</span> <span class="hljs-tag">web3</span><span class="hljs-class">.js</span><span class="hljs-pseudo">:3104</span><span class="hljs-pseudo">:20</span>  
    <span class="hljs-tag">at</span> <span class="hljs-tag">web3</span><span class="hljs-class">.js</span><span class="hljs-pseudo">:6191</span><span class="hljs-pseudo">:15</span>  
    <span class="hljs-tag">at</span> <span class="hljs-tag">web3</span><span class="hljs-class">.js</span><span class="hljs-pseudo">:5004</span><span class="hljs-pseudo">:36</span>  
    <span class="hljs-tag">at</span> &lt;<span class="hljs-tag">anonymous</span>&gt;<span class="hljs-pseudo">:1</span><span class="hljs-pseudo">:1</span>  </code></pre> 
  <h3 id="41-查看账户">4.1. 查看账户</h3> 
  <pre class="prettyprint"><code class=" hljs java"><span class="hljs-comment">//方式一</span>
somnus<span class="hljs-annotation">@ubuntu</span>:~/ethereum$ personal.listAccounts
<span class="hljs-comment">//方式二</span>
somnus<span class="hljs-annotation">@ubuntu</span>:~/ethereum$ eth.accounts
<span class="hljs-comment">//方式三</span>
somnus<span class="hljs-annotation">@ubuntu</span>:~/ethereum$ geth account list 
Account #<span class="hljs-number">0</span>: {<span class="hljs-number">83</span>fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6} keystore:<span class="hljs-comment">///home/neo/.ethereum/keystore/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6</span>
Account #<span class="hljs-number">1</span>: {e8abf98484325fd6afc59b804ac15804b978e607} keystore:<span class="hljs-comment">///home/neo/.ethereum/keystore/UTC--2018-01-20T06-11-23.608902164Z--e8abf98484325fd6afc59b804ac15804b978e607 </span></code></pre> 
  <h3 id="42-创建用户">4.2. 创建用户</h3> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-comment">//方式一（参数为此账户的密码）</span>
personal.newAccount(<span class="hljs-string">"123456"</span>)
<span class="hljs-comment">//方式二（也可以先创建账户，然后输入密码：）</span>
personal.newAccount()</code></pre> 
  <p>默认挖矿账号就是第一个设置的账号，当然也可以自行设置</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">eth<span class="hljs-preprocessor">.coinbase</span>
miner<span class="hljs-preprocessor">.setEtherbase</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])</code></pre> 
  <p>查看区块数据</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">eth<span class="hljs-preprocessor">.blockNumber</span></code></pre> 
  <h2 id="5-余额">5. 余额</h2> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
<span class="hljs-number">70000000000000000000</span>
eth<span class="hljs-preprocessor">.getBalance</span>()返回的余额是以太币的最小面额wei，将wei转换为以太币ether。

//primary = eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]
//balance = web3<span class="hljs-preprocessor">.fromWei</span>(eth<span class="hljs-preprocessor">.getBalance</span>(primary), <span class="hljs-string">"ether"</span>)<span class="hljs-comment">; </span>

&gt; web3<span class="hljs-preprocessor">.fromWei</span>(eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]), <span class="hljs-string">"ether"</span>)
<span class="hljs-number">70</span>    </code></pre> 
  <p>备注eth单位解释： <br> <code>kwei (1000 Wei) <br> mwei (1000 KWei) <br> gwei (1000 mwei) <br> szabo (1000 gwei) <br> finney (1000 szabo) <br> ether (1000 finney)</code></p> 
  <p>也就是说<code>ether =wei * 10^18</code>，也就是说精度可以达到18位。</p> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-comment">//wei转ether</span>
&gt; web3.fromWei(<span class="hljs-number">1000000000000000000</span>,<span class="hljs-string">"ether"</span>)
<span class="hljs-string">"1"</span>
<span class="hljs-comment">//ether转wei</span>
&gt; web3.toWei(<span class="hljs-number">1</span>)
<span class="hljs-string">"1000000000000000000"</span></code></pre> 
  <p><code>ps:web3命令</code> <br> <a href="https://ethereumbuilders.gitbooks.io/guide/content/en/ethereum_javascript_api.html" rel="nofollow">https://ethereumbuilders.gitbooks.io/guide/content/en/ethereum_javascript_api.html</a></p> 
  <h2 id="6-使用节点进行挖矿">6. 使用节点进行挖矿</h2> 
  <h3 id="61-启动矿工开始挖矿">6.1. 启动矿工开始挖矿</h3> 
  <pre class="prettyprint"><code class=" hljs sql">miner.<span class="hljs-operator"><span class="hljs-keyword">start</span>(<span class="hljs-number">1</span>)</span></code></pre> 
  <p>这里的1表示只使用一个线程运行,第一次运行时将开始创建<code>DAG文件</code>，只需等待进度条到100，则将开始挖矿。 实际你看到的挖矿速度很快，这是因为我们已经在初始化创世区块时配置为:<code>"nonce": "0x0000000000000042"</code>。 “0x42”难度能让你在私有测试网链上快速挖以太币。</p> 
  <p><strong>提示</strong></p> 
  <p>挖矿时必然有矿工账户，而系统默认使用创建的第一个账号。</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; miner.start(<span class="hljs-number">1</span>)
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">43</span>] Updated mining threads                   threads=<span class="hljs-number">1</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">43</span>] Transaction pool price threshold updated price=<span class="hljs-number">18000000000</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">43</span>] Starting mining operation 
<span class="hljs-constant">null</span>
&gt; INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">43</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">717.552</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">46</span>] Generating ethash verification cache     epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">91</span> elapsed=<span class="hljs-number">3.000</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">46</span>] Generated ethash verification cache      epoch=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">3.273</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">51</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">0</span>  elapsed=<span class="hljs-number">5.056</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">06</span>:<span class="hljs-number">56</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">1</span>  elapsed=<span class="hljs-number">10.140</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">01</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">2</span>  elapsed=<span class="hljs-number">15.119</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">06</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">3</span>  elapsed=<span class="hljs-number">19.924</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">11</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">4</span>  elapsed=<span class="hljs-number">24.739</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">16</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">5</span>  elapsed=<span class="hljs-number">29.473</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">22</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">6</span>  elapsed=<span class="hljs-number">35.641</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">26</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">7</span>  elapsed=<span class="hljs-number">40.374</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">31</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">8</span>  elapsed=<span class="hljs-number">45.134</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">36</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">9</span>  elapsed=<span class="hljs-number">49.908</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">41</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">0</span> percentage=<span class="hljs-number">10</span> elapsed=<span class="hljs-number">54.633</span>s    
......
......
......
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">22</span>:<span class="hljs-number">43</span>] Generated ethash verification cache      epoch=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">15</span>m57<span class="hljs-number">.328</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">22</span>:<span class="hljs-number">47</span>] Generating ethash verification cache     epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">17</span> elapsed=<span class="hljs-number">3.031</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">22</span>:<span class="hljs-number">50</span>] Generating ethash verification cache     epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">34</span> elapsed=<span class="hljs-number">6.056</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">22</span>:<span class="hljs-number">53</span>] Generating ethash verification cache     epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">49</span> elapsed=<span class="hljs-number">9.562</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">22</span>:<span class="hljs-number">57</span>] Generating ethash verification cache     epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">70</span> elapsed=<span class="hljs-number">13.115</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">00</span>] Generating ethash verification cache     epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">90</span> elapsed=<span class="hljs-number">16.123</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">01</span>] Generated ethash verification cache      epoch=<span class="hljs-number">1</span> elapsed=<span class="hljs-number">17.576</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">19</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">0</span>  elapsed=<span class="hljs-number">18.198</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">32</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">1</span> hash=e2b5b9…<span class="hljs-number">9</span>b1bfe
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">32</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">1</span> hash=e2b5b9…<span class="hljs-number">9</span>b1bfe
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">32</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">1.188</span>ms
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">37</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">1</span>  elapsed=<span class="hljs-number">35.913</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">41</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">62</span>db3f…e27b50
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">41</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">62</span>db3f…e27b50
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">41</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">3</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">772.239</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">43</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">3</span> hash=<span class="hljs-number">34384</span>b…c387f2
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">43</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">3</span> hash=<span class="hljs-number">34384</span>b…c387f2
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">43</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">4</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">1.002</span>ms
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">55</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">2</span>  elapsed=<span class="hljs-number">53.757</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">13</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">3</span>  elapsed=<span class="hljs-number">1</span>m11<span class="hljs-number">.561</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">30</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">4</span>  elapsed=<span class="hljs-number">1</span>m28<span class="hljs-number">.986</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">30</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">4</span> hash=<span class="hljs-number">681970</span>…<span class="hljs-number">462135</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">30</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">4</span> hash=<span class="hljs-number">681970</span>…<span class="hljs-number">462135</span>
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">30</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">5</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">833.629</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">36</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">5</span> hash=<span class="hljs-number">7</span>b058b…d2f07a
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">36</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">5</span> hash=<span class="hljs-number">7</span>b058b…d2f07a
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">36</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">6</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">897.815</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">43</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">6</span> hash=a5fc3d…b1221e
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">43</span>] ? block reached canonical chain          <span class="hljs-built_in">number</span>=<span class="hljs-number">1</span> hash=e2b5b9…<span class="hljs-number">9</span>b1bfe
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">43</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">6</span> hash=a5fc3d…b1221e
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">43</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">7</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">758.061</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">47</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">7</span> hash=<span class="hljs-number">003</span>b02…e886fd
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">47</span>] ? block reached canonical chain          <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">62</span>db3f…e27b50
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">47</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">7</span> hash=<span class="hljs-number">003</span>b02…e886fd
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">47</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">8</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">920.862</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">24</span>:<span class="hljs-number">48</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">5</span>  elapsed=<span class="hljs-number">1</span>m46<span class="hljs-number">.827</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">25</span>:<span class="hljs-number">06</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">6</span>  elapsed=<span class="hljs-number">2</span>m4<span class="hljs-number">.338</span>s
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">25</span>:<span class="hljs-number">23</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">8</span> hash=fd23c9…<span class="hljs-number">361</span>c65
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">25</span>:<span class="hljs-number">23</span>] ? block reached canonical chain          <span class="hljs-built_in">number</span>=<span class="hljs-number">3</span> hash=<span class="hljs-number">34384</span>b…c387f2
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">25</span>:<span class="hljs-number">23</span>] ? mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">8</span> hash=fd23c9…<span class="hljs-number">361</span>c65
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">25</span>:<span class="hljs-number">23</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">9</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">825.737</span>µs
INFO [<span class="hljs-number">01</span>-<span class="hljs-number">19</span>|<span class="hljs-number">21</span>:<span class="hljs-number">25</span>:<span class="hljs-number">23</span>] Generating DAG <span class="hljs-operator">in</span> progress               epoch=<span class="hljs-number">1</span> percentage=<span class="hljs-number">7</span>  elapsed=<span class="hljs-number">2</span>m22<span class="hljs-number">.061</span>s</code></pre> 
  <h3 id="62-停止挖矿">6.2. 停止挖矿</h3> 
  <pre class="prettyprint"><code class=" hljs vbnet">&gt; miner.<span class="hljs-keyword">stop</span>()
<span class="hljs-literal">true</span>
&gt;</code></pre> 
  <h3 id="63-查看所挖金额">6.3. 查看所挖金额</h3> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
<span class="hljs-number">7000000000000000000</span></code></pre> 
  <p>这是一个交互式的 JavaScript 执行环境，在这里面可以执行 JavaScript 代码，其中 &gt; 是命令提示符。在这个环境里也内置了一些用来操作以太坊的 JavaScript 对象，可以直接使用这些对象。这些对象主要包括：</p> 
  <ul> 
   <li><code>eth</code>：包含一些跟操作区块链相关的方法；</li> 
   <li><code>net</code>：包含一些查看p2p网络状态的方法；</li> 
   <li><code>admin</code>：包含一些与管理节点相关的方法；</li> 
   <li><code>miner</code>：包含启动&amp;停止挖矿的一些方法；</li> 
   <li><code>personal</code>：主要包含一些管理账户的方法；</li> 
   <li><code>txpool</code>：包含一些查看交易内存池的方法；</li> 
   <li><code>web3</code>：包含了以上对象，还包含一些单位换算的方法。</li> 
  </ul> 
  <h3 id="64-转账">6.4. 转账</h3> 
  <p>转出账号中有10000个以太币</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">
&gt; web3<span class="hljs-preprocessor">.fromWei</span>(eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]))
<span class="hljs-number">10000</span>

转入账号目前是 <span class="hljs-number">100</span> 

&gt; web3<span class="hljs-preprocessor">.fromWei</span>(eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>]))
<span class="hljs-number">100</span>

解锁传出账号，否则不能转出。personal<span class="hljs-preprocessor">.unlockAccount</span>(账号)或者personal<span class="hljs-preprocessor">.unlockAccount</span>(账号,<span class="hljs-string">"password"</span>, <span class="hljs-number">15000</span>)

&gt; personal<span class="hljs-preprocessor">.unlockAccount</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
true</code></pre> 
  <p>转账操作</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; eth.sendTransaction({<span class="hljs-built_in">from</span>: eth.accounts[<span class="hljs-number">0</span>], <span class="hljs-built_in">to</span>: eth.accounts[<span class="hljs-number">1</span>], <span class="hljs-built_in">value</span>: web3.toWei(<span class="hljs-number">10000</span>, <span class="hljs-string">"ether"</span>)})
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">35</span>] Submitted transaction                    fullhash=<span class="hljs-number">0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27</span> recipient=<span class="hljs-number">0x7053133f9C5803a71C1a0FEdAD3E3a3138e2225B</span>
<span class="hljs-string">"0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27"</span>
<span class="hljs-comment"> //查看待确认交易的详情</span><span class="hljs-comment"> //使用命令web3.eth.getTransaction：</span>
&gt; web3.eth.getTransaction(<span class="hljs-string">"0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27"</span>)
{
  blockHash: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
  blockNumber: <span class="hljs-constant">null</span>,
  <span class="hljs-built_in">from</span>: <span class="hljs-string">"0x4d047e01cd56f878443b11eb2417a936f40d69f7"</span>,
  gas: <span class="hljs-number">90000</span>,
  gasPrice: <span class="hljs-number">18000000000</span>,
  hash: <span class="hljs-string">"0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27"</span>,
  input: <span class="hljs-string">"0x"</span>,
  nonce: <span class="hljs-number">13</span>,
  r: <span class="hljs-string">"0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a"</span>,
  s: <span class="hljs-string">"0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c"</span>,
  <span class="hljs-built_in">to</span>: <span class="hljs-string">"0x7053133f9c5803a71c1a0fedad3e3a3138e2225b"</span>,
  transactionIndex: <span class="hljs-number">0</span>,
  v: <span class="hljs-string">"0x42"</span>,
  <span class="hljs-built_in">value</span>: <span class="hljs-number">1e+22</span>
}
<span class="hljs-comment"> //由于交易还未确认，所以所属区块为null，blockNumber: null。</span><span class="hljs-comment"> //主要参数含义</span><span class="hljs-comment"> //gas：需要的gas数量</span><span class="hljs-comment"> //gasPrice：交易的gas单价[18,000,000,000(wei)=18(GWei)]</span><span class="hljs-comment"> //由此可以算出，我们需要交纳的手续费为=90,000*18(GWei)=1620,000(Gwei)=0.00162(ether)</span>
</code></pre> 
  <p>如果你现在查看转入账号，你会发现余额仍然是 0 ，交易还未成功写进区块，写进区块的方式是挖矿，所以你必须执行挖矿</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; miner.start(<span class="hljs-number">1</span>)
<span class="hljs-constant">null</span>
&gt; INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">18</span>] Starting mining operation 
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">18</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">6713</span> txs=<span class="hljs-number">1</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">363.708</span>µs
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">26</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">6713</span> hash=<span class="hljs-number">260</span>c89…<span class="hljs-number">44</span>b141
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">26</span>]  mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">6713</span> hash=<span class="hljs-number">260</span>c89…<span class="hljs-number">44</span>b141
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">26</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">6714</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">196.425</span>µs
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">28</span>] Successfully sealed <span class="hljs-built_in">new</span> block            <span class="hljs-built_in">number</span>=<span class="hljs-number">6714</span> hash=b690a2…b38e1a
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">28</span>]  mined potential block                  <span class="hljs-built_in">number</span>=<span class="hljs-number">6714</span> hash=b690a2…b38e1a
INFO [<span class="hljs-number">04</span>-<span class="hljs-number">19</span>|<span class="hljs-number">12</span>:<span class="hljs-number">51</span>:<span class="hljs-number">28</span>] Commit <span class="hljs-built_in">new</span> mining work                   <span class="hljs-built_in">number</span>=<span class="hljs-number">6715</span> txs=<span class="hljs-number">0</span> uncles=<span class="hljs-number">0</span> elapsed=<span class="hljs-number">115.331</span>µs</code></pre> 
  <blockquote> 
   <p>第三行第四行显示成功密封了一个新的区块。</p> 
  </blockquote> 
  <p>稍后几分钟，再次查看转入账号，将会看到有10000个以太币入账。传出账号会减少10000个以太币，同时仍然继续挖矿中。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; web3<span class="hljs-preprocessor">.fromWei</span>(eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]), <span class="hljs-string">"ether"</span>)
<span class="hljs-number">10100</span>
//再次查看交易详情
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.getTransaction</span>(<span class="hljs-string">"0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27"</span>)
{
  blockHash: <span class="hljs-string">"0x260c89fdcef4783c22b8cf537fa69c22ee9b7c05bae5ca3aa98c8a3b7944b141"</span>,
  blockNumber: <span class="hljs-number">6713</span>,
  from: <span class="hljs-string">"0x4d047e01cd56f878443b11eb2417a936f40d69f7"</span>,
  gas: <span class="hljs-number">90000</span>,
  gasPrice: <span class="hljs-number">18000000000</span>,
  hash: <span class="hljs-string">"0xa5572bee3609c772e2f3c0b05df52a0ce5b75e401dc00c6c0365b4f36b93df27"</span>,
  input: <span class="hljs-string">"0x"</span>,
  nonce: <span class="hljs-number">13</span>,
  r: <span class="hljs-string">"0x4670f7999a0466a80870d8d69a4c0dab2597b055e1c850b063990d431cdb046a"</span>,
  s: <span class="hljs-string">"0x38f5275a006a1b74ef889a73ac096142f294d69505d60239384a706d9a3cc44c"</span>,
  to: <span class="hljs-string">"0x7053133f9c5803a71c1a0fedad3e3a3138e2225b"</span>,
  transactionIndex: <span class="hljs-number">0</span>,
  v: <span class="hljs-string">"0x42"</span>,
  value: <span class="hljs-number">1e+22</span>
}</code></pre> 
  <h2 id="7-私有链直接部署智能合约">7. 私有链直接部署智能合约</h2> 
  <h3 id="71-编写智能合约代码">7.1. 编写智能合约代码</h3> 
  <pre class="prettyprint"><code class=" hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.4</span>;

contract calculator { 

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span><span class="hljs-params">(uint a)</span> <span class="hljs-title">returns</span><span class="hljs-params">(uint d)</span>{</span>

        <span class="hljs-keyword">return</span> a * <span class="hljs-number">7</span>;
    }

}</code></pre> 
  <h3 id="72-检查coinbase账号余额">7.2. 检查coinbase账号余额</h3> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; account1 = web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0x2abf46d8b0d940cdeedd55872bc0648add40227d"</span>
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.getBalance</span>(account1)
<span class="hljs-number">0</span>
&gt; </code></pre> 
  <p>如果余额大于0，继续，否则，开始挖矿。</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start();</span>
null
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <p>如果你觉得差不多了，可以运行下面的命令停止挖矿。</p> 
  <pre class="prettyprint"><code class=" hljs vbnet">&gt; miner.<span class="hljs-keyword">stop</span>();
<span class="hljs-literal">true</span></code></pre> 
  <h3 id="73-解锁coinbase账号我们通过coinbase账号来付费部署合约">7.3. 解锁coinbase账号，我们通过coinbase账号来付费部署合约</h3> 
  <p><code>123456</code>: 换成你的密码。</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; personal.unlockAccount(web3.eth.coinbase, <span class="hljs-string">'123456'</span>) 
<span class="hljs-literal">true</span></code></pre> 
  <h3 id="74-获取智能合约字节码和abi">7.4. 获取智能合约字节码和abi</h3> 
  <p>代码拷贝到<a href="https://remix.ethereum.org" rel="nofollow">https://remix.ethereum.org</a> 或 <a href="https://ethereum.github.io/browser-solidity/" rel="nofollow">https://ethereum.github.io/browser-solidity/</a>，编译，然后点击<code>Details</code></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180417131306810?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RyZWFtc3VuZGF5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p> 
  <h3 id="75-将-browser-solidity编译后的合约部署到geth">7.5. 将 Browser-solidity编译后的合约部署到Geth</h3> 
  <p>发送部署合约的交易</p> 
  <pre class="prettyprint"><code class=" hljs actionscript"><span class="hljs-keyword">var</span> calculatorContract = web3.eth.contract([{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"a"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"multiply"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"d"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>}]);
<span class="hljs-keyword">var</span> calculator = calculatorContract.<span class="hljs-keyword">new</span>(
   {
     from: web3.eth.accounts[<span class="hljs-number">0</span>], 
     data: <span class="hljs-string">'0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029'</span>, 
     gas: <span class="hljs-string">'4700000'</span>
   }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, contract)</span>{</span>
    console.log(e, contract);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> contract.address !== <span class="hljs-string">'undefined'</span>) {
         console.log(<span class="hljs-string">'Contract mined! address: '</span> + contract.address + <span class="hljs-string">' transactionHash: '</span> + contract.transactionHash);
    }
 })</code></pre> 
  <blockquote> 
   <ul> 
    <li><p><strong><code>from</code>代表合约由哪个账户生成，哪个账户生成，则生成所需的<code>gas</code>就需要该账户承担，默认为<code>eth.accounts[0]</code>，因为所有挖矿所得的以太币也默认都存入该账户中。</strong></p></li> 
    <li><p><strong><code>data</code>代表的就是<code>bytecode</code>。是编译后的代码，你的代码越长，这块的字符串越多。</strong></p></li> 
    <li><p><strong><code>gas</code>代表的是为了部署该合约最多准备的gas数量，当然实际上可能用不了这么多<code>gas</code>，具体消耗以实际使用量为准，这里只是设定一个最大量。<code>gas</code>是调用合约要扣除的<code>gas</code>单位，可以理解为以太币，<code>gas</code>和<code>ether</code>之间有个汇率，汇率受矿机的算率影响会有调整，在公网上，这些<code>gas</code>用于奖励给挖矿者。</strong></p></li> 
    <li><p><strong>最后这段是一个典型的javascript的异步调用的写法，将上面的new方法的结果传递给下一个方法<code>function（e,contract)</code>，在下一个方法中处理如果挖矿成功的显示结果。如果合约成功部署在区块上，则在控制台打印出来<code>Contract mined!</code>、<code>contract address</code>、<code>transactionHash</code>等信息。</strong></p></li> 
    <li><p><strong><code>address</code>表示已经部署智能合约的帐户地址，智能合约也相当于一个帐户。</strong></p></li> 
    <li><p><strong><code>transactionHash</code>表示智能合约产生时的hash值，会永久保存到区块链条里面。</strong></p></li> 
   </ul> 
  </blockquote> 
  <p>输入<code>calculator</code>可以看到合约的一些信息</p> 
  <pre class="prettyprint"><code class=" hljs r">&gt; calculator
{
  abi: [{
      constant: false,
      inputs: [{<span class="hljs-keyword">...</span>}],
      name: <span class="hljs-string">"multiply"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      stateMutability: <span class="hljs-string">"nonpayable"</span>,
      type: <span class="hljs-string">"function"</span>
  }],
  address: <span class="hljs-string">"0x35be144ae869bf8cc7ab83f5dd956898e3b127aa"</span>,
  transactionHash: <span class="hljs-string">"0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed"</span>,
  allEvents: <span class="hljs-keyword">function</span>(),
  multiply: <span class="hljs-keyword">function</span>()
}</code></pre> 
  <h3 id="76-查看本地交易池中待确认的交易">7.6. 查看本地交易池中待确认的交易</h3> 
  <pre class="prettyprint"><code class=" hljs css">&gt; <span class="hljs-tag">txpool</span><span class="hljs-class">.status</span>
<span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">pending</span>:<span class="hljs-value"> <span class="hljs-number">1</span>, queued: <span class="hljs-number">0</span> </span></span></span>}</code></pre> 
  <p>可以看到交易池中有一个待确认的交易</p> 
  <h3 id="77-查看待确认交易的详情">7.7. 查看待确认交易的详情</h3> 
  <p>使用命令<code>web3.eth.getTransaction</code>，参数为<code>transactionHash</code>：</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; web3.eth.getTransaction(<span class="hljs-string">"0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed"</span>)
{
  blockHash: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
  blockNumber: <span class="hljs-constant">null</span>,
  <span class="hljs-built_in">from</span>: <span class="hljs-string">"0x4d047e01cd56f878443b11eb2417a936f40d69f7"</span>,
  gas: <span class="hljs-number">4700000</span>,
  gasPrice: <span class="hljs-number">18000000000</span>,
  hash: <span class="hljs-string">"0x9bd7fe9080ed20a5fbeaa644ca87614b00fcd15582bff897598d991a680fa5d9"</span>,
  input: <span class="hljs-string">"0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f22b1e35f2de2583454229eaa5609b69b3a3628801c59eecb3361299cc2cdc4b0029"</span>,
  nonce: <span class="hljs-number">20</span>,
  r: <span class="hljs-string">"0xca66158e7abf3582fedf03dd040083a0838370687569a62badb88089a62f77"</span>,
  s: <span class="hljs-string">"0x140d6bd716ec6d137eced02987eccc952065d371030784b661051d6f3f630428"</span>,
  <span class="hljs-built_in">to</span>: <span class="hljs-constant">null</span>,
  transactionIndex: <span class="hljs-number">0</span>,
  v: <span class="hljs-string">"0x41"</span>,
  <span class="hljs-built_in">value</span>: <span class="hljs-number">0</span>
}
&gt; </code></pre> 
  <p>由于交易还未确认，所以所属区块为null，<code>blockNumber: null</code>。</p> 
  <h3 id="78-预估手续费">7.8. 预估手续费</h3> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; bytecode = <span class="hljs-string">"608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029 "</span>
<span class="hljs-string">"608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029"</span>
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.estimateGas</span>({data: bytecode})
<span class="hljs-label">Error:</span> invalid argument <span class="hljs-number">0</span>: json: cannot unmarshal hex string without <span class="hljs-number">0</span><span class="hljs-built_in">x</span> prefix into Go struct field CallArgs<span class="hljs-preprocessor">.data</span> of type hexutil<span class="hljs-preprocessor">.Bytes</span>
    at web3<span class="hljs-preprocessor">.js</span>:<span class="hljs-number">3104</span>:<span class="hljs-number">20</span>
    at web3<span class="hljs-preprocessor">.js</span>:<span class="hljs-number">6191</span>:<span class="hljs-number">15</span>
    at web3<span class="hljs-preprocessor">.js</span>:<span class="hljs-number">5004</span>:<span class="hljs-number">36</span>
    at &lt;anonymous&gt;:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>

&gt; bytecode = <span class="hljs-string">"0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029"</span>
<span class="hljs-string">"0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029"</span>
&gt; web3<span class="hljs-preprocessor">.eth</span><span class="hljs-preprocessor">.estimateGas</span>({data: bytecode})
<span class="hljs-number">98391</span>
&gt; </code></pre> 
  <p>备注：字节码前面需要添加<code>0x</code>。手续费大概为<code>98391gas</code>。</p> 
  <h3 id="79-你的合约等待挖矿开始挖矿等一会儿停止">7.9. 你的合约等待挖矿，开始挖矿，等一会儿，停止</h3> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; miner.start()</span>
null
<span class="hljs-blockquote">&gt; Contract mined! Address: 0xbf8b24283f2516360d3a4ba1db0df78ae74689db</span>
[object Object]
<span class="hljs-blockquote">&gt; miner.stop()</span>
true
<span class="hljs-blockquote">&gt; </span></code></pre> 
  <h3 id="710-检查合约是否部署成功">7.10. 检查合约是否部署成功</h3> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getCode</span>(calculator<span class="hljs-preprocessor">.address</span>)
<span class="hljs-string">"0x60606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa114603d575b600080fd5b3415604757600080fd5b605b60048080359060200190919050506071565b6040518082815260200191505060405180910390f35b60006007820290505b9190505600a165627a7a7230582067d7c851e14e862886b6f53dad6825135557fb3a4b691350c94ea5b80605f6770029"</span>
&gt; </code></pre> 
  <h3 id="711-调用合约方法">7.11. 调用合约方法</h3> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; calculator.multiply.call(6)</span>
42
<span class="hljs-blockquote">&gt; //本地调用，不会向区块链网络广播任何东西的合约调用，不会被区块所打包，切记、切记！！！</span></code></pre> 
  <p>如果换做其他人需要运行你的智能合约，还可以用如下方式，但需要两个信息：（后面提到的truffle部署智能合约成功后，私有链就按此方式调用）</p> 
  <blockquote> 
   <ol> 
    <li>智能合约地址<code>Address</code></li> 
    <li>智能合约<code>ABI（Application Binary Interface）</code>，<code>ABI</code>其实就是一个有序的用户手册，描述了所有方法的名字和如何调用它们。</li> 
   </ol> 
  </blockquote> 
  <pre class="prettyprint"><code class=" hljs cs">&gt; <span class="hljs-keyword">var</span> abi = [{<span class="hljs-string">"constant"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"a"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"multiply"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"d"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-keyword">false</span>,<span class="hljs-string">"stateMutability"</span>:<span class="hljs-string">"nonpayable"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>}]
&gt; <span class="hljs-keyword">var</span> calc = eth.contract(abi).at(<span class="hljs-string">"0x35be144ae869bf8cc7ab83f5dd956898e3b127aa"</span>)
&gt; calc.multiply.call(<span class="hljs-number">6</span>)
&gt; <span class="hljs-number">42</span></code></pre> 
  <h3 id="712-再查询交易详情">7.12. 再查询交易详情</h3> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; web3.eth.getTransaction(<span class="hljs-string">"0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed"</span>)
{
  blockHash: <span class="hljs-string">"0x23718f944ea863cdae899b7cf85a298e7a3efc70be09364461d0bf4ef90ae4b5"</span>,
  blockNumber: <span class="hljs-number">5900</span>,
  <span class="hljs-built_in">from</span>: <span class="hljs-string">"0x4d047e01cd56f878443b11eb2417a936f40d69f7"</span>,
  gas: <span class="hljs-number">4700000</span>,
  gasPrice: <span class="hljs-number">18000000000</span>,
  hash: <span class="hljs-string">"0x3c5d28ef56f225d7d2d6b02106a628fce5ce5b42c9c2ba6205bb3ee3a9deeeed"</span>,
  input: <span class="hljs-string">"0x608060405234801561001057600080fd5b5060bb8061001f6000396000f300608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c6888fa1146044575b600080fd5b348015604f57600080fd5b50606c600480360381019080803590602001909291905050506082565b6040518082815260200191505060405180910390f35b60006007820290509190505600a165627a7a72305820f75ed1716facde6a967c214d7920116d5cc4bc2504682f047a95e82183d8c9bd0029"</span>,
  nonce: <span class="hljs-number">21</span>,
  r: <span class="hljs-string">"0x2c81c8ff57dfeccf393d7db45a4cee2f66653e80019a26fb3992ece650457d30"</span>,
  s: <span class="hljs-string">"0xf5db5ebebaa82b16136a29274bffd2351782c9be6f6e4059addf52e58219f48"</span>,
  <span class="hljs-built_in">to</span>: <span class="hljs-constant">null</span>,
  transactionIndex: <span class="hljs-number">0</span>,
  v: <span class="hljs-string">"0x41"</span>,
  <span class="hljs-built_in">value</span>: <span class="hljs-number">0</span>
}</code></pre> 
  <p>可以看到已经写到编号为<code>5900</code>的区块上了<code>blockNumber: 5900</code>。</p> 
  <h2 id="8-创建新节点">8. 创建新节点</h2> 
  <p>都说区块链是去中心化的账本那么可以满足于单机挖矿？说干就干接下来创建一个新节点并将太接入我们的主节点。这里需要注意以下几点：</p> 
  <p>新节点的 <code>networkid</code> 要与 第一个创建的节点<code>data</code> 一致 <br> 需要与 第一个创建的节点<code>data</code> 使用同一个创世区块（也就是同一个<code>genesis.json</code>文件） <br> 如果多个节点都在一台机器上注意端口区分，避免端口冲突 <br> <code>--port 30304</code> <br> <code>--rpcport 9545</code></p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-comment">data2</span> <span class="hljs-comment">init</span> <span class="hljs-comment">genesis</span><span class="hljs-string">.</span><span class="hljs-comment">json</span>

<span class="hljs-comment">geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">networkid</span> <span class="hljs-comment">15</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-comment">data2</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpc</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">port</span> <span class="hljs-comment">30304</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcaddr</span> <span class="hljs-comment">172</span><span class="hljs-string">.</span><span class="hljs-comment">16</span><span class="hljs-string">.</span><span class="hljs-comment">61</span><span class="hljs-string">.</span><span class="hljs-comment">17</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rpcport</span> <span class="hljs-comment">9545</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">nodiscover</span> <span class="hljs-comment">console</span></code></pre> 
  <h3 id="81联盟链互通">8.1.联盟链互通</h3> 
  <p>上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; admin.peers</span>
[]</code></pre> 
  <p>发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。</p> 
  <p>下面就通过分享enode地址的方式来让两个节点建立链接。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; admin<span class="hljs-preprocessor">.nodeInfo</span><span class="hljs-preprocessor">.enode</span>
<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0"</span>
&gt;</code></pre> 
  <p>通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。</p> 
  <p>其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如：</p> 
  <pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-constant">INFO</span> [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">23</span><span class="hljs-symbol">:</span><span class="hljs-number">16</span>] <span class="hljs-constant">RLPx</span> listener up                         <span class="hljs-keyword">self</span>=<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0"</span></code></pre> 
  <p>现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令：</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; admin.addPeer(<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0"</span>)
<span class="hljs-literal">true</span></code></pre> 
  <p>返回true，说明执行成功。再次验证一下：</p> 
  <pre class="prettyprint"><code class=" hljs applescript">&gt; admin.peers
[{
    caps: [<span class="hljs-string">"eth/63"</span>],
    <span class="hljs-property">id</span>: <span class="hljs-string">"aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c"</span>,
    <span class="hljs-property">name</span>: <span class="hljs-string">"Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2"</span>,
    network: {
      localAddress: <span class="hljs-string">"[::1]:49426"</span>,
      remoteAddress: <span class="hljs-string">"[::1]:30306"</span>
    },
    protocols: {
      eth: {
        difficulty: <span class="hljs-number">16384</span>,
        head: <span class="hljs-string">"0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a"</span>,
        <span class="hljs-property">version</span>: <span class="hljs-number">63</span>
      }
    }
}]
&gt;</code></pre> 
  <p>发现<code>节点1</code>已经有一个peer了，同时我们可以看到<code>remoteAddress: “[::1]:30306”</code>，正是我们节点2的端口信息。在<code>节点2</code>执行<code>admin.peers</code>会发现有类似的信息，指向的peer正是节点1的。</p> 
  <p>查询余额并挖矿</p> 
  <p>执行查看余额命令：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.coinbase</span>）
<span class="hljs-number">0</span></code></pre> 
  <p>在<code>节点1</code>执行<code>miner.start()</code>进行挖矿，执行<code>miner.stop()</code>停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。</p> 
  <p>当我们在<code>节点1</code>执行挖矿时，我们会发现<code>节点2</code>的控制台出现了这样的日志信息：</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">32</span>] Block synchronisation started
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Imported <span class="hljs-built_in">new</span> state entries               count=<span class="hljs-number">1</span> elapsed=<span class="hljs-number">47.661</span>µs processed=<span class="hljs-number">1</span> pending=<span class="hljs-number">0</span> retry=<span class="hljs-number">0</span> duplicate=<span class="hljs-number">0</span> unexpected=<span class="hljs-number">0</span>
WARN [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Discarded bad propagated block           <span class="hljs-built_in">number</span>=<span class="hljs-number">1</span> hash=ab49ba…<span class="hljs-number">1</span>cf32f
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Imported <span class="hljs-built_in">new</span> block headers               count=<span class="hljs-number">2</span> elapsed=<span class="hljs-number">9.208</span>ms  <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">738225</span>…<span class="hljs-number">000e3</span>b ignored=<span class="hljs-number">0</span>
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">2</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">1.724</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">738225</span>…<span class="hljs-number">000e3</span>b
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Fast sync complete, auto disabling
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">34</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">5.978</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">3</span> hash=b069a9…<span class="hljs-number">426060</span>
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">38</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.930</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">4</span> hash=<span class="hljs-number">21217</span>e…<span class="hljs-number">526253</span>
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">41</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.419</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">5</span> hash=<span class="hljs-number">3</span>fa6ff…cf2794
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">43</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.557</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">6</span> hash=<span class="hljs-number">4</span>c35b9…<span class="hljs-number">78</span>b3ec
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">45</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.514</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">7</span> hash=<span class="hljs-number">328e62</span>…<span class="hljs-number">1</span>bd3d3
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">46</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.513</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">8</span> hash=<span class="hljs-number">12287</span>e…<span class="hljs-number">0465</span>b5
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">06</span>:<span class="hljs-number">19</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">7.048</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">9</span> hash=<span class="hljs-number">8e844</span>b…b99d6c
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">06</span>:<span class="hljs-number">22</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">8.156</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">10</span> hash=<span class="hljs-number">159</span>b36…d4dde5
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">06</span>:<span class="hljs-number">24</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.549</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">11</span> hash=<span class="hljs-number">969100</span>…<span class="hljs-number">5658</span>a5</code></pre> 
  <p>也就是说，<code>节点1</code>挖矿，<code>节点2</code>在同步数据信息。</p> 
  <p>停止节点1的挖矿，并查看coinbase地址金额：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; miner<span class="hljs-preprocessor">.stop</span>()
true
&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.coinbase</span>)
<span class="hljs-number">140000000000000000000</span>
&gt; eth<span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e"</span></code></pre> 
  <p>这里我们知道了节点一种的地址信息和余额信息，那我们拿<code>节点1</code>的这个地址在<code>节点2</code>的控制台查询一下信息：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(<span class="hljs-string">"0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e"</span>)
<span class="hljs-number">140000000000000000000</span></code></pre> 
  <p>很显然，<code>节点2</code>中也能查询到<code>节点1</code>中地址的余额。以上信息说明，<code>节点1</code>和<code>节点2</code>的数据是完全同步的。</p> 
  <p>并且也可以在不同节点运行<code>eth.blockNumber</code>可以查到区块数量是保持一致的</p> 
  <h2 id="9-how-can-i-run-go-ethereum-as-daemon-process-on-ubuntu">9. How can I run go-ethereum as daemon process on Ubuntu?</h2> 
  <ul> 
   <li>Create a file geth.service:</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs ini"><span class="hljs-title">[Unit]</span>
<span class="hljs-setting">Description=<span class="hljs-value">Ethereum go client</span></span>

<span class="hljs-title">[Service]</span>
<span class="hljs-setting">Type=<span class="hljs-value">simple</span></span>
<span class="hljs-setting">ExecStart=<span class="hljs-value">/usr/bin/geth --networkid <span class="hljs-number">15</span> --datadir /usr/local/ethereum/data --rpc --rpcaddr <span class="hljs-number">172.16</span>.<span class="hljs-number">61.17</span> --rpcport <span class="hljs-number">8545</span> --nodiscover <span class="hljs-number">2</span>&gt;&gt;/usr/local/ethereum/data/geth.log</span></span>

<span class="hljs-title">[Install]</span>
<span class="hljs-setting">WantedBy=<span class="hljs-value">default.target</span></span>
</code></pre> 
  <ul> 
   <li>Enable service:</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">systemctl</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">user</span> <span class="hljs-comment">enable</span> <span class="hljs-comment">/usr/local/ethereum/geth</span><span class="hljs-string">.</span><span class="hljs-comment">service</span>
<span class="hljs-comment">systemctl</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">user</span> <span class="hljs-comment">start</span> <span class="hljs-comment">geth</span><span class="hljs-string">.</span><span class="hljs-comment">service</span></code></pre> 
  <ul> 
   <li>test it</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs lasso">netstat <span class="hljs-attribute">-tunpl</span><span class="hljs-subst">|</span>grep <span class="hljs-number">8545</span>

geth attach ipc:/usr/<span class="hljs-built_in">local</span>/ethereum/<span class="hljs-built_in">data</span>/geth<span class="hljs-built_in">.</span>ipc </code></pre> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lovesomnus/article/details/79785730,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lovesomnus/article/details/79785730,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

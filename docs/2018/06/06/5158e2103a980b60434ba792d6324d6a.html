<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>多机上部署多个组织（4org）的fabric网络 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="多机上部署多个组织（4org）的fabric网络" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本部署基于e2e_cli官方例程，即4Peer+1Orderer的多节点架构，5台主机分别是orderer.example.com、peer0.org1.example.com、peer0.org2.example.com、peer0.org3.example.com、peer0.org4.example.com。 可以首先确保官方提供的2个org，每个组织两个peer的多节点例子能够跑通，具体可参见深蓝或Aberic的博客，再根据两个组织的改成4个组织的。 一、生成公私钥、证书、创世区块和Channel配置区块 角色及id如下： 角色 id orderer.example.com 192.168.3.221 peer0.org1.example.com 192.168.3.222 peer0.org2.example.com 192.168.3.224 peer0.org3.example.com 192.168.3.225 peer0.org4.example.com 192.168.3.228 首先在每个peer节点的机器下复制e2e_cli文件夹，产生新的4orgexample工程目录， root@ubuntu:/opt/gopath/src/github.com/hyperledger/fabric/examples# cp -r e2e_cli 4orgexample 1.1 修改公私钥和证书的配置文件crypto-config.yaml 进入4orgexample目录，首先修改crypto-config.yaml配置文件，将两个org改为四个org，从而生成4个peer和orderer的证书。crypto-config.yaml文件修改如下： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # # --------------------------------------------------------------------------- # &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes # --------------------------------------------------------------------------- OrdererOrgs: # --------------------------------------------------------------------------- # Orderer # --------------------------------------------------------------------------- - Name: Orderer Domain: example.com # --------------------------------------------------------------------------- # &quot;Specs&quot; - See PeerOrgs below for complete description # --------------------------------------------------------------------------- Specs: - Hostname: orderer # --------------------------------------------------------------------------- # &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes # --------------------------------------------------------------------------- PeerOrgs: - Name: Org1 Domain: org1.example.com Template: Count: 1 Users: Count: 1 - Name: Org2 Domain: org2.example.com Template: Count: 1 Users: Count: 1 - Name: Org3 Domain: org3.example.com Template: Count: 1 Users: Count: 1 - Name: Org4 Domain: org4.example.com Template: Count: 1 Users: Count: 1 1.2 修改生成创世区块和Channel配置区块的配置文件configtx.yaml 接着修改configtx.yaml文件，该文件分为几个部分， Profiles: Profiles describe the organizational structure of your network Organizations: The details regarding individual organizations Orderers: The details regarding the Orderer parameters Applications: Application defaults - not needed 具体修改如下： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # --- ################################################################################ # # Profile # # - Different configuration profiles may be encoded here to be specified # as parameters to the configtxgen tool # ################################################################################ Profiles: FourOrgsOrdererGenesis: Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 - *Org3 - *Org4 FourOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 - *Org3 - *Org4 ################################################################################ # # Section: Organizations # # - This section defines the different organizational identities which will # be referenced later in the configuration. # ################################################################################ Organizations: # SampleOrg defines an MSP using the sampleconfig. It should never be used # in production but may be used as a template for other definitions - &amp;OrdererOrg # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: OrdererOrg # ID to load the MSP definition as ID: OrdererMSP # MSPDir is the filesystem path which contains the MSP configuration MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org1MSP # ID to load the MSP definition as ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org2MSP # ID to load the MSP definition as ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org2.example.com Port: 7051 - &amp;Org3 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org3MSP # ID to load the MSP definition as ID: Org3MSP MSPDir: crypto-config/peerOrganizations/org3.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org3.example.com Port: 7051 - &amp;Org4 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org4MSP # ID to load the MSP definition as ID: Org4MSP MSPDir: crypto-config/peerOrganizations/org4.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org4.example.com Port: 7051 ################################################################################ # # SECTION: Orderer # # - This section defines the values to encode into a config transaction or # genesis block for orderer related parameters # ################################################################################ Orderer: &amp;OrdererDefaults # Orderer Type: The orderer implementation to start # Available types are &quot;solo&quot; and &quot;kafka&quot; OrdererType: solo Addresses: - orderer.example.com:7050 # Batch Timeout: The amount of time to wait before creating a batch BatchTimeout: 2s # Batch Size: Controls the number of messages batched into a block BatchSize: # Max Message Count: The maximum number of messages to permit in a batch MaxMessageCount: 10 # Absolute Max Bytes: The absolute maximum number of bytes allowed for # the serialized messages in a batch. AbsoluteMaxBytes: 98 MB # Preferred Max Bytes: The preferred maximum number of bytes allowed for # the serialized messages in a batch. A message larger than the preferred # max bytes will result in a batch larger than preferred max bytes. PreferredMaxBytes: 512 KB Kafka: # Brokers: A list of Kafka brokers to which the orderer connects # NOTE: Use IP:port notation Brokers: - 127.0.0.1:9092 # Organizations is the list of orgs which are defined as participants on # the orderer side of the network Organizations: ################################################################################ # # SECTION: Application # # - This section defines the values to encode into a config transaction or # genesis block for application related parameters # ################################################################################ Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: 1.3 修改运行配置文件的脚本 然后修改generateArtifacts.sh脚本为： #!/bin/bash +x # # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # #set -e CHANNEL_NAME=$1 : ${CHANNEL_NAME:=&quot;mychannel&quot;} echo $CHANNEL_NAME export FABRIC_ROOT=$PWD/../.. export FABRIC_CFG_PATH=$PWD echo OS_ARCH=$(echo &quot;$(uname -s|tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;|sed &#39;s/mingw64_nt.*/windows/&#39;)-$(uname -m | sed &#39;s/x86_64/amd64/g&#39;)&quot; | awk &#39;{print tolower($0)}&#39;) ## Using docker-compose template replace private key file names with constants function replacePrivateKey () { ARCH=`uname -s | grep Darwin` if [ &quot;$ARCH&quot; == &quot;Darwin&quot; ]; then OPTS=&quot;-it&quot; else OPTS=&quot;-i&quot; fi cp docker-compose-e2e-template.yaml docker-compose-e2e.yaml CURRENT_DIR=$PWD cd crypto-config/peerOrganizations/org1.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA1_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org2.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA2_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org3.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA3_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org4.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA4_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml } ## Generates Org certs using cryptogen tool function generateCerts (){ CRYPTOGEN=$FABRIC_ROOT/release/$OS_ARCH/bin/cryptogen if [ -f &quot;$CRYPTOGEN&quot; ]; then echo &quot;Using cryptogen -&gt; $CRYPTOGEN&quot; else echo &quot;Building cryptogen&quot; make -C $FABRIC_ROOT release fi echo echo &quot;##########################################################&quot; echo &quot;##### Generate certificates using cryptogen tool #########&quot; echo &quot;##########################################################&quot; $CRYPTOGEN generate --config=./crypto-config.yaml echo } ## Generate orderer genesis block , channel configuration transaction and anchor peer update transactions function generateChannelArtifacts() { CONFIGTXGEN=$FABRIC_ROOT/release/$OS_ARCH/bin/configtxgen if [ -f &quot;$CONFIGTXGEN&quot; ]; then echo &quot;Using configtxgen -&gt; $CONFIGTXGEN&quot; else echo &quot;Building configtxgen&quot; make -C $FABRIC_ROOT release fi echo &quot;##########################################################&quot; echo &quot;######### Generating Orderer Genesis block ##############&quot; echo &quot;##########################################################&quot; # Note: For some unknown reason (at least for now) the block file can&#39;t be # named orderer.genesis.block or the orderer will fail to launch! $CONFIGTXGEN -profile FourOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block echo echo &quot;#################################################################&quot; echo &quot;### Generating channel configuration transaction &#39;channel.tx&#39; ###&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org1MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org2MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP echo echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org3MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org3MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org3MSP echo echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org4MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org4MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org4MSP echo } generateCerts replacePrivateKey generateChannelArtifacts 然后通过运行./generateArtifacts.sh mychannel 生成channel-artifacts和crypto-config两个文件夹。 二、配置Fabric环境的docker-compose文件 2.1 配置base/docker-compose-base.yaml 修改base/docker-compose-base.yaml，将其修改为4个org的形式： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer environment: - ORDERER_GENERAL_LOGLEVEL=debug - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=true - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ../channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls ports: - 7050:7050 peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org2.example.com - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org3.example.com - CORE_PEER_ADDRESS=peer0.org3.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org3.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org3.example.com:7051 - CORE_PEER_LOCALMSPID=Org3MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org4.example.com: container_name: peer0.org4.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org4.example.com - CORE_PEER_ADDRESS=peer0.org4.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org4.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org4.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org4.example.com:7051 - CORE_PEER_LOCALMSPID=Org4MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 2.2 配置base/peer-base.yaml 再修改base/peer-base.yaml文件，将network的名称修改为与文件夹名称适配的4orgexample_default。 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer-base: image: hyperledger/fabric-peer environment: - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=4orgexample_default #- CORE_LOGGING_LEVEL=ERROR - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_GOSSIP_USELEADERELECTION=true - CORE_PEER_GOSSIP_ORGLEADER=false - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start 2.3 配置orderer和peer 以上操作均在orderer节点上进行，现将orderer节点的4orgexample文件夹打包发送给四个peer节点，并在五个节点上依此新建以下配置文件： orderer节点： docker-compose-orderer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: extends: file: base/docker-compose-base.yaml service: orderer.example.com container_name: orderer.example.com peer0.org1节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: base/docker-compose-base.yaml service: peer0.org1.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org1.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org2节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: base/docker-compose-base.yaml service: peer0.org2.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org2.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org3节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: base/docker-compose-base.yaml service: peer0.org3.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org3.example.com:7051 - CORE_PEER_LOCALMSPID=Org3MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org3.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org4节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org4.example.com: container_name: peer0.org4.example.com extends: file: base/docker-compose-base.yaml service: peer0.org4.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org4.example.com:7051 - CORE_PEER_LOCALMSPID=Org4MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/users/Admin@org4.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org4.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; 至此，一个4个org，每个org拥有一个peer的fabric网络已经配置完毕，篇幅原因，启动该网络的具体操作见下一篇文章。 阅读更多" />
<meta property="og:description" content="本部署基于e2e_cli官方例程，即4Peer+1Orderer的多节点架构，5台主机分别是orderer.example.com、peer0.org1.example.com、peer0.org2.example.com、peer0.org3.example.com、peer0.org4.example.com。 可以首先确保官方提供的2个org，每个组织两个peer的多节点例子能够跑通，具体可参见深蓝或Aberic的博客，再根据两个组织的改成4个组织的。 一、生成公私钥、证书、创世区块和Channel配置区块 角色及id如下： 角色 id orderer.example.com 192.168.3.221 peer0.org1.example.com 192.168.3.222 peer0.org2.example.com 192.168.3.224 peer0.org3.example.com 192.168.3.225 peer0.org4.example.com 192.168.3.228 首先在每个peer节点的机器下复制e2e_cli文件夹，产生新的4orgexample工程目录， root@ubuntu:/opt/gopath/src/github.com/hyperledger/fabric/examples# cp -r e2e_cli 4orgexample 1.1 修改公私钥和证书的配置文件crypto-config.yaml 进入4orgexample目录，首先修改crypto-config.yaml配置文件，将两个org改为四个org，从而生成4个peer和orderer的证书。crypto-config.yaml文件修改如下： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # # --------------------------------------------------------------------------- # &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes # --------------------------------------------------------------------------- OrdererOrgs: # --------------------------------------------------------------------------- # Orderer # --------------------------------------------------------------------------- - Name: Orderer Domain: example.com # --------------------------------------------------------------------------- # &quot;Specs&quot; - See PeerOrgs below for complete description # --------------------------------------------------------------------------- Specs: - Hostname: orderer # --------------------------------------------------------------------------- # &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes # --------------------------------------------------------------------------- PeerOrgs: - Name: Org1 Domain: org1.example.com Template: Count: 1 Users: Count: 1 - Name: Org2 Domain: org2.example.com Template: Count: 1 Users: Count: 1 - Name: Org3 Domain: org3.example.com Template: Count: 1 Users: Count: 1 - Name: Org4 Domain: org4.example.com Template: Count: 1 Users: Count: 1 1.2 修改生成创世区块和Channel配置区块的配置文件configtx.yaml 接着修改configtx.yaml文件，该文件分为几个部分， Profiles: Profiles describe the organizational structure of your network Organizations: The details regarding individual organizations Orderers: The details regarding the Orderer parameters Applications: Application defaults - not needed 具体修改如下： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # --- ################################################################################ # # Profile # # - Different configuration profiles may be encoded here to be specified # as parameters to the configtxgen tool # ################################################################################ Profiles: FourOrgsOrdererGenesis: Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 - *Org3 - *Org4 FourOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 - *Org3 - *Org4 ################################################################################ # # Section: Organizations # # - This section defines the different organizational identities which will # be referenced later in the configuration. # ################################################################################ Organizations: # SampleOrg defines an MSP using the sampleconfig. It should never be used # in production but may be used as a template for other definitions - &amp;OrdererOrg # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: OrdererOrg # ID to load the MSP definition as ID: OrdererMSP # MSPDir is the filesystem path which contains the MSP configuration MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org1MSP # ID to load the MSP definition as ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org2MSP # ID to load the MSP definition as ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org2.example.com Port: 7051 - &amp;Org3 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org3MSP # ID to load the MSP definition as ID: Org3MSP MSPDir: crypto-config/peerOrganizations/org3.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org3.example.com Port: 7051 - &amp;Org4 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org4MSP # ID to load the MSP definition as ID: Org4MSP MSPDir: crypto-config/peerOrganizations/org4.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org4.example.com Port: 7051 ################################################################################ # # SECTION: Orderer # # - This section defines the values to encode into a config transaction or # genesis block for orderer related parameters # ################################################################################ Orderer: &amp;OrdererDefaults # Orderer Type: The orderer implementation to start # Available types are &quot;solo&quot; and &quot;kafka&quot; OrdererType: solo Addresses: - orderer.example.com:7050 # Batch Timeout: The amount of time to wait before creating a batch BatchTimeout: 2s # Batch Size: Controls the number of messages batched into a block BatchSize: # Max Message Count: The maximum number of messages to permit in a batch MaxMessageCount: 10 # Absolute Max Bytes: The absolute maximum number of bytes allowed for # the serialized messages in a batch. AbsoluteMaxBytes: 98 MB # Preferred Max Bytes: The preferred maximum number of bytes allowed for # the serialized messages in a batch. A message larger than the preferred # max bytes will result in a batch larger than preferred max bytes. PreferredMaxBytes: 512 KB Kafka: # Brokers: A list of Kafka brokers to which the orderer connects # NOTE: Use IP:port notation Brokers: - 127.0.0.1:9092 # Organizations is the list of orgs which are defined as participants on # the orderer side of the network Organizations: ################################################################################ # # SECTION: Application # # - This section defines the values to encode into a config transaction or # genesis block for application related parameters # ################################################################################ Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: 1.3 修改运行配置文件的脚本 然后修改generateArtifacts.sh脚本为： #!/bin/bash +x # # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # #set -e CHANNEL_NAME=$1 : ${CHANNEL_NAME:=&quot;mychannel&quot;} echo $CHANNEL_NAME export FABRIC_ROOT=$PWD/../.. export FABRIC_CFG_PATH=$PWD echo OS_ARCH=$(echo &quot;$(uname -s|tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;|sed &#39;s/mingw64_nt.*/windows/&#39;)-$(uname -m | sed &#39;s/x86_64/amd64/g&#39;)&quot; | awk &#39;{print tolower($0)}&#39;) ## Using docker-compose template replace private key file names with constants function replacePrivateKey () { ARCH=`uname -s | grep Darwin` if [ &quot;$ARCH&quot; == &quot;Darwin&quot; ]; then OPTS=&quot;-it&quot; else OPTS=&quot;-i&quot; fi cp docker-compose-e2e-template.yaml docker-compose-e2e.yaml CURRENT_DIR=$PWD cd crypto-config/peerOrganizations/org1.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA1_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org2.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA2_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org3.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA3_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org4.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA4_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml } ## Generates Org certs using cryptogen tool function generateCerts (){ CRYPTOGEN=$FABRIC_ROOT/release/$OS_ARCH/bin/cryptogen if [ -f &quot;$CRYPTOGEN&quot; ]; then echo &quot;Using cryptogen -&gt; $CRYPTOGEN&quot; else echo &quot;Building cryptogen&quot; make -C $FABRIC_ROOT release fi echo echo &quot;##########################################################&quot; echo &quot;##### Generate certificates using cryptogen tool #########&quot; echo &quot;##########################################################&quot; $CRYPTOGEN generate --config=./crypto-config.yaml echo } ## Generate orderer genesis block , channel configuration transaction and anchor peer update transactions function generateChannelArtifacts() { CONFIGTXGEN=$FABRIC_ROOT/release/$OS_ARCH/bin/configtxgen if [ -f &quot;$CONFIGTXGEN&quot; ]; then echo &quot;Using configtxgen -&gt; $CONFIGTXGEN&quot; else echo &quot;Building configtxgen&quot; make -C $FABRIC_ROOT release fi echo &quot;##########################################################&quot; echo &quot;######### Generating Orderer Genesis block ##############&quot; echo &quot;##########################################################&quot; # Note: For some unknown reason (at least for now) the block file can&#39;t be # named orderer.genesis.block or the orderer will fail to launch! $CONFIGTXGEN -profile FourOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block echo echo &quot;#################################################################&quot; echo &quot;### Generating channel configuration transaction &#39;channel.tx&#39; ###&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org1MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org2MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP echo echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org3MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org3MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org3MSP echo echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org4MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org4MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org4MSP echo } generateCerts replacePrivateKey generateChannelArtifacts 然后通过运行./generateArtifacts.sh mychannel 生成channel-artifacts和crypto-config两个文件夹。 二、配置Fabric环境的docker-compose文件 2.1 配置base/docker-compose-base.yaml 修改base/docker-compose-base.yaml，将其修改为4个org的形式： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer environment: - ORDERER_GENERAL_LOGLEVEL=debug - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=true - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ../channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls ports: - 7050:7050 peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org2.example.com - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org3.example.com - CORE_PEER_ADDRESS=peer0.org3.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org3.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org3.example.com:7051 - CORE_PEER_LOCALMSPID=Org3MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org4.example.com: container_name: peer0.org4.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org4.example.com - CORE_PEER_ADDRESS=peer0.org4.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org4.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org4.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org4.example.com:7051 - CORE_PEER_LOCALMSPID=Org4MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 2.2 配置base/peer-base.yaml 再修改base/peer-base.yaml文件，将network的名称修改为与文件夹名称适配的4orgexample_default。 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer-base: image: hyperledger/fabric-peer environment: - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=4orgexample_default #- CORE_LOGGING_LEVEL=ERROR - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_GOSSIP_USELEADERELECTION=true - CORE_PEER_GOSSIP_ORGLEADER=false - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start 2.3 配置orderer和peer 以上操作均在orderer节点上进行，现将orderer节点的4orgexample文件夹打包发送给四个peer节点，并在五个节点上依此新建以下配置文件： orderer节点： docker-compose-orderer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: extends: file: base/docker-compose-base.yaml service: orderer.example.com container_name: orderer.example.com peer0.org1节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: base/docker-compose-base.yaml service: peer0.org1.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org1.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org2节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: base/docker-compose-base.yaml service: peer0.org2.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org2.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org3节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: base/docker-compose-base.yaml service: peer0.org3.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org3.example.com:7051 - CORE_PEER_LOCALMSPID=Org3MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org3.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org4节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org4.example.com: container_name: peer0.org4.example.com extends: file: base/docker-compose-base.yaml service: peer0.org4.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org4.example.com:7051 - CORE_PEER_LOCALMSPID=Org4MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/users/Admin@org4.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org4.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; 至此，一个4个org，每个org拥有一个peer的fabric网络已经配置完毕，篇幅原因，启动该网络的具体操作见下一篇文章。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/06/06/5158e2103a980b60434ba792d6324d6a.html" />
<meta property="og:url" content="https://mlh.app/2018/06/06/5158e2103a980b60434ba792d6324d6a.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-06T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"本部署基于e2e_cli官方例程，即4Peer+1Orderer的多节点架构，5台主机分别是orderer.example.com、peer0.org1.example.com、peer0.org2.example.com、peer0.org3.example.com、peer0.org4.example.com。 可以首先确保官方提供的2个org，每个组织两个peer的多节点例子能够跑通，具体可参见深蓝或Aberic的博客，再根据两个组织的改成4个组织的。 一、生成公私钥、证书、创世区块和Channel配置区块 角色及id如下： 角色 id orderer.example.com 192.168.3.221 peer0.org1.example.com 192.168.3.222 peer0.org2.example.com 192.168.3.224 peer0.org3.example.com 192.168.3.225 peer0.org4.example.com 192.168.3.228 首先在每个peer节点的机器下复制e2e_cli文件夹，产生新的4orgexample工程目录， root@ubuntu:/opt/gopath/src/github.com/hyperledger/fabric/examples# cp -r e2e_cli 4orgexample 1.1 修改公私钥和证书的配置文件crypto-config.yaml 进入4orgexample目录，首先修改crypto-config.yaml配置文件，将两个org改为四个org，从而生成4个peer和orderer的证书。crypto-config.yaml文件修改如下： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # # --------------------------------------------------------------------------- # &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes # --------------------------------------------------------------------------- OrdererOrgs: # --------------------------------------------------------------------------- # Orderer # --------------------------------------------------------------------------- - Name: Orderer Domain: example.com # --------------------------------------------------------------------------- # &quot;Specs&quot; - See PeerOrgs below for complete description # --------------------------------------------------------------------------- Specs: - Hostname: orderer # --------------------------------------------------------------------------- # &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes # --------------------------------------------------------------------------- PeerOrgs: - Name: Org1 Domain: org1.example.com Template: Count: 1 Users: Count: 1 - Name: Org2 Domain: org2.example.com Template: Count: 1 Users: Count: 1 - Name: Org3 Domain: org3.example.com Template: Count: 1 Users: Count: 1 - Name: Org4 Domain: org4.example.com Template: Count: 1 Users: Count: 1 1.2 修改生成创世区块和Channel配置区块的配置文件configtx.yaml 接着修改configtx.yaml文件，该文件分为几个部分， Profiles: Profiles describe the organizational structure of your network Organizations: The details regarding individual organizations Orderers: The details regarding the Orderer parameters Applications: Application defaults - not needed 具体修改如下： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # --- ################################################################################ # # Profile # # - Different configuration profiles may be encoded here to be specified # as parameters to the configtxgen tool # ################################################################################ Profiles: FourOrgsOrdererGenesis: Orderer: &lt;&lt;: *OrdererDefaults Organizations: - *OrdererOrg Consortiums: SampleConsortium: Organizations: - *Org1 - *Org2 - *Org3 - *Org4 FourOrgsChannel: Consortium: SampleConsortium Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 - *Org3 - *Org4 ################################################################################ # # Section: Organizations # # - This section defines the different organizational identities which will # be referenced later in the configuration. # ################################################################################ Organizations: # SampleOrg defines an MSP using the sampleconfig. It should never be used # in production but may be used as a template for other definitions - &amp;OrdererOrg # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: OrdererOrg # ID to load the MSP definition as ID: OrdererMSP # MSPDir is the filesystem path which contains the MSP configuration MSPDir: crypto-config/ordererOrganizations/example.com/msp - &amp;Org1 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org1MSP # ID to load the MSP definition as ID: Org1MSP MSPDir: crypto-config/peerOrganizations/org1.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org1.example.com Port: 7051 - &amp;Org2 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org2MSP # ID to load the MSP definition as ID: Org2MSP MSPDir: crypto-config/peerOrganizations/org2.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org2.example.com Port: 7051 - &amp;Org3 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org3MSP # ID to load the MSP definition as ID: Org3MSP MSPDir: crypto-config/peerOrganizations/org3.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org3.example.com Port: 7051 - &amp;Org4 # DefaultOrg defines the organization which is used in the sampleconfig # of the fabric.git development environment Name: Org4MSP # ID to load the MSP definition as ID: Org4MSP MSPDir: crypto-config/peerOrganizations/org4.example.com/msp AnchorPeers: # AnchorPeers defines the location of peers which can be used # for cross org gossip communication. Note, this value is only # encoded in the genesis block in the Application section context - Host: peer0.org4.example.com Port: 7051 ################################################################################ # # SECTION: Orderer # # - This section defines the values to encode into a config transaction or # genesis block for orderer related parameters # ################################################################################ Orderer: &amp;OrdererDefaults # Orderer Type: The orderer implementation to start # Available types are &quot;solo&quot; and &quot;kafka&quot; OrdererType: solo Addresses: - orderer.example.com:7050 # Batch Timeout: The amount of time to wait before creating a batch BatchTimeout: 2s # Batch Size: Controls the number of messages batched into a block BatchSize: # Max Message Count: The maximum number of messages to permit in a batch MaxMessageCount: 10 # Absolute Max Bytes: The absolute maximum number of bytes allowed for # the serialized messages in a batch. AbsoluteMaxBytes: 98 MB # Preferred Max Bytes: The preferred maximum number of bytes allowed for # the serialized messages in a batch. A message larger than the preferred # max bytes will result in a batch larger than preferred max bytes. PreferredMaxBytes: 512 KB Kafka: # Brokers: A list of Kafka brokers to which the orderer connects # NOTE: Use IP:port notation Brokers: - 127.0.0.1:9092 # Organizations is the list of orgs which are defined as participants on # the orderer side of the network Organizations: ################################################################################ # # SECTION: Application # # - This section defines the values to encode into a config transaction or # genesis block for application related parameters # ################################################################################ Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: 1.3 修改运行配置文件的脚本 然后修改generateArtifacts.sh脚本为： #!/bin/bash +x # # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # #set -e CHANNEL_NAME=$1 : ${CHANNEL_NAME:=&quot;mychannel&quot;} echo $CHANNEL_NAME export FABRIC_ROOT=$PWD/../.. export FABRIC_CFG_PATH=$PWD echo OS_ARCH=$(echo &quot;$(uname -s|tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;|sed &#39;s/mingw64_nt.*/windows/&#39;)-$(uname -m | sed &#39;s/x86_64/amd64/g&#39;)&quot; | awk &#39;{print tolower($0)}&#39;) ## Using docker-compose template replace private key file names with constants function replacePrivateKey () { ARCH=`uname -s | grep Darwin` if [ &quot;$ARCH&quot; == &quot;Darwin&quot; ]; then OPTS=&quot;-it&quot; else OPTS=&quot;-i&quot; fi cp docker-compose-e2e-template.yaml docker-compose-e2e.yaml CURRENT_DIR=$PWD cd crypto-config/peerOrganizations/org1.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA1_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org2.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA2_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org3.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA3_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml cd crypto-config/peerOrganizations/org4.example.com/ca/ PRIV_KEY=$(ls *_sk) cd $CURRENT_DIR sed $OPTS &quot;s/CA4_PRIVATE_KEY/${PRIV_KEY}/g&quot; docker-compose-e2e.yaml } ## Generates Org certs using cryptogen tool function generateCerts (){ CRYPTOGEN=$FABRIC_ROOT/release/$OS_ARCH/bin/cryptogen if [ -f &quot;$CRYPTOGEN&quot; ]; then echo &quot;Using cryptogen -&gt; $CRYPTOGEN&quot; else echo &quot;Building cryptogen&quot; make -C $FABRIC_ROOT release fi echo echo &quot;##########################################################&quot; echo &quot;##### Generate certificates using cryptogen tool #########&quot; echo &quot;##########################################################&quot; $CRYPTOGEN generate --config=./crypto-config.yaml echo } ## Generate orderer genesis block , channel configuration transaction and anchor peer update transactions function generateChannelArtifacts() { CONFIGTXGEN=$FABRIC_ROOT/release/$OS_ARCH/bin/configtxgen if [ -f &quot;$CONFIGTXGEN&quot; ]; then echo &quot;Using configtxgen -&gt; $CONFIGTXGEN&quot; else echo &quot;Building configtxgen&quot; make -C $FABRIC_ROOT release fi echo &quot;##########################################################&quot; echo &quot;######### Generating Orderer Genesis block ##############&quot; echo &quot;##########################################################&quot; # Note: For some unknown reason (at least for now) the block file can&#39;t be # named orderer.genesis.block or the orderer will fail to launch! $CONFIGTXGEN -profile FourOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block echo echo &quot;#################################################################&quot; echo &quot;### Generating channel configuration transaction &#39;channel.tx&#39; ###&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org1MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org2MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP echo echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org3MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org3MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org3MSP echo echo echo &quot;#################################################################&quot; echo &quot;####### Generating anchor peer update for Org4MSP ##########&quot; echo &quot;#################################################################&quot; $CONFIGTXGEN -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org4MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org4MSP echo } generateCerts replacePrivateKey generateChannelArtifacts 然后通过运行./generateArtifacts.sh mychannel 生成channel-artifacts和crypto-config两个文件夹。 二、配置Fabric环境的docker-compose文件 2.1 配置base/docker-compose-base.yaml 修改base/docker-compose-base.yaml，将其修改为4个org的形式： # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: container_name: orderer.example.com image: hyperledger/fabric-orderer environment: - ORDERER_GENERAL_LOGLEVEL=debug - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=true - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ../channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls ports: - 7050:7050 peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org1.example.com - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org2.example.com - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org3.example.com - CORE_PEER_ADDRESS=peer0.org3.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org3.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org3.example.com:7051 - CORE_PEER_LOCALMSPID=Org3MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 peer0.org4.example.com: container_name: peer0.org4.example.com extends: file: peer-base.yaml service: peer-base environment: - CORE_PEER_ID=peer0.org4.example.com - CORE_PEER_ADDRESS=peer0.org4.example.com:7051 - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org4.example.com:7052 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org4.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org4.example.com:7051 - CORE_PEER_LOCALMSPID=Org4MSP volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/msp:/etc/hyperledger/fabric/msp - ../crypto-config/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls:/etc/hyperledger/fabric/tls ports: - 7051:7051 - 7052:7052 - 7053:7053 2.2 配置base/peer-base.yaml 再修改base/peer-base.yaml文件，将network的名称修改为与文件夹名称适配的4orgexample_default。 # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer-base: image: hyperledger/fabric-peer environment: - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=4orgexample_default #- CORE_LOGGING_LEVEL=ERROR - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_GOSSIP_USELEADERELECTION=true - CORE_PEER_GOSSIP_ORGLEADER=false - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start 2.3 配置orderer和peer 以上操作均在orderer节点上进行，现将orderer节点的4orgexample文件夹打包发送给四个peer节点，并在五个节点上依此新建以下配置文件： orderer节点： docker-compose-orderer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: orderer.example.com: extends: file: base/docker-compose-base.yaml service: orderer.example.com container_name: orderer.example.com peer0.org1节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org1.example.com: container_name: peer0.org1.example.com extends: file: base/docker-compose-base.yaml service: peer0.org1.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org1.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org2节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org2.example.com: container_name: peer0.org2.example.com extends: file: base/docker-compose-base.yaml service: peer0.org2.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org2.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org3节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org3.example.com: container_name: peer0.org3.example.com extends: file: base/docker-compose-base.yaml service: peer0.org3.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org3.example.com:7051 - CORE_PEER_LOCALMSPID=Org3MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org3.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; peer0.org4节点： docker-compose-peer.yaml # Copyright IBM Corp. All Rights Reserved. # # SPDX-License-Identifier: Apache-2.0 # version: &#39;2&#39; services: peer0.org4.example.com: container_name: peer0.org4.example.com extends: file: base/docker-compose-base.yaml service: peer0.org4.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; cli: container_name: cli image: hyperledger/fabric-tools tty: true environment: - GOPATH=/opt/gopath - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock - CORE_LOGGING_LEVEL=DEBUG - CORE_PEER_ID=cli - CORE_PEER_ADDRESS=peer0.org4.example.com:7051 - CORE_PEER_LOCALMSPID=Org4MSP - CORE_PEER_TLS_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer0.org4.example.com/tls/ca.crt - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/users/Admin@org4.example.com/msp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer volumes: - /var/run/:/host/var/run/ - ../chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts depends_on: - peer0.org4.example.com extra_hosts: - &quot;orderer.example.com:192.168.3.221&quot; - &quot;peer0.org1.example.com:192.168.3.222&quot; - &quot;peer0.org2.example.com:192.168.3.224&quot; - &quot;peer0.org3.example.com:192.168.3.225&quot; - &quot;peer0.org4.example.com:192.168.3.228&quot; 至此，一个4个org，每个org拥有一个peer的fabric网络已经配置完毕，篇幅原因，启动该网络的具体操作见下一篇文章。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/06/06/5158e2103a980b60434ba792d6324d6a.html","headline":"多机上部署多个组织（4org）的fabric网络","dateModified":"2018-06-06T00:00:00+08:00","datePublished":"2018-06-06T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/06/06/5158e2103a980b60434ba792d6324d6a.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>多机上部署多个组织（4org）的fabric网络</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>本部署基于e2e_cli官方例程，即4Peer+1Orderer的多节点架构，5台主机分别是orderer.example.com、peer0.org1.example.com、peer0.org2.example.com、peer0.org3.example.com、peer0.org4.example.com。 <br> 可以首先确保官方提供的2个org，每个组织两个peer的多节点例子能够跑通，具体可参见深蓝或Aberic的博客，再根据两个组织的改成4个组织的。</p> 
  <h2 id="一生成公私钥证书创世区块和channel配置区块">一、生成公私钥、证书、创世区块和Channel配置区块</h2> 
  <p>角色及id如下：</p> 
  <table> 
   <thead> 
    <tr> 
     <th>角色</th> 
     <th>id</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td>orderer.example.com</td> 
     <td>192.168.3.221</td> 
    </tr> 
    <tr> 
     <td>peer0.org1.example.com</td> 
     <td>192.168.3.222</td> 
    </tr> 
    <tr> 
     <td>peer0.org2.example.com</td> 
     <td>192.168.3.224</td> 
    </tr> 
    <tr> 
     <td>peer0.org3.example.com</td> 
     <td>192.168.3.225</td> 
    </tr> 
    <tr> 
     <td>peer0.org4.example.com</td> 
     <td>192.168.3.228</td> 
    </tr> 
   </tbody>
  </table> 
  <p>首先在每个peer节点的机器下复制e2e_cli文件夹，产生新的4orgexample工程目录，</p> 
  <pre class="prettyprint"><code class=" hljs ruby">root<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/examples<span class="hljs-comment"># cp -r e2e_cli 4orgexample</span></code></pre> 
  <h3 id="11-修改公私钥和证书的配置文件crypto-configyaml">1.1 修改公私钥和证书的配置文件crypto-config.yaml</h3> 
  <p>进入4orgexample目录，首先修改crypto-config.yaml配置文件，将两个org改为四个org，从而生成4个peer和orderer的证书。crypto-config.yaml文件修改如下：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># Copyright IBM Corp. All Rights Reserved.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># SPDX-License-Identifier: Apache-2.0</span>
<span class="hljs-preprocessor">#</span>

<span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
<span class="hljs-preprocessor"># "OrdererOrgs" - Definition of organizations managing orderer nodes</span>
<span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
<span class="hljs-label">OrdererOrgs:</span>
  <span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
  <span class="hljs-preprocessor"># Orderer</span>
  <span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
  - Name: Orderer
    Domain: example<span class="hljs-preprocessor">.com</span>
    <span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
    <span class="hljs-preprocessor"># "Specs" - See PeerOrgs below for complete description</span>
    <span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
    Specs:
      - Hostname: orderer
<span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
<span class="hljs-preprocessor"># "PeerOrgs" - Definition of organizations managing peer nodes</span>
<span class="hljs-preprocessor"># ---------------------------------------------------------------------------</span>
<span class="hljs-label">PeerOrgs:</span>

  - Name: Org1
    Domain: org1<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>
    Template:
      Count: <span class="hljs-number">1</span>
    Users:
      Count: <span class="hljs-number">1</span>

  - Name: Org2
    Domain: org2<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>
    Template:
      Count: <span class="hljs-number">1</span>
    Users:
      Count: <span class="hljs-number">1</span>
  - Name: Org3
    Domain: org3<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>
    Template:
      Count: <span class="hljs-number">1</span>
    Users:
      Count: <span class="hljs-number">1</span>
  - Name: Org4
    Domain: org4<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>
    Template: 
      Count: <span class="hljs-number">1</span>
    Users:
      Count: <span class="hljs-number">1</span>
</code></pre> 
  <h3 id="12-修改生成创世区块和channel配置区块的配置文件configtxyaml">1.2 修改生成创世区块和Channel配置区块的配置文件configtx.yaml</h3> 
  <p>接着修改configtx.yaml文件，该文件分为几个部分，</p> 
  <blockquote> 
   <p>Profiles: Profiles describe the organizational structure of your network <br> Organizations: The details regarding individual organizations <br> Orderers: The details regarding the Orderer parameters <br> Applications: Application defaults - not needed </p> 
  </blockquote> 
  <p>具体修改如下：</p> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span>
<span class="hljs-comment">#</span>

---
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Profile</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - Different configuration profiles may be encoded here to be specified</span>
<span class="hljs-comment"># as parameters to the configtxgen tool</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Profiles</span>:

    <span class="hljs-attribute">FourOrgsOrdererGenesis</span>:
        <span class="hljs-attribute">Orderer</span>:
            &lt;&lt;: *OrdererDefaults
            <span class="hljs-attribute">Organizations</span>:
                - *OrdererOrg
        <span class="hljs-attribute">Consortiums</span>:
            <span class="hljs-attribute">SampleConsortium</span>:
                <span class="hljs-attribute">Organizations</span>:
                    - *Org1
                    - *Org2
                    - *Org3
                    - *Org4
    <span class="hljs-attribute">FourOrgsChannel</span>:
        <span class="hljs-attribute">Consortium</span>: SampleConsortium
        <span class="hljs-attribute">Application</span>:
            &lt;&lt;: *ApplicationDefaults
            <span class="hljs-attribute">Organizations</span>:
                - *Org1
                - *Org2
                - *Org3
                - *Org4

<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Section: Organizations</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the different organizational identities which will</span>
<span class="hljs-comment"># be referenced later in the configuration.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Organizations</span>:

    <span class="hljs-comment"># SampleOrg defines an MSP using the sampleconfig. It should never be used</span>
    <span class="hljs-comment"># in production but may be used as a template for other definitions</span>
    - &amp;OrdererOrg
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: OrdererOrg

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: OrdererMSP

        <span class="hljs-comment"># MSPDir is the filesystem path which contains the MSP configuration</span>
        <span class="hljs-attribute">MSPDir</span>: crypto-config/ordererOrganizations/example.com/msp

    - &amp;Org1
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: Org1MSP

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: Org1MSP

        <span class="hljs-attribute">MSPDir</span>: crypto-config/peerOrganizations/org1.example.com/msp

        <span class="hljs-attribute">AnchorPeers</span>:
            <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used</span>
            <span class="hljs-comment"># for cross org gossip communication. Note, this value is only</span>
            <span class="hljs-comment"># encoded in the genesis block in the Application section context</span>
            - <span class="hljs-attribute">Host</span>: peer0.org1.example.com
              <span class="hljs-attribute">Port</span>: <span class="hljs-number">7051</span>

    - &amp;Org2
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: Org2MSP

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: Org2MSP

        <span class="hljs-attribute">MSPDir</span>: crypto-config/peerOrganizations/org2.example.com/msp

        <span class="hljs-attribute">AnchorPeers</span>:
            <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used</span>
            <span class="hljs-comment"># for cross org gossip communication. Note, this value is only</span>
            <span class="hljs-comment"># encoded in the genesis block in the Application section context</span>
            - <span class="hljs-attribute">Host</span>: peer0.org2.example.com
              <span class="hljs-attribute">Port</span>: <span class="hljs-number">7051</span>
    - &amp;Org3
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: Org3MSP

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: Org3MSP

        <span class="hljs-attribute">MSPDir</span>: crypto-config/peerOrganizations/org3.example.com/msp

        <span class="hljs-attribute">AnchorPeers</span>:
            <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used</span>
            <span class="hljs-comment"># for cross org gossip communication. Note, this value is only</span>
            <span class="hljs-comment"># encoded in the genesis block in the Application section context</span>
            - <span class="hljs-attribute">Host</span>: peer0.org3.example.com
              <span class="hljs-attribute">Port</span>: <span class="hljs-number">7051</span>

    - &amp;Org4
        <span class="hljs-comment"># DefaultOrg defines the organization which is used in the sampleconfig</span>
        <span class="hljs-comment"># of the fabric.git development environment</span>
        <span class="hljs-attribute">Name</span>: Org4MSP

        <span class="hljs-comment"># ID to load the MSP definition as</span>
        <span class="hljs-attribute">ID</span>: Org4MSP

        <span class="hljs-attribute">MSPDir</span>: crypto-config/peerOrganizations/org4.example.com/msp

        <span class="hljs-attribute">AnchorPeers</span>:
            <span class="hljs-comment"># AnchorPeers defines the location of peers which can be used</span>
            <span class="hljs-comment"># for cross org gossip communication. Note, this value is only</span>
            <span class="hljs-comment"># encoded in the genesis block in the Application section context</span>
            - <span class="hljs-attribute">Host</span>: peer0.org4.example.com
              <span class="hljs-attribute">Port</span>: <span class="hljs-number">7051</span>


<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SECTION: Orderer</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the values to encode into a config transaction or</span>
<span class="hljs-comment"># genesis block for orderer related parameters</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Orderer</span>: &amp;OrdererDefaults

    <span class="hljs-comment"># Orderer Type: The orderer implementation to start</span>
    <span class="hljs-comment"># Available types are "solo" and "kafka"</span>
    <span class="hljs-attribute">OrdererType</span>: solo

    <span class="hljs-attribute">Addresses</span>:
        - orderer.example.<span class="hljs-attribute">com</span>:<span class="hljs-number">7050</span>

    <span class="hljs-comment"># Batch Timeout: The amount of time to wait before creating a batch</span>
    <span class="hljs-attribute">BatchTimeout</span>: <span class="hljs-number">2</span>s

    <span class="hljs-comment"># Batch Size: Controls the number of messages batched into a block</span>
    <span class="hljs-attribute">BatchSize</span>:

        <span class="hljs-comment"># Max Message Count: The maximum number of messages to permit in a batch</span>
        <span class="hljs-attribute">MaxMessageCount</span>: <span class="hljs-number">10</span>

        <span class="hljs-comment"># Absolute Max Bytes: The absolute maximum number of bytes allowed for</span>
        <span class="hljs-comment"># the serialized messages in a batch.</span>
        <span class="hljs-attribute">AbsoluteMaxBytes</span>: <span class="hljs-number">98</span> MB

        <span class="hljs-comment"># Preferred Max Bytes: The preferred maximum number of bytes allowed for</span>
        <span class="hljs-comment"># the serialized messages in a batch. A message larger than the preferred</span>
        <span class="hljs-comment"># max bytes will result in a batch larger than preferred max bytes.</span>
        <span class="hljs-attribute">PreferredMaxBytes</span>: <span class="hljs-number">512</span> KB

    <span class="hljs-attribute">Kafka</span>:
        <span class="hljs-comment"># Brokers: A list of Kafka brokers to which the orderer connects</span>
        <span class="hljs-comment"># NOTE: Use IP:port notation</span>
        <span class="hljs-attribute">Brokers</span>:
            - <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">9092</span>

    <span class="hljs-comment"># Organizations is the list of orgs which are defined as participants on</span>
    <span class="hljs-comment"># the orderer side of the network</span>
    <span class="hljs-attribute">Organizations</span>:

<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SECTION: Application</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># - This section defines the values to encode into a config transaction or</span>
<span class="hljs-comment"># genesis block for application related parameters</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">######</span><span class="hljs-comment">##</span>
<span class="hljs-attribute">Application</span>: &amp;ApplicationDefaults

    <span class="hljs-comment"># Organizations is the list of orgs which are defined as participants on</span>
    <span class="hljs-comment"># the application side of the network</span>
    <span class="hljs-attribute">Organizations</span>:
</code></pre> 
  <h3 id="13-修改运行配置文件的脚本">1.3 修改运行配置文件的脚本</h3> 
  <p>然后修改generateArtifacts.sh脚本为：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-comment">#!/bin/bash +x</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Copyright IBM Corp. All Rights Reserved.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># SPDX-License-Identifier: Apache-2.0</span>
<span class="hljs-comment">#</span>


<span class="hljs-comment">#set -e</span>

CHANNEL_NAME=<span class="hljs-variable">$1</span>
: <span class="hljs-variable">${CHANNEL_NAME:="mychannel"}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$CHANNEL_NAME</span>

<span class="hljs-keyword">export</span> FABRIC_ROOT=<span class="hljs-variable">$PWD</span>/../..
<span class="hljs-keyword">export</span> FABRIC_CFG_PATH=<span class="hljs-variable">$PWD</span>
<span class="hljs-built_in">echo</span>

OS_ARCH=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$(uname -s|tr '[:upper:]' '[:lower:]'|sed 's/mingw64_nt.*/windows/')</span>-<span class="hljs-variable">$(uname -m | sed 's/x86_64/amd64/g')</span>"</span> | awk <span class="hljs-string">'{print tolower($0)}'</span>)

<span class="hljs-comment">## Using docker-compose template replace private key file names with constants</span>
function <span class="hljs-function"><span class="hljs-title">replacePrivateKey</span></span> () {
    ARCH=`uname <span class="hljs-operator">-s</span> | grep Darwin`
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$ARCH</span>"</span> == <span class="hljs-string">"Darwin"</span> ]; <span class="hljs-keyword">then</span>
        OPTS=<span class="hljs-string">"-it"</span>
    <span class="hljs-keyword">else</span>
        OPTS=<span class="hljs-string">"-i"</span>
    <span class="hljs-keyword">fi</span>

    cp docker-compose<span class="hljs-operator">-e</span>2e-template.yaml docker-compose<span class="hljs-operator">-e</span>2e.yaml

        CURRENT_DIR=<span class="hljs-variable">$PWD</span>
        <span class="hljs-built_in">cd</span> crypto-config/peerOrganizations/org1.example.com/ca/
        PRIV_KEY=$(ls *_sk)
        <span class="hljs-built_in">cd</span> <span class="hljs-variable">$CURRENT_DIR</span>
        sed <span class="hljs-variable">$OPTS</span> <span class="hljs-string">"s/CA1_PRIVATE_KEY/<span class="hljs-variable">${PRIV_KEY}</span>/g"</span> docker-compose<span class="hljs-operator">-e</span>2e.yaml
        <span class="hljs-built_in">cd</span> crypto-config/peerOrganizations/org2.example.com/ca/
        PRIV_KEY=$(ls *_sk)
        <span class="hljs-built_in">cd</span> <span class="hljs-variable">$CURRENT_DIR</span>
        sed <span class="hljs-variable">$OPTS</span> <span class="hljs-string">"s/CA2_PRIVATE_KEY/<span class="hljs-variable">${PRIV_KEY}</span>/g"</span> docker-compose<span class="hljs-operator">-e</span>2e.yaml
        <span class="hljs-built_in">cd</span> crypto-config/peerOrganizations/org3.example.com/ca/
        PRIV_KEY=$(ls *_sk)
        <span class="hljs-built_in">cd</span> <span class="hljs-variable">$CURRENT_DIR</span>
        sed <span class="hljs-variable">$OPTS</span> <span class="hljs-string">"s/CA3_PRIVATE_KEY/<span class="hljs-variable">${PRIV_KEY}</span>/g"</span> docker-compose<span class="hljs-operator">-e</span>2e.yaml
        <span class="hljs-built_in">cd</span> crypto-config/peerOrganizations/org4.example.com/ca/
        PRIV_KEY=$(ls *_sk)
        <span class="hljs-built_in">cd</span> <span class="hljs-variable">$CURRENT_DIR</span>
        sed <span class="hljs-variable">$OPTS</span> <span class="hljs-string">"s/CA4_PRIVATE_KEY/<span class="hljs-variable">${PRIV_KEY}</span>/g"</span> docker-compose<span class="hljs-operator">-e</span>2e.yaml

}

<span class="hljs-comment">## Generates Org certs using cryptogen tool</span>
function <span class="hljs-function"><span class="hljs-title">generateCerts</span></span> (){
    CRYPTOGEN=<span class="hljs-variable">$FABRIC_ROOT</span>/release/<span class="hljs-variable">$OS_ARCH</span>/bin/cryptogen

    <span class="hljs-keyword">if</span> [ <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$CRYPTOGEN</span>"</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"Using cryptogen -&gt; <span class="hljs-variable">$CRYPTOGEN</span>"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Building cryptogen"</span>
        make -C <span class="hljs-variable">$FABRIC_ROOT</span> release
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"##########################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"##### Generate certificates using cryptogen tool #########"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"##########################################################"</span>
    <span class="hljs-variable">$CRYPTOGEN</span> generate --config=./crypto-config.yaml
    <span class="hljs-built_in">echo</span>
}

<span class="hljs-comment">## Generate orderer genesis block , channel configuration transaction and anchor peer update transactions</span>
function <span class="hljs-function"><span class="hljs-title">generateChannelArtifacts</span></span>() {

    CONFIGTXGEN=<span class="hljs-variable">$FABRIC_ROOT</span>/release/<span class="hljs-variable">$OS_ARCH</span>/bin/configtxgen
    <span class="hljs-keyword">if</span> [ <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$CONFIGTXGEN</span>"</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"Using configtxgen -&gt; <span class="hljs-variable">$CONFIGTXGEN</span>"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Building configtxgen"</span>
        make -C <span class="hljs-variable">$FABRIC_ROOT</span> release
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"##########################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"######### Generating Orderer Genesis block ##############"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"##########################################################"</span>
    <span class="hljs-comment"># Note: For some unknown reason (at least for now) the block file can't be</span>
    <span class="hljs-comment"># named orderer.genesis.block or the orderer will fail to launch!</span>
    <span class="hljs-variable">$CONFIGTXGEN</span> -profile FourOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block

    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"### Generating channel configuration transaction 'channel.tx' ###"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-variable">$CONFIGTXGEN</span> -profile FourOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID <span class="hljs-variable">$CHANNEL_NAME</span>

    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"####### Generating anchor peer update for Org1MSP ##########"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-variable">$CONFIGTXGEN</span> -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID <span class="hljs-variable">$CHANNEL_NAME</span> -asOrg Org1MSP

    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"####### Generating anchor peer update for Org2MSP ##########"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-variable">$CONFIGTXGEN</span> -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID <span class="hljs-variable">$CHANNEL_NAME</span> -asOrg Org2MSP
    <span class="hljs-built_in">echo</span>

    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"####### Generating anchor peer update for Org3MSP ##########"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-variable">$CONFIGTXGEN</span> -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org3MSPanchors.tx -channelID <span class="hljs-variable">$CHANNEL_NAME</span> -asOrg Org3MSP
    <span class="hljs-built_in">echo</span>

    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"####### Generating anchor peer update for Org4MSP ##########"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"#################################################################"</span>
    <span class="hljs-variable">$CONFIGTXGEN</span> -profile FourOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org4MSPanchors.tx -channelID <span class="hljs-variable">$CHANNEL_NAME</span> -asOrg Org4MSP
    <span class="hljs-built_in">echo</span>
}

generateCerts
replacePrivateKey
generateChannelArtifacts

</code></pre> 
  <p>然后通过运行<code>./generateArtifacts.sh mychannel</code> 生成channel-artifacts和crypto-config两个文件夹。</p> 
  <h2 id="二配置fabric环境的docker-compose文件">二、配置Fabric环境的docker-compose文件</h2> 
  <h3 id="21-配置basedocker-compose-baseyaml">2.1 配置base/docker-compose-base.yaml</h3> 
  <p>修改base/docker-compose-base.yaml，将其修改为4个org的形式：</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  orderer.example.com:
    container_name: orderer.example.com
    image: hyperledger/fabric-orderer
    environment:
      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LOGLEVEL</span>=debug </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LISTENADDRESS</span>=<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_GENESISMETHOD</span>=file </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_GENESISFILE</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/orderer</span>.genesis.block </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LOCALMSPID</span>=<span class="hljs-constant">OrdererMSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_LOCALMSPDIR</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/msp</span> </span>      # enabled TLS
      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_PRIVATEKEY</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/tls</span><span class="hljs-regexp">/server.key </span></span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_CERTIFICATE</span>=<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/tls</span><span class="hljs-regexp">/server.crt </span></span>      -<span class="ruby"> <span class="hljs-constant">ORDERER_GENERAL_TLS_ROOTCAS</span>=[<span class="hljs-regexp">/var/hyperledger</span><span class="hljs-regexp">/orderer/tls</span><span class="hljs-regexp">/ca.crt] </span></span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric
    command: orderer
    volumes:
    -<span class="ruby"> ../channel-artifacts/genesis.<span class="hljs-symbol">block:</span>/var/hyperledger/orderer/orderer.genesis.block </span>    -<span class="ruby"> ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/<span class="hljs-symbol">msp:</span>/var/hyperledger/orderer/msp </span>    -<span class="ruby"> ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/<span class="hljs-symbol">:/var/hyperledger/orderer/tls</span> </span>    ports:
      -<span class="ruby"> <span class="hljs-number">7050</span><span class="hljs-symbol">:</span><span class="hljs-number">7050</span> </span>
  peer0.org1.example.com:
    container_name: peer0.org1.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=peer<span class="hljs-number">0</span>.org1.example.com </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_CHAINCODELISTENADDRESS</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_EXTERNALENDPOINT</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org1MSP</span> </span>    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls </span>    ports:
      -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-number">7053</span><span class="hljs-symbol">:</span><span class="hljs-number">7053</span> </span>
  peer0.org2.example.com:
    container_name: peer0.org2.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=peer<span class="hljs-number">0</span>.org2.example.com </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_CHAINCODELISTENADDRESS</span>=peer<span class="hljs-number">0</span>.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_EXTERNALENDPOINT</span>=peer<span class="hljs-number">0</span>.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_BOOTSTRAP</span>=peer<span class="hljs-number">0</span>.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org2MSP</span> </span>    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org2.example.com/peers/peer<span class="hljs-number">0</span>.org2.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org2.example.com/peers/peer<span class="hljs-number">0</span>.org2.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls </span>
    ports:
      -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-number">7053</span><span class="hljs-symbol">:</span><span class="hljs-number">7053</span> </span>
  peer0.org3.example.com:
    container_name: peer0.org3.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=peer<span class="hljs-number">0</span>.org3.example.com </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org3.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_CHAINCODELISTENADDRESS</span>=peer<span class="hljs-number">0</span>.org3.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_EXTERNALENDPOINT</span>=peer<span class="hljs-number">0</span>.org3.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org3MSP</span> </span>    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org3.example.com/peers/peer<span class="hljs-number">0</span>.org3.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org3.example.com/peers/peer<span class="hljs-number">0</span>.org3.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls </span>    ports:
      -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-number">7053</span><span class="hljs-symbol">:</span><span class="hljs-number">7053</span> </span>
  peer0.org4.example.com:
    container_name: peer0.org4.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=peer<span class="hljs-number">0</span>.org4.example.com </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org4.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_CHAINCODELISTENADDRESS</span>=peer<span class="hljs-number">0</span>.org4.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_EXTERNALENDPOINT</span>=peer<span class="hljs-number">0</span>.org4.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_BOOTSTRAP</span>=peer<span class="hljs-number">0</span>.org4.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org4MSP</span> </span>    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org4.example.com/peers/peer<span class="hljs-number">0</span>.org4.example.com/<span class="hljs-symbol">msp:</span>/etc/hyperledger/fabric/msp </span>        -<span class="ruby"> ../crypto-config/peerOrganizations/org4.example.com/peers/peer<span class="hljs-number">0</span>.org4.example.com/<span class="hljs-symbol">tls:</span>/etc/hyperledger/fabric/tls </span>    ports:
      -<span class="ruby"> <span class="hljs-number">7051</span><span class="hljs-symbol">:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-number">7052</span><span class="hljs-symbol">:</span><span class="hljs-number">7052</span> </span>      -<span class="ruby"> <span class="hljs-number">7053</span><span class="hljs-symbol">:</span><span class="hljs-number">7053</span> </span></code></pre> 
  <h3 id="22-配置basepeer-baseyaml">2.2 配置base/peer-base.yaml</h3> 
  <p>再修改base/peer-base.yaml文件，将network的名称修改为与文件夹名称适配的4orgexample_default。</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'
services:
  peer-base:
    image: hyperledger/fabric-peer
    environment:
      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>      # the following setting starts chaincode containers on the same
      # bridge network as the peers
      # https://docs.docker.com/compose/networking/
      -<span class="ruby"> <span class="hljs-constant">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE</span>=<span class="hljs-number">4</span>orgexample_default </span>      #- CORE_LOGGING_LEVEL=ERROR
      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_USELEADERELECTION</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_GOSSIP_ORGLEADER</span>=<span class="hljs-keyword">false</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_PROFILE_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.crt </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/server.key </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/etc/hyperledger</span><span class="hljs-regexp">/fabric/tls</span><span class="hljs-regexp">/ca.crt </span></span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    command: peer node start
</code></pre> 
  <h3 id="23-配置orderer和peer">2.3 配置orderer和peer</h3> 
  <p>以上操作均在orderer节点上进行，现将orderer节点的4orgexample文件夹打包发送给四个peer节点，并在五个节点上依此新建以下配置文件： <br> orderer节点： <br> docker-compose-orderer.yaml</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># Copyright IBM Corp. All Rights Reserved.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># SPDX-License-Identifier: Apache-2.0</span>
<span class="hljs-preprocessor">#</span>

<span class="hljs-label">version:</span> <span class="hljs-string">'2'</span>

<span class="hljs-label">services:</span>

  orderer<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>:
    extends:
      file:   base/docker-compose-base<span class="hljs-preprocessor">.yaml</span>
      service: orderer<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>
    container_name: orderer<span class="hljs-preprocessor">.example</span><span class="hljs-preprocessor">.com</span>
</code></pre> 
  <p>peer0.org1节点： <br> docker-compose-peer.yaml</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  peer0.org1.example.com:
    container_name: peer0.org1.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer0.org1.example.com
    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>
  cli:
    container_name: cli
    image: hyperledger/fabric-tools
    tty: true
    environment:
      -<span class="ruby"> <span class="hljs-constant">GOPATH</span>=<span class="hljs-regexp">/opt/gopath</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=cli </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org1.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org1MSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/tls/server.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/tls/server.key </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer<span class="hljs-number">0</span>.org1.example.com/tls/ca.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org1</span>.example.com/msp </span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../chaincode/go/<span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/examples/chaincode/go </span>        -<span class="ruby"> ./crypto-<span class="hljs-symbol">config:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ </span>        -<span class="ruby"> ./<span class="hljs-symbol">scripts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ </span>        -<span class="ruby"> ./channel-<span class="hljs-symbol">artifacts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts </span>    depends_on:
      -<span class="ruby"> peer<span class="hljs-number">0</span>.org1.example.com </span>    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org1.example.com:192.168.3.222"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org2.example.com:192.168.3.224"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org3.example.com:192.168.3.225"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org4.example.com:192.168.3.228"</span> </span></code></pre> 
  <p>peer0.org2节点： <br> docker-compose-peer.yaml</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  peer0.org2.example.com:
    container_name: peer0.org2.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer0.org2.example.com
    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>
  cli:
    container_name: cli
    image: hyperledger/fabric-tools
    tty: true
    environment:
      -<span class="ruby"> <span class="hljs-constant">GOPATH</span>=<span class="hljs-regexp">/opt/gopath</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=cli </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org2.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org2MSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer<span class="hljs-number">0</span>.org2.example.com/tls/server.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer<span class="hljs-number">0</span>.org2.example.com/tls/server.key </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer<span class="hljs-number">0</span>.org2.example.com/tls/ca.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org2</span>.example.com/msp </span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../chaincode/go/<span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/examples/chaincode/go </span>        -<span class="ruby"> ./crypto-<span class="hljs-symbol">config:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ </span>        -<span class="ruby"> ./<span class="hljs-symbol">scripts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ </span>        -<span class="ruby"> ./channel-<span class="hljs-symbol">artifacts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts </span>    depends_on:
      -<span class="ruby"> peer<span class="hljs-number">0</span>.org2.example.com </span>    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org1.example.com:192.168.3.222"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org2.example.com:192.168.3.224"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org3.example.com:192.168.3.225"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org4.example.com:192.168.3.228"</span> </span></code></pre> 
  <p>peer0.org3节点： <br> docker-compose-peer.yaml</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  peer0.org3.example.com:
    container_name: peer0.org3.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer0.org3.example.com
    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>
  cli:
    container_name: cli
    image: hyperledger/fabric-tools
    tty: true
    environment:
      -<span class="ruby"> <span class="hljs-constant">GOPATH</span>=<span class="hljs-regexp">/opt/gopath</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=cli </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org3.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org3MSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer<span class="hljs-number">0</span>.org3.example.com/tls/server.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer<span class="hljs-number">0</span>.org3.example.com/tls/server.key </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer<span class="hljs-number">0</span>.org3.example.com/tls/ca.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org3</span>.example.com/msp </span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../chaincode/go/<span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/examples/chaincode/go </span>        -<span class="ruby"> ./crypto-<span class="hljs-symbol">config:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ </span>        -<span class="ruby"> ./<span class="hljs-symbol">scripts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ </span>        -<span class="ruby"> ./channel-<span class="hljs-symbol">artifacts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts </span>    depends_on:
      -<span class="ruby"> peer<span class="hljs-number">0</span>.org3.example.com </span>    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org1.example.com:192.168.3.222"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org2.example.com:192.168.3.224"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org3.example.com:192.168.3.225"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org4.example.com:192.168.3.228"</span> </span></code></pre> 
  <p>peer0.org4节点： <br> docker-compose-peer.yaml</p> 
  <pre class="prettyprint"><code class=" hljs haml"># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  peer0.org4.example.com:
    container_name: peer0.org4.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer0.org4.example.com
    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>
  cli:
    container_name: cli
    image: hyperledger/fabric-tools
    tty: true
    environment:
      -<span class="ruby"> <span class="hljs-constant">GOPATH</span>=<span class="hljs-regexp">/opt/gopath</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_VM_ENDPOINT</span>=<span class="hljs-symbol">unix:</span>/<span class="hljs-regexp">//host</span><span class="hljs-regexp">/var/run</span><span class="hljs-regexp">/docker.sock </span></span>      -<span class="ruby"> <span class="hljs-constant">CORE_LOGGING_LEVEL</span>=<span class="hljs-constant">DEBUG</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ID</span>=cli </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_ADDRESS</span>=peer<span class="hljs-number">0</span>.org4.example.<span class="hljs-symbol">com:</span><span class="hljs-number">7051</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_LOCALMSPID</span>=<span class="hljs-constant">Org4MSP</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ENABLED</span>=<span class="hljs-keyword">true</span> </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_CERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer<span class="hljs-number">0</span>.org4.example.com/tls/server.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_KEY_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer<span class="hljs-number">0</span>.org4.example.com/tls/server.key </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_TLS_ROOTCERT_FILE</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/peers/peer<span class="hljs-number">0</span>.org4.example.com/tls/ca.crt </span>      -<span class="ruby"> <span class="hljs-constant">CORE_PEER_MSPCONFIGPATH</span>=<span class="hljs-regexp">/opt/gopath</span><span class="hljs-regexp">/src/github</span>.com/hyperledger/fabric/peer/crypto/peerOrganizations/org4.example.com/users/<span class="hljs-constant">Admin</span><span class="hljs-variable">@org4</span>.example.com/msp </span>    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    volumes:
        -<span class="ruby"> /var/run/<span class="hljs-symbol">:/host/var/run/</span> </span>        -<span class="ruby"> ../chaincode/go/<span class="hljs-symbol">:/opt/gopath/src/github</span>.com/hyperledger/fabric/examples/chaincode/go </span>        -<span class="ruby"> ./crypto-<span class="hljs-symbol">config:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ </span>        -<span class="ruby"> ./<span class="hljs-symbol">scripts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/ </span>        -<span class="ruby"> ./channel-<span class="hljs-symbol">artifacts:</span>/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts </span>    depends_on:
      -<span class="ruby"> peer<span class="hljs-number">0</span>.org4.example.com </span>    extra_hosts:
     -<span class="ruby"> <span class="hljs-string">"orderer.example.com:192.168.3.221"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org1.example.com:192.168.3.222"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org2.example.com:192.168.3.224"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org3.example.com:192.168.3.225"</span> </span>     -<span class="ruby"> <span class="hljs-string">"peer0.org4.example.com:192.168.3.228"</span> </span></code></pre> 
  <p>至此，一个4个org，每个org拥有一个peer的fabric网络已经配置完毕，篇幅原因，启动该网络的具体操作见下一篇文章。</p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/vivian_ll/article/details/80597091,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/vivian_ll/article/details/80597091,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

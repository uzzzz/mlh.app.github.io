<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊联盟链quorum搭建（一） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊联盟链quorum搭建（一）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="关于quorum的介绍可以看一些这几篇文章： https://blog.csdn.net/about_blockchain/article/details/78684901 https://blog.csdn.net/about_blockchain/article/details/78750686 https://blog.csdn.net/about_blockchain/article/details/78814873 本文参考官网教程：https://github.com/jpmorganchase/quorum-examples/tree/master/examples/7nodes 官网教程中创建了7个节点，由这7个节点来模拟联盟链网络。 作为联盟链，节点接入是有权限要求的，通过permissioned-nodes.json文件和permissioned参数来控制哪些节点可以和本节点建立连接，后面会详解。对原来教程中有些比较省略，本文会将一些省略的地方介绍。 一、下载资源 1、首先安装quorum git clone --recursive https://github.com/jpmorganchase/quorum.git cd quorum make all 编译完后，quorum/build/bin目录下会生成如下文件列表 abigen bootnode evm examples faucet geth p2psim puppeth rlpdump swarm wnode 将上面这些加入系统path中。 2、获取costellation-node可执行文件 https://github.com/jpmorganchase/constellation/releases 下载下来后解压，得到constellation-node，加入系统PATH中。 3、下载教程样例： git clone https://github.com/jpmorganchase/quorum-examples 二、搭建raft共识的联盟链 因为联盟间一般是存在信任关系，因此可以使用raft共识算法，这个算法可以容忍节点挂掉，但不能容忍拜占庭错误，即不能存在恶意节点。这样就不用以太坊中的pow算法了，节省cup、内存，而且出块时间块。另外，这个算法中不会存在空块，节省大量空间，如果没有交易，那么生成区块就暂停。 1、初始化，创建7个节点，其中1-4号节点是permissioned节点，即这些节点只允许和permissioned-nodes.json中的节点建立连接，其他节点无法连接到这个节点。初始化的脚本如下： raft-init.sh #!/bin/bash set -u set -e echo &quot;[*] Cleaning up temporary data directories&quot; rm -rf qdata mkdir -p qdata/logs echo &quot;[*] Configuring node 1 (permissioned)&quot; mkdir -p qdata/dd1/{keystore,geth} cp permissioned-nodes.json qdata/dd1/static-nodes.json cp permissioned-nodes.json qdata/dd1/ cp keys/key1 qdata/dd1/keystore cp raft/nodekey1 qdata/dd1/geth/nodekey geth --datadir qdata/dd1 init genesis.json echo &quot;[*] Configuring node 2 (permissioned)&quot; mkdir -p qdata/dd2/{keystore,geth} cp permissioned-nodes.json qdata/dd2/static-nodes.json cp permissioned-nodes.json qdata/dd2/ cp keys/key2 qdata/dd2/keystore cp raft/nodekey2 qdata/dd2/geth/nodekey geth --datadir qdata/dd2 init genesis.json echo &quot;[*] Configuring node 3 (permissioned)&quot; mkdir -p qdata/dd3/{keystore,geth} cp permissioned-nodes.json qdata/dd3/static-nodes.json cp permissioned-nodes.json qdata/dd3/ cp keys/key6 qdata/dd3/keystore cp keys/key3 qdata/dd3/keystore cp raft/nodekey3 qdata/dd3/geth/nodekey geth --datadir qdata/dd3 init genesis.json echo &quot;[*] Configuring node 4 (permissioned)&quot; mkdir -p qdata/dd4/{keystore,geth} cp permissioned-nodes.json qdata/dd4/static-nodes.json cp permissioned-nodes.json qdata/dd4/ cp keys/key4 qdata/dd4/keystore cp raft/nodekey4 qdata/dd4/geth/nodekey geth --datadir qdata/dd4 init genesis.json echo &quot;[*] Configuring node 5&quot; mkdir -p qdata/dd5/{keystore,geth} cp permissioned-nodes.json qdata/dd5/static-nodes.json cp keys/key5 qdata/dd5/keystore cp raft/nodekey5 qdata/dd5/geth/nodekey geth --datadir qdata/dd5 init genesis.json echo &quot;[*] Configuring node 6&quot; mkdir -p qdata/dd6/{keystore,geth} cp permissioned-nodes.json qdata/dd6/static-nodes.json cp raft/nodekey6 qdata/dd6/geth/nodekey cp keys/key7 qdata/dd6/keystore geth --datadir qdata/dd6 init genesis.json echo &quot;[*] Configuring node 7&quot; mkdir -p qdata/dd7/{keystore,geth} cp permissioned-nodes.json qdata/dd7/static-nodes.json cp raft/nodekey7 qdata/dd7/geth/nodekey cp keys/key8 qdata/dd7/keystore geth --datadir qdata/dd7 init genesis.json 以第一个节点的配置为例解释命令： 第一行：创建节点1的目录 第二行：permissioned-nodes.json中存了已经设置好的enode值，即节点的地址，通过这个值，运行geth客户端时可以将不同的节点连接起来。与普通以太坊的geth客户端不同，这里需要一个static-nodes，应该是指定和哪些节点建立连接吧。如果启动geth时不指定--permissioned，启动后本节点就会寻找static-node里面的节点建立连接。 另外，这个enode的值是与nodekey相关的，就是第五行中的nodekey文件，两者应该是一一对应的。所以第五行中将nodekey复制到这个目录中，就相当于把一个节点的唯一标识复制过去。nodekey的生成方法：运行bootnode -genkey nodekey即可生成nodekey文件，再运行bootnode -nodekey nodekey就会输出本节点的enode信息，记录下来即可。 第三行：将permissioned-node.json复制到节点1的目录下，这里面记录了哪些节点可以与本节点建立连接，不在这个列表里的节点是不能和本节点连接的。 第四行：将一个账户文件复制到节点1下的目录，启动geth后，用eth.accounts查账户，就会显示这个文件中的账户地址。 第五行：将nodekey复制到节点1目录下，它作用如上面所述。 第六行：根据创世区块信息genesis.json初始化区块链。 2、启动constellation和geth节点 （1）constellation：可以将其看成是分布式密钥服务器、PGP加密和邮件传输代理的合并，用它来实现quorum的私有机制。 使用方法：生成密钥constellation-node --generatekeys node，就会生成node.pub和node.key两个密钥文件，分别是公私钥文件。如果在生成是使用密码加密，那么在启动contellation-node时是需要输入密码的，为了方便，下面的方法中不输入密码。 下面来看启动节点的constellation-start.sh脚本： #!/bin/bash set -u set -e for i in {1..7} do DDIR=&quot;qdata/c$i&quot; mkdir -p $DDIR mkdir -p qdata/logs cp &quot;keys/tm$i.pub&quot; &quot;$DDIR/tm.pub&quot; cp &quot;keys/tm$i.key&quot; &quot;$DDIR/tm.key&quot; rm -f &quot;$DDIR/tm.ipc&quot; CMD=&quot;constellation-node --url=https://127.0.0.$i:900$i/ --port=900$i --workdir=$DDIR --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/&quot; echo &quot;$CMD &gt;&gt; qdata/logs/constellation$i.log 2&gt;&amp;1 &amp;&quot; $CMD &gt;&gt; &quot;qdata/logs/constellation$i.log&quot; 2&gt;&amp;1 &amp; done DOWN=true while $DOWN; do sleep 0.1 DOWN=false for i in {1..7} do if [ ! -S &quot;qdata/c$i/tm.ipc&quot; ]; then DOWN=true fi done done 其中， 第五行是代表一共启动7个节点，需要在不同的节点目录 第7-9行：建立节点目录 第10-11行：将之前生成的公私钥对放到对应几点目录中 第12行：删除之前存在的旧的 .ipc文件（如果存在的话） 第13行：启动constellation-node节点，具体参数参考https://github.com/jpmorganchase/constellation/blob/master/sample.conf 第15行：将控制台的输出定向到指定文件里，如果启动错误，可以去对应文件查看错误内容 第18-28行：等待所有constellation-node启动完毕，其中24行 -S 是查看对应文件是否存在。 可以运行./constellation-start.sh来启动测试，启动完毕后输入ps -ef | grep constellation-node可以查看进程情况，输入killall constellation-node 来终止程序运行。 （2）下面来启动7个geth节点 raft-start.sh #!/bin/bash set -u set -e mkdir -p qdata/logs echo &quot;[*] Starting Constellation nodes&quot; ./constellation-start.sh echo &quot;[*] Starting Ethereum nodes&quot; set -v ARGS=&quot;--nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints&quot; PRIVATE_CONFIG=qdata/c1/tm.ipc nohup geth --datadir qdata/dd1 $ARGS --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/1.log &amp; PRIVATE_CONFIG=qdata/c2/tm.ipc nohup geth --datadir qdata/dd2 $ARGS --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/2.log &amp; PRIVATE_CONFIG=qdata/c3/tm.ipc nohup geth --datadir qdata/dd3 $ARGS --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/3.log &amp; PRIVATE_CONFIG=qdata/c4/tm.ipc nohup geth --datadir qdata/dd4 $ARGS --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/4.log &amp; PRIVATE_CONFIG=qdata/c5/tm.ipc nohup geth --datadir qdata/dd5 $ARGS --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/5.log &amp; PRIVATE_CONFIG=qdata/c6/tm.ipc nohup geth --datadir qdata/dd6 $ARGS --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/6.log &amp; PRIVATE_CONFIG=qdata/c7/tm.ipc nohup geth --datadir qdata/dd7 $ARGS --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/7.log &amp; set +v echo echo &quot;All nodes configured. See &#39;qdata/logs&#39; for logs, and run e.g. &#39;geth attach qdata/dd1/geth.ipc&#39; to attach to the first Geth node.&quot; echo &quot;To test sending a private transaction from Node 1 to Node 7, run &#39;./runscript.sh private-contract.js&#39;&quot; 其中 第7行：调用上面写的constellation-start.sh脚本，启动7个constellation 第11行：启动geth节点需要的参数，这里需要制定--raft来使用raft共识方法 第12-18行，启动7个geth节点，需要指定raftport端口号，用 --permissioned参数来指定那些节点是有连接权限的。 这样，constellation-node和geth节点都启动起来了，也就是环境已经搭建好了，可以在上面开发了。开发之前先做一下测试。 3、测试环境 zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef | grep constellation-node zhj 17150 2994 4 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.1:9001/ --port=9001 --workdir=qdata/c1 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17174 2994 3 09:23 pts/3 00:00:02 constellation-node --url=https://127.0.0.2:9002/ --port=9002 --workdir=qdata/c2 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17200 2994 3 09:23 pts/3 00:00:02 constellation-node --url=https://127.0.0.3:9003/ --port=9003 --workdir=qdata/c3 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17218 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.4:9004/ --port=9004 --workdir=qdata/c4 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17226 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.5:9005/ --port=9005 --workdir=qdata/c5 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17265 2994 4 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.6:9006/ --port=9006 --workdir=qdata/c6 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17282 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.7:9007/ --port=9007 --workdir=qdata/c7 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17690 11030 0 09:24 pts/6 00:00:00 grep --color=auto constellation-node zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef |grep geth zhj 17354 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd1 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt zhj 17355 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd2 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt zhj 17356 2994 2 09:23 pts/3 00:00:08 geth --datadir qdata/dd3 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt zhj 17357 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd4 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt zhj 17358 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd5 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt zhj 17359 2994 1 09:23 pts/3 00:00:04 geth --datadir qdata/dd6 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt zhj 17360 2994 1 09:23 pts/3 00:00:04 geth --datadir qdata/dd7 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt zhj 17946 11030 0 09:29 pts/6 00:00:00 grep --color=auto geth 说明节点都已正常运行，下面连接第一个节点的geth控制台： 输入geth attach qdata/dd1/geth.ipc，查看基本信息： zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd1/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1 coinbase: 0xed9d02e382b34818e88b88a309c7fe71e65f419d at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd1 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; eth.accounts [&quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot;] &gt; acc0 = eth.accounts[0] &quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot; &gt; eth.getBalance(acc0) 1e+27 &gt; eth.blockNumber 0 可以看到有一个账户地址，就是复制进去的账户，里面有余额（在创世文件里设置的），现在的区块数目是0，现在没有交易，是不产生区块的，下面进行发送一笔交易。 连接第7个节点的geth控制台，查看账户和余额： zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd7/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1 coinbase: 0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd7 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; eth.accounts [&quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot;] &gt; acc0 =eth.accounts[0] &quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot; &gt; eth.getBalance(acc0) 0 然后从节点1的账户发送一笔钱到节点7的账户： &gt; eth.sendTransaction({from:acc0, to:&quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot;, value: 100000}) &quot;0xa0da7ef1632361e7b4d37f5258598bce0bbb074935c613c7e565a2c93964807f&quot; 这时查看账户7的余额： &gt; eth.getBalance(acc0) 100000 再查看区块数目： &gt; eth.blockNumber 1 可以看到因为这笔交易已经生成了一个区块。 如果要发送一笔私有交易，可以用privateFor来指定，例如节点1账户发送一笔私有交易给节点2的账户： &gt;eth.sendTransaction({from: acc0, to: acc1, value: 10000, privateFor:[&quot;QfeDAys9MPDs2XHExtc84jKGHxZg/aj52DTh0vtA3Xc=&quot;]}) &quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot; 其中acc0是节点1的账户，acc1是节点2的账户，privateFor后面的地址是tm2.pub中的内容,返回的交易的地址，下面查看这笔交易： &gt; eth.getTransaction(&quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot;) { blockHash: &quot;0x6e74d807e1951e168489e54b23dd39f367f62312b1463a160c8730ad360f48bf&quot;, blockNumber: 1, from: &quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot;, input: &quot;0x33e358398b2bc693db176718211e9a80b2d2cf58df79e7a760c9b68baa2f41d95a5bec625b3f3eb3b0bb996afb6692e8187164fed745ebd726abd74455895d90&quot;, nonce: 0, r: &quot;0xfa734439ccc3f8d54f22a012703d951a0891c2914b1361967e3f755466f778b6&quot;, s: &quot;0x79ba2235b3d049e3132a32e4bac3d6023f3c460875d098a61c6c829d3c65af7f&quot;, to: &quot;0xca843569e3427144cead5e4d5999a3d0ccf92b8e&quot;, transactionIndex: 0, v: &quot;0x25&quot;, value: 100000 } 其中倒数第二行的v字段值是0x25，即37。当值为37、 38时代表是一笔私有交易。 （7.13补充：我又试了一下，现在quorum还不支持私有交易发送以太币，上面这笔私有交易可以成功发送并被记录在区块里，但是查一下双方的余额时，发现都没有改变。github上开发者是这么说的：链接。但是私有合约可以正常执行，下一篇文章中有具体介绍） 本篇到此结束，下一篇文章介绍在quorum上部署和执行智能合约。 阅读更多" />
<meta property="og:description" content="关于quorum的介绍可以看一些这几篇文章： https://blog.csdn.net/about_blockchain/article/details/78684901 https://blog.csdn.net/about_blockchain/article/details/78750686 https://blog.csdn.net/about_blockchain/article/details/78814873 本文参考官网教程：https://github.com/jpmorganchase/quorum-examples/tree/master/examples/7nodes 官网教程中创建了7个节点，由这7个节点来模拟联盟链网络。 作为联盟链，节点接入是有权限要求的，通过permissioned-nodes.json文件和permissioned参数来控制哪些节点可以和本节点建立连接，后面会详解。对原来教程中有些比较省略，本文会将一些省略的地方介绍。 一、下载资源 1、首先安装quorum git clone --recursive https://github.com/jpmorganchase/quorum.git cd quorum make all 编译完后，quorum/build/bin目录下会生成如下文件列表 abigen bootnode evm examples faucet geth p2psim puppeth rlpdump swarm wnode 将上面这些加入系统path中。 2、获取costellation-node可执行文件 https://github.com/jpmorganchase/constellation/releases 下载下来后解压，得到constellation-node，加入系统PATH中。 3、下载教程样例： git clone https://github.com/jpmorganchase/quorum-examples 二、搭建raft共识的联盟链 因为联盟间一般是存在信任关系，因此可以使用raft共识算法，这个算法可以容忍节点挂掉，但不能容忍拜占庭错误，即不能存在恶意节点。这样就不用以太坊中的pow算法了，节省cup、内存，而且出块时间块。另外，这个算法中不会存在空块，节省大量空间，如果没有交易，那么生成区块就暂停。 1、初始化，创建7个节点，其中1-4号节点是permissioned节点，即这些节点只允许和permissioned-nodes.json中的节点建立连接，其他节点无法连接到这个节点。初始化的脚本如下： raft-init.sh #!/bin/bash set -u set -e echo &quot;[*] Cleaning up temporary data directories&quot; rm -rf qdata mkdir -p qdata/logs echo &quot;[*] Configuring node 1 (permissioned)&quot; mkdir -p qdata/dd1/{keystore,geth} cp permissioned-nodes.json qdata/dd1/static-nodes.json cp permissioned-nodes.json qdata/dd1/ cp keys/key1 qdata/dd1/keystore cp raft/nodekey1 qdata/dd1/geth/nodekey geth --datadir qdata/dd1 init genesis.json echo &quot;[*] Configuring node 2 (permissioned)&quot; mkdir -p qdata/dd2/{keystore,geth} cp permissioned-nodes.json qdata/dd2/static-nodes.json cp permissioned-nodes.json qdata/dd2/ cp keys/key2 qdata/dd2/keystore cp raft/nodekey2 qdata/dd2/geth/nodekey geth --datadir qdata/dd2 init genesis.json echo &quot;[*] Configuring node 3 (permissioned)&quot; mkdir -p qdata/dd3/{keystore,geth} cp permissioned-nodes.json qdata/dd3/static-nodes.json cp permissioned-nodes.json qdata/dd3/ cp keys/key6 qdata/dd3/keystore cp keys/key3 qdata/dd3/keystore cp raft/nodekey3 qdata/dd3/geth/nodekey geth --datadir qdata/dd3 init genesis.json echo &quot;[*] Configuring node 4 (permissioned)&quot; mkdir -p qdata/dd4/{keystore,geth} cp permissioned-nodes.json qdata/dd4/static-nodes.json cp permissioned-nodes.json qdata/dd4/ cp keys/key4 qdata/dd4/keystore cp raft/nodekey4 qdata/dd4/geth/nodekey geth --datadir qdata/dd4 init genesis.json echo &quot;[*] Configuring node 5&quot; mkdir -p qdata/dd5/{keystore,geth} cp permissioned-nodes.json qdata/dd5/static-nodes.json cp keys/key5 qdata/dd5/keystore cp raft/nodekey5 qdata/dd5/geth/nodekey geth --datadir qdata/dd5 init genesis.json echo &quot;[*] Configuring node 6&quot; mkdir -p qdata/dd6/{keystore,geth} cp permissioned-nodes.json qdata/dd6/static-nodes.json cp raft/nodekey6 qdata/dd6/geth/nodekey cp keys/key7 qdata/dd6/keystore geth --datadir qdata/dd6 init genesis.json echo &quot;[*] Configuring node 7&quot; mkdir -p qdata/dd7/{keystore,geth} cp permissioned-nodes.json qdata/dd7/static-nodes.json cp raft/nodekey7 qdata/dd7/geth/nodekey cp keys/key8 qdata/dd7/keystore geth --datadir qdata/dd7 init genesis.json 以第一个节点的配置为例解释命令： 第一行：创建节点1的目录 第二行：permissioned-nodes.json中存了已经设置好的enode值，即节点的地址，通过这个值，运行geth客户端时可以将不同的节点连接起来。与普通以太坊的geth客户端不同，这里需要一个static-nodes，应该是指定和哪些节点建立连接吧。如果启动geth时不指定--permissioned，启动后本节点就会寻找static-node里面的节点建立连接。 另外，这个enode的值是与nodekey相关的，就是第五行中的nodekey文件，两者应该是一一对应的。所以第五行中将nodekey复制到这个目录中，就相当于把一个节点的唯一标识复制过去。nodekey的生成方法：运行bootnode -genkey nodekey即可生成nodekey文件，再运行bootnode -nodekey nodekey就会输出本节点的enode信息，记录下来即可。 第三行：将permissioned-node.json复制到节点1的目录下，这里面记录了哪些节点可以与本节点建立连接，不在这个列表里的节点是不能和本节点连接的。 第四行：将一个账户文件复制到节点1下的目录，启动geth后，用eth.accounts查账户，就会显示这个文件中的账户地址。 第五行：将nodekey复制到节点1目录下，它作用如上面所述。 第六行：根据创世区块信息genesis.json初始化区块链。 2、启动constellation和geth节点 （1）constellation：可以将其看成是分布式密钥服务器、PGP加密和邮件传输代理的合并，用它来实现quorum的私有机制。 使用方法：生成密钥constellation-node --generatekeys node，就会生成node.pub和node.key两个密钥文件，分别是公私钥文件。如果在生成是使用密码加密，那么在启动contellation-node时是需要输入密码的，为了方便，下面的方法中不输入密码。 下面来看启动节点的constellation-start.sh脚本： #!/bin/bash set -u set -e for i in {1..7} do DDIR=&quot;qdata/c$i&quot; mkdir -p $DDIR mkdir -p qdata/logs cp &quot;keys/tm$i.pub&quot; &quot;$DDIR/tm.pub&quot; cp &quot;keys/tm$i.key&quot; &quot;$DDIR/tm.key&quot; rm -f &quot;$DDIR/tm.ipc&quot; CMD=&quot;constellation-node --url=https://127.0.0.$i:900$i/ --port=900$i --workdir=$DDIR --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/&quot; echo &quot;$CMD &gt;&gt; qdata/logs/constellation$i.log 2&gt;&amp;1 &amp;&quot; $CMD &gt;&gt; &quot;qdata/logs/constellation$i.log&quot; 2&gt;&amp;1 &amp; done DOWN=true while $DOWN; do sleep 0.1 DOWN=false for i in {1..7} do if [ ! -S &quot;qdata/c$i/tm.ipc&quot; ]; then DOWN=true fi done done 其中， 第五行是代表一共启动7个节点，需要在不同的节点目录 第7-9行：建立节点目录 第10-11行：将之前生成的公私钥对放到对应几点目录中 第12行：删除之前存在的旧的 .ipc文件（如果存在的话） 第13行：启动constellation-node节点，具体参数参考https://github.com/jpmorganchase/constellation/blob/master/sample.conf 第15行：将控制台的输出定向到指定文件里，如果启动错误，可以去对应文件查看错误内容 第18-28行：等待所有constellation-node启动完毕，其中24行 -S 是查看对应文件是否存在。 可以运行./constellation-start.sh来启动测试，启动完毕后输入ps -ef | grep constellation-node可以查看进程情况，输入killall constellation-node 来终止程序运行。 （2）下面来启动7个geth节点 raft-start.sh #!/bin/bash set -u set -e mkdir -p qdata/logs echo &quot;[*] Starting Constellation nodes&quot; ./constellation-start.sh echo &quot;[*] Starting Ethereum nodes&quot; set -v ARGS=&quot;--nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints&quot; PRIVATE_CONFIG=qdata/c1/tm.ipc nohup geth --datadir qdata/dd1 $ARGS --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/1.log &amp; PRIVATE_CONFIG=qdata/c2/tm.ipc nohup geth --datadir qdata/dd2 $ARGS --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/2.log &amp; PRIVATE_CONFIG=qdata/c3/tm.ipc nohup geth --datadir qdata/dd3 $ARGS --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/3.log &amp; PRIVATE_CONFIG=qdata/c4/tm.ipc nohup geth --datadir qdata/dd4 $ARGS --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/4.log &amp; PRIVATE_CONFIG=qdata/c5/tm.ipc nohup geth --datadir qdata/dd5 $ARGS --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/5.log &amp; PRIVATE_CONFIG=qdata/c6/tm.ipc nohup geth --datadir qdata/dd6 $ARGS --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/6.log &amp; PRIVATE_CONFIG=qdata/c7/tm.ipc nohup geth --datadir qdata/dd7 $ARGS --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/7.log &amp; set +v echo echo &quot;All nodes configured. See &#39;qdata/logs&#39; for logs, and run e.g. &#39;geth attach qdata/dd1/geth.ipc&#39; to attach to the first Geth node.&quot; echo &quot;To test sending a private transaction from Node 1 to Node 7, run &#39;./runscript.sh private-contract.js&#39;&quot; 其中 第7行：调用上面写的constellation-start.sh脚本，启动7个constellation 第11行：启动geth节点需要的参数，这里需要制定--raft来使用raft共识方法 第12-18行，启动7个geth节点，需要指定raftport端口号，用 --permissioned参数来指定那些节点是有连接权限的。 这样，constellation-node和geth节点都启动起来了，也就是环境已经搭建好了，可以在上面开发了。开发之前先做一下测试。 3、测试环境 zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef | grep constellation-node zhj 17150 2994 4 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.1:9001/ --port=9001 --workdir=qdata/c1 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17174 2994 3 09:23 pts/3 00:00:02 constellation-node --url=https://127.0.0.2:9002/ --port=9002 --workdir=qdata/c2 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17200 2994 3 09:23 pts/3 00:00:02 constellation-node --url=https://127.0.0.3:9003/ --port=9003 --workdir=qdata/c3 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17218 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.4:9004/ --port=9004 --workdir=qdata/c4 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17226 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.5:9005/ --port=9005 --workdir=qdata/c5 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17265 2994 4 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.6:9006/ --port=9006 --workdir=qdata/c6 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17282 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.7:9007/ --port=9007 --workdir=qdata/c7 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17690 11030 0 09:24 pts/6 00:00:00 grep --color=auto constellation-node zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef |grep geth zhj 17354 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd1 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt zhj 17355 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd2 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt zhj 17356 2994 2 09:23 pts/3 00:00:08 geth --datadir qdata/dd3 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt zhj 17357 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd4 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt zhj 17358 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd5 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt zhj 17359 2994 1 09:23 pts/3 00:00:04 geth --datadir qdata/dd6 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt zhj 17360 2994 1 09:23 pts/3 00:00:04 geth --datadir qdata/dd7 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt zhj 17946 11030 0 09:29 pts/6 00:00:00 grep --color=auto geth 说明节点都已正常运行，下面连接第一个节点的geth控制台： 输入geth attach qdata/dd1/geth.ipc，查看基本信息： zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd1/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1 coinbase: 0xed9d02e382b34818e88b88a309c7fe71e65f419d at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd1 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; eth.accounts [&quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot;] &gt; acc0 = eth.accounts[0] &quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot; &gt; eth.getBalance(acc0) 1e+27 &gt; eth.blockNumber 0 可以看到有一个账户地址，就是复制进去的账户，里面有余额（在创世文件里设置的），现在的区块数目是0，现在没有交易，是不产生区块的，下面进行发送一笔交易。 连接第7个节点的geth控制台，查看账户和余额： zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd7/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1 coinbase: 0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd7 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; eth.accounts [&quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot;] &gt; acc0 =eth.accounts[0] &quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot; &gt; eth.getBalance(acc0) 0 然后从节点1的账户发送一笔钱到节点7的账户： &gt; eth.sendTransaction({from:acc0, to:&quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot;, value: 100000}) &quot;0xa0da7ef1632361e7b4d37f5258598bce0bbb074935c613c7e565a2c93964807f&quot; 这时查看账户7的余额： &gt; eth.getBalance(acc0) 100000 再查看区块数目： &gt; eth.blockNumber 1 可以看到因为这笔交易已经生成了一个区块。 如果要发送一笔私有交易，可以用privateFor来指定，例如节点1账户发送一笔私有交易给节点2的账户： &gt;eth.sendTransaction({from: acc0, to: acc1, value: 10000, privateFor:[&quot;QfeDAys9MPDs2XHExtc84jKGHxZg/aj52DTh0vtA3Xc=&quot;]}) &quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot; 其中acc0是节点1的账户，acc1是节点2的账户，privateFor后面的地址是tm2.pub中的内容,返回的交易的地址，下面查看这笔交易： &gt; eth.getTransaction(&quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot;) { blockHash: &quot;0x6e74d807e1951e168489e54b23dd39f367f62312b1463a160c8730ad360f48bf&quot;, blockNumber: 1, from: &quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot;, input: &quot;0x33e358398b2bc693db176718211e9a80b2d2cf58df79e7a760c9b68baa2f41d95a5bec625b3f3eb3b0bb996afb6692e8187164fed745ebd726abd74455895d90&quot;, nonce: 0, r: &quot;0xfa734439ccc3f8d54f22a012703d951a0891c2914b1361967e3f755466f778b6&quot;, s: &quot;0x79ba2235b3d049e3132a32e4bac3d6023f3c460875d098a61c6c829d3c65af7f&quot;, to: &quot;0xca843569e3427144cead5e4d5999a3d0ccf92b8e&quot;, transactionIndex: 0, v: &quot;0x25&quot;, value: 100000 } 其中倒数第二行的v字段值是0x25，即37。当值为37、 38时代表是一笔私有交易。 （7.13补充：我又试了一下，现在quorum还不支持私有交易发送以太币，上面这笔私有交易可以成功发送并被记录在区块里，但是查一下双方的余额时，发现都没有改变。github上开发者是这么说的：链接。但是私有合约可以正常执行，下一篇文章中有具体介绍） 本篇到此结束，下一篇文章介绍在quorum上部署和执行智能合约。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/06/05/2ef0c0d05f32c098ccd1765e0fc2410a.html" />
<meta property="og:url" content="https://mlh.app/2018/06/05/2ef0c0d05f32c098ccd1765e0fc2410a.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"关于quorum的介绍可以看一些这几篇文章： https://blog.csdn.net/about_blockchain/article/details/78684901 https://blog.csdn.net/about_blockchain/article/details/78750686 https://blog.csdn.net/about_blockchain/article/details/78814873 本文参考官网教程：https://github.com/jpmorganchase/quorum-examples/tree/master/examples/7nodes 官网教程中创建了7个节点，由这7个节点来模拟联盟链网络。 作为联盟链，节点接入是有权限要求的，通过permissioned-nodes.json文件和permissioned参数来控制哪些节点可以和本节点建立连接，后面会详解。对原来教程中有些比较省略，本文会将一些省略的地方介绍。 一、下载资源 1、首先安装quorum git clone --recursive https://github.com/jpmorganchase/quorum.git cd quorum make all 编译完后，quorum/build/bin目录下会生成如下文件列表 abigen bootnode evm examples faucet geth p2psim puppeth rlpdump swarm wnode 将上面这些加入系统path中。 2、获取costellation-node可执行文件 https://github.com/jpmorganchase/constellation/releases 下载下来后解压，得到constellation-node，加入系统PATH中。 3、下载教程样例： git clone https://github.com/jpmorganchase/quorum-examples 二、搭建raft共识的联盟链 因为联盟间一般是存在信任关系，因此可以使用raft共识算法，这个算法可以容忍节点挂掉，但不能容忍拜占庭错误，即不能存在恶意节点。这样就不用以太坊中的pow算法了，节省cup、内存，而且出块时间块。另外，这个算法中不会存在空块，节省大量空间，如果没有交易，那么生成区块就暂停。 1、初始化，创建7个节点，其中1-4号节点是permissioned节点，即这些节点只允许和permissioned-nodes.json中的节点建立连接，其他节点无法连接到这个节点。初始化的脚本如下： raft-init.sh #!/bin/bash set -u set -e echo &quot;[*] Cleaning up temporary data directories&quot; rm -rf qdata mkdir -p qdata/logs echo &quot;[*] Configuring node 1 (permissioned)&quot; mkdir -p qdata/dd1/{keystore,geth} cp permissioned-nodes.json qdata/dd1/static-nodes.json cp permissioned-nodes.json qdata/dd1/ cp keys/key1 qdata/dd1/keystore cp raft/nodekey1 qdata/dd1/geth/nodekey geth --datadir qdata/dd1 init genesis.json echo &quot;[*] Configuring node 2 (permissioned)&quot; mkdir -p qdata/dd2/{keystore,geth} cp permissioned-nodes.json qdata/dd2/static-nodes.json cp permissioned-nodes.json qdata/dd2/ cp keys/key2 qdata/dd2/keystore cp raft/nodekey2 qdata/dd2/geth/nodekey geth --datadir qdata/dd2 init genesis.json echo &quot;[*] Configuring node 3 (permissioned)&quot; mkdir -p qdata/dd3/{keystore,geth} cp permissioned-nodes.json qdata/dd3/static-nodes.json cp permissioned-nodes.json qdata/dd3/ cp keys/key6 qdata/dd3/keystore cp keys/key3 qdata/dd3/keystore cp raft/nodekey3 qdata/dd3/geth/nodekey geth --datadir qdata/dd3 init genesis.json echo &quot;[*] Configuring node 4 (permissioned)&quot; mkdir -p qdata/dd4/{keystore,geth} cp permissioned-nodes.json qdata/dd4/static-nodes.json cp permissioned-nodes.json qdata/dd4/ cp keys/key4 qdata/dd4/keystore cp raft/nodekey4 qdata/dd4/geth/nodekey geth --datadir qdata/dd4 init genesis.json echo &quot;[*] Configuring node 5&quot; mkdir -p qdata/dd5/{keystore,geth} cp permissioned-nodes.json qdata/dd5/static-nodes.json cp keys/key5 qdata/dd5/keystore cp raft/nodekey5 qdata/dd5/geth/nodekey geth --datadir qdata/dd5 init genesis.json echo &quot;[*] Configuring node 6&quot; mkdir -p qdata/dd6/{keystore,geth} cp permissioned-nodes.json qdata/dd6/static-nodes.json cp raft/nodekey6 qdata/dd6/geth/nodekey cp keys/key7 qdata/dd6/keystore geth --datadir qdata/dd6 init genesis.json echo &quot;[*] Configuring node 7&quot; mkdir -p qdata/dd7/{keystore,geth} cp permissioned-nodes.json qdata/dd7/static-nodes.json cp raft/nodekey7 qdata/dd7/geth/nodekey cp keys/key8 qdata/dd7/keystore geth --datadir qdata/dd7 init genesis.json 以第一个节点的配置为例解释命令： 第一行：创建节点1的目录 第二行：permissioned-nodes.json中存了已经设置好的enode值，即节点的地址，通过这个值，运行geth客户端时可以将不同的节点连接起来。与普通以太坊的geth客户端不同，这里需要一个static-nodes，应该是指定和哪些节点建立连接吧。如果启动geth时不指定--permissioned，启动后本节点就会寻找static-node里面的节点建立连接。 另外，这个enode的值是与nodekey相关的，就是第五行中的nodekey文件，两者应该是一一对应的。所以第五行中将nodekey复制到这个目录中，就相当于把一个节点的唯一标识复制过去。nodekey的生成方法：运行bootnode -genkey nodekey即可生成nodekey文件，再运行bootnode -nodekey nodekey就会输出本节点的enode信息，记录下来即可。 第三行：将permissioned-node.json复制到节点1的目录下，这里面记录了哪些节点可以与本节点建立连接，不在这个列表里的节点是不能和本节点连接的。 第四行：将一个账户文件复制到节点1下的目录，启动geth后，用eth.accounts查账户，就会显示这个文件中的账户地址。 第五行：将nodekey复制到节点1目录下，它作用如上面所述。 第六行：根据创世区块信息genesis.json初始化区块链。 2、启动constellation和geth节点 （1）constellation：可以将其看成是分布式密钥服务器、PGP加密和邮件传输代理的合并，用它来实现quorum的私有机制。 使用方法：生成密钥constellation-node --generatekeys node，就会生成node.pub和node.key两个密钥文件，分别是公私钥文件。如果在生成是使用密码加密，那么在启动contellation-node时是需要输入密码的，为了方便，下面的方法中不输入密码。 下面来看启动节点的constellation-start.sh脚本： #!/bin/bash set -u set -e for i in {1..7} do DDIR=&quot;qdata/c$i&quot; mkdir -p $DDIR mkdir -p qdata/logs cp &quot;keys/tm$i.pub&quot; &quot;$DDIR/tm.pub&quot; cp &quot;keys/tm$i.key&quot; &quot;$DDIR/tm.key&quot; rm -f &quot;$DDIR/tm.ipc&quot; CMD=&quot;constellation-node --url=https://127.0.0.$i:900$i/ --port=900$i --workdir=$DDIR --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/&quot; echo &quot;$CMD &gt;&gt; qdata/logs/constellation$i.log 2&gt;&amp;1 &amp;&quot; $CMD &gt;&gt; &quot;qdata/logs/constellation$i.log&quot; 2&gt;&amp;1 &amp; done DOWN=true while $DOWN; do sleep 0.1 DOWN=false for i in {1..7} do if [ ! -S &quot;qdata/c$i/tm.ipc&quot; ]; then DOWN=true fi done done 其中， 第五行是代表一共启动7个节点，需要在不同的节点目录 第7-9行：建立节点目录 第10-11行：将之前生成的公私钥对放到对应几点目录中 第12行：删除之前存在的旧的 .ipc文件（如果存在的话） 第13行：启动constellation-node节点，具体参数参考https://github.com/jpmorganchase/constellation/blob/master/sample.conf 第15行：将控制台的输出定向到指定文件里，如果启动错误，可以去对应文件查看错误内容 第18-28行：等待所有constellation-node启动完毕，其中24行 -S 是查看对应文件是否存在。 可以运行./constellation-start.sh来启动测试，启动完毕后输入ps -ef | grep constellation-node可以查看进程情况，输入killall constellation-node 来终止程序运行。 （2）下面来启动7个geth节点 raft-start.sh #!/bin/bash set -u set -e mkdir -p qdata/logs echo &quot;[*] Starting Constellation nodes&quot; ./constellation-start.sh echo &quot;[*] Starting Ethereum nodes&quot; set -v ARGS=&quot;--nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints&quot; PRIVATE_CONFIG=qdata/c1/tm.ipc nohup geth --datadir qdata/dd1 $ARGS --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/1.log &amp; PRIVATE_CONFIG=qdata/c2/tm.ipc nohup geth --datadir qdata/dd2 $ARGS --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/2.log &amp; PRIVATE_CONFIG=qdata/c3/tm.ipc nohup geth --datadir qdata/dd3 $ARGS --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/3.log &amp; PRIVATE_CONFIG=qdata/c4/tm.ipc nohup geth --datadir qdata/dd4 $ARGS --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/4.log &amp; PRIVATE_CONFIG=qdata/c5/tm.ipc nohup geth --datadir qdata/dd5 $ARGS --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/5.log &amp; PRIVATE_CONFIG=qdata/c6/tm.ipc nohup geth --datadir qdata/dd6 $ARGS --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/6.log &amp; PRIVATE_CONFIG=qdata/c7/tm.ipc nohup geth --datadir qdata/dd7 $ARGS --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/7.log &amp; set +v echo echo &quot;All nodes configured. See &#39;qdata/logs&#39; for logs, and run e.g. &#39;geth attach qdata/dd1/geth.ipc&#39; to attach to the first Geth node.&quot; echo &quot;To test sending a private transaction from Node 1 to Node 7, run &#39;./runscript.sh private-contract.js&#39;&quot; 其中 第7行：调用上面写的constellation-start.sh脚本，启动7个constellation 第11行：启动geth节点需要的参数，这里需要制定--raft来使用raft共识方法 第12-18行，启动7个geth节点，需要指定raftport端口号，用 --permissioned参数来指定那些节点是有连接权限的。 这样，constellation-node和geth节点都启动起来了，也就是环境已经搭建好了，可以在上面开发了。开发之前先做一下测试。 3、测试环境 zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef | grep constellation-node zhj 17150 2994 4 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.1:9001/ --port=9001 --workdir=qdata/c1 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17174 2994 3 09:23 pts/3 00:00:02 constellation-node --url=https://127.0.0.2:9002/ --port=9002 --workdir=qdata/c2 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17200 2994 3 09:23 pts/3 00:00:02 constellation-node --url=https://127.0.0.3:9003/ --port=9003 --workdir=qdata/c3 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17218 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.4:9004/ --port=9004 --workdir=qdata/c4 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17226 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.5:9005/ --port=9005 --workdir=qdata/c5 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17265 2994 4 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.6:9006/ --port=9006 --workdir=qdata/c6 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17282 2994 3 09:23 pts/3 00:00:03 constellation-node --url=https://127.0.0.7:9007/ --port=9007 --workdir=qdata/c7 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/ zhj 17690 11030 0 09:24 pts/6 00:00:00 grep --color=auto constellation-node zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef |grep geth zhj 17354 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd1 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt zhj 17355 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd2 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt zhj 17356 2994 2 09:23 pts/3 00:00:08 geth --datadir qdata/dd3 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt zhj 17357 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd4 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt zhj 17358 2994 1 09:23 pts/3 00:00:05 geth --datadir qdata/dd5 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt zhj 17359 2994 1 09:23 pts/3 00:00:04 geth --datadir qdata/dd6 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt zhj 17360 2994 1 09:23 pts/3 00:00:04 geth --datadir qdata/dd7 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt zhj 17946 11030 0 09:29 pts/6 00:00:00 grep --color=auto geth 说明节点都已正常运行，下面连接第一个节点的geth控制台： 输入geth attach qdata/dd1/geth.ipc，查看基本信息： zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd1/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1 coinbase: 0xed9d02e382b34818e88b88a309c7fe71e65f419d at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd1 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; eth.accounts [&quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot;] &gt; acc0 = eth.accounts[0] &quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot; &gt; eth.getBalance(acc0) 1e+27 &gt; eth.blockNumber 0 可以看到有一个账户地址，就是复制进去的账户，里面有余额（在创世文件里设置的），现在的区块数目是0，现在没有交易，是不产生区块的，下面进行发送一笔交易。 连接第7个节点的geth控制台，查看账户和余额： zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd7/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1 coinbase: 0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a at block: 0 (Thu, 01 Jan 1970 08:00:00 CST) datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd7 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; eth.accounts [&quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot;] &gt; acc0 =eth.accounts[0] &quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot; &gt; eth.getBalance(acc0) 0 然后从节点1的账户发送一笔钱到节点7的账户： &gt; eth.sendTransaction({from:acc0, to:&quot;0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a&quot;, value: 100000}) &quot;0xa0da7ef1632361e7b4d37f5258598bce0bbb074935c613c7e565a2c93964807f&quot; 这时查看账户7的余额： &gt; eth.getBalance(acc0) 100000 再查看区块数目： &gt; eth.blockNumber 1 可以看到因为这笔交易已经生成了一个区块。 如果要发送一笔私有交易，可以用privateFor来指定，例如节点1账户发送一笔私有交易给节点2的账户： &gt;eth.sendTransaction({from: acc0, to: acc1, value: 10000, privateFor:[&quot;QfeDAys9MPDs2XHExtc84jKGHxZg/aj52DTh0vtA3Xc=&quot;]}) &quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot; 其中acc0是节点1的账户，acc1是节点2的账户，privateFor后面的地址是tm2.pub中的内容,返回的交易的地址，下面查看这笔交易： &gt; eth.getTransaction(&quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot;) { blockHash: &quot;0x6e74d807e1951e168489e54b23dd39f367f62312b1463a160c8730ad360f48bf&quot;, blockNumber: 1, from: &quot;0xed9d02e382b34818e88b88a309c7fe71e65f419d&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff&quot;, input: &quot;0x33e358398b2bc693db176718211e9a80b2d2cf58df79e7a760c9b68baa2f41d95a5bec625b3f3eb3b0bb996afb6692e8187164fed745ebd726abd74455895d90&quot;, nonce: 0, r: &quot;0xfa734439ccc3f8d54f22a012703d951a0891c2914b1361967e3f755466f778b6&quot;, s: &quot;0x79ba2235b3d049e3132a32e4bac3d6023f3c460875d098a61c6c829d3c65af7f&quot;, to: &quot;0xca843569e3427144cead5e4d5999a3d0ccf92b8e&quot;, transactionIndex: 0, v: &quot;0x25&quot;, value: 100000 } 其中倒数第二行的v字段值是0x25，即37。当值为37、 38时代表是一笔私有交易。 （7.13补充：我又试了一下，现在quorum还不支持私有交易发送以太币，上面这笔私有交易可以成功发送并被记录在区块里，但是查一下双方的余额时，发现都没有改变。github上开发者是这么说的：链接。但是私有合约可以正常执行，下一篇文章中有具体介绍） 本篇到此结束，下一篇文章介绍在quorum上部署和执行智能合约。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/06/05/2ef0c0d05f32c098ccd1765e0fc2410a.html","headline":"以太坊联盟链quorum搭建（一）","dateModified":"2018-06-05T00:00:00+08:00","datePublished":"2018-06-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/06/05/2ef0c0d05f32c098ccd1765e0fc2410a.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊联盟链quorum搭建（一）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>关于quorum的介绍可以看一些这几篇文章：</p>
  <p><a href="https://blog.csdn.net/about_blockchain/article/details/78684901" rel="nofollow">https://blog.csdn.net/about_blockchain/article/details/78684901</a><br></p>
  <p><a href="https://blog.csdn.net/about_blockchain/article/details/78750686" rel="nofollow">https://blog.csdn.net/about_blockchain/article/details/78750686</a><br></p>
  <p><a href="https://blog.csdn.net/about_blockchain/article/details/78814873" rel="nofollow">https://blog.csdn.net/about_blockchain/article/details/78814873</a><br></p>
  <p>本文参考官网教程：<a href="https://github.com/jpmorganchase/quorum-examples/tree/master/examples/7nodes" rel="nofollow">https://github.com/jpmorganchase/quorum-examples/tree/master/examples/7nodes</a></p>
  <p>官网教程中创建了7个节点，由这7个节点来模拟联盟链网络。</p>
  <p>作为联盟链，节点接入是有权限要求的，通过<span style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">permissioned-nodes.json文件和<span style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">permissioned参数来控制哪些节点可以和本节点建立连接，后面会详解。对原来教程中有些比较省略，本文会将一些省略的地方介绍。</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">一、下载资源</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">1、首先安装quorum</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;background-color:rgb(246,248,250);">git </span><span class="hljs-keyword" style="font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;">clone</span><span style="color:rgb(0,0,0);font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;background-color:rgb(246,248,250);"> --recursive https:</span><span class="hljs-comment" style="font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;">//github.com/jpmorganchase/quorum.git</span><br></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span class="hljs-comment" style="font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;">cd quorum</span></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span class="hljs-comment" style="font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;">make all</span></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">编译完后，</span></span><span style="background-color:rgb(255,255,255);font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;text-align:justify;">quorum/build/bin目录下会生成如下文件列表</span><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"></span></span></p>
  <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">abigen bootnode evm examples faucet geth p2psim puppeth rlpdump swarm wnode</p>
  <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">将上面这些加入系统path中。</p>
  <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">2、获取costellation-node可执行文件</p>
  <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><a href="https://github.com/jpmorganchase/constellation/releases" rel="nofollow"><span style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"></span>https://github.com/jpmorganchase/constellation/releases</a><span style="background-color:rgb(255,255,255);"></span><br></p>
  <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">下载下来后解压，得到constellation-node，加入系统PATH中。</p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">3、下载教程样例：</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"></span></span></p>
  <pre style="font-family:'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13.6px;line-height:1.45;background-color:rgb(246,248,250);color:rgb(36,41,46);">git clone https://github.com/jpmorganchase/quorum-examples</pre>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><br></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">二、搭建raft共识的联盟链</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">因为联盟间一般是存在信任关系，因此可以使用raft共识算法，这个算法可以容忍节点挂掉，但不能容忍拜占庭错误，即不能存在恶意节点。这样就不用以太坊中的pow算法了，节省cup、内存，而且出块时间块。另外，这个算法中不会存在空块，节省大量空间，如果没有交易，那么生成区块就暂停。</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">1、初始化，创建7个节点，其中1-4号节点是permissioned节点，即这些节点只允许和permissioned-nodes.json中的节点建立连接，其他节点无法连接到这个节点。初始化的脚本如下：</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">raft-init.sh</span></span></p>
  <pre><code class="language-javascript">#!/bin/bash
set -u
set -e

echo "[*] Cleaning up temporary data directories"
rm -rf qdata
mkdir -p qdata/logs

echo "[*] Configuring node 1 (permissioned)"
mkdir -p qdata/dd1/{keystore,geth}
cp permissioned-nodes.json qdata/dd1/static-nodes.json
cp permissioned-nodes.json qdata/dd1/
cp keys/key1 qdata/dd1/keystore
cp raft/nodekey1 qdata/dd1/geth/nodekey
geth --datadir qdata/dd1 init genesis.json

echo "[*] Configuring node 2 (permissioned)"
mkdir -p qdata/dd2/{keystore,geth}
cp permissioned-nodes.json qdata/dd2/static-nodes.json
cp permissioned-nodes.json qdata/dd2/
cp keys/key2 qdata/dd2/keystore
cp raft/nodekey2 qdata/dd2/geth/nodekey
geth --datadir qdata/dd2 init genesis.json

echo "[*] Configuring node 3 (permissioned)"
mkdir -p qdata/dd3/{keystore,geth}
cp permissioned-nodes.json qdata/dd3/static-nodes.json
cp permissioned-nodes.json qdata/dd3/
cp keys/key6 qdata/dd3/keystore
cp keys/key3 qdata/dd3/keystore
cp raft/nodekey3 qdata/dd3/geth/nodekey
geth --datadir qdata/dd3 init genesis.json

echo "[*] Configuring node 4 (permissioned)"
mkdir -p qdata/dd4/{keystore,geth}
cp permissioned-nodes.json qdata/dd4/static-nodes.json
cp permissioned-nodes.json qdata/dd4/
cp keys/key4 qdata/dd4/keystore
cp raft/nodekey4 qdata/dd4/geth/nodekey
geth --datadir qdata/dd4 init genesis.json

echo "[*] Configuring node 5"
mkdir -p qdata/dd5/{keystore,geth}
cp permissioned-nodes.json qdata/dd5/static-nodes.json
cp keys/key5 qdata/dd5/keystore
cp raft/nodekey5 qdata/dd5/geth/nodekey
geth --datadir qdata/dd5 init genesis.json

echo "[*] Configuring node 6"
mkdir -p qdata/dd6/{keystore,geth}
cp permissioned-nodes.json qdata/dd6/static-nodes.json
cp raft/nodekey6 qdata/dd6/geth/nodekey
cp keys/key7 qdata/dd6/keystore
geth --datadir qdata/dd6 init genesis.json

echo "[*] Configuring node 7"
mkdir -p qdata/dd7/{keystore,geth}
cp permissioned-nodes.json qdata/dd7/static-nodes.json
cp raft/nodekey7 qdata/dd7/geth/nodekey
cp keys/key8 qdata/dd7/keystore
geth --datadir qdata/dd7 init genesis.json</code></pre>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">以第一个节点的配置为例解释命令：</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第一行：创建节点1的目录</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">第二行：permissioned-nodes.json中存了已经设置好的enode值，即节点的地址，通过这个值，运行geth客户端时可以将不同的节点连接起来。与普通以太坊的geth客户端不同，这里需要一个static-nodes，应该是指定和哪些节点建立连接吧。如果启动geth时不指定--permissioned，启动后本节点就会寻找static-node里面的节点建立连接。</span></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">另外，这个enode的值是与nodekey相关的，就是第五行中的nodekey文件，两者应该是一一对应的。所以第五行中将nodekey复制到这个目录中，就相当于把一个节点的唯一标识复制过去。nodekey的生成方法：运行bootnode -genkey nodekey即可生成nodekey文件，再运行bootnode -nodekey nodekey就会输出本节点的enode信息，记录下来即可。</span></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">第三行：将permissioned-node.json复制到节点1的目录下，这里面记录了哪些节点可以与本节点建立连接，不在这个列表里的节点是不能和本节点连接的。</span></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);"><span style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';background-color:rgb(255,255,255);">第四行：将一个账户文件复制到节点1下的目录，启动geth后，用eth.accounts查账户，就会显示这个文件中的账户地址。</span></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第五行：将nodekey复制到节点1目录下，它作用如上面所述。</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第六行：根据创世区块信息genesis.json初始化区块链。</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">2、启动constellation和geth节点</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">（1）constellation：可以将其看成是分布式密钥服务器、PGP加密和邮件传输代理的合并，用它来实现quorum的私有机制。</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">使用方法：生成密钥constellation-node --generatekeys node，就会生成node.pub和node.key两个密钥文件，分别是公私钥文件。如果在生成是使用密码加密，那么在启动contellation-node时是需要输入密码的，为了方便，下面的方法中不输入密码。</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">下面来看启动节点的constellation-start.sh脚本：</span></span></p>
  <pre><code class="language-javascript">#!/bin/bash
set -u
set -e

for i in {1..7}
do
    DDIR="qdata/c$i"
    mkdir -p $DDIR
    mkdir -p qdata/logs
    cp "keys/tm$i.pub" "$DDIR/tm.pub"
    cp "keys/tm$i.key" "$DDIR/tm.key"
    rm -f "$DDIR/tm.ipc"
    CMD="constellation-node --url=https://127.0.0.$i:900$i/ --port=900$i --workdir=$DDIR --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/"
    echo "$CMD &gt;&gt; qdata/logs/constellation$i.log 2&gt;&amp;1 &amp;"
    $CMD &gt;&gt; "qdata/logs/constellation$i.log" 2&gt;&amp;1 &amp;
done

DOWN=true
while $DOWN; do
    sleep 0.1
    DOWN=false
    for i in {1..7}
    do
	if [ ! -S "qdata/c$i/tm.ipc" ]; then
            DOWN=true
	fi
    done
done</code></pre>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">其中，</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第五行是代表一共启动7个节点，需要在不同的节点目录</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第7-9行：建立节点目录</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第10-11行：将之前生成的公私钥对放到对应几点目录中</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第12行：删除之前存在的旧的 .ipc文件（如果存在的话）</span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;"><span style="background-color:rgb(255,255,255);">第13行：启动constellation-node节点，具体参数参考<a href="https://github.com/jpmorganchase/constellation/blob/master/sample.conf" rel="nofollow">https://github.com/jpmorganchase/constellation/blob/master/sample.conf</a></span></span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">第15行：将控制台的输出定向到指定文件里，如果启动错误，可以去对应文件查看错误内容</span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">第18-28行：等待所有constellation-node启动完毕，其中24行 -S 是查看对应文件是否存在。</span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">可以运行./constellation-start.sh来启动测试，启动完毕后输入ps -ef | grep constellation-node可以查看进程情况，输入killall constellation-node 来终止程序运行。</span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">（2）下面来启动7个geth节点</span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">raft-start.sh</span></p>
  <pre><code class="language-javascript">#!/bin/bash
set -u
set -e

mkdir -p qdata/logs
echo "[*] Starting Constellation nodes"
./constellation-start.sh

echo "[*] Starting Ethereum nodes"
set -v
ARGS="--nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints"
PRIVATE_CONFIG=qdata/c1/tm.ipc nohup geth --datadir qdata/dd1 $ARGS --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/1.log &amp;
PRIVATE_CONFIG=qdata/c2/tm.ipc nohup geth --datadir qdata/dd2 $ARGS --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/2.log &amp;
PRIVATE_CONFIG=qdata/c3/tm.ipc nohup geth --datadir qdata/dd3 $ARGS --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/3.log &amp;
PRIVATE_CONFIG=qdata/c4/tm.ipc nohup geth --datadir qdata/dd4 $ARGS --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/4.log &amp;
PRIVATE_CONFIG=qdata/c5/tm.ipc nohup geth --datadir qdata/dd5 $ARGS --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/5.log &amp;
PRIVATE_CONFIG=qdata/c6/tm.ipc nohup geth --datadir qdata/dd6 $ARGS --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/6.log &amp;
PRIVATE_CONFIG=qdata/c7/tm.ipc nohup geth --datadir qdata/dd7 $ARGS --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt 2&gt;&gt;qdata/logs/7.log &amp;
set +v

echo
echo "All nodes configured. See 'qdata/logs' for logs, and run e.g. 'geth attach qdata/dd1/geth.ipc' to attach to the first Geth node."
echo "To test sending a private transaction from Node 1 to Node 7, run './runscript.sh private-contract.js'"</code></pre>
  <p>其中</p>
  <p>第7行：调用上面写的constellation-start.sh脚本，启动7个constellation</p>
  <p>第11行：启动geth节点需要的参数，这里需要制定--raft来使用raft共识方法</p>
  <p>第12-18行，启动7个geth节点，需要指定raftport端口号，用 --permissioned参数来指定那些节点是有连接权限的。</p>
  <p><br></p>
  <p>这样，constellation-node和geth节点都启动起来了，也就是环境已经搭建好了，可以在上面开发了。开发之前先做一下测试。</p>
  <p>3、测试环境</p>
  <pre><code class="language-javascript">zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef | grep constellation-node
zhj      17150  2994  4 09:23 pts/3    00:00:03 constellation-node --url=https://127.0.0.1:9001/ --port=9001 --workdir=qdata/c1 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17174  2994  3 09:23 pts/3    00:00:02 constellation-node --url=https://127.0.0.2:9002/ --port=9002 --workdir=qdata/c2 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17200  2994  3 09:23 pts/3    00:00:02 constellation-node --url=https://127.0.0.3:9003/ --port=9003 --workdir=qdata/c3 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17218  2994  3 09:23 pts/3    00:00:03 constellation-node --url=https://127.0.0.4:9004/ --port=9004 --workdir=qdata/c4 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17226  2994  3 09:23 pts/3    00:00:03 constellation-node --url=https://127.0.0.5:9005/ --port=9005 --workdir=qdata/c5 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17265  2994  4 09:23 pts/3    00:00:03 constellation-node --url=https://127.0.0.6:9006/ --port=9006 --workdir=qdata/c6 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17282  2994  3 09:23 pts/3    00:00:03 constellation-node --url=https://127.0.0.7:9007/ --port=9007 --workdir=qdata/c7 --socket=tm.ipc --publickeys=tm.pub --privatekeys=tm.key --othernodes=https://127.0.0.1:9001/
zhj      17690 11030  0 09:24 pts/6    00:00:00 grep --color=auto constellation-node
</code></pre>
  <pre><code class="language-javascript">zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ ps -ef |grep geth
zhj      17354  2994  1 09:23 pts/3    00:00:05 geth --datadir qdata/dd1 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50401 --rpcport 22000 --port 21000 --unlock 0 --password passwords.txt
zhj      17355  2994  1 09:23 pts/3    00:00:05 geth --datadir qdata/dd2 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50402 --rpcport 22001 --port 21001 --unlock 0 --password passwords.txt
zhj      17356  2994  2 09:23 pts/3    00:00:08 geth --datadir qdata/dd3 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50403 --rpcport 22002 --port 21002 --unlock 0 --password passwords.txt
zhj      17357  2994  1 09:23 pts/3    00:00:05 geth --datadir qdata/dd4 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --permissioned --raftport 50404 --rpcport 22003 --port 21003 --unlock 0 --password passwords.txt
zhj      17358  2994  1 09:23 pts/3    00:00:05 geth --datadir qdata/dd5 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50405 --rpcport 22004 --port 21004 --unlock 0 --password passwords.txt
zhj      17359  2994  1 09:23 pts/3    00:00:04 geth --datadir qdata/dd6 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50406 --rpcport 22005 --port 21005 --unlock 0 --password passwords.txt
zhj      17360  2994  1 09:23 pts/3    00:00:04 geth --datadir qdata/dd7 --nodiscover --raft --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum --emitcheckpoints --raftport 50407 --rpcport 22006 --port 21006 --unlock 0 --password passwords.txt
zhj      17946 11030  0 09:29 pts/6    00:00:00 grep --color=auto geth</code></pre>
  <p>说明节点都已正常运行，下面连接第一个节点的geth控制台：</p>
  <p>输入geth attach qdata/dd1/geth.ipc，查看基本信息：</p>
  <pre><code class="language-javascript">zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd1/geth.ipc
Welcome to the Geth JavaScript console!

instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1
coinbase: 0xed9d02e382b34818e88b88a309c7fe71e65f419d
at block: 0 (Thu, 01 Jan 1970 08:00:00 CST)
 datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd1
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0

&gt; eth.accounts
["0xed9d02e382b34818e88b88a309c7fe71e65f419d"]
&gt; acc0 = eth.accounts[0]
"0xed9d02e382b34818e88b88a309c7fe71e65f419d"
&gt; eth.getBalance(acc0)
1e+27
&gt; eth.blockNumber
0</code></pre>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">可以看到有一个账户地址，就是复制进去的账户，里面有余额（在创世文件里设置的），现在的区块数目是0，现在没有交易，是不产生区块的，下面进行发送一笔交易。</span></p>
  <p><span style="font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';color:#24292e;">连接第7个节点的geth控制台，查看账户和余额：</span></p>
  <pre><code class="language-javascript">zhj@zhj-HP:~/project/test_chain/quorum/quorum-examples/examples/7nodes$ geth attach qdata/dd7/geth.ipc 
Welcome to the Geth JavaScript console!

instance: Geth/v1.7.2-stable-fd0e3b9d/linux-amd64/go1.10.1
coinbase: 0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a
at block: 0 (Thu, 01 Jan 1970 08:00:00 CST)
 datadir: /home/zhj/project/test_chain/quorum/quorum-examples/examples/7nodes/qdata/dd7
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 raft:1.0 rpc:1.0 txpool:1.0 web3:1.0

&gt; eth.accounts
["0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a"]
&gt; acc0 =eth.accounts[0]
"0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a"
&gt; eth.getBalance(acc0)
0</code></pre>
  <p>然后从节点1的账户发送一笔钱到节点7的账户：</p>
  <pre><code class="language-javascript">&gt; eth.sendTransaction({from:acc0, to:"0xa9e871f88cbeb870d32d88e4221dcfbd36dd635a", value: 100000})
"0xa0da7ef1632361e7b4d37f5258598bce0bbb074935c613c7e565a2c93964807f"</code></pre>
  <p>这时查看账户7的余额：</p>
  <pre><code class="language-javascript">&gt; eth.getBalance(acc0)
100000</code></pre>
  <p>再查看区块数目：</p>
  <pre><code class="language-javascript">&gt; eth.blockNumber
1</code></pre>
  <p>可以看到因为这笔交易已经生成了一个区块。</p>
  <p>如果要发送一笔私有交易，可以用privateFor来指定，例如节点1账户发送一笔私有交易给节点2的账户：</p>
  <pre><code class="language-javascript">&gt;eth.sendTransaction({from: acc0, to: acc1, value: 10000, privateFor:["QfeDAys9MPDs2XHExtc84jKGHxZg/aj52DTh0vtA3Xc="]})
"0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff"</code></pre>
  <br>
  <p>其中acc0是节点1的账户，acc1是节点2的账户，privateFor后面的地址是tm2.pub中的内容,返回的交易的地址，下面查看这笔交易：</p>
  <pre><code class="language-javascript">&gt; eth.getTransaction("0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff")
{
  blockHash: "0x6e74d807e1951e168489e54b23dd39f367f62312b1463a160c8730ad360f48bf",
  blockNumber: 1,
  from: "0xed9d02e382b34818e88b88a309c7fe71e65f419d",
  gas: 90000,
  gasPrice: 18000000000,
  hash: "0x241c0d71035cce2891e82a883d010bbf0151e79fc3aace8966a626cf0598e7ff",
  input: "0x33e358398b2bc693db176718211e9a80b2d2cf58df79e7a760c9b68baa2f41d95a5bec625b3f3eb3b0bb996afb6692e8187164fed745ebd726abd74455895d90",
  nonce: 0,
  r: "0xfa734439ccc3f8d54f22a012703d951a0891c2914b1361967e3f755466f778b6",
  s: "0x79ba2235b3d049e3132a32e4bac3d6023f3c460875d098a61c6c829d3c65af7f",
  to: "0xca843569e3427144cead5e4d5999a3d0ccf92b8e",
  transactionIndex: 0,
  v: "0x25",
  value: 100000
}</code></pre>
  <p>其中倒数第二行的v字段值是0x25，即37。当值为37、 38时代表是一笔私有交易。</p>
  <p>（7.13补充：我又试了一下，现在quorum还不支持私有交易发送以太币，上面这笔私有交易可以成功发送并被记录在区块里，但是查一下双方的余额时，发现都没有改变。github上开发者是这么说的：<a href="https://github.com/jpmorganchase/quorum-examples/issues/109" rel="nofollow">链接</a>。但是私有合约可以正常执行，下一篇文章中有具体介绍）</p>
  <p>本篇到此结束，下一篇文章介绍在quorum上部署和执行智能合约。</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhj_fly/article/details/80560744,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zhj_fly/article/details/80560744,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>PeckShield CEO 蒋旭宪：智能合约安全问题不可怕，预防和响应机制才是关键 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="PeckShield CEO 蒋旭宪：智能合约安全问题不可怕，预防和响应机制才是关键" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="2018年6月3日，由中国IT技术社区CSDN和专注以太坊生态建设的领先企业灵钛科技主办，以太坊爱好者社区、柏链道捷、火星财经、金色财经、Unitimes、区块链大本营协办的「2018以太坊技术及应用大会·中国」在北京·悠唐皇冠假日酒店隆重举行。 本次大会围绕以太坊生态、以太坊核心技术、以太坊优质应用展开，邀请了众多国内外顶级开发者、以太坊团队核心成员，以及顶级项目负责人齐聚于此，共同助力中国以太坊技术深度交流和社区发展。 作为本届大会的演讲嘉宾，PeckShield创始人兼CEO蒋旭宪在上午的会议中发表了题为《Code Is Law：以太坊智能合约面临的威胁与挑战》的演讲。 蒋旭宪，PeckShield创始人兼CEO， 前360首席科学家和美国北卡州立大学终身教授。致力于改善区块链生态安全，隐私和可用性。公司最近接连发现并命名了BEC、SMT、和EDU等智能合约上的重大安全漏洞。 以下蒋旭宪的演讲实录： 感谢主办方，让我荣幸参加这个社区活动，有机会与大家分享我们团队最近做的关于以太坊智能合约所面临的威胁和挑战。 第一部分，简单介绍以太坊生态现状。 第二部分，讨论制约合约的安全问题。 第三部分，下一步思考：保护措施和防范机制。 一、以太坊生态现状 首先，引用一个网站做的分析报告：2017年一年部署上线了超过1000多个去中心化的应用，同时有超过700多个不同的交易所可以交易代币。 这个生态确实很有吸引力：平均每天有10万的新用户加入以太坊生态圈，加入的用户非常活跃，平均每天在以太坊上的日均交易超过100万次。这是非常惊人的数据，也说明社区非常有活力，这也解释了为什么现在数字加密货币的市场如此火暴。 引用国外网站CoinMarketCap的数据，它统计了1640个虚拟货币的市场规模，市值超过了3300亿美元。与各国GDP相比的话，这个市场规模在全球可以排到第28位，其中的很大一部分原因是得益于以太坊部署。 二、智能合约的安全问题 每个发行的币都会在以太坊上部署一个智能合约 。智能合约掌控着代币的发行、相互之间的转换。 这里我列出从2015年8月份到最近一个月的数据，这个数据表明每个月新部署的智能合约数据，大家可以看看以太坊的火暴时间段跟这个是否吻合？ 蒋涛分享到它最火暴的时候，也就是中国开发者加入的时候，是在2017年的下半年，跟这里智能合约的部署是吻合的。智能合约部署是2017年5月份开始获得了长足增长，增长的数据在2017年9月份开始下滑，但2017年10月份数据又得到长足增长，然后慢慢稳定下来，到2018年的4月份数据慢慢降落了。 大家能够猜到2017年9月份发生了什么事件。这说明国家政策的监管对于以太坊的智能合约部署或代币发行所起到的作用是相当大的。 而且，这个发展的背后还伴随着我们所不想看到的安全事件。 这些安全事件在区块链的各个环节，包括：交易所、矿池、钱包、智能合约 。 关于交易所，今年3月份交易所被攻击的事件； 关于矿池，在上个月遭到了51%算力的攻击，发生了“双花现象”； 关于钱包，2018年4月份全球最大的基于网页的数字钱包域名被劫持； 关于智能合约 ，以太坊最明显的攻击，2018年4月份有关于美链等智能合约的漏洞，5月份有关于EDU等智能合约的漏洞 。 已公开的漏洞直接影响各大交易所，包括停止代币的发行、充值或提现。目前还有不少未公开的漏洞 ，我们会联系相关的项目方和相关交易所，逐步跟他们验证相关的数据。 因为这个是开发者社区，接下来我们会挑两个例子，跟大家分享一下漏洞的原理。希望大家以后在做项目开发时，就能够避免出现相关的问题： 第一个漏洞 ，是关于transferFlaw，也就是大家所理解的偷币漏洞 。如果用户持有一个代币，而它背后对应的智能合约出现这样安全漏洞，攻击者就可以把这些代币从你的钱包里全部转走。 这里列出了一个有漏洞的transferFlaw，其中有三个参数，这是交易的数值，代码49-51行是做初步的检查，以确保这个参数是有效的；53行和54行计算了转出方本身所有的余额，并保存在fromBalance，同时统计了这次允许转出的额度；根据计算出来的变量，在56行和57行，跟当前交易的数值做比较，然后计算两个条件判断：本次交易转出方是否有足够的帐户余额允许做交易，转出方是否有足够的授权来做交易。大家需要关注一下第58行代码，只是简单验证一下：如果把这部分钱或者代币转入转入方，转入方的余额会不会造成溢出。这三个条件加起来就是代码行满足条件下授权这次交易。 大家能够意识到代码行里的判断条件，特别是在56行，如果判断交易的转出方有足够余额，后面的fromBalance不是小于等于value，应该是大于等于value；57行应该是也大于等于value；58行不应该是大于，而应该是小于。 我放一个简单的视频，这里有两个数字钱包：左边数字钱包是一个普通用户的，他有1.2345个UET代币，是我们自己花钱去买的；右边的数字钱包是攻击者的，攻击者开始的代币余额是零。攻击发生的时候，这些UET代币为什么就从用户的数字钱包转到了攻击者钱包的？因为这个漏洞的存在，即使这个用户用的是冷钱包，这些钱也都可以被转走。大家关注一下这个余额的情况，从用户手上转到了攻击者手上。 第二个漏洞是multiOverflow。前面那笔是普通的交易，从转出方转入转入方。但交易一次一次去做的话，可能会引起比较高的交易费用，transferMulti函数的作用就是把多笔的单笔交易组成一个批处理。 它有两个参数，就是转入方和转入的数值。 这里面拥有多笔交易，它做成数组，代码行247和248数值长度是一样的，这是有效的数据，数值长度就变成当前有多少个单笔交易。 代码行249-251相当于把这些要转出的交易的数值做了一个加法，获取总值之后判断转出方是否有足够的余额去授权管理。但因为这个漏洞存在，能够感觉到这个变量有可能溢出，有可能变成零。 假设这个数值有两个地址，一个1、一个2，数值等于2的255次方，2个255次方相加得到256次方，造成的条件相当于转出方的余额大于等于1；后面的循环会把单笔交易的value转到转入方，同时转出方做相减，转出方加这个值等于2的255次方，形成无限生成代币漏洞 。 我们发现有几家正在做的项目已经受到影响，我们第一时间跟他们同步，他们马上更换了智能合约 ，把漏洞做了修改，重新部署上线。 这是转帐的视频，两个手机和钱包都是攻击者的，开始的余额全是零。大家看看余额的变化情况，这么大的数值相当于2的255次方。 看到这个漏洞大家不要觉得很恐慌，最主要的是要开始思考在资产上线可能面临的安全风险。 三、下一步思考：保护措施和防范机制 在资产上线时，一定要考虑到保护措施和防范机制： 第一，上线前一定要对智能合约做相对完整和客观的审计。 第二，上线后一定要注意应急响应。 比如监控你们的智能合约有没有可能有异常交易情况，把这个放到应急响应去，第一时间就知道这个智能合约是否被攻击了。同时，开发业务项目方里有应急响应团队，可以及时做出反应。 第三，希望项目方和交易所有相应的漏洞奖励计划，形成一个健康的生态。 注：为方便大家及时回顾大会嘉宾演讲信息，文章成稿速度较快，其中难免会有一些纰漏，欢迎您及时指出，相关建议请发送至邮箱：puge@csdn.net，非常感谢！后续我们还将在区块链大本营公众号（ID：blockchain_camp）陆续推出精编文章，敬请关注。 阅读更多" />
<meta property="og:description" content="2018年6月3日，由中国IT技术社区CSDN和专注以太坊生态建设的领先企业灵钛科技主办，以太坊爱好者社区、柏链道捷、火星财经、金色财经、Unitimes、区块链大本营协办的「2018以太坊技术及应用大会·中国」在北京·悠唐皇冠假日酒店隆重举行。 本次大会围绕以太坊生态、以太坊核心技术、以太坊优质应用展开，邀请了众多国内外顶级开发者、以太坊团队核心成员，以及顶级项目负责人齐聚于此，共同助力中国以太坊技术深度交流和社区发展。 作为本届大会的演讲嘉宾，PeckShield创始人兼CEO蒋旭宪在上午的会议中发表了题为《Code Is Law：以太坊智能合约面临的威胁与挑战》的演讲。 蒋旭宪，PeckShield创始人兼CEO， 前360首席科学家和美国北卡州立大学终身教授。致力于改善区块链生态安全，隐私和可用性。公司最近接连发现并命名了BEC、SMT、和EDU等智能合约上的重大安全漏洞。 以下蒋旭宪的演讲实录： 感谢主办方，让我荣幸参加这个社区活动，有机会与大家分享我们团队最近做的关于以太坊智能合约所面临的威胁和挑战。 第一部分，简单介绍以太坊生态现状。 第二部分，讨论制约合约的安全问题。 第三部分，下一步思考：保护措施和防范机制。 一、以太坊生态现状 首先，引用一个网站做的分析报告：2017年一年部署上线了超过1000多个去中心化的应用，同时有超过700多个不同的交易所可以交易代币。 这个生态确实很有吸引力：平均每天有10万的新用户加入以太坊生态圈，加入的用户非常活跃，平均每天在以太坊上的日均交易超过100万次。这是非常惊人的数据，也说明社区非常有活力，这也解释了为什么现在数字加密货币的市场如此火暴。 引用国外网站CoinMarketCap的数据，它统计了1640个虚拟货币的市场规模，市值超过了3300亿美元。与各国GDP相比的话，这个市场规模在全球可以排到第28位，其中的很大一部分原因是得益于以太坊部署。 二、智能合约的安全问题 每个发行的币都会在以太坊上部署一个智能合约 。智能合约掌控着代币的发行、相互之间的转换。 这里我列出从2015年8月份到最近一个月的数据，这个数据表明每个月新部署的智能合约数据，大家可以看看以太坊的火暴时间段跟这个是否吻合？ 蒋涛分享到它最火暴的时候，也就是中国开发者加入的时候，是在2017年的下半年，跟这里智能合约的部署是吻合的。智能合约部署是2017年5月份开始获得了长足增长，增长的数据在2017年9月份开始下滑，但2017年10月份数据又得到长足增长，然后慢慢稳定下来，到2018年的4月份数据慢慢降落了。 大家能够猜到2017年9月份发生了什么事件。这说明国家政策的监管对于以太坊的智能合约部署或代币发行所起到的作用是相当大的。 而且，这个发展的背后还伴随着我们所不想看到的安全事件。 这些安全事件在区块链的各个环节，包括：交易所、矿池、钱包、智能合约 。 关于交易所，今年3月份交易所被攻击的事件； 关于矿池，在上个月遭到了51%算力的攻击，发生了“双花现象”； 关于钱包，2018年4月份全球最大的基于网页的数字钱包域名被劫持； 关于智能合约 ，以太坊最明显的攻击，2018年4月份有关于美链等智能合约的漏洞，5月份有关于EDU等智能合约的漏洞 。 已公开的漏洞直接影响各大交易所，包括停止代币的发行、充值或提现。目前还有不少未公开的漏洞 ，我们会联系相关的项目方和相关交易所，逐步跟他们验证相关的数据。 因为这个是开发者社区，接下来我们会挑两个例子，跟大家分享一下漏洞的原理。希望大家以后在做项目开发时，就能够避免出现相关的问题： 第一个漏洞 ，是关于transferFlaw，也就是大家所理解的偷币漏洞 。如果用户持有一个代币，而它背后对应的智能合约出现这样安全漏洞，攻击者就可以把这些代币从你的钱包里全部转走。 这里列出了一个有漏洞的transferFlaw，其中有三个参数，这是交易的数值，代码49-51行是做初步的检查，以确保这个参数是有效的；53行和54行计算了转出方本身所有的余额，并保存在fromBalance，同时统计了这次允许转出的额度；根据计算出来的变量，在56行和57行，跟当前交易的数值做比较，然后计算两个条件判断：本次交易转出方是否有足够的帐户余额允许做交易，转出方是否有足够的授权来做交易。大家需要关注一下第58行代码，只是简单验证一下：如果把这部分钱或者代币转入转入方，转入方的余额会不会造成溢出。这三个条件加起来就是代码行满足条件下授权这次交易。 大家能够意识到代码行里的判断条件，特别是在56行，如果判断交易的转出方有足够余额，后面的fromBalance不是小于等于value，应该是大于等于value；57行应该是也大于等于value；58行不应该是大于，而应该是小于。 我放一个简单的视频，这里有两个数字钱包：左边数字钱包是一个普通用户的，他有1.2345个UET代币，是我们自己花钱去买的；右边的数字钱包是攻击者的，攻击者开始的代币余额是零。攻击发生的时候，这些UET代币为什么就从用户的数字钱包转到了攻击者钱包的？因为这个漏洞的存在，即使这个用户用的是冷钱包，这些钱也都可以被转走。大家关注一下这个余额的情况，从用户手上转到了攻击者手上。 第二个漏洞是multiOverflow。前面那笔是普通的交易，从转出方转入转入方。但交易一次一次去做的话，可能会引起比较高的交易费用，transferMulti函数的作用就是把多笔的单笔交易组成一个批处理。 它有两个参数，就是转入方和转入的数值。 这里面拥有多笔交易，它做成数组，代码行247和248数值长度是一样的，这是有效的数据，数值长度就变成当前有多少个单笔交易。 代码行249-251相当于把这些要转出的交易的数值做了一个加法，获取总值之后判断转出方是否有足够的余额去授权管理。但因为这个漏洞存在，能够感觉到这个变量有可能溢出，有可能变成零。 假设这个数值有两个地址，一个1、一个2，数值等于2的255次方，2个255次方相加得到256次方，造成的条件相当于转出方的余额大于等于1；后面的循环会把单笔交易的value转到转入方，同时转出方做相减，转出方加这个值等于2的255次方，形成无限生成代币漏洞 。 我们发现有几家正在做的项目已经受到影响，我们第一时间跟他们同步，他们马上更换了智能合约 ，把漏洞做了修改，重新部署上线。 这是转帐的视频，两个手机和钱包都是攻击者的，开始的余额全是零。大家看看余额的变化情况，这么大的数值相当于2的255次方。 看到这个漏洞大家不要觉得很恐慌，最主要的是要开始思考在资产上线可能面临的安全风险。 三、下一步思考：保护措施和防范机制 在资产上线时，一定要考虑到保护措施和防范机制： 第一，上线前一定要对智能合约做相对完整和客观的审计。 第二，上线后一定要注意应急响应。 比如监控你们的智能合约有没有可能有异常交易情况，把这个放到应急响应去，第一时间就知道这个智能合约是否被攻击了。同时，开发业务项目方里有应急响应团队，可以及时做出反应。 第三，希望项目方和交易所有相应的漏洞奖励计划，形成一个健康的生态。 注：为方便大家及时回顾大会嘉宾演讲信息，文章成稿速度较快，其中难免会有一些纰漏，欢迎您及时指出，相关建议请发送至邮箱：puge@csdn.net，非常感谢！后续我们还将在区块链大本营公众号（ID：blockchain_camp）陆续推出精编文章，敬请关注。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/06/03/c3c397b07bb3ef34b7e2837b605d8b97.html" />
<meta property="og:url" content="https://mlh.app/2018/06/03/c3c397b07bb3ef34b7e2837b605d8b97.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-03T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"2018年6月3日，由中国IT技术社区CSDN和专注以太坊生态建设的领先企业灵钛科技主办，以太坊爱好者社区、柏链道捷、火星财经、金色财经、Unitimes、区块链大本营协办的「2018以太坊技术及应用大会·中国」在北京·悠唐皇冠假日酒店隆重举行。 本次大会围绕以太坊生态、以太坊核心技术、以太坊优质应用展开，邀请了众多国内外顶级开发者、以太坊团队核心成员，以及顶级项目负责人齐聚于此，共同助力中国以太坊技术深度交流和社区发展。 作为本届大会的演讲嘉宾，PeckShield创始人兼CEO蒋旭宪在上午的会议中发表了题为《Code Is Law：以太坊智能合约面临的威胁与挑战》的演讲。 蒋旭宪，PeckShield创始人兼CEO， 前360首席科学家和美国北卡州立大学终身教授。致力于改善区块链生态安全，隐私和可用性。公司最近接连发现并命名了BEC、SMT、和EDU等智能合约上的重大安全漏洞。 以下蒋旭宪的演讲实录： 感谢主办方，让我荣幸参加这个社区活动，有机会与大家分享我们团队最近做的关于以太坊智能合约所面临的威胁和挑战。 第一部分，简单介绍以太坊生态现状。 第二部分，讨论制约合约的安全问题。 第三部分，下一步思考：保护措施和防范机制。 一、以太坊生态现状 首先，引用一个网站做的分析报告：2017年一年部署上线了超过1000多个去中心化的应用，同时有超过700多个不同的交易所可以交易代币。 这个生态确实很有吸引力：平均每天有10万的新用户加入以太坊生态圈，加入的用户非常活跃，平均每天在以太坊上的日均交易超过100万次。这是非常惊人的数据，也说明社区非常有活力，这也解释了为什么现在数字加密货币的市场如此火暴。 引用国外网站CoinMarketCap的数据，它统计了1640个虚拟货币的市场规模，市值超过了3300亿美元。与各国GDP相比的话，这个市场规模在全球可以排到第28位，其中的很大一部分原因是得益于以太坊部署。 二、智能合约的安全问题 每个发行的币都会在以太坊上部署一个智能合约 。智能合约掌控着代币的发行、相互之间的转换。 这里我列出从2015年8月份到最近一个月的数据，这个数据表明每个月新部署的智能合约数据，大家可以看看以太坊的火暴时间段跟这个是否吻合？ 蒋涛分享到它最火暴的时候，也就是中国开发者加入的时候，是在2017年的下半年，跟这里智能合约的部署是吻合的。智能合约部署是2017年5月份开始获得了长足增长，增长的数据在2017年9月份开始下滑，但2017年10月份数据又得到长足增长，然后慢慢稳定下来，到2018年的4月份数据慢慢降落了。 大家能够猜到2017年9月份发生了什么事件。这说明国家政策的监管对于以太坊的智能合约部署或代币发行所起到的作用是相当大的。 而且，这个发展的背后还伴随着我们所不想看到的安全事件。 这些安全事件在区块链的各个环节，包括：交易所、矿池、钱包、智能合约 。 关于交易所，今年3月份交易所被攻击的事件； 关于矿池，在上个月遭到了51%算力的攻击，发生了“双花现象”； 关于钱包，2018年4月份全球最大的基于网页的数字钱包域名被劫持； 关于智能合约 ，以太坊最明显的攻击，2018年4月份有关于美链等智能合约的漏洞，5月份有关于EDU等智能合约的漏洞 。 已公开的漏洞直接影响各大交易所，包括停止代币的发行、充值或提现。目前还有不少未公开的漏洞 ，我们会联系相关的项目方和相关交易所，逐步跟他们验证相关的数据。 因为这个是开发者社区，接下来我们会挑两个例子，跟大家分享一下漏洞的原理。希望大家以后在做项目开发时，就能够避免出现相关的问题： 第一个漏洞 ，是关于transferFlaw，也就是大家所理解的偷币漏洞 。如果用户持有一个代币，而它背后对应的智能合约出现这样安全漏洞，攻击者就可以把这些代币从你的钱包里全部转走。 这里列出了一个有漏洞的transferFlaw，其中有三个参数，这是交易的数值，代码49-51行是做初步的检查，以确保这个参数是有效的；53行和54行计算了转出方本身所有的余额，并保存在fromBalance，同时统计了这次允许转出的额度；根据计算出来的变量，在56行和57行，跟当前交易的数值做比较，然后计算两个条件判断：本次交易转出方是否有足够的帐户余额允许做交易，转出方是否有足够的授权来做交易。大家需要关注一下第58行代码，只是简单验证一下：如果把这部分钱或者代币转入转入方，转入方的余额会不会造成溢出。这三个条件加起来就是代码行满足条件下授权这次交易。 大家能够意识到代码行里的判断条件，特别是在56行，如果判断交易的转出方有足够余额，后面的fromBalance不是小于等于value，应该是大于等于value；57行应该是也大于等于value；58行不应该是大于，而应该是小于。 我放一个简单的视频，这里有两个数字钱包：左边数字钱包是一个普通用户的，他有1.2345个UET代币，是我们自己花钱去买的；右边的数字钱包是攻击者的，攻击者开始的代币余额是零。攻击发生的时候，这些UET代币为什么就从用户的数字钱包转到了攻击者钱包的？因为这个漏洞的存在，即使这个用户用的是冷钱包，这些钱也都可以被转走。大家关注一下这个余额的情况，从用户手上转到了攻击者手上。 第二个漏洞是multiOverflow。前面那笔是普通的交易，从转出方转入转入方。但交易一次一次去做的话，可能会引起比较高的交易费用，transferMulti函数的作用就是把多笔的单笔交易组成一个批处理。 它有两个参数，就是转入方和转入的数值。 这里面拥有多笔交易，它做成数组，代码行247和248数值长度是一样的，这是有效的数据，数值长度就变成当前有多少个单笔交易。 代码行249-251相当于把这些要转出的交易的数值做了一个加法，获取总值之后判断转出方是否有足够的余额去授权管理。但因为这个漏洞存在，能够感觉到这个变量有可能溢出，有可能变成零。 假设这个数值有两个地址，一个1、一个2，数值等于2的255次方，2个255次方相加得到256次方，造成的条件相当于转出方的余额大于等于1；后面的循环会把单笔交易的value转到转入方，同时转出方做相减，转出方加这个值等于2的255次方，形成无限生成代币漏洞 。 我们发现有几家正在做的项目已经受到影响，我们第一时间跟他们同步，他们马上更换了智能合约 ，把漏洞做了修改，重新部署上线。 这是转帐的视频，两个手机和钱包都是攻击者的，开始的余额全是零。大家看看余额的变化情况，这么大的数值相当于2的255次方。 看到这个漏洞大家不要觉得很恐慌，最主要的是要开始思考在资产上线可能面临的安全风险。 三、下一步思考：保护措施和防范机制 在资产上线时，一定要考虑到保护措施和防范机制： 第一，上线前一定要对智能合约做相对完整和客观的审计。 第二，上线后一定要注意应急响应。 比如监控你们的智能合约有没有可能有异常交易情况，把这个放到应急响应去，第一时间就知道这个智能合约是否被攻击了。同时，开发业务项目方里有应急响应团队，可以及时做出反应。 第三，希望项目方和交易所有相应的漏洞奖励计划，形成一个健康的生态。 注：为方便大家及时回顾大会嘉宾演讲信息，文章成稿速度较快，其中难免会有一些纰漏，欢迎您及时指出，相关建议请发送至邮箱：puge@csdn.net，非常感谢！后续我们还将在区块链大本营公众号（ID：blockchain_camp）陆续推出精编文章，敬请关注。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/06/03/c3c397b07bb3ef34b7e2837b605d8b97.html","headline":"PeckShield CEO 蒋旭宪：智能合约安全问题不可怕，预防和响应机制才是关键","dateModified":"2018-06-03T00:00:00+08:00","datePublished":"2018-06-03T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/06/03/c3c397b07bb3ef34b7e2837b605d8b97.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>PeckShield CEO 蒋旭宪：智能合约安全问题不可怕，预防和响应机制才是关键</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>2018年6月3日，由中国IT技术社区CSDN和专注以太坊生态建设的领先企业灵钛科技主办，以太坊爱好者社区、柏链道捷、火星财经、金色财经、Unitimes、区块链大本营协办的「2018以太坊技术及应用大会·中国」在北京·悠唐皇冠假日酒店隆重举行。</p> 
  <p>本次大会围绕以太坊生态、以太坊核心技术、以太坊优质应用展开，邀请了众多国内外顶级开发者、以太坊团队核心成员，以及顶级项目负责人齐聚于此，共同助力中国以太坊技术深度交流和社区发展。</p> 
  <p>作为本届大会的演讲嘉宾，PeckShield创始人兼CEO蒋旭宪在上午的会议中发表了题为《Code Is Law：以太坊智能合约面临的威胁与挑战》的演讲。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180603123619937?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Jsb2NrY2hhaW5fbGVtb24=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p> 
  <blockquote> 
   <p><strong><font color="#007aaa">蒋旭宪，PeckShield创始人兼CEO， 前360首席科学家和美国北卡州立大学终身教授。致力于改善区块链生态安全，隐私和可用性。公司最近接连发现并命名了BEC、SMT、和EDU等智能合约上的重大安全漏洞。</font></strong></p> 
  </blockquote> 
  <p><strong><font color="#007aaa">以下蒋旭宪的演讲实录：</font></strong></p> 
  <p>感谢主办方，让我荣幸参加这个社区活动，有机会与大家分享我们团队最近做的关于以太坊智能合约所面临的威胁和挑战。</p> 
  <p>第一部分，简单介绍以太坊生态现状。 <br> 第二部分，讨论制约合约的安全问题。 <br> 第三部分，下一步思考：保护措施和防范机制。</p> 
  <p><strong>一、以太坊生态现状</strong></p> 
  <p>首先，引用一个网站做的分析报告：2017年一年部署上线了超过1000多个去中心化的应用，同时有超过700多个不同的交易所可以交易代币。</p> 
  <p>这个生态确实很有吸引力：平均每天有10万的新用户加入以太坊生态圈，加入的用户非常活跃，平均每天在以太坊上的日均交易超过100万次。这是非常惊人的数据，也说明社区非常有活力，这也解释了为什么现在数字加密货币的市场如此火暴。</p> 
  <p>引用国外网站CoinMarketCap的数据，它统计了1640个虚拟货币的市场规模，市值超过了3300亿美元。与各国GDP相比的话，这个市场规模在全球可以排到第28位，其中的很大一部分原因是得益于以太坊部署。</p> 
  <p><strong>二、智能合约的安全问题</strong></p> 
  <p>每个发行的币都会在以太坊上部署一个智能合约 。智能合约掌控着代币的发行、相互之间的转换。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180603123849616?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Jsb2NrY2hhaW5fbGVtb24=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br> 这里我列出从2015年8月份到最近一个月的数据，这个数据表明每个月新部署的智能合约数据，大家可以看看以太坊的火暴时间段跟这个是否吻合？</p> 
  <p>蒋涛分享到它最火暴的时候，也就是中国开发者加入的时候，是在2017年的下半年，跟这里智能合约的部署是吻合的。智能合约部署是2017年5月份开始获得了长足增长，增长的数据在2017年9月份开始下滑，但2017年10月份数据又得到长足增长，然后慢慢稳定下来，到2018年的4月份数据慢慢降落了。</p> 
  <p>大家能够猜到2017年9月份发生了什么事件。这说明国家政策的监管对于以太坊的智能合约部署或代币发行所起到的作用是相当大的。</p> 
  <p>而且，这个发展的背后还伴随着我们所不想看到的安全事件。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180603123913356?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Jsb2NrY2hhaW5fbGVtb24=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br> 这些安全事件在区块链的各个环节，包括：交易所、矿池、钱包、智能合约 。</p> 
  <p>关于交易所，今年3月份交易所被攻击的事件； <br> 关于矿池，在上个月遭到了51%算力的攻击，发生了“双花现象”； <br> 关于钱包，2018年4月份全球最大的基于网页的数字钱包域名被劫持； <br> 关于智能合约 ，以太坊最明显的攻击，2018年4月份有关于美链等智能合约的漏洞，5月份有关于EDU等智能合约的漏洞 。</p> 
  <p>已公开的漏洞直接影响各大交易所，包括停止代币的发行、充值或提现。目前还有不少未公开的漏洞 ，我们会联系相关的项目方和相关交易所，逐步跟他们验证相关的数据。</p> 
  <p>因为这个是开发者社区，接下来我们会挑两个例子，跟大家分享一下漏洞的原理。希望大家以后在做项目开发时，就能够避免出现相关的问题：</p> 
  <p>第一个漏洞 ，是关于transferFlaw，也就是大家所理解的偷币漏洞 。如果用户持有一个代币，而它背后对应的智能合约出现这样安全漏洞，攻击者就可以把这些代币从你的钱包里全部转走。</p> 
  <p>这里列出了一个有漏洞的transferFlaw，其中有三个参数，这是交易的数值，代码49-51行是做初步的检查，以确保这个参数是有效的；53行和54行计算了转出方本身所有的余额，并保存在fromBalance，同时统计了这次允许转出的额度；根据计算出来的变量，在56行和57行，跟当前交易的数值做比较，然后计算两个条件判断：本次交易转出方是否有足够的帐户余额允许做交易，转出方是否有足够的授权来做交易。大家需要关注一下第58行代码，只是简单验证一下：如果把这部分钱或者代币转入转入方，转入方的余额会不会造成溢出。这三个条件加起来就是代码行满足条件下授权这次交易。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180603123942957?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Jsb2NrY2hhaW5fbGVtb24=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br> 大家能够意识到代码行里的判断条件，特别是在56行，如果判断交易的转出方有足够余额，后面的fromBalance不是小于等于value，应该是大于等于value；57行应该是也大于等于value；58行不应该是大于，而应该是小于。</p> 
  <p>我放一个简单的视频，这里有两个数字钱包：左边数字钱包是一个普通用户的，他有1.2345个UET代币，是我们自己花钱去买的；右边的数字钱包是攻击者的，攻击者开始的代币余额是零。攻击发生的时候，这些UET代币为什么就从用户的数字钱包转到了攻击者钱包的？因为这个漏洞的存在，即使这个用户用的是冷钱包，这些钱也都可以被转走。大家关注一下这个余额的情况，从用户手上转到了攻击者手上。</p> 
  <p>第二个漏洞是multiOverflow。前面那笔是普通的交易，从转出方转入转入方。但交易一次一次去做的话，可能会引起比较高的交易费用，transferMulti函数的作用就是把多笔的单笔交易组成一个批处理。</p> 
  <p>它有两个参数，就是转入方和转入的数值。</p> 
  <p>这里面拥有多笔交易，它做成数组，代码行247和248数值长度是一样的，这是有效的数据，数值长度就变成当前有多少个单笔交易。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180603124020443?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Jsb2NrY2hhaW5fbGVtb24=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br> 代码行249-251相当于把这些要转出的交易的数值做了一个加法，获取总值之后判断转出方是否有足够的余额去授权管理。但因为这个漏洞存在，能够感觉到这个变量有可能溢出，有可能变成零。</p> 
  <p>假设这个数值有两个地址，一个1、一个2，数值等于2的255次方，2个255次方相加得到256次方，造成的条件相当于转出方的余额大于等于1；后面的循环会把单笔交易的value转到转入方，同时转出方做相减，转出方加这个值等于2的255次方，形成无限生成代币漏洞 。</p> 
  <p>我们发现有几家正在做的项目已经受到影响，我们第一时间跟他们同步，他们马上更换了智能合约 ，把漏洞做了修改，重新部署上线。</p> 
  <p>这是转帐的视频，两个手机和钱包都是攻击者的，开始的余额全是零。大家看看余额的变化情况，这么大的数值相当于2的255次方。</p> 
  <p>看到这个漏洞大家不要觉得很恐慌，最主要的是要开始思考在资产上线可能面临的安全风险。</p> 
  <p><strong>三、下一步思考：保护措施和防范机制</strong></p> 
  <p>在资产上线时，一定要考虑到保护措施和防范机制：</p> 
  <p>第一，上线前一定要对智能合约做相对完整和客观的审计。</p> 
  <p>第二，上线后一定要注意应急响应。</p> 
  <p>比如监控你们的智能合约有没有可能有异常交易情况，把这个放到应急响应去，第一时间就知道这个智能合约是否被攻击了。同时，开发业务项目方里有应急响应团队，可以及时做出反应。</p> 
  <p>第三，希望项目方和交易所有相应的漏洞奖励计划，形成一个健康的生态。</p> 
  <p><br> <br> <strong>注：为方便大家及时回顾大会嘉宾演讲信息，文章成稿速度较快，其中难免会有一些纰漏，欢迎您及时指出，相关建议请发送至邮箱：puge@csdn.net，非常感谢！后续我们还将在区块链大本营公众号（ID：blockchain_camp）陆续推出精编文章，敬请关注。</strong></p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/80555756,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/Blockchain_lemon/article/details/80555756,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

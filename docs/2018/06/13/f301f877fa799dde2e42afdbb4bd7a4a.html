<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊手机轻钱包开发javascript签名合约交易 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊手机轻钱包开发javascript签名合约交易" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：转载请说明出处 https://blog.csdn.net/weixin_39842528/article/details/80684684 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;以太坊合约交易签名web3.js 环境:window 工具或客户端:ganache 1.2.1&nbsp;, browser-solidity( 在线地址①: https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.21+commit.dfe3193c.js 在线地址②： http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.4.24+commit.e67f0147.js ) 开发语言:javacript &nbsp; 依赖的javacript文件: &nbsp; &nbsp; &nbsp;web3.min.js; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ethereumjs-tx.js; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bignumber.js (下载地址链接: &nbsp;https://pan.baidu.com/s/1KRbH7G0yw5gnXl6iu3k83w &nbsp; 密码: jjqb &nbsp; &nbsp;) 下载后把这三个文件放在同一目录,并新建一个html页面含基础标签元素并引入以上三 个文件 例: &lt;html&gt; &lt;head&gt; &lt;title&gt;hello&lt;/title&gt; &lt;/head&gt; &lt;script src=&quot;./bignumber.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;./web3.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;./ethereumjs-tx.js&quot;&gt;&lt;/script&gt; &lt;body&gt;&lt;/body&gt; &lt;/html&gt; &nbsp; 写在前面 预读此文档你将学习到以下内容 1.使用web3js与现有合约交互 2.使用在线solidity编译器创建编译合约 3.&nbsp;使用web3js和ethereumjs-tx发布一个新的智能合约 4.&nbsp;以太坊手机客户端轻钱包在安卓,ios中实现 5.&nbsp;使用web3js实现合约交易签名 6.&nbsp;发送合约交易前如何获取最佳gaslimit(要点)及算法实现 7.&nbsp;发送合约交易前如何获取最佳gasprice 8.&nbsp;发送合约交易前如何获取nonce 9.判断广播交易之后的状态和是否成功 10.网页钱包开发在html中实现 &nbsp; 参考文档: Web3.js中文文档(常用api): http://web3.tryblockchain.org/ethereum-web3.js-%E5%85%A5%E9%97%A8%E8%AF%B4%E6%98%8E.html Web3.js英文文档(比中文文档更全): http://web3js.readthedocs.io/en/1.0/index.html &nbsp; 案例: 1)实例化web3 var web3 = new Web3(); //&nbsp;连接到以太坊节点 web3.setProvider(new Web3.providers.HttpProvider(&quot;http://localhost:7545&quot;)); 2) ABI //ABI可以从browser-solidity直接获取复制粘贴(ABI) var ABI =&nbsp;[ { &quot;constant&quot;: false, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;receiver&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;name&quot;: &quot;amount&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;sendCoin&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;sufficient&quot;, &quot;type&quot;: &quot;bool&quot; } ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }, { &quot;constant&quot;: false, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;addr&quot;, &quot;type&quot;: &quot;address&quot; } ], &quot;name&quot;: &quot;getBalance&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }, { &quot;inputs&quot;: [], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;constructor&quot; }, { &quot;anonymous&quot;: false, &quot;inputs&quot;: [ { &quot;indexed&quot;: true, &quot;name&quot;: &quot;_from&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;indexed&quot;: true, &quot;name&quot;: &quot;_to&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;indexed&quot;: false, &quot;name&quot;: &quot;_value&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;Transfer&quot;, &quot;type&quot;: &quot;event&quot; } ] var MyContract = web3.eth.contract(ABI).at(&quot;contract address&quot;); //获得已部署合约对象 //创建发布合约 3)&nbsp;WEB3DEPLOY直接从browser-solidity直接获取复制粘贴(WEB3DEPLOY)即下面蓝色字体部分 var metacoinContract = web3.eth.contract( [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var metacoin = metacoinContract.new( &nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from: web3.eth.accounts[1], &nbsp;&nbsp;//自定义(创建合约的地址) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: &#39;0x6060604052341561000f57600080fd5b6127106000803273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506102c5806100636000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806390b98a1114610051578063f8b2cb4f146100ab575b600080fd5b341561005c57600080fd5b610091600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506100f8565b604051808215151515815260200191505060405180910390f35b34156100b657600080fd5b6100e2600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610251565b6040518082815260200191505060405180910390f35b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610149576000905061024b565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490509190505600a165627a7a72305820e2d46191a8715f82d9e47514eff86596520cf4a8cd19717c8579c92ac0c86b1b0029&#39;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gas: &#39;4700000&#39; &nbsp;&nbsp;&nbsp;}, function (e, contract){ &nbsp;&nbsp;&nbsp;&nbsp;console.log(e, contract); &nbsp;&nbsp;&nbsp;&nbsp;if (typeof contract.address !== &#39;undefined&#39;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;}) //查询合约地址余额 var balance_account_one = metacoin.getBalance.call(web3.eth.accounts[1]); balance_account_one.toString(10); &lt; &quot;10000&quot; &nbsp; //获取bufferl类型私钥 var privatekey=New EthJS.Buffer.Buffer.from( &#39;f0a6e4f7f3a51033d50057c0debc5d2f1306e97bf0ae6c8723bd1f15a46e0a54&#39;,&#39;hex&#39;); //获取调用智能的data //方法abi+参数(参数1,接收地址;参数2&nbsp;发送代币金额)也可以自己拼接data var data = metacoin.sendCoin.getData(&quot;0xE7E0afc3D0A1876e1DdA5FD001D127d5dC8FAb29&quot;,500); Console.log(data); //&quot;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&quot; //获取gasprice var gasPrice = web3.eth.gasPrice; console.log(gasPrice.toString(10)); &nbsp;&nbsp;//20000000000 var gasPrice_hex = &nbsp;web3.toHex(20000000000) //签名交易 var nonce = web3.eth.getTransactionCount(web3.eth.accounts[1]); Consle.log(nonce); &nbsp;//1 var nonce_hex = &nbsp;web3.toHex(0) &nbsp; var rawTx_example = { &nbsp;&nbsp;nonce: 0x01, //nonce_hex &nbsp;&nbsp;gasPrice: &#39;0x4a817c800&#39;, &nbsp;&nbsp;//gasPrice_hex &nbsp;&nbsp;to: &#39;0x90A679A0a247b9218c88d473B2Ce556460993ec3&#39;, //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址 &nbsp;&nbsp;value: &#39;0x00&#39;, data:&#39;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&#39; &nbsp;//data } &nbsp; var gaslimit &nbsp;= &nbsp;web3.eth.estimateGas(rawTx_example) Console.log(gaslimit ) &nbsp;&nbsp;//36002 &lt;36002 var gaslimit_hex = web3.toHex(36002); Console.log(gaslimit_hex) &nbsp;&nbsp;//0x8ca2 &lt;&quot;0x8ca2&quot; var rawTx = { &nbsp;&nbsp;nonce: 0x01, &nbsp;&nbsp;//nonce_hex &nbsp;&nbsp;gasPrice: &#39;0x4a817c800&#39;, &nbsp;&nbsp;//gasPrice_hex &nbsp;&nbsp;Gaslimit:’0x8ca2’&nbsp;, // gaslimit_hex &nbsp;&nbsp;to: &#39;0x90A679A0a247b9218c88d473B2Ce556460993ec3&#39;, //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址 &nbsp;&nbsp;value: &#39;0x00&#39;, data:&#39;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&#39; &nbsp;//data } &nbsp; &nbsp; var tx =new EthJS.Tx(rawTx); tx.sign(privateKey); var serializedTx = tx1.serialize(); web3.eth.sendRawTransaction(‘0x’+serializedTx , function(err, hash) { console.log(err) &nbsp;&nbsp;&nbsp; console.log(hash); //&quot;0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506&quot; }); var balance_account_one= metacoin.getBalance.call(web3.eth.accounts[1]); &nbsp; &nbsp;balance_account_one.toString(10); &lt;&quot;9500&quot; 拿到交易回执： web3.eth.getTransactionReceipt(&quot;0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506&quot;); &nbsp; 根据返回的结果status判断,如果是0X1就代表交易被确认打包.转账成功是否成功以交易记录为准 成功! &nbsp; 阅读更多" />
<meta property="og:description" content="版权声明：转载请说明出处 https://blog.csdn.net/weixin_39842528/article/details/80684684 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;以太坊合约交易签名web3.js 环境:window 工具或客户端:ganache 1.2.1&nbsp;, browser-solidity( 在线地址①: https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.21+commit.dfe3193c.js 在线地址②： http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.4.24+commit.e67f0147.js ) 开发语言:javacript &nbsp; 依赖的javacript文件: &nbsp; &nbsp; &nbsp;web3.min.js; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ethereumjs-tx.js; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bignumber.js (下载地址链接: &nbsp;https://pan.baidu.com/s/1KRbH7G0yw5gnXl6iu3k83w &nbsp; 密码: jjqb &nbsp; &nbsp;) 下载后把这三个文件放在同一目录,并新建一个html页面含基础标签元素并引入以上三 个文件 例: &lt;html&gt; &lt;head&gt; &lt;title&gt;hello&lt;/title&gt; &lt;/head&gt; &lt;script src=&quot;./bignumber.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;./web3.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;./ethereumjs-tx.js&quot;&gt;&lt;/script&gt; &lt;body&gt;&lt;/body&gt; &lt;/html&gt; &nbsp; 写在前面 预读此文档你将学习到以下内容 1.使用web3js与现有合约交互 2.使用在线solidity编译器创建编译合约 3.&nbsp;使用web3js和ethereumjs-tx发布一个新的智能合约 4.&nbsp;以太坊手机客户端轻钱包在安卓,ios中实现 5.&nbsp;使用web3js实现合约交易签名 6.&nbsp;发送合约交易前如何获取最佳gaslimit(要点)及算法实现 7.&nbsp;发送合约交易前如何获取最佳gasprice 8.&nbsp;发送合约交易前如何获取nonce 9.判断广播交易之后的状态和是否成功 10.网页钱包开发在html中实现 &nbsp; 参考文档: Web3.js中文文档(常用api): http://web3.tryblockchain.org/ethereum-web3.js-%E5%85%A5%E9%97%A8%E8%AF%B4%E6%98%8E.html Web3.js英文文档(比中文文档更全): http://web3js.readthedocs.io/en/1.0/index.html &nbsp; 案例: 1)实例化web3 var web3 = new Web3(); //&nbsp;连接到以太坊节点 web3.setProvider(new Web3.providers.HttpProvider(&quot;http://localhost:7545&quot;)); 2) ABI //ABI可以从browser-solidity直接获取复制粘贴(ABI) var ABI =&nbsp;[ { &quot;constant&quot;: false, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;receiver&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;name&quot;: &quot;amount&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;sendCoin&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;sufficient&quot;, &quot;type&quot;: &quot;bool&quot; } ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }, { &quot;constant&quot;: false, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;addr&quot;, &quot;type&quot;: &quot;address&quot; } ], &quot;name&quot;: &quot;getBalance&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }, { &quot;inputs&quot;: [], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;constructor&quot; }, { &quot;anonymous&quot;: false, &quot;inputs&quot;: [ { &quot;indexed&quot;: true, &quot;name&quot;: &quot;_from&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;indexed&quot;: true, &quot;name&quot;: &quot;_to&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;indexed&quot;: false, &quot;name&quot;: &quot;_value&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;Transfer&quot;, &quot;type&quot;: &quot;event&quot; } ] var MyContract = web3.eth.contract(ABI).at(&quot;contract address&quot;); //获得已部署合约对象 //创建发布合约 3)&nbsp;WEB3DEPLOY直接从browser-solidity直接获取复制粘贴(WEB3DEPLOY)即下面蓝色字体部分 var metacoinContract = web3.eth.contract( [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var metacoin = metacoinContract.new( &nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from: web3.eth.accounts[1], &nbsp;&nbsp;//自定义(创建合约的地址) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: &#39;0x6060604052341561000f57600080fd5b6127106000803273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506102c5806100636000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806390b98a1114610051578063f8b2cb4f146100ab575b600080fd5b341561005c57600080fd5b610091600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506100f8565b604051808215151515815260200191505060405180910390f35b34156100b657600080fd5b6100e2600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610251565b6040518082815260200191505060405180910390f35b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610149576000905061024b565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490509190505600a165627a7a72305820e2d46191a8715f82d9e47514eff86596520cf4a8cd19717c8579c92ac0c86b1b0029&#39;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gas: &#39;4700000&#39; &nbsp;&nbsp;&nbsp;}, function (e, contract){ &nbsp;&nbsp;&nbsp;&nbsp;console.log(e, contract); &nbsp;&nbsp;&nbsp;&nbsp;if (typeof contract.address !== &#39;undefined&#39;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;}) //查询合约地址余额 var balance_account_one = metacoin.getBalance.call(web3.eth.accounts[1]); balance_account_one.toString(10); &lt; &quot;10000&quot; &nbsp; //获取bufferl类型私钥 var privatekey=New EthJS.Buffer.Buffer.from( &#39;f0a6e4f7f3a51033d50057c0debc5d2f1306e97bf0ae6c8723bd1f15a46e0a54&#39;,&#39;hex&#39;); //获取调用智能的data //方法abi+参数(参数1,接收地址;参数2&nbsp;发送代币金额)也可以自己拼接data var data = metacoin.sendCoin.getData(&quot;0xE7E0afc3D0A1876e1DdA5FD001D127d5dC8FAb29&quot;,500); Console.log(data); //&quot;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&quot; //获取gasprice var gasPrice = web3.eth.gasPrice; console.log(gasPrice.toString(10)); &nbsp;&nbsp;//20000000000 var gasPrice_hex = &nbsp;web3.toHex(20000000000) //签名交易 var nonce = web3.eth.getTransactionCount(web3.eth.accounts[1]); Consle.log(nonce); &nbsp;//1 var nonce_hex = &nbsp;web3.toHex(0) &nbsp; var rawTx_example = { &nbsp;&nbsp;nonce: 0x01, //nonce_hex &nbsp;&nbsp;gasPrice: &#39;0x4a817c800&#39;, &nbsp;&nbsp;//gasPrice_hex &nbsp;&nbsp;to: &#39;0x90A679A0a247b9218c88d473B2Ce556460993ec3&#39;, //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址 &nbsp;&nbsp;value: &#39;0x00&#39;, data:&#39;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&#39; &nbsp;//data } &nbsp; var gaslimit &nbsp;= &nbsp;web3.eth.estimateGas(rawTx_example) Console.log(gaslimit ) &nbsp;&nbsp;//36002 &lt;36002 var gaslimit_hex = web3.toHex(36002); Console.log(gaslimit_hex) &nbsp;&nbsp;//0x8ca2 &lt;&quot;0x8ca2&quot; var rawTx = { &nbsp;&nbsp;nonce: 0x01, &nbsp;&nbsp;//nonce_hex &nbsp;&nbsp;gasPrice: &#39;0x4a817c800&#39;, &nbsp;&nbsp;//gasPrice_hex &nbsp;&nbsp;Gaslimit:’0x8ca2’&nbsp;, // gaslimit_hex &nbsp;&nbsp;to: &#39;0x90A679A0a247b9218c88d473B2Ce556460993ec3&#39;, //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址 &nbsp;&nbsp;value: &#39;0x00&#39;, data:&#39;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&#39; &nbsp;//data } &nbsp; &nbsp; var tx =new EthJS.Tx(rawTx); tx.sign(privateKey); var serializedTx = tx1.serialize(); web3.eth.sendRawTransaction(‘0x’+serializedTx , function(err, hash) { console.log(err) &nbsp;&nbsp;&nbsp; console.log(hash); //&quot;0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506&quot; }); var balance_account_one= metacoin.getBalance.call(web3.eth.accounts[1]); &nbsp; &nbsp;balance_account_one.toString(10); &lt;&quot;9500&quot; 拿到交易回执： web3.eth.getTransactionReceipt(&quot;0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506&quot;); &nbsp; 根据返回的结果status判断,如果是0X1就代表交易被确认打包.转账成功是否成功以交易记录为准 成功! &nbsp; 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/06/13/f301f877fa799dde2e42afdbb4bd7a4a.html" />
<meta property="og:url" content="https://mlh.app/2018/06/13/f301f877fa799dde2e42afdbb4bd7a4a.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-13T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：转载请说明出处 https://blog.csdn.net/weixin_39842528/article/details/80684684 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;以太坊合约交易签名web3.js 环境:window 工具或客户端:ganache 1.2.1&nbsp;, browser-solidity( 在线地址①: https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.21+commit.dfe3193c.js 在线地址②： http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.4.24+commit.e67f0147.js ) 开发语言:javacript &nbsp; 依赖的javacript文件: &nbsp; &nbsp; &nbsp;web3.min.js; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ethereumjs-tx.js; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bignumber.js (下载地址链接: &nbsp;https://pan.baidu.com/s/1KRbH7G0yw5gnXl6iu3k83w &nbsp; 密码: jjqb &nbsp; &nbsp;) 下载后把这三个文件放在同一目录,并新建一个html页面含基础标签元素并引入以上三 个文件 例: &lt;html&gt; &lt;head&gt; &lt;title&gt;hello&lt;/title&gt; &lt;/head&gt; &lt;script src=&quot;./bignumber.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;./web3.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;./ethereumjs-tx.js&quot;&gt;&lt;/script&gt; &lt;body&gt;&lt;/body&gt; &lt;/html&gt; &nbsp; 写在前面 预读此文档你将学习到以下内容 1.使用web3js与现有合约交互 2.使用在线solidity编译器创建编译合约 3.&nbsp;使用web3js和ethereumjs-tx发布一个新的智能合约 4.&nbsp;以太坊手机客户端轻钱包在安卓,ios中实现 5.&nbsp;使用web3js实现合约交易签名 6.&nbsp;发送合约交易前如何获取最佳gaslimit(要点)及算法实现 7.&nbsp;发送合约交易前如何获取最佳gasprice 8.&nbsp;发送合约交易前如何获取nonce 9.判断广播交易之后的状态和是否成功 10.网页钱包开发在html中实现 &nbsp; 参考文档: Web3.js中文文档(常用api): http://web3.tryblockchain.org/ethereum-web3.js-%E5%85%A5%E9%97%A8%E8%AF%B4%E6%98%8E.html Web3.js英文文档(比中文文档更全): http://web3js.readthedocs.io/en/1.0/index.html &nbsp; 案例: 1)实例化web3 var web3 = new Web3(); //&nbsp;连接到以太坊节点 web3.setProvider(new Web3.providers.HttpProvider(&quot;http://localhost:7545&quot;)); 2) ABI //ABI可以从browser-solidity直接获取复制粘贴(ABI) var ABI =&nbsp;[ { &quot;constant&quot;: false, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;receiver&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;name&quot;: &quot;amount&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;sendCoin&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;sufficient&quot;, &quot;type&quot;: &quot;bool&quot; } ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }, { &quot;constant&quot;: false, &quot;inputs&quot;: [ { &quot;name&quot;: &quot;addr&quot;, &quot;type&quot;: &quot;address&quot; } ], &quot;name&quot;: &quot;getBalance&quot;, &quot;outputs&quot;: [ { &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; }, { &quot;inputs&quot;: [], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;constructor&quot; }, { &quot;anonymous&quot;: false, &quot;inputs&quot;: [ { &quot;indexed&quot;: true, &quot;name&quot;: &quot;_from&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;indexed&quot;: true, &quot;name&quot;: &quot;_to&quot;, &quot;type&quot;: &quot;address&quot; }, { &quot;indexed&quot;: false, &quot;name&quot;: &quot;_value&quot;, &quot;type&quot;: &quot;uint256&quot; } ], &quot;name&quot;: &quot;Transfer&quot;, &quot;type&quot;: &quot;event&quot; } ] var MyContract = web3.eth.contract(ABI).at(&quot;contract address&quot;); //获得已部署合约对象 //创建发布合约 3)&nbsp;WEB3DEPLOY直接从browser-solidity直接获取复制粘贴(WEB3DEPLOY)即下面蓝色字体部分 var metacoinContract = web3.eth.contract( [{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var metacoin = metacoinContract.new( &nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from: web3.eth.accounts[1], &nbsp;&nbsp;//自定义(创建合约的地址) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: &#39;0x6060604052341561000f57600080fd5b6127106000803273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506102c5806100636000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806390b98a1114610051578063f8b2cb4f146100ab575b600080fd5b341561005c57600080fd5b610091600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506100f8565b604051808215151515815260200191505060405180910390f35b34156100b657600080fd5b6100e2600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610251565b6040518082815260200191505060405180910390f35b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610149576000905061024b565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490509190505600a165627a7a72305820e2d46191a8715f82d9e47514eff86596520cf4a8cd19717c8579c92ac0c86b1b0029&#39;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gas: &#39;4700000&#39; &nbsp;&nbsp;&nbsp;}, function (e, contract){ &nbsp;&nbsp;&nbsp;&nbsp;console.log(e, contract); &nbsp;&nbsp;&nbsp;&nbsp;if (typeof contract.address !== &#39;undefined&#39;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&#39;Contract mined! address: &#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;}) //查询合约地址余额 var balance_account_one = metacoin.getBalance.call(web3.eth.accounts[1]); balance_account_one.toString(10); &lt; &quot;10000&quot; &nbsp; //获取bufferl类型私钥 var privatekey=New EthJS.Buffer.Buffer.from( &#39;f0a6e4f7f3a51033d50057c0debc5d2f1306e97bf0ae6c8723bd1f15a46e0a54&#39;,&#39;hex&#39;); //获取调用智能的data //方法abi+参数(参数1,接收地址;参数2&nbsp;发送代币金额)也可以自己拼接data var data = metacoin.sendCoin.getData(&quot;0xE7E0afc3D0A1876e1DdA5FD001D127d5dC8FAb29&quot;,500); Console.log(data); //&quot;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&quot; //获取gasprice var gasPrice = web3.eth.gasPrice; console.log(gasPrice.toString(10)); &nbsp;&nbsp;//20000000000 var gasPrice_hex = &nbsp;web3.toHex(20000000000) //签名交易 var nonce = web3.eth.getTransactionCount(web3.eth.accounts[1]); Consle.log(nonce); &nbsp;//1 var nonce_hex = &nbsp;web3.toHex(0) &nbsp; var rawTx_example = { &nbsp;&nbsp;nonce: 0x01, //nonce_hex &nbsp;&nbsp;gasPrice: &#39;0x4a817c800&#39;, &nbsp;&nbsp;//gasPrice_hex &nbsp;&nbsp;to: &#39;0x90A679A0a247b9218c88d473B2Ce556460993ec3&#39;, //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址 &nbsp;&nbsp;value: &#39;0x00&#39;, data:&#39;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&#39; &nbsp;//data } &nbsp; var gaslimit &nbsp;= &nbsp;web3.eth.estimateGas(rawTx_example) Console.log(gaslimit ) &nbsp;&nbsp;//36002 &lt;36002 var gaslimit_hex = web3.toHex(36002); Console.log(gaslimit_hex) &nbsp;&nbsp;//0x8ca2 &lt;&quot;0x8ca2&quot; var rawTx = { &nbsp;&nbsp;nonce: 0x01, &nbsp;&nbsp;//nonce_hex &nbsp;&nbsp;gasPrice: &#39;0x4a817c800&#39;, &nbsp;&nbsp;//gasPrice_hex &nbsp;&nbsp;Gaslimit:’0x8ca2’&nbsp;, // gaslimit_hex &nbsp;&nbsp;to: &#39;0x90A679A0a247b9218c88d473B2Ce556460993ec3&#39;, //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址 &nbsp;&nbsp;value: &#39;0x00&#39;, data:&#39;0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4&#39; &nbsp;//data } &nbsp; &nbsp; var tx =new EthJS.Tx(rawTx); tx.sign(privateKey); var serializedTx = tx1.serialize(); web3.eth.sendRawTransaction(‘0x’+serializedTx , function(err, hash) { console.log(err) &nbsp;&nbsp;&nbsp; console.log(hash); //&quot;0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506&quot; }); var balance_account_one= metacoin.getBalance.call(web3.eth.accounts[1]); &nbsp; &nbsp;balance_account_one.toString(10); &lt;&quot;9500&quot; 拿到交易回执： web3.eth.getTransactionReceipt(&quot;0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506&quot;); &nbsp; 根据返回的结果status判断,如果是0X1就代表交易被确认打包.转账成功是否成功以交易记录为准 成功! &nbsp; 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/06/13/f301f877fa799dde2e42afdbb4bd7a4a.html","headline":"以太坊手机轻钱包开发javascript签名合约交易","dateModified":"2018-06-13T00:00:00+08:00","datePublished":"2018-06-13T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/06/13/f301f877fa799dde2e42afdbb4bd7a4a.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊手机轻钱包开发javascript签名合约交易</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：转载请说明出处 https://blog.csdn.net/weixin_39842528/article/details/80684684 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;以太坊合约交易签名web3.js</p> 
  <p>环境:window</p> 
  <p>工具或客户端:<a href="https://github.com/trufflesuite/ganache/releases/tag/v1.2.1" rel="nofollow">ganache 1.2.1&nbsp;</a>,</p> 
  <p>browser-solidity(</p> 
  <p>在线地址①:</p> 
  <p>https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.21+commit.dfe3193c.js</p> 
  <p>在线地址②：</p> 
  <p><a href="http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.4.24+commit.e67f0147.js" rel="nofollow">http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.4.24+commit.e67f0147.js</a></p> 
  <p>)</p> 
  <p>开发语言:javacript</p> 
  <p>&nbsp;</p> 
  <p>依赖的javacript文件:</p> 
  <p>&nbsp; &nbsp; &nbsp;web3.min.js;</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ethereumjs-tx.js;</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bignumber.js</p> 
  <p>(下载地址链接:</p> 
  <p>&nbsp;https://pan.baidu.com/s/1KRbH7G0yw5gnXl6iu3k83w &nbsp; 密码: jjqb &nbsp; &nbsp;)</p> 
  <p>下载后把这三个文件放在同一目录,并新建一个html页面含基础标签元素并引入以上三 个文件</p> 
  <p>例:</p> 
  <p>&lt;html&gt;</p> 
  <p>&lt;head&gt;</p> 
  <p>&lt;title&gt;hello&lt;/title&gt;</p> 
  <p>&lt;/head&gt;</p> 
  <p>&lt;script src="./bignumber.js"&gt;&lt;/script&gt;</p> 
  <p>&lt;script src="./web3.min.js"&gt;&lt;/script&gt;</p> 
  <p>&lt;script src="./ethereumjs-tx.js"&gt;&lt;/script&gt;</p> 
  <p>&lt;body&gt;&lt;/body&gt;</p> 
  <p>&lt;/html&gt;</p> 
  <p>&nbsp;</p> 
  <p>写在前面</p> 
  <p>预读此文档你将学习到以下内容</p> 
  <p>1.使用web3js与现有合约交互</p> 
  <p>2.使用在线solidity编译器创建编译合约</p> 
  <p>3.&nbsp;使用web3js和ethereumjs-tx发布一个新的智能合约</p> 
  <p>4.&nbsp;以太坊手机客户端轻钱包在安卓,ios中实现</p> 
  <p>5.&nbsp;使用web3js实现合约交易签名</p> 
  <p>6.&nbsp;发送合约交易前如何获取最佳gaslimit(要点)及算法实现</p> 
  <p>7.&nbsp;发送合约交易前如何获取最佳gasprice</p> 
  <p>8.&nbsp;发送合约交易前如何获取nonce</p> 
  <p>9.判断广播交易之后的状态和是否成功</p> 
  <p>10.网页钱包开发在html中实现</p> 
  <p>&nbsp;</p> 
  <p>参考文档:</p> 
  <p>Web3.js中文文档(常用api):</p> 
  <p><a href="http://web3.tryblockchain.org/ethereum-web3.js-%E5%85%A5%E9%97%A8%E8%AF%B4%E6%98%8E.html" rel="nofollow"><span style="color:#0000ff;">http://web3.tryblockchain.org/ethereum-web3.js-%E5%85%A5%E9%97%A8%E8%AF%B4%E6%98%8E.html</span></a></p> 
  <p>Web3.js英文文档(比中文文档更全):</p> 
  <p><a href="http://web3js.readthedocs.io/en/1.0/index.html" rel="nofollow"><span style="color:#0000ff;">http://web3js.readthedocs.io/en/1.0/index.html</span></a></p> 
  <p>&nbsp;</p> 
  <p>案例:</p> 
  <p>1)实例化web3</p> 
  <p>var web3 = new Web3();</p> 
  <p>//&nbsp;连接到以太坊节点</p> 
  <p>web3.setProvider(new Web3.providers.HttpProvider("http://localhost:7545"));</p> 
  <p>2) ABI</p> 
  <p>//ABI可以从<a href="https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.21+commit.dfe3193c.js" rel="nofollow">browser-solidity</a>直接获取复制粘贴(<span style="color:#3366ff;">ABI</span>)</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180729153420952?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTg0MjUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><span style="color:#3399ea;">var </span><span style="color:#ffbb66;">ABI </span><span style="color:#3399ea;">=&nbsp;[ { "constant": false, "inputs": [ { "name": "receiver", "type": "address" }, { "name": "amount", "type": "uint256" } ], "name": "sendCoin", "outputs": [ { "name": "sufficient", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "addr", "type": "address" } ], "name": "getBalance", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "_from", "type": "address" }, { "indexed": true, "name": "_to", "type": "address" }, { "indexed": false, "name": "_value", "type": "uint256" } ], "name": "Transfer", "type": "event" } ]</span></p> 
  <p>var MyContract = web3.eth.contract(<span style="color:#ffbb66;">ABI</span>).at("contract address"); //获得已部署合约对象</p> 
  <p>//创建发布合约</p> 
  <p>3)&nbsp;<span style="color:#000000;">WEB3DEPLOY</span>直接从<a href="https://ethereum.github.io/browser-solidity/#optimize=false&amp;version=soljson-v0.4.21+commit.dfe3193c.js" rel="nofollow">browser-solidity</a>直接获取复制粘贴(<span style="color:#000000;">WEB3DEPLOY</span>)即下面蓝色字体部分</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180729153232586?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTg0MjUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p><span style="color:#3366ff;">var metacoinContract = web3.eth.contract(<br> [{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"sendCoin","outputs":[{"name":"sufficient","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"}]);</span></p> 
  <p><span style="color:#3366ff;">var metacoin = metacoinContract.new(</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;{</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from: web3.eth.accounts[1], &nbsp;&nbsp;</span><span style="color:#ff0000;">//自定义(创建合约的地址)</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: '0x6060604052341561000f57600080fd5b6127106000803273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506102c5806100636000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806390b98a1114610051578063f8b2cb4f146100ab575b600080fd5b341561005c57600080fd5b610091600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506100f8565b604051808215151515815260200191505060405180910390f35b34156100b657600080fd5b6100e2600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610251565b6040518082815260200191505060405180910390f35b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610149576000905061024b565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490509190505600a165627a7a72305820e2d46191a8715f82d9e47514eff86596520cf4a8cd19717c8579c92ac0c86b1b0029',</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gas: '4700000'</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;}, function (e, contract){</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;console.log(e, contract);</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;if (typeof contract.address !== 'undefined') {</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);</span></p> 
  <p><span style="color:#3366ff;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p> 
  <p><span style="color:#3366ff;">&nbsp;})</span></p> 
  <p>//查询合约地址余额</p> 
  <p>var balance_account_one = metacoin.getBalance.call(web3.eth.accounts[1]);</p> 
  <p>balance_account_one.toString(10);</p> 
  <p>&lt; "10000"</p> 
  <p>&nbsp;</p> 
  <p>//获取bufferl类型私钥</p> 
  <p>var privatekey=New EthJS.Buffer.Buffer.from(<br> 'f0a6e4f7f3a51033d50057c0debc5d2f1306e97bf0ae6c8723bd1f15a46e0a54','hex');</p> 
  <p>//获取调用智能的data</p> 
  <p>//方法abi+参数(参数1,接收地址;参数2&nbsp;发送代币金额)也可以自己拼接data</p> 
  <p>var <span style="color:#33ff33;">data</span> = metacoin.sendCoin.getData("0xE7E0afc3D0A1876e1DdA5FD001D127d5dC8FAb29",500);</p> 
  <p>Console.log(data);</p> 
  <p>//"0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4"</p> 
  <p>//获取gasprice</p> 
  <p>var gasPrice = web3.eth.gasPrice;</p> 
  <p>console.log(gasPrice.toString(10)); &nbsp;&nbsp;//20000000000</p> 
  <p>var <span style="color:#33ccff;">gasPrice_hex</span> = &nbsp;web3.toHex(20000000000)</p> 
  <p>//签名交易</p> 
  <p>var nonce = web3.eth.getTransactionCount(web3.eth.accounts[1]);</p> 
  <p>Consle.log(nonce); &nbsp;//1</p> 
  <p>var <span style="color:#3366ff;">nonce_hex</span> = &nbsp;web3.toHex(0)</p> 
  <p>&nbsp;</p> 
  <p>var rawTx_example = {</p> 
  <p>&nbsp;&nbsp;nonce: 0x01, //<span style="color:#3366ff;">nonce_hex</span></p> 
  <p>&nbsp;&nbsp;gasPrice: '0x4a817c800', &nbsp;&nbsp;//<span style="color:#33ccff;">gasPrice_hex</span></p> 
  <p>&nbsp;&nbsp;to: '0x90A679A0a247b9218c88d473B2Ce556460993ec3', //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址</p> 
  <p>&nbsp;&nbsp;value: '0x00',</p> 
  <p>data:'0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4' &nbsp;//<span style="color:#33ff33;">data</span></p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>var gaslimit &nbsp;= &nbsp;web3.eth.estimateGas(rawTx_example)</p> 
  <p>Console.log(gaslimit ) &nbsp;&nbsp;//36002</p> 
  <p>&lt;36002</p> 
  <p>var <span style="color:#ffcc66;">gaslimit_hex</span> = web3.toHex(36002);</p> 
  <p>Console.log(gaslimit_hex) &nbsp;&nbsp;//0x8ca2</p> 
  <p>&lt;"0x8ca2"</p> 
  <p>var rawTx = {</p> 
  <p>&nbsp;&nbsp;nonce: 0x01, &nbsp;&nbsp;//<span style="color:#3366ff;">nonce_hex</span></p> 
  <p>&nbsp;&nbsp;gasPrice: '0x4a817c800', &nbsp;&nbsp;//<span style="color:#66ffff;">gasPrice_hex</span></p> 
  <p>&nbsp;&nbsp;Gaslimit:’0x8ca2’&nbsp;, // <span style="color:#ffcc33;">gaslimit_hex</span></p> 
  <p>&nbsp;&nbsp;to: '0x90A679A0a247b9218c88d473B2Ce556460993ec3', //tokenaddress:调用合约时使用合约地址;非合约交易时接收地址</p> 
  <p>&nbsp;&nbsp;value: '0x00',</p> 
  <p>data:'0x90b98a11000000000000000000000000e7e0afc3d0a1876e1dda5fd001d127d5dc8fab2900000000000000000000000000000000000000000000000000000000000001f4' &nbsp;//<span style="color:#33ff33;">data</span></p> 
  <p>}</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>var tx =new EthJS.Tx(rawTx);</p> 
  <p>tx.sign(privateKey);</p> 
  <p>var serializedTx = tx1.serialize();</p> 
  <p>web3.eth.sendRawTransaction(‘0x’+serializedTx , function(err, hash) {</p> 
  <p>console.log(err) &nbsp;&nbsp;&nbsp;</p> 
  <p>console.log(hash); //"0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506"</p> 
  <p>});</p> 
  <p>var balance_account_one= metacoin.getBalance.call(web3.eth.accounts[1]);</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;balance_account_one.toString(10);</p> 
  <p>&lt;"9500"</p> 
  <p>拿到交易回执：<br> web3.eth.getTransactionReceipt("0x39225d367c12f9eab59b6ff95cfe8e90e3c24142647ef73fa63e268e24d63506");</p> 
  <p>&nbsp;<img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180903170420109?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTg0MjUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> 
  <p>根据返回的结果status判断,如果是0X1就代表交易被确认打包.转账成功是否成功以交易记录为准</p> 
  <p>成功!</p> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_39842528/article/details/80684684,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/weixin_39842528/article/details/80684684,&quot;}">阅读更多</a> 
 <!-- <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view='{"mod":"popu_557","con":",https://blog.csdn.net/weixin_39842528/article/details/80684684,"}' data-track-click='{"mod":"popu_557","con":",https://blog.csdn.net/weixin_39842528/article/details/80684684,"}'>登录后自动展开</a> --> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

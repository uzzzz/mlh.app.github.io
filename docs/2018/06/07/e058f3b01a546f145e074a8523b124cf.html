<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>股票日内回转交易策略（附源码） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="股票日内回转交易策略（附源码）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="什么是日内交易？ ​ 日内交易（Day Trade）是一种交易模式。主要是指持仓时间短，不留过夜持仓的交易方式。日内交易捕捉入市后能够马上脱离入市成本的交易机会，入市之后如果不能马上获利，就准备迅速离场。因为这种交易方式在市时间短，所以承受的市场波动的风险较低。目前，全球范围内有一些操盘高手采用此交易方式取得稳定的盈利，获得了成功。 日内策略在中国市场可行吗？ ​ 与国外市场不同，我国股票市场现阶段施行“T+1”交易，在这个基础上的“T+0”操作，必须是有底仓的高抛低吸。 ​ 但凡在日内交易上经验丰富且有很高胜率的选手，在持股期，都会对日内交易拥有极高的兴趣，交易频次也会比较高。以上表述已经暗含了一个隐藏的前提：必须是当天不准备卖出者才能做T，否则会为了几个点的微小价差而得不偿失。 ​ 日内交易因为其快速了结和价差较小的特点，交易者盈利的首要条件即为一个交易来回的价差大于交易成本。按照当前券商普遍采用的佣金标准万三计算，一个完整交易轮回的摩擦成本略小于0.2%，从这点看，低佣金使得日内交易的盈利变得相对容易。根据我自身的交易经验，只要参与者对单次盈利预期合理且在介入时间点上不至太过偏离，均能在长久的做T生涯中获得不菲的正收益。 策略实现（基于掘金量化平台） 策略思想 本策略首先买入“SHSE.600000”股票10000股。 根据300s的数据来计算“MACD(12,26,9)”线。 “MACD”水下金叉，配合均线多头排列的时候买入1000股，“MACD”水上死叉，配合均线空头排列的时候卖出1000股。 每日操作的股票数不超过原有仓位，并于收盘前把仓位调整至开盘前的仓位。 策略主要步骤实现 订阅数据 subscribe(symbols=symbols, frequency=&#39;300s&#39;, count=35, wait_group=True)(symbols=symbols, frequency=&#39;300s&#39;, count=35, wait_group=True) ​ 订阅数据需要在定义init函数里面设置，并调用subscribe函数： symbols需要设置订阅的标的代码。 frequency需设置订阅数据的周期级别，这里设置1d 表示以一天为周期。 count需要设置获取的bar的数量 数据获取 recent_data = context.data(symbol=symbol, frequency=&#39;300s&#39;, count=35, fields=&#39;close&#39;) = context.data(symbol=symbol, frequency=&#39;300s&#39;, count=35, fields=&#39;close&#39;) ​ 订阅数据之后，需要获取已经订阅的数据来进行操作，这时需调用context.data函数： symbols 需要设置订阅的标的代码。 frequency需设置订阅数据的周期级别，这里设置1d表示以一天为周期。 count需要设置获取的bar的数量 fields需要设置返回值的种类 获取当前bar的时间 def on_bar(context, bars): &nbsp; &nbsp;bar = bars[0] &nbsp; &nbsp;day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) on_bar(context, bars): &nbsp; &nbsp;bar = bars[0] &nbsp; &nbsp;day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) ​ 在on_bar函数里，需要判断当前bar是否为当天交易的最后一根，以判断是否平仓，这里可直接过去传入bar的信息。 参数名 类型 说明 symbol str 标的代码 frequency str 频率 open float 开盘价 close float 收盘价 high float 最高价 low float 最低价 amount float 成交额 volume float 成交量 position long 持仓量 pre_close float 前收盘价 bob datetime.datetime bar开始时间 eob datetime.datetime bar结束时间 回测报告 分析 ​ 我们选取了2016年1月至2016年7月作为回测周期，保利地产（600048）作为标的股票，可以看出： 胜率（具有盈利的平仓次数与总平仓次数之比）达到了46%，当然，您可以根据需要，制定别的高胜率的开平仓条件。 卡玛比率（年化收益率与历史最大回撤之比）是使用最大回撤率来衡量风险。采用最大回撤率来衡量风险，关注的是最极端的情况。卡玛比率越高表示策略承受每单位最大损失获得的报酬越高。在这里卡玛比率达到了1.4。 夏普比率（年化收益率减无风险收益率的差收益波动率之比）达到0.78。 策略收益曲线与标的股票收益具有很大相关性，日内交易的关键点在于手续费的控制，在提高胜率的同时，尽量提高盈亏比，使得平仓的价差收益大于手续费的损耗。 &nbsp; 股票日内回转交易策略源码： &nbsp; # coding=utf-8 from __future__ import print_function, absolute_import, unicode_literals try: import talib except: print(&#39;请安装TA-Lib库&#39;) from gm.api import * &nbsp; &#39;&#39;&#39; 本策略首先买入SHSE.600000股票10000股 随后根据60s的数据来计算MACD(12,26,9)线,并在MACD&gt;0的时候买入100股,MACD&lt;0的时候卖出100股 但每日操作的股票数不超过原有仓位,并于收盘前把仓位调整至开盘前的仓位 回测数据为:SHSE.600000的60s数据 回测时间为:2017-09-01 08:00:00到2017-10-01 16:00:00 &#39;&#39;&#39; &nbsp; &nbsp; def init(context): # 设置标的股票 context.symbol = &#39;SHSE.600000&#39; # 用于判定第一个仓位是否成功开仓 context.first = 0 # 订阅浦发银行, bar频率为1min subscribe(symbols=context.symbol, frequency=&#39;60s&#39;, count=35) # 日内回转每次交易100股 context.trade_n = 100 # 获取昨今天的时间 context.day = [0, 0] # 用于判断是否触发了回转逻辑的计时 context.ending = 0 &nbsp; &nbsp; def on_bar(context, bars): bar = bars[0] if context.first == 0: # 最开始配置仓位 # 需要保持的总仓位 context.total = 10000 # 购买10000股浦发银行股票 order_volume(symbol=context.symbol, volume=context.total, side=PositionSide_Long, order_type=OrderType_Market, position_effect=PositionEffect_Open) print(context.symbol, &#39;以市价单开多仓10000股&#39;) context.first = 1. day = bar.bob.strftime(&#39;%Y-%m-%d&#39;) context.day[-1] = day[-2:] # 每天的仓位操作 context.turnaround = [0, 0] return &nbsp; # 更新最新的日期 day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) context.day[0] = bar.bob.day # 若为新的一天,获取可用于回转的昨仓 if context.day[0] != context.day[-1]: context.ending = 0 context.turnaround = [0, 0] if context.ending == 1: return &nbsp; # 若有可用的昨仓则操作 if context.total &gt;= 0: # 获取时间序列数据 symbol = bar[&#39;symbol&#39;] recent_data = context.data(symbol=symbol, frequency=&#39;60s&#39;, count=35, fields=&#39;close&#39;) # 计算MACD线 macd = talib.MACD(recent_data[&#39;close&#39;].values)[0][-1] # 根据MACD&gt;0则开仓,小于0则平仓 if macd &gt; 0: # 多空单向操作都不能超过昨仓位,否则最后无法调回原仓位 if context.turnaround[0] + context.trade_n &lt; context.total: # 计算累计仓位 context.turnaround[0] += context.trade_n order_volume(symbol=context.symbol, volume=context.trade_n, side=PositionSide_Long, order_type=OrderType_Market, position_effect=PositionEffect_Open) print(symbol, &#39;市价单开多仓&#39;, context.trade_n, &#39;股&#39;) elif macd &lt; 0: if context.turnaround[1] + context.trade_n &lt; context.total: context.turnaround[1] += context.trade_n order_volume(symbol=context.symbol, volume=context.trade_n, side=PositionSide_Short, order_type=OrderType_Market, position_effect=PositionEffect_Close) print(symbol, &#39;市价单平多仓&#39;, context.trade_n, &#39;股&#39;) # 临近收盘时若仓位数不等于昨仓则回转所有仓位 if day[11:16] == &#39;14:55&#39; or day[11:16] == &#39;14:57&#39;: position = context.account().position(symbol=context.symbol, side=PositionSide_Long) if position[&#39;volume&#39;] != context.total: order_target_volume(symbol=context.symbol, volume=context.total, order_type=OrderType_Market, position_side=PositionSide_Long) print(&#39;市价单回转仓位操作...&#39;) context.ending = 1 # 更新过去的日期数据 context.day[-1] = context.day[0] &nbsp; &nbsp; if __name__ == &#39;__main__&#39;: &#39;&#39;&#39; strategy_id策略ID,由系统生成 filename文件名,请与本文件名保持一致 mode实时模式:MODE_LIVE回测模式:MODE_BACKTEST token绑定计算机的ID,可在系统设置-密钥管理中生成 backtest_start_time回测开始时间 backtest_end_time回测结束时间 backtest_adjust股票复权方式不复权:ADJUST_NONE前复权:ADJUST_PREV后复权:ADJUST_POST backtest_initial_cash回测初始资金 backtest_commission_ratio回测佣金比例 backtest_slippage_ratio回测滑点比例 &#39;&#39;&#39; run(strategy_id=&#39;strategy_id&#39;, filename=&#39;main.py&#39;, mode=MODE_BACKTEST, token=&#39;token_id&#39;, backtest_start_time=&#39;2017-09-01 08:00:00&#39;, backtest_end_time=&#39;2017-10-01 16:00:00&#39;, backtest_adjust=ADJUST_PREV, backtest_initial_cash=2000000, backtest_commission_ratio=0.0001, backtest_slippage_ratio=0.0001) 文章来源：掘金量化交易平台&nbsp;,转载请注册出处！ &nbsp; ---------------------------------------------------------------------------------------------------------------------------------------------------------- 更多经典股票/期货量化策略源码查看： 1 双均线策略(期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/153 2 alpha对冲(股票+期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/101 3 集合竞价选股(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/102 4 多因子选股(股票)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/103 5 网格交易(期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/104 6 指数增强(股票)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/105 7 跨品种套利(期货)量化策略源码 https://www.myquant.cn/docs/python_strategyies/106 8 跨期套利(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/107 9 日内回转交易(股票)量化策略源码 https://www.myquant.cn/docs/python_strategyies/108 10 做市商交易(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/109 11 海龟交易法(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/110 12 行业轮动(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/111 13 机器学习(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/112 阅读更多" />
<meta property="og:description" content="什么是日内交易？ ​ 日内交易（Day Trade）是一种交易模式。主要是指持仓时间短，不留过夜持仓的交易方式。日内交易捕捉入市后能够马上脱离入市成本的交易机会，入市之后如果不能马上获利，就准备迅速离场。因为这种交易方式在市时间短，所以承受的市场波动的风险较低。目前，全球范围内有一些操盘高手采用此交易方式取得稳定的盈利，获得了成功。 日内策略在中国市场可行吗？ ​ 与国外市场不同，我国股票市场现阶段施行“T+1”交易，在这个基础上的“T+0”操作，必须是有底仓的高抛低吸。 ​ 但凡在日内交易上经验丰富且有很高胜率的选手，在持股期，都会对日内交易拥有极高的兴趣，交易频次也会比较高。以上表述已经暗含了一个隐藏的前提：必须是当天不准备卖出者才能做T，否则会为了几个点的微小价差而得不偿失。 ​ 日内交易因为其快速了结和价差较小的特点，交易者盈利的首要条件即为一个交易来回的价差大于交易成本。按照当前券商普遍采用的佣金标准万三计算，一个完整交易轮回的摩擦成本略小于0.2%，从这点看，低佣金使得日内交易的盈利变得相对容易。根据我自身的交易经验，只要参与者对单次盈利预期合理且在介入时间点上不至太过偏离，均能在长久的做T生涯中获得不菲的正收益。 策略实现（基于掘金量化平台） 策略思想 本策略首先买入“SHSE.600000”股票10000股。 根据300s的数据来计算“MACD(12,26,9)”线。 “MACD”水下金叉，配合均线多头排列的时候买入1000股，“MACD”水上死叉，配合均线空头排列的时候卖出1000股。 每日操作的股票数不超过原有仓位，并于收盘前把仓位调整至开盘前的仓位。 策略主要步骤实现 订阅数据 subscribe(symbols=symbols, frequency=&#39;300s&#39;, count=35, wait_group=True)(symbols=symbols, frequency=&#39;300s&#39;, count=35, wait_group=True) ​ 订阅数据需要在定义init函数里面设置，并调用subscribe函数： symbols需要设置订阅的标的代码。 frequency需设置订阅数据的周期级别，这里设置1d 表示以一天为周期。 count需要设置获取的bar的数量 数据获取 recent_data = context.data(symbol=symbol, frequency=&#39;300s&#39;, count=35, fields=&#39;close&#39;) = context.data(symbol=symbol, frequency=&#39;300s&#39;, count=35, fields=&#39;close&#39;) ​ 订阅数据之后，需要获取已经订阅的数据来进行操作，这时需调用context.data函数： symbols 需要设置订阅的标的代码。 frequency需设置订阅数据的周期级别，这里设置1d表示以一天为周期。 count需要设置获取的bar的数量 fields需要设置返回值的种类 获取当前bar的时间 def on_bar(context, bars): &nbsp; &nbsp;bar = bars[0] &nbsp; &nbsp;day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) on_bar(context, bars): &nbsp; &nbsp;bar = bars[0] &nbsp; &nbsp;day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) ​ 在on_bar函数里，需要判断当前bar是否为当天交易的最后一根，以判断是否平仓，这里可直接过去传入bar的信息。 参数名 类型 说明 symbol str 标的代码 frequency str 频率 open float 开盘价 close float 收盘价 high float 最高价 low float 最低价 amount float 成交额 volume float 成交量 position long 持仓量 pre_close float 前收盘价 bob datetime.datetime bar开始时间 eob datetime.datetime bar结束时间 回测报告 分析 ​ 我们选取了2016年1月至2016年7月作为回测周期，保利地产（600048）作为标的股票，可以看出： 胜率（具有盈利的平仓次数与总平仓次数之比）达到了46%，当然，您可以根据需要，制定别的高胜率的开平仓条件。 卡玛比率（年化收益率与历史最大回撤之比）是使用最大回撤率来衡量风险。采用最大回撤率来衡量风险，关注的是最极端的情况。卡玛比率越高表示策略承受每单位最大损失获得的报酬越高。在这里卡玛比率达到了1.4。 夏普比率（年化收益率减无风险收益率的差收益波动率之比）达到0.78。 策略收益曲线与标的股票收益具有很大相关性，日内交易的关键点在于手续费的控制，在提高胜率的同时，尽量提高盈亏比，使得平仓的价差收益大于手续费的损耗。 &nbsp; 股票日内回转交易策略源码： &nbsp; # coding=utf-8 from __future__ import print_function, absolute_import, unicode_literals try: import talib except: print(&#39;请安装TA-Lib库&#39;) from gm.api import * &nbsp; &#39;&#39;&#39; 本策略首先买入SHSE.600000股票10000股 随后根据60s的数据来计算MACD(12,26,9)线,并在MACD&gt;0的时候买入100股,MACD&lt;0的时候卖出100股 但每日操作的股票数不超过原有仓位,并于收盘前把仓位调整至开盘前的仓位 回测数据为:SHSE.600000的60s数据 回测时间为:2017-09-01 08:00:00到2017-10-01 16:00:00 &#39;&#39;&#39; &nbsp; &nbsp; def init(context): # 设置标的股票 context.symbol = &#39;SHSE.600000&#39; # 用于判定第一个仓位是否成功开仓 context.first = 0 # 订阅浦发银行, bar频率为1min subscribe(symbols=context.symbol, frequency=&#39;60s&#39;, count=35) # 日内回转每次交易100股 context.trade_n = 100 # 获取昨今天的时间 context.day = [0, 0] # 用于判断是否触发了回转逻辑的计时 context.ending = 0 &nbsp; &nbsp; def on_bar(context, bars): bar = bars[0] if context.first == 0: # 最开始配置仓位 # 需要保持的总仓位 context.total = 10000 # 购买10000股浦发银行股票 order_volume(symbol=context.symbol, volume=context.total, side=PositionSide_Long, order_type=OrderType_Market, position_effect=PositionEffect_Open) print(context.symbol, &#39;以市价单开多仓10000股&#39;) context.first = 1. day = bar.bob.strftime(&#39;%Y-%m-%d&#39;) context.day[-1] = day[-2:] # 每天的仓位操作 context.turnaround = [0, 0] return &nbsp; # 更新最新的日期 day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) context.day[0] = bar.bob.day # 若为新的一天,获取可用于回转的昨仓 if context.day[0] != context.day[-1]: context.ending = 0 context.turnaround = [0, 0] if context.ending == 1: return &nbsp; # 若有可用的昨仓则操作 if context.total &gt;= 0: # 获取时间序列数据 symbol = bar[&#39;symbol&#39;] recent_data = context.data(symbol=symbol, frequency=&#39;60s&#39;, count=35, fields=&#39;close&#39;) # 计算MACD线 macd = talib.MACD(recent_data[&#39;close&#39;].values)[0][-1] # 根据MACD&gt;0则开仓,小于0则平仓 if macd &gt; 0: # 多空单向操作都不能超过昨仓位,否则最后无法调回原仓位 if context.turnaround[0] + context.trade_n &lt; context.total: # 计算累计仓位 context.turnaround[0] += context.trade_n order_volume(symbol=context.symbol, volume=context.trade_n, side=PositionSide_Long, order_type=OrderType_Market, position_effect=PositionEffect_Open) print(symbol, &#39;市价单开多仓&#39;, context.trade_n, &#39;股&#39;) elif macd &lt; 0: if context.turnaround[1] + context.trade_n &lt; context.total: context.turnaround[1] += context.trade_n order_volume(symbol=context.symbol, volume=context.trade_n, side=PositionSide_Short, order_type=OrderType_Market, position_effect=PositionEffect_Close) print(symbol, &#39;市价单平多仓&#39;, context.trade_n, &#39;股&#39;) # 临近收盘时若仓位数不等于昨仓则回转所有仓位 if day[11:16] == &#39;14:55&#39; or day[11:16] == &#39;14:57&#39;: position = context.account().position(symbol=context.symbol, side=PositionSide_Long) if position[&#39;volume&#39;] != context.total: order_target_volume(symbol=context.symbol, volume=context.total, order_type=OrderType_Market, position_side=PositionSide_Long) print(&#39;市价单回转仓位操作...&#39;) context.ending = 1 # 更新过去的日期数据 context.day[-1] = context.day[0] &nbsp; &nbsp; if __name__ == &#39;__main__&#39;: &#39;&#39;&#39; strategy_id策略ID,由系统生成 filename文件名,请与本文件名保持一致 mode实时模式:MODE_LIVE回测模式:MODE_BACKTEST token绑定计算机的ID,可在系统设置-密钥管理中生成 backtest_start_time回测开始时间 backtest_end_time回测结束时间 backtest_adjust股票复权方式不复权:ADJUST_NONE前复权:ADJUST_PREV后复权:ADJUST_POST backtest_initial_cash回测初始资金 backtest_commission_ratio回测佣金比例 backtest_slippage_ratio回测滑点比例 &#39;&#39;&#39; run(strategy_id=&#39;strategy_id&#39;, filename=&#39;main.py&#39;, mode=MODE_BACKTEST, token=&#39;token_id&#39;, backtest_start_time=&#39;2017-09-01 08:00:00&#39;, backtest_end_time=&#39;2017-10-01 16:00:00&#39;, backtest_adjust=ADJUST_PREV, backtest_initial_cash=2000000, backtest_commission_ratio=0.0001, backtest_slippage_ratio=0.0001) 文章来源：掘金量化交易平台&nbsp;,转载请注册出处！ &nbsp; ---------------------------------------------------------------------------------------------------------------------------------------------------------- 更多经典股票/期货量化策略源码查看： 1 双均线策略(期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/153 2 alpha对冲(股票+期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/101 3 集合竞价选股(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/102 4 多因子选股(股票)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/103 5 网格交易(期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/104 6 指数增强(股票)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/105 7 跨品种套利(期货)量化策略源码 https://www.myquant.cn/docs/python_strategyies/106 8 跨期套利(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/107 9 日内回转交易(股票)量化策略源码 https://www.myquant.cn/docs/python_strategyies/108 10 做市商交易(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/109 11 海龟交易法(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/110 12 行业轮动(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/111 13 机器学习(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/112 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/06/07/e058f3b01a546f145e074a8523b124cf.html" />
<meta property="og:url" content="https://mlh.app/2018/06/07/e058f3b01a546f145e074a8523b124cf.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-07T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"什么是日内交易？ ​ 日内交易（Day Trade）是一种交易模式。主要是指持仓时间短，不留过夜持仓的交易方式。日内交易捕捉入市后能够马上脱离入市成本的交易机会，入市之后如果不能马上获利，就准备迅速离场。因为这种交易方式在市时间短，所以承受的市场波动的风险较低。目前，全球范围内有一些操盘高手采用此交易方式取得稳定的盈利，获得了成功。 日内策略在中国市场可行吗？ ​ 与国外市场不同，我国股票市场现阶段施行“T+1”交易，在这个基础上的“T+0”操作，必须是有底仓的高抛低吸。 ​ 但凡在日内交易上经验丰富且有很高胜率的选手，在持股期，都会对日内交易拥有极高的兴趣，交易频次也会比较高。以上表述已经暗含了一个隐藏的前提：必须是当天不准备卖出者才能做T，否则会为了几个点的微小价差而得不偿失。 ​ 日内交易因为其快速了结和价差较小的特点，交易者盈利的首要条件即为一个交易来回的价差大于交易成本。按照当前券商普遍采用的佣金标准万三计算，一个完整交易轮回的摩擦成本略小于0.2%，从这点看，低佣金使得日内交易的盈利变得相对容易。根据我自身的交易经验，只要参与者对单次盈利预期合理且在介入时间点上不至太过偏离，均能在长久的做T生涯中获得不菲的正收益。 策略实现（基于掘金量化平台） 策略思想 本策略首先买入“SHSE.600000”股票10000股。 根据300s的数据来计算“MACD(12,26,9)”线。 “MACD”水下金叉，配合均线多头排列的时候买入1000股，“MACD”水上死叉，配合均线空头排列的时候卖出1000股。 每日操作的股票数不超过原有仓位，并于收盘前把仓位调整至开盘前的仓位。 策略主要步骤实现 订阅数据 subscribe(symbols=symbols, frequency=&#39;300s&#39;, count=35, wait_group=True)(symbols=symbols, frequency=&#39;300s&#39;, count=35, wait_group=True) ​ 订阅数据需要在定义init函数里面设置，并调用subscribe函数： symbols需要设置订阅的标的代码。 frequency需设置订阅数据的周期级别，这里设置1d 表示以一天为周期。 count需要设置获取的bar的数量 数据获取 recent_data = context.data(symbol=symbol, frequency=&#39;300s&#39;, count=35, fields=&#39;close&#39;) = context.data(symbol=symbol, frequency=&#39;300s&#39;, count=35, fields=&#39;close&#39;) ​ 订阅数据之后，需要获取已经订阅的数据来进行操作，这时需调用context.data函数： symbols 需要设置订阅的标的代码。 frequency需设置订阅数据的周期级别，这里设置1d表示以一天为周期。 count需要设置获取的bar的数量 fields需要设置返回值的种类 获取当前bar的时间 def on_bar(context, bars): &nbsp; &nbsp;bar = bars[0] &nbsp; &nbsp;day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) on_bar(context, bars): &nbsp; &nbsp;bar = bars[0] &nbsp; &nbsp;day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) ​ 在on_bar函数里，需要判断当前bar是否为当天交易的最后一根，以判断是否平仓，这里可直接过去传入bar的信息。 参数名 类型 说明 symbol str 标的代码 frequency str 频率 open float 开盘价 close float 收盘价 high float 最高价 low float 最低价 amount float 成交额 volume float 成交量 position long 持仓量 pre_close float 前收盘价 bob datetime.datetime bar开始时间 eob datetime.datetime bar结束时间 回测报告 分析 ​ 我们选取了2016年1月至2016年7月作为回测周期，保利地产（600048）作为标的股票，可以看出： 胜率（具有盈利的平仓次数与总平仓次数之比）达到了46%，当然，您可以根据需要，制定别的高胜率的开平仓条件。 卡玛比率（年化收益率与历史最大回撤之比）是使用最大回撤率来衡量风险。采用最大回撤率来衡量风险，关注的是最极端的情况。卡玛比率越高表示策略承受每单位最大损失获得的报酬越高。在这里卡玛比率达到了1.4。 夏普比率（年化收益率减无风险收益率的差收益波动率之比）达到0.78。 策略收益曲线与标的股票收益具有很大相关性，日内交易的关键点在于手续费的控制，在提高胜率的同时，尽量提高盈亏比，使得平仓的价差收益大于手续费的损耗。 &nbsp; 股票日内回转交易策略源码： &nbsp; # coding=utf-8 from __future__ import print_function, absolute_import, unicode_literals try: import talib except: print(&#39;请安装TA-Lib库&#39;) from gm.api import * &nbsp; &#39;&#39;&#39; 本策略首先买入SHSE.600000股票10000股 随后根据60s的数据来计算MACD(12,26,9)线,并在MACD&gt;0的时候买入100股,MACD&lt;0的时候卖出100股 但每日操作的股票数不超过原有仓位,并于收盘前把仓位调整至开盘前的仓位 回测数据为:SHSE.600000的60s数据 回测时间为:2017-09-01 08:00:00到2017-10-01 16:00:00 &#39;&#39;&#39; &nbsp; &nbsp; def init(context): # 设置标的股票 context.symbol = &#39;SHSE.600000&#39; # 用于判定第一个仓位是否成功开仓 context.first = 0 # 订阅浦发银行, bar频率为1min subscribe(symbols=context.symbol, frequency=&#39;60s&#39;, count=35) # 日内回转每次交易100股 context.trade_n = 100 # 获取昨今天的时间 context.day = [0, 0] # 用于判断是否触发了回转逻辑的计时 context.ending = 0 &nbsp; &nbsp; def on_bar(context, bars): bar = bars[0] if context.first == 0: # 最开始配置仓位 # 需要保持的总仓位 context.total = 10000 # 购买10000股浦发银行股票 order_volume(symbol=context.symbol, volume=context.total, side=PositionSide_Long, order_type=OrderType_Market, position_effect=PositionEffect_Open) print(context.symbol, &#39;以市价单开多仓10000股&#39;) context.first = 1. day = bar.bob.strftime(&#39;%Y-%m-%d&#39;) context.day[-1] = day[-2:] # 每天的仓位操作 context.turnaround = [0, 0] return &nbsp; # 更新最新的日期 day = bar.bob.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) context.day[0] = bar.bob.day # 若为新的一天,获取可用于回转的昨仓 if context.day[0] != context.day[-1]: context.ending = 0 context.turnaround = [0, 0] if context.ending == 1: return &nbsp; # 若有可用的昨仓则操作 if context.total &gt;= 0: # 获取时间序列数据 symbol = bar[&#39;symbol&#39;] recent_data = context.data(symbol=symbol, frequency=&#39;60s&#39;, count=35, fields=&#39;close&#39;) # 计算MACD线 macd = talib.MACD(recent_data[&#39;close&#39;].values)[0][-1] # 根据MACD&gt;0则开仓,小于0则平仓 if macd &gt; 0: # 多空单向操作都不能超过昨仓位,否则最后无法调回原仓位 if context.turnaround[0] + context.trade_n &lt; context.total: # 计算累计仓位 context.turnaround[0] += context.trade_n order_volume(symbol=context.symbol, volume=context.trade_n, side=PositionSide_Long, order_type=OrderType_Market, position_effect=PositionEffect_Open) print(symbol, &#39;市价单开多仓&#39;, context.trade_n, &#39;股&#39;) elif macd &lt; 0: if context.turnaround[1] + context.trade_n &lt; context.total: context.turnaround[1] += context.trade_n order_volume(symbol=context.symbol, volume=context.trade_n, side=PositionSide_Short, order_type=OrderType_Market, position_effect=PositionEffect_Close) print(symbol, &#39;市价单平多仓&#39;, context.trade_n, &#39;股&#39;) # 临近收盘时若仓位数不等于昨仓则回转所有仓位 if day[11:16] == &#39;14:55&#39; or day[11:16] == &#39;14:57&#39;: position = context.account().position(symbol=context.symbol, side=PositionSide_Long) if position[&#39;volume&#39;] != context.total: order_target_volume(symbol=context.symbol, volume=context.total, order_type=OrderType_Market, position_side=PositionSide_Long) print(&#39;市价单回转仓位操作...&#39;) context.ending = 1 # 更新过去的日期数据 context.day[-1] = context.day[0] &nbsp; &nbsp; if __name__ == &#39;__main__&#39;: &#39;&#39;&#39; strategy_id策略ID,由系统生成 filename文件名,请与本文件名保持一致 mode实时模式:MODE_LIVE回测模式:MODE_BACKTEST token绑定计算机的ID,可在系统设置-密钥管理中生成 backtest_start_time回测开始时间 backtest_end_time回测结束时间 backtest_adjust股票复权方式不复权:ADJUST_NONE前复权:ADJUST_PREV后复权:ADJUST_POST backtest_initial_cash回测初始资金 backtest_commission_ratio回测佣金比例 backtest_slippage_ratio回测滑点比例 &#39;&#39;&#39; run(strategy_id=&#39;strategy_id&#39;, filename=&#39;main.py&#39;, mode=MODE_BACKTEST, token=&#39;token_id&#39;, backtest_start_time=&#39;2017-09-01 08:00:00&#39;, backtest_end_time=&#39;2017-10-01 16:00:00&#39;, backtest_adjust=ADJUST_PREV, backtest_initial_cash=2000000, backtest_commission_ratio=0.0001, backtest_slippage_ratio=0.0001) 文章来源：掘金量化交易平台&nbsp;,转载请注册出处！ &nbsp; ---------------------------------------------------------------------------------------------------------------------------------------------------------- 更多经典股票/期货量化策略源码查看： 1 双均线策略(期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/153 2 alpha对冲(股票+期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/101 3 集合竞价选股(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/102 4 多因子选股(股票)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/103 5 网格交易(期货)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/104 6 指数增强(股票)&nbsp; 量化策略源码 https://www.myquant.cn/docs/python_strategyies/105 7 跨品种套利(期货)量化策略源码 https://www.myquant.cn/docs/python_strategyies/106 8 跨期套利(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/107 9 日内回转交易(股票)量化策略源码 https://www.myquant.cn/docs/python_strategyies/108 10 做市商交易(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/109 11 海龟交易法(期货) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/110 12 行业轮动(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/111 13 机器学习(股票) 量化策略源码 https://www.myquant.cn/docs/python_strategyies/112 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/06/07/e058f3b01a546f145e074a8523b124cf.html","headline":"股票日内回转交易策略（附源码）","dateModified":"2018-06-07T00:00:00+08:00","datePublished":"2018-06-07T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/06/07/e058f3b01a546f145e074a8523b124cf.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>股票日内回转交易策略（附源码）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h1>什么是日内交易？</h1> 
  <p>​ 日内交易（Day Trade）是一种交易模式。主要是指持仓时间短，不留过夜持仓的交易方式。日内交易捕捉入市后能够马上脱离入市成本的交易机会，入市之后如果不能马上获利，就准备迅速离场。因为这种交易方式在市时间短，所以承受的市场波动的风险较低。目前，全球范围内有一些操盘高手采用此交易方式取得稳定的盈利，获得了成功。</p> 
  <h2>日内策略在中国市场可行吗？</h2> 
  <p>​ 与国外市场不同，我国股票市场现阶段施行“T+1”交易，在这个基础上的“T+0”操作，必须是有底仓的高抛低吸。</p> 
  <p>​ 但凡在日内交易上经验丰富且有很高胜率的选手，在持股期，都会对日内交易拥有极高的兴趣，交易频次也会比较高。以上表述已经暗含了一个隐藏的前提：必须是当天不准备卖出者才能做T，否则会为了几个点的微小价差而得不偿失。</p> 
  <p>​ 日内交易因为其快速了结和价差较小的特点，交易者盈利的首要条件即为一个交易来回的价差大于交易成本。按照当前券商普遍采用的佣金标准万三计算，一个完整交易轮回的摩擦成本略小于0.2%，从这点看，低佣金使得日内交易的盈利变得相对容易。根据我自身的交易经验，只要参与者对单次盈利预期合理且在介入时间点上不至太过偏离，均能在长久的做T生涯中获得不菲的正收益。</p> 
  <h2>策略实现（<a href="http://www.myquant.cn" rel="nofollow">基于掘金量化平台</a>）</h2> 
  <h3>策略思想</h3> 
  <ul>
   <li style="margin-left:0px;"> <p>本策略首先买入“SHSE.600000”股票10000股。</p> </li> 
   <li style="margin-left:0px;"> <p>根据300s的数据来计算“MACD(12,26,9)”线。</p> </li> 
   <li style="margin-left:0px;"> <p>“MACD”水下金叉，配合均线多头排列的时候买入1000股，“MACD”水上死叉，配合均线空头排列的时候卖出1000股。</p> </li> 
   <li style="margin-left:0px;"> <p>每日操作的股票数不超过原有仓位，并于收盘前把仓位调整至开盘前的仓位。</p> </li> 
  </ul>
  <h3>策略主要步骤实现</h3> 
  <p>订阅数据</p> 
  <pre class="has">
<code class="language-md-end-block"><span style="color:#000000;">subscribe</span>(<span style="color:#000000;">symbols</span>=<span style="color:#000000;">symbols</span>, <span style="color:#000000;">frequency</span>=<span style="color:#aa1111;">'300s'</span>, <span style="color:#000000;">count</span>=<span style="color:#116644;">35</span>, <span style="color:#000000;">wait_group</span>=<span style="color:#770088;">True</span>)</code>(<span style="color:#000000;">symbols</span>=<span style="color:#000000;">symbols</span>, <span style="color:#000000;">frequency</span>=<span style="color:#aa1111;">'300s'</span>, <span style="color:#000000;">count</span>=<span style="color:#116644;">35</span>, <span style="color:#000000;">wait_group</span>=<span style="color:#770088;">True</span>)</pre> 
  <p>​ 订阅数据需要在定义<code>init</code>函数里面设置，并调用<code>subscribe</code>函数：</p> 
  <ul>
   <li style="margin-left:0px;"> <p><code>symbols</code>需要设置订阅的标的代码。</p> </li> 
   <li style="margin-left:0px;"> <p><code>frequency</code>需设置订阅数据的周期级别，这里设置<code>1d</code> 表示以一天为周期。</p> </li> 
   <li style="margin-left:0px;"> <p><code>count</code>需要设置获取的bar的数量</p> </li> 
  </ul>
  <p>数据获取</p> 
  <pre class="has">
<code class="language-md-end-block"><span style="color:#000000;">recent_data</span> = <span style="color:#000000;">context</span>.<span style="color:#000000;">data</span>(<span style="color:#000000;">symbol</span>=<span style="color:#000000;">symbol</span>, <span style="color:#000000;">frequency</span>=<span style="color:#aa1111;">'300s'</span>, <span style="color:#000000;">count</span>=<span style="color:#116644;">35</span>, <span style="color:#000000;">fields</span>=<span style="color:#aa1111;">'close'</span>)</code> = <span style="color:#000000;">context</span>.<span style="color:#000000;">data</span>(<span style="color:#000000;">symbol</span>=<span style="color:#000000;">symbol</span>, <span style="color:#000000;">frequency</span>=<span style="color:#aa1111;">'300s'</span>, <span style="color:#000000;">count</span>=<span style="color:#116644;">35</span>, <span style="color:#000000;">fields</span>=<span style="color:#aa1111;">'close'</span>)</pre> 
  <p>​ 订阅数据之后，需要获取已经订阅的数据来进行操作，这时需调用<code>context.data</code>函数：</p> 
  <ul>
   <li style="margin-left:0px;"> <p><code>symbols</code> 需要设置订阅的标的代码。</p> </li> 
   <li style="margin-left:0px;"> <p><code>frequency</code>需设置订阅数据的周期级别，这里设置<code>1d</code>表示以一天为周期。</p> </li> 
   <li style="margin-left:0px;"> <p><code>count</code>需要设置获取的bar的数量</p> </li> 
   <li style="margin-left:0px;"> <p><code>fields</code>需要设置返回值的种类</p> </li> 
  </ul>
  <p>获取当前bar的时间</p> 
  <pre class="has">
<code class="language-md-end-block"><span style="color:#770088;">def</span> <span style="color:#0000ff;">on_bar</span>(<span style="color:#000000;">context</span>, <span style="color:#000000;">bars</span>):
 &nbsp; &nbsp;<span style="color:#000000;">bar</span> = <span style="color:#000000;">bars</span>[<span style="color:#116644;">0</span>]
 &nbsp; &nbsp;<span style="color:#000000;">day</span> = <span style="color:#000000;">bar</span>.<span style="color:#000000;">bob</span>.<span style="color:#000000;">strftime</span>(<span style="color:#aa1111;">'%Y-%m-%d %H:%M:%S'</span>)</code> <span style="color:#0000ff;">on_bar</span>(<span style="color:#000000;">context</span>, <span style="color:#000000;">bars</span>):
 &nbsp; &nbsp;<span style="color:#000000;">bar</span> = <span style="color:#000000;">bars</span>[<span style="color:#116644;">0</span>]
 &nbsp; &nbsp;<span style="color:#000000;">day</span> = <span style="color:#000000;">bar</span>.<span style="color:#000000;">bob</span>.<span style="color:#000000;">strftime</span>(<span style="color:#aa1111;">'%Y-%m-%d %H:%M:%S'</span>)</pre> 
  <p>​ 在<code>on_bar</code>函数里，需要判断当前<code>bar</code>是否为当天交易的最后一根，以判断是否平仓，这里可直接过去传入<code>bar</code>的信息。</p> 
  <table>
   <thead>
    <tr>
     <th>参数名</th> 
     <th>类型</th> 
     <th>说明</th> 
    </tr>
   </thead>
   <tbody>
    <tr>
     <td style="border-color:#dfe2e5;">symbol</td> 
     <td style="border-color:#dfe2e5;">str</td> 
     <td style="border-color:#dfe2e5;">标的代码</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">frequency</td> 
     <td style="border-color:#dfe2e5;">str</td> 
     <td style="border-color:#dfe2e5;">频率</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">open</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">开盘价</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">close</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">收盘价</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">high</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">最高价</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">low</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">最低价</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">amount</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">成交额</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">volume</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">成交量</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">position</td> 
     <td style="border-color:#dfe2e5;">long</td> 
     <td style="border-color:#dfe2e5;">持仓量</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">pre_close</td> 
     <td style="border-color:#dfe2e5;">float</td> 
     <td style="border-color:#dfe2e5;">前收盘价</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">bob</td> 
     <td style="border-color:#dfe2e5;">datetime.datetime</td> 
     <td style="border-color:#dfe2e5;">bar开始时间</td> 
    </tr>
    <tr>
     <td style="border-color:#dfe2e5;">eob</td> 
     <td style="border-color:#dfe2e5;">datetime.datetime</td> 
     <td style="border-color:#dfe2e5;">bar结束时间</td> 
    </tr>
   </tbody>
  </table>
  <p>回测报告</p> 
  <p><img alt="" class="has" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180607140959108"></p> 
  <p>分析</p> 
  <p>​ 我们选取了2016年1月至2016年7月作为回测周期，保利地产（600048）作为标的股票，可以看出：</p> 
  <ul>
   <li style="margin-left:0px;"> <p><strong>胜率</strong>（具有盈利的平仓次数与总平仓次数之比）达到了46%，当然，您可以根据需要，制定别的高胜率的开平仓条件。</p> </li> 
  </ul>
  <ul>
   <li style="margin-left:0px;"> <p><strong>卡玛比率</strong>（年化收益率与历史最大回撤之比）是使用<strong>最大回撤率</strong>来衡量风险。<strong>采用最大回撤率来衡量风险，关注的是最极端的情况。</strong>卡玛比率越高表示策略承受每单位最大损失获得的报酬越高。在这里卡玛比率达到了1.4。</p> </li> 
  </ul>
  <ul>
   <li style="margin-left:0px;"> <p><strong>夏普比率</strong>（年化收益率减无风险收益率的差收益波动率之比）达到0.78。</p> </li> 
  </ul>
  <ul>
   <li style="margin-left:0px;"> <p><strong>策略收益曲线</strong>与标的股票收益具有很大相关性，日内交易的关键点在于手续费的控制，在提高胜率的同时，尽量提高盈亏比，使得平仓的价差收益大于手续费的损耗。</p> </li> 
  </ul>
  <p>&nbsp;</p> 
  <p><a href="https://www.myquant.cn/docs/python_strategyies/108" rel="nofollow"><span style="color:#ff0000;"><u>股票日内回转交易策略源码：</u></span></a></p> 
  <p>&nbsp;</p> 
  <ol>
   <li><code><span style="color:#880000;"># coding=utf-8</span></code></li> 
   <li><code><span style="color:#000088;">from</span><span style="color:#000000;"> __future__ </span><span style="color:#000088;">import</span><span style="color:#000000;"> print_function</span><span style="color:#666600;">,</span><span style="color:#000000;"> absolute_import</span><span style="color:#666600;">,</span><span style="color:#000000;"> unicode_literals</span></code></li> 
   <li><code><span style="color:#000088;">try</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000088;">import</span><span style="color:#000000;"> talib</span></code></li> 
   <li><code><span style="color:#000088;">except</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000088;">print</span><span style="color:#666600;">(</span><span style="color:#008800;">'请安装TA-Lib库'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">from</span><span style="color:#000000;"> gm</span><span style="color:#666600;">.</span><span style="color:#000000;">api </span><span style="color:#000088;">import</span><span style="color:#000000;"> </span><span style="color:#666600;">*</span></code></li> 
   <li>&nbsp;</li> 
   <li><code><span style="color:#008800;">'''</span></code></li> 
   <li><code><span style="color:#008800;">本策略首先买入SHSE.600000股票10000股</span></code></li> 
   <li><code><span style="color:#008800;">随后根据60s的数据来计算MACD(12,26,9)线,并在MACD&gt;0的时候买入100股,MACD&lt;0的时候卖出100股</span></code></li> 
   <li><code><span style="color:#008800;">但每日操作的股票数不超过原有仓位,并于收盘前把仓位调整至开盘前的仓位</span></code></li> 
   <li><code><span style="color:#008800;">回测数据为:SHSE.600000的60s数据</span></code></li> 
   <li><code><span style="color:#008800;">回测时间为:2017-09-01 08:00:00到2017-10-01 16:00:00</span></code></li> 
   <li><code><span style="color:#008800;">'''</span></code></li> 
   <li>&nbsp;</li> 
   <li>&nbsp;</li> 
   <li><code><span style="color:#000088;">def</span><span style="color:#000000;"> init</span><span style="color:#666600;">(</span><span style="color:#000000;">context</span><span style="color:#666600;">):</span></code></li> 
   <li><code><span style="color:#880000;"># 设置标的股票</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#008800;">'SHSE.600000'</span></code></li> 
   <li><code><span style="color:#880000;"># 用于判定第一个仓位是否成功开仓</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">first </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span></code></li> 
   <li><code><span style="color:#880000;"># 订阅浦发银行, bar频率为1min</span></code></li> 
   <li><code><span style="color:#000000;">subscribe</span><span style="color:#666600;">(</span><span style="color:#000000;">symbols</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> frequency</span><span style="color:#666600;">=</span><span style="color:#008800;">'60s'</span><span style="color:#666600;">,</span><span style="color:#000000;"> count</span><span style="color:#666600;">=</span><span style="color:#006666;">35</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#880000;"># 日内回转每次交易100股</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">100</span></code></li> 
   <li><code><span style="color:#880000;"># 获取昨今天的时间</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">day </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">]</span></code></li> 
   <li><code><span style="color:#880000;"># 用于判断是否触发了回转逻辑的计时</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">ending </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span></code></li> 
   <li>&nbsp;</li> 
   <li>&nbsp;</li> 
   <li><code><span style="color:#000088;">def</span><span style="color:#000000;"> on_bar</span><span style="color:#666600;">(</span><span style="color:#000000;">context</span><span style="color:#666600;">,</span><span style="color:#000000;"> bars</span><span style="color:#666600;">):</span></code></li> 
   <li><code><span style="color:#000000;">bar </span><span style="color:#666600;">=</span><span style="color:#000000;"> bars</span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">]</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">first </span><span style="color:#666600;">==</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#880000;"># 最开始配置仓位</span></code></li> 
   <li><code><span style="color:#880000;"># 需要保持的总仓位</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">total </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">10000</span></code></li> 
   <li><code><span style="color:#880000;"># 购买10000股浦发银行股票</span></code></li> 
   <li><code><span style="color:#000000;">order_volume</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> volume</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">total</span><span style="color:#666600;">,</span><span style="color:#000000;"> side</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionSide_Long</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">order_type</span><span style="color:#666600;">=</span><span style="color:#660066;">OrderType_Market</span><span style="color:#666600;">,</span><span style="color:#000000;"> position_effect</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionEffect_Open</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">print</span><span style="color:#666600;">(</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#008800;">'以市价单开多仓10000股'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">first </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">1.</span></code></li> 
   <li><code><span style="color:#000000;">day </span><span style="color:#666600;">=</span><span style="color:#000000;"> bar</span><span style="color:#666600;">.</span><span style="color:#000000;">bob</span><span style="color:#666600;">.</span><span style="color:#000000;">strftime</span><span style="color:#666600;">(</span><span style="color:#008800;">'%Y-%m-%d'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span><span style="color:#666600;">[-</span><span style="color:#006666;">1</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">=</span><span style="color:#000000;"> day</span><span style="color:#666600;">[-</span><span style="color:#006666;">2</span><span style="color:#666600;">:]</span></code></li> 
   <li><code><span style="color:#880000;"># 每天的仓位操作</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">turnaround </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">]</span></code></li> 
   <li><code><span style="color:#000088;">return</span></code></li> 
   <li>&nbsp;</li> 
   <li><code><span style="color:#880000;"># 更新最新的日期</span></code></li> 
   <li><code><span style="color:#000000;">day </span><span style="color:#666600;">=</span><span style="color:#000000;"> bar</span><span style="color:#666600;">.</span><span style="color:#000000;">bob</span><span style="color:#666600;">.</span><span style="color:#000000;">strftime</span><span style="color:#666600;">(</span><span style="color:#008800;">'%Y-%m-%d %H:%M:%S'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">=</span><span style="color:#000000;"> bar</span><span style="color:#666600;">.</span><span style="color:#000000;">bob</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span></code></li> 
   <li><code><span style="color:#880000;"># 若为新的一天,获取可用于回转的昨仓</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">!=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span><span style="color:#666600;">[-</span><span style="color:#006666;">1</span><span style="color:#666600;">]:</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">ending </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">turnaround </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">]</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">ending </span><span style="color:#666600;">==</span><span style="color:#000000;"> </span><span style="color:#006666;">1</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000088;">return</span></code></li> 
   <li>&nbsp;</li> 
   <li><code><span style="color:#880000;"># 若有可用的昨仓则操作</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">total </span><span style="color:#666600;">&gt;=</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#880000;"># 获取时间序列数据</span></code></li> 
   <li><code><span style="color:#000000;">symbol </span><span style="color:#666600;">=</span><span style="color:#000000;"> bar</span><span style="color:#666600;">[</span><span style="color:#008800;">'symbol'</span><span style="color:#666600;">]</span></code></li> 
   <li><code><span style="color:#000000;">recent_data </span><span style="color:#666600;">=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">data</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">=</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> frequency</span><span style="color:#666600;">=</span><span style="color:#008800;">'60s'</span><span style="color:#666600;">,</span><span style="color:#000000;"> count</span><span style="color:#666600;">=</span><span style="color:#006666;">35</span><span style="color:#666600;">,</span><span style="color:#000000;"> fields</span><span style="color:#666600;">=</span><span style="color:#008800;">'close'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#880000;"># 计算MACD线</span></code></li> 
   <li><code><span style="color:#000000;">macd </span><span style="color:#666600;">=</span><span style="color:#000000;"> talib</span><span style="color:#666600;">.</span><span style="color:#000000;">MACD</span><span style="color:#666600;">(</span><span style="color:#000000;">recent_data</span><span style="color:#666600;">[</span><span style="color:#008800;">'close'</span><span style="color:#666600;">].</span><span style="color:#000000;">values</span><span style="color:#666600;">)[</span><span style="color:#006666;">0</span><span style="color:#666600;">][-</span><span style="color:#006666;">1</span><span style="color:#666600;">]</span></code></li> 
   <li><code><span style="color:#880000;"># 根据MACD&gt;0则开仓,小于0则平仓</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> macd </span><span style="color:#666600;">&gt;</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#880000;"># 多空单向操作都不能超过昨仓位,否则最后无法调回原仓位</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">turnaround</span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">+</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n </span><span style="color:#666600;">&lt;</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">total</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#880000;"># 计算累计仓位</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">turnaround</span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">+=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n</span></code></li> 
   <li><code><span style="color:#000000;">order_volume</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> volume</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n</span><span style="color:#666600;">,</span><span style="color:#000000;"> side</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionSide_Long</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">order_type</span><span style="color:#666600;">=</span><span style="color:#660066;">OrderType_Market</span><span style="color:#666600;">,</span><span style="color:#000000;"> position_effect</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionEffect_Open</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">print</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#008800;">'市价单开多仓'</span><span style="color:#666600;">,</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#008800;">'股'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">elif</span><span style="color:#000000;"> macd </span><span style="color:#666600;">&lt;</span><span style="color:#000000;"> </span><span style="color:#006666;">0</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">turnaround</span><span style="color:#666600;">[</span><span style="color:#006666;">1</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">+</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n </span><span style="color:#666600;">&lt;</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">total</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">turnaround</span><span style="color:#666600;">[</span><span style="color:#006666;">1</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">+=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n</span></code></li> 
   <li><code><span style="color:#000000;">order_volume</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> volume</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n</span><span style="color:#666600;">,</span><span style="color:#000000;"> side</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionSide_Short</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">order_type</span><span style="color:#666600;">=</span><span style="color:#660066;">OrderType_Market</span><span style="color:#666600;">,</span><span style="color:#000000;"> position_effect</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionEffect_Close</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">print</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#008800;">'市价单平多仓'</span><span style="color:#666600;">,</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">trade_n</span><span style="color:#666600;">,</span><span style="color:#000000;"> </span><span style="color:#008800;">'股'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#880000;"># 临近收盘时若仓位数不等于昨仓则回转所有仓位</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> day</span><span style="color:#666600;">[</span><span style="color:#006666;">11</span><span style="color:#666600;">:</span><span style="color:#006666;">16</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">==</span><span style="color:#000000;"> </span><span style="color:#008800;">'14:55'</span><span style="color:#000000;"> </span><span style="color:#000088;">or</span><span style="color:#000000;"> day</span><span style="color:#666600;">[</span><span style="color:#006666;">11</span><span style="color:#666600;">:</span><span style="color:#006666;">16</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">==</span><span style="color:#000000;"> </span><span style="color:#008800;">'14:57'</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000000;">position </span><span style="color:#666600;">=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">account</span><span style="color:#666600;">().</span><span style="color:#000000;">position</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> side</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionSide_Long</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> position</span><span style="color:#666600;">[</span><span style="color:#008800;">'volume'</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">!=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">total</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#000000;">order_target_volume</span><span style="color:#666600;">(</span><span style="color:#000000;">symbol</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">symbol</span><span style="color:#666600;">,</span><span style="color:#000000;"> volume</span><span style="color:#666600;">=</span><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">total</span><span style="color:#666600;">,</span><span style="color:#000000;"> order_type</span><span style="color:#666600;">=</span><span style="color:#660066;">OrderType_Market</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">position_side</span><span style="color:#666600;">=</span><span style="color:#660066;">PositionSide_Long</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000088;">print</span><span style="color:#666600;">(</span><span style="color:#008800;">'市价单回转仓位操作...'</span><span style="color:#666600;">)</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">ending </span><span style="color:#666600;">=</span><span style="color:#000000;"> </span><span style="color:#006666;">1</span></code></li> 
   <li><code><span style="color:#880000;"># 更新过去的日期数据</span></code></li> 
   <li><code><span style="color:#000000;">context</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span><span style="color:#666600;">[-</span><span style="color:#006666;">1</span><span style="color:#666600;">]</span><span style="color:#000000;"> </span><span style="color:#666600;">=</span><span style="color:#000000;"> context</span><span style="color:#666600;">.</span><span style="color:#000000;">day</span><span style="color:#666600;">[</span><span style="color:#006666;">0</span><span style="color:#666600;">]</span></code></li> 
   <li>&nbsp;</li> 
   <li>&nbsp;</li> 
   <li><code><span style="color:#000088;">if</span><span style="color:#000000;"> __name__ </span><span style="color:#666600;">==</span><span style="color:#000000;"> </span><span style="color:#008800;">'__main__'</span><span style="color:#666600;">:</span></code></li> 
   <li><code><span style="color:#008800;">'''</span></code></li> 
   <li><code><span style="color:#008800;">strategy_id策略ID,由系统生成</span></code></li> 
   <li><code><span style="color:#008800;">filename文件名,请与本文件名保持一致</span></code></li> 
   <li><code><span style="color:#008800;">mode实时模式:MODE_LIVE回测模式:MODE_BACKTEST</span></code></li> 
   <li><code><span style="color:#008800;">token绑定计算机的ID,可在系统设置-密钥管理中生成</span></code></li> 
   <li><code><span style="color:#008800;">backtest_start_time回测开始时间</span></code></li> 
   <li><code><span style="color:#008800;">backtest_end_time回测结束时间</span></code></li> 
   <li><code><span style="color:#008800;">backtest_adjust股票复权方式不复权:ADJUST_NONE前复权:ADJUST_PREV后复权:ADJUST_POST</span></code></li> 
   <li><code><span style="color:#008800;">backtest_initial_cash回测初始资金</span></code></li> 
   <li><code><span style="color:#008800;">backtest_commission_ratio回测佣金比例</span></code></li> 
   <li><code><span style="color:#008800;">backtest_slippage_ratio回测滑点比例</span></code></li> 
   <li><code><span style="color:#008800;">'''</span></code></li> 
   <li><code><span style="color:#000000;">run</span><span style="color:#666600;">(</span><span style="color:#000000;">strategy_id</span><span style="color:#666600;">=</span><span style="color:#008800;">'strategy_id'</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">filename</span><span style="color:#666600;">=</span><span style="color:#008800;">'main.py'</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">mode</span><span style="color:#666600;">=</span><span style="color:#000000;">MODE_BACKTEST</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">token</span><span style="color:#666600;">=</span><span style="color:#008800;">'token_id'</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">backtest_start_time</span><span style="color:#666600;">=</span><span style="color:#008800;">'2017-09-01 08:00:00'</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">backtest_end_time</span><span style="color:#666600;">=</span><span style="color:#008800;">'2017-10-01 16:00:00'</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">backtest_adjust</span><span style="color:#666600;">=</span><span style="color:#000000;">ADJUST_PREV</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">backtest_initial_cash</span><span style="color:#666600;">=</span><span style="color:#006666;">2000000</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">backtest_commission_ratio</span><span style="color:#666600;">=</span><span style="color:#006666;">0.0001</span><span style="color:#666600;">,</span></code></li> 
   <li><code><span style="color:#000000;">backtest_slippage_ratio</span><span style="color:#666600;">=</span><span style="color:#006666;">0.0001</span><span style="color:#666600;">)</span></code></li> 
  </ol>
  <p>文章来源：<a href="http://www.myquant.cn" rel="nofollow">掘金量化交易平台</a>&nbsp;,转载请注册出处！</p> 
  <p>&nbsp;</p> 
  <p>----------------------------------------------------------------------------------------------------------------------------------------------------------</p> 
  <p><strong>更多经典股票/期货量化策略源码查看：</strong></p> 
  <table cellspacing="0">
   <tbody>
    <tr>
     <td>1</td> 
     <td>双均线策略(期货)&nbsp; 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/153" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/153</a></u></td> 
    </tr>
    <tr>
     <td>2</td> 
     <td>alpha对冲(股票+期货)&nbsp; 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/101" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/101</a></u></td> 
    </tr>
    <tr>
     <td>3</td> 
     <td>集合竞价选股(股票) 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/102" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/102</a></u></td> 
    </tr>
    <tr>
     <td>4</td> 
     <td>多因子选股(股票)&nbsp; 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/103" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/103</a></u></td> 
    </tr>
    <tr>
     <td>5</td> 
     <td>网格交易(期货)&nbsp; 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/104" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/104</a></u></td> 
    </tr>
    <tr>
     <td>6</td> 
     <td>指数增强(股票)&nbsp; 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/105" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/105</a></u></td> 
    </tr>
    <tr>
     <td>7</td> 
     <td>跨品种套利(期货)量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/106" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/106</a></u></td> 
    </tr>
    <tr>
     <td>8</td> 
     <td>跨期套利(期货) 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/107" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/107</a></u></td> 
    </tr>
    <tr>
     <td>9</td> 
     <td>日内回转交易(股票)量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/108" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/108</a></u></td> 
    </tr>
    <tr>
     <td>10</td> 
     <td>做市商交易(期货) 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/109" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/109</a></u></td> 
    </tr>
    <tr>
     <td>11</td> 
     <td>海龟交易法(期货) 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/110" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/110</a></u></td> 
    </tr>
    <tr>
     <td>12</td> 
     <td>行业轮动(股票) 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/111" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/111</a></u></td> 
    </tr>
    <tr>
     <td>13</td> 
     <td>机器学习(股票) 量化策略源码</td> 
     <td><u><a href="https://www.myquant.cn/docs/python_strategyies/112" rel="nofollow">https://www.myquant.cn/docs/python_strategyies/112</a></u></td> 
    </tr>
   </tbody>
  </table> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/myquant/article/details/80608425,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/myquant/article/details/80608425,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

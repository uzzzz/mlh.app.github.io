<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>ripple钱包接入基础教程-u011374344的专栏(人生就是游戏，拼搏才能升级！) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="ripple钱包接入基础教程-u011374344的专栏(人生就是游戏，拼搏才能升级！)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="先前准备： 1 下载一个瑞波币钱包，并完成相关注册。（瑞波币注册需要20个xrp且一旦转入就不可以再转出了，好像防止恶意注册） &nbsp; &nbsp; 参考地址：点击打开链接 2 在开始前最好熟读下官网文档。点击打开链接 3 目前只基于账户间转账，以及账户监听。所以以下是相关文档的摘要翻译，可以有个大体的了解。 &nbsp; &nbsp;交易流程： &nbsp; &nbsp;通过API执行交易必须经过以下4个流程 通过preparePayMent创建一个未签名的交易。 通过sign签名之前的交易并且保存交易ID 通过submit提交交易。 最后必须通过getTransaction查询交易，否则即使之前提交了也可能会是不成功的。 &nbsp; &nbsp;订阅交易： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 当钱包有余额变动等事件时，通过订阅方式立马就可以获取到你连接的服务器推送到客户端的消息。但 &nbsp; &nbsp;订阅功能只支持websocket API。 &nbsp; &nbsp;id:用于回调时区分第成功订阅通知和正常账户变化通知 accounts：自己希望监听的账户 { &quot;id&quot;: &quot;Example watch Bitstamp&#39;s hot wallet&quot;, &quot;command&quot;: &quot;subscribe&quot;, &quot;accounts&quot;: [&quot;xxxxxxxxxxxxx&quot;] } 上代码：（没亲自测试和不上代码的博客都时耍流氓） rippleWallet.js const RippleAPI = require(&#39;ripple-lib&#39;).RippleAPI; const WebSocket = require(&#39;ws&#39;); const ipaddress = &quot;wss://s2.ripple.com:443&quot;;//&quot;wss://s-west.ripple.com&quot;; //服务器是瑞波官方搭建的，如果连接后面的是获取不到历史数据的 const instructions = {maxLedgerVersionOffset:5}; const INTERVAL = 1000; const api = new RippleAPI({server:ipaddress}); const ratio = 0.000001; const subTag = &quot;Example watch Bitstamp&#39;s hot wallet/&quot;; api.on(&#39;error&#39;, (errorCode, errorMessage) =&gt; { console.log(errorCode + &#39;: &#39; + errorMessage); }); api.on(&#39;connected&#39;, () =&gt; { console.log(&#39;api connected&#39;); }); api.on(&#39;disconnected&#39;, () =&gt; { console.log(&#39;disconnected&#39;); }); var apiPromise = api.connect().then(() =&gt; { console.log(&quot;api connect begin!&quot;); }); const ws = new WebSocket(ipaddress); var notifyMap = new Map(); function parsePushData(data,listenAccount) { var xrpPushInfo = {&#39;dirct&#39;:3};//3忽略 if(data.hasOwnProperty(&#39;transaction&#39;)) { var transaction = data.transaction; if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &quot;transaction&quot; &amp;&amp; transaction.TransactionType == &quot;Payment&quot;) { if (listenAccount != transaction.Destination &amp;&amp; listenAccount == transaction.Account){ //xrpPushInfo[&#39;dirct&#39;] = 0; //出账通知，如果放开这句，在注释下面一句就也能监听出帐消息了 return xrpPushInfo; } else if(listenAccount == transaction.Destination){ xrpPushInfo[&#39;dirct&#39;] = 1;//进账通知 }else{ return xrpPushInfo; } var bsuccess = false; if(data.validated &amp;&amp; data.meta.TransactionResult == &#39;tesSUCCESS&#39;){ bsuccess = true; } xrpPushInfo[&#39;account&#39;]=transaction.Account; xrpPushInfo[&#39;amount&#39;]=String(transaction.Amount*ratio); xrpPushInfo[&#39;destination&#39;]=transaction.Destination; xrpPushInfo[&#39;destinationTag&#39;]=transaction.DestinationTag; xrpPushInfo[&#39;fee&#39;]= String(transaction.Fee*ratio); xrpPushInfo[&#39;hash&#39;]=transaction.hash; xrpPushInfo[&#39;date&#39;]=transaction.date; xrpPushInfo[&#39;code&#39;]=data.meta.TransactionResult; xrpPushInfo[&#39;validated&#39;]=data.validated; xrpPushInfo[&#39;success&#39;]=bsuccess; } } return xrpPushInfo; } function parserPayMent(data) { var xrpResult = {&#39;success&#39;:false}; if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &#39;payment&#39; &amp;&amp; data.hasOwnProperty(&#39;specification&#39;) &amp;&amp; data.hasOwnProperty(&#39;outcome&#39;) &amp;&amp; data.outcome.result == &#39;tesSUCCESS&#39;){ xrpResult[&#39;hash&#39;]=data.id; xrpResult[&#39;src_address&#39;]=data.specification.source.address; xrpResult[&#39;src_tag&#39;] = data.specification.source.tag; xrpResult[&#39;des_address&#39;]=data.specification.destination.address; xrpResult[&#39;des_tag&#39;] = data.specification.destination.tag; xrpResult[&#39;times&#39;] = data.outcome.timestamp; xrpResult[&#39;fee&#39;] = data.outcome.fee; xrpResult[&#39;account&#39;] = data.outcome.deliveredAmount.value; xrpResult[&#39;currency&#39;] = data.outcome.deliveredAmount.currency; xrpResult[&#39;success&#39;]=true; } return xrpResult; } function xrpVerifyTransaction(hash, options,bRecursionFind) { console.log(&#39;Verifing Transaction&#39;); return api.getTransaction(hash, options).then(data =&gt; { //return data.outcome.result === &#39;tesSUCCESS&#39;; return parserPayMent(data); }).catch(error =&gt; { if (error instanceof api.errors.PendingLedgerVersionError) { return new Promise((resolve, reject) =&gt; { setTimeout(() =&gt; xrpVerifyTransaction(hash, options) .then(resolve, reject), INTERVAL); }); } return error; }); } ws.onmessage = function(evt) { console.log(&#39;recv a msg from ripple server!&#39;); if(evt.data.hasOwnProperty(&#39;id&#39;) &amp;&amp; evt.data.id == subTag) return; var data = JSON.parse(evt.data); for(var key in notifyMap) { console.log(key); var result = parsePushData(data,key) console.log(result); if(result[&#39;dirct&#39;] != 3) { notifyMap[key](result); break; } } }; ws.onclose = function(evt) { console.log(&quot;Ws Connection closed.&quot;); }; /** * @brife 封装瑞波币钱包功能 支持订阅钱包转账推送。支持XRP转账 * @param address 钱包地址 * @param secret 钱包密钥 * @param tagnum 钱包转账时设置得TAG * @param accountObserver 用于监听钱包事件得回调 **/ var xrpWallet = function(address,secret,tagnum,accountObserver){ srcAddress_ = address; secret_ = secret; userTag_ = tagnum; accountObserver_= accountObserver; this.xrpInit = function () { var json = { &quot;id&quot;: subTag, &quot;command&quot;: &quot;subscribe&quot;, &quot;accounts&quot;: [srcAddress_] } ws.onopen = function(evt) { console.log(&quot;ws Connection open ...&quot;); var string = JSON.stringify(json) notifyMap[srcAddress_] = accountObserver_; ws.send(string); }; } /** * @brife 钱包转账历史账单 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 * @param options 可选参数 可参考“https://ripple.com/build/rippleapi/” */ this.xrpGetTransactions = function(successCall,failedCall,options){ apiPromise.then(()=&gt;{ return api.getLedger().then(version =&gt;{ //var options ={ // &#39;maxLedgerVersion&#39;:version.ledgerVersion, // &#39;counterparty&#39;:srcAddress_, // &#39;limit&#39;:50, // //&#39;start&#39;:&#39;415F9F4E665E6F83857AF7502DC051078737F634CCB86F3FD26CD8BE6B4217DB&#39;, // &#39;excludeFailures&#39;:true, // &#39;earliestFirst&#39;:false, // &#39;types&#39;:[&#39;payment&#39;] //}; options.maxLedgerVersion=version.ledgerVersion; return api.getTransactions(srcAddress_,options).then(transaction =&gt; { successCall(transaction); }).catch(err=&gt;{failedCall(err);}); }); }); } /** * @brife 钱包余额查询 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 */ this.xrpGetBalances = function(successCall,failedCall){ apiPromise.then(() =&gt; { return api.getBalances(srcAddress_).then(balances =&gt;{ successCall(balances);}); }).catch(err=&gt;{failedCall(err);}); } /** * @brife xrp转账 * @param destAddress 接收方地址 * @param value 转账金额 * @param bSrcFee true表示手续费由当前钱包付出，false表示手续费由收款方付出 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 **/ this.xrpPayment = function(destAddress,value,bSrcFee,successCall,failedCall){ apiPromise.then(() =&gt; { return api.getFee().then(fee =&gt;{ var val = String(value-fee); if(bSrcFee === true) val = String(value); var pay={ source:{ address:srcAddress_, tag:userTag_, maxAmount:{ value:val, currency:&quot;XRP&quot; } }, destination:{ address:destAddress, tag:userTag_, amount:{ value:val, currency:&quot;XRP&quot; } } }; return api.preparePayment(srcAddress_, pay, instructions).then(prepared =&gt;{ return api.getLedger().then(ledger =&gt;{ var ret = api.sign(prepared.txJSON,secret_); return api.submit(ret.signedTransaction).then(result =&gt;{ const options={ minLedgerVersion: ledger.ledgerVersion, maxLedgerVersion: prepared.instructions.maxLedgerVersion }; return new Promise((resolve, reject) =&gt;{ setTimeout(() =&gt; xrpVerifyTransaction(ret.id, options).then(resolve, reject), INTERVAL);}); }); }); }); }); }).then(result=&gt;{successCall(result);}).catch(err=&gt;{failedCall(err)}); } }; module.exports = xrpWallet; 测试代码： test.js var XrpWallet = require(&#39;./rippleWallet&#39;); const srcAddres=&#39;xxxxxxxxxxx&#39;; //你自己的钱包地址 也是被监听的账户 const secret = &quot;xxxxxxxx&quot;; //钱包密钥 const desAddres = &#39;ra7wByNiMdgj2NSU5zPrBcSWYRNxpYJmPg&#39;; //即将转账的地址 这里是我的地址哈，如果愿意赞助我也是不建议的哈。 var options={}; pXrp = new XrpWallet(srcAddres,secret,401143,listenWllet); pXrp.xrpInit(); //初始化，并开启监听 //pXrp.xrpGetTransactions(function(result){console.log(result)},function (err) {console.log(err)},options); //测试获取历史记录 pXrp.xrpGetBalances(function(result){console.log(result)},function (err) {console.log(err)}); //查询账户余额 pXrp.xrpPayment(desAddres,2,false,function(result){console.log(result)},function (err){console.log(&quot;call payment error: &quot; + err)}) //测试转账 阅读更多" />
<meta property="og:description" content="先前准备： 1 下载一个瑞波币钱包，并完成相关注册。（瑞波币注册需要20个xrp且一旦转入就不可以再转出了，好像防止恶意注册） &nbsp; &nbsp; 参考地址：点击打开链接 2 在开始前最好熟读下官网文档。点击打开链接 3 目前只基于账户间转账，以及账户监听。所以以下是相关文档的摘要翻译，可以有个大体的了解。 &nbsp; &nbsp;交易流程： &nbsp; &nbsp;通过API执行交易必须经过以下4个流程 通过preparePayMent创建一个未签名的交易。 通过sign签名之前的交易并且保存交易ID 通过submit提交交易。 最后必须通过getTransaction查询交易，否则即使之前提交了也可能会是不成功的。 &nbsp; &nbsp;订阅交易： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 当钱包有余额变动等事件时，通过订阅方式立马就可以获取到你连接的服务器推送到客户端的消息。但 &nbsp; &nbsp;订阅功能只支持websocket API。 &nbsp; &nbsp;id:用于回调时区分第成功订阅通知和正常账户变化通知 accounts：自己希望监听的账户 { &quot;id&quot;: &quot;Example watch Bitstamp&#39;s hot wallet&quot;, &quot;command&quot;: &quot;subscribe&quot;, &quot;accounts&quot;: [&quot;xxxxxxxxxxxxx&quot;] } 上代码：（没亲自测试和不上代码的博客都时耍流氓） rippleWallet.js const RippleAPI = require(&#39;ripple-lib&#39;).RippleAPI; const WebSocket = require(&#39;ws&#39;); const ipaddress = &quot;wss://s2.ripple.com:443&quot;;//&quot;wss://s-west.ripple.com&quot;; //服务器是瑞波官方搭建的，如果连接后面的是获取不到历史数据的 const instructions = {maxLedgerVersionOffset:5}; const INTERVAL = 1000; const api = new RippleAPI({server:ipaddress}); const ratio = 0.000001; const subTag = &quot;Example watch Bitstamp&#39;s hot wallet/&quot;; api.on(&#39;error&#39;, (errorCode, errorMessage) =&gt; { console.log(errorCode + &#39;: &#39; + errorMessage); }); api.on(&#39;connected&#39;, () =&gt; { console.log(&#39;api connected&#39;); }); api.on(&#39;disconnected&#39;, () =&gt; { console.log(&#39;disconnected&#39;); }); var apiPromise = api.connect().then(() =&gt; { console.log(&quot;api connect begin!&quot;); }); const ws = new WebSocket(ipaddress); var notifyMap = new Map(); function parsePushData(data,listenAccount) { var xrpPushInfo = {&#39;dirct&#39;:3};//3忽略 if(data.hasOwnProperty(&#39;transaction&#39;)) { var transaction = data.transaction; if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &quot;transaction&quot; &amp;&amp; transaction.TransactionType == &quot;Payment&quot;) { if (listenAccount != transaction.Destination &amp;&amp; listenAccount == transaction.Account){ //xrpPushInfo[&#39;dirct&#39;] = 0; //出账通知，如果放开这句，在注释下面一句就也能监听出帐消息了 return xrpPushInfo; } else if(listenAccount == transaction.Destination){ xrpPushInfo[&#39;dirct&#39;] = 1;//进账通知 }else{ return xrpPushInfo; } var bsuccess = false; if(data.validated &amp;&amp; data.meta.TransactionResult == &#39;tesSUCCESS&#39;){ bsuccess = true; } xrpPushInfo[&#39;account&#39;]=transaction.Account; xrpPushInfo[&#39;amount&#39;]=String(transaction.Amount*ratio); xrpPushInfo[&#39;destination&#39;]=transaction.Destination; xrpPushInfo[&#39;destinationTag&#39;]=transaction.DestinationTag; xrpPushInfo[&#39;fee&#39;]= String(transaction.Fee*ratio); xrpPushInfo[&#39;hash&#39;]=transaction.hash; xrpPushInfo[&#39;date&#39;]=transaction.date; xrpPushInfo[&#39;code&#39;]=data.meta.TransactionResult; xrpPushInfo[&#39;validated&#39;]=data.validated; xrpPushInfo[&#39;success&#39;]=bsuccess; } } return xrpPushInfo; } function parserPayMent(data) { var xrpResult = {&#39;success&#39;:false}; if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &#39;payment&#39; &amp;&amp; data.hasOwnProperty(&#39;specification&#39;) &amp;&amp; data.hasOwnProperty(&#39;outcome&#39;) &amp;&amp; data.outcome.result == &#39;tesSUCCESS&#39;){ xrpResult[&#39;hash&#39;]=data.id; xrpResult[&#39;src_address&#39;]=data.specification.source.address; xrpResult[&#39;src_tag&#39;] = data.specification.source.tag; xrpResult[&#39;des_address&#39;]=data.specification.destination.address; xrpResult[&#39;des_tag&#39;] = data.specification.destination.tag; xrpResult[&#39;times&#39;] = data.outcome.timestamp; xrpResult[&#39;fee&#39;] = data.outcome.fee; xrpResult[&#39;account&#39;] = data.outcome.deliveredAmount.value; xrpResult[&#39;currency&#39;] = data.outcome.deliveredAmount.currency; xrpResult[&#39;success&#39;]=true; } return xrpResult; } function xrpVerifyTransaction(hash, options,bRecursionFind) { console.log(&#39;Verifing Transaction&#39;); return api.getTransaction(hash, options).then(data =&gt; { //return data.outcome.result === &#39;tesSUCCESS&#39;; return parserPayMent(data); }).catch(error =&gt; { if (error instanceof api.errors.PendingLedgerVersionError) { return new Promise((resolve, reject) =&gt; { setTimeout(() =&gt; xrpVerifyTransaction(hash, options) .then(resolve, reject), INTERVAL); }); } return error; }); } ws.onmessage = function(evt) { console.log(&#39;recv a msg from ripple server!&#39;); if(evt.data.hasOwnProperty(&#39;id&#39;) &amp;&amp; evt.data.id == subTag) return; var data = JSON.parse(evt.data); for(var key in notifyMap) { console.log(key); var result = parsePushData(data,key) console.log(result); if(result[&#39;dirct&#39;] != 3) { notifyMap[key](result); break; } } }; ws.onclose = function(evt) { console.log(&quot;Ws Connection closed.&quot;); }; /** * @brife 封装瑞波币钱包功能 支持订阅钱包转账推送。支持XRP转账 * @param address 钱包地址 * @param secret 钱包密钥 * @param tagnum 钱包转账时设置得TAG * @param accountObserver 用于监听钱包事件得回调 **/ var xrpWallet = function(address,secret,tagnum,accountObserver){ srcAddress_ = address; secret_ = secret; userTag_ = tagnum; accountObserver_= accountObserver; this.xrpInit = function () { var json = { &quot;id&quot;: subTag, &quot;command&quot;: &quot;subscribe&quot;, &quot;accounts&quot;: [srcAddress_] } ws.onopen = function(evt) { console.log(&quot;ws Connection open ...&quot;); var string = JSON.stringify(json) notifyMap[srcAddress_] = accountObserver_; ws.send(string); }; } /** * @brife 钱包转账历史账单 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 * @param options 可选参数 可参考“https://ripple.com/build/rippleapi/” */ this.xrpGetTransactions = function(successCall,failedCall,options){ apiPromise.then(()=&gt;{ return api.getLedger().then(version =&gt;{ //var options ={ // &#39;maxLedgerVersion&#39;:version.ledgerVersion, // &#39;counterparty&#39;:srcAddress_, // &#39;limit&#39;:50, // //&#39;start&#39;:&#39;415F9F4E665E6F83857AF7502DC051078737F634CCB86F3FD26CD8BE6B4217DB&#39;, // &#39;excludeFailures&#39;:true, // &#39;earliestFirst&#39;:false, // &#39;types&#39;:[&#39;payment&#39;] //}; options.maxLedgerVersion=version.ledgerVersion; return api.getTransactions(srcAddress_,options).then(transaction =&gt; { successCall(transaction); }).catch(err=&gt;{failedCall(err);}); }); }); } /** * @brife 钱包余额查询 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 */ this.xrpGetBalances = function(successCall,failedCall){ apiPromise.then(() =&gt; { return api.getBalances(srcAddress_).then(balances =&gt;{ successCall(balances);}); }).catch(err=&gt;{failedCall(err);}); } /** * @brife xrp转账 * @param destAddress 接收方地址 * @param value 转账金额 * @param bSrcFee true表示手续费由当前钱包付出，false表示手续费由收款方付出 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 **/ this.xrpPayment = function(destAddress,value,bSrcFee,successCall,failedCall){ apiPromise.then(() =&gt; { return api.getFee().then(fee =&gt;{ var val = String(value-fee); if(bSrcFee === true) val = String(value); var pay={ source:{ address:srcAddress_, tag:userTag_, maxAmount:{ value:val, currency:&quot;XRP&quot; } }, destination:{ address:destAddress, tag:userTag_, amount:{ value:val, currency:&quot;XRP&quot; } } }; return api.preparePayment(srcAddress_, pay, instructions).then(prepared =&gt;{ return api.getLedger().then(ledger =&gt;{ var ret = api.sign(prepared.txJSON,secret_); return api.submit(ret.signedTransaction).then(result =&gt;{ const options={ minLedgerVersion: ledger.ledgerVersion, maxLedgerVersion: prepared.instructions.maxLedgerVersion }; return new Promise((resolve, reject) =&gt;{ setTimeout(() =&gt; xrpVerifyTransaction(ret.id, options).then(resolve, reject), INTERVAL);}); }); }); }); }); }).then(result=&gt;{successCall(result);}).catch(err=&gt;{failedCall(err)}); } }; module.exports = xrpWallet; 测试代码： test.js var XrpWallet = require(&#39;./rippleWallet&#39;); const srcAddres=&#39;xxxxxxxxxxx&#39;; //你自己的钱包地址 也是被监听的账户 const secret = &quot;xxxxxxxx&quot;; //钱包密钥 const desAddres = &#39;ra7wByNiMdgj2NSU5zPrBcSWYRNxpYJmPg&#39;; //即将转账的地址 这里是我的地址哈，如果愿意赞助我也是不建议的哈。 var options={}; pXrp = new XrpWallet(srcAddres,secret,401143,listenWllet); pXrp.xrpInit(); //初始化，并开启监听 //pXrp.xrpGetTransactions(function(result){console.log(result)},function (err) {console.log(err)},options); //测试获取历史记录 pXrp.xrpGetBalances(function(result){console.log(result)},function (err) {console.log(err)}); //查询账户余额 pXrp.xrpPayment(desAddres,2,false,function(result){console.log(result)},function (err){console.log(&quot;call payment error: &quot; + err)}) //测试转账 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-12T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"先前准备： 1 下载一个瑞波币钱包，并完成相关注册。（瑞波币注册需要20个xrp且一旦转入就不可以再转出了，好像防止恶意注册） &nbsp; &nbsp; 参考地址：点击打开链接 2 在开始前最好熟读下官网文档。点击打开链接 3 目前只基于账户间转账，以及账户监听。所以以下是相关文档的摘要翻译，可以有个大体的了解。 &nbsp; &nbsp;交易流程： &nbsp; &nbsp;通过API执行交易必须经过以下4个流程 通过preparePayMent创建一个未签名的交易。 通过sign签名之前的交易并且保存交易ID 通过submit提交交易。 最后必须通过getTransaction查询交易，否则即使之前提交了也可能会是不成功的。 &nbsp; &nbsp;订阅交易： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 当钱包有余额变动等事件时，通过订阅方式立马就可以获取到你连接的服务器推送到客户端的消息。但 &nbsp; &nbsp;订阅功能只支持websocket API。 &nbsp; &nbsp;id:用于回调时区分第成功订阅通知和正常账户变化通知 accounts：自己希望监听的账户 { &quot;id&quot;: &quot;Example watch Bitstamp&#39;s hot wallet&quot;, &quot;command&quot;: &quot;subscribe&quot;, &quot;accounts&quot;: [&quot;xxxxxxxxxxxxx&quot;] } 上代码：（没亲自测试和不上代码的博客都时耍流氓） rippleWallet.js const RippleAPI = require(&#39;ripple-lib&#39;).RippleAPI; const WebSocket = require(&#39;ws&#39;); const ipaddress = &quot;wss://s2.ripple.com:443&quot;;//&quot;wss://s-west.ripple.com&quot;; //服务器是瑞波官方搭建的，如果连接后面的是获取不到历史数据的 const instructions = {maxLedgerVersionOffset:5}; const INTERVAL = 1000; const api = new RippleAPI({server:ipaddress}); const ratio = 0.000001; const subTag = &quot;Example watch Bitstamp&#39;s hot wallet/&quot;; api.on(&#39;error&#39;, (errorCode, errorMessage) =&gt; { console.log(errorCode + &#39;: &#39; + errorMessage); }); api.on(&#39;connected&#39;, () =&gt; { console.log(&#39;api connected&#39;); }); api.on(&#39;disconnected&#39;, () =&gt; { console.log(&#39;disconnected&#39;); }); var apiPromise = api.connect().then(() =&gt; { console.log(&quot;api connect begin!&quot;); }); const ws = new WebSocket(ipaddress); var notifyMap = new Map(); function parsePushData(data,listenAccount) { var xrpPushInfo = {&#39;dirct&#39;:3};//3忽略 if(data.hasOwnProperty(&#39;transaction&#39;)) { var transaction = data.transaction; if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &quot;transaction&quot; &amp;&amp; transaction.TransactionType == &quot;Payment&quot;) { if (listenAccount != transaction.Destination &amp;&amp; listenAccount == transaction.Account){ //xrpPushInfo[&#39;dirct&#39;] = 0; //出账通知，如果放开这句，在注释下面一句就也能监听出帐消息了 return xrpPushInfo; } else if(listenAccount == transaction.Destination){ xrpPushInfo[&#39;dirct&#39;] = 1;//进账通知 }else{ return xrpPushInfo; } var bsuccess = false; if(data.validated &amp;&amp; data.meta.TransactionResult == &#39;tesSUCCESS&#39;){ bsuccess = true; } xrpPushInfo[&#39;account&#39;]=transaction.Account; xrpPushInfo[&#39;amount&#39;]=String(transaction.Amount*ratio); xrpPushInfo[&#39;destination&#39;]=transaction.Destination; xrpPushInfo[&#39;destinationTag&#39;]=transaction.DestinationTag; xrpPushInfo[&#39;fee&#39;]= String(transaction.Fee*ratio); xrpPushInfo[&#39;hash&#39;]=transaction.hash; xrpPushInfo[&#39;date&#39;]=transaction.date; xrpPushInfo[&#39;code&#39;]=data.meta.TransactionResult; xrpPushInfo[&#39;validated&#39;]=data.validated; xrpPushInfo[&#39;success&#39;]=bsuccess; } } return xrpPushInfo; } function parserPayMent(data) { var xrpResult = {&#39;success&#39;:false}; if(data.hasOwnProperty(&#39;type&#39;) &amp;&amp; data.type == &#39;payment&#39; &amp;&amp; data.hasOwnProperty(&#39;specification&#39;) &amp;&amp; data.hasOwnProperty(&#39;outcome&#39;) &amp;&amp; data.outcome.result == &#39;tesSUCCESS&#39;){ xrpResult[&#39;hash&#39;]=data.id; xrpResult[&#39;src_address&#39;]=data.specification.source.address; xrpResult[&#39;src_tag&#39;] = data.specification.source.tag; xrpResult[&#39;des_address&#39;]=data.specification.destination.address; xrpResult[&#39;des_tag&#39;] = data.specification.destination.tag; xrpResult[&#39;times&#39;] = data.outcome.timestamp; xrpResult[&#39;fee&#39;] = data.outcome.fee; xrpResult[&#39;account&#39;] = data.outcome.deliveredAmount.value; xrpResult[&#39;currency&#39;] = data.outcome.deliveredAmount.currency; xrpResult[&#39;success&#39;]=true; } return xrpResult; } function xrpVerifyTransaction(hash, options,bRecursionFind) { console.log(&#39;Verifing Transaction&#39;); return api.getTransaction(hash, options).then(data =&gt; { //return data.outcome.result === &#39;tesSUCCESS&#39;; return parserPayMent(data); }).catch(error =&gt; { if (error instanceof api.errors.PendingLedgerVersionError) { return new Promise((resolve, reject) =&gt; { setTimeout(() =&gt; xrpVerifyTransaction(hash, options) .then(resolve, reject), INTERVAL); }); } return error; }); } ws.onmessage = function(evt) { console.log(&#39;recv a msg from ripple server!&#39;); if(evt.data.hasOwnProperty(&#39;id&#39;) &amp;&amp; evt.data.id == subTag) return; var data = JSON.parse(evt.data); for(var key in notifyMap) { console.log(key); var result = parsePushData(data,key) console.log(result); if(result[&#39;dirct&#39;] != 3) { notifyMap[key](result); break; } } }; ws.onclose = function(evt) { console.log(&quot;Ws Connection closed.&quot;); }; /** * @brife 封装瑞波币钱包功能 支持订阅钱包转账推送。支持XRP转账 * @param address 钱包地址 * @param secret 钱包密钥 * @param tagnum 钱包转账时设置得TAG * @param accountObserver 用于监听钱包事件得回调 **/ var xrpWallet = function(address,secret,tagnum,accountObserver){ srcAddress_ = address; secret_ = secret; userTag_ = tagnum; accountObserver_= accountObserver; this.xrpInit = function () { var json = { &quot;id&quot;: subTag, &quot;command&quot;: &quot;subscribe&quot;, &quot;accounts&quot;: [srcAddress_] } ws.onopen = function(evt) { console.log(&quot;ws Connection open ...&quot;); var string = JSON.stringify(json) notifyMap[srcAddress_] = accountObserver_; ws.send(string); }; } /** * @brife 钱包转账历史账单 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 * @param options 可选参数 可参考“https://ripple.com/build/rippleapi/” */ this.xrpGetTransactions = function(successCall,failedCall,options){ apiPromise.then(()=&gt;{ return api.getLedger().then(version =&gt;{ //var options ={ // &#39;maxLedgerVersion&#39;:version.ledgerVersion, // &#39;counterparty&#39;:srcAddress_, // &#39;limit&#39;:50, // //&#39;start&#39;:&#39;415F9F4E665E6F83857AF7502DC051078737F634CCB86F3FD26CD8BE6B4217DB&#39;, // &#39;excludeFailures&#39;:true, // &#39;earliestFirst&#39;:false, // &#39;types&#39;:[&#39;payment&#39;] //}; options.maxLedgerVersion=version.ledgerVersion; return api.getTransactions(srcAddress_,options).then(transaction =&gt; { successCall(transaction); }).catch(err=&gt;{failedCall(err);}); }); }); } /** * @brife 钱包余额查询 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 */ this.xrpGetBalances = function(successCall,failedCall){ apiPromise.then(() =&gt; { return api.getBalances(srcAddress_).then(balances =&gt;{ successCall(balances);}); }).catch(err=&gt;{failedCall(err);}); } /** * @brife xrp转账 * @param destAddress 接收方地址 * @param value 转账金额 * @param bSrcFee true表示手续费由当前钱包付出，false表示手续费由收款方付出 * @param successCall 查询成功回调 * @param failedCall 查询失败回调 **/ this.xrpPayment = function(destAddress,value,bSrcFee,successCall,failedCall){ apiPromise.then(() =&gt; { return api.getFee().then(fee =&gt;{ var val = String(value-fee); if(bSrcFee === true) val = String(value); var pay={ source:{ address:srcAddress_, tag:userTag_, maxAmount:{ value:val, currency:&quot;XRP&quot; } }, destination:{ address:destAddress, tag:userTag_, amount:{ value:val, currency:&quot;XRP&quot; } } }; return api.preparePayment(srcAddress_, pay, instructions).then(prepared =&gt;{ return api.getLedger().then(ledger =&gt;{ var ret = api.sign(prepared.txJSON,secret_); return api.submit(ret.signedTransaction).then(result =&gt;{ const options={ minLedgerVersion: ledger.ledgerVersion, maxLedgerVersion: prepared.instructions.maxLedgerVersion }; return new Promise((resolve, reject) =&gt;{ setTimeout(() =&gt; xrpVerifyTransaction(ret.id, options).then(resolve, reject), INTERVAL);}); }); }); }); }); }).then(result=&gt;{successCall(result);}).catch(err=&gt;{failedCall(err)}); } }; module.exports = xrpWallet; 测试代码： test.js var XrpWallet = require(&#39;./rippleWallet&#39;); const srcAddres=&#39;xxxxxxxxxxx&#39;; //你自己的钱包地址 也是被监听的账户 const secret = &quot;xxxxxxxx&quot;; //钱包密钥 const desAddres = &#39;ra7wByNiMdgj2NSU5zPrBcSWYRNxpYJmPg&#39;; //即将转账的地址 这里是我的地址哈，如果愿意赞助我也是不建议的哈。 var options={}; pXrp = new XrpWallet(srcAddres,secret,401143,listenWllet); pXrp.xrpInit(); //初始化，并开启监听 //pXrp.xrpGetTransactions(function(result){console.log(result)},function (err) {console.log(err)},options); //测试获取历史记录 pXrp.xrpGetBalances(function(result){console.log(result)},function (err) {console.log(err)}); //查询账户余额 pXrp.xrpPayment(desAddres,2,false,function(result){console.log(result)},function (err){console.log(&quot;call payment error: &quot; + err)}) //测试转账 阅读更多","@type":"BlogPosting","url":"/2018/02/12/38f54b642efd7b7dc59ade1409362878.html","headline":"ripple钱包接入基础教程-u011374344的专栏(人生就是游戏，拼搏才能升级！)","dateModified":"2018-02-12T00:00:00+08:00","datePublished":"2018-02-12T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/02/12/38f54b642efd7b7dc59ade1409362878.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>ripple钱包接入基础教程-u011374344的专栏(人生就是游戏，拼搏才能升级！)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-7f5a1a725b.css"> 
 <div class="htmledit_views"> 
  <p>先前准备：</p>
  <p>1 下载一个瑞波币钱包，并完成相关注册。（瑞波币注册需要20个xrp且一旦转入就不可以再转出了，好像防止恶意注册）</p>
  <p>&nbsp; &nbsp; 参考地址：<a href="http://jc.ripplefox.com/#/create" rel="nofollow">点击打开链接</a></p>
  <p>2 在开始前最好熟读下官网文档。<a href="https://ripple.com/build/rippleapi/" rel="nofollow">点击打开链接</a></p>
  <p>3 目前只基于账户间转账，以及账户监听。所以以下是相关文档的摘要翻译，可以有个大体的了解。</p>
  <p>&nbsp; &nbsp;<strong>交易流程：</strong></p>
  <p><strong>&nbsp; &nbsp;通过API执行交易必须经过以下4个流程</strong></p>
  <p></p>
  <ul>
   <li>通过preparePayMent创建一个未签名的交易<strong>。</strong></li>
   <li>通过sign签名之前的交易并且保存交易ID</li>
   <li>通过submit提交交易。</li>
   <li>最后必须通过getTransaction查询交易，否则即使之前提交了也可能会是不成功的。</li>
  </ul>
  <p>&nbsp; &nbsp;订阅交易：</p>
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 当钱包有余额变动等事件时，通过订阅方式立马就可以获取到你连接的服务器推送到客户端的消息。但</p>
  <p>&nbsp; &nbsp;订阅功能只支持websocket API。</p>
  <p>&nbsp; &nbsp;<span style="color:rgb(17,17,17);font-family:Menlo, Monaco, Consolas, monospace;font-size:13px;letter-spacing:.14px;background-color:rgb(245,245,245);">id:用于回调时区分第成功订阅通知和正常账户变化通知 <span style="color:rgb(17,17,17);font-family:Menlo, Monaco, Consolas, monospace;font-size:13px;letter-spacing:.14px;background-color:rgb(245,245,245);">accounts：自己希望监听的账户</span></span></p>
  <pre style="font-family:Menlo, Monaco, Consolas, monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background:rgb(255,255,255) none;border:none;clear:both;letter-spacing:.14px;"><code style="font-family:Menlo, Monaco, Consolas, monospace;color:rgb(17,17,17);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);">{
  "id": "Example watch Bitstamp's hot wallet",
  "command": "subscribe",
  "accounts": ["xxxxxxxxxxxxx"]   
}</code></pre>
  <pre><code class="language-javascript">上代码：（没亲自测试和不上代码的博客都时耍流氓）</code></pre>
  <pre><code class="language-javascript">rippleWallet.js</code></pre>
  <pre><code class="language-javascript">const RippleAPI = require('ripple-lib').RippleAPI;
const WebSocket = require('ws');
const ipaddress = "wss://s2.ripple.com:443";//"wss://s-west.ripple.com"; //服务器是瑞波官方搭建的，如果连接后面的是获取不到历史数据的
const instructions = {maxLedgerVersionOffset:5};
const INTERVAL = 1000;
const api = new RippleAPI({server:ipaddress});
const ratio = 0.000001;
const subTag = "Example watch Bitstamp's hot wallet/";


api.on('error', (errorCode, errorMessage) =&gt; {
  console.log(errorCode + ': ' + errorMessage);
});

api.on('connected', () =&gt; {
  console.log('api connected');
});

api.on('disconnected', () =&gt; {
    console.log('disconnected');
});

var apiPromise = api.connect().then(() =&gt; {
    console.log("api connect begin!");
});

const ws = new WebSocket(ipaddress);
var notifyMap = new Map();

function parsePushData(data,listenAccount)
{
    var xrpPushInfo = {'dirct':3};//3忽略
    if(data.hasOwnProperty('transaction'))
    {
        var transaction = data.transaction;
        if(data.hasOwnProperty('type') &amp;&amp; data.type == "transaction" &amp;&amp; transaction.TransactionType == "Payment")
        {
            if (listenAccount != transaction.Destination &amp;&amp; listenAccount == transaction.Account){
                //xrpPushInfo['dirct'] = 0; //出账通知，如果放开这句，在注释下面一句就也能监听出帐消息了
                return xrpPushInfo;
            }
            else if(listenAccount == transaction.Destination){
                xrpPushInfo['dirct'] = 1;//进账通知
            }else{
                return xrpPushInfo;
            }
            var bsuccess = false;
            if(data.validated &amp;&amp; data.meta.TransactionResult == 'tesSUCCESS'){
                bsuccess = true;
            }
            xrpPushInfo['account']=transaction.Account;
            xrpPushInfo['amount']=String(transaction.Amount*ratio);
            xrpPushInfo['destination']=transaction.Destination;
            xrpPushInfo['destinationTag']=transaction.DestinationTag;
            xrpPushInfo['fee']= String(transaction.Fee*ratio);
            xrpPushInfo['hash']=transaction.hash;
            xrpPushInfo['date']=transaction.date;
            xrpPushInfo['code']=data.meta.TransactionResult;
            xrpPushInfo['validated']=data.validated;
            xrpPushInfo['success']=bsuccess;
        }
    }
    return xrpPushInfo;
}


function parserPayMent(data) {
    var xrpResult = {'success':false};
    if(data.hasOwnProperty('type') &amp;&amp; data.type == 'payment' &amp;&amp;
        data.hasOwnProperty('specification') &amp;&amp; data.hasOwnProperty('outcome') &amp;&amp;
        data.outcome.result == 'tesSUCCESS'){
        xrpResult['hash']=data.id;
        xrpResult['src_address']=data.specification.source.address;
        xrpResult['src_tag'] = data.specification.source.tag;
        xrpResult['des_address']=data.specification.destination.address;
        xrpResult['des_tag'] = data.specification.destination.tag;
        xrpResult['times'] = data.outcome.timestamp;
        xrpResult['fee'] = data.outcome.fee;
        xrpResult['account'] = data.outcome.deliveredAmount.value;
        xrpResult['currency'] = data.outcome.deliveredAmount.currency;

        xrpResult['success']=true;
    }
    return xrpResult;
}

function xrpVerifyTransaction(hash, options,bRecursionFind) {
    console.log('Verifing Transaction');
    return api.getTransaction(hash, options).then(data =&gt; {
        //return data.outcome.result === 'tesSUCCESS';
        return parserPayMent(data);
    }).catch(error =&gt; {
        if (error instanceof api.errors.PendingLedgerVersionError) {
        return new Promise((resolve, reject) =&gt; {
            setTimeout(() =&gt; xrpVerifyTransaction(hash, options)
            .then(resolve, reject), INTERVAL);
        });
    }
    return error;
    });
}

ws.onmessage = function(evt) {

    console.log('recv a msg from ripple server!');
    if(evt.data.hasOwnProperty('id') &amp;&amp; evt.data.id == subTag)
        return;
    var data = JSON.parse(evt.data);
    for(var key in notifyMap)
    {
        console.log(key);
        var result = parsePushData(data,key)
        console.log(result);
        if(result['dirct'] != 3)
        {
            notifyMap[key](result);
            break;
        }

    }
};

ws.onclose = function(evt) {
    console.log("Ws Connection closed.");
};


/**
 * @brife 封装瑞波币钱包功能 支持订阅钱包转账推送。支持XRP转账
 * @param address 钱包地址
 * @param secret  钱包密钥
 * @param tagnum  钱包转账时设置得TAG
 * @param accountObserver 用于监听钱包事件得回调
 **/
var xrpWallet = function(address,secret,tagnum,accountObserver){

      srcAddress_ = address;
      secret_ = secret;
      userTag_ = tagnum;
      accountObserver_= accountObserver;
      
      this.xrpInit = function () {
          var json = {
              "id": subTag,
              "command": "subscribe",
              "accounts": [srcAddress_]
          }
          ws.onopen = function(evt) {
              console.log("ws Connection open ...");
              var string = JSON.stringify(json)
              notifyMap[srcAddress_] = accountObserver_;
              ws.send(string);
          };
      }

      /**
       * @brife 钱包转账历史账单
       * @param successCall 查询成功回调
       * @param failedCall 查询失败回调
       * @param options 可选参数 可参考“https://ripple.com/build/rippleapi/”
       */
      this.xrpGetTransactions = function(successCall,failedCall,options){
        apiPromise.then(()=&gt;{
            return  api.getLedger().then(version =&gt;{
                //var options ={
                //    'maxLedgerVersion':version.ledgerVersion,
                //    'counterparty':srcAddress_,
                //    'limit':50,
                //    //'start':'415F9F4E665E6F83857AF7502DC051078737F634CCB86F3FD26CD8BE6B4217DB',
                //    'excludeFailures':true,
                //    'earliestFirst':false,
                //    'types':['payment']
                //};
                options.maxLedgerVersion=version.ledgerVersion;
                return api.getTransactions(srcAddress_,options).then(transaction =&gt; {
                    successCall(transaction);
                }).catch(err=&gt;{failedCall(err);});
            });
        });
      }

      /**
       * @brife 钱包余额查询
       * @param successCall 查询成功回调
       * @param failedCall 查询失败回调
       */
      this.xrpGetBalances = function(successCall,failedCall){
        apiPromise.then(() =&gt; {
            return api.getBalances(srcAddress_).then(balances =&gt;{
                successCall(balances);});
        }).catch(err=&gt;{failedCall(err);});
      }

      /**
       * @brife xrp转账
       * @param destAddress 接收方地址
       * @param value 转账金额
       * @param bSrcFee true表示手续费由当前钱包付出，false表示手续费由收款方付出
       * @param successCall 查询成功回调
       * @param failedCall 查询失败回调
       **/
      this.xrpPayment = function(destAddress,value,bSrcFee,successCall,failedCall){
        apiPromise.then(() =&gt; {
            return api.getFee().then(fee =&gt;{
                var val = String(value-fee);
                if(bSrcFee === true)
                    val = String(value);
                var pay={
                    source:{
                        address:srcAddress_,
                        tag:userTag_,
                        maxAmount:{
                            value:val,
                            currency:"XRP"
                        }
                    },
                    destination:{
                        address:destAddress,
                        tag:userTag_,
                        amount:{
                            value:val,
                            currency:"XRP"
                        }
                    }
                };
                return api.preparePayment(srcAddress_, pay, instructions).then(prepared =&gt;{
                    return  api.getLedger().then(ledger =&gt;{
                        var ret = api.sign(prepared.txJSON,secret_);
                        return api.submit(ret.signedTransaction).then(result =&gt;{
                            const options={
                                minLedgerVersion: ledger.ledgerVersion,
                                maxLedgerVersion: prepared.instructions.maxLedgerVersion
                            };
                            return new Promise((resolve, reject) =&gt;{
                                setTimeout(() =&gt; xrpVerifyTransaction(ret.id, options).then(resolve, reject), INTERVAL);});
                        });
                    });
                });
            });
        }).then(result=&gt;{successCall(result);}).catch(err=&gt;{failedCall(err)});
    }
};

module.exports = xrpWallet;</code></pre>
  <p>测试代码： test.js</p>
  <pre><code class="language-javascript"></code></pre>
  <pre class="javascript"><code class="language-javascript">var XrpWallet = require('./rippleWallet');
const srcAddres='xxxxxxxxxxx'; //你自己的钱包地址 也是被监听的账户
const secret = "xxxxxxxx";  //钱包密钥

const desAddres = 'ra7wByNiMdgj2NSU5zPrBcSWYRNxpYJmPg'; //即将转账的地址 这里是我的地址哈，如果愿意赞助我也是不建议的哈。

var options={};
pXrp = new XrpWallet(srcAddres,secret,401143,listenWllet);
pXrp.xrpInit(); //初始化，并开启监听
//pXrp.xrpGetTransactions(function(result){console.log(result)},function (err) {console.log(err)},options); //测试获取历史记录
pXrp.xrpGetBalances(function(result){console.log(result)},function (err) {console.log(err)}); //查询账户余额
pXrp.xrpPayment(desAddres,2,false,function(result){console.log(result)},function (err){console.log("call payment error: " + err)}) //测试转账
</code></pre>
  <br>
  <br>
  <p></p>
  <br> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/u011374344/article/details/79314454,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/u011374344/article/details/79314454,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链（2）以太坊开发框架Truffle教程（Windows） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链（2）以太坊开发框架Truffle教程（Windows）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明： https://blog.csdn.net/ShuSheng0007/article/details/79312300 区块链（1）开发环境搭建及Hello World合约展示 区块链（2）以太坊开发框架Truffle教程（Windows） 区块链（3）:在以太坊私有链建立节点集群并发生交易 概述 环境搭建 Node 安装 Truffle 安装 Ganache CLI 安装 使用Truffle Box 创建一个Truffle 项目 编写智能合约 编译智能合约 部署智能合约 测试智能合约 创建UI界面与智能合约交互 在浏览器中使用dapp 使用dapp 概述 上一篇博客介绍了如何搭建一个私有链的以太坊开发环境，并部署一个简单“hello world”智能合约到区块链上，详情请前往区块链开发环境搭建。 本文进一步介绍区块链的一个主流开发框架Truffle 环境搭建 使用 Truffle需要三个东西，分别如下 Nodejs :是一个基于google浏览器Chrome里面的JavaScript引擎（V8）的一个平台，可以很容易的构建快速而具有扩展性的网络程序。 Truffle ：以太坊开发框架 Ganache CLI：是在本地使用内存模拟的一个以太坊环境，其基于Node.js，以前叫TestRPC在开发过程中使用。 Node 安装 前往Node.js官方网站下载相应的版本，一路next安装。安装完成后打开命令行窗口，输入node –v 来验证是否安装成功。输入npm –version 来确认node 包管理工具安装成功。npm 是node package manager的简称 Truffle 安装 Truffle使用npm来安装，如果node是使用installer安装的，系统应该已经将环境变量配置好了，所以在任何路径下都可以使用npm,如果发现不能使用则需要到相应的路径下去执行命令。 在命令行中输入npm –g install truffle 回车。 Ganache CLI 安装 Ganache CLI的安装仍然使用npm，在命令行中输入npm install -g ganache-cli 回车 完成以上三步则可以开始使用Truffle了 接下来通过官方的一个示例来展示Truffle的具体开发流程 项目背景 一所狗狗收容所想利用区块链来跟踪被收养的狗狗 使用Truffle Box 创建一个Truffle 项目 Truffle Box 可以理解为Truffle 的项目模板 使用在命令行窗口新建文件夹pet-shop-tutorial并导航至其中 mkdir pet-shop-tutorial cd pet-shop-tutorial 在命令行窗口中使用命令 truffle unbox pet-shop 来创建项目模板 pet-shop。 命令完成后就会在pet-shop-tutorial文件夹下面生成项目文件，如下图所示 contracts/:存放智能合约文件。 migrations/:存放部署智能合约相关的文件。 test/:智能合约测试文件，测试文件可以使用JavaScript或者Solidity编写。 truffle.js：Truffle的配置文件。如果你使用Windows的cmd命令行的话，需要将文件名改为truffle-config.js之类的。 编写智能合约 在 contracts/目录下新建文件Adoption.sol。 pragma solidity ^0.4.17;//告诉编译器使用大于0.4.17小于0.5版本的solidity语言 contract Adoption { address[16] public adopters; // Adopting a pet function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); adopters[petId] = msg.sender; return petId; } // Retrieving the adopters function getAdopters() public view returns (address[16]) { return adopters; } } 编译智能合约 由于名称冲突，如果你使用的是CMD命令行，则需要将根目录下的truffle.js文件重命名为truffle-config.js truffle-config.js文件的内容为 module.exports = { // See &lt;http://truffleframework.com/docs/advanced/configuration&gt; // for more about customizing your Truffle configuration! networks: { development: { host: &quot;127.0.0.1&quot;, port: 8545, network_id: &quot;*&quot; // Match any network id } } }; 在命令行中输入truffle compile 如果出现类似于下面的结果，说明编译成功了。 Compiling ./contracts/Migrations.sol... Compiling ./contracts/Adoption.sol... Writing artifacts to ./build/contracts 编译成功后，你会在项目的根目录下面发现多了一个build文件夹，里面存放的是智能合约编译后的结果。 部署智能合约 我们已经成功编译了我们的项目，现在需要将其部署到区块链中。 要将智能合约部署到区块链中去，自然需要一条区块链了。我们使用Truffle内置的Truffle Dev即可。 导航到truffle-config.js所在目录，在cmd窗口中输入truffle dev,启动一条区块链，默认会生成10个账户，每个账户里有100个以太 坊。默认监听localhost:9545 (我们也可以使用Ganache CLI。 在命令行中输入ganache-cli 启动一条区块链，默认会生成10个账户，每个账户里有100个以太坊。默认监听localhost:8545) 在/migrations目录下新建一个文件2_deploy_contracts.js var Adoption = artifacts.require(&quot;Adoption&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; 在命令行中输入truffle migrate，如果发现如下输出，则表示部署成功 Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Deploying Adoption... ... 0x43b6a6888c90c38568d4f9ea494b9e2a22f55e506a8197938fb1bb6e5eaa5d34 Adoption: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Saving successful migration to network... ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0 至此，我们已经成功将智能合约部署到了测试用的区块链中，接下来就是测试区块链的正确性，以及与其交互的工作了。 测试智能合约 待续 创建UI界面与智能合约交互 本文以web的方式与智能合约交互，就是我们要创建一个网页，用来与区块链上的智能合约交互。 web3.js 是以太坊提供的一个Javascript库，它封装了以太坊的JSON RPC API，提供了一系列与区块链交互的Javascript对象和函数，包括查看网络状态，查看本地账户、查看交易和区块、发送交易、编译/部署智能合约、调用智能合约等，其中最重要的就是与智能合约交互的API。 进入/src/js目录下，修改app.js文件如下 1.安装web3 将函数initWeb3里面的注释Replace me...替换为如下代码 ``` // Is there an injected web3 instance? if (typeof web3 !== &#39;undefined&#39;) { App.web3Provider = web3.currentProvider; } else { // If no injected web3 instance is detected, fall back to Ganache App.web3Provider = new } web3 = new Web3(App.web3Provider); ``` 2.安装合约 将函数initContract里面的注释Replace me...替换为如下代码 $.getJSON(&#39;Adoption.json&#39;, function(data) { // Get the necessary contract artifact file and instantiate it with truffle-contract var AdoptionArtifact = data; App.contracts.Adoption = TruffleContract(AdoptionArtifact); // Set the provider for our contract App.contracts.Adoption.setProvider(App.web3Provider); // Use our contract to retrieve and mark the adopted pets return App.markAdopted(); }); 3.领养宠物 将函数markAdopted里面的注释Replace me...替换为如下代码 var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; return adoptionInstance.getAdopters.call(); }).then(function(adopters) { for (i = 0; i &lt; adopters.length; i++) { if (adopters[i] !== &#39;0x0000000000000000000000000000000000000000&#39;) { $(&#39;.panel-pet&#39;).eq(i).find(&#39;button&#39;).text(&#39;Success&#39;).attr(&#39;disabled&#39;, true); } } }).catch(function(err) { console.log(err.message); }); 将函数handleAdopt里面的注释Replace me...替换为如下代码 var adoptionInstance; web3.eth.getAccounts(function(error, accounts) { if (error) { console.log(error); } var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; // Execute adopt as a transaction by sending account return adoptionInstance.adopt(petId, {from: account}); }).then(function(result) { return App.markAdopted(); }).catch(function(err) { console.log(err.message); }); }); 经过以上步骤，我们的第一个DApp就开发完成了，是时候展示一下成果了。 在浏览器中使用dapp 在浏览器中使用dapp最简单的方式就安装一个叫MetaMask的插件，其支持Chrome与Firefox。 在Chrome中安装MetaMask 插件 在弹出的窗口中接受使用许可 在MetaMask主页中点击Import Existing DEN 4.在Wallet Seed的输入框中输入 candy maple cake sugar pudding cream honey rich smooth crumble sweet treat 输入密码，确认即可。 5.将MetaMask 连接到我们使用Truffle Dev创建的区块链上去。点击MetaMask 左上角的下三角箭头，打开选择项，选择* Custom RPC* 后输入http://127.0.0.1:9545保存 使用dapp 启动本地server 导航到truffle 根目录下面，在cmd窗口中输入npm run dev,本地dev server 将会启动，并使用默认浏览器打开我们的dapp。 在其中一只要领养的宠物下面点击Adopt按钮。 MetaMask会弹出要求你同意此次交易，点击Submit同意此次交易。 你会看到下面的按钮变成了Success,而且不可点击了，因为此宠物已经被领养了。如果按钮没有变化，就主动刷新一下网页。 在MetaMask上面你可以看到此次交易。 至此，我们就完整的建立了自己的第一个DAPP了，我对web开发不是很熟悉，有机会还是要写一篇使用手机APP作为UI来与区块链交互的文章。 阅读更多" />
<meta property="og:description" content="版权声明： https://blog.csdn.net/ShuSheng0007/article/details/79312300 区块链（1）开发环境搭建及Hello World合约展示 区块链（2）以太坊开发框架Truffle教程（Windows） 区块链（3）:在以太坊私有链建立节点集群并发生交易 概述 环境搭建 Node 安装 Truffle 安装 Ganache CLI 安装 使用Truffle Box 创建一个Truffle 项目 编写智能合约 编译智能合约 部署智能合约 测试智能合约 创建UI界面与智能合约交互 在浏览器中使用dapp 使用dapp 概述 上一篇博客介绍了如何搭建一个私有链的以太坊开发环境，并部署一个简单“hello world”智能合约到区块链上，详情请前往区块链开发环境搭建。 本文进一步介绍区块链的一个主流开发框架Truffle 环境搭建 使用 Truffle需要三个东西，分别如下 Nodejs :是一个基于google浏览器Chrome里面的JavaScript引擎（V8）的一个平台，可以很容易的构建快速而具有扩展性的网络程序。 Truffle ：以太坊开发框架 Ganache CLI：是在本地使用内存模拟的一个以太坊环境，其基于Node.js，以前叫TestRPC在开发过程中使用。 Node 安装 前往Node.js官方网站下载相应的版本，一路next安装。安装完成后打开命令行窗口，输入node –v 来验证是否安装成功。输入npm –version 来确认node 包管理工具安装成功。npm 是node package manager的简称 Truffle 安装 Truffle使用npm来安装，如果node是使用installer安装的，系统应该已经将环境变量配置好了，所以在任何路径下都可以使用npm,如果发现不能使用则需要到相应的路径下去执行命令。 在命令行中输入npm –g install truffle 回车。 Ganache CLI 安装 Ganache CLI的安装仍然使用npm，在命令行中输入npm install -g ganache-cli 回车 完成以上三步则可以开始使用Truffle了 接下来通过官方的一个示例来展示Truffle的具体开发流程 项目背景 一所狗狗收容所想利用区块链来跟踪被收养的狗狗 使用Truffle Box 创建一个Truffle 项目 Truffle Box 可以理解为Truffle 的项目模板 使用在命令行窗口新建文件夹pet-shop-tutorial并导航至其中 mkdir pet-shop-tutorial cd pet-shop-tutorial 在命令行窗口中使用命令 truffle unbox pet-shop 来创建项目模板 pet-shop。 命令完成后就会在pet-shop-tutorial文件夹下面生成项目文件，如下图所示 contracts/:存放智能合约文件。 migrations/:存放部署智能合约相关的文件。 test/:智能合约测试文件，测试文件可以使用JavaScript或者Solidity编写。 truffle.js：Truffle的配置文件。如果你使用Windows的cmd命令行的话，需要将文件名改为truffle-config.js之类的。 编写智能合约 在 contracts/目录下新建文件Adoption.sol。 pragma solidity ^0.4.17;//告诉编译器使用大于0.4.17小于0.5版本的solidity语言 contract Adoption { address[16] public adopters; // Adopting a pet function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); adopters[petId] = msg.sender; return petId; } // Retrieving the adopters function getAdopters() public view returns (address[16]) { return adopters; } } 编译智能合约 由于名称冲突，如果你使用的是CMD命令行，则需要将根目录下的truffle.js文件重命名为truffle-config.js truffle-config.js文件的内容为 module.exports = { // See &lt;http://truffleframework.com/docs/advanced/configuration&gt; // for more about customizing your Truffle configuration! networks: { development: { host: &quot;127.0.0.1&quot;, port: 8545, network_id: &quot;*&quot; // Match any network id } } }; 在命令行中输入truffle compile 如果出现类似于下面的结果，说明编译成功了。 Compiling ./contracts/Migrations.sol... Compiling ./contracts/Adoption.sol... Writing artifacts to ./build/contracts 编译成功后，你会在项目的根目录下面发现多了一个build文件夹，里面存放的是智能合约编译后的结果。 部署智能合约 我们已经成功编译了我们的项目，现在需要将其部署到区块链中。 要将智能合约部署到区块链中去，自然需要一条区块链了。我们使用Truffle内置的Truffle Dev即可。 导航到truffle-config.js所在目录，在cmd窗口中输入truffle dev,启动一条区块链，默认会生成10个账户，每个账户里有100个以太 坊。默认监听localhost:9545 (我们也可以使用Ganache CLI。 在命令行中输入ganache-cli 启动一条区块链，默认会生成10个账户，每个账户里有100个以太坊。默认监听localhost:8545) 在/migrations目录下新建一个文件2_deploy_contracts.js var Adoption = artifacts.require(&quot;Adoption&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; 在命令行中输入truffle migrate，如果发现如下输出，则表示部署成功 Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Deploying Adoption... ... 0x43b6a6888c90c38568d4f9ea494b9e2a22f55e506a8197938fb1bb6e5eaa5d34 Adoption: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Saving successful migration to network... ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0 至此，我们已经成功将智能合约部署到了测试用的区块链中，接下来就是测试区块链的正确性，以及与其交互的工作了。 测试智能合约 待续 创建UI界面与智能合约交互 本文以web的方式与智能合约交互，就是我们要创建一个网页，用来与区块链上的智能合约交互。 web3.js 是以太坊提供的一个Javascript库，它封装了以太坊的JSON RPC API，提供了一系列与区块链交互的Javascript对象和函数，包括查看网络状态，查看本地账户、查看交易和区块、发送交易、编译/部署智能合约、调用智能合约等，其中最重要的就是与智能合约交互的API。 进入/src/js目录下，修改app.js文件如下 1.安装web3 将函数initWeb3里面的注释Replace me...替换为如下代码 ``` // Is there an injected web3 instance? if (typeof web3 !== &#39;undefined&#39;) { App.web3Provider = web3.currentProvider; } else { // If no injected web3 instance is detected, fall back to Ganache App.web3Provider = new } web3 = new Web3(App.web3Provider); ``` 2.安装合约 将函数initContract里面的注释Replace me...替换为如下代码 $.getJSON(&#39;Adoption.json&#39;, function(data) { // Get the necessary contract artifact file and instantiate it with truffle-contract var AdoptionArtifact = data; App.contracts.Adoption = TruffleContract(AdoptionArtifact); // Set the provider for our contract App.contracts.Adoption.setProvider(App.web3Provider); // Use our contract to retrieve and mark the adopted pets return App.markAdopted(); }); 3.领养宠物 将函数markAdopted里面的注释Replace me...替换为如下代码 var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; return adoptionInstance.getAdopters.call(); }).then(function(adopters) { for (i = 0; i &lt; adopters.length; i++) { if (adopters[i] !== &#39;0x0000000000000000000000000000000000000000&#39;) { $(&#39;.panel-pet&#39;).eq(i).find(&#39;button&#39;).text(&#39;Success&#39;).attr(&#39;disabled&#39;, true); } } }).catch(function(err) { console.log(err.message); }); 将函数handleAdopt里面的注释Replace me...替换为如下代码 var adoptionInstance; web3.eth.getAccounts(function(error, accounts) { if (error) { console.log(error); } var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; // Execute adopt as a transaction by sending account return adoptionInstance.adopt(petId, {from: account}); }).then(function(result) { return App.markAdopted(); }).catch(function(err) { console.log(err.message); }); }); 经过以上步骤，我们的第一个DApp就开发完成了，是时候展示一下成果了。 在浏览器中使用dapp 在浏览器中使用dapp最简单的方式就安装一个叫MetaMask的插件，其支持Chrome与Firefox。 在Chrome中安装MetaMask 插件 在弹出的窗口中接受使用许可 在MetaMask主页中点击Import Existing DEN 4.在Wallet Seed的输入框中输入 candy maple cake sugar pudding cream honey rich smooth crumble sweet treat 输入密码，确认即可。 5.将MetaMask 连接到我们使用Truffle Dev创建的区块链上去。点击MetaMask 左上角的下三角箭头，打开选择项，选择* Custom RPC* 后输入http://127.0.0.1:9545保存 使用dapp 启动本地server 导航到truffle 根目录下面，在cmd窗口中输入npm run dev,本地dev server 将会启动，并使用默认浏览器打开我们的dapp。 在其中一只要领养的宠物下面点击Adopt按钮。 MetaMask会弹出要求你同意此次交易，点击Submit同意此次交易。 你会看到下面的按钮变成了Success,而且不可点击了，因为此宠物已经被领养了。如果按钮没有变化，就主动刷新一下网页。 在MetaMask上面你可以看到此次交易。 至此，我们就完整的建立了自己的第一个DAPP了，我对web开发不是很熟悉，有机会还是要写一篇使用手机APP作为UI来与区块链交互的文章。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2018/02/11/9430166b09b47afe78f10d1bd80c7b68.html" />
<meta property="og:url" content="https://mlh.app/2018/02/11/9430166b09b47afe78f10d1bd80c7b68.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-11T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明： https://blog.csdn.net/ShuSheng0007/article/details/79312300 区块链（1）开发环境搭建及Hello World合约展示 区块链（2）以太坊开发框架Truffle教程（Windows） 区块链（3）:在以太坊私有链建立节点集群并发生交易 概述 环境搭建 Node 安装 Truffle 安装 Ganache CLI 安装 使用Truffle Box 创建一个Truffle 项目 编写智能合约 编译智能合约 部署智能合约 测试智能合约 创建UI界面与智能合约交互 在浏览器中使用dapp 使用dapp 概述 上一篇博客介绍了如何搭建一个私有链的以太坊开发环境，并部署一个简单“hello world”智能合约到区块链上，详情请前往区块链开发环境搭建。 本文进一步介绍区块链的一个主流开发框架Truffle 环境搭建 使用 Truffle需要三个东西，分别如下 Nodejs :是一个基于google浏览器Chrome里面的JavaScript引擎（V8）的一个平台，可以很容易的构建快速而具有扩展性的网络程序。 Truffle ：以太坊开发框架 Ganache CLI：是在本地使用内存模拟的一个以太坊环境，其基于Node.js，以前叫TestRPC在开发过程中使用。 Node 安装 前往Node.js官方网站下载相应的版本，一路next安装。安装完成后打开命令行窗口，输入node –v 来验证是否安装成功。输入npm –version 来确认node 包管理工具安装成功。npm 是node package manager的简称 Truffle 安装 Truffle使用npm来安装，如果node是使用installer安装的，系统应该已经将环境变量配置好了，所以在任何路径下都可以使用npm,如果发现不能使用则需要到相应的路径下去执行命令。 在命令行中输入npm –g install truffle 回车。 Ganache CLI 安装 Ganache CLI的安装仍然使用npm，在命令行中输入npm install -g ganache-cli 回车 完成以上三步则可以开始使用Truffle了 接下来通过官方的一个示例来展示Truffle的具体开发流程 项目背景 一所狗狗收容所想利用区块链来跟踪被收养的狗狗 使用Truffle Box 创建一个Truffle 项目 Truffle Box 可以理解为Truffle 的项目模板 使用在命令行窗口新建文件夹pet-shop-tutorial并导航至其中 mkdir pet-shop-tutorial cd pet-shop-tutorial 在命令行窗口中使用命令 truffle unbox pet-shop 来创建项目模板 pet-shop。 命令完成后就会在pet-shop-tutorial文件夹下面生成项目文件，如下图所示 contracts/:存放智能合约文件。 migrations/:存放部署智能合约相关的文件。 test/:智能合约测试文件，测试文件可以使用JavaScript或者Solidity编写。 truffle.js：Truffle的配置文件。如果你使用Windows的cmd命令行的话，需要将文件名改为truffle-config.js之类的。 编写智能合约 在 contracts/目录下新建文件Adoption.sol。 pragma solidity ^0.4.17;//告诉编译器使用大于0.4.17小于0.5版本的solidity语言 contract Adoption { address[16] public adopters; // Adopting a pet function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); adopters[petId] = msg.sender; return petId; } // Retrieving the adopters function getAdopters() public view returns (address[16]) { return adopters; } } 编译智能合约 由于名称冲突，如果你使用的是CMD命令行，则需要将根目录下的truffle.js文件重命名为truffle-config.js truffle-config.js文件的内容为 module.exports = { // See &lt;http://truffleframework.com/docs/advanced/configuration&gt; // for more about customizing your Truffle configuration! networks: { development: { host: &quot;127.0.0.1&quot;, port: 8545, network_id: &quot;*&quot; // Match any network id } } }; 在命令行中输入truffle compile 如果出现类似于下面的结果，说明编译成功了。 Compiling ./contracts/Migrations.sol... Compiling ./contracts/Adoption.sol... Writing artifacts to ./build/contracts 编译成功后，你会在项目的根目录下面发现多了一个build文件夹，里面存放的是智能合约编译后的结果。 部署智能合约 我们已经成功编译了我们的项目，现在需要将其部署到区块链中。 要将智能合约部署到区块链中去，自然需要一条区块链了。我们使用Truffle内置的Truffle Dev即可。 导航到truffle-config.js所在目录，在cmd窗口中输入truffle dev,启动一条区块链，默认会生成10个账户，每个账户里有100个以太 坊。默认监听localhost:9545 (我们也可以使用Ganache CLI。 在命令行中输入ganache-cli 启动一条区块链，默认会生成10个账户，每个账户里有100个以太坊。默认监听localhost:8545) 在/migrations目录下新建一个文件2_deploy_contracts.js var Adoption = artifacts.require(&quot;Adoption&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; 在命令行中输入truffle migrate，如果发现如下输出，则表示部署成功 Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Deploying Adoption... ... 0x43b6a6888c90c38568d4f9ea494b9e2a22f55e506a8197938fb1bb6e5eaa5d34 Adoption: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Saving successful migration to network... ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0 至此，我们已经成功将智能合约部署到了测试用的区块链中，接下来就是测试区块链的正确性，以及与其交互的工作了。 测试智能合约 待续 创建UI界面与智能合约交互 本文以web的方式与智能合约交互，就是我们要创建一个网页，用来与区块链上的智能合约交互。 web3.js 是以太坊提供的一个Javascript库，它封装了以太坊的JSON RPC API，提供了一系列与区块链交互的Javascript对象和函数，包括查看网络状态，查看本地账户、查看交易和区块、发送交易、编译/部署智能合约、调用智能合约等，其中最重要的就是与智能合约交互的API。 进入/src/js目录下，修改app.js文件如下 1.安装web3 将函数initWeb3里面的注释Replace me...替换为如下代码 ``` // Is there an injected web3 instance? if (typeof web3 !== &#39;undefined&#39;) { App.web3Provider = web3.currentProvider; } else { // If no injected web3 instance is detected, fall back to Ganache App.web3Provider = new } web3 = new Web3(App.web3Provider); ``` 2.安装合约 将函数initContract里面的注释Replace me...替换为如下代码 $.getJSON(&#39;Adoption.json&#39;, function(data) { // Get the necessary contract artifact file and instantiate it with truffle-contract var AdoptionArtifact = data; App.contracts.Adoption = TruffleContract(AdoptionArtifact); // Set the provider for our contract App.contracts.Adoption.setProvider(App.web3Provider); // Use our contract to retrieve and mark the adopted pets return App.markAdopted(); }); 3.领养宠物 将函数markAdopted里面的注释Replace me...替换为如下代码 var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; return adoptionInstance.getAdopters.call(); }).then(function(adopters) { for (i = 0; i &lt; adopters.length; i++) { if (adopters[i] !== &#39;0x0000000000000000000000000000000000000000&#39;) { $(&#39;.panel-pet&#39;).eq(i).find(&#39;button&#39;).text(&#39;Success&#39;).attr(&#39;disabled&#39;, true); } } }).catch(function(err) { console.log(err.message); }); 将函数handleAdopt里面的注释Replace me...替换为如下代码 var adoptionInstance; web3.eth.getAccounts(function(error, accounts) { if (error) { console.log(error); } var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; // Execute adopt as a transaction by sending account return adoptionInstance.adopt(petId, {from: account}); }).then(function(result) { return App.markAdopted(); }).catch(function(err) { console.log(err.message); }); }); 经过以上步骤，我们的第一个DApp就开发完成了，是时候展示一下成果了。 在浏览器中使用dapp 在浏览器中使用dapp最简单的方式就安装一个叫MetaMask的插件，其支持Chrome与Firefox。 在Chrome中安装MetaMask 插件 在弹出的窗口中接受使用许可 在MetaMask主页中点击Import Existing DEN 4.在Wallet Seed的输入框中输入 candy maple cake sugar pudding cream honey rich smooth crumble sweet treat 输入密码，确认即可。 5.将MetaMask 连接到我们使用Truffle Dev创建的区块链上去。点击MetaMask 左上角的下三角箭头，打开选择项，选择* Custom RPC* 后输入http://127.0.0.1:9545保存 使用dapp 启动本地server 导航到truffle 根目录下面，在cmd窗口中输入npm run dev,本地dev server 将会启动，并使用默认浏览器打开我们的dapp。 在其中一只要领养的宠物下面点击Adopt按钮。 MetaMask会弹出要求你同意此次交易，点击Submit同意此次交易。 你会看到下面的按钮变成了Success,而且不可点击了，因为此宠物已经被领养了。如果按钮没有变化，就主动刷新一下网页。 在MetaMask上面你可以看到此次交易。 至此，我们就完整的建立了自己的第一个DAPP了，我对web开发不是很熟悉，有机会还是要写一篇使用手机APP作为UI来与区块链交互的文章。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2018/02/11/9430166b09b47afe78f10d1bd80c7b68.html","headline":"区块链（2）以太坊开发框架Truffle教程（Windows）","dateModified":"2018-02-11T00:00:00+08:00","datePublished":"2018-02-11T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2018/02/11/9430166b09b47afe78f10d1bd80c7b68.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链（2）以太坊开发框架Truffle教程（Windows）</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明： https://blog.csdn.net/ShuSheng0007/article/details/79312300 
 </div> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <blockquote> 
   <p><a href="https://blog.csdn.net/shusheng0007/article/details/79288519" rel="nofollow">区块链（1）开发环境搭建及Hello World合约展示</a> <br> <a href="https://blog.csdn.net/shusheng0007/article/details/79312300" rel="nofollow">区块链（2）以太坊开发框架Truffle教程（Windows）</a> <br> <a href="https://blog.csdn.net/shusheng0007/article/details/79391105" rel="nofollow">区块链（3）:在以太坊私有链建立节点集群并发生交易</a></p> 
  </blockquote> 
  <p></p>
  <div class="toc"> 
   <ul> 
    <li><a href="#概述" rel="nofollow">概述</a></li> 
    <li><a href="#环境搭建" rel="nofollow">环境搭建</a>
     <ul> 
      <li><a href="#node-安装" rel="nofollow">Node 安装</a></li> 
      <li><a href="#truffle-安装" rel="nofollow">Truffle 安装</a></li> 
      <li><a href="#ganache-cli-安装" rel="nofollow">Ganache CLI 安装</a></li> 
     </ul> </li> 
    <li><a href="#使用truffle-box-创建一个truffle-项目" rel="nofollow">使用Truffle Box 创建一个Truffle 项目</a>
     <ul> 
      <li><a href="#编写智能合约" rel="nofollow">编写智能合约</a></li> 
      <li><a href="#编译智能合约" rel="nofollow">编译智能合约</a></li> 
      <li><a href="#部署智能合约" rel="nofollow">部署智能合约</a></li> 
      <li><a href="#测试智能合约" rel="nofollow">测试智能合约</a></li> 
      <li><a href="#创建ui界面与智能合约交互" rel="nofollow">创建UI界面与智能合约交互</a></li> 
      <li><a href="#在浏览器中使用dapp" rel="nofollow">在浏览器中使用dapp</a>
       <ul> 
        <li><a href="#使用dapp" rel="nofollow">使用dapp</a></li> 
       </ul> </li> 
     </ul> </li> 
   </ul> 
  </div> 
  <p></p> 
  <h1 id="概述">概述</h1> 
  <p>上一篇博客介绍了如何搭建一个私有链的以太坊开发环境，并部署一个简单“hello world”智能合约到区块链上，详情请前往<a href="http://blog.csdn.net/shusheng0007/article/details/79288519" rel="nofollow">区块链开发环境搭建</a>。</p> 
  <blockquote> 
   <p>本文进一步介绍区块链的一个主流开发框架<strong>Truffle</strong></p> 
  </blockquote> 
  <h1 id="环境搭建">环境搭建</h1> 
  <p>使用 <a href="https://github.com/trufflesuite/truffle" rel="nofollow">Truffle</a>需要三个东西，分别如下</p> 
  <ol> 
   <li><strong>Nodejs</strong> :是一个基于google浏览器<code>Chrome</code>里面的<code>JavaScript</code>引擎（V8）的一个平台，可以很容易的构建快速而具有扩展性的网络程序。</li> 
   <li><strong>Truffle </strong>：以太坊开发框架</li> 
   <li><strong>Ganache CLI</strong>：是在本地使用内存模拟的一个以太坊环境，其基于<code>Node.js</code>，以前叫<strong>TestRPC</strong>在开发过程中使用。</li> 
  </ol> 
  <h2 id="node-安装">Node 安装</h2> 
  <p>前往<code>Node.js</code><a href="https://nodejs.org/en/" rel="nofollow">官方网站</a>下载相应的版本，一路next安装。安装完成后打开命令行窗口，输入<code>node –v</code> 来验证是否安装成功。输入<code>npm –version</code> 来确认node 包管理工具安装成功。npm 是<code>node package manager</code>的简称</p> 
  <h2 id="truffle-安装">Truffle 安装</h2> 
  <p><strong>Truffle</strong>使用npm来安装，如果<code>node</code>是使用installer安装的，系统应该已经将环境变量配置好了，所以在任何路径下都可以使用<code>npm</code>,如果发现不能使用则需要到相应的路径下去执行命令。 <br> 在命令行中输入<code>npm –g install truffle</code> 回车。</p> 
  <h2 id="ganache-cli-安装">Ganache CLI 安装</h2> 
  <p><strong>Ganache CLI</strong>的安装仍然使用npm，在命令行中输入<code>npm install -g ganache-cli</code> 回车 </p> 
  <p>完成以上三步则可以开始使用<strong>Truffle</strong>了</p> 
  <p>接下来通过官方的一个示例来展示Truffle的具体开发流程</p> 
  <blockquote> 
   <p>项目背景 <br> 一所狗狗收容所想利用区块链来跟踪被收养的狗狗</p> 
  </blockquote> 
  <h1 id="使用truffle-box-创建一个truffle-项目">使用Truffle Box 创建一个Truffle 项目</h1> 
  <blockquote> 
   <p><a href="http://truffleframework.com/boxes/" rel="nofollow">Truffle Box </a> 可以理解为Truffle 的项目模板</p> 
  </blockquote> 
  <ol> 
   <li><p>使用在命令行窗口新建文件夹<code>pet-shop-tutorial</code>并导航至其中</p> <p><code>mkdir pet-shop-tutorial <br> cd pet-shop-tutorial</code></p></li> 
   <li><p>在命令行窗口中使用命令 <code>truffle unbox pet-shop</code> 来创建项目模板 <code>pet-shop</code>。 <br> 命令完成后就会在<code>pet-shop-tutorial</code>文件夹下面生成项目文件，如下图所示 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180301162054646?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvU2h1U2hlbmcwMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="truffle project" title=""> <br> <code>contracts/</code>:存放智能合约文件。 <br> <code>migrations/</code>:存放部署智能合约相关的文件。 <br> <code>test/</code>:智能合约测试文件，测试文件可以使用<code>JavaScript</code>或者<code>Solidity</code>编写。 <br> <code>truffle.js</code>：Truffle的配置文件。如果你使用<strong>Windows</strong>的<code>cmd</code>命令行的话，需要将文件名改为<code>truffle-config.js</code>之类的。</p></li> 
  </ol> 
  <h2 id="编写智能合约">编写智能合约</h2> 
  <p>在 <code>contracts/</code>目录下新建文件<code>Adoption.sol</code>。</p> 
  <pre class="prettyprint"><code class=" hljs cs">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.17</span>;<span class="hljs-comment">//告诉编译器使用大于0.4.17小于0.5版本的solidity语言</span>
contract Adoption {
    address[<span class="hljs-number">16</span>] <span class="hljs-keyword">public</span> adopters;    
    <span class="hljs-comment">// Adopting a pet</span>
    function adopt(<span class="hljs-keyword">uint</span> petId) <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span> (<span class="hljs-keyword">uint</span>) {
      require(petId &gt;= <span class="hljs-number">0</span> &amp;&amp; petId &lt;= <span class="hljs-number">15</span>);    
      adopters[petId] = msg.sender;    
      <span class="hljs-keyword">return</span> petId;
    }

    <span class="hljs-comment">// Retrieving the adopters</span>
    function getAdopters() <span class="hljs-keyword">public</span> view <span class="hljs-title">returns</span> (address[16]) {
      <span class="hljs-keyword">return</span> adopters;
    }
}</code></pre> 
  <h2 id="编译智能合约">编译智能合约</h2> 
  <blockquote> 
   <p>由于名称冲突，如果你使用的是<code>CMD</code>命令行，则需要将根目录下的<code>truffle.js</code>文件重命名为<code>truffle-config.js</code></p> 
  </blockquote> 
  <p><code>truffle-config.js</code>文件的内容为</p> 
  <pre class="prettyprint"><code class=" hljs fsharp"><span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-comment">// See &lt;http://truffleframework.com/docs/advanced/configuration&gt;</span>
  <span class="hljs-comment">// for more about customizing your Truffle configuration!</span>
  networks: {
    development: {
      host: <span class="hljs-string">"127.0.0.1"</span>,
      port: <span class="hljs-number">8545</span>,
      network_id: <span class="hljs-string">"*"</span> <span class="hljs-comment">// Match any network id</span>
    }
  }
};</code></pre> 
  <p>在命令行中输入<code>truffle compile</code> 如果出现类似于下面的结果，说明编译成功了。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">Compiling <span class="hljs-built_in">.</span>/contracts/Migrations<span class="hljs-built_in">.</span>sol<span class="hljs-attribute">...</span>
Compiling <span class="hljs-built_in">.</span>/contracts/Adoption<span class="hljs-built_in">.</span>sol<span class="hljs-attribute">...</span>
Writing artifacts <span class="hljs-keyword">to</span> <span class="hljs-built_in">.</span>/build/contracts</code></pre> 
  <p>编译成功后，你会在项目的根目录下面发现多了一个<code>build</code>文件夹，里面存放的是智能合约编译后的结果。</p> 
  <h2 id="部署智能合约">部署智能合约</h2> 
  <p>我们已经成功编译了我们的项目，现在需要将其部署到区块链中。</p> 
  <ol> 
   <li><p>要将智能合约部署到区块链中去，自然需要一条区块链了。我们使用<code>Truffle</code>内置的<code>Truffle Dev</code>即可。 <br> 导航到<code>truffle-config.js</code>所在目录，在cmd窗口中输入<code>truffle dev</code>,启动一条区块链，默认会生成10个账户，每个账户里有100个以太 坊。默认监听<code>localhost:9545</code></p> <p>(我们也可以使用<code>Ganache CLI</code>。 在命令行中输入<code>ganache-cli</code> <br> 启动一条区块链，默认会生成10个账户，每个账户里有100个以太坊。默认监听<code>localhost:8545</code>)</p></li> 
   <li><p>在<code>/migrations</code>目录下新建一个文件<code>2_deploy_contracts.js</code> </p> <pre class="prettyprint"><code class=" hljs lua">var Adoption = artifacts.<span class="hljs-built_in">require</span>(<span class="hljs-string">"Adoption"</span>);    
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(deployer)</span></span> {
   deployer.deploy(Adoption);
};</code></pre></li> 
   <li><p>在命令行中输入<code>truffle migrate</code>，如果发现如下输出，则表示部署成功</p> <pre class="prettyprint"><code class=" hljs r">Using network <span class="hljs-string">'development'</span>.

Running migration: 1_initial_migration.js   Deploying Migrations... 
<span class="hljs-keyword">...</span>
<span class="hljs-number">0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf</span>  
Migrations: <span class="hljs-number">0x8cdaf0cd259887258bc13a92c0a6da92698644c0</span> Saving
successful migration to network...   <span class="hljs-keyword">...</span>
<span class="hljs-number">0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956</span>
Saving artifacts... Running migration: 2_deploy_contracts.js  
Deploying Adoption...   <span class="hljs-keyword">...</span>
<span class="hljs-number">0x43b6a6888c90c38568d4f9ea494b9e2a22f55e506a8197938fb1bb6e5eaa5d34</span>  
Adoption: <span class="hljs-number">0x345ca3e014aaf5dca488057592ee47305d9b3e10</span> Saving
successful migration to network...   <span class="hljs-keyword">...</span>
<span class="hljs-number">0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0</span>
</code></pre> <p>至此，我们已经成功将智能合约部署到了测试用的区块链中，接下来就是测试区块链的正确性，以及与其交互的工作了。</p></li> 
  </ol> 
  <h2 id="测试智能合约">测试智能合约</h2> 
  <p>待续</p> 
  <h2 id="创建ui界面与智能合约交互">创建UI界面与智能合约交互</h2> 
  <p>本文以<code>web</code>的方式与智能合约交互，就是我们要创建一个网页，用来与区块链上的智能合约交互。</p> 
  <blockquote> 
   <p><strong>web3.js</strong> 是以太坊提供的一个<code>Javascript</code>库，它封装了以太坊的<code>JSON RPC API</code>，提供了一系列与区块链交互的<code>Javascript</code>对象和函数，包括查看网络状态，查看本地账户、查看交易和区块、发送交易、编译/部署智能合约、调用智能合约等，其中最重要的就是与智能合约交互的API。</p> 
  </blockquote> 
  <p>进入<code>/src/js</code>目录下，修改<code>app.js</code>文件如下</p> 
  <p>1.安装<code>web3</code></p> 
  <p>将函数<code>initWeb3</code>里面的注释<code>Replace me...</code>替换为如下代码</p> 
  <pre><code>```
// Is there an injected web3 instance? 
if (typeof web3 !== 'undefined') {  
    App.web3Provider = web3.currentProvider; 
 } else {  
    // If no injected web3 instance is detected, fall back to Ganache  
    App.web3Provider = new
} 
web3 = new
Web3(App.web3Provider);
```
</code></pre> 
  <p>2.安装合约</p> 
  <p>将函数<code>initContract</code>里面的注释<code>Replace me...</code>替换为如下代码</p> 
  <pre class="prettyprint"><code class=" hljs haskell">$.getJSON('<span class="hljs-type">Adoption</span>.json', function(<span class="hljs-typedef"><span class="hljs-keyword">data</span>) <span class="hljs-container">{ // <span class="hljs-type">Get</span> <span class="hljs-title">the</span> <span class="hljs-title">necessary</span> <span class="hljs-title">contract</span> <span class="hljs-title">artifact</span> <span class="hljs-title">file</span> <span class="hljs-title">and</span> <span class="hljs-title">instantiate</span> <span class="hljs-title">it</span> <span class="hljs-title">with</span> <span class="hljs-title">truffle</span>-<span class="hljs-title">contract</span> <span class="hljs-title">var</span> <span class="hljs-type">AdoptionArtifact</span> = <span class="hljs-title">data</span>; <span class="hljs-type">App</span>.<span class="hljs-title">contracts</span>.<span class="hljs-type">Adoption</span> = <span class="hljs-type">TruffleContract(AdoptionArtifact)</span>; // <span class="hljs-type">Set</span> <span class="hljs-title">the</span> <span class="hljs-title">provider</span> <span class="hljs-title">for</span> <span class="hljs-title">our</span> <span class="hljs-title">contract</span> <span class="hljs-type">App</span>.<span class="hljs-title">contracts</span>.<span class="hljs-type">Adoption</span>.<span class="hljs-title">setProvider</span>(<span class="hljs-type">App</span>.<span class="hljs-title">web3Provider</span>); // <span class="hljs-type">Use</span> <span class="hljs-title">our</span> <span class="hljs-title">contract</span> <span class="hljs-title">to</span> <span class="hljs-title">retrieve</span> <span class="hljs-title">and</span> <span class="hljs-title">mark</span> <span class="hljs-title">the</span> <span class="hljs-title">adopted</span> <span class="hljs-title">pets</span> <span class="hljs-title">return</span> <span class="hljs-type">App</span>.<span class="hljs-title">markAdopted</span>(); }</span>);</span></code></pre> 
  <p>3.领养宠物</p> 
  <p>将函数<code>markAdopted</code>里面的注释<code>Replace me...</code>替换为如下代码</p> 
  <pre class="prettyprint"><code class=" hljs matlab">var adoptionInstance;
<span class="hljs-transposed_variable">App.</span><span class="hljs-transposed_variable">contracts.</span><span class="hljs-transposed_variable">Adoption.</span>deployed().then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(instance)</span> {</span>
  adoptionInstance = instance;
  <span class="hljs-keyword">return</span> <span class="hljs-transposed_variable">adoptionInstance.</span><span class="hljs-transposed_variable">getAdopters.</span>call();
}).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(adopters)</span> {</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">i</span> = <span class="hljs-number">0</span>; <span class="hljs-built_in">i</span> &lt; <span class="hljs-transposed_variable">adopters.</span><span class="hljs-built_in">length</span>; <span class="hljs-built_in">i</span>++) <span class="hljs-cell">{ if (adopters[i] !== <span class="hljs-string">'0x0000000000000000000000000000000000000000'</span>) { $(<span class="hljs-string">'.panel-pet'</span>).eq(i).find(<span class="hljs-string">'button'</span>).text(<span class="hljs-string">'Success'</span>).attr(<span class="hljs-string">'disabled'</span>, true); }</span>
  }
}).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> {</span>
  <span class="hljs-transposed_variable">console.</span><span class="hljs-built_in">log</span>(<span class="hljs-transposed_variable">err.</span>message);
});</code></pre> 
  <p>将函数<code>handleAdopt</code>里面的注释<code>Replace me...</code>替换为如下代码</p> 
  <pre class="prettyprint"><code class=" hljs lua">var adoptionInstance;
web3.eth.getAccounts(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, accounts)</span></span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">error</span>) {
    console.log(<span class="hljs-built_in">error</span>);
  }

  var account = accounts[<span class="hljs-number">0</span>];
  App.contracts.Adoption.deployed().<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(instance)</span></span> {
    adoptionInstance = instance;

    // Execute adopt as a transaction by sending account
    <span class="hljs-keyword">return</span> adoptionInstance.adopt(petId, {from: account});
  }).<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span></span> {
    <span class="hljs-keyword">return</span> App.markAdopted();
  }).catch(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span> {
    console.log(err.message);
  });
});</code></pre> 
  <p>经过以上步骤，我们的第一个<code>DApp</code>就开发完成了，是时候展示一下成果了。</p> 
  <h2 id="在浏览器中使用dapp">在浏览器中使用dapp</h2> 
  <blockquote> 
   <p>在浏览器中使用<code>dapp</code>最简单的方式就安装一个叫<strong>MetaMask</strong>的插件，其支持<code>Chrome</code>与<code>Firefox</code>。</p> 
  </blockquote> 
  <ol> 
   <li>在<code>Chrome</code>中安装MetaMask 插件</li> 
   <li>在弹出的窗口中接受使用许可</li> 
   <li><p>在<strong>MetaMask</strong>主页中点击<strong>Import Existing DEN</strong></p> <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/2018031214194818?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvU2h1U2hlbmcwMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p></li> 
  </ol> 
  <p>4.在<strong>Wallet Seed</strong>的输入框中输入 <br> <code>candy maple cake sugar pudding cream honey rich smooth crumble sweet treat</code> <br> 输入密码，确认即可。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180312145606889?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvU2h1U2hlbmcwMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p> 
  <p>5.将<strong>MetaMask </strong>连接到我们使用<code>Truffle Dev</code>创建的区块链上去。点击MetaMask 左上角的下三角箭头，打开选择项，选择<em>* Custom RPC*</em> <br> 后输入<code>http://127.0.0.1:9545</code>保存</p> 
  <h3 id="使用dapp">使用dapp</h3> 
  <ol> 
   <li><p>启动本地server</p> <p>导航到truffle 根目录下面，在cmd窗口中输入<code>npm run dev</code>,本地dev server 将会启动，并使用默认浏览器打开我们的dapp。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20180312150600268?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvU2h1U2hlbmcwMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p></li> 
   <li><p>在其中一只要领养的宠物下面点击<code>Adopt</code>按钮。</p></li> 
   <li><p>MetaMask会弹出要求你同意此次交易，点击<code>Submit</code>同意此次交易。</p></li> 
   <li><p>你会看到下面的按钮变成了<code>Success</code>,而且不可点击了，因为此宠物已经被领养了。如果按钮没有变化，就主动刷新一下网页。 <br> 在MetaMask上面你可以看到此次交易。</p></li> 
  </ol> 
  <p>至此，我们就完整的建立了自己的第一个<code>DAPP</code>了，我对web开发不是很熟悉，有机会还是要写一篇使用手机APP作为UI来与区块链交互的文章。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ShuSheng0007/article/details/79312300,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/ShuSheng0007/article/details/79312300,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

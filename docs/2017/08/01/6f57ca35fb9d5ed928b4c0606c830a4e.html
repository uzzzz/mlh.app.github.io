<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊智能合约部署与交互-ddffr的博客 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊智能合约部署与交互-ddffr的博客" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="启动容器来执行geth命令 root@ubu-blockchain2:~# docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:8201 Welcome to the Geth JavaScript console! instance: Geth/01/v1.6.5-stable/linux-amd64/go1.8 coinbase: 0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a at block: 6064 (Wed, 02 Aug 2017 01:13:50 UTC) datadir: /ethcluster/779977/data/01 modules: admin:1.0 eth:1.0 net:1.0 rpc:1.0 web3:1.0 查看我们的账户和余额 eth.getBalance(eth.accounts[0]) 11000000000000000000 eth.getBalance(eth.accounts[1]) 0 eth.accounts[0] &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot; &gt; eth.accounts[1] &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot; 发起一笔交易 eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:web3.toWei(3,&#39;ether&#39;)}) &quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot; 查看交易细节 &gt; eth.getTransaction(&quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot;) { blockHash: &quot;0x3115703894dc6015c96ef4de3e5615f416498ca1f985902b38cd70e27dab8871&quot;, blockNumber: 1250, from: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot;, input: &quot;0x&quot;, nonce: 0, r: &quot;0x2aef2c1fa03a0fa4172d21e3383d8c0431d45ec855b9d16efdd5eb2de90c414c&quot;, s: &quot;0xc4d530fb7902bf509fe56bfbea4861bf6cc16791afc9c9103c1a18f77407d1f&quot;, to: &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot;, transactionIndex: 0, v: &quot;0x17cdb6&quot;, value: 3000000000000000000 } &gt; eth.getBalance(eth.accounts[1]) 3000000000000000000 验证用户0的余额 &gt; eth.getBalance(eth.accounts[0]) 7999622000000000000 编写一个简单的合约 contract Sample { uint public value; function Sample(uint v){ value=v; } function set(uint v){ value=v; } function get() constant returns (uint){ return value; } } 在remix网页编译得到ABI接口和合约的二进制代码、 abi=[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;value&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;set&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{ name: &quot;&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{ name: &quot;v&quot;, type: &quot;uint256&quot; }], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{ name: &quot;&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;function&quot; }, { inputs: [{ name: &quot;v&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;constructor&quot; }] 需要使用eth.contract来定义一个合约类 &gt; sample=eth.contract(abi) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], eth: { accounts: [&quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot;], blockNumber: 6225, coinbase: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 合约的二进制代码赋值给SampleHEX方便使用 SampleHEX=&quot;0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029&quot; 把合约代码部署上链 &gt; thesample=sample.new(1,{from:eth.accounts[0],data:SampleHEX,gas:3000000}) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], address: undefined, transactionHash: &quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot; } 查看交易细节 &gt; samplerecpt=eth.getTransactionReceipt(&quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot;) { blockHash: &quot;0xddba16545af882835fb9a69a0e5f3b9287c61664837d5ea0068b38575cb665c5&quot;, blockNumber: 6246, contractAddress: &quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;, cumulativeGasUsed: 141836, from: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, gasUsed: 141836, logs: [], logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, root: &quot;0xd1093ecaca9cc0d10e82a533a15feccedf7ff5c79fb3ebd9366ec0b35dbef478&quot;, to: null, transactionHash: &quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot;, transactionIndex: 0 } 合约命名 &gt; samplecontract=sample.at(&quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], address: &quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;, transactionHash: null, allEvents: function(), get: function(), set: function(), value: function() } 合约查看功能函数get（）,然后调用set()函数，再get()查看时已经改变了 samplecontract.get.call() 1 &gt; samplecontract.set.sendTransaction(9, {from:eth.accounts[0], gas:3000000}) &quot;0x822ee6fb4caceb7e844c533f7f3bc57806f7cb3676fb3066eb848cca46b2f38a&quot; &gt; samplecontract.get.call() 9 我们再打开一个终端，打开cluster1的peer02的控制台，直接at到上一个终端部署的智能合约地址并进行set操作 root@ubu-blockchain2:~/ethereum-docker/ethereum-docker/ethereum-testnet-docker/dockercomposefiles# docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:9201 Welcome to the Geth JavaScript console! &gt; abi=[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;value&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;set&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] &gt; sample=eth.contract(abi) SampleHEX=&quot;0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029&quot; 直接把合约地址赋值并进行set操作 samplecontract=sample.at(&quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;) &gt; samplecontract.get.call() 9 简单的方法来了。智能合约的部署需要编译，这里用在线编译： https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js 修改编译好的abi和对象名称： 这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下： pragma solidity ^0.4.2; contract Token { address issuer; mapping (address =&gt; uint) balances; event Issue(address account, uint amount); event Transfer(address from, address to,uint amount); function Token() { issuer = msg.sender; } function issue(address account, uintamount) { if (msg.sender != issuer) throw; balances[account] += amount; } function transfer(address to, uint amount){ if (balances[msg.sender] &lt; amount)throw; balances[msg.sender] -= amount; balances[to] += amount; Transfer(msg.sender, to, amount); } function getBalance(address account)constant returns (uint) { return balances[account]; } } 修改编译好的gas和对象名称： varbrowser_untitled_sol_tokenContract =web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;issue&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Issue&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var token =browser_untitled_sol_tokenContract.new( { from: web3.eth.accounts[0], data:&#39;0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029&#39;, gas: &#39;4300000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !==&#39;undefined&#39;) { console.log(&#39;Contract mined! address:&#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) 此时输入合约部署的实例a_demotypes, 可以看到a_demotypes的详情。 控制台调用 &gt; a_demotypes { abi: [{ constant: false, inputs: [{...}], name: &quot;f&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], address: &quot;0x54ed7a5f5a63ddada3bfe83b3e632adabaa5fc2f&quot;, transactionHash: &quot;0x69cde62bcd6458e14f40497f4840f422911d63f5dea2b3a9833e6810db64a1c9&quot;, allEvents: function(), f: function() } 这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。 充值 token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]}); 发送 token token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]}) 查看余额 token.getBalance() 控制台调用就不多说，和Java对象调用一样，直接调用即可 外部接口与智能合约交互 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 相关API: https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction 合约交互的原理 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。 eth_sendTransaction Createsnew message call transaction or a contract creation, if the data field containscode. Parameters Object - The transaction object from: DATA, 20 Bytes - The address the transaction is send from. to: DATA, 20 Bytes - (optional when creating new contract) The address the transaction is directed to. gas: QUANTITY - (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas. gasPrice: QUANTITY - (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas value: QUANTITY - (optional) Integer of the value send with this transaction data: DATA - The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see Ethereum Contract ABI nonce: QUANTITY - (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce. 可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例： 充值issue (address account, uint amount) 这个方法有俩个参数，address充值账号，uint充值数量。 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。 web3.sha3(&quot;issue(address,uint256)&quot;) &quot;0x867904b44b606800f6f10498e11292d04ea19bfc7fe4bc0f1695aa516381f73d&quot; 我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。 eth.accounts[0] &quot;0x0cc9684af605bae10de801218321c1336bb62946&quot; 将10转换为16进制为 000000000000000000000000000000000000000000000000000000000000000a 那么data的数据为： 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a 那么最后我们调用eth_sendTransaction方法传递参数JSON对象为： { from:0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a } 返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 调用接口方法： JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”)); Object result = client.invoke(methodName,params, Object.class); 通过控制台查看第一个账号已有代币： token.getbalance(eth.accounts[0]) 执行调用接口代码。返回交易hash值： 0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095 此时控制台输入： 交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 eth_call Executes anew message call immediately without creating a transaction on the block chain. Parameters Object - The transaction call object from: DATA, 20 Bytes - (optional) The address the transaction is sent from. to: DATA, 20 Bytes - The address the transaction is directed to. gas: QUANTITY - (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions. gasPrice: QUANTITY - (optional) Integer of the gasPrice used for each paid gas value: QUANTITY - (optional) Integer of the value send with this transaction data: DATA - (optional) Hash of the method signature and encoded parameters. For details seeEthereum Contract ABI QUANTITY|TAG - integer block number, or the string &quot;latest&quot;, &quot;earliest&quot; or &quot;pending&quot;, see the default block parameter 这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 查询getBalance(address account) 查询方法hash码： web3.sha3(&quot;getBalance(address)&quot;) &quot;0xf8b2cb4f3943230388faeee074f1503714bff212640051caba01411868d14ae3&quot; 查询我们上一步充值的账号，那么传递的参数data为： 0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb eth_call方法最后参数为： { from: 0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb } 注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者”latest”, “earliest” or “pending” 调用接口返回一个16进制字符串： 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。 这就是一个智能合约的交互过程。是不是很简单啊。 参考：http://blog.csdn.net/super_wu1992/article/details/76919308 阅读更多" />
<meta property="og:description" content="启动容器来执行geth命令 root@ubu-blockchain2:~# docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:8201 Welcome to the Geth JavaScript console! instance: Geth/01/v1.6.5-stable/linux-amd64/go1.8 coinbase: 0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a at block: 6064 (Wed, 02 Aug 2017 01:13:50 UTC) datadir: /ethcluster/779977/data/01 modules: admin:1.0 eth:1.0 net:1.0 rpc:1.0 web3:1.0 查看我们的账户和余额 eth.getBalance(eth.accounts[0]) 11000000000000000000 eth.getBalance(eth.accounts[1]) 0 eth.accounts[0] &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot; &gt; eth.accounts[1] &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot; 发起一笔交易 eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:web3.toWei(3,&#39;ether&#39;)}) &quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot; 查看交易细节 &gt; eth.getTransaction(&quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot;) { blockHash: &quot;0x3115703894dc6015c96ef4de3e5615f416498ca1f985902b38cd70e27dab8871&quot;, blockNumber: 1250, from: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot;, input: &quot;0x&quot;, nonce: 0, r: &quot;0x2aef2c1fa03a0fa4172d21e3383d8c0431d45ec855b9d16efdd5eb2de90c414c&quot;, s: &quot;0xc4d530fb7902bf509fe56bfbea4861bf6cc16791afc9c9103c1a18f77407d1f&quot;, to: &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot;, transactionIndex: 0, v: &quot;0x17cdb6&quot;, value: 3000000000000000000 } &gt; eth.getBalance(eth.accounts[1]) 3000000000000000000 验证用户0的余额 &gt; eth.getBalance(eth.accounts[0]) 7999622000000000000 编写一个简单的合约 contract Sample { uint public value; function Sample(uint v){ value=v; } function set(uint v){ value=v; } function get() constant returns (uint){ return value; } } 在remix网页编译得到ABI接口和合约的二进制代码、 abi=[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;value&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;set&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{ name: &quot;&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{ name: &quot;v&quot;, type: &quot;uint256&quot; }], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{ name: &quot;&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;function&quot; }, { inputs: [{ name: &quot;v&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;constructor&quot; }] 需要使用eth.contract来定义一个合约类 &gt; sample=eth.contract(abi) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], eth: { accounts: [&quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot;], blockNumber: 6225, coinbase: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 合约的二进制代码赋值给SampleHEX方便使用 SampleHEX=&quot;0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029&quot; 把合约代码部署上链 &gt; thesample=sample.new(1,{from:eth.accounts[0],data:SampleHEX,gas:3000000}) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], address: undefined, transactionHash: &quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot; } 查看交易细节 &gt; samplerecpt=eth.getTransactionReceipt(&quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot;) { blockHash: &quot;0xddba16545af882835fb9a69a0e5f3b9287c61664837d5ea0068b38575cb665c5&quot;, blockNumber: 6246, contractAddress: &quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;, cumulativeGasUsed: 141836, from: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, gasUsed: 141836, logs: [], logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, root: &quot;0xd1093ecaca9cc0d10e82a533a15feccedf7ff5c79fb3ebd9366ec0b35dbef478&quot;, to: null, transactionHash: &quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot;, transactionIndex: 0 } 合约命名 &gt; samplecontract=sample.at(&quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], address: &quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;, transactionHash: null, allEvents: function(), get: function(), set: function(), value: function() } 合约查看功能函数get（）,然后调用set()函数，再get()查看时已经改变了 samplecontract.get.call() 1 &gt; samplecontract.set.sendTransaction(9, {from:eth.accounts[0], gas:3000000}) &quot;0x822ee6fb4caceb7e844c533f7f3bc57806f7cb3676fb3066eb848cca46b2f38a&quot; &gt; samplecontract.get.call() 9 我们再打开一个终端，打开cluster1的peer02的控制台，直接at到上一个终端部署的智能合约地址并进行set操作 root@ubu-blockchain2:~/ethereum-docker/ethereum-docker/ethereum-testnet-docker/dockercomposefiles# docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:9201 Welcome to the Geth JavaScript console! &gt; abi=[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;value&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;set&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] &gt; sample=eth.contract(abi) SampleHEX=&quot;0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029&quot; 直接把合约地址赋值并进行set操作 samplecontract=sample.at(&quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;) &gt; samplecontract.get.call() 9 简单的方法来了。智能合约的部署需要编译，这里用在线编译： https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js 修改编译好的abi和对象名称： 这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下： pragma solidity ^0.4.2; contract Token { address issuer; mapping (address =&gt; uint) balances; event Issue(address account, uint amount); event Transfer(address from, address to,uint amount); function Token() { issuer = msg.sender; } function issue(address account, uintamount) { if (msg.sender != issuer) throw; balances[account] += amount; } function transfer(address to, uint amount){ if (balances[msg.sender] &lt; amount)throw; balances[msg.sender] -= amount; balances[to] += amount; Transfer(msg.sender, to, amount); } function getBalance(address account)constant returns (uint) { return balances[account]; } } 修改编译好的gas和对象名称： varbrowser_untitled_sol_tokenContract =web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;issue&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Issue&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var token =browser_untitled_sol_tokenContract.new( { from: web3.eth.accounts[0], data:&#39;0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029&#39;, gas: &#39;4300000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !==&#39;undefined&#39;) { console.log(&#39;Contract mined! address:&#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) 此时输入合约部署的实例a_demotypes, 可以看到a_demotypes的详情。 控制台调用 &gt; a_demotypes { abi: [{ constant: false, inputs: [{...}], name: &quot;f&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], address: &quot;0x54ed7a5f5a63ddada3bfe83b3e632adabaa5fc2f&quot;, transactionHash: &quot;0x69cde62bcd6458e14f40497f4840f422911d63f5dea2b3a9833e6810db64a1c9&quot;, allEvents: function(), f: function() } 这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。 充值 token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]}); 发送 token token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]}) 查看余额 token.getBalance() 控制台调用就不多说，和Java对象调用一样，直接调用即可 外部接口与智能合约交互 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 相关API: https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction 合约交互的原理 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。 eth_sendTransaction Createsnew message call transaction or a contract creation, if the data field containscode. Parameters Object - The transaction object from: DATA, 20 Bytes - The address the transaction is send from. to: DATA, 20 Bytes - (optional when creating new contract) The address the transaction is directed to. gas: QUANTITY - (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas. gasPrice: QUANTITY - (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas value: QUANTITY - (optional) Integer of the value send with this transaction data: DATA - The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see Ethereum Contract ABI nonce: QUANTITY - (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce. 可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例： 充值issue (address account, uint amount) 这个方法有俩个参数，address充值账号，uint充值数量。 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。 web3.sha3(&quot;issue(address,uint256)&quot;) &quot;0x867904b44b606800f6f10498e11292d04ea19bfc7fe4bc0f1695aa516381f73d&quot; 我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。 eth.accounts[0] &quot;0x0cc9684af605bae10de801218321c1336bb62946&quot; 将10转换为16进制为 000000000000000000000000000000000000000000000000000000000000000a 那么data的数据为： 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a 那么最后我们调用eth_sendTransaction方法传递参数JSON对象为： { from:0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a } 返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 调用接口方法： JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”)); Object result = client.invoke(methodName,params, Object.class); 通过控制台查看第一个账号已有代币： token.getbalance(eth.accounts[0]) 执行调用接口代码。返回交易hash值： 0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095 此时控制台输入： 交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 eth_call Executes anew message call immediately without creating a transaction on the block chain. Parameters Object - The transaction call object from: DATA, 20 Bytes - (optional) The address the transaction is sent from. to: DATA, 20 Bytes - The address the transaction is directed to. gas: QUANTITY - (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions. gasPrice: QUANTITY - (optional) Integer of the gasPrice used for each paid gas value: QUANTITY - (optional) Integer of the value send with this transaction data: DATA - (optional) Hash of the method signature and encoded parameters. For details seeEthereum Contract ABI QUANTITY|TAG - integer block number, or the string &quot;latest&quot;, &quot;earliest&quot; or &quot;pending&quot;, see the default block parameter 这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 查询getBalance(address account) 查询方法hash码： web3.sha3(&quot;getBalance(address)&quot;) &quot;0xf8b2cb4f3943230388faeee074f1503714bff212640051caba01411868d14ae3&quot; 查询我们上一步充值的账号，那么传递的参数data为： 0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb eth_call方法最后参数为： { from: 0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb } 注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者”latest”, “earliest” or “pending” 调用接口返回一个16进制字符串： 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。 这就是一个智能合约的交互过程。是不是很简单啊。 参考：http://blog.csdn.net/super_wu1992/article/details/76919308 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/08/01/6f57ca35fb9d5ed928b4c0606c830a4e.html" />
<meta property="og:url" content="https://mlh.app/2017/08/01/6f57ca35fb9d5ed928b4c0606c830a4e.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-08-01T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"启动容器来执行geth命令 root@ubu-blockchain2:~# docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:8201 Welcome to the Geth JavaScript console! instance: Geth/01/v1.6.5-stable/linux-amd64/go1.8 coinbase: 0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a at block: 6064 (Wed, 02 Aug 2017 01:13:50 UTC) datadir: /ethcluster/779977/data/01 modules: admin:1.0 eth:1.0 net:1.0 rpc:1.0 web3:1.0 查看我们的账户和余额 eth.getBalance(eth.accounts[0]) 11000000000000000000 eth.getBalance(eth.accounts[1]) 0 eth.accounts[0] &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot; &gt; eth.accounts[1] &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot; 发起一笔交易 eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:web3.toWei(3,&#39;ether&#39;)}) &quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot; 查看交易细节 &gt; eth.getTransaction(&quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot;) { blockHash: &quot;0x3115703894dc6015c96ef4de3e5615f416498ca1f985902b38cd70e27dab8871&quot;, blockNumber: 1250, from: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec&quot;, input: &quot;0x&quot;, nonce: 0, r: &quot;0x2aef2c1fa03a0fa4172d21e3383d8c0431d45ec855b9d16efdd5eb2de90c414c&quot;, s: &quot;0xc4d530fb7902bf509fe56bfbea4861bf6cc16791afc9c9103c1a18f77407d1f&quot;, to: &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot;, transactionIndex: 0, v: &quot;0x17cdb6&quot;, value: 3000000000000000000 } &gt; eth.getBalance(eth.accounts[1]) 3000000000000000000 验证用户0的余额 &gt; eth.getBalance(eth.accounts[0]) 7999622000000000000 编写一个简单的合约 contract Sample { uint public value; function Sample(uint v){ value=v; } function set(uint v){ value=v; } function get() constant returns (uint){ return value; } } 在remix网页编译得到ABI接口和合约的二进制代码、 abi=[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;value&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;set&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{ name: &quot;&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{ name: &quot;v&quot;, type: &quot;uint256&quot; }], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{ name: &quot;&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;function&quot; }, { inputs: [{ name: &quot;v&quot;, type: &quot;uint256&quot; }], payable: false, type: &quot;constructor&quot; }] 需要使用eth.contract来定义一个合约类 &gt; sample=eth.contract(abi) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], eth: { accounts: [&quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, &quot;0xe82e2f0a5abd8774767b9751659976f9c4f59181&quot;], blockNumber: 6225, coinbase: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 合约的二进制代码赋值给SampleHEX方便使用 SampleHEX=&quot;0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029&quot; 把合约代码部署上链 &gt; thesample=sample.new(1,{from:eth.accounts[0],data:SampleHEX,gas:3000000}) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], address: undefined, transactionHash: &quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot; } 查看交易细节 &gt; samplerecpt=eth.getTransactionReceipt(&quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot;) { blockHash: &quot;0xddba16545af882835fb9a69a0e5f3b9287c61664837d5ea0068b38575cb665c5&quot;, blockNumber: 6246, contractAddress: &quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;, cumulativeGasUsed: 141836, from: &quot;0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a&quot;, gasUsed: 141836, logs: [], logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, root: &quot;0xd1093ecaca9cc0d10e82a533a15feccedf7ff5c79fb3ebd9366ec0b35dbef478&quot;, to: null, transactionHash: &quot;0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1&quot;, transactionIndex: 0 } 合约命名 &gt; samplecontract=sample.at(&quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;) { abi: [{ constant: true, inputs: [], name: &quot;value&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { constant: false, inputs: [{...}], name: &quot;set&quot;, outputs: [], payable: false, type: &quot;function&quot; }, { constant: true, inputs: [], name: &quot;get&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }, { inputs: [{...}], payable: false, type: &quot;constructor&quot; }], address: &quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;, transactionHash: null, allEvents: function(), get: function(), set: function(), value: function() } 合约查看功能函数get（）,然后调用set()函数，再get()查看时已经改变了 samplecontract.get.call() 1 &gt; samplecontract.set.sendTransaction(9, {from:eth.accounts[0], gas:3000000}) &quot;0x822ee6fb4caceb7e844c533f7f3bc57806f7cb3676fb3066eb848cca46b2f38a&quot; &gt; samplecontract.get.call() 9 我们再打开一个终端，打开cluster1的peer02的控制台，直接at到上一个终端部署的智能合约地址并进行set操作 root@ubu-blockchain2:~/ethereum-docker/ethereum-docker/ethereum-testnet-docker/dockercomposefiles# docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:9201 Welcome to the Geth JavaScript console! &gt; abi=[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;value&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;set&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[{&quot;name&quot;:&quot;v&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;}] &gt; sample=eth.contract(abi) SampleHEX=&quot;0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029&quot; 直接把合约地址赋值并进行set操作 samplecontract=sample.at(&quot;0x7504fa9d64ab290844b82660d43b310f8fba0276&quot;) &gt; samplecontract.get.call() 9 简单的方法来了。智能合约的部署需要编译，这里用在线编译： https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js 修改编译好的abi和对象名称： 这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下： pragma solidity ^0.4.2; contract Token { address issuer; mapping (address =&gt; uint) balances; event Issue(address account, uint amount); event Transfer(address from, address to,uint amount); function Token() { issuer = msg.sender; } function issue(address account, uintamount) { if (msg.sender != issuer) throw; balances[account] += amount; } function transfer(address to, uint amount){ if (balances[msg.sender] &lt; amount)throw; balances[msg.sender] -= amount; balances[to] += amount; Transfer(msg.sender, to, amount); } function getBalance(address account)constant returns (uint) { return balances[account]; } } 修改编译好的gas和对象名称： varbrowser_untitled_sol_tokenContract =web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;issue&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Issue&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var token =browser_untitled_sol_tokenContract.new( { from: web3.eth.accounts[0], data:&#39;0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029&#39;, gas: &#39;4300000&#39; }, function (e, contract){ console.log(e, contract); if (typeof contract.address !==&#39;undefined&#39;) { console.log(&#39;Contract mined! address:&#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); } }) 此时输入合约部署的实例a_demotypes, 可以看到a_demotypes的详情。 控制台调用 &gt; a_demotypes { abi: [{ constant: false, inputs: [{...}], name: &quot;f&quot;, outputs: [{...}], payable: false, type: &quot;function&quot; }], address: &quot;0x54ed7a5f5a63ddada3bfe83b3e632adabaa5fc2f&quot;, transactionHash: &quot;0x69cde62bcd6458e14f40497f4840f422911d63f5dea2b3a9833e6810db64a1c9&quot;, allEvents: function(), f: function() } 这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。 充值 token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]}); 发送 token token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]}) 查看余额 token.getBalance() 控制台调用就不多说，和Java对象调用一样，直接调用即可 外部接口与智能合约交互 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 相关API: https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction 合约交互的原理 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。 eth_sendTransaction Createsnew message call transaction or a contract creation, if the data field containscode. Parameters Object - The transaction object from: DATA, 20 Bytes - The address the transaction is send from. to: DATA, 20 Bytes - (optional when creating new contract) The address the transaction is directed to. gas: QUANTITY - (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas. gasPrice: QUANTITY - (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas value: QUANTITY - (optional) Integer of the value send with this transaction data: DATA - The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see Ethereum Contract ABI nonce: QUANTITY - (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce. 可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例： 充值issue (address account, uint amount) 这个方法有俩个参数，address充值账号，uint充值数量。 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。 web3.sha3(&quot;issue(address,uint256)&quot;) &quot;0x867904b44b606800f6f10498e11292d04ea19bfc7fe4bc0f1695aa516381f73d&quot; 我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。 eth.accounts[0] &quot;0x0cc9684af605bae10de801218321c1336bb62946&quot; 将10转换为16进制为 000000000000000000000000000000000000000000000000000000000000000a 那么data的数据为： 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a 那么最后我们调用eth_sendTransaction方法传递参数JSON对象为： { from:0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a } 返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 调用接口方法： JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”)); Object result = client.invoke(methodName,params, Object.class); 通过控制台查看第一个账号已有代币： token.getbalance(eth.accounts[0]) 执行调用接口代码。返回交易hash值： 0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095 此时控制台输入： 交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 eth_call Executes anew message call immediately without creating a transaction on the block chain. Parameters Object - The transaction call object from: DATA, 20 Bytes - (optional) The address the transaction is sent from. to: DATA, 20 Bytes - The address the transaction is directed to. gas: QUANTITY - (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions. gasPrice: QUANTITY - (optional) Integer of the gasPrice used for each paid gas value: QUANTITY - (optional) Integer of the value send with this transaction data: DATA - (optional) Hash of the method signature and encoded parameters. For details seeEthereum Contract ABI QUANTITY|TAG - integer block number, or the string &quot;latest&quot;, &quot;earliest&quot; or &quot;pending&quot;, see the default block parameter 这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 查询getBalance(address account) 查询方法hash码： web3.sha3(&quot;getBalance(address)&quot;) &quot;0xf8b2cb4f3943230388faeee074f1503714bff212640051caba01411868d14ae3&quot; 查询我们上一步充值的账号，那么传递的参数data为： 0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb eth_call方法最后参数为： { from: 0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb } 注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者”latest”, “earliest” or “pending” 调用接口返回一个16进制字符串： 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。 这就是一个智能合约的交互过程。是不是很简单啊。 参考：http://blog.csdn.net/super_wu1992/article/details/76919308 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/08/01/6f57ca35fb9d5ed928b4c0606c830a4e.html","headline":"以太坊智能合约部署与交互-ddffr的博客","dateModified":"2017-08-01T00:00:00+08:00","datePublished":"2017-08-01T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/08/01/6f57ca35fb9d5ed928b4c0606c830a4e.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊智能合约部署与交互-ddffr的博客</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>启动容器来执行geth命令</p> 
  <pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">root</span>@ubu-blockchain2:~# docker run -i blockchain101/ethereum-geth:<span class="hljs-number">1.6</span><span class="hljs-number">.5</span> geth attach http://<span class="hljs-number">45.32</span><span class="hljs-number">.252</span><span class="hljs-number">.88</span>:<span class="hljs-number">8201</span>
<span class="hljs-type">Welcome</span> to the <span class="hljs-type">Geth</span> <span class="hljs-type">JavaScript</span> console!
<span class="hljs-class"> <span class="hljs-keyword">instance</span>: <span class="hljs-type">Geth</span>/01/v1.6.5-stable/linux-amd64/go1.8 coinbase: 0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a at block: 6064 <span class="hljs-container">(<span class="hljs-type">Wed</span>, 02 <span class="hljs-type">Aug</span> 2017 01:13:50 <span class="hljs-type">UTC</span>)</span> datadir: /ethcluster/779977/data/01 modules: admin:1.0 eth:1.0 net:1.0 rpc:1.0 web3:1.0 </span></code></pre> 
  <p>查看我们的账户和余额</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">
eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])

<span class="hljs-number">11000000000000000000</span>
eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>])
<span class="hljs-number">0</span>
eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]
<span class="hljs-string">"0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a"</span>
&gt; eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">1</span>]
<span class="hljs-string">"0xe82e2f0a5abd8774767b9751659976f9c4f59181"</span>
</code></pre> 
  <p>发起一笔交易</p> 
  <pre class="prettyprint"><code class=" hljs css">
<span class="hljs-tag">eth</span><span class="hljs-class">.sendTransaction</span>(<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">from</span>:<span class="hljs-value">eth.accounts[<span class="hljs-number">0</span>],to:eth.accounts[<span class="hljs-number">1</span>],value:web3.<span class="hljs-function">toWei(<span class="hljs-number">3</span>,<span class="hljs-string">'ether'</span>)</span></span></span></span>})

"0<span class="hljs-tag">x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec</span>"
</code></pre> 
  <p>查看交易细节</p> 
  <pre class="prettyprint"><code class=" hljs css">
&gt;  <span class="hljs-tag">eth</span><span class="hljs-class">.getTransaction</span>("0<span class="hljs-tag">x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec</span>")

<span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">blockHash</span>:<span class="hljs-value"> <span class="hljs-string">"0x3115703894dc6015c96ef4de3e5615f416498ca1f985902b38cd70e27dab8871"</span>, blockNumber: <span class="hljs-number">1250</span>, from: <span class="hljs-string">"0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a"</span>, gas: <span class="hljs-number">90000</span>, gasPrice: <span class="hljs-number">18000000000</span>, hash: <span class="hljs-string">"0x0075da712d26aea17d6647035107f509e13eaf3d113c1577db14d4cc4216caec"</span>, input: <span class="hljs-string">"0x"</span>, nonce: <span class="hljs-number">0</span>, r: <span class="hljs-string">"0x2aef2c1fa03a0fa4172d21e3383d8c0431d45ec855b9d16efdd5eb2de90c414c"</span>, s: <span class="hljs-string">"0xc4d530fb7902bf509fe56bfbea4861bf6cc16791afc9c9103c1a18f77407d1f"</span>, to: <span class="hljs-string">"0xe82e2f0a5abd8774767b9751659976f9c4f59181"</span>, transactionIndex: <span class="hljs-number">0</span>, v: <span class="hljs-string">"0x17cdb6"</span>, value: <span class="hljs-number">3000000000000000000</span> </span></span></span>}
&gt; <span class="hljs-tag">eth</span><span class="hljs-class">.getBalance</span>(<span class="hljs-tag">eth</span><span class="hljs-class">.accounts</span><span class="hljs-attr_selector">[1]</span>)

3000000000000000000
</code></pre> 
  <p>验证用户0的余额</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">
&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])

<span class="hljs-number">7999622000000000000</span>
</code></pre> 
  <p>编写一个简单的合约</p> 
  <pre class="prettyprint"><code class=" hljs http">

<span class="cs">contract Sample { <span class="hljs-keyword">uint</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">value</span>; function Sample(<span class="hljs-keyword">uint</span> v){ <span class="hljs-keyword">value</span>=v; } function <span class="hljs-keyword">set</span>(<span class="hljs-keyword">uint</span> v){ <span class="hljs-keyword">value</span>=v; } function <span class="hljs-keyword">get</span>() constant returns (<span class="hljs-keyword">uint</span>){ <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span>; } } </span></code></pre> 
  <p>在<a href="https://remix.ethereum.org/#version=soljson-v0.4.11+commit.68ef5810.js" rel="nofollow" target="_blank">remix</a>网页编译得到ABI接口和合约的二进制代码、</p> 
  <pre class="prettyprint"><code class=" hljs applescript"> abi=[{<span class="hljs-string">"constant"</span>:<span class="hljs-constant">true</span>,<span class="hljs-string">"inputs"</span>:[],<span class="hljs-string">"name"</span>:<span class="hljs-string">"value"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-constant">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"constant"</span>:<span class="hljs-constant">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"v"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"set"</span>,<span class="hljs-string">"outputs"</span>:[],<span class="hljs-string">"payable"</span>:<span class="hljs-constant">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"constant"</span>:<span class="hljs-constant">true</span>,<span class="hljs-string">"inputs"</span>:[],<span class="hljs-string">"name"</span>:<span class="hljs-string">"get"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-constant">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"v"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-constant">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"constructor"</span>}]



[{
    <span class="hljs-type">constant</span>: <span class="hljs-constant">true</span>,
    inputs: [],
    <span class="hljs-property">name</span>: <span class="hljs-string">"value"</span>,
    outputs: [{
        <span class="hljs-property">name</span>: <span class="hljs-string">""</span>,
        type: <span class="hljs-string">"uint256"</span>
    }],
    payable: <span class="hljs-constant">false</span>,
    type: <span class="hljs-string">"function"</span>
}, {
    <span class="hljs-type">constant</span>: <span class="hljs-constant">false</span>,
    inputs: [{
        <span class="hljs-property">name</span>: <span class="hljs-string">"v"</span>,
        type: <span class="hljs-string">"uint256"</span>
    }],
    <span class="hljs-property">name</span>: <span class="hljs-string">"set"</span>,
    outputs: [],
    payable: <span class="hljs-constant">false</span>,
    type: <span class="hljs-string">"function"</span>
}, {
    <span class="hljs-type">constant</span>: <span class="hljs-constant">true</span>,
    inputs: [],
    <span class="hljs-property">name</span>: <span class="hljs-string">"get"</span>,
    outputs: [{
        <span class="hljs-property">name</span>: <span class="hljs-string">""</span>,
        type: <span class="hljs-string">"uint256"</span>
    }],
    payable: <span class="hljs-constant">false</span>,
    type: <span class="hljs-string">"function"</span>
}, {
    inputs: [{
        <span class="hljs-property">name</span>: <span class="hljs-string">"v"</span>,
        type: <span class="hljs-string">"uint256"</span>
    }],
    payable: <span class="hljs-constant">false</span>,
    type: <span class="hljs-string">"constructor"</span>
}]
</code></pre> 
  <p>需要使用eth.contract来定义一个合约类</p> 
  <pre class="prettyprint"><code class=" hljs lua">
&gt; sample=eth.contract(abi)

{
  abi: [{
      constant: <span class="hljs-keyword">true</span>,
      inputs: [],
      name: <span class="hljs-string">"value"</span>,
      outputs: [{...}],
      payable: <span class="hljs-keyword">false</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">"function"</span>
  }, {
      constant: <span class="hljs-keyword">false</span>,
      inputs: [{...}],
      name: <span class="hljs-string">"set"</span>,
      outputs: [],
      payable: <span class="hljs-keyword">false</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">"function"</span>
  }, {
      constant: <span class="hljs-keyword">true</span>,
      inputs: [],
      name: <span class="hljs-string">"get"</span>,
      outputs: [{...}],
      payable: <span class="hljs-keyword">false</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">"function"</span>
  }, {
      inputs: [{...}],
      payable: <span class="hljs-keyword">false</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">"constructor"</span>
  }],
  eth: {
    accounts: [<span class="hljs-string">"0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a"</span>, <span class="hljs-string">"0xe82e2f0a5abd8774767b9751659976f9c4f59181"</span>],
    blockNumber: <span class="hljs-number">6225</span>,
    coinbase: <span class="hljs-string">"0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a"</span>,
    compile: {
      lll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
      serpent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
      solidity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    },
    defaultAccount: undefined,
    defaultBlock: <span class="hljs-string">"latest"</span>,
    gasPrice: <span class="hljs-number">18000000000</span>,
    hashrate: <span class="hljs-number">0</span>,
    mining: <span class="hljs-keyword">false</span>,
    pendingTransactions: [],
    protocolVersion: <span class="hljs-string">"0x3f"</span>,
    syncing: <span class="hljs-keyword">false</span>,
    call: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    contract: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(abi)</span></span>,
    estimateGas: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    filter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fil, callback)</span></span>,
    getAccounts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getBalance: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlockNumber: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getBlockTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlockUncleCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getCode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getCoinbase: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getCompilers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getGasPrice: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getHashrate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getMining: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getPendingTransactions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getProtocolVersion: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getRawTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getStorageAt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionReceipt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getUncle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    iban: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iban)</span></span>,
    icapNamereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    isSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    namereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    resend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendIBANTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sign: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    signTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    submitTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    submitWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
  },
  at: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(address, callback)</span></span>,
  getData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
  new: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
}
</code></pre> 
  <p>合约的二进制代码赋值给SampleHEX方便使用</p> 
  <pre class="prettyprint"><code class=" hljs ini">
<span class="hljs-setting">SampleHEX=<span class="hljs-value"><span class="hljs-string">"0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029"</span></span></span>
</code></pre> 
  <p>把合约代码部署上链</p> 
  <pre class="prettyprint"><code class=" hljs r">&gt; thesample=sample.new(<span class="hljs-number">1</span>,{from:eth.accounts[<span class="hljs-number">0</span>],data:SampleHEX,gas:<span class="hljs-number">3000000</span>})

{
  abi: [{
      constant: true,
      inputs: [],
      name: <span class="hljs-string">"value"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }, {
      constant: false,
      inputs: [{<span class="hljs-keyword">...</span>}],
      name: <span class="hljs-string">"set"</span>,
      outputs: [],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }, {
      constant: true,
      inputs: [],
      name: <span class="hljs-string">"get"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }, {
      inputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"constructor"</span>
  }],
  address: undefined,
  transactionHash: <span class="hljs-string">"0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1"</span>
}</code></pre> 
  <p>查看交易细节</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; samplerecpt=eth.getTransactionReceipt(<span class="hljs-string">"0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1"</span>)

{
  blockHash: <span class="hljs-string">"0xddba16545af882835fb9a69a0e5f3b9287c61664837d5ea0068b38575cb665c5"</span>,
  blockNumber: <span class="hljs-number">6246</span>,
  contractAddress: <span class="hljs-string">"0x7504fa9d64ab290844b82660d43b310f8fba0276"</span>,
  cumulativeGasUsed: <span class="hljs-number">141836</span>,
  <span class="hljs-built_in">from</span>: <span class="hljs-string">"0x4c57e7e9c2f728046ddc6e96052056a241bdbd0a"</span>,
  gasUsed: <span class="hljs-number">141836</span>,
  logs: [],
  logsBloom: <span class="hljs-string">"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>,
  root: <span class="hljs-string">"0xd1093ecaca9cc0d10e82a533a15feccedf7ff5c79fb3ebd9366ec0b35dbef478"</span>,
  <span class="hljs-built_in">to</span>: <span class="hljs-constant">null</span>,
  transactionHash: <span class="hljs-string">"0xee74bcb4461c9712ec9aca96a5a3a4c3c64be1213854d519fc8e5432b554f7a1"</span>,
  transactionIndex: <span class="hljs-number">0</span>
}</code></pre> 
  <p>合约命名</p> 
  <pre class="prettyprint"><code class=" hljs r">&gt; samplecontract=sample.at(<span class="hljs-string">"0x7504fa9d64ab290844b82660d43b310f8fba0276"</span>)

{
  abi: [{
      constant: true,
      inputs: [],
      name: <span class="hljs-string">"value"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }, {
      constant: false,
      inputs: [{<span class="hljs-keyword">...</span>}],
      name: <span class="hljs-string">"set"</span>,
      outputs: [],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }, {
      constant: true,
      inputs: [],
      name: <span class="hljs-string">"get"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }, {
      inputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"constructor"</span>
  }],
  address: <span class="hljs-string">"0x7504fa9d64ab290844b82660d43b310f8fba0276"</span>,
  transactionHash: null,
  allEvents: <span class="hljs-keyword">function</span>(),
  get: <span class="hljs-keyword">function</span>(),
  set: <span class="hljs-keyword">function</span>(),
  value: <span class="hljs-keyword">function</span>()
}</code></pre> 
  <p>合约查看功能函数get（）,然后调用set()函数，再get()查看时已经改变了</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">samplecontract<span class="hljs-preprocessor">.get</span><span class="hljs-preprocessor">.call</span>()
<span class="hljs-number">1</span>

&gt; samplecontract<span class="hljs-preprocessor">.set</span><span class="hljs-preprocessor">.sendTransaction</span>(<span class="hljs-number">9</span>, {from:eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>], gas:<span class="hljs-number">3000000</span>})

<span class="hljs-string">"0x822ee6fb4caceb7e844c533f7f3bc57806f7cb3676fb3066eb848cca46b2f38a"</span>

&gt; samplecontract<span class="hljs-preprocessor">.get</span><span class="hljs-preprocessor">.call</span>()

<span class="hljs-number">9</span>
</code></pre> 
  <p>我们再打开一个终端，打开cluster1的peer02的控制台，直接at到上一个终端部署的智能合约地址并进行set操作</p> 
  <pre class="prettyprint"><code class=" hljs ruby">
root<span class="hljs-variable">@ubu</span>-<span class="hljs-symbol">blockchain2:</span>~<span class="hljs-regexp">/ethereum-docker/ethereum</span>-docker/ethereum-testnet-docker/dockercomposefiles<span class="hljs-comment"># docker run -i blockchain101/ethereum-geth:1.6.5 geth attach http://45.32.252.88:9201</span>
<span class="hljs-constant">Welcome</span> to the <span class="hljs-constant">Geth</span> <span class="hljs-constant">JavaScript</span> console!


&gt;  abi=[{<span class="hljs-string">"constant"</span><span class="hljs-symbol">:true</span>,<span class="hljs-string">"inputs"</span><span class="hljs-symbol">:[]</span>,<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">"value"</span></span>,<span class="hljs-string">"outputs"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"uint256"</span></span>}],<span class="hljs-string">"payable"</span><span class="hljs-symbol">:false</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"function"</span></span>},{<span class="hljs-string">"constant"</span><span class="hljs-symbol">:false</span>,<span class="hljs-string">"inputs"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">"v"</span></span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"uint256"</span></span>}],<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">"set"</span></span>,<span class="hljs-string">"outputs"</span><span class="hljs-symbol">:[]</span>,<span class="hljs-string">"payable"</span><span class="hljs-symbol">:false</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"function"</span></span>},{<span class="hljs-string">"constant"</span><span class="hljs-symbol">:true</span>,<span class="hljs-string">"inputs"</span><span class="hljs-symbol">:[]</span>,<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">"get"</span></span>,<span class="hljs-string">"outputs"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"uint256"</span></span>}],<span class="hljs-string">"payable"</span><span class="hljs-symbol">:false</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"function"</span></span>},{<span class="hljs-string">"inputs"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"name"</span><span class="hljs-symbol">:<span class="hljs-string">"v"</span></span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"uint256"</span></span>}],<span class="hljs-string">"payable"</span><span class="hljs-symbol">:false</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"constructor"</span></span>}]


&gt; sample=eth.contract(abi)

<span class="hljs-constant">SampleHEX</span>=<span class="hljs-string">"0x6060604052341561000c57fe5b60405160208061013a833981016040528080519060200190919050505b806000819055505b505b60f9806100416000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633fa4f24514604e57806360fe47b11460715780636d4ce63c14608e575bfe5b3415605557fe5b605b60b1565b6040518082815260200191505060405180910390f35b3415607857fe5b608c600480803590602001909190505060b7565b005b3415609557fe5b609b60c2565b6040518082815260200191505060405180910390f35b60005481565b806000819055505b50565b600060005490505b905600a165627a7a72305820208c8101070c8ba5a9b32db2bf4b8062a9ba50bc2869c39ac2297938756540e80029"</span>
</code></pre> 
  <p>直接把合约地址赋值并进行set操作</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">samplecontract=sample<span class="hljs-preprocessor">.at</span>(<span class="hljs-string">"0x7504fa9d64ab290844b82660d43b310f8fba0276"</span>)

&gt; samplecontract<span class="hljs-preprocessor">.get</span><span class="hljs-preprocessor">.call</span>()

<span class="hljs-number">9</span>
</code></pre> 
  <p>简单的方法来了。智能合约的部署需要编译，这里用在线编译： <br> <a href="https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js" rel="nofollow" target="_blank">https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js</a> <br> 修改编译好的abi和对象名称：</p> 
  <pre class="prettyprint"><code class=" hljs php">这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下：
pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.2</span>;
contract Token {
             address issuer;
             mapping (address =&gt; uint) balances;

             event Issue(address account, uint amount);
             event Transfer(address from, address to,uint amount);

             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Token</span><span class="hljs-params">()</span> {</span>
                 issuer = msg.sender;
             }

             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">issue</span><span class="hljs-params">(address account, uintamount)</span> {</span>
                 <span class="hljs-keyword">if</span> (msg.sender != issuer) <span class="hljs-keyword">throw</span>;
                 balances[account] += amount;
             }

             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transfer</span><span class="hljs-params">(address to, uint amount)</span>{</span>
                 <span class="hljs-keyword">if</span> (balances[msg.sender] &lt; amount)<span class="hljs-keyword">throw</span>;

                 balances[msg.sender] -= amount;
                 balances[to] += amount;

                 Transfer(msg.sender, to, amount);
             }

             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBalance</span><span class="hljs-params">(address account)</span><span class="hljs-title">constant</span> <span class="hljs-title">returns</span> <span class="hljs-params">(uint)</span> {</span>
                 <span class="hljs-keyword">return</span> balances[account];
             }
         }</code></pre> 
  <pre class="prettyprint"><code class=" hljs actionscript">修改编译好的gas和对象名称：
varbrowser_untitled_sol_tokenContract =web3.eth.contract([{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"account"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"amount"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"issue"</span>,<span class="hljs-string">"outputs"</span>:[],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"to"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"amount"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"transfer"</span>,<span class="hljs-string">"outputs"</span>:[],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"constant"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"account"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"getBalance"</span>,<span class="hljs-string">"outputs"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"function"</span>},{<span class="hljs-string">"inputs"</span>:[],<span class="hljs-string">"payable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"constructor"</span>},{<span class="hljs-string">"anonymous"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"indexed"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"account"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"amount"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"Issue"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"event"</span>},{<span class="hljs-string">"anonymous"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"inputs"</span>:[{<span class="hljs-string">"indexed"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"from"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"to"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"address"</span>},{<span class="hljs-string">"indexed"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"amount"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"uint256"</span>}],<span class="hljs-string">"name"</span>:<span class="hljs-string">"Transfer"</span>,<span class="hljs-string">"type"</span>:<span class="hljs-string">"event"</span>}]);
<span class="hljs-keyword">var</span> token =browser_untitled_sol_tokenContract.<span class="hljs-keyword">new</span>(
   {
     from: web3.eth.accounts[<span class="hljs-number">0</span>],
     data:<span class="hljs-string">'0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029'</span>,
     gas: <span class="hljs-string">'4300000'</span>
   }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, contract)</span>{</span>
    console.log(e, contract);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> contract.address !==<span class="hljs-string">'undefined'</span>) {
         console.log(<span class="hljs-string">'Contract mined! address:'</span> + contract.address + <span class="hljs-string">' transactionHash: '</span> + contract.transactionHash);
    }
 })</code></pre> 
  <p>此时输入合约部署的实例a_demotypes, 可以看到a_demotypes的详情。</p> 
  <p><strong>控制台调用</strong></p> 
  <pre class="prettyprint"><code class=" hljs r">&gt; a_demotypes
{
  abi: [{
      constant: false,
      inputs: [{<span class="hljs-keyword">...</span>}],
      name: <span class="hljs-string">"f"</span>,
      outputs: [{<span class="hljs-keyword">...</span>}],
      payable: false,
      type: <span class="hljs-string">"function"</span>
  }],
  address: <span class="hljs-string">"0x54ed7a5f5a63ddada3bfe83b3e632adabaa5fc2f"</span>,
  transactionHash: <span class="hljs-string">"0x69cde62bcd6458e14f40497f4840f422911d63f5dea2b3a9833e6810db64a1c9"</span>,
  allEvents: <span class="hljs-keyword">function</span>(),
  f: <span class="hljs-keyword">function</span>()
}</code></pre> 
  <p>这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。</p> 
  <pre class="prettyprint"><code class=" hljs css">充值
<span class="hljs-tag">token</span><span class="hljs-class">.issue</span><span class="hljs-class">.sendTransaction</span>(<span class="hljs-tag">eth</span><span class="hljs-class">.accounts</span><span class="hljs-attr_selector">[0]</span>,100, <span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">from</span>:<span class="hljs-value"> eth.accounts[<span class="hljs-number">0</span>]</span></span></span>});

发送 <span class="hljs-tag">token</span>
<span class="hljs-tag">token</span><span class="hljs-class">.transfer</span>(<span class="hljs-tag">eth</span><span class="hljs-class">.accounts</span><span class="hljs-attr_selector">[1]</span>, 30, <span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">from</span>:<span class="hljs-value">eth.accounts[<span class="hljs-number">0</span>]</span></span></span>})

查看余额
<span class="hljs-tag">token</span><span class="hljs-class">.getBalance</span>()
控制台调用就不多说，和<span class="hljs-tag">Java</span>对象调用一样，直接调用即可</code></pre> 
  <p><strong>外部接口与智能合约交互</strong> <br> 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 <br> 相关API: <a href="https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction" rel="nofollow" target="_blank">https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction</a> <br> <strong>合约交互的原理</strong> <br> 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 <br> RPC接口给我们提供了俩个方法：<strong>eth_sendTransaction和eth_call。</strong></p> 
  <pre class="prettyprint"><code class=" hljs vbnet">eth_sendTransaction
Createsnew message <span class="hljs-keyword">call</span> transaction <span class="hljs-keyword">or</span> a contract creation, <span class="hljs-keyword">if</span> the data field containscode.
Parameters

<span class="hljs-built_in">Object</span> - The transaction <span class="hljs-built_in">object</span>
<span class="hljs-keyword">from</span>: DATA, <span class="hljs-number">20</span> Bytes - The address the transaction <span class="hljs-keyword">is</span> send <span class="hljs-keyword">from</span>.
<span class="hljs-keyword">to</span>: DATA, <span class="hljs-number">20</span> Bytes - (<span class="hljs-keyword">optional</span> <span class="hljs-keyword">when</span> creating <span class="hljs-keyword">new</span> contract) The address the transaction <span class="hljs-keyword">is</span> directed <span class="hljs-keyword">to</span>.
gas: QUANTITY - (<span class="hljs-keyword">optional</span>, <span class="hljs-keyword">default</span>: <span class="hljs-number">90000</span>) <span class="hljs-built_in">Integer</span> <span class="hljs-keyword">of</span> the gas provided <span class="hljs-keyword">for</span> the transaction execution. It will <span class="hljs-keyword">return</span> unused gas.
gasPrice: QUANTITY - (<span class="hljs-keyword">optional</span>, <span class="hljs-keyword">default</span>: <span class="hljs-keyword">To</span>-Be-Determined) <span class="hljs-built_in">Integer</span> <span class="hljs-keyword">of</span> the gasPrice used <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> paid gas
value: QUANTITY - (<span class="hljs-keyword">optional</span>) <span class="hljs-built_in">Integer</span> <span class="hljs-keyword">of</span> the value send <span class="hljs-keyword">with</span> this transaction
data: DATA - The compiled code <span class="hljs-keyword">of</span> a contract <span class="hljs-keyword">OR</span> the hash <span class="hljs-keyword">of</span> the invoked method signature <span class="hljs-keyword">and</span> encoded parameters. <span class="hljs-keyword">For</span> details see Ethereum Contract ABI
nonce: QUANTITY - (<span class="hljs-keyword">optional</span>) <span class="hljs-built_in">Integer</span> <span class="hljs-keyword">of</span> a nonce. This allows <span class="hljs-keyword">to</span> overwrite your own pending transactions that use the same nonce.</code></pre> 
  <p>可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： <br> Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例：</p> 
  <p><strong>充值issue (address account, uint amount)</strong> <br> 这个方法有俩个参数，address充值账号，uint充值数量。 <br> 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 <br> 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">web3<span class="hljs-preprocessor">.sha</span>3(<span class="hljs-string">"issue(address,uint256)"</span>)
<span class="hljs-string">"0x867904b44b606800f6f10498e11292d04ea19bfc7fe4bc0f1695aa516381f73d"</span></code></pre> 
  <p>我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"> eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>]
<span class="hljs-string">"0x0cc9684af605bae10de801218321c1336bb62946"</span></code></pre> 
  <p>将10转换为16进制为</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver"><span class="hljs-number">000000000000000000000000000000000000000000000000000000000000000</span><span class="hljs-operator">a</span></code></pre> 
  <p>那么data的数据为：</p> 
  <pre class="prettyprint"><code class=" hljs ">0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a</code></pre> 
  <p>那么最后我们调用eth_sendTransaction方法传递参数JSON对象为：</p> 
  <pre class="prettyprint"><code class=" hljs css"><span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">from</span>:<span class="hljs-value"><span class="hljs-number">0</span>xfdf57e81872562a6112656f961944ce821fdf7eb, to:<span class="hljs-number">0</span>x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: <span class="hljs-number">0</span>x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a </span></span></span>}</code></pre> 
  <p>返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 <br> 调用接口方法：</p> 
  <pre class="prettyprint"><code class=" hljs oxygene">JsonRpcHttpClient client = newJsonRpcHttpClient(<span class="hljs-keyword">new</span> URL(“http:<span class="hljs-comment">//127.0.0.1:8545”));</span>
Object <span class="hljs-keyword">result</span> = client.invoke(methodName,<span class="hljs-keyword">params</span>, Object.<span class="hljs-keyword">class</span>);
</code></pre> 
  <p>通过控制台查看第一个账号已有代币：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">token<span class="hljs-preprocessor">.getbalance</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])</code></pre> 
  <p>执行调用接口代码。返回交易hash值：</p> 
  <pre class="prettyprint"><code class=" hljs ">0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095</code></pre> 
  <p>此时控制台输入： <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170810093532350?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRERGRlI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 <br> <strong>eth_call</strong></p> 
  <pre class="prettyprint"><code class=" hljs applescript">Executes anew message call immediately <span class="hljs-keyword">without</span> creating a <span class="hljs-keyword">transaction</span> <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword">the</span> block chain.
Parameters

Object - The <span class="hljs-keyword">transaction</span> call object
<span class="hljs-keyword">from</span>: DATA, <span class="hljs-number">20</span> Bytes - (optional) The address <span class="hljs-keyword">the</span> <span class="hljs-keyword">transaction</span> <span class="hljs-keyword">is</span> sent <span class="hljs-keyword">from</span>.
<span class="hljs-keyword">to</span>: DATA, <span class="hljs-number">20</span> Bytes - The address <span class="hljs-keyword">the</span> <span class="hljs-keyword">transaction</span> <span class="hljs-keyword">is</span> directed <span class="hljs-keyword">to</span>.
gas: QUANTITY - (optional) Integer <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> gas provided <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">transaction</span> execution. eth_call consumes zero gas, <span class="hljs-keyword">but</span> this parameter may be needed <span class="hljs-keyword">by</span> <span class="hljs-keyword">some</span> executions.
gasPrice: QUANTITY - (optional) Integer <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> gasPrice used <span class="hljs-keyword">for</span> each paid gas
value: QUANTITY - (optional) Integer <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> value send <span class="hljs-keyword">with</span> this <span class="hljs-keyword">transaction</span>
data: DATA - (optional) Hash <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> method signature <span class="hljs-keyword">and</span> encoded parameters. For details seeEthereum Contract ABI
QUANTITY|TAG - <span class="hljs-type">integer</span> block <span class="hljs-type">number</span>, <span class="hljs-keyword">or</span> <span class="hljs-keyword">the</span> <span class="hljs-type">string</span> <span class="hljs-string">"latest"</span>, <span class="hljs-string">"earliest"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"pending"</span>, see <span class="hljs-keyword">the</span> default block parameter</code></pre> 
  <p>这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 <br> 查询getBalance(address account) <br> 查询方法hash码：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm"> web3<span class="hljs-preprocessor">.sha</span>3(<span class="hljs-string">"getBalance(address)"</span>)
<span class="hljs-string">"0xf8b2cb4f3943230388faeee074f1503714bff212640051caba01411868d14ae3"</span></code></pre> 
  <p>查询我们上一步充值的账号，那么传递的参数data为：</p> 
  <pre class="prettyprint"><code class=" hljs ">0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb</code></pre> 
  <p>eth_call方法最后参数为：</p> 
  <pre class="prettyprint"><code class=" hljs css"><span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">from</span>:<span class="hljs-value"> <span class="hljs-number">0</span>xfdf57e81872562a6112656f961944ce821fdf7eb, to:<span class="hljs-number">0</span>x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:<span class="hljs-number">0</span>xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb </span></span></span>}</code></pre> 
  <p>注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者”latest”, “earliest” or “pending” <br> 调用接口返回一个16进制字符串： <br> 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。</p> 
  <p>这就是一个智能合约的交互过程。是不是很简单啊。 <br> 参考：<a href="http://blog.csdn.net/super_wu1992/article/details/76919308" rel="nofollow">http://blog.csdn.net/super_wu1992/article/details/76919308</a></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/DDFFR/article/details/76549320,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/DDFFR/article/details/76549320,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

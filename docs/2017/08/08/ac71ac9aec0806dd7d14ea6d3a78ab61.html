<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊私有链创建及智能合约的部署和交互 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊私有链创建及智能合约的部署和交互" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/super_wu1992/article/details/76919308 部署本机私有链 区块链说白了就是一个个块链接起来的一个链表结果，所以要在本机生成一个自己的私有链首先要做的就是自己先创建一个块作为第一个将要生成的区块链的第一个区块（区块链叫做创世块），所以先生成一个json文件genesis.json,内容为创世块的内容（也是每个区块的包含的基本内容）： { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;nonce&quot;:&quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;difficulty&quot;:&quot;0x020000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;mixhash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;timestamp&quot;:&quot;0x00&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;extraData&quot;:&quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;:&quot;0x4c4b40&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;alloc&quot;:{} } 说明： mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。 nonce: nonce就是一个64位随机数，用于挖矿。 difficulty: 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase: 矿工的账号，随便填 timestamp: 设置创世块的时间戳 parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0 extraData: 附加信息，随便填，可以填你的个性信息 gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以可以填最大。 &nbsp; 创世块我们就这样创建好了。然后创建一个data文件夹用来存储区块数据和账号信息。本机创建私有链要确保安装以太坊的客户端https://geth.ethereum.org/downloads/。 这一切准备工作完成后我们就可以开始初始化创世块及启动我们自己的私有链。 初始化创世块 创建脚本start_init.bat： geth --identity &quot;超神链&quot;--datadir &quot;%cd%\data&quot; init genesis.json @pause 说明：identity 区块标示，名称 init 表示初始化区块，后面就是创世块的配置 datadir 表示数据存放的位置 创建私有链启动脚本startup.dat： geth --identity &quot;超神链&quot;--datadir data --networkid 123456 --rpc --rpcaddr=&quot;0.0.0.0&quot;--rpccorsdomain &quot;*&quot; --port &quot;30303&quot; --rpcapi&quot;db,eth,net,web3&quot; --nodiscover console 说明：networkid 表示启动私有链的网络ID，已其他节点相连是网络IP要一致。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpc 开启rpc通信，可进行智能合约部署和调用。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpcaddr 区块链提供了对外RPC接口，默认是localhost，这个设置为可以IP访问。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Rpccorsdomain 表示任何链接都可以连接到此节点。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Port 该节点对外开放端口。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Rpcapi 可以连接的客户端。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; console：启动命令行模式，可以在Geth中执行命令。 其他的一些启动配置： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Bootnodes：设置要连接的节点，后面跟其他节点的信息。如：--bootnodesenode://bfdb56e1091f0a6a443efa5b255a5b085295208621d700528d4db080a56150b28244d2d34b6630deffee5328d20f562e60e6518ff7128832e6a3b9c305ae780b@10.132.97.29:30303console &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 所有前期准备做好以后分布启动初始化及启动脚本。启动成功后会进入ethereum的javascript控制台。如下： 相关命令 创建新账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.newAccount() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 或者 personal.newAccount(&quot;123456&quot;) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看节点信息 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; admin.nodeInfo &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 挖矿 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 开始挖矿 miner.start(1) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 停止挖矿 miner.stop() &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看当前矿工账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.coinbase默认为第一个账户 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 修改矿工账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; miner.setEtherbase(eth.accounts[1]) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看账户信息 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.accounts[0] &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看账户余额 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBalance(eth.accounts[0]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 或者 web3.fromWei(eth.getBalance(eth.accounts[0]),&quot;ether&quot;) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 解锁账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.unlockAccount(eth.accounts[0]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用账户资金前都需要先解锁账号 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 转账eth.sendTransaction({from:eth.accounts[0],to:&quot;0x587e57a516730381958f86703b1f8e970ff445d9&quot;,value:web3.toWei(3,&quot;ether&quot;)}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用 txpool.status 可以看到交易状态 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看区块数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.blockNumber &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getTransaction(&quot;0x0c59f431068937cbe9e230483bc79f59bd7146edc8ff5ec37fea6710adcab825&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBlock(1)通过区块号查看区块 部署智能合约 合约部署需要挖矿才能成功，我们新开一个窗口用与挖矿，新开一个控制台，输入命令：geth attach 连接到控制台，执行miner.start(1),开始挖矿。 这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下： pragma solidity ^0.4.2; contract Token { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; address issuer; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mapping (address =&gt; uint) balances; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Issue(address account, uint amount); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Transfer(address from, address to,uint amount); &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function Token() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; issuer = msg.sender; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function issue(address account, uintamount) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (msg.sender != issuer) throw; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[account] += amount; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function transfer(address to, uint amount){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (balances[msg.sender] &lt; amount)throw; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[msg.sender] -= amount; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[to] += amount; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transfer(msg.sender, to, amount); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function getBalance(address account)constant returns (uint) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return balances[account]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } 智能合约的部署需要编译，这里用在线编译： https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js 修改编译好的gas和对象名称： varbrowser_untitled_sol_tokenContract =web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;issue&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Issue&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var token =browser_untitled_sol_tokenContract.new( &nbsp;&nbsp; { &nbsp;&nbsp;&nbsp;&nbsp; from: web3.eth.accounts[0], &nbsp;&nbsp;&nbsp;&nbsp; data:&#39;0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029&#39;, &nbsp;&nbsp;&nbsp;&nbsp; gas: &#39;4300000&#39; &nbsp;&nbsp; }, function (e, contract){ &nbsp;&nbsp;&nbsp; console.log(e, contract); &nbsp;&nbsp;&nbsp; if (typeof contract.address !==&#39;undefined&#39;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&#39;Contract mined! address:&#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); &nbsp;&nbsp;&nbsp; } &nbsp;}) &nbsp; 将编译好的代码拷贝直接放到控制台即可。如果出现Error: account is locked undefined错误的话, 则使用personal.unlockAccount(eth.accounts[0],&#39;password&#39;)命令将用户解锁。Password为你创建账号的密码。一段时间后geth窗口就会出现Contract mined! address..., 表明合约代码发布成功。 智能合约的调用 合约部署成功后，在控制台可以直接调用。 控制输入token，放回该合约的信息： 这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。 控制台调用 充值 personal.unlockAccount(eth.accounts[0]) token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]}); miner.start(1) miner.stop() 发送 token token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]}) miner.start(1) miner.stop() 查看余额 token.getBalance() 控制台调用就不多说，和java对象调用一样，直接调用即可。 外部接口与智能合约交互 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 相关API: https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction 合约交互的原理 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。 eth_sendTransaction Createsnew message call transaction or a contract creation, if the data field containscode. Parameters Object&nbsp;- The transaction object from:&nbsp;DATA, 20 Bytes - The address the transaction is send from. to:&nbsp;DATA, 20 Bytes - (optional when creating new contract) The address the transaction is directed to. gas:&nbsp;QUANTITY&nbsp;- (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas. gasPrice:&nbsp;QUANTITY&nbsp;- (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas value:&nbsp;QUANTITY&nbsp;- (optional) Integer of the value send with this transaction data:&nbsp;DATA&nbsp;- The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see&nbsp;Ethereum Contract ABI nonce:&nbsp;QUANTITY&nbsp;- (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce. 可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例： 充值issue (address account, uintamount) 这个方法有俩个参数，address充值账号，uint充值数量。 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。 我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。 将10转换为16进制为 000000000000000000000000000000000000000000000000000000000000000a 那么data的数据为： 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a 那么最后我们调用eth_sendTransaction方法传递参数JSON对象为： { &nbsp;&nbsp;&nbsp; from:0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a } 返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 调用接口方法： JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”)); Object result = client.invoke(methodName,params, Object.class); 通过控制台查看第一个账号已有代币： 执行调用接口代码。返回交易hash值： 0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095 此时控制台输入： 说明此交易等待矿工处理。 查看此时交易状态： 发现这个交易中blockNumber还是null，因为此次交易还处于挂起状态，需要生成一个新的区块才能行。 可以看到此次等待交易为1. 现在开启挖矿。生成新的区块后我们停止挖矿，再来看看第一个账号此时的代币金额： 代币增加了10个。 我们再来看下此时的交易状态： 来看下此次的交易详情： 区块数据已经出来了，至此此次充值成功。 交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 eth_call Executes anew message call immediately without creating a transaction on the block chain. Parameters Object&nbsp;- The transaction call object from:&nbsp;DATA, 20 Bytes - (optional) The address the transaction is sent from. to:&nbsp;DATA, 20 Bytes - The address the transaction is directed to. gas:&nbsp;QUANTITY&nbsp;- (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions. gasPrice:&nbsp;QUANTITY&nbsp;- (optional) Integer of the gasPrice used for each paid gas value:&nbsp;QUANTITY&nbsp;- (optional) Integer of the value send with this transaction data:&nbsp;DATA&nbsp;- (optional) Hash of the method signature and encoded parameters. For details seeEthereum Contract ABI QUANTITY|TAG&nbsp;- integer block number, or the string&nbsp;&quot;latest&quot;,&nbsp;&quot;earliest&quot;&nbsp;or&nbsp;&quot;pending&quot;, see the&nbsp;default block parameter 这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 查询getBalance(address account) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询方法hash码： 查询我们上一步充值的账号，那么传递的参数data为： 0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb eth_call方法最后参数为： { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from: 0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb } 注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者&quot;latest&quot;,&nbsp;&quot;earliest&quot;&nbsp;or&nbsp;&quot;pending&quot; 调用接口返回一个16进制字符串： 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。 这就是一个智能合约的交互过程。是不是很简单啊。 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/super_wu1992/article/details/76919308 部署本机私有链 区块链说白了就是一个个块链接起来的一个链表结果，所以要在本机生成一个自己的私有链首先要做的就是自己先创建一个块作为第一个将要生成的区块链的第一个区块（区块链叫做创世块），所以先生成一个json文件genesis.json,内容为创世块的内容（也是每个区块的包含的基本内容）： { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;nonce&quot;:&quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;difficulty&quot;:&quot;0x020000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;mixhash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;timestamp&quot;:&quot;0x00&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;extraData&quot;:&quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;:&quot;0x4c4b40&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;alloc&quot;:{} } 说明： mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。 nonce: nonce就是一个64位随机数，用于挖矿。 difficulty: 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase: 矿工的账号，随便填 timestamp: 设置创世块的时间戳 parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0 extraData: 附加信息，随便填，可以填你的个性信息 gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以可以填最大。 &nbsp; 创世块我们就这样创建好了。然后创建一个data文件夹用来存储区块数据和账号信息。本机创建私有链要确保安装以太坊的客户端https://geth.ethereum.org/downloads/。 这一切准备工作完成后我们就可以开始初始化创世块及启动我们自己的私有链。 初始化创世块 创建脚本start_init.bat： geth --identity &quot;超神链&quot;--datadir &quot;%cd%\data&quot; init genesis.json @pause 说明：identity 区块标示，名称 init 表示初始化区块，后面就是创世块的配置 datadir 表示数据存放的位置 创建私有链启动脚本startup.dat： geth --identity &quot;超神链&quot;--datadir data --networkid 123456 --rpc --rpcaddr=&quot;0.0.0.0&quot;--rpccorsdomain &quot;*&quot; --port &quot;30303&quot; --rpcapi&quot;db,eth,net,web3&quot; --nodiscover console 说明：networkid 表示启动私有链的网络ID，已其他节点相连是网络IP要一致。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpc 开启rpc通信，可进行智能合约部署和调用。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpcaddr 区块链提供了对外RPC接口，默认是localhost，这个设置为可以IP访问。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Rpccorsdomain 表示任何链接都可以连接到此节点。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Port 该节点对外开放端口。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Rpcapi 可以连接的客户端。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; console：启动命令行模式，可以在Geth中执行命令。 其他的一些启动配置： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Bootnodes：设置要连接的节点，后面跟其他节点的信息。如：--bootnodesenode://bfdb56e1091f0a6a443efa5b255a5b085295208621d700528d4db080a56150b28244d2d34b6630deffee5328d20f562e60e6518ff7128832e6a3b9c305ae780b@10.132.97.29:30303console &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 所有前期准备做好以后分布启动初始化及启动脚本。启动成功后会进入ethereum的javascript控制台。如下： 相关命令 创建新账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.newAccount() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 或者 personal.newAccount(&quot;123456&quot;) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看节点信息 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; admin.nodeInfo &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 挖矿 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 开始挖矿 miner.start(1) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 停止挖矿 miner.stop() &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看当前矿工账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.coinbase默认为第一个账户 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 修改矿工账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; miner.setEtherbase(eth.accounts[1]) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看账户信息 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.accounts[0] &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看账户余额 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBalance(eth.accounts[0]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 或者 web3.fromWei(eth.getBalance(eth.accounts[0]),&quot;ether&quot;) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 解锁账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.unlockAccount(eth.accounts[0]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用账户资金前都需要先解锁账号 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 转账eth.sendTransaction({from:eth.accounts[0],to:&quot;0x587e57a516730381958f86703b1f8e970ff445d9&quot;,value:web3.toWei(3,&quot;ether&quot;)}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用 txpool.status 可以看到交易状态 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看区块数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.blockNumber &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getTransaction(&quot;0x0c59f431068937cbe9e230483bc79f59bd7146edc8ff5ec37fea6710adcab825&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBlock(1)通过区块号查看区块 部署智能合约 合约部署需要挖矿才能成功，我们新开一个窗口用与挖矿，新开一个控制台，输入命令：geth attach 连接到控制台，执行miner.start(1),开始挖矿。 这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下： pragma solidity ^0.4.2; contract Token { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; address issuer; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mapping (address =&gt; uint) balances; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Issue(address account, uint amount); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Transfer(address from, address to,uint amount); &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function Token() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; issuer = msg.sender; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function issue(address account, uintamount) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (msg.sender != issuer) throw; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[account] += amount; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function transfer(address to, uint amount){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (balances[msg.sender] &lt; amount)throw; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[msg.sender] -= amount; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[to] += amount; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transfer(msg.sender, to, amount); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function getBalance(address account)constant returns (uint) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return balances[account]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } 智能合约的部署需要编译，这里用在线编译： https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js 修改编译好的gas和对象名称： varbrowser_untitled_sol_tokenContract =web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;issue&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Issue&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var token =browser_untitled_sol_tokenContract.new( &nbsp;&nbsp; { &nbsp;&nbsp;&nbsp;&nbsp; from: web3.eth.accounts[0], &nbsp;&nbsp;&nbsp;&nbsp; data:&#39;0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029&#39;, &nbsp;&nbsp;&nbsp;&nbsp; gas: &#39;4300000&#39; &nbsp;&nbsp; }, function (e, contract){ &nbsp;&nbsp;&nbsp; console.log(e, contract); &nbsp;&nbsp;&nbsp; if (typeof contract.address !==&#39;undefined&#39;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&#39;Contract mined! address:&#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); &nbsp;&nbsp;&nbsp; } &nbsp;}) &nbsp; 将编译好的代码拷贝直接放到控制台即可。如果出现Error: account is locked undefined错误的话, 则使用personal.unlockAccount(eth.accounts[0],&#39;password&#39;)命令将用户解锁。Password为你创建账号的密码。一段时间后geth窗口就会出现Contract mined! address..., 表明合约代码发布成功。 智能合约的调用 合约部署成功后，在控制台可以直接调用。 控制输入token，放回该合约的信息： 这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。 控制台调用 充值 personal.unlockAccount(eth.accounts[0]) token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]}); miner.start(1) miner.stop() 发送 token token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]}) miner.start(1) miner.stop() 查看余额 token.getBalance() 控制台调用就不多说，和java对象调用一样，直接调用即可。 外部接口与智能合约交互 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 相关API: https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction 合约交互的原理 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。 eth_sendTransaction Createsnew message call transaction or a contract creation, if the data field containscode. Parameters Object&nbsp;- The transaction object from:&nbsp;DATA, 20 Bytes - The address the transaction is send from. to:&nbsp;DATA, 20 Bytes - (optional when creating new contract) The address the transaction is directed to. gas:&nbsp;QUANTITY&nbsp;- (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas. gasPrice:&nbsp;QUANTITY&nbsp;- (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas value:&nbsp;QUANTITY&nbsp;- (optional) Integer of the value send with this transaction data:&nbsp;DATA&nbsp;- The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see&nbsp;Ethereum Contract ABI nonce:&nbsp;QUANTITY&nbsp;- (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce. 可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例： 充值issue (address account, uintamount) 这个方法有俩个参数，address充值账号，uint充值数量。 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。 我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。 将10转换为16进制为 000000000000000000000000000000000000000000000000000000000000000a 那么data的数据为： 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a 那么最后我们调用eth_sendTransaction方法传递参数JSON对象为： { &nbsp;&nbsp;&nbsp; from:0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a } 返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 调用接口方法： JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”)); Object result = client.invoke(methodName,params, Object.class); 通过控制台查看第一个账号已有代币： 执行调用接口代码。返回交易hash值： 0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095 此时控制台输入： 说明此交易等待矿工处理。 查看此时交易状态： 发现这个交易中blockNumber还是null，因为此次交易还处于挂起状态，需要生成一个新的区块才能行。 可以看到此次等待交易为1. 现在开启挖矿。生成新的区块后我们停止挖矿，再来看看第一个账号此时的代币金额： 代币增加了10个。 我们再来看下此时的交易状态： 来看下此次的交易详情： 区块数据已经出来了，至此此次充值成功。 交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 eth_call Executes anew message call immediately without creating a transaction on the block chain. Parameters Object&nbsp;- The transaction call object from:&nbsp;DATA, 20 Bytes - (optional) The address the transaction is sent from. to:&nbsp;DATA, 20 Bytes - The address the transaction is directed to. gas:&nbsp;QUANTITY&nbsp;- (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions. gasPrice:&nbsp;QUANTITY&nbsp;- (optional) Integer of the gasPrice used for each paid gas value:&nbsp;QUANTITY&nbsp;- (optional) Integer of the value send with this transaction data:&nbsp;DATA&nbsp;- (optional) Hash of the method signature and encoded parameters. For details seeEthereum Contract ABI QUANTITY|TAG&nbsp;- integer block number, or the string&nbsp;&quot;latest&quot;,&nbsp;&quot;earliest&quot;&nbsp;or&nbsp;&quot;pending&quot;, see the&nbsp;default block parameter 这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 查询getBalance(address account) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询方法hash码： 查询我们上一步充值的账号，那么传递的参数data为： 0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb eth_call方法最后参数为： { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from: 0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb } 注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者&quot;latest&quot;,&nbsp;&quot;earliest&quot;&nbsp;or&nbsp;&quot;pending&quot; 调用接口返回一个16进制字符串： 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。 这就是一个智能合约的交互过程。是不是很简单啊。 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-08-08T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/super_wu1992/article/details/76919308 部署本机私有链 区块链说白了就是一个个块链接起来的一个链表结果，所以要在本机生成一个自己的私有链首先要做的就是自己先创建一个块作为第一个将要生成的区块链的第一个区块（区块链叫做创世块），所以先生成一个json文件genesis.json,内容为创世块的内容（也是每个区块的包含的基本内容）： { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;nonce&quot;:&quot;0x0000000000000042&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;difficulty&quot;:&quot;0x020000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;mixhash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;timestamp&quot;:&quot;0x00&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;extraData&quot;:&quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;gasLimit&quot;:&quot;0x4c4b40&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;alloc&quot;:{} } 说明： mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。 nonce: nonce就是一个64位随机数，用于挖矿。 difficulty: 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度 alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。 coinbase: 矿工的账号，随便填 timestamp: 设置创世块的时间戳 parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0 extraData: 附加信息，随便填，可以填你的个性信息 gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以可以填最大。 &nbsp; 创世块我们就这样创建好了。然后创建一个data文件夹用来存储区块数据和账号信息。本机创建私有链要确保安装以太坊的客户端https://geth.ethereum.org/downloads/。 这一切准备工作完成后我们就可以开始初始化创世块及启动我们自己的私有链。 初始化创世块 创建脚本start_init.bat： geth --identity &quot;超神链&quot;--datadir &quot;%cd%\\data&quot; init genesis.json @pause 说明：identity 区块标示，名称 init 表示初始化区块，后面就是创世块的配置 datadir 表示数据存放的位置 创建私有链启动脚本startup.dat： geth --identity &quot;超神链&quot;--datadir data --networkid 123456 --rpc --rpcaddr=&quot;0.0.0.0&quot;--rpccorsdomain &quot;*&quot; --port &quot;30303&quot; --rpcapi&quot;db,eth,net,web3&quot; --nodiscover console 说明：networkid 表示启动私有链的网络ID，已其他节点相连是网络IP要一致。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpc 开启rpc通信，可进行智能合约部署和调用。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpcaddr 区块链提供了对外RPC接口，默认是localhost，这个设置为可以IP访问。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Rpccorsdomain 表示任何链接都可以连接到此节点。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Port 该节点对外开放端口。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Rpcapi 可以连接的客户端。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; console：启动命令行模式，可以在Geth中执行命令。 其他的一些启动配置： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Bootnodes：设置要连接的节点，后面跟其他节点的信息。如：--bootnodesenode://bfdb56e1091f0a6a443efa5b255a5b085295208621d700528d4db080a56150b28244d2d34b6630deffee5328d20f562e60e6518ff7128832e6a3b9c305ae780b@10.132.97.29:30303console &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 所有前期准备做好以后分布启动初始化及启动脚本。启动成功后会进入ethereum的javascript控制台。如下： 相关命令 创建新账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.newAccount() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 或者 personal.newAccount(&quot;123456&quot;) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看节点信息 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; admin.nodeInfo &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 挖矿 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 开始挖矿 miner.start(1) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 停止挖矿 miner.stop() &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看当前矿工账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.coinbase默认为第一个账户 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 修改矿工账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; miner.setEtherbase(eth.accounts[1]) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看账户信息 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.accounts[0] &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看账户余额 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBalance(eth.accounts[0]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 或者 web3.fromWei(eth.getBalance(eth.accounts[0]),&quot;ether&quot;) &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 解锁账号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.unlockAccount(eth.accounts[0]) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用账户资金前都需要先解锁账号 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 转账eth.sendTransaction({from:eth.accounts[0],to:&quot;0x587e57a516730381958f86703b1f8e970ff445d9&quot;,value:web3.toWei(3,&quot;ether&quot;)}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用 txpool.status 可以看到交易状态 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看区块数据 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.blockNumber &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getTransaction(&quot;0x0c59f431068937cbe9e230483bc79f59bd7146edc8ff5ec37fea6710adcab825&quot;) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBlock(1)通过区块号查看区块 部署智能合约 合约部署需要挖矿才能成功，我们新开一个窗口用与挖矿，新开一个控制台，输入命令：geth attach 连接到控制台，执行miner.start(1),开始挖矿。 这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下： pragma solidity ^0.4.2; contract Token { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; address issuer; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mapping (address =&gt; uint) balances; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Issue(address account, uint amount); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Transfer(address from, address to,uint amount); &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function Token() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; issuer = msg.sender; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function issue(address account, uintamount) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (msg.sender != issuer) throw; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[account] += amount; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function transfer(address to, uint amount){ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (balances[msg.sender] &lt; amount)throw; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[msg.sender] -= amount; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[to] += amount; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transfer(msg.sender, to, amount); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function getBalance(address account)constant returns (uint) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return balances[account]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } 智能合约的部署需要编译，这里用在线编译： https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js 修改编译好的gas和对象名称： varbrowser_untitled_sol_tokenContract =web3.eth.contract([{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;issue&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;account&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Issue&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]); var token =browser_untitled_sol_tokenContract.new( &nbsp;&nbsp; { &nbsp;&nbsp;&nbsp;&nbsp; from: web3.eth.accounts[0], &nbsp;&nbsp;&nbsp;&nbsp; data:&#39;0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029&#39;, &nbsp;&nbsp;&nbsp;&nbsp; gas: &#39;4300000&#39; &nbsp;&nbsp; }, function (e, contract){ &nbsp;&nbsp;&nbsp; console.log(e, contract); &nbsp;&nbsp;&nbsp; if (typeof contract.address !==&#39;undefined&#39;) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log(&#39;Contract mined! address:&#39; + contract.address + &#39; transactionHash: &#39; + contract.transactionHash); &nbsp;&nbsp;&nbsp; } &nbsp;}) &nbsp; 将编译好的代码拷贝直接放到控制台即可。如果出现Error: account is locked undefined错误的话, 则使用personal.unlockAccount(eth.accounts[0],&#39;password&#39;)命令将用户解锁。Password为你创建账号的密码。一段时间后geth窗口就会出现Contract mined! address..., 表明合约代码发布成功。 智能合约的调用 合约部署成功后，在控制台可以直接调用。 控制输入token，放回该合约的信息： 这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。 控制台调用 充值 personal.unlockAccount(eth.accounts[0]) token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]}); miner.start(1) miner.stop() 发送 token token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]}) miner.start(1) miner.stop() 查看余额 token.getBalance() 控制台调用就不多说，和java对象调用一样，直接调用即可。 外部接口与智能合约交互 以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。 相关API: https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction 合约交互的原理 合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。 RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。 eth_sendTransaction Createsnew message call transaction or a contract creation, if the data field containscode. Parameters Object&nbsp;- The transaction object from:&nbsp;DATA, 20 Bytes - The address the transaction is send from. to:&nbsp;DATA, 20 Bytes - (optional when creating new contract) The address the transaction is directed to. gas:&nbsp;QUANTITY&nbsp;- (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas. gasPrice:&nbsp;QUANTITY&nbsp;- (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas value:&nbsp;QUANTITY&nbsp;- (optional) Integer of the value send with this transaction data:&nbsp;DATA&nbsp;- The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see&nbsp;Ethereum Contract ABI nonce:&nbsp;QUANTITY&nbsp;- (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce. 可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下： Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例： 充值issue (address account, uintamount) 这个方法有俩个参数，address充值账号，uint充值数量。 根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。 这里方法名并不是issue (address account, uint amount)而是issue(address,uint256)的sha3值。 我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。 将10转换为16进制为 000000000000000000000000000000000000000000000000000000000000000a 那么data的数据为： 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a 那么最后我们调用eth_sendTransaction方法传递参数JSON对象为： { &nbsp;&nbsp;&nbsp; from:0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a } 返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。 调用接口方法： JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”)); Object result = client.invoke(methodName,params, Object.class); 通过控制台查看第一个账号已有代币： 执行调用接口代码。返回交易hash值： 0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095 此时控制台输入： 说明此交易等待矿工处理。 查看此时交易状态： 发现这个交易中blockNumber还是null，因为此次交易还处于挂起状态，需要生成一个新的区块才能行。 可以看到此次等待交易为1. 现在开启挖矿。生成新的区块后我们停止挖矿，再来看看第一个账号此时的代币金额： 代币增加了10个。 我们再来看下此时的交易状态： 来看下此次的交易详情： 区块数据已经出来了，至此此次充值成功。 交易和充值一样，需要注意的是代币转出账号为from属性的值，代币转入账号为data属性里的值，to对应的是合约地址。 eth_call Executes anew message call immediately without creating a transaction on the block chain. Parameters Object&nbsp;- The transaction call object from:&nbsp;DATA, 20 Bytes - (optional) The address the transaction is sent from. to:&nbsp;DATA, 20 Bytes - The address the transaction is directed to. gas:&nbsp;QUANTITY&nbsp;- (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions. gasPrice:&nbsp;QUANTITY&nbsp;- (optional) Integer of the gasPrice used for each paid gas value:&nbsp;QUANTITY&nbsp;- (optional) Integer of the value send with this transaction data:&nbsp;DATA&nbsp;- (optional) Hash of the method signature and encoded parameters. For details seeEthereum Contract ABI QUANTITY|TAG&nbsp;- integer block number, or the string&nbsp;&quot;latest&quot;,&nbsp;&quot;earliest&quot;&nbsp;or&nbsp;&quot;pending&quot;, see the&nbsp;default block parameter 这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，from,to,data，数据格式都是一样的。 查询getBalance(address account) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询方法hash码： 查询我们上一步充值的账号，那么传递的参数data为： 0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb eth_call方法最后参数为： { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from: 0xfdf57e81872562a6112656f961944ce821fdf7eb, to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3, data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb } 注意，这个方法需要俩参数，处理一个JSONobject外，还有一个字符串参数，这俩可以为“”或者&quot;latest&quot;,&nbsp;&quot;earliest&quot;&nbsp;or&nbsp;&quot;pending&quot; 调用接口返回一个16进制字符串： 0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。 这就是一个智能合约的交互过程。是不是很简单啊。 阅读更多","@type":"BlogPosting","url":"/2017/08/08/ac71ac9aec0806dd7d14ea6d3a78ab61.html","headline":"以太坊私有链创建及智能合约的部署和交互","dateModified":"2017-08-08T00:00:00+08:00","datePublished":"2017-08-08T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/08/08/ac71ac9aec0806dd7d14ea6d3a78ab61.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊私有链创建及智能合约的部署和交互</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/super_wu1992/article/details/76919308 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"> 
 <div class="htmledit_views"> 
  <h1><span style="font-size:18px;">部署本机私有链</span></h1> 
  <p><span style="font-size:18px;">区块链说白了就是一个个块链接起来的一个链表结果，所以要在本机生成一个自己的私有链首先要做的就是自己先创建一个块作为第一个将要生成的区块链的第一个区块（区块链叫做创世块），所以先生成一个json文件genesis.json,内容为创世块的内容（也是每个区块的包含的基本内容）：</span></p> 
  <p><span style="font-size:18px;">{</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "nonce":"0x0000000000000042",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "difficulty":"0x020000",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "mixhash":"0x0000000000000000000000000000000000000000000000000000000000000000",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "coinbase":"0x0000000000000000000000000000000000000000",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "timestamp":"0x00",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "extraData":"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "gasLimit":"0x4c4b40",</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "alloc":{}</span></p> 
  <p><span style="font-size:18px;">}</span></p> 
  <p><span style="font-size:18px;">说明：</span></p> 
  <p><span style="font-size:18px;"><strong>mixhash</strong>：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。</span></p> 
  <p><span style="font-size:18px;"><strong>nonce</strong>: nonce就是一个64位随机数，用于挖矿。</span></p> 
  <p><span style="font-size:18px;"><strong>difficulty</strong>: 设置当前区块的难度，如果难度过大，cpu挖矿就很难，这里设置较小难度</span></p> 
  <p><span style="font-size:18px;"><strong>alloc</strong>: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以我们不需要预置有币的账号，需要的时候自己创建即可以。</span></p> 
  <p><span style="font-size:18px;"><strong>coinbase</strong>: 矿工的账号，随便填</span></p> 
  <p><span style="font-size:18px;"><strong>timestamp</strong>: 设置创世块的时间戳</span></p> 
  <p><span style="font-size:18px;"><strong>parentHash</strong>: 上一个区块的hash值，因为是创世块，所以这个值是0</span></p> 
  <p><span style="font-size:18px;"><strong>extraData</strong>: 附加信息，随便填，可以填你的个性信息</span></p> 
  <p><span style="font-size:18px;"><strong>gasLimit</strong>: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为我们是私有链，所以可以填最大。</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">创世块我们就这样创建好了。然后创建一个data文件夹用来存储区块数据和账号信息。本机创建私有链要确保安装以太坊的客户端<span style="color:rgb(74,74,74);"><a href="https://geth.ethereum.org/downloads/" rel="nofollow">https://geth.ethereum.org/downloads/</a></span><span style="color:rgb(74,74,74);">。</span></span></p> 
  <p><span style="font-size:18px;">这一切准备工作完成后我们就可以开始初始化创世块及启动我们自己的私有链。</span></p> 
  <p><strong><span style="font-size:18px;">初始化创世块</span></strong></p> 
  <p><span style="font-size:18px;">创建脚本start_init.bat：</span></p> 
  <p><span style="font-size:18px;">geth --identity "超神链"--datadir "%cd%\data" init genesis.json</span></p> 
  <p><span style="font-size:18px;">@pause</span></p> 
  <p><span style="font-size:18px;">说明：identity 区块标示，名称</span></p> 
  <p><span style="font-size:18px;">init 表示初始化区块，后面就是创世块的配置</span></p> 
  <p><span style="font-size:18px;">datadir 表示数据存放的位置</span></p> 
  <p><span style="font-size:18px;">创建私有链启动脚本startup.dat：</span></p> 
  <p><span style="font-size:18px;">geth --identity "超神链"--datadir data --networkid 123456 --rpc --rpcaddr="0.0.0.0"--rpccorsdomain "*" --port "30303" --rpcapi"db,eth,net,web3" --nodiscover console</span></p> 
  <p><span style="font-size:18px;">说明：networkid 表示启动私有链的网络ID，已其他节点相连是网络IP要一致。</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpc 开启rpc通信，可进行智能合约部署和调用。</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rpcaddr 区块链提供了对外RPC接口，默认是localhost，这个设置为可以IP访问。</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Rpccorsdomain 表示任何链接都可以连接到此节点。</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Port 该节点对外开放端口。</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Rpcapi 可以连接的客户端。</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; console：启动命令行模式，可以在Geth中执行命令。</span></p> 
  <p><span style="font-size:18px;">其他的一些启动配置：</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; Bootnodes：设置要连接的节点，后面跟其他节点的信息。如：--bootnodes<span style="color:#FF0000;">enode://bfdb56e1091f0a6a443efa5b255a5b085295208621d700528d4db080a56150b28244d2d34b6630deffee5328d20f562e60e6518ff7128832e6a3b9c305ae780b@10.132.97.29:30303</span>console</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 所有前期准备做好以后分布启动初始化及启动脚本。启动成功后会进入ethereum的javascript控制台。如下：</span></p> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808170712110?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p></p> 
  <h1><span style="font-size:18px;">相关命令</span></h1> 
  <p></p> 
  <p align="left"><strong><span style="color:#4A4A4A;"><span style="font-size:18px;">创建新账号</span></span></strong></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.newAccount()</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">或者</span><span style="color:#4A4A4A;"> personal.newAccount("123456")</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">查看节点信息</span></strong></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; admin.nodeInfo</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">挖矿</span></strong></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">开始挖矿</span><span style="color:#4A4A4A;"> miner.start(1)</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">停止挖矿</span><span style="color:#4A4A4A;"> miner.stop()</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">查看当前矿工账号</span></strong></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.coinbase</span><span style="color:#4A4A4A;">默认为第一个账户</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">修改矿工账号</span></strong></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; miner.setEtherbase(eth.accounts[1])</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">查看账户信息</span></strong></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.accounts[0]</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">查看账户余额</span></strong></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBalance(eth.accounts[0])</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">或者</span><span style="color:#4A4A4A;"> web3.fromWei(eth.getBalance(eth.accounts[0]),"ether")</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">解锁账号</span></strong></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; personal.unlockAccount(eth.accounts[0])</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">使用账户资金前都需要先解锁账号</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">转账</span><span style="color:#4A4A4A;">eth.sendTransaction({from:eth.accounts[0],to:"0x587e57a516730381958f86703b1f8e970ff445d9",value:web3.toWei(3,"ether")})</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#4A4A4A;">使用</span><span style="color:#4A4A4A;"> txpool.status </span> <span style="color:#4A4A4A;">可以看到交易状态</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <strong><span style="color:#4A4A4A;">查看区块数据</span></strong></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.blockNumber</span></span></p> 
  <p align="left"><span style="color:#4A4A4A;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getTransaction("0x0c59f431068937cbe9e230483bc79f59bd7146edc8ff5ec37fea6710adcab825")</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#4A4A4A;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eth.getBlock(1)</span><span style="color:#4A4A4A;">通过区块号查看区块</span></span></p> 
  <h1><span style="font-size:18px;">部署智能合约</span></h1> 
  <p><span style="font-size:18px;">合约部署需要挖矿才能成功，我们新开一个窗口用与挖矿，新开一个控制台，输入命令：geth attach 连接到控制台，执行miner.start(1),开始挖矿。</span></p> 
  <p><span style="font-size:18px;">这里在网上找了个代币的只能合约，可以进行充值、转账和查询，issue 函数可以向充值以太到合约账户，transfer 函数可以向其他账号发送token，getBalance 函数可以获取某个账号的token余额，代码如下：</span></p> 
  <p><span style="font-size:18px;">pragma solidity ^0.4.2;</span></p> 
  <p><span style="font-size:18px;">contract Token {</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; address issuer;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mapping (address =&gt; uint) balances;</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Issue(address account, uint amount);</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; event Transfer(address from, address to,uint amount);</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function Token() {</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; issuer = msg.sender;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function issue(address account, uintamount) {</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (msg.sender != issuer) throw;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[account] += amount;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function transfer(address to, uint amount){</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (balances[msg.sender] &lt; amount)throw;</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[msg.sender] -= amount;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; balances[to] += amount;</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Transfer(msg.sender, to, amount);</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</span></p> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; function getBalance(address account)constant returns (uint) {</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return balances[account];</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</span></p> 
  <p><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p> 
  <p><span style="font-size:18px;">智能合约的部署需要编译，这里用在线编译：</span></p> 
  <p><a href="https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js" rel="nofollow"><span style="font-size:18px;">https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.14+commit.c2215d46.js</span></a></p> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808170834787?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p><span style="font-size:18px;"><br></span></p> 
  <p><span style="font-size:18px;">修改编译好的gas和对象名称：</span></p> 
  <div style="background:#F8F8F8;"> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">varbrowser_untitled_sol_tokenContract =web3.eth.contract([{"constant":false,"inputs":[{"name":"account","type":"address"},{"name":"amount","type":"uint256"}],"name":"issue","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"amount","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"account","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"account","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Issue","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Transfer","type":"event"}]);</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">var token =browser_untitled_sol_tokenContract.new(</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp; {</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp; from: web3.eth.accounts[0],</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp; data:'0x6060604052341561000f57600080fd5b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6103d2806100616000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063867904b414610054578063a9059cbb14610096578063f8b2cb4f146100d8575b600080fd5b341561005f57600080fd5b610094600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610125565b005b34156100a157600080fd5b6100d6600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101d2565b005b34156100e357600080fd5b61010f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061035c565b6040518082815260200191505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561018057600080fd5b80600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055505b5050565b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101561021e57600080fd5b80600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055507fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef338383604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390a15b5050565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a723058204afe007a03446d43d13ac892e6dba9d032f540a11ff427d26c22560727cbea2f0029',</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp; gas: '4300000'</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp; }, function (e, contract){</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; console.log(e, contract);</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; if (typeof contract.address !=='undefined') {</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; console.log('Contract mined! address:' + contract.address + ' transactionHash: ' + contract.transactionHash);</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp; }</span></span></strong></p> 
   <p align="left"><strong><span style="color:#333333;"><span style="font-size:18px;">&nbsp;})</span></span></strong></p> 
  </div> 
  <p><span style="font-size:18px;">&nbsp;</span></p> 
  <p><span style="font-size:18px;">将编译好的代码拷贝直接放到控制台即可。如果出现Error: account is locked undefined错误的话, 则使用personal.unlockAccount(eth.accounts[0],'password')命令将用户解锁。Password为你创建账号的密码。一段时间后geth窗口就会出现Contract mined! address..., 表明合约代码发布成功。</span></p> 
  <h1><span style="font-size:18px;">智能合约的调用</span></h1> 
  <p><span style="font-size:18px;">合约部署成功后，在控制台可以直接调用。</span></p> 
  <span style="font-size:18px;">控制输入token，放回该合约的信息：<br></span> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808170958757?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171015324?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p></p> 
  <p><span style="font-size:18px;">这里重点就是address表示的是合约的地址，你会发现这个和账号的信息结果一样，其实你也可以把这个合约地址看做是一个账号地址，后面我们外部调用到的就是这个合约地址。</span></p> 
  <h2><span style="font-size:18px;">控制台调用</span></h2> 
  <p><span style="font-size:18px;">充值</span></p> 
  <p><span style="font-size:18px;">personal.unlockAccount(eth.accounts[0])</span></p> 
  <p><span style="font-size:18px;">token.issue.sendTransaction(eth.accounts[0],100, {from: eth.accounts[0]});</span></p> 
  <p><span style="font-size:18px;">miner.start(1)</span></p> 
  <p><span style="font-size:18px;">miner.stop()</span></p> 
  <p><span style="font-size:18px;">发送 token</span></p> 
  <p><span style="font-size:18px;">token.transfer(eth.accounts[1], 30, {from:eth.accounts[0]})</span></p> 
  <p><span style="font-size:18px;">miner.start(1)</span></p> 
  <p><span style="font-size:18px;">miner.stop()</span></p> 
  <p><span style="font-size:18px;">查看余额</span></p> 
  <p><span style="font-size:18px;">token.getBalance()</span></p> 
  <p><span style="font-size:18px;">控制台调用就不多说，和java对象调用一样，直接调用即可。</span></p> 
  <h2><span style="font-size:18px;">外部接口与智能合约交互</span></h2> 
  <p><span style="font-size:18px;">以太坊对外提供的有很多接口JSON RPC接口，web3接口，这里我们用JSON RPC接口。</span></p> 
  <p><span style="font-size:18px;">相关API: <a href="https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction" rel="nofollow"> https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sendrawtransaction</a></span></p> 
  <p><strong><span style="font-size:18px;">合约交互的原理</span></strong></p> 
  <p><span style="font-size:18px;">合约的交互都是一次交易，而我们要做的就是把要调用的方法和参数按照api规定的以参数的形式向区块请求一次交易，ethereum接收到我们的请求后通过解析传递的参数来执行相关的合约代码。</span></p> 
  <p><span style="font-size:18px;">RPC接口给我们提供了俩个方法：eth_sendTransaction和eth_call。</span></p> 
  <h4><span style="color:#24292E;"><span style="font-size:18px;">eth_sendTransaction</span></span></h4> 
  <p><span style="color:#24292E;"><span style="font-size:18px;">Createsnew message call transaction or a contract creation, if the data field containscode.</span></span></p> 
  <h5><span style="color:#24292E;"><span style="font-size:18px;">Parameters</span></span></h5> 
  <ol start="1" type="1">
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>Object</code>&nbsp;- The transaction object</span></li>
  </ol>
  <ul type="disc">
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>from</code>:&nbsp;<code>DATA</code>, 20 Bytes - The address the transaction is send from.</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>to</code>:&nbsp;<code>DATA</code>, 20 Bytes - (optional when creating new contract) The address the transaction is directed to.</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>gas</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional, default: 90000) Integer of the gas provided for the transaction execution. It will return unused gas.</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>gasPrice</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional, default: To-Be-Determined) Integer of the gasPrice used for each paid gas</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>value</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional) Integer of the value send with this transaction</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>data</code>:&nbsp;<code>DATA</code>&nbsp;- The compiled code of a contract OR the hash of the invoked method signature and encoded parameters. For details see&nbsp;<a href="https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI" rel="nofollow"><span style="color:#0366D6;">Ethereum Contract ABI</span></a></span> </li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>nonce</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional) Integer of a nonce. This allows to overwrite your own pending transactions that use the same nonce.</span></li>
  </ul>
  <p><span style="font-size:18px;">可以看到，如果我们创建的为合约时，我们只需要from,to(文档上写的是可选的，但是实际操作中没有to为null的话合约不能正常执行，建议还是加上，这个值就是前面我们部署合约后生成的合约address),data。Data的属性的值具体可以看Contract ABI。这里大概说下：</span></p> 
  <p><span style="font-size:18px;">Data的值相对来说不是固定的，具体怎么生成与合约的参数类型，参数数量都有关联。这里我们以部署的token合约的三个方法为例：</span></p> 
  <p><span style="font-size:18px;"><strong>充值issue (address account, uintamount)</strong></span></p> 
  <p><span style="font-size:18px;">这个方法有俩个参数，address充值账号，uint充值数量。</span></p> 
  <p><span style="font-size:18px;">根据Contract ABI，data值应该为方法名的sha3的前8个字节+参数的64字节，不够前面补充为0。</span></p> 
  <p><span style="font-size:18px;">这里方法名并不是<strong>issue (address account, uint amount)</strong>而是issue(address,uint256)的sha3值。</span></p> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171153740?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p><span style="font-size:18px;">我们往第一个账号充值10，这里的数据不是以太币，而是我们自己创建的代币。</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171318191?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p><span style="font-size:18px;">将10转换为16进制为</span></p> 
  <p><span style="font-size:18px;">000000000000000000000000000000000000000000000000000000000000000a</span></p> 
  <p><span style="font-size:18px;">那么data的数据为：</span></p> 
  <p><span style="font-size:18px;">0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a</span></p> 
  <p><span style="font-size:18px;">那么最后我们调用eth_sendTransaction方法传递参数JSON对象为：</span></p> 
  <p><span style="font-size:18px;">{<br> &nbsp;&nbsp;&nbsp; from:0xfdf57e81872562a6112656f961944ce821fdf7eb,</span></p> 
  <p><span style="font-size:18px;">to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3,</span></p> 
  <p><span style="font-size:18px;">data: 0x867904b4000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb000000000000000000000000000000000000000000000000000000000000000a</span></p> 
  <p><span style="font-size:18px;">}</span></p> 
  <p><span style="font-size:18px;">返回：此交易的hash值,此时该交易还没有执行，只是创建，还需要矿工通过挖矿才能完成。</span></p> 
  <p><span style="font-size:18px;">调用接口方法：</span></p> 
  <p><span style="font-size:18px;">JsonRpcHttpClient client = newJsonRpcHttpClient(new URL(“http://127.0.0.1:8545”));</span></p> 
  <p><span style="font-size:18px;">Object result = client.invoke(methodName,params, Object.class);</span></p> 
  <p><span style="font-size:18px;">通过控制台查看第一个账号已有代币：</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171427217?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p><span style="font-size:18px;">执行调用接口代码。返回交易hash值：</span></p> 
  <p><span style="font-size:18px;">0x2013764d1c3fea680f9015353497aa5f9f8d61580a3bd0524b3613b34329c095</span></p> 
  <p><span style="font-size:18px;">此时控制台输入：</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171456443?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p><span style="font-size:18px;">说明此交易等待矿工处理。</span></p> 
  <p><span style="font-size:18px;">查看此时交易状态：</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171610103?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p><span style="font-size:18px;">发现这个交易中blockNumber还是null，因为此次交易还处于挂起状态，需要生成一个新的区块才能行。</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171639362?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span> 
  <p><span style="font-size:18px;">可以看到此次等待交易为1.</span></p> 
  <p><span style="font-size:18px;">现在开启挖矿。生成新的区块后我们停止挖矿，再来看看第一个账号此时的代币金额：</span></p> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171723606?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">代币<span style="font-family:'宋体';">增加了</span><span lang="en-us" style="font-family:'Courier New';" xml:lang="en-us">10</span><span style="font-family:'宋体';">个。</span><br></span></p> 
  <p><span style="font-size:18px;">我们再来看下此时的交易状态：</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171809803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p><span style="font-size:18px;">来看下此次的交易详情：</span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171844181?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p><span style="font-size:18px;">区块数据已经出来了，至此此次充值成功。</span></p> 
  <p><span style="font-size:18px;"><span style="color:#FF0000;">交易和充值一样，需要注意的是代币转出账号为</span><span style="color:#FF0000;">from</span><span style="color:#FF0000;">属性的值，代币转入账号为</span><span style="color:#FF0000;">data</span><span style="color:#FF0000;">属性里的值，</span><span style="color:#FF0000;">to</span><span style="color:#FF0000;">对应的是合约地址。</span></span></p> 
  <h4><span style="color:#24292E;"><span style="font-size:18px;">eth_call</span></span></h4> 
  <p><span style="color:#24292E;"><span style="font-size:18px;">Executes anew message call immediately without creating a transaction on the block chain.</span></span></p> 
  <h5><span style="color:#24292E;"><span style="font-size:18px;">Parameters</span></span></h5> 
  <ol start="1" type="1">
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>Object</code>&nbsp;- The transaction call object</span></li>
  </ol>
  <ul type="disc">
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>from</code>:&nbsp;<code>DATA</code>, 20 Bytes - (optional) The address the transaction is sent from.</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>to</code>:&nbsp;<code>DATA</code>, 20 Bytes - The address the transaction is directed to.</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>gas</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional) Integer of the gas provided for the transaction execution. eth_call consumes zero gas, but this parameter may be needed by some executions.</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>gasPrice</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional) Integer of the gasPrice used for each paid gas</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>value</code>:&nbsp;<code>QUANTITY</code>&nbsp;- (optional) Integer of the value send with this transaction</span></li>
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>data</code>:&nbsp;<code>DATA</code>&nbsp;- (optional) Hash of the method signature and encoded parameters. For details see<a href="https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI" rel="nofollow"><span style="color:#0366D6;">Ethereum Contract ABI</span></a></span></li>
  </ul>
  <ol start="2" type="1">
   <li style="color:rgb(36,41,46);"><span style="font-size:18px;"><code>QUANTITY|TAG</code>&nbsp;- integer block number, or the string&nbsp;<code>"latest"</code>,&nbsp;<code>"earliest"</code>&nbsp;or&nbsp;<code>"pending"</code>, see the&nbsp;<a href="https://github.com/ethereum/wiki/wiki/JSON-RPC#the-default-block-parameter" rel="nofollow"><span style="color:#0366D6;">default block parameter</span></a></span></li>
  </ol>
  <p align="left"><span style="font-size:18px;"><code><span style="color:#24292E;">这个方法返回一条信息给我们，相当于数据库的查询功能，参数也是三个，</span></code><code><span style="color:#24292E;">from,to,data</span></code><code><span style="color:#24292E;">，数据格式都是一样的。</span></code></span></p> 
  <p align="left"><strong><span style="font-size:18px;"><span style="color:#24292E;">查询</span><span style="color:#24292E;">getBalance(address account)</span></span></strong></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#24292E;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> <span style="color:#24292E;">查询方法</span><span style="color:#24292E;">hash</span><span style="color:#24292E;">码：</span></span></p> 
  <span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808171944518?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span> 
  <p></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#24292E;">查询我们上一步充值的账号，那么传递的参数</span><span style="color:#24292E;">data</span><span style="color:#24292E;">为：</span></span></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#24292E;">eth_call</span><span style="color:#24292E;">方法最后参数为：</span></span></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">{</span></span></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from: 0xfdf57e81872562a6112656f961944ce821fdf7eb,</span></span></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">to:0x7fe133950fc010ce41322d88f64f1918b9abb3a3,</span></span></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">data:0xf8b2cb4f000000000000000000000000fdf57e81872562a6112656f961944ce821fdf7eb</span></span></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">}</span></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#24292E;">注意，这个方法需要俩参数，处理一个</span><span style="color:#24292E;">JSONobject</span><span style="color:#24292E;">外，还有一个字符串参数，这俩可以为“”或者</span><code><span style="color:#24292E;">"latest"</span></code><span style="color:#24292E;">,&nbsp;</span><code><span style="color:#24292E;">"earliest"</span></code><span style="color:#24292E;">&nbsp;</span><span style="color:#24292E;">or&nbsp;</span><code><span style="color:#24292E;">"pending"</span></code></span></p> 
  <p align="left"><span style="font-size:18px;"><span style="color:#24292E;">调用接口返回一个</span><span style="color:#24292E;">16</span><span style="color:#24292E;">进制字符串：</span></span></p> 
  <span style="font-size:18px;">0x0000000000000000000000000000000000000000000000000000000000000071就是该账号的代币数量，转换为十进制为：113，与控制查询一致。<br></span> 
  <p><span style="font-size:18px;"><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170808172038253?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VwZXJfd3UxOTky/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p></p> 
  <p align="left"><span style="color:#24292E;"><span style="font-size:18px;">这就是一个智能合约的交互过程。是不是很简单啊。</span></span></p> 
  <br> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/super_wu1992/article/details/76919308,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/super_wu1992/article/details/76919308,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>基于MT4平台通过CTP操作期货(一) – 行情-mt4develop的博客(记录外汇(mt4)平台等相关开发经验) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="基于MT4平台通过CTP操作期货(一) – 行情-mt4develop的博客(记录外汇(mt4)平台等相关开发经验)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/MT4Develop/article/details/68115193 通过MT4平台来由ctp接口操作期货，首先需要处理好商品和行情 1.期货商品品种 由于期货商品代号会随着时间变化，且商品品种较多，手动维护商品的话太繁琐。比较简单的处理方式 是做一个服务端的插件，在插件的启动事件 int APIENTRY MtSrvStartup(CServerInterface *server) 去检查并新增商品代号 这里主要用到了MT4接口的这两个个方法，取商品信息和新增商品 int __stdcall SymbolsGet(LPCSTR symbol,ConSymbol *security); int __stdcall SymbolsAdd(ConSymbol *sec); 期货的品种种类是相对固定的，变化的只是月份，所以可以考虑常量定义相关种类，也可以考虑直接从四大期货的网站去爬。 我是直接用常量定义种类，然后根据当前月份计算目前的期货品种。 SymbolDefine Defines[SYMBOL_DEF_COUNT] = { //中国金融期货交易所 CFFEX { &quot;沪深300&quot;, &quot;IF&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月(如当前为3月，则为4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;9}}, { &quot;上证50&quot;, &quot;IH&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月 { &quot;中证500&quot;, &quot;IC&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月 { &quot;5年期国债&quot;, &quot;TF&quot;, 3, 2, {0}, 0},//最近的三个季月（3月、6月、9月、12月中的最近三个月循环）(当前为3月 则为6&quot;,&quot;9&quot;,&quot;12}}, { &quot;10年期国债&quot;, &quot;T&quot;, 3, 2, {0}, 0},//最近的三个季月（3月、6月、9月、12月中的最近三个月循环） //上海期货交易所 SHFE { &quot;铜&quot;, &quot;cu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;铝&quot;, &quot;al&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;锌&quot;, &quot;zn&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;铅&quot;, &quot;pb&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;镍&quot;, &quot;ni&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;锡&quot;, &quot;sn&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;黄金&quot;, &quot;au&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;白银&quot;, &quot;ag&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;螺纹钢&quot;, &quot;rb&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;线材&quot;, &quot;wr&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;热轧卷板&quot;, &quot;hc&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;燃料油&quot;, &quot;fu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;沥青&quot;, &quot;bu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;天然橡胶&quot;, &quot;ru&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, //大连商品交易所 DCE { &quot;玉米&quot;, &quot;c&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;玉米淀粉&quot;, &quot;cs&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;黄大豆1号&quot;, &quot;a&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;黄大豆2号&quot;, &quot;b&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;豆粕&quot;, &quot;m&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11, 12 }, 2}, { &quot;豆油&quot;, &quot;y&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11, 12 }, 2}, { &quot;棕榈油&quot;, &quot;p&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;纤维板&quot;, &quot;fb&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;胶合板&quot;, &quot;bb&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;鸡蛋&quot;, &quot;jd&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚乙烯(塑料}},&quot;, &quot;l&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚氯乙烯(PVC}},&quot;, &quot;v&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚丙烯&quot;, &quot;pp&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;焦炭&quot;, &quot;j&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;焦煤&quot;, &quot;jm&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;铁矿石&quot;, &quot;i&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, //郑州商品交易所 CZCE { &quot;强麦&quot;, &quot;WH&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;普麦&quot;, &quot;PM&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;棉花&quot;, &quot;CF&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;白糖&quot;, &quot;SR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;PTA&quot;, &quot;TA&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;菜籽油&quot;, &quot;OI&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;早籼稻&quot;, &quot;RI&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;甲醇&quot;, &quot;MA&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;玻璃&quot;, &quot;FG&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;菜籽&quot;, &quot;RS&quot;, 0, 0, { 7, 8, 9, 11 }, 3}, { &quot;菜粕&quot;, &quot;RM&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11 }, 3}, { &quot;动力煤&quot;, &quot;ZC&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;粳稻&quot;, &quot;JR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;晚籼稻&quot;, &quot;LR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;硅铁&quot;, &quot;SF&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;锰硅&quot;, &quot;SM&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3} }; 然后通过插件方便的新增所有的期货品种到MT4中 2.行情数据 处理好品种问题，接下来就是行情数据。 行情数据主要是两个事情，一个是用CTP接口取到数据，另一个是把数据写入MT4 1)取CTP的行情数据 只需要用到CTP的行情接口CThostFtdcMdApi // 初始化UserApi pUserApi = CThostFtdcMdApi::CreateFtdcMdApi(); // 创建UserApi CThostFtdcMdSpi* pUserSpi = new CMdSpi(); pUserApi-&gt;RegisterSpi(pUserSpi); // 注册事件类 pUserApi-&gt;RegisterFront(FRONT_ADDR); // connect pUserApi-&gt;Init(); pUserApi-&gt;Join(); // pUserApi-&gt;Release(); 在连接成功后，调用登录并订阅行情即可。 pUserApi-&gt;ReqUserLogin(&amp;req, ++iRequestID); SubscribeMarketData(); SubscribeForQuoteRsp(); CTP都有比较详细的接口说明，相关文档都很健全，这里就不多说了。 2)数据写入MT4 数据写入MT4有两个方式 都可以做到。 一个方式是使用DataFeed接口，做一个行情插件，关于行情插件有在此文(http://blog.csdn.net/mt4develop/article/details/51251465)简单介绍，这里的话，就是在行情插件中去调用CTP接口取报价数据即可。 另一个方式是使用普通插件接口，用接口的扩展事件 int APIENTRY MtSrvTelnet(char *buf, const int maxlen) 此接口可用于 向MT4发送任意自定义的数据，插件在此事件中处理即可。 那么此处可以做一个外部程序调用CTP接口取得数据，然后把数据发给MT4的扩展接口，然后在此事件中调用MT4新增报价的方法即可。 void __stdcall HistoryAddTick(FeedData *tick); 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/MT4Develop/article/details/68115193 通过MT4平台来由ctp接口操作期货，首先需要处理好商品和行情 1.期货商品品种 由于期货商品代号会随着时间变化，且商品品种较多，手动维护商品的话太繁琐。比较简单的处理方式 是做一个服务端的插件，在插件的启动事件 int APIENTRY MtSrvStartup(CServerInterface *server) 去检查并新增商品代号 这里主要用到了MT4接口的这两个个方法，取商品信息和新增商品 int __stdcall SymbolsGet(LPCSTR symbol,ConSymbol *security); int __stdcall SymbolsAdd(ConSymbol *sec); 期货的品种种类是相对固定的，变化的只是月份，所以可以考虑常量定义相关种类，也可以考虑直接从四大期货的网站去爬。 我是直接用常量定义种类，然后根据当前月份计算目前的期货品种。 SymbolDefine Defines[SYMBOL_DEF_COUNT] = { //中国金融期货交易所 CFFEX { &quot;沪深300&quot;, &quot;IF&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月(如当前为3月，则为4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;9}}, { &quot;上证50&quot;, &quot;IH&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月 { &quot;中证500&quot;, &quot;IC&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月 { &quot;5年期国债&quot;, &quot;TF&quot;, 3, 2, {0}, 0},//最近的三个季月（3月、6月、9月、12月中的最近三个月循环）(当前为3月 则为6&quot;,&quot;9&quot;,&quot;12}}, { &quot;10年期国债&quot;, &quot;T&quot;, 3, 2, {0}, 0},//最近的三个季月（3月、6月、9月、12月中的最近三个月循环） //上海期货交易所 SHFE { &quot;铜&quot;, &quot;cu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;铝&quot;, &quot;al&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;锌&quot;, &quot;zn&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;铅&quot;, &quot;pb&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;镍&quot;, &quot;ni&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;锡&quot;, &quot;sn&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;黄金&quot;, &quot;au&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;白银&quot;, &quot;ag&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;螺纹钢&quot;, &quot;rb&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;线材&quot;, &quot;wr&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;热轧卷板&quot;, &quot;hc&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;燃料油&quot;, &quot;fu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;沥青&quot;, &quot;bu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;天然橡胶&quot;, &quot;ru&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, //大连商品交易所 DCE { &quot;玉米&quot;, &quot;c&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;玉米淀粉&quot;, &quot;cs&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;黄大豆1号&quot;, &quot;a&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;黄大豆2号&quot;, &quot;b&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;豆粕&quot;, &quot;m&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11, 12 }, 2}, { &quot;豆油&quot;, &quot;y&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11, 12 }, 2}, { &quot;棕榈油&quot;, &quot;p&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;纤维板&quot;, &quot;fb&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;胶合板&quot;, &quot;bb&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;鸡蛋&quot;, &quot;jd&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚乙烯(塑料}},&quot;, &quot;l&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚氯乙烯(PVC}},&quot;, &quot;v&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚丙烯&quot;, &quot;pp&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;焦炭&quot;, &quot;j&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;焦煤&quot;, &quot;jm&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;铁矿石&quot;, &quot;i&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, //郑州商品交易所 CZCE { &quot;强麦&quot;, &quot;WH&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;普麦&quot;, &quot;PM&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;棉花&quot;, &quot;CF&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;白糖&quot;, &quot;SR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;PTA&quot;, &quot;TA&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;菜籽油&quot;, &quot;OI&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;早籼稻&quot;, &quot;RI&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;甲醇&quot;, &quot;MA&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;玻璃&quot;, &quot;FG&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;菜籽&quot;, &quot;RS&quot;, 0, 0, { 7, 8, 9, 11 }, 3}, { &quot;菜粕&quot;, &quot;RM&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11 }, 3}, { &quot;动力煤&quot;, &quot;ZC&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;粳稻&quot;, &quot;JR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;晚籼稻&quot;, &quot;LR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;硅铁&quot;, &quot;SF&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;锰硅&quot;, &quot;SM&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3} }; 然后通过插件方便的新增所有的期货品种到MT4中 2.行情数据 处理好品种问题，接下来就是行情数据。 行情数据主要是两个事情，一个是用CTP接口取到数据，另一个是把数据写入MT4 1)取CTP的行情数据 只需要用到CTP的行情接口CThostFtdcMdApi // 初始化UserApi pUserApi = CThostFtdcMdApi::CreateFtdcMdApi(); // 创建UserApi CThostFtdcMdSpi* pUserSpi = new CMdSpi(); pUserApi-&gt;RegisterSpi(pUserSpi); // 注册事件类 pUserApi-&gt;RegisterFront(FRONT_ADDR); // connect pUserApi-&gt;Init(); pUserApi-&gt;Join(); // pUserApi-&gt;Release(); 在连接成功后，调用登录并订阅行情即可。 pUserApi-&gt;ReqUserLogin(&amp;req, ++iRequestID); SubscribeMarketData(); SubscribeForQuoteRsp(); CTP都有比较详细的接口说明，相关文档都很健全，这里就不多说了。 2)数据写入MT4 数据写入MT4有两个方式 都可以做到。 一个方式是使用DataFeed接口，做一个行情插件，关于行情插件有在此文(http://blog.csdn.net/mt4develop/article/details/51251465)简单介绍，这里的话，就是在行情插件中去调用CTP接口取报价数据即可。 另一个方式是使用普通插件接口，用接口的扩展事件 int APIENTRY MtSrvTelnet(char *buf, const int maxlen) 此接口可用于 向MT4发送任意自定义的数据，插件在此事件中处理即可。 那么此处可以做一个外部程序调用CTP接口取得数据，然后把数据发给MT4的扩展接口，然后在此事件中调用MT4新增报价的方法即可。 void __stdcall HistoryAddTick(FeedData *tick); 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/03/29/5edcf5b0a02535b99c4aeac04b8d7578.html" />
<meta property="og:url" content="https://mlh.app/2017/03/29/5edcf5b0a02535b99c4aeac04b8d7578.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/MT4Develop/article/details/68115193 通过MT4平台来由ctp接口操作期货，首先需要处理好商品和行情 1.期货商品品种 由于期货商品代号会随着时间变化，且商品品种较多，手动维护商品的话太繁琐。比较简单的处理方式 是做一个服务端的插件，在插件的启动事件 int APIENTRY MtSrvStartup(CServerInterface *server) 去检查并新增商品代号 这里主要用到了MT4接口的这两个个方法，取商品信息和新增商品 int __stdcall SymbolsGet(LPCSTR symbol,ConSymbol *security); int __stdcall SymbolsAdd(ConSymbol *sec); 期货的品种种类是相对固定的，变化的只是月份，所以可以考虑常量定义相关种类，也可以考虑直接从四大期货的网站去爬。 我是直接用常量定义种类，然后根据当前月份计算目前的期货品种。 SymbolDefine Defines[SYMBOL_DEF_COUNT] = { //中国金融期货交易所 CFFEX { &quot;沪深300&quot;, &quot;IF&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月(如当前为3月，则为4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;9}}, { &quot;上证50&quot;, &quot;IH&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月 { &quot;中证500&quot;, &quot;IC&quot;, 1, 1, {0}, 0},//当月、下月及随后两个季月 { &quot;5年期国债&quot;, &quot;TF&quot;, 3, 2, {0}, 0},//最近的三个季月（3月、6月、9月、12月中的最近三个月循环）(当前为3月 则为6&quot;,&quot;9&quot;,&quot;12}}, { &quot;10年期国债&quot;, &quot;T&quot;, 3, 2, {0}, 0},//最近的三个季月（3月、6月、9月、12月中的最近三个月循环） //上海期货交易所 SHFE { &quot;铜&quot;, &quot;cu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;铝&quot;, &quot;al&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;锌&quot;, &quot;zn&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;铅&quot;, &quot;pb&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;镍&quot;, &quot;ni&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;锡&quot;, &quot;sn&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;黄金&quot;, &quot;au&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;白银&quot;, &quot;ag&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;螺纹钢&quot;, &quot;rb&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;线材&quot;, &quot;wr&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;热轧卷板&quot;, &quot;hc&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;燃料油&quot;, &quot;fu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;沥青&quot;, &quot;bu&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, { &quot;天然橡胶&quot;, &quot;ru&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 1}, //大连商品交易所 DCE { &quot;玉米&quot;, &quot;c&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;玉米淀粉&quot;, &quot;cs&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;黄大豆1号&quot;, &quot;a&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;黄大豆2号&quot;, &quot;b&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 2}, { &quot;豆粕&quot;, &quot;m&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11, 12 }, 2}, { &quot;豆油&quot;, &quot;y&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11, 12 }, 2}, { &quot;棕榈油&quot;, &quot;p&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;纤维板&quot;, &quot;fb&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;胶合板&quot;, &quot;bb&quot;, 2, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;鸡蛋&quot;, &quot;jd&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚乙烯(塑料}},&quot;, &quot;l&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚氯乙烯(PVC}},&quot;, &quot;v&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;聚丙烯&quot;, &quot;pp&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;焦炭&quot;, &quot;j&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;焦煤&quot;, &quot;jm&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, { &quot;铁矿石&quot;, &quot;i&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 2}, //郑州商品交易所 CZCE { &quot;强麦&quot;, &quot;WH&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;普麦&quot;, &quot;PM&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;棉花&quot;, &quot;CF&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;白糖&quot;, &quot;SR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;PTA&quot;, &quot;TA&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;菜籽油&quot;, &quot;OI&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;早籼稻&quot;, &quot;RI&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;甲醇&quot;, &quot;MA&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;玻璃&quot;, &quot;FG&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;菜籽&quot;, &quot;RS&quot;, 0, 0, { 7, 8, 9, 11 }, 3}, { &quot;菜粕&quot;, &quot;RM&quot;, 0, 0, { 1, 3, 5, 7, 8, 9, 11 }, 3}, { &quot;动力煤&quot;, &quot;ZC&quot;, 1, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;粳稻&quot;, &quot;JR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;晚籼稻&quot;, &quot;LR&quot;, 0, 0, { 1, 3, 5, 7, 9, 11 }, 3}, { &quot;硅铁&quot;, &quot;SF&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3}, { &quot;锰硅&quot;, &quot;SM&quot;, 0, 0, { 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12 }, 3} }; 然后通过插件方便的新增所有的期货品种到MT4中 2.行情数据 处理好品种问题，接下来就是行情数据。 行情数据主要是两个事情，一个是用CTP接口取到数据，另一个是把数据写入MT4 1)取CTP的行情数据 只需要用到CTP的行情接口CThostFtdcMdApi // 初始化UserApi pUserApi = CThostFtdcMdApi::CreateFtdcMdApi(); // 创建UserApi CThostFtdcMdSpi* pUserSpi = new CMdSpi(); pUserApi-&gt;RegisterSpi(pUserSpi); // 注册事件类 pUserApi-&gt;RegisterFront(FRONT_ADDR); // connect pUserApi-&gt;Init(); pUserApi-&gt;Join(); // pUserApi-&gt;Release(); 在连接成功后，调用登录并订阅行情即可。 pUserApi-&gt;ReqUserLogin(&amp;req, ++iRequestID); SubscribeMarketData(); SubscribeForQuoteRsp(); CTP都有比较详细的接口说明，相关文档都很健全，这里就不多说了。 2)数据写入MT4 数据写入MT4有两个方式 都可以做到。 一个方式是使用DataFeed接口，做一个行情插件，关于行情插件有在此文(http://blog.csdn.net/mt4develop/article/details/51251465)简单介绍，这里的话，就是在行情插件中去调用CTP接口取报价数据即可。 另一个方式是使用普通插件接口，用接口的扩展事件 int APIENTRY MtSrvTelnet(char *buf, const int maxlen) 此接口可用于 向MT4发送任意自定义的数据，插件在此事件中处理即可。 那么此处可以做一个外部程序调用CTP接口取得数据，然后把数据发给MT4的扩展接口，然后在此事件中调用MT4新增报价的方法即可。 void __stdcall HistoryAddTick(FeedData *tick); 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/03/29/5edcf5b0a02535b99c4aeac04b8d7578.html","headline":"基于MT4平台通过CTP操作期货(一) – 行情-mt4develop的博客(记录外汇(mt4)平台等相关开发经验)","dateModified":"2017-03-29T00:00:00+08:00","datePublished":"2017-03-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/03/29/5edcf5b0a02535b99c4aeac04b8d7578.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>基于MT4平台通过CTP操作期货(一) -- 行情-mt4develop的博客(记录外汇(mt4)平台等相关开发经验)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/MT4Develop/article/details/68115193 
 </div> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>通过MT4平台来由ctp接口操作期货，首先需要处理好商品和行情</p> 
  <h1 id="1期货商品品种">1.期货商品品种</h1> 
  <p>由于期货商品代号会随着时间变化，且商品品种较多，手动维护商品的话太繁琐。比较简单的处理方式 <br> 是做一个服务端的插件，在插件的启动事件</p> 
  <pre class="prettyprint"><code class=" hljs axapta"><span class="hljs-keyword">int</span> APIENTRY MtSrvStartup(CServerInterface *<span class="hljs-keyword">server</span>)</code></pre> 
  <p>去检查并新增商品代号 <br> 这里主要用到了MT4接口的这两个个方法，取商品信息和新增商品</p> 
  <pre class="prettyprint"><code class=" hljs perl"><span class="hljs-keyword">int</span>         __stdcall SymbolsGet(LPCSTR symbol,ConSymbol <span class="hljs-variable">*security</span>);
<span class="hljs-keyword">int</span>         __stdcall SymbolsAdd(ConSymbol <span class="hljs-variable">*sec</span>);</code></pre> 
  <p>期货的品种种类是相对固定的，变化的只是月份，所以可以考虑常量定义相关种类，也可以考虑直接从四大期货的网站去爬。 <br> 我是直接用常量定义种类，然后根据当前月份计算目前的期货品种。</p> 
  <pre class="prettyprint"><code class=" hljs cs">SymbolDefine Defines[SYMBOL_DEF_COUNT] = {
    <span class="hljs-comment">//中国金融期货交易所 CFFEX</span>
    { <span class="hljs-string">"沪深300"</span>, <span class="hljs-string">"IF"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, {<span class="hljs-number">0</span>}, <span class="hljs-number">0</span>},<span class="hljs-comment">//当月、下月及随后两个季月(如当前为3月，则为4","5","6","9}},</span>
    { <span class="hljs-string">"上证50"</span>, <span class="hljs-string">"IH"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, {<span class="hljs-number">0</span>}, <span class="hljs-number">0</span>},<span class="hljs-comment">//当月、下月及随后两个季月</span>
    { <span class="hljs-string">"中证500"</span>, <span class="hljs-string">"IC"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, {<span class="hljs-number">0</span>}, <span class="hljs-number">0</span>},<span class="hljs-comment">//当月、下月及随后两个季月</span>
    { <span class="hljs-string">"5年期国债"</span>, <span class="hljs-string">"TF"</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, {<span class="hljs-number">0</span>}, <span class="hljs-number">0</span>},<span class="hljs-comment">//最近的三个季月（3月、6月、9月、12月中的最近三个月循环）(当前为3月 则为6","9","12}},</span>
    { <span class="hljs-string">"10年期国债"</span>, <span class="hljs-string">"T"</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, {<span class="hljs-number">0</span>}, <span class="hljs-number">0</span>},<span class="hljs-comment">//最近的三个季月（3月、6月、9月、12月中的最近三个月循环）</span>
    <span class="hljs-comment">//上海期货交易所 SHFE</span>
    { <span class="hljs-string">"铜"</span>, <span class="hljs-string">"cu"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"铝"</span>, <span class="hljs-string">"al"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"锌"</span>, <span class="hljs-string">"zn"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"铅"</span>, <span class="hljs-string">"pb"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"镍"</span>, <span class="hljs-string">"ni"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"锡"</span>, <span class="hljs-string">"sn"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"黄金"</span>, <span class="hljs-string">"au"</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"白银"</span>, <span class="hljs-string">"ag"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"螺纹钢"</span>, <span class="hljs-string">"rb"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"线材"</span>, <span class="hljs-string">"wr"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"热轧卷板"</span>, <span class="hljs-string">"hc"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"燃料油"</span>, <span class="hljs-string">"fu"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"沥青"</span>, <span class="hljs-string">"bu"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    { <span class="hljs-string">"天然橡胶"</span>, <span class="hljs-string">"ru"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">1</span>},
    <span class="hljs-comment">//大连商品交易所 DCE</span>
    { <span class="hljs-string">"玉米"</span>, <span class="hljs-string">"c"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"玉米淀粉"</span>, <span class="hljs-string">"cs"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"黄大豆1号"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"黄大豆2号"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"豆粕"</span>, <span class="hljs-string">"m"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"豆油"</span>, <span class="hljs-string">"y"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"棕榈油"</span>, <span class="hljs-string">"p"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"纤维板"</span>, <span class="hljs-string">"fb"</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"胶合板"</span>, <span class="hljs-string">"bb"</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"鸡蛋"</span>, <span class="hljs-string">"jd"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"聚乙烯(塑料}},"</span>, <span class="hljs-string">"l"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"聚氯乙烯(PVC}},"</span>, <span class="hljs-string">"v"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"聚丙烯"</span>, <span class="hljs-string">"pp"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"焦炭"</span>, <span class="hljs-string">"j"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"焦煤"</span>, <span class="hljs-string">"jm"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    { <span class="hljs-string">"铁矿石"</span>, <span class="hljs-string">"i"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">2</span>},
    <span class="hljs-comment">//郑州商品交易所 CZCE</span>
    { <span class="hljs-string">"强麦"</span>, <span class="hljs-string">"WH"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"普麦"</span>, <span class="hljs-string">"PM"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"棉花"</span>, <span class="hljs-string">"CF"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"白糖"</span>, <span class="hljs-string">"SR"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"PTA"</span>, <span class="hljs-string">"TA"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"菜籽油"</span>, <span class="hljs-string">"OI"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"早籼稻"</span>, <span class="hljs-string">"RI"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"甲醇"</span>, <span class="hljs-string">"MA"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"玻璃"</span>, <span class="hljs-string">"FG"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"菜籽"</span>, <span class="hljs-string">"RS"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"菜粕"</span>, <span class="hljs-string">"RM"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"动力煤"</span>, <span class="hljs-string">"ZC"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"粳稻"</span>, <span class="hljs-string">"JR"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"晚籼稻"</span>, <span class="hljs-string">"LR"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"硅铁"</span>, <span class="hljs-string">"SF"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">3</span>},
    { <span class="hljs-string">"锰硅"</span>, <span class="hljs-string">"SM"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span> }, <span class="hljs-number">3</span>}
};</code></pre> 
  <p>然后通过插件方便的新增所有的期货品种到MT4中 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170329205259250?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTVQ0RGV2ZWxvcA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170329205342375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTVQ0RGV2ZWxvcA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <h1 id="2行情数据">2.行情数据</h1> 
  <p>处理好品种问题，接下来就是行情数据。 <br> 行情数据主要是两个事情，一个是用CTP接口取到数据，另一个是把数据写入MT4</p> 
  <p><strong>1)取CTP的行情数据</strong></p> 
  <p>只需要用到CTP的行情接口CThostFtdcMdApi </p> 
  <pre class="prettyprint"><code class=" hljs lasso">    <span class="hljs-comment">// 初始化UserApi</span>
    pUserApi <span class="hljs-subst">=</span> CThostFtdcMdApi<span class="hljs-tag">::CreateFtdcMdApi</span>();          <span class="hljs-comment">// 创建UserApi</span>
    CThostFtdcMdSpi<span class="hljs-subst">*</span> pUserSpi <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> CMdSpi();
    pUserApi<span class="hljs-subst">-&gt;</span>RegisterSpi(pUserSpi);                        <span class="hljs-comment">// 注册事件类</span>
    pUserApi<span class="hljs-subst">-&gt;</span>RegisterFront(FRONT_ADDR);                    <span class="hljs-comment">// connect</span>
    pUserApi<span class="hljs-subst">-&gt;</span>Init();

    pUserApi<span class="hljs-subst">-&gt;</span><span class="hljs-keyword">Join</span>();
<span class="hljs-comment">// pUserApi-&gt;Release();</span></code></pre> 
  <p>在连接成功后，调用登录并订阅行情即可。</p> 
  <pre class="prettyprint"><code class=" hljs scss">pUserApi-&gt;<span class="hljs-function">ReqUserLogin(&amp;req, ++iRequestID)</span>;
<span class="hljs-function">SubscribeMarketData()</span>;
<span class="hljs-function">SubscribeForQuoteRsp()</span>;</code></pre> 
  <p>CTP都有比较详细的接口说明，相关文档都很健全，这里就不多说了。</p> 
  <p><strong>2)数据写入MT4</strong> <br> 数据写入MT4有两个方式 都可以做到。 <br> 一个方式是使用DataFeed接口，做一个行情插件，关于行情插件有在此文(<a href="http://blog.csdn.net/mt4develop/article/details/51251465" rel="nofollow">http://blog.csdn.net/mt4develop/article/details/51251465</a>)简单介绍，这里的话，就是在行情插件中去调用CTP接口取报价数据即可。 <br> 另一个方式是使用普通插件接口，用接口的扩展事件</p> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">int</span>   APIENTRY       MtSrvTelnet(<span class="hljs-keyword">char</span> *buf, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> maxlen)</code></pre> 
  <p>此接口可用于 向MT4发送任意自定义的数据，插件在此事件中处理即可。 <br> 那么此处可以做一个外部程序调用CTP接口取得数据，然后把数据发给MT4的扩展接口，然后在此事件中调用MT4新增报价的方法即可。</p> 
  <pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">void</span>        __stdcall HistoryAddTick(FeedData *tick);</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/MT4Develop/article/details/68115193,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/MT4Develop/article/details/68115193,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

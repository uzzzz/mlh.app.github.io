<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日) 系统环境：centos 7 64位 docker docker-compose 不要使用 centos yum 仓库带的 docker，版本过低。 安装docker 官方的repo 里面的版本 $ sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-&#39;EOF&#39; [dockerrepo] name=Docker Repository baseurl=https://yum.dockerproject.org/repo/main/centos/7/ enabled=1 gpgcheck=1 gpgkey=https://yum.dockerproject.org/gpg EOF yum update yum install docker-engine systemctl enable docker systemctl restart docker 一.添加 fabric 用户和设置存放源码的目录 useradd fabric # 建立如下项目目录. mkdir /home/fabric/fabric 二.安装 go 的开发环境和必须的组件 以 root 用户安装 wget https://storage.googleapis.com/golang/go1.8.1.linux-amd64.tar.gz tar -xzvf go1.8.1.linux-amd64.tar.gz mv ./go /usr/local //修改 etc/profile，增加 一下内容 export GOROOT=/usr/local/go export PATH=$PATH:$GOROOT/bin source /etc/profile #安装后,确认 go 1.8 安装成功 go version go version go1.8 darwin/amd64 #如果无法科学上网，使用如下步骤: # 1. 以 root安装 gopm export GOPATH=/usr/local go get -u github.com/gpmgo/gopm #确认在/usr/local/bin 目录下有 gopm # 2. 以 fabric 用户，通过 gopm 安装 goimports export GOPATH=/home/fabric/fabric gopm get -g -d golang.org/x/tools/cmd/goimports #再使用 go install 安装 goimports go install golang.org/x/tools/cmd/goimports #确认在/home/fabric/fabric/bin 目录下有 goimports 以 fabric 用户 安装 gocov GOPATH=/home/fabric/fabric gopm get -g -d golang.org/x/tools/cover gopm get -g -d github.com/axw/gocov/gocov go install github.com/axw/gocov/gocov # 确认 /home/fabric/fabric/bin 目录下有 gocov 安装 gocov-xml GOPATH=/home/fabric/fabric gopm get -g -d github.com/AlekSi/gocov-xml go install github.com/AlekSi/gocov-xml #确认 /home/fabric/fabric/bin 目录下有 gocov-xml 三. 安装其他必须的组件 以 root 用户安装 #centos 下需要安装 yum install -y gcc libtool libltdl-dev libtool-ltdl-devel openssl 四.设置fabric环境变量 vim ~/.bashrc export GOPATH=/home/fabric/fabric # 使得环境变量生效 source ~/.bashrc 五.进入项目目录 cd $GOPATH 六. 建立 go 源码目录结构(一定要建立 src/github.com/hyperledger ，否则无法使用 go 进行编译) cd $GOPATH mkdir -p src/github.com/hyperledger 七.拉取 fabric 的源码 cd $GOPATH/src/github.com/hyperledger git clone https://github.com/hyperledger/fabric.git 八.编译生成 protoc-gen-go #编译生成 protoc-gen-go cd $GOPATH gopm get -g -d github.com/golang/protobuf/protoc-gen-go go install github.com/golang/protobuf/protoc-gen-go #确认在$GOPATH/bin出现protoc-gen-go执行文件 九. 编译 fabric docker 环境 cd $GOPATH/src/github.com/hyperledger/fabric make docker 如果出现 Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock 这个错误。 解决方案： 1. 把 fabric 用户加入到 sudo 组 a. 以 root 用户登录 b. vim /etc/sudoers c. 增加 fabric ALL=(ALL) ALL 一行到root ALL=(ALL) ALL下面 2. sudo usermod -a -G docker $USER 3. newgrp - docker 4. newgrp - groups ${USER} | cut -d&#39; &#39; -f1 参考： https://techoverflow.net/2017/03/01/solving-docker-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket/ 十.如果出现文件或者命令没找到的错误，复制go 的相关文件到 fabric 编译环境 cp $GOPATH/bin/protoc-gen-go $GOPATH/src/github.com/hyperledger/fabric/build/docker/gotools/bin/ cp $GOPATH/bin/gocov $GOPATH/src/github.com/hyperledger/fabric/build/docker/gotools/bin/ 十一.编译 fabric ca 环境 cd /root git clone https://github.com/hyperledger/fabric-ca.git cd fabric-ca make docker 十二. 部署和测试 e2e 应用 一键启动 cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli ./network_setup.sh up mytestchannel A. 生成配置文件 cd $GOPATH/src/github.com/hyperledger/fabric make configtxgen B. 执行后，控制台的输出内容如下: build/bin/configtxgen CGO_CFLAGS=&quot; &quot; GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags &quot;nopkcs11&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgen Binary available as build/bin/configtxgen C. Run the generateCfgTrx.sh shell script cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli ./generateCfgTrx.sh mytestchannel D.控制台输出 [root@fabric e2e_cli]# ./generateCfgTrx.sh mytestchannel Channel name - mytestchannel Building configtxgen build/bin/configtxgen CGO_CFLAGS=&quot; &quot; GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags &quot;nopkcs11&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgen Binary available as build/bin/configtxgen Generating genesis block 2017/04/19 16:14:03 Loading configuration 2017/04/19 16:14:03 Looking for configtx.yaml in: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool 2017/04/19 16:14:03 Found configtx.yaml there 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Generating genesis block 2017/04/19 16:14:03 Writing genesis block Generating channel configuration transaction 2017/04/19 16:14:03 Loading configuration 2017/04/19 16:14:03 Looking for configtx.yaml in: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool 2017/04/19 16:14:03 Found configtx.yaml there 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Generating new channel configtx 2017/04/19 16:14:03 Creating no-op MSP instance 2017/04/19 16:14:03 Obtaining default signing identity 2017/04/19 16:14:03 Creating no-op signing identity instance 2017/04/19 16:14:03 Serialinzing identity 2017/04/19 16:14:03 signing message 2017/04/19 16:14:03 signing message 2017/04/19 16:14:03 Writing new channel tx E.启动 fabric 网络 先把make 出的 image 进行 tag 到 latest docker tag hyperledger/fabric-orderer:x86_64-1.0.0-snapshot-&lt;xxxxxxx&gt; hyperledger/fabric-orderer docker tag hyperledger/fabric-peer:x86_64-1.0.0-snapshot-&lt;xxxxxxx&gt; hyperledger/fabric-peer 然后启动 docker 容器 cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli CHANNEL_NAME=mytestchannel docker-compose up -d 十三.问题的解决 A.在 mac os 下出现如下错误: Error processing tar file(bzip2 data invalid: bad magic value in continuation file): 解决办法 ,更新gnu-tar brew install gnu-tar --with-default-names B. 在 mac os 下出现’ltdl.h’ file not found错误 brew install libtool openssl C. 出现goimports: command not found错误 make linter 出现如下错误： LINT: Running code checks.. Checking ./bccsp ./scripts/golinter.sh: line 22: goimports: command not found make: *** [linter] 错误 127 但是执行$GOPATH/src/github.com/hyperledger/fabric/scripts/golinter.sh 是可以正常执行的 make gotools #如果无法科学上网,需要使用代理 git config --global http.proxy &quot;192.168.0.50:8016&quot; git config --global https.proxy &quot;192.168.0.50:8016&quot; #或者在可以 git 的地方，把 gotools 的源码 git 下来，然后复制到相应目录下 git clone https://go.googlesource.com/tools #当前目录下生成 tools 目录， #把目录复制到$GOPATH/src/github.com/hyperledger/fabric/gotools/build/gopath/src/golang.org/x/目录下。 #重新 make gotools cd $GOPATH/src/github.com/hyperledger/fabric make gotools D. make 过程中出现 IPv4 forwarding is disabled. Networking will not work. 这个警告。 sysctl -w net.ipv4.ip_forward=1 #重启 docker 服务 systemctl restart docker E. 运行 e2e 例子的时候出现如下错误: 1.无法创建 channel vim $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli/docker-compose.yaml #修改 docker-compose.yaml 文件。在 cli 部分增加 host 映射 extra_hosts: - &quot;orderer0:10.211.55.8&quot; - &quot;peer0:10.211.55.8&quot; - &quot;peer1:10.211.55.8&quot; - &quot;peer2:10.211.55.8&quot; - &quot;peer3:10.211.55.8&quot; #修改 script.sh 脚本,进行 peer 的判断，映射端口号： if [ $1 -eq 0 ]; then CORE_PEER_ADDRESS=peer$1:7051 elif [ $1 -eq 1 ]; then ORE_PEER_ADDRESS=peer$1:8051 elif [ $1 -eq 2 ]; then ORE_PEER_ADDRESS=peer$1:9051 elif [ $1 -eq 3 ]; then ORE_PEER_ADDRESS=peer$1:10051 fi F. 相关知识点 1. git 拉取某个特定版本 git reset --hard &lt;commitlevel号&gt; 阅读更多" />
<meta property="og:description" content="git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日) 系统环境：centos 7 64位 docker docker-compose 不要使用 centos yum 仓库带的 docker，版本过低。 安装docker 官方的repo 里面的版本 $ sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-&#39;EOF&#39; [dockerrepo] name=Docker Repository baseurl=https://yum.dockerproject.org/repo/main/centos/7/ enabled=1 gpgcheck=1 gpgkey=https://yum.dockerproject.org/gpg EOF yum update yum install docker-engine systemctl enable docker systemctl restart docker 一.添加 fabric 用户和设置存放源码的目录 useradd fabric # 建立如下项目目录. mkdir /home/fabric/fabric 二.安装 go 的开发环境和必须的组件 以 root 用户安装 wget https://storage.googleapis.com/golang/go1.8.1.linux-amd64.tar.gz tar -xzvf go1.8.1.linux-amd64.tar.gz mv ./go /usr/local //修改 etc/profile，增加 一下内容 export GOROOT=/usr/local/go export PATH=$PATH:$GOROOT/bin source /etc/profile #安装后,确认 go 1.8 安装成功 go version go version go1.8 darwin/amd64 #如果无法科学上网，使用如下步骤: # 1. 以 root安装 gopm export GOPATH=/usr/local go get -u github.com/gpmgo/gopm #确认在/usr/local/bin 目录下有 gopm # 2. 以 fabric 用户，通过 gopm 安装 goimports export GOPATH=/home/fabric/fabric gopm get -g -d golang.org/x/tools/cmd/goimports #再使用 go install 安装 goimports go install golang.org/x/tools/cmd/goimports #确认在/home/fabric/fabric/bin 目录下有 goimports 以 fabric 用户 安装 gocov GOPATH=/home/fabric/fabric gopm get -g -d golang.org/x/tools/cover gopm get -g -d github.com/axw/gocov/gocov go install github.com/axw/gocov/gocov # 确认 /home/fabric/fabric/bin 目录下有 gocov 安装 gocov-xml GOPATH=/home/fabric/fabric gopm get -g -d github.com/AlekSi/gocov-xml go install github.com/AlekSi/gocov-xml #确认 /home/fabric/fabric/bin 目录下有 gocov-xml 三. 安装其他必须的组件 以 root 用户安装 #centos 下需要安装 yum install -y gcc libtool libltdl-dev libtool-ltdl-devel openssl 四.设置fabric环境变量 vim ~/.bashrc export GOPATH=/home/fabric/fabric # 使得环境变量生效 source ~/.bashrc 五.进入项目目录 cd $GOPATH 六. 建立 go 源码目录结构(一定要建立 src/github.com/hyperledger ，否则无法使用 go 进行编译) cd $GOPATH mkdir -p src/github.com/hyperledger 七.拉取 fabric 的源码 cd $GOPATH/src/github.com/hyperledger git clone https://github.com/hyperledger/fabric.git 八.编译生成 protoc-gen-go #编译生成 protoc-gen-go cd $GOPATH gopm get -g -d github.com/golang/protobuf/protoc-gen-go go install github.com/golang/protobuf/protoc-gen-go #确认在$GOPATH/bin出现protoc-gen-go执行文件 九. 编译 fabric docker 环境 cd $GOPATH/src/github.com/hyperledger/fabric make docker 如果出现 Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock 这个错误。 解决方案： 1. 把 fabric 用户加入到 sudo 组 a. 以 root 用户登录 b. vim /etc/sudoers c. 增加 fabric ALL=(ALL) ALL 一行到root ALL=(ALL) ALL下面 2. sudo usermod -a -G docker $USER 3. newgrp - docker 4. newgrp - groups ${USER} | cut -d&#39; &#39; -f1 参考： https://techoverflow.net/2017/03/01/solving-docker-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket/ 十.如果出现文件或者命令没找到的错误，复制go 的相关文件到 fabric 编译环境 cp $GOPATH/bin/protoc-gen-go $GOPATH/src/github.com/hyperledger/fabric/build/docker/gotools/bin/ cp $GOPATH/bin/gocov $GOPATH/src/github.com/hyperledger/fabric/build/docker/gotools/bin/ 十一.编译 fabric ca 环境 cd /root git clone https://github.com/hyperledger/fabric-ca.git cd fabric-ca make docker 十二. 部署和测试 e2e 应用 一键启动 cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli ./network_setup.sh up mytestchannel A. 生成配置文件 cd $GOPATH/src/github.com/hyperledger/fabric make configtxgen B. 执行后，控制台的输出内容如下: build/bin/configtxgen CGO_CFLAGS=&quot; &quot; GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags &quot;nopkcs11&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgen Binary available as build/bin/configtxgen C. Run the generateCfgTrx.sh shell script cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli ./generateCfgTrx.sh mytestchannel D.控制台输出 [root@fabric e2e_cli]# ./generateCfgTrx.sh mytestchannel Channel name - mytestchannel Building configtxgen build/bin/configtxgen CGO_CFLAGS=&quot; &quot; GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags &quot;nopkcs11&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgen Binary available as build/bin/configtxgen Generating genesis block 2017/04/19 16:14:03 Loading configuration 2017/04/19 16:14:03 Looking for configtx.yaml in: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool 2017/04/19 16:14:03 Found configtx.yaml there 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Generating genesis block 2017/04/19 16:14:03 Writing genesis block Generating channel configuration transaction 2017/04/19 16:14:03 Loading configuration 2017/04/19 16:14:03 Looking for configtx.yaml in: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool 2017/04/19 16:14:03 Found configtx.yaml there 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Generating new channel configtx 2017/04/19 16:14:03 Creating no-op MSP instance 2017/04/19 16:14:03 Obtaining default signing identity 2017/04/19 16:14:03 Creating no-op signing identity instance 2017/04/19 16:14:03 Serialinzing identity 2017/04/19 16:14:03 signing message 2017/04/19 16:14:03 signing message 2017/04/19 16:14:03 Writing new channel tx E.启动 fabric 网络 先把make 出的 image 进行 tag 到 latest docker tag hyperledger/fabric-orderer:x86_64-1.0.0-snapshot-&lt;xxxxxxx&gt; hyperledger/fabric-orderer docker tag hyperledger/fabric-peer:x86_64-1.0.0-snapshot-&lt;xxxxxxx&gt; hyperledger/fabric-peer 然后启动 docker 容器 cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli CHANNEL_NAME=mytestchannel docker-compose up -d 十三.问题的解决 A.在 mac os 下出现如下错误: Error processing tar file(bzip2 data invalid: bad magic value in continuation file): 解决办法 ,更新gnu-tar brew install gnu-tar --with-default-names B. 在 mac os 下出现’ltdl.h’ file not found错误 brew install libtool openssl C. 出现goimports: command not found错误 make linter 出现如下错误： LINT: Running code checks.. Checking ./bccsp ./scripts/golinter.sh: line 22: goimports: command not found make: *** [linter] 错误 127 但是执行$GOPATH/src/github.com/hyperledger/fabric/scripts/golinter.sh 是可以正常执行的 make gotools #如果无法科学上网,需要使用代理 git config --global http.proxy &quot;192.168.0.50:8016&quot; git config --global https.proxy &quot;192.168.0.50:8016&quot; #或者在可以 git 的地方，把 gotools 的源码 git 下来，然后复制到相应目录下 git clone https://go.googlesource.com/tools #当前目录下生成 tools 目录， #把目录复制到$GOPATH/src/github.com/hyperledger/fabric/gotools/build/gopath/src/golang.org/x/目录下。 #重新 make gotools cd $GOPATH/src/github.com/hyperledger/fabric make gotools D. make 过程中出现 IPv4 forwarding is disabled. Networking will not work. 这个警告。 sysctl -w net.ipv4.ip_forward=1 #重启 docker 服务 systemctl restart docker E. 运行 e2e 例子的时候出现如下错误: 1.无法创建 channel vim $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli/docker-compose.yaml #修改 docker-compose.yaml 文件。在 cli 部分增加 host 映射 extra_hosts: - &quot;orderer0:10.211.55.8&quot; - &quot;peer0:10.211.55.8&quot; - &quot;peer1:10.211.55.8&quot; - &quot;peer2:10.211.55.8&quot; - &quot;peer3:10.211.55.8&quot; #修改 script.sh 脚本,进行 peer 的判断，映射端口号： if [ $1 -eq 0 ]; then CORE_PEER_ADDRESS=peer$1:7051 elif [ $1 -eq 1 ]; then ORE_PEER_ADDRESS=peer$1:8051 elif [ $1 -eq 2 ]; then ORE_PEER_ADDRESS=peer$1:9051 elif [ $1 -eq 3 ]; then ORE_PEER_ADDRESS=peer$1:10051 fi F. 相关知识点 1. git 拉取某个特定版本 git reset --hard &lt;commitlevel号&gt; 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/06/26/1d88b64fe680250bc45d7efbeac90c00.html" />
<meta property="og:url" content="https://mlh.app/2017/06/26/1d88b64fe680250bc45d7efbeac90c00.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-06-26T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日) 系统环境：centos 7 64位 docker docker-compose 不要使用 centos yum 仓库带的 docker，版本过低。 安装docker 官方的repo 里面的版本 $ sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-&#39;EOF&#39; [dockerrepo] name=Docker Repository baseurl=https://yum.dockerproject.org/repo/main/centos/7/ enabled=1 gpgcheck=1 gpgkey=https://yum.dockerproject.org/gpg EOF yum update yum install docker-engine systemctl enable docker systemctl restart docker 一.添加 fabric 用户和设置存放源码的目录 useradd fabric # 建立如下项目目录. mkdir /home/fabric/fabric 二.安装 go 的开发环境和必须的组件 以 root 用户安装 wget https://storage.googleapis.com/golang/go1.8.1.linux-amd64.tar.gz tar -xzvf go1.8.1.linux-amd64.tar.gz mv ./go /usr/local //修改 etc/profile，增加 一下内容 export GOROOT=/usr/local/go export PATH=$PATH:$GOROOT/bin source /etc/profile #安装后,确认 go 1.8 安装成功 go version go version go1.8 darwin/amd64 #如果无法科学上网，使用如下步骤: # 1. 以 root安装 gopm export GOPATH=/usr/local go get -u github.com/gpmgo/gopm #确认在/usr/local/bin 目录下有 gopm # 2. 以 fabric 用户，通过 gopm 安装 goimports export GOPATH=/home/fabric/fabric gopm get -g -d golang.org/x/tools/cmd/goimports #再使用 go install 安装 goimports go install golang.org/x/tools/cmd/goimports #确认在/home/fabric/fabric/bin 目录下有 goimports 以 fabric 用户 安装 gocov GOPATH=/home/fabric/fabric gopm get -g -d golang.org/x/tools/cover gopm get -g -d github.com/axw/gocov/gocov go install github.com/axw/gocov/gocov # 确认 /home/fabric/fabric/bin 目录下有 gocov 安装 gocov-xml GOPATH=/home/fabric/fabric gopm get -g -d github.com/AlekSi/gocov-xml go install github.com/AlekSi/gocov-xml #确认 /home/fabric/fabric/bin 目录下有 gocov-xml 三. 安装其他必须的组件 以 root 用户安装 #centos 下需要安装 yum install -y gcc libtool libltdl-dev libtool-ltdl-devel openssl 四.设置fabric环境变量 vim ~/.bashrc export GOPATH=/home/fabric/fabric # 使得环境变量生效 source ~/.bashrc 五.进入项目目录 cd $GOPATH 六. 建立 go 源码目录结构(一定要建立 src/github.com/hyperledger ，否则无法使用 go 进行编译) cd $GOPATH mkdir -p src/github.com/hyperledger 七.拉取 fabric 的源码 cd $GOPATH/src/github.com/hyperledger git clone https://github.com/hyperledger/fabric.git 八.编译生成 protoc-gen-go #编译生成 protoc-gen-go cd $GOPATH gopm get -g -d github.com/golang/protobuf/protoc-gen-go go install github.com/golang/protobuf/protoc-gen-go #确认在$GOPATH/bin出现protoc-gen-go执行文件 九. 编译 fabric docker 环境 cd $GOPATH/src/github.com/hyperledger/fabric make docker 如果出现 Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock 这个错误。 解决方案： 1. 把 fabric 用户加入到 sudo 组 a. 以 root 用户登录 b. vim /etc/sudoers c. 增加 fabric ALL=(ALL) ALL 一行到root ALL=(ALL) ALL下面 2. sudo usermod -a -G docker $USER 3. newgrp - docker 4. newgrp - groups ${USER} | cut -d&#39; &#39; -f1 参考： https://techoverflow.net/2017/03/01/solving-docker-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket/ 十.如果出现文件或者命令没找到的错误，复制go 的相关文件到 fabric 编译环境 cp $GOPATH/bin/protoc-gen-go $GOPATH/src/github.com/hyperledger/fabric/build/docker/gotools/bin/ cp $GOPATH/bin/gocov $GOPATH/src/github.com/hyperledger/fabric/build/docker/gotools/bin/ 十一.编译 fabric ca 环境 cd /root git clone https://github.com/hyperledger/fabric-ca.git cd fabric-ca make docker 十二. 部署和测试 e2e 应用 一键启动 cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli ./network_setup.sh up mytestchannel A. 生成配置文件 cd $GOPATH/src/github.com/hyperledger/fabric make configtxgen B. 执行后，控制台的输出内容如下: build/bin/configtxgen CGO_CFLAGS=&quot; &quot; GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags &quot;nopkcs11&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgen Binary available as build/bin/configtxgen C. Run the generateCfgTrx.sh shell script cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli ./generateCfgTrx.sh mytestchannel D.控制台输出 [root@fabric e2e_cli]# ./generateCfgTrx.sh mytestchannel Channel name - mytestchannel Building configtxgen build/bin/configtxgen CGO_CFLAGS=&quot; &quot; GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags &quot;nopkcs11&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/common/configtx/tool/configtxgen Binary available as build/bin/configtxgen Generating genesis block 2017/04/19 16:14:03 Loading configuration 2017/04/19 16:14:03 Looking for configtx.yaml in: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool 2017/04/19 16:14:03 Found configtx.yaml there 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Generating genesis block 2017/04/19 16:14:03 Writing genesis block Generating channel configuration transaction 2017/04/19 16:14:03 Loading configuration 2017/04/19 16:14:03 Looking for configtx.yaml in: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool 2017/04/19 16:14:03 Found configtx.yaml there 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Checking for MSPDir at: . 2017/04/19 16:14:03 Generating new channel configtx 2017/04/19 16:14:03 Creating no-op MSP instance 2017/04/19 16:14:03 Obtaining default signing identity 2017/04/19 16:14:03 Creating no-op signing identity instance 2017/04/19 16:14:03 Serialinzing identity 2017/04/19 16:14:03 signing message 2017/04/19 16:14:03 signing message 2017/04/19 16:14:03 Writing new channel tx E.启动 fabric 网络 先把make 出的 image 进行 tag 到 latest docker tag hyperledger/fabric-orderer:x86_64-1.0.0-snapshot-&lt;xxxxxxx&gt; hyperledger/fabric-orderer docker tag hyperledger/fabric-peer:x86_64-1.0.0-snapshot-&lt;xxxxxxx&gt; hyperledger/fabric-peer 然后启动 docker 容器 cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli CHANNEL_NAME=mytestchannel docker-compose up -d 十三.问题的解决 A.在 mac os 下出现如下错误: Error processing tar file(bzip2 data invalid: bad magic value in continuation file): 解决办法 ,更新gnu-tar brew install gnu-tar --with-default-names B. 在 mac os 下出现’ltdl.h’ file not found错误 brew install libtool openssl C. 出现goimports: command not found错误 make linter 出现如下错误： LINT: Running code checks.. Checking ./bccsp ./scripts/golinter.sh: line 22: goimports: command not found make: *** [linter] 错误 127 但是执行$GOPATH/src/github.com/hyperledger/fabric/scripts/golinter.sh 是可以正常执行的 make gotools #如果无法科学上网,需要使用代理 git config --global http.proxy &quot;192.168.0.50:8016&quot; git config --global https.proxy &quot;192.168.0.50:8016&quot; #或者在可以 git 的地方，把 gotools 的源码 git 下来，然后复制到相应目录下 git clone https://go.googlesource.com/tools #当前目录下生成 tools 目录， #把目录复制到$GOPATH/src/github.com/hyperledger/fabric/gotools/build/gopath/src/golang.org/x/目录下。 #重新 make gotools cd $GOPATH/src/github.com/hyperledger/fabric make gotools D. make 过程中出现 IPv4 forwarding is disabled. Networking will not work. 这个警告。 sysctl -w net.ipv4.ip_forward=1 #重启 docker 服务 systemctl restart docker E. 运行 e2e 例子的时候出现如下错误: 1.无法创建 channel vim $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli/docker-compose.yaml #修改 docker-compose.yaml 文件。在 cli 部分增加 host 映射 extra_hosts: - &quot;orderer0:10.211.55.8&quot; - &quot;peer0:10.211.55.8&quot; - &quot;peer1:10.211.55.8&quot; - &quot;peer2:10.211.55.8&quot; - &quot;peer3:10.211.55.8&quot; #修改 script.sh 脚本,进行 peer 的判断，映射端口号： if [ $1 -eq 0 ]; then CORE_PEER_ADDRESS=peer$1:7051 elif [ $1 -eq 1 ]; then ORE_PEER_ADDRESS=peer$1:8051 elif [ $1 -eq 2 ]; then ORE_PEER_ADDRESS=peer$1:9051 elif [ $1 -eq 3 ]; then ORE_PEER_ADDRESS=peer$1:10051 fi F. 相关知识点 1. git 拉取某个特定版本 git reset --hard &lt;commitlevel号&gt; 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/06/26/1d88b64fe680250bc45d7efbeac90c00.html","headline":"git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日)","dateModified":"2017-06-26T00:00:00+08:00","datePublished":"2017-06-26T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/06/26/1d88b64fe680250bc45d7efbeac90c00.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h1 id="git-fabric-100-官方源码进行编译生成-docker-imagesrc2-版本2017年6月26日">git fabric 1.0.0 官方源码进行编译，生成 docker images(rc2 版本2017年6月26日)</h1> 
  <p>系统环境：centos 7 64位 <br> docker <br> docker-compose</p> 
  <p>不要使用 centos yum 仓库带的 docker，版本过低。 <br> 安装docker 官方的repo 里面的版本</p> 
  <pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-variable">$ </span>sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-<span class="hljs-string">'EOF'</span>
[dockerrepo]
name=<span class="hljs-constant">Docker</span> <span class="hljs-constant">Repository</span>
baseurl=<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/yum.dockerproject.org/repo</span><span class="hljs-regexp">/main/centos</span><span class="hljs-regexp">/7/</span>
enabled=<span class="hljs-number">1</span>
gpgcheck=<span class="hljs-number">1</span>
gpgkey=<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/yum.dockerproject.org/gpg</span>
<span class="hljs-constant">EOF</span>

yum update

yum install docker-engine

systemctl enable docker

systemctl restart docker
</code></pre> 
  <h2 id="一添加-fabric-用户和设置存放源码的目录">一.添加 fabric 用户和设置存放源码的目录</h2> 
  <pre class="prettyprint"><code class=" hljs vala">useradd fabric
<span class="hljs-preprocessor"># 建立如下项目目录.</span>
mkdir /home/fabric/fabric</code></pre> 
  <h2 id="二安装-go-的开发环境和必须的组件">二.安装 go 的开发环境和必须的组件</h2> 
  <p>以 root 用户安装</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">wget https://storage<span class="hljs-preprocessor">.googleapis</span><span class="hljs-preprocessor">.com</span>/golang/go1<span class="hljs-number">.8</span><span class="hljs-number">.1</span><span class="hljs-preprocessor">.linux</span>-amd64<span class="hljs-preprocessor">.tar</span><span class="hljs-preprocessor">.gz</span>

tar -xzvf go1<span class="hljs-number">.8</span><span class="hljs-number">.1</span><span class="hljs-preprocessor">.linux</span>-amd64<span class="hljs-preprocessor">.tar</span><span class="hljs-preprocessor">.gz</span>

mv ./go  /usr/local

//修改 etc/profile，增加 一下内容
export GOROOT=/usr/local/go
export PATH=$PATH:$GOROOT/bin

source /etc/profile</code></pre> 
  <pre class="prettyprint"><code class=" hljs livecodeserver"><span class="hljs-comment">#安装后,确认 go 1.8 安装成功</span>
go <span class="hljs-built_in">version</span>
go <span class="hljs-built_in">version</span> go1<span class="hljs-number">.8</span> darwin/amd64

<span class="hljs-comment">#如果无法科学上网，使用如下步骤:</span>
<span class="hljs-comment"># 1. 以 root安装 gopm</span>
    export GOPATH=/usr/<span class="hljs-built_in">local</span>
    go <span class="hljs-built_in">get</span> -u github.com/gpmgo/gopm
    <span class="hljs-comment">#确认在/usr/local/bin 目录下有 gopm</span>
<span class="hljs-comment"># 2. 以 fabric 用户，通过 gopm 安装 goimports</span>
    export GOPATH=/home/fabric/fabric
    gopm <span class="hljs-built_in">get</span> -g -d golang.org/x/tools/cmd/goimports
    <span class="hljs-comment">#再使用 go install 安装 goimports</span>
    go install golang.org/x/tools/cmd/goimports
    <span class="hljs-comment">#确认在/home/fabric/fabric/bin 目录下有 goimports</span></code></pre> 
  <p>以 fabric 用户 安装 gocov</p> 
  <pre class="prettyprint"><code class=" hljs vala">GOPATH=/home/fabric/fabric
gopm <span class="hljs-keyword">get</span> -g -d golang.org/x/tools/cover
gopm <span class="hljs-keyword">get</span> -g -d github.com/axw/gocov/gocov
go install github.com/axw/gocov/gocov
<span class="hljs-preprocessor"># 确认 /home/fabric/fabric/bin 目录下有 gocov</span></code></pre> 
  <p>安装 gocov-xml</p> 
  <pre class="prettyprint"><code class=" hljs vala">GOPATH=/home/fabric/fabric
gopm <span class="hljs-keyword">get</span> -g -d github.com/AlekSi/gocov-xml
go install github.com/AlekSi/gocov-xml
<span class="hljs-preprocessor">#确认 /home/fabric/fabric/bin 目录下有 gocov-xml</span></code></pre> 
  <h2 id="三-安装其他必须的组件">三. 安装其他必须的组件</h2> 
  <p>以 root 用户安装</p> 
  <pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-variable">#centos</span> 下需要安装
yum install   <span class="hljs-attribute">-y</span> gcc libtool libltdl<span class="hljs-attribute">-dev</span> libtool<span class="hljs-attribute">-ltdl</span><span class="hljs-attribute">-devel</span> openssl
</code></pre> 
  <h2 id="四设置fabric环境变量">四.设置fabric环境变量</h2> 
  <pre class="prettyprint"><code class=" hljs bash">vim ~/.bashrc
<span class="hljs-keyword">export</span> GOPATH=/home/fabric/fabric
<span class="hljs-comment"># 使得环境变量生效</span>
<span class="hljs-built_in">source</span> ~/.bashrc</code></pre> 
  <h2 id="五进入项目目录">五.进入项目目录</h2> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span></code></pre> 
  <h2 id="六-建立-go-源码目录结构一定要建立-srcgithubcomhyperledger-否则无法使用-go-进行编译">六. 建立 go 源码目录结构(一定要建立 src/github.com/hyperledger ，否则无法使用 go 进行编译)</h2> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>
mkdir -p src/github.com/hyperledger</code></pre> 
  <h2 id="七拉取-fabric-的源码">七.拉取 fabric 的源码</h2> 
  <pre class="prettyprint"><code class=" hljs php">cd <span class="hljs-variable">$GOPATH</span>/src/github.com/hyperledger
git <span class="hljs-keyword">clone</span> https:<span class="hljs-comment">//github.com/hyperledger/fabric.git</span></code></pre> 
  <h2 id="八编译生成-protoc-gen-go">八.编译生成 protoc-gen-go</h2> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-comment">#编译生成 protoc-gen-go </span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>
gopm get -g <span class="hljs-operator">-d</span> github.com/golang/protobuf/protoc-gen-go
go install github.com/golang/protobuf/protoc-gen-go
<span class="hljs-comment">#确认在$GOPATH/bin出现protoc-gen-go执行文件</span></code></pre> 
  <h2 id="九-编译-fabric-docker-环境">九. 编译 fabric docker 环境</h2> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>/src/github.com/hyperledger/fabric
make docker</code></pre> 
  <p>如果出现 Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock 这个错误。 <br> 解决方案： <br> 1. 把 fabric 用户加入到 sudo 组 <br> a. 以 root 用户登录 <br> b. vim /etc/sudoers <br> c. 增加 fabric ALL=(ALL) ALL 一行到root ALL=(ALL) ALL下面 <br> 2. sudo usermod -a -G docker $USER <br> 3. newgrp - docker <br> 4. newgrp - <code>groups ${USER} | cut -d' ' -f1</code> <br> 参考： <br> <a href="https://techoverflow.net/2017/03/01/solving-docker-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket/" rel="nofollow" target="_blank">https://techoverflow.net/2017/03/01/solving-docker-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket/</a></p> 
  <h2 id="十如果出现文件或者命令没找到的错误复制go-的相关文件到-fabric-编译环境">十.如果出现文件或者命令没找到的错误，复制go 的相关文件到 fabric 编译环境</h2> 
  <pre class="prettyprint"><code class=" hljs lasso">cp <span class="hljs-variable">$GOPATH</span>/bin/protoc<span class="hljs-attribute">-gen</span><span class="hljs-attribute">-go</span> <span class="hljs-variable">$GOPATH</span>/src/github<span class="hljs-built_in">.</span>com/hyperledger/fabric/build/docker/gotools/bin<span class="hljs-subst">/</span> 

cp <span class="hljs-variable">$GOPATH</span>/bin/gocov <span class="hljs-variable">$GOPATH</span>/src/github<span class="hljs-built_in">.</span>com/hyperledger/fabric/build/docker/gotools/bin<span class="hljs-subst">/</span> </code></pre> 
  <h2 id="十一编译-fabric-ca-环境">十一.编译 fabric ca 环境</h2> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> /root
git clone https://github.com/hyperledger/fabric-ca.git
<span class="hljs-built_in">cd</span> fabric-ca
make docker</code></pre> 
  <h2 id="十二-部署和测试-e2e-应用">十二. 部署和测试 e2e 应用</h2> 
  <p>一键启动 <br> cd $GOPATH/src/github.com/hyperledger/fabric/examples/e2e_cli <br> ./network_setup.sh up mytestchannel</p> 
  <h3 id="a-生成配置文件">A. 生成配置文件</h3> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>/src/github.com/hyperledger/fabric
make configtxgen</code></pre> 
  <h3 id="b-执行后控制台的输出内容如下">B. 执行后，控制台的输出内容如下:</h3> 
  <pre class="prettyprint"><code class=" hljs handlebars"><span class="xml"><span class="hljs-tag"><span class="hljs-attribute">build</span>/<span class="hljs-attribute">bin</span>/<span class="hljs-attribute">configtxgen</span> <span class="hljs-attribute">CGO_CFLAGS</span>=<span class="hljs-value">" "</span> <span class="hljs-attribute">GOBIN</span>=/<span class="hljs-attribute">root</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">src</span>/<span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">build</span>/<span class="hljs-attribute">bin</span> <span class="hljs-attribute">go</span> <span class="hljs-attribute">install</span> <span class="hljs-attribute">-tags</span> "<span class="hljs-attribute">nopkcs11</span>" <span class="hljs-attribute">-ldflags</span> "<span class="hljs-attribute">-X</span> <span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">common</span>/<span class="hljs-attribute">metadata.Version</span>=<span class="hljs-value">1.0.0-snapshot-eba4a20</span> <span class="hljs-attribute">-X</span> <span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">common</span>/<span class="hljs-attribute">metadata.BaseVersion</span>=<span class="hljs-value">0.3.0</span> <span class="hljs-attribute">-X</span> <span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">common</span>/<span class="hljs-attribute">metadata.BaseDockerLabel</span>=<span class="hljs-value">org.hyperledger.fabric</span> <span class="hljs-attribute">-X</span> <span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">common</span>/<span class="hljs-attribute">metadata.DockerNamespace</span>=<span class="hljs-value">hyperledger</span> <span class="hljs-attribute">-X</span> <span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">common</span>/<span class="hljs-attribute">metadata.BaseDockerNamespace</span>=<span class="hljs-value">hyperledger"</span> <span class="hljs-attribute">github.com</span>/<span class="hljs-attribute">hyperledger</span>/<span class="hljs-attribute">fabric</span>/<span class="hljs-attribute">common</span>/<span class="hljs-attribute">configtx</span>/<span class="hljs-attribute">tool</span>/<span class="hljs-attribute">configtxgen</span> <span class="hljs-attribute">Binary</span> <span class="hljs-attribute">available</span> <span class="hljs-attribute">as</span> <span class="hljs-attribute">build</span>/<span class="hljs-attribute">bin</span>/<span class="hljs-attribute">configtxgen</span></span></span></code></pre> 
  <h3 id="c-run-the-generatecfgtrxsh-shell-script">C. Run the generateCfgTrx.sh shell script</h3> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>/src/github.com/hyperledger/fabric/examples/e2e_cli
./generateCfgTrx.sh  mytestchannel</code></pre> 
  <h3 id="d控制台输出">D.控制台输出</h3> 
  <pre class="prettyprint"><code class=" hljs applescript">[root@fabric e2e_cli]<span class="hljs-comment"># ./generateCfgTrx.sh mytestchannel</span>
Channel <span class="hljs-property">name</span> - mytestchannel

Building configtxgen
build/bin/configtxgen
CGO_CFLAGS=<span class="hljs-string">" "</span> GOBIN=/root/fabric/src/github.com/hyperledger/fabric/build/bin go install -tags <span class="hljs-string">"nopkcs11"</span> -ldflags <span class="hljs-string">"-X github.com/hyperledger/fabric/common/metadata.Version=1.0.0-snapshot-eba4a20 -X github.com/hyperledger/fabric/common/metadata.BaseVersion=0.3.0 -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger -X github.com/hyperledger/fabric/common/metadata.BaseDockerNamespace=hyperledger"</span> github.com/hyperledger/fabric/common/configtx/tool/configtxgen
Binary available <span class="hljs-keyword">as</span> build/bin/configtxgen
Generating genesis block
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Loading configuration
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Looking <span class="hljs-keyword">for</span> configtx.yaml <span class="hljs-keyword">in</span>: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Found configtx.yaml there
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Checking <span class="hljs-keyword">for</span> MSPDir <span class="hljs-keyword">at</span>: .
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Checking <span class="hljs-keyword">for</span> MSPDir <span class="hljs-keyword">at</span>: .
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Checking <span class="hljs-keyword">for</span> MSPDir <span class="hljs-keyword">at</span>: .
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Generating genesis block
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Writing genesis block
Generating channel configuration <span class="hljs-keyword">transaction</span>
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Loading configuration
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Looking <span class="hljs-keyword">for</span> configtx.yaml <span class="hljs-keyword">in</span>: /root/fabric/src/github.com/hyperledger/fabric/common/configtx/tool
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Found configtx.yaml there
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Checking <span class="hljs-keyword">for</span> MSPDir <span class="hljs-keyword">at</span>: .
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Checking <span class="hljs-keyword">for</span> MSPDir <span class="hljs-keyword">at</span>: .
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Checking <span class="hljs-keyword">for</span> MSPDir <span class="hljs-keyword">at</span>: .
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Generating new channel configtx
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Creating no-op MSP instance
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Obtaining default signing identity
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Creating no-op signing identity instance
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Serialinzing identity
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> signing message
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> signing message
<span class="hljs-number">2017</span>/<span class="hljs-number">04</span>/<span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> Writing new channel tx</code></pre> 
  <h3 id="e启动-fabric-网络">E.启动 fabric 网络</h3> 
  <p>先把make 出的 image 进行 tag 到 latest</p> 
  <pre class="prettyprint"><code class=" hljs lasso">docker <span class="hljs-built_in">tag</span> hyperledger/fabric<span class="hljs-attribute">-orderer</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span><span class="hljs-attribute">-snapshot</span><span class="hljs-subst">-&lt;</span>xxxxxxx<span class="hljs-subst">&gt;</span> hyperledger/fabric<span class="hljs-attribute">-orderer</span>

docker <span class="hljs-built_in">tag</span> hyperledger/fabric<span class="hljs-attribute">-peer</span>:x86_64<span class="hljs-subst">-</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span><span class="hljs-attribute">-snapshot</span><span class="hljs-subst">-&lt;</span>xxxxxxx<span class="hljs-subst">&gt;</span> hyperledger/fabric<span class="hljs-attribute">-peer</span></code></pre> 
  <p>然后启动 docker 容器</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$GOPATH</span>/src/github.com/hyperledger/fabric/examples/e2e_cli

CHANNEL_NAME=mytestchannel docker-compose up <span class="hljs-operator">-d</span></code></pre> 
  <h2 id="十三问题的解决">十三.问题的解决</h2> 
  <h3 id="a在-mac-os-下出现如下错误">A.在 mac os 下出现如下错误:</h3> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">Error processing tar <span class="hljs-built_in">file</span>(bzip2 data invalid: bad magic <span class="hljs-built_in">value</span> <span class="hljs-operator">in</span> continuation <span class="hljs-built_in">file</span>): </code></pre> 
  <p>解决办法 ,更新gnu-tar</p> 
  <pre class="prettyprint"><code class=" hljs lasso">brew install gnu<span class="hljs-attribute">-tar</span> <span class="hljs-subst">--</span><span class="hljs-keyword">with</span><span class="hljs-attribute">-default</span><span class="hljs-attribute">-names</span></code></pre> 
  <h3 id="b-在-mac-os-下出现ltdlh-file-not-found错误">B. 在 mac os 下出现’ltdl.h’ file not found错误</h3> 
  <pre class="prettyprint"><code class=" hljs cmake">brew <span class="hljs-keyword">install</span> libtool openssl</code></pre> 
  <h3 id="c-出现goimports-command-not-found错误">C. 出现goimports: command not found错误</h3> 
  <p>make linter <br> 出现如下错误：</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">LINT: Running code checks..
Checking ./bccsp
./scripts/golinter.sh: <span class="hljs-built_in">line</span> <span class="hljs-number">22</span>: goimports: <span class="hljs-command"><span class="hljs-keyword">command</span> <span class="hljs-title">not</span> <span class="hljs-title">found</span></span>
make: *** [linter] 错误 <span class="hljs-number">127</span></code></pre> 
  <p>但是执行$GOPATH/src/github.com/hyperledger/fabric/scripts/golinter.sh <br> 是可以正常执行的</p> 
  <pre class="prettyprint"><code class=" hljs vala">make gotools

<span class="hljs-preprocessor">#如果无法科学上网,需要使用代理</span>
git config --global http.proxy <span class="hljs-string">"192.168.0.50:8016"</span>
git config --global https.proxy <span class="hljs-string">"192.168.0.50:8016"</span>

<span class="hljs-preprocessor">#或者在可以 git 的地方，把 gotools 的源码 git 下来，然后复制到相应目录下</span>

git clone https:<span class="hljs-comment">//go.googlesource.com/tools </span>
<span class="hljs-preprocessor">#当前目录下生成 tools 目录，</span>
<span class="hljs-preprocessor">#把目录复制到$GOPATH/src/github.com/hyperledger/fabric/gotools/build/gopath/src/golang.org/x/目录下。</span>
<span class="hljs-preprocessor">#重新 make gotools</span>
cd $GOPATH/src/github.com/hyperledger/fabric
make gotools</code></pre> 
  <h3 id="d-make-过程中出现-ipv4-forwarding-is-disabled-networking-will-not-work-这个警告">D. make 过程中出现 IPv4 forwarding is disabled. Networking will not work. 这个警告。</h3> 
  <pre class="prettyprint"><code class=" hljs avrasm">sysctl -w net<span class="hljs-preprocessor">.ipv</span>4<span class="hljs-preprocessor">.ip</span>_forward=<span class="hljs-number">1</span>
<span class="hljs-preprocessor">#重启 docker 服务</span>
systemctl restart docker</code></pre> 
  <h3 id="e-运行-e2e-例子的时候出现如下错误">E. 运行 e2e 例子的时候出现如下错误:</h3> 
  <h4 id="1无法创建-channel">1.无法创建 channel</h4> 
  <pre class="prettyprint"><code class=" hljs bash">vim  <span class="hljs-variable">$GOPATH</span>/src/github.com/hyperledger/fabric/examples/e2e_cli/docker-compose.yaml

<span class="hljs-comment">#修改 docker-compose.yaml 文件。在 cli 部分增加 host 映射</span>
    extra_hosts:
      - <span class="hljs-string">"orderer0:10.211.55.8"</span>
      - <span class="hljs-string">"peer0:10.211.55.8"</span>
      - <span class="hljs-string">"peer1:10.211.55.8"</span>
      - <span class="hljs-string">"peer2:10.211.55.8"</span>
      - <span class="hljs-string">"peer3:10.211.55.8"</span>

<span class="hljs-comment">#修改 script.sh 脚本,进行 peer 的判断，映射端口号：</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span> ]; <span class="hljs-keyword">then</span>
     CORE_PEER_ADDRESS=peer<span class="hljs-variable">$1</span>:<span class="hljs-number">7051</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$1</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">1</span> ]; <span class="hljs-keyword">then</span>
        ORE_PEER_ADDRESS=peer<span class="hljs-variable">$1</span>:<span class="hljs-number">8051</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$1</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">2</span> ]; <span class="hljs-keyword">then</span>
        ORE_PEER_ADDRESS=peer<span class="hljs-variable">$1</span>:<span class="hljs-number">9051</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$1</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">3</span> ]; <span class="hljs-keyword">then</span>
        ORE_PEER_ADDRESS=peer<span class="hljs-variable">$1</span>:<span class="hljs-number">10051</span>
<span class="hljs-keyword">fi</span></code></pre> 
  <h3 id="f-相关知识点">F. 相关知识点</h3> 
  <h4 id="1-git-拉取某个特定版本">1. git 拉取某个特定版本</h4> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">git</span> <span class="hljs-comment">reset</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">hard</span> &lt;<span class="hljs-comment">commitlevel号</span>&gt;</code></pre> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/remote_roamer/article/details/73733426,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/remote_roamer/article/details/73733426,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊-挣脱数字货币的枷锁 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊-挣脱数字货币的枷锁" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="以太坊-挣脱数字货币的枷锁 在区块链领域，以太坊项目也是十分出名的开源项目。作为公有区块链平台，以太坊将比特币针对数字货币交易的功能进一步进行了拓展，面向更为复杂和灵活的应用场景，支持了智能合约（smart contract）这一重要特性。 从此，区块链技术的应用场景，从单一基于UTXO的数字货币交易，延伸到图灵完备的通用计算领域。用户不再受限于仅能使用比特币脚本所支持的简单逻辑，而是可以自行设计任意复杂的合约逻辑。这就为构建各种多样化的上层应用开启了大门，可谓意义重大。 本章将参照比特币项目来介绍以太坊项目的核心概念和改进设计等内容。 一、以太坊项目简介 以太坊（Ethereum）项目的最初目标是打造一个智能合约的平台（Platform for Smart Contract），该平台支持图灵完备的应用，按照智能合约的约定逻辑自动执行，理想情况下将不存在故障停机、审查、欺诈，以及第三方干预等问题。 以太坊平台目前支持Golang、C++、Python等多种语言实现的客户端。由于其核心实现是基于比特币网络的核心思想进行了拓展，因此在很多设计特性上都与比特币网络十分类似。 基于以太坊项目，以太坊团队目前运营了一个公开的区块链平台——以太坊网络。智能合约开发者使用官方提供的工具和以太坊专用应用开发语言Solidity，可以很容易地开发出运行在以太坊网络上的“去中心化”应用（Decentralized Application，DApp）。这些应用将运行在以太坊的虚拟机（Ethereum Virtual Machine，EVM）里。用户通过以太币（Ether）来购买燃料（Gas），维持所部署应用的运行。 以太坊项目的官网网站为ethereum.org，代码托管在github.com/ethereum。 1.1、以太坊项目简史 与比特币网络自2009年上线的历史相比，以太坊项目要年轻得多。 2013年底，比特币开发团队中有一些开发者开始探讨将比特币网络中的核心技术，主要是区块链技术，拓展到更多应用场景的可能性。以太坊的早期发明者Vitalik Buterin提出应该能运行任意形式（图灵完备）的应用程序，而不仅仅是比特币中受限制的简单脚本。该设计思想并未得到比特币社区的支持，后来作为以太坊白皮书发布。 2014年2月，更多开发者（包括Gavin Wood、Jeffrey Wilcke等）加入以太坊项目，并计划在社区开始以众筹形式募集资金，以开发一个运行智能合约的信任平台。 2014年7月，以太币预售，经过42天，总共筹集到价值超过1800万美元的比特币。随后在瑞士成立以太坊基金会，负责对募集到的资金进行管理和运营；并组建研发团队以开源社区形式进行平台开发。 2015年7月底，以太坊第一阶段Frontier正式发布，标志着以太坊区块链网络的正式上线。这一阶段采用类似比特币网络的PoW共识机制，参与节点以矿工挖矿形式维护网络；支持上传智能合约。Frontier版本实现了计划的基本功能，在运行中测试出了一些安全上的漏洞。这一阶段使用者以开发者居多。 2016年3月，第二阶段Homestead开始运行（区块数1150000），主要改善了安全性，同时开始提供图形界面的客户端，提升了易用性，更多用户加入了进来。 2016年6月，DAO基于以太坊平台进行众筹，受到漏洞攻击，造成价值超过5000万美元的以太币被冻结。社区最后通过硬分叉（Hard Fork）进行解决。 2017年3月，以太坊成立以太坊企业级联盟（Enterprise Ethereum Alliance，EEA），联盟成员主要来自摩根大通，微软，芝加哥大学和部分创业企业等。 目前，以太坊网络支持了接近比特币网络的交易量，成为广受关注的公有链项目。 后续按照计划将发布第三阶段Metropolis和第四阶段Serenity，主要特性包括支持PoS股权证明的共识机制，以降低原先PoW机制造成的能耗浪费；以及图形界面的钱包，以提升易用性。 包括DAO在内，以太坊网络已经经历了数次大的硬分叉，注意每次硬分叉后的版本对之前版本并不兼容。 1.2、主要特点 以太坊区块链底层也是一个类似比特币网络的P2P网络平台，智能合约运行在网络中的以太坊虚拟机里。网络自身是公开可接入的，任何人都可以接入并参与网络中数据的维护，提供运行以太坊虚拟机的资源。 与比特币项目相比，以太坊区块链的技术特点主要包括： 支持图灵完备的智能合约，设计了编程语言Solidity和虚拟机EVM； 选用了内存需求较高的哈希函数，避免出现强算力矿机、矿池攻击； 叔块（uncle block）激励机制，降低矿池的优势，并减少了区块产生间隔（10分钟降低到15秒左右）； 采用账户系统和世界状态，而不是UTXO，容易支持更复杂的逻辑； 通过Gas限制代码执行指令数，避免循环执行攻击； 支持PoW共识算法，并计划支持效率更高的PoS算法。 此外，开发团队还计划通过分片（sharding）方式来解决网络可扩展性问题。 这些技术特点，解决了比特币网络在运行中被人诟病的一些问题，让以太坊网络具备了更大的应用潜力。 二、核心概念 基于比特币网络的核心思想，以太坊项目提出了许多创新的技术概念，包括智能合约、基于账户的交易、以太币和燃料等。 2.1、智能合约 智能合约（Smart Contract）是以太坊中最为重要的一个概念，即以计算机程序的方式来缔结和运行各种合约。最早在上世纪90年代，Nick Szabo等人就提出过类似的概念，但一直因为缺乏可靠执行智能合约的环境，而被当作一种理论设计。区块链技术的出现，恰好补充了这一缺陷。 以太坊支持通过图灵完备的高级语言（包括Solidity、Serpent、Viper）等来开发智能合约。智能合约作为运行在以太坊虚拟机（Ethereum Virual Machine，EVM）中的应用，可以接受来自外部的交易请求和事件，通过触发运行提前编写好的代码逻辑，进一步生成新的交易和事件，可以进一步调用其他智能合约。 智能合约的执行结果可能对以太坊网络上的账本状态进行更新。这些修改由于经过了以太坊网络中的共识，一旦确认后无法被伪造和篡改。 2.2、账户 在之前的章节中，笔者介绍过比特币在设计中并没有账户（Account）的概念，而是采用了UTXO模型记录整个系统的状态。任何人都可以通过交易历史来推算出用户的余额信息。而以太坊则采用了不同的做法，直接用账户来记录系统状态。每个账户存储余额信息、智能合约代码和内部数据存储等。以太坊支持在不同的账户之间转移数据，以实现更为复杂的逻辑。 具体来看，以太坊账户分为两种类型：合约账户（Contracts Accounts）和外部账户（Externally Owned Accounts，或EOA）： 合约账户：存储执行的智能合约代码，只能被外部账户来调用激活； 外部账户：以太币拥有者账户，对应到某公钥。账户包括nonce、balance、storageRoot、codeHash等字段，由个人来控制。 当合约账户被调用时，存储其中的智能合约会在矿工处的虚拟机中自动执行，并消耗一定的燃料。燃料通过外部账户中的以太币进行购买。 2.3、交易 交易（Transaction），在以太坊中是指从一个账户到另一个账户的消息数据。消息数据可以是以太币或者合约执行参数。 以太坊采用交易作为执行操作的最小单位。每个交易包括如下字段： to：目标账户地址； value：可以指定转移的以太币数量； nonce：交易相关的字串； gasPrice：执行交易需要消耗的Gas价格； startgas：交易消耗的最大Gas值； signature：签名信息。 类似于比特币网络，在发送交易时，用户需要缴纳一定的交易费用，通过以太币方式进行支付和消耗。目前，以太坊网络可以支持超过比特币网络的交易速率（可以达到每秒几十笔）。 2.4、以太币 以太币（Ether）是以太坊网络中的货币。 以太币主要用于购买燃料，支付给矿工，以维护以太坊网络运行智能合约的费用。以太币最小单位是wei，一个以太币等于10的18次方个wei。 以太币同样可以通过挖矿来生成，成功生成新区块的以太坊矿工可以获得5个以太币的奖励，以及包含在区块内交易的燃料费用。用户也可以通过交易市场来直接购买以太币。 目前，每年大约可以通过挖矿生成超过一千万个以太币，单个以太币的市场价格超过300美元。 2.5、燃料 燃料（Gas），控制某次交易执行指令的上限。每执行一条合约指令会消耗固定的燃料。当某个交易还未执行结束，而燃料消耗完时，合约执行终止并回滚状态。 Gas可以跟以太币进行兑换。需要注意的是，以太币的价格是波动的，但运行某段智能合约的燃料费用可以是固定的，通过设定Gas价格等进行调节。 三、主要设计 以太坊项目的基本设计与比特币网络类似。为了支持更复杂的智能合约，以太坊在不少地方进行了改进，包括交易模型、共识、对攻击的防护和可扩展性等。 3.1、智能合约相关设计 3.1.1、运行环境 以太坊采用以太坊虚拟机作为智能合约的运行环境。以太坊虚拟机是一个隔离的轻量级虚拟机环境，运行在其中的智能合约代码无法访问本地网络、文件系统或其他进程。 对同一个智能合约来说，往往需要在多个以太坊虚拟机中同时运行多份，以确保整个区块链数据的一致性和高度的容错性。但另一方面，这也限制了整个网络的容量。 3.1.2、开发语言 以太坊为编写智能合约设计了图灵完备的高级编程语言，降低了智能合约开发的难度。目前，Solidity是最常用的以太坊合约编写语言之一。 智能合约编写完毕后，用编译器编译为以太坊虚拟机专用的二进制格式（EVM bytecode），由客户端上传到区块链当中，之后在矿工的以太坊虚拟机中执行。 3.2、交易模型 出于智能合约的便利考虑，以太坊采用了账户的模型，状态可以实时地保存到账户里，而无需像比特币的UXTO模型那样去回溯整个历史。UXTO模型和账户模型的对比如表7-1所示。 表7-1　UXTO模型和账户模型 3.3、共识 以太坊目前采用了基于成熟的PoW共识的变种算法Ethash协议作为共识机制。 为了防止ASIC矿机矿池的算力攻击，跟原始PoW的计算密集型Hash运算不同，Ethash在执行时候需要消耗大量内存，反而跟计算效率关系不大。这意味着很难制造出专门针对Ethash的芯片，即通用机器可能更加有效。 虽然，Ethash对原始的PoW进行了改进，但仍然需要进行大量无效的运算，这也为人们所诟病。 社区已经有计划在未来采用更高效的Proof-of-Stake（PoS）作为共识机制。相对于PoW机制来讲，PoS机制无需消耗大量无用的Hash计算，但其共识过程的复杂度要更高一些，还有待进一步的检验。 3.4、降低攻击 由于以太坊网络中的交易更加多样化，也就更容易受到攻击。 以太坊网络在降低攻击方面的核心设计思想仍然是通过经济激励机制防止少数人作恶： 所有交易都要提供交易费用，避免DDoS攻击； 程序运行指令数通过Gas来限制，所消耗的费用超过设定上限时就会被取消，避免出现恶意合约。 这就确保了攻击者试图消耗网络中虚拟机的计算资源时，需要付出经济代价（支付大量的以太币）；同时难以通过构造恶意的循环或不稳定合约代码来对网络造成破坏。 3.5、提高扩展性 可扩展性是以太坊网络承接更多业务量的最大制约。以太坊项目未来希望通过分片（sharding）机制来提高整个网络的扩展性。分片是一组维护和执行同一批智能合约的节点组成的子网络，是整个网络的子集。 支持分片功能之前，以太坊整个网络中的每个节点都需要处理所有的智能合约，这就造成了网络的最大处理能力会受限于单个节点的处理能力。 分片后，同一片内的合约处理是同步的，彼此达成共识，不同分片之间则可以是异步的，可以提高网络整体的可扩展性。 3.4、相关工具 3.4.1、客户端和开发库 以太坊客户端可用于接入以太坊网络，进行账户管理、交易、挖矿、智能合约等各方面操作。 以太坊社区现在提供了多种语言实现的客户端和开发库，支持标准的JSON-RPC协议。用户可根据自己熟悉的开发语言进行选择： go-ethereum：Go语言实现； Parity：Rust语言实现； cpp-ethereum：C++语言实现； ethereumjs-lib：javascript语言实现； Ethereum（J）：Java语言实现； ethereumH：Haskell语言实现； pyethapp：Python语言实现； ruby-ethereum：Ruby语言实现。 上述实现中，go-ethereum的独立客户端Geth是最常用的以太坊客户端之一。用户可通过安装Geth来接入以太坊网络并成为一个完整节点。Geth也可作为一个HTTP-RPC服务器，对外暴露JSON-RPC接口，供用户与以太坊网络交互。Geth的使用需要基本的命令行基础，其功能相对完整，源码托管于github.com/ethereum/go-ethereum。 3.4.2、以太坊钱包 对于只需进行账户管理、以太坊转账、DApp使用等基本操作的用户，则可选择直观易用的钱包客户端。 Mist是官方提供的一套包含图形界面的钱包客户端，除了可用于进行交易，也支持直接编写和部署智能合约，如图7-1所示。 图7-1　Mist浏览器 所编写的代码编译发布后，可以部署到区块链上。使用者可通过发送调用相应合约方法的交易来执行智能合约。 3.4.3、IDE 对于开发者，以太坊社区涌现出了许多服务于编写智能合约和DApp的IDE，例如： Truffle：功能丰富的以太坊应用开发环境； Embark：DApp开发框架，支持集成以太坊、IPFS等； Remix：用于编写Solidity的IDE，内置调试器和测试环境。 3.4.4、网站资源 已有一些网站提供对以太坊网络的数据、运行在以太坊上的DApp等信息进行查看，例如： ethstats.net：实时查看网络的信息，如区块、价格、交易数等； ethernodes.org：显示整个网络的历史统计信息，如客户端的分布情况等； dapps.ethercasts.com：查看运行在以太坊上的DApp的信息，包括简介、所处阶段和状态等。 四、小结 以太坊项目将区块链技术在数字货币的基础上进行了延伸，提出了打造更为通用的智能合约平台的宏大构想，并基于开源技术构建了以太坊为核心的开源生态系统。 本章内容介绍了以太坊的相关知识，包括核心概念、设计、工具等。 比照比特币项目，可以掌握以太坊的相关改进设计，并学习智能合约的编写。实际上，智能合约并不是一个新兴概念，但区块链技术的出现为智能合约的“代码即律法”提供提供了信任基础和实施架构。通过引入智能合约，区块链技术释放了支持更多应用领域的巨大潜力。 摘自：区块链原理、设计与应用 阅读更多" />
<meta property="og:description" content="以太坊-挣脱数字货币的枷锁 在区块链领域，以太坊项目也是十分出名的开源项目。作为公有区块链平台，以太坊将比特币针对数字货币交易的功能进一步进行了拓展，面向更为复杂和灵活的应用场景，支持了智能合约（smart contract）这一重要特性。 从此，区块链技术的应用场景，从单一基于UTXO的数字货币交易，延伸到图灵完备的通用计算领域。用户不再受限于仅能使用比特币脚本所支持的简单逻辑，而是可以自行设计任意复杂的合约逻辑。这就为构建各种多样化的上层应用开启了大门，可谓意义重大。 本章将参照比特币项目来介绍以太坊项目的核心概念和改进设计等内容。 一、以太坊项目简介 以太坊（Ethereum）项目的最初目标是打造一个智能合约的平台（Platform for Smart Contract），该平台支持图灵完备的应用，按照智能合约的约定逻辑自动执行，理想情况下将不存在故障停机、审查、欺诈，以及第三方干预等问题。 以太坊平台目前支持Golang、C++、Python等多种语言实现的客户端。由于其核心实现是基于比特币网络的核心思想进行了拓展，因此在很多设计特性上都与比特币网络十分类似。 基于以太坊项目，以太坊团队目前运营了一个公开的区块链平台——以太坊网络。智能合约开发者使用官方提供的工具和以太坊专用应用开发语言Solidity，可以很容易地开发出运行在以太坊网络上的“去中心化”应用（Decentralized Application，DApp）。这些应用将运行在以太坊的虚拟机（Ethereum Virtual Machine，EVM）里。用户通过以太币（Ether）来购买燃料（Gas），维持所部署应用的运行。 以太坊项目的官网网站为ethereum.org，代码托管在github.com/ethereum。 1.1、以太坊项目简史 与比特币网络自2009年上线的历史相比，以太坊项目要年轻得多。 2013年底，比特币开发团队中有一些开发者开始探讨将比特币网络中的核心技术，主要是区块链技术，拓展到更多应用场景的可能性。以太坊的早期发明者Vitalik Buterin提出应该能运行任意形式（图灵完备）的应用程序，而不仅仅是比特币中受限制的简单脚本。该设计思想并未得到比特币社区的支持，后来作为以太坊白皮书发布。 2014年2月，更多开发者（包括Gavin Wood、Jeffrey Wilcke等）加入以太坊项目，并计划在社区开始以众筹形式募集资金，以开发一个运行智能合约的信任平台。 2014年7月，以太币预售，经过42天，总共筹集到价值超过1800万美元的比特币。随后在瑞士成立以太坊基金会，负责对募集到的资金进行管理和运营；并组建研发团队以开源社区形式进行平台开发。 2015年7月底，以太坊第一阶段Frontier正式发布，标志着以太坊区块链网络的正式上线。这一阶段采用类似比特币网络的PoW共识机制，参与节点以矿工挖矿形式维护网络；支持上传智能合约。Frontier版本实现了计划的基本功能，在运行中测试出了一些安全上的漏洞。这一阶段使用者以开发者居多。 2016年3月，第二阶段Homestead开始运行（区块数1150000），主要改善了安全性，同时开始提供图形界面的客户端，提升了易用性，更多用户加入了进来。 2016年6月，DAO基于以太坊平台进行众筹，受到漏洞攻击，造成价值超过5000万美元的以太币被冻结。社区最后通过硬分叉（Hard Fork）进行解决。 2017年3月，以太坊成立以太坊企业级联盟（Enterprise Ethereum Alliance，EEA），联盟成员主要来自摩根大通，微软，芝加哥大学和部分创业企业等。 目前，以太坊网络支持了接近比特币网络的交易量，成为广受关注的公有链项目。 后续按照计划将发布第三阶段Metropolis和第四阶段Serenity，主要特性包括支持PoS股权证明的共识机制，以降低原先PoW机制造成的能耗浪费；以及图形界面的钱包，以提升易用性。 包括DAO在内，以太坊网络已经经历了数次大的硬分叉，注意每次硬分叉后的版本对之前版本并不兼容。 1.2、主要特点 以太坊区块链底层也是一个类似比特币网络的P2P网络平台，智能合约运行在网络中的以太坊虚拟机里。网络自身是公开可接入的，任何人都可以接入并参与网络中数据的维护，提供运行以太坊虚拟机的资源。 与比特币项目相比，以太坊区块链的技术特点主要包括： 支持图灵完备的智能合约，设计了编程语言Solidity和虚拟机EVM； 选用了内存需求较高的哈希函数，避免出现强算力矿机、矿池攻击； 叔块（uncle block）激励机制，降低矿池的优势，并减少了区块产生间隔（10分钟降低到15秒左右）； 采用账户系统和世界状态，而不是UTXO，容易支持更复杂的逻辑； 通过Gas限制代码执行指令数，避免循环执行攻击； 支持PoW共识算法，并计划支持效率更高的PoS算法。 此外，开发团队还计划通过分片（sharding）方式来解决网络可扩展性问题。 这些技术特点，解决了比特币网络在运行中被人诟病的一些问题，让以太坊网络具备了更大的应用潜力。 二、核心概念 基于比特币网络的核心思想，以太坊项目提出了许多创新的技术概念，包括智能合约、基于账户的交易、以太币和燃料等。 2.1、智能合约 智能合约（Smart Contract）是以太坊中最为重要的一个概念，即以计算机程序的方式来缔结和运行各种合约。最早在上世纪90年代，Nick Szabo等人就提出过类似的概念，但一直因为缺乏可靠执行智能合约的环境，而被当作一种理论设计。区块链技术的出现，恰好补充了这一缺陷。 以太坊支持通过图灵完备的高级语言（包括Solidity、Serpent、Viper）等来开发智能合约。智能合约作为运行在以太坊虚拟机（Ethereum Virual Machine，EVM）中的应用，可以接受来自外部的交易请求和事件，通过触发运行提前编写好的代码逻辑，进一步生成新的交易和事件，可以进一步调用其他智能合约。 智能合约的执行结果可能对以太坊网络上的账本状态进行更新。这些修改由于经过了以太坊网络中的共识，一旦确认后无法被伪造和篡改。 2.2、账户 在之前的章节中，笔者介绍过比特币在设计中并没有账户（Account）的概念，而是采用了UTXO模型记录整个系统的状态。任何人都可以通过交易历史来推算出用户的余额信息。而以太坊则采用了不同的做法，直接用账户来记录系统状态。每个账户存储余额信息、智能合约代码和内部数据存储等。以太坊支持在不同的账户之间转移数据，以实现更为复杂的逻辑。 具体来看，以太坊账户分为两种类型：合约账户（Contracts Accounts）和外部账户（Externally Owned Accounts，或EOA）： 合约账户：存储执行的智能合约代码，只能被外部账户来调用激活； 外部账户：以太币拥有者账户，对应到某公钥。账户包括nonce、balance、storageRoot、codeHash等字段，由个人来控制。 当合约账户被调用时，存储其中的智能合约会在矿工处的虚拟机中自动执行，并消耗一定的燃料。燃料通过外部账户中的以太币进行购买。 2.3、交易 交易（Transaction），在以太坊中是指从一个账户到另一个账户的消息数据。消息数据可以是以太币或者合约执行参数。 以太坊采用交易作为执行操作的最小单位。每个交易包括如下字段： to：目标账户地址； value：可以指定转移的以太币数量； nonce：交易相关的字串； gasPrice：执行交易需要消耗的Gas价格； startgas：交易消耗的最大Gas值； signature：签名信息。 类似于比特币网络，在发送交易时，用户需要缴纳一定的交易费用，通过以太币方式进行支付和消耗。目前，以太坊网络可以支持超过比特币网络的交易速率（可以达到每秒几十笔）。 2.4、以太币 以太币（Ether）是以太坊网络中的货币。 以太币主要用于购买燃料，支付给矿工，以维护以太坊网络运行智能合约的费用。以太币最小单位是wei，一个以太币等于10的18次方个wei。 以太币同样可以通过挖矿来生成，成功生成新区块的以太坊矿工可以获得5个以太币的奖励，以及包含在区块内交易的燃料费用。用户也可以通过交易市场来直接购买以太币。 目前，每年大约可以通过挖矿生成超过一千万个以太币，单个以太币的市场价格超过300美元。 2.5、燃料 燃料（Gas），控制某次交易执行指令的上限。每执行一条合约指令会消耗固定的燃料。当某个交易还未执行结束，而燃料消耗完时，合约执行终止并回滚状态。 Gas可以跟以太币进行兑换。需要注意的是，以太币的价格是波动的，但运行某段智能合约的燃料费用可以是固定的，通过设定Gas价格等进行调节。 三、主要设计 以太坊项目的基本设计与比特币网络类似。为了支持更复杂的智能合约，以太坊在不少地方进行了改进，包括交易模型、共识、对攻击的防护和可扩展性等。 3.1、智能合约相关设计 3.1.1、运行环境 以太坊采用以太坊虚拟机作为智能合约的运行环境。以太坊虚拟机是一个隔离的轻量级虚拟机环境，运行在其中的智能合约代码无法访问本地网络、文件系统或其他进程。 对同一个智能合约来说，往往需要在多个以太坊虚拟机中同时运行多份，以确保整个区块链数据的一致性和高度的容错性。但另一方面，这也限制了整个网络的容量。 3.1.2、开发语言 以太坊为编写智能合约设计了图灵完备的高级编程语言，降低了智能合约开发的难度。目前，Solidity是最常用的以太坊合约编写语言之一。 智能合约编写完毕后，用编译器编译为以太坊虚拟机专用的二进制格式（EVM bytecode），由客户端上传到区块链当中，之后在矿工的以太坊虚拟机中执行。 3.2、交易模型 出于智能合约的便利考虑，以太坊采用了账户的模型，状态可以实时地保存到账户里，而无需像比特币的UXTO模型那样去回溯整个历史。UXTO模型和账户模型的对比如表7-1所示。 表7-1　UXTO模型和账户模型 3.3、共识 以太坊目前采用了基于成熟的PoW共识的变种算法Ethash协议作为共识机制。 为了防止ASIC矿机矿池的算力攻击，跟原始PoW的计算密集型Hash运算不同，Ethash在执行时候需要消耗大量内存，反而跟计算效率关系不大。这意味着很难制造出专门针对Ethash的芯片，即通用机器可能更加有效。 虽然，Ethash对原始的PoW进行了改进，但仍然需要进行大量无效的运算，这也为人们所诟病。 社区已经有计划在未来采用更高效的Proof-of-Stake（PoS）作为共识机制。相对于PoW机制来讲，PoS机制无需消耗大量无用的Hash计算，但其共识过程的复杂度要更高一些，还有待进一步的检验。 3.4、降低攻击 由于以太坊网络中的交易更加多样化，也就更容易受到攻击。 以太坊网络在降低攻击方面的核心设计思想仍然是通过经济激励机制防止少数人作恶： 所有交易都要提供交易费用，避免DDoS攻击； 程序运行指令数通过Gas来限制，所消耗的费用超过设定上限时就会被取消，避免出现恶意合约。 这就确保了攻击者试图消耗网络中虚拟机的计算资源时，需要付出经济代价（支付大量的以太币）；同时难以通过构造恶意的循环或不稳定合约代码来对网络造成破坏。 3.5、提高扩展性 可扩展性是以太坊网络承接更多业务量的最大制约。以太坊项目未来希望通过分片（sharding）机制来提高整个网络的扩展性。分片是一组维护和执行同一批智能合约的节点组成的子网络，是整个网络的子集。 支持分片功能之前，以太坊整个网络中的每个节点都需要处理所有的智能合约，这就造成了网络的最大处理能力会受限于单个节点的处理能力。 分片后，同一片内的合约处理是同步的，彼此达成共识，不同分片之间则可以是异步的，可以提高网络整体的可扩展性。 3.4、相关工具 3.4.1、客户端和开发库 以太坊客户端可用于接入以太坊网络，进行账户管理、交易、挖矿、智能合约等各方面操作。 以太坊社区现在提供了多种语言实现的客户端和开发库，支持标准的JSON-RPC协议。用户可根据自己熟悉的开发语言进行选择： go-ethereum：Go语言实现； Parity：Rust语言实现； cpp-ethereum：C++语言实现； ethereumjs-lib：javascript语言实现； Ethereum（J）：Java语言实现； ethereumH：Haskell语言实现； pyethapp：Python语言实现； ruby-ethereum：Ruby语言实现。 上述实现中，go-ethereum的独立客户端Geth是最常用的以太坊客户端之一。用户可通过安装Geth来接入以太坊网络并成为一个完整节点。Geth也可作为一个HTTP-RPC服务器，对外暴露JSON-RPC接口，供用户与以太坊网络交互。Geth的使用需要基本的命令行基础，其功能相对完整，源码托管于github.com/ethereum/go-ethereum。 3.4.2、以太坊钱包 对于只需进行账户管理、以太坊转账、DApp使用等基本操作的用户，则可选择直观易用的钱包客户端。 Mist是官方提供的一套包含图形界面的钱包客户端，除了可用于进行交易，也支持直接编写和部署智能合约，如图7-1所示。 图7-1　Mist浏览器 所编写的代码编译发布后，可以部署到区块链上。使用者可通过发送调用相应合约方法的交易来执行智能合约。 3.4.3、IDE 对于开发者，以太坊社区涌现出了许多服务于编写智能合约和DApp的IDE，例如： Truffle：功能丰富的以太坊应用开发环境； Embark：DApp开发框架，支持集成以太坊、IPFS等； Remix：用于编写Solidity的IDE，内置调试器和测试环境。 3.4.4、网站资源 已有一些网站提供对以太坊网络的数据、运行在以太坊上的DApp等信息进行查看，例如： ethstats.net：实时查看网络的信息，如区块、价格、交易数等； ethernodes.org：显示整个网络的历史统计信息，如客户端的分布情况等； dapps.ethercasts.com：查看运行在以太坊上的DApp的信息，包括简介、所处阶段和状态等。 四、小结 以太坊项目将区块链技术在数字货币的基础上进行了延伸，提出了打造更为通用的智能合约平台的宏大构想，并基于开源技术构建了以太坊为核心的开源生态系统。 本章内容介绍了以太坊的相关知识，包括核心概念、设计、工具等。 比照比特币项目，可以掌握以太坊的相关改进设计，并学习智能合约的编写。实际上，智能合约并不是一个新兴概念，但区块链技术的出现为智能合约的“代码即律法”提供提供了信任基础和实施架构。通过引入智能合约，区块链技术释放了支持更多应用领域的巨大潜力。 摘自：区块链原理、设计与应用 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-12-04T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"以太坊-挣脱数字货币的枷锁 在区块链领域，以太坊项目也是十分出名的开源项目。作为公有区块链平台，以太坊将比特币针对数字货币交易的功能进一步进行了拓展，面向更为复杂和灵活的应用场景，支持了智能合约（smart contract）这一重要特性。 从此，区块链技术的应用场景，从单一基于UTXO的数字货币交易，延伸到图灵完备的通用计算领域。用户不再受限于仅能使用比特币脚本所支持的简单逻辑，而是可以自行设计任意复杂的合约逻辑。这就为构建各种多样化的上层应用开启了大门，可谓意义重大。 本章将参照比特币项目来介绍以太坊项目的核心概念和改进设计等内容。 一、以太坊项目简介 以太坊（Ethereum）项目的最初目标是打造一个智能合约的平台（Platform for Smart Contract），该平台支持图灵完备的应用，按照智能合约的约定逻辑自动执行，理想情况下将不存在故障停机、审查、欺诈，以及第三方干预等问题。 以太坊平台目前支持Golang、C++、Python等多种语言实现的客户端。由于其核心实现是基于比特币网络的核心思想进行了拓展，因此在很多设计特性上都与比特币网络十分类似。 基于以太坊项目，以太坊团队目前运营了一个公开的区块链平台——以太坊网络。智能合约开发者使用官方提供的工具和以太坊专用应用开发语言Solidity，可以很容易地开发出运行在以太坊网络上的“去中心化”应用（Decentralized Application，DApp）。这些应用将运行在以太坊的虚拟机（Ethereum Virtual Machine，EVM）里。用户通过以太币（Ether）来购买燃料（Gas），维持所部署应用的运行。 以太坊项目的官网网站为ethereum.org，代码托管在github.com/ethereum。 1.1、以太坊项目简史 与比特币网络自2009年上线的历史相比，以太坊项目要年轻得多。 2013年底，比特币开发团队中有一些开发者开始探讨将比特币网络中的核心技术，主要是区块链技术，拓展到更多应用场景的可能性。以太坊的早期发明者Vitalik Buterin提出应该能运行任意形式（图灵完备）的应用程序，而不仅仅是比特币中受限制的简单脚本。该设计思想并未得到比特币社区的支持，后来作为以太坊白皮书发布。 2014年2月，更多开发者（包括Gavin Wood、Jeffrey Wilcke等）加入以太坊项目，并计划在社区开始以众筹形式募集资金，以开发一个运行智能合约的信任平台。 2014年7月，以太币预售，经过42天，总共筹集到价值超过1800万美元的比特币。随后在瑞士成立以太坊基金会，负责对募集到的资金进行管理和运营；并组建研发团队以开源社区形式进行平台开发。 2015年7月底，以太坊第一阶段Frontier正式发布，标志着以太坊区块链网络的正式上线。这一阶段采用类似比特币网络的PoW共识机制，参与节点以矿工挖矿形式维护网络；支持上传智能合约。Frontier版本实现了计划的基本功能，在运行中测试出了一些安全上的漏洞。这一阶段使用者以开发者居多。 2016年3月，第二阶段Homestead开始运行（区块数1150000），主要改善了安全性，同时开始提供图形界面的客户端，提升了易用性，更多用户加入了进来。 2016年6月，DAO基于以太坊平台进行众筹，受到漏洞攻击，造成价值超过5000万美元的以太币被冻结。社区最后通过硬分叉（Hard Fork）进行解决。 2017年3月，以太坊成立以太坊企业级联盟（Enterprise Ethereum Alliance，EEA），联盟成员主要来自摩根大通，微软，芝加哥大学和部分创业企业等。 目前，以太坊网络支持了接近比特币网络的交易量，成为广受关注的公有链项目。 后续按照计划将发布第三阶段Metropolis和第四阶段Serenity，主要特性包括支持PoS股权证明的共识机制，以降低原先PoW机制造成的能耗浪费；以及图形界面的钱包，以提升易用性。 包括DAO在内，以太坊网络已经经历了数次大的硬分叉，注意每次硬分叉后的版本对之前版本并不兼容。 1.2、主要特点 以太坊区块链底层也是一个类似比特币网络的P2P网络平台，智能合约运行在网络中的以太坊虚拟机里。网络自身是公开可接入的，任何人都可以接入并参与网络中数据的维护，提供运行以太坊虚拟机的资源。 与比特币项目相比，以太坊区块链的技术特点主要包括： 支持图灵完备的智能合约，设计了编程语言Solidity和虚拟机EVM； 选用了内存需求较高的哈希函数，避免出现强算力矿机、矿池攻击； 叔块（uncle block）激励机制，降低矿池的优势，并减少了区块产生间隔（10分钟降低到15秒左右）； 采用账户系统和世界状态，而不是UTXO，容易支持更复杂的逻辑； 通过Gas限制代码执行指令数，避免循环执行攻击； 支持PoW共识算法，并计划支持效率更高的PoS算法。 此外，开发团队还计划通过分片（sharding）方式来解决网络可扩展性问题。 这些技术特点，解决了比特币网络在运行中被人诟病的一些问题，让以太坊网络具备了更大的应用潜力。 二、核心概念 基于比特币网络的核心思想，以太坊项目提出了许多创新的技术概念，包括智能合约、基于账户的交易、以太币和燃料等。 2.1、智能合约 智能合约（Smart Contract）是以太坊中最为重要的一个概念，即以计算机程序的方式来缔结和运行各种合约。最早在上世纪90年代，Nick Szabo等人就提出过类似的概念，但一直因为缺乏可靠执行智能合约的环境，而被当作一种理论设计。区块链技术的出现，恰好补充了这一缺陷。 以太坊支持通过图灵完备的高级语言（包括Solidity、Serpent、Viper）等来开发智能合约。智能合约作为运行在以太坊虚拟机（Ethereum Virual Machine，EVM）中的应用，可以接受来自外部的交易请求和事件，通过触发运行提前编写好的代码逻辑，进一步生成新的交易和事件，可以进一步调用其他智能合约。 智能合约的执行结果可能对以太坊网络上的账本状态进行更新。这些修改由于经过了以太坊网络中的共识，一旦确认后无法被伪造和篡改。 2.2、账户 在之前的章节中，笔者介绍过比特币在设计中并没有账户（Account）的概念，而是采用了UTXO模型记录整个系统的状态。任何人都可以通过交易历史来推算出用户的余额信息。而以太坊则采用了不同的做法，直接用账户来记录系统状态。每个账户存储余额信息、智能合约代码和内部数据存储等。以太坊支持在不同的账户之间转移数据，以实现更为复杂的逻辑。 具体来看，以太坊账户分为两种类型：合约账户（Contracts Accounts）和外部账户（Externally Owned Accounts，或EOA）： 合约账户：存储执行的智能合约代码，只能被外部账户来调用激活； 外部账户：以太币拥有者账户，对应到某公钥。账户包括nonce、balance、storageRoot、codeHash等字段，由个人来控制。 当合约账户被调用时，存储其中的智能合约会在矿工处的虚拟机中自动执行，并消耗一定的燃料。燃料通过外部账户中的以太币进行购买。 2.3、交易 交易（Transaction），在以太坊中是指从一个账户到另一个账户的消息数据。消息数据可以是以太币或者合约执行参数。 以太坊采用交易作为执行操作的最小单位。每个交易包括如下字段： to：目标账户地址； value：可以指定转移的以太币数量； nonce：交易相关的字串； gasPrice：执行交易需要消耗的Gas价格； startgas：交易消耗的最大Gas值； signature：签名信息。 类似于比特币网络，在发送交易时，用户需要缴纳一定的交易费用，通过以太币方式进行支付和消耗。目前，以太坊网络可以支持超过比特币网络的交易速率（可以达到每秒几十笔）。 2.4、以太币 以太币（Ether）是以太坊网络中的货币。 以太币主要用于购买燃料，支付给矿工，以维护以太坊网络运行智能合约的费用。以太币最小单位是wei，一个以太币等于10的18次方个wei。 以太币同样可以通过挖矿来生成，成功生成新区块的以太坊矿工可以获得5个以太币的奖励，以及包含在区块内交易的燃料费用。用户也可以通过交易市场来直接购买以太币。 目前，每年大约可以通过挖矿生成超过一千万个以太币，单个以太币的市场价格超过300美元。 2.5、燃料 燃料（Gas），控制某次交易执行指令的上限。每执行一条合约指令会消耗固定的燃料。当某个交易还未执行结束，而燃料消耗完时，合约执行终止并回滚状态。 Gas可以跟以太币进行兑换。需要注意的是，以太币的价格是波动的，但运行某段智能合约的燃料费用可以是固定的，通过设定Gas价格等进行调节。 三、主要设计 以太坊项目的基本设计与比特币网络类似。为了支持更复杂的智能合约，以太坊在不少地方进行了改进，包括交易模型、共识、对攻击的防护和可扩展性等。 3.1、智能合约相关设计 3.1.1、运行环境 以太坊采用以太坊虚拟机作为智能合约的运行环境。以太坊虚拟机是一个隔离的轻量级虚拟机环境，运行在其中的智能合约代码无法访问本地网络、文件系统或其他进程。 对同一个智能合约来说，往往需要在多个以太坊虚拟机中同时运行多份，以确保整个区块链数据的一致性和高度的容错性。但另一方面，这也限制了整个网络的容量。 3.1.2、开发语言 以太坊为编写智能合约设计了图灵完备的高级编程语言，降低了智能合约开发的难度。目前，Solidity是最常用的以太坊合约编写语言之一。 智能合约编写完毕后，用编译器编译为以太坊虚拟机专用的二进制格式（EVM bytecode），由客户端上传到区块链当中，之后在矿工的以太坊虚拟机中执行。 3.2、交易模型 出于智能合约的便利考虑，以太坊采用了账户的模型，状态可以实时地保存到账户里，而无需像比特币的UXTO模型那样去回溯整个历史。UXTO模型和账户模型的对比如表7-1所示。 表7-1　UXTO模型和账户模型 3.3、共识 以太坊目前采用了基于成熟的PoW共识的变种算法Ethash协议作为共识机制。 为了防止ASIC矿机矿池的算力攻击，跟原始PoW的计算密集型Hash运算不同，Ethash在执行时候需要消耗大量内存，反而跟计算效率关系不大。这意味着很难制造出专门针对Ethash的芯片，即通用机器可能更加有效。 虽然，Ethash对原始的PoW进行了改进，但仍然需要进行大量无效的运算，这也为人们所诟病。 社区已经有计划在未来采用更高效的Proof-of-Stake（PoS）作为共识机制。相对于PoW机制来讲，PoS机制无需消耗大量无用的Hash计算，但其共识过程的复杂度要更高一些，还有待进一步的检验。 3.4、降低攻击 由于以太坊网络中的交易更加多样化，也就更容易受到攻击。 以太坊网络在降低攻击方面的核心设计思想仍然是通过经济激励机制防止少数人作恶： 所有交易都要提供交易费用，避免DDoS攻击； 程序运行指令数通过Gas来限制，所消耗的费用超过设定上限时就会被取消，避免出现恶意合约。 这就确保了攻击者试图消耗网络中虚拟机的计算资源时，需要付出经济代价（支付大量的以太币）；同时难以通过构造恶意的循环或不稳定合约代码来对网络造成破坏。 3.5、提高扩展性 可扩展性是以太坊网络承接更多业务量的最大制约。以太坊项目未来希望通过分片（sharding）机制来提高整个网络的扩展性。分片是一组维护和执行同一批智能合约的节点组成的子网络，是整个网络的子集。 支持分片功能之前，以太坊整个网络中的每个节点都需要处理所有的智能合约，这就造成了网络的最大处理能力会受限于单个节点的处理能力。 分片后，同一片内的合约处理是同步的，彼此达成共识，不同分片之间则可以是异步的，可以提高网络整体的可扩展性。 3.4、相关工具 3.4.1、客户端和开发库 以太坊客户端可用于接入以太坊网络，进行账户管理、交易、挖矿、智能合约等各方面操作。 以太坊社区现在提供了多种语言实现的客户端和开发库，支持标准的JSON-RPC协议。用户可根据自己熟悉的开发语言进行选择： go-ethereum：Go语言实现； Parity：Rust语言实现； cpp-ethereum：C++语言实现； ethereumjs-lib：javascript语言实现； Ethereum（J）：Java语言实现； ethereumH：Haskell语言实现； pyethapp：Python语言实现； ruby-ethereum：Ruby语言实现。 上述实现中，go-ethereum的独立客户端Geth是最常用的以太坊客户端之一。用户可通过安装Geth来接入以太坊网络并成为一个完整节点。Geth也可作为一个HTTP-RPC服务器，对外暴露JSON-RPC接口，供用户与以太坊网络交互。Geth的使用需要基本的命令行基础，其功能相对完整，源码托管于github.com/ethereum/go-ethereum。 3.4.2、以太坊钱包 对于只需进行账户管理、以太坊转账、DApp使用等基本操作的用户，则可选择直观易用的钱包客户端。 Mist是官方提供的一套包含图形界面的钱包客户端，除了可用于进行交易，也支持直接编写和部署智能合约，如图7-1所示。 图7-1　Mist浏览器 所编写的代码编译发布后，可以部署到区块链上。使用者可通过发送调用相应合约方法的交易来执行智能合约。 3.4.3、IDE 对于开发者，以太坊社区涌现出了许多服务于编写智能合约和DApp的IDE，例如： Truffle：功能丰富的以太坊应用开发环境； Embark：DApp开发框架，支持集成以太坊、IPFS等； Remix：用于编写Solidity的IDE，内置调试器和测试环境。 3.4.4、网站资源 已有一些网站提供对以太坊网络的数据、运行在以太坊上的DApp等信息进行查看，例如： ethstats.net：实时查看网络的信息，如区块、价格、交易数等； ethernodes.org：显示整个网络的历史统计信息，如客户端的分布情况等； dapps.ethercasts.com：查看运行在以太坊上的DApp的信息，包括简介、所处阶段和状态等。 四、小结 以太坊项目将区块链技术在数字货币的基础上进行了延伸，提出了打造更为通用的智能合约平台的宏大构想，并基于开源技术构建了以太坊为核心的开源生态系统。 本章内容介绍了以太坊的相关知识，包括核心概念、设计、工具等。 比照比特币项目，可以掌握以太坊的相关改进设计，并学习智能合约的编写。实际上，智能合约并不是一个新兴概念，但区块链技术的出现为智能合约的“代码即律法”提供提供了信任基础和实施架构。通过引入智能合约，区块链技术释放了支持更多应用领域的巨大潜力。 摘自：区块链原理、设计与应用 阅读更多","@type":"BlogPosting","url":"/2017/12/04/fd6c74a4936549e49dc1fe405feb799e.html","headline":"以太坊-挣脱数字货币的枷锁","dateModified":"2017-12-04T00:00:00+08:00","datePublished":"2017-12-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/12/04/fd6c74a4936549e49dc1fe405feb799e.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊-挣脱数字货币的枷锁</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p><strong>以太坊-挣脱数字货币的枷锁</strong></p> 
  <p>在区块链领域，以太坊项目也是十分出名的开源项目。作为公有区块链平台，以太坊将比特币针对数字货币交易的功能进一步进行了拓展，面向更为复杂和灵活的应用场景，支持了智能合约（smart contract）这一重要特性。</p> 
  <p>从此，区块链技术的应用场景，从单一基于UTXO的数字货币交易，延伸到图灵完备的通用计算领域。用户不再受限于仅能使用比特币脚本所支持的简单逻辑，而是可以自行设计任意复杂的合约逻辑。这就为构建各种多样化的上层应用开启了大门，可谓意义重大。</p> 
  <p>本章将参照比特币项目来介绍以太坊项目的核心概念和改进设计等内容。</p> 
  <p><strong>一、以太坊项目简介</strong></p> 
  <p>以太坊（Ethereum）项目的最初目标是打造一个智能合约的平台（Platform for Smart Contract），该平台支持图灵完备的应用，按照智能合约的约定逻辑自动执行，理想情况下将不存在故障停机、审查、欺诈，以及第三方干预等问题。 <br> </p>
  <center> 
   <br> 
   <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171204144443271?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvenlobHd6eQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> 
   <br> 
  </center> 
  <br> 以太坊平台目前支持Golang、C++、Python等多种语言实现的客户端。由于其核心实现是基于比特币网络的核心思想进行了拓展，因此在很多设计特性上都与比特币网络十分类似。
  <p></p> 
  <p>基于以太坊项目，以太坊团队目前运营了一个公开的区块链平台——以太坊网络。智能合约开发者使用官方提供的工具和以太坊专用应用开发语言Solidity，可以很容易地开发出运行在以太坊网络上的“去中心化”应用（Decentralized Application，DApp）。这些应用将运行在以太坊的虚拟机（Ethereum Virtual Machine，EVM）里。用户通过以太币（Ether）来购买燃料（Gas），维持所部署应用的运行。</p> 
  <p>以太坊项目的官网网站为ethereum.org，代码托管在github.com/ethereum。</p> 
  <p><strong>1.1、以太坊项目简史</strong></p> 
  <p>与比特币网络自2009年上线的历史相比，以太坊项目要年轻得多。</p> 
  <ul> 
   <li><p>2013年底，比特币开发团队中有一些开发者开始探讨将比特币网络中的核心技术，主要是区块链技术，拓展到更多应用场景的可能性。以太坊的早期发明者Vitalik Buterin提出应该能运行任意形式（图灵完备）的应用程序，而不仅仅是比特币中受限制的简单脚本。该设计思想并未得到比特币社区的支持，后来作为以太坊白皮书发布。</p></li> 
   <li><p>2014年2月，更多开发者（包括Gavin Wood、Jeffrey Wilcke等）加入以太坊项目，并计划在社区开始以众筹形式募集资金，以开发一个运行智能合约的信任平台。</p></li> 
   <li><p>2014年7月，以太币预售，经过42天，总共筹集到价值超过1800万美元的比特币。随后在瑞士成立以太坊基金会，负责对募集到的资金进行管理和运营；并组建研发团队以开源社区形式进行平台开发。</p></li> 
   <li><p>2015年7月底，以太坊第一阶段Frontier正式发布，标志着以太坊区块链网络的正式上线。这一阶段采用类似比特币网络的PoW共识机制，参与节点以矿工挖矿形式维护网络；支持上传智能合约。Frontier版本实现了计划的基本功能，在运行中测试出了一些安全上的漏洞。这一阶段使用者以开发者居多。</p></li> 
   <li><p>2016年3月，第二阶段Homestead开始运行（区块数1150000），主要改善了安全性，同时开始提供图形界面的客户端，提升了易用性，更多用户加入了进来。</p></li> 
   <li><p>2016年6月，DAO基于以太坊平台进行众筹，受到漏洞攻击，造成价值超过5000万美元的以太币被冻结。社区最后通过硬分叉（Hard Fork）进行解决。</p></li> 
   <li><p>2017年3月，以太坊成立以太坊企业级联盟（Enterprise Ethereum Alliance，EEA），联盟成员主要来自摩根大通，微软，芝加哥大学和部分创业企业等。</p></li> 
  </ul> 
  <p>目前，以太坊网络支持了接近比特币网络的交易量，成为广受关注的公有链项目。</p> 
  <p>后续按照计划将发布第三阶段Metropolis和第四阶段Serenity，主要特性包括支持PoS股权证明的共识机制，以降低原先PoW机制造成的能耗浪费；以及图形界面的钱包，以提升易用性。</p> 
  <p>包括DAO在内，以太坊网络已经经历了数次大的硬分叉，注意每次硬分叉后的版本对之前版本并不兼容。</p> 
  <p><strong>1.2、主要特点</strong></p> 
  <p>以太坊区块链底层也是一个类似比特币网络的P2P网络平台，智能合约运行在网络中的以太坊虚拟机里。网络自身是公开可接入的，任何人都可以接入并参与网络中数据的维护，提供运行以太坊虚拟机的资源。</p> 
  <p>与比特币项目相比，以太坊区块链的技术特点主要包括：</p> 
  <ul> 
   <li><p>支持图灵完备的智能合约，设计了编程语言Solidity和虚拟机EVM；</p></li> 
   <li><p>选用了内存需求较高的哈希函数，避免出现强算力矿机、矿池攻击；</p></li> 
   <li><p>叔块（uncle block）激励机制，降低矿池的优势，并减少了区块产生间隔（10分钟降低到15秒左右）；</p></li> 
   <li><p>采用账户系统和世界状态，而不是UTXO，容易支持更复杂的逻辑；</p></li> 
   <li><p>通过Gas限制代码执行指令数，避免循环执行攻击；</p></li> 
   <li><p>支持PoW共识算法，并计划支持效率更高的PoS算法。</p></li> 
  </ul> 
  <p>此外，开发团队还计划通过分片（sharding）方式来解决网络可扩展性问题。</p> 
  <p>这些技术特点，解决了比特币网络在运行中被人诟病的一些问题，让以太坊网络具备了更大的应用潜力。</p> 
  <p><strong>二、核心概念</strong></p> 
  <p>基于比特币网络的核心思想，以太坊项目提出了许多创新的技术概念，包括智能合约、基于账户的交易、以太币和燃料等。</p> 
  <p><strong>2.1、智能合约</strong></p> 
  <p>智能合约（Smart Contract）是以太坊中最为重要的一个概念，即以计算机程序的方式来缔结和运行各种合约。最早在上世纪90年代，Nick Szabo等人就提出过类似的概念，但一直因为缺乏可靠执行智能合约的环境，而被当作一种理论设计。区块链技术的出现，恰好补充了这一缺陷。</p> 
  <p>以太坊支持通过图灵完备的高级语言（包括Solidity、Serpent、Viper）等来开发智能合约。智能合约作为运行在以太坊虚拟机（Ethereum Virual Machine，EVM）中的应用，可以接受来自外部的交易请求和事件，通过触发运行提前编写好的代码逻辑，进一步生成新的交易和事件，可以进一步调用其他智能合约。</p> 
  <p>智能合约的执行结果可能对以太坊网络上的账本状态进行更新。这些修改由于经过了以太坊网络中的共识，一旦确认后无法被伪造和篡改。</p> 
  <p><strong>2.2、账户</strong></p> 
  <p>在之前的章节中，笔者介绍过比特币在设计中并没有账户（Account）的概念，而是采用了UTXO模型记录整个系统的状态。任何人都可以通过交易历史来推算出用户的余额信息。而以太坊则采用了不同的做法，直接用账户来记录系统状态。每个账户存储余额信息、智能合约代码和内部数据存储等。以太坊支持在不同的账户之间转移数据，以实现更为复杂的逻辑。</p> 
  <p>具体来看，以太坊账户分为两种类型：合约账户（Contracts Accounts）和外部账户（Externally Owned Accounts，或EOA）：</p> 
  <ul> 
   <li><p>合约账户：存储执行的智能合约代码，只能被外部账户来调用激活；</p></li> 
   <li><p>外部账户：以太币拥有者账户，对应到某公钥。账户包括nonce、balance、storageRoot、codeHash等字段，由个人来控制。</p></li> 
  </ul> 
  <p>当合约账户被调用时，存储其中的智能合约会在矿工处的虚拟机中自动执行，并消耗一定的燃料。燃料通过外部账户中的以太币进行购买。</p> 
  <p><strong>2.3、交易</strong></p> 
  <p>交易（Transaction），在以太坊中是指从一个账户到另一个账户的消息数据。消息数据可以是以太币或者合约执行参数。</p> 
  <p>以太坊采用交易作为执行操作的最小单位。每个交易包括如下字段：</p> 
  <ul> 
   <li><p>to：目标账户地址；</p></li> 
   <li><p>value：可以指定转移的以太币数量；</p></li> 
   <li><p>nonce：交易相关的字串；</p></li> 
   <li><p>gasPrice：执行交易需要消耗的Gas价格；</p></li> 
   <li><p>startgas：交易消耗的最大Gas值；</p></li> 
   <li><p>signature：签名信息。</p></li> 
  </ul> 
  <p>类似于比特币网络，在发送交易时，用户需要缴纳一定的交易费用，通过以太币方式进行支付和消耗。目前，以太坊网络可以支持超过比特币网络的交易速率（可以达到每秒几十笔）。</p> 
  <p><strong>2.4、以太币</strong></p> 
  <p>以太币（Ether）是以太坊网络中的货币。</p> 
  <p>以太币主要用于购买燃料，支付给矿工，以维护以太坊网络运行智能合约的费用。以太币最小单位是wei，一个以太币等于10的18次方个wei。</p> 
  <p>以太币同样可以通过挖矿来生成，成功生成新区块的以太坊矿工可以获得5个以太币的奖励，以及包含在区块内交易的燃料费用。用户也可以通过交易市场来直接购买以太币。</p> 
  <p>目前，每年大约可以通过挖矿生成超过一千万个以太币，单个以太币的市场价格超过300美元。</p> 
  <p><strong>2.5、燃料</strong></p> 
  <p>燃料（Gas），控制某次交易执行指令的上限。每执行一条合约指令会消耗固定的燃料。当某个交易还未执行结束，而燃料消耗完时，合约执行终止并回滚状态。</p> 
  <p>Gas可以跟以太币进行兑换。需要注意的是，以太币的价格是波动的，但运行某段智能合约的燃料费用可以是固定的，通过设定Gas价格等进行调节。</p> 
  <p><strong>三、主要设计</strong></p> 
  <p>以太坊项目的基本设计与比特币网络类似。为了支持更复杂的智能合约，以太坊在不少地方进行了改进，包括交易模型、共识、对攻击的防护和可扩展性等。</p> 
  <p><strong>3.1、智能合约相关设计</strong></p> 
  <p><strong>3.1.1、运行环境</strong></p> 
  <p>以太坊采用以太坊虚拟机作为智能合约的运行环境。以太坊虚拟机是一个隔离的轻量级虚拟机环境，运行在其中的智能合约代码无法访问本地网络、文件系统或其他进程。</p> 
  <p>对同一个智能合约来说，往往需要在多个以太坊虚拟机中同时运行多份，以确保整个区块链数据的一致性和高度的容错性。但另一方面，这也限制了整个网络的容量。</p> 
  <p><strong>3.1.2、开发语言</strong></p> 
  <p>以太坊为编写智能合约设计了图灵完备的高级编程语言，降低了智能合约开发的难度。目前，Solidity是最常用的以太坊合约编写语言之一。</p> 
  <p>智能合约编写完毕后，用编译器编译为以太坊虚拟机专用的二进制格式（EVM bytecode），由客户端上传到区块链当中，之后在矿工的以太坊虚拟机中执行。</p> 
  <p><strong>3.2、交易模型</strong></p> 
  <p>出于智能合约的便利考虑，以太坊采用了账户的模型，状态可以实时地保存到账户里，而无需像比特币的UXTO模型那样去回溯整个历史。UXTO模型和账户模型的对比如表7-1所示。 <br> </p>
  <center> 
   <br> 
   <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171204144846491?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvenlobHd6eQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> 
   <br> 表7-1　UXTO模型和账户模型 
   <br> 
  </center> 
  <br> 
  <strong>3.3、共识</strong>
  <p></p> 
  <p>以太坊目前采用了基于成熟的PoW共识的变种算法Ethash协议作为共识机制。</p> 
  <p>为了防止ASIC矿机矿池的算力攻击，跟原始PoW的计算密集型Hash运算不同，Ethash在执行时候需要消耗大量内存，反而跟计算效率关系不大。这意味着很难制造出专门针对Ethash的芯片，即通用机器可能更加有效。</p> 
  <p>虽然，Ethash对原始的PoW进行了改进，但仍然需要进行大量无效的运算，这也为人们所诟病。</p> 
  <p>社区已经有计划在未来采用更高效的Proof-of-Stake（PoS）作为共识机制。相对于PoW机制来讲，PoS机制无需消耗大量无用的Hash计算，但其共识过程的复杂度要更高一些，还有待进一步的检验。</p> 
  <p><strong>3.4、降低攻击</strong></p> 
  <p>由于以太坊网络中的交易更加多样化，也就更容易受到攻击。</p> 
  <p>以太坊网络在降低攻击方面的核心设计思想仍然是通过经济激励机制防止少数人作恶：</p> 
  <p>所有交易都要提供交易费用，避免DDoS攻击；</p> 
  <p>程序运行指令数通过Gas来限制，所消耗的费用超过设定上限时就会被取消，避免出现恶意合约。</p> 
  <p>这就确保了攻击者试图消耗网络中虚拟机的计算资源时，需要付出经济代价（支付大量的以太币）；同时难以通过构造恶意的循环或不稳定合约代码来对网络造成破坏。</p> 
  <p><strong>3.5、提高扩展性</strong></p> 
  <p>可扩展性是以太坊网络承接更多业务量的最大制约。以太坊项目未来希望通过分片（sharding）机制来提高整个网络的扩展性。分片是一组维护和执行同一批智能合约的节点组成的子网络，是整个网络的子集。</p> 
  <p>支持分片功能之前，以太坊整个网络中的每个节点都需要处理所有的智能合约，这就造成了网络的最大处理能力会受限于单个节点的处理能力。</p> 
  <p>分片后，同一片内的合约处理是同步的，彼此达成共识，不同分片之间则可以是异步的，可以提高网络整体的可扩展性。</p> 
  <p><strong>3.4、相关工具</strong></p> 
  <p><strong>3.4.1、客户端和开发库</strong></p> 
  <p>以太坊客户端可用于接入以太坊网络，进行账户管理、交易、挖矿、智能合约等各方面操作。</p> 
  <p>以太坊社区现在提供了多种语言实现的客户端和开发库，支持标准的JSON-RPC协议。用户可根据自己熟悉的开发语言进行选择：</p> 
  <ul> 
   <li><p>go-ethereum：Go语言实现；</p></li> 
   <li><p>Parity：Rust语言实现；</p></li> 
   <li><p>cpp-ethereum：C++语言实现；</p></li> 
   <li><p>ethereumjs-lib：javascript语言实现；</p></li> 
   <li><p>Ethereum（J）：Java语言实现；</p></li> 
   <li><p>ethereumH：Haskell语言实现；</p></li> 
   <li><p>pyethapp：Python语言实现；</p></li> 
   <li><p>ruby-ethereum：Ruby语言实现。</p></li> 
  </ul> 
  <p>上述实现中，go-ethereum的独立客户端Geth是最常用的以太坊客户端之一。用户可通过安装Geth来接入以太坊网络并成为一个完整节点。Geth也可作为一个HTTP-RPC服务器，对外暴露JSON-RPC接口，供用户与以太坊网络交互。Geth的使用需要基本的命令行基础，其功能相对完整，源码托管于github.com/ethereum/go-ethereum。</p> 
  <p><strong>3.4.2、以太坊钱包</strong></p> 
  <p>对于只需进行账户管理、以太坊转账、DApp使用等基本操作的用户，则可选择直观易用的钱包客户端。</p> 
  <p>Mist是官方提供的一套包含图形界面的钱包客户端，除了可用于进行交易，也支持直接编写和部署智能合约，如图7-1所示。 <br> </p>
  <center> 
   <br> 
   <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171204145004344?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvenlobHd6eQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""> 
   <br> 图7-1　Mist浏览器 
   <br> 
  </center> 
  <br> 所编写的代码编译发布后，可以部署到区块链上。使用者可通过发送调用相应合约方法的交易来执行智能合约。
  <p></p> 
  <p><strong>3.4.3、IDE</strong></p> 
  <p>对于开发者，以太坊社区涌现出了许多服务于编写智能合约和DApp的IDE，例如：</p> 
  <ul> 
   <li><p>Truffle：功能丰富的以太坊应用开发环境；</p></li> 
   <li><p>Embark：DApp开发框架，支持集成以太坊、IPFS等；</p></li> 
   <li><p>Remix：用于编写Solidity的IDE，内置调试器和测试环境。</p></li> 
  </ul> 
  <p><strong>3.4.4、网站资源</strong></p> 
  <p>已有一些网站提供对以太坊网络的数据、运行在以太坊上的DApp等信息进行查看，例如：</p> 
  <ul> 
   <li><p>ethstats.net：实时查看网络的信息，如区块、价格、交易数等；</p></li> 
   <li><p>ethernodes.org：显示整个网络的历史统计信息，如客户端的分布情况等；</p></li> 
   <li><p>dapps.ethercasts.com：查看运行在以太坊上的DApp的信息，包括简介、所处阶段和状态等。</p></li> 
  </ul> 
  <p><strong>四、小结</strong></p> 
  <p>以太坊项目将区块链技术在数字货币的基础上进行了延伸，提出了打造更为通用的智能合约平台的宏大构想，并基于开源技术构建了以太坊为核心的开源生态系统。</p> 
  <p>本章内容介绍了以太坊的相关知识，包括核心概念、设计、工具等。</p> 
  <p>比照比特币项目，可以掌握以太坊的相关改进设计，并学习智能合约的编写。实际上，智能合约并不是一个新兴概念，但区块链技术的出现为智能合约的“代码即律法”提供提供了信任基础和实施架构。通过引入智能合约，区块链技术释放了支持更多应用领域的巨大潜力。</p> 
  <p>摘自：区块链原理、设计与应用</p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zyhlwzy/article/details/78709760,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zyhlwzy/article/details/78709760,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

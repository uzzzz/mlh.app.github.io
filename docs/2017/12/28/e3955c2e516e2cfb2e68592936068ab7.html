<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊如何搭建私有连联盟链 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊如何搭建私有连联盟链" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="如何启动geth节点对大家来说已经不是什么难事，今天博主就带大家学习一下如何搭建两个节点的联盟链。 私有链的创建 在之前的文章中我们已经讲到过私有链的创建，本篇文章我们会有道私有链创建的知识，就重新温故一下。创建私有链首先需要指定创始块的配置，也就是genesis.json的配置。此文件就是一个内容格式为json的文本文件。 配置文件的内容格式基本如下： { &quot;alloc&quot;: {}, &quot;config&quot;: { &quot;chainID&quot;: 72, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;nonce&quot;: &quot;0x0000000000000000&quot;, &quot;difficulty&quot;: &quot;0x4000&quot;, &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &quot;timestamp&quot;: &quot;0x00&quot;, &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;extraData&quot;: &quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &quot;gasLimit&quot;: &quot;0xffffffff&quot; } 配置项简介 我们对配置项的内容进行一下简单的介绍。 alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以不需要预置有币的账号，需要的时候自己创建即可以。实例代码如下： &quot;alloc&quot;: { &quot;de1e758511a7c67e7db93d1c23c1060a21db4615&quot;: { &quot;balance&quot;: &quot;1000&quot; }, &quot;27dc8de9e9a1cb673543bd5fce89e83af09e228f&quot;: { &quot;balance&quot;: &quot;1100&quot; }, &quot;d64a66c28a6ae5150af5e7c34696502793b91ae7&quot;: { &quot;balance&quot;: &quot;900&quot; } nonce:一个64位随机数，用于挖矿，和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4.Block Header Validity (44)章节所描述的条件。 difficulty: 设置计算区块的难度，如果数值过大，挖矿时间较长，在测试环境为节省算力和等带时间可设置较小值。 mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 coinbase: 矿工账号，随便填写。 timestamp: 设置创世块的时间戳。 parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0。 extraData: 附加信息，随便填，可以填你的个性信息，必须为十六进制的字符串。 gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为是私有链，所以填最大。 创世块初始化 本教程以mac操作系统为例，其他操作系统可对照执行。 执行以下命令来启动初始化创世块的命令，最简单的一组操作就是制定dir文件路径，和初始化文件目录。前面我们已经写好了genesis.json的配置文件，下面就执行一下初始化操作，涉及到操作参数为init。 ershixiongdeMacBook-Pro:geth zzs$ ./geth --datadir ./data-init1/ init genesis.json 本教程将初始化json文件放在geth同级目录下，如果放在其他目录下，指定具体的路径即可。同时创建了一个data-init1目录专门存储节点数据，执行完成会发现在该目录下多出两个目录，一个为geth一个为keystore。其中geth里面放数据相关信息，keystore里面放加密过的私钥文件。 执行时打印日志如下： WARN [12-28|19:12:03] No etherbase set and no accounts found as default INFO [12-28|19:12:03] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init1/geth/chaindata cache=16 handles=16 INFO [12-28|19:12:03] Writing custom genesis block INFO [12-28|19:12:03] Successfully wrote genesis state database=chaindata hash=942f59…a2588a INFO [12-28|19:12:03] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init1/geth/lightchaindata cache=16 handles=16 INFO [12-28|19:12:03] Writing custom genesis block INFO [12-28|19:12:03] Successfully wrote genesis state database=lightchaindata hash=942f59…a2588a 经过以上命令，我们已经完成了私有连的初始化工作。因为我们要建立联盟链，因此需要再创建执行一遍同样的命令，json文件必须相同，datadir目录必须不同。博主使用data-init2目录来存储第二个节点的数据。 ershixiongdeMacBook-Pro:geth zzs$ ./geth --datadir ./data-init2/ init genesis.json 启动并进入控制台 根据具体的操作系统，开两个窗口来启动两个节点。这里有一点需要注意的是，虽然是两个节点，但他们的启动程序都是geth，只不过datadir目录不同而已。 在第一个窗口执行以下命令启动一个节点，注意启动之后不要关闭窗口。 ./geth --datadir ./data-init1/ --networkid 88 --nodiscover console 参数简介： networkid 指定网路ID，确保不适用1-4。 nodiscover 此参数确保geth不去寻找peers，主要是为了严格控制联盟链连入的节点。 这里我们需要注意的是在启动第一个节点时并没有指定port参数，因此此处采用了默认的port，也就是30303。 以下为执行时打印的日志，并进入控制台。通过日志我们也可以发现端口为30303。 WARN [12-28|19:23:16] No etherbase set and no accounts found as default INFO [12-28|19:23:16] Starting peer-to-peer node instance=Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2 INFO [12-28|19:23:16] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init2/geth/chaindata cache=128 handles=1024 WARN [12-28|19:23:16] Upgrading database to use lookup entries INFO [12-28|19:23:16] Database deduplication successful deduped=0 INFO [12-28|19:23:16] Initialised chain configuration config=&quot;{ChainID: 72 Homestead: 0 DAO: &lt;nil&gt; DAOSupport: false EIP150: &lt;nil&gt; EIP155: 0 EIP158: 0 Byzantium: &lt;nil&gt; Engine: unknown}&quot; INFO [12-28|19:23:16] Disk storage enabled for ethash caches dir=/Users/zzs/develop/eth/geth/data-init2/geth/ethash count=3 INFO [12-28|19:23:16] Disk storage enabled for ethash DAGs dir=/Users/zzs/.ethash count=2 INFO [12-28|19:23:16] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=88 INFO [12-28|19:23:16] Loaded most recent local header number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Loaded most recent local full block number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Loaded most recent local fast block number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Regenerated local transaction journal transactions=0 accounts=0 INFO [12-28|19:23:16] Starting P2P networking INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; INFO [12-28|19:23:16] IPC endpoint opened: /Users/zzs/develop/eth/geth/data-init2/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; INFO [12-28|19:23:18] Mapped network port proto=tcp extport=30303 intport=30303 interface=&quot;UPNP IGDv1-IP1&quot; 下面在另外一个窗口，换一个端口，比如30306，再换一下datadir，来启动第二个节点。 ./geth --datadir ./data-init2/ --port 30306 --networkid 88 --nodiscover console 执行上面命令，完成节点2的启动，并进入控制台。 添加coinbase账户 上面的日志我们也看到警告信息，提示没有账户存在，那么现在我们就在第一个节点上创建一个账户，具体在控制台操作命令如下： &gt; personal.listAccounts [] &gt; personal.newAccount(&quot;123456&quot;) &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; &gt; 上面的命令先是查看了节点下的地址，结果为空，然后创建了一个秘密为123456的账号。 同样的，在另外一个窗口我们执行同样的命令： &gt; personal.listAccounts [] &gt; personal.newAccount(&quot;123456&quot;) &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot; &gt; 这样，两个节点就拥有了两个地址。同时，在它们的keystore目录下对应生成了加密的私钥文件。 我们也可以再次执行list命令查看添加账户之后的情况。同时可以执行以下命令查看coinbase账号： &gt; eth.coinbase &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot; &gt; 由于只有一个地址，因此该地址就作为coinbase地址。如果想查看更多的信息可以执行以下命令： &gt; personal.listWallets [{ accounts: [{ address: &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;, url: &quot;keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572&quot; }], status: &quot;Locked&quot;, url: &quot;keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572&quot; }] 这里不仅打印了账户信息，还打印出了私钥存储的位置和账户状态等信息。 联盟链互通 上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。 &gt; admin.peers [] 发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。 下面就通过分享enode地址的方式来让两个节点建立链接。 &gt; admin.nodeInfo.enode &quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot; &gt; 通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。 其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如： INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; 现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令： &gt; admin.addPeer(&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot;) true 返回true，说明执行成功。再次验证一下： &gt; admin.peers [{ caps: [&quot;eth/63&quot;], id: &quot;aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c&quot;, name: &quot;Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2&quot;, network: { localAddress: &quot;[::1]:49426&quot;, remoteAddress: &quot;[::1]:30306&quot; }, protocols: { eth: { difficulty: 16384, head: &quot;0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a&quot;, version: 63 } } }] &gt; 发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。 查询余额并挖矿 执行查看余额命令： &gt; eth.getBalance(eth.coinbase） 0 &gt; 发现两个节点的账号余额都为0。 在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。 当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息： &gt; INFO [12-28|20:05:32] Block synchronisation started INFO [12-28|20:05:33] Imported new state entries count=1 elapsed=47.661µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 WARN [12-28|20:05:33] Discarded bad propagated block number=1 hash=ab49ba…1cf32f INFO [12-28|20:05:33] Imported new block headers count=2 elapsed=9.208ms number=2 hash=738225…000e3b ignored=0 INFO [12-28|20:05:33] Imported new chain segment blocks=2 txs=0 mgas=0.000 elapsed=1.724ms mgasps=0.000 number=2 hash=738225…000e3b INFO [12-28|20:05:33] Fast sync complete, auto disabling INFO [12-28|20:05:34] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=5.978ms mgasps=0.000 number=3 hash=b069a9…426060 INFO [12-28|20:05:38] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.930ms mgasps=0.000 number=4 hash=21217e…526253 INFO [12-28|20:05:41] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.419ms mgasps=0.000 number=5 hash=3fa6ff…cf2794 INFO [12-28|20:05:43] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.557ms mgasps=0.000 number=6 hash=4c35b9…78b3ec INFO [12-28|20:05:45] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.514ms mgasps=0.000 number=7 hash=328e62…1bd3d3 INFO [12-28|20:05:46] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.513ms mgasps=0.000 number=8 hash=12287e…0465b5 INFO [12-28|20:06:19] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=7.048ms mgasps=0.000 number=9 hash=8e844b…b99d6c INFO [12-28|20:06:22] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=8.156ms mgasps=0.000 number=10 hash=159b36…d4dde5 INFO [12-28|20:06:24] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.549ms mgasps=0.000 number=11 hash=969100…5658a5 也就是说，节点1挖矿，节点2在同步数据信息。 停止节点1的挖矿，并查看coinbase地址金额： &gt; miner.stop() true &gt; eth.getBalance(eth.coinbase) 140000000000000000000 &gt; eth.coinbase &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; 这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息： &gt; eth.getBalance(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) 140000000000000000000 &gt; 很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。 交易转账 现在我们从节点1的coinbase账户发一笔交易到节点2的coinbase账户。 &gt; personal.unlockAccount(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) Unlock account 0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e Passphrase: true &gt; eth.sendTransaction({from: eth.coinbase, to: &#39;0x02b7344004c45465796f779b7b95d7912c2ef572&#39;, value: 100000000}) INFO [12-28|20:13:21] Submitted transaction fullhash=0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0 recipient=0x02b7344004c45465796F779B7b95d7912C2eF572 &quot;0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0&quot; &gt; 解锁账户并发送1币交易信息。现在查看一下节点2的地址内是否有余额： &gt; eth.getBalance(&quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;) 0 &gt; 发现余额是0，为什么呢？因为虽然我们发起了交易，单并没有矿工挖矿打包交易。再次执行miner.start()。再次查询，就会发现节点2的coinbase地址已经有金额了。 &gt; eth.getBalance(&quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;) 100000000 通过以上的操作我们已经建立了一个拥有两个节点的联盟链，如果想建立更多节点的联盟链，可以此添加新的节点。 注意事项 需要注意的是，如果一个节点重启，则需要重新添加peer。另外，在实际生产中可去掉console命令，通过之前介绍的attach命令进入控制台。 更多资讯 或许更多相关资讯可关注微信公众号：《程序新视界》和知识星球（小密圈），为你解疑答惑。也可加入QQ技术群（659809063）进行交流。 阅读更多" />
<meta property="og:description" content="如何启动geth节点对大家来说已经不是什么难事，今天博主就带大家学习一下如何搭建两个节点的联盟链。 私有链的创建 在之前的文章中我们已经讲到过私有链的创建，本篇文章我们会有道私有链创建的知识，就重新温故一下。创建私有链首先需要指定创始块的配置，也就是genesis.json的配置。此文件就是一个内容格式为json的文本文件。 配置文件的内容格式基本如下： { &quot;alloc&quot;: {}, &quot;config&quot;: { &quot;chainID&quot;: 72, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;nonce&quot;: &quot;0x0000000000000000&quot;, &quot;difficulty&quot;: &quot;0x4000&quot;, &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &quot;timestamp&quot;: &quot;0x00&quot;, &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;extraData&quot;: &quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &quot;gasLimit&quot;: &quot;0xffffffff&quot; } 配置项简介 我们对配置项的内容进行一下简单的介绍。 alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以不需要预置有币的账号，需要的时候自己创建即可以。实例代码如下： &quot;alloc&quot;: { &quot;de1e758511a7c67e7db93d1c23c1060a21db4615&quot;: { &quot;balance&quot;: &quot;1000&quot; }, &quot;27dc8de9e9a1cb673543bd5fce89e83af09e228f&quot;: { &quot;balance&quot;: &quot;1100&quot; }, &quot;d64a66c28a6ae5150af5e7c34696502793b91ae7&quot;: { &quot;balance&quot;: &quot;900&quot; } nonce:一个64位随机数，用于挖矿，和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4.Block Header Validity (44)章节所描述的条件。 difficulty: 设置计算区块的难度，如果数值过大，挖矿时间较长，在测试环境为节省算力和等带时间可设置较小值。 mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 coinbase: 矿工账号，随便填写。 timestamp: 设置创世块的时间戳。 parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0。 extraData: 附加信息，随便填，可以填你的个性信息，必须为十六进制的字符串。 gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为是私有链，所以填最大。 创世块初始化 本教程以mac操作系统为例，其他操作系统可对照执行。 执行以下命令来启动初始化创世块的命令，最简单的一组操作就是制定dir文件路径，和初始化文件目录。前面我们已经写好了genesis.json的配置文件，下面就执行一下初始化操作，涉及到操作参数为init。 ershixiongdeMacBook-Pro:geth zzs$ ./geth --datadir ./data-init1/ init genesis.json 本教程将初始化json文件放在geth同级目录下，如果放在其他目录下，指定具体的路径即可。同时创建了一个data-init1目录专门存储节点数据，执行完成会发现在该目录下多出两个目录，一个为geth一个为keystore。其中geth里面放数据相关信息，keystore里面放加密过的私钥文件。 执行时打印日志如下： WARN [12-28|19:12:03] No etherbase set and no accounts found as default INFO [12-28|19:12:03] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init1/geth/chaindata cache=16 handles=16 INFO [12-28|19:12:03] Writing custom genesis block INFO [12-28|19:12:03] Successfully wrote genesis state database=chaindata hash=942f59…a2588a INFO [12-28|19:12:03] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init1/geth/lightchaindata cache=16 handles=16 INFO [12-28|19:12:03] Writing custom genesis block INFO [12-28|19:12:03] Successfully wrote genesis state database=lightchaindata hash=942f59…a2588a 经过以上命令，我们已经完成了私有连的初始化工作。因为我们要建立联盟链，因此需要再创建执行一遍同样的命令，json文件必须相同，datadir目录必须不同。博主使用data-init2目录来存储第二个节点的数据。 ershixiongdeMacBook-Pro:geth zzs$ ./geth --datadir ./data-init2/ init genesis.json 启动并进入控制台 根据具体的操作系统，开两个窗口来启动两个节点。这里有一点需要注意的是，虽然是两个节点，但他们的启动程序都是geth，只不过datadir目录不同而已。 在第一个窗口执行以下命令启动一个节点，注意启动之后不要关闭窗口。 ./geth --datadir ./data-init1/ --networkid 88 --nodiscover console 参数简介： networkid 指定网路ID，确保不适用1-4。 nodiscover 此参数确保geth不去寻找peers，主要是为了严格控制联盟链连入的节点。 这里我们需要注意的是在启动第一个节点时并没有指定port参数，因此此处采用了默认的port，也就是30303。 以下为执行时打印的日志，并进入控制台。通过日志我们也可以发现端口为30303。 WARN [12-28|19:23:16] No etherbase set and no accounts found as default INFO [12-28|19:23:16] Starting peer-to-peer node instance=Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2 INFO [12-28|19:23:16] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init2/geth/chaindata cache=128 handles=1024 WARN [12-28|19:23:16] Upgrading database to use lookup entries INFO [12-28|19:23:16] Database deduplication successful deduped=0 INFO [12-28|19:23:16] Initialised chain configuration config=&quot;{ChainID: 72 Homestead: 0 DAO: &lt;nil&gt; DAOSupport: false EIP150: &lt;nil&gt; EIP155: 0 EIP158: 0 Byzantium: &lt;nil&gt; Engine: unknown}&quot; INFO [12-28|19:23:16] Disk storage enabled for ethash caches dir=/Users/zzs/develop/eth/geth/data-init2/geth/ethash count=3 INFO [12-28|19:23:16] Disk storage enabled for ethash DAGs dir=/Users/zzs/.ethash count=2 INFO [12-28|19:23:16] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=88 INFO [12-28|19:23:16] Loaded most recent local header number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Loaded most recent local full block number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Loaded most recent local fast block number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Regenerated local transaction journal transactions=0 accounts=0 INFO [12-28|19:23:16] Starting P2P networking INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; INFO [12-28|19:23:16] IPC endpoint opened: /Users/zzs/develop/eth/geth/data-init2/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; INFO [12-28|19:23:18] Mapped network port proto=tcp extport=30303 intport=30303 interface=&quot;UPNP IGDv1-IP1&quot; 下面在另外一个窗口，换一个端口，比如30306，再换一下datadir，来启动第二个节点。 ./geth --datadir ./data-init2/ --port 30306 --networkid 88 --nodiscover console 执行上面命令，完成节点2的启动，并进入控制台。 添加coinbase账户 上面的日志我们也看到警告信息，提示没有账户存在，那么现在我们就在第一个节点上创建一个账户，具体在控制台操作命令如下： &gt; personal.listAccounts [] &gt; personal.newAccount(&quot;123456&quot;) &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; &gt; 上面的命令先是查看了节点下的地址，结果为空，然后创建了一个秘密为123456的账号。 同样的，在另外一个窗口我们执行同样的命令： &gt; personal.listAccounts [] &gt; personal.newAccount(&quot;123456&quot;) &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot; &gt; 这样，两个节点就拥有了两个地址。同时，在它们的keystore目录下对应生成了加密的私钥文件。 我们也可以再次执行list命令查看添加账户之后的情况。同时可以执行以下命令查看coinbase账号： &gt; eth.coinbase &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot; &gt; 由于只有一个地址，因此该地址就作为coinbase地址。如果想查看更多的信息可以执行以下命令： &gt; personal.listWallets [{ accounts: [{ address: &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;, url: &quot;keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572&quot; }], status: &quot;Locked&quot;, url: &quot;keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572&quot; }] 这里不仅打印了账户信息，还打印出了私钥存储的位置和账户状态等信息。 联盟链互通 上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。 &gt; admin.peers [] 发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。 下面就通过分享enode地址的方式来让两个节点建立链接。 &gt; admin.nodeInfo.enode &quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot; &gt; 通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。 其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如： INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; 现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令： &gt; admin.addPeer(&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot;) true 返回true，说明执行成功。再次验证一下： &gt; admin.peers [{ caps: [&quot;eth/63&quot;], id: &quot;aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c&quot;, name: &quot;Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2&quot;, network: { localAddress: &quot;[::1]:49426&quot;, remoteAddress: &quot;[::1]:30306&quot; }, protocols: { eth: { difficulty: 16384, head: &quot;0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a&quot;, version: 63 } } }] &gt; 发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。 查询余额并挖矿 执行查看余额命令： &gt; eth.getBalance(eth.coinbase） 0 &gt; 发现两个节点的账号余额都为0。 在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。 当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息： &gt; INFO [12-28|20:05:32] Block synchronisation started INFO [12-28|20:05:33] Imported new state entries count=1 elapsed=47.661µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 WARN [12-28|20:05:33] Discarded bad propagated block number=1 hash=ab49ba…1cf32f INFO [12-28|20:05:33] Imported new block headers count=2 elapsed=9.208ms number=2 hash=738225…000e3b ignored=0 INFO [12-28|20:05:33] Imported new chain segment blocks=2 txs=0 mgas=0.000 elapsed=1.724ms mgasps=0.000 number=2 hash=738225…000e3b INFO [12-28|20:05:33] Fast sync complete, auto disabling INFO [12-28|20:05:34] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=5.978ms mgasps=0.000 number=3 hash=b069a9…426060 INFO [12-28|20:05:38] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.930ms mgasps=0.000 number=4 hash=21217e…526253 INFO [12-28|20:05:41] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.419ms mgasps=0.000 number=5 hash=3fa6ff…cf2794 INFO [12-28|20:05:43] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.557ms mgasps=0.000 number=6 hash=4c35b9…78b3ec INFO [12-28|20:05:45] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.514ms mgasps=0.000 number=7 hash=328e62…1bd3d3 INFO [12-28|20:05:46] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.513ms mgasps=0.000 number=8 hash=12287e…0465b5 INFO [12-28|20:06:19] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=7.048ms mgasps=0.000 number=9 hash=8e844b…b99d6c INFO [12-28|20:06:22] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=8.156ms mgasps=0.000 number=10 hash=159b36…d4dde5 INFO [12-28|20:06:24] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.549ms mgasps=0.000 number=11 hash=969100…5658a5 也就是说，节点1挖矿，节点2在同步数据信息。 停止节点1的挖矿，并查看coinbase地址金额： &gt; miner.stop() true &gt; eth.getBalance(eth.coinbase) 140000000000000000000 &gt; eth.coinbase &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; 这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息： &gt; eth.getBalance(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) 140000000000000000000 &gt; 很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。 交易转账 现在我们从节点1的coinbase账户发一笔交易到节点2的coinbase账户。 &gt; personal.unlockAccount(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) Unlock account 0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e Passphrase: true &gt; eth.sendTransaction({from: eth.coinbase, to: &#39;0x02b7344004c45465796f779b7b95d7912c2ef572&#39;, value: 100000000}) INFO [12-28|20:13:21] Submitted transaction fullhash=0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0 recipient=0x02b7344004c45465796F779B7b95d7912C2eF572 &quot;0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0&quot; &gt; 解锁账户并发送1币交易信息。现在查看一下节点2的地址内是否有余额： &gt; eth.getBalance(&quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;) 0 &gt; 发现余额是0，为什么呢？因为虽然我们发起了交易，单并没有矿工挖矿打包交易。再次执行miner.start()。再次查询，就会发现节点2的coinbase地址已经有金额了。 &gt; eth.getBalance(&quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;) 100000000 通过以上的操作我们已经建立了一个拥有两个节点的联盟链，如果想建立更多节点的联盟链，可以此添加新的节点。 注意事项 需要注意的是，如果一个节点重启，则需要重新添加peer。另外，在实际生产中可去掉console命令，通过之前介绍的attach命令进入控制台。 更多资讯 或许更多相关资讯可关注微信公众号：《程序新视界》和知识星球（小密圈），为你解疑答惑。也可加入QQ技术群（659809063）进行交流。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/12/28/e3955c2e516e2cfb2e68592936068ab7.html" />
<meta property="og:url" content="https://mlh.app/2017/12/28/e3955c2e516e2cfb2e68592936068ab7.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-12-28T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"如何启动geth节点对大家来说已经不是什么难事，今天博主就带大家学习一下如何搭建两个节点的联盟链。 私有链的创建 在之前的文章中我们已经讲到过私有链的创建，本篇文章我们会有道私有链创建的知识，就重新温故一下。创建私有链首先需要指定创始块的配置，也就是genesis.json的配置。此文件就是一个内容格式为json的文本文件。 配置文件的内容格式基本如下： { &quot;alloc&quot;: {}, &quot;config&quot;: { &quot;chainID&quot;: 72, &quot;homesteadBlock&quot;: 0, &quot;eip155Block&quot;: 0, &quot;eip158Block&quot;: 0 }, &quot;nonce&quot;: &quot;0x0000000000000000&quot;, &quot;difficulty&quot;: &quot;0x4000&quot;, &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;, &quot;timestamp&quot;: &quot;0x00&quot;, &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;extraData&quot;: &quot;0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa&quot;, &quot;gasLimit&quot;: &quot;0xffffffff&quot; } 配置项简介 我们对配置项的内容进行一下简单的介绍。 alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以不需要预置有币的账号，需要的时候自己创建即可以。实例代码如下： &quot;alloc&quot;: { &quot;de1e758511a7c67e7db93d1c23c1060a21db4615&quot;: { &quot;balance&quot;: &quot;1000&quot; }, &quot;27dc8de9e9a1cb673543bd5fce89e83af09e228f&quot;: { &quot;balance&quot;: &quot;1100&quot; }, &quot;d64a66c28a6ae5150af5e7c34696502793b91ae7&quot;: { &quot;balance&quot;: &quot;900&quot; } nonce:一个64位随机数，用于挖矿，和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4.Block Header Validity (44)章节所描述的条件。 difficulty: 设置计算区块的难度，如果数值过大，挖矿时间较长，在测试环境为节省算力和等带时间可设置较小值。 mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。 coinbase: 矿工账号，随便填写。 timestamp: 设置创世块的时间戳。 parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0。 extraData: 附加信息，随便填，可以填你的个性信息，必须为十六进制的字符串。 gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为是私有链，所以填最大。 创世块初始化 本教程以mac操作系统为例，其他操作系统可对照执行。 执行以下命令来启动初始化创世块的命令，最简单的一组操作就是制定dir文件路径，和初始化文件目录。前面我们已经写好了genesis.json的配置文件，下面就执行一下初始化操作，涉及到操作参数为init。 ershixiongdeMacBook-Pro:geth zzs$ ./geth --datadir ./data-init1/ init genesis.json 本教程将初始化json文件放在geth同级目录下，如果放在其他目录下，指定具体的路径即可。同时创建了一个data-init1目录专门存储节点数据，执行完成会发现在该目录下多出两个目录，一个为geth一个为keystore。其中geth里面放数据相关信息，keystore里面放加密过的私钥文件。 执行时打印日志如下： WARN [12-28|19:12:03] No etherbase set and no accounts found as default INFO [12-28|19:12:03] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init1/geth/chaindata cache=16 handles=16 INFO [12-28|19:12:03] Writing custom genesis block INFO [12-28|19:12:03] Successfully wrote genesis state database=chaindata hash=942f59…a2588a INFO [12-28|19:12:03] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init1/geth/lightchaindata cache=16 handles=16 INFO [12-28|19:12:03] Writing custom genesis block INFO [12-28|19:12:03] Successfully wrote genesis state database=lightchaindata hash=942f59…a2588a 经过以上命令，我们已经完成了私有连的初始化工作。因为我们要建立联盟链，因此需要再创建执行一遍同样的命令，json文件必须相同，datadir目录必须不同。博主使用data-init2目录来存储第二个节点的数据。 ershixiongdeMacBook-Pro:geth zzs$ ./geth --datadir ./data-init2/ init genesis.json 启动并进入控制台 根据具体的操作系统，开两个窗口来启动两个节点。这里有一点需要注意的是，虽然是两个节点，但他们的启动程序都是geth，只不过datadir目录不同而已。 在第一个窗口执行以下命令启动一个节点，注意启动之后不要关闭窗口。 ./geth --datadir ./data-init1/ --networkid 88 --nodiscover console 参数简介： networkid 指定网路ID，确保不适用1-4。 nodiscover 此参数确保geth不去寻找peers，主要是为了严格控制联盟链连入的节点。 这里我们需要注意的是在启动第一个节点时并没有指定port参数，因此此处采用了默认的port，也就是30303。 以下为执行时打印的日志，并进入控制台。通过日志我们也可以发现端口为30303。 WARN [12-28|19:23:16] No etherbase set and no accounts found as default INFO [12-28|19:23:16] Starting peer-to-peer node instance=Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2 INFO [12-28|19:23:16] Allocated cache and file handles database=/Users/zzs/develop/eth/geth/data-init2/geth/chaindata cache=128 handles=1024 WARN [12-28|19:23:16] Upgrading database to use lookup entries INFO [12-28|19:23:16] Database deduplication successful deduped=0 INFO [12-28|19:23:16] Initialised chain configuration config=&quot;{ChainID: 72 Homestead: 0 DAO: &lt;nil&gt; DAOSupport: false EIP150: &lt;nil&gt; EIP155: 0 EIP158: 0 Byzantium: &lt;nil&gt; Engine: unknown}&quot; INFO [12-28|19:23:16] Disk storage enabled for ethash caches dir=/Users/zzs/develop/eth/geth/data-init2/geth/ethash count=3 INFO [12-28|19:23:16] Disk storage enabled for ethash DAGs dir=/Users/zzs/.ethash count=2 INFO [12-28|19:23:16] Initialising Ethereum protocol versions=&quot;[63 62]&quot; network=88 INFO [12-28|19:23:16] Loaded most recent local header number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Loaded most recent local full block number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Loaded most recent local fast block number=0 hash=942f59…a2588a td=16384 INFO [12-28|19:23:16] Regenerated local transaction journal transactions=0 accounts=0 INFO [12-28|19:23:16] Starting P2P networking INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; INFO [12-28|19:23:16] IPC endpoint opened: /Users/zzs/develop/eth/geth/data-init2/geth.ipc Welcome to the Geth JavaScript console! instance: Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 &gt; INFO [12-28|19:23:18] Mapped network port proto=tcp extport=30303 intport=30303 interface=&quot;UPNP IGDv1-IP1&quot; 下面在另外一个窗口，换一个端口，比如30306，再换一下datadir，来启动第二个节点。 ./geth --datadir ./data-init2/ --port 30306 --networkid 88 --nodiscover console 执行上面命令，完成节点2的启动，并进入控制台。 添加coinbase账户 上面的日志我们也看到警告信息，提示没有账户存在，那么现在我们就在第一个节点上创建一个账户，具体在控制台操作命令如下： &gt; personal.listAccounts [] &gt; personal.newAccount(&quot;123456&quot;) &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; &gt; 上面的命令先是查看了节点下的地址，结果为空，然后创建了一个秘密为123456的账号。 同样的，在另外一个窗口我们执行同样的命令： &gt; personal.listAccounts [] &gt; personal.newAccount(&quot;123456&quot;) &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot; &gt; 这样，两个节点就拥有了两个地址。同时，在它们的keystore目录下对应生成了加密的私钥文件。 我们也可以再次执行list命令查看添加账户之后的情况。同时可以执行以下命令查看coinbase账号： &gt; eth.coinbase &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot; &gt; 由于只有一个地址，因此该地址就作为coinbase地址。如果想查看更多的信息可以执行以下命令： &gt; personal.listWallets [{ accounts: [{ address: &quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;, url: &quot;keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572&quot; }], status: &quot;Locked&quot;, url: &quot;keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572&quot; }] 这里不仅打印了账户信息，还打印出了私钥存储的位置和账户状态等信息。 联盟链互通 上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。 &gt; admin.peers [] 发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。 下面就通过分享enode地址的方式来让两个节点建立链接。 &gt; admin.nodeInfo.enode &quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot; &gt; 通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。 其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如： INFO [12-28|19:23:16] RLPx listener up self=&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0&quot; 现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令： &gt; admin.addPeer(&quot;enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0&quot;) true 返回true，说明执行成功。再次验证一下： &gt; admin.peers [{ caps: [&quot;eth/63&quot;], id: &quot;aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c&quot;, name: &quot;Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2&quot;, network: { localAddress: &quot;[::1]:49426&quot;, remoteAddress: &quot;[::1]:30306&quot; }, protocols: { eth: { difficulty: 16384, head: &quot;0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a&quot;, version: 63 } } }] &gt; 发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。 查询余额并挖矿 执行查看余额命令： &gt; eth.getBalance(eth.coinbase） 0 &gt; 发现两个节点的账号余额都为0。 在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。 当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息： &gt; INFO [12-28|20:05:32] Block synchronisation started INFO [12-28|20:05:33] Imported new state entries count=1 elapsed=47.661µs processed=1 pending=0 retry=0 duplicate=0 unexpected=0 WARN [12-28|20:05:33] Discarded bad propagated block number=1 hash=ab49ba…1cf32f INFO [12-28|20:05:33] Imported new block headers count=2 elapsed=9.208ms number=2 hash=738225…000e3b ignored=0 INFO [12-28|20:05:33] Imported new chain segment blocks=2 txs=0 mgas=0.000 elapsed=1.724ms mgasps=0.000 number=2 hash=738225…000e3b INFO [12-28|20:05:33] Fast sync complete, auto disabling INFO [12-28|20:05:34] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=5.978ms mgasps=0.000 number=3 hash=b069a9…426060 INFO [12-28|20:05:38] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.930ms mgasps=0.000 number=4 hash=21217e…526253 INFO [12-28|20:05:41] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.419ms mgasps=0.000 number=5 hash=3fa6ff…cf2794 INFO [12-28|20:05:43] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.557ms mgasps=0.000 number=6 hash=4c35b9…78b3ec INFO [12-28|20:05:45] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.514ms mgasps=0.000 number=7 hash=328e62…1bd3d3 INFO [12-28|20:05:46] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.513ms mgasps=0.000 number=8 hash=12287e…0465b5 INFO [12-28|20:06:19] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=7.048ms mgasps=0.000 number=9 hash=8e844b…b99d6c INFO [12-28|20:06:22] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=8.156ms mgasps=0.000 number=10 hash=159b36…d4dde5 INFO [12-28|20:06:24] Imported new chain segment blocks=1 txs=0 mgas=0.000 elapsed=6.549ms mgasps=0.000 number=11 hash=969100…5658a5 也就是说，节点1挖矿，节点2在同步数据信息。 停止节点1的挖矿，并查看coinbase地址金额： &gt; miner.stop() true &gt; eth.getBalance(eth.coinbase) 140000000000000000000 &gt; eth.coinbase &quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot; 这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息： &gt; eth.getBalance(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) 140000000000000000000 &gt; 很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。 交易转账 现在我们从节点1的coinbase账户发一笔交易到节点2的coinbase账户。 &gt; personal.unlockAccount(&quot;0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e&quot;) Unlock account 0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e Passphrase: true &gt; eth.sendTransaction({from: eth.coinbase, to: &#39;0x02b7344004c45465796f779b7b95d7912c2ef572&#39;, value: 100000000}) INFO [12-28|20:13:21] Submitted transaction fullhash=0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0 recipient=0x02b7344004c45465796F779B7b95d7912C2eF572 &quot;0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0&quot; &gt; 解锁账户并发送1币交易信息。现在查看一下节点2的地址内是否有余额： &gt; eth.getBalance(&quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;) 0 &gt; 发现余额是0，为什么呢？因为虽然我们发起了交易，单并没有矿工挖矿打包交易。再次执行miner.start()。再次查询，就会发现节点2的coinbase地址已经有金额了。 &gt; eth.getBalance(&quot;0x02b7344004c45465796f779b7b95d7912c2ef572&quot;) 100000000 通过以上的操作我们已经建立了一个拥有两个节点的联盟链，如果想建立更多节点的联盟链，可以此添加新的节点。 注意事项 需要注意的是，如果一个节点重启，则需要重新添加peer。另外，在实际生产中可去掉console命令，通过之前介绍的attach命令进入控制台。 更多资讯 或许更多相关资讯可关注微信公众号：《程序新视界》和知识星球（小密圈），为你解疑答惑。也可加入QQ技术群（659809063）进行交流。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/12/28/e3955c2e516e2cfb2e68592936068ab7.html","headline":"以太坊如何搭建私有连联盟链","dateModified":"2017-12-28T00:00:00+08:00","datePublished":"2017-12-28T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/12/28/e3955c2e516e2cfb2e68592936068ab7.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊如何搭建私有连联盟链</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>如何启动geth节点对大家来说已经不是什么难事，今天博主就带大家学习一下如何搭建两个节点的联盟链。</p> 
  <h2 id="私有链的创建">私有链的创建</h2> 
  <p>在之前的文章中我们已经讲到过私有链的创建，本篇文章我们会有道私有链创建的知识，就重新温故一下。创建私有链首先需要指定创始块的配置，也就是genesis.json的配置。此文件就是一个内容格式为json的文本文件。</p> 
  <p>配置文件的内容格式基本如下：</p> 
  <pre class="prettyprint"><code class=" hljs json">{
 "<span class="hljs-attribute">alloc</span>": <span class="hljs-value">{}</span>,
 "<span class="hljs-attribute">config</span>": <span class="hljs-value">{ "<span class="hljs-attribute">chainID</span>": <span class="hljs-value"><span class="hljs-number">72</span></span>, "<span class="hljs-attribute">homesteadBlock</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">eip155Block</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>, "<span class="hljs-attribute">eip158Block</span>": <span class="hljs-value"><span class="hljs-number">0</span> </span>}</span>,
 "<span class="hljs-attribute">nonce</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000"</span></span>,
 "<span class="hljs-attribute">difficulty</span>": <span class="hljs-value"><span class="hljs-string">"0x4000"</span></span>,
 "<span class="hljs-attribute">mixhash</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span></span>,
 "<span class="hljs-attribute">coinbase</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000"</span></span>,
 "<span class="hljs-attribute">timestamp</span>": <span class="hljs-value"><span class="hljs-string">"0x00"</span></span>,
 "<span class="hljs-attribute">parentHash</span>": <span class="hljs-value"><span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span></span>,
 "<span class="hljs-attribute">extraData</span>": <span class="hljs-value"><span class="hljs-string">"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"</span></span>,
 "<span class="hljs-attribute">gasLimit</span>": <span class="hljs-value"><span class="hljs-string">"0xffffffff"</span> </span>}
</code></pre> 
  <h2 id="配置项简介">配置项简介</h2> 
  <p>我们对配置项的内容进行一下简单的介绍。</p> 
  <p>alloc: 用来预置账号以及账号的以太币数量，因为私有链挖矿比较容易，所以不需要预置有币的账号，需要的时候自己创建即可以。实例代码如下：</p> 
  <pre class="prettyprint"><code class=" hljs bash"><span class="hljs-string">"alloc"</span>: {
    <span class="hljs-string">"de1e758511a7c67e7db93d1c23c1060a21db4615"</span>: {
      <span class="hljs-string">"balance"</span>: <span class="hljs-string">"1000"</span>
    },
    <span class="hljs-string">"27dc8de9e9a1cb673543bd5fce89e83af09e228f"</span>: {
      <span class="hljs-string">"balance"</span>: <span class="hljs-string">"1100"</span>
    },
    <span class="hljs-string">"d64a66c28a6ae5150af5e7c34696502793b91ae7"</span>: {
      <span class="hljs-string">"balance"</span>: <span class="hljs-string">"900"</span>
    }</code></pre> 
  <p>nonce:一个64位随机数，用于挖矿，和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4.Block Header Validity (44)章节所描述的条件。</p> 
  <p>difficulty: 设置计算区块的难度，如果数值过大，挖矿时间较长，在测试环境为节省算力和等带时间可设置较小值。</p> 
  <p>mixhash：与nonce配合用于挖矿，由上一个区块的一部分生成的hash。和nonce的设置需要满足以太坊的Yellow paper, 4.3.4. Block Header Validity, (44)章节所描述的条件。</p> 
  <p>coinbase: 矿工账号，随便填写。</p> 
  <p>timestamp: 设置创世块的时间戳。</p> 
  <p>parentHash: 上一个区块的hash值，因为是创世块，所以这个值是0。</p> 
  <p>extraData: 附加信息，随便填，可以填你的个性信息，必须为十六进制的字符串。</p> 
  <p>gasLimit: 该值设置对GAS的消耗总量限制，用来限制区块能包含的交易信息总和，因为是私有链，所以填最大。</p> 
  <h2 id="创世块初始化">创世块初始化</h2> 
  <p>本教程以mac操作系统为例，其他操作系统可对照执行。 <br> 执行以下命令来启动初始化创世块的命令，最简单的一组操作就是制定dir文件路径，和初始化文件目录。前面我们已经写好了genesis.json的配置文件，下面就执行一下初始化操作，涉及到操作参数为init。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">ershixiongdeMacBook<span class="hljs-attribute">-Pro</span>:geth zzs$ <span class="hljs-built_in">.</span>/geth <span class="hljs-subst">--</span>datadir <span class="hljs-built_in">.</span>/<span class="hljs-built_in">data</span><span class="hljs-attribute">-init1</span><span class="hljs-subst">/</span> init genesis<span class="hljs-built_in">.</span>json</code></pre> 
  <p>本教程将初始化json文件放在geth同级目录下，如果放在其他目录下，指定具体的路径即可。同时创建了一个data-init1目录专门存储节点数据，执行完成会发现在该目录下多出两个目录，一个为geth一个为keystore。其中geth里面放数据相关信息，keystore里面放加密过的私钥文件。</p> 
  <p>执行时打印日志如下：</p> 
  <pre class="prettyprint"><code class=" hljs sql">WARN [12-28|19:12:03] No etherbase <span class="hljs-operator"><span class="hljs-keyword">set</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">no</span> accounts <span class="hljs-keyword">found</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">03</span>] Allocated cache <span class="hljs-keyword">and</span> file handles <span class="hljs-keyword">database</span>=/Users/zzs/develop/eth/geth/data-init1/geth/chaindata cache=<span class="hljs-number">16</span> handles=<span class="hljs-number">16</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">03</span>] Writing custom genesis block INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">03</span>] Successfully wrote genesis state <span class="hljs-keyword">database</span>=chaindata hash=<span class="hljs-number">942</span>f59…a2588a INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">03</span>] Allocated cache <span class="hljs-keyword">and</span> file handles <span class="hljs-keyword">database</span>=/Users/zzs/develop/eth/geth/data-init1/geth/lightchaindata cache=<span class="hljs-number">16</span> handles=<span class="hljs-number">16</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">03</span>] Writing custom genesis block INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">03</span>] Successfully wrote genesis state <span class="hljs-keyword">database</span>=lightchaindata hash=<span class="hljs-number">942</span>f59…a2588a</span></code></pre> 
  <p>经过以上命令，我们已经完成了私有连的初始化工作。因为我们要建立联盟链，因此需要再创建执行一遍同样的命令，json文件必须相同，datadir目录必须不同。博主使用data-init2目录来存储第二个节点的数据。</p> 
  <pre class="prettyprint"><code class=" hljs lasso">ershixiongdeMacBook<span class="hljs-attribute">-Pro</span>:geth zzs$ <span class="hljs-built_in">.</span>/geth <span class="hljs-subst">--</span>datadir <span class="hljs-built_in">.</span>/<span class="hljs-built_in">data</span><span class="hljs-attribute">-init2</span><span class="hljs-subst">/</span> init genesis<span class="hljs-built_in">.</span>json</code></pre> 
  <h2 id="启动并进入控制台">启动并进入控制台</h2> 
  <p>根据具体的操作系统，开两个窗口来启动两个节点。这里有一点需要注意的是，虽然是两个节点，但他们的启动程序都是geth，只不过datadir目录不同而已。 <br> 在第一个窗口执行以下命令启动一个节点，注意启动之后不要关闭窗口。</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-string">.</span><span class="hljs-comment">/geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-string">.</span><span class="hljs-comment">/data</span><span class="hljs-literal">-</span><span class="hljs-comment">init1/</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">networkid</span> <span class="hljs-comment">88</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">nodiscover</span> <span class="hljs-comment">console</span></code></pre> 
  <p>参数简介：</p> 
  <p>networkid 指定网路ID，确保不适用1-4。</p> 
  <p>nodiscover 此参数确保geth不去寻找peers，主要是为了严格控制联盟链连入的节点。</p> 
  <p>这里我们需要注意的是在启动第一个节点时并没有指定port参数，因此此处采用了默认的port，也就是30303。 <br> 以下为执行时打印的日志，并进入控制台。通过日志我们也可以发现端口为30303。</p> 
  <pre class="prettyprint"><code class=" hljs sql">WARN [12-28|19:23:16] No etherbase <span class="hljs-operator"><span class="hljs-keyword">set</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">no</span> accounts <span class="hljs-keyword">found</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Starting peer-<span class="hljs-keyword">to</span>-peer node instance=Geth/v1<span class="hljs-number">.7</span><span class="hljs-number">.3</span>-stable-<span class="hljs-number">4</span>bb3c89d/darwin-amd64/go1<span class="hljs-number">.9</span><span class="hljs-number">.2</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Allocated cache <span class="hljs-keyword">and</span> file handles <span class="hljs-keyword">database</span>=/Users/zzs/develop/eth/geth/data-init2/geth/chaindata cache=<span class="hljs-number">128</span> handles=<span class="hljs-number">1024</span> WARN [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Upgrading <span class="hljs-keyword">database</span> <span class="hljs-keyword">to</span> use lookup entries INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] <span class="hljs-keyword">Database</span> deduplication successful deduped=<span class="hljs-number">0</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Initialised chain configuration config=<span class="hljs-string">"{ChainID: 72 Homestead: 0 DAO: &lt;nil&gt; DAOSupport: false EIP150: &lt;nil&gt; EIP155: 0 EIP158: 0 Byzantium: &lt;nil&gt; Engine: unknown}"</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Disk storage enabled <span class="hljs-keyword">for</span> ethash caches dir=/Users/zzs/develop/eth/geth/data-init2/geth/ethash <span class="hljs-aggregate">count</span>=<span class="hljs-number">3</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Disk storage enabled <span class="hljs-keyword">for</span> ethash DAGs dir=/Users/zzs/.ethash <span class="hljs-aggregate">count</span>=<span class="hljs-number">2</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Initialising Ethereum protocol versions=<span class="hljs-string">"[63 62]"</span> network=<span class="hljs-number">88</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Loaded most recent <span class="hljs-keyword">local</span> header <span class="hljs-keyword">number</span>=<span class="hljs-number">0</span> hash=<span class="hljs-number">942</span>f59…a2588a td=<span class="hljs-number">16384</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Loaded most recent <span class="hljs-keyword">local</span> <span class="hljs-keyword">full</span> block <span class="hljs-keyword">number</span>=<span class="hljs-number">0</span> hash=<span class="hljs-number">942</span>f59…a2588a td=<span class="hljs-number">16384</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Loaded most recent <span class="hljs-keyword">local</span> fast block <span class="hljs-keyword">number</span>=<span class="hljs-number">0</span> hash=<span class="hljs-number">942</span>f59…a2588a td=<span class="hljs-number">16384</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Regenerated <span class="hljs-keyword">local</span> <span class="hljs-keyword">transaction</span> journal transactions=<span class="hljs-number">0</span> accounts=<span class="hljs-number">0</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] Starting P2P networking INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] RLPx listener up self=<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0"</span> INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] IPC endpoint opened: /Users/zzs/develop/eth/geth/data-init2/geth.ipc Welcome <span class="hljs-keyword">to</span> the Geth JavaScript console! instance: Geth/v1<span class="hljs-number">.7</span><span class="hljs-number">.3</span>-stable-<span class="hljs-number">4</span>bb3c89d/darwin-amd64/go1<span class="hljs-number">.9</span><span class="hljs-number">.2</span> modules: admin:<span class="hljs-number">1.0</span> debug:<span class="hljs-number">1.0</span> eth:<span class="hljs-number">1.0</span> miner:<span class="hljs-number">1.0</span> net:<span class="hljs-number">1.0</span> personal:<span class="hljs-number">1.0</span> rpc:<span class="hljs-number">1.0</span> txpool:<span class="hljs-number">1.0</span> web3:<span class="hljs-number">1.0</span> &gt; INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span>:<span class="hljs-number">23</span>:<span class="hljs-number">18</span>] Mapped network port proto=tcp extport=<span class="hljs-number">30303</span> intport=<span class="hljs-number">30303</span> interface=<span class="hljs-string">"UPNP IGDv1-IP1"</span></span></code></pre> 
  <p>下面在另外一个窗口，换一个端口，比如30306，再换一下datadir，来启动第二个节点。</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-string">.</span><span class="hljs-comment">/geth</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">datadir</span> <span class="hljs-string">.</span><span class="hljs-comment">/data</span><span class="hljs-literal">-</span><span class="hljs-comment">init2/</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">port</span> <span class="hljs-comment">30306</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">networkid</span> <span class="hljs-comment">88</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">nodiscover</span> <span class="hljs-comment">console</span></code></pre> 
  <p>执行上面命令，完成节点2的启动，并进入控制台。</p> 
  <h2 id="添加coinbase账户">添加coinbase账户</h2> 
  <p>上面的日志我们也看到警告信息，提示没有账户存在，那么现在我们就在第一个节点上创建一个账户，具体在控制台操作命令如下：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; personal<span class="hljs-preprocessor">.listAccounts</span>
[]
&gt; personal<span class="hljs-preprocessor">.newAccount</span>(<span class="hljs-string">"123456"</span>)
<span class="hljs-string">"0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e"</span>
&gt;</code></pre> 
  <p>上面的命令先是查看了节点下的地址，结果为空，然后创建了一个秘密为123456的账号。</p> 
  <p>同样的，在另外一个窗口我们执行同样的命令：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; personal<span class="hljs-preprocessor">.listAccounts</span>
[]
&gt; personal<span class="hljs-preprocessor">.newAccount</span>(<span class="hljs-string">"123456"</span>)
<span class="hljs-string">"0x02b7344004c45465796f779b7b95d7912c2ef572"</span>
&gt;</code></pre> 
  <p>这样，两个节点就拥有了两个地址。同时，在它们的keystore目录下对应生成了加密的私钥文件。</p> 
  <p>我们也可以再次执行list命令查看添加账户之后的情况。同时可以执行以下命令查看coinbase账号：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0x02b7344004c45465796f779b7b95d7912c2ef572"</span>
&gt;</code></pre> 
  <p>由于只有一个地址，因此该地址就作为coinbase地址。如果想查看更多的信息可以执行以下命令：</p> 
  <pre class="prettyprint"><code class=" hljs profile">&gt; <span class="hljs-filename">personal.listWallets [{ accounts</span>: [{<span class="hljs-built_in"> address: <span class="hljs-string">"0x02b7344004c45465796f779b7b95d7912c2ef572"</span>, url: <span class="hljs-string">"keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572"</span> }], status: <span class="hljs-string">"Locked"</span>, url: <span class="hljs-string">"keystore:///Users/zzs/develop/eth/geth/data-init2/keystore/UTC--2017-12-28T11-36-18.185974427Z--02b7344004c45465796f779b7b95d7912c2ef572"</span> }]</span></code></pre> 
  <p>这里不仅打印了账户信息，还打印出了私钥存储的位置和账户状态等信息。</p> 
  <h2 id="联盟链互通">联盟链互通</h2> 
  <p>上面分别是在两个节点上进行的操作，下面我们需要把两个节点之间建立起链接。首先，我们执行以下命令查看以下节点的peers的情况。</p> 
  <pre class="prettyprint"><code class=" hljs markdown"><span class="hljs-blockquote">&gt; admin.peers</span>
[]</code></pre> 
  <p>发现节点并没有链接上任何其他节点，这也是我们的nodiscover参数发挥了效果。</p> 
  <p>下面就通过分享enode地址的方式来让两个节点建立链接。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; admin<span class="hljs-preprocessor">.nodeInfo</span><span class="hljs-preprocessor">.enode</span>
<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0"</span>
&gt;</code></pre> 
  <p>通过上面命令，我们获得了节点2的encode信息。这是geth用来连接到不同节点的enode信息，在这些不同的节点它们能够分享交易和成功挖掘信息。</p> 
  <p>其实这个信息如果留心的话，在启动节点的打印日志中已经打印出每个节点的encode信息。比如：</p> 
  <pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-constant">INFO</span> [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">23</span><span class="hljs-symbol">:</span><span class="hljs-number">16</span>] <span class="hljs-constant">RLPx</span> listener up                         <span class="hljs-keyword">self</span>=<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30303?discport=0"</span></code></pre> 
  <p>现在，我们要告知一个节点，另外一个节点的encode信息。首先复制节点2的日志中self等号后面的信息，在节点1的控制台执行以下命令：</p> 
  <pre class="prettyprint"><code class=" hljs bash">&gt; admin.addPeer(<span class="hljs-string">"enode://aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c@[::]:30306?discport=0"</span>)
<span class="hljs-literal">true</span></code></pre> 
  <p>返回true，说明执行成功。再次验证一下：</p> 
  <pre class="prettyprint"><code class=" hljs applescript">&gt; admin.peers
[{
    caps: [<span class="hljs-string">"eth/63"</span>],
    <span class="hljs-property">id</span>: <span class="hljs-string">"aa621c010c685665ef217044dac4d57f4d1d682c682a5b3f92ca23b40982383240a05b680060ce8b0ce020a96c49c9c2c3628c4ea3281845211bd4cf4f03b35c"</span>,
    <span class="hljs-property">name</span>: <span class="hljs-string">"Geth/v1.7.3-stable-4bb3c89d/darwin-amd64/go1.9.2"</span>,
    network: {
      localAddress: <span class="hljs-string">"[::1]:49426"</span>,
      remoteAddress: <span class="hljs-string">"[::1]:30306"</span>
    },
    protocols: {
      eth: {
        difficulty: <span class="hljs-number">16384</span>,
        head: <span class="hljs-string">"0x942f596f99dc8879b426b59080824662e1f97587353d087487fea0a0e2a2588a"</span>,
        <span class="hljs-property">version</span>: <span class="hljs-number">63</span>
      }
    }
}]
&gt;</code></pre> 
  <p>发现节点1已经有一个peer了，同时我们可以看到remoteAddress: “[::1]:30306”，正是我们节点2的端口信息。在节点2执行admin.peers会发现有类似的信息，指向的peer正是节点1的。</p> 
  <h2 id="查询余额并挖矿">查询余额并挖矿</h2> 
  <p>执行查看余额命令：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.coinbase</span>）
<span class="hljs-number">0</span>
&gt;</code></pre> 
  <p>发现两个节点的账号余额都为0。</p> 
  <p>在节点1执行miner.start()进行挖矿，执行miner.stop()停止挖矿。停止挖矿的时候开业忽略控制台输出，只要正确拼写命令回车即可。</p> 
  <p>当我们在节点1执行挖矿时，我们会发现节点2的控制台出现了这样的日志信息：</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">32</span>] Block synchronisation started
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Imported <span class="hljs-built_in">new</span> state entries               count=<span class="hljs-number">1</span> elapsed=<span class="hljs-number">47.661</span>µs processed=<span class="hljs-number">1</span> pending=<span class="hljs-number">0</span> retry=<span class="hljs-number">0</span> duplicate=<span class="hljs-number">0</span> unexpected=<span class="hljs-number">0</span>
WARN [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Discarded bad propagated block           <span class="hljs-built_in">number</span>=<span class="hljs-number">1</span> hash=ab49ba…<span class="hljs-number">1</span>cf32f
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Imported <span class="hljs-built_in">new</span> block headers               count=<span class="hljs-number">2</span> elapsed=<span class="hljs-number">9.208</span>ms  <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">738225</span>…<span class="hljs-number">000e3</span>b ignored=<span class="hljs-number">0</span>
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">2</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">1.724</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">2</span> hash=<span class="hljs-number">738225</span>…<span class="hljs-number">000e3</span>b
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">33</span>] Fast sync complete, auto disabling
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">34</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">5.978</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">3</span> hash=b069a9…<span class="hljs-number">426060</span>
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">38</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.930</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">4</span> hash=<span class="hljs-number">21217</span>e…<span class="hljs-number">526253</span>
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">41</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.419</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">5</span> hash=<span class="hljs-number">3</span>fa6ff…cf2794
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">43</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.557</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">6</span> hash=<span class="hljs-number">4</span>c35b9…<span class="hljs-number">78</span>b3ec
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">45</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.514</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">7</span> hash=<span class="hljs-number">328e62</span>…<span class="hljs-number">1</span>bd3d3
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">05</span>:<span class="hljs-number">46</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.513</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">8</span> hash=<span class="hljs-number">12287</span>e…<span class="hljs-number">0465</span>b5
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">06</span>:<span class="hljs-number">19</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">7.048</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">9</span> hash=<span class="hljs-number">8e844</span>b…b99d6c
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">06</span>:<span class="hljs-number">22</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">8.156</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">10</span> hash=<span class="hljs-number">159</span>b36…d4dde5
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">06</span>:<span class="hljs-number">24</span>] Imported <span class="hljs-built_in">new</span> chain segment               blocks=<span class="hljs-number">1</span> txs=<span class="hljs-number">0</span> mgas=<span class="hljs-number">0.000</span> elapsed=<span class="hljs-number">6.549</span>ms  mgasps=<span class="hljs-number">0.000</span> <span class="hljs-built_in">number</span>=<span class="hljs-number">11</span> hash=<span class="hljs-number">969100</span>…<span class="hljs-number">5658</span>a5</code></pre> 
  <p>也就是说，节点1挖矿，节点2在同步数据信息。</p> 
  <p>停止节点1的挖矿，并查看coinbase地址金额：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; miner<span class="hljs-preprocessor">.stop</span>()
true
&gt; eth<span class="hljs-preprocessor">.getBalance</span>(eth<span class="hljs-preprocessor">.coinbase</span>)
<span class="hljs-number">140000000000000000000</span>
&gt; eth<span class="hljs-preprocessor">.coinbase</span>
<span class="hljs-string">"0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e"</span></code></pre> 
  <p>这里我们知道了节点一种的地址信息和余额信息，那我们拿节点1的这个地址在节点2的控制台查询一下信息：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(<span class="hljs-string">"0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e"</span>)
<span class="hljs-number">140000000000000000000</span>
&gt;</code></pre> 
  <p>很显然，节点2中也能查询到节点1中地址的余额。以上信息说明，节点1和节点2的数据是完全同步的。</p> 
  <h2 id="交易转账">交易转账</h2> 
  <p>现在我们从节点1的coinbase账户发一笔交易到节点2的coinbase账户。</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">&gt; personal.unlockAccount(<span class="hljs-string">"0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e"</span>)
Unlock account <span class="hljs-number">0x60c8abe58c9dbc52a4ee9f8510f1799c432c0f3e</span>
Passphrase:
<span class="hljs-constant">true</span>
&gt; eth.sendTransaction({<span class="hljs-built_in">from</span>: eth.coinbase, <span class="hljs-built_in">to</span>: <span class="hljs-string">'0x02b7344004c45465796f779b7b95d7912c2ef572'</span>, <span class="hljs-built_in">value</span>: <span class="hljs-number">100000000</span>})
INFO [<span class="hljs-number">12</span>-<span class="hljs-number">28</span>|<span class="hljs-number">20</span>:<span class="hljs-number">13</span>:<span class="hljs-number">21</span>] Submitted transaction                    fullhash=<span class="hljs-number">0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0</span> recipient=<span class="hljs-number">0x02b7344004c45465796F779B7b95d7912C2eF572</span>
<span class="hljs-string">"0xc32e40f0f606a6368aa2c4c6a27db20f5a1d728fb9ef1f50a0410f4889e095a0"</span>
&gt;</code></pre> 
  <p>解锁账户并发送1币交易信息。现在查看一下节点2的地址内是否有余额：</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(<span class="hljs-string">"0x02b7344004c45465796f779b7b95d7912c2ef572"</span>)
<span class="hljs-number">0</span>
&gt;</code></pre> 
  <p>发现余额是0，为什么呢？因为虽然我们发起了交易，单并没有矿工挖矿打包交易。再次执行miner.start()。再次查询，就会发现节点2的coinbase地址已经有金额了。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">&gt; eth<span class="hljs-preprocessor">.getBalance</span>(<span class="hljs-string">"0x02b7344004c45465796f779b7b95d7912c2ef572"</span>)
<span class="hljs-number">100000000</span></code></pre> 
  <p>通过以上的操作我们已经建立了一个拥有两个节点的联盟链，如果想建立更多节点的联盟链，可以此添加新的节点。</p> 
  <h2 id="注意事项">注意事项</h2> 
  <p>需要注意的是，如果一个节点重启，则需要重新添加peer。另外，在实际生产中可去掉console命令，通过之前介绍的attach命令进入控制台。</p> 
  <h2 id="更多资讯">更多资讯</h2> 
  <p>或许更多相关资讯可关注微信公众号：《程序新视界》和知识星球（小密圈），为你解疑答惑。也可加入QQ技术群（659809063）进行交流。 <br> <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170107104725766?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd281NDEwNzU3NTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170924110226518?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd281NDEwNzU3NTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wo541075754/article/details/78926177,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wo541075754/article/details/78926177,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

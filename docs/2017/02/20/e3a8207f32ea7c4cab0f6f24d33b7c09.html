<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>银联支付开发、使用的一些总结 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="银联支付开发、使用的一些总结" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，转载请注明出处。 https://blog.csdn.net/u010882234/article/details/56005197 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 现在的网页支付（PC和微信H5）和app支付，用的比较多的是微信支付、银联支付和支付宝支付，其余的是这些支付的第三方支付，我目前了解的只有这么多。我目前做了银联支付和微信支付，这里说一些银联支付的开发的一些介绍吧。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据我们公司的应用经验，银联支付时费率最低的，如果和银联商务谈判的好，自身的交易量比较大，费率可能更低（具体不能透露了）。银联支付一种是按百分比收取手续费，另一种按笔数收取手续费，例如，每笔0.9元。我们公司用了2种银联支付，一开始用的是银联支付，后来因费率问题，使用银联支付第三方平台--千引支付，实质上也是银联支付。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们申请的银联支付，在网上营业厅、微信服务号、Android和iOS平台都在使用，是“手机WAP支付产品”。主要用了2个接口，第一个是“消费类交易”，即银联支付申请接口。它也可以分为两部分，（1）通过拼接报文，签名加密，生成html网页，浏览器跳转请求到银联支付页面。此时，订单生成，用户可以在银联页面完成支付。（2）支付成功后，银联会根据请求参数里的配置，主动回调前台、后台通知地址，通知用户支付成功。第二个接口是“交易状态查询交易”，即查询订单交易结果。 &nbsp;&nbsp;&nbsp;&nbsp; 现在具体讲一下代码： &nbsp;&nbsp;&nbsp; 消费类交易接口：官方文档地址：https://open.unionpay.com/ajweb/help/api （1）交易申请。初始化证书，拼接报文，数据签名，创建表单或取得tn号。调用此接口，微信、网厅可得到一个html的https post表单，浏览器执行js自动提交，访问银联支付申请接口，跳转银联支付页面。此时，服务端只是拼接报文，签名加密，请求的动作，是用户的浏览器做的，可以保证银联支付的安全性。app端则是，调用接口，取得tn号，调用app已安装的银联控件跳往银联支付页面。 private String pc2UnionPay(String orderId, String incMoney, &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String txnTime) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 初始化证书 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SDKConfig.getConfig().loadPropertiesFromSrc();// 从classpath加载acp_sdk.properties文件 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 交易请求url 从配置文件读取 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String requestFrontUrl = SDKConfig.getConfig().getFrontRequestUrl(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 组装请求报文 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 版本号 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;version&quot;, &quot;5.0.0&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 字符集编码 默认&quot;UTF-8&quot; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = &quot;UTF-8&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;encoding&quot;, encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 签名方法 01 RSA &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;signMethod&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易类型 01-消费 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnType&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易子类型 01:自助消费 02:订购 03:分期付款 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnSubType&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 业务类型 000201 B2C网关支付 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;bizType&quot;, &quot;000201&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 渠道类型 07-互联网渠道 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;channelType&quot;, &quot;07&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单前台接收地址 选送 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 FrontRcvResponse.java &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;frontUrl&quot;, frontUrl); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单后台接收地址 必送 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 BackRcvResponse.java &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;backUrl&quot;, backUrl); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 接入类型:商户接入填0 0- 商户 ， 1： 收单， 2：平台商户 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;accessType&quot;, &quot;0&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户号码 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;merId&quot;, merId);// 898310049004002 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单号 商户根据自己规则定义生成，每订单日期内不重复 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;orderId&quot;, orderId); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单发送时间 格式： YYYYMMDDhhmmss 商户发送交易时间，根据自己系统或平台生成 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnTime&quot;, txnTime); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易金额 分 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnAmt&quot;, incMoney); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易币种 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;currencyCode&quot;, &quot;156&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 若报文中的数据元标识的key对应的value为空，不上送该报文域 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 创建表单 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String html = null; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 1; i &lt;= 3; i++) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;html = createHtml(requestFrontUrl, signData(data)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (html != null) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return html; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return &quot;服务器忙&quot;; &nbsp;&nbsp; &nbsp;} public static String createHtml(String action, Map&lt;String, String&gt; hiddens) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;StringBuffer sf = new StringBuffer(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=UTF-8\&quot;/&gt;&lt;/head&gt;&lt;body&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;form id = \&quot;pay_form\&quot; action=\&quot;&quot; + action &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ &quot;\&quot; method=\&quot;post\&quot;&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != hiddens &amp;&amp; 0 != hiddens.size()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Set&lt;Entry&lt;String, String&gt;&gt; set = hiddens.entrySet(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = set.iterator(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; ey = it.next(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = ey.getKey(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = ey.getValue(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;&quot; + key + &quot;\&quot; id=\&quot;&quot; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ key + &quot;\&quot; value=\&quot;&quot; + value + &quot;\&quot;/&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/form&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/body&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;document.all.pay_form.submit();&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/script&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/html&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return sf.toString(); &nbsp;&nbsp; &nbsp;} （2）支付成功通知商户。根据申请时取得的前后台通知地址，银联在支付成功后，会主动通知商户交易结果，但应以后台通知为准。前台应答是通过 浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联系统异步把交易状态为成功的交易通知给商户，失败交易不发送。前台应答及后台通知，商户都需要验签。 public class BackNoticeServlet extends HttpServlet { &nbsp;&nbsp; &nbsp;private static final long serialVersionUID = -900467945307979675L; &nbsp;&nbsp; &nbsp;@Override &nbsp;&nbsp; &nbsp;protected void service(HttpServletRequest request, HttpServletResponse response) &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;throws ServletException, IOException { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;try { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;后台接收银行通知开始……&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;BankService bService = (BankService) PayCache.getInstance().getBean(&quot;bankService&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;RechargeService service =&nbsp; (RechargeService)PayCache.getInstance().getBean(&quot;rechargeService&quot;); //&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;request.setCharacterEncoding(&quot;ISO-8859-1&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = request.getParameter(SDKConstants.param_encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 获取请求参数中所有的信息 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; reqParam = getAllRequestParam(request); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 打印请求报文 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.printRequestLog(reqParam); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; valideData = null; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != reqParam &amp;&amp; !reqParam.isEmpty()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = reqParam.entrySet() &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;.iterator(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData = new HashMap&lt;String, String&gt;(reqParam.size()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; e = it.next(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = (String) e.getKey(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = (String) e.getValue(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;value = new String(value.getBytes(&quot;ISO-8859-1&quot;), encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData.put(key, value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 验证签名 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (!SDKUtil.validate(valideData, encoding)) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;验证签名结果[失败].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} else { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;验证签名结果[成功].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 持久化银行返回的数据 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;持久化银行返回的数据&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String settleDate = reqParam.get(&quot;settleDate&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Calendar cal=Calendar.getInstance(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;settleDate = String.valueOf(cal.get(Calendar.YEAR)) + settleDate;//加上年份 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;reqParam.put(&quot;settleDate&quot;, settleDate); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.addPayresult(reqParam); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(&quot;00&quot;.equals(reqParam.get(&quot;respCode&quot;))){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.updOrder(reqParam.get(&quot;orderId&quot;),settleDate); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;返回银行数据给商户开始……&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;respCode&quot;, reqParam.get(&quot;respCode&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;respMsg&quot;, reqParam.get(&quot;respMsg&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;orderId&quot;, reqParam.get(&quot;orderId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnTime&quot;, reqParam.get(&quot;txnTime&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnAmt&quot;, reqParam.get(&quot;txnAmt&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;queryId&quot;, reqParam.get(&quot;queryId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;settleDate&quot;, reqParam.get(&quot;settleDate&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;settleAmt&quot;, reqParam.get(&quot;settleAmt&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnType&quot;, reqParam.get(&quot;txnType&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String statusCode = &quot;&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ProfitApplyOrder order = bService.queryOrder(reqParam.get(&quot;orderId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(int i=0;i&lt;5;i++){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;statusCode = XmlUtil.invokeMethod(res,order.getBackUrl()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(statusCode.equals(&quot;success&quot;)){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;返回银行数据给商户结束[成功].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;银行数据接受完成！&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} catch (Exception e) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;e.printStackTrace(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;接受银行数据失败:&quot; + e.getMessage()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} finally { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;response.setHeader(&quot;Content-type&quot;, &quot;text/html;charset=UTF-8&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;PrintWriter writer = response.getWriter(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.print(System.currentTimeMillis()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.flush(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;public static Map&lt;String, String&gt; getAllRequestParam( &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;final HttpServletRequest request) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Enumeration&lt;?&gt; temp = request.getParameterNames(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != temp) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (temp.hasMoreElements()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String en = (String) temp.nextElement(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = request.getParameter(en); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(en, value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 在报文上送时，如果字段的值为空，则不上送&lt;下面的处理为在获取所有参数数据时，判断若值为空，则删除这个字段&gt; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// System.out.println(&quot; temp数据的键==&quot;+en+&quot;&nbsp;&nbsp;&nbsp;&nbsp; 值===&quot;+value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null == res.get(en) || &quot;&quot;.equals(res.get(en))) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.remove(en); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return res; &nbsp;&nbsp; &nbsp;} } 交易状态查询交易：（以下摘自银联官方文档） 商户收到后台通知后，应根据通知报文中订单号等关键信息，更新系统中的订单支付状态。 商户在以下情况下，可主动发起交易状态查询，并根据查询结果更新交易状态。 (1)前台交易，在5分钟内未收到后台通知。 (2)后台交易，在1秒内未收到后台通知 。 (3)商户在特殊情况下没有正确处理后台通知，需要重新判定交易状态。 商户应注意对同一笔交易，对不同时间点可能先后收到的查询结果及后台通知进行合适的处理。 以上，此接口调用查询订单交易结果，是商户主动发起的，没什么好说的，把官方文档贴了一下。附上交易应答码地址：https://open.unionpay.com/ajweb/help?id=262 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，转载请注明出处。 https://blog.csdn.net/u010882234/article/details/56005197 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 现在的网页支付（PC和微信H5）和app支付，用的比较多的是微信支付、银联支付和支付宝支付，其余的是这些支付的第三方支付，我目前了解的只有这么多。我目前做了银联支付和微信支付，这里说一些银联支付的开发的一些介绍吧。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据我们公司的应用经验，银联支付时费率最低的，如果和银联商务谈判的好，自身的交易量比较大，费率可能更低（具体不能透露了）。银联支付一种是按百分比收取手续费，另一种按笔数收取手续费，例如，每笔0.9元。我们公司用了2种银联支付，一开始用的是银联支付，后来因费率问题，使用银联支付第三方平台--千引支付，实质上也是银联支付。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们申请的银联支付，在网上营业厅、微信服务号、Android和iOS平台都在使用，是“手机WAP支付产品”。主要用了2个接口，第一个是“消费类交易”，即银联支付申请接口。它也可以分为两部分，（1）通过拼接报文，签名加密，生成html网页，浏览器跳转请求到银联支付页面。此时，订单生成，用户可以在银联页面完成支付。（2）支付成功后，银联会根据请求参数里的配置，主动回调前台、后台通知地址，通知用户支付成功。第二个接口是“交易状态查询交易”，即查询订单交易结果。 &nbsp;&nbsp;&nbsp;&nbsp; 现在具体讲一下代码： &nbsp;&nbsp;&nbsp; 消费类交易接口：官方文档地址：https://open.unionpay.com/ajweb/help/api （1）交易申请。初始化证书，拼接报文，数据签名，创建表单或取得tn号。调用此接口，微信、网厅可得到一个html的https post表单，浏览器执行js自动提交，访问银联支付申请接口，跳转银联支付页面。此时，服务端只是拼接报文，签名加密，请求的动作，是用户的浏览器做的，可以保证银联支付的安全性。app端则是，调用接口，取得tn号，调用app已安装的银联控件跳往银联支付页面。 private String pc2UnionPay(String orderId, String incMoney, &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String txnTime) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 初始化证书 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SDKConfig.getConfig().loadPropertiesFromSrc();// 从classpath加载acp_sdk.properties文件 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 交易请求url 从配置文件读取 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String requestFrontUrl = SDKConfig.getConfig().getFrontRequestUrl(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 组装请求报文 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 版本号 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;version&quot;, &quot;5.0.0&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 字符集编码 默认&quot;UTF-8&quot; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = &quot;UTF-8&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;encoding&quot;, encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 签名方法 01 RSA &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;signMethod&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易类型 01-消费 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnType&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易子类型 01:自助消费 02:订购 03:分期付款 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnSubType&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 业务类型 000201 B2C网关支付 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;bizType&quot;, &quot;000201&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 渠道类型 07-互联网渠道 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;channelType&quot;, &quot;07&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单前台接收地址 选送 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 FrontRcvResponse.java &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;frontUrl&quot;, frontUrl); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单后台接收地址 必送 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 BackRcvResponse.java &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;backUrl&quot;, backUrl); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 接入类型:商户接入填0 0- 商户 ， 1： 收单， 2：平台商户 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;accessType&quot;, &quot;0&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户号码 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;merId&quot;, merId);// 898310049004002 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单号 商户根据自己规则定义生成，每订单日期内不重复 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;orderId&quot;, orderId); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单发送时间 格式： YYYYMMDDhhmmss 商户发送交易时间，根据自己系统或平台生成 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnTime&quot;, txnTime); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易金额 分 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnAmt&quot;, incMoney); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易币种 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;currencyCode&quot;, &quot;156&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 若报文中的数据元标识的key对应的value为空，不上送该报文域 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 创建表单 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String html = null; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 1; i &lt;= 3; i++) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;html = createHtml(requestFrontUrl, signData(data)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (html != null) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return html; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return &quot;服务器忙&quot;; &nbsp;&nbsp; &nbsp;} public static String createHtml(String action, Map&lt;String, String&gt; hiddens) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;StringBuffer sf = new StringBuffer(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=UTF-8\&quot;/&gt;&lt;/head&gt;&lt;body&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;form id = \&quot;pay_form\&quot; action=\&quot;&quot; + action &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ &quot;\&quot; method=\&quot;post\&quot;&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != hiddens &amp;&amp; 0 != hiddens.size()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Set&lt;Entry&lt;String, String&gt;&gt; set = hiddens.entrySet(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = set.iterator(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; ey = it.next(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = ey.getKey(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = ey.getValue(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;&quot; + key + &quot;\&quot; id=\&quot;&quot; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ key + &quot;\&quot; value=\&quot;&quot; + value + &quot;\&quot;/&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/form&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/body&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;document.all.pay_form.submit();&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/script&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/html&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return sf.toString(); &nbsp;&nbsp; &nbsp;} （2）支付成功通知商户。根据申请时取得的前后台通知地址，银联在支付成功后，会主动通知商户交易结果，但应以后台通知为准。前台应答是通过 浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联系统异步把交易状态为成功的交易通知给商户，失败交易不发送。前台应答及后台通知，商户都需要验签。 public class BackNoticeServlet extends HttpServlet { &nbsp;&nbsp; &nbsp;private static final long serialVersionUID = -900467945307979675L; &nbsp;&nbsp; &nbsp;@Override &nbsp;&nbsp; &nbsp;protected void service(HttpServletRequest request, HttpServletResponse response) &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;throws ServletException, IOException { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;try { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;后台接收银行通知开始……&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;BankService bService = (BankService) PayCache.getInstance().getBean(&quot;bankService&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;RechargeService service =&nbsp; (RechargeService)PayCache.getInstance().getBean(&quot;rechargeService&quot;); //&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;request.setCharacterEncoding(&quot;ISO-8859-1&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = request.getParameter(SDKConstants.param_encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 获取请求参数中所有的信息 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; reqParam = getAllRequestParam(request); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 打印请求报文 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.printRequestLog(reqParam); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; valideData = null; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != reqParam &amp;&amp; !reqParam.isEmpty()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = reqParam.entrySet() &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;.iterator(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData = new HashMap&lt;String, String&gt;(reqParam.size()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; e = it.next(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = (String) e.getKey(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = (String) e.getValue(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;value = new String(value.getBytes(&quot;ISO-8859-1&quot;), encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData.put(key, value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 验证签名 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (!SDKUtil.validate(valideData, encoding)) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;验证签名结果[失败].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} else { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;验证签名结果[成功].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 持久化银行返回的数据 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;持久化银行返回的数据&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String settleDate = reqParam.get(&quot;settleDate&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Calendar cal=Calendar.getInstance(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;settleDate = String.valueOf(cal.get(Calendar.YEAR)) + settleDate;//加上年份 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;reqParam.put(&quot;settleDate&quot;, settleDate); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.addPayresult(reqParam); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(&quot;00&quot;.equals(reqParam.get(&quot;respCode&quot;))){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.updOrder(reqParam.get(&quot;orderId&quot;),settleDate); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;返回银行数据给商户开始……&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;respCode&quot;, reqParam.get(&quot;respCode&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;respMsg&quot;, reqParam.get(&quot;respMsg&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;orderId&quot;, reqParam.get(&quot;orderId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnTime&quot;, reqParam.get(&quot;txnTime&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnAmt&quot;, reqParam.get(&quot;txnAmt&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;queryId&quot;, reqParam.get(&quot;queryId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;settleDate&quot;, reqParam.get(&quot;settleDate&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;settleAmt&quot;, reqParam.get(&quot;settleAmt&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnType&quot;, reqParam.get(&quot;txnType&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String statusCode = &quot;&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ProfitApplyOrder order = bService.queryOrder(reqParam.get(&quot;orderId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(int i=0;i&lt;5;i++){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;statusCode = XmlUtil.invokeMethod(res,order.getBackUrl()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(statusCode.equals(&quot;success&quot;)){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;返回银行数据给商户结束[成功].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;银行数据接受完成！&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} catch (Exception e) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;e.printStackTrace(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;接受银行数据失败:&quot; + e.getMessage()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} finally { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;response.setHeader(&quot;Content-type&quot;, &quot;text/html;charset=UTF-8&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;PrintWriter writer = response.getWriter(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.print(System.currentTimeMillis()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.flush(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;public static Map&lt;String, String&gt; getAllRequestParam( &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;final HttpServletRequest request) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Enumeration&lt;?&gt; temp = request.getParameterNames(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != temp) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (temp.hasMoreElements()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String en = (String) temp.nextElement(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = request.getParameter(en); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(en, value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 在报文上送时，如果字段的值为空，则不上送&lt;下面的处理为在获取所有参数数据时，判断若值为空，则删除这个字段&gt; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// System.out.println(&quot; temp数据的键==&quot;+en+&quot;&nbsp;&nbsp;&nbsp;&nbsp; 值===&quot;+value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null == res.get(en) || &quot;&quot;.equals(res.get(en))) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.remove(en); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return res; &nbsp;&nbsp; &nbsp;} } 交易状态查询交易：（以下摘自银联官方文档） 商户收到后台通知后，应根据通知报文中订单号等关键信息，更新系统中的订单支付状态。 商户在以下情况下，可主动发起交易状态查询，并根据查询结果更新交易状态。 (1)前台交易，在5分钟内未收到后台通知。 (2)后台交易，在1秒内未收到后台通知 。 (3)商户在特殊情况下没有正确处理后台通知，需要重新判定交易状态。 商户应注意对同一笔交易，对不同时间点可能先后收到的查询结果及后台通知进行合适的处理。 以上，此接口调用查询订单交易结果，是商户主动发起的，没什么好说的，把官方文档贴了一下。附上交易应答码地址：https://open.unionpay.com/ajweb/help?id=262 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-20T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，转载请注明出处。 https://blog.csdn.net/u010882234/article/details/56005197 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 现在的网页支付（PC和微信H5）和app支付，用的比较多的是微信支付、银联支付和支付宝支付，其余的是这些支付的第三方支付，我目前了解的只有这么多。我目前做了银联支付和微信支付，这里说一些银联支付的开发的一些介绍吧。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据我们公司的应用经验，银联支付时费率最低的，如果和银联商务谈判的好，自身的交易量比较大，费率可能更低（具体不能透露了）。银联支付一种是按百分比收取手续费，另一种按笔数收取手续费，例如，每笔0.9元。我们公司用了2种银联支付，一开始用的是银联支付，后来因费率问题，使用银联支付第三方平台--千引支付，实质上也是银联支付。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们申请的银联支付，在网上营业厅、微信服务号、Android和iOS平台都在使用，是“手机WAP支付产品”。主要用了2个接口，第一个是“消费类交易”，即银联支付申请接口。它也可以分为两部分，（1）通过拼接报文，签名加密，生成html网页，浏览器跳转请求到银联支付页面。此时，订单生成，用户可以在银联页面完成支付。（2）支付成功后，银联会根据请求参数里的配置，主动回调前台、后台通知地址，通知用户支付成功。第二个接口是“交易状态查询交易”，即查询订单交易结果。 &nbsp;&nbsp;&nbsp;&nbsp; 现在具体讲一下代码： &nbsp;&nbsp;&nbsp; 消费类交易接口：官方文档地址：https://open.unionpay.com/ajweb/help/api （1）交易申请。初始化证书，拼接报文，数据签名，创建表单或取得tn号。调用此接口，微信、网厅可得到一个html的https post表单，浏览器执行js自动提交，访问银联支付申请接口，跳转银联支付页面。此时，服务端只是拼接报文，签名加密，请求的动作，是用户的浏览器做的，可以保证银联支付的安全性。app端则是，调用接口，取得tn号，调用app已安装的银联控件跳往银联支付页面。 private String pc2UnionPay(String orderId, String incMoney, &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String txnTime) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 初始化证书 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SDKConfig.getConfig().loadPropertiesFromSrc();// 从classpath加载acp_sdk.properties文件 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 交易请求url 从配置文件读取 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String requestFrontUrl = SDKConfig.getConfig().getFrontRequestUrl(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 组装请求报文 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 版本号 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;version&quot;, &quot;5.0.0&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 字符集编码 默认&quot;UTF-8&quot; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = &quot;UTF-8&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;encoding&quot;, encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 签名方法 01 RSA &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;signMethod&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易类型 01-消费 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnType&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易子类型 01:自助消费 02:订购 03:分期付款 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnSubType&quot;, &quot;01&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 业务类型 000201 B2C网关支付 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;bizType&quot;, &quot;000201&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 渠道类型 07-互联网渠道 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;channelType&quot;, &quot;07&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单前台接收地址 选送 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 FrontRcvResponse.java &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;frontUrl&quot;, frontUrl); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单后台接收地址 必送 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 BackRcvResponse.java &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;backUrl&quot;, backUrl); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 接入类型:商户接入填0 0- 商户 ， 1： 收单， 2：平台商户 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;accessType&quot;, &quot;0&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户号码 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;merId&quot;, merId);// 898310049004002 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单号 商户根据自己规则定义生成，每订单日期内不重复 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;orderId&quot;, orderId); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单发送时间 格式： YYYYMMDDhhmmss 商户发送交易时间，根据自己系统或平台生成 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnTime&quot;, txnTime); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易金额 分 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;txnAmt&quot;, incMoney); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易币种 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put(&quot;currencyCode&quot;, &quot;156&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 若报文中的数据元标识的key对应的value为空，不上送该报文域 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/** &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 创建表单 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String html = null; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 1; i &lt;= 3; i++) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;html = createHtml(requestFrontUrl, signData(data)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (html != null) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return html; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return &quot;服务器忙&quot;; &nbsp;&nbsp; &nbsp;} public static String createHtml(String action, Map&lt;String, String&gt; hiddens) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;StringBuffer sf = new StringBuffer(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\\&quot;Content-Type\\&quot; content=\\&quot;text/html; charset=UTF-8\\&quot;/&gt;&lt;/head&gt;&lt;body&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;form id = \\&quot;pay_form\\&quot; action=\\&quot;&quot; + action &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ &quot;\\&quot; method=\\&quot;post\\&quot;&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != hiddens &amp;&amp; 0 != hiddens.size()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Set&lt;Entry&lt;String, String&gt;&gt; set = hiddens.entrySet(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = set.iterator(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; ey = it.next(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = ey.getKey(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = ey.getValue(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;input type=\\&quot;hidden\\&quot; name=\\&quot;&quot; + key + &quot;\\&quot; id=\\&quot;&quot; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ key + &quot;\\&quot; value=\\&quot;&quot; + value + &quot;\\&quot;/&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/form&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/body&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;script type=\\&quot;text/javascript\\&quot;&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;document.all.pay_form.submit();&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/script&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append(&quot;&lt;/html&gt;&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return sf.toString(); &nbsp;&nbsp; &nbsp;} （2）支付成功通知商户。根据申请时取得的前后台通知地址，银联在支付成功后，会主动通知商户交易结果，但应以后台通知为准。前台应答是通过 浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联系统异步把交易状态为成功的交易通知给商户，失败交易不发送。前台应答及后台通知，商户都需要验签。 public class BackNoticeServlet extends HttpServlet { &nbsp;&nbsp; &nbsp;private static final long serialVersionUID = -900467945307979675L; &nbsp;&nbsp; &nbsp;@Override &nbsp;&nbsp; &nbsp;protected void service(HttpServletRequest request, HttpServletResponse response) &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;throws ServletException, IOException { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;try { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;后台接收银行通知开始……&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;BankService bService = (BankService) PayCache.getInstance().getBean(&quot;bankService&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;RechargeService service =&nbsp; (RechargeService)PayCache.getInstance().getBean(&quot;rechargeService&quot;); //&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;request.setCharacterEncoding(&quot;ISO-8859-1&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = request.getParameter(SDKConstants.param_encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 获取请求参数中所有的信息 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; reqParam = getAllRequestParam(request); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 打印请求报文 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.printRequestLog(reqParam); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; valideData = null; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != reqParam &amp;&amp; !reqParam.isEmpty()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = reqParam.entrySet() &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;.iterator(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData = new HashMap&lt;String, String&gt;(reqParam.size()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; e = it.next(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = (String) e.getKey(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = (String) e.getValue(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;value = new String(value.getBytes(&quot;ISO-8859-1&quot;), encoding); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData.put(key, value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 验证签名 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (!SDKUtil.validate(valideData, encoding)) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;验证签名结果[失败].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} else { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;验证签名结果[成功].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 持久化银行返回的数据 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;持久化银行返回的数据&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String settleDate = reqParam.get(&quot;settleDate&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Calendar cal=Calendar.getInstance(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;settleDate = String.valueOf(cal.get(Calendar.YEAR)) + settleDate;//加上年份 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;reqParam.put(&quot;settleDate&quot;, settleDate); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.addPayresult(reqParam); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(&quot;00&quot;.equals(reqParam.get(&quot;respCode&quot;))){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.updOrder(reqParam.get(&quot;orderId&quot;),settleDate); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;返回银行数据给商户开始……&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;respCode&quot;, reqParam.get(&quot;respCode&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;respMsg&quot;, reqParam.get(&quot;respMsg&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;orderId&quot;, reqParam.get(&quot;orderId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnTime&quot;, reqParam.get(&quot;txnTime&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnAmt&quot;, reqParam.get(&quot;txnAmt&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;queryId&quot;, reqParam.get(&quot;queryId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;settleDate&quot;, reqParam.get(&quot;settleDate&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;settleAmt&quot;, reqParam.get(&quot;settleAmt&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(&quot;txnType&quot;, reqParam.get(&quot;txnType&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String statusCode = &quot;&quot;; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ProfitApplyOrder order = bService.queryOrder(reqParam.get(&quot;orderId&quot;)); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(int i=0;i&lt;5;i++){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;statusCode = XmlUtil.invokeMethod(res,order.getBackUrl()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(statusCode.equals(&quot;success&quot;)){ &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;返回银行数据给商户结束[成功].&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;银行数据接受完成！&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} catch (Exception e) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;e.printStackTrace(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog(&quot;接受银行数据失败:&quot; + e.getMessage()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} finally { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;response.setHeader(&quot;Content-type&quot;, &quot;text/html;charset=UTF-8&quot;); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;PrintWriter writer = response.getWriter(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.print(System.currentTimeMillis()); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.flush(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;public static Map&lt;String, String&gt; getAllRequestParam( &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;final HttpServletRequest request) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Enumeration&lt;?&gt; temp = request.getParameterNames(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != temp) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (temp.hasMoreElements()) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String en = (String) temp.nextElement(); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = request.getParameter(en); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(en, value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 在报文上送时，如果字段的值为空，则不上送&lt;下面的处理为在获取所有参数数据时，判断若值为空，则删除这个字段&gt; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// System.out.println(&quot; temp数据的键==&quot;+en+&quot;&nbsp;&nbsp;&nbsp;&nbsp; 值===&quot;+value); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null == res.get(en) || &quot;&quot;.equals(res.get(en))) { &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.remove(en); &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return res; &nbsp;&nbsp; &nbsp;} } 交易状态查询交易：（以下摘自银联官方文档） 商户收到后台通知后，应根据通知报文中订单号等关键信息，更新系统中的订单支付状态。 商户在以下情况下，可主动发起交易状态查询，并根据查询结果更新交易状态。 (1)前台交易，在5分钟内未收到后台通知。 (2)后台交易，在1秒内未收到后台通知 。 (3)商户在特殊情况下没有正确处理后台通知，需要重新判定交易状态。 商户应注意对同一笔交易，对不同时间点可能先后收到的查询结果及后台通知进行合适的处理。 以上，此接口调用查询订单交易结果，是商户主动发起的，没什么好说的，把官方文档贴了一下。附上交易应答码地址：https://open.unionpay.com/ajweb/help?id=262 阅读更多","@type":"BlogPosting","url":"/2017/02/20/e3a8207f32ea7c4cab0f6f24d33b7c09.html","headline":"银联支付开发、使用的一些总结","dateModified":"2017-02-20T00:00:00+08:00","datePublished":"2017-02-20T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/02/20/e3a8207f32ea7c4cab0f6f24d33b7c09.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>银联支付开发、使用的一些总结</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，转载请注明出处。 https://blog.csdn.net/u010882234/article/details/56005197 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css"> 
 <div class="htmledit_views"> 
  <p><br></p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 现在的网页支付（PC和微信H5）和app支付，用的比较多的是微信支付、银联支付和支付宝支付，其余的是这些支付的第三方支付，我目前了解的只有这么多。我目前做了银联支付和微信支付，这里说一些银联支付的开发的一些介绍吧。</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 根据我们公司的应用经验，银联支付时费率最低的，如果和银联商务谈判的好，自身的交易量比较大，费率可能更低（具体不能透露了）。银联支付一种是按百分比收取手续费，另一种按笔数收取手续费，例如，每笔0.9元。我们公司用了2种银联支付，一开始用的是银联支付，后来因费率问题，使用银联支付第三方平台--千引支付，实质上也是银联支付。</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们申请的银联支付，在网上营业厅、微信服务号、Android和iOS平台都在使用，是“手机WAP支付产品”。主要用了2个接口，第一个是“消费类交易”，即银联支付申请接口。它也可以分为两部分，（1）通过拼接报文，签名加密，生成html网页，浏览器跳转请求到银联支付页面。此时，订单生成，用户可以在银联页面完成支付。（2）支付成功后，银联会根据请求参数里的配置，主动回调前台、后台通知地址，通知用户支付成功。第二个接口是“交易状态查询交易”，即查询订单交易结果。</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp; 现在具体讲一下代码：</p> 
  <p>&nbsp;&nbsp;&nbsp; 消费类交易接口：官方文档地址：https://open.unionpay.com/ajweb/help/api</p> 
  <p>（1）交易申请。初始化证书，拼接报文，数据签名，创建表单或取得tn号。调用此接口，微信、网厅可得到一个html的https post表单，浏览器执行js自动提交，访问银联支付申请接口，跳转银联支付页面。此时，服务端只是拼接报文，签名加密，请求的动作，是用户的浏览器做的，可以保证银联支付的安全性。app端则是，调用接口，取得tn号，调用app已安装的银联控件跳往银联支付页面。</p> 
  <p>private String pc2UnionPay(String orderId, String incMoney,<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String txnTime) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/**<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 初始化证书<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SDKConfig.getConfig().loadPropertiesFromSrc();// 从classpath加载acp_sdk.properties文件<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/**<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 交易请求url 从配置文件读取<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String requestFrontUrl = SDKConfig.getConfig().getFrontRequestUrl();<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/**<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 组装请求报文<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 版本号<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("version", "5.0.0");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 字符集编码 默认"UTF-8"<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = "UTF-8";<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("encoding", encoding);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 签名方法 01 RSA<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("signMethod", "01");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易类型 01-消费<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("txnType", "01");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易子类型 01:自助消费 02:订购 03:分期付款<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("txnSubType", "01");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 业务类型 000201 B2C网关支付<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("bizType", "000201");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 渠道类型 07-互联网渠道<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("channelType", "07");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单前台接收地址 选送<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 FrontRcvResponse.java<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("frontUrl", frontUrl);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户/收单后台接收地址 必送<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 后台服务对应的写法参照 BackRcvResponse.java<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("backUrl", backUrl);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 接入类型:商户接入填0 0- 商户 ， 1： 收单， 2：平台商户<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("accessType", "0");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 商户号码<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("merId", merId);// 898310049004002<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单号 商户根据自己规则定义生成，每订单日期内不重复<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("orderId", orderId);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 订单发送时间 格式： YYYYMMDDhhmmss 商户发送交易时间，根据自己系统或平台生成<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("txnTime", txnTime);<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易金额 分<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("txnAmt", incMoney);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 交易币种<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data.put("currencyCode", "156");<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 若报文中的数据元标识的key对应的value为空，不上送该报文域<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;/**<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * 创建表单<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; */<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String html = null;<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 1; i &lt;= 3; i++) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;html = createHtml(requestFrontUrl, signData(data));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (html != null) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return html;<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return "服务器忙";<br> &nbsp;&nbsp; &nbsp;}</p> 
  <p>public static String createHtml(String action, Map&lt;String, String&gt; hiddens) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;StringBuffer sf = new StringBuffer();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/&gt;&lt;/head&gt;&lt;body&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;form id = \"pay_form\" action=\"" + action<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ "\" method=\"post\"&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != hiddens &amp;&amp; 0 != hiddens.size()) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Set&lt;Entry&lt;String, String&gt;&gt; set = hiddens.entrySet();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = set.iterator();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; ey = it.next();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = ey.getKey();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = ey.getValue();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;input type=\"hidden\" name=\"" + key + "\" id=\""<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;+ key + "\" value=\"" + value + "\"/&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;/form&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;/body&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;script type=\"text/javascript\"&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("document.all.pay_form.submit();");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;/script&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;sf.append("&lt;/html&gt;");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return sf.toString();<br> &nbsp;&nbsp; &nbsp;}</p> 
  <p>（2）支付成功通知商户。根据申请时取得的前后台通知地址，银联在支付成功后，会主动通知商户交易结果，但应以后台通知为准。前台应答是通过 浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联系统异步把交易状态为成功的交易通知给商户，失败交易不发送。前台应答及后台通知，商户都需要验签。</p> 
  <p>public class BackNoticeServlet extends HttpServlet {<br> &nbsp;&nbsp; &nbsp;private static final long serialVersionUID = -900467945307979675L;<br> &nbsp;&nbsp; &nbsp;@Override<br> &nbsp;&nbsp; &nbsp;protected void service(HttpServletRequest request, HttpServletResponse response)<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;throws ServletException, IOException {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;try {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("后台接收银行通知开始……");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;BankService bService = (BankService) PayCache.getInstance().getBean("bankService");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;RechargeService service =&nbsp; (RechargeService)PayCache.getInstance().getBean("rechargeService");<br> //&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;request.setCharacterEncoding("ISO-8859-1");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String encoding = request.getParameter(SDKConstants.param_encoding);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 获取请求参数中所有的信息<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; reqParam = getAllRequestParam(request);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 打印请求报文<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.printRequestLog(reqParam);<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; valideData = null;<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != reqParam &amp;&amp; !reqParam.isEmpty()) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Iterator&lt;Entry&lt;String, String&gt;&gt; it = reqParam.entrySet()<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;.iterator();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData = new HashMap&lt;String, String&gt;(reqParam.size());<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (it.hasNext()) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Entry&lt;String, String&gt; e = it.next();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String key = (String) e.getKey();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = (String) e.getValue();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;value = new String(value.getBytes("ISO-8859-1"), encoding);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;valideData.put(key, value);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 验证签名<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (!SDKUtil.validate(valideData, encoding)) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("验证签名结果[失败].");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} else {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("验证签名结果[成功].");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 持久化银行返回的数据<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("持久化银行返回的数据");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String settleDate = reqParam.get("settleDate");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Calendar cal=Calendar.getInstance();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;settleDate = String.valueOf(cal.get(Calendar.YEAR)) + settleDate;//加上年份<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;reqParam.put("settleDate", settleDate);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.addPayresult(reqParam);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if("00".equals(reqParam.get("respCode"))){<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;service.updOrder(reqParam.get("orderId"),settleDate);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("返回银行数据给商户开始……");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("respCode", reqParam.get("respCode"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("respMsg", reqParam.get("respMsg"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("orderId", reqParam.get("orderId"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("txnTime", reqParam.get("txnTime"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("txnAmt", reqParam.get("txnAmt"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("queryId", reqParam.get("queryId"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("settleDate", reqParam.get("settleDate"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("settleAmt", reqParam.get("settleAmt"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put("txnType", reqParam.get("txnType"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String statusCode = "";<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ProfitApplyOrder order = bService.queryOrder(reqParam.get("orderId"));<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(int i=0;i&lt;5;i++){<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;statusCode = XmlUtil.invokeMethod(res,order.getBackUrl());<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if(statusCode.equals("success")){<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("返回银行数据给商户结束[成功].");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break;<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("银行数据接受完成！");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br><br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} catch (Exception e) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;e.printStackTrace();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;LogUtil.writeLog("接受银行数据失败:" + e.getMessage());<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;} finally {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;response.setHeader("Content-type", "text/html;charset=UTF-8");<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;PrintWriter writer = response.getWriter();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.print(System.currentTimeMillis());<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;writer.flush();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;<br> &nbsp;&nbsp; &nbsp;public static Map&lt;String, String&gt; getAllRequestParam(<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;final HttpServletRequest request) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Map&lt;String, String&gt; res = new HashMap&lt;String, String&gt;();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Enumeration&lt;?&gt; temp = request.getParameterNames();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null != temp) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while (temp.hasMoreElements()) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String en = (String) temp.nextElement();<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;String value = request.getParameter(en);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.put(en, value);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// 在报文上送时，如果字段的值为空，则不上送&lt;下面的处理为在获取所有参数数据时，判断若值为空，则删除这个字段&gt;<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// System.out.println(" temp数据的键=="+en+"&nbsp;&nbsp;&nbsp;&nbsp; 值==="+value);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (null == res.get(en) || "".equals(res.get(en))) {<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;res.remove(en);<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return res;<br> &nbsp;&nbsp; &nbsp;}<br> }</p> 
  <p><br></p> 
  <p>交易状态查询交易：（以下摘自银联官方文档）</p> 
  <p>商户收到后台通知后，应根据通知报文中订单号等关键信息，更新系统中的订单支付状态。<br> 商户在以下情况下，可主动发起交易状态查询，并根据查询结果更新交易状态。<br> (1)前台交易，在5分钟内未收到后台通知。<br> (2)后台交易，在1秒内未收到后台通知 。<br> (3)商户在特殊情况下没有正确处理后台通知，需要重新判定交易状态。<br> 商户应注意对同一笔交易，对不同时间点可能先后收到的查询结果及后台通知进行合适的处理。</p> 
  <p>以上，此接口调用查询订单交易结果，是商户主动发起的，没什么好说的，把官方文档贴了一下。附上交易应答码地址：https://open.unionpay.com/ajweb/help?id=262<br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/u010882234/article/details/56005197,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/u010882234/article/details/56005197,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

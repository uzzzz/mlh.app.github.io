<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>.NET银联支付开发（一）：支付 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content=".NET银联支付开发（一）：支付" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="第一次做银联支付的开发，无论是支付还是退款都走了不少弯路，银联支付的sdk和demo并不容易让人明白如何调用sdk。所以，想写两篇文章把开发的过程分享出来供大家参考。这篇文章讲一下银联支付的网关支付产品的前台交易类型的付款开发流程。闲话少叙，进入正题。 一、付款需要发送的报文（发送给银联的数据） 报文中包含以下信息： 1、基本信息，必须发送，可固定不变 1 版本号 version NS5 M 按规范填写。 固定填写 2 编码方式 encoding ANS1..20 M 填写报文使用的字符编码，UTF-8|GBK|GB2312|GB18030 若不填写，默认取值：UTF-8 可取值UTF-8或GBK 3 证书ID certId N1..128 M 填写签名私钥证书的 Serial Number， 该值可通过银联提 供的 SDK 获取 &nbsp; 4 签名方法 signMethod N2 M 非对称签名：01（表示采用 RSA 签名） 固定填写：01（表示采用 RSA 签名） 5 签名 signature ANS1..1024 M 填写对报文摘要的签名，可通过SDK生成签名 填写对报文摘要的签名，可通过SDK生成签名 6 交易类型 txnType N2 M 取值：00：查询交易，01：消费，02：预授权， 03：预授权完成，04：退货，05：圈存， 11：代收，12：代付， 13：账单支付，14：转账（保留），21：批量交易， 22：批量查询，31：消费撤销， 32：预授权撤销，33：预授权完成撤销， 71：余额查询，72：实名认证-建立绑定关系， 73：账单查询，74：解除绑定关系， 75：查询绑定关系，77：发送短信验证码交易， 78：开通查询交易，79：开通交易， 94：IC卡脚本通知 95：查询更新加密公钥证书 固定填写：01 7 交易子类 txnSubType N2 M 依据实际交易类型填写。默认取值：00 固定填写：01：自助消费， 通过地址的方式区 分前台消费 和后台消费（含无跳转 支付） 8 产品类型 bizType N6 M 依据实际业务场景填写 (目前仅使用后 4 位，签名 2 位 默认为 00) &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 000301：认证支付 2.0 000302：评级支付 000401：代付 &nbsp;000501：代收 000601：账单支付 000801： 跨行收单 000901：绑定支付 001001：订购 000202：B2B 000201 9 渠道类型 channelType N2 M 05：语音07：互联网08：移动 16：数字机顶盒 固定填写：07 2、商户信息 接入类型 accessType N1 M 0：商户直连接入 1：收单机构接入 &nbsp;2：平台商户接入 0：普通商户直连接入 &nbsp;1：收单机构接入 2 商户代码 merId AN15 M 已被批准加入银联互联网系统 的商户代码 &nbsp; 3 前台通知地址 frontUrl ANS1..256 C 前台返回商户结果时使用， 前台类交易需上送 不支持换行符等不可见字符 前台返回商户结果时使用， 例：https://xxx.xxx.com/xxx 4 后台通知地址 backUrl ANS1..256 M 后台返回商户结果时使用， 如上送，则发送商户后台交 易结果通知， 不支持换行符等不可见字符， 如需通过专 线通知， 需要在通知地址前面加上前缀： 专线的首字母 加竖线 ZX| 后台返回商户结果时使用， 例：https://xxx.xxx.com/xxx 5 失败交易 前台跳转地址 frontFailUrl ANS1..256 O 前台消费交易若商户上送此字段， 则在支付失败时， 页面跳转至商户该URL （不带交易信息，仅跳转）， 支持HTTP与HTTPS协议， 互联网可访问 前台消费交易若商户上送此字段， 则在支付失败时， 页面跳转至商户该URL （不带交易信息，仅跳转）， 支持HTTP与HTTPS协议，互联网可访问 3、订单信息 商户订单号 orderId AN8..40 M 商户订单号，不应含“-”或“_” 商户端生成，例：12345asdf 2 交易币种 currencyCode AN3 M 币种格式必须为3位代码， 境内客户取值：156（人民币） 固定填写：156 3 交易金额 txnAmt N1..12 M 单位为分，不能带小数点，样例：1元送100 单位为分，例：1元填写100 4 订单发送时间 txnTime YYYYMMDDHHmmss M 必须使用当前北京时间 （年年年年月月日日时时分分秒秒）24小时制， 样例：20151123152540，北京时间 商户发送交易时间 商户发送交易时间，例：20151118100505 5 订单接收超时时间 orderTimeout N1..10 O 单位为毫秒，交易发生时，该笔交易在银联全渠道系统中有效的最长时间。 当距离交易发送时间超过该时间时，银联全渠道系统不再为该笔交易提供支付服务 1、前台类消费交易时上送 2、认证支付 2.0，后台交易时可选 6 支付超时时间 payTimeout YYYYMMDDHHmmss O 订单支付超时时间，超过此时间用户支付成功的交易， 不通知商户，系统自动退款， 大约 5 个工作日金额返还 到用户账户 非网银的交易：超过此时间未完成支付时银联页面会提示超时，不允许后续支付。 &nbsp;跳转网银的交易银联无法控制，超过此时间用户支付成功的交易，不通知商户，系统自动退款， 大约5个工作日金额返还到用户账户。 7 发卡机构代码 issInsCode AN1..20 C 当账号类型为 02-存折时需填写 在前台类交易时填写默认银行代码， 支持直接跳转到网 银 1、当帐号类型为02-存折时需填写 2、在前台类交易时填写默认银行代码，支持直接跳转到网银。 银行简码列表参考附录C.1、C.2，其中C.2银行列表仅支持借记卡，例：工行填写ICBC 8 请求方自定义域 reqReserved ANS1..1024 O 商户自定义保留域， 交易应答时会原样返回 商户自定义保留域，交易应答时会原样返回 4、机构信息 收单机构代码 acqInsCode AN8..11 C 已被批准加入银联互联网系统的收单机构代码， 适用于收单机构接入测试场景。 在商户接入时不返回此域， 且上送报文中不应出现此域。 &nbsp; 2 商户类别 merCatCode N4 C 填写MCC码，接入类型为收单机构接入时需上送 &nbsp; 3 商户名称 merName ANS1..40 C 接入类型为收单机构接入时需上送, 不支持换行符等不可见字符 &nbsp; 4 商户简称 merAbbr ANS1..8 C 接入类型为收单机构接入时需上送最长 8 位， 不支持换行符等不可见字符 二、付款的应答报文（银联返回的数据） 1、应答报文的基本信息 1 版本号 version NS5 R 按规范填写。 &nbsp; 2 编码方式 encoding ANS1..20 R 填写报文使用的字符编码， UTF-8|GBK|GB2312|GB18030 若不填写，默认取值：UTF-8 &nbsp; 3 签名方法 signMethod N2 M 非对称签名：01（表示采用 RSA 签名） &nbsp; 4 签名 signature ANS1..1024 M 填写对报文摘要的签名，可通过SDK生成签名 &nbsp; 5 交易类型 txnType N2 R 取值： 00：查询交易，01：消费，02：预授权， 03：预授权完成，04：退货，05：圈存， 11：代收，12：代付，13：账单支付， 14：转账（保留），21：批量交易，22：批量查询， 31：消费撤销，32：预授权撤销，33：预授权完成撤销， 71：余额查询，72：实名认证-建立绑定关系， 73：账单查询，74：解除绑定关系，75：查询绑定关系， 77：发送短信验证码交易，78：开通查询交易， 79：开通交易，94：IC卡脚本通知 95：查询更新加密公钥证书 &nbsp; 6 交易子类 txnSubType N2 R 依据实际交易类型填写。默认取值：00 &nbsp; 7 产品类型 bizType N6 R 依据实际业务场景填写(目前仅使用后 4 位，签名 2 位 默认为 00) &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 &nbsp;000301：认证支付 2.0 000302：评级支付 000401：代付 000501：代收 000601：账单支付 000801：跨行收单 000901：绑定支付 001001：订购 000202：B2B &nbsp; 8 签名公钥 证书 signPubKeyCert AN2048 C 使用 RSA 签名方式时必选， 此域填写银联签名公钥证书 使用 RSA 签名方式时必选， 此域填写银联签名公钥证书。 2、应答报文的商户信息 1 接入类型 accessType N1 R 0：商户直连接入1：收单机构接入 2：平台商户接入 &nbsp; 2 商户代码 merId AN15 R 已被批准加入银联互联网系统的商户代码 3、应答报文的订单信息 1 商户订单号 orderId AN8..40 R 商户订单号，不应含“-”或“_” &nbsp; 2 交易币种 currencyCode AN3 R 币种格式必须为3位代码，境内客户取值：156（人民币） 默认为 156 3 交易金额 txnAmt N1..12 R 单位为分，不能带小数点，样例：1元送100 &nbsp; 4 订单发送时间 txnTime YYYYMMDDHHmmss R 必须使用当前北京时间（年年年年月月日日时时分分秒秒） 24小时制，样例：20151123152540，北京时间 商户发送交易时间 &nbsp; 5 支付方式 payType N4 C 默认不返回此域，如需要返此域，需要提交申请， 视商户配置返回，可在消费类交易中返回以下中的一种： 0001：认证支付 0002：快捷支付 0004：储值卡支付 0005：IC卡支付 0201：网银支付 1001：牡丹畅通卡支付 1002：中铁银通卡支付 0401：信用卡支付——暂定 0402：小额临时支付 0403：认证支付 2.0 &nbsp;0404：互联网订单手机支付 9000：其他无卡支付(如手机客户端支付) 根据商户配置返回 6 账号 accNo AN1..1024 C 交易账号。请求时使用加密公钥对交易账号加密， 并做 Base64 编码后上送； 应答时如需返回，则使用签名私钥 进行解密。 &nbsp;前台交易可由银联页面采集，也可由商户上送并返显。 如需锁定返显卡号，应通过保留域（reserved）上送卡 号锁定标识。 根据商户配置返回 7 支付卡类型 payCardType N2 C 消费交易，视商户配置返回。该域取值为： &nbsp;00：未知 01：借记账户 02：贷记账户 03：准贷记账户 04：借贷合一账户 05：预付费账户 06：半开放预付费账户 根据商户配置返回 8 请求方自定义域 reqReserved ANS1..1024 R 商户自定义保留域，交易应答时会原样返回 &nbsp; 9 保留域 reserved ANS1..2048 O 保留域包含多个子域，所有子域需用“{}”包含，子域间以“&amp;”符号链接。 格式如下：{子域名1=值&amp;子域名2=值&amp;子域名3=值}。 相关子域说明见注 5 &nbsp; &nbsp; 4、应答报文的通知信息 1 查询流水号 queryId AN21 M 由银联返回，用于在后续类交易中唯一标识一笔交易 消费交易的流水号，供后续查询用 2 应答码 respCode AN2 M 具体参见应答码定义章节 &nbsp; 3 应答信息 respMsg ANS1..256 M 填写具体的应答信息 &nbsp; 4 银联受理订单号 tn N21 C 商户推送订单后银联系统返回该流水号， 商户调用支付控件时使用 商户推送订单后银联移动支付 系统返回该流水号， 商户调用支付控件时使用 三、交易流程 相关交易流程如下： 交易步骤： 1、持卡人/企业浏览商户网页，选择消费交易； 2、商户组织交易报文，通过浏览器跳转至银联全渠道系统的支付页面； 3、持卡人/企业在银联全渠道系统支付页面输入相关交易信息； 4、全渠道系统完成用户的交易处理； 5、银联全渠道系统，将交易受理结果返回给商户； 6、因消费交易涉及资金清算，银联系统发送后台通知（交易结果）给商户。 四、真实开发实例 下面展示的代码为开发实例，代码展示顺序按照交易流程进行排列。 1、用户浏览页面，进行消费交易，对订单进行付款。页面提交订单信息表单的js代码 $(function () { //支付提交表单 $(&quot;#paySubmit&quot;).click(function () { $(&quot;#mainForm&quot;).submit(); }); });2、接收订单数据的控制器代码 public void GotoPay() { Dictionary&lt;string,string&gt; param = new Dictionary&lt;string,string&gt;(); param[&quot;orderId&quot;] = Request.Form[&quot;orderId&quot;].ToString();//订单号 param[&quot;merId&quot;] = merId; //商户号 decimal orderSum = IOrderService.GetMoney(param[&quot;orderId&quot;]); param[&quot;txnAmt&quot;] = ((int)orderSum*100).ToString(); //订单金额，单位为分 string payType = Request.Form[&quot;payType&quot;].ToString();//支付类型 if (payType==PayType.unionpay.ToString()) //银联支付 { UnionpayB2C.Unionpay(param); } } 3、支付层的银联支付处理 public static void Unionpay(Dictionary&lt;string, string&gt; data) { Dictionary&lt;string, string&gt; param = new Dictionary&lt;string, string&gt;(); //以下信息非特殊情况不需要改动 param[&quot;version&quot;] = &quot;5.0.0&quot;;//版本号 param[&quot;encoding&quot;] = &quot;UTF-8&quot;;//编码方式 param[&quot;txnType&quot;] = &quot;01&quot;;//交易类型 param[&quot;txnSubType&quot;] = &quot;01&quot;;//交易子类 param[&quot;bizType&quot;] = &quot;000201&quot;;//业务类型 param[&quot;signMethod&quot;] = &quot;01&quot;;//签名方法 param[&quot;channelType&quot;] = &quot;08&quot;;//渠道类型 param[&quot;accessType&quot;] = &quot;0&quot;;//接入类型 param[&quot;frontUrl&quot;] = SDKConfig.FrontUrl; //前台通知地址 param[&quot;backUrl&quot;] = SDKConfig.BackUrl; //后台通知地址 param[&quot;currencyCode&quot;] = &quot;156&quot;;//交易币种 //TODO 以下信息需要填写 param[&quot;merId&quot;] = data[&quot;merId&quot;];//商户号，请改自己的测试商户号，此处默认取demo演示页面传递的参数 param[&quot;orderId&quot;] = data[&quot;orderId&quot;];//商户订单号，8-32位数字字母，不能含“-”或“_”，此处默认取demo演示页面传递的参数，可以自行定制规则 param[&quot;txnTime&quot;] = DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;);//订单发送时间，格式为YYYYMMDDhhmmss，取北京时间，此处默认取demo演示页面传递的参数，参考取法： DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;) param[&quot;txnAmt&quot;] = data[&quot;txnAmt&quot;];//交易金额，单位分，此处默认取demo演示页面传递的参数 //param[&quot;reqReserved&quot;] = &quot;透传信息&quot;;//请求方保留域，透传字段，查询、通知、对账文件中均会原样出现，如有需要请启用并修改自己希望透传的数据 //TODO 其他特殊用法请查看 pages/api_01_gateway/special_use_purchase.htm AcpService.Sign(param, System.Text.Encoding.UTF8); string html = AcpService.CreateAutoFormHtml(SDKConfig.FrontTransUrl, param, System.Text.Encoding.UTF8);// 将SDKUtil产生的Html文档写入页面，从而引导用户浏览器重定向 HttpContext.Current.Response.ContentEncoding = Encoding.UTF8; // 指定输出编码 HttpContext.Current.Response.Write(html); } 4、接收银联应答报文的控制器代码 /// &lt;summary&gt; /// 前台交易返回结果 /// &lt;/summary&gt; [HttpPost] public ActionResult RcvResponse() { Dictionary&lt;string, string&gt; result = UnionpayB2C.FrontRcvResponse(); JsonDTO json = new JsonDTO() { Res = false, Msg = &quot;支付失败，请重新支付&quot; }; if (result!=null) { if (result[RespData.respCode.ToString()]==RespCode.success) //交易成功 { OrderDetailDTO dto = new OrderDetailDTO() { OrderNum = result[RespData.orderId.ToString()], OrderStatus = EnumOrderStatus.WatingReceive, PayTime = Convert.ToDateTime(result[RespData.txnTime.ToString()]) //OrderNum = &quot;20170217102907590110902120&quot;, //OrderStatus = EnumOrderStatus.WatingReceive, //PayTime = DateTime.Now }; json.Res=IOrderService.UpdateOrder(dto); if (json.Res) { IOrderService.AddOrderPayInfo(new OrderPayInfoDTO { OrderID = result[RespData.orderId.ToString()], QueryID = result[RespData.queryId.ToString()], TxnTime = result[RespData.txnTime.ToString()], TxnAmt =int.Parse(result[RespData.txnAmt.ToString()]), }); json.Msg = &quot;支付成功&quot;; } return View(json); } else { return View(json); } } return View(json); } 5、支付层处理银联应答报文 /// &lt;summary&gt; /// 接收银联返回的前台交易结果报文 /// &lt;/summary&gt; public static Dictionary&lt;string, string&gt; FrontRcvResponse() { if (HttpContext.Current.Request.HttpMethod == &quot;POST&quot;) { // 使用Dictionary保存参数 Dictionary&lt;string, string&gt; resData = new Dictionary&lt;string, string&gt;(); NameValueCollection coll = HttpContext.Current.Request.Form; string[] requestItem = coll.AllKeys; for (int i = 0; i &lt; requestItem.Length; i++) { resData.Add(requestItem[i], HttpContext.Current.Request.Form[requestItem[i]]); } // 返回报文中不包含UPOG,表示Server端正确接收交易请求,则需要验证Server端返回报文的签名 if (AcpService.Validate(resData, System.Text.Encoding.UTF8)) { //Response.Write(&quot;商户端验证返回报文签名成功\n&quot;); //string respcode = resData[&quot;respCode&quot;]; //00、A6为成功，其余为失败。其他字段也可按此方式获取。 //如果卡号我们业务配了会返回且配了需要加密的话，请按此方法解密 //if(resData.ContainsKey(&quot;accNo&quot;)) //{ // string accNo = SecurityUtil.DecryptData(resData[&quot;accNo&quot;], System.Text.Encoding.UTF8); //} //商户端根据返回报文内容处理自己的业务逻辑 ,DEMO此处只输出报文结果 return resData; } else { log.Error(&quot;商户端验证银联返回报文结果：验证签名失败&quot;); return null; } } return null; } 注：银联的测试环境和生产环境的配置是不同的，其中，前台交易通知地址配置为接收银联应答报文的地址。 阅读更多" />
<meta property="og:description" content="第一次做银联支付的开发，无论是支付还是退款都走了不少弯路，银联支付的sdk和demo并不容易让人明白如何调用sdk。所以，想写两篇文章把开发的过程分享出来供大家参考。这篇文章讲一下银联支付的网关支付产品的前台交易类型的付款开发流程。闲话少叙，进入正题。 一、付款需要发送的报文（发送给银联的数据） 报文中包含以下信息： 1、基本信息，必须发送，可固定不变 1 版本号 version NS5 M 按规范填写。 固定填写 2 编码方式 encoding ANS1..20 M 填写报文使用的字符编码，UTF-8|GBK|GB2312|GB18030 若不填写，默认取值：UTF-8 可取值UTF-8或GBK 3 证书ID certId N1..128 M 填写签名私钥证书的 Serial Number， 该值可通过银联提 供的 SDK 获取 &nbsp; 4 签名方法 signMethod N2 M 非对称签名：01（表示采用 RSA 签名） 固定填写：01（表示采用 RSA 签名） 5 签名 signature ANS1..1024 M 填写对报文摘要的签名，可通过SDK生成签名 填写对报文摘要的签名，可通过SDK生成签名 6 交易类型 txnType N2 M 取值：00：查询交易，01：消费，02：预授权， 03：预授权完成，04：退货，05：圈存， 11：代收，12：代付， 13：账单支付，14：转账（保留），21：批量交易， 22：批量查询，31：消费撤销， 32：预授权撤销，33：预授权完成撤销， 71：余额查询，72：实名认证-建立绑定关系， 73：账单查询，74：解除绑定关系， 75：查询绑定关系，77：发送短信验证码交易， 78：开通查询交易，79：开通交易， 94：IC卡脚本通知 95：查询更新加密公钥证书 固定填写：01 7 交易子类 txnSubType N2 M 依据实际交易类型填写。默认取值：00 固定填写：01：自助消费， 通过地址的方式区 分前台消费 和后台消费（含无跳转 支付） 8 产品类型 bizType N6 M 依据实际业务场景填写 (目前仅使用后 4 位，签名 2 位 默认为 00) &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 000301：认证支付 2.0 000302：评级支付 000401：代付 &nbsp;000501：代收 000601：账单支付 000801： 跨行收单 000901：绑定支付 001001：订购 000202：B2B 000201 9 渠道类型 channelType N2 M 05：语音07：互联网08：移动 16：数字机顶盒 固定填写：07 2、商户信息 接入类型 accessType N1 M 0：商户直连接入 1：收单机构接入 &nbsp;2：平台商户接入 0：普通商户直连接入 &nbsp;1：收单机构接入 2 商户代码 merId AN15 M 已被批准加入银联互联网系统 的商户代码 &nbsp; 3 前台通知地址 frontUrl ANS1..256 C 前台返回商户结果时使用， 前台类交易需上送 不支持换行符等不可见字符 前台返回商户结果时使用， 例：https://xxx.xxx.com/xxx 4 后台通知地址 backUrl ANS1..256 M 后台返回商户结果时使用， 如上送，则发送商户后台交 易结果通知， 不支持换行符等不可见字符， 如需通过专 线通知， 需要在通知地址前面加上前缀： 专线的首字母 加竖线 ZX| 后台返回商户结果时使用， 例：https://xxx.xxx.com/xxx 5 失败交易 前台跳转地址 frontFailUrl ANS1..256 O 前台消费交易若商户上送此字段， 则在支付失败时， 页面跳转至商户该URL （不带交易信息，仅跳转）， 支持HTTP与HTTPS协议， 互联网可访问 前台消费交易若商户上送此字段， 则在支付失败时， 页面跳转至商户该URL （不带交易信息，仅跳转）， 支持HTTP与HTTPS协议，互联网可访问 3、订单信息 商户订单号 orderId AN8..40 M 商户订单号，不应含“-”或“_” 商户端生成，例：12345asdf 2 交易币种 currencyCode AN3 M 币种格式必须为3位代码， 境内客户取值：156（人民币） 固定填写：156 3 交易金额 txnAmt N1..12 M 单位为分，不能带小数点，样例：1元送100 单位为分，例：1元填写100 4 订单发送时间 txnTime YYYYMMDDHHmmss M 必须使用当前北京时间 （年年年年月月日日时时分分秒秒）24小时制， 样例：20151123152540，北京时间 商户发送交易时间 商户发送交易时间，例：20151118100505 5 订单接收超时时间 orderTimeout N1..10 O 单位为毫秒，交易发生时，该笔交易在银联全渠道系统中有效的最长时间。 当距离交易发送时间超过该时间时，银联全渠道系统不再为该笔交易提供支付服务 1、前台类消费交易时上送 2、认证支付 2.0，后台交易时可选 6 支付超时时间 payTimeout YYYYMMDDHHmmss O 订单支付超时时间，超过此时间用户支付成功的交易， 不通知商户，系统自动退款， 大约 5 个工作日金额返还 到用户账户 非网银的交易：超过此时间未完成支付时银联页面会提示超时，不允许后续支付。 &nbsp;跳转网银的交易银联无法控制，超过此时间用户支付成功的交易，不通知商户，系统自动退款， 大约5个工作日金额返还到用户账户。 7 发卡机构代码 issInsCode AN1..20 C 当账号类型为 02-存折时需填写 在前台类交易时填写默认银行代码， 支持直接跳转到网 银 1、当帐号类型为02-存折时需填写 2、在前台类交易时填写默认银行代码，支持直接跳转到网银。 银行简码列表参考附录C.1、C.2，其中C.2银行列表仅支持借记卡，例：工行填写ICBC 8 请求方自定义域 reqReserved ANS1..1024 O 商户自定义保留域， 交易应答时会原样返回 商户自定义保留域，交易应答时会原样返回 4、机构信息 收单机构代码 acqInsCode AN8..11 C 已被批准加入银联互联网系统的收单机构代码， 适用于收单机构接入测试场景。 在商户接入时不返回此域， 且上送报文中不应出现此域。 &nbsp; 2 商户类别 merCatCode N4 C 填写MCC码，接入类型为收单机构接入时需上送 &nbsp; 3 商户名称 merName ANS1..40 C 接入类型为收单机构接入时需上送, 不支持换行符等不可见字符 &nbsp; 4 商户简称 merAbbr ANS1..8 C 接入类型为收单机构接入时需上送最长 8 位， 不支持换行符等不可见字符 二、付款的应答报文（银联返回的数据） 1、应答报文的基本信息 1 版本号 version NS5 R 按规范填写。 &nbsp; 2 编码方式 encoding ANS1..20 R 填写报文使用的字符编码， UTF-8|GBK|GB2312|GB18030 若不填写，默认取值：UTF-8 &nbsp; 3 签名方法 signMethod N2 M 非对称签名：01（表示采用 RSA 签名） &nbsp; 4 签名 signature ANS1..1024 M 填写对报文摘要的签名，可通过SDK生成签名 &nbsp; 5 交易类型 txnType N2 R 取值： 00：查询交易，01：消费，02：预授权， 03：预授权完成，04：退货，05：圈存， 11：代收，12：代付，13：账单支付， 14：转账（保留），21：批量交易，22：批量查询， 31：消费撤销，32：预授权撤销，33：预授权完成撤销， 71：余额查询，72：实名认证-建立绑定关系， 73：账单查询，74：解除绑定关系，75：查询绑定关系， 77：发送短信验证码交易，78：开通查询交易， 79：开通交易，94：IC卡脚本通知 95：查询更新加密公钥证书 &nbsp; 6 交易子类 txnSubType N2 R 依据实际交易类型填写。默认取值：00 &nbsp; 7 产品类型 bizType N6 R 依据实际业务场景填写(目前仅使用后 4 位，签名 2 位 默认为 00) &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 &nbsp;000301：认证支付 2.0 000302：评级支付 000401：代付 000501：代收 000601：账单支付 000801：跨行收单 000901：绑定支付 001001：订购 000202：B2B &nbsp; 8 签名公钥 证书 signPubKeyCert AN2048 C 使用 RSA 签名方式时必选， 此域填写银联签名公钥证书 使用 RSA 签名方式时必选， 此域填写银联签名公钥证书。 2、应答报文的商户信息 1 接入类型 accessType N1 R 0：商户直连接入1：收单机构接入 2：平台商户接入 &nbsp; 2 商户代码 merId AN15 R 已被批准加入银联互联网系统的商户代码 3、应答报文的订单信息 1 商户订单号 orderId AN8..40 R 商户订单号，不应含“-”或“_” &nbsp; 2 交易币种 currencyCode AN3 R 币种格式必须为3位代码，境内客户取值：156（人民币） 默认为 156 3 交易金额 txnAmt N1..12 R 单位为分，不能带小数点，样例：1元送100 &nbsp; 4 订单发送时间 txnTime YYYYMMDDHHmmss R 必须使用当前北京时间（年年年年月月日日时时分分秒秒） 24小时制，样例：20151123152540，北京时间 商户发送交易时间 &nbsp; 5 支付方式 payType N4 C 默认不返回此域，如需要返此域，需要提交申请， 视商户配置返回，可在消费类交易中返回以下中的一种： 0001：认证支付 0002：快捷支付 0004：储值卡支付 0005：IC卡支付 0201：网银支付 1001：牡丹畅通卡支付 1002：中铁银通卡支付 0401：信用卡支付——暂定 0402：小额临时支付 0403：认证支付 2.0 &nbsp;0404：互联网订单手机支付 9000：其他无卡支付(如手机客户端支付) 根据商户配置返回 6 账号 accNo AN1..1024 C 交易账号。请求时使用加密公钥对交易账号加密， 并做 Base64 编码后上送； 应答时如需返回，则使用签名私钥 进行解密。 &nbsp;前台交易可由银联页面采集，也可由商户上送并返显。 如需锁定返显卡号，应通过保留域（reserved）上送卡 号锁定标识。 根据商户配置返回 7 支付卡类型 payCardType N2 C 消费交易，视商户配置返回。该域取值为： &nbsp;00：未知 01：借记账户 02：贷记账户 03：准贷记账户 04：借贷合一账户 05：预付费账户 06：半开放预付费账户 根据商户配置返回 8 请求方自定义域 reqReserved ANS1..1024 R 商户自定义保留域，交易应答时会原样返回 &nbsp; 9 保留域 reserved ANS1..2048 O 保留域包含多个子域，所有子域需用“{}”包含，子域间以“&amp;”符号链接。 格式如下：{子域名1=值&amp;子域名2=值&amp;子域名3=值}。 相关子域说明见注 5 &nbsp; &nbsp; 4、应答报文的通知信息 1 查询流水号 queryId AN21 M 由银联返回，用于在后续类交易中唯一标识一笔交易 消费交易的流水号，供后续查询用 2 应答码 respCode AN2 M 具体参见应答码定义章节 &nbsp; 3 应答信息 respMsg ANS1..256 M 填写具体的应答信息 &nbsp; 4 银联受理订单号 tn N21 C 商户推送订单后银联系统返回该流水号， 商户调用支付控件时使用 商户推送订单后银联移动支付 系统返回该流水号， 商户调用支付控件时使用 三、交易流程 相关交易流程如下： 交易步骤： 1、持卡人/企业浏览商户网页，选择消费交易； 2、商户组织交易报文，通过浏览器跳转至银联全渠道系统的支付页面； 3、持卡人/企业在银联全渠道系统支付页面输入相关交易信息； 4、全渠道系统完成用户的交易处理； 5、银联全渠道系统，将交易受理结果返回给商户； 6、因消费交易涉及资金清算，银联系统发送后台通知（交易结果）给商户。 四、真实开发实例 下面展示的代码为开发实例，代码展示顺序按照交易流程进行排列。 1、用户浏览页面，进行消费交易，对订单进行付款。页面提交订单信息表单的js代码 $(function () { //支付提交表单 $(&quot;#paySubmit&quot;).click(function () { $(&quot;#mainForm&quot;).submit(); }); });2、接收订单数据的控制器代码 public void GotoPay() { Dictionary&lt;string,string&gt; param = new Dictionary&lt;string,string&gt;(); param[&quot;orderId&quot;] = Request.Form[&quot;orderId&quot;].ToString();//订单号 param[&quot;merId&quot;] = merId; //商户号 decimal orderSum = IOrderService.GetMoney(param[&quot;orderId&quot;]); param[&quot;txnAmt&quot;] = ((int)orderSum*100).ToString(); //订单金额，单位为分 string payType = Request.Form[&quot;payType&quot;].ToString();//支付类型 if (payType==PayType.unionpay.ToString()) //银联支付 { UnionpayB2C.Unionpay(param); } } 3、支付层的银联支付处理 public static void Unionpay(Dictionary&lt;string, string&gt; data) { Dictionary&lt;string, string&gt; param = new Dictionary&lt;string, string&gt;(); //以下信息非特殊情况不需要改动 param[&quot;version&quot;] = &quot;5.0.0&quot;;//版本号 param[&quot;encoding&quot;] = &quot;UTF-8&quot;;//编码方式 param[&quot;txnType&quot;] = &quot;01&quot;;//交易类型 param[&quot;txnSubType&quot;] = &quot;01&quot;;//交易子类 param[&quot;bizType&quot;] = &quot;000201&quot;;//业务类型 param[&quot;signMethod&quot;] = &quot;01&quot;;//签名方法 param[&quot;channelType&quot;] = &quot;08&quot;;//渠道类型 param[&quot;accessType&quot;] = &quot;0&quot;;//接入类型 param[&quot;frontUrl&quot;] = SDKConfig.FrontUrl; //前台通知地址 param[&quot;backUrl&quot;] = SDKConfig.BackUrl; //后台通知地址 param[&quot;currencyCode&quot;] = &quot;156&quot;;//交易币种 //TODO 以下信息需要填写 param[&quot;merId&quot;] = data[&quot;merId&quot;];//商户号，请改自己的测试商户号，此处默认取demo演示页面传递的参数 param[&quot;orderId&quot;] = data[&quot;orderId&quot;];//商户订单号，8-32位数字字母，不能含“-”或“_”，此处默认取demo演示页面传递的参数，可以自行定制规则 param[&quot;txnTime&quot;] = DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;);//订单发送时间，格式为YYYYMMDDhhmmss，取北京时间，此处默认取demo演示页面传递的参数，参考取法： DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;) param[&quot;txnAmt&quot;] = data[&quot;txnAmt&quot;];//交易金额，单位分，此处默认取demo演示页面传递的参数 //param[&quot;reqReserved&quot;] = &quot;透传信息&quot;;//请求方保留域，透传字段，查询、通知、对账文件中均会原样出现，如有需要请启用并修改自己希望透传的数据 //TODO 其他特殊用法请查看 pages/api_01_gateway/special_use_purchase.htm AcpService.Sign(param, System.Text.Encoding.UTF8); string html = AcpService.CreateAutoFormHtml(SDKConfig.FrontTransUrl, param, System.Text.Encoding.UTF8);// 将SDKUtil产生的Html文档写入页面，从而引导用户浏览器重定向 HttpContext.Current.Response.ContentEncoding = Encoding.UTF8; // 指定输出编码 HttpContext.Current.Response.Write(html); } 4、接收银联应答报文的控制器代码 /// &lt;summary&gt; /// 前台交易返回结果 /// &lt;/summary&gt; [HttpPost] public ActionResult RcvResponse() { Dictionary&lt;string, string&gt; result = UnionpayB2C.FrontRcvResponse(); JsonDTO json = new JsonDTO() { Res = false, Msg = &quot;支付失败，请重新支付&quot; }; if (result!=null) { if (result[RespData.respCode.ToString()]==RespCode.success) //交易成功 { OrderDetailDTO dto = new OrderDetailDTO() { OrderNum = result[RespData.orderId.ToString()], OrderStatus = EnumOrderStatus.WatingReceive, PayTime = Convert.ToDateTime(result[RespData.txnTime.ToString()]) //OrderNum = &quot;20170217102907590110902120&quot;, //OrderStatus = EnumOrderStatus.WatingReceive, //PayTime = DateTime.Now }; json.Res=IOrderService.UpdateOrder(dto); if (json.Res) { IOrderService.AddOrderPayInfo(new OrderPayInfoDTO { OrderID = result[RespData.orderId.ToString()], QueryID = result[RespData.queryId.ToString()], TxnTime = result[RespData.txnTime.ToString()], TxnAmt =int.Parse(result[RespData.txnAmt.ToString()]), }); json.Msg = &quot;支付成功&quot;; } return View(json); } else { return View(json); } } return View(json); } 5、支付层处理银联应答报文 /// &lt;summary&gt; /// 接收银联返回的前台交易结果报文 /// &lt;/summary&gt; public static Dictionary&lt;string, string&gt; FrontRcvResponse() { if (HttpContext.Current.Request.HttpMethod == &quot;POST&quot;) { // 使用Dictionary保存参数 Dictionary&lt;string, string&gt; resData = new Dictionary&lt;string, string&gt;(); NameValueCollection coll = HttpContext.Current.Request.Form; string[] requestItem = coll.AllKeys; for (int i = 0; i &lt; requestItem.Length; i++) { resData.Add(requestItem[i], HttpContext.Current.Request.Form[requestItem[i]]); } // 返回报文中不包含UPOG,表示Server端正确接收交易请求,则需要验证Server端返回报文的签名 if (AcpService.Validate(resData, System.Text.Encoding.UTF8)) { //Response.Write(&quot;商户端验证返回报文签名成功\n&quot;); //string respcode = resData[&quot;respCode&quot;]; //00、A6为成功，其余为失败。其他字段也可按此方式获取。 //如果卡号我们业务配了会返回且配了需要加密的话，请按此方法解密 //if(resData.ContainsKey(&quot;accNo&quot;)) //{ // string accNo = SecurityUtil.DecryptData(resData[&quot;accNo&quot;], System.Text.Encoding.UTF8); //} //商户端根据返回报文内容处理自己的业务逻辑 ,DEMO此处只输出报文结果 return resData; } else { log.Error(&quot;商户端验证银联返回报文结果：验证签名失败&quot;); return null; } } return null; } 注：银联的测试环境和生产环境的配置是不同的，其中，前台交易通知地址配置为接收银联应答报文的地址。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/02/24/c5db57e548e8ce34028414944f31b48f.html" />
<meta property="og:url" content="https://mlh.app/2017/02/24/c5db57e548e8ce34028414944f31b48f.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-24T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"第一次做银联支付的开发，无论是支付还是退款都走了不少弯路，银联支付的sdk和demo并不容易让人明白如何调用sdk。所以，想写两篇文章把开发的过程分享出来供大家参考。这篇文章讲一下银联支付的网关支付产品的前台交易类型的付款开发流程。闲话少叙，进入正题。 一、付款需要发送的报文（发送给银联的数据） 报文中包含以下信息： 1、基本信息，必须发送，可固定不变 1 版本号 version NS5 M 按规范填写。 固定填写 2 编码方式 encoding ANS1..20 M 填写报文使用的字符编码，UTF-8|GBK|GB2312|GB18030 若不填写，默认取值：UTF-8 可取值UTF-8或GBK 3 证书ID certId N1..128 M 填写签名私钥证书的 Serial Number， 该值可通过银联提 供的 SDK 获取 &nbsp; 4 签名方法 signMethod N2 M 非对称签名：01（表示采用 RSA 签名） 固定填写：01（表示采用 RSA 签名） 5 签名 signature ANS1..1024 M 填写对报文摘要的签名，可通过SDK生成签名 填写对报文摘要的签名，可通过SDK生成签名 6 交易类型 txnType N2 M 取值：00：查询交易，01：消费，02：预授权， 03：预授权完成，04：退货，05：圈存， 11：代收，12：代付， 13：账单支付，14：转账（保留），21：批量交易， 22：批量查询，31：消费撤销， 32：预授权撤销，33：预授权完成撤销， 71：余额查询，72：实名认证-建立绑定关系， 73：账单查询，74：解除绑定关系， 75：查询绑定关系，77：发送短信验证码交易， 78：开通查询交易，79：开通交易， 94：IC卡脚本通知 95：查询更新加密公钥证书 固定填写：01 7 交易子类 txnSubType N2 M 依据实际交易类型填写。默认取值：00 固定填写：01：自助消费， 通过地址的方式区 分前台消费 和后台消费（含无跳转 支付） 8 产品类型 bizType N6 M 依据实际业务场景填写 (目前仅使用后 4 位，签名 2 位 默认为 00) &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 000301：认证支付 2.0 000302：评级支付 000401：代付 &nbsp;000501：代收 000601：账单支付 000801： 跨行收单 000901：绑定支付 001001：订购 000202：B2B 000201 9 渠道类型 channelType N2 M 05：语音07：互联网08：移动 16：数字机顶盒 固定填写：07 2、商户信息 接入类型 accessType N1 M 0：商户直连接入 1：收单机构接入 &nbsp;2：平台商户接入 0：普通商户直连接入 &nbsp;1：收单机构接入 2 商户代码 merId AN15 M 已被批准加入银联互联网系统 的商户代码 &nbsp; 3 前台通知地址 frontUrl ANS1..256 C 前台返回商户结果时使用， 前台类交易需上送 不支持换行符等不可见字符 前台返回商户结果时使用， 例：https://xxx.xxx.com/xxx 4 后台通知地址 backUrl ANS1..256 M 后台返回商户结果时使用， 如上送，则发送商户后台交 易结果通知， 不支持换行符等不可见字符， 如需通过专 线通知， 需要在通知地址前面加上前缀： 专线的首字母 加竖线 ZX| 后台返回商户结果时使用， 例：https://xxx.xxx.com/xxx 5 失败交易 前台跳转地址 frontFailUrl ANS1..256 O 前台消费交易若商户上送此字段， 则在支付失败时， 页面跳转至商户该URL （不带交易信息，仅跳转）， 支持HTTP与HTTPS协议， 互联网可访问 前台消费交易若商户上送此字段， 则在支付失败时， 页面跳转至商户该URL （不带交易信息，仅跳转）， 支持HTTP与HTTPS协议，互联网可访问 3、订单信息 商户订单号 orderId AN8..40 M 商户订单号，不应含“-”或“_” 商户端生成，例：12345asdf 2 交易币种 currencyCode AN3 M 币种格式必须为3位代码， 境内客户取值：156（人民币） 固定填写：156 3 交易金额 txnAmt N1..12 M 单位为分，不能带小数点，样例：1元送100 单位为分，例：1元填写100 4 订单发送时间 txnTime YYYYMMDDHHmmss M 必须使用当前北京时间 （年年年年月月日日时时分分秒秒）24小时制， 样例：20151123152540，北京时间 商户发送交易时间 商户发送交易时间，例：20151118100505 5 订单接收超时时间 orderTimeout N1..10 O 单位为毫秒，交易发生时，该笔交易在银联全渠道系统中有效的最长时间。 当距离交易发送时间超过该时间时，银联全渠道系统不再为该笔交易提供支付服务 1、前台类消费交易时上送 2、认证支付 2.0，后台交易时可选 6 支付超时时间 payTimeout YYYYMMDDHHmmss O 订单支付超时时间，超过此时间用户支付成功的交易， 不通知商户，系统自动退款， 大约 5 个工作日金额返还 到用户账户 非网银的交易：超过此时间未完成支付时银联页面会提示超时，不允许后续支付。 &nbsp;跳转网银的交易银联无法控制，超过此时间用户支付成功的交易，不通知商户，系统自动退款， 大约5个工作日金额返还到用户账户。 7 发卡机构代码 issInsCode AN1..20 C 当账号类型为 02-存折时需填写 在前台类交易时填写默认银行代码， 支持直接跳转到网 银 1、当帐号类型为02-存折时需填写 2、在前台类交易时填写默认银行代码，支持直接跳转到网银。 银行简码列表参考附录C.1、C.2，其中C.2银行列表仅支持借记卡，例：工行填写ICBC 8 请求方自定义域 reqReserved ANS1..1024 O 商户自定义保留域， 交易应答时会原样返回 商户自定义保留域，交易应答时会原样返回 4、机构信息 收单机构代码 acqInsCode AN8..11 C 已被批准加入银联互联网系统的收单机构代码， 适用于收单机构接入测试场景。 在商户接入时不返回此域， 且上送报文中不应出现此域。 &nbsp; 2 商户类别 merCatCode N4 C 填写MCC码，接入类型为收单机构接入时需上送 &nbsp; 3 商户名称 merName ANS1..40 C 接入类型为收单机构接入时需上送, 不支持换行符等不可见字符 &nbsp; 4 商户简称 merAbbr ANS1..8 C 接入类型为收单机构接入时需上送最长 8 位， 不支持换行符等不可见字符 二、付款的应答报文（银联返回的数据） 1、应答报文的基本信息 1 版本号 version NS5 R 按规范填写。 &nbsp; 2 编码方式 encoding ANS1..20 R 填写报文使用的字符编码， UTF-8|GBK|GB2312|GB18030 若不填写，默认取值：UTF-8 &nbsp; 3 签名方法 signMethod N2 M 非对称签名：01（表示采用 RSA 签名） &nbsp; 4 签名 signature ANS1..1024 M 填写对报文摘要的签名，可通过SDK生成签名 &nbsp; 5 交易类型 txnType N2 R 取值： 00：查询交易，01：消费，02：预授权， 03：预授权完成，04：退货，05：圈存， 11：代收，12：代付，13：账单支付， 14：转账（保留），21：批量交易，22：批量查询， 31：消费撤销，32：预授权撤销，33：预授权完成撤销， 71：余额查询，72：实名认证-建立绑定关系， 73：账单查询，74：解除绑定关系，75：查询绑定关系， 77：发送短信验证码交易，78：开通查询交易， 79：开通交易，94：IC卡脚本通知 95：查询更新加密公钥证书 &nbsp; 6 交易子类 txnSubType N2 R 依据实际交易类型填写。默认取值：00 &nbsp; 7 产品类型 bizType N6 R 依据实际业务场景填写(目前仅使用后 4 位，签名 2 位 默认为 00) &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 &nbsp;000301：认证支付 2.0 000302：评级支付 000401：代付 000501：代收 000601：账单支付 000801：跨行收单 000901：绑定支付 001001：订购 000202：B2B &nbsp; 8 签名公钥 证书 signPubKeyCert AN2048 C 使用 RSA 签名方式时必选， 此域填写银联签名公钥证书 使用 RSA 签名方式时必选， 此域填写银联签名公钥证书。 2、应答报文的商户信息 1 接入类型 accessType N1 R 0：商户直连接入1：收单机构接入 2：平台商户接入 &nbsp; 2 商户代码 merId AN15 R 已被批准加入银联互联网系统的商户代码 3、应答报文的订单信息 1 商户订单号 orderId AN8..40 R 商户订单号，不应含“-”或“_” &nbsp; 2 交易币种 currencyCode AN3 R 币种格式必须为3位代码，境内客户取值：156（人民币） 默认为 156 3 交易金额 txnAmt N1..12 R 单位为分，不能带小数点，样例：1元送100 &nbsp; 4 订单发送时间 txnTime YYYYMMDDHHmmss R 必须使用当前北京时间（年年年年月月日日时时分分秒秒） 24小时制，样例：20151123152540，北京时间 商户发送交易时间 &nbsp; 5 支付方式 payType N4 C 默认不返回此域，如需要返此域，需要提交申请， 视商户配置返回，可在消费类交易中返回以下中的一种： 0001：认证支付 0002：快捷支付 0004：储值卡支付 0005：IC卡支付 0201：网银支付 1001：牡丹畅通卡支付 1002：中铁银通卡支付 0401：信用卡支付——暂定 0402：小额临时支付 0403：认证支付 2.0 &nbsp;0404：互联网订单手机支付 9000：其他无卡支付(如手机客户端支付) 根据商户配置返回 6 账号 accNo AN1..1024 C 交易账号。请求时使用加密公钥对交易账号加密， 并做 Base64 编码后上送； 应答时如需返回，则使用签名私钥 进行解密。 &nbsp;前台交易可由银联页面采集，也可由商户上送并返显。 如需锁定返显卡号，应通过保留域（reserved）上送卡 号锁定标识。 根据商户配置返回 7 支付卡类型 payCardType N2 C 消费交易，视商户配置返回。该域取值为： &nbsp;00：未知 01：借记账户 02：贷记账户 03：准贷记账户 04：借贷合一账户 05：预付费账户 06：半开放预付费账户 根据商户配置返回 8 请求方自定义域 reqReserved ANS1..1024 R 商户自定义保留域，交易应答时会原样返回 &nbsp; 9 保留域 reserved ANS1..2048 O 保留域包含多个子域，所有子域需用“{}”包含，子域间以“&amp;”符号链接。 格式如下：{子域名1=值&amp;子域名2=值&amp;子域名3=值}。 相关子域说明见注 5 &nbsp; &nbsp; 4、应答报文的通知信息 1 查询流水号 queryId AN21 M 由银联返回，用于在后续类交易中唯一标识一笔交易 消费交易的流水号，供后续查询用 2 应答码 respCode AN2 M 具体参见应答码定义章节 &nbsp; 3 应答信息 respMsg ANS1..256 M 填写具体的应答信息 &nbsp; 4 银联受理订单号 tn N21 C 商户推送订单后银联系统返回该流水号， 商户调用支付控件时使用 商户推送订单后银联移动支付 系统返回该流水号， 商户调用支付控件时使用 三、交易流程 相关交易流程如下： 交易步骤： 1、持卡人/企业浏览商户网页，选择消费交易； 2、商户组织交易报文，通过浏览器跳转至银联全渠道系统的支付页面； 3、持卡人/企业在银联全渠道系统支付页面输入相关交易信息； 4、全渠道系统完成用户的交易处理； 5、银联全渠道系统，将交易受理结果返回给商户； 6、因消费交易涉及资金清算，银联系统发送后台通知（交易结果）给商户。 四、真实开发实例 下面展示的代码为开发实例，代码展示顺序按照交易流程进行排列。 1、用户浏览页面，进行消费交易，对订单进行付款。页面提交订单信息表单的js代码 $(function () { //支付提交表单 $(&quot;#paySubmit&quot;).click(function () { $(&quot;#mainForm&quot;).submit(); }); });2、接收订单数据的控制器代码 public void GotoPay() { Dictionary&lt;string,string&gt; param = new Dictionary&lt;string,string&gt;(); param[&quot;orderId&quot;] = Request.Form[&quot;orderId&quot;].ToString();//订单号 param[&quot;merId&quot;] = merId; //商户号 decimal orderSum = IOrderService.GetMoney(param[&quot;orderId&quot;]); param[&quot;txnAmt&quot;] = ((int)orderSum*100).ToString(); //订单金额，单位为分 string payType = Request.Form[&quot;payType&quot;].ToString();//支付类型 if (payType==PayType.unionpay.ToString()) //银联支付 { UnionpayB2C.Unionpay(param); } } 3、支付层的银联支付处理 public static void Unionpay(Dictionary&lt;string, string&gt; data) { Dictionary&lt;string, string&gt; param = new Dictionary&lt;string, string&gt;(); //以下信息非特殊情况不需要改动 param[&quot;version&quot;] = &quot;5.0.0&quot;;//版本号 param[&quot;encoding&quot;] = &quot;UTF-8&quot;;//编码方式 param[&quot;txnType&quot;] = &quot;01&quot;;//交易类型 param[&quot;txnSubType&quot;] = &quot;01&quot;;//交易子类 param[&quot;bizType&quot;] = &quot;000201&quot;;//业务类型 param[&quot;signMethod&quot;] = &quot;01&quot;;//签名方法 param[&quot;channelType&quot;] = &quot;08&quot;;//渠道类型 param[&quot;accessType&quot;] = &quot;0&quot;;//接入类型 param[&quot;frontUrl&quot;] = SDKConfig.FrontUrl; //前台通知地址 param[&quot;backUrl&quot;] = SDKConfig.BackUrl; //后台通知地址 param[&quot;currencyCode&quot;] = &quot;156&quot;;//交易币种 //TODO 以下信息需要填写 param[&quot;merId&quot;] = data[&quot;merId&quot;];//商户号，请改自己的测试商户号，此处默认取demo演示页面传递的参数 param[&quot;orderId&quot;] = data[&quot;orderId&quot;];//商户订单号，8-32位数字字母，不能含“-”或“_”，此处默认取demo演示页面传递的参数，可以自行定制规则 param[&quot;txnTime&quot;] = DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;);//订单发送时间，格式为YYYYMMDDhhmmss，取北京时间，此处默认取demo演示页面传递的参数，参考取法： DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;) param[&quot;txnAmt&quot;] = data[&quot;txnAmt&quot;];//交易金额，单位分，此处默认取demo演示页面传递的参数 //param[&quot;reqReserved&quot;] = &quot;透传信息&quot;;//请求方保留域，透传字段，查询、通知、对账文件中均会原样出现，如有需要请启用并修改自己希望透传的数据 //TODO 其他特殊用法请查看 pages/api_01_gateway/special_use_purchase.htm AcpService.Sign(param, System.Text.Encoding.UTF8); string html = AcpService.CreateAutoFormHtml(SDKConfig.FrontTransUrl, param, System.Text.Encoding.UTF8);// 将SDKUtil产生的Html文档写入页面，从而引导用户浏览器重定向 HttpContext.Current.Response.ContentEncoding = Encoding.UTF8; // 指定输出编码 HttpContext.Current.Response.Write(html); } 4、接收银联应答报文的控制器代码 /// &lt;summary&gt; /// 前台交易返回结果 /// &lt;/summary&gt; [HttpPost] public ActionResult RcvResponse() { Dictionary&lt;string, string&gt; result = UnionpayB2C.FrontRcvResponse(); JsonDTO json = new JsonDTO() { Res = false, Msg = &quot;支付失败，请重新支付&quot; }; if (result!=null) { if (result[RespData.respCode.ToString()]==RespCode.success) //交易成功 { OrderDetailDTO dto = new OrderDetailDTO() { OrderNum = result[RespData.orderId.ToString()], OrderStatus = EnumOrderStatus.WatingReceive, PayTime = Convert.ToDateTime(result[RespData.txnTime.ToString()]) //OrderNum = &quot;20170217102907590110902120&quot;, //OrderStatus = EnumOrderStatus.WatingReceive, //PayTime = DateTime.Now }; json.Res=IOrderService.UpdateOrder(dto); if (json.Res) { IOrderService.AddOrderPayInfo(new OrderPayInfoDTO { OrderID = result[RespData.orderId.ToString()], QueryID = result[RespData.queryId.ToString()], TxnTime = result[RespData.txnTime.ToString()], TxnAmt =int.Parse(result[RespData.txnAmt.ToString()]), }); json.Msg = &quot;支付成功&quot;; } return View(json); } else { return View(json); } } return View(json); } 5、支付层处理银联应答报文 /// &lt;summary&gt; /// 接收银联返回的前台交易结果报文 /// &lt;/summary&gt; public static Dictionary&lt;string, string&gt; FrontRcvResponse() { if (HttpContext.Current.Request.HttpMethod == &quot;POST&quot;) { // 使用Dictionary保存参数 Dictionary&lt;string, string&gt; resData = new Dictionary&lt;string, string&gt;(); NameValueCollection coll = HttpContext.Current.Request.Form; string[] requestItem = coll.AllKeys; for (int i = 0; i &lt; requestItem.Length; i++) { resData.Add(requestItem[i], HttpContext.Current.Request.Form[requestItem[i]]); } // 返回报文中不包含UPOG,表示Server端正确接收交易请求,则需要验证Server端返回报文的签名 if (AcpService.Validate(resData, System.Text.Encoding.UTF8)) { //Response.Write(&quot;商户端验证返回报文签名成功\\n&quot;); //string respcode = resData[&quot;respCode&quot;]; //00、A6为成功，其余为失败。其他字段也可按此方式获取。 //如果卡号我们业务配了会返回且配了需要加密的话，请按此方法解密 //if(resData.ContainsKey(&quot;accNo&quot;)) //{ // string accNo = SecurityUtil.DecryptData(resData[&quot;accNo&quot;], System.Text.Encoding.UTF8); //} //商户端根据返回报文内容处理自己的业务逻辑 ,DEMO此处只输出报文结果 return resData; } else { log.Error(&quot;商户端验证银联返回报文结果：验证签名失败&quot;); return null; } } return null; } 注：银联的测试环境和生产环境的配置是不同的，其中，前台交易通知地址配置为接收银联应答报文的地址。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/02/24/c5db57e548e8ce34028414944f31b48f.html","headline":".NET银联支付开发（一）：支付","dateModified":"2017-02-24T00:00:00+08:00","datePublished":"2017-02-24T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/02/24/c5db57e548e8ce34028414944f31b48f.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>.NET银联支付开发（一）：支付</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>第一次做银联支付的开发，无论是支付还是退款都走了不少弯路，银联支付的sdk和demo并不容易让人明白如何调用sdk。所以，想写两篇文章把开发的过程分享出来供大家参考。这篇文章讲一下银联支付的<strong>网关支付产品</strong>的<strong>前台交易类型</strong>的付款开发流程。闲话少叙，进入正题。</p> 
  <h3>一、付款需要发送的报文（发送给银联的数据）<br></h3> 
  <p>报文中包含以下信息：</p> 
  <h4>1、基本信息，必须发送，可固定不变<br></h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 1</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 版本号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> version</td> 
     <td title="NS5：长度为5字节定长的数字字符和/或特殊字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> NS5</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 按规范填写。</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 固定填写</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 编码方式</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> encoding</td> 
     <td title="ANS1..20：长度为1到20字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> ANS1..20</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 填写报文使用的字符编码，UTF-8|GBK|GB2312|GB18030<br> 若不填写，默认取值：UTF-8</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 可取值UTF-8或GBK</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 证书ID</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> certId</td> 
     <td title="N1..128：长度为1到128字节的变长整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N1..128</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 填写签名私钥证书的 Serial Number，<br> 该值可通过银联提 供的 SDK 获取</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 签名方法</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> signMethod</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N2</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 非对称签名：01（表示采用 RSA 签名）</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 固定填写：01（表示采用 RSA 签名）</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 5</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 签名</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> signature</td> 
     <td title="ANS1..1024：长度为1到1024字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> ANS1..1024</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 填写对报文摘要的签名，可通过SDK生成签名</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 填写对报文摘要的签名，可通过SDK生成签名</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 6</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 交易类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> txnType</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N2</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 取值：00：查询交易，01：消费，02：预授权，<br> 03：预授权完成，04：退货，05：圈存，<br> 11：代收，12：代付，<br> 13：账单支付，14：转账（保留），21：批量交易，<br> 22：批量查询，31：消费撤销，<br> 32：预授权撤销，33：预授权完成撤销，<br> 71：余额查询，72：实名认证-建立绑定关系，<br> 73：账单查询，74：解除绑定关系，<br> 75：查询绑定关系，77：发送短信验证码交易，<br> 78：开通查询交易，79：开通交易，<br> 94：IC卡脚本通知 95：查询更新加密公钥证书</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 固定填写：01</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 7</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 交易子类</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> txnSubType</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N2</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 依据实际交易类型填写。默认取值：00</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 固定填写：01：自助消费，<br> 通过地址的方式区 分前台消费<br> 和后台消费（含无跳转 支付）</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 8</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 产品类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> bizType</td> 
     <td title="N6：长度为6字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N6</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 依据实际业务场景填写<br> (目前仅使用后 4 位，签名 2 位 默认为 00)<br> &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付 <br> 000301：认证支付 2.0 000302：评级支付 000401：代付<br> &nbsp;000501：代收 000601：账单支付 000801：<br> 跨行收单 000901：绑定支付 001001：订购 000202：B2B</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 000201</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 9</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 渠道类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> channelType</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N2</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 05：语音07：互联网08：移动 16：数字机顶盒</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 固定填写：07</td> 
    </tr>
   </tbody>
  </table>
  <h4>2、商户信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> <br> 接入类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> accessType</td> 
     <td title="N1：长度为1字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N1</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 0：商户直连接入<br> 1：收单机构接入<br> &nbsp;2：平台商户接入</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 0：普通商户直连接入<br> &nbsp;1：收单机构接入</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 商户代码</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> merId</td> 
     <td title="AN15：长度为15字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> AN15</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 已被批准加入银联互联网系统<br> 的商户代码</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 前台通知地址</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> frontUrl</td> 
     <td title="ANS1..256：长度为1到256字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> ANS1..256</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 前台返回商户结果时使用，<br> 前台类交易需上送 <br> 不支持换行符等不可见字符</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 前台返回商户结果时使用，<br> 例：https://xxx.xxx.com/xxx</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 后台通知地址</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> backUrl</td> 
     <td title="ANS1..256：长度为1到256字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> ANS1..256</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 后台返回商户结果时使用，<br> 如上送，则发送商户后台交 易结果通知，<br> 不支持换行符等不可见字符，<br> 如需通过专 线通知，<br> 需要在通知地址前面加上前缀：<br> 专线的首字母 加竖线 ZX|</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 后台返回商户结果时使用，<br> 例：https://xxx.xxx.com/xxx</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 5</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 失败交易<br> 前台跳转地址</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> frontFailUrl</td> 
     <td title="ANS1..256：长度为1到256字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> ANS1..256</td> 
     <td title="受理方和发卡方自选填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> O</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 前台消费交易若商户上送此字段，<br> 则在支付失败时，<br> 页面跳转至商户该URL<br> （不带交易信息，仅跳转），<br> 支持HTTP与HTTPS协议，<br> 互联网可访问</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 前台消费交易若商户上送此字段，<br> 则在支付失败时，<br> 页面跳转至商户该URL<br> （不带交易信息，仅跳转），<br> 支持HTTP与HTTPS协议，互联网可访问</td> 
    </tr>
   </tbody>
  </table>
  <h4>3、订单信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> <br> 商户订单号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> orderId</td> 
     <td title="AN8..40" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> AN8..40</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 商户订单号，不应含“-”或“_”</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 商户端生成，例：12345asdf</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 交易币种</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> currencyCode</td> 
     <td title="AN3：长度为3字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> AN3</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 币种格式必须为3位代码，<br> 境内客户取值：156（人民币）</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 固定填写：156</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 交易金额</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> txnAmt</td> 
     <td title="N1..12：长度为1到12字节的变长整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N1..12</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 单位为分，不能带小数点，样例：1元送100</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 单位为分，例：1元填写100</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 订单发送时间</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> txnTime</td> 
     <td title="YYYYMMDDHHmmss：时间格式[年(4字节)月日HH分秒]，示例  20150101HH0000" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> YYYYMMDDHHmmss</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 必须使用当前北京时间<br> （年年年年月月日日时时分分秒秒）24小时制，<br> 样例：20151123152540，北京时间 商户发送交易时间</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 商户发送交易时间，例：20151118100505</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 5</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 订单接收超时时间</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> orderTimeout</td> 
     <td title="N1..10：长度为1到10字节的变长整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> N1..10</td> 
     <td title="受理方和发卡方自选填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> O</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 单位为毫秒，交易发生时，该笔交易在银联全渠道系统中有效的最长时间。<br> 当距离交易发送时间超过该时间时，银联全渠道系统不再为该笔交易提供支付服务</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 1、前台类消费交易时上送 <br> 2、认证支付 2.0，后台交易时可选</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 6</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 支付超时时间</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> payTimeout</td> 
     <td title="YYYYMMDDHHmmss：时间格式[年(4字节)月日HH分秒]，示例  20150101HH0000" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> YYYYMMDDHHmmss</td> 
     <td title="受理方和发卡方自选填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> O</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 订单支付超时时间，超过此时间用户支付成功的交易， 不通知商户，系统自动退款，<br> 大约 5 个工作日金额返还 到用户账户</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 非网银的交易：超过此时间未完成支付时银联页面会提示超时，不允许后续支付。<br> &nbsp;跳转网银的交易银联无法控制，超过此时间用户支付成功的交易，不通知商户，系统自动退款，<br> 大约5个工作日金额返还到用户账户。</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 7</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 发卡机构代码</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> issInsCode</td> 
     <td title="AN1..20：长度为1到20字节的变长字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> AN1..20</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 当账号类型为 02-存折时需填写 在前台类交易时填写默认银行代码，<br> 支持直接跳转到网 银</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 1、当帐号类型为02-存折时需填写 <br> 2、在前台类交易时填写默认银行代码，支持直接跳转到网银。<br> 银行简码列表参考附录C.1、C.2，其中C.2银行列表仅支持借记卡，例：工行填写ICBC</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 8</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> 请求方自定义域</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> reqReserved</td> 
     <td title="ANS1..1024：长度为1到1024字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> ANS1..1024</td> 
     <td title="受理方和发卡方自选填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;"> O</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 商户自定义保留域，<br> 交易应答时会原样返回</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;"> 商户自定义保留域，交易应答时会原样返回</td> 
    </tr>
   </tbody>
  </table>
  <h4>4、机构信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> <br> 收单机构代码</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> acqInsCode</td> 
     <td title="AN8..11：长度为8到11字节的变长字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN8..11</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 已被批准加入银联互联网系统的收单机构代码，<br> 适用于收单机构接入测试场景。<br> 在商户接入时不返回此域，<br> 且上送报文中不应出现此域。</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 商户类别</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> merCatCode</td> 
     <td title="N4：长度为4字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N4</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 填写MCC码，接入类型为收单机构接入时需上送</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 商户名称</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> merName</td> 
     <td title="ANS1..40：长度为1到40字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..40</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 接入类型为收单机构接入时需上送,<br> 不支持换行符等不可见字符</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 商户简称</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> merAbbr</td> 
     <td title="ANS1..8：长度为1到8字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..8</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 接入类型为收单机构接入时需上送最长 8 位，<br> 不支持换行符等不可见字符</td> 
    </tr>
   </tbody>
  </table>
  <br>
  <h3>二、付款的应答报文（银联返回的数据）</h3> 
  <h4>1、应答报文的基本信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 1</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 版本号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> version</td> 
     <td title="NS5：长度为5字节定长的数字字符和/或特殊字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> NS5</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 按规范填写。</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 编码方式</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> encoding</td> 
     <td title="ANS1..20：长度为1到20字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..20</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 填写报文使用的字符编码，<br> UTF-8|GBK|GB2312|GB18030<br> 若不填写，默认取值：UTF-8</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 签名方法</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> signMethod</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N2</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 非对称签名：01（表示采用 RSA 签名）</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 签名</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> signature</td> 
     <td title="ANS1..1024：长度为1到1024字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..1024</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 填写对报文摘要的签名，可通过SDK生成签名</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 5</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 交易类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> txnType</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N2</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 取值：<br> 00：查询交易，01：消费，02：预授权，<br> 03：预授权完成，04：退货，05：圈存，<br> 11：代收，12：代付，13：账单支付，<br> 14：转账（保留），21：批量交易，22：批量查询，<br> 31：消费撤销，32：预授权撤销，33：预授权完成撤销，<br> 71：余额查询，72：实名认证-建立绑定关系，<br> 73：账单查询，74：解除绑定关系，75：查询绑定关系，<br> 77：发送短信验证码交易，78：开通查询交易，<br> 79：开通交易，94：IC卡脚本通知 <br> 95：查询更新加密公钥证书</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 6</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 交易子类</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> txnSubType</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N2</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 依据实际交易类型填写。默认取值：00</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 7</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 产品类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> bizType</td> 
     <td title="N6：长度为6字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N6</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 依据实际业务场景填写(目前仅使用后 4 位，签名 2 位 默认为 00)<br> &nbsp;默认取值：000000 具体取值范围： 000201：B2C 网关支付<br> &nbsp;000301：认证支付 2.0 000302：评级支付 000401：代付 <br> 000501：代收 000601：账单支付 <br> 000801：跨行收单 <br> 000901：绑定支付 001001：订购 <br> 000202：B2B</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 8</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 签名公钥 证书</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> signPubKeyCert</td> 
     <td title="AN2048：长度为2048字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN2048</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 使用 RSA 签名方式时必选，<br> 此域填写银联签名公钥证书</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 使用 RSA 签名方式时必选，<br> 此域填写银联签名公钥证书。</td> 
    </tr>
   </tbody>
  </table>
  <h4>2、应答报文的商户信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 1</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 接入类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> accessType</td> 
     <td title="N1：长度为1字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N1</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 0：商户直连接入1：收单机构接入 2：平台商户接入</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 商户代码</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> merId</td> 
     <td title="AN15：长度为15字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN15</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 已被批准加入银联互联网系统的商户代码</td> 
    </tr>
   </tbody>
  </table>
  <h4>3、应答报文的订单信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 1</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 商户订单号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> orderId</td> 
     <td title="AN8..40" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN8..40</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 商户订单号，不应含“-”或“_”</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 交易币种</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> currencyCode</td> 
     <td title="AN3：长度为3字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN3</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 币种格式必须为3位代码，境内客户取值：156（人民币）</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 默认为 156</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 交易金额</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> txnAmt</td> 
     <td title="N1..12：长度为1到12字节的变长整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N1..12</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 单位为分，不能带小数点，样例：1元送100</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 订单发送时间</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> txnTime</td> 
     <td title="YYYYMMDDHHmmss：时间格式[年(4字节)月日HH分秒]，示例  20150101HH0000" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> YYYYMMDDHHmmss</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 必须使用当前北京时间（年年年年月月日日时时分分秒秒）<br> 24小时制，样例：20151123152540，北京时间 商户发送交易时间</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 5</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 支付方式</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> payType</td> 
     <td title="N4：长度为4字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N4</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 默认不返回此域，如需要返此域，需要提交申请，<br> 视商户配置返回，可在消费类交易中返回以下中的一种：<br> 0001：认证支付 0002：快捷支付 0004：储值卡支付 <br> 0005：IC卡支付 0201：网银支付 1001：牡丹畅通卡支付 <br> 1002：中铁银通卡支付 0401：信用卡支付——暂定 <br> 0402：小额临时支付 0403：认证支付 2.0<br> &nbsp;0404：互联网订单手机支付 9000：其他无卡支付(如手机客户端支付)</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 根据商户配置返回</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 6</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 账号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> accNo</td> 
     <td title="AN1..1024：长度为1到1024字节的变长字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN1..1024</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 交易账号。请求时使用加密公钥对交易账号加密，<br> 并做 Base64 编码后上送；<br> 应答时如需返回，则使用签名私钥 进行解密。<br> &nbsp;前台交易可由银联页面采集，也可由商户上送并返显。 <br> 如需锁定返显卡号，应通过保留域（reserved）上送卡 号锁定标识。</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 根据商户配置返回</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 7</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 支付卡类型</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> payCardType</td> 
     <td title="N2：长度为2字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N2</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 消费交易，视商户配置返回。该域取值为：<br> &nbsp;00：未知 01：借记账户 02：贷记账户 <br> 03：准贷记账户 04：借贷合一账户 05：预付费账户 <br> 06：半开放预付费账户</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 根据商户配置返回</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 8</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 请求方自定义域</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> reqReserved</td> 
     <td title="ANS1..1024：长度为1到1024字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..1024</td> 
     <td title="必须与先前报文中对应域的值相同的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> R</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 商户自定义保留域，交易应答时会原样返回</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr class="trclk">
     <td style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 9</td> 
     <td title="点击查看详情" class="demo-tip-twitter" style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 保留域</td> 
     <td title="点击查看详情" class="demo-tip-twitter" style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> reserved</td> 
     <td title="ANS1..2048：长度为1到2048字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..2048</td> 
     <td title="受理方和发卡方自选填写的域" class="demo-tip-twitter" style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> O</td> 
     <td title="点击查看详情" class="demo-tip-twitter" style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 保留域包含多个子域，所有子域需用“{}”包含，子域间以“&amp;”符号链接。<br> 格式如下：{子域名1=值&amp;子域名2=值&amp;子域名3=值}。<br> 相关子域说明见注 5</td> 
     <td title="点击查看详情" class="demo-tip-twitter" style="color:rgb(70,159,254);border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
   </tbody>
   <tbody>
    <tr>
     <td colspan="7" style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;text-indent:5px;"> &nbsp;</td> 
    </tr>
   </tbody>
  </table>
  <br>
  <h4>4、应答报文的通知信息</h4> 
  <p> </p>
  <table class="table_border1">
   <tbody>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 1</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 查询流水号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> queryId</td> 
     <td title="AN21：长度为21字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN21</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 由银联返回，用于在后续类交易中唯一标识一笔交易</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 消费交易的流水号，供后续查询用</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 2</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 应答码</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> respCode</td> 
     <td title="AN2：长度为2字节定长的字母和/或数字字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> AN2</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 具体参见应答码定义章节</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 3</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 应答信息</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> respMsg</td> 
     <td title="ANS1..256：长度为1到256字节的变长字母、数字和/或特殊符号字符" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> ANS1..256</td> 
     <td title="必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> M</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 填写具体的应答信息</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> &nbsp;</td> 
    </tr>
    <tr>
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 4</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> 银联受理订单号</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> tn</td> 
     <td title="N21：长度为21字节定长的整型数值，若表示金额，则以分为单位" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> N21</td> 
     <td title="某条件成立时必须填写的域" class="demo-tip-twitter" style="border:1px solid rgb(224,224,224);text-align:center;font-size:14px;display:table-cell;"> C</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 商户推送订单后银联系统返回该流水号，<br> 商户调用支付控件时使用</td> 
     <td style="border:1px solid rgb(224,224,224);text-align:left;font-size:14px;display:table-cell;"> 商户推送订单后银联移动支付 系统返回该流水号，<br> 商户调用支付控件时使用</td> 
    </tr>
   </tbody>
  </table>
  <h3>三、交易流程</h3> 
  <p></p> 
  <p><span style="font-family:'微软雅黑';">相关交易流程如下：</span></p> 
  <p><img title="1416391251671030464.png" alt="1416391251671030464.png" src="https://open.unionpay.com/upload/image/1416391251671030464.png" border="0" style="border:0px;width:532px;"></p> 
  <p><span style="font-family:'微软雅黑';">交易步骤：</span></p> 
  <p><span style="font-family:'微软雅黑';">1、持卡人/企业浏览商户网页，选择消费交易；</span></p> 
  <p><span style="font-family:'微软雅黑';">2、商户组织交易报文，通过浏览器跳转至银联全渠道系统的支付页面；</span></p> 
  <p><span style="font-family:'微软雅黑';">3、持卡人/企业在银联全渠道系统支付页面输入相关交易信息；</span></p> 
  <p><span style="font-family:'微软雅黑';">4、全渠道系统完成用户的交易处理；</span></p> 
  <p><span style="font-family:'微软雅黑';">5、银联全渠道系统，将交易受理结果返回给商户；</span></p> 
  <p><span style="font-family:'微软雅黑';">6、因消费交易涉及资金清算，银联系统发送后台通知（交易结果）给商户。</span></p> 
  <h3>四、真实开发实例</h3> 
  <p><span style="color:#009900;"><strong>下面展示的代码为开发实例，代码展示顺序按照交易流程进行排列。</strong></span></p> 
  <p>1、用户浏览页面，进行消费交易，对订单进行付款。页面提交订单信息表单的js代码</p> 
  <p></p> 
  <pre><code class="language-javascript">$(function () {
        //支付提交表单
        $("#paySubmit").click(function () {
            $("#mainForm").submit();
        });
    });</code></pre>2、接收订单数据的控制器代码 
  <p></p> 
  <p></p> 
  <pre><code class="language-csharp">        public void GotoPay()
        {
			Dictionary&lt;string,string&gt; param = new Dictionary&lt;string,string&gt;();
			param["orderId"] = Request.Form["orderId"].ToString();//订单号
			param["merId"] = merId; //商户号

			decimal orderSum = IOrderService.GetMoney(param["orderId"]);
			param["txnAmt"] = ((int)orderSum*100).ToString(); //订单金额，单位为分

			
			string payType = Request.Form["payType"].ToString();//支付类型

			if (payType==PayType.unionpay.ToString())	//银联支付
			{
				UnionpayB2C.Unionpay(param);
			}
        }</code></pre>
  <br> 3、支付层的银联支付处理 
  <p></p> 
  <p></p> 
  <pre><code class="language-csharp">public static void Unionpay(Dictionary&lt;string, string&gt; data)
		{

			Dictionary&lt;string, string&gt; param = new Dictionary&lt;string, string&gt;();

			//以下信息非特殊情况不需要改动
			param["version"] = "5.0.0";//版本号
			param["encoding"] = "UTF-8";//编码方式
			param["txnType"] = "01";//交易类型
			param["txnSubType"] = "01";//交易子类
			param["bizType"] = "000201";//业务类型
			param["signMethod"] = "01";//签名方法
			param["channelType"] = "08";//渠道类型
			param["accessType"] = "0";//接入类型
			param["frontUrl"] = SDKConfig.FrontUrl;  //前台通知地址      
			param["backUrl"] = SDKConfig.BackUrl;  //后台通知地址
			param["currencyCode"] = "156";//交易币种

			//TODO 以下信息需要填写
			param["merId"] = data["merId"];//商户号，请改自己的测试商户号，此处默认取demo演示页面传递的参数
			param["orderId"] = data["orderId"];//商户订单号，8-32位数字字母，不能含“-”或“_”，此处默认取demo演示页面传递的参数，可以自行定制规则
			param["txnTime"] = DateTime.Now.ToString("yyyyMMddHHmmss");//订单发送时间，格式为YYYYMMDDhhmmss，取北京时间，此处默认取demo演示页面传递的参数，参考取法： DateTime.Now.ToString("yyyyMMddHHmmss")
			param["txnAmt"] = data["txnAmt"];//交易金额，单位分，此处默认取demo演示页面传递的参数
			//param["reqReserved"] = "透传信息";//请求方保留域，透传字段，查询、通知、对账文件中均会原样出现，如有需要请启用并修改自己希望透传的数据

			//TODO 其他特殊用法请查看 pages/api_01_gateway/special_use_purchase.htm

			
			AcpService.Sign(param, System.Text.Encoding.UTF8);
			string html = AcpService.CreateAutoFormHtml(SDKConfig.FrontTransUrl, param, System.Text.Encoding.UTF8);// 将SDKUtil产生的Html文档写入页面，从而引导用户浏览器重定向   
			HttpContext.Current.Response.ContentEncoding = Encoding.UTF8; // 指定输出编码
			HttpContext.Current.Response.Write(html);
			
		}</code></pre>
  <br> 4、接收银联应答报文的控制器代码 
  <p></p> 
  <p></p> 
  <pre><code class="language-csharp">/// &lt;summary&gt;
		/// 前台交易返回结果
		/// &lt;/summary&gt;
		[HttpPost]
		public ActionResult RcvResponse()
		{
			Dictionary&lt;string, string&gt; result = UnionpayB2C.FrontRcvResponse();
			
			JsonDTO json = new JsonDTO()
			{
				Res = false,
				Msg = "支付失败，请重新支付"
			};

			if (result!=null)
			{
				if (result[RespData.respCode.ToString()]==RespCode.success)		//交易成功
				{
					OrderDetailDTO dto = new OrderDetailDTO() {
						OrderNum = result[RespData.orderId.ToString()],
						OrderStatus = EnumOrderStatus.WatingReceive,
						PayTime = Convert.ToDateTime(result[RespData.txnTime.ToString()])
						//OrderNum = "20170217102907590110902120",
						//OrderStatus = EnumOrderStatus.WatingReceive,
						//PayTime = DateTime.Now
					};

					json.Res=IOrderService.UpdateOrder(dto);

					if (json.Res)
					{
						IOrderService.AddOrderPayInfo(new OrderPayInfoDTO {
							OrderID = result[RespData.orderId.ToString()],
							QueryID = result[RespData.queryId.ToString()],
							TxnTime = result[RespData.txnTime.ToString()],
							TxnAmt =int.Parse(result[RespData.txnAmt.ToString()]),
						});

						json.Msg = "支付成功";
					}

					return View(json);
				}
				else
				{
					return View(json);
				}
			}

			return View(json);
		}</code></pre>
  <br> 5、支付层处理银联应答报文 
  <p></p> 
  <p></p> 
  <pre><code class="language-csharp">/// &lt;summary&gt;
		/// 接收银联返回的前台交易结果报文
		/// &lt;/summary&gt;
		public static Dictionary&lt;string, string&gt; FrontRcvResponse()
		{
			if (HttpContext.Current.Request.HttpMethod == "POST")
			{
				// 使用Dictionary保存参数
				Dictionary&lt;string, string&gt; resData = new Dictionary&lt;string, string&gt;();

				NameValueCollection coll = HttpContext.Current.Request.Form;

				string[] requestItem = coll.AllKeys;

				for (int i = 0; i &lt; requestItem.Length; i++)
				{
					resData.Add(requestItem[i], HttpContext.Current.Request.Form[requestItem[i]]);
				}

				// 返回报文中不包含UPOG,表示Server端正确接收交易请求,则需要验证Server端返回报文的签名
				if (AcpService.Validate(resData, System.Text.Encoding.UTF8))
				{
					//Response.Write("商户端验证返回报文签名成功\n");

					//string respcode = resData["respCode"]; //00、A6为成功，其余为失败。其他字段也可按此方式获取。

					//如果卡号我们业务配了会返回且配了需要加密的话，请按此方法解密
					//if(resData.ContainsKey("accNo"))
					//{
					//    string accNo = SecurityUtil.DecryptData(resData["accNo"], System.Text.Encoding.UTF8); 
					//}

					//商户端根据返回报文内容处理自己的业务逻辑 ,DEMO此处只输出报文结果
					return resData;
				}
				else
				{
					log.Error("商户端验证银联返回报文结果：验证签名失败");
					return null;
				}

			}
			return null;
		}</code></pre>
  <br> 注：银联的测试环境和生产环境的配置是不同的，其中，前台交易通知地址配置为接收银联应答报文的地址。
  <br>
  <p></p> 
  <p><br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wangzl1163/article/details/56843645,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wangzl1163/article/details/56843645,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

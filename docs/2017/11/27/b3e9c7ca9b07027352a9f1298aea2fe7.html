<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Fabric CA环境的集成 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Fabric CA环境的集成" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="我们前面关于Fabric的所有文章中用到的例子都没有CA Server，都是由cryptogen这个工具根据crypto-config.yaml而生成的。但是在实际生产环境中，我们应该为每个Org建立一个CA，由CA来管理其中的用户。下面我们就试着讲Fabric CA集成到整个Fabric网络中，并用CA Client生成新用户，最终使用新用户调用ChainCode，验证新用户的合法性。我们仍然以官方的e2e_cli为例.为每个Org各自建立一套CA。 1.修改docker-compose文件，增加CA容器 我们就以给org1这个组织增加CA容器为例，打开e2e_cli文件夹中的docker-compose-cli.yaml ，增加以下内容： &nbsp; ca0: &nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca &nbsp;&nbsp;&nbsp; environment: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false &nbsp;&nbsp;&nbsp; ports: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - &quot;7054:7054&quot; &nbsp;&nbsp;&nbsp; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY} -b admin:adminpw -d&#39; &nbsp;&nbsp;&nbsp; volumes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config &nbsp;&nbsp;&nbsp; container_name: ca0 &nbsp;&nbsp; &nbsp; &nbsp; ca1: &nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca &nbsp;&nbsp;&nbsp; environment: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false &nbsp;&nbsp;&nbsp; ports: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - &quot;7055:7054&quot; &nbsp;&nbsp;&nbsp; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY2} -b admin:adminpw -d&#39; &nbsp;&nbsp;&nbsp; volumes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config &nbsp;&nbsp;&nbsp; container_name: ca1 这里我们注意到，Fabric CA Server启动的时候，带了3个重要的参数：ca.certfile 指定了CA的根证书，ca.keyfile 指定了接下来给新用户签发证书时的私钥，这里我们使用变量${PRIVATE_KEY}和${PRIVATE_KEY2}代替，这是因为每次network_setup的时候，私钥的名字是不一样的，所以需要从启动脚本中传入。另外就是-b参数，指定了CA Client连接CA Server时使用的用户名密码。 2.修改network_setup.sh启动脚本，将CA容器启动的参数带入 接下来我们需要修改network_setup.sh文件，因为前面我们使用了变量${PRIVATE_KEY}，所以这里我们需要读取变量并带入docker-compose 启动的时候。具体修改如下： function networkUp ()&nbsp; { &nbsp;&nbsp;&nbsp; if [ -f &quot;./crypto-config&quot; ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;crypto-config directory already exists.&quot; &nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #Generate all the artifacts that includes org certs, orderer genesis block, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # channel configuration transaction &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source generateArtifacts.sh $CH_NAME &nbsp;&nbsp;&nbsp; fi folder=&quot;crypto-config/peerOrganizations/org1.example.com/ca&quot; privName=&quot;&quot; for file_a in ${folder}/* do &nbsp;&nbsp;&nbsp; temp_file=`basename $file_a` &nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != &quot;pem&quot; ];then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName=$temp_file &nbsp;&nbsp;&nbsp; fi done &nbsp;&nbsp;&nbsp; echo $privName folder=&quot;crypto-config/peerOrganizations/org2.example.com/ca&quot; privName2=&quot;&quot; for file_a in ${folder}/* do &nbsp;&nbsp;&nbsp; temp_file=`basename $file_a` &nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != &quot;pem&quot; ];then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName2=$temp_file &nbsp;&nbsp;&nbsp; fi done &nbsp;&nbsp;&nbsp; echo $privName2 &nbsp;&nbsp;&nbsp; if [ &quot;${IF_COUCHDB}&quot; == &quot;couchdb&quot; ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT docker-compose -f $COMPOSE_FILE -f $COMPOSE_FILE_COUCH up -d 2&gt;&amp;1 &nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT PRIVATE_KEY=$privName PRIVATE_KEY2=$privName2 docker-compose -f $COMPOSE_FILE up -d 2&gt;&amp;1 &nbsp;&nbsp;&nbsp; fi &nbsp;&nbsp;&nbsp; if [ $? -ne 0 ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;ERROR !!!! Unable to pull the images &quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit 1 &nbsp;&nbsp;&nbsp;&nbsp; fi &nbsp;&nbsp;&nbsp; docker logs -f cli } 这里脚本的逻辑很简单，就是去crypto-config/peerOrganizations/org1.example.com/ca这个文件夹中去遍历文件，找到私钥文件的文件名，并把文件名赋值给privName，然后在docker-compse的启动时，指定到PRIVATE_KEY即可。 3.使用CA Client生成新用户 只需要经过前面2步，我们给Org1设置的CA Server就算完成了。 3.1启动Fabric网络 运行 ./network_setup.sh up 启动整个Fabric网络。接下来需要使用CA Client来生成新用户。我们需要以下几步： 3.2下载并安装Fabric CA Client 官方提供的CA Client需要依赖于libtool这个库，所以需要先安装这个库，运行命令： sudo apt install libtool libltdl-dev 然后执行以下命令安装Fabric CA Client： go get -u github.com/hyperledger/fabric-ca/cmd/... 该命令执行完毕后，我们应该在~/go/bin下面看到生成的2个文件： fabric-ca-client&nbsp; fabric-ca-server 3.3注册认证管理员 我们首先需要以管理员身份使用CA Client连接到CA Server，并生成相应的文件。 export FABRIC_CA_CLIENT_HOME=$HOME/ca fabric-ca-client enroll -u http://admin:adminpw@localhost:7054 这个时候我们可以去$HOME/ca目录，看到CA Client创建了一个fabric-ca-client-config.yaml文件和一个msp文件夹。config可以去修改一些组织信息之类的。 3.4注册新用户 接下来我们想新建一个叫devin的用户，那么需要先执行这个命令： fabric-ca-client register --id.name devin --id.type user --id.affiliation org1.department1 --id.attrs &#39;hf.Revoker=true,foo=bar&#39; 系统会返回一个该用户的密码： 2017/09/05 22:20:41 [INFO] User provided config file: /home/jambeau/ca/fabric-ca-client-config.yaml 2017/09/05 22:20:41 [INFO] Configuration file location: /home/jambeau/ca/fabric-ca-client-config.yaml Password: GOuMzkcGgGzq 我们拿到这个密码以后就可以再次使用enroll命令，给devin这个用户生成msp的私钥和证书： fabric-ca-client enroll -u http://devin:GOuMzkcGgGzq@localhost:7054 -M $FABRIC_CA_CLIENT_HOME/devinmsp 现在新用户devin的私钥和证书就在$HOME/ca/devinmsp目录下，我们可以使用tree命令查看一下： devinmsp/ ├── cacerts │ └── localhost-7054.pem ├── keystore │ └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk └── signcerts └── cert.pem 4.编写ChainCode验证当前用户 由于官方提供的example02并没有关于当前用户的信息的代码，所以我们需要编写自己的ChainCode。 这里我们主要是用到ChainCode接口提供的GetCreator方法，具体完整的ChainCode如下： package main import ( &quot;github.com/hyperledger/fabric/core/chaincode/shim&quot; pb &quot;github.com/hyperledger/fabric/protos/peer&quot; &quot;fmt&quot; &quot;encoding/pem&quot; &quot;crypto/x509&quot; &quot;bytes&quot; ) type SimpleChaincode struct { } func main() { err := shim.Start(new(SimpleChaincode)) if err != nil { fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err) } } func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response { return shim.Success(nil) } func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response { function, args := stub.GetFunctionAndParameters() fmt.Println(&quot;invoke is running &quot; + function) if function == &quot;cert&quot; {//自定义函数名称 return t.testCertificate(stub, args)//定义调用的函数 } return shim.Error(&quot;Received unknown function invocation&quot;) } func (t *SimpleChaincode) testCertificate(stub shim.ChaincodeStubInterface, args []string) pb.Response{ creatorByte,_:= stub.GetCreator() certStart := bytes.IndexAny(creatorByte, &quot;-----&quot;)// Devin:I don&#39;t know why sometimes -----BEGIN is invalid, so I use ----- if certStart == -1 { fmt.Errorf(&quot;No certificate found&quot;) } certText := creatorByte[certStart:] bl, _ := pem.Decode(certText) if bl == nil { fmt.Errorf(&quot;Could not decode the PEM structure&quot;) } fmt.Println(string(certText)) cert, err := x509.ParseCertificate(bl.Bytes) if err != nil { fmt.Errorf(&quot;ParseCertificate failed&quot;) } fmt.Println(cert) uname:=cert.Subject.CommonName fmt.Println(&quot;Name:&quot;+uname) return shim.Success([]byte(&quot;Called testCertificate &quot;+uname)) } 我们只需要在~/go/src/github.com/hyperledger/fabric/examples/chaincode/go目录下新建一个文件夹，比如test1，然后新建一个文件test1.go并粘贴上面的代码进去即可。 现在ChainCode已经开发完成，我们需要部署并测试该ChainCode的正确性，下面是部署步骤： 首先登陆到cli中： docker exec -it cli bash 然后在cli下面执行以下命令： peer chaincode install -n test1 -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/test1 ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile $ORDERER_CA -C mychannel -n test1 -v 1.0 -c &#39;{&quot;Args&quot;:[]}&#39; peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 系统返回结果，说明我们当前的用户是Admin@org1.example.com root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 2017-09-05 14:40:23.175 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2017-09-05 14:40:23.176 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2017-09-05 14:40:23.176 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2017-09-05 14:40:23.176 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2017-09-05 14:40:23.176 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: plaintext: 0A95070A6708031A0B08D7EEBACD0510...07120574657374311A060A0463657274 2017-09-05 14:40:23.176 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: digest: B4BB1EE5E6EBA63E50C85831C8820FB0B4490C55F23C247EDE5529DDAB23C273 Query Result: Called testCertificate Admin@org1.example.com 2017-09-05 14:40:23.195 UTC [main] main -&gt; INFO 007 Exiting..... 5.设置新用户的证书和私钥文件夹，验证新用户的可用性 因为我们是给org1设置的CA，用户devin也是在org1下，所以需要把~/ca/devinmsp下面的文件转移到org1下面。org1的用户证书和私钥文件夹在： ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users 我们需要新建文件夹devin用于保存新用户的证书和私钥，我们新建一个Ubuntu的命令行窗口，前面已经登录您的cli的窗口保留，我们接下来还会用。 cd ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users mkdir devin cp ~/ca/devinmsp/ devin/msp –R 不知道什么原因，Fabric在使用的时候需要用到msp文件夹下的admincerts文件夹，但是CA Client在生成的时候并没有这个文件夹，所以我们需要从signcerts这个文件夹中拷贝一个过来，运行以下命令： mkdir devin/msp/admincerts cp devin/msp/signcerts/cert.pem devin/msp/admincerts/ 好现在我们的新用户的所有证书准备完毕，tree devin看看结果： devin/ └── msp ├── admincerts │ └── cert.pem ├── cacerts │ └── localhost-7054.pem ├── keystore │ └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk └── signcerts └── cert.pem 接下来切换到cli窗口，我们把当前cli的用户msp文件夹切换成devin的文件夹，具体命令是： CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/devin/msp 现在我们再来运行一下ChainCode： peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 我们可以看到结果已经变化了，用户已经由Admin变成了devin： root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 2017-09-05 14:53:17.497 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2017-09-05 14:53:17.497 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2017-09-05 14:53:17.497 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2017-09-05 14:53:17.497 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2017-09-05 14:53:17.497 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: plaintext: 0AE3070A6808031A0C08DDF4BACD0510...07120574657374311A060A0463657274 2017-09-05 14:53:17.497 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: digest: 21EE9B77A231E22ACB5FDD59C668C1A6E300833A820901DF9E896E22C00FC00F Query Result: Called testCertificate devin 2017-09-05 14:53:17.508 UTC [main] main -&gt; INFO 007 Exiting..... 以上就是关于Fabric CA环境集成的简单测试。关于CA Server有配置文件在CA Server容器内部，可以针对不同的org信息进行修改。而CA Client也有配置文件，也可以在enroll之前进行修改。 阅读更多" />
<meta property="og:description" content="我们前面关于Fabric的所有文章中用到的例子都没有CA Server，都是由cryptogen这个工具根据crypto-config.yaml而生成的。但是在实际生产环境中，我们应该为每个Org建立一个CA，由CA来管理其中的用户。下面我们就试着讲Fabric CA集成到整个Fabric网络中，并用CA Client生成新用户，最终使用新用户调用ChainCode，验证新用户的合法性。我们仍然以官方的e2e_cli为例.为每个Org各自建立一套CA。 1.修改docker-compose文件，增加CA容器 我们就以给org1这个组织增加CA容器为例，打开e2e_cli文件夹中的docker-compose-cli.yaml ，增加以下内容： &nbsp; ca0: &nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca &nbsp;&nbsp;&nbsp; environment: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false &nbsp;&nbsp;&nbsp; ports: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - &quot;7054:7054&quot; &nbsp;&nbsp;&nbsp; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY} -b admin:adminpw -d&#39; &nbsp;&nbsp;&nbsp; volumes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config &nbsp;&nbsp;&nbsp; container_name: ca0 &nbsp;&nbsp; &nbsp; &nbsp; ca1: &nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca &nbsp;&nbsp;&nbsp; environment: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false &nbsp;&nbsp;&nbsp; ports: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - &quot;7055:7054&quot; &nbsp;&nbsp;&nbsp; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY2} -b admin:adminpw -d&#39; &nbsp;&nbsp;&nbsp; volumes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config &nbsp;&nbsp;&nbsp; container_name: ca1 这里我们注意到，Fabric CA Server启动的时候，带了3个重要的参数：ca.certfile 指定了CA的根证书，ca.keyfile 指定了接下来给新用户签发证书时的私钥，这里我们使用变量${PRIVATE_KEY}和${PRIVATE_KEY2}代替，这是因为每次network_setup的时候，私钥的名字是不一样的，所以需要从启动脚本中传入。另外就是-b参数，指定了CA Client连接CA Server时使用的用户名密码。 2.修改network_setup.sh启动脚本，将CA容器启动的参数带入 接下来我们需要修改network_setup.sh文件，因为前面我们使用了变量${PRIVATE_KEY}，所以这里我们需要读取变量并带入docker-compose 启动的时候。具体修改如下： function networkUp ()&nbsp; { &nbsp;&nbsp;&nbsp; if [ -f &quot;./crypto-config&quot; ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;crypto-config directory already exists.&quot; &nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #Generate all the artifacts that includes org certs, orderer genesis block, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # channel configuration transaction &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source generateArtifacts.sh $CH_NAME &nbsp;&nbsp;&nbsp; fi folder=&quot;crypto-config/peerOrganizations/org1.example.com/ca&quot; privName=&quot;&quot; for file_a in ${folder}/* do &nbsp;&nbsp;&nbsp; temp_file=`basename $file_a` &nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != &quot;pem&quot; ];then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName=$temp_file &nbsp;&nbsp;&nbsp; fi done &nbsp;&nbsp;&nbsp; echo $privName folder=&quot;crypto-config/peerOrganizations/org2.example.com/ca&quot; privName2=&quot;&quot; for file_a in ${folder}/* do &nbsp;&nbsp;&nbsp; temp_file=`basename $file_a` &nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != &quot;pem&quot; ];then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName2=$temp_file &nbsp;&nbsp;&nbsp; fi done &nbsp;&nbsp;&nbsp; echo $privName2 &nbsp;&nbsp;&nbsp; if [ &quot;${IF_COUCHDB}&quot; == &quot;couchdb&quot; ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT docker-compose -f $COMPOSE_FILE -f $COMPOSE_FILE_COUCH up -d 2&gt;&amp;1 &nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT PRIVATE_KEY=$privName PRIVATE_KEY2=$privName2 docker-compose -f $COMPOSE_FILE up -d 2&gt;&amp;1 &nbsp;&nbsp;&nbsp; fi &nbsp;&nbsp;&nbsp; if [ $? -ne 0 ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;ERROR !!!! Unable to pull the images &quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit 1 &nbsp;&nbsp;&nbsp;&nbsp; fi &nbsp;&nbsp;&nbsp; docker logs -f cli } 这里脚本的逻辑很简单，就是去crypto-config/peerOrganizations/org1.example.com/ca这个文件夹中去遍历文件，找到私钥文件的文件名，并把文件名赋值给privName，然后在docker-compse的启动时，指定到PRIVATE_KEY即可。 3.使用CA Client生成新用户 只需要经过前面2步，我们给Org1设置的CA Server就算完成了。 3.1启动Fabric网络 运行 ./network_setup.sh up 启动整个Fabric网络。接下来需要使用CA Client来生成新用户。我们需要以下几步： 3.2下载并安装Fabric CA Client 官方提供的CA Client需要依赖于libtool这个库，所以需要先安装这个库，运行命令： sudo apt install libtool libltdl-dev 然后执行以下命令安装Fabric CA Client： go get -u github.com/hyperledger/fabric-ca/cmd/... 该命令执行完毕后，我们应该在~/go/bin下面看到生成的2个文件： fabric-ca-client&nbsp; fabric-ca-server 3.3注册认证管理员 我们首先需要以管理员身份使用CA Client连接到CA Server，并生成相应的文件。 export FABRIC_CA_CLIENT_HOME=$HOME/ca fabric-ca-client enroll -u http://admin:adminpw@localhost:7054 这个时候我们可以去$HOME/ca目录，看到CA Client创建了一个fabric-ca-client-config.yaml文件和一个msp文件夹。config可以去修改一些组织信息之类的。 3.4注册新用户 接下来我们想新建一个叫devin的用户，那么需要先执行这个命令： fabric-ca-client register --id.name devin --id.type user --id.affiliation org1.department1 --id.attrs &#39;hf.Revoker=true,foo=bar&#39; 系统会返回一个该用户的密码： 2017/09/05 22:20:41 [INFO] User provided config file: /home/jambeau/ca/fabric-ca-client-config.yaml 2017/09/05 22:20:41 [INFO] Configuration file location: /home/jambeau/ca/fabric-ca-client-config.yaml Password: GOuMzkcGgGzq 我们拿到这个密码以后就可以再次使用enroll命令，给devin这个用户生成msp的私钥和证书： fabric-ca-client enroll -u http://devin:GOuMzkcGgGzq@localhost:7054 -M $FABRIC_CA_CLIENT_HOME/devinmsp 现在新用户devin的私钥和证书就在$HOME/ca/devinmsp目录下，我们可以使用tree命令查看一下： devinmsp/ ├── cacerts │ └── localhost-7054.pem ├── keystore │ └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk └── signcerts └── cert.pem 4.编写ChainCode验证当前用户 由于官方提供的example02并没有关于当前用户的信息的代码，所以我们需要编写自己的ChainCode。 这里我们主要是用到ChainCode接口提供的GetCreator方法，具体完整的ChainCode如下： package main import ( &quot;github.com/hyperledger/fabric/core/chaincode/shim&quot; pb &quot;github.com/hyperledger/fabric/protos/peer&quot; &quot;fmt&quot; &quot;encoding/pem&quot; &quot;crypto/x509&quot; &quot;bytes&quot; ) type SimpleChaincode struct { } func main() { err := shim.Start(new(SimpleChaincode)) if err != nil { fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err) } } func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response { return shim.Success(nil) } func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response { function, args := stub.GetFunctionAndParameters() fmt.Println(&quot;invoke is running &quot; + function) if function == &quot;cert&quot; {//自定义函数名称 return t.testCertificate(stub, args)//定义调用的函数 } return shim.Error(&quot;Received unknown function invocation&quot;) } func (t *SimpleChaincode) testCertificate(stub shim.ChaincodeStubInterface, args []string) pb.Response{ creatorByte,_:= stub.GetCreator() certStart := bytes.IndexAny(creatorByte, &quot;-----&quot;)// Devin:I don&#39;t know why sometimes -----BEGIN is invalid, so I use ----- if certStart == -1 { fmt.Errorf(&quot;No certificate found&quot;) } certText := creatorByte[certStart:] bl, _ := pem.Decode(certText) if bl == nil { fmt.Errorf(&quot;Could not decode the PEM structure&quot;) } fmt.Println(string(certText)) cert, err := x509.ParseCertificate(bl.Bytes) if err != nil { fmt.Errorf(&quot;ParseCertificate failed&quot;) } fmt.Println(cert) uname:=cert.Subject.CommonName fmt.Println(&quot;Name:&quot;+uname) return shim.Success([]byte(&quot;Called testCertificate &quot;+uname)) } 我们只需要在~/go/src/github.com/hyperledger/fabric/examples/chaincode/go目录下新建一个文件夹，比如test1，然后新建一个文件test1.go并粘贴上面的代码进去即可。 现在ChainCode已经开发完成，我们需要部署并测试该ChainCode的正确性，下面是部署步骤： 首先登陆到cli中： docker exec -it cli bash 然后在cli下面执行以下命令： peer chaincode install -n test1 -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/test1 ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile $ORDERER_CA -C mychannel -n test1 -v 1.0 -c &#39;{&quot;Args&quot;:[]}&#39; peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 系统返回结果，说明我们当前的用户是Admin@org1.example.com root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 2017-09-05 14:40:23.175 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2017-09-05 14:40:23.176 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2017-09-05 14:40:23.176 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2017-09-05 14:40:23.176 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2017-09-05 14:40:23.176 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: plaintext: 0A95070A6708031A0B08D7EEBACD0510...07120574657374311A060A0463657274 2017-09-05 14:40:23.176 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: digest: B4BB1EE5E6EBA63E50C85831C8820FB0B4490C55F23C247EDE5529DDAB23C273 Query Result: Called testCertificate Admin@org1.example.com 2017-09-05 14:40:23.195 UTC [main] main -&gt; INFO 007 Exiting..... 5.设置新用户的证书和私钥文件夹，验证新用户的可用性 因为我们是给org1设置的CA，用户devin也是在org1下，所以需要把~/ca/devinmsp下面的文件转移到org1下面。org1的用户证书和私钥文件夹在： ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users 我们需要新建文件夹devin用于保存新用户的证书和私钥，我们新建一个Ubuntu的命令行窗口，前面已经登录您的cli的窗口保留，我们接下来还会用。 cd ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users mkdir devin cp ~/ca/devinmsp/ devin/msp –R 不知道什么原因，Fabric在使用的时候需要用到msp文件夹下的admincerts文件夹，但是CA Client在生成的时候并没有这个文件夹，所以我们需要从signcerts这个文件夹中拷贝一个过来，运行以下命令： mkdir devin/msp/admincerts cp devin/msp/signcerts/cert.pem devin/msp/admincerts/ 好现在我们的新用户的所有证书准备完毕，tree devin看看结果： devin/ └── msp ├── admincerts │ └── cert.pem ├── cacerts │ └── localhost-7054.pem ├── keystore │ └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk └── signcerts └── cert.pem 接下来切换到cli窗口，我们把当前cli的用户msp文件夹切换成devin的文件夹，具体命令是： CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/devin/msp 现在我们再来运行一下ChainCode： peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 我们可以看到结果已经变化了，用户已经由Admin变成了devin： root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 2017-09-05 14:53:17.497 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2017-09-05 14:53:17.497 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2017-09-05 14:53:17.497 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2017-09-05 14:53:17.497 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2017-09-05 14:53:17.497 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: plaintext: 0AE3070A6808031A0C08DDF4BACD0510...07120574657374311A060A0463657274 2017-09-05 14:53:17.497 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: digest: 21EE9B77A231E22ACB5FDD59C668C1A6E300833A820901DF9E896E22C00FC00F Query Result: Called testCertificate devin 2017-09-05 14:53:17.508 UTC [main] main -&gt; INFO 007 Exiting..... 以上就是关于Fabric CA环境集成的简单测试。关于CA Server有配置文件在CA Server容器内部，可以针对不同的org信息进行修改。而CA Client也有配置文件，也可以在enroll之前进行修改。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/11/27/b3e9c7ca9b07027352a9f1298aea2fe7.html" />
<meta property="og:url" content="https://mlh.app/2017/11/27/b3e9c7ca9b07027352a9f1298aea2fe7.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-27T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"我们前面关于Fabric的所有文章中用到的例子都没有CA Server，都是由cryptogen这个工具根据crypto-config.yaml而生成的。但是在实际生产环境中，我们应该为每个Org建立一个CA，由CA来管理其中的用户。下面我们就试着讲Fabric CA集成到整个Fabric网络中，并用CA Client生成新用户，最终使用新用户调用ChainCode，验证新用户的合法性。我们仍然以官方的e2e_cli为例.为每个Org各自建立一套CA。 1.修改docker-compose文件，增加CA容器 我们就以给org1这个组织增加CA容器为例，打开e2e_cli文件夹中的docker-compose-cli.yaml ，增加以下内容： &nbsp; ca0: &nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca &nbsp;&nbsp;&nbsp; environment: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false &nbsp;&nbsp;&nbsp; ports: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - &quot;7054:7054&quot; &nbsp;&nbsp;&nbsp; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY} -b admin:adminpw -d&#39; &nbsp;&nbsp;&nbsp; volumes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config &nbsp;&nbsp;&nbsp; container_name: ca0 &nbsp;&nbsp; &nbsp; &nbsp; ca1: &nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca &nbsp;&nbsp;&nbsp; environment: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false &nbsp;&nbsp;&nbsp; ports: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - &quot;7055:7054&quot; &nbsp;&nbsp;&nbsp; command: sh -c &#39;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY2} -b admin:adminpw -d&#39; &nbsp;&nbsp;&nbsp; volumes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config &nbsp;&nbsp;&nbsp; container_name: ca1 这里我们注意到，Fabric CA Server启动的时候，带了3个重要的参数：ca.certfile 指定了CA的根证书，ca.keyfile 指定了接下来给新用户签发证书时的私钥，这里我们使用变量${PRIVATE_KEY}和${PRIVATE_KEY2}代替，这是因为每次network_setup的时候，私钥的名字是不一样的，所以需要从启动脚本中传入。另外就是-b参数，指定了CA Client连接CA Server时使用的用户名密码。 2.修改network_setup.sh启动脚本，将CA容器启动的参数带入 接下来我们需要修改network_setup.sh文件，因为前面我们使用了变量${PRIVATE_KEY}，所以这里我们需要读取变量并带入docker-compose 启动的时候。具体修改如下： function networkUp ()&nbsp; { &nbsp;&nbsp;&nbsp; if [ -f &quot;./crypto-config&quot; ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;crypto-config directory already exists.&quot; &nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #Generate all the artifacts that includes org certs, orderer genesis block, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # channel configuration transaction &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source generateArtifacts.sh $CH_NAME &nbsp;&nbsp;&nbsp; fi folder=&quot;crypto-config/peerOrganizations/org1.example.com/ca&quot; privName=&quot;&quot; for file_a in ${folder}/* do &nbsp;&nbsp;&nbsp; temp_file=`basename $file_a` &nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != &quot;pem&quot; ];then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName=$temp_file &nbsp;&nbsp;&nbsp; fi done &nbsp;&nbsp;&nbsp; echo $privName folder=&quot;crypto-config/peerOrganizations/org2.example.com/ca&quot; privName2=&quot;&quot; for file_a in ${folder}/* do &nbsp;&nbsp;&nbsp; temp_file=`basename $file_a` &nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != &quot;pem&quot; ];then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName2=$temp_file &nbsp;&nbsp;&nbsp; fi done &nbsp;&nbsp;&nbsp; echo $privName2 &nbsp;&nbsp;&nbsp; if [ &quot;${IF_COUCHDB}&quot; == &quot;couchdb&quot; ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT docker-compose -f $COMPOSE_FILE -f $COMPOSE_FILE_COUCH up -d 2&gt;&amp;1 &nbsp;&nbsp;&nbsp; else &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT PRIVATE_KEY=$privName PRIVATE_KEY2=$privName2 docker-compose -f $COMPOSE_FILE up -d 2&gt;&amp;1 &nbsp;&nbsp;&nbsp; fi &nbsp;&nbsp;&nbsp; if [ $? -ne 0 ]; then &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;ERROR !!!! Unable to pull the images &quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit 1 &nbsp;&nbsp;&nbsp;&nbsp; fi &nbsp;&nbsp;&nbsp; docker logs -f cli } 这里脚本的逻辑很简单，就是去crypto-config/peerOrganizations/org1.example.com/ca这个文件夹中去遍历文件，找到私钥文件的文件名，并把文件名赋值给privName，然后在docker-compse的启动时，指定到PRIVATE_KEY即可。 3.使用CA Client生成新用户 只需要经过前面2步，我们给Org1设置的CA Server就算完成了。 3.1启动Fabric网络 运行 ./network_setup.sh up 启动整个Fabric网络。接下来需要使用CA Client来生成新用户。我们需要以下几步： 3.2下载并安装Fabric CA Client 官方提供的CA Client需要依赖于libtool这个库，所以需要先安装这个库，运行命令： sudo apt install libtool libltdl-dev 然后执行以下命令安装Fabric CA Client： go get -u github.com/hyperledger/fabric-ca/cmd/... 该命令执行完毕后，我们应该在~/go/bin下面看到生成的2个文件： fabric-ca-client&nbsp; fabric-ca-server 3.3注册认证管理员 我们首先需要以管理员身份使用CA Client连接到CA Server，并生成相应的文件。 export FABRIC_CA_CLIENT_HOME=$HOME/ca fabric-ca-client enroll -u http://admin:adminpw@localhost:7054 这个时候我们可以去$HOME/ca目录，看到CA Client创建了一个fabric-ca-client-config.yaml文件和一个msp文件夹。config可以去修改一些组织信息之类的。 3.4注册新用户 接下来我们想新建一个叫devin的用户，那么需要先执行这个命令： fabric-ca-client register --id.name devin --id.type user --id.affiliation org1.department1 --id.attrs &#39;hf.Revoker=true,foo=bar&#39; 系统会返回一个该用户的密码： 2017/09/05 22:20:41 [INFO] User provided config file: /home/jambeau/ca/fabric-ca-client-config.yaml 2017/09/05 22:20:41 [INFO] Configuration file location: /home/jambeau/ca/fabric-ca-client-config.yaml Password: GOuMzkcGgGzq 我们拿到这个密码以后就可以再次使用enroll命令，给devin这个用户生成msp的私钥和证书： fabric-ca-client enroll -u http://devin:GOuMzkcGgGzq@localhost:7054 -M $FABRIC_CA_CLIENT_HOME/devinmsp 现在新用户devin的私钥和证书就在$HOME/ca/devinmsp目录下，我们可以使用tree命令查看一下： devinmsp/ ├── cacerts │ └── localhost-7054.pem ├── keystore │ └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk └── signcerts └── cert.pem 4.编写ChainCode验证当前用户 由于官方提供的example02并没有关于当前用户的信息的代码，所以我们需要编写自己的ChainCode。 这里我们主要是用到ChainCode接口提供的GetCreator方法，具体完整的ChainCode如下： package main import ( &quot;github.com/hyperledger/fabric/core/chaincode/shim&quot; pb &quot;github.com/hyperledger/fabric/protos/peer&quot; &quot;fmt&quot; &quot;encoding/pem&quot; &quot;crypto/x509&quot; &quot;bytes&quot; ) type SimpleChaincode struct { } func main() { err := shim.Start(new(SimpleChaincode)) if err != nil { fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err) } } func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response { return shim.Success(nil) } func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response { function, args := stub.GetFunctionAndParameters() fmt.Println(&quot;invoke is running &quot; + function) if function == &quot;cert&quot; {//自定义函数名称 return t.testCertificate(stub, args)//定义调用的函数 } return shim.Error(&quot;Received unknown function invocation&quot;) } func (t *SimpleChaincode) testCertificate(stub shim.ChaincodeStubInterface, args []string) pb.Response{ creatorByte,_:= stub.GetCreator() certStart := bytes.IndexAny(creatorByte, &quot;-----&quot;)// Devin:I don&#39;t know why sometimes -----BEGIN is invalid, so I use ----- if certStart == -1 { fmt.Errorf(&quot;No certificate found&quot;) } certText := creatorByte[certStart:] bl, _ := pem.Decode(certText) if bl == nil { fmt.Errorf(&quot;Could not decode the PEM structure&quot;) } fmt.Println(string(certText)) cert, err := x509.ParseCertificate(bl.Bytes) if err != nil { fmt.Errorf(&quot;ParseCertificate failed&quot;) } fmt.Println(cert) uname:=cert.Subject.CommonName fmt.Println(&quot;Name:&quot;+uname) return shim.Success([]byte(&quot;Called testCertificate &quot;+uname)) } 我们只需要在~/go/src/github.com/hyperledger/fabric/examples/chaincode/go目录下新建一个文件夹，比如test1，然后新建一个文件test1.go并粘贴上面的代码进去即可。 现在ChainCode已经开发完成，我们需要部署并测试该ChainCode的正确性，下面是部署步骤： 首先登陆到cli中： docker exec -it cli bash 然后在cli下面执行以下命令： peer chaincode install -n test1 -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/test1 ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile $ORDERER_CA -C mychannel -n test1 -v 1.0 -c &#39;{&quot;Args&quot;:[]}&#39; peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 系统返回结果，说明我们当前的用户是Admin@org1.example.com root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 2017-09-05 14:40:23.175 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2017-09-05 14:40:23.176 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2017-09-05 14:40:23.176 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2017-09-05 14:40:23.176 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2017-09-05 14:40:23.176 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: plaintext: 0A95070A6708031A0B08D7EEBACD0510...07120574657374311A060A0463657274 2017-09-05 14:40:23.176 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: digest: B4BB1EE5E6EBA63E50C85831C8820FB0B4490C55F23C247EDE5529DDAB23C273 Query Result: Called testCertificate Admin@org1.example.com 2017-09-05 14:40:23.195 UTC [main] main -&gt; INFO 007 Exiting..... 5.设置新用户的证书和私钥文件夹，验证新用户的可用性 因为我们是给org1设置的CA，用户devin也是在org1下，所以需要把~/ca/devinmsp下面的文件转移到org1下面。org1的用户证书和私钥文件夹在： ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users 我们需要新建文件夹devin用于保存新用户的证书和私钥，我们新建一个Ubuntu的命令行窗口，前面已经登录您的cli的窗口保留，我们接下来还会用。 cd ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users mkdir devin cp ~/ca/devinmsp/ devin/msp –R 不知道什么原因，Fabric在使用的时候需要用到msp文件夹下的admincerts文件夹，但是CA Client在生成的时候并没有这个文件夹，所以我们需要从signcerts这个文件夹中拷贝一个过来，运行以下命令： mkdir devin/msp/admincerts cp devin/msp/signcerts/cert.pem devin/msp/admincerts/ 好现在我们的新用户的所有证书准备完毕，tree devin看看结果： devin/ └── msp ├── admincerts │ └── cert.pem ├── cacerts │ └── localhost-7054.pem ├── keystore │ └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk └── signcerts └── cert.pem 接下来切换到cli窗口，我们把当前cli的用户msp文件夹切换成devin的文件夹，具体命令是： CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/devin/msp 现在我们再来运行一下ChainCode： peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 我们可以看到结果已经变化了，用户已经由Admin变成了devin： root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c &#39;{&quot;Args&quot;:[&quot;cert&quot;]}&#39; 2017-09-05 14:53:17.497 UTC [msp] GetLocalMSP -&gt; DEBU 001 Returning existing local MSP 2017-09-05 14:53:17.497 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity 2017-09-05 14:53:17.497 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc 2017-09-05 14:53:17.497 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc 2017-09-05 14:53:17.497 UTC [msp/identity] Sign -&gt; DEBU 005 Sign: plaintext: 0AE3070A6808031A0C08DDF4BACD0510...07120574657374311A060A0463657274 2017-09-05 14:53:17.497 UTC [msp/identity] Sign -&gt; DEBU 006 Sign: digest: 21EE9B77A231E22ACB5FDD59C668C1A6E300833A820901DF9E896E22C00FC00F Query Result: Called testCertificate devin 2017-09-05 14:53:17.508 UTC [main] main -&gt; INFO 007 Exiting..... 以上就是关于Fabric CA环境集成的简单测试。关于CA Server有配置文件在CA Server容器内部，可以针对不同的org信息进行修改。而CA Client也有配置文件，也可以在enroll之前进行修改。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/11/27/b3e9c7ca9b07027352a9f1298aea2fe7.html","headline":"Fabric CA环境的集成","dateModified":"2017-11-27T00:00:00+08:00","datePublished":"2017-11-27T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/11/27/b3e9c7ca9b07027352a9f1298aea2fe7.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Fabric CA环境的集成</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>我们前面关于Fabric的所有文章中用到的例子都没有CA Server，都是由cryptogen这个工具根据crypto-config.yaml而生成的。但是在实际生产环境中，我们应该为每个Org建立一个CA，由CA来管理其中的用户。下面我们就试着讲Fabric CA集成到整个Fabric网络中，并用CA Client生成新用户，最终使用新用户调用ChainCode，验证新用户的合法性。我们仍然以官方的e2e_cli为例.为每个Org各自建立一套CA。</p> 
  <p></p> 
  <h2>1.修改docker-compose文件，增加CA容器</h2> 
  <p></p> 
  <p>我们就以给org1这个组织增加CA容器为例，打开e2e_cli文件夹中的docker-compose-cli.yaml ，增加以下内容：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">&nbsp; ca0: 
&nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca 
&nbsp;&nbsp;&nbsp; environment: 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca0 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false 
&nbsp;&nbsp;&nbsp; ports: 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - "7054:7054" 
&nbsp;&nbsp;&nbsp; command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY} -b admin:adminpw -d' 
&nbsp;&nbsp;&nbsp; volumes: 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config 
&nbsp;&nbsp;&nbsp; container_name: ca0
&nbsp;&nbsp; &nbsp;
&nbsp; ca1: 
&nbsp;&nbsp;&nbsp; image: hyperledger/fabric-ca 
&nbsp;&nbsp;&nbsp; environment: 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_CA_NAME=ca1 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - FABRIC_CA_SERVER_TLS_ENABLED=false 
&nbsp;&nbsp;&nbsp; ports: 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - "7055:7054" 
&nbsp;&nbsp;&nbsp; command: sh -c 'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/${PRIVATE_KEY2} -b admin:adminpw -d' 
&nbsp;&nbsp;&nbsp; volumes: 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - ./crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config 
&nbsp;&nbsp;&nbsp; container_name: ca1<span style="font-family: !important;font-size:12px !important;line-height:1.5;">
</span></pre> 
  </div> 
  <p>这里我们注意到，Fabric CA Server启动的时候，带了3个重要的参数：ca.certfile 指定了CA的根证书，ca.keyfile 指定了接下来给新用户签发证书时的私钥，这里我们使用变量${PRIVATE_KEY}和${PRIVATE_KEY2}代替，这是因为每次network_setup的时候，私钥的名字是不一样的，所以需要从启动脚本中传入。另外就是-b参数，指定了CA Client连接CA Server时使用的用户名密码。</p> 
  <h2>2.修改network_setup.sh启动脚本，将CA容器启动的参数带入</h2> 
  <p>接下来我们需要修改network_setup.sh文件，因为前面我们使用了变量${PRIVATE_KEY}，所以这里我们需要读取变量并带入docker-compose 启动的时候。具体修改如下：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;"><span style="font-family: !important;font-size:12px !important;line-height:1.5;"></span>function networkUp ()&nbsp; { 
&nbsp;&nbsp;&nbsp; if [ -f "./crypto-config" ]; then 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "crypto-config directory already exists." 
&nbsp;&nbsp;&nbsp; else 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #Generate all the artifacts that includes org certs, orderer genesis block, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # channel configuration transaction 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source generateArtifacts.sh $CH_NAME 
&nbsp;&nbsp;&nbsp; fi 
<span style="color:#FF0000;">folder="crypto-config/peerOrganizations/org1.example.com/ca" 
privName="" </span>
for file_a in ${folder}/* 
do 
&nbsp;&nbsp;&nbsp; temp_file=`basename $file_a`

&nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != "pem" ];then 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName=$temp_file 
&nbsp;&nbsp;&nbsp; fi 
done 
&nbsp;&nbsp;&nbsp; echo $privName 
<span style="color:#FF0000;">folder="crypto-config/peerOrganizations/org2.example.com/ca" 
privName2="" </span>
for file_a in ${folder}/* 
do 
&nbsp;&nbsp;&nbsp; temp_file=`basename $file_a`

&nbsp;&nbsp;&nbsp; if [ ${temp_file##*.} != "pem" ];then 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; privName2=$temp_file 
&nbsp;&nbsp;&nbsp; fi 
done 
&nbsp;&nbsp;&nbsp; echo $privName2 
&nbsp;&nbsp;&nbsp; if [ "${IF_COUCHDB}" == "couchdb" ]; then 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT docker-compose -f $COMPOSE_FILE -f $COMPOSE_FILE_COUCH up -d 2&gt;&amp;1 
&nbsp;&nbsp;&nbsp; else 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CHANNEL_NAME=$CH_NAME TIMEOUT=$CLI_TIMEOUT <span style="color:#FF0000;">PRIVATE_KEY=$privName PRIVATE_KEY2=$privName2 </span>docker-compose -f $COMPOSE_FILE up -d 2&gt;&amp;1
&nbsp;&nbsp;&nbsp; fi 
&nbsp;&nbsp;&nbsp; if [ $? -ne 0 ]; then 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "ERROR !!!! Unable to pull the images " 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit 1 
&nbsp;&nbsp;&nbsp;&nbsp; fi 
&nbsp;&nbsp;&nbsp; docker logs -f cli 
}<span style="font-family: !important;font-size:12px !important;line-height:1.5;"></span></pre> 
  </div> 
  <p>这里脚本的逻辑很简单，就是去crypto-config/peerOrganizations/org1.example.com/ca这个文件夹中去遍历文件，找到私钥文件的文件名，并把文件名赋值给privName，然后在docker-compse的启动时，指定到PRIVATE_KEY即可。</p> 
  <h2>3.使用CA Client生成新用户</h2> 
  <p>只需要经过前面2步，我们给Org1设置的CA Server就算完成了。</p> 
  <h3>3.1启动Fabric网络</h3> 
  <p>运行</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">./network_setup.<span style="font-family: !important;font-size:12px !important;line-height:1.5;">sh</span> up</pre> 
  </div> 
  <p>启动整个Fabric网络。接下来需要使用CA Client来生成新用户。我们需要以下几步：</p> 
  <h3>3.2下载并安装Fabric CA Client</h3> 
  <p>官方提供的CA Client需要依赖于libtool这个库，所以需要先安装这个库，运行命令：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;"><span style="font-family: !important;font-size:12px !important;line-height:1.5;">sudo</span> apt <span style="font-family: !important;font-size:12px !important;line-height:1.5;">install</span> libtool libltdl-dev</pre> 
  </div> 
  <pre>然后执行以下命令安装Fabric CA Client：</pre> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">go get -u github.com/hyperledger/fabric-ca/cmd/...</pre> 
  </div> 
  <pre>该命令执行完毕后，我们应该在~/go/bin下面看到生成的2个文件：</pre> 
  <pre>fabric-ca-client&nbsp; fabric-ca-server</pre> 
  <h3>3.3注册认证管理员</h3> 
  <pre>我们首先需要以管理员身份使用CA Client连接到CA Server，并生成相应的文件。</pre> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">export FABRIC_CA_CLIENT_HOME=$HOME/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">ca
fabric</span>-ca-client enroll -u http:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">//</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">admin:adminpw@localhost:7054</span></pre> 
  </div> 
  <pre>这个时候我们可以去$HOME/ca目录，看到CA Client创建了一个fabric-ca-client-config.yaml文件和一个msp文件夹。config可以去修改一些组织信息之类的。</pre> 
  <h3>3.4注册新用户</h3> 
  <pre>接下来我们想新建一个叫devin的用户，那么需要先执行这个命令：</pre> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">fabric-ca-client register --<span style="font-family: !important;font-size:12px !important;line-height:1.5;">id</span>.name devin --<span style="font-family: !important;font-size:12px !important;line-height:1.5;">id</span>.type user --<span style="font-family: !important;font-size:12px !important;line-height:1.5;">id</span>.affiliation org1.department1 --<span style="font-family: !important;font-size:12px !important;line-height:1.5;">id</span>.attrs <span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">hf.Revoker=true,foo=bar</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span></pre> 
  </div> 
  <pre>系统会返回一个该用户的密码：</pre> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;"><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">22</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">20</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">41</span> [INFO] User provided config <span style="font-family: !important;font-size:12px !important;line-height:1.5;">file</span>: /home/jambeau/ca/fabric-ca-client-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">config.yaml 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">22</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">20</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">41</span> [INFO] Configuration <span style="font-family: !important;font-size:12px !important;line-height:1.5;">file</span> location: /home/jambeau/ca/fabric-ca-client-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">config.yaml 
Password: GOuMzkcGgGzq</span></pre> 
  </div> 
  <p>我们拿到这个密码以后就可以再次使用enroll命令，给devin这个用户生成msp的私钥和证书：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">fabric-ca-client enroll -u http:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">//</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">devin:GOuMzkcGgGzq@localhost:7054 -M $FABRIC_CA_CLIENT_HOME/devinmsp</span></pre> 
  </div> 
  <pre>现在新用户devin的私钥和证书就在$HOME/ca/devinmsp目录下，我们可以使用tree命令查看一下：</pre> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">devinmsp/<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> 
├── cacerts 
│   └── localhost</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">7054</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">.pem 
├── keystore 
│   └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk 
└── signcerts 
    └── cert.pem</span></pre> 
  </div> 
  <h2>4.编写ChainCode验证当前用户</h2> 
  <p>由于官方提供的example02并没有关于当前用户的信息的代码，所以我们需要编写自己的ChainCode。</p> 
  <p>这里我们主要是用到ChainCode接口提供的GetCreator方法，具体完整的ChainCode如下：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;"><span style="font-family: !important;font-size:12px !important;line-height:1.5;">package main

import (
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">github.com/hyperledger/fabric/core/chaincode/shim</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">
   pb </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">github.com/hyperledger/fabric/protos/peer</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>
   <span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>
   <span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">encoding/pem</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>
   <span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">crypto/x509</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>
   <span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">bytes</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">
)

type SimpleChaincode struct {
}

func main() {
   err :</span>=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> shim.Start(new(SimpleChaincode))
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">if</span> err !=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> nil {
      </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Printf(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">Error starting Simple chaincode: %s</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">, err)
   }
}
func (t </span>*<span style="font-family: !important;font-size:12px !important;line-height:1.5;">SimpleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response {
   return shim.Success(nil)
}


func (t </span>*<span style="font-family: !important;font-size:12px !important;line-height:1.5;">SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response {
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">function</span>, args :=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> stub.GetFunctionAndParameters()
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Println(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">invoke is running </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span> + <span style="font-family: !important;font-size:12px !important;line-height:1.5;">function</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">)
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">if</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">function</span> == <span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">cert</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span> {<span style="font-family: !important;font-size:12px !important;line-height:1.5;">//</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">自定义函数名称</span>
      return t.testCertificate(stub, args)<span style="font-family: !important;font-size:12px !important;line-height:1.5;">//</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">定义调用的函数</span>
<span style="font-family: !important;font-size:12px !important;line-height:1.5;">   }
   return shim.Error(</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">Received unknown function invocation</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">)
}
func (t </span>*SimpleChaincode) testCertificate(stub shim.ChaincodeStubInterface, args []<span style="font-family: !important;font-size:12px !important;line-height:1.5;">string</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">) pb.Response{
   creatorByte,_:</span>=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> stub.GetCreator()
   certStart :</span>= bytes.IndexAny(creatorByte, <span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">-----</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>)<span style="font-family: !important;font-size:12px !important;line-height:1.5;">//</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Devin:I don't know why sometimes -----BEGIN is invalid, so I use -----</span>
   <span style="font-family: !important;font-size:12px !important;line-height:1.5;">if</span> certStart == -<span style="font-family: !important;font-size:12px !important;line-height:1.5;">1</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> {
      </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Errorf(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">No certificate found</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">)
   }
   certText :</span>=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> creatorByte[certStart:]
   bl, _ :</span>=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> pem.Decode(certText)
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">if</span> bl ==<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> nil {
      </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Errorf(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">Could not decode the PEM structure</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">)
   }
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Println(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">string</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">(certText))
   cert, err :</span>=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> x509.ParseCertificate(bl.Bytes)
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">if</span> err !=<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> nil {
      </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Errorf(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">ParseCertificate failed</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">)
   }
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">.Println(cert)
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">uname</span>:=<span style="font-family: !important;font-size:12px !important;line-height:1.5;">cert.Subject.CommonName
   </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">fmt</span>.Println(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">Name:</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>+<span style="font-family: !important;font-size:12px !important;line-height:1.5;">uname</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">)
   return shim.Success([]</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">byte</span>(<span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">Called testCertificate </span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">"</span>+<span style="font-family: !important;font-size:12px !important;line-height:1.5;">uname</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">))
}</span></pre> 
  </div> 
  <pre>我们只需要在~/go/src/github.com/hyperledger/fabric/examples/chaincode/go目录下新建一个文件夹，比如test1，然后新建一个文件test1.go并粘贴上面的代码进去即可。</pre> 
  <p>现在ChainCode已经开发完成，我们需要部署并测试该ChainCode的正确性，下面是部署步骤：</p> 
  <p>首先登陆到cli中：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">docker exec -it cli bash</pre> 
  </div> 
  <p>然后在cli下面执行以下命令：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">peer chaincode <span style="font-family: !important;font-size:12px !important;line-height:1.5;">install</span> -n test1 -v <span style="font-family: !important;font-size:12px !important;line-height:1.5;">1.0</span> -p github.com/hyperledger/fabric/examples/chaincode/go/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">test1

ORDERER_CA</span>=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">cert.pem

peer chaincode instantiate </span>-o orderer.example.com:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">7050</span> --tls <span style="font-family: !important;font-size:12px !important;line-height:1.5;">true</span> --cafile $ORDERER_CA -C mychannel -n test1 -v <span style="font-family: !important;font-size:12px !important;line-height:1.5;">1.0</span> -c <span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">{"Args":[]}</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">

peer chaincode query </span>-C mychannel -n test1 -c <span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">{"Args":["cert"]}</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span></pre> 
  </div> 
  <pre>系统返回结果，说明我们当前的用户是Admin@org1.example.com</pre> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c <span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">{"Args":["cert"]}</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span> 
<span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.175</span> UTC [msp] GetLocalMSP -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">001</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Returning existing local MSP 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.176</span> UTC [msp] GetDefaultSigningIdentity -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">002</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Obtaining default signing identity 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.176</span> UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO <span style="font-family: !important;font-size:12px !important;line-height:1.5;">003</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Using default escc 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.176</span> UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO <span style="font-family: !important;font-size:12px !important;line-height:1.5;">004</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Using default vscc 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.176</span> UTC [msp/identity] Sign -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">005</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Sign: plaintext: 0A95070A6708031A0B08D7EEBACD0510...07120574657374311A060A0463657274 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.176</span> UTC [msp/identity] Sign -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">006</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Sign: digest: B4BB1EE5E6EBA63E50C85831C8820FB0B4490C55F23C247EDE5529DDAB23C273 
Query Result: Called testCertificate <span style="font-family: !important;font-size:12px !important;line-height:1.5;">Admin@org1.example.com</span> 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">40</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">23.195</span> UTC [main] main -&gt; INFO <span style="font-family: !important;font-size:12px !important;line-height:1.5;">007</span> Exiting..... </pre> 
  </div> 
  <h2>5.设置新用户的证书和私钥文件夹，验证新用户的可用性</h2> 
  <p>因为我们是给org1设置的CA，用户devin也是在org1下，所以需要把~/ca/devinmsp下面的文件转移到org1下面。org1的用户证书和私钥文件夹在：</p> 
  <p>~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/users</p> 
  <p>我们需要新建文件夹devin用于保存新用户的证书和私钥，我们新建一个Ubuntu的命令行窗口，前面已经登录您的cli的窗口保留，我们接下来还会用。</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">cd ~/go/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config/peerOrganizations/org1.example.com/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">users

</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">mkdir</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> devin

</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">cp</span> ~/ca/devinmsp/ devin/msp –R</pre> 
  </div> 
  <p>不知道什么原因，Fabric在使用的时候需要用到msp文件夹下的admincerts文件夹，但是CA Client在生成的时候并没有这个文件夹，所以我们需要从signcerts这个文件夹中拷贝一个过来，运行以下命令：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;"><span style="font-family: !important;font-size:12px !important;line-height:1.5;">mkdir</span> devin/msp/<span style="font-family: !important;font-size:12px !important;line-height:1.5;">admincerts

</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">cp</span> devin/msp/signcerts/cert.pem devin/msp/admincerts/</pre> 
  </div> 
  <p>好现在我们的新用户的所有证书准备完毕，tree devin看看结果：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">devin/<span style="font-family: !important;font-size:12px !important;line-height:1.5;"> 
└── msp 
    ├── admincerts 
    │   └── cert.pem 
    ├── cacerts 
    │   └── localhost</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">7054</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">.pem 
    ├── keystore 
    │   └── a044e43ad1fd7cdfd1fd995abaef53895534bd70e8cdfdb665430d12665f2041_sk 
    └── signcerts 
        └── cert.pem</span></pre> 
  </div> 
  <p>接下来切换到cli窗口，我们把当前cli的用户msp文件夹切换成devin的文件夹，具体命令是：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/devin/msp</pre> 
  </div> 
  <p>现在我们再来运行一下ChainCode：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">peer chaincode query -C mychannel -n test1 -c <span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">{"Args":["cert"]}</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span></pre> 
  </div> 
  <p>我们可以看到结果已经变化了，用户已经由Admin变成了devin：</p> 
  <div class="cnblogs_code"> 
   <pre style="font-family:'Courier New' !important;font-size:12px !important;">root@2d1735e72642:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n test1 -c <span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">{"Args":["cert"]}</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">'</span> 
<span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.497</span> UTC [msp] GetLocalMSP -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">001</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Returning existing local MSP 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.497</span> UTC [msp] GetDefaultSigningIdentity -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">002</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Obtaining default signing identity 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.497</span> UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO <span style="font-family: !important;font-size:12px !important;line-height:1.5;">003</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Using default escc 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.497</span> UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO <span style="font-family: !important;font-size:12px !important;line-height:1.5;">004</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Using default vscc 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.497</span> UTC [msp/identity] Sign -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">005</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Sign: plaintext: 0AE3070A6808031A0C08DDF4BACD0510...07120574657374311A060A0463657274 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.497</span> UTC [msp/identity] Sign -&gt; DEBU <span style="font-family: !important;font-size:12px !important;line-height:1.5;">006</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;"> Sign: digest: 21EE9B77A231E22ACB5FDD59C668C1A6E300833A820901DF9E896E22C00FC00F 
Query Result: Called testCertificate <span style="font-family: !important;font-size:12px !important;line-height:1.5;">devin</span> 
</span><span style="font-family: !important;font-size:12px !important;line-height:1.5;">2017</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">09</span>-<span style="font-family: !important;font-size:12px !important;line-height:1.5;">05</span> <span style="font-family: !important;font-size:12px !important;line-height:1.5;">14</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">53</span>:<span style="font-family: !important;font-size:12px !important;line-height:1.5;">17.508</span> UTC [main] main -&gt; INFO <span style="font-family: !important;font-size:12px !important;line-height:1.5;">007</span> Exiting.....</pre> 
  </div> 
  <p>以上就是关于Fabric CA环境集成的简单测试。关于CA Server有配置文件在CA Server容器内部，可以针对不同的org信息进行修改。而CA Client也有配置文件，也可以在enroll之前进行修改。</p> 
  <br> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jambeau/article/details/78643394,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jambeau/article/details/78643394,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/liyuechun520/article/details/78620774 孔壹学院：国内区块链职业教育引领品牌。 作者：黎跃春，孔壹学院创始人，区块链、高可用架构师 微信：liyc1215 区块链博客：http://liyuechun.org Ebay项目 基于以太坊Ethereum &amp; IPFS的去中心化Ebay区块链项目详情链接 目录 1. 内容简介 2. IPFS-HTTP效果图 3. 实现步骤 3.1 安装create-react-app 3.2 React项目创建 3.3 运行React项目 3.4 浏览项目 ipfs-api3.5 安装ipfs-api 3.6 完成UI逻辑 3.7 导入IPFS 3.8 编写上传大文本字符串到IPFS的Promise函数 3.9 上传数据到IPFS 3.10 跨域资源共享CORS配置 3.11 再次刷新网页提交数据并在线查看数据 3.12 从IPFS读取数据 3.13 总结 4. 下篇文章预告 1. 内容简介 【IPFS + 区块链 系列】 入门篇 - IPFS环境配置 【IPFS + 区块链 系列】 入门篇 - IPFS+IPNS+个人博客搭建 在前面两篇文章中，第一篇春哥给大家详细介绍了IPFS环境配置，第二篇介绍了IPFS如何搭建个人博客，通过这两篇文章相信大家已经对IPFS有所了解，接下来的这篇文章，我们将为大家讲解js-ipfs-api的简单使用，如何将数据上传到IPFS，以及如何从IPFS通过HASH读取数据。 2. IPFS-HTTP效果图 3. 实现步骤 3.1 安装create-react-app 参考文档：https://reactjs.org/tutorial/tutorial.html localhost:1123 yuechunli$ npm install -g create-react-app 3.2 React项目创建 localhost:1123 yuechunli$ create-react-app ipfs-http-demo localhost:ipfs-http-demo yuechunli$ ls README.md package.json src node_modules public yarn.lock localhost:ipfs-http-demo yuechunli$ 3.3 运行React项目 localhost:ipfs-http-demo yuechunli$ npm start Compiled successfully! You can now view ipfs-http-demo in the browser. Local: http://localhost:3000/ On Your Network: http://192.168.0.107:3000/ Note that the development build is not optimized. To create a production build, use yarn build. 3.4 浏览项目 浏览器浏览http://localhost:3000。 效果如下： 3.5 安装ipfs-api ⚠️：在这里我就不过多的去介绍React的使用以及开发，如果感兴趣的可以去看这套React的视频，学完这套视频你可以直接进企业找React相关的前端开发工作。 项目结构 安装ipfs-api 切换到项目根目录，安装ipfs-api。 $ npm uninstall --save ipfs-api localhost:ipfs-http-demo yuechunli$ ls README.md package.json src node_modules public yarn.lock localhost:ipfs-http-demo yuechunli$ pwd /Users/liyuechun/Desktop/1123/ipfs-http-demo localhost:ipfs-http-demo yuechunli$ npm uninstall --save ipfs-api ⚠️：ipfs安装完后，如上图所示，接下来刷新一下浏览器，看看项目是否有问题，正常来讲，一切会正常，������，Continue，Continue，Continue…… 3.6 完成UI逻辑 拷贝下面的代码，将src/App.js里面的代码直接替换掉。 import React, { Component } from &#39;react&#39;; import &#39;./App.css&#39;; class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } render() { return ( &lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{width: 200,height: 40,borderWidth:2}}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt; ); } } export default App; 上面的代码完成的工作是，当我们在输入框中输入一个字符串时，点击提交到IPFS按钮，将文本框中的内容取出来打印，后续我们需要将这个数据上传到IPFS。点击读取数据按钮，我们也只是随便打印了一个字符串，后面需要从IPFS读取数据，然后将读取的数据存储到状态机变量strContent中并且展示出来。 3.7 导入IPFS const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); 3.8 编写上传大文本字符串到IPFS的Promise函数 saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } response[0].hash返回的是数据上传到IPFS后返回的HASH字符串。 3.9 上传数据到IPFS this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); ipfsContent是从文本框中取到的数据，调用this.saveTextBlobOnIpfs方法将数据上传后，会返回字符串hash，并且将hash存储到状态机变量strHash中。 目前完整的代码： import React, {Component} from &#39;react&#39;; import &#39;./App.css&#39;; const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } render() { return (&lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{ width: 200, height: 40, borderWidth: 2 }}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt;); } } export default App; 测试： 3.10 跨域资源共享CORS配置 跨域资源共享( CORS )配置，依次在终端执行下面的代码： localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods &#39;[&quot;PUT&quot;, &quot;GET&quot;, &quot;POST&quot;, &quot;OPTIONS&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin &#39;[&quot;*&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Credentials &#39;[&quot;true&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Headers &#39;[&quot;Authorization&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Expose-Headers &#39;[&quot;Location&quot;]&#39; 用正确的端口运行daemon： localhost:ipfs-http-demo yuechunli$ ipfs config Addresses.API /ip4/127.0.0.1/tcp/5001 localhost:ipfs-http-demo yuechunli$ ipfs config Addresses.API /ip4/127.0.0.1/tcp/5001 localhost:ipfs-http-demo yuechunli$ ipfs daemon 3.11 再次刷新网页提交数据并在线查看数据 上传数据，并且查看返回hash值 在线查看上传到IPFS的数据 3.12 从IPFS读取数据 ipfs.cat ipfs.cat(this.state.strHash).then((stream) =&gt; { console.log(stream); let strContent = Utf8ArrayToStr(stream); console.log(strContent); this.setState({strContent: strContent}); }); stream为Uint8Array类型的数据，下面的方法是将Uint8Array转换为string字符串。 Utf8ArrayToStr function Utf8ArrayToStr(array) { var out, i, len, c; var char2, char3; out = &quot;&quot;; len = array.length; i = 0; while(i &lt; len) { c = array[i++]; switch(c &gt;&gt; 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: // 0xxxxxxx out += String.fromCharCode(c); break; case 12: case 13: // 110x xxxx 10xx xxxx char2 = array[i++]; out += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 6) | (char2 &amp; 0x3F)); break; case 14: // 1110 xxxx 10xx xxxx 10xx xxxx char2 = array[i++]; char3 = array[i++]; out += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 12) | ((char2 &amp; 0x3F) &lt;&lt; 6) | ((char3 &amp; 0x3F) &lt;&lt; 0)); break; default: break; } } return out; } 完整源码 import React, {Component} from &#39;react&#39;; import &#39;./App.css&#39;; const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); function Utf8ArrayToStr(array) { var out, i, len, c; var char2, char3; out = &quot;&quot;; len = array.length; i = 0; while (i &lt; len) { c = array[i++]; switch (c &gt;&gt; 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: // 0xxxxxxx out += String.fromCharCode(c); break; case 12: case 13: // 110x xxxx 10xx xxxx char2 = array[i++]; out += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 6) | (char2 &amp; 0x3F)); break; case 14: // 1110 xxxx 10xx xxxx 10xx xxxx char2 = array[i++]; char3 = array[i++]; out += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 12) | ((char2 &amp; 0x3F) &lt;&lt; 6) | ((char3 &amp; 0x3F) &lt;&lt; 0)); break; default: break; } } return out; } class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } render() { return (&lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{ width: 200, height: 40, borderWidth: 2 }}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) ipfs.cat(this.state.strHash).then((stream) =&gt; { console.log(stream); let strContent = Utf8ArrayToStr(stream); console.log(strContent); this.setState({strContent: strContent}); }); }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt;); } } export default App; 3.13 总结 这篇文章主要讲解如何配置React环境，如何创建React项目，如何安装js-ipfs-api，如何上传数据，如何设置开发环境，如何下载数据等等内容。通过这篇文章的系统学习，你会掌握js-ipfs-api在项目中的使用流程。 这是【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。 4. 下篇文章预告 这是【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。 5. 技术交流 区块链技术交流QQ群：348924182 进微信群请加微信：liyc1215 「区块链部落」官方公众号 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/liyuechun520/article/details/78620774 孔壹学院：国内区块链职业教育引领品牌。 作者：黎跃春，孔壹学院创始人，区块链、高可用架构师 微信：liyc1215 区块链博客：http://liyuechun.org Ebay项目 基于以太坊Ethereum &amp; IPFS的去中心化Ebay区块链项目详情链接 目录 1. 内容简介 2. IPFS-HTTP效果图 3. 实现步骤 3.1 安装create-react-app 3.2 React项目创建 3.3 运行React项目 3.4 浏览项目 ipfs-api3.5 安装ipfs-api 3.6 完成UI逻辑 3.7 导入IPFS 3.8 编写上传大文本字符串到IPFS的Promise函数 3.9 上传数据到IPFS 3.10 跨域资源共享CORS配置 3.11 再次刷新网页提交数据并在线查看数据 3.12 从IPFS读取数据 3.13 总结 4. 下篇文章预告 1. 内容简介 【IPFS + 区块链 系列】 入门篇 - IPFS环境配置 【IPFS + 区块链 系列】 入门篇 - IPFS+IPNS+个人博客搭建 在前面两篇文章中，第一篇春哥给大家详细介绍了IPFS环境配置，第二篇介绍了IPFS如何搭建个人博客，通过这两篇文章相信大家已经对IPFS有所了解，接下来的这篇文章，我们将为大家讲解js-ipfs-api的简单使用，如何将数据上传到IPFS，以及如何从IPFS通过HASH读取数据。 2. IPFS-HTTP效果图 3. 实现步骤 3.1 安装create-react-app 参考文档：https://reactjs.org/tutorial/tutorial.html localhost:1123 yuechunli$ npm install -g create-react-app 3.2 React项目创建 localhost:1123 yuechunli$ create-react-app ipfs-http-demo localhost:ipfs-http-demo yuechunli$ ls README.md package.json src node_modules public yarn.lock localhost:ipfs-http-demo yuechunli$ 3.3 运行React项目 localhost:ipfs-http-demo yuechunli$ npm start Compiled successfully! You can now view ipfs-http-demo in the browser. Local: http://localhost:3000/ On Your Network: http://192.168.0.107:3000/ Note that the development build is not optimized. To create a production build, use yarn build. 3.4 浏览项目 浏览器浏览http://localhost:3000。 效果如下： 3.5 安装ipfs-api ⚠️：在这里我就不过多的去介绍React的使用以及开发，如果感兴趣的可以去看这套React的视频，学完这套视频你可以直接进企业找React相关的前端开发工作。 项目结构 安装ipfs-api 切换到项目根目录，安装ipfs-api。 $ npm uninstall --save ipfs-api localhost:ipfs-http-demo yuechunli$ ls README.md package.json src node_modules public yarn.lock localhost:ipfs-http-demo yuechunli$ pwd /Users/liyuechun/Desktop/1123/ipfs-http-demo localhost:ipfs-http-demo yuechunli$ npm uninstall --save ipfs-api ⚠️：ipfs安装完后，如上图所示，接下来刷新一下浏览器，看看项目是否有问题，正常来讲，一切会正常，������，Continue，Continue，Continue…… 3.6 完成UI逻辑 拷贝下面的代码，将src/App.js里面的代码直接替换掉。 import React, { Component } from &#39;react&#39;; import &#39;./App.css&#39;; class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } render() { return ( &lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{width: 200,height: 40,borderWidth:2}}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt; ); } } export default App; 上面的代码完成的工作是，当我们在输入框中输入一个字符串时，点击提交到IPFS按钮，将文本框中的内容取出来打印，后续我们需要将这个数据上传到IPFS。点击读取数据按钮，我们也只是随便打印了一个字符串，后面需要从IPFS读取数据，然后将读取的数据存储到状态机变量strContent中并且展示出来。 3.7 导入IPFS const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); 3.8 编写上传大文本字符串到IPFS的Promise函数 saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } response[0].hash返回的是数据上传到IPFS后返回的HASH字符串。 3.9 上传数据到IPFS this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); ipfsContent是从文本框中取到的数据，调用this.saveTextBlobOnIpfs方法将数据上传后，会返回字符串hash，并且将hash存储到状态机变量strHash中。 目前完整的代码： import React, {Component} from &#39;react&#39;; import &#39;./App.css&#39;; const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } render() { return (&lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{ width: 200, height: 40, borderWidth: 2 }}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt;); } } export default App; 测试： 3.10 跨域资源共享CORS配置 跨域资源共享( CORS )配置，依次在终端执行下面的代码： localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods &#39;[&quot;PUT&quot;, &quot;GET&quot;, &quot;POST&quot;, &quot;OPTIONS&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin &#39;[&quot;*&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Credentials &#39;[&quot;true&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Headers &#39;[&quot;Authorization&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Expose-Headers &#39;[&quot;Location&quot;]&#39; 用正确的端口运行daemon： localhost:ipfs-http-demo yuechunli$ ipfs config Addresses.API /ip4/127.0.0.1/tcp/5001 localhost:ipfs-http-demo yuechunli$ ipfs config Addresses.API /ip4/127.0.0.1/tcp/5001 localhost:ipfs-http-demo yuechunli$ ipfs daemon 3.11 再次刷新网页提交数据并在线查看数据 上传数据，并且查看返回hash值 在线查看上传到IPFS的数据 3.12 从IPFS读取数据 ipfs.cat ipfs.cat(this.state.strHash).then((stream) =&gt; { console.log(stream); let strContent = Utf8ArrayToStr(stream); console.log(strContent); this.setState({strContent: strContent}); }); stream为Uint8Array类型的数据，下面的方法是将Uint8Array转换为string字符串。 Utf8ArrayToStr function Utf8ArrayToStr(array) { var out, i, len, c; var char2, char3; out = &quot;&quot;; len = array.length; i = 0; while(i &lt; len) { c = array[i++]; switch(c &gt;&gt; 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: // 0xxxxxxx out += String.fromCharCode(c); break; case 12: case 13: // 110x xxxx 10xx xxxx char2 = array[i++]; out += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 6) | (char2 &amp; 0x3F)); break; case 14: // 1110 xxxx 10xx xxxx 10xx xxxx char2 = array[i++]; char3 = array[i++]; out += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 12) | ((char2 &amp; 0x3F) &lt;&lt; 6) | ((char3 &amp; 0x3F) &lt;&lt; 0)); break; default: break; } } return out; } 完整源码 import React, {Component} from &#39;react&#39;; import &#39;./App.css&#39;; const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); function Utf8ArrayToStr(array) { var out, i, len, c; var char2, char3; out = &quot;&quot;; len = array.length; i = 0; while (i &lt; len) { c = array[i++]; switch (c &gt;&gt; 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: // 0xxxxxxx out += String.fromCharCode(c); break; case 12: case 13: // 110x xxxx 10xx xxxx char2 = array[i++]; out += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 6) | (char2 &amp; 0x3F)); break; case 14: // 1110 xxxx 10xx xxxx 10xx xxxx char2 = array[i++]; char3 = array[i++]; out += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 12) | ((char2 &amp; 0x3F) &lt;&lt; 6) | ((char3 &amp; 0x3F) &lt;&lt; 0)); break; default: break; } } return out; } class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } render() { return (&lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{ width: 200, height: 40, borderWidth: 2 }}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) ipfs.cat(this.state.strHash).then((stream) =&gt; { console.log(stream); let strContent = Utf8ArrayToStr(stream); console.log(strContent); this.setState({strContent: strContent}); }); }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt;); } } export default App; 3.13 总结 这篇文章主要讲解如何配置React环境，如何创建React项目，如何安装js-ipfs-api，如何上传数据，如何设置开发环境，如何下载数据等等内容。通过这篇文章的系统学习，你会掌握js-ipfs-api在项目中的使用流程。 这是【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。 4. 下篇文章预告 这是【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。 5. 技术交流 区块链技术交流QQ群：348924182 进微信群请加微信：liyc1215 「区块链部落」官方公众号 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/11/24/16f7d9f9b1ed46ea5a1e697048030118.html" />
<meta property="og:url" content="https://mlh.app/2017/11/24/16f7d9f9b1ed46ea5a1e697048030118.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-24T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/liyuechun520/article/details/78620774 孔壹学院：国内区块链职业教育引领品牌。 作者：黎跃春，孔壹学院创始人，区块链、高可用架构师 微信：liyc1215 区块链博客：http://liyuechun.org Ebay项目 基于以太坊Ethereum &amp; IPFS的去中心化Ebay区块链项目详情链接 目录 1. 内容简介 2. IPFS-HTTP效果图 3. 实现步骤 3.1 安装create-react-app 3.2 React项目创建 3.3 运行React项目 3.4 浏览项目 ipfs-api3.5 安装ipfs-api 3.6 完成UI逻辑 3.7 导入IPFS 3.8 编写上传大文本字符串到IPFS的Promise函数 3.9 上传数据到IPFS 3.10 跨域资源共享CORS配置 3.11 再次刷新网页提交数据并在线查看数据 3.12 从IPFS读取数据 3.13 总结 4. 下篇文章预告 1. 内容简介 【IPFS + 区块链 系列】 入门篇 - IPFS环境配置 【IPFS + 区块链 系列】 入门篇 - IPFS+IPNS+个人博客搭建 在前面两篇文章中，第一篇春哥给大家详细介绍了IPFS环境配置，第二篇介绍了IPFS如何搭建个人博客，通过这两篇文章相信大家已经对IPFS有所了解，接下来的这篇文章，我们将为大家讲解js-ipfs-api的简单使用，如何将数据上传到IPFS，以及如何从IPFS通过HASH读取数据。 2. IPFS-HTTP效果图 3. 实现步骤 3.1 安装create-react-app 参考文档：https://reactjs.org/tutorial/tutorial.html localhost:1123 yuechunli$ npm install -g create-react-app 3.2 React项目创建 localhost:1123 yuechunli$ create-react-app ipfs-http-demo localhost:ipfs-http-demo yuechunli$ ls README.md package.json src node_modules public yarn.lock localhost:ipfs-http-demo yuechunli$ 3.3 运行React项目 localhost:ipfs-http-demo yuechunli$ npm start Compiled successfully! You can now view ipfs-http-demo in the browser. Local: http://localhost:3000/ On Your Network: http://192.168.0.107:3000/ Note that the development build is not optimized. To create a production build, use yarn build. 3.4 浏览项目 浏览器浏览http://localhost:3000。 效果如下： 3.5 安装ipfs-api ⚠️：在这里我就不过多的去介绍React的使用以及开发，如果感兴趣的可以去看这套React的视频，学完这套视频你可以直接进企业找React相关的前端开发工作。 项目结构 安装ipfs-api 切换到项目根目录，安装ipfs-api。 $ npm uninstall --save ipfs-api localhost:ipfs-http-demo yuechunli$ ls README.md package.json src node_modules public yarn.lock localhost:ipfs-http-demo yuechunli$ pwd /Users/liyuechun/Desktop/1123/ipfs-http-demo localhost:ipfs-http-demo yuechunli$ npm uninstall --save ipfs-api ⚠️：ipfs安装完后，如上图所示，接下来刷新一下浏览器，看看项目是否有问题，正常来讲，一切会正常，������，Continue，Continue，Continue…… 3.6 完成UI逻辑 拷贝下面的代码，将src/App.js里面的代码直接替换掉。 import React, { Component } from &#39;react&#39;; import &#39;./App.css&#39;; class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } render() { return ( &lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{width: 200,height: 40,borderWidth:2}}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt; ); } } export default App; 上面的代码完成的工作是，当我们在输入框中输入一个字符串时，点击提交到IPFS按钮，将文本框中的内容取出来打印，后续我们需要将这个数据上传到IPFS。点击读取数据按钮，我们也只是随便打印了一个字符串，后面需要从IPFS读取数据，然后将读取的数据存储到状态机变量strContent中并且展示出来。 3.7 导入IPFS const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); 3.8 编写上传大文本字符串到IPFS的Promise函数 saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } response[0].hash返回的是数据上传到IPFS后返回的HASH字符串。 3.9 上传数据到IPFS this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); ipfsContent是从文本框中取到的数据，调用this.saveTextBlobOnIpfs方法将数据上传后，会返回字符串hash，并且将hash存储到状态机变量strHash中。 目前完整的代码： import React, {Component} from &#39;react&#39;; import &#39;./App.css&#39;; const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } render() { return (&lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{ width: 200, height: 40, borderWidth: 2 }}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt;); } } export default App; 测试： 3.10 跨域资源共享CORS配置 跨域资源共享( CORS )配置，依次在终端执行下面的代码： localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods &#39;[&quot;PUT&quot;, &quot;GET&quot;, &quot;POST&quot;, &quot;OPTIONS&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin &#39;[&quot;*&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Credentials &#39;[&quot;true&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Allow-Headers &#39;[&quot;Authorization&quot;]&#39; localhost:ipfs-http-demo yuechunli$ ipfs config --json API.HTTPHeaders.Access-Control-Expose-Headers &#39;[&quot;Location&quot;]&#39; 用正确的端口运行daemon： localhost:ipfs-http-demo yuechunli$ ipfs config Addresses.API /ip4/127.0.0.1/tcp/5001 localhost:ipfs-http-demo yuechunli$ ipfs config Addresses.API /ip4/127.0.0.1/tcp/5001 localhost:ipfs-http-demo yuechunli$ ipfs daemon 3.11 再次刷新网页提交数据并在线查看数据 上传数据，并且查看返回hash值 在线查看上传到IPFS的数据 3.12 从IPFS读取数据 ipfs.cat ipfs.cat(this.state.strHash).then((stream) =&gt; { console.log(stream); let strContent = Utf8ArrayToStr(stream); console.log(strContent); this.setState({strContent: strContent}); }); stream为Uint8Array类型的数据，下面的方法是将Uint8Array转换为string字符串。 Utf8ArrayToStr function Utf8ArrayToStr(array) { var out, i, len, c; var char2, char3; out = &quot;&quot;; len = array.length; i = 0; while(i &lt; len) { c = array[i++]; switch(c &gt;&gt; 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: // 0xxxxxxx out += String.fromCharCode(c); break; case 12: case 13: // 110x xxxx 10xx xxxx char2 = array[i++]; out += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 6) | (char2 &amp; 0x3F)); break; case 14: // 1110 xxxx 10xx xxxx 10xx xxxx char2 = array[i++]; char3 = array[i++]; out += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 12) | ((char2 &amp; 0x3F) &lt;&lt; 6) | ((char3 &amp; 0x3F) &lt;&lt; 0)); break; default: break; } } return out; } 完整源码 import React, {Component} from &#39;react&#39;; import &#39;./App.css&#39;; const ipfsAPI = require(&#39;ipfs-api&#39;); const ipfs = ipfsAPI({host: &#39;localhost&#39;, port: &#39;5001&#39;, protocol: &#39;http&#39;}); function Utf8ArrayToStr(array) { var out, i, len, c; var char2, char3; out = &quot;&quot;; len = array.length; i = 0; while (i &lt; len) { c = array[i++]; switch (c &gt;&gt; 4) { case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: // 0xxxxxxx out += String.fromCharCode(c); break; case 12: case 13: // 110x xxxx 10xx xxxx char2 = array[i++]; out += String.fromCharCode(((c &amp; 0x1F) &lt;&lt; 6) | (char2 &amp; 0x3F)); break; case 14: // 1110 xxxx 10xx xxxx 10xx xxxx char2 = array[i++]; char3 = array[i++]; out += String.fromCharCode(((c &amp; 0x0F) &lt;&lt; 12) | ((char2 &amp; 0x3F) &lt;&lt; 6) | ((char3 &amp; 0x3F) &lt;&lt; 0)); break; default: break; } } return out; } class App extends Component { constructor(props) { super(props); this.state = { strHash: null, strContent: null } } saveTextBlobOnIpfs = (blob) =&gt; { return new Promise(function(resolve, reject) { const descBuffer = Buffer.from(blob, &#39;utf-8&#39;); ipfs.add(descBuffer).then((response) =&gt; { console.log(response) resolve(response[0].hash); }).catch((err) =&gt; { console.error(err) reject(err); }) }) } render() { return (&lt;div className=&quot;App&quot;&gt; &lt;input ref=&quot;ipfsContent&quot; style={{ width: 200, height: 40, borderWidth: 2 }}/&gt; &lt;button onClick={() =&gt; { let ipfsContent = this.refs.ipfsContent.value; console.log(ipfsContent); this.saveTextBlobOnIpfs(ipfsContent).then((hash) =&gt; { console.log(hash); this.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{this.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { console.log(&#39;从ipfs读取数据。&#39;) ipfs.cat(this.state.strHash).then((stream) =&gt; { console.log(stream); let strContent = Utf8ArrayToStr(stream); console.log(strContent); this.setState({strContent: strContent}); }); }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{this.state.strContent}&lt;/h1&gt; &lt;/div&gt;); } } export default App; 3.13 总结 这篇文章主要讲解如何配置React环境，如何创建React项目，如何安装js-ipfs-api，如何上传数据，如何设置开发环境，如何下载数据等等内容。通过这篇文章的系统学习，你会掌握js-ipfs-api在项目中的使用流程。 这是【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。 4. 下篇文章预告 这是【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。 5. 技术交流 区块链技术交流QQ群：348924182 进微信群请加微信：liyc1215 「区块链部落」官方公众号 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/11/24/16f7d9f9b1ed46ea5a1e697048030118.html","headline":"【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api","dateModified":"2017-11-24T00:00:00+08:00","datePublished":"2017-11-24T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/11/24/16f7d9f9b1ed46ea5a1e697048030118.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/liyuechun520/article/details/78620774 
 </div> 
 <div class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <blockquote> 
   <p>孔壹学院：国内区块链职业教育引领品牌。</p> 
   <p>作者：黎跃春，孔壹学院创始人，区块链、高可用架构师</p> 
   <p>微信：liyc1215</p> 
   <p>区块链博客：<a href="http://liyuechun.org" rel="nofollow" target="_blank">http://liyuechun.org</a></p> 
  </blockquote> 
  <h2 id="ebay项目">Ebay项目</h2> 
  <p><strong>基于以太坊Ethereum &amp; IPFS的去中心化Ebay区块链项目<a href="https://mp.weixin.qq.com/s/feY21MxV_-LuWogPW6qqWA" rel="nofollow" target="_blank">详情链接</a></strong></p> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/ipfs-http.png" alt="" title=""></p> 
  <h2 id="目录">目录</h2> 
  <ul> 
   <li><a href="#1-内容简介" rel="nofollow" target="_blank">1. 内容简介</a></li> 
   <li><a href="#2-IPFS-HTTP效果图" rel="nofollow" target="_blank">2. IPFS-HTTP效果图</a></li> 
   <li><a href="#3-实现步骤" rel="nofollow" target="_blank">3. 实现步骤</a> <br> 
    <ul>
     <li><a href="#31-安装create-react-app" rel="nofollow" target="_blank">3.1 安装create-react-app</a></li> 
     <li><a href="#32-React项目创建" rel="nofollow" target="_blank">3.2 React项目创建</a></li> 
     <li><a href="#33-运行React项目" rel="nofollow" target="_blank">3.3 运行React项目</a></li> 
     <li><a href="#34-浏览项目" rel="nofollow" target="_blank">3.4 浏览项目</a></li> 
     <li><a href="&quot;#35-安装<code" rel="nofollow" target="_blank">ipfs-api3.5 安装<code>ipfs-api</code></a></li> 
     <li><a href="#36-完成UI逻辑" rel="nofollow" target="_blank">3.6 完成UI逻辑</a></li> 
     <li><a href="#37-导入IPFS" rel="nofollow" target="_blank">3.7 导入IPFS</a></li> 
     <li><a href="#38-编写上传大文本字符串到IPFS的Promise函数" rel="nofollow" target="_blank">3.8 编写上传大文本字符串到IPFS的Promise函数</a></li> 
     <li><a href="#39-上传数据到IPFS" rel="nofollow" target="_blank">3.9 上传数据到IPFS</a></li> 
     <li><a href="#310-跨域资源共享CORS配置" rel="nofollow" target="_blank">3.10 跨域资源共享CORS配置</a></li> 
     <li><a href="#311-再次刷新网页提交数据并在线查看数据" rel="nofollow" target="_blank">3.11 再次刷新网页提交数据并在线查看数据</a></li> 
     <li><a href="#312-从IPFS读取数据" rel="nofollow" target="_blank">3.12 从IPFS读取数据</a></li> 
     <li><a href="#313-总结" rel="nofollow" target="_blank">3.13 总结</a></li>
    </ul></li> 
   <li><a href="#4-下篇文章预告" rel="nofollow" target="_blank">4. 下篇文章预告</a></li> 
  </ul> 
  <h2 id="1-内容简介">1. 内容简介</h2> 
  <ul> 
   <li><a href="http://liyuechun.org/2017/11/20/ipfs-blockchain/" rel="nofollow" target="_blank">【IPFS + 区块链 系列】 入门篇 - IPFS环境配置</a></li> 
   <li><a href="http://liyuechun.org/2017/11/21/ipfs-blockchain-blogger/" rel="nofollow" target="_blank">【IPFS + 区块链 系列】 入门篇 - IPFS+IPNS+个人博客搭建</a></li> 
  </ul> 
  <p>在前面两篇文章中，第一篇春哥给大家详细介绍了<code>IPFS</code>环境配置，第二篇介绍了<code>IPFS</code>如何搭建个人博客，通过这两篇文章相信大家已经对<code>IPFS</code>有所了解，接下来的这篇文章，我们将为大家讲解<code>js-ipfs-api</code>的简单使用，如何将数据上传到<code>IPFS</code>，以及如何从<code>IPFS</code>通过<code>HASH</code>读取数据。</p> 
  <h2 id="2-ipfs-http效果图">2. IPFS-HTTP效果图</h2> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/ipfs-http-demo.gif" alt="" title=""></p> 
  <h2 id="3-实现步骤">3. 实现步骤</h2> 
  <h3 id="31-安装create-react-app">3.1 安装create-react-app</h3> 
  <p><strong>参考文档：</strong><a href="https://reactjs.org/tutorial/tutorial.html" rel="nofollow" target="_blank">https://reactjs.org/tutorial/tutorial.html</a></p> 
  <pre class="prettyprint"><code class=" hljs lasso">localhost:<span class="hljs-number">1123</span> yuechunli$ npm install <span class="hljs-attribute">-g</span> create<span class="hljs-attribute">-react</span><span class="hljs-attribute">-app</span></code></pre> 
  <h3 id="32-react项目创建">3.2 React项目创建</h3> 
  <pre class="prettyprint"><code class=" hljs lasso">localhost:<span class="hljs-number">1123</span> yuechunli$ create<span class="hljs-attribute">-react</span><span class="hljs-attribute">-app</span> ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span>
localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ls
README<span class="hljs-built_in">.</span>md   package<span class="hljs-built_in">.</span>json    src
node_modules    <span class="hljs-keyword">public</span>      yarn<span class="hljs-built_in">.</span>lock
localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ </code></pre> 
  <h3 id="33-运行react项目">3.3 运行React项目</h3> 
  <pre class="prettyprint"><code class=" hljs lasso">localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ npm start</code></pre> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">Compiled successfully!

You can now view ipfs-<span class="hljs-keyword">http</span>-demo <span class="hljs-operator">in</span> <span class="hljs-operator">the</span> browser.

  Local:            <span class="hljs-keyword">http</span>://localhost:<span class="hljs-number">3000</span>/
  On Your Network:  <span class="hljs-keyword">http</span>://<span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.107</span>:<span class="hljs-number">3000</span>/

Note that <span class="hljs-operator">the</span> development build is <span class="hljs-operator">not</span> optimized.
To <span class="hljs-built_in">create</span> <span class="hljs-operator">a</span> production build, use yarn build.</code></pre> 
  <h3 id="34-浏览项目">3.4 浏览项目</h3> 
  <p>浏览器浏览<code>http://localhost:3000</code>。</p> 
  <p>效果如下：</p> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/Snip20171123_2.png" alt="" title=""></p> 
  <h3 id="35-安装ipfs-api">3.5 安装<code>ipfs-api</code></h3> 
  <p><strong>⚠️：在这里我就不过多的去介绍React的使用以及开发，如果感兴趣的可以去看<a href="http://edu.csdn.net/course/play/4749" rel="nofollow" target="_blank">这套React的视频</a>，学完这套视频你可以直接进企业找React相关的前端开发工作。</strong></p> 
  <ul> 
   <li>项目结构</li> 
  </ul> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/Snip20171123_3.png" alt="" title=""></p> 
  <ul> 
   <li>安装<code>ipfs-api</code></li> 
  </ul> 
  <p>切换到项目根目录，安装<code>ipfs-api</code>。</p> 
  <pre class="prettyprint"><code class=" hljs brainfuck"><span class="hljs-comment">$</span> <span class="hljs-comment">npm</span> <span class="hljs-comment">uninstall</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span> <span class="hljs-comment">ipfs</span><span class="hljs-literal">-</span><span class="hljs-comment">api</span></code></pre> 
  <pre class="prettyprint"><code class=" hljs lasso">localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ls
README<span class="hljs-built_in">.</span>md   package<span class="hljs-built_in">.</span>json    src
node_modules    <span class="hljs-keyword">public</span>      yarn<span class="hljs-built_in">.</span>lock
localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ pwd
/Users/liyuechun/Desktop/<span class="hljs-number">1123</span>/ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span>
localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ npm uninstall <span class="hljs-subst">--</span>save ipfs<span class="hljs-attribute">-api</span></code></pre> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/Snip20171123_5.png" alt="" title=""></p> 
  <p><strong>⚠️：ipfs安装完后，如上图所示，接下来刷新一下浏览器，看看项目是否有问题，正常来讲，一切会正常，������，Continue，Continue，Continue……</strong></p> 
  <h3 id="36-完成ui逻辑">3.6 完成UI逻辑</h3> 
  <p>拷贝下面的代码，将<code>src/App.js</code>里面的代码直接替换掉。</p> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-reserved">import</span> React, { Component } from <span class="hljs-string">'react'</span>;
<span class="hljs-reserved">import</span> <span class="hljs-string">'./App.css'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> {</span>


      constructor(props) {
          <span class="hljs-keyword">super</span>(props);
          <span class="hljs-keyword">this</span>.state = {
            <span class="hljs-attribute">strHash</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attribute">strContent</span>: <span class="hljs-literal">null</span>
          }
      }

    render() {
      <span class="hljs-keyword">return</span> (
        &lt;div className=<span class="hljs-string">"App"</span>&gt;
          &lt;input
            ref=<span class="hljs-string">"ipfsContent"</span>
            style={{<span class="hljs-attribute">width</span>: <span class="hljs-number">200</span>,<span class="hljs-attribute">height</span>: <span class="hljs-number">40</span>,<span class="hljs-attribute">borderWidth</span>:<span class="hljs-number">2</span>}}/&gt;
          &lt;button onClick={<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-reserved">let</span> ipfsContent = <span class="hljs-keyword">this</span>.refs.ipfsContent.value;
            <span class="hljs-built_in">console</span>.log(ipfsContent);
          }}&gt;提交到IPFS&lt;/button&gt;

          &lt;p&gt;{<span class="hljs-keyword">this</span>.state.strHash}&lt;/p&gt;

          &lt;button onClick={<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'从ipfs读取数据。'</span>)
           }}&gt;读取数据&lt;/button&gt;
           &lt;h1&gt;{<span class="hljs-keyword">this</span>.state.strContent}&lt;/h1&gt;
        &lt;/div&gt;
      );
    }
}

<span class="hljs-reserved">export</span> <span class="hljs-reserved">default</span> App;</code></pre> 
  <p>上面的代码完成的工作是，当我们在输入框中输入一个字符串时，点击<strong>提交到IPFS</strong>按钮，将文本框中的内容取出来打印，后续我们需要将这个数据上传到<code>IPFS</code>。点击<strong>读取数据</strong>按钮，我们也只是随便打印了一个字符串，后面需要从IPFS读取数据，然后将读取的数据存储到状态机变量<code>strContent</code>中并且展示出来。</p> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/ipfs-http-ui.gif" alt="" title=""></p> 
  <h3 id="37-导入ipfs">3.7 导入IPFS</h3> 
  <pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-keyword">const</span> ipfsAPI = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ipfs-api'</span>);
<span class="hljs-keyword">const</span> ipfs = ipfsAPI({host: <span class="hljs-string">'localhost'</span>, port: <span class="hljs-string">'5001'</span>, protocol: <span class="hljs-string">'http'</span>});</code></pre> 
  <h3 id="38-编写上传大文本字符串到ipfs的promise函数">3.8 编写上传大文本字符串到IPFS的Promise函数</h3> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-function"><span class="hljs-title">saveTextBlobOnIpfs</span> = <span class="hljs-params">(blob)</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise(<span class="hljs-reserved">function</span>(resolve, reject) {
      <span class="hljs-reserved">const</span> descBuffer = Buffer.from(blob, <span class="hljs-string">'utf-8'</span>);
      ipfs.add<span class="hljs-function"><span class="hljs-params">(descBuffer)</span>.<span class="hljs-title">then</span><span class="hljs-params">((response) =&gt; { <span class="hljs-built_in">console</span>.log(response) resolve(response[<span class="hljs-number">0</span>].hash); })</span>.<span class="hljs-title">catch</span><span class="hljs-params">((err) =&gt; { <span class="hljs-built_in">console</span>.error(err) reject(err); })</span> }) }</span></code></pre> 
  <p><code>response[0].hash</code>返回的是数据上传到<code>IPFS</code>后返回的<code>HASH</code>字符串。</p> 
  <h3 id="39-上传数据到ipfs">3.9 上传数据到IPFS</h3> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-keyword">this</span>.saveTextBlobOnIpfs<span class="hljs-function"><span class="hljs-params">(ipfsContent)</span>.<span class="hljs-title">then</span><span class="hljs-params">((hash) =&gt; { <span class="hljs-built_in">console</span>.log(hash); <span class="hljs-keyword">this</span>.setState({strHash: hash}); })</span>;</span></code></pre> 
  <p><code>ipfsContent</code>是从文本框中取到的数据，调用<code>this.saveTextBlobOnIpfs</code>方法将数据上传后，会返回字符串<code>hash</code>，并且将<code>hash</code>存储到状态机变量<code>strHash</code>中。</p> 
  <p><strong>目前完整的代码：</strong></p> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-reserved">import</span> React, {Component} from <span class="hljs-string">'react'</span>;
<span class="hljs-reserved">import</span> <span class="hljs-string">'./App.css'</span>;

<span class="hljs-reserved">const</span> ipfsAPI = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ipfs-api'</span>);
<span class="hljs-reserved">const</span> ipfs = ipfsAPI({<span class="hljs-attribute">host</span>: <span class="hljs-string">'localhost'</span>, <span class="hljs-attribute">port</span>: <span class="hljs-string">'5001'</span>, <span class="hljs-attribute">protocol</span>: <span class="hljs-string">'http'</span>});

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> {</span>

  constructor(props) {
    <span class="hljs-keyword">super</span>(props);
    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attribute">strHash</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attribute">strContent</span>: <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-function"><span class="hljs-title">saveTextBlobOnIpfs</span> = <span class="hljs-params">(blob)</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise(<span class="hljs-reserved">function</span>(resolve, reject) {
      <span class="hljs-reserved">const</span> descBuffer = Buffer.from(blob, <span class="hljs-string">'utf-8'</span>);
      ipfs.add<span class="hljs-function"><span class="hljs-params">(descBuffer)</span>.<span class="hljs-title">then</span><span class="hljs-params">((response) =&gt; { <span class="hljs-built_in">console</span>.log(response) resolve(response[<span class="hljs-number">0</span>].hash); })</span>.<span class="hljs-title">catch</span><span class="hljs-params">((err) =&gt; { <span class="hljs-built_in">console</span>.error(err) reject(err); })</span> }) } <span class="hljs-title">render</span><span class="hljs-params">()</span> { <span class="hljs-title">return</span> <span class="hljs-params">(&lt;div className=<span class="hljs-string">"App"</span>&gt; &lt;input ref=<span class="hljs-string">"ipfsContent"</span> style={{ width: <span class="hljs-number">200</span>, height: <span class="hljs-number">40</span>, borderWidth: <span class="hljs-number">2</span> }}/&gt; &lt;button onClick={() =&gt; { <span class="hljs-reserved">let</span> ipfsContent = <span class="hljs-keyword">this</span>.refs.ipfsContent.value; <span class="hljs-built_in">console</span>.log(ipfsContent); <span class="hljs-keyword">this</span>.saveTextBlobOnIpfs(ipfsContent).<span class="hljs-keyword">then</span>((hash) =&gt; { <span class="hljs-built_in">console</span>.log(hash); <span class="hljs-keyword">this</span>.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{<span class="hljs-keyword">this</span>.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'从ipfs读取数据。'</span>) }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{<span class="hljs-keyword">this</span>.state.strContent}&lt;/h1&gt; &lt;/div&gt;)</span>; } } <span class="hljs-title">export</span> <span class="hljs-title">default</span> <span class="hljs-title">App</span>;</span></code></pre> 
  <p><strong>测试：</strong></p> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/baocuole--.gif" alt="" title=""></p> 
  <h3 id="310-跨域资源共享cors配置">3.10 跨域资源共享CORS配置</h3> 
  <p>跨域资源共享<code>( CORS )</code>配置，依次在终端执行下面的代码：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config <span class="hljs-subst">--</span>json API<span class="hljs-built_in">.</span>HTTPHeaders<span class="hljs-built_in">.</span>Access<span class="hljs-attribute">-Control</span><span class="hljs-attribute">-Allow</span><span class="hljs-attribute">-Methods</span> <span class="hljs-string">'["PUT", "GET", "POST", "OPTIONS"]'</span>

localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config <span class="hljs-subst">--</span>json API<span class="hljs-built_in">.</span>HTTPHeaders<span class="hljs-built_in">.</span>Access<span class="hljs-attribute">-Control</span><span class="hljs-attribute">-Allow</span><span class="hljs-attribute">-Origin</span> <span class="hljs-string">'["*"]'</span>

localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config <span class="hljs-subst">--</span>json API<span class="hljs-built_in">.</span>HTTPHeaders<span class="hljs-built_in">.</span>Access<span class="hljs-attribute">-Control</span><span class="hljs-attribute">-Allow</span><span class="hljs-attribute">-Credentials</span> <span class="hljs-string">'["true"]'</span>

localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config <span class="hljs-subst">--</span>json API<span class="hljs-built_in">.</span>HTTPHeaders<span class="hljs-built_in">.</span>Access<span class="hljs-attribute">-Control</span><span class="hljs-attribute">-Allow</span><span class="hljs-attribute">-Headers</span> <span class="hljs-string">'["Authorization"]'</span>

localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config <span class="hljs-subst">--</span>json API<span class="hljs-built_in">.</span>HTTPHeaders<span class="hljs-built_in">.</span>Access<span class="hljs-attribute">-Control</span><span class="hljs-attribute">-Expose</span><span class="hljs-attribute">-Headers</span> <span class="hljs-string">'["Location"]'</span></code></pre> 
  <p><code>用正确的端口运行daemon：</code></p> 
  <pre class="prettyprint"><code class=" hljs lasso">localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config Addresses<span class="hljs-built_in">.</span>API
/ip4/<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>/tcp/<span class="hljs-number">5001</span>
localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs config Addresses<span class="hljs-built_in">.</span>API /ip4/<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>/tcp/<span class="hljs-number">5001</span>
localhost:ipfs<span class="hljs-attribute">-http</span><span class="hljs-attribute">-demo</span> yuechunli$ ipfs daemon</code></pre> 
  <h3 id="311-再次刷新网页提交数据并在线查看数据">3.11 再次刷新网页提交数据并在线查看数据</h3> 
  <ul> 
   <li>上传数据，并且查看返回hash值</li> 
  </ul> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/huoquhash.gif" alt="" title=""></p> 
  <ul> 
   <li>在线查看上传到IPFS的数据</li> 
  </ul> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/zaixianchakanhash.gif" alt="" title=""></p> 
  <h3 id="312-从ipfs读取数据">3.12 从IPFS读取数据</h3> 
  <ul> 
   <li><code>ipfs.cat</code></li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs coffeescript">ipfs.cat<span class="hljs-function"><span class="hljs-params">(<span class="hljs-keyword">this</span>.state.strHash)</span>.<span class="hljs-title">then</span><span class="hljs-params">((stream) =&gt; { <span class="hljs-built_in">console</span>.log(stream); <span class="hljs-reserved">let</span> strContent = Utf8ArrayToStr(stream); <span class="hljs-built_in">console</span>.log(strContent); <span class="hljs-keyword">this</span>.setState({strContent: strContent}); })</span>;</span></code></pre> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/Snip20171123_6.png" alt="" title=""></p> 
  <p><code>stream</code>为<code>Uint8Array</code>类型的数据，下面的方法是将<code>Uint8Array</code>转换为<code>string</code>字符串。</p> 
  <ul> 
   <li><code>Utf8ArrayToStr</code></li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Utf8ArrayToStr</span><span class="hljs-params">(array)</span> {</span>
    <span class="hljs-keyword">var</span> out, i, len, c;
    <span class="hljs-keyword">var</span> char2, char3;

    out = <span class="hljs-string">""</span>;
    len = <span class="hljs-keyword">array</span>.length;
    i = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(i &lt; len) {
    c = <span class="hljs-keyword">array</span>[i++];
    <span class="hljs-keyword">switch</span>(c &gt;&gt; <span class="hljs-number">4</span>)
      {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
          <span class="hljs-comment">// 0xxxxxxx</span>
          out += String.fromCharCode(c);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>: <span class="hljs-keyword">case</span> <span class="hljs-number">13</span>:
          <span class="hljs-comment">// 110x xxxx 10xx xxxx</span>
          char2 = <span class="hljs-keyword">array</span>[i++];
          out += String.fromCharCode(((c &amp; <span class="hljs-number">0x1F</span>) &lt;&lt; <span class="hljs-number">6</span>) | (char2 &amp; <span class="hljs-number">0x3F</span>));
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">14</span>:
          <span class="hljs-comment">// 1110 xxxx 10xx xxxx 10xx xxxx</span>
          char2 = <span class="hljs-keyword">array</span>[i++];
          char3 = <span class="hljs-keyword">array</span>[i++];
          out += String.fromCharCode(((c &amp; <span class="hljs-number">0x0F</span>) &lt;&lt; <span class="hljs-number">12</span>) |
                         ((char2 &amp; <span class="hljs-number">0x3F</span>) &lt;&lt; <span class="hljs-number">6</span>) |
                         ((char3 &amp; <span class="hljs-number">0x3F</span>) &lt;&lt; <span class="hljs-number">0</span>));
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
          <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">return</span> out;
}</code></pre> 
  <ul> 
   <li>完整源码</li> 
  </ul> 
  <pre class="prettyprint"><code class=" hljs coffeescript"><span class="hljs-reserved">import</span> React, {Component} from <span class="hljs-string">'react'</span>;
<span class="hljs-reserved">import</span> <span class="hljs-string">'./App.css'</span>;

<span class="hljs-reserved">const</span> ipfsAPI = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ipfs-api'</span>);
<span class="hljs-reserved">const</span> ipfs = ipfsAPI({<span class="hljs-attribute">host</span>: <span class="hljs-string">'localhost'</span>, <span class="hljs-attribute">port</span>: <span class="hljs-string">'5001'</span>, <span class="hljs-attribute">protocol</span>: <span class="hljs-string">'http'</span>});

<span class="hljs-reserved">function</span> Utf8ArrayToStr(array) {
  <span class="hljs-reserved">var</span> out,
    i,
    len,
    c;
  <span class="hljs-reserved">var</span> char2,
    char3;

  out = <span class="hljs-string">""</span>;
  len = array.length;
  i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (i &lt; len) {
    c = array[i++];
    <span class="hljs-keyword">switch</span> (c &gt;&gt; <span class="hljs-number">4</span>) {
      <span class="hljs-reserved">case</span> <span class="hljs-number">0</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">1</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">2</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">3</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">4</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">5</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">6</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">7</span>:
        <span class="hljs-regexp">//</span> <span class="hljs-number">0</span>xxxxxxx
        out += String.fromCharCode(c);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-reserved">case</span> <span class="hljs-number">12</span>:
      <span class="hljs-reserved">case</span> <span class="hljs-number">13</span>:
        <span class="hljs-regexp">//</span> <span class="hljs-number">110</span>x xxxx   <span class="hljs-number">10</span>xx xxxx
        char2 = array[i++];
        out += String.fromCharCode(((c &amp; <span class="hljs-number">0x1F</span>) &lt;&lt; <span class="hljs-number">6</span>) | (char2 &amp; <span class="hljs-number">0x3F</span>));
        <span class="hljs-keyword">break</span>;
      <span class="hljs-reserved">case</span> <span class="hljs-number">14</span>:
        <span class="hljs-regexp">//</span> <span class="hljs-number">1110</span> xxxx  <span class="hljs-number">10</span>xx xxxx  <span class="hljs-number">10</span>xx xxxx
        char2 = array[i++];
        char3 = array[i++];
        out += String.fromCharCode(((c &amp; <span class="hljs-number">0x0F</span>) &lt;&lt; <span class="hljs-number">12</span>) | ((char2 &amp; <span class="hljs-number">0x3F</span>) &lt;&lt; <span class="hljs-number">6</span>) | ((char3 &amp; <span class="hljs-number">0x3F</span>) &lt;&lt; <span class="hljs-number">0</span>));
        <span class="hljs-keyword">break</span>;
      <span class="hljs-attribute">default</span>:
        <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-keyword">return</span> out;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> {</span>

  constructor(props) {
    <span class="hljs-keyword">super</span>(props);
    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attribute">strHash</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attribute">strContent</span>: <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-function"><span class="hljs-title">saveTextBlobOnIpfs</span> = <span class="hljs-params">(blob)</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise(<span class="hljs-reserved">function</span>(resolve, reject) {
      <span class="hljs-reserved">const</span> descBuffer = Buffer.from(blob, <span class="hljs-string">'utf-8'</span>);
      ipfs.add<span class="hljs-function"><span class="hljs-params">(descBuffer)</span>.<span class="hljs-title">then</span><span class="hljs-params">((response) =&gt; { <span class="hljs-built_in">console</span>.log(response) resolve(response[<span class="hljs-number">0</span>].hash); })</span>.<span class="hljs-title">catch</span><span class="hljs-params">((err) =&gt; { <span class="hljs-built_in">console</span>.error(err) reject(err); })</span> }) } <span class="hljs-title">render</span><span class="hljs-params">()</span> { <span class="hljs-title">return</span> <span class="hljs-params">(&lt;div className=<span class="hljs-string">"App"</span>&gt; &lt;input ref=<span class="hljs-string">"ipfsContent"</span> style={{ width: <span class="hljs-number">200</span>, height: <span class="hljs-number">40</span>, borderWidth: <span class="hljs-number">2</span> }}/&gt; &lt;button onClick={() =&gt; { <span class="hljs-reserved">let</span> ipfsContent = <span class="hljs-keyword">this</span>.refs.ipfsContent.value; <span class="hljs-built_in">console</span>.log(ipfsContent); <span class="hljs-keyword">this</span>.saveTextBlobOnIpfs(ipfsContent).<span class="hljs-keyword">then</span>((hash) =&gt; { <span class="hljs-built_in">console</span>.log(hash); <span class="hljs-keyword">this</span>.setState({strHash: hash}); }); }}&gt;提交到IPFS&lt;/button&gt; &lt;p&gt;{<span class="hljs-keyword">this</span>.state.strHash}&lt;/p&gt; &lt;button onClick={() =&gt; { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'从ipfs读取数据。'</span>) ipfs.cat(<span class="hljs-keyword">this</span>.state.strHash).<span class="hljs-keyword">then</span>((stream) =&gt; { <span class="hljs-built_in">console</span>.log(stream); <span class="hljs-reserved">let</span> strContent = Utf8ArrayToStr(stream); <span class="hljs-built_in">console</span>.log(strContent); <span class="hljs-keyword">this</span>.setState({strContent: strContent}); }); }}&gt;读取数据&lt;/button&gt; &lt;h1&gt;{<span class="hljs-keyword">this</span>.state.strContent}&lt;/h1&gt; &lt;/div&gt;)</span>; } } <span class="hljs-title">export</span> <span class="hljs-title">default</span> <span class="hljs-title">App</span>;</span></code></pre> 
  <h3 id="313-总结">3.13 总结</h3> 
  <p>这篇文章主要讲解如何配置React环境，如何创建React项目，如何安装<code>js-ipfs-api</code>，如何上传数据，如何设置开发环境，如何下载数据等等内容。通过这篇文章的系统学习，你会掌握<code>js-ipfs-api</code>在项目中的使用流程。</p> 
  <p>这是<code>【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api</code>，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。</p> 
  <h2 id="4-下篇文章预告">4. 下篇文章预告</h2> 
  <p>这是<code>【IPFS + 区块链 系列】 入门篇 - IPFS + Ethereum （上篇）-js-ipfs-api</code>，下篇讲解如何将IPFS和以太坊智能合约结合进行数据存储。</p> 
  <h2 id="5-技术交流">5. 技术交流</h2> 
  <ul> 
   <li>区块链技术交流QQ群：<code>348924182</code></li> 
   <li>进微信群请加微信：<code>liyc1215</code></li> 
   <li>「区块链部落」官方公众号</li> 
  </ul> 
  <p><img src="http://om1c35wrq.bkt.clouddn.com/%E5%8C%BA%E5%9D%97%E9%93%BE%E9%83%A8%E8%90%BD.png" alt="" title=""></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/liyuechun520/article/details/78620774,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/liyuechun520/article/details/78620774,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

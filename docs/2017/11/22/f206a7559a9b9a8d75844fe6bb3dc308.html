<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>WooCommerce接入支付宝支付功能（一）——创建应用以及请求支付 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="WooCommerce接入支付宝支付功能（一）——创建应用以及请求支付" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="采用WordPress搭建的网站，并使用WooCommerce插件，现在需要接入支付宝支付功能。 1. 创建应用 1.1 登录 使用支付宝账号登录开放平台： 1.2 创建应用 登录之后是如下界面： 开发文档中说“根据实际需求创建应用（如”支付应用“）”，我在这个页面没看到这一项，只有“支付接入”、“自定义接入”、“商业零售”、“交通出行”、“政务民生”、“医疗教育”这几项。不知道这几项的具体含义。暂时先选择“支付接入”吧！ 这里要求选择“使用场景”，有第三方法应用和自用型应用两个选项，第一个是指开发出来给别人用的，第二个是指开发给自己用的。选择自用型，填入应用名称后，跳转到下面的页面： 这个页面包含基础信息、功能选项、开发配置三块。上面的图只截取到了前两块。 1.2.1 基础信息 基础信息中有应用名称和应用图标。应用名称之前已经填过了，现在上传自己的应用图标就行了。应用基础信息在开发应用过程中可以无需审核随时完善。但在应用申请上线时需要进行审核。 1.2.2 功能选项 功能选项模块中包含各种功能，你可以选择自己需要的功能添加到功能列表中，现在默认添加了当面付、手机网站支付、APP支付功能。不同的功能有不同的使用条件，如果某个功能的使用条件是签约，那么在使用此项功能之前，需要签约对应产品。点击“+ 继续添加”，跳到添加功能页面，这里有非常多的功能供选择： 添加了“电脑网站支付”功能。 1.2.3 开发配置 支付宝网关：已有默认值。 应用网关：用于接收支付宝异步通知，这里可以不用设置。 授权回调地址：第三方授权或者用户信息授权后回调地址。授权链接中配置的redirect_uri值必须与此值保持一致。 RSA2(SHA256)密钥(推荐)：开发者要保证接口中使用的秘钥与此处的公钥匹配，否则无法调用接口。接口参数sign_type=RSA2。 RSA(SHA1)密钥：同上，接口参数为sign_type=RSA。 对接口加签方式中的“设置应用公钥”进行设置，会弹出如下窗口： 选择设置应用公钥后弹出下面窗口： 填写校验码后，弹出窗口： 这个框框里面需要填入商户自己的公钥。简单介绍一下商户公钥、商户私钥和支付宝公钥的概念： 商户应用公钥：商户自己生成的RSA公钥，生成之后需要上传公钥到支付宝开放平台以便支付宝使用该公钥验证交易是否由该商户发起的； 商户应用私钥：商户自己生成的RSA私钥，商户开发者使用生成的私钥对请求字符串进行加签； 支付宝公钥：支付宝的RSA公钥，商户使用该公钥验证结果是否由支付宝返回的。 生成商户应用私钥和应用公钥： 点击右边的链接：https://docs.open.alipay.com/291/105971，这里介绍了生成商户RSA密钥的方法。根据指导，生成了应用公钥2048.txt和应用私钥2048.txt两个文件。生成的私钥一定要妥善保管。私钥需要填写到代码中供签名时使用；公钥需要上传到支付宝开放平台。 上传商户应用公钥到支付宝平台： 把应用公钥2048.txt中的内容复制粘贴到前面的框框中。然后保存，弹出如下窗口： 现在在RSA2(SHA256)密钥(推荐)右边如下： 可以看到，除了商户的应用公钥之外，还有支付宝公钥。 可以随时修改应用公钥。 使用应用私钥生成请求签名 把AppID、应用私钥、支付宝公钥配置在代码中，对请求内容进行签名，并对支付宝返回的内容进行验签。 支付宝开放平台SDK封装了签名和验签过程，只需配置账号和密钥参数即可，推荐使用SDK。这个在开发过程中会介绍。 创建应用时的应用状态为“开发中”，无法在线上正式调用接口。按照上面的步骤设置好后，提交审核。 2 开发 应用审核通过后，变成已上线状态。现在我们可以尝试开发支付宝网站接口了。 2.1 下载服务端SDK 为了帮助开发者调用开放接口，支付宝开放平台提供了“开放平台服务端SDK”，包含JAVA、PHP和.NET三个版本，封装了签名&amp;验签、HTTP接口请求等基础功能。 https://docs.open.alipay.com/54/103419，选择你熟悉的语言的SDK。我下载的是PHP版本的。这个页面中有关于各语言版本SDK的详细使用说明，可以仔细阅读一遍。 将下载的alipay-sdk-PHP-20171121170331.zip解压到项目目录中去，比如项目文件夹为alipay/，那么解压后的SDK为alipay/alipay-sdk-PHP-20171121170331/。 2.2 接口调用配置 在SDK调用前需要进行初始化，代码如下： require_once(&quot;alipay-sdk-PHP-20171121170331/AopSdk.php&quot;); //构造参数 $aop = new AopClient (); $aop-&gt;gatewayUrl = &#39;https://openapi.alipay.com/gateway.do&#39;; // 向这个网址发送支付、退款、查询等请求 $aop-&gt;appId = &#39;请填写APPID&#39;; $aop-&gt;rsaPrivateKey = &#39;请填写商户私钥&#39;; $aop-&gt;apiVersion = &#39;1.0&#39;; $aop-&gt;signType = &#39;RSA2&#39;; // 对字符串进行前ing时使用的签名算法类型 $aop-&gt;postCharset= &#39;utf-8&#39;; $aop-&gt;format=&#39;json&#39;; 接下来，就可以用$aop来调用具体的API了。$aop只需要初始化一次，后续调用不同的API都可以使用同一个$aop对象。 2.3 向支付宝发送支付请求 通过向支付宝网关发送alipay.trade.page.pay请求进行支付。 $request = new AlipayTradePagePayRequest (); $request-&gt;setReturnUrl(&#39;请填写您的页面同步跳转地址&#39;); // 在支付完成之后，支付宝服务器会跳转到这个页面，同时GET方式传送支付结果参数 $request-&gt;setNotifyUrl(&#39;请填写您的异步通知地址&#39;); // 支付完成后，支付宝服务器会向这个网址发送异步通知消息，支付结果必须以异步通知为准，不能依赖同步跳转 $request-&gt;setBizContent(&#39;{&quot;product_code&quot;:&quot;FAST_INSTANT_TRADE_PAY&quot;,&quot;out_trade_no&quot;:&quot;20150320010101001&quot;,&quot;subject&quot;:&quot;Iphone6 16G&quot;,&quot;total_amount&quot;:&quot;88.88&quot;,&quot;body&quot;:&quot;Iphone6 16G&quot;}&#39;); // 请求 $result = $aop-&gt;pageExecute ($request); // $resule是一个表单 // 输出 echo $result; 报文请求时会自动用应用私钥进行签名；支付宝收到请求之后，首先用应用公钥对请求参数验签，然后返回表单$result，打印这个表单会把用户重定向到支付页面。 请求返回的结果$result的内容如下： &lt;form id=&#39;alipaysubmit&#39; name=&#39;alipaysubmit&#39; action=&#39;https://openapi.alipaydev.com/gateway.do?charset=UTF-8&#39; method=&#39;POST&#39;&gt;&lt;input type=&#39;hidden&#39; name=&#39;biz_content&#39; value=&#39;{&quot;product_code&quot;:&quot;FAST_INSTANT_TRADE_PAY&quot;,&quot;body&quot;:&quot;hah&quot;,&quot;subject&quot;:&quot;测试&quot;,&quot;total_amount&quot;:&quot;0.01&quot;,&quot;out_trade_no&quot;:&quot;201711279339773&quot;}&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;app_id&#39; value=&#39;2016090800411111&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;version&#39; value=&#39;1.0&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;format&#39; value=&#39;json&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;sign_type&#39; value=&#39;RSA2&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;method&#39; value=&#39;alipay.trade.page.pay&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;timestamp&#39; value=&#39;2017-11-27 10:26:48&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;alipay_sdk&#39; value=&#39;alipay-sdk-php-20161101&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;notify_url&#39; value=&#39;http://www.example.com&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;return_url&#39; value=&#39;http://www.example.com&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;charset&#39; value=&#39;UTF-8&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;sign&#39; value=&#39;nZG55zzL2PtHywMt0z93uCx+1W3JSo9tUk8AM32N2fvzeeapg6g55nVjGmdGRrSLDQzYibEP3imOqmS6I5u9e222v8BeZKPtZJUb4GMrvot0NXVSqRRDi/kmyURAI7d8+8wkpgQP3mEKg9YM4JddcWYQRFdM6W0kzKPd2N+hThjdchJ30wwwDtCAgZNs916t3YTW18ZTDxSSjDCHDDPd065PkUwNmLc1YwvumS+dKVEVDAy2/gcUjAyFTQx1A9fYW2kibyp2ohGQbjksogTEgOKE2yIuLVZWMTMcZ5k2en826OWV47UmKH07NzCjhqI45Wrkg8sXoY1mUZdvnXUvRQ==&#39;/&gt;&lt;input type=&#39;submit&#39; value=&#39;ok&#39; style=&#39;display:none;&#39;&#39;&gt;&lt;/form&gt;&lt;script&gt;document.forms[&#39;alipaysubmit&#39;].submit();&lt;/script&gt; 当用户付过钱后，会跳转到设置的return url中，并以GET方式返回支付结果参数。 2.4 处理异步通知 由于同步返回的不可靠性，支付结果必须以异步通知或查询接口返回为准，不能依赖同步跳转。 2.4.1 验签 支付成功后，支付宝除了向return url发送同步通知外，还会以POST方式向notify url发送异步通知。商户系统受到异步通知后，首先需要用支付宝公钥进行验签，确定消息是否来自支付宝。SDK中封装了验签接口。 $arr = $_POST; $arr[&#39;fund_bill_list&#39;] = stripslashes($arr[&#39;fund_bill_list&#39;]); $aop = new AopClient(); $aop-&gt;alipayrsaPublicKey = &#39;支付宝公钥&#39;; $signtype = &#39;RSA2&#39; $flag = $aop-&gt;rsaCheckV1($arr, &#39;支付宝公钥&#39;, $signtype); if ($flag) { //验签成功 // 进行通知数据的二次检验 // 根据交易状态进行商户的自身业务 echo &#39;success&#39;; } else { // 验签失败，记录异常日志 echo &#39;fail&#39;; } 刚开始的时候，出现了验签失败的结果。后来在网上搜了一下，发现这是因为PHP自动将fund_bill_list中的特殊字符前加了转义符，需要把转义字符去掉才行。所以如果验签没通过，不妨加上$arr[&#39;fund_bill_list&#39;] = stripslashes($arr[&#39;fund_bill_list&#39;]);试试。 2.4.2 二次检验 验签通过后，需要按照以下步骤检验数据的正确性： 1、商户需要验证该通知数据中的out_trade_no是否为商户系统中创建的订单号； 2、判断total_amount是否确实为该订单的实际金额（即商户订单创建时的金额）； 3、校验通知中的seller_id（或者seller_email) 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）； 4、验证app_id是否为该商户本身。 上述1、2、3、4有任何一个验证不通过，则表明本次通知是异常通知，务必忽略。 在上述验证通过后商户必须根据支付宝不同类型的业务通知，正确的进行不同的业务处理，并且过滤重复的通知结果数据。在支付宝的业务通知中，只有交易通知状态为TRADE_SUCCESS或TRADE_FINISHED时，支付宝才会认定为买家付款成功。 注意： 状态TRADE_SUCCESS的通知触发条件是商户签约的产品支持退款功能的前提下，买家付款成功； 交易状态TRADE_FINISHED的通知触发条件是商户签约的产品不支持退款功能的前提下，买家付款成功；或者，商户签约的产品支持退款功能的前提下，交易已经成功并且已经超过可退款期限。 2.4.3 继续商户自身的业务逻辑 在验签、二次校通过后，根据trade_status进行后续业务处理。 // 交易状态 $trade_status = $_POST[&#39;trade_status&#39;]; if($trade_status == &#39;TRADE_FINISHED&#39; || $trade_status==&#39;TRADE_SUCCESS&#39;) { // 判断该订单是否在商户网站中已经做过处理，如果没有的话执行商户的业务程序 } 3 问题集锦 1. 调试错误，请回到请求来源地，重新发起请求。 错误代码 missing-signature 错误原因: 缺少签名参数 解答： 这是因为alipay.trade.page.pay请求结果里面没有sign，为什么呢？https://openclub.alipay.com/read.php?tid=2333&amp;fid=46给出了原因。 php环境必须5.5以上，而现在的服务器上通过php -v命令查看，版本是PHP 5.3.28。升级之后这个问题解决了。 2. 支付请求提交后，返回“订单信息无法识别，建议联系卖家”的错误提示？ 解答： $request-&gt;setBizContent();中每个参数值都应该是字符串，比如&#39;&quot;&#39; . $value1 . &#39;&quot;&#39;。 下一篇：WooCommerce接入支付宝支付功能（二）——WooCommerce中添加新的支付网关 参考 [1] 电脑网站支付快速接入 [2] 创建应用 [3] 生成RSA密钥 [4] 上传应用公钥并获取支付宝公钥 [5] 使用应用私钥生成请求签名 [6] 服务端SDK [7] alipay.trade.page.pay [8] 电脑网站支付结果异步通知 阅读更多" />
<meta property="og:description" content="采用WordPress搭建的网站，并使用WooCommerce插件，现在需要接入支付宝支付功能。 1. 创建应用 1.1 登录 使用支付宝账号登录开放平台： 1.2 创建应用 登录之后是如下界面： 开发文档中说“根据实际需求创建应用（如”支付应用“）”，我在这个页面没看到这一项，只有“支付接入”、“自定义接入”、“商业零售”、“交通出行”、“政务民生”、“医疗教育”这几项。不知道这几项的具体含义。暂时先选择“支付接入”吧！ 这里要求选择“使用场景”，有第三方法应用和自用型应用两个选项，第一个是指开发出来给别人用的，第二个是指开发给自己用的。选择自用型，填入应用名称后，跳转到下面的页面： 这个页面包含基础信息、功能选项、开发配置三块。上面的图只截取到了前两块。 1.2.1 基础信息 基础信息中有应用名称和应用图标。应用名称之前已经填过了，现在上传自己的应用图标就行了。应用基础信息在开发应用过程中可以无需审核随时完善。但在应用申请上线时需要进行审核。 1.2.2 功能选项 功能选项模块中包含各种功能，你可以选择自己需要的功能添加到功能列表中，现在默认添加了当面付、手机网站支付、APP支付功能。不同的功能有不同的使用条件，如果某个功能的使用条件是签约，那么在使用此项功能之前，需要签约对应产品。点击“+ 继续添加”，跳到添加功能页面，这里有非常多的功能供选择： 添加了“电脑网站支付”功能。 1.2.3 开发配置 支付宝网关：已有默认值。 应用网关：用于接收支付宝异步通知，这里可以不用设置。 授权回调地址：第三方授权或者用户信息授权后回调地址。授权链接中配置的redirect_uri值必须与此值保持一致。 RSA2(SHA256)密钥(推荐)：开发者要保证接口中使用的秘钥与此处的公钥匹配，否则无法调用接口。接口参数sign_type=RSA2。 RSA(SHA1)密钥：同上，接口参数为sign_type=RSA。 对接口加签方式中的“设置应用公钥”进行设置，会弹出如下窗口： 选择设置应用公钥后弹出下面窗口： 填写校验码后，弹出窗口： 这个框框里面需要填入商户自己的公钥。简单介绍一下商户公钥、商户私钥和支付宝公钥的概念： 商户应用公钥：商户自己生成的RSA公钥，生成之后需要上传公钥到支付宝开放平台以便支付宝使用该公钥验证交易是否由该商户发起的； 商户应用私钥：商户自己生成的RSA私钥，商户开发者使用生成的私钥对请求字符串进行加签； 支付宝公钥：支付宝的RSA公钥，商户使用该公钥验证结果是否由支付宝返回的。 生成商户应用私钥和应用公钥： 点击右边的链接：https://docs.open.alipay.com/291/105971，这里介绍了生成商户RSA密钥的方法。根据指导，生成了应用公钥2048.txt和应用私钥2048.txt两个文件。生成的私钥一定要妥善保管。私钥需要填写到代码中供签名时使用；公钥需要上传到支付宝开放平台。 上传商户应用公钥到支付宝平台： 把应用公钥2048.txt中的内容复制粘贴到前面的框框中。然后保存，弹出如下窗口： 现在在RSA2(SHA256)密钥(推荐)右边如下： 可以看到，除了商户的应用公钥之外，还有支付宝公钥。 可以随时修改应用公钥。 使用应用私钥生成请求签名 把AppID、应用私钥、支付宝公钥配置在代码中，对请求内容进行签名，并对支付宝返回的内容进行验签。 支付宝开放平台SDK封装了签名和验签过程，只需配置账号和密钥参数即可，推荐使用SDK。这个在开发过程中会介绍。 创建应用时的应用状态为“开发中”，无法在线上正式调用接口。按照上面的步骤设置好后，提交审核。 2 开发 应用审核通过后，变成已上线状态。现在我们可以尝试开发支付宝网站接口了。 2.1 下载服务端SDK 为了帮助开发者调用开放接口，支付宝开放平台提供了“开放平台服务端SDK”，包含JAVA、PHP和.NET三个版本，封装了签名&amp;验签、HTTP接口请求等基础功能。 https://docs.open.alipay.com/54/103419，选择你熟悉的语言的SDK。我下载的是PHP版本的。这个页面中有关于各语言版本SDK的详细使用说明，可以仔细阅读一遍。 将下载的alipay-sdk-PHP-20171121170331.zip解压到项目目录中去，比如项目文件夹为alipay/，那么解压后的SDK为alipay/alipay-sdk-PHP-20171121170331/。 2.2 接口调用配置 在SDK调用前需要进行初始化，代码如下： require_once(&quot;alipay-sdk-PHP-20171121170331/AopSdk.php&quot;); //构造参数 $aop = new AopClient (); $aop-&gt;gatewayUrl = &#39;https://openapi.alipay.com/gateway.do&#39;; // 向这个网址发送支付、退款、查询等请求 $aop-&gt;appId = &#39;请填写APPID&#39;; $aop-&gt;rsaPrivateKey = &#39;请填写商户私钥&#39;; $aop-&gt;apiVersion = &#39;1.0&#39;; $aop-&gt;signType = &#39;RSA2&#39;; // 对字符串进行前ing时使用的签名算法类型 $aop-&gt;postCharset= &#39;utf-8&#39;; $aop-&gt;format=&#39;json&#39;; 接下来，就可以用$aop来调用具体的API了。$aop只需要初始化一次，后续调用不同的API都可以使用同一个$aop对象。 2.3 向支付宝发送支付请求 通过向支付宝网关发送alipay.trade.page.pay请求进行支付。 $request = new AlipayTradePagePayRequest (); $request-&gt;setReturnUrl(&#39;请填写您的页面同步跳转地址&#39;); // 在支付完成之后，支付宝服务器会跳转到这个页面，同时GET方式传送支付结果参数 $request-&gt;setNotifyUrl(&#39;请填写您的异步通知地址&#39;); // 支付完成后，支付宝服务器会向这个网址发送异步通知消息，支付结果必须以异步通知为准，不能依赖同步跳转 $request-&gt;setBizContent(&#39;{&quot;product_code&quot;:&quot;FAST_INSTANT_TRADE_PAY&quot;,&quot;out_trade_no&quot;:&quot;20150320010101001&quot;,&quot;subject&quot;:&quot;Iphone6 16G&quot;,&quot;total_amount&quot;:&quot;88.88&quot;,&quot;body&quot;:&quot;Iphone6 16G&quot;}&#39;); // 请求 $result = $aop-&gt;pageExecute ($request); // $resule是一个表单 // 输出 echo $result; 报文请求时会自动用应用私钥进行签名；支付宝收到请求之后，首先用应用公钥对请求参数验签，然后返回表单$result，打印这个表单会把用户重定向到支付页面。 请求返回的结果$result的内容如下： &lt;form id=&#39;alipaysubmit&#39; name=&#39;alipaysubmit&#39; action=&#39;https://openapi.alipaydev.com/gateway.do?charset=UTF-8&#39; method=&#39;POST&#39;&gt;&lt;input type=&#39;hidden&#39; name=&#39;biz_content&#39; value=&#39;{&quot;product_code&quot;:&quot;FAST_INSTANT_TRADE_PAY&quot;,&quot;body&quot;:&quot;hah&quot;,&quot;subject&quot;:&quot;测试&quot;,&quot;total_amount&quot;:&quot;0.01&quot;,&quot;out_trade_no&quot;:&quot;201711279339773&quot;}&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;app_id&#39; value=&#39;2016090800411111&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;version&#39; value=&#39;1.0&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;format&#39; value=&#39;json&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;sign_type&#39; value=&#39;RSA2&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;method&#39; value=&#39;alipay.trade.page.pay&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;timestamp&#39; value=&#39;2017-11-27 10:26:48&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;alipay_sdk&#39; value=&#39;alipay-sdk-php-20161101&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;notify_url&#39; value=&#39;http://www.example.com&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;return_url&#39; value=&#39;http://www.example.com&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;charset&#39; value=&#39;UTF-8&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;sign&#39; value=&#39;nZG55zzL2PtHywMt0z93uCx+1W3JSo9tUk8AM32N2fvzeeapg6g55nVjGmdGRrSLDQzYibEP3imOqmS6I5u9e222v8BeZKPtZJUb4GMrvot0NXVSqRRDi/kmyURAI7d8+8wkpgQP3mEKg9YM4JddcWYQRFdM6W0kzKPd2N+hThjdchJ30wwwDtCAgZNs916t3YTW18ZTDxSSjDCHDDPd065PkUwNmLc1YwvumS+dKVEVDAy2/gcUjAyFTQx1A9fYW2kibyp2ohGQbjksogTEgOKE2yIuLVZWMTMcZ5k2en826OWV47UmKH07NzCjhqI45Wrkg8sXoY1mUZdvnXUvRQ==&#39;/&gt;&lt;input type=&#39;submit&#39; value=&#39;ok&#39; style=&#39;display:none;&#39;&#39;&gt;&lt;/form&gt;&lt;script&gt;document.forms[&#39;alipaysubmit&#39;].submit();&lt;/script&gt; 当用户付过钱后，会跳转到设置的return url中，并以GET方式返回支付结果参数。 2.4 处理异步通知 由于同步返回的不可靠性，支付结果必须以异步通知或查询接口返回为准，不能依赖同步跳转。 2.4.1 验签 支付成功后，支付宝除了向return url发送同步通知外，还会以POST方式向notify url发送异步通知。商户系统受到异步通知后，首先需要用支付宝公钥进行验签，确定消息是否来自支付宝。SDK中封装了验签接口。 $arr = $_POST; $arr[&#39;fund_bill_list&#39;] = stripslashes($arr[&#39;fund_bill_list&#39;]); $aop = new AopClient(); $aop-&gt;alipayrsaPublicKey = &#39;支付宝公钥&#39;; $signtype = &#39;RSA2&#39; $flag = $aop-&gt;rsaCheckV1($arr, &#39;支付宝公钥&#39;, $signtype); if ($flag) { //验签成功 // 进行通知数据的二次检验 // 根据交易状态进行商户的自身业务 echo &#39;success&#39;; } else { // 验签失败，记录异常日志 echo &#39;fail&#39;; } 刚开始的时候，出现了验签失败的结果。后来在网上搜了一下，发现这是因为PHP自动将fund_bill_list中的特殊字符前加了转义符，需要把转义字符去掉才行。所以如果验签没通过，不妨加上$arr[&#39;fund_bill_list&#39;] = stripslashes($arr[&#39;fund_bill_list&#39;]);试试。 2.4.2 二次检验 验签通过后，需要按照以下步骤检验数据的正确性： 1、商户需要验证该通知数据中的out_trade_no是否为商户系统中创建的订单号； 2、判断total_amount是否确实为该订单的实际金额（即商户订单创建时的金额）； 3、校验通知中的seller_id（或者seller_email) 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）； 4、验证app_id是否为该商户本身。 上述1、2、3、4有任何一个验证不通过，则表明本次通知是异常通知，务必忽略。 在上述验证通过后商户必须根据支付宝不同类型的业务通知，正确的进行不同的业务处理，并且过滤重复的通知结果数据。在支付宝的业务通知中，只有交易通知状态为TRADE_SUCCESS或TRADE_FINISHED时，支付宝才会认定为买家付款成功。 注意： 状态TRADE_SUCCESS的通知触发条件是商户签约的产品支持退款功能的前提下，买家付款成功； 交易状态TRADE_FINISHED的通知触发条件是商户签约的产品不支持退款功能的前提下，买家付款成功；或者，商户签约的产品支持退款功能的前提下，交易已经成功并且已经超过可退款期限。 2.4.3 继续商户自身的业务逻辑 在验签、二次校通过后，根据trade_status进行后续业务处理。 // 交易状态 $trade_status = $_POST[&#39;trade_status&#39;]; if($trade_status == &#39;TRADE_FINISHED&#39; || $trade_status==&#39;TRADE_SUCCESS&#39;) { // 判断该订单是否在商户网站中已经做过处理，如果没有的话执行商户的业务程序 } 3 问题集锦 1. 调试错误，请回到请求来源地，重新发起请求。 错误代码 missing-signature 错误原因: 缺少签名参数 解答： 这是因为alipay.trade.page.pay请求结果里面没有sign，为什么呢？https://openclub.alipay.com/read.php?tid=2333&amp;fid=46给出了原因。 php环境必须5.5以上，而现在的服务器上通过php -v命令查看，版本是PHP 5.3.28。升级之后这个问题解决了。 2. 支付请求提交后，返回“订单信息无法识别，建议联系卖家”的错误提示？ 解答： $request-&gt;setBizContent();中每个参数值都应该是字符串，比如&#39;&quot;&#39; . $value1 . &#39;&quot;&#39;。 下一篇：WooCommerce接入支付宝支付功能（二）——WooCommerce中添加新的支付网关 参考 [1] 电脑网站支付快速接入 [2] 创建应用 [3] 生成RSA密钥 [4] 上传应用公钥并获取支付宝公钥 [5] 使用应用私钥生成请求签名 [6] 服务端SDK [7] alipay.trade.page.pay [8] 电脑网站支付结果异步通知 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/11/22/f206a7559a9b9a8d75844fe6bb3dc308.html" />
<meta property="og:url" content="https://mlh.app/2017/11/22/f206a7559a9b9a8d75844fe6bb3dc308.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-22T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"采用WordPress搭建的网站，并使用WooCommerce插件，现在需要接入支付宝支付功能。 1. 创建应用 1.1 登录 使用支付宝账号登录开放平台： 1.2 创建应用 登录之后是如下界面： 开发文档中说“根据实际需求创建应用（如”支付应用“）”，我在这个页面没看到这一项，只有“支付接入”、“自定义接入”、“商业零售”、“交通出行”、“政务民生”、“医疗教育”这几项。不知道这几项的具体含义。暂时先选择“支付接入”吧！ 这里要求选择“使用场景”，有第三方法应用和自用型应用两个选项，第一个是指开发出来给别人用的，第二个是指开发给自己用的。选择自用型，填入应用名称后，跳转到下面的页面： 这个页面包含基础信息、功能选项、开发配置三块。上面的图只截取到了前两块。 1.2.1 基础信息 基础信息中有应用名称和应用图标。应用名称之前已经填过了，现在上传自己的应用图标就行了。应用基础信息在开发应用过程中可以无需审核随时完善。但在应用申请上线时需要进行审核。 1.2.2 功能选项 功能选项模块中包含各种功能，你可以选择自己需要的功能添加到功能列表中，现在默认添加了当面付、手机网站支付、APP支付功能。不同的功能有不同的使用条件，如果某个功能的使用条件是签约，那么在使用此项功能之前，需要签约对应产品。点击“+ 继续添加”，跳到添加功能页面，这里有非常多的功能供选择： 添加了“电脑网站支付”功能。 1.2.3 开发配置 支付宝网关：已有默认值。 应用网关：用于接收支付宝异步通知，这里可以不用设置。 授权回调地址：第三方授权或者用户信息授权后回调地址。授权链接中配置的redirect_uri值必须与此值保持一致。 RSA2(SHA256)密钥(推荐)：开发者要保证接口中使用的秘钥与此处的公钥匹配，否则无法调用接口。接口参数sign_type=RSA2。 RSA(SHA1)密钥：同上，接口参数为sign_type=RSA。 对接口加签方式中的“设置应用公钥”进行设置，会弹出如下窗口： 选择设置应用公钥后弹出下面窗口： 填写校验码后，弹出窗口： 这个框框里面需要填入商户自己的公钥。简单介绍一下商户公钥、商户私钥和支付宝公钥的概念： 商户应用公钥：商户自己生成的RSA公钥，生成之后需要上传公钥到支付宝开放平台以便支付宝使用该公钥验证交易是否由该商户发起的； 商户应用私钥：商户自己生成的RSA私钥，商户开发者使用生成的私钥对请求字符串进行加签； 支付宝公钥：支付宝的RSA公钥，商户使用该公钥验证结果是否由支付宝返回的。 生成商户应用私钥和应用公钥： 点击右边的链接：https://docs.open.alipay.com/291/105971，这里介绍了生成商户RSA密钥的方法。根据指导，生成了应用公钥2048.txt和应用私钥2048.txt两个文件。生成的私钥一定要妥善保管。私钥需要填写到代码中供签名时使用；公钥需要上传到支付宝开放平台。 上传商户应用公钥到支付宝平台： 把应用公钥2048.txt中的内容复制粘贴到前面的框框中。然后保存，弹出如下窗口： 现在在RSA2(SHA256)密钥(推荐)右边如下： 可以看到，除了商户的应用公钥之外，还有支付宝公钥。 可以随时修改应用公钥。 使用应用私钥生成请求签名 把AppID、应用私钥、支付宝公钥配置在代码中，对请求内容进行签名，并对支付宝返回的内容进行验签。 支付宝开放平台SDK封装了签名和验签过程，只需配置账号和密钥参数即可，推荐使用SDK。这个在开发过程中会介绍。 创建应用时的应用状态为“开发中”，无法在线上正式调用接口。按照上面的步骤设置好后，提交审核。 2 开发 应用审核通过后，变成已上线状态。现在我们可以尝试开发支付宝网站接口了。 2.1 下载服务端SDK 为了帮助开发者调用开放接口，支付宝开放平台提供了“开放平台服务端SDK”，包含JAVA、PHP和.NET三个版本，封装了签名&amp;验签、HTTP接口请求等基础功能。 https://docs.open.alipay.com/54/103419，选择你熟悉的语言的SDK。我下载的是PHP版本的。这个页面中有关于各语言版本SDK的详细使用说明，可以仔细阅读一遍。 将下载的alipay-sdk-PHP-20171121170331.zip解压到项目目录中去，比如项目文件夹为alipay/，那么解压后的SDK为alipay/alipay-sdk-PHP-20171121170331/。 2.2 接口调用配置 在SDK调用前需要进行初始化，代码如下： require_once(&quot;alipay-sdk-PHP-20171121170331/AopSdk.php&quot;); //构造参数 $aop = new AopClient (); $aop-&gt;gatewayUrl = &#39;https://openapi.alipay.com/gateway.do&#39;; // 向这个网址发送支付、退款、查询等请求 $aop-&gt;appId = &#39;请填写APPID&#39;; $aop-&gt;rsaPrivateKey = &#39;请填写商户私钥&#39;; $aop-&gt;apiVersion = &#39;1.0&#39;; $aop-&gt;signType = &#39;RSA2&#39;; // 对字符串进行前ing时使用的签名算法类型 $aop-&gt;postCharset= &#39;utf-8&#39;; $aop-&gt;format=&#39;json&#39;; 接下来，就可以用$aop来调用具体的API了。$aop只需要初始化一次，后续调用不同的API都可以使用同一个$aop对象。 2.3 向支付宝发送支付请求 通过向支付宝网关发送alipay.trade.page.pay请求进行支付。 $request = new AlipayTradePagePayRequest (); $request-&gt;setReturnUrl(&#39;请填写您的页面同步跳转地址&#39;); // 在支付完成之后，支付宝服务器会跳转到这个页面，同时GET方式传送支付结果参数 $request-&gt;setNotifyUrl(&#39;请填写您的异步通知地址&#39;); // 支付完成后，支付宝服务器会向这个网址发送异步通知消息，支付结果必须以异步通知为准，不能依赖同步跳转 $request-&gt;setBizContent(&#39;{&quot;product_code&quot;:&quot;FAST_INSTANT_TRADE_PAY&quot;,&quot;out_trade_no&quot;:&quot;20150320010101001&quot;,&quot;subject&quot;:&quot;Iphone6 16G&quot;,&quot;total_amount&quot;:&quot;88.88&quot;,&quot;body&quot;:&quot;Iphone6 16G&quot;}&#39;); // 请求 $result = $aop-&gt;pageExecute ($request); // $resule是一个表单 // 输出 echo $result; 报文请求时会自动用应用私钥进行签名；支付宝收到请求之后，首先用应用公钥对请求参数验签，然后返回表单$result，打印这个表单会把用户重定向到支付页面。 请求返回的结果$result的内容如下： &lt;form id=&#39;alipaysubmit&#39; name=&#39;alipaysubmit&#39; action=&#39;https://openapi.alipaydev.com/gateway.do?charset=UTF-8&#39; method=&#39;POST&#39;&gt;&lt;input type=&#39;hidden&#39; name=&#39;biz_content&#39; value=&#39;{&quot;product_code&quot;:&quot;FAST_INSTANT_TRADE_PAY&quot;,&quot;body&quot;:&quot;hah&quot;,&quot;subject&quot;:&quot;测试&quot;,&quot;total_amount&quot;:&quot;0.01&quot;,&quot;out_trade_no&quot;:&quot;201711279339773&quot;}&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;app_id&#39; value=&#39;2016090800411111&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;version&#39; value=&#39;1.0&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;format&#39; value=&#39;json&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;sign_type&#39; value=&#39;RSA2&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;method&#39; value=&#39;alipay.trade.page.pay&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;timestamp&#39; value=&#39;2017-11-27 10:26:48&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;alipay_sdk&#39; value=&#39;alipay-sdk-php-20161101&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;notify_url&#39; value=&#39;http://www.example.com&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;return_url&#39; value=&#39;http://www.example.com&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;charset&#39; value=&#39;UTF-8&#39;/&gt;&lt;input type=&#39;hidden&#39; name=&#39;sign&#39; value=&#39;nZG55zzL2PtHywMt0z93uCx+1W3JSo9tUk8AM32N2fvzeeapg6g55nVjGmdGRrSLDQzYibEP3imOqmS6I5u9e222v8BeZKPtZJUb4GMrvot0NXVSqRRDi/kmyURAI7d8+8wkpgQP3mEKg9YM4JddcWYQRFdM6W0kzKPd2N+hThjdchJ30wwwDtCAgZNs916t3YTW18ZTDxSSjDCHDDPd065PkUwNmLc1YwvumS+dKVEVDAy2/gcUjAyFTQx1A9fYW2kibyp2ohGQbjksogTEgOKE2yIuLVZWMTMcZ5k2en826OWV47UmKH07NzCjhqI45Wrkg8sXoY1mUZdvnXUvRQ==&#39;/&gt;&lt;input type=&#39;submit&#39; value=&#39;ok&#39; style=&#39;display:none;&#39;&#39;&gt;&lt;/form&gt;&lt;script&gt;document.forms[&#39;alipaysubmit&#39;].submit();&lt;/script&gt; 当用户付过钱后，会跳转到设置的return url中，并以GET方式返回支付结果参数。 2.4 处理异步通知 由于同步返回的不可靠性，支付结果必须以异步通知或查询接口返回为准，不能依赖同步跳转。 2.4.1 验签 支付成功后，支付宝除了向return url发送同步通知外，还会以POST方式向notify url发送异步通知。商户系统受到异步通知后，首先需要用支付宝公钥进行验签，确定消息是否来自支付宝。SDK中封装了验签接口。 $arr = $_POST; $arr[&#39;fund_bill_list&#39;] = stripslashes($arr[&#39;fund_bill_list&#39;]); $aop = new AopClient(); $aop-&gt;alipayrsaPublicKey = &#39;支付宝公钥&#39;; $signtype = &#39;RSA2&#39; $flag = $aop-&gt;rsaCheckV1($arr, &#39;支付宝公钥&#39;, $signtype); if ($flag) { //验签成功 // 进行通知数据的二次检验 // 根据交易状态进行商户的自身业务 echo &#39;success&#39;; } else { // 验签失败，记录异常日志 echo &#39;fail&#39;; } 刚开始的时候，出现了验签失败的结果。后来在网上搜了一下，发现这是因为PHP自动将fund_bill_list中的特殊字符前加了转义符，需要把转义字符去掉才行。所以如果验签没通过，不妨加上$arr[&#39;fund_bill_list&#39;] = stripslashes($arr[&#39;fund_bill_list&#39;]);试试。 2.4.2 二次检验 验签通过后，需要按照以下步骤检验数据的正确性： 1、商户需要验证该通知数据中的out_trade_no是否为商户系统中创建的订单号； 2、判断total_amount是否确实为该订单的实际金额（即商户订单创建时的金额）； 3、校验通知中的seller_id（或者seller_email) 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）； 4、验证app_id是否为该商户本身。 上述1、2、3、4有任何一个验证不通过，则表明本次通知是异常通知，务必忽略。 在上述验证通过后商户必须根据支付宝不同类型的业务通知，正确的进行不同的业务处理，并且过滤重复的通知结果数据。在支付宝的业务通知中，只有交易通知状态为TRADE_SUCCESS或TRADE_FINISHED时，支付宝才会认定为买家付款成功。 注意： 状态TRADE_SUCCESS的通知触发条件是商户签约的产品支持退款功能的前提下，买家付款成功； 交易状态TRADE_FINISHED的通知触发条件是商户签约的产品不支持退款功能的前提下，买家付款成功；或者，商户签约的产品支持退款功能的前提下，交易已经成功并且已经超过可退款期限。 2.4.3 继续商户自身的业务逻辑 在验签、二次校通过后，根据trade_status进行后续业务处理。 // 交易状态 $trade_status = $_POST[&#39;trade_status&#39;]; if($trade_status == &#39;TRADE_FINISHED&#39; || $trade_status==&#39;TRADE_SUCCESS&#39;) { // 判断该订单是否在商户网站中已经做过处理，如果没有的话执行商户的业务程序 } 3 问题集锦 1. 调试错误，请回到请求来源地，重新发起请求。 错误代码 missing-signature 错误原因: 缺少签名参数 解答： 这是因为alipay.trade.page.pay请求结果里面没有sign，为什么呢？https://openclub.alipay.com/read.php?tid=2333&amp;fid=46给出了原因。 php环境必须5.5以上，而现在的服务器上通过php -v命令查看，版本是PHP 5.3.28。升级之后这个问题解决了。 2. 支付请求提交后，返回“订单信息无法识别，建议联系卖家”的错误提示？ 解答： $request-&gt;setBizContent();中每个参数值都应该是字符串，比如&#39;&quot;&#39; . $value1 . &#39;&quot;&#39;。 下一篇：WooCommerce接入支付宝支付功能（二）——WooCommerce中添加新的支付网关 参考 [1] 电脑网站支付快速接入 [2] 创建应用 [3] 生成RSA密钥 [4] 上传应用公钥并获取支付宝公钥 [5] 使用应用私钥生成请求签名 [6] 服务端SDK [7] alipay.trade.page.pay [8] 电脑网站支付结果异步通知 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/11/22/f206a7559a9b9a8d75844fe6bb3dc308.html","headline":"WooCommerce接入支付宝支付功能（一）——创建应用以及请求支付","dateModified":"2017-11-22T00:00:00+08:00","datePublished":"2017-11-22T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/11/22/f206a7559a9b9a8d75844fe6bb3dc308.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>WooCommerce接入支付宝支付功能（一）——创建应用以及请求支付</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>采用WordPress搭建的网站，并使用WooCommerce插件，现在需要接入支付宝支付功能。</p> 
  <h1 id="1-创建应用">1. 创建应用</h1> 
  <h2 id="11-登录">1.1 登录</h2> 
  <p>使用支付宝账号登录<a href="https://auth.alipay.com/login/index.htm?goto=https%3A%2F%2Fopenhome.alipay.com%2Fplatform%2FmanageApp.htm" rel="nofollow">开放平台</a>：</p> 
  <p></p>
  <center>
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122165022134?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <hr> 
  <h2 id="12-创建应用">1.2 创建应用</h2> 
  <p>登录之后是如下界面： <br> </p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122165312453?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>开发文档中说“根据实际需求创建应用（如”支付应用“）”，我在这个页面没看到这一项，只有“支付接入”、“自定义接入”、“商业零售”、“交通出行”、“政务民生”、“医疗教育”这几项。不知道这几项的具体含义。暂时先选择“支付接入”吧！ <br> </p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122165911456?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>这里要求选择“使用场景”，有第三方法应用和自用型应用两个选项，第一个是指开发出来给别人用的，第二个是指开发给自己用的。选择自用型，填入应用名称后，跳转到下面的页面： <br> </p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122170649241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>这个页面包含基础信息、功能选项、开发配置三块。上面的图只截取到了前两块。</p> 
  <hr> 
  <h3 id="121-基础信息">1.2.1 基础信息</h3> 
  <p>基础信息中有应用名称和应用图标。应用名称之前已经填过了，现在上传自己的应用图标就行了。应用基础信息在<strong>开发应用</strong>过程中可以无需审核随时完善。但在应用申请上线时需要进行审核。</p> 
  <hr> 
  <h3 id="122-功能选项">1.2.2 功能选项</h3> 
  <p>功能选项模块中包含各种功能，你可以选择自己需要的功能添加到功能列表中，现在默认添加了当面付、手机网站支付、APP支付功能。不同的功能有不同的使用条件，如果某个功能的使用条件是签约，那么在使用此项功能之前，需要签约对应产品。点击“+ 继续添加”，跳到添加功能页面，这里有非常多的功能供选择：</p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122171552729?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>添加了“电脑网站支付”功能。</p> 
  <hr> 
  <h3 id="123-开发配置">1.2.3 开发配置</h3> 
  <p></p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122172225846?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <ul> 
   <li><p>支付宝网关：已有默认值。</p></li> 
   <li><p>应用网关：用于接收支付宝异步通知，这里可以不用设置。</p></li> 
   <li><p>授权回调地址：第三方授权或者用户信息授权后回调地址。授权链接中配置的redirect_uri值必须与此值保持一致。</p></li> 
   <li><p>RSA2(SHA256)密钥(推荐)：开发者要保证接口中使用的秘钥与此处的公钥匹配，否则无法调用接口。接口参数sign_type=RSA2。</p></li> 
   <li><p>RSA(SHA1)密钥：同上，接口参数为sign_type=RSA。</p></li> 
  </ul> 
  <p>对接口加签方式中的“设置应用公钥”进行设置，会弹出如下窗口： <br> </p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122173147730?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>选择设置应用公钥后弹出下面窗口：</p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122173311898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>填写校验码后，弹出窗口：</p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122173658255?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>这个框框里面需要填入商户自己的公钥。简单介绍一下商户公钥、商户私钥和支付宝公钥的概念：</p> 
  <ul> 
   <li><p>商户应用公钥：商户自己生成的RSA公钥，生成之后需要上传公钥到支付宝开放平台以便支付宝使用该公钥验证交易是否由该商户发起的；</p></li> 
   <li><p>商户应用私钥：商户自己生成的RSA私钥，商户开发者使用生成的私钥对请求字符串进行加签；</p></li> 
   <li><p>支付宝公钥：支付宝的RSA公钥，商户使用该公钥验证结果是否由支付宝返回的。</p></li> 
  </ul> 
  <p><strong>生成商户应用私钥和应用公钥</strong>： <br> 点击右边的链接：<a href="https://docs.open.alipay.com/291/105971" rel="nofollow">https://docs.open.alipay.com/291/105971</a>，这里介绍了生成商户RSA密钥的方法。根据指导，生成了<code>应用公钥2048.txt</code>和<code>应用私钥2048.txt</code>两个文件。生成的私钥一定要妥善保管。私钥需要填写到代码中供签名时使用；公钥需要上传到支付宝开放平台。</p> 
  <p><strong>上传商户应用公钥到支付宝平台：</strong> <br> 把<code>应用公钥2048.txt</code>中的内容复制粘贴到前面的框框中。然后保存，弹出如下窗口：</p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122195041485?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>现在在RSA2(SHA256)密钥(推荐)右边如下：</p>
  <center> 
   <br> 
   <img title="" alt="这里写图片描述" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171122195250867?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVmljdG9yaWFX/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  </center>
  <p></p> 
  <p>可以看到，除了商户的应用公钥之外，还有支付宝公钥。 <br> 可以随时修改应用公钥。</p> 
  <p><strong>使用应用私钥生成请求签名</strong> <br> 把AppID、应用私钥、支付宝公钥配置在代码中，对请求内容进行签名，并对支付宝返回的内容进行验签。</p> 
  <p>支付宝开放平台SDK封装了签名和验签过程，只需配置账号和密钥参数即可，推荐使用SDK。这个在开发过程中会介绍。</p> 
  <hr> 
  <p><strong>创建应用</strong>时的应用状态为“开发中”，无法在线上正式调用接口。按照上面的步骤设置好后，提交审核。</p> 
  <h1 id="2-开发">2 开发</h1> 
  <p>应用审核通过后，变成已上线状态。现在我们可以尝试开发支付宝网站接口了。</p> 
  <h2 id="21-下载服务端sdk">2.1 下载服务端SDK</h2> 
  <p>为了帮助开发者调用开放接口，支付宝开放平台提供了“开放平台服务端SDK”，包含JAVA、PHP和.NET三个版本，封装了签名&amp;验签、HTTP接口请求等基础功能。</p> 
  <p><a href="https://docs.open.alipay.com/54/103419" rel="nofollow">https://docs.open.alipay.com/54/103419</a>，选择你熟悉的语言的SDK。我下载的是PHP版本的。这个页面中有关于各语言版本SDK的详细使用说明，可以仔细阅读一遍。</p> 
  <p>将下载的<code>alipay-sdk-PHP-20171121170331.zip</code>解压到项目目录中去，比如项目文件夹为<code>alipay/</code>，那么解压后的SDK为<code>alipay/alipay-sdk-PHP-20171121170331/</code>。</p> 
  <h2 id="22-接口调用配置">2.2 接口调用配置</h2> 
  <p>在SDK调用前需要进行初始化，代码如下：</p> 
  <pre class="prettyprint"><code class=" hljs lasso">require_once(<span class="hljs-string">"alipay-sdk-PHP-20171121170331/AopSdk.php"</span>);
<span class="hljs-comment">//构造参数 </span>
<span class="hljs-variable">$aop</span> <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> AopClient ();  
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>gatewayUrl <span class="hljs-subst">=</span> <span class="hljs-string">'https://openapi.alipay.com/gateway.do'</span>;  <span class="hljs-comment">// 向这个网址发送支付、退款、查询等请求</span>
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>appId <span class="hljs-subst">=</span> <span class="hljs-string">'请填写APPID'</span>;  
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>rsaPrivateKey <span class="hljs-subst">=</span> <span class="hljs-string">'请填写商户私钥'</span>;  
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>apiVersion <span class="hljs-subst">=</span> <span class="hljs-string">'1.0'</span>;  
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>signType <span class="hljs-subst">=</span> <span class="hljs-string">'RSA2'</span>;  <span class="hljs-comment">// 对字符串进行前ing时使用的签名算法类型</span>
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>postCharset<span class="hljs-subst">=</span> <span class="hljs-string">'utf-8'</span>;  
<span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>format<span class="hljs-subst">=</span><span class="hljs-string">'json'</span>;  </code></pre> 
  <p>接下来，就可以用<code>$aop</code>来调用具体的API了。<code>$aop</code>只需要初始化一次，后续调用不同的API都可以使用同一个<code>$aop</code>对象。</p> 
  <h2 id="23-向支付宝发送支付请求">2.3 向支付宝发送支付请求</h2> 
  <p>通过向支付宝网关发送<a href="https://docs.open.alipay.com/270/alipay.trade.page.pay/" rel="nofollow"><code>alipay.trade.page.pay</code></a>请求进行支付。</p> 
  <pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-variable">$request</span> <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> AlipayTradePagePayRequest ();  
<span class="hljs-variable">$request</span><span class="hljs-subst">-&gt;</span>setReturnUrl(<span class="hljs-string">'请填写您的页面同步跳转地址'</span>);  <span class="hljs-comment">// 在支付完成之后，支付宝服务器会跳转到这个页面，同时GET方式传送支付结果参数</span>
<span class="hljs-variable">$request</span><span class="hljs-subst">-&gt;</span>setNotifyUrl(<span class="hljs-string">'请填写您的异步通知地址'</span>);  <span class="hljs-comment">// 支付完成后，支付宝服务器会向这个网址发送异步通知消息，支付结果必须以异步通知为准，不能依赖同步跳转</span>
<span class="hljs-variable">$request</span><span class="hljs-subst">-&gt;</span>setBizContent(<span class="hljs-string">'{"product_code":"FAST_INSTANT_TRADE_PAY","out_trade_no":"20150320010101001","subject":"Iphone6 16G","total_amount":"88.88","body":"Iphone6 16G"}'</span>);

<span class="hljs-comment">// 请求 </span>
<span class="hljs-variable">$result</span> <span class="hljs-subst">=</span> <span class="hljs-variable">$aop</span><span class="hljs-subst">-&gt;</span>pageExecute (<span class="hljs-variable">$request</span>); <span class="hljs-comment">// $resule是一个表单</span>

<span class="hljs-comment">// 输出 </span>
echo <span class="hljs-variable">$result</span>;
</code></pre> 
  <p>报文请求时会自动用应用私钥进行签名；支付宝收到请求之后，首先用应用公钥对请求参数验签，然后返回表单<code>$result</code>，打印这个表单会把用户重定向到支付页面。</p> 
  <p>请求返回的结果<code>$result</code>的内容如下：</p> 
  <pre class="prettyprint"><code class=" hljs ocaml">&lt;form id=<span class="hljs-string">'alipaysubmit'</span> name=<span class="hljs-string">'alipaysubmit'</span> action=<span class="hljs-string">'https://openapi.alipaydev.com/gateway.do?charset=UTF-8'</span> <span class="hljs-keyword">method</span>=<span class="hljs-string">'POST'</span>&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'biz_content'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'{"product_code":"FAST_INSTANT_TRADE_PAY","body":"hah","subject":"测试","total_amount":"0.01","out_trade_no":"201711279339773"}'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'app_id'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'2016090800411111'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'version'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'1.0'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'format'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'json'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'sign_type'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'RSA2'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'method'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'alipay.trade.page.pay'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'timestamp'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'2017-11-27 10:26:48'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'alipay_sdk'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'alipay-sdk-php-20161101'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'notify_url'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'http://www.example.com'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'return_url'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'http://www.example.com'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'charset'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'UTF-8'</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'hidden'</span> name=<span class="hljs-string">'sign'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'nZG55zzL2PtHywMt0z93uCx+1W3JSo9tUk8AM32N2fvzeeapg6g55nVjGmdGRrSLDQzYibEP3imOqmS6I5u9e222v8BeZKPtZJUb4GMrvot0NXVSqRRDi/kmyURAI7d8+8wkpgQP3mEKg9YM4JddcWYQRFdM6W0kzKPd2N+hThjdchJ30wwwDtCAgZNs916t3YTW18ZTDxSSjDCHDDPd065PkUwNmLc1YwvumS+dKVEVDAy2/gcUjAyFTQx1A9fYW2kibyp2ohGQbjksogTEgOKE2yIuLVZWMTMcZ5k2en826OWV47UmKH07NzCjhqI45Wrkg8sXoY1mUZdvnXUvRQ=='</span>/&gt;&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span>=</span><span class="hljs-string">'submit'</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">'ok'</span> style=<span class="hljs-string">'display:none;'</span><span class="hljs-string">'&gt;&lt;/form&gt;&lt;script&gt;document.forms['</span>alipaysubmit<span class="hljs-string">'].submit();&lt;/script&gt;</span></code></pre> 
  <p>当用户付过钱后，会跳转到设置的<code>return url</code>中，并以GET方式返回支付结果参数。</p> 
  <h2 id="24-处理异步通知">2.4 处理异步通知</h2> 
  <p>由于同步返回的不可靠性，支付结果必须以异步通知或查询接口返回为准，不能依赖同步跳转。</p> 
  <h3 id="241-验签">2.4.1 验签</h3> 
  <p>支付成功后，支付宝除了向<code>return url</code>发送同步通知外，还会以POST方式向<code>notify url</code>发送异步通知。商户系统受到异步通知后，首先需要用支付宝公钥进行验签，确定消息是否来自支付宝。SDK中封装了验签接口。</p> 
  <pre class="prettyprint"><code class=" hljs php"><span class="hljs-variable">$arr</span> = <span class="hljs-variable">$_POST</span>;
<span class="hljs-variable">$arr</span>[<span class="hljs-string">'fund_bill_list'</span>] = stripslashes(<span class="hljs-variable">$arr</span>[<span class="hljs-string">'fund_bill_list'</span>]);
<span class="hljs-variable">$aop</span> = <span class="hljs-keyword">new</span> AopClient();
<span class="hljs-variable">$aop</span>-&gt;alipayrsaPublicKey = <span class="hljs-string">'支付宝公钥'</span>;
<span class="hljs-variable">$signtype</span> = <span class="hljs-string">'RSA2'</span> 
<span class="hljs-variable">$flag</span> = <span class="hljs-variable">$aop</span>-&gt;rsaCheckV1(<span class="hljs-variable">$arr</span>, <span class="hljs-string">'支付宝公钥'</span>, <span class="hljs-variable">$signtype</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$flag</span>) {
    <span class="hljs-comment">//验签成功</span>
    <span class="hljs-comment">// 进行通知数据的二次检验</span>
    <span class="hljs-comment">// 根据交易状态进行商户的自身业务</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'success'</span>;      
}
<span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 验签失败，记录异常日志</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'fail'</span>;
}
</code></pre> 
  <p>刚开始的时候，出现了验签失败的结果。后来在网上搜了一下，发现这是因为PHP自动将<code>fund_bill_list</code>中的特殊字符前加了转义符，需要把转义字符去掉才行。所以如果验签没通过，不妨加上<code>$arr['fund_bill_list'] = stripslashes($arr['fund_bill_list']);</code>试试。</p> 
  <h3 id="242-二次检验">2.4.2 二次检验</h3> 
  <p>验签通过后，需要按照以下步骤检验数据的正确性：</p> 
  <ul> 
   <li>1、商户需要验证该通知数据中的out_trade_no是否为商户系统中创建的订单号；</li> 
   <li>2、判断total_amount是否确实为该订单的实际金额（即商户订单创建时的金额）；</li> 
   <li>3、校验通知中的seller_id（或者seller_email) 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）；</li> 
   <li>4、验证app_id是否为该商户本身。</li> 
  </ul> 
  <p>上述1、2、3、4有任何一个验证不通过，则表明本次通知是异常通知，务必忽略。</p> 
  <p>在上述验证通过后商户必须根据支付宝不同类型的业务通知，正确的进行不同的业务处理，并且过滤重复的通知结果数据。在支付宝的业务通知中，只有交易通知状态为TRADE_SUCCESS或TRADE_FINISHED时，支付宝才会认定为买家付款成功。</p> 
  <p><strong>注意：</strong> <br> 状态TRADE_SUCCESS的通知触发条件是商户签约的产品支持退款功能的前提下，买家付款成功； <br> 交易状态TRADE_FINISHED的通知触发条件是商户签约的产品不支持退款功能的前提下，买家付款成功；或者，商户签约的产品支持退款功能的前提下，交易已经成功并且已经超过可退款期限。</p> 
  <h3 id="243-继续商户自身的业务逻辑">2.4.3 继续商户自身的业务逻辑</h3> 
  <p>在验签、二次校通过后，根据<code>trade_status</code>进行后续业务处理。</p> 
  <pre class="prettyprint"><code class=" hljs php">
  <span class="hljs-comment">// 交易状态</span>
  <span class="hljs-variable">$trade_status</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'trade_status'</span>];
  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$trade_status</span> == <span class="hljs-string">'TRADE_FINISHED'</span> || <span class="hljs-variable">$trade_status</span>==<span class="hljs-string">'TRADE_SUCCESS'</span>) {
      <span class="hljs-comment">// 判断该订单是否在商户网站中已经做过处理，如果没有的话执行商户的业务程序</span>
  }  </code></pre> 
  <h1 id="3-问题集锦">3 问题集锦</h1> 
  <p><strong>1. <code>调试错误，请回到请求来源地，重新发起请求。</code></strong> <br> <strong><code>错误代码 missing-signature 错误原因: 缺少签名参数</code></strong> <br> <strong>解答：</strong> <br> 这是因为alipay.trade.page.pay请求结果里面没有sign，为什么呢？<a href="https://openclub.alipay.com/read.php?tid=2333&amp;fid=46" rel="nofollow">https://openclub.alipay.com/read.php?tid=2333&amp;fid=46</a>给出了原因。 <br> php环境必须5.5以上，而现在的服务器上通过<code>php -v</code>命令查看，版本是PHP 5.3.28。升级之后这个问题解决了。</p> 
  <p><strong>2. 支付请求提交后，返回“<code>订单信息无法识别，建议联系卖家</code>”的错误提示？</strong> <br> <strong>解答：</strong> <br> <code>$request-&gt;setBizContent();</code>中每个参数值都应该是字符串，比如<code>'"' . $value1 . '"'</code>。</p> 
  <p>下一篇：<a href="https://blog.csdn.net/VictoriaW/article/details/78625387" rel="nofollow">WooCommerce接入支付宝支付功能（二）——WooCommerce中添加新的支付网关</a></p> 
  <h1 id="参考">参考</h1> 
  <p>[1] <a href="https://docs.open.alipay.com/270/105899/" rel="nofollow">电脑网站支付快速接入</a> <br> [2] <a href="https://docs.open.alipay.com/200/105310/" rel="nofollow">创建应用</a> <br> [3] <a href="https://docs.open.alipay.com/291/105971/" rel="nofollow">生成RSA密钥</a> <br> [4] <a href="https://docs.open.alipay.com/291/105972/" rel="nofollow">上传应用公钥并获取支付宝公钥</a> <br> [5] <a href="https://docs.open.alipay.com/291/105974/" rel="nofollow">使用应用私钥生成请求签名</a> <br> [6] <a href="https://docs.open.alipay.com/54/103419" rel="nofollow">服务端SDK</a> <br> [7] <a href="https://docs.open.alipay.com/270/alipay.trade.page.pay/" rel="nofollow">alipay.trade.page.pay</a> <br> [8] <a href="https://docs.open.alipay.com/270/105902/" rel="nofollow">电脑网站支付结果异步通知</a></p> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/VictoriaW/article/details/78606545,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/VictoriaW/article/details/78606545,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

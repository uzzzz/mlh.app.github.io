<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>以太坊代币2.0开发原生态智能合约数字货币系统 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="以太坊代币2.0开发原生态智能合约数字货币系统" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="区块链爱好者（QQ：53016353） 1. 整体概览 在以太坊代币 1.0版本中，原0.6版本中的“Membership Service”已经被“以太坊代币 CA”所替代。 以太坊代币 CA是Hyperledger 以太坊代币的证书颁发机构，它提供的功能如下： 1）身份的注册，或连接到LDAP作为用户注册表; 2）发放登记证书（ECerts）; 3）发布交易证书（TCerts），在Hyperledger 以太坊代币 blockchain上进行交易时提供匿名性和不可链接性; 4）证书更新和撤销。 以太坊代币 CA包含一个client端和一个server端。在以太坊代币 1.0版本中，CA可以脱离Docker镜像，作为一个独立的服务来运行。若使用docker启动，所有的CA服务都是在一个专门的镜像（名称类似于“ca”）中进行执行。 以太坊代币 CA提供了两种访问方式调用Server服务，一种是通过Client调用，另一种是通过SDK调用。两种调用都是REST风格的。SDK的API接口位于以太坊代币-ca工程的 以太坊代币-ca/swagger/swagger-以太坊代币-ca.json。本文使用的是通过Client调用。 1.1 以太坊代币 CA整体架构图 [1] Server端由一个集群组成，包括前端的一个高可用的代理服务器，连接着若干个CA Server集群，这些集群将数据共同存放在同一个数据服务器上。数据库可能是MySQL、LDAP、PostgresSQL或者SQLite。 1.2 以太坊代币 CA运行流程的时序图 具体步骤包括： 1) Server端初始化 2) CA根证书生成 3) Server端启动服务 4) Client端向Server端请求登记 5) Server端向Client端返回登记证书ECert 6) Client端向Server端请求注册节点 7) Server端向Client端返回节点注册信息结果 8) Client端向Server端请求登记节点 9) Server端生成TCert，存入数据库 10) Server端向Client端返回登记结果 2. 安装 2.1 Dokcer启动 2.1.1 拉取镜像 docker pull hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha 2.1.2 使用Docker-Compose启动 将下部分代码添加到 中的service中，使用 docker-compose up 启动ca服务节点 &nbsp; ca: &nbsp; &nbsp; image: hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha &nbsp; &nbsp; container_name: 以太坊代币-ca &nbsp; &nbsp; ports: &nbsp; &nbsp; &nbsp; - &quot;8888:8888&quot; &nbsp; &nbsp; environment: &nbsp; &nbsp; &nbsp; - 以太坊代币_CA_HOME=/etc/hyperledger/以太坊代币-ca &nbsp; &nbsp; volumes: &nbsp; &nbsp; &nbsp; - &quot;./以太坊代币-ca:/etc/hyperledger/以太坊代币-ca&quot; &nbsp; &nbsp; command: sh -c &#39;以太坊代币-ca-server start -b admin:adminpw&#39; 2.2 Native启动 2.2.1前提条件 - Go 1.7版本或以上 - GOPATH环境配置正确 - 安装libtool和libtdhl-dev 2.2.2 安装方法 可直接使用“go get”命令进行安装。“go get”相当于“git clone”+“go install” #go get -u github.com/hyperledger/以太坊代币-ca/cmd/... 后续的操作和在Docker中类似，这里我们主要讲Docker启动的情况。 3. 以太坊代币-CA-Server 官方说明如下： Hyperledger 以太坊代币 Certificate Authority Server Usage: &nbsp; 以太坊代币-ca-server [command] Available Commands: &nbsp; init &nbsp; &nbsp; &nbsp; &nbsp;Initialize the 以太坊代币-ca server &nbsp; start &nbsp; &nbsp; &nbsp; Start the 以太坊代币-ca server Flags: &nbsp; &nbsp; &nbsp; --address string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening address of 以太坊代币-ca-server (default &quot;0.0.0.0&quot;) &nbsp; -b, --boot string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The user:pass for bootstrap admin which is required to build default config file &nbsp; &nbsp; &nbsp; --ca.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded CA certificate file (default &quot;ca-cert.pem&quot;) &nbsp; &nbsp; &nbsp; --ca.chainfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA chain file (default &quot;ca-chain.pem&quot;) &nbsp; &nbsp; &nbsp; --ca.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA key file (default &quot;ca-key.pem&quot;) &nbsp; -n, --ca.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Certificate Authority name &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configuration file (default &quot;以太坊代币-ca-server-config.yaml&quot;) &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The common name field of the certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp; &nbsp; The serial number in a certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --db.datasource string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Data source which is database specific (default &quot;以太坊代币-ca-server.db&quot;) &nbsp; &nbsp; &nbsp; --db.tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem) &nbsp; &nbsp; &nbsp; --db.tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled &nbsp; &nbsp; &nbsp; --db.tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled &nbsp; &nbsp; &nbsp; --db.tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection &nbsp; &nbsp; &nbsp; --db.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type of database; one of: sqlite3, postgres, mysql (default &quot;sqlite3&quot;) &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable debug level logging &nbsp; &nbsp; &nbsp; --ldap.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable the LDAP client for authentication and attributes &nbsp; &nbsp; &nbsp; --ldap.groupfilter string &nbsp; &nbsp; &nbsp; &nbsp; The LDAP group filter for a single affiliation group (default &quot;(memberUid=%s)&quot;) &nbsp; &nbsp; &nbsp; --ldap.url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LDAP client URL of form ldap://adminDN:adminPassword@host[:port]/base &nbsp; &nbsp; &nbsp; --ldap.userfilter string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The LDAP user filter to use when searching for users (default &quot;(uid=%s)&quot;) &nbsp; -p, --port int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening port of 以太坊代币-ca-server (default 7054) &nbsp; &nbsp; &nbsp; --registry.maxenrollments int &nbsp; &nbsp; Maximum number of enrollments; valid if LDAP not enabled &nbsp; &nbsp; &nbsp; --tls.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded TLS certificate file for server&#39;s listening port (default &quot;ca-cert.pem&quot;) &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable TLS on the listening port &nbsp; &nbsp; &nbsp; --tls.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded TLS key for server&#39;s listening port (default &quot;ca-key.pem&quot;) &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;URL of the parent 以太坊代币-ca-server Use &quot;以太坊代币-ca-server [command] --help&quot; for more information about a command. 3.1 初始化Server服务 3.1.1 指令介绍 # 以太坊代币-ca-server init -b admin:adminpw -b在这里指的是bootstrap，也就是启动加载状态。 有一个名为 以太坊代币-ca-server-config.yaml 的配置文件会在节点启动时自动生成。我们也可以根据里面的内容自定义配置CSR信息，使用 --config 文件名来进行启动配置。 CSR为“Certificate Signing Request”的缩写，即证书签名请求。 目前在keys中支持的算法和相关长度如下： 以太坊代币-CA 1.0支持MySQL、LDAP、PostgresSQL和SQLite，这里配置用的是默认的SQLite。其他配置方法暂且不表。 3.1.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server init -b admin:adminpw 2017/03/21 08:54:23 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml 2017/03/21 08:54:23 Initialize BCCSP [SW] 2017/03/21 08:54:23 [INFO] The CA key and certificate files already exist 2017/03/21 08:54:23 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem 2017/03/21 08:54:23 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem 2017/03/21 08:54:23 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db 2017/03/21 08:54:23 [INFO] Initialization was successful 3.2 启动Server服务 3.2.1 指令介绍 以太坊代币-ca-server start -b &lt;admin&gt;:&lt;adminpw&gt; 这里，默认调用的启动配置文件为以太坊代币-ca-server-config.yaml，如果需要自定义配置，还是使用 --config 文件名来进行启动配置。 成功后，server端会在预先配置的环境路径下生成相应的ca证书文件，并在配置的端口号上进行服务监听。这里我们在端口8888上进行监听。 3.2.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server start -b admin:adminpw 2017/03/21 08:54:50 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml 2017/03/21 08:54:50 Initialize BCCSP [SW] 2017/03/21 08:54:50 [INFO] The CA key and certificate files already exist 2017/03/21 08:54:50 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem 2017/03/21 08:54:50 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem 2017/03/21 08:54:50 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db 2017/03/21 08:54:50 [INFO] Listening at http://0.0.0.0:8888 4. 以太坊代币-CA-Client 官方说明如下： Hyperledger 以太坊代币 Certificate Authority Client Usage: &nbsp; 以太坊代币-ca-client [command] Available Commands: &nbsp; enroll &nbsp; &nbsp; &nbsp;Enroll user &nbsp; getcacert &nbsp; Get CA certificate chain &nbsp; reenroll &nbsp; &nbsp;Reenroll user &nbsp; register &nbsp; &nbsp;Register user &nbsp; revoke &nbsp; &nbsp; &nbsp;Revoke user Flags: &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Configuration file (default &quot;/etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml&quot;) &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The common name field of the certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp;The serial number in a certificate signing request to a parent 以太坊代币-ca-server &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable debug level logging &nbsp; &nbsp; &nbsp; --enrollment.hosts string &nbsp; &nbsp; &nbsp;Comma-separated host list &nbsp; &nbsp; &nbsp; --enrollment.label string &nbsp; &nbsp; &nbsp;Label to use in HSM operations &nbsp; &nbsp; &nbsp; --enrollment.profile string &nbsp; &nbsp;Name of the signing profile to use in issuing the certificate &nbsp; &nbsp; &nbsp; --id.affiliation string &nbsp; &nbsp; &nbsp; &nbsp;The identity&#39;s affiliation &nbsp; &nbsp; &nbsp; --id.attr string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Attributes associated with this identity (e.g. hf.Revoker=true) &nbsp; &nbsp; &nbsp; --id.maxenrollments int &nbsp; &nbsp; &nbsp; &nbsp;The maximum number of times the secret can be reused to enroll. &nbsp; &nbsp; &nbsp; --id.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unique name of the identity &nbsp; &nbsp; &nbsp; --id.secret string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The enrollment secret for the identity being registered &nbsp; &nbsp; &nbsp; --id.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type of identity being registered (e.g. &#39;peer, app, user&#39;) &nbsp; -M, --mspdir string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Membership Service Provider directory (default &quot;msp&quot;) &nbsp; -m, --myhost string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hostname to include in the certificate signing request during enrollment (default &quot;0f86c3e1cf15&quot;) &nbsp; &nbsp; &nbsp; --tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem) &nbsp; &nbsp; &nbsp; --tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled &nbsp; &nbsp; &nbsp; --tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL of 以太坊代币-ca-server (default &quot;http://localhost:7054&quot;) Use &quot;以太坊代币-ca-client [command] --help&quot; for more information about a command. 4.1启动用户登记 4.1.1 指令介绍 #以太坊代币-ca-client enroll -u&nbsp; 登记启动用户会在用户的home路径下生成登记证书文件ECert。 4.1.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://admin:adminpw@localhost:8888 2017/03/21 08:59:09 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml 2017/03/21 08:59:09 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml 2017/03/21 08:59:09 Initialize BCCSP [SW] 2017/03/21 08:59:09 [INFO] received CSR 2017/03/21 08:59:09 [INFO] generating key: ECDSA-256 2017/03/21 08:59:09 [INFO] encoded CSR 2017/03/21 08:59:09 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/msp/keystore/key.pem 2017/03/21 08:59:09 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/msp/signcerts/cert.pem 2017/03/21 08:59:09 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/msp/cacerts/.pem 4.2 新身份注册 4.2.1 指令介绍 # 以太坊代币-ca-client register 在注册阶段，server端需要检查被注册对象的两方面内容： 1 被注册的对象的角色一定要在预先配置的“hf.Registrar.Roles”属性中约定的范围内。比如，如果“hf.Registrar.Roles”约定的角色包括“peer”和“client”，那么被注册对象就只能是这两个角色中的一个，如果被注册对象的角色为“user”，那么注册就不能被通过。 2 被注册对象的从属关系参数一定要归属于预先配置的组织属性。换句话说，被注册对象的affiliation参数一定要是预先配置的affiliation参数的一个前缀。例如，假设预先配置的组织关系为：“a.b.c”，那么新注册的对象的affiliation属性可以是“a.b.c”，也可以是“a.b”，但“a.c”就不能通过注册。 下面是id配置的一个示例： id: &nbsp; name: MyPeer1 &nbsp; type: peer &nbsp; affiliation: org1.department1 &nbsp; attributes: &nbsp; &nbsp; - name: SomeAttrName &nbsp; &nbsp; &nbsp; value: SomeAttrValue &nbsp; &nbsp; - name: foo &nbsp; &nbsp; &nbsp; value: bar 如果想要在后面允许对这个ID进行注销，在这里配置的attributes中要包含“hf.Revoker”，即： &nbsp; attributes: &nbsp; &nbsp; - name: hf.Revoker &nbsp; &nbsp; &nbsp; value: true 4.2.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client register --id.name cliTest00 2017/03/21 09:05:16 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:05:16 Initialize BCCSP [SW] 2017/03/21 09:05:16 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml Password: oLtPkJRCzdTH 这里随机生成了一个Password，将在后面的节点登记中用到。 在指令中使用flag来临时自定义用户名和密码：--id.name &lt;用户名&gt; --id.secret &lt;密码&gt; 4.3 节点身份登记 4.3.1 指令介绍 官方文档上说，在节点身份登记之前，要先指定以太坊代币_CA_CERT_FILE和以太坊代币_CA_KEY_FILE两个环境变量，生成的peer.pem和key.pem两个证书文件作为TCert。但是我的试验中，生成的证书文件路径仍然是在以太坊代币_CA_CLIENT_HOME相应的路径下，不知是否是仍然存在的bug。 # export 以太坊代币_CA_CERT_FILE=$MSP_DIR/signcerts/peer.pem # export 以太坊代币_CA_KEY_FILE=$MSP_DIR/keystore/key.pem 以太坊代币-ca client enroll -u http://&lt;peer ID&gt;:&lt;password&gt;@localhost:port 这里Peer ID为注册时的id name，password为上文提到的注册时生成的密码。 4.3.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://cliTest00:oLtPkJRCzdTH@localhost:8888 2017/03/21 09:07:48 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:07:48 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:07:48 Initialize BCCSP [SW] 2017/03/21 09:07:48 [INFO] received CSR 2017/03/21 09:07:48 [INFO] generating key: ecdsa-256 2017/03/21 09:07:48 [INFO] encoded CSR 2017/03/21 09:07:48 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem 2017/03/21 09:07:48 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem 2017/03/21 09:07:48 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem 4.4 身份重登记 4.4.1 指令介绍 # 以太坊代币-ca-client reenroll 当登记的身份过期时，可以利用reenroll命令对身份进行重新登记。注意，这个指令后面不能添加登记的名称和密码，只是按照之前配置好的内容进行重新登记。 4.4.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client reenroll 2017/03/21 10:11:36 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 10:11:36 Initialize BCCSP [SW] 2017/03/21 10:11:36 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 10:11:36 [INFO] received CSR 2017/03/21 10:11:36 [INFO] generating key: ecdsa-256 2017/03/21 10:11:37 [INFO] encoded CSR 2017/03/21 10:11:37 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem 2017/03/21 10:11:37 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem 2017/03/21 10:11:37 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem 4.5 证书或身份撤销 4.5.1 指令介绍 Usage: &nbsp; 以太坊代币-ca-client revoke [flags] Flags: &nbsp; -a, --aki string &nbsp; &nbsp; &nbsp;AKI &nbsp; -e, --eid string &nbsp; &nbsp; &nbsp;Enrollment ID (Optional) &nbsp; -r, --reason string &nbsp; Reason for revoking &nbsp; -s, --serial string &nbsp; Serial Number 官方给出的说明有些错误，被标（Optional）的应该是“Reason for revoking”部分。实际上，要求指令后面的flag内容为下面两种格式中的一种： 以太坊代币-ca-client revoke -a xxx -s yyy -r &lt;reason&gt; 或 以太坊代币-ca-client revoke -e &lt;enrollment_id&gt; -r &lt;reason&gt; 支持的&lt;reason&gt;包括： Reasons: - unspecified - keycompromise - cacompromise - affiliationchange - superseded - cessationofoperation - certificatehold - removefromcrl - privilegewithdrawn - aacompromise AKI（Authority Key Identifier）和Serial Number都是在身份登记后生成的cert.pem文件中。我们需要对这个文件进行解析。可以使用OpenSSL进行解析： root@xiao-virtual-machine:/home/xiao/test/以太坊代币-ca/clients/admin/msp/signcerts# openssl x509 -in cert.pem -text -noout -serial Certificate: &nbsp; &nbsp; Data: &nbsp; &nbsp; &nbsp; &nbsp; Version: 3 (0x2) &nbsp; &nbsp; &nbsp; &nbsp; Serial Number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4a:ad:ce:89:16:9d:36:23:99:c5:37:7a:e9:2b:06:d7:8a:f3:f3:da &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256 &nbsp; &nbsp; &nbsp; &nbsp; Issuer: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=以太坊代币-ca-server &nbsp; &nbsp; &nbsp; &nbsp; Validity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not Before: Mar 21 09:21:00 2017 GMT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not After : Feb 17 17:21:00 2018 GMT &nbsp; &nbsp; &nbsp; &nbsp; Subject: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=test001 &nbsp; &nbsp; &nbsp; &nbsp; Subject Public Key Info: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public Key Algorithm: id-ecPublicKey &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public-Key: (256 bit) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pub:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:8a:ff:a4:44:2c:10:e5:4c:4e:7d:7d:0f:bb:28: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa:c0:30:b8:53:2c:0d:1d:26:92:c9:85:7c:0d:24: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7a:c0:25:5c:18:c9:f7:fa:d2:53:e9:00:00:99:d1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:30:a1:d5:dd:a1:3c:30:37:5a:f9:70:e5:aa:6e: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 89:6c:54:ad:18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ASN1 OID: prime256v1 &nbsp; &nbsp; &nbsp; &nbsp; X509v3 extensions: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Key Usage: critical &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Certificate Sign &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Basic Constraints: critical &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA:FALSE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Key Identifier:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6F:76:CA:12:7D:20:5F:27:6F:93:55:15:48:F1:32:6C:83:2A:F6:03 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Authority Key Identifier:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyid:A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Alternative Name:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DNS:38cdca9067ac &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30:46:02:21:00:a6:3e:33:78:e2:59:8c:e2:ba:6f:0f:7b:01: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;66:5d:67:08:af:81:de:1b:47:20:c1:00:e5:11:ba:1e:7a:f1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f2:02:21:00:95:1a:31:06:6e:ab:cd:91:85:02:38:8c:72:87: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;70:8e:e5:bc:7d:a8:0f:05:a1:55:60:c9:49:a0:72:1d:a1:11 serial=4AADCE89169D362399C5377AE92B06D78AF3F3DA 这里，AKI为 A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43 (需要去除冒号），Serial Number为 4AADCE89169D362399C5377AE92B06D78AF3F3DA 4.5.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client revoke -e test01 &nbsp;&nbsp; 2017/03/21 11:11:05 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 11:11:05 Initialize BCCSP [SW] 2017/03/21 11:11:05 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 11:11:05 [INFO] Revocation was successful 这里只是表述了通过eid进行撤销的方式，另一种方法总是不能成功，与Hyperledger项目组的成员沟通后，说是存在bug，目前仍在修复中。所以这里暂且不表。 5. 其他 5.1 优先级 命令执行的优先级从高到低依次是： 1 命令行flag 2 环境变量 3 配置文件 阅读更多" />
<meta property="og:description" content="区块链爱好者（QQ：53016353） 1. 整体概览 在以太坊代币 1.0版本中，原0.6版本中的“Membership Service”已经被“以太坊代币 CA”所替代。 以太坊代币 CA是Hyperledger 以太坊代币的证书颁发机构，它提供的功能如下： 1）身份的注册，或连接到LDAP作为用户注册表; 2）发放登记证书（ECerts）; 3）发布交易证书（TCerts），在Hyperledger 以太坊代币 blockchain上进行交易时提供匿名性和不可链接性; 4）证书更新和撤销。 以太坊代币 CA包含一个client端和一个server端。在以太坊代币 1.0版本中，CA可以脱离Docker镜像，作为一个独立的服务来运行。若使用docker启动，所有的CA服务都是在一个专门的镜像（名称类似于“ca”）中进行执行。 以太坊代币 CA提供了两种访问方式调用Server服务，一种是通过Client调用，另一种是通过SDK调用。两种调用都是REST风格的。SDK的API接口位于以太坊代币-ca工程的 以太坊代币-ca/swagger/swagger-以太坊代币-ca.json。本文使用的是通过Client调用。 1.1 以太坊代币 CA整体架构图 [1] Server端由一个集群组成，包括前端的一个高可用的代理服务器，连接着若干个CA Server集群，这些集群将数据共同存放在同一个数据服务器上。数据库可能是MySQL、LDAP、PostgresSQL或者SQLite。 1.2 以太坊代币 CA运行流程的时序图 具体步骤包括： 1) Server端初始化 2) CA根证书生成 3) Server端启动服务 4) Client端向Server端请求登记 5) Server端向Client端返回登记证书ECert 6) Client端向Server端请求注册节点 7) Server端向Client端返回节点注册信息结果 8) Client端向Server端请求登记节点 9) Server端生成TCert，存入数据库 10) Server端向Client端返回登记结果 2. 安装 2.1 Dokcer启动 2.1.1 拉取镜像 docker pull hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha 2.1.2 使用Docker-Compose启动 将下部分代码添加到 中的service中，使用 docker-compose up 启动ca服务节点 &nbsp; ca: &nbsp; &nbsp; image: hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha &nbsp; &nbsp; container_name: 以太坊代币-ca &nbsp; &nbsp; ports: &nbsp; &nbsp; &nbsp; - &quot;8888:8888&quot; &nbsp; &nbsp; environment: &nbsp; &nbsp; &nbsp; - 以太坊代币_CA_HOME=/etc/hyperledger/以太坊代币-ca &nbsp; &nbsp; volumes: &nbsp; &nbsp; &nbsp; - &quot;./以太坊代币-ca:/etc/hyperledger/以太坊代币-ca&quot; &nbsp; &nbsp; command: sh -c &#39;以太坊代币-ca-server start -b admin:adminpw&#39; 2.2 Native启动 2.2.1前提条件 - Go 1.7版本或以上 - GOPATH环境配置正确 - 安装libtool和libtdhl-dev 2.2.2 安装方法 可直接使用“go get”命令进行安装。“go get”相当于“git clone”+“go install” #go get -u github.com/hyperledger/以太坊代币-ca/cmd/... 后续的操作和在Docker中类似，这里我们主要讲Docker启动的情况。 3. 以太坊代币-CA-Server 官方说明如下： Hyperledger 以太坊代币 Certificate Authority Server Usage: &nbsp; 以太坊代币-ca-server [command] Available Commands: &nbsp; init &nbsp; &nbsp; &nbsp; &nbsp;Initialize the 以太坊代币-ca server &nbsp; start &nbsp; &nbsp; &nbsp; Start the 以太坊代币-ca server Flags: &nbsp; &nbsp; &nbsp; --address string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening address of 以太坊代币-ca-server (default &quot;0.0.0.0&quot;) &nbsp; -b, --boot string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The user:pass for bootstrap admin which is required to build default config file &nbsp; &nbsp; &nbsp; --ca.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded CA certificate file (default &quot;ca-cert.pem&quot;) &nbsp; &nbsp; &nbsp; --ca.chainfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA chain file (default &quot;ca-chain.pem&quot;) &nbsp; &nbsp; &nbsp; --ca.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA key file (default &quot;ca-key.pem&quot;) &nbsp; -n, --ca.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Certificate Authority name &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configuration file (default &quot;以太坊代币-ca-server-config.yaml&quot;) &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The common name field of the certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp; &nbsp; The serial number in a certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --db.datasource string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Data source which is database specific (default &quot;以太坊代币-ca-server.db&quot;) &nbsp; &nbsp; &nbsp; --db.tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem) &nbsp; &nbsp; &nbsp; --db.tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled &nbsp; &nbsp; &nbsp; --db.tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled &nbsp; &nbsp; &nbsp; --db.tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection &nbsp; &nbsp; &nbsp; --db.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type of database; one of: sqlite3, postgres, mysql (default &quot;sqlite3&quot;) &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable debug level logging &nbsp; &nbsp; &nbsp; --ldap.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable the LDAP client for authentication and attributes &nbsp; &nbsp; &nbsp; --ldap.groupfilter string &nbsp; &nbsp; &nbsp; &nbsp; The LDAP group filter for a single affiliation group (default &quot;(memberUid=%s)&quot;) &nbsp; &nbsp; &nbsp; --ldap.url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LDAP client URL of form ldap://adminDN:adminPassword@host[:port]/base &nbsp; &nbsp; &nbsp; --ldap.userfilter string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The LDAP user filter to use when searching for users (default &quot;(uid=%s)&quot;) &nbsp; -p, --port int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening port of 以太坊代币-ca-server (default 7054) &nbsp; &nbsp; &nbsp; --registry.maxenrollments int &nbsp; &nbsp; Maximum number of enrollments; valid if LDAP not enabled &nbsp; &nbsp; &nbsp; --tls.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded TLS certificate file for server&#39;s listening port (default &quot;ca-cert.pem&quot;) &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable TLS on the listening port &nbsp; &nbsp; &nbsp; --tls.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded TLS key for server&#39;s listening port (default &quot;ca-key.pem&quot;) &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;URL of the parent 以太坊代币-ca-server Use &quot;以太坊代币-ca-server [command] --help&quot; for more information about a command. 3.1 初始化Server服务 3.1.1 指令介绍 # 以太坊代币-ca-server init -b admin:adminpw -b在这里指的是bootstrap，也就是启动加载状态。 有一个名为 以太坊代币-ca-server-config.yaml 的配置文件会在节点启动时自动生成。我们也可以根据里面的内容自定义配置CSR信息，使用 --config 文件名来进行启动配置。 CSR为“Certificate Signing Request”的缩写，即证书签名请求。 目前在keys中支持的算法和相关长度如下： 以太坊代币-CA 1.0支持MySQL、LDAP、PostgresSQL和SQLite，这里配置用的是默认的SQLite。其他配置方法暂且不表。 3.1.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server init -b admin:adminpw 2017/03/21 08:54:23 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml 2017/03/21 08:54:23 Initialize BCCSP [SW] 2017/03/21 08:54:23 [INFO] The CA key and certificate files already exist 2017/03/21 08:54:23 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem 2017/03/21 08:54:23 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem 2017/03/21 08:54:23 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db 2017/03/21 08:54:23 [INFO] Initialization was successful 3.2 启动Server服务 3.2.1 指令介绍 以太坊代币-ca-server start -b &lt;admin&gt;:&lt;adminpw&gt; 这里，默认调用的启动配置文件为以太坊代币-ca-server-config.yaml，如果需要自定义配置，还是使用 --config 文件名来进行启动配置。 成功后，server端会在预先配置的环境路径下生成相应的ca证书文件，并在配置的端口号上进行服务监听。这里我们在端口8888上进行监听。 3.2.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server start -b admin:adminpw 2017/03/21 08:54:50 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml 2017/03/21 08:54:50 Initialize BCCSP [SW] 2017/03/21 08:54:50 [INFO] The CA key and certificate files already exist 2017/03/21 08:54:50 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem 2017/03/21 08:54:50 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem 2017/03/21 08:54:50 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db 2017/03/21 08:54:50 [INFO] Listening at http://0.0.0.0:8888 4. 以太坊代币-CA-Client 官方说明如下： Hyperledger 以太坊代币 Certificate Authority Client Usage: &nbsp; 以太坊代币-ca-client [command] Available Commands: &nbsp; enroll &nbsp; &nbsp; &nbsp;Enroll user &nbsp; getcacert &nbsp; Get CA certificate chain &nbsp; reenroll &nbsp; &nbsp;Reenroll user &nbsp; register &nbsp; &nbsp;Register user &nbsp; revoke &nbsp; &nbsp; &nbsp;Revoke user Flags: &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Configuration file (default &quot;/etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml&quot;) &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The common name field of the certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp;The serial number in a certificate signing request to a parent 以太坊代币-ca-server &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable debug level logging &nbsp; &nbsp; &nbsp; --enrollment.hosts string &nbsp; &nbsp; &nbsp;Comma-separated host list &nbsp; &nbsp; &nbsp; --enrollment.label string &nbsp; &nbsp; &nbsp;Label to use in HSM operations &nbsp; &nbsp; &nbsp; --enrollment.profile string &nbsp; &nbsp;Name of the signing profile to use in issuing the certificate &nbsp; &nbsp; &nbsp; --id.affiliation string &nbsp; &nbsp; &nbsp; &nbsp;The identity&#39;s affiliation &nbsp; &nbsp; &nbsp; --id.attr string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Attributes associated with this identity (e.g. hf.Revoker=true) &nbsp; &nbsp; &nbsp; --id.maxenrollments int &nbsp; &nbsp; &nbsp; &nbsp;The maximum number of times the secret can be reused to enroll. &nbsp; &nbsp; &nbsp; --id.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unique name of the identity &nbsp; &nbsp; &nbsp; --id.secret string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The enrollment secret for the identity being registered &nbsp; &nbsp; &nbsp; --id.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type of identity being registered (e.g. &#39;peer, app, user&#39;) &nbsp; -M, --mspdir string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Membership Service Provider directory (default &quot;msp&quot;) &nbsp; -m, --myhost string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hostname to include in the certificate signing request during enrollment (default &quot;0f86c3e1cf15&quot;) &nbsp; &nbsp; &nbsp; --tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem) &nbsp; &nbsp; &nbsp; --tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled &nbsp; &nbsp; &nbsp; --tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL of 以太坊代币-ca-server (default &quot;http://localhost:7054&quot;) Use &quot;以太坊代币-ca-client [command] --help&quot; for more information about a command. 4.1启动用户登记 4.1.1 指令介绍 #以太坊代币-ca-client enroll -u&nbsp; 登记启动用户会在用户的home路径下生成登记证书文件ECert。 4.1.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://admin:adminpw@localhost:8888 2017/03/21 08:59:09 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml 2017/03/21 08:59:09 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml 2017/03/21 08:59:09 Initialize BCCSP [SW] 2017/03/21 08:59:09 [INFO] received CSR 2017/03/21 08:59:09 [INFO] generating key: ECDSA-256 2017/03/21 08:59:09 [INFO] encoded CSR 2017/03/21 08:59:09 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/msp/keystore/key.pem 2017/03/21 08:59:09 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/msp/signcerts/cert.pem 2017/03/21 08:59:09 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/msp/cacerts/.pem 4.2 新身份注册 4.2.1 指令介绍 # 以太坊代币-ca-client register 在注册阶段，server端需要检查被注册对象的两方面内容： 1 被注册的对象的角色一定要在预先配置的“hf.Registrar.Roles”属性中约定的范围内。比如，如果“hf.Registrar.Roles”约定的角色包括“peer”和“client”，那么被注册对象就只能是这两个角色中的一个，如果被注册对象的角色为“user”，那么注册就不能被通过。 2 被注册对象的从属关系参数一定要归属于预先配置的组织属性。换句话说，被注册对象的affiliation参数一定要是预先配置的affiliation参数的一个前缀。例如，假设预先配置的组织关系为：“a.b.c”，那么新注册的对象的affiliation属性可以是“a.b.c”，也可以是“a.b”，但“a.c”就不能通过注册。 下面是id配置的一个示例： id: &nbsp; name: MyPeer1 &nbsp; type: peer &nbsp; affiliation: org1.department1 &nbsp; attributes: &nbsp; &nbsp; - name: SomeAttrName &nbsp; &nbsp; &nbsp; value: SomeAttrValue &nbsp; &nbsp; - name: foo &nbsp; &nbsp; &nbsp; value: bar 如果想要在后面允许对这个ID进行注销，在这里配置的attributes中要包含“hf.Revoker”，即： &nbsp; attributes: &nbsp; &nbsp; - name: hf.Revoker &nbsp; &nbsp; &nbsp; value: true 4.2.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client register --id.name cliTest00 2017/03/21 09:05:16 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:05:16 Initialize BCCSP [SW] 2017/03/21 09:05:16 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml Password: oLtPkJRCzdTH 这里随机生成了一个Password，将在后面的节点登记中用到。 在指令中使用flag来临时自定义用户名和密码：--id.name &lt;用户名&gt; --id.secret &lt;密码&gt; 4.3 节点身份登记 4.3.1 指令介绍 官方文档上说，在节点身份登记之前，要先指定以太坊代币_CA_CERT_FILE和以太坊代币_CA_KEY_FILE两个环境变量，生成的peer.pem和key.pem两个证书文件作为TCert。但是我的试验中，生成的证书文件路径仍然是在以太坊代币_CA_CLIENT_HOME相应的路径下，不知是否是仍然存在的bug。 # export 以太坊代币_CA_CERT_FILE=$MSP_DIR/signcerts/peer.pem # export 以太坊代币_CA_KEY_FILE=$MSP_DIR/keystore/key.pem 以太坊代币-ca client enroll -u http://&lt;peer ID&gt;:&lt;password&gt;@localhost:port 这里Peer ID为注册时的id name，password为上文提到的注册时生成的密码。 4.3.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://cliTest00:oLtPkJRCzdTH@localhost:8888 2017/03/21 09:07:48 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:07:48 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:07:48 Initialize BCCSP [SW] 2017/03/21 09:07:48 [INFO] received CSR 2017/03/21 09:07:48 [INFO] generating key: ecdsa-256 2017/03/21 09:07:48 [INFO] encoded CSR 2017/03/21 09:07:48 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem 2017/03/21 09:07:48 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem 2017/03/21 09:07:48 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem 4.4 身份重登记 4.4.1 指令介绍 # 以太坊代币-ca-client reenroll 当登记的身份过期时，可以利用reenroll命令对身份进行重新登记。注意，这个指令后面不能添加登记的名称和密码，只是按照之前配置好的内容进行重新登记。 4.4.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client reenroll 2017/03/21 10:11:36 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 10:11:36 Initialize BCCSP [SW] 2017/03/21 10:11:36 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 10:11:36 [INFO] received CSR 2017/03/21 10:11:36 [INFO] generating key: ecdsa-256 2017/03/21 10:11:37 [INFO] encoded CSR 2017/03/21 10:11:37 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem 2017/03/21 10:11:37 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem 2017/03/21 10:11:37 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem 4.5 证书或身份撤销 4.5.1 指令介绍 Usage: &nbsp; 以太坊代币-ca-client revoke [flags] Flags: &nbsp; -a, --aki string &nbsp; &nbsp; &nbsp;AKI &nbsp; -e, --eid string &nbsp; &nbsp; &nbsp;Enrollment ID (Optional) &nbsp; -r, --reason string &nbsp; Reason for revoking &nbsp; -s, --serial string &nbsp; Serial Number 官方给出的说明有些错误，被标（Optional）的应该是“Reason for revoking”部分。实际上，要求指令后面的flag内容为下面两种格式中的一种： 以太坊代币-ca-client revoke -a xxx -s yyy -r &lt;reason&gt; 或 以太坊代币-ca-client revoke -e &lt;enrollment_id&gt; -r &lt;reason&gt; 支持的&lt;reason&gt;包括： Reasons: - unspecified - keycompromise - cacompromise - affiliationchange - superseded - cessationofoperation - certificatehold - removefromcrl - privilegewithdrawn - aacompromise AKI（Authority Key Identifier）和Serial Number都是在身份登记后生成的cert.pem文件中。我们需要对这个文件进行解析。可以使用OpenSSL进行解析： root@xiao-virtual-machine:/home/xiao/test/以太坊代币-ca/clients/admin/msp/signcerts# openssl x509 -in cert.pem -text -noout -serial Certificate: &nbsp; &nbsp; Data: &nbsp; &nbsp; &nbsp; &nbsp; Version: 3 (0x2) &nbsp; &nbsp; &nbsp; &nbsp; Serial Number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4a:ad:ce:89:16:9d:36:23:99:c5:37:7a:e9:2b:06:d7:8a:f3:f3:da &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256 &nbsp; &nbsp; &nbsp; &nbsp; Issuer: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=以太坊代币-ca-server &nbsp; &nbsp; &nbsp; &nbsp; Validity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not Before: Mar 21 09:21:00 2017 GMT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not After : Feb 17 17:21:00 2018 GMT &nbsp; &nbsp; &nbsp; &nbsp; Subject: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=test001 &nbsp; &nbsp; &nbsp; &nbsp; Subject Public Key Info: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public Key Algorithm: id-ecPublicKey &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public-Key: (256 bit) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pub:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:8a:ff:a4:44:2c:10:e5:4c:4e:7d:7d:0f:bb:28: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa:c0:30:b8:53:2c:0d:1d:26:92:c9:85:7c:0d:24: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7a:c0:25:5c:18:c9:f7:fa:d2:53:e9:00:00:99:d1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:30:a1:d5:dd:a1:3c:30:37:5a:f9:70:e5:aa:6e: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 89:6c:54:ad:18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ASN1 OID: prime256v1 &nbsp; &nbsp; &nbsp; &nbsp; X509v3 extensions: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Key Usage: critical &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Certificate Sign &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Basic Constraints: critical &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA:FALSE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Key Identifier:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6F:76:CA:12:7D:20:5F:27:6F:93:55:15:48:F1:32:6C:83:2A:F6:03 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Authority Key Identifier:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyid:A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Alternative Name:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DNS:38cdca9067ac &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30:46:02:21:00:a6:3e:33:78:e2:59:8c:e2:ba:6f:0f:7b:01: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;66:5d:67:08:af:81:de:1b:47:20:c1:00:e5:11:ba:1e:7a:f1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f2:02:21:00:95:1a:31:06:6e:ab:cd:91:85:02:38:8c:72:87: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;70:8e:e5:bc:7d:a8:0f:05:a1:55:60:c9:49:a0:72:1d:a1:11 serial=4AADCE89169D362399C5377AE92B06D78AF3F3DA 这里，AKI为 A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43 (需要去除冒号），Serial Number为 4AADCE89169D362399C5377AE92B06D78AF3F3DA 4.5.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client revoke -e test01 &nbsp;&nbsp; 2017/03/21 11:11:05 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 11:11:05 Initialize BCCSP [SW] 2017/03/21 11:11:05 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 11:11:05 [INFO] Revocation was successful 这里只是表述了通过eid进行撤销的方式，另一种方法总是不能成功，与Hyperledger项目组的成员沟通后，说是存在bug，目前仍在修复中。所以这里暂且不表。 5. 其他 5.1 优先级 命令执行的优先级从高到低依次是： 1 命令行flag 2 环境变量 3 配置文件 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-18T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"区块链爱好者（QQ：53016353） 1. 整体概览 在以太坊代币 1.0版本中，原0.6版本中的“Membership Service”已经被“以太坊代币 CA”所替代。 以太坊代币 CA是Hyperledger 以太坊代币的证书颁发机构，它提供的功能如下： 1）身份的注册，或连接到LDAP作为用户注册表; 2）发放登记证书（ECerts）; 3）发布交易证书（TCerts），在Hyperledger 以太坊代币 blockchain上进行交易时提供匿名性和不可链接性; 4）证书更新和撤销。 以太坊代币 CA包含一个client端和一个server端。在以太坊代币 1.0版本中，CA可以脱离Docker镜像，作为一个独立的服务来运行。若使用docker启动，所有的CA服务都是在一个专门的镜像（名称类似于“ca”）中进行执行。 以太坊代币 CA提供了两种访问方式调用Server服务，一种是通过Client调用，另一种是通过SDK调用。两种调用都是REST风格的。SDK的API接口位于以太坊代币-ca工程的 以太坊代币-ca/swagger/swagger-以太坊代币-ca.json。本文使用的是通过Client调用。 1.1 以太坊代币 CA整体架构图 [1] Server端由一个集群组成，包括前端的一个高可用的代理服务器，连接着若干个CA Server集群，这些集群将数据共同存放在同一个数据服务器上。数据库可能是MySQL、LDAP、PostgresSQL或者SQLite。 1.2 以太坊代币 CA运行流程的时序图 具体步骤包括： 1) Server端初始化 2) CA根证书生成 3) Server端启动服务 4) Client端向Server端请求登记 5) Server端向Client端返回登记证书ECert 6) Client端向Server端请求注册节点 7) Server端向Client端返回节点注册信息结果 8) Client端向Server端请求登记节点 9) Server端生成TCert，存入数据库 10) Server端向Client端返回登记结果 2. 安装 2.1 Dokcer启动 2.1.1 拉取镜像 docker pull hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha 2.1.2 使用Docker-Compose启动 将下部分代码添加到 中的service中，使用 docker-compose up 启动ca服务节点 &nbsp; ca: &nbsp; &nbsp; image: hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha &nbsp; &nbsp; container_name: 以太坊代币-ca &nbsp; &nbsp; ports: &nbsp; &nbsp; &nbsp; - &quot;8888:8888&quot; &nbsp; &nbsp; environment: &nbsp; &nbsp; &nbsp; - 以太坊代币_CA_HOME=/etc/hyperledger/以太坊代币-ca &nbsp; &nbsp; volumes: &nbsp; &nbsp; &nbsp; - &quot;./以太坊代币-ca:/etc/hyperledger/以太坊代币-ca&quot; &nbsp; &nbsp; command: sh -c &#39;以太坊代币-ca-server start -b admin:adminpw&#39; 2.2 Native启动 2.2.1前提条件 - Go 1.7版本或以上 - GOPATH环境配置正确 - 安装libtool和libtdhl-dev 2.2.2 安装方法 可直接使用“go get”命令进行安装。“go get”相当于“git clone”+“go install” #go get -u github.com/hyperledger/以太坊代币-ca/cmd/... 后续的操作和在Docker中类似，这里我们主要讲Docker启动的情况。 3. 以太坊代币-CA-Server 官方说明如下： Hyperledger 以太坊代币 Certificate Authority Server Usage: &nbsp; 以太坊代币-ca-server [command] Available Commands: &nbsp; init &nbsp; &nbsp; &nbsp; &nbsp;Initialize the 以太坊代币-ca server &nbsp; start &nbsp; &nbsp; &nbsp; Start the 以太坊代币-ca server Flags: &nbsp; &nbsp; &nbsp; --address string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening address of 以太坊代币-ca-server (default &quot;0.0.0.0&quot;) &nbsp; -b, --boot string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The user:pass for bootstrap admin which is required to build default config file &nbsp; &nbsp; &nbsp; --ca.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded CA certificate file (default &quot;ca-cert.pem&quot;) &nbsp; &nbsp; &nbsp; --ca.chainfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA chain file (default &quot;ca-chain.pem&quot;) &nbsp; &nbsp; &nbsp; --ca.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA key file (default &quot;ca-key.pem&quot;) &nbsp; -n, --ca.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Certificate Authority name &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configuration file (default &quot;以太坊代币-ca-server-config.yaml&quot;) &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The common name field of the certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp; &nbsp; The serial number in a certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --db.datasource string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Data source which is database specific (default &quot;以太坊代币-ca-server.db&quot;) &nbsp; &nbsp; &nbsp; --db.tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem) &nbsp; &nbsp; &nbsp; --db.tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled &nbsp; &nbsp; &nbsp; --db.tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled &nbsp; &nbsp; &nbsp; --db.tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection &nbsp; &nbsp; &nbsp; --db.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type of database; one of: sqlite3, postgres, mysql (default &quot;sqlite3&quot;) &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable debug level logging &nbsp; &nbsp; &nbsp; --ldap.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable the LDAP client for authentication and attributes &nbsp; &nbsp; &nbsp; --ldap.groupfilter string &nbsp; &nbsp; &nbsp; &nbsp; The LDAP group filter for a single affiliation group (default &quot;(memberUid=%s)&quot;) &nbsp; &nbsp; &nbsp; --ldap.url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LDAP client URL of form ldap://adminDN:adminPassword@host[:port]/base &nbsp; &nbsp; &nbsp; --ldap.userfilter string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The LDAP user filter to use when searching for users (default &quot;(uid=%s)&quot;) &nbsp; -p, --port int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening port of 以太坊代币-ca-server (default 7054) &nbsp; &nbsp; &nbsp; --registry.maxenrollments int &nbsp; &nbsp; Maximum number of enrollments; valid if LDAP not enabled &nbsp; &nbsp; &nbsp; --tls.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded TLS certificate file for server&#39;s listening port (default &quot;ca-cert.pem&quot;) &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable TLS on the listening port &nbsp; &nbsp; &nbsp; --tls.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded TLS key for server&#39;s listening port (default &quot;ca-key.pem&quot;) &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;URL of the parent 以太坊代币-ca-server Use &quot;以太坊代币-ca-server [command] --help&quot; for more information about a command. 3.1 初始化Server服务 3.1.1 指令介绍 # 以太坊代币-ca-server init -b admin:adminpw -b在这里指的是bootstrap，也就是启动加载状态。 有一个名为 以太坊代币-ca-server-config.yaml 的配置文件会在节点启动时自动生成。我们也可以根据里面的内容自定义配置CSR信息，使用 --config 文件名来进行启动配置。 CSR为“Certificate Signing Request”的缩写，即证书签名请求。 目前在keys中支持的算法和相关长度如下： 以太坊代币-CA 1.0支持MySQL、LDAP、PostgresSQL和SQLite，这里配置用的是默认的SQLite。其他配置方法暂且不表。 3.1.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server init -b admin:adminpw 2017/03/21 08:54:23 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml 2017/03/21 08:54:23 Initialize BCCSP [SW] 2017/03/21 08:54:23 [INFO] The CA key and certificate files already exist 2017/03/21 08:54:23 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem 2017/03/21 08:54:23 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem 2017/03/21 08:54:23 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db 2017/03/21 08:54:23 [INFO] Initialization was successful 3.2 启动Server服务 3.2.1 指令介绍 以太坊代币-ca-server start -b &lt;admin&gt;:&lt;adminpw&gt; 这里，默认调用的启动配置文件为以太坊代币-ca-server-config.yaml，如果需要自定义配置，还是使用 --config 文件名来进行启动配置。 成功后，server端会在预先配置的环境路径下生成相应的ca证书文件，并在配置的端口号上进行服务监听。这里我们在端口8888上进行监听。 3.2.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server start -b admin:adminpw 2017/03/21 08:54:50 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml 2017/03/21 08:54:50 Initialize BCCSP [SW] 2017/03/21 08:54:50 [INFO] The CA key and certificate files already exist 2017/03/21 08:54:50 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem 2017/03/21 08:54:50 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem 2017/03/21 08:54:50 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db 2017/03/21 08:54:50 [INFO] Listening at http://0.0.0.0:8888 4. 以太坊代币-CA-Client 官方说明如下： Hyperledger 以太坊代币 Certificate Authority Client Usage: &nbsp; 以太坊代币-ca-client [command] Available Commands: &nbsp; enroll &nbsp; &nbsp; &nbsp;Enroll user &nbsp; getcacert &nbsp; Get CA certificate chain &nbsp; reenroll &nbsp; &nbsp;Reenroll user &nbsp; register &nbsp; &nbsp;Register user &nbsp; revoke &nbsp; &nbsp; &nbsp;Revoke user Flags: &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Configuration file (default &quot;/etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml&quot;) &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The common name field of the certificate signing request to a parent 以太坊代币-ca-server &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp;The serial number in a certificate signing request to a parent 以太坊代币-ca-server &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable debug level logging &nbsp; &nbsp; &nbsp; --enrollment.hosts string &nbsp; &nbsp; &nbsp;Comma-separated host list &nbsp; &nbsp; &nbsp; --enrollment.label string &nbsp; &nbsp; &nbsp;Label to use in HSM operations &nbsp; &nbsp; &nbsp; --enrollment.profile string &nbsp; &nbsp;Name of the signing profile to use in issuing the certificate &nbsp; &nbsp; &nbsp; --id.affiliation string &nbsp; &nbsp; &nbsp; &nbsp;The identity&#39;s affiliation &nbsp; &nbsp; &nbsp; --id.attr string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Attributes associated with this identity (e.g. hf.Revoker=true) &nbsp; &nbsp; &nbsp; --id.maxenrollments int &nbsp; &nbsp; &nbsp; &nbsp;The maximum number of times the secret can be reused to enroll. &nbsp; &nbsp; &nbsp; --id.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unique name of the identity &nbsp; &nbsp; &nbsp; --id.secret string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The enrollment secret for the identity being registered &nbsp; &nbsp; &nbsp; --id.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type of identity being registered (e.g. &#39;peer, app, user&#39;) &nbsp; -M, --mspdir string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Membership Service Provider directory (default &quot;msp&quot;) &nbsp; -m, --myhost string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hostname to include in the certificate signing request during enrollment (default &quot;0f86c3e1cf15&quot;) &nbsp; &nbsp; &nbsp; --tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem) &nbsp; &nbsp; &nbsp; --tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled &nbsp; &nbsp; &nbsp; --tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL of 以太坊代币-ca-server (default &quot;http://localhost:7054&quot;) Use &quot;以太坊代币-ca-client [command] --help&quot; for more information about a command. 4.1启动用户登记 4.1.1 指令介绍 #以太坊代币-ca-client enroll -u&nbsp; 登记启动用户会在用户的home路径下生成登记证书文件ECert。 4.1.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://admin:adminpw@localhost:8888 2017/03/21 08:59:09 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml 2017/03/21 08:59:09 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml 2017/03/21 08:59:09 Initialize BCCSP [SW] 2017/03/21 08:59:09 [INFO] received CSR 2017/03/21 08:59:09 [INFO] generating key: ECDSA-256 2017/03/21 08:59:09 [INFO] encoded CSR 2017/03/21 08:59:09 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/msp/keystore/key.pem 2017/03/21 08:59:09 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/msp/signcerts/cert.pem 2017/03/21 08:59:09 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/msp/cacerts/.pem 4.2 新身份注册 4.2.1 指令介绍 # 以太坊代币-ca-client register 在注册阶段，server端需要检查被注册对象的两方面内容： 1 被注册的对象的角色一定要在预先配置的“hf.Registrar.Roles”属性中约定的范围内。比如，如果“hf.Registrar.Roles”约定的角色包括“peer”和“client”，那么被注册对象就只能是这两个角色中的一个，如果被注册对象的角色为“user”，那么注册就不能被通过。 2 被注册对象的从属关系参数一定要归属于预先配置的组织属性。换句话说，被注册对象的affiliation参数一定要是预先配置的affiliation参数的一个前缀。例如，假设预先配置的组织关系为：“a.b.c”，那么新注册的对象的affiliation属性可以是“a.b.c”，也可以是“a.b”，但“a.c”就不能通过注册。 下面是id配置的一个示例： id: &nbsp; name: MyPeer1 &nbsp; type: peer &nbsp; affiliation: org1.department1 &nbsp; attributes: &nbsp; &nbsp; - name: SomeAttrName &nbsp; &nbsp; &nbsp; value: SomeAttrValue &nbsp; &nbsp; - name: foo &nbsp; &nbsp; &nbsp; value: bar 如果想要在后面允许对这个ID进行注销，在这里配置的attributes中要包含“hf.Revoker”，即： &nbsp; attributes: &nbsp; &nbsp; - name: hf.Revoker &nbsp; &nbsp; &nbsp; value: true 4.2.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client register --id.name cliTest00 2017/03/21 09:05:16 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:05:16 Initialize BCCSP [SW] 2017/03/21 09:05:16 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml Password: oLtPkJRCzdTH 这里随机生成了一个Password，将在后面的节点登记中用到。 在指令中使用flag来临时自定义用户名和密码：--id.name &lt;用户名&gt; --id.secret &lt;密码&gt; 4.3 节点身份登记 4.3.1 指令介绍 官方文档上说，在节点身份登记之前，要先指定以太坊代币_CA_CERT_FILE和以太坊代币_CA_KEY_FILE两个环境变量，生成的peer.pem和key.pem两个证书文件作为TCert。但是我的试验中，生成的证书文件路径仍然是在以太坊代币_CA_CLIENT_HOME相应的路径下，不知是否是仍然存在的bug。 # export 以太坊代币_CA_CERT_FILE=$MSP_DIR/signcerts/peer.pem # export 以太坊代币_CA_KEY_FILE=$MSP_DIR/keystore/key.pem 以太坊代币-ca client enroll -u http://&lt;peer ID&gt;:&lt;password&gt;@localhost:port 这里Peer ID为注册时的id name，password为上文提到的注册时生成的密码。 4.3.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://cliTest00:oLtPkJRCzdTH@localhost:8888 2017/03/21 09:07:48 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:07:48 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 09:07:48 Initialize BCCSP [SW] 2017/03/21 09:07:48 [INFO] received CSR 2017/03/21 09:07:48 [INFO] generating key: ecdsa-256 2017/03/21 09:07:48 [INFO] encoded CSR 2017/03/21 09:07:48 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem 2017/03/21 09:07:48 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem 2017/03/21 09:07:48 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem 4.4 身份重登记 4.4.1 指令介绍 # 以太坊代币-ca-client reenroll 当登记的身份过期时，可以利用reenroll命令对身份进行重新登记。注意，这个指令后面不能添加登记的名称和密码，只是按照之前配置好的内容进行重新登记。 4.4.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client reenroll 2017/03/21 10:11:36 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 10:11:36 Initialize BCCSP [SW] 2017/03/21 10:11:36 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 10:11:36 [INFO] received CSR 2017/03/21 10:11:36 [INFO] generating key: ecdsa-256 2017/03/21 10:11:37 [INFO] encoded CSR 2017/03/21 10:11:37 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem 2017/03/21 10:11:37 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem 2017/03/21 10:11:37 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem 4.5 证书或身份撤销 4.5.1 指令介绍 Usage: &nbsp; 以太坊代币-ca-client revoke [flags] Flags: &nbsp; -a, --aki string &nbsp; &nbsp; &nbsp;AKI &nbsp; -e, --eid string &nbsp; &nbsp; &nbsp;Enrollment ID (Optional) &nbsp; -r, --reason string &nbsp; Reason for revoking &nbsp; -s, --serial string &nbsp; Serial Number 官方给出的说明有些错误，被标（Optional）的应该是“Reason for revoking”部分。实际上，要求指令后面的flag内容为下面两种格式中的一种： 以太坊代币-ca-client revoke -a xxx -s yyy -r &lt;reason&gt; 或 以太坊代币-ca-client revoke -e &lt;enrollment_id&gt; -r &lt;reason&gt; 支持的&lt;reason&gt;包括： Reasons: - unspecified - keycompromise - cacompromise - affiliationchange - superseded - cessationofoperation - certificatehold - removefromcrl - privilegewithdrawn - aacompromise AKI（Authority Key Identifier）和Serial Number都是在身份登记后生成的cert.pem文件中。我们需要对这个文件进行解析。可以使用OpenSSL进行解析： root@xiao-virtual-machine:/home/xiao/test/以太坊代币-ca/clients/admin/msp/signcerts# openssl x509 -in cert.pem -text -noout -serial Certificate: &nbsp; &nbsp; Data: &nbsp; &nbsp; &nbsp; &nbsp; Version: 3 (0x2) &nbsp; &nbsp; &nbsp; &nbsp; Serial Number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4a:ad:ce:89:16:9d:36:23:99:c5:37:7a:e9:2b:06:d7:8a:f3:f3:da &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256 &nbsp; &nbsp; &nbsp; &nbsp; Issuer: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=以太坊代币-ca-server &nbsp; &nbsp; &nbsp; &nbsp; Validity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not Before: Mar 21 09:21:00 2017 GMT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not After : Feb 17 17:21:00 2018 GMT &nbsp; &nbsp; &nbsp; &nbsp; Subject: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=test001 &nbsp; &nbsp; &nbsp; &nbsp; Subject Public Key Info: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public Key Algorithm: id-ecPublicKey &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public-Key: (256 bit) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pub:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:8a:ff:a4:44:2c:10:e5:4c:4e:7d:7d:0f:bb:28: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa:c0:30:b8:53:2c:0d:1d:26:92:c9:85:7c:0d:24: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7a:c0:25:5c:18:c9:f7:fa:d2:53:e9:00:00:99:d1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:30:a1:d5:dd:a1:3c:30:37:5a:f9:70:e5:aa:6e: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 89:6c:54:ad:18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ASN1 OID: prime256v1 &nbsp; &nbsp; &nbsp; &nbsp; X509v3 extensions: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Key Usage: critical &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Certificate Sign &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Basic Constraints: critical &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA:FALSE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Key Identifier:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6F:76:CA:12:7D:20:5F:27:6F:93:55:15:48:F1:32:6C:83:2A:F6:03 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Authority Key Identifier:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyid:A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Alternative Name:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DNS:38cdca9067ac &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30:46:02:21:00:a6:3e:33:78:e2:59:8c:e2:ba:6f:0f:7b:01: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;66:5d:67:08:af:81:de:1b:47:20:c1:00:e5:11:ba:1e:7a:f1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f2:02:21:00:95:1a:31:06:6e:ab:cd:91:85:02:38:8c:72:87: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;70:8e:e5:bc:7d:a8:0f:05:a1:55:60:c9:49:a0:72:1d:a1:11 serial=4AADCE89169D362399C5377AE92B06D78AF3F3DA 这里，AKI为 A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43 (需要去除冒号），Serial Number为 4AADCE89169D362399C5377AE92B06D78AF3F3DA 4.5.2 示例 root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client revoke -e test01 &nbsp;&nbsp; 2017/03/21 11:11:05 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 11:11:05 Initialize BCCSP [SW] 2017/03/21 11:11:05 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml 2017/03/21 11:11:05 [INFO] Revocation was successful 这里只是表述了通过eid进行撤销的方式，另一种方法总是不能成功，与Hyperledger项目组的成员沟通后，说是存在bug，目前仍在修复中。所以这里暂且不表。 5. 其他 5.1 优先级 命令执行的优先级从高到低依次是： 1 命令行flag 2 环境变量 3 配置文件 阅读更多","@type":"BlogPosting","url":"/2017/11/18/aff696e6f251a70b52efb68a3955b983.html","headline":"以太坊代币2.0开发原生态智能合约数字货币系统","dateModified":"2017-11-18T00:00:00+08:00","datePublished":"2017-11-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/11/18/aff696e6f251a70b52efb68a3955b983.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>以太坊代币2.0开发原生态智能合约数字货币系统</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p style="text-align:center;"><span style="color:rgb(102,102,102);font-family:Arial;font-size:14px;line-height:24px;text-indent:28px;">区块链爱好者（QQ：53016353）</span><br></p> 
  <p>1. 整体概览</p> 
  <br>
  <br> 在以太坊代币 1.0版本中，原0.6版本中的“Membership Service”已经被“以太坊代币 CA”所替代。
  <br>
  <br>
  <br> 以太坊代币 CA是Hyperledger 以太坊代币的证书颁发机构，它提供的功能如下：
  <br> 1）身份的注册，或连接到LDAP作为用户注册表;
  <br> 2）发放登记证书（ECerts）;
  <br> 3）发布交易证书（TCerts），在Hyperledger 以太坊代币 blockchain上进行交易时提供匿名性和不可链接性;
  <br> 4）证书更新和撤销。
  <br>
  <br>
  <br> 以太坊代币 CA包含一个client端和一个server端。在以太坊代币 1.0版本中，CA可以脱离Docker镜像，作为一个独立的服务来运行。若使用docker启动，所有的CA服务都是在一个专门的镜像（名称类似于“ca”）中进行执行。
  <br>
  <br>
  <br> 以太坊代币 CA提供了两种访问方式调用Server服务，一种是通过Client调用，另一种是通过SDK调用。两种调用都是REST风格的。SDK的API接口位于以太坊代币-ca工程的 以太坊代币-ca/swagger/swagger-以太坊代币-ca.json。本文使用的是通过Client调用。
  <br>
  <br>
  <br> 1.1 以太坊代币 CA整体架构图
  <br>
  <br>
  <br>
  <br>
  <br> [1]
  <br>
  <br>
  <br> Server端由一个集群组成，包括前端的一个高可用的代理服务器，连接着若干个CA Server集群，这些集群将数据共同存放在同一个数据服务器上。数据库可能是MySQL、LDAP、PostgresSQL或者SQLite。
  <br>
  <br>
  <br> 1.2 以太坊代币 CA运行流程的时序图
  <br>
  <br>
  <br>
  <br>
  <br> 具体步骤包括：
  <br>
  <br>
  <br> 1) Server端初始化
  <br> 2) CA根证书生成
  <br> 3) Server端启动服务
  <br> 4) Client端向Server端请求登记
  <br> 5) Server端向Client端返回登记证书ECert
  <br> 6) Client端向Server端请求注册节点
  <br> 7) Server端向Client端返回节点注册信息结果
  <br> 8) Client端向Server端请求登记节点
  <br> 9) Server端生成TCert，存入数据库
  <br> 10) Server端向Client端返回登记结果
  <br>
  <br>
  <br>
  <br>
  <br> 2. 安装
  <br>
  <br>
  <br> 2.1 Dokcer启动
  <br>
  <br>
  <br> 2.1.1 拉取镜像
  <br>
  <br>
  <br> docker pull hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha
  <br>
  <br>
  <br> 2.1.2 使用Docker-Compose启动
  <br>
  <br>
  <br> 将下部分代码添加到 中的service中，使用 docker-compose up 启动ca服务节点
  <br>
  <br>
  <br> &nbsp; ca:
  <br> &nbsp; &nbsp; image: hyperledger/以太坊代币-ca:x86_64-1.0.0-alpha
  <br> &nbsp; &nbsp; container_name: 以太坊代币-ca
  <br> &nbsp; &nbsp; ports:
  <br> &nbsp; &nbsp; &nbsp; - "8888:8888"
  <br> &nbsp; &nbsp; environment:
  <br> &nbsp; &nbsp; &nbsp; - 以太坊代币_CA_HOME=/etc/hyperledger/以太坊代币-ca
  <br> &nbsp; &nbsp; volumes:
  <br> &nbsp; &nbsp; &nbsp; - "./以太坊代币-ca:/etc/hyperledger/以太坊代币-ca"
  <br> &nbsp; &nbsp; command: sh -c '以太坊代币-ca-server start -b admin:adminpw'
  <br>
  <br>
  <br> 2.2 Native启动
  <br>
  <br>
  <br> 2.2.1前提条件
  <br>
  <br>
  <br> - Go 1.7版本或以上
  <br> - GOPATH环境配置正确
  <br> - 安装libtool和libtdhl-dev
  <br>
  <br>
  <br> 2.2.2 安装方法
  <br>
  <br>
  <br> 可直接使用“go get”命令进行安装。“go get”相当于“git clone”+“go install”
  <br>
  <br>
  <br> #go get -u github.com/hyperledger/以太坊代币-ca/cmd/...
  <br>
  <br>
  <br> 后续的操作和在Docker中类似，这里我们主要讲Docker启动的情况。
  <br>
  <br>
  <br> 3. 以太坊代币-CA-Server
  <br>
  <br>
  <br> 官方说明如下：
  <br>
  <br>
  <br> Hyperledger 以太坊代币 Certificate Authority Server
  <br>
  <br>
  <br> Usage:
  <br> &nbsp; 以太坊代币-ca-server [command]
  <br>
  <br>
  <br> Available Commands:
  <br> &nbsp; init &nbsp; &nbsp; &nbsp; &nbsp;Initialize the 以太坊代币-ca server
  <br> &nbsp; start &nbsp; &nbsp; &nbsp; Start the 以太坊代币-ca server
  <br>
  <br>
  <br> Flags:
  <br> &nbsp; &nbsp; &nbsp; --address string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening address of 以太坊代币-ca-server (default "0.0.0.0")
  <br> &nbsp; -b, --boot string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The user:pass for bootstrap admin which is required to build default config file
  <br> &nbsp; &nbsp; &nbsp; --ca.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded CA certificate file (default "ca-cert.pem")
  <br> &nbsp; &nbsp; &nbsp; --ca.chainfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA chain file (default "ca-chain.pem")
  <br> &nbsp; &nbsp; &nbsp; --ca.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded CA key file (default "ca-key.pem")
  <br> &nbsp; -n, --ca.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Certificate Authority name
  <br> &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configuration file (default "以太坊代币-ca-server-config.yaml")
  <br> &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The common name field of the certificate signing request to a parent 以太坊代币-ca-server
  <br> &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp; &nbsp; The serial number in a certificate signing request to a parent 以太坊代币-ca-server
  <br> &nbsp; &nbsp; &nbsp; --db.datasource string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Data source which is database specific (default "以太坊代币-ca-server.db")
  <br> &nbsp; &nbsp; &nbsp; --db.tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem)
  <br> &nbsp; &nbsp; &nbsp; --db.tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled
  <br> &nbsp; &nbsp; &nbsp; --db.tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled
  <br> &nbsp; &nbsp; &nbsp; --db.tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection
  <br> &nbsp; &nbsp; &nbsp; --db.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type of database; one of: sqlite3, postgres, mysql (default "sqlite3")
  <br> &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable debug level logging
  <br> &nbsp; &nbsp; &nbsp; --ldap.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable the LDAP client for authentication and attributes
  <br> &nbsp; &nbsp; &nbsp; --ldap.groupfilter string &nbsp; &nbsp; &nbsp; &nbsp; The LDAP group filter for a single affiliation group (default "(memberUid=%s)")
  <br> &nbsp; &nbsp; &nbsp; --ldap.url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LDAP client URL of form ldap://adminDN:adminPassword@host[:port]/base
  <br> &nbsp; &nbsp; &nbsp; --ldap.userfilter string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The LDAP user filter to use when searching for users (default "(uid=%s)")
  <br> &nbsp; -p, --port int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Listening port of 以太坊代币-ca-server (default 7054)
  <br> &nbsp; &nbsp; &nbsp; --registry.maxenrollments int &nbsp; &nbsp; Maximum number of enrollments; valid if LDAP not enabled
  <br> &nbsp; &nbsp; &nbsp; --tls.certfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded TLS certificate file for server's listening port (default "ca-cert.pem")
  <br> &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable TLS on the listening port
  <br> &nbsp; &nbsp; &nbsp; --tls.keyfile string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PEM-encoded TLS key for server's listening port (default "ca-key.pem")
  <br> &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;URL of the parent 以太坊代币-ca-server
  <br>
  <br>
  <br> Use "以太坊代币-ca-server [command] --help" for more information about a command.
  <br>
  <br>
  <br> 3.1 初始化Server服务
  <br>
  <br>
  <br> 3.1.1 指令介绍
  <br>
  <br>
  <br> # 以太坊代币-ca-server init -b admin:adminpw
  <br>
  <br>
  <br> -b在这里指的是bootstrap，也就是启动加载状态。
  <br>
  <br>
  <br> 有一个名为 以太坊代币-ca-server-config.yaml 的配置文件会在节点启动时自动生成。我们也可以根据里面的内容自定义配置CSR信息，使用 --config 文件名来进行启动配置。
  <br>
  <br>
  <br> CSR为“Certificate Signing Request”的缩写，即证书签名请求。
  <br>
  <br>
  <br> 目前在keys中支持的算法和相关长度如下：
  <br>
  <br>
  <br>
  <br>
  <br> 以太坊代币-CA 1.0支持MySQL、LDAP、PostgresSQL和SQLite，这里配置用的是默认的SQLite。其他配置方法暂且不表。
  <br>
  <br>
  <br> 3.1.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server init -b admin:adminpw
  <br> 2017/03/21 08:54:23 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml
  <br> 2017/03/21 08:54:23 Initialize BCCSP [SW]
  <br> 2017/03/21 08:54:23 [INFO] The CA key and certificate files already exist
  <br> 2017/03/21 08:54:23 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem
  <br> 2017/03/21 08:54:23 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem
  <br> 2017/03/21 08:54:23 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db
  <br> 2017/03/21 08:54:23 [INFO] Initialization was successful
  <br>
  <br>
  <br> 3.2 启动Server服务
  <br>
  <br>
  <br> 3.2.1 指令介绍
  <br>
  <br>
  <br> 以太坊代币-ca-server start -b &lt;admin&gt;:&lt;adminpw&gt;
  <br>
  <br>
  <br> 这里，默认调用的启动配置文件为以太坊代币-ca-server-config.yaml，如果需要自定义配置，还是使用 --config 文件名来进行启动配置。
  <br> 成功后，server端会在预先配置的环境路径下生成相应的ca证书文件，并在配置的端口号上进行服务监听。这里我们在端口8888上进行监听。
  <br>
  <br>
  <br> 3.2.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-server start -b admin:adminpw
  <br> 2017/03/21 08:54:50 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server-config.yaml
  <br> 2017/03/21 08:54:50 Initialize BCCSP [SW]
  <br> 2017/03/21 08:54:50 [INFO] The CA key and certificate files already exist
  <br> 2017/03/21 08:54:50 [INFO] Key file location: /etc/hyperledger/以太坊代币-ca/ca-key.pem
  <br> 2017/03/21 08:54:50 [INFO] Certificate file location: /etc/hyperledger/以太坊代币-ca/ca-cert.pem
  <br> 2017/03/21 08:54:50 [INFO] Initialized sqlite3 data base at /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-server.db
  <br> 2017/03/21 08:54:50 [INFO] Listening at http://0.0.0.0:8888
  <br>
  <br>
  <br> 4. 以太坊代币-CA-Client
  <br>
  <br>
  <br> 官方说明如下：
  <br>
  <br>
  <br> Hyperledger 以太坊代币 Certificate Authority Client
  <br>
  <br>
  <br> Usage:
  <br> &nbsp; 以太坊代币-ca-client [command]
  <br>
  <br>
  <br> Available Commands:
  <br> &nbsp; enroll &nbsp; &nbsp; &nbsp;Enroll user
  <br> &nbsp; getcacert &nbsp; Get CA certificate chain
  <br> &nbsp; reenroll &nbsp; &nbsp;Reenroll user
  <br> &nbsp; register &nbsp; &nbsp;Register user
  <br> &nbsp; revoke &nbsp; &nbsp; &nbsp;Revoke user
  <br>
  <br>
  <br> Flags:
  <br> &nbsp; -c, --config string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Configuration file (default "/etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml")
  <br> &nbsp; &nbsp; &nbsp; --csr.cn string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The common name field of the certificate signing request to a parent 以太坊代币-ca-server
  <br> &nbsp; &nbsp; &nbsp; --csr.serialnumber string &nbsp; &nbsp; &nbsp;The serial number in a certificate signing request to a parent 以太坊代币-ca-server
  <br> &nbsp; -d, --debug &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable debug level logging
  <br> &nbsp; &nbsp; &nbsp; --enrollment.hosts string &nbsp; &nbsp; &nbsp;Comma-separated host list
  <br> &nbsp; &nbsp; &nbsp; --enrollment.label string &nbsp; &nbsp; &nbsp;Label to use in HSM operations
  <br> &nbsp; &nbsp; &nbsp; --enrollment.profile string &nbsp; &nbsp;Name of the signing profile to use in issuing the certificate
  <br> &nbsp; &nbsp; &nbsp; --id.affiliation string &nbsp; &nbsp; &nbsp; &nbsp;The identity's affiliation
  <br> &nbsp; &nbsp; &nbsp; --id.attr string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Attributes associated with this identity (e.g. hf.Revoker=true)
  <br> &nbsp; &nbsp; &nbsp; --id.maxenrollments int &nbsp; &nbsp; &nbsp; &nbsp;The maximum number of times the secret can be reused to enroll.
  <br> &nbsp; &nbsp; &nbsp; --id.name string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unique name of the identity
  <br> &nbsp; &nbsp; &nbsp; --id.secret string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The enrollment secret for the identity being registered
  <br> &nbsp; &nbsp; &nbsp; --id.type string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type of identity being registered (e.g. 'peer, app, user')
  <br> &nbsp; -M, --mspdir string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Membership Service Provider directory (default "msp")
  <br> &nbsp; -m, --myhost string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hostname to include in the certificate signing request during enrollment (default "0f86c3e1cf15")
  <br> &nbsp; &nbsp; &nbsp; --tls.certfiles string &nbsp; &nbsp; &nbsp; &nbsp; PEM-encoded comma separated list of trusted certificate files (e.g. root1.pem, root2.pem)
  <br> &nbsp; &nbsp; &nbsp; --tls.client.certfile string &nbsp; PEM-encoded certificate file when mutual authenticate is enabled
  <br> &nbsp; &nbsp; &nbsp; --tls.client.keyfile string &nbsp; &nbsp;PEM-encoded key file when mutual authentication is enabled
  <br> &nbsp; &nbsp; &nbsp; --tls.enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Enable TLS for client connection
  <br> &nbsp; -u, --url string &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL of 以太坊代币-ca-server (default "http://localhost:7054")
  <br>
  <br>
  <br> Use "以太坊代币-ca-client [command] --help" for more information about a command.
  <br>
  <br>
  <br> 4.1启动用户登记
  <br>
  <br>
  <br> 4.1.1 指令介绍
  <br>
  <br>
  <br> #以太坊代币-ca-client enroll -u&nbsp;
  <br>
  <br>
  <br> 登记启动用户会在用户的home路径下生成登记证书文件ECert。
  <br>
  <br>
  <br> 4.1.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://admin:adminpw@localhost:8888
  <br> 2017/03/21 08:59:09 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 08:59:09 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 08:59:09 Initialize BCCSP [SW]
  <br> 2017/03/21 08:59:09 [INFO] received CSR
  <br> 2017/03/21 08:59:09 [INFO] generating key: ECDSA-256
  <br> 2017/03/21 08:59:09 [INFO] encoded CSR
  <br> 2017/03/21 08:59:09 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/msp/keystore/key.pem
  <br> 2017/03/21 08:59:09 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/msp/signcerts/cert.pem
  <br> 2017/03/21 08:59:09 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/msp/cacerts/.pem
  <br>
  <br>
  <br> 4.2 新身份注册
  <br>
  <br>
  <br> 4.2.1 指令介绍
  <br>
  <br>
  <br> # 以太坊代币-ca-client register
  <br>
  <br>
  <br> 在注册阶段，server端需要检查被注册对象的两方面内容：
  <br>
  <br>
  <br>
  <span></span>1 被注册的对象的角色一定要在预先配置的“hf.Registrar.Roles”属性中约定的范围内。比如，如果“hf.Registrar.Roles”约定的角色包括“peer”和“client”，那么被注册对象就只能是这两个角色中的一个，如果被注册对象的角色为“user”，那么注册就不能被通过。
  <br>
  <span></span>
  <br>
  <span></span>2 被注册对象的从属关系参数一定要归属于预先配置的组织属性。换句话说，被注册对象的affiliation参数一定要是预先配置的affiliation参数的一个前缀。例如，假设预先配置的组织关系为：“a.b.c”，那么新注册的对象的affiliation属性可以是“a.b.c”，也可以是“a.b”，但“a.c”就不能通过注册。
  <br> 下面是id配置的一个示例：
  <br>
  <br>
  <br> id:
  <br> &nbsp; name: MyPeer1
  <br> &nbsp; type: peer
  <br> &nbsp; affiliation: org1.department1
  <br> &nbsp; attributes:
  <br> &nbsp; &nbsp; - name: SomeAttrName
  <br> &nbsp; &nbsp; &nbsp; value: SomeAttrValue
  <br> &nbsp; &nbsp; - name: foo
  <br> &nbsp; &nbsp; &nbsp; value: bar
  <br>
  <br>
  <br> 如果想要在后面允许对这个ID进行注销，在这里配置的attributes中要包含“hf.Revoker”，即：
  <br>
  <br>
  <br> &nbsp; attributes:
  <br> &nbsp; &nbsp; - name: hf.Revoker
  <br> &nbsp; &nbsp; &nbsp; value: true
  <br>
  <br>
  <br> 4.2.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client register --id.name cliTest00
  <br> 2017/03/21 09:05:16 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 09:05:16 Initialize BCCSP [SW]
  <br> 2017/03/21 09:05:16 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> Password: oLtPkJRCzdTH
  <br>
  <br>
  <br> 这里随机生成了一个Password，将在后面的节点登记中用到。
  <br> 在指令中使用flag来临时自定义用户名和密码：--id.name &lt;用户名&gt; --id.secret &lt;密码&gt;
  <br>
  <br>
  <br> 4.3 节点身份登记
  <br>
  <br>
  <br> 4.3.1 指令介绍
  <br>
  <br>
  <br> 官方文档上说，在节点身份登记之前，要先指定以太坊代币_CA_CERT_FILE和以太坊代币_CA_KEY_FILE两个环境变量，生成的peer.pem和key.pem两个证书文件作为TCert。但是我的试验中，生成的证书文件路径仍然是在以太坊代币_CA_CLIENT_HOME相应的路径下，不知是否是仍然存在的bug。
  <br>
  <br>
  <br> # export 以太坊代币_CA_CERT_FILE=$MSP_DIR/signcerts/peer.pem
  <br> # export 以太坊代币_CA_KEY_FILE=$MSP_DIR/keystore/key.pem
  <br> 以太坊代币-ca client enroll -u http://&lt;peer ID&gt;:&lt;password&gt;@localhost:port
  <br>
  <br>
  <br> 这里Peer ID为注册时的id name，password为上文提到的注册时生成的密码。
  <br>
  <br>
  <br> 4.3.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client enroll -u http://cliTest00:oLtPkJRCzdTH@localhost:8888
  <br> 2017/03/21 09:07:48 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 09:07:48 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 09:07:48 Initialize BCCSP [SW]
  <br> 2017/03/21 09:07:48 [INFO] received CSR
  <br> 2017/03/21 09:07:48 [INFO] generating key: ecdsa-256
  <br> 2017/03/21 09:07:48 [INFO] encoded CSR
  <br> 2017/03/21 09:07:48 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem
  <br> 2017/03/21 09:07:48 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem
  <br> 2017/03/21 09:07:48 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem
  <br>
  <br>
  <br> 4.4 身份重登记
  <br>
  <br>
  <br> 4.4.1 指令介绍
  <br>
  <br>
  <br> # 以太坊代币-ca-client reenroll
  <br>
  <br>
  <br> 当登记的身份过期时，可以利用reenroll命令对身份进行重新登记。注意，这个指令后面不能添加登记的名称和密码，只是按照之前配置好的内容进行重新登记。
  <br>
  <br>
  <br> 4.4.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client reenroll
  <br> 2017/03/21 10:11:36 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 10:11:36 Initialize BCCSP [SW]
  <br> 2017/03/21 10:11:36 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 10:11:36 [INFO] received CSR
  <br> 2017/03/21 10:11:36 [INFO] generating key: ecdsa-256
  <br> 2017/03/21 10:11:37 [INFO] encoded CSR
  <br> 2017/03/21 10:11:37 [INFO] Stored client key at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/keystore/key.pem
  <br> 2017/03/21 10:11:37 [INFO] Stored client certificate at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/signcerts/cert.pem
  <br> 2017/03/21 10:11:37 [INFO] Stored CA certificate chain at /etc/hyperledger/以太坊代币-ca/clients/admin/msp/cacerts/.pem
  <br>
  <br>
  <br> 4.5 证书或身份撤销
  <br>
  <br>
  <br> 4.5.1 指令介绍
  <br>
  <br>
  <br> Usage:
  <br> &nbsp; 以太坊代币-ca-client revoke [flags]
  <br>
  <br>
  <br> Flags:
  <br> &nbsp; -a, --aki string &nbsp; &nbsp; &nbsp;AKI
  <br> &nbsp; -e, --eid string &nbsp; &nbsp; &nbsp;Enrollment ID (Optional)
  <br> &nbsp; -r, --reason string &nbsp; Reason for revoking
  <br> &nbsp; -s, --serial string &nbsp; Serial Number
  <br>
  <br>
  <br> 官方给出的说明有些错误，被标（Optional）的应该是“Reason for revoking”部分。实际上，要求指令后面的flag内容为下面两种格式中的一种：
  <br>
  <br>
  <br> 以太坊代币-ca-client revoke -a xxx -s yyy -r &lt;reason&gt;
  <br>
  <br>
  <br> 或
  <br>
  <br>
  <br> 以太坊代币-ca-client revoke -e &lt;enrollment_id&gt; -r &lt;reason&gt;
  <br>
  <br>
  <br> 支持的&lt;reason&gt;包括：
  <br>
  <br>
  <br> Reasons:
  <br> - unspecified
  <br> - keycompromise
  <br> - cacompromise
  <br> - affiliationchange
  <br> - superseded
  <br> - cessationofoperation
  <br> - certificatehold
  <br> - removefromcrl
  <br> - privilegewithdrawn
  <br> - aacompromise
  <br>
  <br>
  <br> AKI（Authority Key Identifier）和Serial Number都是在身份登记后生成的cert.pem文件中。我们需要对这个文件进行解析。可以使用OpenSSL进行解析：
  <br>
  <br>
  <br> root@xiao-virtual-machine:/home/xiao/test/以太坊代币-ca/clients/admin/msp/signcerts# openssl x509 -in cert.pem -text -noout -serial
  <br> Certificate:
  <br> &nbsp; &nbsp; Data:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; Version: 3 (0x2)
  <br> &nbsp; &nbsp; &nbsp; &nbsp; Serial Number:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4a:ad:ce:89:16:9d:36:23:99:c5:37:7a:e9:2b:06:d7:8a:f3:f3:da
  <br> &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256
  <br> &nbsp; &nbsp; &nbsp; &nbsp; Issuer: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=以太坊代币-ca-server
  <br> &nbsp; &nbsp; &nbsp; &nbsp; Validity
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not Before: Mar 21 09:21:00 2017 GMT
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Not After : Feb 17 17:21:00 2018 GMT
  <br> &nbsp; &nbsp; &nbsp; &nbsp; Subject: C=US, ST=North Carolina, O=Hyperledger, OU=以太坊代币, CN=test001
  <br> &nbsp; &nbsp; &nbsp; &nbsp; Subject Public Key Info:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public Key Algorithm: id-ecPublicKey
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Public-Key: (256 bit)
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pub:&nbsp;
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:8a:ff:a4:44:2c:10:e5:4c:4e:7d:7d:0f:bb:28:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; aa:c0:30:b8:53:2c:0d:1d:26:92:c9:85:7c:0d:24:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7a:c0:25:5c:18:c9:f7:fa:d2:53:e9:00:00:99:d1:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 04:30:a1:d5:dd:a1:3c:30:37:5a:f9:70:e5:aa:6e:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 89:6c:54:ad:18
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ASN1 OID: prime256v1
  <br> &nbsp; &nbsp; &nbsp; &nbsp; X509v3 extensions:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Key Usage: critical
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Certificate Sign
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Basic Constraints: critical
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CA:FALSE
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Key Identifier:&nbsp;
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6F:76:CA:12:7D:20:5F:27:6F:93:55:15:48:F1:32:6C:83:2A:F6:03
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Authority Key Identifier:&nbsp;
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyid:A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43
  <br>
  <br>
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Alternative Name:&nbsp;
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DNS:38cdca9067ac
  <br> &nbsp; &nbsp; Signature Algorithm: ecdsa-with-SHA256
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30:46:02:21:00:a6:3e:33:78:e2:59:8c:e2:ba:6f:0f:7b:01:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;66:5d:67:08:af:81:de:1b:47:20:c1:00:e5:11:ba:1e:7a:f1:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f2:02:21:00:95:1a:31:06:6e:ab:cd:91:85:02:38:8c:72:87:
  <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;70:8e:e5:bc:7d:a8:0f:05:a1:55:60:c9:49:a0:72:1d:a1:11
  <br> serial=4AADCE89169D362399C5377AE92B06D78AF3F3DA
  <br>
  <br>
  <br> 这里，AKI为
  <br>
  <br>
  <br> A5:1F:27:F8:09:78:46:4D:63:A8:23:48:B3:B4:01:1D:FB:FF:C9:43
  <br>
  <br>
  <br> (需要去除冒号），Serial Number为
  <br>
  <br>
  <br> 4AADCE89169D362399C5377AE92B06D78AF3F3DA
  <br>
  <br>
  <br> 4.5.2 示例
  <br>
  <br>
  <br> root@0f86c3e1cf15:/etc/hyperledger/以太坊代币-ca# 以太坊代币-ca-client revoke -e test01 &nbsp;&nbsp;
  <br> 2017/03/21 11:11:05 [INFO] User provided config file: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 11:11:05 Initialize BCCSP [SW]
  <br> 2017/03/21 11:11:05 [INFO] Configuration file location: /etc/hyperledger/以太坊代币-ca/clients/admin/以太坊代币-ca-client-config.yaml
  <br> 2017/03/21 11:11:05 [INFO] Revocation was successful
  <br>
  <br>
  <br> 这里只是表述了通过eid进行撤销的方式，另一种方法总是不能成功，与Hyperledger项目组的成员沟通后，说是存在bug，目前仍在修复中。所以这里暂且不表。
  <br>
  <br>
  <br> 5. 其他
  <br>
  <br>
  <br> 5.1 优先级
  <br>
  <br>
  <br> 命令执行的优先级从高到低依次是：
  <br>
  <br>
  <br> 1 命令行flag
  <br> 2 环境变量
  <br> 3 配置文件 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jQQ53016353/article/details/78566499,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jQQ53016353/article/details/78566499,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

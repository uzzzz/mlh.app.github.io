<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>【区块链】DOCKER部署量子链私有网络环境以及部署智能合约实践 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="【区块链】DOCKER部署量子链私有网络环境以及部署智能合约实践" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="DOCKER部署量子链私有网络环境以及部署智能合约实践 安装环境 安装Docker https://store.docker.com/editions/community/docker-ce-desktop-mac 这里安装的是CE的稳定版 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker version Client: Version: 17.09.0-ce API version: 1.32 Go version: go1.8.3 Git commit: afdb6d4 Built: Tue Sep 26 22:40:09 2017 OS/Arch: darwin/amd64 Server: Version: 17.09.0-ce API version: 1.32 (minimum version 1.12) Go version: go1.8.3 Git commit: afdb6d4 Built: Tue Sep 26 22:45:38 2017 OS/Arch: linux/amd64 Experimental: true xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker login Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to create one. Username (******************): Password: Login Succeeded xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run hello-world Unable to find image &#39;hello-world:latest&#39; locally latest: Pulling from library/hello-world 5b0f327be733: Pull complete Digest: sha256:07d5f7800dfe37b8c2196c7b1c524c33808ce2e0f74e7aa00e603295ca9a0972 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub. 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://cloud.docker.com/ For more examples and ideas, visit: https://docs.docker.com/engine/userguide/ 创建桥接网络 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network create --driver bridge qtum_network 2b13b85764a65c48335edd059a7c715da1cbf7c07df4387d68bb269ef16e6796 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network ls NETWORK ID NAME DRIVER SCOPE f180013a366c bridge bridge local d1f91168e308 host host local c7412c2ee6d2 none null local 2b13b85764a6 qtum_network bridge local 拉取Qtum镜像 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/qtum Using default tag: latest latest: Pulling from cryptominder/qtum 280aca6ddce2: Pull complete a3ed95caeb02: Pull complete c05bbaad6588: Pull complete d58e30222385: Pull complete 72e52753ff3a: Pull complete e2f4e66e4f9a: Pull complete ab49593d9269: Pull complete 5334c4f4c433: Pull complete Digest: sha256:99764799a4fc807882cd8a2744d844f701b41f6846bf0b87c7d8780ff517a83f Status: Downloaded newer image for cryptominder/qtum:latest xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker images REPOSITORY TAG IMAGE ID CREATED SIZE cryptominder/qtum latest f5adde30c8eb 8 days ago 92.1MB hello-world latest 05a3bd381fc2 4 weeks ago 1.84kB 本地文件映射 docker run后面接下面两种参数 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data 获取配置文件 git clone https://github.com/crypt0m1nd3r/docker-qtum-config.git 启动节点 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node1 --network=qtum_network -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtumd 522be9f3d830c1f749f15c4a7b6e87008930b3a416bb2ae2cc8561ac84fe6a9c 列表 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 23 seconds ago Up 25 seconds 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 在当前文件夹可以看到一个node1_data文件夹 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls node1_data/regtest banlist.dat blocks chainstate database db.log debug.log peers.dat qtumd.pid stateQtum vm.log wallet.dat 其他两个节点 ~/docker_qtum/docker-qtum-config git:(master) [11:47:23] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node2 --network=qtum_network -v ${PWD}/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node2_data:/data cryptominder/qtum:latest qtumd cf5bf31175d5627c52a6f3513f8f96bf1bdf74869bcb5b14bff9ef4232a02763 ~/docker_qtum/docker-qtum-config git:(master) [11:48:11] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node3 --network=qtum_network -v ${PWD}/node3_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node3_data:/data cryptominder/qtum:latest qtumd c4bc72f072a500fbcf1ea3d63ecd02b59b8641c246afa6744ab40597edc9f7ca 查看 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4bc72f072a5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 46 seconds ago Up 48 seconds 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node3 cf5bf31175d5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; About a minute ago Up About a minute 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node2 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 4 minutes ago Up 4 minutes 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 验证节点有效 ❖ ~/docker_qtum/docker-qtum-config git:(master) [11:49:30] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i –network container:qtumd_node1 -v PWD/node1qtumd.conf:/home/qtum/qtum.conf:ro−v {PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getinfo { “version”: 140301, “protocolversion”: 70016, “walletversion”: 130000, “balance”: 0.00000000, “stake”: 0.00000000, “blocks”: 0, “timeoffset”: 0, “connections”: 2, “proxy”: “”, “difficulty”: { “proof-of-work”: 4.656542373906925e-10, “proof-of-stake”: 4.656542373906925e-10 }, “testnet”: false, “moneysupply”: 0, “keypoololdest”: 1508125526, “keypoolsize”: 100, “paytxfee”: 0.00000000, “relayfee”: 0.00400000, “errors”: “” } Proof-of-Stake (POS) xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli generate 1 [ &quot;56b7a6fb87d15dd289fe682f7adce8fb2c49a330a8f19ac4c0217a35d8c639c4&quot; ] ❖ ~/docker_qtum/docker-qtum-config git:(master) [12:03:54] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli generate 4999 [ &quot;794857ae6cdae4b483407fda666d0004d0c4385335ea706d17aa2c3b4b591e62&quot;, &quot;1f6ab1697ece120857db6f7f364efaf01563985c5b962d2d76c0614423209ed8&quot;, &quot;74f72495383cd7037a94c4652165874727f7a86543527c30fae07c5b702492c4&quot;, &quot;310657e8a642213cfdfb0f93fb6bdaa11b485c16dc29daf792d0a5e69b0a21bd&quot;, &quot;3fbd40f4455c65fd15dddca49a401cbd568df1aec20d2f0c74108cd082dbb4d6&quot;, &quot;62893413cf52b7d0c990a847139ea402a002f18f9131470b841ff699eab5356f&quot;, &quot;7481d60c63d3a9c064c2c91d1ae7d50a2c6bd4ffea08fb6af9fcbd586b163861&quot; ................... 超过5000个块后，开始POS,每过几分钟，就会自动产生新的区块。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo { &quot;walletversion&quot;: 130000, &quot;balance&quot;: 90000000.00000000, &quot;stake&quot;: 110000.00000000, &quot;unconfirmed_balance&quot;: 0.00000000, &quot;immature_balance&quot;: 9900000.00000000, &quot;txcount&quot;: 5005, &quot;keypoololdest&quot;: 1508125526, &quot;keypoolsize&quot;: 100, &quot;paytxfee&quot;: 0.00000000, &quot;hdmasterkeyid&quot;: &quot;7edb36583046f5ca439537f24073d0a6602ea901&quot; } stake为自动产生的部分。 停止运行 docker stop qtumd_node1 部署 确认环境 ❖ ~/docker_qtum/docker-qtum-config git:(master) [13:35:19] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps -f name=qtumd CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4bc72f072a5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node3 cf5bf31175d5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node2 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 ❖ ~/docker_qtum/docker-qtum-config git:(master) [13:49:48] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo { &quot;walletversion&quot;: 130000, &quot;balance&quot;: 90000000.00000000, &quot;stake&quot;: 3960000.00000000, &quot;unconfirmed_balance&quot;: 0.00000000, &quot;immature_balance&quot;: 6400000.00000000, &quot;txcount&quot;: 5180, &quot;keypoololdest&quot;: 1508125526, &quot;keypoolsize&quot;: 100, &quot;paytxfee&quot;: 0.00000000, &quot;hdmasterkeyid&quot;: &quot;7edb36583046f5ca439537f24073d0a6602ea901&quot; } 确认是不是有智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts { &quot;0000000000000000000000000000000000000083&quot;: 0.00000000, &quot;0000000000000000000000000000000000000080&quot;: 0.00000000, &quot;0000000000000000000000000000000000000081&quot;: 0.00000000, &quot;0000000000000000000000000000000000000082&quot;: 0.00000000, &quot;0000000000000000000000000000000000000084&quot;: 0.00000000 } 获取solc和ethabi xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version Unable to find image &#39;ethereum/solc:stable&#39; locally stable: Pulling from ethereum/solc 88286f41530e: Pull complete 5650800b8aa2: Pull complete 4c72a311195d: Pull complete e416a2de4b1d: Pull complete 6dcc936acf64: Pull complete Digest: sha256:c61b13352fb2feb691cce49439eababdf9da215d4669437c17c9fd36311ad264 Status: Downloaded newer image for ethereum/solc:stable solc, the solidity compiler commandline interface Version: 0.4.17+commit.bdeb9e52.Linux.g++ ❖ ~ [14:48:40] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version solc, the solidity compiler commandline interface Version: 0.4.17+commit.bdeb9e52.Linux.g++ xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/ethabi Using default tag: latest latest: Pulling from cryptominder/ethabi 219d2e45b4af: Pull complete ef9ce992ffe4: Pull complete d0df8518230c: Pull complete 38ae21afde7b: Pull complete baa1c2e15c01: Pull complete 85b637e7eada: Pull complete 223f4c62bf4a: Pull complete 7a1623674a9e: Pull complete Digest: sha256:2fabc4f844a1309037bfd93f63956cac6c3dd76779e674d5388c02192aec6147 Status: Downloaded newer image for cryptominder/ethabi:latest ❖ ~/docker_qtum/docker-qtum-config git:(master) [14:54:17] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest --help Ethereum ABI coder. Copyright 2016-2017 Parity Technologies (UK) Limited Usage: ethabi encode function &lt;abi-path&gt; &lt;function-name&gt; [-p &lt;param&gt;]... [-l | --lenient] ethabi encode params [-v &lt;type&gt; &lt;param&gt;]... [-l | --lenient] ethabi decode function &lt;abi-path&gt; &lt;function-name&gt; &lt;data&gt; ethabi decode params [-t &lt;type&gt;]... &lt;data&gt; ethabi decode log &lt;abi-path&gt; &lt;event-name&gt; [-l &lt;topic&gt;]... &lt;data&gt; ethabi -h | --help Options: -h, --help Display this message and exit. -l, --lenient Allow short representation of input params. Commands: encode Encode ABI call. decode Decode ABI call result. function Load function from json ABI file. params Specify types of input params inline. log Decode event log. 编译智能合约 vi helloworld.sol contract mortal { /* Define variable owner of the type address */ address owner; /* This function is executed at initialization and sets the owner of the contract */ function mortal() { owner = msg.sender; } /* Function to recover the funds on the contract */ function kill() { if (msg.sender == owner) selfdestruct(owner); } } contract greeter is mortal { /* Define variable greeting of the type string */ string greeting; /* This runs when the contract is executed */ function greeter(string _greeting) public { greeting = _greeting; } /* Main function */ function greet() constant returns (string) { return greeting; } } xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/solidity ethereum/solc:stable --optimize --bin --abi --hashes -o /solidity --overwrite helloworld.sol helloworld.sol:6:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function mortal() { owner = msg.sender; } ^---------------------------------------^ helloworld.sol:9:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function kill() { if (msg.sender == owner) selfdestruct(owner); } ^---------------------------------------------------------------^ helloworld.sol:22:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function greet() constant returns (string) { ^ Spanning multiple lines. helloworld.sol:1:1: Warning: Source file does not specify required compiler version!Consider adding &quot;pragma solidity ^0.4.17 contract mortal { ^ Spanning multiple lines. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures 部署智能合约 ❖ ~/docker_qtum/docker-qtum-config git:(master) [15:20:48] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountaddress greeter_owner qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 我们会得到一个地址qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listaccounts { &quot;&quot;: 97420000.00000000, &quot;greeter_owner&quot;: 0.00000000 } 开始编译 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.bin &amp;&amp; docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest encode params -v string &#39;Hello World!&#39; --lenient 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 下面会用到的命令 createcontract &quot;bytecode&quot; (gaslimit gasprice &quot;senderaddress&quot; broadcast) Create a contract with bytcode. Arguments: 1. &quot;bytecode&quot; (string, required) contract bytcode. 2. gasLimit (numeric or string, optional) gasLimit, default: 2500000, max: 40000000 3. gasPrice (numeric or string, optional) gasPrice QTUM price per gas unit, default: 0.0000004, min:0.0000004 4. &quot;senderaddress&quot; (string, optional) The quantum address that will be used to create the contract. 5. &quot;broadcast&quot; (bool, optional, default=true) Whether to broadcast the transaction or not. 正式部署 ❖ ~/docker_qtum/docker-qtum-config git:(master) [15:25:47] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 error code: -3 error message: Sender address does not have any unspent outputs 这是因为对应的地址有余额，我们需要保证部署合约的地址有UTXO xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 3 44de44c625fe3971b8cd528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff 经过1个区块的确认，我们就有UTXO了。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listunspent 1 9999999 [\&quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7\&quot;] [ { &quot;txid&quot;: &quot;44de44c625fe3971b8cd528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff&quot;, &quot;vout&quot;: 1, &quot;address&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;account&quot;: &quot;greeter_owner&quot;, &quot;scriptPubKey&quot;: &quot;76a91408cd94aa2c2aea9fd23c7c1ff435066b88b5741288ac&quot;, &quot;amount&quot;: 3.00000000, &quot;confirmations&quot;: 12, &quot;spendable&quot;: true, &quot;solvable&quot;: true } ] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { &quot;txid&quot;: &quot;2cb2ef3e57d9f72ddc76736e5859badf62904ddce2af5ddfe57fdbe2af9e8558&quot;, &quot;sender&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;hash160&quot;: &quot;08cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot;, &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot; } 检查智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts { &quot;0000000000000000000000000000000000000083&quot;: 0.00000000, &quot;0000000000000000000000000000000000000080&quot;: 0.00000000, &quot;0000000000000000000000000000000000000081&quot;: 0.00000000, &quot;0000000000000000000000000000000000000082&quot;: 0.00000000, &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;: 0.00000000, //我们创建的智能合约 &quot;0000000000000000000000000000000000000084&quot;: 0.00000000 } xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f { &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;balance&quot;: 0, &quot;storage&quot;: { &quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;: &quot;00000000000000000000000008cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot; }, &quot;b10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000001&quot;: &quot;48656c6c6f20576f726c64210000000000000000000000000000000000000018&quot; } }, &quot;code&quot;: &quot;606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c0029&quot; } 运行智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest encode function /ethabi/greeter.abi greet cfae3217 ❖ ~/docker_qtum [16:11:49] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures ❖ ~/docker_qtum [16:11:57] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.signatures cfae3217: greet() 41c0e1b5: kill() xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node2 -v ${PWD}/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node2_data:/data cryptominder/qtum:latest qtum-cli callcontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f cfae3217 { &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;executionResult&quot;: { &quot;gasUsed&quot;: 22737, &quot;excepted&quot;: &quot;None&quot;, &quot;newAddress&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;output&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000&quot;, &quot;codeDeposit&quot;: 0, &quot;gasRefunded&quot;: 0, &quot;depositSize&quot;: 0, &quot;gasForDeposit&quot;: 0 }, &quot;transactionReceipt&quot;: { &quot;stateRoot&quot;: &quot;5d6bf971874e554793c28ce2dcef60eadca95abd18e77686a9d14371f2504386&quot;, &quot;gasUsed&quot;: 22737, &quot;bloom&quot;: &quot;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;log&quot;: [ ] } } 解码output xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest decode params -t string 0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 string Hello World! 清除智能合约 这里对比两个命令 callcontract 链下完成，不会在区块链上产生记录。不消耗gas sendtocontract 链上完成，需要同步，会消耗gas 我们使用下面的命令 sendtocontract &quot;contractaddress&quot; &quot;data&quot; (amount gaslimit gasprice senderaddress broadcast) Send funds and data to a contract. Arguments: 1. &quot;contractaddress&quot; (string, required) The contract address that will receive the funds and data. 2. &quot;datahex&quot; (string, required) data to send. 3. &quot;amount&quot; (numeric or string, optional) The amount in QTUM to send. eg 0.1, default: 0 4. gasLimit (numeric or string, optional) gasLimit, default: 250000, max: 40000000 5. gasPrice (numeric or string, optional) gasPrice Qtum price per gas unit, default: 0.0000004, min:0.0000004 6. &quot;senderaddress&quot; (string, optional) The quantum address that will be used as sender. 7. &quot;broadcast&quot; (bool, optional, default=true) Whether to broadcast the transaction or not. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 { &quot;txid&quot;: &quot;07017d992df14d07dde8cd4fcf5e1dc3837deff6c463c677796d88b2c70defa7&quot;, &quot;sender&quot;: &quot;qbbWnpv1up8HP8T7tYSkfUiv6qnw4qbBw8&quot;, &quot;hash160&quot;: &quot;c5d9780aba93fec62be8624ab0bd1ccbb3bdf6a0&quot; } 再次调用发现并没有被销毁，因为在合约中规定了调用者必须和创建者一致。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 0 250000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 error code: -3 error message: Sender address does not have any unspent outputs //提示没有UTXO ~/docker_qtum/docker-qtum-config git:(master) [16:26:41] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 3 fccbe9c36a26747314d40d2bdfc9cb917f67f0bc011a51e305a4b92dc79a422c ~/docker_qtum/docker-qtum-config git:(master) [16:27:22] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 0 250000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { &quot;txid&quot;: &quot;fcc6904e090d89acd65f70c3708d5b49b2f2b1a03f3d3ac19572da6135206bbb&quot;, &quot;sender&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;hash160&quot;: &quot;08cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot; } 再次查看详情，发现已经不存在了 ❖ ~/docker_qtum/docker-qtum-config git:(master) [16:27:26] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f error code: -5 error message: Address does not exist 到此，智能合约的基本操作完成。 参考资料 https://steemit.com/qtum/@cryptominder/qtum-blockchain-development-environment-setup https://steemit.com/qtum/@cryptominder/quantum-qtum-blockchain-developer-tutorial-hello-world 阅读更多" />
<meta property="og:description" content="DOCKER部署量子链私有网络环境以及部署智能合约实践 安装环境 安装Docker https://store.docker.com/editions/community/docker-ce-desktop-mac 这里安装的是CE的稳定版 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker version Client: Version: 17.09.0-ce API version: 1.32 Go version: go1.8.3 Git commit: afdb6d4 Built: Tue Sep 26 22:40:09 2017 OS/Arch: darwin/amd64 Server: Version: 17.09.0-ce API version: 1.32 (minimum version 1.12) Go version: go1.8.3 Git commit: afdb6d4 Built: Tue Sep 26 22:45:38 2017 OS/Arch: linux/amd64 Experimental: true xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker login Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to create one. Username (******************): Password: Login Succeeded xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run hello-world Unable to find image &#39;hello-world:latest&#39; locally latest: Pulling from library/hello-world 5b0f327be733: Pull complete Digest: sha256:07d5f7800dfe37b8c2196c7b1c524c33808ce2e0f74e7aa00e603295ca9a0972 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub. 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://cloud.docker.com/ For more examples and ideas, visit: https://docs.docker.com/engine/userguide/ 创建桥接网络 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network create --driver bridge qtum_network 2b13b85764a65c48335edd059a7c715da1cbf7c07df4387d68bb269ef16e6796 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network ls NETWORK ID NAME DRIVER SCOPE f180013a366c bridge bridge local d1f91168e308 host host local c7412c2ee6d2 none null local 2b13b85764a6 qtum_network bridge local 拉取Qtum镜像 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/qtum Using default tag: latest latest: Pulling from cryptominder/qtum 280aca6ddce2: Pull complete a3ed95caeb02: Pull complete c05bbaad6588: Pull complete d58e30222385: Pull complete 72e52753ff3a: Pull complete e2f4e66e4f9a: Pull complete ab49593d9269: Pull complete 5334c4f4c433: Pull complete Digest: sha256:99764799a4fc807882cd8a2744d844f701b41f6846bf0b87c7d8780ff517a83f Status: Downloaded newer image for cryptominder/qtum:latest xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker images REPOSITORY TAG IMAGE ID CREATED SIZE cryptominder/qtum latest f5adde30c8eb 8 days ago 92.1MB hello-world latest 05a3bd381fc2 4 weeks ago 1.84kB 本地文件映射 docker run后面接下面两种参数 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data 获取配置文件 git clone https://github.com/crypt0m1nd3r/docker-qtum-config.git 启动节点 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node1 --network=qtum_network -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtumd 522be9f3d830c1f749f15c4a7b6e87008930b3a416bb2ae2cc8561ac84fe6a9c 列表 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 23 seconds ago Up 25 seconds 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 在当前文件夹可以看到一个node1_data文件夹 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls node1_data/regtest banlist.dat blocks chainstate database db.log debug.log peers.dat qtumd.pid stateQtum vm.log wallet.dat 其他两个节点 ~/docker_qtum/docker-qtum-config git:(master) [11:47:23] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node2 --network=qtum_network -v ${PWD}/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node2_data:/data cryptominder/qtum:latest qtumd cf5bf31175d5627c52a6f3513f8f96bf1bdf74869bcb5b14bff9ef4232a02763 ~/docker_qtum/docker-qtum-config git:(master) [11:48:11] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node3 --network=qtum_network -v ${PWD}/node3_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node3_data:/data cryptominder/qtum:latest qtumd c4bc72f072a500fbcf1ea3d63ecd02b59b8641c246afa6744ab40597edc9f7ca 查看 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4bc72f072a5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 46 seconds ago Up 48 seconds 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node3 cf5bf31175d5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; About a minute ago Up About a minute 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node2 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 4 minutes ago Up 4 minutes 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 验证节点有效 ❖ ~/docker_qtum/docker-qtum-config git:(master) [11:49:30] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i –network container:qtumd_node1 -v PWD/node1qtumd.conf:/home/qtum/qtum.conf:ro−v {PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getinfo { “version”: 140301, “protocolversion”: 70016, “walletversion”: 130000, “balance”: 0.00000000, “stake”: 0.00000000, “blocks”: 0, “timeoffset”: 0, “connections”: 2, “proxy”: “”, “difficulty”: { “proof-of-work”: 4.656542373906925e-10, “proof-of-stake”: 4.656542373906925e-10 }, “testnet”: false, “moneysupply”: 0, “keypoololdest”: 1508125526, “keypoolsize”: 100, “paytxfee”: 0.00000000, “relayfee”: 0.00400000, “errors”: “” } Proof-of-Stake (POS) xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli generate 1 [ &quot;56b7a6fb87d15dd289fe682f7adce8fb2c49a330a8f19ac4c0217a35d8c639c4&quot; ] ❖ ~/docker_qtum/docker-qtum-config git:(master) [12:03:54] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli generate 4999 [ &quot;794857ae6cdae4b483407fda666d0004d0c4385335ea706d17aa2c3b4b591e62&quot;, &quot;1f6ab1697ece120857db6f7f364efaf01563985c5b962d2d76c0614423209ed8&quot;, &quot;74f72495383cd7037a94c4652165874727f7a86543527c30fae07c5b702492c4&quot;, &quot;310657e8a642213cfdfb0f93fb6bdaa11b485c16dc29daf792d0a5e69b0a21bd&quot;, &quot;3fbd40f4455c65fd15dddca49a401cbd568df1aec20d2f0c74108cd082dbb4d6&quot;, &quot;62893413cf52b7d0c990a847139ea402a002f18f9131470b841ff699eab5356f&quot;, &quot;7481d60c63d3a9c064c2c91d1ae7d50a2c6bd4ffea08fb6af9fcbd586b163861&quot; ................... 超过5000个块后，开始POS,每过几分钟，就会自动产生新的区块。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo { &quot;walletversion&quot;: 130000, &quot;balance&quot;: 90000000.00000000, &quot;stake&quot;: 110000.00000000, &quot;unconfirmed_balance&quot;: 0.00000000, &quot;immature_balance&quot;: 9900000.00000000, &quot;txcount&quot;: 5005, &quot;keypoololdest&quot;: 1508125526, &quot;keypoolsize&quot;: 100, &quot;paytxfee&quot;: 0.00000000, &quot;hdmasterkeyid&quot;: &quot;7edb36583046f5ca439537f24073d0a6602ea901&quot; } stake为自动产生的部分。 停止运行 docker stop qtumd_node1 部署 确认环境 ❖ ~/docker_qtum/docker-qtum-config git:(master) [13:35:19] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps -f name=qtumd CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4bc72f072a5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node3 cf5bf31175d5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node2 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 ❖ ~/docker_qtum/docker-qtum-config git:(master) [13:49:48] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo { &quot;walletversion&quot;: 130000, &quot;balance&quot;: 90000000.00000000, &quot;stake&quot;: 3960000.00000000, &quot;unconfirmed_balance&quot;: 0.00000000, &quot;immature_balance&quot;: 6400000.00000000, &quot;txcount&quot;: 5180, &quot;keypoololdest&quot;: 1508125526, &quot;keypoolsize&quot;: 100, &quot;paytxfee&quot;: 0.00000000, &quot;hdmasterkeyid&quot;: &quot;7edb36583046f5ca439537f24073d0a6602ea901&quot; } 确认是不是有智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts { &quot;0000000000000000000000000000000000000083&quot;: 0.00000000, &quot;0000000000000000000000000000000000000080&quot;: 0.00000000, &quot;0000000000000000000000000000000000000081&quot;: 0.00000000, &quot;0000000000000000000000000000000000000082&quot;: 0.00000000, &quot;0000000000000000000000000000000000000084&quot;: 0.00000000 } 获取solc和ethabi xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version Unable to find image &#39;ethereum/solc:stable&#39; locally stable: Pulling from ethereum/solc 88286f41530e: Pull complete 5650800b8aa2: Pull complete 4c72a311195d: Pull complete e416a2de4b1d: Pull complete 6dcc936acf64: Pull complete Digest: sha256:c61b13352fb2feb691cce49439eababdf9da215d4669437c17c9fd36311ad264 Status: Downloaded newer image for ethereum/solc:stable solc, the solidity compiler commandline interface Version: 0.4.17+commit.bdeb9e52.Linux.g++ ❖ ~ [14:48:40] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version solc, the solidity compiler commandline interface Version: 0.4.17+commit.bdeb9e52.Linux.g++ xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/ethabi Using default tag: latest latest: Pulling from cryptominder/ethabi 219d2e45b4af: Pull complete ef9ce992ffe4: Pull complete d0df8518230c: Pull complete 38ae21afde7b: Pull complete baa1c2e15c01: Pull complete 85b637e7eada: Pull complete 223f4c62bf4a: Pull complete 7a1623674a9e: Pull complete Digest: sha256:2fabc4f844a1309037bfd93f63956cac6c3dd76779e674d5388c02192aec6147 Status: Downloaded newer image for cryptominder/ethabi:latest ❖ ~/docker_qtum/docker-qtum-config git:(master) [14:54:17] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest --help Ethereum ABI coder. Copyright 2016-2017 Parity Technologies (UK) Limited Usage: ethabi encode function &lt;abi-path&gt; &lt;function-name&gt; [-p &lt;param&gt;]... [-l | --lenient] ethabi encode params [-v &lt;type&gt; &lt;param&gt;]... [-l | --lenient] ethabi decode function &lt;abi-path&gt; &lt;function-name&gt; &lt;data&gt; ethabi decode params [-t &lt;type&gt;]... &lt;data&gt; ethabi decode log &lt;abi-path&gt; &lt;event-name&gt; [-l &lt;topic&gt;]... &lt;data&gt; ethabi -h | --help Options: -h, --help Display this message and exit. -l, --lenient Allow short representation of input params. Commands: encode Encode ABI call. decode Decode ABI call result. function Load function from json ABI file. params Specify types of input params inline. log Decode event log. 编译智能合约 vi helloworld.sol contract mortal { /* Define variable owner of the type address */ address owner; /* This function is executed at initialization and sets the owner of the contract */ function mortal() { owner = msg.sender; } /* Function to recover the funds on the contract */ function kill() { if (msg.sender == owner) selfdestruct(owner); } } contract greeter is mortal { /* Define variable greeting of the type string */ string greeting; /* This runs when the contract is executed */ function greeter(string _greeting) public { greeting = _greeting; } /* Main function */ function greet() constant returns (string) { return greeting; } } xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/solidity ethereum/solc:stable --optimize --bin --abi --hashes -o /solidity --overwrite helloworld.sol helloworld.sol:6:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function mortal() { owner = msg.sender; } ^---------------------------------------^ helloworld.sol:9:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function kill() { if (msg.sender == owner) selfdestruct(owner); } ^---------------------------------------------------------------^ helloworld.sol:22:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function greet() constant returns (string) { ^ Spanning multiple lines. helloworld.sol:1:1: Warning: Source file does not specify required compiler version!Consider adding &quot;pragma solidity ^0.4.17 contract mortal { ^ Spanning multiple lines. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures 部署智能合约 ❖ ~/docker_qtum/docker-qtum-config git:(master) [15:20:48] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountaddress greeter_owner qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 我们会得到一个地址qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listaccounts { &quot;&quot;: 97420000.00000000, &quot;greeter_owner&quot;: 0.00000000 } 开始编译 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.bin &amp;&amp; docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest encode params -v string &#39;Hello World!&#39; --lenient 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 下面会用到的命令 createcontract &quot;bytecode&quot; (gaslimit gasprice &quot;senderaddress&quot; broadcast) Create a contract with bytcode. Arguments: 1. &quot;bytecode&quot; (string, required) contract bytcode. 2. gasLimit (numeric or string, optional) gasLimit, default: 2500000, max: 40000000 3. gasPrice (numeric or string, optional) gasPrice QTUM price per gas unit, default: 0.0000004, min:0.0000004 4. &quot;senderaddress&quot; (string, optional) The quantum address that will be used to create the contract. 5. &quot;broadcast&quot; (bool, optional, default=true) Whether to broadcast the transaction or not. 正式部署 ❖ ~/docker_qtum/docker-qtum-config git:(master) [15:25:47] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 error code: -3 error message: Sender address does not have any unspent outputs 这是因为对应的地址有余额，我们需要保证部署合约的地址有UTXO xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 3 44de44c625fe3971b8cd528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff 经过1个区块的确认，我们就有UTXO了。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listunspent 1 9999999 [\&quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7\&quot;] [ { &quot;txid&quot;: &quot;44de44c625fe3971b8cd528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff&quot;, &quot;vout&quot;: 1, &quot;address&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;account&quot;: &quot;greeter_owner&quot;, &quot;scriptPubKey&quot;: &quot;76a91408cd94aa2c2aea9fd23c7c1ff435066b88b5741288ac&quot;, &quot;amount&quot;: 3.00000000, &quot;confirmations&quot;: 12, &quot;spendable&quot;: true, &quot;solvable&quot;: true } ] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { &quot;txid&quot;: &quot;2cb2ef3e57d9f72ddc76736e5859badf62904ddce2af5ddfe57fdbe2af9e8558&quot;, &quot;sender&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;hash160&quot;: &quot;08cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot;, &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot; } 检查智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts { &quot;0000000000000000000000000000000000000083&quot;: 0.00000000, &quot;0000000000000000000000000000000000000080&quot;: 0.00000000, &quot;0000000000000000000000000000000000000081&quot;: 0.00000000, &quot;0000000000000000000000000000000000000082&quot;: 0.00000000, &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;: 0.00000000, //我们创建的智能合约 &quot;0000000000000000000000000000000000000084&quot;: 0.00000000 } xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f { &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;balance&quot;: 0, &quot;storage&quot;: { &quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;: &quot;00000000000000000000000008cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot; }, &quot;b10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000001&quot;: &quot;48656c6c6f20576f726c64210000000000000000000000000000000000000018&quot; } }, &quot;code&quot;: &quot;606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c0029&quot; } 运行智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest encode function /ethabi/greeter.abi greet cfae3217 ❖ ~/docker_qtum [16:11:49] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures ❖ ~/docker_qtum [16:11:57] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.signatures cfae3217: greet() 41c0e1b5: kill() xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node2 -v ${PWD}/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node2_data:/data cryptominder/qtum:latest qtum-cli callcontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f cfae3217 { &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;executionResult&quot;: { &quot;gasUsed&quot;: 22737, &quot;excepted&quot;: &quot;None&quot;, &quot;newAddress&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;output&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000&quot;, &quot;codeDeposit&quot;: 0, &quot;gasRefunded&quot;: 0, &quot;depositSize&quot;: 0, &quot;gasForDeposit&quot;: 0 }, &quot;transactionReceipt&quot;: { &quot;stateRoot&quot;: &quot;5d6bf971874e554793c28ce2dcef60eadca95abd18e77686a9d14371f2504386&quot;, &quot;gasUsed&quot;: 22737, &quot;bloom&quot;: &quot;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;log&quot;: [ ] } } 解码output xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest decode params -t string 0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 string Hello World! 清除智能合约 这里对比两个命令 callcontract 链下完成，不会在区块链上产生记录。不消耗gas sendtocontract 链上完成，需要同步，会消耗gas 我们使用下面的命令 sendtocontract &quot;contractaddress&quot; &quot;data&quot; (amount gaslimit gasprice senderaddress broadcast) Send funds and data to a contract. Arguments: 1. &quot;contractaddress&quot; (string, required) The contract address that will receive the funds and data. 2. &quot;datahex&quot; (string, required) data to send. 3. &quot;amount&quot; (numeric or string, optional) The amount in QTUM to send. eg 0.1, default: 0 4. gasLimit (numeric or string, optional) gasLimit, default: 250000, max: 40000000 5. gasPrice (numeric or string, optional) gasPrice Qtum price per gas unit, default: 0.0000004, min:0.0000004 6. &quot;senderaddress&quot; (string, optional) The quantum address that will be used as sender. 7. &quot;broadcast&quot; (bool, optional, default=true) Whether to broadcast the transaction or not. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 { &quot;txid&quot;: &quot;07017d992df14d07dde8cd4fcf5e1dc3837deff6c463c677796d88b2c70defa7&quot;, &quot;sender&quot;: &quot;qbbWnpv1up8HP8T7tYSkfUiv6qnw4qbBw8&quot;, &quot;hash160&quot;: &quot;c5d9780aba93fec62be8624ab0bd1ccbb3bdf6a0&quot; } 再次调用发现并没有被销毁，因为在合约中规定了调用者必须和创建者一致。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 0 250000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 error code: -3 error message: Sender address does not have any unspent outputs //提示没有UTXO ~/docker_qtum/docker-qtum-config git:(master) [16:26:41] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 3 fccbe9c36a26747314d40d2bdfc9cb917f67f0bc011a51e305a4b92dc79a422c ~/docker_qtum/docker-qtum-config git:(master) [16:27:22] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 0 250000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { &quot;txid&quot;: &quot;fcc6904e090d89acd65f70c3708d5b49b2f2b1a03f3d3ac19572da6135206bbb&quot;, &quot;sender&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;hash160&quot;: &quot;08cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot; } 再次查看详情，发现已经不存在了 ❖ ~/docker_qtum/docker-qtum-config git:(master) [16:27:26] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f error code: -5 error message: Address does not exist 到此，智能合约的基本操作完成。 参考资料 https://steemit.com/qtum/@cryptominder/qtum-blockchain-development-environment-setup https://steemit.com/qtum/@cryptominder/quantum-qtum-blockchain-developer-tutorial-hello-world 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-10-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"DOCKER部署量子链私有网络环境以及部署智能合约实践 安装环境 安装Docker https://store.docker.com/editions/community/docker-ce-desktop-mac 这里安装的是CE的稳定版 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker version Client: Version: 17.09.0-ce API version: 1.32 Go version: go1.8.3 Git commit: afdb6d4 Built: Tue Sep 26 22:40:09 2017 OS/Arch: darwin/amd64 Server: Version: 17.09.0-ce API version: 1.32 (minimum version 1.12) Go version: go1.8.3 Git commit: afdb6d4 Built: Tue Sep 26 22:45:38 2017 OS/Arch: linux/amd64 Experimental: true xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker login Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to create one. Username (******************): Password: Login Succeeded xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run hello-world Unable to find image &#39;hello-world:latest&#39; locally latest: Pulling from library/hello-world 5b0f327be733: Pull complete Digest: sha256:07d5f7800dfe37b8c2196c7b1c524c33808ce2e0f74e7aa00e603295ca9a0972 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub. 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://cloud.docker.com/ For more examples and ideas, visit: https://docs.docker.com/engine/userguide/ 创建桥接网络 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network create --driver bridge qtum_network 2b13b85764a65c48335edd059a7c715da1cbf7c07df4387d68bb269ef16e6796 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network ls NETWORK ID NAME DRIVER SCOPE f180013a366c bridge bridge local d1f91168e308 host host local c7412c2ee6d2 none null local 2b13b85764a6 qtum_network bridge local 拉取Qtum镜像 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/qtum Using default tag: latest latest: Pulling from cryptominder/qtum 280aca6ddce2: Pull complete a3ed95caeb02: Pull complete c05bbaad6588: Pull complete d58e30222385: Pull complete 72e52753ff3a: Pull complete e2f4e66e4f9a: Pull complete ab49593d9269: Pull complete 5334c4f4c433: Pull complete Digest: sha256:99764799a4fc807882cd8a2744d844f701b41f6846bf0b87c7d8780ff517a83f Status: Downloaded newer image for cryptominder/qtum:latest xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker images REPOSITORY TAG IMAGE ID CREATED SIZE cryptominder/qtum latest f5adde30c8eb 8 days ago 92.1MB hello-world latest 05a3bd381fc2 4 weeks ago 1.84kB 本地文件映射 docker run后面接下面两种参数 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data 获取配置文件 git clone https://github.com/crypt0m1nd3r/docker-qtum-config.git 启动节点 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node1 --network=qtum_network -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtumd 522be9f3d830c1f749f15c4a7b6e87008930b3a416bb2ae2cc8561ac84fe6a9c 列表 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 23 seconds ago Up 25 seconds 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 在当前文件夹可以看到一个node1_data文件夹 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls node1_data/regtest banlist.dat blocks chainstate database db.log debug.log peers.dat qtumd.pid stateQtum vm.log wallet.dat 其他两个节点 ~/docker_qtum/docker-qtum-config git:(master) [11:47:23] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node2 --network=qtum_network -v ${PWD}/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node2_data:/data cryptominder/qtum:latest qtumd cf5bf31175d5627c52a6f3513f8f96bf1bdf74869bcb5b14bff9ef4232a02763 ~/docker_qtum/docker-qtum-config git:(master) [11:48:11] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -d --rm --name qtumd_node3 --network=qtum_network -v ${PWD}/node3_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node3_data:/data cryptominder/qtum:latest qtumd c4bc72f072a500fbcf1ea3d63ecd02b59b8641c246afa6744ab40597edc9f7ca 查看 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4bc72f072a5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 46 seconds ago Up 48 seconds 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node3 cf5bf31175d5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; About a minute ago Up About a minute 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node2 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 4 minutes ago Up 4 minutes 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 验证节点有效 ❖ ~/docker_qtum/docker-qtum-config git:(master) [11:49:30] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i –network container:qtumd_node1 -v PWD/node1qtumd.conf:/home/qtum/qtum.conf:ro−v {PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getinfo { “version”: 140301, “protocolversion”: 70016, “walletversion”: 130000, “balance”: 0.00000000, “stake”: 0.00000000, “blocks”: 0, “timeoffset”: 0, “connections”: 2, “proxy”: “”, “difficulty”: { “proof-of-work”: 4.656542373906925e-10, “proof-of-stake”: 4.656542373906925e-10 }, “testnet”: false, “moneysupply”: 0, “keypoololdest”: 1508125526, “keypoolsize”: 100, “paytxfee”: 0.00000000, “relayfee”: 0.00400000, “errors”: “” } Proof-of-Stake (POS) xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli generate 1 [ &quot;56b7a6fb87d15dd289fe682f7adce8fb2c49a330a8f19ac4c0217a35d8c639c4&quot; ] ❖ ~/docker_qtum/docker-qtum-config git:(master) [12:03:54] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli generate 4999 [ &quot;794857ae6cdae4b483407fda666d0004d0c4385335ea706d17aa2c3b4b591e62&quot;, &quot;1f6ab1697ece120857db6f7f364efaf01563985c5b962d2d76c0614423209ed8&quot;, &quot;74f72495383cd7037a94c4652165874727f7a86543527c30fae07c5b702492c4&quot;, &quot;310657e8a642213cfdfb0f93fb6bdaa11b485c16dc29daf792d0a5e69b0a21bd&quot;, &quot;3fbd40f4455c65fd15dddca49a401cbd568df1aec20d2f0c74108cd082dbb4d6&quot;, &quot;62893413cf52b7d0c990a847139ea402a002f18f9131470b841ff699eab5356f&quot;, &quot;7481d60c63d3a9c064c2c91d1ae7d50a2c6bd4ffea08fb6af9fcbd586b163861&quot; ................... 超过5000个块后，开始POS,每过几分钟，就会自动产生新的区块。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo { &quot;walletversion&quot;: 130000, &quot;balance&quot;: 90000000.00000000, &quot;stake&quot;: 110000.00000000, &quot;unconfirmed_balance&quot;: 0.00000000, &quot;immature_balance&quot;: 9900000.00000000, &quot;txcount&quot;: 5005, &quot;keypoololdest&quot;: 1508125526, &quot;keypoolsize&quot;: 100, &quot;paytxfee&quot;: 0.00000000, &quot;hdmasterkeyid&quot;: &quot;7edb36583046f5ca439537f24073d0a6602ea901&quot; } stake为自动产生的部分。 停止运行 docker stop qtumd_node1 部署 确认环境 ❖ ~/docker_qtum/docker-qtum-config git:(master) [13:35:19] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps -f name=qtumd CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES c4bc72f072a5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node3 cf5bf31175d5 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node2 522be9f3d830 cryptominder/qtum:latest &quot;/entrypoint.sh qtumd&quot; 2 hours ago Up 2 hours 3888-3889/tcp, 13888-13889/tcp, 23888/tcp qtumd_node1 ❖ ~/docker_qtum/docker-qtum-config git:(master) [13:49:48] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo { &quot;walletversion&quot;: 130000, &quot;balance&quot;: 90000000.00000000, &quot;stake&quot;: 3960000.00000000, &quot;unconfirmed_balance&quot;: 0.00000000, &quot;immature_balance&quot;: 6400000.00000000, &quot;txcount&quot;: 5180, &quot;keypoololdest&quot;: 1508125526, &quot;keypoolsize&quot;: 100, &quot;paytxfee&quot;: 0.00000000, &quot;hdmasterkeyid&quot;: &quot;7edb36583046f5ca439537f24073d0a6602ea901&quot; } 确认是不是有智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts { &quot;0000000000000000000000000000000000000083&quot;: 0.00000000, &quot;0000000000000000000000000000000000000080&quot;: 0.00000000, &quot;0000000000000000000000000000000000000081&quot;: 0.00000000, &quot;0000000000000000000000000000000000000082&quot;: 0.00000000, &quot;0000000000000000000000000000000000000084&quot;: 0.00000000 } 获取solc和ethabi xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version Unable to find image &#39;ethereum/solc:stable&#39; locally stable: Pulling from ethereum/solc 88286f41530e: Pull complete 5650800b8aa2: Pull complete 4c72a311195d: Pull complete e416a2de4b1d: Pull complete 6dcc936acf64: Pull complete Digest: sha256:c61b13352fb2feb691cce49439eababdf9da215d4669437c17c9fd36311ad264 Status: Downloaded newer image for ethereum/solc:stable solc, the solidity compiler commandline interface Version: 0.4.17+commit.bdeb9e52.Linux.g++ ❖ ~ [14:48:40] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version solc, the solidity compiler commandline interface Version: 0.4.17+commit.bdeb9e52.Linux.g++ xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/ethabi Using default tag: latest latest: Pulling from cryptominder/ethabi 219d2e45b4af: Pull complete ef9ce992ffe4: Pull complete d0df8518230c: Pull complete 38ae21afde7b: Pull complete baa1c2e15c01: Pull complete 85b637e7eada: Pull complete 223f4c62bf4a: Pull complete 7a1623674a9e: Pull complete Digest: sha256:2fabc4f844a1309037bfd93f63956cac6c3dd76779e674d5388c02192aec6147 Status: Downloaded newer image for cryptominder/ethabi:latest ❖ ~/docker_qtum/docker-qtum-config git:(master) [14:54:17] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest --help Ethereum ABI coder. Copyright 2016-2017 Parity Technologies (UK) Limited Usage: ethabi encode function &lt;abi-path&gt; &lt;function-name&gt; [-p &lt;param&gt;]... [-l | --lenient] ethabi encode params [-v &lt;type&gt; &lt;param&gt;]... [-l | --lenient] ethabi decode function &lt;abi-path&gt; &lt;function-name&gt; &lt;data&gt; ethabi decode params [-t &lt;type&gt;]... &lt;data&gt; ethabi decode log &lt;abi-path&gt; &lt;event-name&gt; [-l &lt;topic&gt;]... &lt;data&gt; ethabi -h | --help Options: -h, --help Display this message and exit. -l, --lenient Allow short representation of input params. Commands: encode Encode ABI call. decode Decode ABI call result. function Load function from json ABI file. params Specify types of input params inline. log Decode event log. 编译智能合约 vi helloworld.sol contract mortal { /* Define variable owner of the type address */ address owner; /* This function is executed at initialization and sets the owner of the contract */ function mortal() { owner = msg.sender; } /* Function to recover the funds on the contract */ function kill() { if (msg.sender == owner) selfdestruct(owner); } } contract greeter is mortal { /* Define variable greeting of the type string */ string greeting; /* This runs when the contract is executed */ function greeter(string _greeting) public { greeting = _greeting; } /* Main function */ function greet() constant returns (string) { return greeting; } } xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/solidity ethereum/solc:stable --optimize --bin --abi --hashes -o /solidity --overwrite helloworld.sol helloworld.sol:6:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function mortal() { owner = msg.sender; } ^---------------------------------------^ helloworld.sol:9:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function kill() { if (msg.sender == owner) selfdestruct(owner); } ^---------------------------------------------------------------^ helloworld.sol:22:5: Warning: No visibility specified. Defaulting to &quot;public&quot;. function greet() constant returns (string) { ^ Spanning multiple lines. helloworld.sol:1:1: Warning: Source file does not specify required compiler version!Consider adding &quot;pragma solidity ^0.4.17 contract mortal { ^ Spanning multiple lines. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures 部署智能合约 ❖ ~/docker_qtum/docker-qtum-config git:(master) [15:20:48] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountaddress greeter_owner qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 我们会得到一个地址qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listaccounts { &quot;&quot;: 97420000.00000000, &quot;greeter_owner&quot;: 0.00000000 } 开始编译 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.bin &amp;&amp; docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest encode params -v string &#39;Hello World!&#39; --lenient 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 下面会用到的命令 createcontract &quot;bytecode&quot; (gaslimit gasprice &quot;senderaddress&quot; broadcast) Create a contract with bytcode. Arguments: 1. &quot;bytecode&quot; (string, required) contract bytcode. 2. gasLimit (numeric or string, optional) gasLimit, default: 2500000, max: 40000000 3. gasPrice (numeric or string, optional) gasPrice QTUM price per gas unit, default: 0.0000004, min:0.0000004 4. &quot;senderaddress&quot; (string, optional) The quantum address that will be used to create the contract. 5. &quot;broadcast&quot; (bool, optional, default=true) Whether to broadcast the transaction or not. 正式部署 ❖ ~/docker_qtum/docker-qtum-config git:(master) [15:25:47] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 error code: -3 error message: Sender address does not have any unspent outputs 这是因为对应的地址有余额，我们需要保证部署合约的地址有UTXO xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 3 44de44c625fe3971b8cd528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff 经过1个区块的确认，我们就有UTXO了。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listunspent 1 9999999 [\\&quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7\\&quot;] [ { &quot;txid&quot;: &quot;44de44c625fe3971b8cd528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff&quot;, &quot;vout&quot;: 1, &quot;address&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;account&quot;: &quot;greeter_owner&quot;, &quot;scriptPubKey&quot;: &quot;76a91408cd94aa2c2aea9fd23c7c1ff435066b88b5741288ac&quot;, &quot;amount&quot;: 3.00000000, &quot;confirmations&quot;: 12, &quot;spendable&quot;: true, &quot;solvable&quot;: true } ] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { &quot;txid&quot;: &quot;2cb2ef3e57d9f72ddc76736e5859badf62904ddce2af5ddfe57fdbe2af9e8558&quot;, &quot;sender&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;hash160&quot;: &quot;08cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot;, &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot; } 检查智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts { &quot;0000000000000000000000000000000000000083&quot;: 0.00000000, &quot;0000000000000000000000000000000000000080&quot;: 0.00000000, &quot;0000000000000000000000000000000000000081&quot;: 0.00000000, &quot;0000000000000000000000000000000000000082&quot;: 0.00000000, &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;: 0.00000000, //我们创建的智能合约 &quot;0000000000000000000000000000000000000084&quot;: 0.00000000 } xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f { &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;balance&quot;: 0, &quot;storage&quot;: { &quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000000&quot;: &quot;00000000000000000000000008cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot; }, &quot;b10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6&quot;: { &quot;0000000000000000000000000000000000000000000000000000000000000001&quot;: &quot;48656c6c6f20576f726c64210000000000000000000000000000000000000018&quot; } }, &quot;code&quot;: &quot;606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c0029&quot; } 运行智能合约 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest encode function /ethabi/greeter.abi greet cfae3217 ❖ ~/docker_qtum [16:11:49] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures ❖ ~/docker_qtum [16:11:57] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.signatures cfae3217: greet() 41c0e1b5: kill() xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node2 -v ${PWD}/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node2_data:/data cryptominder/qtum:latest qtum-cli callcontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f cfae3217 { &quot;address&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;executionResult&quot;: { &quot;gasUsed&quot;: 22737, &quot;excepted&quot;: &quot;None&quot;, &quot;newAddress&quot;: &quot;d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f&quot;, &quot;output&quot;: &quot;0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000&quot;, &quot;codeDeposit&quot;: 0, &quot;gasRefunded&quot;: 0, &quot;depositSize&quot;: 0, &quot;gasForDeposit&quot;: 0 }, &quot;transactionReceipt&quot;: { &quot;stateRoot&quot;: &quot;5d6bf971874e554793c28ce2dcef60eadca95abd18e77686a9d14371f2504386&quot;, &quot;gasUsed&quot;: 22737, &quot;bloom&quot;: &quot;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, &quot;log&quot;: [ ] } } 解码output xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v ${PWD}:/ethabi cryptominder/ethabi:latest decode params -t string 0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 string Hello World! 清除智能合约 这里对比两个命令 callcontract 链下完成，不会在区块链上产生记录。不消耗gas sendtocontract 链上完成，需要同步，会消耗gas 我们使用下面的命令 sendtocontract &quot;contractaddress&quot; &quot;data&quot; (amount gaslimit gasprice senderaddress broadcast) Send funds and data to a contract. Arguments: 1. &quot;contractaddress&quot; (string, required) The contract address that will receive the funds and data. 2. &quot;datahex&quot; (string, required) data to send. 3. &quot;amount&quot; (numeric or string, optional) The amount in QTUM to send. eg 0.1, default: 0 4. gasLimit (numeric or string, optional) gasLimit, default: 250000, max: 40000000 5. gasPrice (numeric or string, optional) gasPrice Qtum price per gas unit, default: 0.0000004, min:0.0000004 6. &quot;senderaddress&quot; (string, optional) The quantum address that will be used as sender. 7. &quot;broadcast&quot; (bool, optional, default=true) Whether to broadcast the transaction or not. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 { &quot;txid&quot;: &quot;07017d992df14d07dde8cd4fcf5e1dc3837deff6c463c677796d88b2c70defa7&quot;, &quot;sender&quot;: &quot;qbbWnpv1up8HP8T7tYSkfUiv6qnw4qbBw8&quot;, &quot;hash160&quot;: &quot;c5d9780aba93fec62be8624ab0bd1ccbb3bdf6a0&quot; } 再次调用发现并没有被销毁，因为在合约中规定了调用者必须和创建者一致。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 0 250000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 error code: -3 error message: Sender address does not have any unspent outputs //提示没有UTXO ~/docker_qtum/docker-qtum-config git:(master) [16:26:41] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 3 fccbe9c36a26747314d40d2bdfc9cb917f67f0bc011a51e305a4b92dc79a422c ~/docker_qtum/docker-qtum-config git:(master) [16:27:22] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 41c0e1b5 0 250000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { &quot;txid&quot;: &quot;fcc6904e090d89acd65f70c3708d5b49b2f2b1a03f3d3ac19572da6135206bbb&quot;, &quot;sender&quot;: &quot;qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7&quot;, &quot;hash160&quot;: &quot;08cd94aa2c2aea9fd23c7c1ff435066b88b57412&quot; } 再次查看详情，发现已经不存在了 ❖ ~/docker_qtum/docker-qtum-config git:(master) [16:27:26] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v ${PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v ${PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f error code: -5 error message: Address does not exist 到此，智能合约的基本操作完成。 参考资料 https://steemit.com/qtum/@cryptominder/qtum-blockchain-development-environment-setup https://steemit.com/qtum/@cryptominder/quantum-qtum-blockchain-developer-tutorial-hello-world 阅读更多","@type":"BlogPosting","url":"/2017/10/16/6f4eaf8bb6f462af7af444484b8c18ea.html","headline":"【区块链】DOCKER部署量子链私有网络环境以及部署智能合约实践","dateModified":"2017-10-16T00:00:00+08:00","datePublished":"2017-10-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/10/16/6f4eaf8bb6f462af7af444484b8c18ea.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>【区块链】DOCKER部署量子链私有网络环境以及部署智能合约实践</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h1 id="docker部署量子链私有网络环境以及部署智能合约实践">DOCKER部署量子链私有网络环境以及部署智能合约实践</h1> 
  <h2 id="安装环境">安装环境</h2> 
  <h3 id="安装docker">安装Docker</h3> 
  <p><a href="https://store.docker.com/editions/community/docker-ce-desktop-mac" rel="nofollow" target="_blank">https://store.docker.com/editions/community/docker-ce-desktop-mac</a></p> 
  <p>这里安装的是CE的稳定版</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker version
Client:
 Version:      <span class="hljs-number">17.09</span>.<span class="hljs-number">0</span>-ce
 API version:  <span class="hljs-number">1.32</span>
 Go version:   go1.<span class="hljs-number">8.3</span>
 Git commit:   afdb6d4
 Built:        Tue Sep <span class="hljs-number">26</span> <span class="hljs-number">22</span>:<span class="hljs-number">40</span>:<span class="hljs-number">09</span> <span class="hljs-number">2017</span>
 OS/Arch:      darwin/amd64

Server:
 Version:      <span class="hljs-number">17.09</span>.<span class="hljs-number">0</span>-ce
 API version:  <span class="hljs-number">1.32</span> (minimum version <span class="hljs-number">1.12</span>)
 Go version:   go1.<span class="hljs-number">8.3</span>
 Git commit:   afdb6d4
 Built:        Tue Sep <span class="hljs-number">26</span> <span class="hljs-number">22</span>:<span class="hljs-number">45</span>:<span class="hljs-number">38</span> <span class="hljs-number">2017</span>
 OS/Arch:      linux/amd64
 Experimental: <span class="hljs-literal">true</span>

</code></pre> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="hljs-string">'t have a Docker ID, head over to https://hub.docker.com to create one. Username (******************): Password: Login Succeeded xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run hello-world Unable to find image '</span>hello-world:latest<span class="hljs-string">' locally latest: Pulling from library/hello-world 5b0f327be733: Pull complete Digest: sha256:07d5f7800dfe37b8c2196c7b1c524c33808ce2e0f74e7aa00e603295ca9a0972 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the "hello-world" image from the Docker Hub. 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://cloud.docker.com/ For more examples and ideas, visit: https://docs.docker.com/engine/userguide/</span></code></pre> 
  <h3 id="创建桥接网络">创建桥接网络</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network create --driver bridge qtum_network
<span class="hljs-number">2</span>b13b85764a65c48335edd059a7c715da1cbf7c07df4387d68bb269ef16e6796


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
f180013a366c        bridge              bridge              local
d1f91168e308        host                host                local
c7412c2ee6d2        none                null                local
<span class="hljs-number">2</span>b13b85764a6        qtum_network        bridge              local




</code></pre> 
  <h3 id="拉取qtum镜像">拉取Qtum镜像</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/qtum
Using default tag: latest
latest: Pulling from cryptominder/qtum
<span class="hljs-number">280</span>aca6ddce2: Pull complete 
a3ed95caeb02: Pull complete 
c05bbaad6588: Pull complete 
d58e30222385: Pull complete 
<span class="hljs-number">72</span>e52753ff3a: Pull complete 
e2f4e66e4f9a: Pull complete 
ab49593d9269: Pull complete 
<span class="hljs-number">5334</span>c4f4c433: Pull complete 
Digest: sha256:<span class="hljs-number">99764799</span>a4fc807882<span class="hljs-built_in">cd</span>8a2744d844f701b41f6846bf0b87c7d8780ff517a83f
Status: Downloaded newer image <span class="hljs-keyword">for</span> cryptominder/qtum:latest


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
cryptominder/qtum   latest              f5adde30c8eb        <span class="hljs-number">8</span> days ago          <span class="hljs-number">92.1</span>MB
hello-world         latest              <span class="hljs-number">05</span>a3bd381fc2        <span class="hljs-number">4</span> weeks ago         <span class="hljs-number">1.84</span>kB
</code></pre> 
  <h3 id="本地文件映射">本地文件映射</h3> 
  <p><code>docker run</code>后面接下面两种参数</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
-v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro

-v <span class="hljs-variable">${PWD}</span>/node1_data:/data
</code></pre> 
  <h3 id="获取配置文件">获取配置文件</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
git clone https://github.com/crypt0m1nd3r/docker-qtum-config.git
</code></pre> 
  <h3 id="启动节点">启动节点</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run <span class="hljs-operator">-d</span> --rm --name qtumd_node1 --network=qtum_network -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtumd
<span class="hljs-number">522</span>be9f3d830c1f749f15c4a7b6e87008930b3a416bb2ae2cc8561ac84fe6a9c
</code></pre> 
  <p>列表</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                       NAMES
<span class="hljs-number">522</span>be9f3d830        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   <span class="hljs-number">23</span> seconds ago      Up <span class="hljs-number">25</span> seconds       <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node1
</code></pre> 
  <p>在当前文件夹可以看到一个<code>node1_data</code>文件夹</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls node1_data/regtest 
banlist.dat blocks      chainstate  database    db.log      debug.log   peers.dat   qtumd.pid   stateQtum   vm.log      wallet.dat

</code></pre> 
  <p>其他两个节点</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">

~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">11</span>:<span class="hljs-number">47</span>:<span class="hljs-number">23</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run <span class="hljs-operator">-d</span> --rm --name qtumd_node2 --network=qtum_network -v <span class="hljs-variable">${PWD}</span>/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node2_data:/data cryptominder/qtum:latest qtumd
cf5bf31175d5627c52a6f3513f8f96bf1bdf74869bcb5b14bff9ef4232a02763

~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">11</span>:<span class="hljs-number">48</span>:<span class="hljs-number">11</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run <span class="hljs-operator">-d</span> --rm --name qtumd_node3 --network=qtum_network -v <span class="hljs-variable">${PWD}</span>/node3_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node3_data:/data cryptominder/qtum:latest qtumd 
c4bc72f072a500fbcf1ea3d63ecd02b59b8641c246afa6744ab40597edc9f7ca
</code></pre> 
  <p>查看</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps
CONTAINER ID        IMAGE                      COMMAND                  CREATED              STATUS              PORTS                                       NAMES
c4bc72f072a5        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   <span class="hljs-number">46</span> seconds ago       Up <span class="hljs-number">48</span> seconds       <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node3
cf5bf31175d5        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   About a minute ago   Up About a minute   <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node2
<span class="hljs-number">522</span>be9f3d830        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   <span class="hljs-number">4</span> minutes ago        Up <span class="hljs-number">4</span> minutes        <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node1
</code></pre> 
  <h3 id="验证节点有效">验证节点有效</h3> 
  <p>❖ ~/docker_qtum/docker-qtum-config git:(master) [11:49:30] <br> xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i –network container:qtumd_node1 -v <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-1-Frame" role="textbox" aria-readonly="true" style="">
    <nobr>
     <span class="math" id="MathJax-Span-1" style="width: 28.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.447em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.669em 1000em 2.947em -0.497em); top: -2.497em; left: 0.003em;"><span class="mrow" id="MathJax-Span-2"><span class="texatom" id="MathJax-Span-3"><span class="mrow" id="MathJax-Span-4"><span class="mi" id="MathJax-Span-5" style="font-family: STIXGeneral-Italic;">P</span><span class="mi" id="MathJax-Span-6" style="font-family: STIXGeneral-Italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.058em;"></span></span><span class="mi" id="MathJax-Span-7" style="font-family: STIXGeneral-Italic;">D</span></span></span><span class="texatom" id="MathJax-Span-8"><span class="mrow" id="MathJax-Span-9"><span class="mo" id="MathJax-Span-10" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="mi" id="MathJax-Span-11" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-12" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-13" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-14" style="font-family: STIXGeneral-Italic;">e</span><span class="msubsup" id="MathJax-Span-15"><span style="display: inline-block; position: relative; width: 0.892em; height: 0px;"><span style="position: absolute; clip: rect(1.669em 1000em 2.669em -0.386em); top: -2.497em; left: 0.003em;"><span class="mn" id="MathJax-Span-16" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.503em;"></span></span><span style="position: absolute; top: -2.219em; left: 0.503em;"><span class="mi" id="MathJax-Span-17" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">q</span><span style="display: inline-block; width: 0px; height: 2.392em;"></span></span></span></span><span class="mi" id="MathJax-Span-18" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-19" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-20" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-21" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-22" style="font-family: STIXGeneral-Regular;">.</span><span class="mi" id="MathJax-Span-23" style="font-family: STIXGeneral-Italic; padding-left: 0.169em;">c</span><span class="mi" id="MathJax-Span-24" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-25" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-26" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.169em;"></span></span><span class="mo" id="MathJax-Span-27" style="font-family: STIXGeneral-Regular; padding-left: 0.336em;">:</span><span class="texatom" id="MathJax-Span-28" style="padding-left: 0.336em;"><span class="mrow" id="MathJax-Span-29"><span class="mo" id="MathJax-Span-30" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-32" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-33" style="font-family: STIXGeneral-Italic;">m</span><span class="mi" id="MathJax-Span-34" style="font-family: STIXGeneral-Italic;">e</span><span class="texatom" id="MathJax-Span-35"><span class="mrow" id="MathJax-Span-36"><span class="mo" id="MathJax-Span-37" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="mi" id="MathJax-Span-38" style="font-family: STIXGeneral-Italic;">q</span><span class="mi" id="MathJax-Span-39" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-40" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-41" style="font-family: STIXGeneral-Italic;">m</span><span class="texatom" id="MathJax-Span-42"><span class="mrow" id="MathJax-Span-43"><span class="mo" id="MathJax-Span-44" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="mi" id="MathJax-Span-45" style="font-family: STIXGeneral-Italic;">q</span><span class="mi" id="MathJax-Span-46" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-47" style="font-family: STIXGeneral-Italic;">u</span><span class="mi" id="MathJax-Span-48" style="font-family: STIXGeneral-Italic;">m</span><span class="mo" id="MathJax-Span-49" style="font-family: STIXGeneral-Regular;">.</span><span class="mi" id="MathJax-Span-50" style="font-family: STIXGeneral-Italic; padding-left: 0.169em;">c</span><span class="mi" id="MathJax-Span-51" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-52" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-53" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.169em;"></span></span><span class="mo" id="MathJax-Span-54" style="font-family: STIXGeneral-Regular; padding-left: 0.336em;">:</span><span class="mi" id="MathJax-Span-55" style="font-family: STIXGeneral-Italic; padding-left: 0.336em;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-56" style="font-family: STIXGeneral-Italic;">o</span><span class="mo" id="MathJax-Span-57" style="font-family: STIXGeneral-Regular; padding-left: 0.281em;">−</span><span class="mi" id="MathJax-Span-58" style="font-family: STIXGeneral-Italic; padding-left: 0.281em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.503em;"></span></span></span><span style="border-left: 0.003em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.337em; vertical-align: -0.397em;"></span></span>
    </nobr></span><script type="math/tex" id="MathJax-Element-1">{PWD}/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v </script>{PWD}/node1_data:/data cryptominder/qtum:latest qtum-cli getinfo <br> { <br> “version”: 140301, <br> “protocolversion”: 70016, <br> “walletversion”: 130000, <br> “balance”: 0.00000000, <br> “stake”: 0.00000000, <br> “blocks”: 0, <br> “timeoffset”: 0, <br> “connections”: 2, <br> “proxy”: “”, <br> “difficulty”: { <br> “proof-of-work”: 4.656542373906925e-10, <br> “proof-of-stake”: 4.656542373906925e-10 <br> }, <br> “testnet”: false, <br> “moneysupply”: 0, <br> “keypoololdest”: 1508125526, <br> “keypoolsize”: 100, <br> “paytxfee”: 0.00000000, <br> “relayfee”: 0.00400000, <br> “errors”: “” <br> }</p> 
  <h3 id="proof-of-stake-pos">Proof-of-Stake (POS)</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli generate <span class="hljs-number">1</span>
[
  <span class="hljs-string">"56b7a6fb87d15dd289fe682f7adce8fb2c49a330a8f19ac4c0217a35d8c639c4"</span>
]
❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">12</span>:<span class="hljs-number">03</span>:<span class="hljs-number">54</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli generate <span class="hljs-number">4999</span>
[
  <span class="hljs-string">"794857ae6cdae4b483407fda666d0004d0c4385335ea706d17aa2c3b4b591e62"</span>, 
  <span class="hljs-string">"1f6ab1697ece120857db6f7f364efaf01563985c5b962d2d76c0614423209ed8"</span>, 
  <span class="hljs-string">"74f72495383cd7037a94c4652165874727f7a86543527c30fae07c5b702492c4"</span>, 
  <span class="hljs-string">"310657e8a642213cfdfb0f93fb6bdaa11b485c16dc29daf792d0a5e69b0a21bd"</span>, 
  <span class="hljs-string">"3fbd40f4455c65fd15dddca49a401cbd568df1aec20d2f0c74108cd082dbb4d6"</span>, 
  <span class="hljs-string">"62893413cf52b7d0c990a847139ea402a002f18f9131470b841ff699eab5356f"</span>, 
  <span class="hljs-string">"7481d60c63d3a9c064c2c91d1ae7d50a2c6bd4ffea08fb6af9fcbd586b163861"</span>
  ...................




</code></pre> 
  <p>超过5000个块后，开始POS,每过几分钟，就会自动产生新的区块。</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo  
{
  <span class="hljs-string">"walletversion"</span>: <span class="hljs-number">130000</span>,
  <span class="hljs-string">"balance"</span>: <span class="hljs-number">90000000.00000000</span>,
  <span class="hljs-string">"stake"</span>: <span class="hljs-number">110000.00000000</span>,
  <span class="hljs-string">"unconfirmed_balance"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"immature_balance"</span>: <span class="hljs-number">9900000.00000000</span>,
  <span class="hljs-string">"txcount"</span>: <span class="hljs-number">5005</span>,
  <span class="hljs-string">"keypoololdest"</span>: <span class="hljs-number">1508125526</span>,
  <span class="hljs-string">"keypoolsize"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"paytxfee"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"hdmasterkeyid"</span>: <span class="hljs-string">"7edb36583046f5ca439537f24073d0a6602ea901"</span>
}

</code></pre> 
  <p><code>stake</code>为自动产生的部分。</p> 
  <h3 id="停止运行">停止运行</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
docker stop qtumd_node1

</code></pre> 
  <h2 id="部署">部署</h2> 
  <h3 id="确认环境">确认环境</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">13</span>:<span class="hljs-number">35</span>:<span class="hljs-number">19</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker ps <span class="hljs-operator">-f</span> name=qtumd
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                       NAMES
c4bc72f072a5        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   <span class="hljs-number">2</span> hours ago         Up <span class="hljs-number">2</span> hours          <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node3
cf5bf31175d5        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   <span class="hljs-number">2</span> hours ago         Up <span class="hljs-number">2</span> hours          <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node2
<span class="hljs-number">522</span>be9f3d830        cryptominder/qtum:latest   <span class="hljs-string">"/entrypoint.sh qtumd"</span>   <span class="hljs-number">2</span> hours ago         Up <span class="hljs-number">2</span> hours          <span class="hljs-number">3888</span>-<span class="hljs-number">3889</span>/tcp, <span class="hljs-number">13888</span>-<span class="hljs-number">13889</span>/tcp, <span class="hljs-number">23888</span>/tcp   qtumd_node1
❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">13</span>:<span class="hljs-number">49</span>:<span class="hljs-number">48</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli getwalletinfo
{
  <span class="hljs-string">"walletversion"</span>: <span class="hljs-number">130000</span>,
  <span class="hljs-string">"balance"</span>: <span class="hljs-number">90000000.00000000</span>,
  <span class="hljs-string">"stake"</span>: <span class="hljs-number">3960000.00000000</span>,
  <span class="hljs-string">"unconfirmed_balance"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"immature_balance"</span>: <span class="hljs-number">6400000.00000000</span>,
  <span class="hljs-string">"txcount"</span>: <span class="hljs-number">5180</span>,
  <span class="hljs-string">"keypoololdest"</span>: <span class="hljs-number">1508125526</span>,
  <span class="hljs-string">"keypoolsize"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"paytxfee"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"hdmasterkeyid"</span>: <span class="hljs-string">"7edb36583046f5ca439537f24073d0a6602ea901"</span>
}







</code></pre> 
  <p>确认是不是有智能合约</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts
{
  <span class="hljs-string">"0000000000000000000000000000000000000083"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000080"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000081"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000082"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000084"</span>: <span class="hljs-number">0.00000000</span>
}
</code></pre> 
  <h3 id="获取solc和ethabi">获取solc和ethabi</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version
Unable to find image <span class="hljs-string">'ethereum/solc:stable'</span> locally
stable: Pulling from ethereum/solc
<span class="hljs-number">88286</span>f41530e: Pull complete 
<span class="hljs-number">5650800</span>b8aa2: Pull complete 
<span class="hljs-number">4</span>c72a311195d: Pull complete 
e416a2de4b1d: Pull complete 
<span class="hljs-number">6</span>dcc936acf64: Pull complete 
Digest: sha256:c61b13352fb2feb691cce49439eababdf9da215d4669437c17c9fd36311ad264
Status: Downloaded newer image <span class="hljs-keyword">for</span> ethereum/solc:stable
solc, the solidity compiler commandline interface
Version: <span class="hljs-number">0.4</span>.<span class="hljs-number">17</span>+commit.bdeb9e52.Linux.g++
❖  ~ [<span class="hljs-number">14</span>:<span class="hljs-number">48</span>:<span class="hljs-number">40</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run ethereum/solc:stable solc --version
solc, the solidity compiler commandline interface
Version: <span class="hljs-number">0.4</span>.<span class="hljs-number">17</span>+commit.bdeb9e52.Linux.g++


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker pull cryptominder/ethabi
Using default tag: latest
latest: Pulling from cryptominder/ethabi
<span class="hljs-number">219</span>d2e45b4af: Pull complete 
ef9ce992ffe4: Pull complete 
d0df8518230c: Pull complete 
<span class="hljs-number">38</span>ae21afde7b: Pull complete 
baa1c2e15c01: Pull complete 
<span class="hljs-number">85</span>b637e7eada: Pull complete 
<span class="hljs-number">223</span>f4c62bf4a: Pull complete 
<span class="hljs-number">7</span>a1623674a9e: Pull complete 
Digest: sha256:<span class="hljs-number">2</span>fabc4f844a1309037bfd93f63956cac6c3dd76779e674d5388c02192aec6147
Status: Downloaded newer image <span class="hljs-keyword">for</span> cryptominder/ethabi:latest
❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">17</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v <span class="hljs-variable">${PWD}</span>:/ethabi cryptominder/ethabi:latest --help
Ethereum ABI coder.
  Copyright <span class="hljs-number">2016</span>-<span class="hljs-number">2017</span> Parity Technologies (UK) Limited

Usage:
    ethabi encode function &lt;abi-path&gt; &lt;function-name&gt; [-p &lt;param&gt;]... [<span class="hljs-operator">-l</span> | --lenient]
    ethabi encode params [-v &lt;<span class="hljs-built_in">type</span>&gt; &lt;param&gt;]... [<span class="hljs-operator">-l</span> | --lenient]
    ethabi decode function &lt;abi-path&gt; &lt;function-name&gt; &lt;data&gt;
    ethabi decode params [-t &lt;<span class="hljs-built_in">type</span>&gt;]... &lt;data&gt;
    ethabi decode log &lt;abi-path&gt; &lt;event-name&gt; [<span class="hljs-operator">-l</span> &lt;topic&gt;]... &lt;data&gt;
    ethabi -h | --help

Options:
    -h, --help         Display this message and exit.
    <span class="hljs-operator">-l</span>, --lenient      Allow short representation of input params.

Commands:
    encode             Encode ABI call.
    decode             Decode ABI call result.
    function           Load function from json ABI file.
    params             Specify types of input params inline.
    log                Decode event log.
</code></pre> 
  <h3 id="编译智能合约">编译智能合约</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">


vi helloworld.sol


contract mortal {
    /* Define variable owner of the <span class="hljs-built_in">type</span> address */
    address owner;

    /* This function is executed at initialization and sets the owner of the contract */
    function <span class="hljs-function"><span class="hljs-title">mortal</span></span>() { owner = msg.sender; }

    /* Function to recover the funds on the contract */
    function <span class="hljs-function"><span class="hljs-title">kill</span></span>() { <span class="hljs-keyword">if</span> (msg.sender == owner) selfdestruct(owner); }
}

contract greeter is mortal {
    /* Define variable greeting of the <span class="hljs-built_in">type</span> string */
    string greeting;

    /* This runs when the contract is executed */
    function greeter(string _greeting) public {
        greeting = _greeting;
    }

    /* Main function */
    function greet() constant returns (string) {
        <span class="hljs-keyword">return</span> greeting;
    }
}

</code></pre> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v <span class="hljs-variable">${PWD}</span>:/solidity ethereum/solc:stable --optimize --bin --abi --hashes -o /solidity --overwrite helloworld.sol     
helloworld.sol:<span class="hljs-number">6</span>:<span class="hljs-number">5</span>: Warning: No visibility specified. Defaulting to <span class="hljs-string">"public"</span>.
    function <span class="hljs-function"><span class="hljs-title">mortal</span></span>() { owner = msg.sender; }
    ^---------------------------------------^
helloworld.sol:<span class="hljs-number">9</span>:<span class="hljs-number">5</span>: Warning: No visibility specified. Defaulting to <span class="hljs-string">"public"</span>.
    function <span class="hljs-function"><span class="hljs-title">kill</span></span>() { <span class="hljs-keyword">if</span> (msg.sender == owner) selfdestruct(owner); }
    ^---------------------------------------------------------------^
helloworld.sol:<span class="hljs-number">22</span>:<span class="hljs-number">5</span>: Warning: No visibility specified. Defaulting to <span class="hljs-string">"public"</span>.
    function greet() constant returns (string) {
    ^
Spanning multiple lines.
helloworld.sol:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>: Warning: Source file does not specify required compiler version!Consider adding <span class="hljs-string">"pragma solidity ^0.4.17 contract mortal { ^ Spanning multiple lines. xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls docker-qtum-config greeter.abi greeter.bin greeter.signatures helloworld.sol mortal.abi mortal.bin mortal.signatures </span></code></pre> 
  <h3 id="部署智能合约">部署智能合约</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">

❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">48</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountaddress greeter_owner
qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7
</code></pre> 
  <p>我们会得到一个地址<code>qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7</code></p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli listaccounts
{
  <span class="hljs-string">""</span>: <span class="hljs-number">97420000.00000000</span>,
  <span class="hljs-string">"greeter_owner"</span>: <span class="hljs-number">0.00000000</span>
}



</code></pre> 
  <p>开始编译</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.bin &amp;&amp; docker run --rm -v <span class="hljs-variable">${PWD}</span>:/ethabi cryptominder/ethabi:latest encode params -v string <span class="hljs-string">'Hello World!'</span> --lenient
<span class="hljs-number">6060604052341561000</span>f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000</code></pre> 
  <p>下面会用到的命令</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">

createcontract <span class="hljs-string">"bytecode"</span> (gaslimit gasprice <span class="hljs-string">"senderaddress"</span> broadcast)
Create a contract with bytcode.

Arguments:
<span class="hljs-number">1</span>. <span class="hljs-string">"bytecode"</span>  (string, required) contract bytcode.
<span class="hljs-number">2</span>. gasLimit  (numeric or string, optional) gasLimit, default: <span class="hljs-number">2500000</span>, max: <span class="hljs-number">40000000</span>
<span class="hljs-number">3</span>. gasPrice  (numeric or string, optional) gasPrice QTUM price per gas unit, default: <span class="hljs-number">0.0000004</span>, min:<span class="hljs-number">0.0000004</span>
<span class="hljs-number">4</span>. <span class="hljs-string">"senderaddress"</span> (string, optional) The quantum address that will be used to create the contract.
<span class="hljs-number">5</span>. <span class="hljs-string">"broadcast"</span> (bool, optional, default=<span class="hljs-literal">true</span>) Whether to broadcast the transaction or not.</code></pre> 
  <h3 id="正式部署">正式部署</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">


❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">15</span>:<span class="hljs-number">25</span>:<span class="hljs-number">47</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract  <span class="hljs-number">6060604052341561000</span>f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 <span class="hljs-number">2500000</span> <span class="hljs-number">0.00000049</span>  qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 

error code: -<span class="hljs-number">3</span>
error message:
Sender address does not have any unspent outputs
</code></pre> 
  <p>这是因为对应的地址有余额，我们需要保证部署合约的地址有UTXO</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress    qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7    <span class="hljs-number">3</span>
<span class="hljs-number">44</span>de44c625fe3971b8<span class="hljs-built_in">cd</span>528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff

</code></pre> 
  <p>经过1个区块的确认，我们就有UTXO了。</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli listunspent <span class="hljs-number">1</span> <span class="hljs-number">9999999</span> [\<span class="hljs-string">"qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7\"] [ { "</span>txid<span class="hljs-string">": "</span><span class="hljs-number">44</span>de44c625fe3971b8<span class="hljs-built_in">cd</span>528f98a46913a6b3a14ea4eb4a3d8b292202833f29ff<span class="hljs-string">", "</span>vout<span class="hljs-string">": 1, "</span>address<span class="hljs-string">": "</span>qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7<span class="hljs-string">", "</span>account<span class="hljs-string">": "</span>greeter_owner<span class="hljs-string">", "</span>scriptPubKey<span class="hljs-string">": "</span><span class="hljs-number">76</span>a91408<span class="hljs-built_in">cd</span>94aa2c2aea9fd23c7c1ff435066b88b5741288ac<span class="hljs-string">", "</span>amount<span class="hljs-string">": 3.00000000, "</span>confirmations<span class="hljs-string">": 12, "</span>spendable<span class="hljs-string">": true, "</span>solvable<span class="hljs-string">": true } ] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli createcontract 6060604052341561000f57600080fd5b6040516103173803806103178339810160405280805160008054600160a060020a03191633600160a060020a03161790559190910190506001818051610059929160200190610060565b50506100fb565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100ce565b828001600101855582156100ce579182015b828111156100ce5782518255916020019190600101906100b3565b506100da9291506100de565b5090565b6100f891905b808211156100da57600081556001016100e4565b90565b61020d8061010a6000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000 2500000 0.00000049 qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7 { "</span>txid<span class="hljs-string">": "</span><span class="hljs-number">2</span>cb2ef3e57d9f72ddc76736e5859badf62904ddce2af5ddfe57fdbe2af9e8558<span class="hljs-string">", "</span>sender<span class="hljs-string">": "</span>qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7<span class="hljs-string">", "</span><span class="hljs-built_in">hash</span>160<span class="hljs-string">": "</span><span class="hljs-number">08</span><span class="hljs-built_in">cd</span>94aa2c2aea9fd23c7c1ff435066b88b57412<span class="hljs-string">", "</span>address<span class="hljs-string">": "</span>d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f<span class="hljs-string">" } </span></code></pre> 
  <h3 id="检查智能合约">检查智能合约</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli listcontracts
{
  <span class="hljs-string">"0000000000000000000000000000000000000083"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000080"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000081"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"0000000000000000000000000000000000000082"</span>: <span class="hljs-number">0.00000000</span>,
  <span class="hljs-string">"d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f"</span>: <span class="hljs-number">0.00000000</span>, //我们创建的智能合约
  <span class="hljs-string">"0000000000000000000000000000000000000084"</span>: <span class="hljs-number">0.00000000</span>
}



xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f 
{
  <span class="hljs-string">"address"</span>: <span class="hljs-string">"d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f"</span>,
  <span class="hljs-string">"balance"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"storage"</span>: {
    <span class="hljs-string">"290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563"</span>: {
      <span class="hljs-string">"0000000000000000000000000000000000000000000000000000000000000000"</span>: <span class="hljs-string">"00000000000000000000000008cd94aa2c2aea9fd23c7c1ff435066b88b57412"</span>
    },
    <span class="hljs-string">"b10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6"</span>: {
      <span class="hljs-string">"0000000000000000000000000000000000000000000000000000000000000001"</span>: <span class="hljs-string">"48656c6c6f20576f726c64210000000000000000000000000000000000000018"</span>
    }
  },
  <span class="hljs-string">"code"</span>: <span class="hljs-string">"606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b58114610047578063cfae32171461005c57600080fd5b341561005257600080fd5b61005a6100e6565b005b341561006757600080fd5b61006f610127565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ab578082015183820152602001610093565b50505050905090810190601f1680156100d85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101255760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b61012f6101cf565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101c55780601f1061019a576101008083540402835291602001916101c5565b820191906000526020600020905b8154815290600101906020018083116101a857829003601f168201915b5050505050905090565b602060405190810160405260008152905600a165627a7a72305820d4b628395b481f1c0f4bee7365b1922f05eaa223abe2bbebf74804849a66181c0029"</span>
}
</code></pre> 
  <h3 id="运行智能合约">运行智能合约</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v <span class="hljs-variable">${PWD}</span>:/ethabi cryptominder/ethabi:latest encode function /ethabi/greeter.abi greet
cfae3217
❖  ~/docker_qtum [<span class="hljs-number">16</span>:<span class="hljs-number">11</span>:<span class="hljs-number">49</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ ls
docker-qtum-config greeter.abi        greeter.bin        greeter.signatures helloworld.sol     mortal.abi         mortal.bin         mortal.signatures
❖  ~/docker_qtum [<span class="hljs-number">16</span>:<span class="hljs-number">11</span>:<span class="hljs-number">57</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cat greeter.signatures
cfae3217: greet()
<span class="hljs-number">41</span>c0e1b5: kill()


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node2 -v <span class="hljs-variable">${PWD}</span>/node2_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node2_data:/data cryptominder/qtum:latest qtum-cli callcontract  d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f    cfae3217
{
  <span class="hljs-string">"address"</span>: <span class="hljs-string">"d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f"</span>,
  <span class="hljs-string">"executionResult"</span>: {
    <span class="hljs-string">"gasUsed"</span>: <span class="hljs-number">22737</span>,
    <span class="hljs-string">"excepted"</span>: <span class="hljs-string">"None"</span>,
    <span class="hljs-string">"newAddress"</span>: <span class="hljs-string">"d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f"</span>,
    <span class="hljs-string">"output"</span>: <span class="hljs-string">"0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c48656c6c6f20576f726c64210000000000000000000000000000000000000000"</span>,
    <span class="hljs-string">"codeDeposit"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"gasRefunded"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"depositSize"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"gasForDeposit"</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-string">"transactionReceipt"</span>: {
    <span class="hljs-string">"stateRoot"</span>: <span class="hljs-string">"5d6bf971874e554793c28ce2dcef60eadca95abd18e77686a9d14371f2504386"</span>,
    <span class="hljs-string">"gasUsed"</span>: <span class="hljs-number">22737</span>,
    <span class="hljs-string">"bloom"</span>: <span class="hljs-string">"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>,
    <span class="hljs-string">"log"</span>: [
    ]
  }
}

</code></pre> 
  <p>解码output</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run --rm -v <span class="hljs-variable">${PWD}</span>:/ethabi cryptominder/ethabi:latest decode params -t string <span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000</span>c48656c6c6f20576f726c64210000000000000000000000000000000000000000
string Hello World!
</code></pre> 
  <h3 id="清除智能合约">清除智能合约</h3> 
  <p>这里对比两个命令</p> 
  <ul> 
   <li>callcontract 链下完成，不会在区块链上产生记录。不消耗gas</li> 
   <li>sendtocontract 链上完成，需要同步，会消耗gas</li> 
  </ul> 
  <pre class="prettyprint"><code class="language-bash hljs ">我们使用下面的命令

sendtocontract <span class="hljs-string">"contractaddress"</span> <span class="hljs-string">"data"</span> (amount gaslimit gasprice senderaddress broadcast)
Send funds and data to a contract.

Arguments:
<span class="hljs-number">1</span>. <span class="hljs-string">"contractaddress"</span> (string, required) The contract address that will receive the funds and data.
<span class="hljs-number">2</span>. <span class="hljs-string">"datahex"</span>  (string, required) data to send.
<span class="hljs-number">3</span>. <span class="hljs-string">"amount"</span>      (numeric or string, optional) The amount <span class="hljs-keyword">in</span> QTUM to send. eg <span class="hljs-number">0.1</span>, default: <span class="hljs-number">0</span>
<span class="hljs-number">4</span>. gasLimit  (numeric or string, optional) gasLimit, default: <span class="hljs-number">250000</span>, max: <span class="hljs-number">40000000</span>
<span class="hljs-number">5</span>. gasPrice  (numeric or string, optional) gasPrice Qtum price per gas unit, default: <span class="hljs-number">0.0000004</span>, min:<span class="hljs-number">0.0000004</span>
<span class="hljs-number">6</span>. <span class="hljs-string">"senderaddress"</span> (string, optional) The quantum address that will be used as sender.
<span class="hljs-number">7</span>. <span class="hljs-string">"broadcast"</span> (bool, optional, default=<span class="hljs-literal">true</span>) Whether to broadcast the transaction or not.</code></pre> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract    d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f    <span class="hljs-number">41</span>c0e1b5
{
  <span class="hljs-string">"txid"</span>: <span class="hljs-string">"07017d992df14d07dde8cd4fcf5e1dc3837deff6c463c677796d88b2c70defa7"</span>,
  <span class="hljs-string">"sender"</span>: <span class="hljs-string">"qbbWnpv1up8HP8T7tYSkfUiv6qnw4qbBw8"</span>,
  <span class="hljs-string">"hash160"</span>: <span class="hljs-string">"c5d9780aba93fec62be8624ab0bd1ccbb3bdf6a0"</span>
}





</code></pre> 
  <p>再次调用发现并没有被销毁，因为在合约中规定了调用者必须和创建者一致。</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract     d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f    <span class="hljs-number">41</span>c0e1b5 <span class="hljs-number">0</span> <span class="hljs-number">250000</span> <span class="hljs-number">0.00000049</span> qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7
error code: -<span class="hljs-number">3</span>
error message:
Sender address does not have any unspent outputs

//提示没有UTXO


 ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">16</span>:<span class="hljs-number">26</span>:<span class="hljs-number">41</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli sendtoaddress    qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7    <span class="hljs-number">3</span>      
fccbe9c36a26747314d40d2bdfc9cb917f67f0bc011a51e305a4b92dc79a422c
 ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">16</span>:<span class="hljs-number">27</span>:<span class="hljs-number">22</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli sendtocontract     d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f    <span class="hljs-number">41</span>c0e1b5 <span class="hljs-number">0</span> <span class="hljs-number">250000</span> <span class="hljs-number">0.00000049</span> qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7
{
  <span class="hljs-string">"txid"</span>: <span class="hljs-string">"fcc6904e090d89acd65f70c3708d5b49b2f2b1a03f3d3ac19572da6135206bbb"</span>,
  <span class="hljs-string">"sender"</span>: <span class="hljs-string">"qJMvqZibSRfVfbHNbew5rZmxD4cdhCXnR7"</span>,
  <span class="hljs-string">"hash160"</span>: <span class="hljs-string">"08cd94aa2c2aea9fd23c7c1ff435066b88b57412"</span>
}

</code></pre> 
  <p>再次查看详情，发现已经不存在了</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">

❖  ~/docker_qtum/docker-qtum-config git:(master) [<span class="hljs-number">16</span>:<span class="hljs-number">27</span>:<span class="hljs-number">26</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ docker run -i --network container:qtumd_node1 -v <span class="hljs-variable">${PWD}</span>/node1_qtumd.conf:/home/qtum/qtum.conf:ro -v <span class="hljs-variable">${PWD}</span>/node1_data:/data cryptominder/qtum:latest qtum-cli getaccountinfo  d5662f5de4e5e3a2dc6dd49a87843f893dbcb48f    
error code: -<span class="hljs-number">5</span>
error message:
Address does not exist
</code></pre> 
  <p>到此，智能合约的基本操作完成。</p> 
  <h2 id="参考资料">参考资料</h2> 
  <ul> 
   <li><a href="https://steemit.com/qtum/@cryptominder/qtum-blockchain-development-environment-setup" rel="nofollow" target="_blank">https://steemit.com/qtum/@cryptominder/qtum-blockchain-development-environment-setup</a></li> 
   <li><a href="https://steemit.com/qtum/@cryptominder/quantum-qtum-blockchain-developer-tutorial-hello-world" rel="nofollow" target="_blank">https://steemit.com/qtum/@cryptominder/quantum-qtum-blockchain-developer-tutorial-hello-world</a></li> 
  </ul> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/diandianxiyu_geek/article/details/78251215,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/diandianxiyu_geek/article/details/78251215,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

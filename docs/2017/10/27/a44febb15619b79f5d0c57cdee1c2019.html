<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>【区块链】Truffle 部署 编译 测试 智能合约 的 完整实践操作 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="【区块链】Truffle 部署 编译 测试 智能合约 的 完整实践操作" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/diandianxiyu/article/details/78361621 Truffle 部署 编译 测试 智能合约 的 完整实践操作 目标 搭建开发环境 创建一个Truffle项目 编写智能合约 编译转移智能合约 测试智能合约 创建用户界面连接智能合约 在浏览器中访问Dapp 搭建开发环境 Node.js v6+ LTS and npm (comes with Node) Git 这里配置脚本略过。。。。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ node -v v8.5.0 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm -v 5.4.2 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ git --version git version 2.13.5 (Apple Git-94) xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g ethereumjs-testrpc /usr/local/bin/testrpc -&gt; /usr/local/lib/node_modules/ethereumjs-testrpc/build/cli.node.js &gt; fsevents@1.1.2 install /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/fsevents &gt; node install events.js:182 throw er; // Unhandled &#39;error&#39; event ^ Error: spawn node-pre-gyp ENOENT at _errnoException (util.js:1026:11) at Process.ChildProcess._handle.onexit (internal/child_process.js:192:19) at onErrorNT (internal/child_process.js:374:16) at _combinedTickCallback (internal/process/next_tick.js:138:11) at process._tickCallback (internal/process/next_tick.js:180:9) at Function.Module.runMain (module.js:667:11) at startup (bootstrap_node.js:201:16) at bootstrap_node.js:626:3 &gt; uglifyjs-webpack-plugin@0.4.6 postinstall /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/uglifyjs-webpack-plugin &gt; node lib/post_install.js npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 (node_modules/ethereumjs-testrpc/node_modules/fsevents): npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 install: `node install` npm WARN optional SKIPPING OPTIONAL DEPENDENCY: Exit status 1 + ethereumjs-testrpc@4.1.3 added 2 packages, removed 475 packages, updated 238 packages and moved 1 package in 293.194s ╭─────────────────────────────────────╮ │ │ │ Update available 5.4.2 → 5.5.1 │ │ Run npm i -g npm to update │ │ │ ╰─────────────────────────────────────╯ xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm i -g npm to update /usr/local/bin/npm -&gt; /usr/local/lib/node_modules/npm/bin/npm-cli.js /usr/local/bin/npx -&gt; /usr/local/lib/node_modules/npm/bin/npx-cli.js /usr/local/bin/update -&gt; /usr/local/lib/node_modules/update/bin/update.js + update@0.7.4 + npm@5.5.1 + to@0.2.9 added 708 packages, removed 2 packages and updated 29 packages in 434.067s xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ sudo npm install -g ethereumjs-testrpc npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/decamelize npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_strip-ansi@3.0.1@strip-ansi/node_modules/ansi-regex npm ERR! path /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui npm ERR! code ENOENT npm ERR! errno -2 npm ERR! syscall access npm ERR! enoent ENOENT: no such file or directory, access &#39;/usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui&#39; npm ERR! enoent This is related to npm not being able to find a file. npm ERR! enoent npm ERR! A complete log of this run can be found in: npm ERR! /Users/xiaoyu/.npm/_logs/2017-10-26T08_09_48_018Z-debug.log xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g truffle /usr/local/bin/truffle -&gt; /usr/local/lib/node_modules/truffle/build/cli.bundled.js + truffle@3.4.11 removed 105 packages and updated 91 packages in 89.658s 用Truffle Box创建一个Truffle项目 ❖ ~/solidity [16:15:01] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ mkdir pet-shop-tutorial ❖ ~/solidity [16:15:06] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cd pet-shop-tutorial xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle unbox pet-shop Downloading... Unpacking... Setting up... 目录结构 /contracts 智能合约 /migrations 迁移系统来处理智能合约部署 /test 测试 truffle.js 配置文件 其他部分是nodejs的配置文件以及文件夹 编写智能合约 在contracts中创建Adoption.sol文件 pragma solidity ^0.4.4; contract Adoption { address[16] public adopters; //存储地址 //采用一个宠物 function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); adopters[petId] = msg.sender; return petId; } //返回采用者 function getAdopters() public returns (address[16]) { return adopters; } } 编译转移智能合约 EVM的测试环境 打开另一个窗口 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ testrpc -p 8588 EthereumJS TestRPC v4.1.3 (ganache-core: 1.1.3) Available Accounts ================== (0) 0xd2a54e8087d88889e1857698ceb228493b67bab6 (1) 0x44d32639c3803b9daa7392ff2ea50644153d7721 (2) 0x32d951e2f319edb079764b1c75864497a3132446 (3) 0x82244a630d6031be85ca298376cfa2bd6c7389a6 (4) 0xd3b556b69eb670a250bbc3f15ebefb081d4c7108 (5) 0x9f50cf1b425c6ca97de0128e46a21abd7bda3258 (6) 0x8e0545a4fe9eac1bb2f4683f0c6b36cd4a364a40 (7) 0x200b052f6eaeaa1dc11abcc3101b7a8aca293e70 (8) 0xcbd4c8b9d264367d385d4938c3b390a2eb0f2a62 (9) 0xa769a296f0bbab07e48ca62da5ad5aea4c920580 Private Keys ================== (0) a4f66a0654bbd1338a0cc9264624ad9f710f5cd65bbd4aed6f0b20706335e573 (1) cab64a11662597c79a9e866865efbec4b2e1701ed21783f68a61162937baaf8a (2) 9f52f1c63923b390b438212bdd4594d3b479b22024bd193b8a3a600572f697af (3) 452b11e8ea19803b44b474d86c13d7325a387459abe634ad1c64b13eb26d0745 (4) a663ff82b20002942c491e393951e5e366d8cceeff89732690f974f709243260 (5) 7410aba40135ee4fea322a13403b081939d245e7ed534e016090657cbdb6183c (6) 269e44a7c17d591d23a694539a8d6feee3d9894182d4bc663a2f51fc33a3f540 (7) 4f70e8c8f25a1ef2e9057a1b25053d6bceca46b68dfc0548e0c96b16fa9af5eb (8) 6114321e07ba8248509c17f4f0318aaf0edd972986f43ec652a2030b6cfe18bd (9) 37cacf13d9833bb3c63c657b42fed5f87f3806cca4d1cd400cbc5f7c8c2a3cc1 HD Wallet ================== Mnemonic: better become piano october library quarter festival ability arrow patch fringe practice Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8588 这里注意，我的测试demo指定了端口，那么也要修改对应的配置文件。 truffle.js module.exports = { networks: { development: { host: &quot;localhost&quot;, port: 8588, network_id: &quot;*&quot; // Match any network id } } }; 编译智能合约 ❖ ~/solidity/pet-shop-tutorial [16:27:59] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle compile Compiling ./contracts/Adoption.sol... Compiling ./contracts/Migrations.sol... Writing artifacts to ./build/contracts 迁移智能合约 查看项目目录，会发现migrations目录中已经存在了一个文件1_initial_migration.js 我们开始创建第二个文件2_deploy_contracts.js var Adoption = artifacts.require(&quot;./Adoption.sol&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; 执行迁移 ❖ ~/solidity/pet-shop-tutorial [16:53:30] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle migrate Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809 Migrations: 0xf7345735ec00a0b797e5469a49b5deaf9131659f Saving successful migration to network... ... 0xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a Saving artifacts... Running migration: 2_deploy_contracts.js Deploying Adoption... ... 0xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9 Adoption: 0x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a Saving successful migration to network... ... 0x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39 Saving artifacts... 同时，你在testrpc上还能看到下面的输出 Listening on localhost:8588 net_version eth_accounts eth_accounts net_version net_version eth_sendTransaction Transaction: 0x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809 Contract created: 0xf7345735ec00a0b797e5469a49b5deaf9131659f Gas usage: 201556 Block Number: 1 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a Gas usage: 41965 Block Number: 2 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_getTransactionReceipt eth_accounts net_version net_version eth_sendTransaction Transaction: 0xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9 Contract created: 0x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a Gas usage: 213057 Block Number: 3 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39 Gas usage: 26965 Block Number: 4 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_getTransactionReceipt 测试智能合约 在test文件夹中创建文件TestAdoption.sol pragma solidity ^0.4.11; import &quot;truffle/Assert.sol&quot;; //truffle公共的库 import &quot;truffle/DeployedAddresses.sol&quot;; //truffle公共的库 import &quot;../contracts/Adoption.sol&quot;; contract TestAdoption { Adoption adoption = Adoption(DeployedAddresses.Adoption()); // 测试 adopt() function testUserCanAdoptPet() { uint returnedId = adoption.adopt(8); //调用输入参数 uint expected = 8; //期望的结果 Assert.equal(returnedId, expected, &quot;Adoption of pet ID 8 should be recorded.&quot;); //判断如果没有就抛出异常 } // 单个测试 function testGetAdopterAddressByPetId() { address expected = this; address adopter = adoption.adopters(8); Assert.equal(adopter, expected, &quot;Owner of pet ID 8 should be recorded.&quot;); } // 所有的测试 function testGetAdopterAddressByPetIdInArray() { address expected = this; address[16] memory adopters = adoption.getAdopters(); Assert.equal(adopters[8], expected, &quot;Owner of pet ID 8 should be recorded.&quot;); } } 运行测试命令 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle test Using network &#39;development&#39;. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... Compilation warnings encountered: truffle/Assert.sol:114:20: Warning: This declaration shadows an existing declaration. function equal(string A, string B, string message) constant returns (bool result) { ^------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:137:23: Warning: This declaration shadows an existing declaration. function notEqual(string A, string B, string message) constant returns (bool result) { ^------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:206:20: Warning: This declaration shadows an existing declaration. function equal(bytes32 A, bytes32 B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:226:23: Warning: This declaration shadows an existing declaration. function notEqual(bytes32 A, bytes32 B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:286:20: Warning: This declaration shadows an existing declaration. function equal(address A, address B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:305:23: Warning: This declaration shadows an existing declaration. function notEqual(address A, address B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:403:20: Warning: This declaration shadows an existing declaration. function equal(bool A, bool B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:426:23: Warning: This declaration shadows an existing declaration. function notEqual(bool A, bool B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:451:20: Warning: This declaration shadows an existing declaration. function equal(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:474:23: Warning: This declaration shadows an existing declaration. function notEqual(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:497:22: Warning: This declaration shadows an existing declaration. function isAbove(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:520:24: Warning: This declaration shadows an existing declaration. function isAtLeast(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:543:22: Warning: This declaration shadows an existing declaration. function isBelow(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:566:23: Warning: This declaration shadows an existing declaration. function isAtMost(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:635:20: Warning: This declaration shadows an existing declaration. function equal(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:658:23: Warning: This declaration shadows an existing declaration. function notEqual(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:681:22: Warning: This declaration shadows an existing declaration. function isAbove(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:704:24: Warning: This declaration shadows an existing declaration. function isAtLeast(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:727:22: Warning: This declaration shadows an existing declaration. function isBelow(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:750:23: Warning: This declaration shadows an existing declaration. function isAtMost(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1267:27: Warning: This declaration shadows an existing declaration. function balanceEqual(address A, uint b, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1287:30: Warning: This declaration shadows an existing declaration. function balanceNotEqual(address A, uint b, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1306:28: Warning: This declaration shadows an existing declaration. function balanceIsZero(address A, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1325:31: Warning: This declaration shadows an existing declaration. function balanceIsNotZero(address A, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ TestAdoption ✓ testUserCanAdoptPet (100ms) ✓ testGetAdopterAddressByPetId (106ms) ✓ testGetAdopterAddressByPetIdInArray (119ms) 3 passing (912ms) 同时，在testrpc窗口中，输出如下内容 net_version eth_accounts eth_accounts eth_accounts eth_sendTransaction Transaction: 0x0248e4f5b8ed0130b6c04fb0628747948c4430b2db32ae4b4aecc5837c95a7a9 Contract created: 0x44d5b51c7a790edf595f36f647d8782ab95d2043 Gas usage: 201556 Block Number: 5 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xf25d861fa237ca89ece917d3bfcae990b00253a213e3dfe977c808727bb41621 Gas usage: 41965 Block Number: 6 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_getTransactionReceipt eth_accounts eth_sendTransaction Transaction: 0x3bc4a4f9a6a29e336135a0617b9dcda72af62f8ed6ba8cdcb52e2c13b9c0b9c1 Contract created: 0x7e434775cefce86de3c944aeb840b80ffa397e6f Gas usage: 213057 Block Number: 7 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0x8e9a560c91b97f4fe1020f9e4154b063391d4e1b6da522a80e78d572e18e3864 Gas usage: 26965 Block Number: 8 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_getTransactionReceipt evm_snapshot Saved snapshot #1 net_version eth_sendTransaction net_version eth_sendTransaction Transaction: 0xbcca837fc7693ae43eef2210f88f5b59ada90c2c56250558bdee776417c6ce8d Contract created: 0x16e910a876a0ef1ad4fceb7b15b0ed1e34212a3f Gas usage: 141661 Block Number: 9 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter Transaction: 0x8ad5172333283066102aada539d0b17f14a3a13b5bc996b8baca49296d625045 Contract created: 0x7d49d66afb1fa72446cbbeb2dc7f43237a2895d9 Gas usage: 4630196 Block Number: 10 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getFilterChanges eth_getTransactionReceipt eth_getTransactionReceipt eth_getCode eth_getCode eth_uninstallFilter eth_uninstallFilter eth_sendTransaction Transaction: 0x4a9374f9c1da7266c44b9c3f191572a79938bf446e9261a910904fbd86b019ef Contract created: 0x2411f93ad68e7a071ad6b116614d4a45049a2e36 Gas usage: 425816 Block Number: 11 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_blockNumber eth_sendTransaction Transaction: 0xc77b4f897c7ebcd27022c0b677589b6a3611384f5734660ec422cde74f0bec24 Gas usage: 48908 Block Number: 12 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt eth_blockNumber eth_sendTransaction Transaction: 0xbc11d4af9475b481271d824c3ba492d7eb23a204608c3da790b77cd8509d518e Gas usage: 29062 Block Number: 13 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt eth_blockNumber eth_sendTransaction Transaction: 0x64e35489fcad832bfce85d305726922c2c2a97dcb897ffbfc4a69b0649fc7244 Gas usage: 36064 Block Number: 14 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt 创建用户界面连接智能合约 安装web3 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g web3 npm WARN deprecated fs-promise@2.0.3: Use mz or fs-extra^3.0 with Promise Support npm WARN deprecated tar.gz@1.0.7: ⚠️ WARNING ⚠️ tar.gz module has been deprecated and your application is vulnerable. Please use tar module instead: https://npmjs.com/tar npm WARN deprecated minimatch@0.3.0: Please update to minimatch 3.0.2 or higher to avoid a RegExp DoS issue &gt; scrypt@6.0.3 preinstall /usr/local/lib/node_modules/web3/node_modules/scrypt &gt; node node-scrypt-preinstall.js &gt; scrypt@6.0.3 install /usr/local/lib/node_modules/web3/node_modules/scrypt &gt; node-gyp rebuild SOLINK_MODULE(target) Release/copied_files.node CC(target) Release/obj.target/scrypt_wrapper/src/util/memlimit.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/keyderivation.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/pickparams.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/hash.o LIBTOOL-STATIC Release/scrypt_wrapper.a CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/crypto/crypto_scrypt.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/crypto/crypto_scrypt_smix.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/util/warnp.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/alg/sha256.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/util/insecure_memzero.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/scryptenc/scryptenc_cpuperf.o LIBTOOL-STATIC Release/scrypt_lib.a CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_common.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_hash_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_hash_async.o CXX(target) Release/obj.target/scrypt/scrypt_node.o SOLINK_MODULE(target) Release/scrypt.node &gt; sha3@1.2.0 install /usr/local/lib/node_modules/web3/node_modules/sha3 &gt; node-gyp rebuild CXX(target) Release/obj.target/sha3/src/addon.o ../src/addon.cpp:59:36: warning: &#39;NewInstance&#39; is deprecated [-Wdeprecated-declarations] info.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv)); ^ /Users/xiaoyu/.node-gyp/8.5.0/include/node/v8.h:3787:3: note: &#39;NewInstance&#39; has been explicitly marked deprecated here V8_DEPRECATED(&quot;Use maybe version&quot;, ^ /Users/xiaoyu/.node-gyp/8.5.0/include/node/v8config.h:332:29: note: expanded from macro &#39;V8_DEPRECATED&#39; declarator __attribute__((deprecated)) ^ 1 warning generated. CXX(target) Release/obj.target/sha3/src/displayIntermediateValues.o CXX(target) Release/obj.target/sha3/src/KeccakF-1600-reference.o CXX(target) Release/obj.target/sha3/src/KeccakNISTInterface.o CXX(target) Release/obj.target/sha3/src/KeccakSponge.o SOLINK_MODULE(target) Release/sha3.node &gt; websocket@1.0.24 install /usr/local/lib/node_modules/web3/node_modules/websocket &gt; (node-gyp rebuild 2&gt; builderror.log) || (exit 0) CXX(target) Release/obj.target/bufferutil/src/bufferutil.o SOLINK_MODULE(target) Release/bufferutil.node CXX(target) Release/obj.target/validation/src/validation.o SOLINK_MODULE(target) Release/validation.node + web3@1.0.0-beta.24 added 289 packages in 68.85s 打开文件/src/js/app.js 下面的代码展示了如何调用web3,调用合约的方法，以及绑定数据到UI App = { web3Provider: null, contracts: {}, init: function() { // Load pets. $.getJSON(&#39;../pets.json&#39;, function(data) { var petsRow = $(&#39;#petsRow&#39;); var petTemplate = $(&#39;#petTemplate&#39;); for (i = 0; i &lt; data.length; i ++) { petTemplate.find(&#39;.panel-title&#39;).text(data[i].name); petTemplate.find(&#39;img&#39;).attr(&#39;src&#39;, data[i].picture); petTemplate.find(&#39;.pet-breed&#39;).text(data[i].breed); petTemplate.find(&#39;.pet-age&#39;).text(data[i].age); petTemplate.find(&#39;.pet-location&#39;).text(data[i].location); petTemplate.find(&#39;.btn-adopt&#39;).attr(&#39;data-id&#39;, data[i].id); petsRow.append(petTemplate.html()); } }); return App.initWeb3(); }, initWeb3: function() { // web3入口 if (typeof web3 !== &#39;undefined&#39;) { App.web3Provider = web3.currentProvider; } else { // 测试网络 App.web3Provider = new Web3.providers.HttpProvider(&#39;http://localhost:8588&#39;); //这里是我指定的端口88 } web3 = new Web3(App.web3Provider); return App.initContract(); }, initContract: function() { //加载Adoption.json $.getJSON(&#39;Adoption.json&#39;, function(data) { // 智能合约实例化 var AdoptionArtifact = data; App.contracts.Adoption = TruffleContract(AdoptionArtifact); // 设置合约提供者 App.contracts.Adoption.setProvider(App.web3Provider); // 检索操作 return App.markAdopted(); }); return App.bindEvents(); }, bindEvents: function() { $(document).on(&#39;click&#39;, &#39;.btn-adopt&#39;, App.handleAdopt); }, markAdopted: function(adopters, account) { //实例 var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; return adoptionInstance.getAdopters.call(); }).then(function(adopters) { for (i = 0; i &lt; adopters.length; i++) { if (adopters[i] !== &#39;0x0000000000000000000000000000000000000000&#39;) { $(&#39;.panel-pet&#39;).eq(i).find(&#39;button&#39;).text(&#39;Success&#39;).attr(&#39;disabled&#39;, true); } } }).catch(function(err) { console.log(err.message); }); }, handleAdopt: function() { event.preventDefault(); var petId = parseInt($(event.target).data(&#39;id&#39;)); var adoptionInstance; web3.eth.getAccounts(function(error, accounts) { if (error) { console.log(error); } var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; // Execute adopt as a transaction by sending account return adoptionInstance.adopt(petId, {from: account}); }).then(function(result) { return App.markAdopted(); }).catch(function(err) { console.log(err.message); }); }); } }; $(function() { $(window).load(function() { App.init(); }); }); 在浏览器中运行dapp 安装MetaMask到浏览器 安装扩展程序 创建测试网络账户 从其他测试网络钱包转移eth 安装和配置lite-server 打开bs-config.json文件 { &quot;server&quot;: { &quot;baseDir&quot;: [&quot;./src&quot;, &quot;./build/contracts&quot;] } } 打开package.json文件，下面配置了lite-server的部分 &quot;scripts&quot;: { &quot;dev&quot;: &quot;lite-server&quot;, &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot; }, 当运行npm run dev的时候，就会启动lite-server 运行Dapp ❖ ~/solidity/pet-shop-tutorial [17:35:33] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev &gt; pet-shop@1.0.0 dev /Users/xiaoyu/solidity/pet-shop-tutorial &gt; lite-server sh: lite-server: command not found npm ERR! file sh npm ERR! code ELIFECYCLE npm ERR! errno ENOENT npm ERR! syscall spawn npm ERR! pet-shop@1.0.0 dev: `lite-server` npm ERR! spawn ENOENT npm ERR! npm ERR! Failed at the pet-shop@1.0.0 dev script. npm ERR! This is probably not a problem with npm. There is likely additional logging output above. npm ERR! A complete log of this run can be found in: npm ERR! /Users/xiaoyu/.npm/_logs/2017-10-26T10_20_42_191Z-debug.log 报错了。。。。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g lite-server npm WARN deprecated express@2.5.11: express 2.x series is deprecated npm WARN deprecated connect@1.9.2: connect 1.x series is deprecated /usr/local/bin/lite-server -&gt; /usr/local/lib/node_modules/lite-server/bin/lite-server &gt; fsevents@1.1.2 install /usr/local/lib/node_modules/lite-server/node_modules/fsevents &gt; node install [fsevents] Success: &quot;/usr/local/lib/node_modules/lite-server/node_modules/fsevents/lib/binding/Release/node-v57-darwin-x64/fse.node&quot; already installed Pass --update-binary to reinstall or --build-from-source to recompile + lite-server@2.3.0 added 417 packages in 499.895s ❖ ~/solidity/pet-shop-tutorial [18:30:10] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev &gt; pet-shop@1.0.0 dev /Users/xiaoyu/solidity/pet-shop-tutorial &gt; lite-server ** browser-sync config ** { injectChanges: false, files: [ &#39;./**/*.{html,htm,css,js}&#39; ], watchOptions: { ignored: &#39;node_modules&#39; }, server: { baseDir: [ &#39;./src&#39;, &#39;./build/contracts&#39; ], middleware: [ [Function], [Function] ] } } [Browsersync] Access URLs: ------------------------------------- Local: http://localhost:3000 External: http://10.0.178.198:3000 ------------------------------------- UI: http://localhost:3001 UI External: http://10.0.178.198:3001 ------------------------------------- [Browsersync] Serving files from: ./src [Browsersync] Serving files from: ./build/contracts [Browsersync] Watching files... 17.10.26 18:31:20 200 GET /index.html 17.10.26 18:31:20 200 GET /css/bootstrap.min.css 17.10.26 18:31:21 200 GET /js/bootstrap.min.js 17.10.26 18:31:21 200 GET /js/web3.min.js 17.10.26 18:31:21 200 GET /js/app.js 17.10.26 18:31:21 200 GET /js/truffle-contract.js 17.10.26 18:31:24 200 GET /pets.json 17.10.26 18:31:24 200 GET /Adoption.json 17.10.26 18:31:24 200 GET /images/french-bulldog.jpeg 17.10.26 18:31:24 200 GET /images/boxer.jpeg 17.10.26 18:31:24 200 GET /images/scottish-terrier.jpeg 17.10.26 18:31:24 200 GET /images/golden-retriever.jpeg 17.10.26 18:31:24 404 GET /favicon.ico 然后会自动打开浏览器,http://localhost:3000/ 点击adopt按钮，会跳出提示，支付合约费用，完成调用。 总结 Truffle能完成智能合约的整套流程。 Truffle Box 提供了现成的项目，可以快速上手。 Truffle官网文档够详细，点个赞。 参考资料 http://truffleframework.com/docs/getting_started/project http://truffleframework.com/tutorials/pet-shop https://github.com/ethereumjs/testrpc http://truffleframework.com/boxes/ https://github.com/trufflesuite/truffle-core/blob/master/lib/testing/Assert.sol https://github.com/ethereum/web3.js/ https://metamask.io/ 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/diandianxiyu/article/details/78361621 Truffle 部署 编译 测试 智能合约 的 完整实践操作 目标 搭建开发环境 创建一个Truffle项目 编写智能合约 编译转移智能合约 测试智能合约 创建用户界面连接智能合约 在浏览器中访问Dapp 搭建开发环境 Node.js v6+ LTS and npm (comes with Node) Git 这里配置脚本略过。。。。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ node -v v8.5.0 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm -v 5.4.2 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ git --version git version 2.13.5 (Apple Git-94) xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g ethereumjs-testrpc /usr/local/bin/testrpc -&gt; /usr/local/lib/node_modules/ethereumjs-testrpc/build/cli.node.js &gt; fsevents@1.1.2 install /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/fsevents &gt; node install events.js:182 throw er; // Unhandled &#39;error&#39; event ^ Error: spawn node-pre-gyp ENOENT at _errnoException (util.js:1026:11) at Process.ChildProcess._handle.onexit (internal/child_process.js:192:19) at onErrorNT (internal/child_process.js:374:16) at _combinedTickCallback (internal/process/next_tick.js:138:11) at process._tickCallback (internal/process/next_tick.js:180:9) at Function.Module.runMain (module.js:667:11) at startup (bootstrap_node.js:201:16) at bootstrap_node.js:626:3 &gt; uglifyjs-webpack-plugin@0.4.6 postinstall /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/uglifyjs-webpack-plugin &gt; node lib/post_install.js npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 (node_modules/ethereumjs-testrpc/node_modules/fsevents): npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 install: `node install` npm WARN optional SKIPPING OPTIONAL DEPENDENCY: Exit status 1 + ethereumjs-testrpc@4.1.3 added 2 packages, removed 475 packages, updated 238 packages and moved 1 package in 293.194s ╭─────────────────────────────────────╮ │ │ │ Update available 5.4.2 → 5.5.1 │ │ Run npm i -g npm to update │ │ │ ╰─────────────────────────────────────╯ xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm i -g npm to update /usr/local/bin/npm -&gt; /usr/local/lib/node_modules/npm/bin/npm-cli.js /usr/local/bin/npx -&gt; /usr/local/lib/node_modules/npm/bin/npx-cli.js /usr/local/bin/update -&gt; /usr/local/lib/node_modules/update/bin/update.js + update@0.7.4 + npm@5.5.1 + to@0.2.9 added 708 packages, removed 2 packages and updated 29 packages in 434.067s xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ sudo npm install -g ethereumjs-testrpc npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/decamelize npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_strip-ansi@3.0.1@strip-ansi/node_modules/ansi-regex npm ERR! path /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui npm ERR! code ENOENT npm ERR! errno -2 npm ERR! syscall access npm ERR! enoent ENOENT: no such file or directory, access &#39;/usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui&#39; npm ERR! enoent This is related to npm not being able to find a file. npm ERR! enoent npm ERR! A complete log of this run can be found in: npm ERR! /Users/xiaoyu/.npm/_logs/2017-10-26T08_09_48_018Z-debug.log xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g truffle /usr/local/bin/truffle -&gt; /usr/local/lib/node_modules/truffle/build/cli.bundled.js + truffle@3.4.11 removed 105 packages and updated 91 packages in 89.658s 用Truffle Box创建一个Truffle项目 ❖ ~/solidity [16:15:01] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ mkdir pet-shop-tutorial ❖ ~/solidity [16:15:06] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cd pet-shop-tutorial xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle unbox pet-shop Downloading... Unpacking... Setting up... 目录结构 /contracts 智能合约 /migrations 迁移系统来处理智能合约部署 /test 测试 truffle.js 配置文件 其他部分是nodejs的配置文件以及文件夹 编写智能合约 在contracts中创建Adoption.sol文件 pragma solidity ^0.4.4; contract Adoption { address[16] public adopters; //存储地址 //采用一个宠物 function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); adopters[petId] = msg.sender; return petId; } //返回采用者 function getAdopters() public returns (address[16]) { return adopters; } } 编译转移智能合约 EVM的测试环境 打开另一个窗口 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ testrpc -p 8588 EthereumJS TestRPC v4.1.3 (ganache-core: 1.1.3) Available Accounts ================== (0) 0xd2a54e8087d88889e1857698ceb228493b67bab6 (1) 0x44d32639c3803b9daa7392ff2ea50644153d7721 (2) 0x32d951e2f319edb079764b1c75864497a3132446 (3) 0x82244a630d6031be85ca298376cfa2bd6c7389a6 (4) 0xd3b556b69eb670a250bbc3f15ebefb081d4c7108 (5) 0x9f50cf1b425c6ca97de0128e46a21abd7bda3258 (6) 0x8e0545a4fe9eac1bb2f4683f0c6b36cd4a364a40 (7) 0x200b052f6eaeaa1dc11abcc3101b7a8aca293e70 (8) 0xcbd4c8b9d264367d385d4938c3b390a2eb0f2a62 (9) 0xa769a296f0bbab07e48ca62da5ad5aea4c920580 Private Keys ================== (0) a4f66a0654bbd1338a0cc9264624ad9f710f5cd65bbd4aed6f0b20706335e573 (1) cab64a11662597c79a9e866865efbec4b2e1701ed21783f68a61162937baaf8a (2) 9f52f1c63923b390b438212bdd4594d3b479b22024bd193b8a3a600572f697af (3) 452b11e8ea19803b44b474d86c13d7325a387459abe634ad1c64b13eb26d0745 (4) a663ff82b20002942c491e393951e5e366d8cceeff89732690f974f709243260 (5) 7410aba40135ee4fea322a13403b081939d245e7ed534e016090657cbdb6183c (6) 269e44a7c17d591d23a694539a8d6feee3d9894182d4bc663a2f51fc33a3f540 (7) 4f70e8c8f25a1ef2e9057a1b25053d6bceca46b68dfc0548e0c96b16fa9af5eb (8) 6114321e07ba8248509c17f4f0318aaf0edd972986f43ec652a2030b6cfe18bd (9) 37cacf13d9833bb3c63c657b42fed5f87f3806cca4d1cd400cbc5f7c8c2a3cc1 HD Wallet ================== Mnemonic: better become piano october library quarter festival ability arrow patch fringe practice Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8588 这里注意，我的测试demo指定了端口，那么也要修改对应的配置文件。 truffle.js module.exports = { networks: { development: { host: &quot;localhost&quot;, port: 8588, network_id: &quot;*&quot; // Match any network id } } }; 编译智能合约 ❖ ~/solidity/pet-shop-tutorial [16:27:59] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle compile Compiling ./contracts/Adoption.sol... Compiling ./contracts/Migrations.sol... Writing artifacts to ./build/contracts 迁移智能合约 查看项目目录，会发现migrations目录中已经存在了一个文件1_initial_migration.js 我们开始创建第二个文件2_deploy_contracts.js var Adoption = artifacts.require(&quot;./Adoption.sol&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; 执行迁移 ❖ ~/solidity/pet-shop-tutorial [16:53:30] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle migrate Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809 Migrations: 0xf7345735ec00a0b797e5469a49b5deaf9131659f Saving successful migration to network... ... 0xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a Saving artifacts... Running migration: 2_deploy_contracts.js Deploying Adoption... ... 0xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9 Adoption: 0x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a Saving successful migration to network... ... 0x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39 Saving artifacts... 同时，你在testrpc上还能看到下面的输出 Listening on localhost:8588 net_version eth_accounts eth_accounts net_version net_version eth_sendTransaction Transaction: 0x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809 Contract created: 0xf7345735ec00a0b797e5469a49b5deaf9131659f Gas usage: 201556 Block Number: 1 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a Gas usage: 41965 Block Number: 2 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_getTransactionReceipt eth_accounts net_version net_version eth_sendTransaction Transaction: 0xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9 Contract created: 0x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a Gas usage: 213057 Block Number: 3 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39 Gas usage: 26965 Block Number: 4 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_getTransactionReceipt 测试智能合约 在test文件夹中创建文件TestAdoption.sol pragma solidity ^0.4.11; import &quot;truffle/Assert.sol&quot;; //truffle公共的库 import &quot;truffle/DeployedAddresses.sol&quot;; //truffle公共的库 import &quot;../contracts/Adoption.sol&quot;; contract TestAdoption { Adoption adoption = Adoption(DeployedAddresses.Adoption()); // 测试 adopt() function testUserCanAdoptPet() { uint returnedId = adoption.adopt(8); //调用输入参数 uint expected = 8; //期望的结果 Assert.equal(returnedId, expected, &quot;Adoption of pet ID 8 should be recorded.&quot;); //判断如果没有就抛出异常 } // 单个测试 function testGetAdopterAddressByPetId() { address expected = this; address adopter = adoption.adopters(8); Assert.equal(adopter, expected, &quot;Owner of pet ID 8 should be recorded.&quot;); } // 所有的测试 function testGetAdopterAddressByPetIdInArray() { address expected = this; address[16] memory adopters = adoption.getAdopters(); Assert.equal(adopters[8], expected, &quot;Owner of pet ID 8 should be recorded.&quot;); } } 运行测试命令 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle test Using network &#39;development&#39;. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... Compilation warnings encountered: truffle/Assert.sol:114:20: Warning: This declaration shadows an existing declaration. function equal(string A, string B, string message) constant returns (bool result) { ^------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:137:23: Warning: This declaration shadows an existing declaration. function notEqual(string A, string B, string message) constant returns (bool result) { ^------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:206:20: Warning: This declaration shadows an existing declaration. function equal(bytes32 A, bytes32 B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:226:23: Warning: This declaration shadows an existing declaration. function notEqual(bytes32 A, bytes32 B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:286:20: Warning: This declaration shadows an existing declaration. function equal(address A, address B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:305:23: Warning: This declaration shadows an existing declaration. function notEqual(address A, address B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:403:20: Warning: This declaration shadows an existing declaration. function equal(bool A, bool B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:426:23: Warning: This declaration shadows an existing declaration. function notEqual(bool A, bool B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:451:20: Warning: This declaration shadows an existing declaration. function equal(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:474:23: Warning: This declaration shadows an existing declaration. function notEqual(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:497:22: Warning: This declaration shadows an existing declaration. function isAbove(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:520:24: Warning: This declaration shadows an existing declaration. function isAtLeast(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:543:22: Warning: This declaration shadows an existing declaration. function isBelow(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:566:23: Warning: This declaration shadows an existing declaration. function isAtMost(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:635:20: Warning: This declaration shadows an existing declaration. function equal(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:658:23: Warning: This declaration shadows an existing declaration. function notEqual(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:681:22: Warning: This declaration shadows an existing declaration. function isAbove(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:704:24: Warning: This declaration shadows an existing declaration. function isAtLeast(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:727:22: Warning: This declaration shadows an existing declaration. function isBelow(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:750:23: Warning: This declaration shadows an existing declaration. function isAtMost(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1267:27: Warning: This declaration shadows an existing declaration. function balanceEqual(address A, uint b, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1287:30: Warning: This declaration shadows an existing declaration. function balanceNotEqual(address A, uint b, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1306:28: Warning: This declaration shadows an existing declaration. function balanceIsZero(address A, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1325:31: Warning: This declaration shadows an existing declaration. function balanceIsNotZero(address A, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ TestAdoption ✓ testUserCanAdoptPet (100ms) ✓ testGetAdopterAddressByPetId (106ms) ✓ testGetAdopterAddressByPetIdInArray (119ms) 3 passing (912ms) 同时，在testrpc窗口中，输出如下内容 net_version eth_accounts eth_accounts eth_accounts eth_sendTransaction Transaction: 0x0248e4f5b8ed0130b6c04fb0628747948c4430b2db32ae4b4aecc5837c95a7a9 Contract created: 0x44d5b51c7a790edf595f36f647d8782ab95d2043 Gas usage: 201556 Block Number: 5 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xf25d861fa237ca89ece917d3bfcae990b00253a213e3dfe977c808727bb41621 Gas usage: 41965 Block Number: 6 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_getTransactionReceipt eth_accounts eth_sendTransaction Transaction: 0x3bc4a4f9a6a29e336135a0617b9dcda72af62f8ed6ba8cdcb52e2c13b9c0b9c1 Contract created: 0x7e434775cefce86de3c944aeb840b80ffa397e6f Gas usage: 213057 Block Number: 7 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0x8e9a560c91b97f4fe1020f9e4154b063391d4e1b6da522a80e78d572e18e3864 Gas usage: 26965 Block Number: 8 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_getTransactionReceipt evm_snapshot Saved snapshot #1 net_version eth_sendTransaction net_version eth_sendTransaction Transaction: 0xbcca837fc7693ae43eef2210f88f5b59ada90c2c56250558bdee776417c6ce8d Contract created: 0x16e910a876a0ef1ad4fceb7b15b0ed1e34212a3f Gas usage: 141661 Block Number: 9 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter Transaction: 0x8ad5172333283066102aada539d0b17f14a3a13b5bc996b8baca49296d625045 Contract created: 0x7d49d66afb1fa72446cbbeb2dc7f43237a2895d9 Gas usage: 4630196 Block Number: 10 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getFilterChanges eth_getTransactionReceipt eth_getTransactionReceipt eth_getCode eth_getCode eth_uninstallFilter eth_uninstallFilter eth_sendTransaction Transaction: 0x4a9374f9c1da7266c44b9c3f191572a79938bf446e9261a910904fbd86b019ef Contract created: 0x2411f93ad68e7a071ad6b116614d4a45049a2e36 Gas usage: 425816 Block Number: 11 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_blockNumber eth_sendTransaction Transaction: 0xc77b4f897c7ebcd27022c0b677589b6a3611384f5734660ec422cde74f0bec24 Gas usage: 48908 Block Number: 12 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt eth_blockNumber eth_sendTransaction Transaction: 0xbc11d4af9475b481271d824c3ba492d7eb23a204608c3da790b77cd8509d518e Gas usage: 29062 Block Number: 13 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt eth_blockNumber eth_sendTransaction Transaction: 0x64e35489fcad832bfce85d305726922c2c2a97dcb897ffbfc4a69b0649fc7244 Gas usage: 36064 Block Number: 14 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt 创建用户界面连接智能合约 安装web3 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g web3 npm WARN deprecated fs-promise@2.0.3: Use mz or fs-extra^3.0 with Promise Support npm WARN deprecated tar.gz@1.0.7: ⚠️ WARNING ⚠️ tar.gz module has been deprecated and your application is vulnerable. Please use tar module instead: https://npmjs.com/tar npm WARN deprecated minimatch@0.3.0: Please update to minimatch 3.0.2 or higher to avoid a RegExp DoS issue &gt; scrypt@6.0.3 preinstall /usr/local/lib/node_modules/web3/node_modules/scrypt &gt; node node-scrypt-preinstall.js &gt; scrypt@6.0.3 install /usr/local/lib/node_modules/web3/node_modules/scrypt &gt; node-gyp rebuild SOLINK_MODULE(target) Release/copied_files.node CC(target) Release/obj.target/scrypt_wrapper/src/util/memlimit.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/keyderivation.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/pickparams.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/hash.o LIBTOOL-STATIC Release/scrypt_wrapper.a CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/crypto/crypto_scrypt.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/crypto/crypto_scrypt_smix.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/util/warnp.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/alg/sha256.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/util/insecure_memzero.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/scryptenc/scryptenc_cpuperf.o LIBTOOL-STATIC Release/scrypt_lib.a CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_common.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_hash_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_hash_async.o CXX(target) Release/obj.target/scrypt/scrypt_node.o SOLINK_MODULE(target) Release/scrypt.node &gt; sha3@1.2.0 install /usr/local/lib/node_modules/web3/node_modules/sha3 &gt; node-gyp rebuild CXX(target) Release/obj.target/sha3/src/addon.o ../src/addon.cpp:59:36: warning: &#39;NewInstance&#39; is deprecated [-Wdeprecated-declarations] info.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv)); ^ /Users/xiaoyu/.node-gyp/8.5.0/include/node/v8.h:3787:3: note: &#39;NewInstance&#39; has been explicitly marked deprecated here V8_DEPRECATED(&quot;Use maybe version&quot;, ^ /Users/xiaoyu/.node-gyp/8.5.0/include/node/v8config.h:332:29: note: expanded from macro &#39;V8_DEPRECATED&#39; declarator __attribute__((deprecated)) ^ 1 warning generated. CXX(target) Release/obj.target/sha3/src/displayIntermediateValues.o CXX(target) Release/obj.target/sha3/src/KeccakF-1600-reference.o CXX(target) Release/obj.target/sha3/src/KeccakNISTInterface.o CXX(target) Release/obj.target/sha3/src/KeccakSponge.o SOLINK_MODULE(target) Release/sha3.node &gt; websocket@1.0.24 install /usr/local/lib/node_modules/web3/node_modules/websocket &gt; (node-gyp rebuild 2&gt; builderror.log) || (exit 0) CXX(target) Release/obj.target/bufferutil/src/bufferutil.o SOLINK_MODULE(target) Release/bufferutil.node CXX(target) Release/obj.target/validation/src/validation.o SOLINK_MODULE(target) Release/validation.node + web3@1.0.0-beta.24 added 289 packages in 68.85s 打开文件/src/js/app.js 下面的代码展示了如何调用web3,调用合约的方法，以及绑定数据到UI App = { web3Provider: null, contracts: {}, init: function() { // Load pets. $.getJSON(&#39;../pets.json&#39;, function(data) { var petsRow = $(&#39;#petsRow&#39;); var petTemplate = $(&#39;#petTemplate&#39;); for (i = 0; i &lt; data.length; i ++) { petTemplate.find(&#39;.panel-title&#39;).text(data[i].name); petTemplate.find(&#39;img&#39;).attr(&#39;src&#39;, data[i].picture); petTemplate.find(&#39;.pet-breed&#39;).text(data[i].breed); petTemplate.find(&#39;.pet-age&#39;).text(data[i].age); petTemplate.find(&#39;.pet-location&#39;).text(data[i].location); petTemplate.find(&#39;.btn-adopt&#39;).attr(&#39;data-id&#39;, data[i].id); petsRow.append(petTemplate.html()); } }); return App.initWeb3(); }, initWeb3: function() { // web3入口 if (typeof web3 !== &#39;undefined&#39;) { App.web3Provider = web3.currentProvider; } else { // 测试网络 App.web3Provider = new Web3.providers.HttpProvider(&#39;http://localhost:8588&#39;); //这里是我指定的端口88 } web3 = new Web3(App.web3Provider); return App.initContract(); }, initContract: function() { //加载Adoption.json $.getJSON(&#39;Adoption.json&#39;, function(data) { // 智能合约实例化 var AdoptionArtifact = data; App.contracts.Adoption = TruffleContract(AdoptionArtifact); // 设置合约提供者 App.contracts.Adoption.setProvider(App.web3Provider); // 检索操作 return App.markAdopted(); }); return App.bindEvents(); }, bindEvents: function() { $(document).on(&#39;click&#39;, &#39;.btn-adopt&#39;, App.handleAdopt); }, markAdopted: function(adopters, account) { //实例 var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; return adoptionInstance.getAdopters.call(); }).then(function(adopters) { for (i = 0; i &lt; adopters.length; i++) { if (adopters[i] !== &#39;0x0000000000000000000000000000000000000000&#39;) { $(&#39;.panel-pet&#39;).eq(i).find(&#39;button&#39;).text(&#39;Success&#39;).attr(&#39;disabled&#39;, true); } } }).catch(function(err) { console.log(err.message); }); }, handleAdopt: function() { event.preventDefault(); var petId = parseInt($(event.target).data(&#39;id&#39;)); var adoptionInstance; web3.eth.getAccounts(function(error, accounts) { if (error) { console.log(error); } var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; // Execute adopt as a transaction by sending account return adoptionInstance.adopt(petId, {from: account}); }).then(function(result) { return App.markAdopted(); }).catch(function(err) { console.log(err.message); }); }); } }; $(function() { $(window).load(function() { App.init(); }); }); 在浏览器中运行dapp 安装MetaMask到浏览器 安装扩展程序 创建测试网络账户 从其他测试网络钱包转移eth 安装和配置lite-server 打开bs-config.json文件 { &quot;server&quot;: { &quot;baseDir&quot;: [&quot;./src&quot;, &quot;./build/contracts&quot;] } } 打开package.json文件，下面配置了lite-server的部分 &quot;scripts&quot;: { &quot;dev&quot;: &quot;lite-server&quot;, &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot; }, 当运行npm run dev的时候，就会启动lite-server 运行Dapp ❖ ~/solidity/pet-shop-tutorial [17:35:33] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev &gt; pet-shop@1.0.0 dev /Users/xiaoyu/solidity/pet-shop-tutorial &gt; lite-server sh: lite-server: command not found npm ERR! file sh npm ERR! code ELIFECYCLE npm ERR! errno ENOENT npm ERR! syscall spawn npm ERR! pet-shop@1.0.0 dev: `lite-server` npm ERR! spawn ENOENT npm ERR! npm ERR! Failed at the pet-shop@1.0.0 dev script. npm ERR! This is probably not a problem with npm. There is likely additional logging output above. npm ERR! A complete log of this run can be found in: npm ERR! /Users/xiaoyu/.npm/_logs/2017-10-26T10_20_42_191Z-debug.log 报错了。。。。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g lite-server npm WARN deprecated express@2.5.11: express 2.x series is deprecated npm WARN deprecated connect@1.9.2: connect 1.x series is deprecated /usr/local/bin/lite-server -&gt; /usr/local/lib/node_modules/lite-server/bin/lite-server &gt; fsevents@1.1.2 install /usr/local/lib/node_modules/lite-server/node_modules/fsevents &gt; node install [fsevents] Success: &quot;/usr/local/lib/node_modules/lite-server/node_modules/fsevents/lib/binding/Release/node-v57-darwin-x64/fse.node&quot; already installed Pass --update-binary to reinstall or --build-from-source to recompile + lite-server@2.3.0 added 417 packages in 499.895s ❖ ~/solidity/pet-shop-tutorial [18:30:10] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev &gt; pet-shop@1.0.0 dev /Users/xiaoyu/solidity/pet-shop-tutorial &gt; lite-server ** browser-sync config ** { injectChanges: false, files: [ &#39;./**/*.{html,htm,css,js}&#39; ], watchOptions: { ignored: &#39;node_modules&#39; }, server: { baseDir: [ &#39;./src&#39;, &#39;./build/contracts&#39; ], middleware: [ [Function], [Function] ] } } [Browsersync] Access URLs: ------------------------------------- Local: http://localhost:3000 External: http://10.0.178.198:3000 ------------------------------------- UI: http://localhost:3001 UI External: http://10.0.178.198:3001 ------------------------------------- [Browsersync] Serving files from: ./src [Browsersync] Serving files from: ./build/contracts [Browsersync] Watching files... 17.10.26 18:31:20 200 GET /index.html 17.10.26 18:31:20 200 GET /css/bootstrap.min.css 17.10.26 18:31:21 200 GET /js/bootstrap.min.js 17.10.26 18:31:21 200 GET /js/web3.min.js 17.10.26 18:31:21 200 GET /js/app.js 17.10.26 18:31:21 200 GET /js/truffle-contract.js 17.10.26 18:31:24 200 GET /pets.json 17.10.26 18:31:24 200 GET /Adoption.json 17.10.26 18:31:24 200 GET /images/french-bulldog.jpeg 17.10.26 18:31:24 200 GET /images/boxer.jpeg 17.10.26 18:31:24 200 GET /images/scottish-terrier.jpeg 17.10.26 18:31:24 200 GET /images/golden-retriever.jpeg 17.10.26 18:31:24 404 GET /favicon.ico 然后会自动打开浏览器,http://localhost:3000/ 点击adopt按钮，会跳出提示，支付合约费用，完成调用。 总结 Truffle能完成智能合约的整套流程。 Truffle Box 提供了现成的项目，可以快速上手。 Truffle官网文档够详细，点个赞。 参考资料 http://truffleframework.com/docs/getting_started/project http://truffleframework.com/tutorials/pet-shop https://github.com/ethereumjs/testrpc http://truffleframework.com/boxes/ https://github.com/trufflesuite/truffle-core/blob/master/lib/testing/Assert.sol https://github.com/ethereum/web3.js/ https://metamask.io/ 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/10/27/a44febb15619b79f5d0c57cdee1c2019.html" />
<meta property="og:url" content="https://mlh.app/2017/10/27/a44febb15619b79f5d0c57cdee1c2019.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-10-27T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/diandianxiyu/article/details/78361621 Truffle 部署 编译 测试 智能合约 的 完整实践操作 目标 搭建开发环境 创建一个Truffle项目 编写智能合约 编译转移智能合约 测试智能合约 创建用户界面连接智能合约 在浏览器中访问Dapp 搭建开发环境 Node.js v6+ LTS and npm (comes with Node) Git 这里配置脚本略过。。。。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ node -v v8.5.0 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm -v 5.4.2 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ git --version git version 2.13.5 (Apple Git-94) xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g ethereumjs-testrpc /usr/local/bin/testrpc -&gt; /usr/local/lib/node_modules/ethereumjs-testrpc/build/cli.node.js &gt; fsevents@1.1.2 install /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/fsevents &gt; node install events.js:182 throw er; // Unhandled &#39;error&#39; event ^ Error: spawn node-pre-gyp ENOENT at _errnoException (util.js:1026:11) at Process.ChildProcess._handle.onexit (internal/child_process.js:192:19) at onErrorNT (internal/child_process.js:374:16) at _combinedTickCallback (internal/process/next_tick.js:138:11) at process._tickCallback (internal/process/next_tick.js:180:9) at Function.Module.runMain (module.js:667:11) at startup (bootstrap_node.js:201:16) at bootstrap_node.js:626:3 &gt; uglifyjs-webpack-plugin@0.4.6 postinstall /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/uglifyjs-webpack-plugin &gt; node lib/post_install.js npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 (node_modules/ethereumjs-testrpc/node_modules/fsevents): npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 install: `node install` npm WARN optional SKIPPING OPTIONAL DEPENDENCY: Exit status 1 + ethereumjs-testrpc@4.1.3 added 2 packages, removed 475 packages, updated 238 packages and moved 1 package in 293.194s ╭─────────────────────────────────────╮ │ │ │ Update available 5.4.2 → 5.5.1 │ │ Run npm i -g npm to update │ │ │ ╰─────────────────────────────────────╯ xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm i -g npm to update /usr/local/bin/npm -&gt; /usr/local/lib/node_modules/npm/bin/npm-cli.js /usr/local/bin/npx -&gt; /usr/local/lib/node_modules/npm/bin/npx-cli.js /usr/local/bin/update -&gt; /usr/local/lib/node_modules/update/bin/update.js + update@0.7.4 + npm@5.5.1 + to@0.2.9 added 708 packages, removed 2 packages and updated 29 packages in 434.067s xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ sudo npm install -g ethereumjs-testrpc npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/decamelize npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_strip-ansi@3.0.1@strip-ansi/node_modules/ansi-regex npm ERR! path /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui npm ERR! code ENOENT npm ERR! errno -2 npm ERR! syscall access npm ERR! enoent ENOENT: no such file or directory, access &#39;/usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui&#39; npm ERR! enoent This is related to npm not being able to find a file. npm ERR! enoent npm ERR! A complete log of this run can be found in: npm ERR! /Users/xiaoyu/.npm/_logs/2017-10-26T08_09_48_018Z-debug.log xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g truffle /usr/local/bin/truffle -&gt; /usr/local/lib/node_modules/truffle/build/cli.bundled.js + truffle@3.4.11 removed 105 packages and updated 91 packages in 89.658s 用Truffle Box创建一个Truffle项目 ❖ ~/solidity [16:15:01] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ mkdir pet-shop-tutorial ❖ ~/solidity [16:15:06] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ cd pet-shop-tutorial xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle unbox pet-shop Downloading... Unpacking... Setting up... 目录结构 /contracts 智能合约 /migrations 迁移系统来处理智能合约部署 /test 测试 truffle.js 配置文件 其他部分是nodejs的配置文件以及文件夹 编写智能合约 在contracts中创建Adoption.sol文件 pragma solidity ^0.4.4; contract Adoption { address[16] public adopters; //存储地址 //采用一个宠物 function adopt(uint petId) public returns (uint) { require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); adopters[petId] = msg.sender; return petId; } //返回采用者 function getAdopters() public returns (address[16]) { return adopters; } } 编译转移智能合约 EVM的测试环境 打开另一个窗口 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ testrpc -p 8588 EthereumJS TestRPC v4.1.3 (ganache-core: 1.1.3) Available Accounts ================== (0) 0xd2a54e8087d88889e1857698ceb228493b67bab6 (1) 0x44d32639c3803b9daa7392ff2ea50644153d7721 (2) 0x32d951e2f319edb079764b1c75864497a3132446 (3) 0x82244a630d6031be85ca298376cfa2bd6c7389a6 (4) 0xd3b556b69eb670a250bbc3f15ebefb081d4c7108 (5) 0x9f50cf1b425c6ca97de0128e46a21abd7bda3258 (6) 0x8e0545a4fe9eac1bb2f4683f0c6b36cd4a364a40 (7) 0x200b052f6eaeaa1dc11abcc3101b7a8aca293e70 (8) 0xcbd4c8b9d264367d385d4938c3b390a2eb0f2a62 (9) 0xa769a296f0bbab07e48ca62da5ad5aea4c920580 Private Keys ================== (0) a4f66a0654bbd1338a0cc9264624ad9f710f5cd65bbd4aed6f0b20706335e573 (1) cab64a11662597c79a9e866865efbec4b2e1701ed21783f68a61162937baaf8a (2) 9f52f1c63923b390b438212bdd4594d3b479b22024bd193b8a3a600572f697af (3) 452b11e8ea19803b44b474d86c13d7325a387459abe634ad1c64b13eb26d0745 (4) a663ff82b20002942c491e393951e5e366d8cceeff89732690f974f709243260 (5) 7410aba40135ee4fea322a13403b081939d245e7ed534e016090657cbdb6183c (6) 269e44a7c17d591d23a694539a8d6feee3d9894182d4bc663a2f51fc33a3f540 (7) 4f70e8c8f25a1ef2e9057a1b25053d6bceca46b68dfc0548e0c96b16fa9af5eb (8) 6114321e07ba8248509c17f4f0318aaf0edd972986f43ec652a2030b6cfe18bd (9) 37cacf13d9833bb3c63c657b42fed5f87f3806cca4d1cd400cbc5f7c8c2a3cc1 HD Wallet ================== Mnemonic: better become piano october library quarter festival ability arrow patch fringe practice Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8588 这里注意，我的测试demo指定了端口，那么也要修改对应的配置文件。 truffle.js module.exports = { networks: { development: { host: &quot;localhost&quot;, port: 8588, network_id: &quot;*&quot; // Match any network id } } }; 编译智能合约 ❖ ~/solidity/pet-shop-tutorial [16:27:59] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle compile Compiling ./contracts/Adoption.sol... Compiling ./contracts/Migrations.sol... Writing artifacts to ./build/contracts 迁移智能合约 查看项目目录，会发现migrations目录中已经存在了一个文件1_initial_migration.js 我们开始创建第二个文件2_deploy_contracts.js var Adoption = artifacts.require(&quot;./Adoption.sol&quot;); module.exports = function(deployer) { deployer.deploy(Adoption); }; 执行迁移 ❖ ~/solidity/pet-shop-tutorial [16:53:30] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle migrate Using network &#39;development&#39;. Running migration: 1_initial_migration.js Deploying Migrations... ... 0x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809 Migrations: 0xf7345735ec00a0b797e5469a49b5deaf9131659f Saving successful migration to network... ... 0xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a Saving artifacts... Running migration: 2_deploy_contracts.js Deploying Adoption... ... 0xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9 Adoption: 0x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a Saving successful migration to network... ... 0x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39 Saving artifacts... 同时，你在testrpc上还能看到下面的输出 Listening on localhost:8588 net_version eth_accounts eth_accounts net_version net_version eth_sendTransaction Transaction: 0x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809 Contract created: 0xf7345735ec00a0b797e5469a49b5deaf9131659f Gas usage: 201556 Block Number: 1 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a Gas usage: 41965 Block Number: 2 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_getTransactionReceipt eth_accounts net_version net_version eth_sendTransaction Transaction: 0xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9 Contract created: 0x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a Gas usage: 213057 Block Number: 3 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39 Gas usage: 26965 Block Number: 4 Block Time: Thu Oct 26 2017 16:58:31 GMT+0800 (CST) eth_getTransactionReceipt 测试智能合约 在test文件夹中创建文件TestAdoption.sol pragma solidity ^0.4.11; import &quot;truffle/Assert.sol&quot;; //truffle公共的库 import &quot;truffle/DeployedAddresses.sol&quot;; //truffle公共的库 import &quot;../contracts/Adoption.sol&quot;; contract TestAdoption { Adoption adoption = Adoption(DeployedAddresses.Adoption()); // 测试 adopt() function testUserCanAdoptPet() { uint returnedId = adoption.adopt(8); //调用输入参数 uint expected = 8; //期望的结果 Assert.equal(returnedId, expected, &quot;Adoption of pet ID 8 should be recorded.&quot;); //判断如果没有就抛出异常 } // 单个测试 function testGetAdopterAddressByPetId() { address expected = this; address adopter = adoption.adopters(8); Assert.equal(adopter, expected, &quot;Owner of pet ID 8 should be recorded.&quot;); } // 所有的测试 function testGetAdopterAddressByPetIdInArray() { address expected = this; address[16] memory adopters = adoption.getAdopters(); Assert.equal(adopters[8], expected, &quot;Owner of pet ID 8 should be recorded.&quot;); } } 运行测试命令 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle test Using network &#39;development&#39;. Compiling ./contracts/Adoption.sol... Compiling ./test/TestAdoption.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... Compilation warnings encountered: truffle/Assert.sol:114:20: Warning: This declaration shadows an existing declaration. function equal(string A, string B, string message) constant returns (bool result) { ^------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:137:23: Warning: This declaration shadows an existing declaration. function notEqual(string A, string B, string message) constant returns (bool result) { ^------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:206:20: Warning: This declaration shadows an existing declaration. function equal(bytes32 A, bytes32 B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:226:23: Warning: This declaration shadows an existing declaration. function notEqual(bytes32 A, bytes32 B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:286:20: Warning: This declaration shadows an existing declaration. function equal(address A, address B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:305:23: Warning: This declaration shadows an existing declaration. function notEqual(address A, address B, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:403:20: Warning: This declaration shadows an existing declaration. function equal(bool A, bool B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:426:23: Warning: This declaration shadows an existing declaration. function notEqual(bool A, bool B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:451:20: Warning: This declaration shadows an existing declaration. function equal(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:474:23: Warning: This declaration shadows an existing declaration. function notEqual(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:497:22: Warning: This declaration shadows an existing declaration. function isAbove(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:520:24: Warning: This declaration shadows an existing declaration. function isAtLeast(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:543:22: Warning: This declaration shadows an existing declaration. function isBelow(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:566:23: Warning: This declaration shadows an existing declaration. function isAtMost(uint A, uint B, string message) constant returns (bool result) { ^----^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:635:20: Warning: This declaration shadows an existing declaration. function equal(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:658:23: Warning: This declaration shadows an existing declaration. function notEqual(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:681:22: Warning: This declaration shadows an existing declaration. function isAbove(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:704:24: Warning: This declaration shadows an existing declaration. function isAtLeast(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:727:22: Warning: This declaration shadows an existing declaration. function isBelow(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:750:23: Warning: This declaration shadows an existing declaration. function isAtMost(int A, int B, string message) constant returns (bool result) { ^---^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1267:27: Warning: This declaration shadows an existing declaration. function balanceEqual(address A, uint b, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1287:30: Warning: This declaration shadows an existing declaration. function balanceNotEqual(address A, uint b, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1306:28: Warning: This declaration shadows an existing declaration. function balanceIsZero(address A, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ ,truffle/Assert.sol:1325:31: Warning: This declaration shadows an existing declaration. function balanceIsNotZero(address A, string message) constant returns (bool result) { ^-------^ truffle/Assert.sol:64:5: The shadowed declaration is here: uint8 constant A = uint8(byte(&#39;a&#39;)); ^---------------------------------^ TestAdoption ✓ testUserCanAdoptPet (100ms) ✓ testGetAdopterAddressByPetId (106ms) ✓ testGetAdopterAddressByPetIdInArray (119ms) 3 passing (912ms) 同时，在testrpc窗口中，输出如下内容 net_version eth_accounts eth_accounts eth_accounts eth_sendTransaction Transaction: 0x0248e4f5b8ed0130b6c04fb0628747948c4430b2db32ae4b4aecc5837c95a7a9 Contract created: 0x44d5b51c7a790edf595f36f647d8782ab95d2043 Gas usage: 201556 Block Number: 5 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xf25d861fa237ca89ece917d3bfcae990b00253a213e3dfe977c808727bb41621 Gas usage: 41965 Block Number: 6 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_getTransactionReceipt eth_accounts eth_sendTransaction Transaction: 0x3bc4a4f9a6a29e336135a0617b9dcda72af62f8ed6ba8cdcb52e2c13b9c0b9c1 Contract created: 0x7e434775cefce86de3c944aeb840b80ffa397e6f Gas usage: 213057 Block Number: 7 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0x8e9a560c91b97f4fe1020f9e4154b063391d4e1b6da522a80e78d572e18e3864 Gas usage: 26965 Block Number: 8 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_getTransactionReceipt evm_snapshot Saved snapshot #1 net_version eth_sendTransaction net_version eth_sendTransaction Transaction: 0xbcca837fc7693ae43eef2210f88f5b59ada90c2c56250558bdee776417c6ce8d Contract created: 0x16e910a876a0ef1ad4fceb7b15b0ed1e34212a3f Gas usage: 141661 Block Number: 9 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter Transaction: 0x8ad5172333283066102aada539d0b17f14a3a13b5bc996b8baca49296d625045 Contract created: 0x7d49d66afb1fa72446cbbeb2dc7f43237a2895d9 Gas usage: 4630196 Block Number: 10 Block Time: Thu Oct 26 2017 17:29:40 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getFilterChanges eth_getTransactionReceipt eth_getTransactionReceipt eth_getCode eth_getCode eth_uninstallFilter eth_uninstallFilter eth_sendTransaction Transaction: 0x4a9374f9c1da7266c44b9c3f191572a79938bf446e9261a910904fbd86b019ef Contract created: 0x2411f93ad68e7a071ad6b116614d4a45049a2e36 Gas usage: 425816 Block Number: 11 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_blockNumber eth_sendTransaction Transaction: 0xc77b4f897c7ebcd27022c0b677589b6a3611384f5734660ec422cde74f0bec24 Gas usage: 48908 Block Number: 12 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt eth_blockNumber eth_sendTransaction Transaction: 0xbc11d4af9475b481271d824c3ba492d7eb23a204608c3da790b77cd8509d518e Gas usage: 29062 Block Number: 13 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt eth_blockNumber eth_sendTransaction Transaction: 0x64e35489fcad832bfce85d305726922c2c2a97dcb897ffbfc4a69b0649fc7244 Gas usage: 36064 Block Number: 14 Block Time: Thu Oct 26 2017 17:29:41 GMT+0800 (CST) eth_getTransactionReceipt 创建用户界面连接智能合约 安装web3 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g web3 npm WARN deprecated fs-promise@2.0.3: Use mz or fs-extra^3.0 with Promise Support npm WARN deprecated tar.gz@1.0.7: ⚠️ WARNING ⚠️ tar.gz module has been deprecated and your application is vulnerable. Please use tar module instead: https://npmjs.com/tar npm WARN deprecated minimatch@0.3.0: Please update to minimatch 3.0.2 or higher to avoid a RegExp DoS issue &gt; scrypt@6.0.3 preinstall /usr/local/lib/node_modules/web3/node_modules/scrypt &gt; node node-scrypt-preinstall.js &gt; scrypt@6.0.3 install /usr/local/lib/node_modules/web3/node_modules/scrypt &gt; node-gyp rebuild SOLINK_MODULE(target) Release/copied_files.node CC(target) Release/obj.target/scrypt_wrapper/src/util/memlimit.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/keyderivation.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/pickparams.o CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/hash.o LIBTOOL-STATIC Release/scrypt_wrapper.a CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/crypto/crypto_scrypt.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/crypto/crypto_scrypt_smix.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/util/warnp.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/alg/sha256.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/libcperciva/util/insecure_memzero.o CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-1.2.0/lib/scryptenc/scryptenc_cpuperf.o LIBTOOL-STATIC Release/scrypt_lib.a CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_common.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_async.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_hash_sync.o CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_hash_async.o CXX(target) Release/obj.target/scrypt/scrypt_node.o SOLINK_MODULE(target) Release/scrypt.node &gt; sha3@1.2.0 install /usr/local/lib/node_modules/web3/node_modules/sha3 &gt; node-gyp rebuild CXX(target) Release/obj.target/sha3/src/addon.o ../src/addon.cpp:59:36: warning: &#39;NewInstance&#39; is deprecated [-Wdeprecated-declarations] info.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv)); ^ /Users/xiaoyu/.node-gyp/8.5.0/include/node/v8.h:3787:3: note: &#39;NewInstance&#39; has been explicitly marked deprecated here V8_DEPRECATED(&quot;Use maybe version&quot;, ^ /Users/xiaoyu/.node-gyp/8.5.0/include/node/v8config.h:332:29: note: expanded from macro &#39;V8_DEPRECATED&#39; declarator __attribute__((deprecated)) ^ 1 warning generated. CXX(target) Release/obj.target/sha3/src/displayIntermediateValues.o CXX(target) Release/obj.target/sha3/src/KeccakF-1600-reference.o CXX(target) Release/obj.target/sha3/src/KeccakNISTInterface.o CXX(target) Release/obj.target/sha3/src/KeccakSponge.o SOLINK_MODULE(target) Release/sha3.node &gt; websocket@1.0.24 install /usr/local/lib/node_modules/web3/node_modules/websocket &gt; (node-gyp rebuild 2&gt; builderror.log) || (exit 0) CXX(target) Release/obj.target/bufferutil/src/bufferutil.o SOLINK_MODULE(target) Release/bufferutil.node CXX(target) Release/obj.target/validation/src/validation.o SOLINK_MODULE(target) Release/validation.node + web3@1.0.0-beta.24 added 289 packages in 68.85s 打开文件/src/js/app.js 下面的代码展示了如何调用web3,调用合约的方法，以及绑定数据到UI App = { web3Provider: null, contracts: {}, init: function() { // Load pets. $.getJSON(&#39;../pets.json&#39;, function(data) { var petsRow = $(&#39;#petsRow&#39;); var petTemplate = $(&#39;#petTemplate&#39;); for (i = 0; i &lt; data.length; i ++) { petTemplate.find(&#39;.panel-title&#39;).text(data[i].name); petTemplate.find(&#39;img&#39;).attr(&#39;src&#39;, data[i].picture); petTemplate.find(&#39;.pet-breed&#39;).text(data[i].breed); petTemplate.find(&#39;.pet-age&#39;).text(data[i].age); petTemplate.find(&#39;.pet-location&#39;).text(data[i].location); petTemplate.find(&#39;.btn-adopt&#39;).attr(&#39;data-id&#39;, data[i].id); petsRow.append(petTemplate.html()); } }); return App.initWeb3(); }, initWeb3: function() { // web3入口 if (typeof web3 !== &#39;undefined&#39;) { App.web3Provider = web3.currentProvider; } else { // 测试网络 App.web3Provider = new Web3.providers.HttpProvider(&#39;http://localhost:8588&#39;); //这里是我指定的端口88 } web3 = new Web3(App.web3Provider); return App.initContract(); }, initContract: function() { //加载Adoption.json $.getJSON(&#39;Adoption.json&#39;, function(data) { // 智能合约实例化 var AdoptionArtifact = data; App.contracts.Adoption = TruffleContract(AdoptionArtifact); // 设置合约提供者 App.contracts.Adoption.setProvider(App.web3Provider); // 检索操作 return App.markAdopted(); }); return App.bindEvents(); }, bindEvents: function() { $(document).on(&#39;click&#39;, &#39;.btn-adopt&#39;, App.handleAdopt); }, markAdopted: function(adopters, account) { //实例 var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; return adoptionInstance.getAdopters.call(); }).then(function(adopters) { for (i = 0; i &lt; adopters.length; i++) { if (adopters[i] !== &#39;0x0000000000000000000000000000000000000000&#39;) { $(&#39;.panel-pet&#39;).eq(i).find(&#39;button&#39;).text(&#39;Success&#39;).attr(&#39;disabled&#39;, true); } } }).catch(function(err) { console.log(err.message); }); }, handleAdopt: function() { event.preventDefault(); var petId = parseInt($(event.target).data(&#39;id&#39;)); var adoptionInstance; web3.eth.getAccounts(function(error, accounts) { if (error) { console.log(error); } var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) { adoptionInstance = instance; // Execute adopt as a transaction by sending account return adoptionInstance.adopt(petId, {from: account}); }).then(function(result) { return App.markAdopted(); }).catch(function(err) { console.log(err.message); }); }); } }; $(function() { $(window).load(function() { App.init(); }); }); 在浏览器中运行dapp 安装MetaMask到浏览器 安装扩展程序 创建测试网络账户 从其他测试网络钱包转移eth 安装和配置lite-server 打开bs-config.json文件 { &quot;server&quot;: { &quot;baseDir&quot;: [&quot;./src&quot;, &quot;./build/contracts&quot;] } } 打开package.json文件，下面配置了lite-server的部分 &quot;scripts&quot;: { &quot;dev&quot;: &quot;lite-server&quot;, &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot; }, 当运行npm run dev的时候，就会启动lite-server 运行Dapp ❖ ~/solidity/pet-shop-tutorial [17:35:33] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev &gt; pet-shop@1.0.0 dev /Users/xiaoyu/solidity/pet-shop-tutorial &gt; lite-server sh: lite-server: command not found npm ERR! file sh npm ERR! code ELIFECYCLE npm ERR! errno ENOENT npm ERR! syscall spawn npm ERR! pet-shop@1.0.0 dev: `lite-server` npm ERR! spawn ENOENT npm ERR! npm ERR! Failed at the pet-shop@1.0.0 dev script. npm ERR! This is probably not a problem with npm. There is likely additional logging output above. npm ERR! A complete log of this run can be found in: npm ERR! /Users/xiaoyu/.npm/_logs/2017-10-26T10_20_42_191Z-debug.log 报错了。。。。 xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g lite-server npm WARN deprecated express@2.5.11: express 2.x series is deprecated npm WARN deprecated connect@1.9.2: connect 1.x series is deprecated /usr/local/bin/lite-server -&gt; /usr/local/lib/node_modules/lite-server/bin/lite-server &gt; fsevents@1.1.2 install /usr/local/lib/node_modules/lite-server/node_modules/fsevents &gt; node install [fsevents] Success: &quot;/usr/local/lib/node_modules/lite-server/node_modules/fsevents/lib/binding/Release/node-v57-darwin-x64/fse.node&quot; already installed Pass --update-binary to reinstall or --build-from-source to recompile + lite-server@2.3.0 added 417 packages in 499.895s ❖ ~/solidity/pet-shop-tutorial [18:30:10] xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev &gt; pet-shop@1.0.0 dev /Users/xiaoyu/solidity/pet-shop-tutorial &gt; lite-server ** browser-sync config ** { injectChanges: false, files: [ &#39;./**/*.{html,htm,css,js}&#39; ], watchOptions: { ignored: &#39;node_modules&#39; }, server: { baseDir: [ &#39;./src&#39;, &#39;./build/contracts&#39; ], middleware: [ [Function], [Function] ] } } [Browsersync] Access URLs: ------------------------------------- Local: http://localhost:3000 External: http://10.0.178.198:3000 ------------------------------------- UI: http://localhost:3001 UI External: http://10.0.178.198:3001 ------------------------------------- [Browsersync] Serving files from: ./src [Browsersync] Serving files from: ./build/contracts [Browsersync] Watching files... 17.10.26 18:31:20 200 GET /index.html 17.10.26 18:31:20 200 GET /css/bootstrap.min.css 17.10.26 18:31:21 200 GET /js/bootstrap.min.js 17.10.26 18:31:21 200 GET /js/web3.min.js 17.10.26 18:31:21 200 GET /js/app.js 17.10.26 18:31:21 200 GET /js/truffle-contract.js 17.10.26 18:31:24 200 GET /pets.json 17.10.26 18:31:24 200 GET /Adoption.json 17.10.26 18:31:24 200 GET /images/french-bulldog.jpeg 17.10.26 18:31:24 200 GET /images/boxer.jpeg 17.10.26 18:31:24 200 GET /images/scottish-terrier.jpeg 17.10.26 18:31:24 200 GET /images/golden-retriever.jpeg 17.10.26 18:31:24 404 GET /favicon.ico 然后会自动打开浏览器,http://localhost:3000/ 点击adopt按钮，会跳出提示，支付合约费用，完成调用。 总结 Truffle能完成智能合约的整套流程。 Truffle Box 提供了现成的项目，可以快速上手。 Truffle官网文档够详细，点个赞。 参考资料 http://truffleframework.com/docs/getting_started/project http://truffleframework.com/tutorials/pet-shop https://github.com/ethereumjs/testrpc http://truffleframework.com/boxes/ https://github.com/trufflesuite/truffle-core/blob/master/lib/testing/Assert.sol https://github.com/ethereum/web3.js/ https://metamask.io/ 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/10/27/a44febb15619b79f5d0c57cdee1c2019.html","headline":"【区块链】Truffle 部署 编译 测试 智能合约 的 完整实践操作","dateModified":"2017-10-27T00:00:00+08:00","datePublished":"2017-10-27T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/10/27/a44febb15619b79f5d0c57cdee1c2019.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>【区块链】Truffle 部署 编译 测试 智能合约 的 完整实践操作</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/diandianxiyu/article/details/78361621 
 </div> 
 <div class="markdown_views prism-dracula"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h1 id="truffle-部署-编译-测试-智能合约-的-完整实践操作">Truffle 部署 编译 测试 智能合约 的 完整实践操作</h1> 
  <h2 id="目标">目标</h2> 
  <ul> 
   <li>搭建开发环境</li> 
   <li>创建一个Truffle项目</li> 
   <li>编写智能合约</li> 
   <li>编译转移智能合约</li> 
   <li>测试智能合约</li> 
   <li>创建用户界面连接智能合约</li> 
   <li>在浏览器中访问Dapp</li> 
  </ul> 
  <h2 id="搭建开发环境">搭建开发环境</h2> 
  <ul> 
   <li>Node.js v6+ LTS and npm (comes with Node)</li> 
   <li>Git</li> 
  </ul> 
  <p>这里配置脚本略过。。。。</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ node -v
v8.<span class="hljs-number">5.0</span>

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm -v
<span class="hljs-number">5.4</span>.<span class="hljs-number">2</span>

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ git --version
git version <span class="hljs-number">2.13</span>.<span class="hljs-number">5</span> (Apple Git-<span class="hljs-number">94</span>)</code></pre> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g ethereumjs-testrpc
/usr/local/bin/testrpc -&gt; /usr/local/lib/node_modules/ethereumjs-testrpc/build/cli.node.js

&gt; fsevents@<span class="hljs-number">1.1</span>.<span class="hljs-number">2</span> install /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/fsevents
&gt; node install

events.js:<span class="hljs-number">182</span>
      throw er; // Unhandled <span class="hljs-string">'error'</span> event
      ^

Error: spawn node-pre-gyp ENOENT
    at _errnoException (util.js:<span class="hljs-number">1026</span>:<span class="hljs-number">11</span>)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:<span class="hljs-number">192</span>:<span class="hljs-number">19</span>)
    at onErrorNT (internal/child_process.js:<span class="hljs-number">374</span>:<span class="hljs-number">16</span>)
    at _combinedTickCallback (internal/process/next_tick.js:<span class="hljs-number">138</span>:<span class="hljs-number">11</span>)
    at process._tickCallback (internal/process/next_tick.js:<span class="hljs-number">180</span>:<span class="hljs-number">9</span>)
    at Function.Module.runMain (module.js:<span class="hljs-number">667</span>:<span class="hljs-number">11</span>)
    at startup (bootstrap_node.js:<span class="hljs-number">201</span>:<span class="hljs-number">16</span>)
    at bootstrap_node.js:<span class="hljs-number">626</span>:<span class="hljs-number">3</span>

&gt; uglifyjs-webpack-plugin@<span class="hljs-number">0.4</span>.<span class="hljs-number">6</span> postinstall /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/uglifyjs-webpack-plugin
&gt; node lib/post_install.js

npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@<span class="hljs-number">1.1</span>.<span class="hljs-number">2</span> (node_modules/ethereumjs-testrpc/node_modules/fsevents):
npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@<span class="hljs-number">1.1</span>.<span class="hljs-number">2</span> install: `node install`
npm WARN optional SKIPPING OPTIONAL DEPENDENCY: Exit status <span class="hljs-number">1</span>

+ ethereumjs-testrpc@<span class="hljs-number">4.1</span>.<span class="hljs-number">3</span>
added <span class="hljs-number">2</span> packages, removed <span class="hljs-number">475</span> packages, updated <span class="hljs-number">238</span> packages and moved <span class="hljs-number">1</span> package <span class="hljs-keyword">in</span> <span class="hljs-number">293.194</span>s


   ╭─────────────────────────────────────╮
   │                                     │
   │   Update available <span class="hljs-number">5.4</span>.<span class="hljs-number">2</span> → <span class="hljs-number">5.5</span>.<span class="hljs-number">1</span>    │
   │     Run npm i -g npm to update      │
   │                                     │
   ╰─────────────────────────────────────╯


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm i -g npm to update  
/usr/local/bin/npm -&gt; /usr/local/lib/node_modules/npm/bin/npm-cli.js
/usr/local/bin/npx -&gt; /usr/local/lib/node_modules/npm/bin/npx-cli.js
/usr/local/bin/update -&gt; /usr/local/lib/node_modules/update/bin/update.js
+ update@<span class="hljs-number">0.7</span>.<span class="hljs-number">4</span>
+ npm@<span class="hljs-number">5.5</span>.<span class="hljs-number">1</span>
+ to@<span class="hljs-number">0.2</span>.<span class="hljs-number">9</span>
added <span class="hljs-number">708</span> packages, removed <span class="hljs-number">2</span> packages and updated <span class="hljs-number">29</span> packages <span class="hljs-keyword">in</span> <span class="hljs-number">434.067</span>s


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ <span class="hljs-built_in">sudo</span>  npm install -g ethereumjs-testrpc                        
npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@<span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>@yargs/node_modules/cliui
npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@<span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>@yargs/node_modules/decamelize
npm WARN checkPermissions Missing write access to /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_strip-ansi@<span class="hljs-number">3.0</span>.<span class="hljs-number">1</span>@strip-ansi/node_modules/ansi-regex
npm ERR! path /usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@<span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>@yargs/node_modules/cliui
npm ERR! code ENOENT
npm ERR! errno -<span class="hljs-number">2</span>
npm ERR! syscall access
npm ERR! enoent ENOENT: no such file or directory, access <span class="hljs-string">'/usr/local/lib/node_modules/ethereumjs-testrpc/node_modules/_yargs@3.10.0@yargs/node_modules/cliui'</span>
npm ERR! enoent This is related to npm not being able to find a file.
npm ERR! enoent 

npm ERR! A complete log of this run can be found <span class="hljs-keyword">in</span>:
npm ERR!     /Users/xiaoyu/.npm/_logs/<span class="hljs-number">2017</span>-<span class="hljs-number">10</span>-<span class="hljs-number">26</span>T08_09_48_018Z-debug.log


xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g truffle
/usr/local/bin/truffle -&gt; /usr/local/lib/node_modules/truffle/build/cli.bundled.js
+ truffle@<span class="hljs-number">3.4</span>.<span class="hljs-number">11</span>
removed <span class="hljs-number">105</span> packages and updated <span class="hljs-number">91</span> packages <span class="hljs-keyword">in</span> <span class="hljs-number">89.658</span>s</code></pre> 
  <h2 id="用truffle-box创建一个truffle项目">用Truffle Box创建一个Truffle项目</h2> 
  <pre class="prettyprint"><code class="language-bash hljs ">❖  ~/solidity [<span class="hljs-number">16</span>:<span class="hljs-number">15</span>:<span class="hljs-number">01</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ mkdir pet-shop-tutorial
❖  ~/solidity [<span class="hljs-number">16</span>:<span class="hljs-number">15</span>:<span class="hljs-number">06</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ <span class="hljs-built_in">cd</span> pet-shop-tutorial

xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle unbox pet-shop
Downloading...
Unpacking...
Setting up...</code></pre> 
  <h3 id="目录结构">目录结构</h3> 
  <p>/contracts 智能合约 <br> /migrations 迁移系统来处理智能合约部署 <br> /test 测试 <br> truffle.js 配置文件</p> 
  <p>其他部分是nodejs的配置文件以及文件夹</p> 
  <h2 id="编写智能合约">编写智能合约</h2> 
  <p>在<code>contracts</code>中创建<code>Adoption.sol</code>文件</p> 
  <pre class="prettyprint"><code class="language-solidity hljs cs">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.4</span>;

contract Adoption {

    address[<span class="hljs-number">16</span>] <span class="hljs-keyword">public</span> adopters; <span class="hljs-comment">//存储地址</span>

    <span class="hljs-comment">//采用一个宠物</span>
    function adopt(<span class="hljs-keyword">uint</span> petId) <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span> (<span class="hljs-keyword">uint</span>) {
        require(petId &gt;= <span class="hljs-number">0</span> &amp;&amp; petId &lt;= <span class="hljs-number">15</span>);

        adopters[petId] = msg.sender;

        <span class="hljs-keyword">return</span> petId;
    }

    <span class="hljs-comment">//返回采用者</span>
    function getAdopters() <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span> (address[16]) {
        <span class="hljs-keyword">return</span> adopters;
    }
}
</code></pre> 
  <h2 id="编译转移智能合约">编译转移智能合约</h2> 
  <h3 id="evm的测试环境">EVM的测试环境</h3> 
  <p>打开另一个窗口</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ testrpc -p <span class="hljs-number">8588</span>
EthereumJS TestRPC v4.<span class="hljs-number">1.3</span> (ganache-core: <span class="hljs-number">1.1</span>.<span class="hljs-number">3</span>)

Available Accounts
==================
(<span class="hljs-number">0</span>) <span class="hljs-number">0</span>xd2a54e8087d88889e1857698ceb228493b67bab6
(<span class="hljs-number">1</span>) <span class="hljs-number">0</span>x44d32639c3803b9daa7392ff2ea50644153d7721
(<span class="hljs-number">2</span>) <span class="hljs-number">0</span>x32d951e2f319edb079764b1c75864497a3132446
(<span class="hljs-number">3</span>) <span class="hljs-number">0</span>x82244a630d6031be85ca298376cfa2bd6c7389a6
(<span class="hljs-number">4</span>) <span class="hljs-number">0</span>xd3b556b69eb670a250bbc3f15ebefb081d4c7108
(<span class="hljs-number">5</span>) <span class="hljs-number">0</span>x9f50cf1b425c6ca97de0128e46a21abd7bda3258
(<span class="hljs-number">6</span>) <span class="hljs-number">0</span>x8e0545a4fe9eac1bb2f4683f0c6b36<span class="hljs-built_in">cd</span>4a364a40
(<span class="hljs-number">7</span>) <span class="hljs-number">0</span>x200b052f6eaeaa1dc11abcc3101b7a8aca293e70
(<span class="hljs-number">8</span>) <span class="hljs-number">0</span>xcbd4c8b9d264367d385d4938c3b390a2eb0f2a62
(<span class="hljs-number">9</span>) <span class="hljs-number">0</span>xa769a296f0bbab07e48ca62da5ad5aea4c920580

Private Keys
==================
(<span class="hljs-number">0</span>) a4f66a0654bbd1338a0cc9264624ad9f710f5<span class="hljs-built_in">cd</span>65bbd4aed6f0b20706335e573
(<span class="hljs-number">1</span>) cab64a11662597c79a9e866865efbec4b2e1701ed21783f68a61162937baaf8a
(<span class="hljs-number">2</span>) <span class="hljs-number">9</span>f52f1c63923b390b438212bdd4594d3b479b22024bd193b8a3a600572f697af
(<span class="hljs-number">3</span>) <span class="hljs-number">452</span>b11e8ea19803b44b474d86c13d7325a387459abe634ad1c64b13eb26d0745
(<span class="hljs-number">4</span>) a663ff82b20002942c491e393951e5e366d8cceeff89732690f974f709243260
(<span class="hljs-number">5</span>) <span class="hljs-number">7410</span>aba40135ee4fea322a13403b081939d245e7ed534e016090657cbdb6183c
(<span class="hljs-number">6</span>) <span class="hljs-number">269</span>e44a7c17d591d23a694539a8d6feee3d9894182d4bc663a2f51fc33a3f540
(<span class="hljs-number">7</span>) <span class="hljs-number">4</span>f70e8c8f25a1ef2e9057a1b25053d6bceca46b68dfc0548e0c96b16fa9af5eb
(<span class="hljs-number">8</span>) <span class="hljs-number">6114321</span>e07ba8248509c17f4f0318aaf0edd972986f43ec652a2030b6cfe18bd
(<span class="hljs-number">9</span>) <span class="hljs-number">37</span>cacf13d9833bb3c63c657b42fed5f87f3806cca4d1<span class="hljs-built_in">cd</span>400cbc5f7c8c2a3cc1

HD Wallet
==================
Mnemonic:      better become piano october library quarter festival ability arrow patch fringe practice
Base HD Path:  m/<span class="hljs-number">44</span><span class="hljs-string">'/60'</span>/<span class="hljs-number">0</span><span class="hljs-string">'/0/{account_index} Listening on localhost:8588</span></code></pre> 
  <p>这里注意，我的测试demo指定了端口，那么也要修改对应的配置文件。</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">truffle.js

module.exports = {
  networks: {
    development: {
      host: <span class="hljs-string">"localhost"</span>,
      port: <span class="hljs-number">8588</span>,
      network_id: <span class="hljs-string">"*"</span> // Match any network id
    }
  }
};</code></pre> 
  <p>编译智能合约</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">❖  ~/solidity/pet-shop-tutorial [<span class="hljs-number">16</span>:<span class="hljs-number">27</span>:<span class="hljs-number">59</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle compile
Compiling ./contracts/Adoption.sol...
Compiling ./contracts/Migrations.sol...
Writing artifacts to ./build/contracts
</code></pre> 
  <h2 id="迁移智能合约">迁移智能合约</h2> 
  <p>查看项目目录，会发现<code>migrations</code>目录中已经存在了一个文件<code>1_initial_migration.js</code></p> 
  <p>我们开始创建第二个文件<code>2_deploy_contracts.js</code></p> 
  <pre class="prettyprint"><code class="language-javascript hljs "><span class="hljs-keyword">var</span> Adoption = artifacts.require(<span class="hljs-string">"./Adoption.sol"</span>);

module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(deployer)</span> {</span>
  deployer.deploy(Adoption);
};</code></pre> 
  <p>执行迁移</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">❖  ~/solidity/pet-shop-tutorial [<span class="hljs-number">16</span>:<span class="hljs-number">53</span>:<span class="hljs-number">30</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle migrate
Using network <span class="hljs-string">'development'</span>.

Running migration: <span class="hljs-number">1</span>_initial_migration.js
  Deploying Migrations...
  ... <span class="hljs-number">0</span>x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809
  Migrations: <span class="hljs-number">0</span>xf7345735ec00a0b797e5469a49b5deaf9131659f
Saving successful migration to network...
  ... <span class="hljs-number">0</span>xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a
Saving artifacts...
Running migration: <span class="hljs-number">2</span>_deploy_contracts.js
  Deploying Adoption...
  ... <span class="hljs-number">0</span>xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9
  Adoption: <span class="hljs-number">0</span>x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a
Saving successful migration to network...
  ... <span class="hljs-number">0</span>x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39
Saving artifacts...
</code></pre> 
  <p>同时，你在<code>testrpc</code>上还能看到下面的输出</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">Listening on localhost:<span class="hljs-number">8588</span>
net_version
eth_accounts
eth_accounts
net_version
net_version
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x09db8962f99c5e5bdb316882c9f3aff69244df68664c6d90dda7e8c9f5249809
  Contract created: <span class="hljs-number">0</span>xf7345735ec00a0b797e5469a49b5deaf9131659f
  Gas usage: <span class="hljs-number">201556</span>
  Block Number: <span class="hljs-number">1</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">31</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>xb6f330b833176db1e94d24c84bab618b6c9205585e9803f7c6fe21f14fec179a
  Gas usage: <span class="hljs-number">41965</span>
  Block Number: <span class="hljs-number">2</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">31</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
eth_accounts
net_version
net_version
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>xb93b24287ebba0dfd091e62fb9d55e188a76412097fdae4a7caf1520b9aaabb9
  Contract created: <span class="hljs-number">0</span>x424bc3aeeeb6d0a0e0ed8271ce7764b6ad336c7a
  Gas usage: <span class="hljs-number">213057</span>
  Block Number: <span class="hljs-number">3</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">31</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x26f08c9da8a6ec12f4edece8a6344a9030bb7fbd97f3b1a4592b93f4aec2dc39
  Gas usage: <span class="hljs-number">26965</span>
  Block Number: <span class="hljs-number">4</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">31</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
</code></pre> 
  <h2 id="测试智能合约">测试智能合约</h2> 
  <p>在<code>test</code>文件夹中创建文件<code>TestAdoption.sol</code></p> 
  <pre class="prettyprint"><code class="language-solidity hljs actionscript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;

<span class="hljs-preprocessor"><span class="hljs-keyword">import</span> "truffle/Assert.sol";</span> <span class="hljs-comment">//truffle公共的库</span>
<span class="hljs-preprocessor"><span class="hljs-keyword">import</span> "truffle/DeployedAddresses.sol";</span> <span class="hljs-comment">//truffle公共的库</span>
<span class="hljs-preprocessor"><span class="hljs-keyword">import</span> "../contracts/Adoption.sol";</span>

contract TestAdoption {
    Adoption adoption = Adoption(DeployedAddresses.Adoption());

    <span class="hljs-comment">// 测试 adopt()</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testUserCanAdoptPet</span><span class="hljs-params">()</span> {</span>
        uint returnedId = adoption.adopt(<span class="hljs-number">8</span>); <span class="hljs-comment">//调用输入参数</span>

        uint expected = <span class="hljs-number">8</span>; <span class="hljs-comment">//期望的结果</span>

        Assert.equal(returnedId, expected, <span class="hljs-string">"Adoption of pet ID 8 should be recorded."</span>); <span class="hljs-comment">//判断如果没有就抛出异常</span>
    }

    <span class="hljs-comment">// 单个测试</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testGetAdopterAddressByPetId</span><span class="hljs-params">()</span> {</span>

        address expected = <span class="hljs-keyword">this</span>;

        address adopter = adoption.adopters(<span class="hljs-number">8</span>);

        Assert.equal(adopter, expected, <span class="hljs-string">"Owner of pet ID 8 should be recorded."</span>);
    }

    <span class="hljs-comment">// 所有的测试</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testGetAdopterAddressByPetIdInArray</span><span class="hljs-params">()</span> {</span>

        address expected = <span class="hljs-keyword">this</span>;

        address[<span class="hljs-number">16</span>] memory adopters = adoption.getAdopters();

        Assert.equal(adopters[<span class="hljs-number">8</span>], expected, <span class="hljs-string">"Owner of pet ID 8 should be recorded."</span>);
    }


}</code></pre> 
  <p>运行测试命令</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ truffle test
Using network <span class="hljs-string">'development'</span>.

Compiling ./contracts/Adoption.sol...
Compiling ./test/TestAdoption.sol...
Compiling truffle/Assert.sol...
Compiling truffle/DeployedAddresses.sol...

Compilation warnings encountered:

truffle/Assert.sol:<span class="hljs-number">114</span>:<span class="hljs-number">20</span>: Warning: This declaration shadows an existing declaration.
    function equal(string A, string B, string message) constant returns (bool result) {
                   ^------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">137</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function notEqual(string A, string B, string message) constant returns (bool result) {
                      ^------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">206</span>:<span class="hljs-number">20</span>: Warning: This declaration shadows an existing declaration.
    function equal(bytes32 A, bytes32 B, string message) constant returns (bool result) {
                   ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">226</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function notEqual(bytes32 A, bytes32 B, string message) constant returns (bool result) {
                      ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">286</span>:<span class="hljs-number">20</span>: Warning: This declaration shadows an existing declaration.
    function equal(address A, address B, string message) constant returns (bool result) {
                   ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">305</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function notEqual(address A, address B, string message) constant returns (bool result) {
                      ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">403</span>:<span class="hljs-number">20</span>: Warning: This declaration shadows an existing declaration.
    function equal(bool A, bool B, string message) constant returns (bool result) {
                   ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">426</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function notEqual(bool A, bool B, string message) constant returns (bool result) {
                      ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">451</span>:<span class="hljs-number">20</span>: Warning: This declaration shadows an existing declaration.
    function equal(uint A, uint B, string message) constant returns (bool result) {
                   ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">474</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function notEqual(uint A, uint B, string message) constant returns (bool result) {
                      ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">497</span>:<span class="hljs-number">22</span>: Warning: This declaration shadows an existing declaration.
    function isAbove(uint A, uint B, string message) constant returns (bool result) {
                     ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">520</span>:<span class="hljs-number">24</span>: Warning: This declaration shadows an existing declaration.
    function isAtLeast(uint A, uint B, string message) constant returns (bool result) {
                       ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">543</span>:<span class="hljs-number">22</span>: Warning: This declaration shadows an existing declaration.
    function isBelow(uint A, uint B, string message) constant returns (bool result) {
                     ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">566</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function isAtMost(uint A, uint B, string message) constant returns (bool result) {
                      ^----^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">635</span>:<span class="hljs-number">20</span>: Warning: This declaration shadows an existing declaration.
    function equal(int A, int B, string message) constant returns (bool result) {
                   ^---^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">658</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function notEqual(int A, int B, string message) constant returns (bool result) {
                      ^---^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">681</span>:<span class="hljs-number">22</span>: Warning: This declaration shadows an existing declaration.
    function isAbove(int A, int B, string message) constant returns (bool result) {
                     ^---^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">704</span>:<span class="hljs-number">24</span>: Warning: This declaration shadows an existing declaration.
    function isAtLeast(int A, int B, string message) constant returns (bool result) {
                       ^---^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">727</span>:<span class="hljs-number">22</span>: Warning: This declaration shadows an existing declaration.
    function isBelow(int A, int B, string message) constant returns (bool result) {
                     ^---^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">750</span>:<span class="hljs-number">23</span>: Warning: This declaration shadows an existing declaration.
    function isAtMost(int A, int B, string message) constant returns (bool result) {
                      ^---^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">1267</span>:<span class="hljs-number">27</span>: Warning: This declaration shadows an existing declaration.
    function balanceEqual(address A, uint b, string message) constant returns (bool result) {
                          ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">1287</span>:<span class="hljs-number">30</span>: Warning: This declaration shadows an existing declaration.
    function balanceNotEqual(address A, uint b, string message) constant returns (bool result) {
                             ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">1306</span>:<span class="hljs-number">28</span>: Warning: This declaration shadows an existing declaration.
    function balanceIsZero(address A, string message) constant returns (bool result) {
                           ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^

,truffle/Assert.sol:<span class="hljs-number">1325</span>:<span class="hljs-number">31</span>: Warning: This declaration shadows an existing declaration.
    function balanceIsNotZero(address A, string message) constant returns (bool result) {
                              ^-------^
truffle/Assert.sol:<span class="hljs-number">64</span>:<span class="hljs-number">5</span>: The shadowed declaration is here:
    uint8 constant A = uint8(byte(<span class="hljs-string">'a'</span>));
    ^---------------------------------^




  TestAdoption
    ✓ testUserCanAdoptPet (<span class="hljs-number">100</span>ms)
    ✓ testGetAdopterAddressByPetId (<span class="hljs-number">106</span>ms)
    ✓ testGetAdopterAddressByPetIdInArray (<span class="hljs-number">119</span>ms)


  <span class="hljs-number">3</span> passing (<span class="hljs-number">912</span>ms)

</code></pre> 
  <p>同时，在<code>testrpc</code>窗口中，输出如下内容</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">net_version
eth_accounts
eth_accounts
eth_accounts
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x0248e4f5b8ed0130b6c04fb0628747948c4430b2db32ae4b4aecc5837c95a7a9
  Contract created: <span class="hljs-number">0</span>x44d5b51c7a790edf595f36f647d8782ab95d2043
  Gas usage: <span class="hljs-number">201556</span>
  Block Number: <span class="hljs-number">5</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">40</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>xf25d861fa237ca89ece917d3bfcae990b00253a213e3dfe977c808727bb41621
  Gas usage: <span class="hljs-number">41965</span>
  Block Number: <span class="hljs-number">6</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">40</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
eth_accounts
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x3bc4a4f9a6a29e336135a0617b9dcda72af62f8ed6ba8cdcb52e2c13b9c0b9c1
  Contract created: <span class="hljs-number">0</span>x7e434775cefce86de3c944aeb840b80ffa397e6f
  Gas usage: <span class="hljs-number">213057</span>
  Block Number: <span class="hljs-number">7</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">40</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x8e9a560c91b97f4fe1020f9e4154b063391d4e1b6da522a80e78d572e18e3864
  Gas usage: <span class="hljs-number">26965</span>
  Block Number: <span class="hljs-number">8</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">40</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
evm_snapshot
Saved snapshot <span class="hljs-comment">#1</span>
net_version
eth_sendTransaction
net_version
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>xbcca837fc7693ae43eef2210f88f5b59ada90c2c56250558bdee776417c6ce8d
  Contract created: <span class="hljs-number">0</span>x16e910a876a0ef1ad4fceb7b15b0ed1e34212a3f
  Gas usage: <span class="hljs-number">141661</span>
  Block Number: <span class="hljs-number">9</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">40</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter

  Transaction: <span class="hljs-number">0</span>x8ad5172333283066102aada539d0b17f14a3a13b5bc996b8baca49296d625045
  Contract created: <span class="hljs-number">0</span>x7d49d66afb1fa72446cbbeb2dc7f43237a2895d9
  Gas usage: <span class="hljs-number">4630196</span>
  Block Number: <span class="hljs-number">10</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">40</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter
eth_getFilterChanges
eth_getFilterChanges
eth_getTransactionReceipt
eth_getTransactionReceipt
eth_getCode
eth_getCode
eth_uninstallFilter
eth_uninstallFilter
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x4a9374f9c1da7266c44b9c3f191572a79938bf446e9261a910904fbd86b019ef
  Contract created: <span class="hljs-number">0</span>x2411f93ad68e7a071ad6b116614d4a45049a2e36
  Gas usage: <span class="hljs-number">425816</span>
  Block Number: <span class="hljs-number">11</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">41</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_blockNumber
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>xc77b4f897c7ebcd27022c0b677589b6a3611384f5734660ec422cde74f0bec24
  Gas usage: <span class="hljs-number">48908</span>
  Block Number: <span class="hljs-number">12</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">41</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
eth_blockNumber
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>xbc11d4af9475b481271d824c3ba492d7eb23a204608c3da790b77<span class="hljs-built_in">cd</span>8509d518e
  Gas usage: <span class="hljs-number">29062</span>
  Block Number: <span class="hljs-number">13</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">41</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
eth_blockNumber
eth_sendTransaction

  Transaction: <span class="hljs-number">0</span>x64e35489fcad832bfce85d305726922c2c2a97dcb897ffbfc4a69b0649fc7244
  Gas usage: <span class="hljs-number">36064</span>
  Block Number: <span class="hljs-number">14</span>
  Block Time: Thu Oct <span class="hljs-number">26</span> <span class="hljs-number">2017</span> <span class="hljs-number">17</span>:<span class="hljs-number">29</span>:<span class="hljs-number">41</span> GMT+<span class="hljs-number">0800</span> (CST)

eth_getTransactionReceipt
</code></pre> 
  <h2 id="创建用户界面连接智能合约">创建用户界面连接智能合约</h2> 
  <h3 id="安装web3">安装web3</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g web3
npm WARN deprecated fs-promise@<span class="hljs-number">2.0</span>.<span class="hljs-number">3</span>: Use mz or fs-extra^<span class="hljs-number">3.0</span> with Promise Support
npm WARN deprecated tar.gz@<span class="hljs-number">1.0</span>.<span class="hljs-number">7</span>: ⚠️  WARNING ⚠️ tar.gz module has been deprecated and your application is vulnerable. Please use tar module instead: https://npmjs.com/tar
npm WARN deprecated minimatch@<span class="hljs-number">0.3</span>.<span class="hljs-number">0</span>: Please update to minimatch <span class="hljs-number">3.0</span>.<span class="hljs-number">2</span> or higher to avoid a RegExp DoS issue

&gt; scrypt@<span class="hljs-number">6.0</span>.<span class="hljs-number">3</span> preinstall /usr/local/lib/node_modules/web3/node_modules/scrypt
&gt; node node-scrypt-preinstall.js


&gt; scrypt@<span class="hljs-number">6.0</span>.<span class="hljs-number">3</span> install /usr/local/lib/node_modules/web3/node_modules/scrypt
&gt; node-gyp rebuild

  SOLINK_MODULE(target) Release/copied_files.node
  CC(target) Release/obj.target/scrypt_wrapper/src/util/memlimit.o
  CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/keyderivation.o
  CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/pickparams.o
  CC(target) Release/obj.target/scrypt_wrapper/src/scryptwrapper/hash.o
  LIBTOOL-STATIC Release/scrypt_wrapper.a
  CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span>/lib/crypto/crypto_scrypt.o
  CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span>/lib/crypto/crypto_scrypt_smix.o
  CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span>/libcperciva/util/warnp.o
  CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span>/libcperciva/alg/sha256.o
  CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span>/libcperciva/util/insecure_memzero.o
  CC(target) Release/obj.target/scrypt_lib/scrypt/scrypt-<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span>/lib/scryptenc/scryptenc_cpuperf.o
  LIBTOOL-STATIC Release/scrypt_lib.a
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_common.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_async.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_params_sync.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_async.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf_sync.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_sync.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_kdf-verify_async.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_<span class="hljs-built_in">hash</span>_sync.o
  CXX(target) Release/obj.target/scrypt/src/node-boilerplate/scrypt_<span class="hljs-built_in">hash</span>_async.o
  CXX(target) Release/obj.target/scrypt/scrypt_node.o
  SOLINK_MODULE(target) Release/scrypt.node

&gt; sha3@<span class="hljs-number">1.2</span>.<span class="hljs-number">0</span> install /usr/local/lib/node_modules/web3/node_modules/sha3
&gt; node-gyp rebuild

  CXX(target) Release/obj.target/sha3/src/addon.o
../src/addon.cpp:<span class="hljs-number">59</span>:<span class="hljs-number">36</span>: warning: <span class="hljs-string">'NewInstance'</span> is deprecated [-Wdeprecated-declarations]
                        info.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv));
                                                        ^
/Users/xiaoyu/.node-gyp/<span class="hljs-number">8.5</span>.<span class="hljs-number">0</span>/include/node/v8.h:<span class="hljs-number">3787</span>:<span class="hljs-number">3</span>: note: <span class="hljs-string">'NewInstance'</span> has been explicitly marked deprecated here
  V8_DEPRECATED(<span class="hljs-string">"Use maybe version"</span>,
  ^
/Users/xiaoyu/.node-gyp/<span class="hljs-number">8.5</span>.<span class="hljs-number">0</span>/include/node/v8config.h:<span class="hljs-number">332</span>:<span class="hljs-number">29</span>: note: expanded from macro <span class="hljs-string">'V8_DEPRECATED'</span>
  declarator __attribute__((deprecated))
                            ^
<span class="hljs-number">1</span> warning generated.
  CXX(target) Release/obj.target/sha3/src/displayIntermediateValues.o
  CXX(target) Release/obj.target/sha3/src/KeccakF-<span class="hljs-number">1600</span>-reference.o
  CXX(target) Release/obj.target/sha3/src/KeccakNISTInterface.o
  CXX(target) Release/obj.target/sha3/src/KeccakSponge.o
  SOLINK_MODULE(target) Release/sha3.node

&gt; websocket@<span class="hljs-number">1.0</span>.<span class="hljs-number">24</span> install /usr/local/lib/node_modules/web3/node_modules/websocket
&gt; (node-gyp rebuild <span class="hljs-number">2</span>&gt; builderror.log) || (<span class="hljs-keyword">exit</span> <span class="hljs-number">0</span>)

  CXX(target) Release/obj.target/bufferutil/src/bufferutil.o
  SOLINK_MODULE(target) Release/bufferutil.node
  CXX(target) Release/obj.target/validation/src/validation.o
  SOLINK_MODULE(target) Release/validation.node
+ web3@<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span>-beta.<span class="hljs-number">24</span>
added <span class="hljs-number">289</span> packages <span class="hljs-keyword">in</span> <span class="hljs-number">68.85</span>s
</code></pre> 
  <p>打开文件<code>/src/js/app.js</code></p> 
  <p>下面的代码展示了如何调用web3,调用合约的方法，以及绑定数据到UI</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">App = {
  web3Provider: null,
  contracts: {},

  init: <span class="hljs-function"><span class="hljs-title">function</span></span>() {
    // Load pets.
    $.getJSON(<span class="hljs-string">'../pets.json'</span>, function(data) {
      var petsRow = $(<span class="hljs-string">'#petsRow'</span>);
      var petTemplate = $(<span class="hljs-string">'#petTemplate'</span>);

      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; data.length; i ++) {
        petTemplate.find(<span class="hljs-string">'.panel-title'</span>).text(data[i].name);
        petTemplate.find(<span class="hljs-string">'img'</span>).attr(<span class="hljs-string">'src'</span>, data[i].picture);
        petTemplate.find(<span class="hljs-string">'.pet-breed'</span>).text(data[i].breed);
        petTemplate.find(<span class="hljs-string">'.pet-age'</span>).text(data[i].age);
        petTemplate.find(<span class="hljs-string">'.pet-location'</span>).text(data[i].location);
        petTemplate.find(<span class="hljs-string">'.btn-adopt'</span>).attr(<span class="hljs-string">'data-id'</span>, data[i].id);

        petsRow.append(petTemplate.html());
      }
    });

    <span class="hljs-keyword">return</span> App.initWeb3();
  },

  initWeb3: <span class="hljs-function"><span class="hljs-title">function</span></span>() {

      // web3入口
      <span class="hljs-keyword">if</span> (typeof web3 !== <span class="hljs-string">'undefined'</span>) {
          App.web3Provider = web3.currentProvider;
      } <span class="hljs-keyword">else</span> {
          // 测试网络
          App.web3Provider = new Web3.providers.HttpProvider(<span class="hljs-string">'http://localhost:8588'</span>); //这里是我指定的端口<span class="hljs-number">88</span>
      }
      web3 = new Web3(App.web3Provider);

    <span class="hljs-keyword">return</span> App.initContract();
  },

  initContract: <span class="hljs-function"><span class="hljs-title">function</span></span>() {
      //加载Adoption.json
      $.getJSON(<span class="hljs-string">'Adoption.json'</span>, function(data) {
          // 智能合约实例化
          var AdoptionArtifact = data;
          App.contracts.Adoption = TruffleContract(AdoptionArtifact);

          // 设置合约提供者
          App.contracts.Adoption.setProvider(App.web3Provider);

          // 检索操作
          <span class="hljs-keyword">return</span> App.markAdopted();
      });

    <span class="hljs-keyword">return</span> App.bindEvents();
  },

  <span class="hljs-built_in">bind</span>Events: <span class="hljs-function"><span class="hljs-title">function</span></span>() {
    $(document).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'.btn-adopt'</span>, App.handleAdopt);
  },

  markAdopted: function(adopters, account) {
      //实例
      var adoptionInstance;


      App.contracts.Adoption.deployed().then(function(instance) {
          adoptionInstance = instance;

          <span class="hljs-keyword">return</span> adoptionInstance.getAdopters.call();
      }).then(function(adopters) {
          <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; adopters.length; i++) {
              <span class="hljs-keyword">if</span> (adopters[i] !== <span class="hljs-string">'0x0000000000000000000000000000000000000000'</span>) {
                  $(<span class="hljs-string">'.panel-pet'</span>).eq(i).find(<span class="hljs-string">'button'</span>).text(<span class="hljs-string">'Success'</span>).attr(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span>);
              }
          }
      }).catch(function(err) {
          console.log(err.message);
      });
  },

  handleAdopt: <span class="hljs-function"><span class="hljs-title">function</span></span>() {
    event.preventDefault();

    var petId = parseInt($(event.target).data(<span class="hljs-string">'id'</span>));

      var adoptionInstance;

      web3.eth.getAccounts(function(error, accounts) {
          <span class="hljs-keyword">if</span> (error) {
              console.log(error);
          }

          var account = accounts[<span class="hljs-number">0</span>];

          App.contracts.Adoption.deployed().then(function(instance) {
              adoptionInstance = instance;

              // Execute adopt as a transaction by sending account
              <span class="hljs-keyword">return</span> adoptionInstance.adopt(petId, {from: account});
          }).then(function(result) {
              <span class="hljs-keyword">return</span> App.markAdopted();
          }).catch(function(err) {
              console.log(err.message);
          });
      });
  }

};

$(<span class="hljs-function"><span class="hljs-title">function</span></span>() {
  $(window).load(<span class="hljs-function"><span class="hljs-title">function</span></span>() {
    App.init();
  });
});
</code></pre> 
  <h2 id="在浏览器中运行dapp">在浏览器中运行dapp</h2> 
  <h3 id="安装metamask到浏览器">安装MetaMask到浏览器</h3> 
  <ul> 
   <li>安装扩展程序</li> 
   <li>创建测试网络账户</li> 
   <li>从其他测试网络钱包转移eth</li> 
  </ul> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171026180815627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZGlhbmRpYW54aXl1X2dlZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="创建一个账户并导入eth" title=""></p> 
  <h3 id="安装和配置lite-server">安装和配置lite-server</h3> 
  <p>打开<code>bs-config.json</code>文件</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">{
  <span class="hljs-string">"server"</span>: {
    <span class="hljs-string">"baseDir"</span>: [<span class="hljs-string">"./src"</span>, <span class="hljs-string">"./build/contracts"</span>]
  }
}</code></pre> 
  <p>打开<code>package.json</code>文件，下面配置了lite-server的部分</p> 
  <pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"dev"</span>: <span class="hljs-string">"lite-server"</span>,
  <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
},
</code></pre> 
  <p>当运行<code>npm run dev</code>的时候，就会启动<code>lite-server</code></p> 
  <h3 id="运行dapp">运行Dapp</h3> 
  <pre class="prettyprint"><code class="language-bash hljs ">❖  ~/solidity/pet-shop-tutorial [<span class="hljs-number">17</span>:<span class="hljs-number">35</span>:<span class="hljs-number">33</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev

&gt; pet-shop@<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> dev /Users/xiaoyu/solidity/pet-shop-tutorial
&gt; lite-server

sh: lite-server: command not found
npm ERR! file sh
npm ERR! code ELIFECYCLE
npm ERR! errno ENOENT
npm ERR! syscall spawn
npm ERR! pet-shop@<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> dev: `lite-server`
npm ERR! spawn ENOENT
npm ERR! 
npm ERR! Failed at the pet-shop@<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> dev script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found <span class="hljs-keyword">in</span>:
npm ERR!     /Users/xiaoyu/.npm/_logs/<span class="hljs-number">2017</span>-<span class="hljs-number">10</span>-<span class="hljs-number">26</span>T10_20_42_191Z-debug.log</code></pre> 
  <p>报错了。。。。</p> 
  <pre class="prettyprint"><code class="language-bash hljs ">xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm install -g lite-server
npm WARN deprecated express@<span class="hljs-number">2.5</span>.<span class="hljs-number">11</span>: express <span class="hljs-number">2</span>.x series is deprecated
npm WARN deprecated connect@<span class="hljs-number">1.9</span>.<span class="hljs-number">2</span>: connect <span class="hljs-number">1</span>.x series is deprecated
/usr/local/bin/lite-server -&gt; /usr/local/lib/node_modules/lite-server/bin/lite-server

&gt; fsevents@<span class="hljs-number">1.1</span>.<span class="hljs-number">2</span> install /usr/local/lib/node_modules/lite-server/node_modules/fsevents
&gt; node install

[fsevents] Success: <span class="hljs-string">"/usr/local/lib/node_modules/lite-server/node_modules/fsevents/lib/binding/Release/node-v57-darwin-x64/fse.node"</span> already installed
Pass --update-binary to reinstall or --build-from-source to recompile
+ lite-server@<span class="hljs-number">2.3</span>.<span class="hljs-number">0</span>
added <span class="hljs-number">417</span> packages <span class="hljs-keyword">in</span> <span class="hljs-number">499.895</span>s
❖  ~/solidity/pet-shop-tutorial [<span class="hljs-number">18</span>:<span class="hljs-number">30</span>:<span class="hljs-number">10</span>]
xiaoyu@LIXIAOYUdeMacBook-Pro.com➤ npm run dev               

&gt; pet-shop@<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span> dev /Users/xiaoyu/solidity/pet-shop-tutorial
&gt; lite-server

** browser-sync config **
{ injectChanges: <span class="hljs-literal">false</span>,
  files: [ <span class="hljs-string">'./**/*.{html,htm,css,js}'</span> ],
  watchOptions: { ignored: <span class="hljs-string">'node_modules'</span> },
  server: 
   { baseDir: [ <span class="hljs-string">'./src'</span>, <span class="hljs-string">'./build/contracts'</span> ],
     middleware: [ [Function], [Function] ] } }
[Browsersync] Access URLs:
 -------------------------------------
       Local: http://localhost:<span class="hljs-number">3000</span>
    External: http://<span class="hljs-number">10.0</span>.<span class="hljs-number">178.198</span>:<span class="hljs-number">3000</span>
 -------------------------------------
          UI: http://localhost:<span class="hljs-number">3001</span>
 UI External: http://<span class="hljs-number">10.0</span>.<span class="hljs-number">178.198</span>:<span class="hljs-number">3001</span>
 -------------------------------------
[Browsersync] Serving files from: ./src
[Browsersync] Serving files from: ./build/contracts
[Browsersync] Watching files...
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">20</span> <span class="hljs-number">200</span> GET /index.html
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">20</span> <span class="hljs-number">200</span> GET /css/bootstrap.min.css
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">21</span> <span class="hljs-number">200</span> GET /js/bootstrap.min.js
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">21</span> <span class="hljs-number">200</span> GET /js/web3.min.js
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">21</span> <span class="hljs-number">200</span> GET /js/app.js
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">21</span> <span class="hljs-number">200</span> GET /js/truffle-contract.js
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">200</span> GET /pets.json
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">200</span> GET /Adoption.json
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">200</span> GET /images/french-bulldog.jpeg
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">200</span> GET /images/boxer.jpeg
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">200</span> GET /images/scottish-terrier.jpeg
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">200</span> GET /images/golden-retriever.jpeg
<span class="hljs-number">17.10</span>.<span class="hljs-number">26</span> <span class="hljs-number">18</span>:<span class="hljs-number">31</span>:<span class="hljs-number">24</span> <span class="hljs-number">404</span> GET /favicon.ico

</code></pre> 
  <p>然后会自动打开浏览器,<code>http://localhost:3000/</code></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20171026183238595?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZGlhbmRpYW54aXl1X2dlZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="示例网站" title=""></p> 
  <p>点击adopt按钮，会跳出提示，支付合约费用，完成调用。</p> 
  <h2 id="总结">总结</h2> 
  <p>Truffle能完成智能合约的整套流程。</p> 
  <p>Truffle Box 提供了现成的项目，可以快速上手。</p> 
  <p>Truffle官网文档够详细，点个赞。</p> 
  <h2 id="参考资料">参考资料</h2> 
  <ul> 
   <li><a href="http://truffleframework.com/docs/getting_started/project" rel="nofollow" target="_blank">http://truffleframework.com/docs/getting_started/project</a></li> 
   <li><a href="http://truffleframework.com/tutorials/pet-shop" rel="nofollow" target="_blank">http://truffleframework.com/tutorials/pet-shop</a></li> 
   <li><a href="https://github.com/ethereumjs/testrpc" rel="nofollow" target="_blank">https://github.com/ethereumjs/testrpc</a></li> 
   <li><a href="http://truffleframework.com/boxes/" rel="nofollow" target="_blank">http://truffleframework.com/boxes/</a></li> 
   <li><a href="https://github.com/trufflesuite/truffle-core/blob/master/lib/testing/Assert.sol" rel="nofollow" target="_blank">https://github.com/trufflesuite/truffle-core/blob/master/lib/testing/Assert.sol</a></li> 
   <li><a href="https://github.com/ethereum/web3.js/" rel="nofollow" target="_blank">https://github.com/ethereum/web3.js/</a></li> 
   <li><a href="https://metamask.io/" rel="nofollow" target="_blank">https://metamask.io/</a></li> 
  </ul> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-778f64ae39.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/diandianxiyu_geek/article/details/78361621,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/diandianxiyu_geek/article/details/78361621,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>建设银行通知到商户个人系统 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="建设银行通知到商户个人系统" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="项目中时常涉及到支付动作，以下是个人在接手建设银行对接部分，查阅了许多资料，整理给大家，希望对大家有用！ 业务场景：在项目中通过向建设银行网关缴费，建设银行会跳转到我们在建行商户系统账号上所填写的回调地址，这时我们所要做的就是验签操作，验签成功说明支付成功，接下来是自己业务系统的一系列操作，如账单管理入库，推送消息，保存用户的转账记录等等之类的。 查阅建行的接口对接相关文档，文档上有这样的接口说明： 银行—&gt;商户接口参数 银行—&gt;商户接口包含两部分，即服务器通知和页面通知，商户可以登录商户后台独立设置，也可以由分行业务人员在分行后台设置。 站点间接口的参数传送仍然采用普通的URL方式，信息包含在CGI参数，具体如下所示： HTTP://MERCHANT.WEB.SITE/MERCHANT_CGI?POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y&amp;SIGN=4b3ef029516193b7d969ac1840083635a3e0901b8cd526caa44c1a07 2f496d7f0d4bca3942c0d9030bede37c7809b835cec787eb39e18b7596a724fba9805b24714dfbb0f4a3fb430b32e075254a114d4c38a0ac 52ef46a0ad33dec3fbfc15417402a1399e65e46996c0cf49fc7ffca9222f8cd693c8376b6f928828967bec42 注：?前的URL由商户在签约时提供 参与签名运算的字符及其顺序如下 POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y 注：字符串中变量名必须是大写字母。 如果商户的程序将MERCHANTID, POSID,BRANCHID, ORDERID, PAYMENT, CURCODE，TXCODE和MAC作为隐藏域(hidden)， 然后使用SUBMIT按纽，注意在 FORM的METHOD中使用“GET”的方式。 验签java代码： package com.wlkj.common.config; import java.security.KeyPair; import java.security.KeyPairGenerator; import java.security.PrivateKey; import java.security.PublicKey; import java.security.SecureRandom; import java.security.Security; import java.security.Signature; import netpay.merchant.crypto.ABAProvider; import netpay.merchant.crypto.RSAPrivKeyCrt; import netpay.merchant.crypto.RSAPubKey; public class RSASig{ private String priKey; private String pubKey; public boolean generateKeys(){ PublicKey keyPub; PrivateKey keyPri; SecureRandom rand; Security.addProvider(new ABAProvider()); rand = new SecureRandom(); rand.setSeed(System.currentTimeMillis()); try { KeyPairGenerator fact; KeyPair keyPair; fact = KeyPairGenerator.getInstance(&quot;RSA&quot;, &quot;ABA&quot;); fact.initialize(1024, rand); keyPair = fact.generateKeyPair(); keyPub = keyPair.getPublic(); keyPri = keyPair.getPrivate(); pubKey = bytesToHexStr(keyPub.getEncoded()); priKey = bytesToHexStr(keyPri.getEncoded()); } catch (Exception e) { return false; } return true; } public String getPublicKey(){ return pubKey; } public String getPrivateKey(){ return priKey; } public void setPublicKey(String pkey){ pubKey = pkey; } public void setPrivateKey(String pkey){ priKey = pkey; } public String generateSigature(String src){ try{ Security.addProvider(new ABAProvider()); Signature sigEng = Signature.getInstance(&quot;MD5withRSA&quot;,&quot;ABA&quot;); byte[] pribyte = hexStrToBytes(priKey.trim()); sigEng.initSign(new RSAPrivKeyCrt(pribyte)); sigEng.update(src.getBytes()); byte[] signature = sigEng.sign(); return bytesToHexStr(signature); }catch(Exception e){ return null; } } public boolean verifySigature(String sign,String src){ try{ Security.addProvider(new ABAProvider()); Signature sigEng = Signature.getInstance(&quot;MD5withRSA&quot;,&quot;ABA&quot;); byte[] pubbyte = hexStrToBytes(pubKey.trim()); sigEng.initVerify(new RSAPubKey(pubbyte)); sigEng.update(src.getBytes()); byte[] sign1 = hexStrToBytes(sign); if (sigEng.verify(sign1)) { return true; } else { return false; } }catch(Exception e){ return false; } } /** * Transform the specified byte into a Hex String form. */ public static final String bytesToHexStr( byte[] bcd) { StringBuffer s = new StringBuffer(bcd.length * 2); for (int i = 0; i &lt; bcd.length; i++) { s.append(bcdLookup[(bcd[i] &gt;&gt;&gt; 4) &amp; 0x0f]); s.append(bcdLookup[bcd[i] &amp; 0x0f]); } return s.toString(); } /** * Transform the specified Hex String into a byte array. */ public static final byte[] hexStrToBytes( String s) { byte[] bytes; bytes = new byte[s.length() / 2]; for (int i = 0; i &lt; bytes.length; i++) { bytes[i] = (byte)Integer.parseInt( s.substring(2 * i, 2 * i + 2), 16); } return bytes; } private static final char[] bcdLookup = { &#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39; }; } import net.sf.json.JSONObject; import org.apache.log4j.Logger; import com.jfinal.core.Controller; import com.jfinal.kit.HttpKit; /** * 支付回调类 * @author 黄宝康 */ public class PayAction extends Controller{ private static final Logger logger = Logger.getLogger(PayAction.class); private String URL = &quot;&quot;; private String PUBKEY = &quot;&quot;; /** * 获取支付回调方法 */ public void index(){ String param = HttpKit.readData(getRequest()); JSONObject jo = JSONObject.fromObject(param); String posid = getPara(&quot;POSID&quot;); // 业务参数 String POSID = jo.getString(&quot;POSID&quot;); String BRANCHID = jo.getString(&quot;BRANCHID&quot;); String ORDERID = jo.getString(&quot;ORDERID&quot;); String PAYMENT = jo.getString(&quot;PAYMENT&quot;); String CURCODE = jo.getString(&quot;CURCODE&quot;); String REMARK1 = jo.getString(&quot;REMARK1&quot;); String REMARK2 = jo.getString(&quot;REMARK2&quot;); String SUCCESS = jo.getString(&quot;SUCCESS&quot;); String SIGN = jo.getString(&quot;SIGN&quot;); String strSrc = &quot;POSID=&quot;+POSID+&quot;&amp;BRANCHID=&quot;+BRANCHID+&quot;&amp;ORDERID=&quot;+ORDERID+&quot;&amp;PAYMENT=&quot;+PAYMENT+&quot;&amp;CURCODE=&quot;+CURCODE+&quot;&amp;REMARK1=&quot;+REMARK1+&quot;&amp;REMARK2=&quot;+REMARK2+&quot;&amp;SUCCESS=&quot;+SUCCESS; String strSign = SIGN; RSASig rsa=new RSASig(); rsa.setPublicKey(PUBKEY); String strRet; if(rsa.verifySigature(strSign, strSrc)){ strRet = &quot;Y&quot;; }else{ strRet = &quot;N&quot;; } renderText(&quot;调用成功!&quot;); } } 验签操作主要是考虑到安全性，公钥公开，sign参数是经过加密过来的，用自己的私钥加密的。以下是加签，解签的测试。 package signtest; import CCBSign.RSASig; public class SignTest { public static void main(String []args){ String strSrc; String strPubKey; String strPriKey; String strSign; strPubKey=&quot;30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strPriKey=&quot;30820277020100300d06092a864886f70d0101010500048202613082025d020100028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111028181008954fc004e452e1c5b7ef5a348563dc94ee4f4e7ff1bb25b4b0b783abea783345e575b7228b1da51529d772e31c311a342ffa90009eb7758fec4449ebafdb84126d1d2443dbcec07d9807638ef32cb91bf18eaaa46f6db84de5eba05edfe70ad029449a4cb4de7a95f5c903d6a3fa301f1cc0fe3e29ac72eeab68737f3b2f57d024100d428be0e1463c6b25cc493f23777135a9251b8092f3439c9604d61df8aadb958b947222fd60a489e5de44c379e806015edb0b15030a22cbc5e0ff693fd5bedcf024100bbce1eb6b55f5530f1bb7a437a0f0512f0153d0ada5c5b4ea57c3ea83bd89fe0166d5af1d07f153e83c05eae1585b113c03c8d989bb4d151c96aa78691fac1f7024100bb33020c6c5809ac6ff8bec6a9691113ae481adaed6a511b18bcbfc53e20d0b7b28a0f1b26454f2252d87f7c5ead81f53b236f46c180095ae9959d556714e0e3024100b0c1feca141d7d5b3ddda03f81f004c6879b84beeba237d18cb12be9a1bcd2b4c9d055984bc2e6d16cf14a0d416ec4c74b8449081a1397d48155526089647a51024100bcfe9b05b25578d5d96f80229e015aa58a0af5b0c0aa3ad695fe0d270c4818a737a7abc2f59cf1ea22c7155e06b7d26fba2594e29cb7fd02bd9b6e24b49e425a&quot;; strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; RSASig rsa=new RSASig(); rsa.setPrivateKey(strPriKey); strSign=rsa.generateSigature(strSrc); System.out.println(strSign); rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign fail&quot;); } //修改了源串后再验签 注意比较POSID的编号 strSrc=&quot;POSID=000000001&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; if( rsa.verifySigature(strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //修改签名串后再验签 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; strSign=&#39;a&#39;+strSign.substring(1,1)+strSign.substring(1,strSign.length()); System.out.println(strSign); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //修改公钥后再验签 删除一位公钥 //strPubKey=&quot;30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strPubKey=&quot;3019d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strSign=rsa.generateSigature( strSrc); rsa.setPublicKey( strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign ok&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //接下来是一些成功的签名验证 //1 strSrc=&quot;POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=2004010061&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=N&quot;; strSign=&quot;5bf88c409a13963286904e8954a4d825108f9b5bb60a8c8e5cfc05355fe4e247c777b521c7d68b8d51968285d51d1a0da0c5bd55e19268949a20dd7bd14f17422e41f3e6f7446d2136e10e796abc8b8a6f752bed5091374551d84d02f185aa3f9b516ac77ca319b06a8269389de6d7f677c619bfc0c89ccbcb125ae6dd7cc646&quot;; strPubKey=&quot;30819c300d06092a864886f70d010101050003818a003081860281807d1e98e9c10625239ad9116488accf18a95125c83f5ac52f055be47614087b1bc55f1d475ddb0516b6339f7c2a8fd4def86519087cc6ecd8ea4657a5cef26d84890d00772d216e95d0aba1ea9fd39fb02202c82b71333b104e715da5de65be4cf5b83e3c0ba459777fe83a39485f145fccc94b471981348db5beab735c5889f1020111&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //2 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y&quot;; strSign=&quot;43680d00f5097caae18b7af3fc936cc79feb621fb166e25affbb52721e2c5c1e656f030dff46e6f0298ef82cf2fd10b6cef34fb2aa270716c30708aeb1abf0520418449614562e891cd5aede8f83b1dd65f76cc81ad5aabfd4aba409da3523ef8e82a7d19055dbb6d9241171893bf282bf64f239677ecd84abbe55fd855f48f3&quot;; strPubKey=&quot;30819f300d06092a864886f70d010101050003818d0030818902818100b466e3a0fa097b57a1bc63c1fd5d97d4ef8d270d538a5aee3d1061f579f02a19cf1543701d94d81f46ce56adb84dca440a7e8f5af40538bb7a88efaf9991ead0fabc63d48fd1f12de658229e30e38ccbd9a631ec9c2d95b8590ea1a01d0931221e062544023a1ed2eb7050853fe56bf8cfd0f18243192d38855a36a87badba790203010001&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //3 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y&quot;; strSign=&quot;3183a60f887937846008f4ecfea725af5d65ecaefebea828459193343df7d0943f0fa9e44a298cc9a8e335bece72f8bfce8da3975e21fe4ce4d6c96894d5428e05e896b7da03f7519551b8a09bf1286ea48975b3cd49978eefbb628cc98f4f064feb898518dfb783acdd25eb6f5507fc00c16d1ae69d801a8cb970c4b7e0959b&quot;; strPubKey=&quot;30819f300d06092a864886f70d010101050003818d0030818902818100d0e57a2ebbc82801980de2ad7101c67dc137432bb6ced45882b8d41cbfec7519ae8bf18b2584ae460d7d437aec069ec907935e4b39c72a6291e43a6a88c3405565357dc23c46b7072e6e50b1da4cd9cfdec616cb6ad43f0b013040307973d63b889e78fdd1389714adec663acefe5c974e513a063ba9acb96f590139b0fc571b0203010001&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //接下来是一些错误的验签 //1 strSrc=&quot;POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=120040915091516271800047&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=Y&quot;; strSign=&quot;2732e323aa1d4f460bed516a79944001fbad2c93bbdb0d22c71066f4a69528c8699da27c13893bfcefea14dabb6f3cfa93e1414e8782124c99ffc8b059aad5f7f543993f28d262147b5206aea8d2b72aa34a256a4a5bb9c90c9aa8d2897eae90b581e7e6091fcfbb7f4885711b75b95ba7982f7519dc166e20d8b8294e4af2ad&quot;; strPubKey=&quot;30819c300d06092a864886f70d010101050003818a003081860281807e4caba7c0ff9f593bb03ac8e64fcc76ebdf728b3b54493c3f62c7c94e8663d8505da39b08b00df4320c5a49d54c7774044fcc42937a0fb6a3706f724f872fe5f998cc48eb20875902b4b935e14df77b7aeb9224a5cf2db765b20fe56d8f4d5a9e03ab7943a41a179f8240e5311b3957971921fe9ccb9c24c828e99f91cc33f1020111&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } } } 阅读更多" />
<meta property="og:description" content="项目中时常涉及到支付动作，以下是个人在接手建设银行对接部分，查阅了许多资料，整理给大家，希望对大家有用！ 业务场景：在项目中通过向建设银行网关缴费，建设银行会跳转到我们在建行商户系统账号上所填写的回调地址，这时我们所要做的就是验签操作，验签成功说明支付成功，接下来是自己业务系统的一系列操作，如账单管理入库，推送消息，保存用户的转账记录等等之类的。 查阅建行的接口对接相关文档，文档上有这样的接口说明： 银行—&gt;商户接口参数 银行—&gt;商户接口包含两部分，即服务器通知和页面通知，商户可以登录商户后台独立设置，也可以由分行业务人员在分行后台设置。 站点间接口的参数传送仍然采用普通的URL方式，信息包含在CGI参数，具体如下所示： HTTP://MERCHANT.WEB.SITE/MERCHANT_CGI?POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y&amp;SIGN=4b3ef029516193b7d969ac1840083635a3e0901b8cd526caa44c1a07 2f496d7f0d4bca3942c0d9030bede37c7809b835cec787eb39e18b7596a724fba9805b24714dfbb0f4a3fb430b32e075254a114d4c38a0ac 52ef46a0ad33dec3fbfc15417402a1399e65e46996c0cf49fc7ffca9222f8cd693c8376b6f928828967bec42 注：?前的URL由商户在签约时提供 参与签名运算的字符及其顺序如下 POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y 注：字符串中变量名必须是大写字母。 如果商户的程序将MERCHANTID, POSID,BRANCHID, ORDERID, PAYMENT, CURCODE，TXCODE和MAC作为隐藏域(hidden)， 然后使用SUBMIT按纽，注意在 FORM的METHOD中使用“GET”的方式。 验签java代码： package com.wlkj.common.config; import java.security.KeyPair; import java.security.KeyPairGenerator; import java.security.PrivateKey; import java.security.PublicKey; import java.security.SecureRandom; import java.security.Security; import java.security.Signature; import netpay.merchant.crypto.ABAProvider; import netpay.merchant.crypto.RSAPrivKeyCrt; import netpay.merchant.crypto.RSAPubKey; public class RSASig{ private String priKey; private String pubKey; public boolean generateKeys(){ PublicKey keyPub; PrivateKey keyPri; SecureRandom rand; Security.addProvider(new ABAProvider()); rand = new SecureRandom(); rand.setSeed(System.currentTimeMillis()); try { KeyPairGenerator fact; KeyPair keyPair; fact = KeyPairGenerator.getInstance(&quot;RSA&quot;, &quot;ABA&quot;); fact.initialize(1024, rand); keyPair = fact.generateKeyPair(); keyPub = keyPair.getPublic(); keyPri = keyPair.getPrivate(); pubKey = bytesToHexStr(keyPub.getEncoded()); priKey = bytesToHexStr(keyPri.getEncoded()); } catch (Exception e) { return false; } return true; } public String getPublicKey(){ return pubKey; } public String getPrivateKey(){ return priKey; } public void setPublicKey(String pkey){ pubKey = pkey; } public void setPrivateKey(String pkey){ priKey = pkey; } public String generateSigature(String src){ try{ Security.addProvider(new ABAProvider()); Signature sigEng = Signature.getInstance(&quot;MD5withRSA&quot;,&quot;ABA&quot;); byte[] pribyte = hexStrToBytes(priKey.trim()); sigEng.initSign(new RSAPrivKeyCrt(pribyte)); sigEng.update(src.getBytes()); byte[] signature = sigEng.sign(); return bytesToHexStr(signature); }catch(Exception e){ return null; } } public boolean verifySigature(String sign,String src){ try{ Security.addProvider(new ABAProvider()); Signature sigEng = Signature.getInstance(&quot;MD5withRSA&quot;,&quot;ABA&quot;); byte[] pubbyte = hexStrToBytes(pubKey.trim()); sigEng.initVerify(new RSAPubKey(pubbyte)); sigEng.update(src.getBytes()); byte[] sign1 = hexStrToBytes(sign); if (sigEng.verify(sign1)) { return true; } else { return false; } }catch(Exception e){ return false; } } /** * Transform the specified byte into a Hex String form. */ public static final String bytesToHexStr( byte[] bcd) { StringBuffer s = new StringBuffer(bcd.length * 2); for (int i = 0; i &lt; bcd.length; i++) { s.append(bcdLookup[(bcd[i] &gt;&gt;&gt; 4) &amp; 0x0f]); s.append(bcdLookup[bcd[i] &amp; 0x0f]); } return s.toString(); } /** * Transform the specified Hex String into a byte array. */ public static final byte[] hexStrToBytes( String s) { byte[] bytes; bytes = new byte[s.length() / 2]; for (int i = 0; i &lt; bytes.length; i++) { bytes[i] = (byte)Integer.parseInt( s.substring(2 * i, 2 * i + 2), 16); } return bytes; } private static final char[] bcdLookup = { &#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39; }; } import net.sf.json.JSONObject; import org.apache.log4j.Logger; import com.jfinal.core.Controller; import com.jfinal.kit.HttpKit; /** * 支付回调类 * @author 黄宝康 */ public class PayAction extends Controller{ private static final Logger logger = Logger.getLogger(PayAction.class); private String URL = &quot;&quot;; private String PUBKEY = &quot;&quot;; /** * 获取支付回调方法 */ public void index(){ String param = HttpKit.readData(getRequest()); JSONObject jo = JSONObject.fromObject(param); String posid = getPara(&quot;POSID&quot;); // 业务参数 String POSID = jo.getString(&quot;POSID&quot;); String BRANCHID = jo.getString(&quot;BRANCHID&quot;); String ORDERID = jo.getString(&quot;ORDERID&quot;); String PAYMENT = jo.getString(&quot;PAYMENT&quot;); String CURCODE = jo.getString(&quot;CURCODE&quot;); String REMARK1 = jo.getString(&quot;REMARK1&quot;); String REMARK2 = jo.getString(&quot;REMARK2&quot;); String SUCCESS = jo.getString(&quot;SUCCESS&quot;); String SIGN = jo.getString(&quot;SIGN&quot;); String strSrc = &quot;POSID=&quot;+POSID+&quot;&amp;BRANCHID=&quot;+BRANCHID+&quot;&amp;ORDERID=&quot;+ORDERID+&quot;&amp;PAYMENT=&quot;+PAYMENT+&quot;&amp;CURCODE=&quot;+CURCODE+&quot;&amp;REMARK1=&quot;+REMARK1+&quot;&amp;REMARK2=&quot;+REMARK2+&quot;&amp;SUCCESS=&quot;+SUCCESS; String strSign = SIGN; RSASig rsa=new RSASig(); rsa.setPublicKey(PUBKEY); String strRet; if(rsa.verifySigature(strSign, strSrc)){ strRet = &quot;Y&quot;; }else{ strRet = &quot;N&quot;; } renderText(&quot;调用成功!&quot;); } } 验签操作主要是考虑到安全性，公钥公开，sign参数是经过加密过来的，用自己的私钥加密的。以下是加签，解签的测试。 package signtest; import CCBSign.RSASig; public class SignTest { public static void main(String []args){ String strSrc; String strPubKey; String strPriKey; String strSign; strPubKey=&quot;30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strPriKey=&quot;30820277020100300d06092a864886f70d0101010500048202613082025d020100028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111028181008954fc004e452e1c5b7ef5a348563dc94ee4f4e7ff1bb25b4b0b783abea783345e575b7228b1da51529d772e31c311a342ffa90009eb7758fec4449ebafdb84126d1d2443dbcec07d9807638ef32cb91bf18eaaa46f6db84de5eba05edfe70ad029449a4cb4de7a95f5c903d6a3fa301f1cc0fe3e29ac72eeab68737f3b2f57d024100d428be0e1463c6b25cc493f23777135a9251b8092f3439c9604d61df8aadb958b947222fd60a489e5de44c379e806015edb0b15030a22cbc5e0ff693fd5bedcf024100bbce1eb6b55f5530f1bb7a437a0f0512f0153d0ada5c5b4ea57c3ea83bd89fe0166d5af1d07f153e83c05eae1585b113c03c8d989bb4d151c96aa78691fac1f7024100bb33020c6c5809ac6ff8bec6a9691113ae481adaed6a511b18bcbfc53e20d0b7b28a0f1b26454f2252d87f7c5ead81f53b236f46c180095ae9959d556714e0e3024100b0c1feca141d7d5b3ddda03f81f004c6879b84beeba237d18cb12be9a1bcd2b4c9d055984bc2e6d16cf14a0d416ec4c74b8449081a1397d48155526089647a51024100bcfe9b05b25578d5d96f80229e015aa58a0af5b0c0aa3ad695fe0d270c4818a737a7abc2f59cf1ea22c7155e06b7d26fba2594e29cb7fd02bd9b6e24b49e425a&quot;; strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; RSASig rsa=new RSASig(); rsa.setPrivateKey(strPriKey); strSign=rsa.generateSigature(strSrc); System.out.println(strSign); rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign fail&quot;); } //修改了源串后再验签 注意比较POSID的编号 strSrc=&quot;POSID=000000001&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; if( rsa.verifySigature(strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //修改签名串后再验签 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; strSign=&#39;a&#39;+strSign.substring(1,1)+strSign.substring(1,strSign.length()); System.out.println(strSign); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //修改公钥后再验签 删除一位公钥 //strPubKey=&quot;30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strPubKey=&quot;3019d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strSign=rsa.generateSigature( strSrc); rsa.setPublicKey( strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign ok&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //接下来是一些成功的签名验证 //1 strSrc=&quot;POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=2004010061&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=N&quot;; strSign=&quot;5bf88c409a13963286904e8954a4d825108f9b5bb60a8c8e5cfc05355fe4e247c777b521c7d68b8d51968285d51d1a0da0c5bd55e19268949a20dd7bd14f17422e41f3e6f7446d2136e10e796abc8b8a6f752bed5091374551d84d02f185aa3f9b516ac77ca319b06a8269389de6d7f677c619bfc0c89ccbcb125ae6dd7cc646&quot;; strPubKey=&quot;30819c300d06092a864886f70d010101050003818a003081860281807d1e98e9c10625239ad9116488accf18a95125c83f5ac52f055be47614087b1bc55f1d475ddb0516b6339f7c2a8fd4def86519087cc6ecd8ea4657a5cef26d84890d00772d216e95d0aba1ea9fd39fb02202c82b71333b104e715da5de65be4cf5b83e3c0ba459777fe83a39485f145fccc94b471981348db5beab735c5889f1020111&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //2 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y&quot;; strSign=&quot;43680d00f5097caae18b7af3fc936cc79feb621fb166e25affbb52721e2c5c1e656f030dff46e6f0298ef82cf2fd10b6cef34fb2aa270716c30708aeb1abf0520418449614562e891cd5aede8f83b1dd65f76cc81ad5aabfd4aba409da3523ef8e82a7d19055dbb6d9241171893bf282bf64f239677ecd84abbe55fd855f48f3&quot;; strPubKey=&quot;30819f300d06092a864886f70d010101050003818d0030818902818100b466e3a0fa097b57a1bc63c1fd5d97d4ef8d270d538a5aee3d1061f579f02a19cf1543701d94d81f46ce56adb84dca440a7e8f5af40538bb7a88efaf9991ead0fabc63d48fd1f12de658229e30e38ccbd9a631ec9c2d95b8590ea1a01d0931221e062544023a1ed2eb7050853fe56bf8cfd0f18243192d38855a36a87badba790203010001&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //3 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y&quot;; strSign=&quot;3183a60f887937846008f4ecfea725af5d65ecaefebea828459193343df7d0943f0fa9e44a298cc9a8e335bece72f8bfce8da3975e21fe4ce4d6c96894d5428e05e896b7da03f7519551b8a09bf1286ea48975b3cd49978eefbb628cc98f4f064feb898518dfb783acdd25eb6f5507fc00c16d1ae69d801a8cb970c4b7e0959b&quot;; strPubKey=&quot;30819f300d06092a864886f70d010101050003818d0030818902818100d0e57a2ebbc82801980de2ad7101c67dc137432bb6ced45882b8d41cbfec7519ae8bf18b2584ae460d7d437aec069ec907935e4b39c72a6291e43a6a88c3405565357dc23c46b7072e6e50b1da4cd9cfdec616cb6ad43f0b013040307973d63b889e78fdd1389714adec663acefe5c974e513a063ba9acb96f590139b0fc571b0203010001&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //接下来是一些错误的验签 //1 strSrc=&quot;POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=120040915091516271800047&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=Y&quot;; strSign=&quot;2732e323aa1d4f460bed516a79944001fbad2c93bbdb0d22c71066f4a69528c8699da27c13893bfcefea14dabb6f3cfa93e1414e8782124c99ffc8b059aad5f7f543993f28d262147b5206aea8d2b72aa34a256a4a5bb9c90c9aa8d2897eae90b581e7e6091fcfbb7f4885711b75b95ba7982f7519dc166e20d8b8294e4af2ad&quot;; strPubKey=&quot;30819c300d06092a864886f70d010101050003818a003081860281807e4caba7c0ff9f593bb03ac8e64fcc76ebdf728b3b54493c3f62c7c94e8663d8505da39b08b00df4320c5a49d54c7774044fcc42937a0fb6a3706f724f872fe5f998cc48eb20875902b4b935e14df77b7aeb9224a5cf2db765b20fe56d8f4d5a9e03ab7943a41a179f8240e5311b3957971921fe9ccb9c24c828e99f91cc33f1020111&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } } } 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/09/18/c85a7857bd84f1af9f1319e371fc8e7f.html" />
<meta property="og:url" content="https://mlh.app/2017/09/18/c85a7857bd84f1af9f1319e371fc8e7f.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-18T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"项目中时常涉及到支付动作，以下是个人在接手建设银行对接部分，查阅了许多资料，整理给大家，希望对大家有用！ 业务场景：在项目中通过向建设银行网关缴费，建设银行会跳转到我们在建行商户系统账号上所填写的回调地址，这时我们所要做的就是验签操作，验签成功说明支付成功，接下来是自己业务系统的一系列操作，如账单管理入库，推送消息，保存用户的转账记录等等之类的。 查阅建行的接口对接相关文档，文档上有这样的接口说明： 银行—&gt;商户接口参数 银行—&gt;商户接口包含两部分，即服务器通知和页面通知，商户可以登录商户后台独立设置，也可以由分行业务人员在分行后台设置。 站点间接口的参数传送仍然采用普通的URL方式，信息包含在CGI参数，具体如下所示： HTTP://MERCHANT.WEB.SITE/MERCHANT_CGI?POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y&amp;SIGN=4b3ef029516193b7d969ac1840083635a3e0901b8cd526caa44c1a07 2f496d7f0d4bca3942c0d9030bede37c7809b835cec787eb39e18b7596a724fba9805b24714dfbb0f4a3fb430b32e075254a114d4c38a0ac 52ef46a0ad33dec3fbfc15417402a1399e65e46996c0cf49fc7ffca9222f8cd693c8376b6f928828967bec42 注：?前的URL由商户在签约时提供 参与签名运算的字符及其顺序如下 POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y 注：字符串中变量名必须是大写字母。 如果商户的程序将MERCHANTID, POSID,BRANCHID, ORDERID, PAYMENT, CURCODE，TXCODE和MAC作为隐藏域(hidden)， 然后使用SUBMIT按纽，注意在 FORM的METHOD中使用“GET”的方式。 验签java代码： package com.wlkj.common.config; import java.security.KeyPair; import java.security.KeyPairGenerator; import java.security.PrivateKey; import java.security.PublicKey; import java.security.SecureRandom; import java.security.Security; import java.security.Signature; import netpay.merchant.crypto.ABAProvider; import netpay.merchant.crypto.RSAPrivKeyCrt; import netpay.merchant.crypto.RSAPubKey; public class RSASig{ private String priKey; private String pubKey; public boolean generateKeys(){ PublicKey keyPub; PrivateKey keyPri; SecureRandom rand; Security.addProvider(new ABAProvider()); rand = new SecureRandom(); rand.setSeed(System.currentTimeMillis()); try { KeyPairGenerator fact; KeyPair keyPair; fact = KeyPairGenerator.getInstance(&quot;RSA&quot;, &quot;ABA&quot;); fact.initialize(1024, rand); keyPair = fact.generateKeyPair(); keyPub = keyPair.getPublic(); keyPri = keyPair.getPrivate(); pubKey = bytesToHexStr(keyPub.getEncoded()); priKey = bytesToHexStr(keyPri.getEncoded()); } catch (Exception e) { return false; } return true; } public String getPublicKey(){ return pubKey; } public String getPrivateKey(){ return priKey; } public void setPublicKey(String pkey){ pubKey = pkey; } public void setPrivateKey(String pkey){ priKey = pkey; } public String generateSigature(String src){ try{ Security.addProvider(new ABAProvider()); Signature sigEng = Signature.getInstance(&quot;MD5withRSA&quot;,&quot;ABA&quot;); byte[] pribyte = hexStrToBytes(priKey.trim()); sigEng.initSign(new RSAPrivKeyCrt(pribyte)); sigEng.update(src.getBytes()); byte[] signature = sigEng.sign(); return bytesToHexStr(signature); }catch(Exception e){ return null; } } public boolean verifySigature(String sign,String src){ try{ Security.addProvider(new ABAProvider()); Signature sigEng = Signature.getInstance(&quot;MD5withRSA&quot;,&quot;ABA&quot;); byte[] pubbyte = hexStrToBytes(pubKey.trim()); sigEng.initVerify(new RSAPubKey(pubbyte)); sigEng.update(src.getBytes()); byte[] sign1 = hexStrToBytes(sign); if (sigEng.verify(sign1)) { return true; } else { return false; } }catch(Exception e){ return false; } } /** * Transform the specified byte into a Hex String form. */ public static final String bytesToHexStr( byte[] bcd) { StringBuffer s = new StringBuffer(bcd.length * 2); for (int i = 0; i &lt; bcd.length; i++) { s.append(bcdLookup[(bcd[i] &gt;&gt;&gt; 4) &amp; 0x0f]); s.append(bcdLookup[bcd[i] &amp; 0x0f]); } return s.toString(); } /** * Transform the specified Hex String into a byte array. */ public static final byte[] hexStrToBytes( String s) { byte[] bytes; bytes = new byte[s.length() / 2]; for (int i = 0; i &lt; bytes.length; i++) { bytes[i] = (byte)Integer.parseInt( s.substring(2 * i, 2 * i + 2), 16); } return bytes; } private static final char[] bcdLookup = { &#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;,&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39; }; } import net.sf.json.JSONObject; import org.apache.log4j.Logger; import com.jfinal.core.Controller; import com.jfinal.kit.HttpKit; /** * 支付回调类 * @author 黄宝康 */ public class PayAction extends Controller{ private static final Logger logger = Logger.getLogger(PayAction.class); private String URL = &quot;&quot;; private String PUBKEY = &quot;&quot;; /** * 获取支付回调方法 */ public void index(){ String param = HttpKit.readData(getRequest()); JSONObject jo = JSONObject.fromObject(param); String posid = getPara(&quot;POSID&quot;); // 业务参数 String POSID = jo.getString(&quot;POSID&quot;); String BRANCHID = jo.getString(&quot;BRANCHID&quot;); String ORDERID = jo.getString(&quot;ORDERID&quot;); String PAYMENT = jo.getString(&quot;PAYMENT&quot;); String CURCODE = jo.getString(&quot;CURCODE&quot;); String REMARK1 = jo.getString(&quot;REMARK1&quot;); String REMARK2 = jo.getString(&quot;REMARK2&quot;); String SUCCESS = jo.getString(&quot;SUCCESS&quot;); String SIGN = jo.getString(&quot;SIGN&quot;); String strSrc = &quot;POSID=&quot;+POSID+&quot;&amp;BRANCHID=&quot;+BRANCHID+&quot;&amp;ORDERID=&quot;+ORDERID+&quot;&amp;PAYMENT=&quot;+PAYMENT+&quot;&amp;CURCODE=&quot;+CURCODE+&quot;&amp;REMARK1=&quot;+REMARK1+&quot;&amp;REMARK2=&quot;+REMARK2+&quot;&amp;SUCCESS=&quot;+SUCCESS; String strSign = SIGN; RSASig rsa=new RSASig(); rsa.setPublicKey(PUBKEY); String strRet; if(rsa.verifySigature(strSign, strSrc)){ strRet = &quot;Y&quot;; }else{ strRet = &quot;N&quot;; } renderText(&quot;调用成功!&quot;); } } 验签操作主要是考虑到安全性，公钥公开，sign参数是经过加密过来的，用自己的私钥加密的。以下是加签，解签的测试。 package signtest; import CCBSign.RSASig; public class SignTest { public static void main(String []args){ String strSrc; String strPubKey; String strPriKey; String strSign; strPubKey=&quot;30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strPriKey=&quot;30820277020100300d06092a864886f70d0101010500048202613082025d020100028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111028181008954fc004e452e1c5b7ef5a348563dc94ee4f4e7ff1bb25b4b0b783abea783345e575b7228b1da51529d772e31c311a342ffa90009eb7758fec4449ebafdb84126d1d2443dbcec07d9807638ef32cb91bf18eaaa46f6db84de5eba05edfe70ad029449a4cb4de7a95f5c903d6a3fa301f1cc0fe3e29ac72eeab68737f3b2f57d024100d428be0e1463c6b25cc493f23777135a9251b8092f3439c9604d61df8aadb958b947222fd60a489e5de44c379e806015edb0b15030a22cbc5e0ff693fd5bedcf024100bbce1eb6b55f5530f1bb7a437a0f0512f0153d0ada5c5b4ea57c3ea83bd89fe0166d5af1d07f153e83c05eae1585b113c03c8d989bb4d151c96aa78691fac1f7024100bb33020c6c5809ac6ff8bec6a9691113ae481adaed6a511b18bcbfc53e20d0b7b28a0f1b26454f2252d87f7c5ead81f53b236f46c180095ae9959d556714e0e3024100b0c1feca141d7d5b3ddda03f81f004c6879b84beeba237d18cb12be9a1bcd2b4c9d055984bc2e6d16cf14a0d416ec4c74b8449081a1397d48155526089647a51024100bcfe9b05b25578d5d96f80229e015aa58a0af5b0c0aa3ad695fe0d270c4818a737a7abc2f59cf1ea22c7155e06b7d26fba2594e29cb7fd02bd9b6e24b49e425a&quot;; strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; RSASig rsa=new RSASig(); rsa.setPrivateKey(strPriKey); strSign=rsa.generateSigature(strSrc); System.out.println(strSign); rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign fail&quot;); } //修改了源串后再验签 注意比较POSID的编号 strSrc=&quot;POSID=000000001&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; if( rsa.verifySigature(strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //修改签名串后再验签 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11&quot;; strSign=&#39;a&#39;+strSign.substring(1,1)+strSign.substring(1,strSign.length()); System.out.println(strSign); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //修改公钥后再验签 删除一位公钥 //strPubKey=&quot;30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strPubKey=&quot;3019d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111&quot;; strSign=rsa.generateSigature( strSrc); rsa.setPublicKey( strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign ok&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //接下来是一些成功的签名验证 //1 strSrc=&quot;POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=2004010061&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=N&quot;; strSign=&quot;5bf88c409a13963286904e8954a4d825108f9b5bb60a8c8e5cfc05355fe4e247c777b521c7d68b8d51968285d51d1a0da0c5bd55e19268949a20dd7bd14f17422e41f3e6f7446d2136e10e796abc8b8a6f752bed5091374551d84d02f185aa3f9b516ac77ca319b06a8269389de6d7f677c619bfc0c89ccbcb125ae6dd7cc646&quot;; strPubKey=&quot;30819c300d06092a864886f70d010101050003818a003081860281807d1e98e9c10625239ad9116488accf18a95125c83f5ac52f055be47614087b1bc55f1d475ddb0516b6339f7c2a8fd4def86519087cc6ecd8ea4657a5cef26d84890d00772d216e95d0aba1ea9fd39fb02202c82b71333b104e715da5de65be4cf5b83e3c0ba459777fe83a39485f145fccc94b471981348db5beab735c5889f1020111&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //2 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y&quot;; strSign=&quot;43680d00f5097caae18b7af3fc936cc79feb621fb166e25affbb52721e2c5c1e656f030dff46e6f0298ef82cf2fd10b6cef34fb2aa270716c30708aeb1abf0520418449614562e891cd5aede8f83b1dd65f76cc81ad5aabfd4aba409da3523ef8e82a7d19055dbb6d9241171893bf282bf64f239677ecd84abbe55fd855f48f3&quot;; strPubKey=&quot;30819f300d06092a864886f70d010101050003818d0030818902818100b466e3a0fa097b57a1bc63c1fd5d97d4ef8d270d538a5aee3d1061f579f02a19cf1543701d94d81f46ce56adb84dca440a7e8f5af40538bb7a88efaf9991ead0fabc63d48fd1f12de658229e30e38ccbd9a631ec9c2d95b8590ea1a01d0931221e062544023a1ed2eb7050853fe56bf8cfd0f18243192d38855a36a87badba790203010001&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //3 strSrc=&quot;POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y&quot;; strSign=&quot;3183a60f887937846008f4ecfea725af5d65ecaefebea828459193343df7d0943f0fa9e44a298cc9a8e335bece72f8bfce8da3975e21fe4ce4d6c96894d5428e05e896b7da03f7519551b8a09bf1286ea48975b3cd49978eefbb628cc98f4f064feb898518dfb783acdd25eb6f5507fc00c16d1ae69d801a8cb970c4b7e0959b&quot;; strPubKey=&quot;30819f300d06092a864886f70d010101050003818d0030818902818100d0e57a2ebbc82801980de2ad7101c67dc137432bb6ced45882b8d41cbfec7519ae8bf18b2584ae460d7d437aec069ec907935e4b39c72a6291e43a6a88c3405565357dc23c46b7072e6e50b1da4cd9cfdec616cb6ad43f0b013040307973d63b889e78fdd1389714adec663acefe5c974e513a063ba9acb96f590139b0fc571b0203010001&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } //接下来是一些错误的验签 //1 strSrc=&quot;POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=120040915091516271800047&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=Y&quot;; strSign=&quot;2732e323aa1d4f460bed516a79944001fbad2c93bbdb0d22c71066f4a69528c8699da27c13893bfcefea14dabb6f3cfa93e1414e8782124c99ffc8b059aad5f7f543993f28d262147b5206aea8d2b72aa34a256a4a5bb9c90c9aa8d2897eae90b581e7e6091fcfbb7f4885711b75b95ba7982f7519dc166e20d8b8294e4af2ad&quot;; strPubKey=&quot;30819c300d06092a864886f70d010101050003818a003081860281807e4caba7c0ff9f593bb03ac8e64fcc76ebdf728b3b54493c3f62c7c94e8663d8505da39b08b00df4320c5a49d54c7774044fcc42937a0fb6a3706f724f872fe5f998cc48eb20875902b4b935e14df77b7aeb9224a5cf2db765b20fe56d8f4d5a9e03ab7943a41a179f8240e5311b3957971921fe9ccb9c24c828e99f91cc33f1020111&quot;; rsa.setPublicKey(strPubKey); if( rsa.verifySigature( strSign,strSrc) ){ System.out.println(&quot;Sign OK&quot;); } else{ System.out.println(&quot;Sign failed&quot;); } } } 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/09/18/c85a7857bd84f1af9f1319e371fc8e7f.html","headline":"建设银行通知到商户个人系统","dateModified":"2017-09-18T00:00:00+08:00","datePublished":"2017-09-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/09/18/c85a7857bd84f1af9f1319e371fc8e7f.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>建设银行通知到商户个人系统</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <h3 id="项目中时常涉及到支付动作以下是个人在接手建设银行对接部分查阅了许多资料整理给大家希望对大家有用">项目中时常涉及到支付动作，以下是个人在接手建设银行对接部分，查阅了许多资料，整理给大家，希望对大家有用！</h3> 
  <p>业务场景：在项目中通过向建设银行网关缴费，建设银行会跳转到我们在建行商户系统账号上所填写的回调地址，这时我们所要做的就是验签操作，验签成功说明支付成功，接下来是自己业务系统的一系列操作，如账单管理入库，推送消息，保存用户的转账记录等等之类的。</p> 
  <p>查阅建行的接口对接相关文档，文档上有这样的接口说明：</p> 
  <p><strong>银行—&gt;商户接口参数</strong></p> 
  <p>银行—&gt;商户接口包含两部分，即服务器通知和页面通知，商户可以登录商户后台独立设置，也可以由分行业务人员在分行后台设置。</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170918153612683?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVhbmdiYW9rYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p> 
  <p>站点间接口的参数传送仍然采用普通的URL方式，信息包含在CGI参数，具体如下所示： <br> <a href="HTTP://MERCHANT.WEB.SITE/MERCHANT_CGI?POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1" rel="nofollow" target="_blank">HTTP://MERCHANT.WEB.SITE/MERCHANT_CGI?POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1</a>＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y&amp;SIGN=4b3ef029516193b7d969ac1840083635a3e0901b8cd526caa44c1a07 <br> 2f496d7f0d4bca3942c0d9030bede37c7809b835cec787eb39e18b7596a724fba9805b24714dfbb0f4a3fb430b32e075254a114d4c38a0ac <br> 52ef46a0ad33dec3fbfc15417402a1399e65e46996c0cf49fc7ffca9222f8cd693c8376b6f928828967bec42</p> 
  <p>注：?前的URL由商户在签约时提供</p> 
  <p>参与签名运算的字符及其顺序如下 <br> POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1＝19991101&amp;REMARK2=merchantname&amp;SUCCESS=Y <br> 注：字符串中变量名必须是大写字母。</p> 
  <p>如果商户的程序将MERCHANTID, POSID,BRANCHID, ORDERID, PAYMENT, CURCODE，TXCODE和MAC作为隐藏域(hidden)， <br> 然后使用SUBMIT按纽，注意在 FORM的METHOD中使用“GET”的方式。</p> 
  <p>验签java代码：</p> 
  <pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.wlkj.common.config;

<span class="hljs-keyword">import</span> java.security.KeyPair;
<span class="hljs-keyword">import</span> java.security.KeyPairGenerator;
<span class="hljs-keyword">import</span> java.security.PrivateKey;
<span class="hljs-keyword">import</span> java.security.PublicKey;
<span class="hljs-keyword">import</span> java.security.SecureRandom;
<span class="hljs-keyword">import</span> java.security.Security;
<span class="hljs-keyword">import</span> java.security.Signature;

<span class="hljs-keyword">import</span> netpay.merchant.crypto.ABAProvider;
<span class="hljs-keyword">import</span> netpay.merchant.crypto.RSAPrivKeyCrt;
<span class="hljs-keyword">import</span> netpay.merchant.crypto.RSAPubKey;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RSASig</span>{</span>
    <span class="hljs-keyword">private</span> String priKey;
    <span class="hljs-keyword">private</span> String pubKey;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">generateKeys</span>(){

        PublicKey       keyPub;
        PrivateKey      keyPri;
        SecureRandom        rand;

        Security.addProvider(<span class="hljs-keyword">new</span> ABAProvider());

        rand = <span class="hljs-keyword">new</span> SecureRandom();

        rand.setSeed(System.currentTimeMillis());

        <span class="hljs-keyword">try</span>
        {
            KeyPairGenerator    fact;
            KeyPair         keyPair;

            fact = KeyPairGenerator.getInstance(<span class="hljs-string">"RSA"</span>, <span class="hljs-string">"ABA"</span>);

            fact.initialize(<span class="hljs-number">1024</span>, rand);

            keyPair = fact.generateKeyPair();

            keyPub = keyPair.getPublic();

            keyPri = keyPair.getPrivate();

            pubKey = bytesToHexStr(keyPub.getEncoded());

            priKey = bytesToHexStr(keyPri.getEncoded());
        }
        <span class="hljs-keyword">catch</span> (Exception e)
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }


    <span class="hljs-keyword">public</span> String <span class="hljs-title">getPublicKey</span>(){
        <span class="hljs-keyword">return</span> pubKey;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getPrivateKey</span>(){
        <span class="hljs-keyword">return</span> priKey;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPublicKey</span>(String pkey){
        pubKey = pkey;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrivateKey</span>(String pkey){
        priKey = pkey;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">generateSigature</span>(String src){
        <span class="hljs-keyword">try</span>{
        Security.addProvider(<span class="hljs-keyword">new</span> ABAProvider());
        Signature sigEng = Signature.getInstance(<span class="hljs-string">"MD5withRSA"</span>,<span class="hljs-string">"ABA"</span>);

        <span class="hljs-keyword">byte</span>[] pribyte = hexStrToBytes(priKey.trim());
        sigEng.initSign(<span class="hljs-keyword">new</span> RSAPrivKeyCrt(pribyte));
        sigEng.update(src.getBytes());

        <span class="hljs-keyword">byte</span>[] signature = sigEng.sign();
        <span class="hljs-keyword">return</span> bytesToHexStr(signature);
        }<span class="hljs-keyword">catch</span>(Exception e){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">verifySigature</span>(String sign,String src){
        <span class="hljs-keyword">try</span>{
        Security.addProvider(<span class="hljs-keyword">new</span> ABAProvider());
        Signature sigEng = Signature.getInstance(<span class="hljs-string">"MD5withRSA"</span>,<span class="hljs-string">"ABA"</span>);

        <span class="hljs-keyword">byte</span>[] pubbyte = hexStrToBytes(pubKey.trim());
        sigEng.initVerify(<span class="hljs-keyword">new</span> RSAPubKey(pubbyte));
        sigEng.update(src.getBytes());

        <span class="hljs-keyword">byte</span>[] sign1 = hexStrToBytes(sign);
        <span class="hljs-keyword">if</span> (sigEng.verify(sign1))
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        }<span class="hljs-keyword">catch</span>(Exception e){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
    }

    <span class="hljs-javadoc">/** * Transform the specified byte into a Hex String form. */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String <span class="hljs-title">bytesToHexStr</span>(
        <span class="hljs-keyword">byte</span>[] bcd)
    {
        StringBuffer s = <span class="hljs-keyword">new</span> StringBuffer(bcd.length * <span class="hljs-number">2</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; bcd.length; i++)
        {
            s.append(bcdLookup[(bcd[i] &gt;&gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0x0f</span>]);
            s.append(bcdLookup[bcd[i] &amp; <span class="hljs-number">0x0f</span>]);
        }

        <span class="hljs-keyword">return</span> s.toString();
    }


    <span class="hljs-javadoc">/** * Transform the specified Hex String into a byte array. */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">hexStrToBytes</span>(
        String  s)
    {
        <span class="hljs-keyword">byte</span>[]  bytes;

        bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[s.length() / <span class="hljs-number">2</span>];

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; bytes.length; i++)
        {
            bytes[i] = (<span class="hljs-keyword">byte</span>)Integer.parseInt(
                    s.substring(<span class="hljs-number">2</span> * i, <span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>), <span class="hljs-number">16</span>);
        }

        <span class="hljs-keyword">return</span> bytes;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span>[] bcdLookup =
    {
        <span class="hljs-string">'0'</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'2'</span>,<span class="hljs-string">'3'</span>,<span class="hljs-string">'4'</span>,<span class="hljs-string">'5'</span>,<span class="hljs-string">'6'</span>,<span class="hljs-string">'7'</span>,<span class="hljs-string">'8'</span>,<span class="hljs-string">'9'</span>,<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>,<span class="hljs-string">'d'</span>,<span class="hljs-string">'e'</span>,<span class="hljs-string">'f'</span>
    };
}</code></pre> 
  <pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">import</span> net.sf.json.JSONObject;

<span class="hljs-keyword">import</span> org.apache.log4j.Logger;

<span class="hljs-keyword">import</span> com.jfinal.core.Controller;
<span class="hljs-keyword">import</span> com.jfinal.kit.HttpKit;

<span class="hljs-javadoc">/** * 支付回调类 *<span class="hljs-javadoctag"> @author</span> 黄宝康 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PayAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>{</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = Logger.getLogger(PayAction.class);
    <span class="hljs-keyword">private</span> String URL = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">private</span> String PUBKEY = <span class="hljs-string">""</span>;
    <span class="hljs-javadoc">/** * 获取支付回调方法 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">index</span>(){
        String param = HttpKit.readData(getRequest());
        JSONObject jo = JSONObject.fromObject(param);
        String posid = getPara(<span class="hljs-string">"POSID"</span>);
<span class="hljs-comment">// 业务参数</span>
        String POSID = jo.getString(<span class="hljs-string">"POSID"</span>);
        String BRANCHID = jo.getString(<span class="hljs-string">"BRANCHID"</span>);
        String ORDERID = jo.getString(<span class="hljs-string">"ORDERID"</span>);
        String PAYMENT = jo.getString(<span class="hljs-string">"PAYMENT"</span>);
        String CURCODE = jo.getString(<span class="hljs-string">"CURCODE"</span>);
        String REMARK1 = jo.getString(<span class="hljs-string">"REMARK1"</span>);
        String REMARK2 = jo.getString(<span class="hljs-string">"REMARK2"</span>);
        String SUCCESS = jo.getString(<span class="hljs-string">"SUCCESS"</span>);
        String SIGN = jo.getString(<span class="hljs-string">"SIGN"</span>);

        String strSrc = <span class="hljs-string">"POSID="</span>+POSID+<span class="hljs-string">"&amp;BRANCHID="</span>+BRANCHID+<span class="hljs-string">"&amp;ORDERID="</span>+ORDERID+<span class="hljs-string">"&amp;PAYMENT="</span>+PAYMENT+<span class="hljs-string">"&amp;CURCODE="</span>+CURCODE+<span class="hljs-string">"&amp;REMARK1="</span>+REMARK1+<span class="hljs-string">"&amp;REMARK2="</span>+REMARK2+<span class="hljs-string">"&amp;SUCCESS="</span>+SUCCESS;
        String strSign = SIGN;
        RSASig rsa=<span class="hljs-keyword">new</span> RSASig();
        rsa.setPublicKey(PUBKEY);
        String strRet;
        <span class="hljs-keyword">if</span>(rsa.verifySigature(strSign, strSrc)){
            strRet = <span class="hljs-string">"Y"</span>;
        }<span class="hljs-keyword">else</span>{
            strRet = <span class="hljs-string">"N"</span>;
        }
        renderText(<span class="hljs-string">"调用成功!"</span>);
    }
}</code></pre> 
  <p>验签操作主要是考虑到安全性，公钥公开，sign参数是经过加密过来的，用自己的私钥加密的。以下是加签，解签的测试。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">package signtest<span class="hljs-comment">;</span>
import CCBSign<span class="hljs-preprocessor">.RSASig</span><span class="hljs-comment">; </span>

public class SignTest {
    public static void main(String []args){
        String strSrc<span class="hljs-comment">;</span>
        String strPubKey<span class="hljs-comment">;</span>
        String strPriKey<span class="hljs-comment">;</span>
        String strSign<span class="hljs-comment">;</span>

        strPubKey=<span class="hljs-string">"30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111"</span><span class="hljs-comment">;</span>
        strPriKey=<span class="hljs-string">"30820277020100300d06092a864886f70d0101010500048202613082025d020100028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111028181008954fc004e452e1c5b7ef5a348563dc94ee4f4e7ff1bb25b4b0b783abea783345e575b7228b1da51529d772e31c311a342ffa90009eb7758fec4449ebafdb84126d1d2443dbcec07d9807638ef32cb91bf18eaaa46f6db84de5eba05edfe70ad029449a4cb4de7a95f5c903d6a3fa301f1cc0fe3e29ac72eeab68737f3b2f57d024100d428be0e1463c6b25cc493f23777135a9251b8092f3439c9604d61df8aadb958b947222fd60a489e5de44c379e806015edb0b15030a22cbc5e0ff693fd5bedcf024100bbce1eb6b55f5530f1bb7a437a0f0512f0153d0ada5c5b4ea57c3ea83bd89fe0166d5af1d07f153e83c05eae1585b113c03c8d989bb4d151c96aa78691fac1f7024100bb33020c6c5809ac6ff8bec6a9691113ae481adaed6a511b18bcbfc53e20d0b7b28a0f1b26454f2252d87f7c5ead81f53b236f46c180095ae9959d556714e0e3024100b0c1feca141d7d5b3ddda03f81f004c6879b84beeba237d18cb12be9a1bcd2b4c9d055984bc2e6d16cf14a0d416ec4c74b8449081a1397d48155526089647a51024100bcfe9b05b25578d5d96f80229e015aa58a0af5b0c0aa3ad695fe0d270c4818a737a7abc2f59cf1ea22c7155e06b7d26fba2594e29cb7fd02bd9b6e24b49e425a"</span><span class="hljs-comment">;</span>
        strSrc=<span class="hljs-string">"POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11"</span><span class="hljs-comment">;</span>
        RSASig rsa=new RSASig()<span class="hljs-comment">;</span>
        rsa<span class="hljs-preprocessor">.setPrivateKey</span>(strPriKey)<span class="hljs-comment">;</span>
        strSign=rsa<span class="hljs-preprocessor">.generateSigature</span>(strSrc)<span class="hljs-comment">;</span>

        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(strSign)<span class="hljs-comment">;</span>

        rsa<span class="hljs-preprocessor">.setPublicKey</span>(strPubKey)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign fail"</span>)<span class="hljs-comment">;</span>
        }


        //修改了源串后再验签 注意比较POSID的编号
        strSrc=<span class="hljs-string">"POSID=000000001&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11"</span><span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>(strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }

        //修改签名串后再验签
        strSrc=<span class="hljs-string">"POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=19991101234&amp;PAYMENT=500.00&amp;CURCODE=01&amp;REMARK1=19991101&amp;REMARK2=北京商户&amp;SUCCESS=Y&amp;ACC_TYPE=11"</span><span class="hljs-comment">;</span>
        strSign=<span class="hljs-string">'a'</span>+strSign<span class="hljs-preprocessor">.substring</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)+strSign<span class="hljs-preprocessor">.substring</span>(<span class="hljs-number">1</span>,strSign<span class="hljs-preprocessor">.length</span>())<span class="hljs-comment">;</span>
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(strSign)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }

        //修改公钥后再验签 删除一位公钥
        //strPubKey=<span class="hljs-string">"30819d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111"</span><span class="hljs-comment">;</span>
        strPubKey=<span class="hljs-string">"3019d300d06092a864886f70d010101050003818b00308187028181009ba4951169c5deecf03a8ddb2fd934f53747c03a211f63bccc84773182bdd8f7159634705041087e4c9053df05326952a143e1aab5e8ba75ed891a91c2db484b66a064abba6605418944d8763814ff23c161101948ec9ef2dfac735b4bb7c7dac18fbf87157b424780eb7080a3e7c9e79dd4841e44a001edfe497b9e3d2181b9020111"</span><span class="hljs-comment">;</span>
        strSign=rsa<span class="hljs-preprocessor">.generateSigature</span>( strSrc)<span class="hljs-comment">;</span>
        rsa<span class="hljs-preprocessor">.setPublicKey</span>( strPubKey)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign ok"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }

        //接下来是一些成功的签名验证
        //<span class="hljs-number">1</span>
        strSrc=<span class="hljs-string">"POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=2004010061&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=N"</span><span class="hljs-comment">;</span>
        strSign=<span class="hljs-string">"5bf88c409a13963286904e8954a4d825108f9b5bb60a8c8e5cfc05355fe4e247c777b521c7d68b8d51968285d51d1a0da0c5bd55e19268949a20dd7bd14f17422e41f3e6f7446d2136e10e796abc8b8a6f752bed5091374551d84d02f185aa3f9b516ac77ca319b06a8269389de6d7f677c619bfc0c89ccbcb125ae6dd7cc646"</span><span class="hljs-comment">;</span>
        strPubKey=<span class="hljs-string">"30819c300d06092a864886f70d010101050003818a003081860281807d1e98e9c10625239ad9116488accf18a95125c83f5ac52f055be47614087b1bc55f1d475ddb0516b6339f7c2a8fd4def86519087cc6ecd8ea4657a5cef26d84890d00772d216e95d0aba1ea9fd39fb02202c82b71333b104e715da5de65be4cf5b83e3c0ba459777fe83a39485f145fccc94b471981348db5beab735c5889f1020111"</span><span class="hljs-comment">;</span>
        rsa<span class="hljs-preprocessor">.setPublicKey</span>(strPubKey)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }

        //<span class="hljs-number">2</span>
        strSrc=<span class="hljs-string">"POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y"</span><span class="hljs-comment">;</span>
        strSign=<span class="hljs-string">"43680d00f5097caae18b7af3fc936cc79feb621fb166e25affbb52721e2c5c1e656f030dff46e6f0298ef82cf2fd10b6cef34fb2aa270716c30708aeb1abf0520418449614562e891cd5aede8f83b1dd65f76cc81ad5aabfd4aba409da3523ef8e82a7d19055dbb6d9241171893bf282bf64f239677ecd84abbe55fd855f48f3"</span><span class="hljs-comment">;</span>
        strPubKey=<span class="hljs-string">"30819f300d06092a864886f70d010101050003818d0030818902818100b466e3a0fa097b57a1bc63c1fd5d97d4ef8d270d538a5aee3d1061f579f02a19cf1543701d94d81f46ce56adb84dca440a7e8f5af40538bb7a88efaf9991ead0fabc63d48fd1f12de658229e30e38ccbd9a631ec9c2d95b8590ea1a01d0931221e062544023a1ed2eb7050853fe56bf8cfd0f18243192d38855a36a87badba790203010001"</span><span class="hljs-comment">;</span>
        rsa<span class="hljs-preprocessor">.setPublicKey</span>(strPubKey)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }

        //<span class="hljs-number">3</span>
        strSrc=<span class="hljs-string">"POSID=000000000&amp;BRANCHID=110000000&amp;ORDERID=20041031&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=ccb&amp;REMARK2=test&amp;SUCCESS=Y"</span><span class="hljs-comment">;</span>
        strSign=<span class="hljs-string">"3183a60f887937846008f4ecfea725af5d65ecaefebea828459193343df7d0943f0fa9e44a298cc9a8e335bece72f8bfce8da3975e21fe4ce4d6c96894d5428e05e896b7da03f7519551b8a09bf1286ea48975b3cd49978eefbb628cc98f4f064feb898518dfb783acdd25eb6f5507fc00c16d1ae69d801a8cb970c4b7e0959b"</span><span class="hljs-comment">;</span>
        strPubKey=<span class="hljs-string">"30819f300d06092a864886f70d010101050003818d0030818902818100d0e57a2ebbc82801980de2ad7101c67dc137432bb6ced45882b8d41cbfec7519ae8bf18b2584ae460d7d437aec069ec907935e4b39c72a6291e43a6a88c3405565357dc23c46b7072e6e50b1da4cd9cfdec616cb6ad43f0b013040307973d63b889e78fdd1389714adec663acefe5c974e513a063ba9acb96f590139b0fc571b0203010001"</span><span class="hljs-comment">;</span>
        rsa<span class="hljs-preprocessor">.setPublicKey</span>(strPubKey)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }

        //接下来是一些错误的验签
        //<span class="hljs-number">1</span>
        strSrc=<span class="hljs-string">"POSID=000000000&amp;BRANCHID=330000000&amp;ORDERID=120040915091516271800047&amp;PAYMENT=0.01&amp;CURCODE=01&amp;REMARK1=&amp;REMARK2=&amp;SUCCESS=Y"</span><span class="hljs-comment">;</span>
        strSign=<span class="hljs-string">"2732e323aa1d4f460bed516a79944001fbad2c93bbdb0d22c71066f4a69528c8699da27c13893bfcefea14dabb6f3cfa93e1414e8782124c99ffc8b059aad5f7f543993f28d262147b5206aea8d2b72aa34a256a4a5bb9c90c9aa8d2897eae90b581e7e6091fcfbb7f4885711b75b95ba7982f7519dc166e20d8b8294e4af2ad"</span><span class="hljs-comment">;</span>
        strPubKey=<span class="hljs-string">"30819c300d06092a864886f70d010101050003818a003081860281807e4caba7c0ff9f593bb03ac8e64fcc76ebdf728b3b54493c3f62c7c94e8663d8505da39b08b00df4320c5a49d54c7774044fcc42937a0fb6a3706f724f872fe5f998cc48eb20875902b4b935e14df77b7aeb9224a5cf2db765b20fe56d8f4d5a9e03ab7943a41a179f8240e5311b3957971921fe9ccb9c24c828e99f91cc33f1020111"</span><span class="hljs-comment">;</span>
        rsa<span class="hljs-preprocessor">.setPublicKey</span>(strPubKey)<span class="hljs-comment">;</span>
        if( rsa<span class="hljs-preprocessor">.verifySigature</span>( strSign,strSrc) ){
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign OK"</span>)<span class="hljs-comment">;</span>
        }
        else{
            System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"Sign failed"</span>)<span class="hljs-comment">;</span>
        }
    }
}
</code></pre> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/huangbaokang/article/details/78019889,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/huangbaokang/article/details/78019889,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

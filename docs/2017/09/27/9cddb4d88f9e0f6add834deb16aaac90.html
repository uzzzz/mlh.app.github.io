<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Scry.info社区开发者技术分享——智能合约 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Scry.info社区开发者技术分享——智能合约" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="智能合约（smart contract）这个术语至少可以追溯到1995年，是由多产的跨领域法律学者尼克·萨博（Nick Szabo）提出来的。他在发表在自己的网站的几篇文章中提到了智能合约的理念。 “一个智能合约是一套以数字形式定义的承诺（promises），包括合约参与方可以在上面执行这些承诺的协议。” 基于区块链的智能合约构建及执行由多方用户共同参与制订一份智能合约，合约通过P2P网络扩散到每个节点并存入内存中，等待共识时间到了，验证节点会把所有合约打包成一个合约集合（set），并算出这个合约集合的hash值，组装成一个区块机构扩散到全网，全网各节点通过多轮的对比验证，最终达成共识合约成立。当触发智能合约条件后，进入新一轮的验证，验证达成共识，区块链构建的智能合约自动执行。 以下代码演示了一个简单的智能合约: pragma solidity ^0.4.4; // This is just a simple example of a coin-like contract. // It is not standards compatible and cannot be expected to talk to other // coin/token contracts. If you want to create a standards-compliant // token, see: https://github.com/ConsenSys/Tokens. Cheers! &nbsp; contract MetaCoin { &nbsp;&nbsp;&nbsp;&nbsp;mapping (address =&gt; uint) balances; &nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint256 _value); &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;function MetaCoin() { &nbsp; //&nbsp;The initial number of creators is 10000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] = 10000; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp; &nbsp;/**&nbsp;Send token to the specified address&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;function sendCoin(address receiver, uint amount) returns(bool sufficient) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(balances[msg.sender] &lt; amount) return false;&nbsp;// The sender&#39;s balance is insufficient to return false &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] -= amount;&nbsp;// Deduct the number of tokens from the sender &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[receiver] += amount;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Increase the number of recipient tokens&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Transfer(msg.sender, receiver, amount);&nbsp;// Throw event &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp; /**&nbsp;Gets the balance of the specified address&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;function getBalance(address addr) returns(uint) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return balances[addr]; &nbsp;&nbsp;&nbsp;&nbsp;} } 通过solc或solcjs编译该合约,得到相应的abi和bin 在geth控制台输入(或将此内容存为meta.js文件,然后使用loadScript(“meta.js”)来加载): personal.unlockAccount(eth.accounts[0],&quot;yan&quot;,99); //&nbsp;这里应该替换为自己的账号密码. var abi = &#39;[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;init2&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;getInit2&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;getInit1&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;init1&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]&#39;; var bytecode = &#39;0x6060604052341561000f57600080fd5b5b6127106000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555032600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6104e6806100e86000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063069489a21461007b5780637b1b0bb0146100d05780638a3959361461012557806390b98a111461017a578063f2eb3e34146101d4578063f8b2cb4f14610229575b600080fd5b341561008657600080fd5b61008e610276565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156100db57600080fd5b6100e361029c565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561013057600080fd5b6101386102c7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561018557600080fd5b6101ba600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506102f2565b604051808215151515815260200191505060405180910390f35b34156101df57600080fd5b6101e761044b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561023457600080fd5b610260600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610471565b6040518082815260200191505060405180910390f35b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156103435760009050610445565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a72305820da8820ab8e6ee92312c9f4dae7f46b7aa4b70df7df8cfab644ba330a2c25d5540029&#39;; &nbsp;var abiArray = JSON.parse(abi) &nbsp;var metaCoin = eth.contract(abiArray);//(abi); &nbsp;var txDeploy = {from:eth.accounts[0], data: bytecode, gas: 4700000}; &nbsp;var myContractPartialInstance = metaCoin.new(txDeploy, function(err, ctract){ &nbsp;&nbsp;console.log(&quot;&gt;&gt;&gt;&gt;&gt;&gt;deploy end:&gt;&gt; &quot;,err,ctract.address); &nbsp;&nbsp;if (!err &amp;&amp; ctract.address){ &nbsp;&nbsp;&nbsp;console.log(&quot;deploy success:&quot;,ctract.address); } else { &nbsp;&nbsp;&nbsp;console.log(&quot;deploy failed&quot;); &nbsp;&nbsp;} &nbsp;}); 再启动miner.start()既可看到部署结果,下次使用时通过 var _contract =&nbsp;eth.contract(abiArray); var _contractInst = _contract.at(ctractAddress);&nbsp; 得到合约实例.此时就可以通过contractInst来调用其方法.但要注意的是: contractInst&nbsp;.getBalance.call(addr) //&nbsp;没有交易的行为使用call contractInst.sendCoin.sendTransaction(addr, 100, {from:eth.accounts[0]}) //&nbsp;有交易的行为使用sendTransaction 因为sendCoin函数内在修改数据存储,是一种交易行为. 具体参见Solidity官方文档: http://solidity.readthedocs.io/en/develop/ 以上合约不是标准的ERC20代币合约,ERC20代币合约包含几个方法和属性: contract&nbsp;&nbsp;ERC20 { string public constant name = &quot;Token Name&quot;; string public constant symbol = &quot;SYM&quot;; uint8 public constant decimals =&nbsp;1; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function totalSupply() constant returns (uint totalSupply); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function balanceOf(address _owner) constant returns (uint balance); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transfer(address _to, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transferFrom(address _from, address _to, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function approve(address _spender, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function allowance(address _owner, address _spender) constant returns (uint remaining); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint _value); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Approval(address indexed _owner, address indexed _spender, uint _value); &nbsp;} 按ERC20标准实现的合约能被钱包客户端识别,并能通过界面进行方面操作. 具体参考: https://github.com/ethereum/eips/issues/20 https://theethereum.wiki/w/index.php/ERC20_Token_Standard 这里的decimals表示将代币总数细化到小数点后多少位(但不是真正的小数).&nbsp;比如总量初始化为1000,&nbsp;decimals为1,&nbsp;则实际是100个代币(100 * 10**1 = = 1000),&nbsp;此时如果你想向别人发送1个代币,在钱包里不能写1,&nbsp;而是要写10,&nbsp;因为写1表示发送0.1个,通过交易可以查看到实际发送的是0.1: 所以如果你要发行1000个代币,那么在智能合约中的初始设置时应该是total = 1000 * 10**decimals. (要乘上10的decimals次方) 智能合约虽然提供较为完备的可编程能力,但其中的坑还是很多的(比如存储,变量类型转换等),不同的写法可能导致隐患甚至错误(Solidity文档中也有较为详细的介绍),所以在编写智能合约时要非常小心. 由于篇幅有限,无法深入介绍,具体请参考以上官方文档. 阅读更多" />
<meta property="og:description" content="智能合约（smart contract）这个术语至少可以追溯到1995年，是由多产的跨领域法律学者尼克·萨博（Nick Szabo）提出来的。他在发表在自己的网站的几篇文章中提到了智能合约的理念。 “一个智能合约是一套以数字形式定义的承诺（promises），包括合约参与方可以在上面执行这些承诺的协议。” 基于区块链的智能合约构建及执行由多方用户共同参与制订一份智能合约，合约通过P2P网络扩散到每个节点并存入内存中，等待共识时间到了，验证节点会把所有合约打包成一个合约集合（set），并算出这个合约集合的hash值，组装成一个区块机构扩散到全网，全网各节点通过多轮的对比验证，最终达成共识合约成立。当触发智能合约条件后，进入新一轮的验证，验证达成共识，区块链构建的智能合约自动执行。 以下代码演示了一个简单的智能合约: pragma solidity ^0.4.4; // This is just a simple example of a coin-like contract. // It is not standards compatible and cannot be expected to talk to other // coin/token contracts. If you want to create a standards-compliant // token, see: https://github.com/ConsenSys/Tokens. Cheers! &nbsp; contract MetaCoin { &nbsp;&nbsp;&nbsp;&nbsp;mapping (address =&gt; uint) balances; &nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint256 _value); &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;function MetaCoin() { &nbsp; //&nbsp;The initial number of creators is 10000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] = 10000; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp; &nbsp;/**&nbsp;Send token to the specified address&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;function sendCoin(address receiver, uint amount) returns(bool sufficient) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(balances[msg.sender] &lt; amount) return false;&nbsp;// The sender&#39;s balance is insufficient to return false &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] -= amount;&nbsp;// Deduct the number of tokens from the sender &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[receiver] += amount;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Increase the number of recipient tokens&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Transfer(msg.sender, receiver, amount);&nbsp;// Throw event &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp; /**&nbsp;Gets the balance of the specified address&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;function getBalance(address addr) returns(uint) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return balances[addr]; &nbsp;&nbsp;&nbsp;&nbsp;} } 通过solc或solcjs编译该合约,得到相应的abi和bin 在geth控制台输入(或将此内容存为meta.js文件,然后使用loadScript(“meta.js”)来加载): personal.unlockAccount(eth.accounts[0],&quot;yan&quot;,99); //&nbsp;这里应该替换为自己的账号密码. var abi = &#39;[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;init2&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;getInit2&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;getInit1&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;init1&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]&#39;; var bytecode = &#39;0x6060604052341561000f57600080fd5b5b6127106000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555032600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6104e6806100e86000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063069489a21461007b5780637b1b0bb0146100d05780638a3959361461012557806390b98a111461017a578063f2eb3e34146101d4578063f8b2cb4f14610229575b600080fd5b341561008657600080fd5b61008e610276565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156100db57600080fd5b6100e361029c565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561013057600080fd5b6101386102c7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561018557600080fd5b6101ba600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506102f2565b604051808215151515815260200191505060405180910390f35b34156101df57600080fd5b6101e761044b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561023457600080fd5b610260600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610471565b6040518082815260200191505060405180910390f35b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156103435760009050610445565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a72305820da8820ab8e6ee92312c9f4dae7f46b7aa4b70df7df8cfab644ba330a2c25d5540029&#39;; &nbsp;var abiArray = JSON.parse(abi) &nbsp;var metaCoin = eth.contract(abiArray);//(abi); &nbsp;var txDeploy = {from:eth.accounts[0], data: bytecode, gas: 4700000}; &nbsp;var myContractPartialInstance = metaCoin.new(txDeploy, function(err, ctract){ &nbsp;&nbsp;console.log(&quot;&gt;&gt;&gt;&gt;&gt;&gt;deploy end:&gt;&gt; &quot;,err,ctract.address); &nbsp;&nbsp;if (!err &amp;&amp; ctract.address){ &nbsp;&nbsp;&nbsp;console.log(&quot;deploy success:&quot;,ctract.address); } else { &nbsp;&nbsp;&nbsp;console.log(&quot;deploy failed&quot;); &nbsp;&nbsp;} &nbsp;}); 再启动miner.start()既可看到部署结果,下次使用时通过 var _contract =&nbsp;eth.contract(abiArray); var _contractInst = _contract.at(ctractAddress);&nbsp; 得到合约实例.此时就可以通过contractInst来调用其方法.但要注意的是: contractInst&nbsp;.getBalance.call(addr) //&nbsp;没有交易的行为使用call contractInst.sendCoin.sendTransaction(addr, 100, {from:eth.accounts[0]}) //&nbsp;有交易的行为使用sendTransaction 因为sendCoin函数内在修改数据存储,是一种交易行为. 具体参见Solidity官方文档: http://solidity.readthedocs.io/en/develop/ 以上合约不是标准的ERC20代币合约,ERC20代币合约包含几个方法和属性: contract&nbsp;&nbsp;ERC20 { string public constant name = &quot;Token Name&quot;; string public constant symbol = &quot;SYM&quot;; uint8 public constant decimals =&nbsp;1; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function totalSupply() constant returns (uint totalSupply); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function balanceOf(address _owner) constant returns (uint balance); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transfer(address _to, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transferFrom(address _from, address _to, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function approve(address _spender, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function allowance(address _owner, address _spender) constant returns (uint remaining); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint _value); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Approval(address indexed _owner, address indexed _spender, uint _value); &nbsp;} 按ERC20标准实现的合约能被钱包客户端识别,并能通过界面进行方面操作. 具体参考: https://github.com/ethereum/eips/issues/20 https://theethereum.wiki/w/index.php/ERC20_Token_Standard 这里的decimals表示将代币总数细化到小数点后多少位(但不是真正的小数).&nbsp;比如总量初始化为1000,&nbsp;decimals为1,&nbsp;则实际是100个代币(100 * 10**1 = = 1000),&nbsp;此时如果你想向别人发送1个代币,在钱包里不能写1,&nbsp;而是要写10,&nbsp;因为写1表示发送0.1个,通过交易可以查看到实际发送的是0.1: 所以如果你要发行1000个代币,那么在智能合约中的初始设置时应该是total = 1000 * 10**decimals. (要乘上10的decimals次方) 智能合约虽然提供较为完备的可编程能力,但其中的坑还是很多的(比如存储,变量类型转换等),不同的写法可能导致隐患甚至错误(Solidity文档中也有较为详细的介绍),所以在编写智能合约时要非常小心. 由于篇幅有限,无法深入介绍,具体请参考以上官方文档. 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/09/27/9cddb4d88f9e0f6add834deb16aaac90.html" />
<meta property="og:url" content="https://mlh.app/2017/09/27/9cddb4d88f9e0f6add834deb16aaac90.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-27T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"智能合约（smart contract）这个术语至少可以追溯到1995年，是由多产的跨领域法律学者尼克·萨博（Nick Szabo）提出来的。他在发表在自己的网站的几篇文章中提到了智能合约的理念。 “一个智能合约是一套以数字形式定义的承诺（promises），包括合约参与方可以在上面执行这些承诺的协议。” 基于区块链的智能合约构建及执行由多方用户共同参与制订一份智能合约，合约通过P2P网络扩散到每个节点并存入内存中，等待共识时间到了，验证节点会把所有合约打包成一个合约集合（set），并算出这个合约集合的hash值，组装成一个区块机构扩散到全网，全网各节点通过多轮的对比验证，最终达成共识合约成立。当触发智能合约条件后，进入新一轮的验证，验证达成共识，区块链构建的智能合约自动执行。 以下代码演示了一个简单的智能合约: pragma solidity ^0.4.4; // This is just a simple example of a coin-like contract. // It is not standards compatible and cannot be expected to talk to other // coin/token contracts. If you want to create a standards-compliant // token, see: https://github.com/ConsenSys/Tokens. Cheers! &nbsp; contract MetaCoin { &nbsp;&nbsp;&nbsp;&nbsp;mapping (address =&gt; uint) balances; &nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint256 _value); &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;function MetaCoin() { &nbsp; //&nbsp;The initial number of creators is 10000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] = 10000; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp; &nbsp;/**&nbsp;Send token to the specified address&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;function sendCoin(address receiver, uint amount) returns(bool sufficient) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(balances[msg.sender] &lt; amount) return false;&nbsp;// The sender&#39;s balance is insufficient to return false &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] -= amount;&nbsp;// Deduct the number of tokens from the sender &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[receiver] += amount;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Increase the number of recipient tokens&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Transfer(msg.sender, receiver, amount);&nbsp;// Throw event &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp; /**&nbsp;Gets the balance of the specified address&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;function getBalance(address addr) returns(uint) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return balances[addr]; &nbsp;&nbsp;&nbsp;&nbsp;} } 通过solc或solcjs编译该合约,得到相应的abi和bin 在geth控制台输入(或将此内容存为meta.js文件,然后使用loadScript(“meta.js”)来加载): personal.unlockAccount(eth.accounts[0],&quot;yan&quot;,99); //&nbsp;这里应该替换为自己的账号密码. var abi = &#39;[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;init2&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;getInit2&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[],&quot;name&quot;:&quot;getInit1&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;receiver&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;sendCoin&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;sufficient&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;init1&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;addr&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;getBalance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]&#39;; var bytecode = &#39;0x6060604052341561000f57600080fd5b5b6127106000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555032600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6104e6806100e86000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063069489a21461007b5780637b1b0bb0146100d05780638a3959361461012557806390b98a111461017a578063f2eb3e34146101d4578063f8b2cb4f14610229575b600080fd5b341561008657600080fd5b61008e610276565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156100db57600080fd5b6100e361029c565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561013057600080fd5b6101386102c7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561018557600080fd5b6101ba600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506102f2565b604051808215151515815260200191505060405180910390f35b34156101df57600080fd5b6101e761044b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561023457600080fd5b610260600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610471565b6040518082815260200191505060405180910390f35b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156103435760009050610445565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a72305820da8820ab8e6ee92312c9f4dae7f46b7aa4b70df7df8cfab644ba330a2c25d5540029&#39;; &nbsp;var abiArray = JSON.parse(abi) &nbsp;var metaCoin = eth.contract(abiArray);//(abi); &nbsp;var txDeploy = {from:eth.accounts[0], data: bytecode, gas: 4700000}; &nbsp;var myContractPartialInstance = metaCoin.new(txDeploy, function(err, ctract){ &nbsp;&nbsp;console.log(&quot;&gt;&gt;&gt;&gt;&gt;&gt;deploy end:&gt;&gt; &quot;,err,ctract.address); &nbsp;&nbsp;if (!err &amp;&amp; ctract.address){ &nbsp;&nbsp;&nbsp;console.log(&quot;deploy success:&quot;,ctract.address); } else { &nbsp;&nbsp;&nbsp;console.log(&quot;deploy failed&quot;); &nbsp;&nbsp;} &nbsp;}); 再启动miner.start()既可看到部署结果,下次使用时通过 var _contract =&nbsp;eth.contract(abiArray); var _contractInst = _contract.at(ctractAddress);&nbsp; 得到合约实例.此时就可以通过contractInst来调用其方法.但要注意的是: contractInst&nbsp;.getBalance.call(addr) //&nbsp;没有交易的行为使用call contractInst.sendCoin.sendTransaction(addr, 100, {from:eth.accounts[0]}) //&nbsp;有交易的行为使用sendTransaction 因为sendCoin函数内在修改数据存储,是一种交易行为. 具体参见Solidity官方文档: http://solidity.readthedocs.io/en/develop/ 以上合约不是标准的ERC20代币合约,ERC20代币合约包含几个方法和属性: contract&nbsp;&nbsp;ERC20 { string public constant name = &quot;Token Name&quot;; string public constant symbol = &quot;SYM&quot;; uint8 public constant decimals =&nbsp;1; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function totalSupply() constant returns (uint totalSupply); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function balanceOf(address _owner) constant returns (uint balance); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transfer(address _to, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transferFrom(address _from, address _to, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function approve(address _spender, uint _value) returns (bool success); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function allowance(address _owner, address _spender) constant returns (uint remaining); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint _value); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Approval(address indexed _owner, address indexed _spender, uint _value); &nbsp;} 按ERC20标准实现的合约能被钱包客户端识别,并能通过界面进行方面操作. 具体参考: https://github.com/ethereum/eips/issues/20 https://theethereum.wiki/w/index.php/ERC20_Token_Standard 这里的decimals表示将代币总数细化到小数点后多少位(但不是真正的小数).&nbsp;比如总量初始化为1000,&nbsp;decimals为1,&nbsp;则实际是100个代币(100 * 10**1 = = 1000),&nbsp;此时如果你想向别人发送1个代币,在钱包里不能写1,&nbsp;而是要写10,&nbsp;因为写1表示发送0.1个,通过交易可以查看到实际发送的是0.1: 所以如果你要发行1000个代币,那么在智能合约中的初始设置时应该是total = 1000 * 10**decimals. (要乘上10的decimals次方) 智能合约虽然提供较为完备的可编程能力,但其中的坑还是很多的(比如存储,变量类型转换等),不同的写法可能导致隐患甚至错误(Solidity文档中也有较为详细的介绍),所以在编写智能合约时要非常小心. 由于篇幅有限,无法深入介绍,具体请参考以上官方文档. 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/09/27/9cddb4d88f9e0f6add834deb16aaac90.html","headline":"Scry.info社区开发者技术分享——智能合约","dateModified":"2017-09-27T00:00:00+08:00","datePublished":"2017-09-27T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/09/27/9cddb4d88f9e0f6add834deb16aaac90.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Scry.info社区开发者技术分享——智能合约</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><span style="color:rgb(51,51,51);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;"><img src="https://img-blog.csdn.net/20170927110404597?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2NyeV9pbmZv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></p> 
  <p><span style="color:rgb(51,51,51);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;">智能合约（smart contract）这个术语至少可以追溯到1995年，是由多产的跨领域法律学者尼克·萨博（Nick Szabo）提出来的。他在发表在自己的网站的几篇文章中提到了智能合约的理念。</span></p> 
  <p></p> 
  <div style="text-indent:28px;">
   <span style="font-family:'宋体';color:#333333;"><span style="font-size:14px;line-height:22.4px;"><br></span></span>
  </div> 
  <span style="color:rgb(51,51,51);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;"> </span>
  <p style="clear:both;min-height:1em;text-indent:28px;"> <span style="font-family:'宋体';color:rgb(89,89,89);letter-spacing:0px;font-size:14px;">“一个</span><span style="color:rgb(89,89,89);font-size:14px;font-family:'宋体';">智能</span><span style="font-family:'宋体';color:rgb(89,89,89);letter-spacing:0px;font-size:14px;"><span>合约是一套以数字形式定义的承诺（</span>promises），包括合约参与方可以在上面执行这些承诺的协议。”</span></p> 
  <div>
   <span style="font-family:'宋体';color:rgb(89,89,89);letter-spacing:0px;font-size:14px;"><br></span>
  </div> 
  <p></p> 
  <p><span style="font-family:'宋体';font-size:14px;line-height:22.4px;color:rgb(38,38,38);">基于区块链的智能合约构建及执行由多方用户共同参与制订一份智能合约，合约通过</span><span style="font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;color:rgb(38,38,38);">P2P网络扩散到每个节点并存入内存中，等待共识时间到了，验证节点会把所有合约打包成一个合约集合（set），并算出这个合约集合的hash值，组装成一个区块机构扩散到全网，全网各节点通过多轮的对比验证，最终达成共识合约成立。当触发智能合约条件后，进入新一轮的验证，验证达成共识，区块链构建的智能合约自动执行。</span></p> 
  <p><span style="color:rgb(51,51,51);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;"><span style="color:rgb(38,38,38);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;"><br></span></span></p> 
  <p><span style="color:rgb(51,51,51);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;"><span style="color:rgb(38,38,38);font-family:'宋体';font-size:14px;line-height:22.4px;text-indent:28px;"></span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>以下代码演示了一个简单的智能合约</span>:</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:Calibri;font-size:14px;">pragma solidity ^0.4.4;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:Calibri;font-size:14px;"></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">// This is just a simple example of a coin-like contract.</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">// It is not standards compatible and cannot be expected to talk to other</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">// coin/token contracts. If you want to create a standards-compliant</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">// token, see: https://github.com/ConsenSys/Tokens. Cheers!</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">contract MetaCoin {</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;mapping (address =&gt; uint) balances;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint256 _value);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;function MetaCoin() {</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:'宋体';font-size:14px;">&nbsp; //&nbsp;<span></span>The initial number of creators is 10000<span style="font-family:Calibri;"></span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] = 10000;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:'宋体';font-size:14px;">&nbsp;/**&nbsp;<span>Send token to the specified address&nbsp;</span><span style="font-family:Calibri;">*/</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;function sendCoin(address receiver, uint amount) returns(bool sufficient) {</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(balances[msg.sender] &lt; amount) return false;</span><span style="font-family:'宋体';font-size:14px;">&nbsp;// The sender's balance is insufficient to return false</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-size:14px;font-family:Calibri;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender] -= amount;</span><span style="font-family:'宋体';font-size:14px;">&nbsp;// Deduct the number of tokens from the sender</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:'宋体';font-size:14px;"><span style="font-family:Calibri;background-color:rgb(240,240,240);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balances[receiver] += amount;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="background-color:rgb(240,240,240);">//&nbsp;Increase the number of recipient tokens</span>&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-size:14px;font-family:Calibri;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Transfer(msg.sender, receiver, amount);</span><span style="font-family:'宋体';font-size:14px;">&nbsp;// Throw event</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:'宋体';font-size:14px;">/**&nbsp;<span>Gets the balance of the specified address&nbsp;</span><span style="font-family:Calibri;">*/</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;function getBalance(address addr) returns(uint) {</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return balances[addr];</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">}</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;"><br></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;"></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>通过</span>solc<span>或</span><span style="font-family:Calibri;">solcjs</span><span>编译该合约</span><span style="font-family:Calibri;">,</span><span>得到相应的</span><span style="font-family:Calibri;">abi</span><span>和</span><span style="font-family:Calibri;">bin</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>在</span>geth<span>控制台输入</span><span style="font-family:Calibri;">(</span><span>或将此内容存为</span><span style="font-family:Calibri;">meta.js</span><span>文件</span><span style="font-family:Calibri;">,</span><span>然后使用</span><span style="font-family:Calibri;">loadScript(</span></span><span style="font-family:Calibri;font-size:14px;">“</span><span style="font-family:'宋体';font-size:14px;">meta.js</span><span style="font-family:Calibri;font-size:14px;">”</span><span style="font-family:'宋体';font-size:14px;">)<span>来加载</span><span style="font-family:Calibri;">):</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:Calibri;font-size:14px;">personal.unlockAccount(eth.accounts[0],"yan",99)</span><span style="font-family:'宋体';font-size:14px;">; //&nbsp;<span>这里应该替换为自己的账号密码</span><span style="font-family:Calibri;">.</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span style="font-family:Calibri;"></span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">var abi = '[{"constant":true,"inputs":[],"name":"init2","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getInit2","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getInit1","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"sendCoin","outputs":[{"name":"sufficient","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"init1","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"}]';</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">var bytecode = '0x6060604052341561000f57600080fd5b5b6127106000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555032600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6104e6806100e86000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063069489a21461007b5780637b1b0bb0146100d05780638a3959361461012557806390b98a111461017a578063f2eb3e34146101d4578063f8b2cb4f14610229575b600080fd5b341561008657600080fd5b61008e610276565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156100db57600080fd5b6100e361029c565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561013057600080fd5b6101386102c7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561018557600080fd5b6101ba600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506102f2565b604051808215151515815260200191505060405180910390f35b34156101df57600080fd5b6101e761044b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561023457600080fd5b610260600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610471565b6040518082815260200191505060405180910390f35b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410156103435760009050610445565b816000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282540392505081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190505b92915050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b9190505600a165627a7a72305820da8820ab8e6ee92312c9f4dae7f46b7aa4b70df7df8cfab644ba330a2c25d5540029';</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;var abiArray = JSON.parse(abi)</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;var metaCoin = eth.contract(abiArray);//(abi);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;var txDeploy = {from:eth.accounts[0], data: bytecode, gas: 4700000};</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;var myContractPartialInstance = metaCoin.new(txDeploy, function(err, ctract){</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span>&nbsp;<span style="font-family:Calibri;font-size:14px;">console.log("&gt;&gt;&gt;&gt;&gt;&gt;deploy end:&gt;&gt; ",err,ctract.address);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span>&nbsp;<span style="font-family:Calibri;font-size:14px;">if (!err &amp;&amp; ctract.address){</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span>&nbsp;&nbsp;<span style="font-family:Calibri;font-size:14px;">console.log("deploy success:",ctract.address);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">} else {</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span>&nbsp;&nbsp;<span style="font-family:Calibri;font-size:14px;">console.log("deploy failed");</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span>&nbsp;<span style="font-family:Calibri;font-size:14px;">}</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;});</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;"><br></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;"></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>再启动</span>miner.start()<span>既可看到部署结果</span><span style="font-family:Calibri;">,</span><span>下次使用时通过</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:Calibri;font-size:14px;">var _contract =</span><span style="font-family:'宋体';font-size:14px;">&nbsp;</span><span style="font-family:Calibri;font-size:14px;">eth.contract(abiArray);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:Calibri;font-size:14px;">var _contractInst = _contract.at(ctract</span><span style="font-family:'宋体';font-size:14px;">A</span><span style="font-family:Calibri;font-size:14px;">ddress);</span><span style="font-family:'宋体';font-size:14px;">&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>得到合约实例</span>.<span>此时就可以通过</span></span><span style="font-family:Calibri;font-size:14px;">contractInst<span style="font-family:'宋体';">来调用其方法</span></span><span style="font-family:'宋体';font-size:14px;">.</span><span style="font-size:14px;font-family:'宋体';">但要注意的是</span><span style="font-family:'宋体';font-size:14px;">:</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:Calibri;font-size:14px;">contractInst&nbsp;</span><span style="font-family:'宋体';font-size:14px;">.getBalance.call(addr) //&nbsp;<span>没有交易的行为使用</span><span style="font-family:Calibri;">call</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;">contractInst.sendCoin.sendTransaction(addr, 100, {from:eth.accounts[0]}) //&nbsp;<span>有交易的行为使用</span><span style="font-family:Calibri;">sendTransaction</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>因为</span>sendCoin<span>函数内在修改数据存储</span><span style="font-family:Calibri;">,</span><span>是一种交易行为</span><span style="font-family:Calibri;">.</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>具体参见</span>Solidity<span>官方文档</span><span style="font-family:Calibri;">:</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="color:rgb(0,0,255);"><u>http://solidity.readthedocs.io/en/develop/</u></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><br></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>以上合约不是标准的</span>ERC20<span>代币合约</span><span style="font-family:Calibri;">,ERC20</span><span>代币合约包含几个方法和属性</span><span style="font-family:Calibri;">:</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span style="font-family:Calibri;"></span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">contract</span><span style="font-family:'宋体';font-size:14px;">&nbsp;</span><span style="font-family:Calibri;font-size:14px;">&nbsp;ERC20 {</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">string public constant name = "Token Name";</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;text-indent:28px;"> <span style="font-family:Calibri;font-size:14px;">string public constant symbol = "SYM";</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;text-indent:28px;"> <span style="font-family:Calibri;font-size:14px;">uint8 public constant decimals =&nbsp;</span><span style="font-family:'宋体';font-size:14px;">1</span><span style="font-family:Calibri;font-size:14px;">;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function totalSupply() constant returns (uint totalSupply);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function balanceOf(address _owner) constant returns (uint balance);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transfer(address _to, uint _value) returns (bool success);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function transferFrom(address _from, address _to, uint _value) returns (bool success);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function approve(address _spender, uint _value) returns (bool success);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function allowance(address _owner, address _spender) constant returns (uint remaining);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Transfer(address indexed _from, address indexed _to, uint _value);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event Approval(address indexed _owner, address indexed _spender, uint _value);</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:24px;"> <span style="font-family:Calibri;font-size:14px;">&nbsp;}</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>按</span>ERC20<span>标准实现的合约能被钱包客户端识别</span><span style="font-family:Calibri;">,</span><span>并能通过界面进行方面操作</span><span style="font-family:Calibri;">.</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="font-family:'宋体';font-size:14px;"><span>具体参考</span>:</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="color:rgb(0,0,255);"><u>https://github.com/ethereum/eips/issues/20</u></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="color:rgb(0,0,255);"><u>https://theethereum.wiki/w/index.php/ERC20_Token_Standard</u></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;"> <span style="color:rgb(0,0,255);"><u><br></u></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-size:14px;font-family:'宋体';">这里的</span><span style="font-family:Calibri;font-size:14px;">decimals<span style="font-family:'宋体';">表示将代币总数细化到小数点后多少位</span></span><span style="font-family:'宋体';font-size:14px;">(</span><span style="font-size:14px;font-family:'宋体';">但不是真正的小数</span><span style="font-family:'宋体';font-size:14px;">).&nbsp;<span>比如总量初始化</span></span><span style="font-family:'宋体';font-size:14px;line-height:25.6px;"><span>为</span><span style="font-family:Calibri;">1000,</span></span><span style="font-size:14px;line-height:25.6px;font-family:Calibri;">&nbsp;decimals<span style="font-family:'宋体';">为</span></span><span style="font-family:'宋体';font-size:14px;line-height:25.6px;">1,&nbsp;<span>则实际是</span><span style="font-family:Calibri;">100</span><span>个代币</span><span style="font-family:Calibri;">(100 * 10**1 = = 1000),&nbsp;</span><span>此时如果你想向别人发送</span><span style="font-family:Calibri;">1</span><span>个代币</span><span style="font-family:Calibri;">,</span><span>在钱包里不能写</span><span style="font-family:Calibri;">1,&nbsp;</span><span>而是要写</span><span style="font-family:Calibri;">10,&nbsp;</span><span>因为写</span><span style="font-family:Calibri;">1</span><span>表示发送</span><span style="font-family:Calibri;">0.1</span><span>个</span><span style="font-family:Calibri;">,</span><span>通过交易可以查看到实际发送的是</span><span style="font-family:Calibri;">0.1:</span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-family:'宋体';font-size:14px;line-height:25.6px;"><span style="font-family:Calibri;"><img src="" alt=""><br></span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-family:'宋体';font-size:14px;line-height:25.6px;"><span style="font-family:Calibri;"></span></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-family:'宋体';font-size:14px;"><span>所以如果你要发行</span>1000<span>个代币</span><span style="font-family:Calibri;">,</span><span>那么在智能合约中的初始设置时应该是</span><span style="font-family:Calibri;">total = 1000 * 10**</span></span><span style="font-family:Calibri;font-size:14px;">decimals</span><span style="font-family:'宋体';font-size:14px;">. (<span>要乘上</span><span style="font-family:Calibri;">10</span><span>的</span></span><span style="font-family:Calibri;font-size:14px;">decimals<span style="font-family:'宋体';">次方</span></span><span style="font-family:'宋体';font-size:14px;">)</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-family:Calibri;font-size:14px;"><br></span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-family:'宋体';font-size:14px;">智能合约虽然提供较为完备的可编程能力,但其中的坑还是很多的</span><span style="font-size:14px;font-family:Calibri;">(</span><span style="font-family:'宋体';font-size:14px;">比如存储</span><span style="font-size:14px;font-family:Calibri;">,</span><span style="font-family:'宋体';font-size:14px;">变量类型转换等</span><span style="font-size:14px;font-family:Calibri;">),</span><span style="font-family:'宋体';font-size:14px;">不同的写法可能导致隐患甚至错误</span><span style="font-size:14px;font-family:Calibri;">(Solidity</span><span style="font-family:'宋体';font-size:14px;">文档中也有较为详细的介绍</span><span style="font-size:14px;font-family:Calibri;">),</span><span style="font-family:'宋体';font-size:14px;">所以在编写智能合约时要非常小心</span><span style="font-size:14px;font-family:Calibri;">.</span></p> 
  <p style="clear:both;min-height:1em;color:rgb(62,62,62);font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;font-size:16px;line-height:25.6px;text-indent:28px;"> <span style="font-family:'宋体';font-size:14px;"><span>由于篇幅有限</span>,<span>无法深入介绍</span><span style="font-family:Calibri;">,</span><span>具体请参考以上官方文档</span><span style="font-family:Calibri;">.</span></span></p> 
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/scry_info/article/details/78110268,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/scry_info/article/details/78110268,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>SpringBoot 整合Ehcache3 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="SpringBoot 整合Ehcache3" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。新博客地址：www.atomicdevelop.com https://blog.csdn.net/believer123/article/details/54767136 SpringBootLean 是对springboot学习与研究项目，是根据实际项目的形式对进行配置与处理，欢迎star与fork。 [oschina 地址] http://git.oschina.net/cmlbeliever/SpringBootLearning [github 地址] https://github.com/cmlbeliever/SpringBootLearning 最近研究了下服务器端缓存处理，并整合到SpringBoot中，已提交到branch-ehcache3分支。 网上使用的大部分是ehcache2的版本，groupId为net.sf.ehcache，升级到3以后groupId改成了org.ehcache，所以代码改变还是比较大的，根据官网上的博客地址 http://www.ehcache.org/blog/2016/05/18/ehcache3_jsr107_spring.html 按照官网的博客进行整合即可，总结步骤如下： 1、导入pom依赖 &lt;dependency&gt; &lt;groupId&gt;org.ehcache&lt;/groupId&gt; &lt;artifactId&gt;ehcache&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.cache&lt;/groupId&gt; &lt;artifactId&gt;cache-api&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-core --&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-core&lt;/artifactId&gt; &lt;version&gt;1.1.9&lt;/version&gt; &lt;/dependency&gt; 2、导入ehcache配置文件 &lt;config xmlns:xsi=&#39;http://www.w3.org/2001/XMLSchema-instance&#39; xmlns=&#39;http://www.ehcache.org/v3&#39; xmlns:jsr107=&#39;http://www.ehcache.org/v3/jsr107&#39;&gt; &lt;service&gt; &lt;jsr107:defaults&gt; &lt;jsr107:cache name=&quot;people&quot; template=&quot;heap-cache&quot; /&gt; &lt;/jsr107:defaults&gt; &lt;/service&gt; &lt;cache-template name=&quot;heap-cache&quot;&gt; &lt;listeners&gt; &lt;listener&gt; &lt;class&gt;com.cml.springboot.framework.cache3.EventLogger&lt;/class&gt; &lt;event-firing-mode&gt;ASYNCHRONOUS&lt;/event-firing-mode&gt; &lt;event-ordering-mode&gt;UNORDERED&lt;/event-ordering-mode&gt; &lt;events-to-fire-on&gt;CREATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;UPDATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EXPIRED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;REMOVED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EVICTED&lt;/events-to-fire-on&gt; &lt;/listener&gt; &lt;/listeners&gt; &lt;resources&gt; &lt;heap unit=&quot;entries&quot;&gt;2000&lt;/heap&gt; &lt;offheap unit=&quot;MB&quot;&gt;100&lt;/offheap&gt; &lt;/resources&gt; &lt;/cache-template&gt; &lt;/config&gt; 3、添加log监听类 package com.cml.springboot.framework.cache3; import org.ehcache.event.CacheEvent; import org.ehcache.event.CacheEventListener; import org.slf4j.Logger; import org.slf4j.LoggerFactory; /** * * @author GGIB */ public class EventLogger implements CacheEventListener&lt;Object, Object&gt; { private static final Logger LOGGER = LoggerFactory.getLogger(EventLogger.class); @Override public void onEvent(CacheEvent&lt;? extends Object, ? extends Object&gt; event) { LOGGER.info(&quot;Event: &quot; + event.getType() + &quot; Key: &quot; + event.getKey() + &quot; old value: &quot; + event.getOldValue() + &quot; new value: &quot; + event.getNewValue()); } } 4、添加cache配置类，这里添加cacheName为people package com.cml.springboot.framework.cache3; import java.util.concurrent.TimeUnit; import javax.cache.CacheManager; import javax.cache.configuration.MutableConfiguration; import javax.cache.expiry.Duration; import javax.cache.expiry.TouchedExpiryPolicy; import org.ehcache.spi.loaderwriter.CacheLoaderWriter; import org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer; import org.springframework.stereotype.Component; import org.springframework.web.servlet.mvc.condition.ProducesRequestCondition; @Component public class Ehcache3Config implements JCacheManagerCustomizer { private static final String NAME_CACHE = &quot;people&quot;; @Override public void customize(CacheManager cacheManager) { cacheManager.createCache(NAME_CACHE, new MutableConfiguration&lt;&gt;() .setExpiryPolicyFactory(TouchedExpiryPolicy.factoryOf(new Duration(TimeUnit.SECONDS, 10))) .setStoreByValue(true).setStatisticsEnabled(true)); } } 按照上述步骤配置即可，然后添加单元测试，可以从log上看出缓存是否使用到了。 单元测试类 com.cml.springboot.cache.Ehcache3Test 测试结果： ==================================================== 2017-01-28 16:30:05.732 INFO 41240 --- [ main] o.s.t.web.servlet.TestDispatcherServlet : FrameworkServlet &#39;&#39;: initialization completed in 1120 ms 2017-01-28 16:30:06.213 INFO 41240 --- [ main] o.s.s.c.ThreadPoolTaskScheduler : Initializing ExecutorService &#39;taskScheduler&#39; 2017-01-28 16:30:06.562 INFO 41240 --- [ main] o.s.c.support.DefaultLifecycleProcessor : Starting beans in phase 0 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.endpoint.EventDrivenConsumer : Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the &#39;errorChannel&#39; channel 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.channel.PublishSubscribeChannel : Channel &#39;application:-1.errorChannel&#39; has 1 subscriber(s). 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.endpoint.EventDrivenConsumer : started _org.springframework.integration.errorLogger 2017-01-28 16:30:06.579 INFO 41240 --- [ main] com.cml.springboot.cache3.Ehcache3Test : Started Ehcache3Test in 7.565 seconds (JVM running for 8.36) 2017-01-28 16:30:06.886 INFO 41240 --- [ main] c.c.s.s.service.impl.UserServiceImpl : ====================read user from db========= 2017-01-28 16:30:06.938 INFO 41240 --- [ main] c.c.s.sample.controller.CacheController : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] 2017-01-28 16:30:06.938 INFO 41240 --- [hcache [null]-0] c.c.s.framework.cache3.EventLogger : Event: CREATED Key: C78CE23552BC46328959C8C0AE391886 old value: null new value: User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] ============================== {&quot;code&quot;:1,&quot;user&quot;:{&quot;token&quot;:&quot;C78CE23552BC46328959C8C0AE391886&quot;,&quot;userId&quot;:1,&quot;birthday&quot;:&quot;19870227000000&quot;,&quot;nickName&quot;:&quot;小明22&quot;}} =====================read data second========================== 2017-01-28 16:30:07.022 INFO 41240 --- [ main] c.c.s.sample.controller.CacheController : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] ============================== {&quot;code&quot;:1,&quot;user&quot;:{&quot;token&quot;:&quot;C78CE23552BC46328959C8C0AE391886&quot;,&quot;userId&quot;:1,&quot;birthday&quot;:&quot;19870227000000&quot;,&quot;nickName&quot;:&quot;小明22&quot;}} 2017-01-28 16:30:07.031 INFO 41240 --- [ Thread-2] o.s.w.c.s.GenericWebApplicationContext : Closing org.springframework.web.context.support.GenericWebApplicationContext@17f62e33: startup date [Sat Jan 28 16:29:59 CST 2017]; root of context hierarchy 2017-01-28 16:30:07.035 INFO 41240 --- [ Thread-2] o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase 0 2017-01-28 16:30:07.036 INFO 41240 --- [ Thread-2] o.s.i.endpoint.EventDrivenConsumer : Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the &#39;errorChannel&#39; channel 2017-01-28 16:30:07.036 INFO 41240 --- [ Thread-2] o.s.i.channel.PublishSubscribeChannel : Channel &#39;application:-1.errorChannel&#39; has 0 subscriber(s). 2017-01-28 16:30:07.037 INFO 41240 --- [ Thread-2] o.s.i.endpoint.EventDrivenConsumer : stopped _org.springframework.integration.errorLogger 2017-01-28 16:30:07.038 INFO 41240 --- [ Thread-2] o.s.s.c.ThreadPoolTaskScheduler : Shutting down ExecutorService &#39;taskScheduler&#39; 2017-01-28 16:30:07.061 INFO 41240 --- [ Thread-2] org.ehcache.core.EhcacheManager : Cache &#39;people&#39; removed from EhcacheManager. 注：工程上分支branch-ehcache为ehcache2版本的配置。 步骤4只配置了内存缓存，至于文件缓存以及配置需要年后再研究，欢迎补充！" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。新博客地址：www.atomicdevelop.com https://blog.csdn.net/believer123/article/details/54767136 SpringBootLean 是对springboot学习与研究项目，是根据实际项目的形式对进行配置与处理，欢迎star与fork。 [oschina 地址] http://git.oschina.net/cmlbeliever/SpringBootLearning [github 地址] https://github.com/cmlbeliever/SpringBootLearning 最近研究了下服务器端缓存处理，并整合到SpringBoot中，已提交到branch-ehcache3分支。 网上使用的大部分是ehcache2的版本，groupId为net.sf.ehcache，升级到3以后groupId改成了org.ehcache，所以代码改变还是比较大的，根据官网上的博客地址 http://www.ehcache.org/blog/2016/05/18/ehcache3_jsr107_spring.html 按照官网的博客进行整合即可，总结步骤如下： 1、导入pom依赖 &lt;dependency&gt; &lt;groupId&gt;org.ehcache&lt;/groupId&gt; &lt;artifactId&gt;ehcache&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.cache&lt;/groupId&gt; &lt;artifactId&gt;cache-api&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-core --&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-core&lt;/artifactId&gt; &lt;version&gt;1.1.9&lt;/version&gt; &lt;/dependency&gt; 2、导入ehcache配置文件 &lt;config xmlns:xsi=&#39;http://www.w3.org/2001/XMLSchema-instance&#39; xmlns=&#39;http://www.ehcache.org/v3&#39; xmlns:jsr107=&#39;http://www.ehcache.org/v3/jsr107&#39;&gt; &lt;service&gt; &lt;jsr107:defaults&gt; &lt;jsr107:cache name=&quot;people&quot; template=&quot;heap-cache&quot; /&gt; &lt;/jsr107:defaults&gt; &lt;/service&gt; &lt;cache-template name=&quot;heap-cache&quot;&gt; &lt;listeners&gt; &lt;listener&gt; &lt;class&gt;com.cml.springboot.framework.cache3.EventLogger&lt;/class&gt; &lt;event-firing-mode&gt;ASYNCHRONOUS&lt;/event-firing-mode&gt; &lt;event-ordering-mode&gt;UNORDERED&lt;/event-ordering-mode&gt; &lt;events-to-fire-on&gt;CREATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;UPDATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EXPIRED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;REMOVED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EVICTED&lt;/events-to-fire-on&gt; &lt;/listener&gt; &lt;/listeners&gt; &lt;resources&gt; &lt;heap unit=&quot;entries&quot;&gt;2000&lt;/heap&gt; &lt;offheap unit=&quot;MB&quot;&gt;100&lt;/offheap&gt; &lt;/resources&gt; &lt;/cache-template&gt; &lt;/config&gt; 3、添加log监听类 package com.cml.springboot.framework.cache3; import org.ehcache.event.CacheEvent; import org.ehcache.event.CacheEventListener; import org.slf4j.Logger; import org.slf4j.LoggerFactory; /** * * @author GGIB */ public class EventLogger implements CacheEventListener&lt;Object, Object&gt; { private static final Logger LOGGER = LoggerFactory.getLogger(EventLogger.class); @Override public void onEvent(CacheEvent&lt;? extends Object, ? extends Object&gt; event) { LOGGER.info(&quot;Event: &quot; + event.getType() + &quot; Key: &quot; + event.getKey() + &quot; old value: &quot; + event.getOldValue() + &quot; new value: &quot; + event.getNewValue()); } } 4、添加cache配置类，这里添加cacheName为people package com.cml.springboot.framework.cache3; import java.util.concurrent.TimeUnit; import javax.cache.CacheManager; import javax.cache.configuration.MutableConfiguration; import javax.cache.expiry.Duration; import javax.cache.expiry.TouchedExpiryPolicy; import org.ehcache.spi.loaderwriter.CacheLoaderWriter; import org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer; import org.springframework.stereotype.Component; import org.springframework.web.servlet.mvc.condition.ProducesRequestCondition; @Component public class Ehcache3Config implements JCacheManagerCustomizer { private static final String NAME_CACHE = &quot;people&quot;; @Override public void customize(CacheManager cacheManager) { cacheManager.createCache(NAME_CACHE, new MutableConfiguration&lt;&gt;() .setExpiryPolicyFactory(TouchedExpiryPolicy.factoryOf(new Duration(TimeUnit.SECONDS, 10))) .setStoreByValue(true).setStatisticsEnabled(true)); } } 按照上述步骤配置即可，然后添加单元测试，可以从log上看出缓存是否使用到了。 单元测试类 com.cml.springboot.cache.Ehcache3Test 测试结果： ==================================================== 2017-01-28 16:30:05.732 INFO 41240 --- [ main] o.s.t.web.servlet.TestDispatcherServlet : FrameworkServlet &#39;&#39;: initialization completed in 1120 ms 2017-01-28 16:30:06.213 INFO 41240 --- [ main] o.s.s.c.ThreadPoolTaskScheduler : Initializing ExecutorService &#39;taskScheduler&#39; 2017-01-28 16:30:06.562 INFO 41240 --- [ main] o.s.c.support.DefaultLifecycleProcessor : Starting beans in phase 0 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.endpoint.EventDrivenConsumer : Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the &#39;errorChannel&#39; channel 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.channel.PublishSubscribeChannel : Channel &#39;application:-1.errorChannel&#39; has 1 subscriber(s). 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.endpoint.EventDrivenConsumer : started _org.springframework.integration.errorLogger 2017-01-28 16:30:06.579 INFO 41240 --- [ main] com.cml.springboot.cache3.Ehcache3Test : Started Ehcache3Test in 7.565 seconds (JVM running for 8.36) 2017-01-28 16:30:06.886 INFO 41240 --- [ main] c.c.s.s.service.impl.UserServiceImpl : ====================read user from db========= 2017-01-28 16:30:06.938 INFO 41240 --- [ main] c.c.s.sample.controller.CacheController : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] 2017-01-28 16:30:06.938 INFO 41240 --- [hcache [null]-0] c.c.s.framework.cache3.EventLogger : Event: CREATED Key: C78CE23552BC46328959C8C0AE391886 old value: null new value: User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] ============================== {&quot;code&quot;:1,&quot;user&quot;:{&quot;token&quot;:&quot;C78CE23552BC46328959C8C0AE391886&quot;,&quot;userId&quot;:1,&quot;birthday&quot;:&quot;19870227000000&quot;,&quot;nickName&quot;:&quot;小明22&quot;}} =====================read data second========================== 2017-01-28 16:30:07.022 INFO 41240 --- [ main] c.c.s.sample.controller.CacheController : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] ============================== {&quot;code&quot;:1,&quot;user&quot;:{&quot;token&quot;:&quot;C78CE23552BC46328959C8C0AE391886&quot;,&quot;userId&quot;:1,&quot;birthday&quot;:&quot;19870227000000&quot;,&quot;nickName&quot;:&quot;小明22&quot;}} 2017-01-28 16:30:07.031 INFO 41240 --- [ Thread-2] o.s.w.c.s.GenericWebApplicationContext : Closing org.springframework.web.context.support.GenericWebApplicationContext@17f62e33: startup date [Sat Jan 28 16:29:59 CST 2017]; root of context hierarchy 2017-01-28 16:30:07.035 INFO 41240 --- [ Thread-2] o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase 0 2017-01-28 16:30:07.036 INFO 41240 --- [ Thread-2] o.s.i.endpoint.EventDrivenConsumer : Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the &#39;errorChannel&#39; channel 2017-01-28 16:30:07.036 INFO 41240 --- [ Thread-2] o.s.i.channel.PublishSubscribeChannel : Channel &#39;application:-1.errorChannel&#39; has 0 subscriber(s). 2017-01-28 16:30:07.037 INFO 41240 --- [ Thread-2] o.s.i.endpoint.EventDrivenConsumer : stopped _org.springframework.integration.errorLogger 2017-01-28 16:30:07.038 INFO 41240 --- [ Thread-2] o.s.s.c.ThreadPoolTaskScheduler : Shutting down ExecutorService &#39;taskScheduler&#39; 2017-01-28 16:30:07.061 INFO 41240 --- [ Thread-2] org.ehcache.core.EhcacheManager : Cache &#39;people&#39; removed from EhcacheManager. 注：工程上分支branch-ehcache为ehcache2版本的配置。 步骤4只配置了内存缓存，至于文件缓存以及配置需要年后再研究，欢迎补充！" />
<link rel="canonical" href="https://mlh.app/2017/01/28/5ef8b578757c0aefd3e00dc38e74a7db.html" />
<meta property="og:url" content="https://mlh.app/2017/01/28/5ef8b578757c0aefd3e00dc38e74a7db.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-28T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。新博客地址：www.atomicdevelop.com https://blog.csdn.net/believer123/article/details/54767136 SpringBootLean 是对springboot学习与研究项目，是根据实际项目的形式对进行配置与处理，欢迎star与fork。 [oschina 地址] http://git.oschina.net/cmlbeliever/SpringBootLearning [github 地址] https://github.com/cmlbeliever/SpringBootLearning 最近研究了下服务器端缓存处理，并整合到SpringBoot中，已提交到branch-ehcache3分支。 网上使用的大部分是ehcache2的版本，groupId为net.sf.ehcache，升级到3以后groupId改成了org.ehcache，所以代码改变还是比较大的，根据官网上的博客地址 http://www.ehcache.org/blog/2016/05/18/ehcache3_jsr107_spring.html 按照官网的博客进行整合即可，总结步骤如下： 1、导入pom依赖 &lt;dependency&gt; &lt;groupId&gt;org.ehcache&lt;/groupId&gt; &lt;artifactId&gt;ehcache&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;javax.cache&lt;/groupId&gt; &lt;artifactId&gt;cache-api&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-core --&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-core&lt;/artifactId&gt; &lt;version&gt;1.1.9&lt;/version&gt; &lt;/dependency&gt; 2、导入ehcache配置文件 &lt;config xmlns:xsi=&#39;http://www.w3.org/2001/XMLSchema-instance&#39; xmlns=&#39;http://www.ehcache.org/v3&#39; xmlns:jsr107=&#39;http://www.ehcache.org/v3/jsr107&#39;&gt; &lt;service&gt; &lt;jsr107:defaults&gt; &lt;jsr107:cache name=&quot;people&quot; template=&quot;heap-cache&quot; /&gt; &lt;/jsr107:defaults&gt; &lt;/service&gt; &lt;cache-template name=&quot;heap-cache&quot;&gt; &lt;listeners&gt; &lt;listener&gt; &lt;class&gt;com.cml.springboot.framework.cache3.EventLogger&lt;/class&gt; &lt;event-firing-mode&gt;ASYNCHRONOUS&lt;/event-firing-mode&gt; &lt;event-ordering-mode&gt;UNORDERED&lt;/event-ordering-mode&gt; &lt;events-to-fire-on&gt;CREATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;UPDATED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EXPIRED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;REMOVED&lt;/events-to-fire-on&gt; &lt;events-to-fire-on&gt;EVICTED&lt;/events-to-fire-on&gt; &lt;/listener&gt; &lt;/listeners&gt; &lt;resources&gt; &lt;heap unit=&quot;entries&quot;&gt;2000&lt;/heap&gt; &lt;offheap unit=&quot;MB&quot;&gt;100&lt;/offheap&gt; &lt;/resources&gt; &lt;/cache-template&gt; &lt;/config&gt; 3、添加log监听类 package com.cml.springboot.framework.cache3; import org.ehcache.event.CacheEvent; import org.ehcache.event.CacheEventListener; import org.slf4j.Logger; import org.slf4j.LoggerFactory; /** * * @author GGIB */ public class EventLogger implements CacheEventListener&lt;Object, Object&gt; { private static final Logger LOGGER = LoggerFactory.getLogger(EventLogger.class); @Override public void onEvent(CacheEvent&lt;? extends Object, ? extends Object&gt; event) { LOGGER.info(&quot;Event: &quot; + event.getType() + &quot; Key: &quot; + event.getKey() + &quot; old value: &quot; + event.getOldValue() + &quot; new value: &quot; + event.getNewValue()); } } 4、添加cache配置类，这里添加cacheName为people package com.cml.springboot.framework.cache3; import java.util.concurrent.TimeUnit; import javax.cache.CacheManager; import javax.cache.configuration.MutableConfiguration; import javax.cache.expiry.Duration; import javax.cache.expiry.TouchedExpiryPolicy; import org.ehcache.spi.loaderwriter.CacheLoaderWriter; import org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer; import org.springframework.stereotype.Component; import org.springframework.web.servlet.mvc.condition.ProducesRequestCondition; @Component public class Ehcache3Config implements JCacheManagerCustomizer { private static final String NAME_CACHE = &quot;people&quot;; @Override public void customize(CacheManager cacheManager) { cacheManager.createCache(NAME_CACHE, new MutableConfiguration&lt;&gt;() .setExpiryPolicyFactory(TouchedExpiryPolicy.factoryOf(new Duration(TimeUnit.SECONDS, 10))) .setStoreByValue(true).setStatisticsEnabled(true)); } } 按照上述步骤配置即可，然后添加单元测试，可以从log上看出缓存是否使用到了。 单元测试类 com.cml.springboot.cache.Ehcache3Test 测试结果： ==================================================== 2017-01-28 16:30:05.732 INFO 41240 --- [ main] o.s.t.web.servlet.TestDispatcherServlet : FrameworkServlet &#39;&#39;: initialization completed in 1120 ms 2017-01-28 16:30:06.213 INFO 41240 --- [ main] o.s.s.c.ThreadPoolTaskScheduler : Initializing ExecutorService &#39;taskScheduler&#39; 2017-01-28 16:30:06.562 INFO 41240 --- [ main] o.s.c.support.DefaultLifecycleProcessor : Starting beans in phase 0 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.endpoint.EventDrivenConsumer : Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the &#39;errorChannel&#39; channel 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.channel.PublishSubscribeChannel : Channel &#39;application:-1.errorChannel&#39; has 1 subscriber(s). 2017-01-28 16:30:06.563 INFO 41240 --- [ main] o.s.i.endpoint.EventDrivenConsumer : started _org.springframework.integration.errorLogger 2017-01-28 16:30:06.579 INFO 41240 --- [ main] com.cml.springboot.cache3.Ehcache3Test : Started Ehcache3Test in 7.565 seconds (JVM running for 8.36) 2017-01-28 16:30:06.886 INFO 41240 --- [ main] c.c.s.s.service.impl.UserServiceImpl : ====================read user from db========= 2017-01-28 16:30:06.938 INFO 41240 --- [ main] c.c.s.sample.controller.CacheController : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] 2017-01-28 16:30:06.938 INFO 41240 --- [hcache [null]-0] c.c.s.framework.cache3.EventLogger : Event: CREATED Key: C78CE23552BC46328959C8C0AE391886 old value: null new value: User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] ============================== {&quot;code&quot;:1,&quot;user&quot;:{&quot;token&quot;:&quot;C78CE23552BC46328959C8C0AE391886&quot;,&quot;userId&quot;:1,&quot;birthday&quot;:&quot;19870227000000&quot;,&quot;nickName&quot;:&quot;小明22&quot;}} =====================read data second========================== 2017-01-28 16:30:07.022 INFO 41240 --- [ main] c.c.s.sample.controller.CacheController : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=null, password=null, token=C78CE23552BC46328959C8C0AE391886, newToken=null, userId=1, birthday=1987-02-27T00:00:00.000+08:00, nickName=小明22] ============================== {&quot;code&quot;:1,&quot;user&quot;:{&quot;token&quot;:&quot;C78CE23552BC46328959C8C0AE391886&quot;,&quot;userId&quot;:1,&quot;birthday&quot;:&quot;19870227000000&quot;,&quot;nickName&quot;:&quot;小明22&quot;}} 2017-01-28 16:30:07.031 INFO 41240 --- [ Thread-2] o.s.w.c.s.GenericWebApplicationContext : Closing org.springframework.web.context.support.GenericWebApplicationContext@17f62e33: startup date [Sat Jan 28 16:29:59 CST 2017]; root of context hierarchy 2017-01-28 16:30:07.035 INFO 41240 --- [ Thread-2] o.s.c.support.DefaultLifecycleProcessor : Stopping beans in phase 0 2017-01-28 16:30:07.036 INFO 41240 --- [ Thread-2] o.s.i.endpoint.EventDrivenConsumer : Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the &#39;errorChannel&#39; channel 2017-01-28 16:30:07.036 INFO 41240 --- [ Thread-2] o.s.i.channel.PublishSubscribeChannel : Channel &#39;application:-1.errorChannel&#39; has 0 subscriber(s). 2017-01-28 16:30:07.037 INFO 41240 --- [ Thread-2] o.s.i.endpoint.EventDrivenConsumer : stopped _org.springframework.integration.errorLogger 2017-01-28 16:30:07.038 INFO 41240 --- [ Thread-2] o.s.s.c.ThreadPoolTaskScheduler : Shutting down ExecutorService &#39;taskScheduler&#39; 2017-01-28 16:30:07.061 INFO 41240 --- [ Thread-2] org.ehcache.core.EhcacheManager : Cache &#39;people&#39; removed from EhcacheManager. 注：工程上分支branch-ehcache为ehcache2版本的配置。 步骤4只配置了内存缓存，至于文件缓存以及配置需要年后再研究，欢迎补充！","@type":"BlogPosting","url":"https://mlh.app/2017/01/28/5ef8b578757c0aefd3e00dc38e74a7db.html","headline":"SpringBoot 整合Ehcache3","dateModified":"2017-01-28T00:00:00+08:00","datePublished":"2017-01-28T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/01/28/5ef8b578757c0aefd3e00dc38e74a7db.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>SpringBoot 整合Ehcache3</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright"> 
  <svg class="icon" title="CSDN认证原创" aria-hidden="true" style="width:53px; height: 18px; vertical-align: -4px;"> 
   <use xlink:href="#CSDN_Cert"></use> 
  </svg> 版权声明：本文为博主原创文章，未经博主允许不得转载。新博客地址：www.atomicdevelop.com https://blog.csdn.net/believer123/article/details/54767136 
 </div> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p><strong>SpringBootLean 是对springboot学习与研究项目，是根据实际项目的形式对进行配置与处理，欢迎star与fork。</strong> <br> [oschina 地址] <br> <a href="http://git.oschina.net/cmlbeliever/SpringBootLearning" rel="nofollow">http://git.oschina.net/cmlbeliever/SpringBootLearning</a> <br> [github 地址] <br> <a href="https://github.com/cmlbeliever/SpringBootLearning" rel="nofollow">https://github.com/cmlbeliever/SpringBootLearning</a></p> 
  <p>最近研究了下服务器端缓存处理，并整合到SpringBoot中，已提交到branch-ehcache3分支。</p> 
  <p>网上使用的大部分是ehcache2的版本，groupId为net.sf.ehcache，升级到3以后groupId改成了org.ehcache，所以代码改变还是比较大的，根据官网上的博客地址 <br> <a href="http://www.ehcache.org/blog/2016/05/18/ehcache3_jsr107_spring.html" rel="nofollow">http://www.ehcache.org/blog/2016/05/18/ehcache3_jsr107_spring.html</a> <br> 按照官网的博客进行整合即可，总结步骤如下：</p> 
  <p>1、导入pom依赖</p> 
  <pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.ehcache<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>javax.cache<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>cache-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-core --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>logback-core<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.1.9<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
</code></pre> 
  <p>2、导入ehcache配置文件</p> 
  <pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-subst">&lt;</span>config xmlns:xsi<span class="hljs-subst">=</span><span class="hljs-string">'http://www.w3.org/2001/XMLSchema-instance'</span>
    xmlns<span class="hljs-subst">=</span><span class="hljs-string">'http://www.ehcache.org/v3'</span> xmlns:jsr107<span class="hljs-subst">=</span><span class="hljs-string">'http://www.ehcache.org/v3/jsr107'</span><span class="hljs-subst">&gt;</span>

    <span class="hljs-subst">&lt;</span>service<span class="hljs-subst">&gt;</span>
        <span class="hljs-subst">&lt;</span>jsr107:defaults<span class="hljs-subst">&gt;</span>
            <span class="hljs-subst">&lt;</span>jsr107:<span class="hljs-keyword">cache</span> name<span class="hljs-subst">=</span><span class="hljs-string">"people"</span> template<span class="hljs-subst">=</span><span class="hljs-string">"heap-cache"</span> <span class="hljs-subst">/</span><span class="hljs-subst">&gt;</span>
        <span class="hljs-subst">&lt;</span>/jsr107:defaults<span class="hljs-subst">&gt;</span>
    <span class="hljs-subst">&lt;</span>/service<span class="hljs-subst">&gt;</span>

    <span class="hljs-subst">&lt;</span><span class="hljs-keyword">cache</span><span class="hljs-attribute">-template</span> name<span class="hljs-subst">=</span><span class="hljs-string">"heap-cache"</span><span class="hljs-subst">&gt;</span>
        <span class="hljs-subst">&lt;</span>listeners<span class="hljs-subst">&gt;</span>
            <span class="hljs-subst">&lt;</span>listener<span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>class<span class="hljs-subst">&gt;</span>com<span class="hljs-built_in">.</span>cml<span class="hljs-built_in">.</span>springboot<span class="hljs-built_in">.</span>framework<span class="hljs-built_in">.</span>cache3<span class="hljs-built_in">.</span>EventLogger<span class="hljs-subst">&lt;</span>/class<span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>event<span class="hljs-attribute">-firing</span><span class="hljs-attribute">-mode</span><span class="hljs-subst">&gt;</span>ASYNCHRONOUS<span class="hljs-subst">&lt;</span>/event<span class="hljs-attribute">-firing</span><span class="hljs-attribute">-mode</span><span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>event<span class="hljs-attribute">-ordering</span><span class="hljs-attribute">-mode</span><span class="hljs-subst">&gt;</span>UNORDERED<span class="hljs-subst">&lt;</span>/event<span class="hljs-attribute">-ordering</span><span class="hljs-attribute">-mode</span><span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>CREATED<span class="hljs-subst">&lt;</span>/events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>UPDATED<span class="hljs-subst">&lt;</span>/events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>EXPIRED<span class="hljs-subst">&lt;</span>/events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>REMOVED<span class="hljs-subst">&lt;</span>/events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>
                <span class="hljs-subst">&lt;</span>events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>EVICTED<span class="hljs-subst">&lt;</span>/events<span class="hljs-attribute">-to</span><span class="hljs-attribute">-fire</span><span class="hljs-attribute">-on</span><span class="hljs-subst">&gt;</span>
            <span class="hljs-subst">&lt;</span>/listener<span class="hljs-subst">&gt;</span>
        <span class="hljs-subst">&lt;</span>/listeners<span class="hljs-subst">&gt;</span>
        <span class="hljs-subst">&lt;</span>resources<span class="hljs-subst">&gt;</span>
            <span class="hljs-subst">&lt;</span>heap unit<span class="hljs-subst">=</span><span class="hljs-string">"entries"</span><span class="hljs-subst">&gt;</span><span class="hljs-number">2000</span><span class="hljs-subst">&lt;</span>/heap<span class="hljs-subst">&gt;</span>
            <span class="hljs-subst">&lt;</span>offheap unit<span class="hljs-subst">=</span><span class="hljs-string">"MB"</span><span class="hljs-subst">&gt;</span><span class="hljs-number">100</span><span class="hljs-subst">&lt;</span>/offheap<span class="hljs-subst">&gt;</span>
        <span class="hljs-subst">&lt;</span>/resources<span class="hljs-subst">&gt;</span>
    <span class="hljs-subst">&lt;</span>/<span class="hljs-keyword">cache</span><span class="hljs-attribute">-template</span><span class="hljs-subst">&gt;</span>
<span class="hljs-subst">&lt;</span>/config<span class="hljs-subst">&gt;</span></code></pre> 
  <p>3、添加log监听类</p> 
  <pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> com.cml.springboot.framework.cache3;

<span class="hljs-keyword">import</span> org.ehcache.event.CacheEvent;
<span class="hljs-keyword">import</span> org.ehcache.event.CacheEventListener;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-javadoc">/** * * <span class="hljs-javadoctag">@author</span> GGIB */</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventLogger</span> <span class="hljs-title">implements</span> <span class="hljs-title">CacheEventListener</span>&lt;<span class="hljs-title">Object</span>, <span class="hljs-title">Object</span>&gt; {</span>

    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(EventLogger.<span class="hljs-keyword">class</span>);

    <span class="hljs-annotation">@Override</span>
    public void onEvent(CacheEvent&lt;? <span class="hljs-keyword">extends</span> Object, ? <span class="hljs-keyword">extends</span> Object&gt; event) {

        LOGGER.info(<span class="hljs-string">"Event: "</span> + event.getType() + <span class="hljs-string">" Key: "</span> + event.getKey() + <span class="hljs-string">" old value: "</span> + event.getOldValue()
                + <span class="hljs-string">" new value: "</span> + event.getNewValue());

    }

}</code></pre> 
  <p>4、添加cache配置类，这里添加cacheName为people</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.cml</span><span class="hljs-preprocessor">.springboot</span><span class="hljs-preprocessor">.framework</span><span class="hljs-preprocessor">.cache</span>3<span class="hljs-comment">;</span>

import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.TimeUnit</span><span class="hljs-comment">;</span>

import javax<span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.CacheManager</span><span class="hljs-comment">;</span>
import javax<span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.configuration</span><span class="hljs-preprocessor">.MutableConfiguration</span><span class="hljs-comment">;</span>
import javax<span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.expiry</span><span class="hljs-preprocessor">.Duration</span><span class="hljs-comment">;</span>
import javax<span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.expiry</span><span class="hljs-preprocessor">.TouchedExpiryPolicy</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.ehcache</span><span class="hljs-preprocessor">.spi</span><span class="hljs-preprocessor">.loaderwriter</span><span class="hljs-preprocessor">.CacheLoaderWriter</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.boot</span><span class="hljs-preprocessor">.autoconfigure</span><span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.JCacheManagerCustomizer</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.stereotype</span><span class="hljs-preprocessor">.Component</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.servlet</span><span class="hljs-preprocessor">.mvc</span><span class="hljs-preprocessor">.condition</span><span class="hljs-preprocessor">.ProducesRequestCondition</span><span class="hljs-comment">;</span>

@Component
public class Ehcache3Config implements JCacheManagerCustomizer {

    private static final String NAME_CACHE = <span class="hljs-string">"people"</span><span class="hljs-comment">;</span>

    @Override
    public void customize(CacheManager cacheManager) {
        cacheManager<span class="hljs-preprocessor">.createCache</span>(NAME_CACHE,
                new MutableConfiguration&lt;&gt;()
                        <span class="hljs-preprocessor">.setExpiryPolicyFactory</span>(TouchedExpiryPolicy<span class="hljs-preprocessor">.factoryOf</span>(new Duration(TimeUnit<span class="hljs-preprocessor">.SECONDS</span>, <span class="hljs-number">10</span>)))
                        <span class="hljs-preprocessor">.setStoreByValue</span>(true)<span class="hljs-preprocessor">.setStatisticsEnabled</span>(true))<span class="hljs-comment">;</span>
    }

}
</code></pre> 
  <p>按照上述步骤配置即可，然后添加单元测试，可以从log上看出缓存是否使用到了。</p> 
  <p>单元测试类 com.cml.springboot.cache.Ehcache3Test <br> 测试结果：</p> 
  <pre class="prettyprint"><code class=" hljs cs">====================================================
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">05.732</span>  INFO <span class="hljs-number">41240</span> --- [           main] o.s.t.web.servlet.TestDispatcherServlet  : FrameworkServlet <span class="hljs-string">''</span>: initialization completed <span class="hljs-keyword">in</span> <span class="hljs-number">1120</span> ms
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.213</span>  INFO <span class="hljs-number">41240</span> --- [           main] o.s.s.c.ThreadPoolTaskScheduler          : Initializing ExecutorService  <span class="hljs-string">'taskScheduler'</span>
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.562</span>  INFO <span class="hljs-number">41240</span> --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans <span class="hljs-keyword">in</span> phase <span class="hljs-number">0</span>
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.563</span>  INFO <span class="hljs-number">41240</span> --- [           main] o.s.i.endpoint.EventDrivenConsumer       : Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} <span class="hljs-keyword">as</span> a subscriber to the <span class="hljs-string">'errorChannel'</span> channel
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.563</span>  INFO <span class="hljs-number">41240</span> --- [           main] o.s.i.channel.PublishSubscribeChannel    : Channel <span class="hljs-string">'application:-1.errorChannel'</span> has <span class="hljs-number">1</span> subscriber(s).
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.563</span>  INFO <span class="hljs-number">41240</span> --- [           main] o.s.i.endpoint.EventDrivenConsumer       : started _org.springframework.integration.errorLogger
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.579</span>  INFO <span class="hljs-number">41240</span> --- [           main] com.cml.springboot.cache3.Ehcache3Test   : Started Ehcache3Test <span class="hljs-keyword">in</span> <span class="hljs-number">7.565</span> seconds (JVM running <span class="hljs-keyword">for</span> <span class="hljs-number">8.36</span>)
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.886</span>  INFO <span class="hljs-number">41240</span> --- [           main] c.c.s.s.service.impl.UserServiceImpl     : ====================read user <span class="hljs-keyword">from</span> db=========
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.938</span>  INFO <span class="hljs-number">41240</span> --- [           main] c.c.s.sample.controller.CacheController  : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=<span class="hljs-keyword">null</span>, password=<span class="hljs-keyword">null</span>, token=C78CE23552BC46328959C8C0AE391886, newToken=<span class="hljs-keyword">null</span>, userId=<span class="hljs-number">1</span>, birthday=<span class="hljs-number">1987</span>-<span class="hljs-number">02</span>-<span class="hljs-number">27</span>T00:<span class="hljs-number">00</span>:<span class="hljs-number">00.000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span>, nickName=小明<span class="hljs-number">22</span>]
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.938</span>  INFO <span class="hljs-number">41240</span> --- [hcache [<span class="hljs-keyword">null</span>]-<span class="hljs-number">0</span>] c.c.s.framework.cache3.EventLogger       : Event: CREATED Key: C78CE23552BC46328959C8C0AE391886 old <span class="hljs-keyword">value</span>: <span class="hljs-keyword">null</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">value</span>: User [username=<span class="hljs-keyword">null</span>, password=<span class="hljs-keyword">null</span>, token=C78CE23552BC46328959C8C0AE391886, newToken=<span class="hljs-keyword">null</span>, userId=<span class="hljs-number">1</span>, birthday=<span class="hljs-number">1987</span>-<span class="hljs-number">02</span>-<span class="hljs-number">27</span>T00:<span class="hljs-number">00</span>:<span class="hljs-number">00.000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span>, nickName=小明<span class="hljs-number">22</span>]
==============================
{<span class="hljs-string">"code"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"user"</span>:{<span class="hljs-string">"token"</span>:<span class="hljs-string">"C78CE23552BC46328959C8C0AE391886"</span>,<span class="hljs-string">"userId"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"birthday"</span>:<span class="hljs-string">"19870227000000"</span>,<span class="hljs-string">"nickName"</span>:<span class="hljs-string">"小明22"</span>}}
=====================read data second==========================
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.022</span>  INFO <span class="hljs-number">41240</span> --- [           main] c.c.s.sample.controller.CacheController  : read data token=C78CE23552BC46328959C8C0AE391886,user:User [username=<span class="hljs-keyword">null</span>, password=<span class="hljs-keyword">null</span>, token=C78CE23552BC46328959C8C0AE391886, newToken=<span class="hljs-keyword">null</span>, userId=<span class="hljs-number">1</span>, birthday=<span class="hljs-number">1987</span>-<span class="hljs-number">02</span>-<span class="hljs-number">27</span>T00:<span class="hljs-number">00</span>:<span class="hljs-number">00.000</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span>, nickName=小明<span class="hljs-number">22</span>]
==============================
{<span class="hljs-string">"code"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"user"</span>:{<span class="hljs-string">"token"</span>:<span class="hljs-string">"C78CE23552BC46328959C8C0AE391886"</span>,<span class="hljs-string">"userId"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"birthday"</span>:<span class="hljs-string">"19870227000000"</span>,<span class="hljs-string">"nickName"</span>:<span class="hljs-string">"小明22"</span>}}
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.031</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] o.s.w.c.s.GenericWebApplicationContext   : Closing org.springframework.web.context.support.GenericWebApplicationContext@<span class="hljs-number">17</span>f62e33: startup date [Sat Jan <span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">29</span>:<span class="hljs-number">59</span> CST <span class="hljs-number">2017</span>]; root of context hierarchy
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.035</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] o.s.c.support.DefaultLifecycleProcessor  : Stopping beans <span class="hljs-keyword">in</span> phase <span class="hljs-number">0</span>
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.036</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] o.s.i.endpoint.EventDrivenConsumer       : Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} <span class="hljs-keyword">as</span> a subscriber to the <span class="hljs-string">'errorChannel'</span> channel
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.036</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] o.s.i.channel.PublishSubscribeChannel    : Channel <span class="hljs-string">'application:-1.errorChannel'</span> has <span class="hljs-number">0</span> subscriber(s).
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.037</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] o.s.i.endpoint.EventDrivenConsumer       : stopped _org.springframework.integration.errorLogger
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.038</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] o.s.s.c.ThreadPoolTaskScheduler          : Shutting down ExecutorService <span class="hljs-string">'taskScheduler'</span>
<span class="hljs-number">2017</span>-<span class="hljs-number">01</span>-<span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.061</span>  INFO <span class="hljs-number">41240</span> --- [       Thread-<span class="hljs-number">2</span>] org.ehcache.core.EhcacheManager          : Cache <span class="hljs-string">'people'</span> removed <span class="hljs-keyword">from</span> EhcacheManager.</code></pre> 
  <p><strong>注：工程上分支branch-ehcache为ehcache2版本的配置。</strong></p> 
  <p><strong>步骤4只配置了内存缓存，至于文件缓存以及配置需要年后再研究，欢迎补充！</strong></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7b4cdcb592.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hyperledger fabric的链码接口整理 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hyperledger fabric的链码接口整理" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1.Chaincode接口必须被所有的链上代码实现,fabric运行交易通过调用这些指定的函数 // 在容器建立连接之后再部署交易期间调用Init函数，准许链上代码初始化内部数据 &nbsp;&nbsp;&nbsp;&nbsp;Init(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// 每次调用交易都会调用Invoke接口. 链上代码可能会改变状态变量 &nbsp;&nbsp;&nbsp;&nbsp;Invoke(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// 查询交易时调用Query接口. 链上代码仅仅读（而不是修改）它的状态变量并其返回结果 &nbsp;&nbsp;&nbsp;&nbsp;Query(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) } 2. ChaincodeStubInterface用来部署链上代码apps来进入和修改他们的账本 type ChaincodeStubInterface interface { &nbsp;&nbsp;&nbsp;&nbsp;// Get the arguments to the stub call as a 2D byte array &nbsp;&nbsp;&nbsp;&nbsp;// 获取stub调用的参数来作为一个2维字节数组 &nbsp;&nbsp;&nbsp;&nbsp;GetArgs() [][]byte &nbsp;&nbsp;&nbsp;&nbsp;// Get the arguments to the stub call as a string array &nbsp;&nbsp;&nbsp;&nbsp;// 获取stub调用的参数来作为一个字符数组 &nbsp;&nbsp;&nbsp;&nbsp;GetStringArgs() []string &nbsp;&nbsp;&nbsp;&nbsp;// 获取交易的ID &nbsp;&nbsp;&nbsp;&nbsp;GetTxID() string &nbsp;&nbsp;&nbsp;&nbsp;// InvokeChaincode 本地调用指定的链上代码，`Invoke`使用相同的交易，也就说链上代码调用 &nbsp;&nbsp;&nbsp;&nbsp;// 链上代码不会创建一个新的交易消息 &nbsp;&nbsp;&nbsp;&nbsp;InvokeChaincode(chaincodeName string, args [][]byte) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// InvokeChaincode 本地调用指定的链上代码，`Query`使用相同的交易，也就说链上代码调用 &nbsp;&nbsp;&nbsp;&nbsp;// 链上代码不会创建一个新的交易消息 &nbsp;&nbsp;&nbsp;&nbsp;QueryChaincode(chaincodeName string, args [][]byte) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetState通过Key来返回数组的特定值 &nbsp;&nbsp;&nbsp;&nbsp;GetState(key string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// PutState向账本中写入特定的键和值 &nbsp;&nbsp;&nbsp;&nbsp;PutState(key string, value []byte) error &nbsp;&nbsp;&nbsp;&nbsp;// DelState从账本中移除指定的键和值 &nbsp;&nbsp;&nbsp;&nbsp;DelState(key string) error &nbsp;&nbsp;&nbsp;&nbsp;// RangeQueryState函数可以通过chaincode调用来查询状态范围内的键。假设startKey和endKey &nbsp;&nbsp;&nbsp;&nbsp;// 在词典中，将返回一个迭代器，它可以用来遍历startKey和endKey之间的所有键。 &nbsp;&nbsp;&nbsp;&nbsp;// 迭代器返回键的顺序是随机的。 &nbsp;&nbsp;&nbsp;&nbsp;RangeQueryState(startKey, endKey string) (StateRangeQueryIteratorInterface, error) &nbsp;&nbsp;&nbsp;&nbsp;// CreateTable创建一张新表，给出表名和列定义 &nbsp;&nbsp;&nbsp;&nbsp;CreateTable(name string, columnDefinitions []*ColumnDefinition) error &nbsp;&nbsp;&nbsp;&nbsp;// GetTable如果表存在，返回指定的一张表，如果表不存在ErrTableNotFound错误 &nbsp;&nbsp;&nbsp;&nbsp;GetTable(tableName string) (*Table, error) &nbsp;&nbsp;&nbsp;&nbsp;// DeleteTable删除表和实体相关的所有行 &nbsp;&nbsp;&nbsp;&nbsp;DeleteTable(tableName string) error &nbsp;&nbsp;&nbsp;&nbsp;// InsertRow 插入一个新行进入指定的表 &nbsp;&nbsp;&nbsp;&nbsp;// 返回 - &nbsp;&nbsp;&nbsp;&nbsp;// 如果行成功插入返回true和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果已经存在给定的行就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果指定的表名不存在返回false和TableNotFoundError &nbsp;&nbsp;&nbsp;&nbsp;// 如果出现一个没有预料到的错误条件返回false和error &nbsp;&nbsp;&nbsp;&nbsp;InsertRow(tableName string, row Row) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// ReplaceRow 在指定的表中更新行. &nbsp;&nbsp;&nbsp;&nbsp;// 返回 - &nbsp;&nbsp;&nbsp;&nbsp;// 如果行成功更新就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果给出的行不存在相应的键就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果指定的表名不存在返回false和TableNotFoundError &nbsp;&nbsp;&nbsp;&nbsp;// 如果出现一个没有预料到的错误条件返回false和error &nbsp;&nbsp;&nbsp;&nbsp;ReplaceRow(tableName string, row Row) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// 通过键从指定的表中获取行 &nbsp;&nbsp;&nbsp;&nbsp;GetRow(tableName string, key []Column) (Row, error) &nbsp;&nbsp;&nbsp;&nbsp;// 基于特定的key来返回多行。例如，给出表| A | B | C | D |，A,C和D是键，可以使用[A，C]调用GetRows来返回所有具有A， &nbsp;&nbsp;&nbsp;&nbsp;// C和任何D值的行作为它们的键。 GetRows也可以用A调用，返回所有具有A和C和D作为其键值的行。 &nbsp;&nbsp;&nbsp;&nbsp;GetRows(tableName string, key []Column) (&lt;-chan Row, error) &nbsp;&nbsp;&nbsp;&nbsp;//DeleteRow从指定的表中通过key来删除特定的行 &nbsp;&nbsp;&nbsp;&nbsp;DeleteRow(tableName string, key []Column) error &nbsp;&nbsp;&nbsp;&nbsp;// ReadCertAttribute用来从交易证书中读取指定的属性 &nbsp;&nbsp;&nbsp;&nbsp;// *attributeName* 是这个函数的入参. &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// attrValue,error:=stub.ReadCertAttribute(&quot;position&quot;) &nbsp;&nbsp;&nbsp;&nbsp;ReadCertAttribute(attributeName string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifyAttribute用于验证事务证书是否具有名称为* attribute Name *和value * attributeValue *的属性， &nbsp;&nbsp;&nbsp;&nbsp;// attributeName和attributeValue是此函数接收的输入参数 &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// containsAttr, error := stub.VerifyAttribute(&quot;position&quot;, &quot;Software Engineer&quot;) &nbsp;&nbsp;&nbsp;&nbsp;VerifyAttribute(attributeName string, attributeValue []byte) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifyAttributes与VerifyAttribute相同，但它检查属性列表及其相应的值，而不是单个属性/值对 &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// containsAttrs, error:= stub.VerifyAttributes(&amp;attr.Attribute{&quot;position&quot;, &quot;Software Engineer&quot;}, &amp;attr.Attribute{&quot;company&quot;, &quot;ACompany&quot;}) &nbsp;&nbsp;&nbsp;&nbsp;VerifyAttributes(attrs ...*attr.Attribute) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifySignature核实交易的签名，如果正确返回true,否则返回false &nbsp;&nbsp;&nbsp;&nbsp;VerifySignature(certificate, signature, message []byte) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetCallerCertificate 返回调用者证书 &nbsp;&nbsp;&nbsp;&nbsp;GetCallerCertificate() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetCallerMetadata 返回调用方元数据 &nbsp;&nbsp;&nbsp;&nbsp;GetCallerMetadata() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetBinding 返回交易捆绑 &nbsp;&nbsp;&nbsp;&nbsp;GetBinding() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetPayload 返回交易的payload, payload是一个定义在fabric/protos/chaincode.proto &nbsp;&nbsp;&nbsp;&nbsp;// 中的ChaincodeSpecwhich &nbsp;&nbsp;&nbsp;&nbsp;GetPayload() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetTxTimestamp返回交易创建的时间戳，这个时间戳是peer收到交易的当前时间。 &nbsp;&nbsp;&nbsp;&nbsp;// 请注意，此时间戳可能与其他对等端peer的时间不同 &nbsp;&nbsp;&nbsp;&nbsp;GetTxTimestamp() (*timestamp.Timestamp, error) &nbsp;&nbsp;&nbsp;&nbsp;// SetEvent保存当交易组成一个块时要发送的事件 &nbsp;&nbsp;&nbsp;&nbsp;SetEvent(name string, payload []byte) error } 3.StateRangeQueryIteratorInterface允许在一个链上代码在状态上迭代一定范围的键值 type StateRangeQueryIteratorInterface interface { &nbsp;&nbsp;&nbsp;&nbsp;// HasNext如果查询迭代器范围内包含额外的键和值就返回true &nbsp;&nbsp;&nbsp;&nbsp;HasNext() bool &nbsp;&nbsp;&nbsp;&nbsp;// Next在迭代器范围内返回下一个键和值 &nbsp;&nbsp;&nbsp;&nbsp;Next() (string, []byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// Close 关闭范围查询迭代器，当从迭代器中读完被释放资源的时候被调用 &nbsp;&nbsp;&nbsp;&nbsp;Close() error } 4.chaincode_example02解析 package main import ( &nbsp;&nbsp;&nbsp;&nbsp;&quot;errors&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;fmt&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;strconv&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;github.com/hyperledger/fabric/core/chaincode/shim&quot; ) // SimpleChaincode 样例链上代码实现 type SimpleChaincode struct { } func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;var A, B string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var Aval, Bval int // 资产持股 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 4&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;// 初始化链上代码 &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;Aval, err = strconv.Atoi(args[1]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Expecting integer value for asset holding&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;B = args[2] &nbsp;&nbsp;&nbsp;&nbsp;Bval, err = strconv.Atoi(args[3]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Expecting integer value for asset holding&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Aval = %d, Bval = %d\n&quot;, Aval, Bval) &nbsp;&nbsp;&nbsp;&nbsp;// 写状态到账本 &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(A, []byte(strconv.Itoa(Aval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(B, []byte(strconv.Itoa(Bval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // 支持从A到B支付X股 func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if function == &quot;delete&quot; { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Deletes an entity from its state &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 从他的状态中删除entity &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return t.delete(stub, args) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;var A, B string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var Aval, Bval int // 持股资产 &nbsp;&nbsp;&nbsp;&nbsp;var X int // 交易值 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 3 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 3&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;B = args[1] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本中获取状态 &nbsp;&nbsp;&nbsp;&nbsp;// TODO: will be nice to have a GetAllState call to ledger &nbsp;&nbsp;&nbsp;&nbsp;Avalbytes, err := stub.GetState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to get state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Avalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Entity not found&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Aval, _ = strconv.Atoi(string(Avalbytes)) &nbsp;&nbsp;&nbsp;&nbsp;Bvalbytes, err := stub.GetState(B) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to get state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Bvalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Entity not found&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Bval, _ = strconv.Atoi(string(Bvalbytes)) &nbsp;&nbsp;&nbsp;&nbsp;// 执行execution &nbsp;&nbsp;&nbsp;&nbsp;X, err = strconv.Atoi(args[2]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Invalid transaction amount, expecting a integer value&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Aval = Aval - X &nbsp;&nbsp;&nbsp;&nbsp;Bval = Bval + X &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Aval = %d, Bval = %d\n&quot;, Aval, Bval) &nbsp;&nbsp;&nbsp;&nbsp;// 写状态到账本 &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(A, []byte(strconv.Itoa(Aval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(B, []byte(strconv.Itoa(Bval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // 从账本中删除实体 func (t *SimpleChaincode) delete(stub shim.ChaincodeStubInterface, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 1 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 1&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A := args[0] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本的状态中删除密钥 &nbsp;&nbsp;&nbsp;&nbsp;err := stub.DelState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to delete state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // Query callback representing the query of a chaincode // Query 查询链上代码 func (t *SimpleChaincode) Query(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if function != &quot;query&quot; { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Invalid query function name. Expecting \&quot;query\&quot;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;var A string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 1 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting name of the person to query&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本中获取状态 &nbsp;&nbsp;&nbsp;&nbsp;Avalbytes, err := stub.GetState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\&quot;Error\&quot;:\&quot;Failed to get state for &quot; + A + &quot;\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Avalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\&quot;Error\&quot;:\&quot;Nil amount for &quot; + A + &quot;\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\&quot;Name\&quot;:\&quot;&quot; + A + &quot;\&quot;,\&quot;Amount\&quot;:\&quot;&quot; + string(Avalbytes) + &quot;\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Query Response:%s\n&quot;, jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;return Avalbytes, nil } func main() { &nbsp;&nbsp;&nbsp;&nbsp;// ChainCode 调用 err := shim.Start(new(SimpleChaincode)) &nbsp;&nbsp;&nbsp;&nbsp;// 接入到ChainCodeSupportServer &nbsp;&nbsp;&nbsp;&nbsp;err := shim.Start(new(SimpleChaincode)) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err) &nbsp;&nbsp;&nbsp;&nbsp;} } 阅读更多" />
<meta property="og:description" content="1.Chaincode接口必须被所有的链上代码实现,fabric运行交易通过调用这些指定的函数 // 在容器建立连接之后再部署交易期间调用Init函数，准许链上代码初始化内部数据 &nbsp;&nbsp;&nbsp;&nbsp;Init(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// 每次调用交易都会调用Invoke接口. 链上代码可能会改变状态变量 &nbsp;&nbsp;&nbsp;&nbsp;Invoke(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// 查询交易时调用Query接口. 链上代码仅仅读（而不是修改）它的状态变量并其返回结果 &nbsp;&nbsp;&nbsp;&nbsp;Query(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) } 2. ChaincodeStubInterface用来部署链上代码apps来进入和修改他们的账本 type ChaincodeStubInterface interface { &nbsp;&nbsp;&nbsp;&nbsp;// Get the arguments to the stub call as a 2D byte array &nbsp;&nbsp;&nbsp;&nbsp;// 获取stub调用的参数来作为一个2维字节数组 &nbsp;&nbsp;&nbsp;&nbsp;GetArgs() [][]byte &nbsp;&nbsp;&nbsp;&nbsp;// Get the arguments to the stub call as a string array &nbsp;&nbsp;&nbsp;&nbsp;// 获取stub调用的参数来作为一个字符数组 &nbsp;&nbsp;&nbsp;&nbsp;GetStringArgs() []string &nbsp;&nbsp;&nbsp;&nbsp;// 获取交易的ID &nbsp;&nbsp;&nbsp;&nbsp;GetTxID() string &nbsp;&nbsp;&nbsp;&nbsp;// InvokeChaincode 本地调用指定的链上代码，`Invoke`使用相同的交易，也就说链上代码调用 &nbsp;&nbsp;&nbsp;&nbsp;// 链上代码不会创建一个新的交易消息 &nbsp;&nbsp;&nbsp;&nbsp;InvokeChaincode(chaincodeName string, args [][]byte) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// InvokeChaincode 本地调用指定的链上代码，`Query`使用相同的交易，也就说链上代码调用 &nbsp;&nbsp;&nbsp;&nbsp;// 链上代码不会创建一个新的交易消息 &nbsp;&nbsp;&nbsp;&nbsp;QueryChaincode(chaincodeName string, args [][]byte) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetState通过Key来返回数组的特定值 &nbsp;&nbsp;&nbsp;&nbsp;GetState(key string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// PutState向账本中写入特定的键和值 &nbsp;&nbsp;&nbsp;&nbsp;PutState(key string, value []byte) error &nbsp;&nbsp;&nbsp;&nbsp;// DelState从账本中移除指定的键和值 &nbsp;&nbsp;&nbsp;&nbsp;DelState(key string) error &nbsp;&nbsp;&nbsp;&nbsp;// RangeQueryState函数可以通过chaincode调用来查询状态范围内的键。假设startKey和endKey &nbsp;&nbsp;&nbsp;&nbsp;// 在词典中，将返回一个迭代器，它可以用来遍历startKey和endKey之间的所有键。 &nbsp;&nbsp;&nbsp;&nbsp;// 迭代器返回键的顺序是随机的。 &nbsp;&nbsp;&nbsp;&nbsp;RangeQueryState(startKey, endKey string) (StateRangeQueryIteratorInterface, error) &nbsp;&nbsp;&nbsp;&nbsp;// CreateTable创建一张新表，给出表名和列定义 &nbsp;&nbsp;&nbsp;&nbsp;CreateTable(name string, columnDefinitions []*ColumnDefinition) error &nbsp;&nbsp;&nbsp;&nbsp;// GetTable如果表存在，返回指定的一张表，如果表不存在ErrTableNotFound错误 &nbsp;&nbsp;&nbsp;&nbsp;GetTable(tableName string) (*Table, error) &nbsp;&nbsp;&nbsp;&nbsp;// DeleteTable删除表和实体相关的所有行 &nbsp;&nbsp;&nbsp;&nbsp;DeleteTable(tableName string) error &nbsp;&nbsp;&nbsp;&nbsp;// InsertRow 插入一个新行进入指定的表 &nbsp;&nbsp;&nbsp;&nbsp;// 返回 - &nbsp;&nbsp;&nbsp;&nbsp;// 如果行成功插入返回true和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果已经存在给定的行就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果指定的表名不存在返回false和TableNotFoundError &nbsp;&nbsp;&nbsp;&nbsp;// 如果出现一个没有预料到的错误条件返回false和error &nbsp;&nbsp;&nbsp;&nbsp;InsertRow(tableName string, row Row) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// ReplaceRow 在指定的表中更新行. &nbsp;&nbsp;&nbsp;&nbsp;// 返回 - &nbsp;&nbsp;&nbsp;&nbsp;// 如果行成功更新就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果给出的行不存在相应的键就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果指定的表名不存在返回false和TableNotFoundError &nbsp;&nbsp;&nbsp;&nbsp;// 如果出现一个没有预料到的错误条件返回false和error &nbsp;&nbsp;&nbsp;&nbsp;ReplaceRow(tableName string, row Row) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// 通过键从指定的表中获取行 &nbsp;&nbsp;&nbsp;&nbsp;GetRow(tableName string, key []Column) (Row, error) &nbsp;&nbsp;&nbsp;&nbsp;// 基于特定的key来返回多行。例如，给出表| A | B | C | D |，A,C和D是键，可以使用[A，C]调用GetRows来返回所有具有A， &nbsp;&nbsp;&nbsp;&nbsp;// C和任何D值的行作为它们的键。 GetRows也可以用A调用，返回所有具有A和C和D作为其键值的行。 &nbsp;&nbsp;&nbsp;&nbsp;GetRows(tableName string, key []Column) (&lt;-chan Row, error) &nbsp;&nbsp;&nbsp;&nbsp;//DeleteRow从指定的表中通过key来删除特定的行 &nbsp;&nbsp;&nbsp;&nbsp;DeleteRow(tableName string, key []Column) error &nbsp;&nbsp;&nbsp;&nbsp;// ReadCertAttribute用来从交易证书中读取指定的属性 &nbsp;&nbsp;&nbsp;&nbsp;// *attributeName* 是这个函数的入参. &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// attrValue,error:=stub.ReadCertAttribute(&quot;position&quot;) &nbsp;&nbsp;&nbsp;&nbsp;ReadCertAttribute(attributeName string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifyAttribute用于验证事务证书是否具有名称为* attribute Name *和value * attributeValue *的属性， &nbsp;&nbsp;&nbsp;&nbsp;// attributeName和attributeValue是此函数接收的输入参数 &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// containsAttr, error := stub.VerifyAttribute(&quot;position&quot;, &quot;Software Engineer&quot;) &nbsp;&nbsp;&nbsp;&nbsp;VerifyAttribute(attributeName string, attributeValue []byte) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifyAttributes与VerifyAttribute相同，但它检查属性列表及其相应的值，而不是单个属性/值对 &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// containsAttrs, error:= stub.VerifyAttributes(&amp;attr.Attribute{&quot;position&quot;, &quot;Software Engineer&quot;}, &amp;attr.Attribute{&quot;company&quot;, &quot;ACompany&quot;}) &nbsp;&nbsp;&nbsp;&nbsp;VerifyAttributes(attrs ...*attr.Attribute) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifySignature核实交易的签名，如果正确返回true,否则返回false &nbsp;&nbsp;&nbsp;&nbsp;VerifySignature(certificate, signature, message []byte) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetCallerCertificate 返回调用者证书 &nbsp;&nbsp;&nbsp;&nbsp;GetCallerCertificate() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetCallerMetadata 返回调用方元数据 &nbsp;&nbsp;&nbsp;&nbsp;GetCallerMetadata() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetBinding 返回交易捆绑 &nbsp;&nbsp;&nbsp;&nbsp;GetBinding() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetPayload 返回交易的payload, payload是一个定义在fabric/protos/chaincode.proto &nbsp;&nbsp;&nbsp;&nbsp;// 中的ChaincodeSpecwhich &nbsp;&nbsp;&nbsp;&nbsp;GetPayload() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetTxTimestamp返回交易创建的时间戳，这个时间戳是peer收到交易的当前时间。 &nbsp;&nbsp;&nbsp;&nbsp;// 请注意，此时间戳可能与其他对等端peer的时间不同 &nbsp;&nbsp;&nbsp;&nbsp;GetTxTimestamp() (*timestamp.Timestamp, error) &nbsp;&nbsp;&nbsp;&nbsp;// SetEvent保存当交易组成一个块时要发送的事件 &nbsp;&nbsp;&nbsp;&nbsp;SetEvent(name string, payload []byte) error } 3.StateRangeQueryIteratorInterface允许在一个链上代码在状态上迭代一定范围的键值 type StateRangeQueryIteratorInterface interface { &nbsp;&nbsp;&nbsp;&nbsp;// HasNext如果查询迭代器范围内包含额外的键和值就返回true &nbsp;&nbsp;&nbsp;&nbsp;HasNext() bool &nbsp;&nbsp;&nbsp;&nbsp;// Next在迭代器范围内返回下一个键和值 &nbsp;&nbsp;&nbsp;&nbsp;Next() (string, []byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// Close 关闭范围查询迭代器，当从迭代器中读完被释放资源的时候被调用 &nbsp;&nbsp;&nbsp;&nbsp;Close() error } 4.chaincode_example02解析 package main import ( &nbsp;&nbsp;&nbsp;&nbsp;&quot;errors&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;fmt&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;strconv&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;github.com/hyperledger/fabric/core/chaincode/shim&quot; ) // SimpleChaincode 样例链上代码实现 type SimpleChaincode struct { } func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;var A, B string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var Aval, Bval int // 资产持股 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 4&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;// 初始化链上代码 &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;Aval, err = strconv.Atoi(args[1]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Expecting integer value for asset holding&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;B = args[2] &nbsp;&nbsp;&nbsp;&nbsp;Bval, err = strconv.Atoi(args[3]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Expecting integer value for asset holding&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Aval = %d, Bval = %d\n&quot;, Aval, Bval) &nbsp;&nbsp;&nbsp;&nbsp;// 写状态到账本 &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(A, []byte(strconv.Itoa(Aval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(B, []byte(strconv.Itoa(Bval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // 支持从A到B支付X股 func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if function == &quot;delete&quot; { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Deletes an entity from its state &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 从他的状态中删除entity &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return t.delete(stub, args) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;var A, B string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var Aval, Bval int // 持股资产 &nbsp;&nbsp;&nbsp;&nbsp;var X int // 交易值 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 3 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 3&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;B = args[1] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本中获取状态 &nbsp;&nbsp;&nbsp;&nbsp;// TODO: will be nice to have a GetAllState call to ledger &nbsp;&nbsp;&nbsp;&nbsp;Avalbytes, err := stub.GetState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to get state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Avalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Entity not found&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Aval, _ = strconv.Atoi(string(Avalbytes)) &nbsp;&nbsp;&nbsp;&nbsp;Bvalbytes, err := stub.GetState(B) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to get state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Bvalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Entity not found&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Bval, _ = strconv.Atoi(string(Bvalbytes)) &nbsp;&nbsp;&nbsp;&nbsp;// 执行execution &nbsp;&nbsp;&nbsp;&nbsp;X, err = strconv.Atoi(args[2]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Invalid transaction amount, expecting a integer value&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Aval = Aval - X &nbsp;&nbsp;&nbsp;&nbsp;Bval = Bval + X &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Aval = %d, Bval = %d\n&quot;, Aval, Bval) &nbsp;&nbsp;&nbsp;&nbsp;// 写状态到账本 &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(A, []byte(strconv.Itoa(Aval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(B, []byte(strconv.Itoa(Bval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // 从账本中删除实体 func (t *SimpleChaincode) delete(stub shim.ChaincodeStubInterface, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 1 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 1&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A := args[0] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本的状态中删除密钥 &nbsp;&nbsp;&nbsp;&nbsp;err := stub.DelState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to delete state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // Query callback representing the query of a chaincode // Query 查询链上代码 func (t *SimpleChaincode) Query(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if function != &quot;query&quot; { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Invalid query function name. Expecting \&quot;query\&quot;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;var A string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 1 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting name of the person to query&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本中获取状态 &nbsp;&nbsp;&nbsp;&nbsp;Avalbytes, err := stub.GetState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\&quot;Error\&quot;:\&quot;Failed to get state for &quot; + A + &quot;\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Avalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\&quot;Error\&quot;:\&quot;Nil amount for &quot; + A + &quot;\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\&quot;Name\&quot;:\&quot;&quot; + A + &quot;\&quot;,\&quot;Amount\&quot;:\&quot;&quot; + string(Avalbytes) + &quot;\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Query Response:%s\n&quot;, jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;return Avalbytes, nil } func main() { &nbsp;&nbsp;&nbsp;&nbsp;// ChainCode 调用 err := shim.Start(new(SimpleChaincode)) &nbsp;&nbsp;&nbsp;&nbsp;// 接入到ChainCodeSupportServer &nbsp;&nbsp;&nbsp;&nbsp;err := shim.Start(new(SimpleChaincode)) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err) &nbsp;&nbsp;&nbsp;&nbsp;} } 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/01/13/80773b54286ffee953879f6843e23816.html" />
<meta property="og:url" content="https://mlh.app/2017/01/13/80773b54286ffee953879f6843e23816.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-01-13T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1.Chaincode接口必须被所有的链上代码实现,fabric运行交易通过调用这些指定的函数 // 在容器建立连接之后再部署交易期间调用Init函数，准许链上代码初始化内部数据 &nbsp;&nbsp;&nbsp;&nbsp;Init(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// 每次调用交易都会调用Invoke接口. 链上代码可能会改变状态变量 &nbsp;&nbsp;&nbsp;&nbsp;Invoke(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// 查询交易时调用Query接口. 链上代码仅仅读（而不是修改）它的状态变量并其返回结果 &nbsp;&nbsp;&nbsp;&nbsp;Query(stub ChaincodeStubInterface, function string, args []string) ([]byte, error) } 2. ChaincodeStubInterface用来部署链上代码apps来进入和修改他们的账本 type ChaincodeStubInterface interface { &nbsp;&nbsp;&nbsp;&nbsp;// Get the arguments to the stub call as a 2D byte array &nbsp;&nbsp;&nbsp;&nbsp;// 获取stub调用的参数来作为一个2维字节数组 &nbsp;&nbsp;&nbsp;&nbsp;GetArgs() [][]byte &nbsp;&nbsp;&nbsp;&nbsp;// Get the arguments to the stub call as a string array &nbsp;&nbsp;&nbsp;&nbsp;// 获取stub调用的参数来作为一个字符数组 &nbsp;&nbsp;&nbsp;&nbsp;GetStringArgs() []string &nbsp;&nbsp;&nbsp;&nbsp;// 获取交易的ID &nbsp;&nbsp;&nbsp;&nbsp;GetTxID() string &nbsp;&nbsp;&nbsp;&nbsp;// InvokeChaincode 本地调用指定的链上代码，`Invoke`使用相同的交易，也就说链上代码调用 &nbsp;&nbsp;&nbsp;&nbsp;// 链上代码不会创建一个新的交易消息 &nbsp;&nbsp;&nbsp;&nbsp;InvokeChaincode(chaincodeName string, args [][]byte) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// InvokeChaincode 本地调用指定的链上代码，`Query`使用相同的交易，也就说链上代码调用 &nbsp;&nbsp;&nbsp;&nbsp;// 链上代码不会创建一个新的交易消息 &nbsp;&nbsp;&nbsp;&nbsp;QueryChaincode(chaincodeName string, args [][]byte) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetState通过Key来返回数组的特定值 &nbsp;&nbsp;&nbsp;&nbsp;GetState(key string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// PutState向账本中写入特定的键和值 &nbsp;&nbsp;&nbsp;&nbsp;PutState(key string, value []byte) error &nbsp;&nbsp;&nbsp;&nbsp;// DelState从账本中移除指定的键和值 &nbsp;&nbsp;&nbsp;&nbsp;DelState(key string) error &nbsp;&nbsp;&nbsp;&nbsp;// RangeQueryState函数可以通过chaincode调用来查询状态范围内的键。假设startKey和endKey &nbsp;&nbsp;&nbsp;&nbsp;// 在词典中，将返回一个迭代器，它可以用来遍历startKey和endKey之间的所有键。 &nbsp;&nbsp;&nbsp;&nbsp;// 迭代器返回键的顺序是随机的。 &nbsp;&nbsp;&nbsp;&nbsp;RangeQueryState(startKey, endKey string) (StateRangeQueryIteratorInterface, error) &nbsp;&nbsp;&nbsp;&nbsp;// CreateTable创建一张新表，给出表名和列定义 &nbsp;&nbsp;&nbsp;&nbsp;CreateTable(name string, columnDefinitions []*ColumnDefinition) error &nbsp;&nbsp;&nbsp;&nbsp;// GetTable如果表存在，返回指定的一张表，如果表不存在ErrTableNotFound错误 &nbsp;&nbsp;&nbsp;&nbsp;GetTable(tableName string) (*Table, error) &nbsp;&nbsp;&nbsp;&nbsp;// DeleteTable删除表和实体相关的所有行 &nbsp;&nbsp;&nbsp;&nbsp;DeleteTable(tableName string) error &nbsp;&nbsp;&nbsp;&nbsp;// InsertRow 插入一个新行进入指定的表 &nbsp;&nbsp;&nbsp;&nbsp;// 返回 - &nbsp;&nbsp;&nbsp;&nbsp;// 如果行成功插入返回true和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果已经存在给定的行就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果指定的表名不存在返回false和TableNotFoundError &nbsp;&nbsp;&nbsp;&nbsp;// 如果出现一个没有预料到的错误条件返回false和error &nbsp;&nbsp;&nbsp;&nbsp;InsertRow(tableName string, row Row) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// ReplaceRow 在指定的表中更新行. &nbsp;&nbsp;&nbsp;&nbsp;// 返回 - &nbsp;&nbsp;&nbsp;&nbsp;// 如果行成功更新就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果给出的行不存在相应的键就返回false和no error &nbsp;&nbsp;&nbsp;&nbsp;// 如果指定的表名不存在返回false和TableNotFoundError &nbsp;&nbsp;&nbsp;&nbsp;// 如果出现一个没有预料到的错误条件返回false和error &nbsp;&nbsp;&nbsp;&nbsp;ReplaceRow(tableName string, row Row) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// 通过键从指定的表中获取行 &nbsp;&nbsp;&nbsp;&nbsp;GetRow(tableName string, key []Column) (Row, error) &nbsp;&nbsp;&nbsp;&nbsp;// 基于特定的key来返回多行。例如，给出表| A | B | C | D |，A,C和D是键，可以使用[A，C]调用GetRows来返回所有具有A， &nbsp;&nbsp;&nbsp;&nbsp;// C和任何D值的行作为它们的键。 GetRows也可以用A调用，返回所有具有A和C和D作为其键值的行。 &nbsp;&nbsp;&nbsp;&nbsp;GetRows(tableName string, key []Column) (&lt;-chan Row, error) &nbsp;&nbsp;&nbsp;&nbsp;//DeleteRow从指定的表中通过key来删除特定的行 &nbsp;&nbsp;&nbsp;&nbsp;DeleteRow(tableName string, key []Column) error &nbsp;&nbsp;&nbsp;&nbsp;// ReadCertAttribute用来从交易证书中读取指定的属性 &nbsp;&nbsp;&nbsp;&nbsp;// *attributeName* 是这个函数的入参. &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// attrValue,error:=stub.ReadCertAttribute(&quot;position&quot;) &nbsp;&nbsp;&nbsp;&nbsp;ReadCertAttribute(attributeName string) ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifyAttribute用于验证事务证书是否具有名称为* attribute Name *和value * attributeValue *的属性， &nbsp;&nbsp;&nbsp;&nbsp;// attributeName和attributeValue是此函数接收的输入参数 &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// containsAttr, error := stub.VerifyAttribute(&quot;position&quot;, &quot;Software Engineer&quot;) &nbsp;&nbsp;&nbsp;&nbsp;VerifyAttribute(attributeName string, attributeValue []byte) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifyAttributes与VerifyAttribute相同，但它检查属性列表及其相应的值，而不是单个属性/值对 &nbsp;&nbsp;&nbsp;&nbsp;// 例如: &nbsp;&nbsp;&nbsp;&nbsp;// containsAttrs, error:= stub.VerifyAttributes(&amp;attr.Attribute{&quot;position&quot;, &quot;Software Engineer&quot;}, &amp;attr.Attribute{&quot;company&quot;, &quot;ACompany&quot;}) &nbsp;&nbsp;&nbsp;&nbsp;VerifyAttributes(attrs ...*attr.Attribute) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// VerifySignature核实交易的签名，如果正确返回true,否则返回false &nbsp;&nbsp;&nbsp;&nbsp;VerifySignature(certificate, signature, message []byte) (bool, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetCallerCertificate 返回调用者证书 &nbsp;&nbsp;&nbsp;&nbsp;GetCallerCertificate() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetCallerMetadata 返回调用方元数据 &nbsp;&nbsp;&nbsp;&nbsp;GetCallerMetadata() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetBinding 返回交易捆绑 &nbsp;&nbsp;&nbsp;&nbsp;GetBinding() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetPayload 返回交易的payload, payload是一个定义在fabric/protos/chaincode.proto &nbsp;&nbsp;&nbsp;&nbsp;// 中的ChaincodeSpecwhich &nbsp;&nbsp;&nbsp;&nbsp;GetPayload() ([]byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// GetTxTimestamp返回交易创建的时间戳，这个时间戳是peer收到交易的当前时间。 &nbsp;&nbsp;&nbsp;&nbsp;// 请注意，此时间戳可能与其他对等端peer的时间不同 &nbsp;&nbsp;&nbsp;&nbsp;GetTxTimestamp() (*timestamp.Timestamp, error) &nbsp;&nbsp;&nbsp;&nbsp;// SetEvent保存当交易组成一个块时要发送的事件 &nbsp;&nbsp;&nbsp;&nbsp;SetEvent(name string, payload []byte) error } 3.StateRangeQueryIteratorInterface允许在一个链上代码在状态上迭代一定范围的键值 type StateRangeQueryIteratorInterface interface { &nbsp;&nbsp;&nbsp;&nbsp;// HasNext如果查询迭代器范围内包含额外的键和值就返回true &nbsp;&nbsp;&nbsp;&nbsp;HasNext() bool &nbsp;&nbsp;&nbsp;&nbsp;// Next在迭代器范围内返回下一个键和值 &nbsp;&nbsp;&nbsp;&nbsp;Next() (string, []byte, error) &nbsp;&nbsp;&nbsp;&nbsp;// Close 关闭范围查询迭代器，当从迭代器中读完被释放资源的时候被调用 &nbsp;&nbsp;&nbsp;&nbsp;Close() error } 4.chaincode_example02解析 package main import ( &nbsp;&nbsp;&nbsp;&nbsp;&quot;errors&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;fmt&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;strconv&quot; &nbsp;&nbsp;&nbsp;&nbsp;&quot;github.com/hyperledger/fabric/core/chaincode/shim&quot; ) // SimpleChaincode 样例链上代码实现 type SimpleChaincode struct { } func (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;var A, B string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var Aval, Bval int // 资产持股 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 4 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 4&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;// 初始化链上代码 &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;Aval, err = strconv.Atoi(args[1]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Expecting integer value for asset holding&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;B = args[2] &nbsp;&nbsp;&nbsp;&nbsp;Bval, err = strconv.Atoi(args[3]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Expecting integer value for asset holding&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Aval = %d, Bval = %d\\n&quot;, Aval, Bval) &nbsp;&nbsp;&nbsp;&nbsp;// 写状态到账本 &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(A, []byte(strconv.Itoa(Aval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(B, []byte(strconv.Itoa(Bval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // 支持从A到B支付X股 func (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if function == &quot;delete&quot; { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Deletes an entity from its state &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 从他的状态中删除entity &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return t.delete(stub, args) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;var A, B string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var Aval, Bval int // 持股资产 &nbsp;&nbsp;&nbsp;&nbsp;var X int // 交易值 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 3 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 3&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;B = args[1] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本中获取状态 &nbsp;&nbsp;&nbsp;&nbsp;// TODO: will be nice to have a GetAllState call to ledger &nbsp;&nbsp;&nbsp;&nbsp;Avalbytes, err := stub.GetState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to get state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Avalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Entity not found&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Aval, _ = strconv.Atoi(string(Avalbytes)) &nbsp;&nbsp;&nbsp;&nbsp;Bvalbytes, err := stub.GetState(B) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to get state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Bvalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Entity not found&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Bval, _ = strconv.Atoi(string(Bvalbytes)) &nbsp;&nbsp;&nbsp;&nbsp;// 执行execution &nbsp;&nbsp;&nbsp;&nbsp;X, err = strconv.Atoi(args[2]) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Invalid transaction amount, expecting a integer value&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;Aval = Aval - X &nbsp;&nbsp;&nbsp;&nbsp;Bval = Bval + X &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Aval = %d, Bval = %d\\n&quot;, Aval, Bval) &nbsp;&nbsp;&nbsp;&nbsp;// 写状态到账本 &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(A, []byte(strconv.Itoa(Aval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;err = stub.PutState(B, []byte(strconv.Itoa(Bval))) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, err &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // 从账本中删除实体 func (t *SimpleChaincode) delete(stub shim.ChaincodeStubInterface, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 1 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting 1&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A := args[0] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本的状态中删除密钥 &nbsp;&nbsp;&nbsp;&nbsp;err := stub.DelState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Failed to delete state&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;return nil, nil } // Query callback representing the query of a chaincode // Query 查询链上代码 func (t *SimpleChaincode) Query(stub shim.ChaincodeStubInterface, function string, args []string) ([]byte, error) { &nbsp;&nbsp;&nbsp;&nbsp;if function != &quot;query&quot; { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Invalid query function name. Expecting \\&quot;query\\&quot;&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;var A string // 字符实体 &nbsp;&nbsp;&nbsp;&nbsp;var err error &nbsp;&nbsp;&nbsp;&nbsp;if len(args) != 1 { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(&quot;Incorrect number of arguments. Expecting name of the person to query&quot;) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;A = args[0] &nbsp;&nbsp;&nbsp;&nbsp;// 从账本中获取状态 &nbsp;&nbsp;&nbsp;&nbsp;Avalbytes, err := stub.GetState(A) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\\&quot;Error\\&quot;:\\&quot;Failed to get state for &quot; + A + &quot;\\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;if Avalbytes == nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\\&quot;Error\\&quot;:\\&quot;Nil amount for &quot; + A + &quot;\\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return nil, errors.New(jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;jsonResp := &quot;{\\&quot;Name\\&quot;:\\&quot;&quot; + A + &quot;\\&quot;,\\&quot;Amount\\&quot;:\\&quot;&quot; + string(Avalbytes) + &quot;\\&quot;}&quot; &nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Query Response:%s\\n&quot;, jsonResp) &nbsp;&nbsp;&nbsp;&nbsp;return Avalbytes, nil } func main() { &nbsp;&nbsp;&nbsp;&nbsp;// ChainCode 调用 err := shim.Start(new(SimpleChaincode)) &nbsp;&nbsp;&nbsp;&nbsp;// 接入到ChainCodeSupportServer &nbsp;&nbsp;&nbsp;&nbsp;err := shim.Start(new(SimpleChaincode)) &nbsp;&nbsp;&nbsp;&nbsp;if err != nil { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err) &nbsp;&nbsp;&nbsp;&nbsp;} } 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/01/13/80773b54286ffee953879f6843e23816.html","headline":"Hyperledger fabric的链码接口整理","dateModified":"2017-01-13T00:00:00+08:00","datePublished":"2017-01-13T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/01/13/80773b54286ffee953879f6843e23816.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Hyperledger fabric的链码接口整理</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><span style="font-size:18px;">1.Chaincode接口必须被所有的链上代码实现,fabric运行交易通过调用这些指定的函数</span></p> 
  <p><span style="font-size:18px;"></span></p> 
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">在容器建立连接之后再部署交易期间调用Init函数，准许链上代码初始化内部数据</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Init<span style="color:#000000;">(</span>stub<span style="color:#c0c0c0;"> </span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">每次调用交易都会调用Invoke接口.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">链上代码可能会改变状态变量</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Invoke<span style="color:#000000;">(</span>stub<span style="color:#c0c0c0;"> </span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">查询交易时调用Query接口.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">链上代码仅仅读（而不是修改）它的状态变量并其返回结果</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Query<span style="color:#000000;">(</span>stub<span style="color:#c0c0c0;"> </span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 2. ChaincodeStubInterface用来部署链上代码apps来进入和修改他们的账本 
  <p></p> 
  <p><span style="font-size:18px;"></span></p> 
  <pre><span style="color:#000080;font-weight:600;">type</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">ChaincodeStubInterface</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;font-weight:600;">interface</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Get</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">arguments</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">stub</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">call</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">as</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">2D</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">byte</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">array</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">获取stub调用的参数来作为一个2维字节数组</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetArgs<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[][]</span><span style="color:#000080;">byte</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Get</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">arguments</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">stub</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">call</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">as</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">string</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">array</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">获取stub调用的参数来作为一个字符数组</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetStringArgs<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">获取交易的ID</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetTxID<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">InvokeChaincode</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">本地调用指定的链上代码，`Invoke`使用相同的交易，也就说链上代码调用</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">链上代码不会创建一个新的交易消息</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>InvokeChaincode<span style="color:#000000;">(</span>chaincodeName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[][]</span><span style="color:#000080;">byte</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">InvokeChaincode</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">本地调用指定的链上代码，`Query`使用相同的交易，也就说链上代码调用</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">链上代码不会创建一个新的交易消息</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>QueryChaincode<span style="color:#000000;">(</span>chaincodeName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[][]</span><span style="color:#000080;">byte</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetState通过Key来返回数组的特定值</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetState<span style="color:#000000;">(</span>key<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">PutState向账本中写入特定的键和值</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>PutState<span style="color:#000000;">(</span>key<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>value<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">DelState从账本中移除指定的键和值</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>DelState<span style="color:#000000;">(</span>key<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">RangeQueryState函数可以通过chaincode调用来查询状态范围内的键。假设startKey和endKey</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">在词典中，将返回一个迭代器，它可以用来遍历startKey和endKey之间的所有键。</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">迭代器返回键的顺序是随机的。</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>RangeQueryState<span style="color:#000000;">(</span>startKey<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>endKey<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span>StateRangeQueryIteratorInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">CreateTable创建一张新表，给出表名和列定义</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>CreateTable<span style="color:#000000;">(</span>name<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>columnDefinitions<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]*</span>ColumnDefinition<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetTable如果表存在，返回指定的一张表，如果表不存在ErrTableNotFound错误</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetTable<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(*</span>Table<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">DeleteTable删除表和实体相关的所有行</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>DeleteTable<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">InsertRow</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">插入一个新行进入指定的表</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">返回</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">-</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果行成功插入返回true和no</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">error</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果已经存在给定的行就返回false和no</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">error</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果指定的表名不存在返回false和TableNotFoundError</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果出现一个没有预料到的错误条件返回false和error</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>InsertRow<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>row<span style="color:#c0c0c0;"> </span>Row<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span><span style="color:#000080;">bool</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">ReplaceRow</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">在指定的表中更新行.</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">返回</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">-</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果行成功更新就返回false和no</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">error</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果给出的行不存在相应的键就返回false和no</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">error</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果指定的表名不存在返回false和TableNotFoundError</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">如果出现一个没有预料到的错误条件返回false和error</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>ReplaceRow<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>row<span style="color:#c0c0c0;"> </span>Row<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span><span style="color:#000080;">bool</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">通过键从指定的表中获取行</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetRow<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>key<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span>Column<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span>Row<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">基于特定的key来返回多行。例如，给出表|</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">A</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">|</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">B</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">|</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">C</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">|</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">D</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">|，A,C和D是键，可以使用[A，C]调用GetRows来返回所有具有A，</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">C和任何D值的行作为它们的键。</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetRows也可以用A调用，返回所有具有A和C和D作为其键值的行。</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetRows<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>key<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span>Column<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(&lt;-</span><span style="color:#000080;font-weight:600;">chan</span><span style="color:#c0c0c0;"> </span>Row<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//DeleteRow从指定的表中通过key来删除特定的行</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>DeleteRow<span style="color:#000000;">(</span>tableName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>key<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span>Column<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">ReadCertAttribute用来从交易证书中读取指定的属性</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">*attributeName*</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">是这个函数的入参.</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">例如:</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;">  </span><span style="color:#008000;">attrValue,error:=stub.ReadCertAttribute("position")</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>ReadCertAttribute<span style="color:#000000;">(</span>attributeName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifyAttribute用于验证事务证书是否具有名称为*</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">attribute</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Name</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">*和value</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">*</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">attributeValue</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">*的属性，</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">attributeName和attributeValue是此函数接收的输入参数</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">例如:</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;">    </span><span style="color:#008000;">containsAttr,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">error</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">:=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">stub.VerifyAttribute("position",</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"Software</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Engineer")</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>VerifyAttribute<span style="color:#000000;">(</span>attributeName<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>attributeValue<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span><span style="color:#000080;">bool</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifyAttributes与VerifyAttribute相同，但它检查属性列表及其相应的值，而不是单个属性/值对</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">例如:</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;">    </span><span style="color:#008000;">containsAttrs,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">error:=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">stub.VerifyAttributes(&amp;attr.Attribute{"position",</span><span style="color:#c0c0c0;">  </span><span style="color:#008000;">"Software</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Engineer"},</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">&amp;attr.Attribute{"company",</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"ACompany"})</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>VerifyAttributes<span style="color:#000000;">(</span>attrs<span style="color:#c0c0c0;"> </span><span style="color:#000000;">...*</span>attr<span style="color:#000000;">.</span>Attribute<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span><span style="color:#000080;">bool</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">VerifySignature核实交易的签名，如果正确返回true,否则返回false</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>VerifySignature<span style="color:#000000;">(</span>certificate<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>signature<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>message<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span><span style="color:#000080;">bool</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetCallerCertificate</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">返回调用者证书</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetCallerCertificate<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetCallerMetadata</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">返回调用方元数据</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetCallerMetadata<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetBinding</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">返回交易捆绑</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetBinding<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetPayload</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">返回交易的payload,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">payload是一个定义在fabric/protos/chaincode.proto</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">中的ChaincodeSpecwhich</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetPayload<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetTxTimestamp返回交易创建的时间戳，这个时间戳是peer收到交易的当前时间。</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">请注意，此时间戳可能与其他对等端peer的时间不同</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>GetTxTimestamp<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(*</span>timestamp<span style="color:#000000;">.</span>Timestamp<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">SetEvent保存当交易组成一个块时要发送的事件</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>SetEvent<span style="color:#000000;">(</span>name<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>payload<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <p></p> 
  <p><span style="font-size:18px;">3.StateRangeQueryIteratorInterface允许在一个链上代码在状态上迭代一定范围的键值</span></p> 
  <p><span style="font-size:18px;"></span></p> 
  <pre><span style="color:#000080;font-weight:600;">type</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">StateRangeQueryIteratorInterface</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;font-weight:600;">interface</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">HasNext如果查询迭代器范围内包含额外的键和值就返回true</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>HasNext<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">bool</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Next在迭代器范围内返回下一个键和值</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Next<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Close</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">关闭范围查询迭代器，当从迭代器中读完被释放资源的时候被调用</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Close<span style="color:#000000;">()</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <p></p> 
  <p><span style="font-size:18px;">4.chaincode_example02解析</span></p> 
  <p><span style="font-size:18px;"></span></p> 
  <pre><span style="color:#000080;font-weight:600;">package</span><span style="color:#c0c0c0;"> </span>main</pre> 
  <pre></pre> 
  <pre></pre> 
  <pre><span style="color:#000080;font-weight:600;">import</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">"errors"</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">"fmt"</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">"strconv"</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">"github.com/hyperledger/fabric/core/chaincode/shim"</span></pre> 
  <pre><span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">SimpleChaincode</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">样例链上代码实现</span></pre> 
  <pre><span style="color:#000080;font-weight:600;">type</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">SimpleChaincode</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;font-weight:600;">struct</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#000080;font-weight:600;">func</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span>t<span style="color:#c0c0c0;"> </span><span style="color:#000000;">*</span><span style="color:#000080;">SimpleChaincode</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">Init(</span>stub<span style="color:#c0c0c0;"> </span>shim<span style="color:#000000;">.</span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>A<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>B<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#c0c0c0;">    </span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">字符实体</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>Aval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>Bval<span style="color:#c0c0c0;"> </span><span style="color:#000080;">int</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">资产持股</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">len</span><span style="color:#000000;">(</span>args<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#800080;">4</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Incorrect</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">number</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">arguments.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">4"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">初始化链上代码</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">[</span><span style="color:#800080;">0</span><span style="color:#000000;">]</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Aval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>strconv<span style="color:#000000;">.</span>Atoi<span style="color:#000000;">(</span>args<span style="color:#000000;">[</span><span style="color:#800080;">1</span><span style="color:#000000;">])</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">integer</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">value</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">for</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">asset</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">holding"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>B<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">[</span><span style="color:#800080;">2</span><span style="color:#000000;">]</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Bval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>strconv<span style="color:#000000;">.</span>Atoi<span style="color:#000000;">(</span>args<span style="color:#000000;">[</span><span style="color:#800080;">3</span><span style="color:#000000;">])</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">integer</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">value</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">for</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">asset</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">holding"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>fmt<span style="color:#000000;">.</span>Printf<span style="color:#000000;">(</span><span style="color:#008000;">"Aval</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">%d,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Bval</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">%d\n"</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>Aval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>Bval<span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">写状态到账本</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>PutState<span style="color:#000000;">(</span>A<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">(</span>strconv<span style="color:#000000;">.</span>Itoa<span style="color:#000000;">(</span>Aval<span style="color:#000000;">)))</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err</pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>PutState<span style="color:#000000;">(</span>B<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">(</span>strconv<span style="color:#000000;">.</span>Itoa<span style="color:#000000;">(</span>Bval<span style="color:#000000;">)))</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err</pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">支持从A到B支付X股</span></pre> 
  <pre><span style="color:#000080;font-weight:600;">func</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span>t<span style="color:#c0c0c0;"> </span><span style="color:#000000;">*</span><span style="color:#000080;">SimpleChaincode</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">Invoke(</span>stub<span style="color:#c0c0c0;"> </span>shim<span style="color:#000000;">.</span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000000;">==</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"delete"</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Deletes</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">an</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">entity</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">from</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">its</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">从他的状态中删除entity</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span>t<span style="color:#000000;">.</span><span style="color:#000080;">delete</span><span style="color:#000000;">(</span>stub<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>A<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>B<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#c0c0c0;">    </span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">字符实体</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>Aval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>Bval<span style="color:#c0c0c0;"> </span><span style="color:#000080;">int</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">持股资产</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>X<span style="color:#c0c0c0;"> </span><span style="color:#000080;">int</span><span style="color:#c0c0c0;">          </span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">交易值</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">len</span><span style="color:#000000;">(</span>args<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#800080;">3</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Incorrect</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">number</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">arguments.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">3"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">[</span><span style="color:#800080;">0</span><span style="color:#000000;">]</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>B<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">[</span><span style="color:#800080;">1</span><span style="color:#000000;">]</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">从账本中获取状态</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">TODO:</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">will</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">be</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">nice</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">have</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">GetAllState</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">call</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">ledger</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Avalbytes<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>GetState<span style="color:#000000;">(</span>A<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Failed</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">get</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>Avalbytes<span style="color:#c0c0c0;"> </span><span style="color:#000000;">==</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Entity</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">not</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">found"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Aval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>_<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>strconv<span style="color:#000000;">.</span>Atoi<span style="color:#000000;">(</span><span style="color:#000080;">string</span><span style="color:#000000;">(</span>Avalbytes<span style="color:#000000;">))</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Bvalbytes<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>GetState<span style="color:#000000;">(</span>B<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Failed</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">get</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>Bvalbytes<span style="color:#c0c0c0;"> </span><span style="color:#000000;">==</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Entity</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">not</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">found"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Bval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>_<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>strconv<span style="color:#000000;">.</span>Atoi<span style="color:#000000;">(</span><span style="color:#000080;">string</span><span style="color:#000000;">(</span>Bvalbytes<span style="color:#000000;">))</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">执行execution</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>X<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>strconv<span style="color:#000000;">.</span>Atoi<span style="color:#000000;">(</span>args<span style="color:#000000;">[</span><span style="color:#800080;">2</span><span style="color:#000000;">])</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Invalid</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">transaction</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">amount,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">integer</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">value"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Aval<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>Aval<span style="color:#c0c0c0;"> </span><span style="color:#000000;">-</span><span style="color:#c0c0c0;"> </span>X</pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Bval<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>Bval<span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span>X</pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>fmt<span style="color:#000000;">.</span>Printf<span style="color:#000000;">(</span><span style="color:#008000;">"Aval</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">%d,</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Bval</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">%d\n"</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>Aval<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>Bval<span style="color:#000000;">)</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">写状态到账本</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>PutState<span style="color:#000000;">(</span>A<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">(</span>strconv<span style="color:#000000;">.</span>Itoa<span style="color:#000000;">(</span>Aval<span style="color:#000000;">)))</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err</pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>PutState<span style="color:#000000;">(</span>B<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">byte</span><span style="color:#000000;">(</span>strconv<span style="color:#000000;">.</span>Itoa<span style="color:#000000;">(</span>Bval<span style="color:#000000;">)))</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err</pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">从账本中删除实体</span></pre> 
  <pre><span style="color:#000080;font-weight:600;">func</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span>t<span style="color:#c0c0c0;"> </span><span style="color:#000000;">*</span><span style="color:#000080;">SimpleChaincode</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">delete</span><span style="color:#000000;">(</span>stub<span style="color:#c0c0c0;"> </span>shim<span style="color:#000000;">.</span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">len</span><span style="color:#000000;">(</span>args<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#800080;">1</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Incorrect</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">number</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">arguments.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">1"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">[</span><span style="color:#800080;">0</span><span style="color:#000000;">]</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">从账本的状态中删除密钥</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>DelState<span style="color:#000000;">(</span>A<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Failed</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">delete</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Query</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">callback</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">representing</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">query</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">a</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">chaincode</span></pre> 
  <pre><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Query</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">查询链上代码</span></pre> 
  <pre><span style="color:#000080;font-weight:600;">func</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">(</span>t<span style="color:#c0c0c0;"> </span><span style="color:#000000;">*</span><span style="color:#000080;">SimpleChaincode</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">Query(</span>stub<span style="color:#c0c0c0;"> </span>shim<span style="color:#000000;">.</span>ChaincodeStubInterface<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>args<span style="color:#c0c0c0;"> </span><span style="color:#000000;">[]</span><span style="color:#000080;">string</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">([]</span><span style="color:#000080;">byte</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span><span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>function<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"query"</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Invalid</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">query</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">function</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">name.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">\"query\""</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>A<span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">字符实体</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">var</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000080;">error</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">len</span><span style="color:#000000;">(</span>args<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#800080;">1</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span><span style="color:#008000;">"Incorrect</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">number</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">arguments.</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Expecting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">name</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">of</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">the</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">person</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">query"</span><span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">=</span><span style="color:#c0c0c0;"> </span>args<span style="color:#000000;">[</span><span style="color:#800080;">0</span><span style="color:#000000;">]</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">从账本中获取状态</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>Avalbytes<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span>stub<span style="color:#000000;">.</span>GetState<span style="color:#000000;">(</span>A<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jsonResp<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"{\"Error\":\"Failed</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">to</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">get</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">state</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">for</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"\"}"</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span>jsonResp<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>Avalbytes<span style="color:#c0c0c0;"> </span><span style="color:#000000;">==</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jsonResp<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"{\"Error\":\"Nil</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">amount</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">for</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"\"}"</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>errors<span style="color:#000000;">.</span>New<span style="color:#000000;">(</span>jsonResp<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>jsonResp<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"{\"Name\":\""</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span>A<span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"\",\"Amount\":\""</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">string</span><span style="color:#000000;">(</span>Avalbytes<span style="color:#000000;">)</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">+</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">"\"}"</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>fmt<span style="color:#000000;">.</span>Printf<span style="color:#000000;">(</span><span style="color:#008000;">"Query</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Response:%s\n"</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>jsonResp<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">return</span><span style="color:#c0c0c0;"> </span>Avalbytes<span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <pre></pre> 
  <pre><span style="color:#000080;font-weight:600;">func</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">main()</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">ChainCode</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">调用</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">err</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">:=</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">shim.Start(new(SimpleChaincode))</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">接入到ChainCodeSupportServer</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">:=</span><span style="color:#c0c0c0;"> </span>shim<span style="color:#000000;">.</span>Start<span style="color:#000000;">(</span><span style="color:#000080;">new</span><span style="color:#000000;">(</span>SimpleChaincode<span style="color:#000000;">))</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000080;font-weight:600;">if</span><span style="color:#c0c0c0;"> </span>err<span style="color:#c0c0c0;"> </span><span style="color:#000000;">!=</span><span style="color:#c0c0c0;"> </span><span style="color:#000080;">nil</span><span style="color:#c0c0c0;"> </span><span style="color:#000000;">{</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fmt<span style="color:#000000;">.</span>Printf<span style="color:#000000;">(</span><span style="color:#008000;">"Error</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">starting</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">Simple</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">chaincode:</span><span style="color:#c0c0c0;"> </span><span style="color:#008000;">%s"</span><span style="color:#000000;">,</span><span style="color:#c0c0c0;"> </span>err<span style="color:#000000;">)</span></pre> 
  <pre><span style="color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#000000;">}</span></pre> 
  <pre><span style="color:#000000;">}</span></pre> 
  <br>
  <p></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jiang_xinxing/article/details/54408516,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jiang_xinxing/article/details/54408516,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

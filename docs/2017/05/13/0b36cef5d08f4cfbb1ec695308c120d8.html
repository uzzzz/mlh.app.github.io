<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>支付宝支付-常用支付API详解(查询、退款、提现等)-酷玩时刻-by javen(凡事皆有终结,耐心是赢得成功的一种手段 微信公众号:javenlife) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="支付宝支付-常用支付API详解(查询、退款、提现等)-酷玩时刻-by javen(凡事皆有终结,耐心是赢得成功的一种手段 微信公众号:javenlife)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，欢迎转载,转载标明出处(http://blog.csdn.net/zyw_java)。微信公众号:javenlife https://blog.csdn.net/zyw_java/article/details/71844328 本文章已同步发布到简书 http://www.jianshu.com/p/b6e6291709c7 1、前言 此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步 https://github.com/Javen205/IJPay http://git.oschina.net/javen205/IJPay 前面几篇文件详细介绍了 支付宝提现、扫码支付、条码支付、Wap支付、App支付 支付宝支付-提现到个人支付宝 支付宝支付-扫码支付 支付宝支付-刷卡支付(条码支付) 支付宝Wap支付你了解多少？ Android版-支付宝APP支付 一张二维码集成微信、支付宝支付 其中也断断续续的提到了一些接口。本片文章主要是总结支付宝支付中常用的一些接口 2、常用的接口总结 这里使用表格的方式列出 官方接口列表以及详细的参数说明 API列表 类型 描述 使用场景 alipay.trade.query 免费 统一收单线下交易查询 提供所有支付宝支付订单的查询 alipay.trade.refund 免费 统一收单交易退款接口 买家或者卖家的原因需要退款时 alipay.trade.fastpay.refund.query 免费 统一收单交易退款查询 查看退款请求是否执行成功 alipay.trade.pay 免费 统一收单交易支付接口 将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。 alipay.trade.precreate 免费 统一收单线下交易预创建 二维码支付 alipay.trade.cancel 免费 统一收单交易撤销接口 撤销交易 alipay.trade.create 免费 统一收单交易创建接口 创建下单 alipay.trade.close 免费 统一收单交易关闭接口 用于交易创建后，用户在一定时间内未进行支付时可以通过此接口关闭订单 alipay.trade.order.settle 免费 统一收单交易结算接口 用于在线下场景交易支付后，进行结算 alipay.fund.trans.toaccount.transfer 免费 单笔转账到支付宝账户接口 支付宝提现 alipay.fund.trans.order.query 免费 查询转账订单接口 提现结果查询 alipay.data.dataservice.bill.downloadurl.query 免费 查询对账单下载地址 为方便商户快速查账 3、使用服务端SDK封装接口 3.1 服务端SDK下载及其使用方法 参考 开放平台服务端SDK Maven项目引用JAR包可以参考 支付宝Wap支付你了解多少？ 里面有详细的介绍 重要说明 1、接口使用的编码格式为 UTF-8 2、接口数据交互使用的是 json 3、接口加密的模式使用官方推荐的 RSA2 4、本片文章主要是介绍Java的使用方法与封装 3.2 初始化SDK 在SDK调用前需要进行初始化 AlipayClient alipayClient = new DefaultAlipayClient(URL, APP_ID, APP_PRIVATE_KEY, FORMAT, CHARSET, ALIPAY_PUBLIC_KEY, SIGN_TYPE); 关键参数说明： 配置参数 示例值解释 获取方式/示例值 URL 支付网关（固定） 正式环境：https://openapi.alipay.com/gateway.do 沙箱环境：https://openapi.alipaydev.com/gateway.do APP_ID APPID即创建应用后生成 获取见上面创建应用并获取APPID APP_PRIVATE_KEY 开发者应用私钥，由开发者自己生成 获取详见上面配置密钥 FORMAT 参数返回格式，只支持json json（固定） CHARSET 请求和签名使用的字符编码格式，支持GBK和UTF-8 开发者根据实际工程编码配置 ALIPAY_PUBLIC_KEY 支付宝公钥，由支付宝生成 获取详见上面配置密钥 SIGN_TYPE 商户生成签名字符串所使用的签名算法类型，目前支持RSA2和RSA，推荐使用RSA2 RSA2 3.3 API接口封装 3.3.1 alipay.trade.query接口封装 该接口提供所有支付宝支付订单的查询，商户可以通过该接口主动查询订单状态，完成下一步的业务逻辑。 需要调用查询接口的情况： 当商户后台、网络、服务器等出现异常，商户系统最终未接收到支付通知； 调用支付接口后，返回系统错误或未知交易状态情况； 调用alipay.trade.pay，返回INPROCESS的状态； 调用alipay.trade.cancel之前，需确认支付状态； /** * 交易查询接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.8H2JzG&amp;docType=4&amp;apiId=757 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{ AlipayTradeQueryResponse response = tradeQuery(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeQueryResponse tradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{ AlipayTradeQueryRequest request = new AlipayTradeQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.2 alipay.trade.refund 接口封装 当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。 交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款 支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的商户订单号和设置不同的退款单号。一笔退款失败后重新提交，要采用原来的退款单号。总退款金额不能超过用户实际支付金额 /** * 退款 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.SAyEeI&amp;docType=4&amp;apiId=759 * @param content * @return * @throws AlipayApiException */ public static String tradeRefund(AlipayTradeRefundModel model) throws AlipayApiException{ AlipayTradeRefundResponse response = tradeRefundToResponse(model); return response.getBody(); } public static AlipayTradeRefundResponse tradeRefundToResponse(AlipayTradeRefundModel model) throws AlipayApiException{ AlipayTradeRefundRequest request = new AlipayTradeRefundRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.3 alipay.trade.fastpay.refund.query接口封装 商户可使用该接口查询自已通过alipay.trade.refund提交的退款请求是否执行成功。 该接口的返回码10000，仅代表本次查询操作成功，不代表退款成功。如果该接口返回了查询数据，则代表退款成功，如果没有查询到则代表未退款成功，可以调用退款接口进行重试。重试时请务必保证退款请求号一致。 /** * 退款查询 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.KQeTSa&amp;apiId=1049&amp;docType=4 * @param model * @return * @throws AlipayApiException */ public static String tradeRefundQuery(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{ AlipayTradeFastpayRefundQueryResponse response = tradeRefundQueryToResponse(model); return response.getBody(); } public static AlipayTradeFastpayRefundQueryResponse tradeRefundQueryToResponse(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{ AlipayTradeFastpayRefundQueryRequest request = new AlipayTradeFastpayRefundQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.4 alipay.trade.pay接口封装 收银员使用扫码设备读取用户手机支付宝“付款码”/声波获取设备（如麦克风）读取用户手机支付宝的声波信息后，将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。 /** * 条形码支付、声波支付 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.XVqALk&amp;apiId=850&amp;docType=4 * @param notifyUrl * @throws AlipayApiException */ public static String tradePay(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException { AlipayTradePayResponse response = tradePayToResponse(model,notifyUrl); return response.getBody(); } public static AlipayTradePayResponse tradePayToResponse(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePayRequest request = new AlipayTradePayRequest(); request.setBizModel(model);// 填充业务参数 request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); // 通过alipayClient调用API，获得对应的response类 } 3.3.5 alipay.trade.precreate 接口封装 收银员通过收银台或商户后台调用支付宝接口，生成二维码后，展示给用户，由用户扫描二维码完成订单支付。 /** * 扫码支付 * https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.i0UVZn&amp;treeId=193&amp;articleId=105170&amp;docType=1#s4 * @param notifyUrl * @return * @throws AlipayApiException */ public static String tradePrecreatePay(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePrecreateResponse response = tradePrecreatePayToResponse(model,notifyUrl); return response.getBody(); } public static AlipayTradePrecreateResponse tradePrecreatePayToResponse(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePrecreateRequest request = new AlipayTradePrecreateRequest(); request.setBizModel(model); request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); } 3.3.6 alipay.trade.cancel 接口封装 支付交易返回失败或支付系统超时，调用该接口撤销交易。如果此订单用户支付失败，支付宝系统会将此订单关闭；如果用户支付成功，支付宝系统会将此订单资金退还给用户。 注意：只有发生支付系统超时或者支付结果未知时可调用撤销，其他正常支付的单如需实现相同功能请调用申请退款API。提交支付交易后调用【查询订单API】，没有明确的支付结果再调用【撤销订单API】。 /** * 交易撤销接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.XInh6e&amp;docType=4&amp;apiId=866 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{ AlipayTradeCancelResponse response = tradeCancel(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeCancelResponse tradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{ AlipayTradeCancelRequest request = new AlipayTradeCancelRequest(); request.setBizModel(model); AlipayTradeCancelResponse response = alipayClient.execute(request); return response; } 3.3.7 alipay.trade.create 接口封装 商户通过该接口进行交易的创建下单 /** * 统一收单交易创建接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1046&amp;docType=4 * @param model * @param notifyUrl * @return * @throws AlipayApiException */ public static AlipayTradeCreateResponse tradeCreate(AlipayTradeCreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradeCreateRequest request = new AlipayTradeCreateRequest(); request.setBizModel(model); request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); } 3.3.8 alipay.trade.close 接口封装 用于交易创建后，用户在一定时间内未进行支付，可调用该接口直接将未付款的交易进行关闭。 /** * 关闭订单 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1058&amp;docType=4 * @param model * @return * @throws AlipayApiException */ public static boolean isTradeClose(AlipayTradeCloseModel model) throws AlipayApiException{ AlipayTradeCloseResponse response = tradeClose(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeCloseResponse tradeClose(AlipayTradeCloseModel model) throws AlipayApiException{ AlipayTradeCloseRequest request = new AlipayTradeCloseRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.9 alipay.trade.order.settle接口封装 用于在线下场景交易支付后，进行结算 /** * 交易结算接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.nl0RS3&amp;docType=4&amp;apiId=1147 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{ AlipayTradeOrderSettleResponse response = tradeOrderSettle(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeOrderSettleResponse tradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{ AlipayTradeOrderSettleRequest request = new AlipayTradeOrderSettleRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.10 alipay.fund.trans.toaccount.transfer接口封装 可以参考 支付宝支付-提现到个人支付宝 3.3.11 alipay.fund.trans.order.query接口封装 可以参考 支付宝支付-提现到个人支付宝 3.3.12 alipay.data.dataservice.bill.downloadurl.query 接口封装 为方便商户快速查账，支持商户通过本接口获取商户离线账单下载地址 /** * 查询对账单下载地址 * @param bizContent * @return * @throws AlipayApiException */ public static String billDownloadurlQuery(AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{ AlipayDataDataserviceBillDownloadurlQueryResponse response = billDownloadurlQueryToResponse(model); return response.getBillDownloadUrl(); } public static AlipayDataDataserviceBillDownloadurlQueryResponse billDownloadurlQueryToResponse (AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{ AlipayDataDataserviceBillDownloadurlQueryRequest request = new AlipayDataDataserviceBillDownloadurlQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 4、异步通知封装 将异步通知的参数转化为Map为验签做准备 /** * 将异步通知的参数转化为Map * @param request * @return */ public static Map&lt;String, String&gt; toMap(HttpServletRequest request) { System.out.println(&quot;&gt;&gt;&gt;&gt;&quot; + request.getQueryString()); Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;(); Map&lt;String, String[]&gt; requestParams = request.getParameterMap(); for (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) { String name = (String) iter.next(); String[] values = (String[]) requestParams.get(name); String valueStr = &quot;&quot;; for (int i = 0; i &lt; values.length; i++) { valueStr = (i == values.length - 1) ? valueStr + values[i] : valueStr + values[i] + &quot;,&quot;; } // 乱码解决，这段代码在出现乱码时使用。 // valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;); params.put(name, valueStr); } return params; } 使用AlipaySignature.rsaCheckV1(....)接口进行验证签名 public void notify_url() { try { // 获取支付宝POST过来反馈信息 Map&lt;String, String&gt; params = AliPayApi.toMap(getRequest()); for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) { System.out.println(entry.getKey() + &quot; = &quot; + entry.getValue()); } boolean verify_result = AlipaySignature.rsaCheckV1(params, AliPayApi.ALIPAY_PUBLIC_KEY, AliPayApi.CHARSET, AliPayApi.SIGN_TYPE); if (verify_result) {// 验证成功 // TODO 请在这里加上商户的业务逻辑程序代码 异步通知可能出现订单重复通知 需要做去重处理 System.out.println(&quot;notify_url 验证成功succcess&quot;); renderText(&quot;success&quot;); return; } else { System.out.println(&quot;notify_url 验证失败&quot;); // TODO renderText(&quot;failure&quot;); return; } } catch (AlipayApiException e) { e.printStackTrace(); renderText(&quot;failure&quot;); } } 此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步 https://github.com/Javen205/IJPay http://git.oschina.net/javen205/IJPay 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，欢迎转载,转载标明出处(http://blog.csdn.net/zyw_java)。微信公众号:javenlife https://blog.csdn.net/zyw_java/article/details/71844328 本文章已同步发布到简书 http://www.jianshu.com/p/b6e6291709c7 1、前言 此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步 https://github.com/Javen205/IJPay http://git.oschina.net/javen205/IJPay 前面几篇文件详细介绍了 支付宝提现、扫码支付、条码支付、Wap支付、App支付 支付宝支付-提现到个人支付宝 支付宝支付-扫码支付 支付宝支付-刷卡支付(条码支付) 支付宝Wap支付你了解多少？ Android版-支付宝APP支付 一张二维码集成微信、支付宝支付 其中也断断续续的提到了一些接口。本片文章主要是总结支付宝支付中常用的一些接口 2、常用的接口总结 这里使用表格的方式列出 官方接口列表以及详细的参数说明 API列表 类型 描述 使用场景 alipay.trade.query 免费 统一收单线下交易查询 提供所有支付宝支付订单的查询 alipay.trade.refund 免费 统一收单交易退款接口 买家或者卖家的原因需要退款时 alipay.trade.fastpay.refund.query 免费 统一收单交易退款查询 查看退款请求是否执行成功 alipay.trade.pay 免费 统一收单交易支付接口 将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。 alipay.trade.precreate 免费 统一收单线下交易预创建 二维码支付 alipay.trade.cancel 免费 统一收单交易撤销接口 撤销交易 alipay.trade.create 免费 统一收单交易创建接口 创建下单 alipay.trade.close 免费 统一收单交易关闭接口 用于交易创建后，用户在一定时间内未进行支付时可以通过此接口关闭订单 alipay.trade.order.settle 免费 统一收单交易结算接口 用于在线下场景交易支付后，进行结算 alipay.fund.trans.toaccount.transfer 免费 单笔转账到支付宝账户接口 支付宝提现 alipay.fund.trans.order.query 免费 查询转账订单接口 提现结果查询 alipay.data.dataservice.bill.downloadurl.query 免费 查询对账单下载地址 为方便商户快速查账 3、使用服务端SDK封装接口 3.1 服务端SDK下载及其使用方法 参考 开放平台服务端SDK Maven项目引用JAR包可以参考 支付宝Wap支付你了解多少？ 里面有详细的介绍 重要说明 1、接口使用的编码格式为 UTF-8 2、接口数据交互使用的是 json 3、接口加密的模式使用官方推荐的 RSA2 4、本片文章主要是介绍Java的使用方法与封装 3.2 初始化SDK 在SDK调用前需要进行初始化 AlipayClient alipayClient = new DefaultAlipayClient(URL, APP_ID, APP_PRIVATE_KEY, FORMAT, CHARSET, ALIPAY_PUBLIC_KEY, SIGN_TYPE); 关键参数说明： 配置参数 示例值解释 获取方式/示例值 URL 支付网关（固定） 正式环境：https://openapi.alipay.com/gateway.do 沙箱环境：https://openapi.alipaydev.com/gateway.do APP_ID APPID即创建应用后生成 获取见上面创建应用并获取APPID APP_PRIVATE_KEY 开发者应用私钥，由开发者自己生成 获取详见上面配置密钥 FORMAT 参数返回格式，只支持json json（固定） CHARSET 请求和签名使用的字符编码格式，支持GBK和UTF-8 开发者根据实际工程编码配置 ALIPAY_PUBLIC_KEY 支付宝公钥，由支付宝生成 获取详见上面配置密钥 SIGN_TYPE 商户生成签名字符串所使用的签名算法类型，目前支持RSA2和RSA，推荐使用RSA2 RSA2 3.3 API接口封装 3.3.1 alipay.trade.query接口封装 该接口提供所有支付宝支付订单的查询，商户可以通过该接口主动查询订单状态，完成下一步的业务逻辑。 需要调用查询接口的情况： 当商户后台、网络、服务器等出现异常，商户系统最终未接收到支付通知； 调用支付接口后，返回系统错误或未知交易状态情况； 调用alipay.trade.pay，返回INPROCESS的状态； 调用alipay.trade.cancel之前，需确认支付状态； /** * 交易查询接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.8H2JzG&amp;docType=4&amp;apiId=757 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{ AlipayTradeQueryResponse response = tradeQuery(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeQueryResponse tradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{ AlipayTradeQueryRequest request = new AlipayTradeQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.2 alipay.trade.refund 接口封装 当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。 交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款 支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的商户订单号和设置不同的退款单号。一笔退款失败后重新提交，要采用原来的退款单号。总退款金额不能超过用户实际支付金额 /** * 退款 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.SAyEeI&amp;docType=4&amp;apiId=759 * @param content * @return * @throws AlipayApiException */ public static String tradeRefund(AlipayTradeRefundModel model) throws AlipayApiException{ AlipayTradeRefundResponse response = tradeRefundToResponse(model); return response.getBody(); } public static AlipayTradeRefundResponse tradeRefundToResponse(AlipayTradeRefundModel model) throws AlipayApiException{ AlipayTradeRefundRequest request = new AlipayTradeRefundRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.3 alipay.trade.fastpay.refund.query接口封装 商户可使用该接口查询自已通过alipay.trade.refund提交的退款请求是否执行成功。 该接口的返回码10000，仅代表本次查询操作成功，不代表退款成功。如果该接口返回了查询数据，则代表退款成功，如果没有查询到则代表未退款成功，可以调用退款接口进行重试。重试时请务必保证退款请求号一致。 /** * 退款查询 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.KQeTSa&amp;apiId=1049&amp;docType=4 * @param model * @return * @throws AlipayApiException */ public static String tradeRefundQuery(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{ AlipayTradeFastpayRefundQueryResponse response = tradeRefundQueryToResponse(model); return response.getBody(); } public static AlipayTradeFastpayRefundQueryResponse tradeRefundQueryToResponse(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{ AlipayTradeFastpayRefundQueryRequest request = new AlipayTradeFastpayRefundQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.4 alipay.trade.pay接口封装 收银员使用扫码设备读取用户手机支付宝“付款码”/声波获取设备（如麦克风）读取用户手机支付宝的声波信息后，将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。 /** * 条形码支付、声波支付 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.XVqALk&amp;apiId=850&amp;docType=4 * @param notifyUrl * @throws AlipayApiException */ public static String tradePay(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException { AlipayTradePayResponse response = tradePayToResponse(model,notifyUrl); return response.getBody(); } public static AlipayTradePayResponse tradePayToResponse(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePayRequest request = new AlipayTradePayRequest(); request.setBizModel(model);// 填充业务参数 request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); // 通过alipayClient调用API，获得对应的response类 } 3.3.5 alipay.trade.precreate 接口封装 收银员通过收银台或商户后台调用支付宝接口，生成二维码后，展示给用户，由用户扫描二维码完成订单支付。 /** * 扫码支付 * https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.i0UVZn&amp;treeId=193&amp;articleId=105170&amp;docType=1#s4 * @param notifyUrl * @return * @throws AlipayApiException */ public static String tradePrecreatePay(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePrecreateResponse response = tradePrecreatePayToResponse(model,notifyUrl); return response.getBody(); } public static AlipayTradePrecreateResponse tradePrecreatePayToResponse(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePrecreateRequest request = new AlipayTradePrecreateRequest(); request.setBizModel(model); request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); } 3.3.6 alipay.trade.cancel 接口封装 支付交易返回失败或支付系统超时，调用该接口撤销交易。如果此订单用户支付失败，支付宝系统会将此订单关闭；如果用户支付成功，支付宝系统会将此订单资金退还给用户。 注意：只有发生支付系统超时或者支付结果未知时可调用撤销，其他正常支付的单如需实现相同功能请调用申请退款API。提交支付交易后调用【查询订单API】，没有明确的支付结果再调用【撤销订单API】。 /** * 交易撤销接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.XInh6e&amp;docType=4&amp;apiId=866 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{ AlipayTradeCancelResponse response = tradeCancel(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeCancelResponse tradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{ AlipayTradeCancelRequest request = new AlipayTradeCancelRequest(); request.setBizModel(model); AlipayTradeCancelResponse response = alipayClient.execute(request); return response; } 3.3.7 alipay.trade.create 接口封装 商户通过该接口进行交易的创建下单 /** * 统一收单交易创建接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1046&amp;docType=4 * @param model * @param notifyUrl * @return * @throws AlipayApiException */ public static AlipayTradeCreateResponse tradeCreate(AlipayTradeCreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradeCreateRequest request = new AlipayTradeCreateRequest(); request.setBizModel(model); request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); } 3.3.8 alipay.trade.close 接口封装 用于交易创建后，用户在一定时间内未进行支付，可调用该接口直接将未付款的交易进行关闭。 /** * 关闭订单 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1058&amp;docType=4 * @param model * @return * @throws AlipayApiException */ public static boolean isTradeClose(AlipayTradeCloseModel model) throws AlipayApiException{ AlipayTradeCloseResponse response = tradeClose(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeCloseResponse tradeClose(AlipayTradeCloseModel model) throws AlipayApiException{ AlipayTradeCloseRequest request = new AlipayTradeCloseRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.9 alipay.trade.order.settle接口封装 用于在线下场景交易支付后，进行结算 /** * 交易结算接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.nl0RS3&amp;docType=4&amp;apiId=1147 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{ AlipayTradeOrderSettleResponse response = tradeOrderSettle(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeOrderSettleResponse tradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{ AlipayTradeOrderSettleRequest request = new AlipayTradeOrderSettleRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.10 alipay.fund.trans.toaccount.transfer接口封装 可以参考 支付宝支付-提现到个人支付宝 3.3.11 alipay.fund.trans.order.query接口封装 可以参考 支付宝支付-提现到个人支付宝 3.3.12 alipay.data.dataservice.bill.downloadurl.query 接口封装 为方便商户快速查账，支持商户通过本接口获取商户离线账单下载地址 /** * 查询对账单下载地址 * @param bizContent * @return * @throws AlipayApiException */ public static String billDownloadurlQuery(AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{ AlipayDataDataserviceBillDownloadurlQueryResponse response = billDownloadurlQueryToResponse(model); return response.getBillDownloadUrl(); } public static AlipayDataDataserviceBillDownloadurlQueryResponse billDownloadurlQueryToResponse (AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{ AlipayDataDataserviceBillDownloadurlQueryRequest request = new AlipayDataDataserviceBillDownloadurlQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 4、异步通知封装 将异步通知的参数转化为Map为验签做准备 /** * 将异步通知的参数转化为Map * @param request * @return */ public static Map&lt;String, String&gt; toMap(HttpServletRequest request) { System.out.println(&quot;&gt;&gt;&gt;&gt;&quot; + request.getQueryString()); Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;(); Map&lt;String, String[]&gt; requestParams = request.getParameterMap(); for (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) { String name = (String) iter.next(); String[] values = (String[]) requestParams.get(name); String valueStr = &quot;&quot;; for (int i = 0; i &lt; values.length; i++) { valueStr = (i == values.length - 1) ? valueStr + values[i] : valueStr + values[i] + &quot;,&quot;; } // 乱码解决，这段代码在出现乱码时使用。 // valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;); params.put(name, valueStr); } return params; } 使用AlipaySignature.rsaCheckV1(....)接口进行验证签名 public void notify_url() { try { // 获取支付宝POST过来反馈信息 Map&lt;String, String&gt; params = AliPayApi.toMap(getRequest()); for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) { System.out.println(entry.getKey() + &quot; = &quot; + entry.getValue()); } boolean verify_result = AlipaySignature.rsaCheckV1(params, AliPayApi.ALIPAY_PUBLIC_KEY, AliPayApi.CHARSET, AliPayApi.SIGN_TYPE); if (verify_result) {// 验证成功 // TODO 请在这里加上商户的业务逻辑程序代码 异步通知可能出现订单重复通知 需要做去重处理 System.out.println(&quot;notify_url 验证成功succcess&quot;); renderText(&quot;success&quot;); return; } else { System.out.println(&quot;notify_url 验证失败&quot;); // TODO renderText(&quot;failure&quot;); return; } } catch (AlipayApiException e) { e.printStackTrace(); renderText(&quot;failure&quot;); } } 此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步 https://github.com/Javen205/IJPay http://git.oschina.net/javen205/IJPay 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-05-13T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，欢迎转载,转载标明出处(http://blog.csdn.net/zyw_java)。微信公众号:javenlife https://blog.csdn.net/zyw_java/article/details/71844328 本文章已同步发布到简书 http://www.jianshu.com/p/b6e6291709c7 1、前言 此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步 https://github.com/Javen205/IJPay http://git.oschina.net/javen205/IJPay 前面几篇文件详细介绍了 支付宝提现、扫码支付、条码支付、Wap支付、App支付 支付宝支付-提现到个人支付宝 支付宝支付-扫码支付 支付宝支付-刷卡支付(条码支付) 支付宝Wap支付你了解多少？ Android版-支付宝APP支付 一张二维码集成微信、支付宝支付 其中也断断续续的提到了一些接口。本片文章主要是总结支付宝支付中常用的一些接口 2、常用的接口总结 这里使用表格的方式列出 官方接口列表以及详细的参数说明 API列表 类型 描述 使用场景 alipay.trade.query 免费 统一收单线下交易查询 提供所有支付宝支付订单的查询 alipay.trade.refund 免费 统一收单交易退款接口 买家或者卖家的原因需要退款时 alipay.trade.fastpay.refund.query 免费 统一收单交易退款查询 查看退款请求是否执行成功 alipay.trade.pay 免费 统一收单交易支付接口 将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。 alipay.trade.precreate 免费 统一收单线下交易预创建 二维码支付 alipay.trade.cancel 免费 统一收单交易撤销接口 撤销交易 alipay.trade.create 免费 统一收单交易创建接口 创建下单 alipay.trade.close 免费 统一收单交易关闭接口 用于交易创建后，用户在一定时间内未进行支付时可以通过此接口关闭订单 alipay.trade.order.settle 免费 统一收单交易结算接口 用于在线下场景交易支付后，进行结算 alipay.fund.trans.toaccount.transfer 免费 单笔转账到支付宝账户接口 支付宝提现 alipay.fund.trans.order.query 免费 查询转账订单接口 提现结果查询 alipay.data.dataservice.bill.downloadurl.query 免费 查询对账单下载地址 为方便商户快速查账 3、使用服务端SDK封装接口 3.1 服务端SDK下载及其使用方法 参考 开放平台服务端SDK Maven项目引用JAR包可以参考 支付宝Wap支付你了解多少？ 里面有详细的介绍 重要说明 1、接口使用的编码格式为 UTF-8 2、接口数据交互使用的是 json 3、接口加密的模式使用官方推荐的 RSA2 4、本片文章主要是介绍Java的使用方法与封装 3.2 初始化SDK 在SDK调用前需要进行初始化 AlipayClient alipayClient = new DefaultAlipayClient(URL, APP_ID, APP_PRIVATE_KEY, FORMAT, CHARSET, ALIPAY_PUBLIC_KEY, SIGN_TYPE); 关键参数说明： 配置参数 示例值解释 获取方式/示例值 URL 支付网关（固定） 正式环境：https://openapi.alipay.com/gateway.do 沙箱环境：https://openapi.alipaydev.com/gateway.do APP_ID APPID即创建应用后生成 获取见上面创建应用并获取APPID APP_PRIVATE_KEY 开发者应用私钥，由开发者自己生成 获取详见上面配置密钥 FORMAT 参数返回格式，只支持json json（固定） CHARSET 请求和签名使用的字符编码格式，支持GBK和UTF-8 开发者根据实际工程编码配置 ALIPAY_PUBLIC_KEY 支付宝公钥，由支付宝生成 获取详见上面配置密钥 SIGN_TYPE 商户生成签名字符串所使用的签名算法类型，目前支持RSA2和RSA，推荐使用RSA2 RSA2 3.3 API接口封装 3.3.1 alipay.trade.query接口封装 该接口提供所有支付宝支付订单的查询，商户可以通过该接口主动查询订单状态，完成下一步的业务逻辑。 需要调用查询接口的情况： 当商户后台、网络、服务器等出现异常，商户系统最终未接收到支付通知； 调用支付接口后，返回系统错误或未知交易状态情况； 调用alipay.trade.pay，返回INPROCESS的状态； 调用alipay.trade.cancel之前，需确认支付状态； /** * 交易查询接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.8H2JzG&amp;docType=4&amp;apiId=757 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{ AlipayTradeQueryResponse response = tradeQuery(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeQueryResponse tradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{ AlipayTradeQueryRequest request = new AlipayTradeQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.2 alipay.trade.refund 接口封装 当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。 交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款 支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的商户订单号和设置不同的退款单号。一笔退款失败后重新提交，要采用原来的退款单号。总退款金额不能超过用户实际支付金额 /** * 退款 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.SAyEeI&amp;docType=4&amp;apiId=759 * @param content * @return * @throws AlipayApiException */ public static String tradeRefund(AlipayTradeRefundModel model) throws AlipayApiException{ AlipayTradeRefundResponse response = tradeRefundToResponse(model); return response.getBody(); } public static AlipayTradeRefundResponse tradeRefundToResponse(AlipayTradeRefundModel model) throws AlipayApiException{ AlipayTradeRefundRequest request = new AlipayTradeRefundRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.3 alipay.trade.fastpay.refund.query接口封装 商户可使用该接口查询自已通过alipay.trade.refund提交的退款请求是否执行成功。 该接口的返回码10000，仅代表本次查询操作成功，不代表退款成功。如果该接口返回了查询数据，则代表退款成功，如果没有查询到则代表未退款成功，可以调用退款接口进行重试。重试时请务必保证退款请求号一致。 /** * 退款查询 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.KQeTSa&amp;apiId=1049&amp;docType=4 * @param model * @return * @throws AlipayApiException */ public static String tradeRefundQuery(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{ AlipayTradeFastpayRefundQueryResponse response = tradeRefundQueryToResponse(model); return response.getBody(); } public static AlipayTradeFastpayRefundQueryResponse tradeRefundQueryToResponse(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{ AlipayTradeFastpayRefundQueryRequest request = new AlipayTradeFastpayRefundQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.4 alipay.trade.pay接口封装 收银员使用扫码设备读取用户手机支付宝“付款码”/声波获取设备（如麦克风）读取用户手机支付宝的声波信息后，将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。 /** * 条形码支付、声波支付 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.XVqALk&amp;apiId=850&amp;docType=4 * @param notifyUrl * @throws AlipayApiException */ public static String tradePay(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException { AlipayTradePayResponse response = tradePayToResponse(model,notifyUrl); return response.getBody(); } public static AlipayTradePayResponse tradePayToResponse(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePayRequest request = new AlipayTradePayRequest(); request.setBizModel(model);// 填充业务参数 request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); // 通过alipayClient调用API，获得对应的response类 } 3.3.5 alipay.trade.precreate 接口封装 收银员通过收银台或商户后台调用支付宝接口，生成二维码后，展示给用户，由用户扫描二维码完成订单支付。 /** * 扫码支付 * https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.i0UVZn&amp;treeId=193&amp;articleId=105170&amp;docType=1#s4 * @param notifyUrl * @return * @throws AlipayApiException */ public static String tradePrecreatePay(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePrecreateResponse response = tradePrecreatePayToResponse(model,notifyUrl); return response.getBody(); } public static AlipayTradePrecreateResponse tradePrecreatePayToResponse(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradePrecreateRequest request = new AlipayTradePrecreateRequest(); request.setBizModel(model); request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); } 3.3.6 alipay.trade.cancel 接口封装 支付交易返回失败或支付系统超时，调用该接口撤销交易。如果此订单用户支付失败，支付宝系统会将此订单关闭；如果用户支付成功，支付宝系统会将此订单资金退还给用户。 注意：只有发生支付系统超时或者支付结果未知时可调用撤销，其他正常支付的单如需实现相同功能请调用申请退款API。提交支付交易后调用【查询订单API】，没有明确的支付结果再调用【撤销订单API】。 /** * 交易撤销接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.XInh6e&amp;docType=4&amp;apiId=866 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{ AlipayTradeCancelResponse response = tradeCancel(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeCancelResponse tradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{ AlipayTradeCancelRequest request = new AlipayTradeCancelRequest(); request.setBizModel(model); AlipayTradeCancelResponse response = alipayClient.execute(request); return response; } 3.3.7 alipay.trade.create 接口封装 商户通过该接口进行交易的创建下单 /** * 统一收单交易创建接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1046&amp;docType=4 * @param model * @param notifyUrl * @return * @throws AlipayApiException */ public static AlipayTradeCreateResponse tradeCreate(AlipayTradeCreateModel model, String notifyUrl) throws AlipayApiException{ AlipayTradeCreateRequest request = new AlipayTradeCreateRequest(); request.setBizModel(model); request.setNotifyUrl(notifyUrl); return alipayClient.execute(request); } 3.3.8 alipay.trade.close 接口封装 用于交易创建后，用户在一定时间内未进行支付，可调用该接口直接将未付款的交易进行关闭。 /** * 关闭订单 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1058&amp;docType=4 * @param model * @return * @throws AlipayApiException */ public static boolean isTradeClose(AlipayTradeCloseModel model) throws AlipayApiException{ AlipayTradeCloseResponse response = tradeClose(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeCloseResponse tradeClose(AlipayTradeCloseModel model) throws AlipayApiException{ AlipayTradeCloseRequest request = new AlipayTradeCloseRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.9 alipay.trade.order.settle接口封装 用于在线下场景交易支付后，进行结算 /** * 交易结算接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.nl0RS3&amp;docType=4&amp;apiId=1147 * @param bizContent * @return * @throws AlipayApiException */ public static boolean isTradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{ AlipayTradeOrderSettleResponse response = tradeOrderSettle(model); if(response.isSuccess()){ return true; } return false; } public static AlipayTradeOrderSettleResponse tradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{ AlipayTradeOrderSettleRequest request = new AlipayTradeOrderSettleRequest(); request.setBizModel(model); return alipayClient.execute(request); } 3.3.10 alipay.fund.trans.toaccount.transfer接口封装 可以参考 支付宝支付-提现到个人支付宝 3.3.11 alipay.fund.trans.order.query接口封装 可以参考 支付宝支付-提现到个人支付宝 3.3.12 alipay.data.dataservice.bill.downloadurl.query 接口封装 为方便商户快速查账，支持商户通过本接口获取商户离线账单下载地址 /** * 查询对账单下载地址 * @param bizContent * @return * @throws AlipayApiException */ public static String billDownloadurlQuery(AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{ AlipayDataDataserviceBillDownloadurlQueryResponse response = billDownloadurlQueryToResponse(model); return response.getBillDownloadUrl(); } public static AlipayDataDataserviceBillDownloadurlQueryResponse billDownloadurlQueryToResponse (AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{ AlipayDataDataserviceBillDownloadurlQueryRequest request = new AlipayDataDataserviceBillDownloadurlQueryRequest(); request.setBizModel(model); return alipayClient.execute(request); } 4、异步通知封装 将异步通知的参数转化为Map为验签做准备 /** * 将异步通知的参数转化为Map * @param request * @return */ public static Map&lt;String, String&gt; toMap(HttpServletRequest request) { System.out.println(&quot;&gt;&gt;&gt;&gt;&quot; + request.getQueryString()); Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;(); Map&lt;String, String[]&gt; requestParams = request.getParameterMap(); for (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) { String name = (String) iter.next(); String[] values = (String[]) requestParams.get(name); String valueStr = &quot;&quot;; for (int i = 0; i &lt; values.length; i++) { valueStr = (i == values.length - 1) ? valueStr + values[i] : valueStr + values[i] + &quot;,&quot;; } // 乱码解决，这段代码在出现乱码时使用。 // valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;); params.put(name, valueStr); } return params; } 使用AlipaySignature.rsaCheckV1(....)接口进行验证签名 public void notify_url() { try { // 获取支付宝POST过来反馈信息 Map&lt;String, String&gt; params = AliPayApi.toMap(getRequest()); for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) { System.out.println(entry.getKey() + &quot; = &quot; + entry.getValue()); } boolean verify_result = AlipaySignature.rsaCheckV1(params, AliPayApi.ALIPAY_PUBLIC_KEY, AliPayApi.CHARSET, AliPayApi.SIGN_TYPE); if (verify_result) {// 验证成功 // TODO 请在这里加上商户的业务逻辑程序代码 异步通知可能出现订单重复通知 需要做去重处理 System.out.println(&quot;notify_url 验证成功succcess&quot;); renderText(&quot;success&quot;); return; } else { System.out.println(&quot;notify_url 验证失败&quot;); // TODO renderText(&quot;failure&quot;); return; } } catch (AlipayApiException e) { e.printStackTrace(); renderText(&quot;failure&quot;); } } 此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步 https://github.com/Javen205/IJPay http://git.oschina.net/javen205/IJPay 阅读更多","@type":"BlogPosting","url":"/2017/05/13/0b36cef5d08f4cfbb1ec695308c120d8.html","headline":"支付宝支付-常用支付API详解(查询、退款、提现等)-酷玩时刻-by javen(凡事皆有终结,耐心是赢得成功的一种手段 微信公众号:javenlife)","dateModified":"2017-05-13T00:00:00+08:00","datePublished":"2017-05-13T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/05/13/0b36cef5d08f4cfbb1ec695308c120d8.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>支付宝支付-常用支付API详解(查询、退款、提现等)-酷玩时刻-by javen(凡事皆有终结,耐心是赢得成功的一种手段 微信公众号:javenlife)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，欢迎转载,转载标明出处(http://blog.csdn.net/zyw_java)。微信公众号:javenlife https://blog.csdn.net/zyw_java/article/details/71844328 
 </div> 
 <div class="markdown_views prism-tomorrow-night-eighties"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>本文章已同步发布到简书 <a href="http://www.jianshu.com/p/b6e6291709c7" rel="nofollow">http://www.jianshu.com/p/b6e6291709c7</a></p> 
  <h4 id="1前言">1、前言</h4> 
  <p>此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步</p> 
  <p><a href="https://github.com/Javen205/IJPay" rel="nofollow">https://github.com/Javen205/IJPay</a> <br> <a href="http://git.oschina.net/javen205/IJPay" rel="nofollow">http://git.oschina.net/javen205/IJPay</a></p> 
  <p>前面几篇文件详细介绍了 <strong>支付宝提现</strong>、<strong>扫码支付</strong>、<strong>条码支付</strong>、<strong>Wap支付</strong>、<strong>App支付</strong></p> 
  <ul> 
   <li><p><a href="http://blog.csdn.net/zyw_java/article/details/71598711" rel="nofollow">支付宝支付-提现到个人支付宝</a></p></li> 
   <li><p><a href="http://blog.csdn.net/zyw_java/article/details/71437269" rel="nofollow">支付宝支付-扫码支付</a></p></li> 
   <li><p><a href="http://blog.csdn.net/zyw_java/article/details/71372789" rel="nofollow">支付宝支付-刷卡支付(条码支付)</a></p></li> 
   <li><p><a href="http://blog.csdn.net/zyw_java/article/details/54024253" rel="nofollow">支付宝Wap支付你了解多少？</a></p></li> 
   <li><p><a href="http://blog.csdn.net/zyw_java/article/details/54024238" rel="nofollow">Android版-支付宝APP支付</a></p></li> 
   <li><p><a href="http://blog.csdn.net/zyw_java/article/details/54630880" rel="nofollow">一张二维码集成微信、支付宝支付</a></p></li> 
  </ul> 
  <p>其中也断断续续的提到了一些接口。本片文章主要是总结支付宝支付中常用的一些接口</p> 
  <h4 id="2常用的接口总结">2、常用的接口总结</h4> 
  <p>这里使用表格的方式列出 <a href="https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.DL0CtU&amp;docType=4&amp;apiId=757" rel="nofollow">官方接口列表以及详细的参数说明</a></p> 
  <table> 
   <thead> 
    <tr> 
     <th>API列表</th> 
     <th>类型</th> 
     <th>描述</th> 
     <th>使用场景</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=757&amp;docType=4" rel="nofollow">alipay.trade.query</a></td> 
     <td>免费</td> 
     <td>统一收单线下交易查询</td> 
     <td>提供所有支付宝支付订单的查询</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=759&amp;docType=4" rel="nofollow">alipay.trade.refund</a></td> 
     <td>免费</td> 
     <td>统一收单交易退款接口</td> 
     <td>买家或者卖家的原因需要退款时</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=1049&amp;docType=4" rel="nofollow">alipay.trade.fastpay.refund.query</a></td> 
     <td>免费</td> 
     <td>统一收单交易退款查询</td> 
     <td>查看退款请求是否执行成功</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=850&amp;docType=4" rel="nofollow">alipay.trade.pay</a></td> 
     <td>免费</td> 
     <td>统一收单交易支付接口</td> 
     <td>将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=862&amp;docType=4" rel="nofollow">alipay.trade.precreate</a></td> 
     <td>免费</td> 
     <td>统一收单线下交易预创建</td> 
     <td>二维码支付</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=866&amp;docType=4" rel="nofollow">alipay.trade.cancel</a></td> 
     <td>免费</td> 
     <td>统一收单交易撤销接口</td> 
     <td>撤销交易</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=1046&amp;docType=4" rel="nofollow">alipay.trade.create</a></td> 
     <td>免费</td> 
     <td>统一收单交易创建接口</td> 
     <td>创建下单</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=1058&amp;docType=4" rel="nofollow">alipay.trade.close</a></td> 
     <td>免费</td> 
     <td>统一收单交易关闭接口</td> 
     <td>用于交易创建后，用户在一定时间内未进行支付时可以通过此接口关闭订单</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=1147&amp;docType=4" rel="nofollow">alipay.trade.order.settle</a></td> 
     <td>免费</td> 
     <td>统一收单交易结算接口</td> 
     <td>用于在线下场景交易支付后，进行结算</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?apiId=1321&amp;docType=4" rel="nofollow">alipay.fund.trans.toaccount.transfer</a></td> 
     <td>免费</td> 
     <td>单笔转账到支付宝账户接口</td> 
     <td>支付宝提现</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?docType=4&amp;apiId=1322" rel="nofollow">alipay.fund.trans.order.query</a></td> 
     <td>免费</td> 
     <td>查询转账订单接口</td> 
     <td>提现结果查询</td> 
    </tr> 
    <tr> 
     <td><a href="https://doc.open.alipay.com/docs/api.htm?spm=a219a.7386797.0.0.xflPSt&amp;docType=4&amp;apiId=1054" rel="nofollow">alipay.data.dataservice.bill.downloadurl.query</a></td> 
     <td>免费</td> 
     <td>查询对账单下载地址</td> 
     <td>为方便商户快速查账</td> 
    </tr> 
   </tbody>
  </table> 
  <h4 id="3使用服务端sdk封装接口">3、使用服务端SDK封装接口</h4> 
  <h5 id="31-服务端sdk下载及其使用方法">3.1 服务端SDK下载及其使用方法</h5> 
  <p>参考 <a href="https://doc.open.alipay.com/doc2/detail?treeId=54&amp;articleId=103419&amp;docType=1" rel="nofollow">开放平台服务端SDK</a></p> 
  <p>Maven项目引用JAR包可以参考 <a href="http://www.jianshu.com/p/7656de831a2c" rel="nofollow">支付宝Wap支付你了解多少？</a> 里面有详细的介绍</p> 
  <blockquote> 
   <p><strong>重要说明</strong> <br> 1、接口使用的编码格式为 <strong>UTF-8</strong> <br> 2、接口数据交互使用的是 <strong>json</strong> <br> 3、接口加密的模式使用官方推荐的 <strong>RSA2</strong> <br> 4、本片文章主要是介绍Java的使用方法与封装</p> 
  </blockquote> 
  <h5 id="32-初始化sdk">3.2 初始化SDK</h5> 
  <p>在SDK调用前需要进行初始化</p> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="AlipayClient alipayClient = new DefaultAlipayClient(URL, APP_ID, APP_PRIVATE_KEY, FORMAT, CHARSET, ALIPAY_PUBLIC_KEY, SIGN_TYPE);
" data-snippet-id="ext.84c74a67c15107d95956ccfc455cdf9e" data-snippet-saved="false" data-codota-status="done"><code class=" hljs fix"><span class="hljs-attribute">AlipayClient alipayClient </span>=<span class="hljs-string"> new DefaultAlipayClient(URL, APP_ID, APP_PRIVATE_KEY, FORMAT, CHARSET, ALIPAY_PUBLIC_KEY, SIGN_TYPE); </span></code></pre> 
  <p>关键参数说明：</p> 
  <table> 
   <thead> 
    <tr> 
     <th>配置参数</th> 
     <th>示例值解释</th> 
     <th>获取方式/示例值</th> 
    </tr> 
   </thead> 
   <tbody>
    <tr> 
     <td>URL</td> 
     <td>支付网关（固定）</td> 
     <td>正式环境：<a href="https://openapi.alipay.com/gateway.do" rel="nofollow">https://openapi.alipay.com/gateway.do</a> 沙箱环境：<a href="https://openapi.alipaydev.com/gateway.do" rel="nofollow">https://openapi.alipaydev.com/gateway.do</a></td> 
    </tr> 
    <tr> 
     <td>APP_ID</td> 
     <td>APPID即创建应用后生成</td> 
     <td>获取见上面<a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.75NkPq&amp;treeId=193&amp;articleId=105170&amp;docType=1#appid" rel="nofollow">创建应用并获取APPID</a></td> 
    </tr> 
    <tr> 
     <td>APP_PRIVATE_KEY</td> 
     <td>开发者应用私钥，由开发者自己生成</td> 
     <td>获取详见上面<a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.75NkPq&amp;treeId=193&amp;articleId=105170&amp;docType=1#key" rel="nofollow">配置密钥</a></td> 
    </tr> 
    <tr> 
     <td>FORMAT</td> 
     <td>参数返回格式，只支持json</td> 
     <td>json（固定）</td> 
    </tr> 
    <tr> 
     <td>CHARSET</td> 
     <td>请求和签名使用的字符编码格式，支持GBK和UTF-8</td> 
     <td>开发者根据实际工程编码配置</td> 
    </tr> 
    <tr> 
     <td>ALIPAY_PUBLIC_KEY</td> 
     <td>支付宝公钥，由支付宝生成</td> 
     <td>获取详见上面<a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.75NkPq&amp;treeId=193&amp;articleId=105170&amp;docType=1#key" rel="nofollow">配置密钥</a></td> 
    </tr> 
    <tr> 
     <td>SIGN_TYPE</td> 
     <td>商户生成签名字符串所使用的签名算法类型，目前支持RSA2和RSA，推荐使用RSA2</td> 
     <td>RSA2</td> 
    </tr> 
   </tbody>
  </table> 
  <h5 id="33-api接口封装">3.3 API接口封装</h5> 
  <h6 id="331-alipaytradequery接口封装">3.3.1 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=757&amp;docType=4" rel="nofollow">alipay.trade.query</a>接口封装</h6> 
  <blockquote> 
   <p>该接口提供所有支付宝支付订单的查询，商户可以通过该接口主动查询订单状态，完成下一步的业务逻辑。 需要调用查询接口的情况： 当商户后台、网络、服务器等出现异常，商户系统最终未接收到支付通知； 调用支付接口后，返回系统错误或未知交易状态情况； 调用alipay.trade.pay，返回INPROCESS的状态； 调用alipay.trade.cancel之前，需确认支付状态；</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 交易查询接口
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.8H2JzG&amp;docType=4&amp;apiId=757
     * @param bizContent
     * @return
     * @throws AlipayApiException
     */
    public static boolean isTradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{
        AlipayTradeQueryResponse response = tradeQuery(model);
        if(response.isSuccess()){
            return true;
        }
        return false;
    }

    public static AlipayTradeQueryResponse  tradeQuery(AlipayTradeQueryModel model) throws AlipayApiException{
        AlipayTradeQueryRequest request = new AlipayTradeQueryRequest();
        request.setBizModel(model);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.7402fb797599b70fc81025ab72812c7a" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 交易查询接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.8H2JzG&amp;docType=4&amp;apiId=757 *<span class="hljs-javadoctag"> @param</span> bizContent *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isTradeQuery</span>(AlipayTradeQueryModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeQueryResponse response = tradeQuery(model);
        <span class="hljs-keyword">if</span>(response.isSuccess()){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeQueryResponse  <span class="hljs-title">tradeQuery</span>(AlipayTradeQueryModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeQueryRequest request = <span class="hljs-keyword">new</span> AlipayTradeQueryRequest();
        request.setBizModel(model);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h6 id="332-alipaytraderefund-接口封装">3.3.2 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=759&amp;docType=4" rel="nofollow">alipay.trade.refund</a> 接口封装</h6> 
  <blockquote> 
   <p>当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。 交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款 支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的商户订单号和设置不同的退款单号。一笔退款失败后重新提交，要采用原来的退款单号。总退款金额不能超过用户实际支付金额</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 退款
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.SAyEeI&amp;docType=4&amp;apiId=759
     * @param content
     * @return
     * @throws AlipayApiException
     */
    public static String tradeRefund(AlipayTradeRefundModel model) throws AlipayApiException{
        AlipayTradeRefundResponse response = tradeRefundToResponse(model);
        return response.getBody();
    }
    public static AlipayTradeRefundResponse tradeRefundToResponse(AlipayTradeRefundModel model) throws AlipayApiException{
        AlipayTradeRefundRequest request = new AlipayTradeRefundRequest();
        request.setBizModel(model);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.f06f37c4a5ac391652c17b7c6a376ee5" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 退款 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.SAyEeI&amp;docType=4&amp;apiId=759 *<span class="hljs-javadoctag"> @param</span> content *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">tradeRefund</span>(AlipayTradeRefundModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeRefundResponse response = tradeRefundToResponse(model);
        <span class="hljs-keyword">return</span> response.getBody();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeRefundResponse <span class="hljs-title">tradeRefundToResponse</span>(AlipayTradeRefundModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeRefundRequest request = <span class="hljs-keyword">new</span> AlipayTradeRefundRequest();
        request.setBizModel(model);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h6 id="333-alipaytradefastpayrefundquery接口封装">3.3.3 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=1049&amp;docType=4" rel="nofollow">alipay.trade.fastpay.refund.query</a>接口封装</h6> 
  <blockquote> 
   <p>商户可使用该接口查询自已通过alipay.trade.refund提交的退款请求是否执行成功。 该接口的返回码10000，仅代表本次查询操作成功，不代表退款成功。如果该接口返回了查询数据，则代表退款成功，如果没有查询到则代表未退款成功，可以调用退款接口进行重试。重试时请务必保证退款请求号一致。</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 退款查询
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.KQeTSa&amp;apiId=1049&amp;docType=4
     * @param model
     * @return
     * @throws AlipayApiException
     */
    public static String tradeRefundQuery(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{
        AlipayTradeFastpayRefundQueryResponse response = tradeRefundQueryToResponse(model);
        return response.getBody();
    }

    public static AlipayTradeFastpayRefundQueryResponse tradeRefundQueryToResponse(AlipayTradeFastpayRefundQueryModel model) throws AlipayApiException{
        AlipayTradeFastpayRefundQueryRequest request = new AlipayTradeFastpayRefundQueryRequest();
        request.setBizModel(model);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.995003145b79054b853761d4b67aa8ef" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 退款查询 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.KQeTSa&amp;apiId=1049&amp;docType=4 *<span class="hljs-javadoctag"> @param</span> model *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">tradeRefundQuery</span>(AlipayTradeFastpayRefundQueryModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeFastpayRefundQueryResponse response = tradeRefundQueryToResponse(model);
        <span class="hljs-keyword">return</span> response.getBody();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeFastpayRefundQueryResponse <span class="hljs-title">tradeRefundQueryToResponse</span>(AlipayTradeFastpayRefundQueryModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeFastpayRefundQueryRequest request = <span class="hljs-keyword">new</span> AlipayTradeFastpayRefundQueryRequest();
        request.setBizModel(model);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h6 id="334-alipaytradepay接口封装">3.3.4 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=850&amp;docType=4" rel="nofollow">alipay.trade.pay</a>接口封装</h6> 
  <blockquote> 
   <p>收银员使用扫码设备读取用户手机支付宝“付款码”/声波获取设备（如麦克风）读取用户手机支付宝的声波信息后，将二维码或条码信息/声波信息通过本接口上送至支付宝发起支付。</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 条形码支付、声波支付
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.XVqALk&amp;apiId=850&amp;docType=4
     * @param notifyUrl 
     * @throws AlipayApiException
     */
    public static String tradePay(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException {
        AlipayTradePayResponse response = tradePayToResponse(model,notifyUrl);
        return response.getBody();
    }

    public static AlipayTradePayResponse tradePayToResponse(AlipayTradePayModel model, String notifyUrl) throws AlipayApiException{
        AlipayTradePayRequest request = new AlipayTradePayRequest();
        request.setBizModel(model);// 填充业务参数
        request.setNotifyUrl(notifyUrl);
        return alipayClient.execute(request); // 通过alipayClient调用API，获得对应的response类
    }" data-snippet-id="ext.de44758388df261f199300aa36a33f60" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 条形码支付、声波支付 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.XVqALk&amp;apiId=850&amp;docType=4 *<span class="hljs-javadoctag"> @param</span> notifyUrl *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">tradePay</span>(AlipayTradePayModel model, String notifyUrl) <span class="hljs-keyword">throws</span> AlipayApiException {
        AlipayTradePayResponse response = tradePayToResponse(model,notifyUrl);
        <span class="hljs-keyword">return</span> response.getBody();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradePayResponse <span class="hljs-title">tradePayToResponse</span>(AlipayTradePayModel model, String notifyUrl) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradePayRequest request = <span class="hljs-keyword">new</span> AlipayTradePayRequest();
        request.setBizModel(model);<span class="hljs-comment">// 填充业务参数</span>
        request.setNotifyUrl(notifyUrl);
        <span class="hljs-keyword">return</span> alipayClient.execute(request); <span class="hljs-comment">// 通过alipayClient调用API，获得对应的response类</span>
    }</code></pre> 
  <h6 id="335-alipaytradeprecreate-接口封装">3.3.5 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=862&amp;docType=4" rel="nofollow">alipay.trade.precreate</a> 接口封装</h6> 
  <blockquote> 
   <p>收银员通过收银台或商户后台调用支付宝接口，生成二维码后，展示给用户，由用户扫描二维码完成订单支付。</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 扫码支付
     * https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.i0UVZn&amp;treeId=193&amp;articleId=105170&amp;docType=1#s4
     * @param notifyUrl 
     * @return
     * @throws AlipayApiException 
     */
    public static String tradePrecreatePay(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{
        AlipayTradePrecreateResponse response = tradePrecreatePayToResponse(model,notifyUrl);
        return response.getBody();
    }
    public static AlipayTradePrecreateResponse tradePrecreatePayToResponse(AlipayTradePrecreateModel model, String notifyUrl) throws AlipayApiException{
        AlipayTradePrecreateRequest request = new AlipayTradePrecreateRequest();
        request.setBizModel(model);
        request.setNotifyUrl(notifyUrl);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.3cf6efd986f735d37356641069671ac9" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 扫码支付 * https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.i0UVZn&amp;treeId=193&amp;articleId=105170&amp;docType=1#s4 *<span class="hljs-javadoctag"> @param</span> notifyUrl *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">tradePrecreatePay</span>(AlipayTradePrecreateModel model, String notifyUrl) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradePrecreateResponse response = tradePrecreatePayToResponse(model,notifyUrl);
        <span class="hljs-keyword">return</span> response.getBody();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradePrecreateResponse <span class="hljs-title">tradePrecreatePayToResponse</span>(AlipayTradePrecreateModel model, String notifyUrl) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradePrecreateRequest request = <span class="hljs-keyword">new</span> AlipayTradePrecreateRequest();
        request.setBizModel(model);
        request.setNotifyUrl(notifyUrl);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h6 id="336-alipaytradecancel-接口封装">3.3.6 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=866&amp;docType=4" rel="nofollow">alipay.trade.cancel</a> 接口封装</h6> 
  <blockquote> 
   <p>支付交易返回失败或支付系统超时，调用该接口撤销交易。如果此订单用户支付失败，支付宝系统会将此订单关闭；如果用户支付成功，支付宝系统会将此订单资金退还给用户。 <strong>注意</strong>：只有发生支付系统超时或者支付结果未知时可调用撤销，其他正常支付的单如需实现相同功能请调用申请退款API。提交支付交易后调用【查询订单API】，没有明确的支付结果再调用【撤销订单API】。</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 交易撤销接口
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.XInh6e&amp;docType=4&amp;apiId=866
     * @param bizContent
     * @return
     * @throws AlipayApiException
     */
    public static boolean isTradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{
        AlipayTradeCancelResponse response = tradeCancel(model);
        if(response.isSuccess()){
            return true;
        }
        return false;
    }

    public static AlipayTradeCancelResponse tradeCancel(AlipayTradeCancelModel model) throws AlipayApiException{
        AlipayTradeCancelRequest request = new AlipayTradeCancelRequest();
        request.setBizModel(model);
        AlipayTradeCancelResponse response = alipayClient.execute(request);
        return response;
    }" data-snippet-id="ext.76fbd44fda7a48d051e395e1bd5fb98c" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 交易撤销接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.XInh6e&amp;docType=4&amp;apiId=866 *<span class="hljs-javadoctag"> @param</span> bizContent *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isTradeCancel</span>(AlipayTradeCancelModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeCancelResponse response = tradeCancel(model);
        <span class="hljs-keyword">if</span>(response.isSuccess()){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeCancelResponse <span class="hljs-title">tradeCancel</span>(AlipayTradeCancelModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeCancelRequest request = <span class="hljs-keyword">new</span> AlipayTradeCancelRequest();
        request.setBizModel(model);
        AlipayTradeCancelResponse response = alipayClient.execute(request);
        <span class="hljs-keyword">return</span> response;
    }</code></pre> 
  <h6 id="337-alipaytradecreate-接口封装">3.3.7 <a href="https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1046&amp;docType=4" rel="nofollow">alipay.trade.create</a> 接口封装</h6> 
  <blockquote> 
   <p>商户通过该接口进行交易的创建下单</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 统一收单交易创建接口
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1046&amp;docType=4
     * @param model
     * @param notifyUrl 
     * @return
     * @throws AlipayApiException
     */
    public static AlipayTradeCreateResponse tradeCreate(AlipayTradeCreateModel model, String notifyUrl) throws AlipayApiException{
        AlipayTradeCreateRequest request = new AlipayTradeCreateRequest();
        request.setBizModel(model);
        request.setNotifyUrl(notifyUrl);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.bce8781ca1993c4efb71aa8c9813a7ae" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 统一收单交易创建接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1046&amp;docType=4 *<span class="hljs-javadoctag"> @param</span> model *<span class="hljs-javadoctag"> @param</span> notifyUrl *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeCreateResponse <span class="hljs-title">tradeCreate</span>(AlipayTradeCreateModel model, String notifyUrl) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeCreateRequest request = <span class="hljs-keyword">new</span> AlipayTradeCreateRequest();
        request.setBizModel(model);
        request.setNotifyUrl(notifyUrl);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h6 id="338-alipaytradeclose-接口封装">3.3.8 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=1058&amp;docType=4" rel="nofollow">alipay.trade.close</a> 接口封装</h6> 
  <blockquote> 
   <p>用于交易创建后，用户在一定时间内未进行支付，可调用该接口直接将未付款的交易进行关闭。</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 关闭订单
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1058&amp;docType=4
     * @param model
     * @return
     * @throws AlipayApiException
     */
    public static boolean isTradeClose(AlipayTradeCloseModel model) throws AlipayApiException{
        AlipayTradeCloseResponse response = tradeClose(model);
        if(response.isSuccess()){
            return true;
        }
        return false;
    }

    public static AlipayTradeCloseResponse tradeClose(AlipayTradeCloseModel model) throws AlipayApiException{
        AlipayTradeCloseRequest request = new AlipayTradeCloseRequest();
        request.setBizModel(model);
        return alipayClient.execute(request);

    }" data-snippet-id="ext.2a073ead71b5f8eb5c800e3e000fb9d9" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 关闭订单 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7629065.0.0.21yRUe&amp;apiId=1058&amp;docType=4 *<span class="hljs-javadoctag"> @param</span> model *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isTradeClose</span>(AlipayTradeCloseModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeCloseResponse response = tradeClose(model);
        <span class="hljs-keyword">if</span>(response.isSuccess()){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeCloseResponse <span class="hljs-title">tradeClose</span>(AlipayTradeCloseModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeCloseRequest request = <span class="hljs-keyword">new</span> AlipayTradeCloseRequest();
        request.setBizModel(model);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);

    }</code></pre> 
  <h6 id="339-alipaytradeordersettle接口封装">3.3.9 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=1147&amp;docType=4" rel="nofollow">alipay.trade.order.settle</a>接口封装</h6> 
  <blockquote> 
   <p>用于在线下场景交易支付后，进行结算</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 交易结算接口
     * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.nl0RS3&amp;docType=4&amp;apiId=1147
     * @param bizContent
     * @return
     * @throws AlipayApiException
     */
    public static boolean isTradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{
        AlipayTradeOrderSettleResponse  response  = tradeOrderSettle(model);
        if(response.isSuccess()){
            return true;
        }
        return false;
    }

    public static AlipayTradeOrderSettleResponse tradeOrderSettle(AlipayTradeOrderSettleModel model) throws AlipayApiException{
        AlipayTradeOrderSettleRequest request = new AlipayTradeOrderSettleRequest();
        request.setBizModel(model);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.ec3ccd58c2880de75b8606b5fb9f04d8" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 交易结算接口 * https://doc.open.alipay.com/docs/api.htm?spm=a219a.7395905.0.0.nl0RS3&amp;docType=4&amp;apiId=1147 *<span class="hljs-javadoctag"> @param</span> bizContent *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isTradeOrderSettle</span>(AlipayTradeOrderSettleModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeOrderSettleResponse  response  = tradeOrderSettle(model);
        <span class="hljs-keyword">if</span>(response.isSuccess()){
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayTradeOrderSettleResponse <span class="hljs-title">tradeOrderSettle</span>(AlipayTradeOrderSettleModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayTradeOrderSettleRequest request = <span class="hljs-keyword">new</span> AlipayTradeOrderSettleRequest();
        request.setBizModel(model);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h6 id="3310-alipayfundtranstoaccounttransfer接口封装">3.3.10 <a href="https://doc.open.alipay.com/docs/api.htm?apiId=1321&amp;docType=4" rel="nofollow">alipay.fund.trans.toaccount.transfer</a>接口封装</h6> 
  <p>可以参考 <a href="http://blog.csdn.net/zyw_java/article/details/71598711" rel="nofollow">支付宝支付-提现到个人支付宝</a></p> 
  <h6 id="3311-alipayfundtransorderquery接口封装">3.3.11 <a href="https://doc.open.alipay.com/docs/api.htm?docType=4&amp;apiId=1322" rel="nofollow">alipay.fund.trans.order.query</a>接口封装</h6> 
  <p>可以参考 <a href="http://blog.csdn.net/zyw_java/article/details/71598711" rel="nofollow">支付宝支付-提现到个人支付宝</a></p> 
  <h5 id="3312-alipaydatadataservicebilldownloadurlquery-接口封装">3.3.12 <a href="https://doc.open.alipay.com/docs/api.htm?spm=a219a.7386797.0.0.xflPSt&amp;docType=4&amp;apiId=1054" rel="nofollow">alipay.data.dataservice.bill.downloadurl.query</a> 接口封装</h5> 
  <blockquote> 
   <p>为方便商户快速查账，支持商户通过本接口获取商户离线账单下载地址</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 查询对账单下载地址
     * @param bizContent
     * @return
     * @throws AlipayApiException
     */
    public static String billDownloadurlQuery(AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{
        AlipayDataDataserviceBillDownloadurlQueryResponse response =  billDownloadurlQueryToResponse(model);
        return response.getBillDownloadUrl();
    }

    public static AlipayDataDataserviceBillDownloadurlQueryResponse  billDownloadurlQueryToResponse (AlipayDataDataserviceBillDownloadurlQueryModel model) throws AlipayApiException{
        AlipayDataDataserviceBillDownloadurlQueryRequest request = new AlipayDataDataserviceBillDownloadurlQueryRequest();
        request.setBizModel(model);
        return alipayClient.execute(request);
    }" data-snippet-id="ext.34676ab7c77bb5efaa75943eb0171699" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 查询对账单下载地址 *<span class="hljs-javadoctag"> @param</span> bizContent *<span class="hljs-javadoctag"> @return</span> *<span class="hljs-javadoctag"> @throws</span> AlipayApiException */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">billDownloadurlQuery</span>(AlipayDataDataserviceBillDownloadurlQueryModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayDataDataserviceBillDownloadurlQueryResponse response =  billDownloadurlQueryToResponse(model);
        <span class="hljs-keyword">return</span> response.getBillDownloadUrl();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AlipayDataDataserviceBillDownloadurlQueryResponse  <span class="hljs-title">billDownloadurlQueryToResponse</span> (AlipayDataDataserviceBillDownloadurlQueryModel model) <span class="hljs-keyword">throws</span> AlipayApiException{
        AlipayDataDataserviceBillDownloadurlQueryRequest request = <span class="hljs-keyword">new</span> AlipayDataDataserviceBillDownloadurlQueryRequest();
        request.setBizModel(model);
        <span class="hljs-keyword">return</span> alipayClient.execute(request);
    }</code></pre> 
  <h4 id="4异步通知封装">4、异步通知封装</h4> 
  <blockquote> 
   <p>将异步通知的参数转化为Map为验签做准备</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="/**
     * 将异步通知的参数转化为Map
     * @param request
     * @return
     */
    public static Map<String, String> toMap(HttpServletRequest request) {
        System.out.println(&quot;>>>>&quot; + request.getQueryString());
        Map<String, String> params = new HashMap<String, String>();
        Map<String, String[]> requestParams = request.getParameterMap();
        for (Iterator<String> iter = requestParams.keySet().iterator(); iter.hasNext();) {
            String name = (String) iter.next();
            String[] values = (String[]) requestParams.get(name);
            String valueStr = &quot;&quot;;
            for (int i = 0; i < values.length; i++) {
                valueStr = (i == values.length - 1) ? valueStr + values[i] : valueStr + values[i] + &quot;,&quot;;
            }
            // 乱码解决，这段代码在出现乱码时使用。
            // valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;);
            params.put(name, valueStr);
        }
        return params;
    }" data-snippet-id="ext.fcfa3bb8273c208971e4c881dcfef78a" data-snippet-saved="false" data-codota-status="done"><code class=" hljs java"><span class="hljs-javadoc">/** * 将异步通知的参数转化为Map *<span class="hljs-javadoctag"> @param</span> request *<span class="hljs-javadoctag"> @return</span> */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, String&gt; <span class="hljs-title">toMap</span>(HttpServletRequest request) {
        System.out.println(<span class="hljs-string">"&gt;&gt;&gt;&gt;"</span> + request.getQueryString());
        Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;();
        Map&lt;String, String[]&gt; requestParams = request.getParameterMap();
        <span class="hljs-keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) {
            String name = (String) iter.next();
            String[] values = (String[]) requestParams.get(name);
            String valueStr = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; values.length; i++) {
                valueStr = (i == values.length - <span class="hljs-number">1</span>) ? valueStr + values[i] : valueStr + values[i] + <span class="hljs-string">","</span>;
            }
            <span class="hljs-comment">// 乱码解决，这段代码在出现乱码时使用。</span>
            <span class="hljs-comment">// valueStr = new String(valueStr.getBytes("ISO-8859-1"), "utf-8");</span>
            params.put(name, valueStr);
        }
        <span class="hljs-keyword">return</span> params;
    }</code></pre> 
  <blockquote> 
   <p>使用<code>AlipaySignature.rsaCheckV1(....)</code>接口进行验证签名</p> 
  </blockquote> 
  <div class="top-box hide">
   <div class="alert-info"></div>
  </div>
  <pre class="prettyprint prettyprinted" data-original-code="public void notify_url() {
        try {
            // 获取支付宝POST过来反馈信息
            Map<String, String> params = AliPayApi.toMap(getRequest());

            for (Map.Entry<String, String> entry : params.entrySet()) {
                System.out.println(entry.getKey() + &quot; = &quot; + entry.getValue());
            }

            boolean verify_result = AlipaySignature.rsaCheckV1(params, AliPayApi.ALIPAY_PUBLIC_KEY, AliPayApi.CHARSET,
                    AliPayApi.SIGN_TYPE);

            if (verify_result) {// 验证成功
                // TODO 请在这里加上商户的业务逻辑程序代码 异步通知可能出现订单重复通知 需要做去重处理
                System.out.println(&quot;notify_url 验证成功succcess&quot;);
                renderText(&quot;success&quot;);
                return;
            } else {
                System.out.println(&quot;notify_url 验证失败&quot;);
                // TODO
                renderText(&quot;failure&quot;);
                return;
            }
        } catch (AlipayApiException e) {
            e.printStackTrace();
            renderText(&quot;failure&quot;);
        }
    }" data-snippet-id="ext.9ffa235d61d9fc29942cd3436763c19e" data-snippet-saved="false" data-codota-status="done"><code class=" hljs cs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notify_url</span>() {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取支付宝POST过来反馈信息</span>
            Map&lt;String, String&gt; <span class="hljs-keyword">params</span> = AliPayApi.toMap(getRequest());

            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : <span class="hljs-keyword">params</span>.entrySet()) {
                System.<span class="hljs-keyword">out</span>.println(entry.getKey() + <span class="hljs-string">" = "</span> + entry.getValue());
            }

            boolean verify_result = AlipaySignature.rsaCheckV1(<span class="hljs-keyword">params</span>, AliPayApi.ALIPAY_PUBLIC_KEY, AliPayApi.CHARSET,
                    AliPayApi.SIGN_TYPE);

            <span class="hljs-keyword">if</span> (verify_result) {<span class="hljs-comment">// 验证成功</span>
                <span class="hljs-comment">// TODO 请在这里加上商户的业务逻辑程序代码 异步通知可能出现订单重复通知 需要做去重处理</span>
                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"notify_url 验证成功succcess"</span>);
                renderText(<span class="hljs-string">"success"</span>);
                <span class="hljs-keyword">return</span>;
            } <span class="hljs-keyword">else</span> {
                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"notify_url 验证失败"</span>);
                <span class="hljs-comment">// TODO</span>
                renderText(<span class="hljs-string">"failure"</span>);
                <span class="hljs-keyword">return</span>;
            }
        } <span class="hljs-keyword">catch</span> (AlipayApiException e) {
            e.printStackTrace();
            renderText(<span class="hljs-string">"failure"</span>);
        }
    }</code></pre> 
  <p>此项目已开源欢迎Start、PR、发起Issues一起讨论交流共同进步</p> 
  <p><a href="https://github.com/Javen205/IJPay" rel="nofollow">https://github.com/Javen205/IJPay</a> <br> <a href="http://git.oschina.net/javen205/IJPay" rel="nofollow">http://git.oschina.net/javen205/IJPay</a></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7f770a53f2.css" rel="stylesheet"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zyw_java/article/details/71844328,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/zyw_java/article/details/71844328,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

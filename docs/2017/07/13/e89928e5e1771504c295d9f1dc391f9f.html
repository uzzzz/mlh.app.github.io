<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>银联二维码支付之主扫、被扫、查询接口-寒风的博客(屌丝程序猿) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="银联二维码支付之主扫、被扫、查询接口-寒风的博客(屌丝程序猿)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanfengzqh/article/details/75043052 最近在做银联二维码支付Android端相关项目，因为中国银联网站上并未提供Android端demo,只提供了Java相关demo，只能是根据自己的业务需求去更改，开始看银联的开发文档觉得一脸懵逼，看不懂，后来经过深入分析，才知道自己没有理清步骤，在本篇文档中先介绍一下，银联二维码的主扫、被扫以及查询接口，后续会在介绍退货、冲证、撤销等相关接口。 银联Java提供的SDK目录如下: 在MainActivity中或者Application中先调用：SDKConfig.getConfig().loadPropertiesFromSrc(this);加载工程所需的相关密钥证书，这些证书密钥Java工程是通过classPath路径加载的，但是在Android项目中可以放在assets文件贾或者其他的本地目录中，在此我将这些证书密钥放在了assets中，便于去加载。此外还要将相关的jar包取出来放在项目中 当然，这些jar包在银联提供的java的Demo中都是有的。 一、主扫 package com.zng.unionpayqr.msqr; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; import com.zng.unionpayqr.utils.DemoBase; import com.zng.unionpayqr.utils.RandomUtil; public class QRMainSweepUtil { /**QR主扫*/ public static void qrMainSweep(){ Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ contentData.put(&quot;version&quot;, DemoBase.version); //版本号 全渠道默认值 contentData.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 contentData.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 contentData.put(&quot;txnType&quot;, &quot;01&quot;); //交易类型 01:消费 contentData.put(&quot;txnSubType&quot;, &quot;07&quot;); //交易子类 07：申请消费二维码 contentData.put(&quot;bizType&quot;, &quot;000000&quot;); //填写000000 contentData.put(&quot;channelType&quot;, &quot;08&quot;); //渠道类型 08手机 /***商户接入参数***/ contentData.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 contentData.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户） contentData.put(&quot;orderId&quot;, RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则 contentData.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效 contentData.put(&quot;txnAmt&quot;, &quot;1&quot;); //交易金额 单位为分，不能带小数点 contentData.put(&quot;currencyCode&quot;, &quot;156&quot;); //境内商户固定 156 人民币 contentData.put(&quot;backUrl&quot;, DemoBase.backUrl); /**对请求参数进行签名并发送http post请求，接收同步应答报文**/ Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); Log.d(&quot;zqh&quot;, &quot;rspData = &quot;+rspData); /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); String respCode = rspData.get(&quot;respCode&quot;) ; if((&quot;00&quot;).equals(respCode)){ //成功,获取tn号 String qrCode = rspData.get(&quot;qrCode&quot;); Log.e(&quot;zqh&quot;, &quot;qrCode = &quot;+qrCode); }else{ //其他应答码为失败请排查原因或做失败处理 } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 二、被扫 package com.zng.unionpayqr.qrss; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; import com.zng.unionpayqr.utils.DemoBase; import com.zng.unionpayqr.utils.RandomUtil; /** * QR被扫 * @author zqh * */ public class QRIsSweptUtil { /**QR被扫*/ public static void qrIsSwept(String C2BCode){ Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ contentData.put(&quot;version&quot;, DemoBase.version); //版本号 全渠道默认值 contentData.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 contentData.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 contentData.put(&quot;txnType&quot;, &quot;01&quot;); //交易类型 01:消费 contentData.put(&quot;txnSubType&quot;, &quot;06&quot;); //交易子类 07：申请消费二维码 contentData.put(&quot;bizType&quot;, &quot;000000&quot;); //填写000000 contentData.put(&quot;channelType&quot;, &quot;08&quot;); //渠道类型 08手机 /***商户接入参数***/ contentData.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 contentData.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户） contentData.put(&quot;qrNo&quot;, C2BCode); contentData.put(&quot;orderId&quot;, RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则 contentData.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效 contentData.put(&quot;txnAmt&quot;, &quot;1&quot;); //交易金额 单位为分，不能带小数点 contentData.put(&quot;currencyCode&quot;, &quot;156&quot;); //境内商户固定 156 人民币 contentData.put(&quot;backUrl&quot;, DemoBase.backUrl); /**对请求参数进行签名并发送http post请求，接收同步应答报文**/ Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); Log.d(&quot;zqh&quot;, &quot;rspData = &quot;+rspData); /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); String respCode = rspData.get(&quot;respCode&quot;) ; if((&quot;00&quot;).equals(respCode)){ //成功,获取tn号 String qrCode = rspData.get(&quot;qrCode&quot;); Log.e(&quot;zqh&quot;, &quot;qrCode = &quot;+qrCode); }else{ //其他应答码为失败请排查原因或做失败处理 } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 三、查询 package com.zng.unionpayqr.utils; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; public class QueryUtil { public static void query(){ Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ data.put(&quot;version&quot;, DemoBase.version); //版本号 data.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 data.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 data.put(&quot;txnType&quot;, &quot;00&quot;); //交易类型 00-默认 data.put(&quot;txnSubType&quot;, &quot;00&quot;); //交易子类型 默认00 data.put(&quot;bizType&quot;, &quot;000201&quot;); //业务类型 /***商户接入参数***/ data.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 data.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入固定填0，不需修改 /***要调通交易以下字段必须修改***/ data.put(&quot;orderId&quot;, &quot;20170712055720002&quot;); //****商户订单号，每次发交易测试需修改为被查询的交易的订单号 data.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //****订单发送时间，每次发交易测试需修改为被查询的交易的订单发送时间 /**请求参数设置完毕，以下对请求参数进行签名并发送http post请求，接收同步应答报文-------------&gt;**/ Map&lt;String, String&gt; reqData = AcpService.sign(data,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String url = SDKConfig.getConfig().getSingleQueryUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.singleQueryUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData, url,DemoBase.encoding); //发送请求报文并接受同步应答（默认连接超时时间30秒，读取返回结果超时时间30秒）;这里调用signData之后，调用submitUrl之前不能对submitFromData中的键值对做任何修改，如果修改会导致验签不通过 /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); if((&quot;00&quot;).equals(rspData.get(&quot;respCode&quot;))){//如果查询交易成功 String origRespCode = rspData.get(&quot;origRespCode&quot;); if((&quot;00&quot;).equals(origRespCode)){ //交易成功，更新商户订单状态 //TODO }else if((&quot;03&quot;).equals(origRespCode)|| (&quot;04&quot;).equals(origRespCode)|| (&quot;05&quot;).equals(origRespCode)){ //订单处理中或交易状态未明，需稍后发起交易状态查询交易 【如果最终尚未确定交易是否成功请以对账文件为准】 //TODO }else{ //其他应答码为交易失败 //TODO } }else if((&quot;34&quot;).equals(rspData.get(&quot;respCode&quot;))){ //订单不存在，可认为交易状态未明，需要稍后发起交易状态查询，或依据对账结果为准 }else{//查询交易本身失败，如应答码10/11检查查询报文是否正确 //TODO } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;交易状态查询交易&lt;/br&gt;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 银联测试地址: 商户接入银联全渠道二维码测试：主扫场景:商户参考demo生成二维码后，请使用银联提供的主扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp发送查询订单和付款交易完成付款。被扫场景：请先使用银联提供的被扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp中的C2B码申请交易，申请二维码得到qrNo，然后参考demo完成扫码消费交易。测试过程中请使用我们提供的测试卡进行测试，测试卡信息：https://open.unionpay.com/ajweb/help/faq/list?id=4&amp;level=0&amp;from=0&amp;keyword=%E6%B5%8B%E8%AF%95%E5%8D%A1 以下是相关的Demo链接欢迎下载。 点击打开链接 github完整项目连接:https://github.com/hanfengzqh/UnionPayQR 阅读更多" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanfengzqh/article/details/75043052 最近在做银联二维码支付Android端相关项目，因为中国银联网站上并未提供Android端demo,只提供了Java相关demo，只能是根据自己的业务需求去更改，开始看银联的开发文档觉得一脸懵逼，看不懂，后来经过深入分析，才知道自己没有理清步骤，在本篇文档中先介绍一下，银联二维码的主扫、被扫以及查询接口，后续会在介绍退货、冲证、撤销等相关接口。 银联Java提供的SDK目录如下: 在MainActivity中或者Application中先调用：SDKConfig.getConfig().loadPropertiesFromSrc(this);加载工程所需的相关密钥证书，这些证书密钥Java工程是通过classPath路径加载的，但是在Android项目中可以放在assets文件贾或者其他的本地目录中，在此我将这些证书密钥放在了assets中，便于去加载。此外还要将相关的jar包取出来放在项目中 当然，这些jar包在银联提供的java的Demo中都是有的。 一、主扫 package com.zng.unionpayqr.msqr; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; import com.zng.unionpayqr.utils.DemoBase; import com.zng.unionpayqr.utils.RandomUtil; public class QRMainSweepUtil { /**QR主扫*/ public static void qrMainSweep(){ Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ contentData.put(&quot;version&quot;, DemoBase.version); //版本号 全渠道默认值 contentData.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 contentData.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 contentData.put(&quot;txnType&quot;, &quot;01&quot;); //交易类型 01:消费 contentData.put(&quot;txnSubType&quot;, &quot;07&quot;); //交易子类 07：申请消费二维码 contentData.put(&quot;bizType&quot;, &quot;000000&quot;); //填写000000 contentData.put(&quot;channelType&quot;, &quot;08&quot;); //渠道类型 08手机 /***商户接入参数***/ contentData.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 contentData.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户） contentData.put(&quot;orderId&quot;, RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则 contentData.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效 contentData.put(&quot;txnAmt&quot;, &quot;1&quot;); //交易金额 单位为分，不能带小数点 contentData.put(&quot;currencyCode&quot;, &quot;156&quot;); //境内商户固定 156 人民币 contentData.put(&quot;backUrl&quot;, DemoBase.backUrl); /**对请求参数进行签名并发送http post请求，接收同步应答报文**/ Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); Log.d(&quot;zqh&quot;, &quot;rspData = &quot;+rspData); /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); String respCode = rspData.get(&quot;respCode&quot;) ; if((&quot;00&quot;).equals(respCode)){ //成功,获取tn号 String qrCode = rspData.get(&quot;qrCode&quot;); Log.e(&quot;zqh&quot;, &quot;qrCode = &quot;+qrCode); }else{ //其他应答码为失败请排查原因或做失败处理 } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 二、被扫 package com.zng.unionpayqr.qrss; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; import com.zng.unionpayqr.utils.DemoBase; import com.zng.unionpayqr.utils.RandomUtil; /** * QR被扫 * @author zqh * */ public class QRIsSweptUtil { /**QR被扫*/ public static void qrIsSwept(String C2BCode){ Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ contentData.put(&quot;version&quot;, DemoBase.version); //版本号 全渠道默认值 contentData.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 contentData.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 contentData.put(&quot;txnType&quot;, &quot;01&quot;); //交易类型 01:消费 contentData.put(&quot;txnSubType&quot;, &quot;06&quot;); //交易子类 07：申请消费二维码 contentData.put(&quot;bizType&quot;, &quot;000000&quot;); //填写000000 contentData.put(&quot;channelType&quot;, &quot;08&quot;); //渠道类型 08手机 /***商户接入参数***/ contentData.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 contentData.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户） contentData.put(&quot;qrNo&quot;, C2BCode); contentData.put(&quot;orderId&quot;, RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则 contentData.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效 contentData.put(&quot;txnAmt&quot;, &quot;1&quot;); //交易金额 单位为分，不能带小数点 contentData.put(&quot;currencyCode&quot;, &quot;156&quot;); //境内商户固定 156 人民币 contentData.put(&quot;backUrl&quot;, DemoBase.backUrl); /**对请求参数进行签名并发送http post请求，接收同步应答报文**/ Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); Log.d(&quot;zqh&quot;, &quot;rspData = &quot;+rspData); /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); String respCode = rspData.get(&quot;respCode&quot;) ; if((&quot;00&quot;).equals(respCode)){ //成功,获取tn号 String qrCode = rspData.get(&quot;qrCode&quot;); Log.e(&quot;zqh&quot;, &quot;qrCode = &quot;+qrCode); }else{ //其他应答码为失败请排查原因或做失败处理 } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 三、查询 package com.zng.unionpayqr.utils; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; public class QueryUtil { public static void query(){ Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ data.put(&quot;version&quot;, DemoBase.version); //版本号 data.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 data.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 data.put(&quot;txnType&quot;, &quot;00&quot;); //交易类型 00-默认 data.put(&quot;txnSubType&quot;, &quot;00&quot;); //交易子类型 默认00 data.put(&quot;bizType&quot;, &quot;000201&quot;); //业务类型 /***商户接入参数***/ data.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 data.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入固定填0，不需修改 /***要调通交易以下字段必须修改***/ data.put(&quot;orderId&quot;, &quot;20170712055720002&quot;); //****商户订单号，每次发交易测试需修改为被查询的交易的订单号 data.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //****订单发送时间，每次发交易测试需修改为被查询的交易的订单发送时间 /**请求参数设置完毕，以下对请求参数进行签名并发送http post请求，接收同步应答报文-------------&gt;**/ Map&lt;String, String&gt; reqData = AcpService.sign(data,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String url = SDKConfig.getConfig().getSingleQueryUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.singleQueryUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData, url,DemoBase.encoding); //发送请求报文并接受同步应答（默认连接超时时间30秒，读取返回结果超时时间30秒）;这里调用signData之后，调用submitUrl之前不能对submitFromData中的键值对做任何修改，如果修改会导致验签不通过 /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); if((&quot;00&quot;).equals(rspData.get(&quot;respCode&quot;))){//如果查询交易成功 String origRespCode = rspData.get(&quot;origRespCode&quot;); if((&quot;00&quot;).equals(origRespCode)){ //交易成功，更新商户订单状态 //TODO }else if((&quot;03&quot;).equals(origRespCode)|| (&quot;04&quot;).equals(origRespCode)|| (&quot;05&quot;).equals(origRespCode)){ //订单处理中或交易状态未明，需稍后发起交易状态查询交易 【如果最终尚未确定交易是否成功请以对账文件为准】 //TODO }else{ //其他应答码为交易失败 //TODO } }else if((&quot;34&quot;).equals(rspData.get(&quot;respCode&quot;))){ //订单不存在，可认为交易状态未明，需要稍后发起交易状态查询，或依据对账结果为准 }else{//查询交易本身失败，如应答码10/11检查查询报文是否正确 //TODO } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;交易状态查询交易&lt;/br&gt;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 银联测试地址: 商户接入银联全渠道二维码测试：主扫场景:商户参考demo生成二维码后，请使用银联提供的主扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp发送查询订单和付款交易完成付款。被扫场景：请先使用银联提供的被扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp中的C2B码申请交易，申请二维码得到qrNo，然后参考demo完成扫码消费交易。测试过程中请使用我们提供的测试卡进行测试，测试卡信息：https://open.unionpay.com/ajweb/help/faq/list?id=4&amp;level=0&amp;from=0&amp;keyword=%E6%B5%8B%E8%AF%95%E5%8D%A1 以下是相关的Demo链接欢迎下载。 点击打开链接 github完整项目连接:https://github.com/hanfengzqh/UnionPayQR 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/07/13/e89928e5e1771504c295d9f1dc391f9f.html" />
<meta property="og:url" content="https://mlh.app/2017/07/13/e89928e5e1771504c295d9f1dc391f9f.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-13T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanfengzqh/article/details/75043052 最近在做银联二维码支付Android端相关项目，因为中国银联网站上并未提供Android端demo,只提供了Java相关demo，只能是根据自己的业务需求去更改，开始看银联的开发文档觉得一脸懵逼，看不懂，后来经过深入分析，才知道自己没有理清步骤，在本篇文档中先介绍一下，银联二维码的主扫、被扫以及查询接口，后续会在介绍退货、冲证、撤销等相关接口。 银联Java提供的SDK目录如下: 在MainActivity中或者Application中先调用：SDKConfig.getConfig().loadPropertiesFromSrc(this);加载工程所需的相关密钥证书，这些证书密钥Java工程是通过classPath路径加载的，但是在Android项目中可以放在assets文件贾或者其他的本地目录中，在此我将这些证书密钥放在了assets中，便于去加载。此外还要将相关的jar包取出来放在项目中 当然，这些jar包在银联提供的java的Demo中都是有的。 一、主扫 package com.zng.unionpayqr.msqr; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; import com.zng.unionpayqr.utils.DemoBase; import com.zng.unionpayqr.utils.RandomUtil; public class QRMainSweepUtil { /**QR主扫*/ public static void qrMainSweep(){ Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ contentData.put(&quot;version&quot;, DemoBase.version); //版本号 全渠道默认值 contentData.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 contentData.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 contentData.put(&quot;txnType&quot;, &quot;01&quot;); //交易类型 01:消费 contentData.put(&quot;txnSubType&quot;, &quot;07&quot;); //交易子类 07：申请消费二维码 contentData.put(&quot;bizType&quot;, &quot;000000&quot;); //填写000000 contentData.put(&quot;channelType&quot;, &quot;08&quot;); //渠道类型 08手机 /***商户接入参数***/ contentData.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 contentData.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户） contentData.put(&quot;orderId&quot;, RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则 contentData.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效 contentData.put(&quot;txnAmt&quot;, &quot;1&quot;); //交易金额 单位为分，不能带小数点 contentData.put(&quot;currencyCode&quot;, &quot;156&quot;); //境内商户固定 156 人民币 contentData.put(&quot;backUrl&quot;, DemoBase.backUrl); /**对请求参数进行签名并发送http post请求，接收同步应答报文**/ Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); Log.d(&quot;zqh&quot;, &quot;rspData = &quot;+rspData); /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); String respCode = rspData.get(&quot;respCode&quot;) ; if((&quot;00&quot;).equals(respCode)){ //成功,获取tn号 String qrCode = rspData.get(&quot;qrCode&quot;); Log.e(&quot;zqh&quot;, &quot;qrCode = &quot;+qrCode); }else{ //其他应答码为失败请排查原因或做失败处理 } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 二、被扫 package com.zng.unionpayqr.qrss; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; import com.zng.unionpayqr.utils.DemoBase; import com.zng.unionpayqr.utils.RandomUtil; /** * QR被扫 * @author zqh * */ public class QRIsSweptUtil { /**QR被扫*/ public static void qrIsSwept(String C2BCode){ Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ contentData.put(&quot;version&quot;, DemoBase.version); //版本号 全渠道默认值 contentData.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 contentData.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 contentData.put(&quot;txnType&quot;, &quot;01&quot;); //交易类型 01:消费 contentData.put(&quot;txnSubType&quot;, &quot;06&quot;); //交易子类 07：申请消费二维码 contentData.put(&quot;bizType&quot;, &quot;000000&quot;); //填写000000 contentData.put(&quot;channelType&quot;, &quot;08&quot;); //渠道类型 08手机 /***商户接入参数***/ contentData.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 contentData.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户） contentData.put(&quot;qrNo&quot;, C2BCode); contentData.put(&quot;orderId&quot;, RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则 contentData.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效 contentData.put(&quot;txnAmt&quot;, &quot;1&quot;); //交易金额 单位为分，不能带小数点 contentData.put(&quot;currencyCode&quot;, &quot;156&quot;); //境内商户固定 156 人民币 contentData.put(&quot;backUrl&quot;, DemoBase.backUrl); /**对请求参数进行签名并发送http post请求，接收同步应答报文**/ Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); Log.d(&quot;zqh&quot;, &quot;rspData = &quot;+rspData); /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); String respCode = rspData.get(&quot;respCode&quot;) ; if((&quot;00&quot;).equals(respCode)){ //成功,获取tn号 String qrCode = rspData.get(&quot;qrCode&quot;); Log.e(&quot;zqh&quot;, &quot;qrCode = &quot;+qrCode); }else{ //其他应答码为失败请排查原因或做失败处理 } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 三、查询 package com.zng.unionpayqr.utils; import java.util.HashMap; import java.util.Map; import android.util.Log; import com.zng.unionpayqr.sdk.AcpService; import com.zng.unionpayqr.sdk.LogUtil; import com.zng.unionpayqr.sdk.SDKConfig; public class QueryUtil { public static void query(){ Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;(); /***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/ data.put(&quot;version&quot;, DemoBase.version); //版本号 data.put(&quot;encoding&quot;, DemoBase.encoding); //字符集编码 可以使用UTF-8,GBK两种方式 data.put(&quot;signMethod&quot;, SDKConfig.getConfig().getSignMethod()); //签名方法 data.put(&quot;txnType&quot;, &quot;00&quot;); //交易类型 00-默认 data.put(&quot;txnSubType&quot;, &quot;00&quot;); //交易子类型 默认00 data.put(&quot;bizType&quot;, &quot;000201&quot;); //业务类型 /***商户接入参数***/ data.put(&quot;merId&quot;, &quot;777290058149059&quot;); //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试 data.put(&quot;accessType&quot;, &quot;0&quot;); //接入类型，商户接入固定填0，不需修改 /***要调通交易以下字段必须修改***/ data.put(&quot;orderId&quot;, &quot;20170712055720002&quot;); //****商户订单号，每次发交易测试需修改为被查询的交易的订单号 data.put(&quot;txnTime&quot;, DemoBase.getCurrentTime()); //****订单发送时间，每次发交易测试需修改为被查询的交易的订单发送时间 /**请求参数设置完毕，以下对请求参数进行签名并发送http post请求，接收同步应答报文-------------&gt;**/ Map&lt;String, String&gt; reqData = AcpService.sign(data,DemoBase.encoding); //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。 String url = SDKConfig.getConfig().getSingleQueryUrl(); //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.singleQueryUrl Map&lt;String, String&gt; rspData = AcpService.post(reqData, url,DemoBase.encoding); //发送请求报文并接受同步应答（默认连接超时时间30秒，读取返回结果超时时间30秒）;这里调用signData之后，调用submitUrl之前不能对submitFromData中的键值对做任何修改，如果修改会导致验签不通过 /**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/ //应答码规范参考open.unionpay.com帮助中心 下载 产品接口规范 《平台接入接口规范-第5部分-附录》 if(!rspData.isEmpty()){ if(AcpService.validate(rspData, DemoBase.encoding)){ LogUtil.writeLog(&quot;验证签名成功&quot;); if((&quot;00&quot;).equals(rspData.get(&quot;respCode&quot;))){//如果查询交易成功 String origRespCode = rspData.get(&quot;origRespCode&quot;); if((&quot;00&quot;).equals(origRespCode)){ //交易成功，更新商户订单状态 //TODO }else if((&quot;03&quot;).equals(origRespCode)|| (&quot;04&quot;).equals(origRespCode)|| (&quot;05&quot;).equals(origRespCode)){ //订单处理中或交易状态未明，需稍后发起交易状态查询交易 【如果最终尚未确定交易是否成功请以对账文件为准】 //TODO }else{ //其他应答码为交易失败 //TODO } }else if((&quot;34&quot;).equals(rspData.get(&quot;respCode&quot;))){ //订单不存在，可认为交易状态未明，需要稍后发起交易状态查询，或依据对账结果为准 }else{//查询交易本身失败，如应答码10/11检查查询报文是否正确 //TODO } }else{ LogUtil.writeErrorLog(&quot;验证签名失败&quot;); //TODO 检查验证签名失败的原因 } }else{ //未返回正确的http状态 LogUtil.writeErrorLog(&quot;未获取到返回报文或返回http状态码非200&quot;); } String reqMessage = DemoBase.genHtmlResult(reqData); String rspMessage = DemoBase.genHtmlResult(rspData); Log.e(&quot;zqh&quot;,&quot;交易状态查询交易&lt;/br&gt;请求报文:&lt;br/&gt;&quot;+reqMessage+&quot;&lt;br/&gt;&quot; + &quot;应答报文:&lt;/br&gt;&quot;+rspMessage+&quot;&quot;); } } 银联测试地址: 商户接入银联全渠道二维码测试：主扫场景:商户参考demo生成二维码后，请使用银联提供的主扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp发送查询订单和付款交易完成付款。被扫场景：请先使用银联提供的被扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp中的C2B码申请交易，申请二维码得到qrNo，然后参考demo完成扫码消费交易。测试过程中请使用我们提供的测试卡进行测试，测试卡信息：https://open.unionpay.com/ajweb/help/faq/list?id=4&amp;level=0&amp;from=0&amp;keyword=%E6%B5%8B%E8%AF%95%E5%8D%A1 以下是相关的Demo链接欢迎下载。 点击打开链接 github完整项目连接:https://github.com/hanfengzqh/UnionPayQR 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/07/13/e89928e5e1771504c295d9f1dc391f9f.html","headline":"银联二维码支付之主扫、被扫、查询接口-寒风的博客(屌丝程序猿)","dateModified":"2017-07-13T00:00:00+08:00","datePublished":"2017-07-13T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/07/13/e89928e5e1771504c295d9f1dc391f9f.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>银联二维码支付之主扫、被扫、查询接口-寒风的博客(屌丝程序猿)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。 https://blog.csdn.net/hanfengzqh/article/details/75043052 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-7f5a1a725b.css"> 
 <div class="htmledit_views"> 
  <p>最近在做银联二维码支付Android端相关项目，因为中国银联网站上并未提供Android端demo,只提供了Java相关demo，只能是根据自己的业务需求去更改，开始看银联的开发文档觉得一脸懵逼，看不懂，后来经过深入分析，才知道自己没有理清步骤，在本篇文档中先介绍一下，银联二维码的主扫、被扫以及查询接口，后续会在介绍退货、冲证、撤销等相关接口。</p> 
  <p>银联Java提供的SDK目录如下:</p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170713093118962?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFuZmVuZ3pxaA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" width="200" height="300" alt=""><br></p> 
  <p>在MainActivity中或者Application中先调用：SDKConfig.getConfig().loadPropertiesFromSrc(this);加载工程所需的相关密钥证书，这些证书密钥Java工程是通过classPath路径加载的，但是在Android项目中可以放在assets文件贾或者其他的本地目录中，在此我将这些证书密钥放在了assets中，便于去加载。此外还要将相关的jar包取出来放在项目中</p> 
  <p><img src="" alt=""><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20170713093205765?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFuZmVuZ3pxaA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></p> 
  <p>当然，这些jar包在银联提供的java的Demo中都是有的。</p> 
  <p>一、主扫</p> 
  <p></p> 
  <pre><code class="language-java">package com.zng.unionpayqr.msqr;

import java.util.HashMap;
import java.util.Map;

import android.util.Log;

import com.zng.unionpayqr.sdk.AcpService;
import com.zng.unionpayqr.sdk.LogUtil;
import com.zng.unionpayqr.sdk.SDKConfig;
import com.zng.unionpayqr.utils.DemoBase;
import com.zng.unionpayqr.utils.RandomUtil;

public class QRMainSweepUtil {

	/**QR主扫*/
	public static void qrMainSweep(){
		Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;();
		/***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/
		contentData.put("version", DemoBase.version);            //版本号 全渠道默认值
		contentData.put("encoding", DemoBase.encoding);     //字符集编码 可以使用UTF-8,GBK两种方式
		contentData.put("signMethod", SDKConfig.getConfig().getSignMethod()); //签名方法
		contentData.put("txnType", "01");              		 	//交易类型 01:消费
		contentData.put("txnSubType", "07");           		 	//交易子类 07：申请消费二维码
		contentData.put("bizType", "000000");          		 	//填写000000
		contentData.put("channelType", "08");          		 	//渠道类型 08手机
		
		/***商户接入参数***/
		contentData.put("merId", "777290058149059");   		 	//商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试
		contentData.put("accessType", "0");            		 	//接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户）
		contentData.put("orderId", RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则	
		contentData.put("txnTime", DemoBase.getCurrentTime());	//订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效
		contentData.put("txnAmt", "1");							//交易金额 单位为分，不能带小数点
		contentData.put("currencyCode", "156");                 //境内商户固定 156 人民币
		contentData.put("backUrl", DemoBase.backUrl);
		
		/**对请求参数进行签名并发送http post请求，接收同步应答报文**/
		Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding);			 //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。
		String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl();								 //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl
		Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); 
		
		Log.d("zqh", "rspData = "+rspData);
		/**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/
		//应答码规范参考open.unionpay.com帮助中心 下载  产品接口规范  《平台接入接口规范-第5部分-附录》
		if(!rspData.isEmpty()){
			if(AcpService.validate(rspData, DemoBase.encoding)){
				LogUtil.writeLog("验证签名成功");
				String respCode = rspData.get("respCode") ;
				if(("00").equals(respCode)){
					//成功,获取tn号
					String qrCode = rspData.get("qrCode");
					Log.e("zqh", "qrCode = "+qrCode);
				}else{
					//其他应答码为失败请排查原因或做失败处理
					
				}
			}else{
				LogUtil.writeErrorLog("验证签名失败");
				//TODO 检查验证签名失败的原因
			}
		}else{
			//未返回正确的http状态
			LogUtil.writeErrorLog("未获取到返回报文或返回http状态码非200");
		}
		String reqMessage = DemoBase.genHtmlResult(reqData);
		String rspMessage = DemoBase.genHtmlResult(rspData);
		Log.e("zqh","请求报文:&lt;br/&gt;"+reqMessage+"&lt;br/&gt;" + "应答报文:&lt;/br&gt;"+rspMessage+"");
	}
}
</code></pre>
  <br>
  <br>
  <p></p> 
  <p>二、被扫</p> 
  <p></p> 
  <pre><code class="language-java">package com.zng.unionpayqr.qrss;

import java.util.HashMap;
import java.util.Map;

import android.util.Log;

import com.zng.unionpayqr.sdk.AcpService;
import com.zng.unionpayqr.sdk.LogUtil;
import com.zng.unionpayqr.sdk.SDKConfig;
import com.zng.unionpayqr.utils.DemoBase;
import com.zng.unionpayqr.utils.RandomUtil;

/**
 * QR被扫
 * @author zqh
 *
 */
public class QRIsSweptUtil {
	
	/**QR被扫*/
	public static void qrIsSwept(String C2BCode){
		Map&lt;String, String&gt; contentData = new HashMap&lt;String, String&gt;();
		/***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/
		contentData.put("version", DemoBase.version);            //版本号 全渠道默认值
		contentData.put("encoding", DemoBase.encoding);     //字符集编码 可以使用UTF-8,GBK两种方式
		contentData.put("signMethod", SDKConfig.getConfig().getSignMethod()); //签名方法
		contentData.put("txnType", "01");              		 	//交易类型 01:消费
		contentData.put("txnSubType", "06");           		 	//交易子类 07：申请消费二维码
		contentData.put("bizType", "000000");          		 	//填写000000
		contentData.put("channelType", "08");          		 	//渠道类型 08手机
		
		/***商户接入参数***/
		contentData.put("merId", "777290058149059");   		 	//商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试
		contentData.put("accessType", "0");            		 	//接入类型，商户接入填0 ，不需修改（0：直连商户， 1： 收单机构 2：平台商户）
		contentData.put("qrNo", C2BCode);
		contentData.put("orderId", RandomUtil.getOutTradeNo()); //商户订单号，8-40位数字字母，不能含“-”或“_”，可以自行定制规则	
		contentData.put("txnTime", DemoBase.getCurrentTime());	//订单发送时间，取系统时间，格式为YYYYMMDDhhmmss，必须取当前时间，否则会报txnTime无效
		contentData.put("txnAmt", "1");						//交易金额 单位为分，不能带小数点
		contentData.put("currencyCode", "156");                 //境内商户固定 156 人民币
		contentData.put("backUrl", DemoBase.backUrl);
		
		/**对请求参数进行签名并发送http post请求，接收同步应答报文**/
		Map&lt;String, String&gt; reqData = AcpService.sign(contentData,DemoBase.encoding);			 //报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。
		String requestAppUrl = SDKConfig.getConfig().getBackRequestUrl();								 //交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.backTransUrl
		Map&lt;String, String&gt; rspData = AcpService.post(reqData,requestAppUrl,DemoBase.encoding); 
		
		Log.d("zqh", "rspData = "+rspData);
		/**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/
		//应答码规范参考open.unionpay.com帮助中心 下载  产品接口规范  《平台接入接口规范-第5部分-附录》
		if(!rspData.isEmpty()){
			if(AcpService.validate(rspData, DemoBase.encoding)){
				LogUtil.writeLog("验证签名成功");
				String respCode = rspData.get("respCode") ;
				if(("00").equals(respCode)){
					//成功,获取tn号
					String qrCode = rspData.get("qrCode");
					Log.e("zqh", "qrCode = "+qrCode);
				}else{
					//其他应答码为失败请排查原因或做失败处理
					
				}
			}else{
				LogUtil.writeErrorLog("验证签名失败");
				//TODO 检查验证签名失败的原因
			}
		}else{
			//未返回正确的http状态
			LogUtil.writeErrorLog("未获取到返回报文或返回http状态码非200");
		}
		String reqMessage = DemoBase.genHtmlResult(reqData);
		String rspMessage = DemoBase.genHtmlResult(rspData);
		Log.e("zqh","请求报文:&lt;br/&gt;"+reqMessage+"&lt;br/&gt;" + "应答报文:&lt;/br&gt;"+rspMessage+"");
	}
}
</code></pre>
  <br> 三、查询 
  <p></p> 
  <p></p> 
  <pre><code class="language-java">package com.zng.unionpayqr.utils;

import java.util.HashMap;
import java.util.Map;

import android.util.Log;

import com.zng.unionpayqr.sdk.AcpService;
import com.zng.unionpayqr.sdk.LogUtil;
import com.zng.unionpayqr.sdk.SDKConfig;

public class QueryUtil {

	public static void query(){
		Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;();
		/***银联全渠道系统，产品参数，除了encoding自行选择外其他不需修改***/
		data.put("version", DemoBase.version);                 //版本号
		data.put("encoding", DemoBase.encoding);          //字符集编码 可以使用UTF-8,GBK两种方式
		data.put("signMethod", SDKConfig.getConfig().getSignMethod()); //签名方法
		data.put("txnType", "00");                             //交易类型 00-默认
		data.put("txnSubType", "00");                          //交易子类型  默认00
		data.put("bizType", "000201");                         //业务类型 
		
		/***商户接入参数***/
		data.put("merId", "777290058149059");                  //商户号码，请改成自己申请的商户号或者open上注册得来的777商户号测试
		data.put("accessType", "0");                           //接入类型，商户接入固定填0，不需修改
		
		/***要调通交易以下字段必须修改***/
		data.put("orderId", "20170712055720002");                 			//****商户订单号，每次发交易测试需修改为被查询的交易的订单号
		data.put("txnTime", DemoBase.getCurrentTime());                			//****订单发送时间，每次发交易测试需修改为被查询的交易的订单发送时间
		/**请求参数设置完毕，以下对请求参数进行签名并发送http post请求，接收同步应答报文-------------&gt;**/
		
		Map&lt;String, String&gt; reqData = AcpService.sign(data,DemoBase.encoding);			//报文中certId,signature的值是在signData方法中获取并自动赋值的，只要证书配置正确即可。
		String url = SDKConfig.getConfig().getSingleQueryUrl();								//交易请求url从配置文件读取对应属性文件acp_sdk.properties中的 acpsdk.singleQueryUrl
		Map&lt;String, String&gt; rspData = AcpService.post(reqData, url,DemoBase.encoding); //发送请求报文并接受同步应答（默认连接超时时间30秒，读取返回结果超时时间30秒）;这里调用signData之后，调用submitUrl之前不能对submitFromData中的键值对做任何修改，如果修改会导致验签不通过
		
		/**对应答码的处理，请根据您的业务逻辑来编写程序,以下应答码处理逻辑仅供参考-------------&gt;**/
		//应答码规范参考open.unionpay.com帮助中心 下载  产品接口规范  《平台接入接口规范-第5部分-附录》
		if(!rspData.isEmpty()){
			if(AcpService.validate(rspData, DemoBase.encoding)){
				LogUtil.writeLog("验证签名成功");
				if(("00").equals(rspData.get("respCode"))){//如果查询交易成功
					String origRespCode = rspData.get("origRespCode");
					if(("00").equals(origRespCode)){
						//交易成功，更新商户订单状态
						//TODO
					}else if(("03").equals(origRespCode)||
							 ("04").equals(origRespCode)||
							 ("05").equals(origRespCode)){
						//订单处理中或交易状态未明，需稍后发起交易状态查询交易 【如果最终尚未确定交易是否成功请以对账文件为准】
						//TODO
					}else{
						//其他应答码为交易失败
						//TODO
					}
				}else if(("34").equals(rspData.get("respCode"))){
					//订单不存在，可认为交易状态未明，需要稍后发起交易状态查询，或依据对账结果为准
					
				}else{//查询交易本身失败，如应答码10/11检查查询报文是否正确
					//TODO
				}
			}else{
				LogUtil.writeErrorLog("验证签名失败");
				//TODO 检查验证签名失败的原因
			}
		}else{
			//未返回正确的http状态
			LogUtil.writeErrorLog("未获取到返回报文或返回http状态码非200");
		}
			
		String reqMessage = DemoBase.genHtmlResult(reqData);
		String rspMessage = DemoBase.genHtmlResult(rspData);
		Log.e("zqh","交易状态查询交易&lt;/br&gt;请求报文:&lt;br/&gt;"+reqMessage+"&lt;br/&gt;" + "应答报文:&lt;/br&gt;"+rspMessage+"");
	}
}
</code></pre>
  <pre><code class="language-java">银联测试地址:</code></pre>
  <pre><code class="language-java"></code></pre>
  <code class="language-java">商户接入银联全渠道二维码测试：主扫场景:商户参考demo生成二维码后，请使用银联提供的主扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp发送查询订单和付款交易完成付款。被扫场景：请先使用银联提供的被扫模式付款方仿真https://open.unionpay.com/ajweb/help/qrcodeFormPage/mainSweepReceiverApp中的C2B码申请交易，申请二维码得到qrNo，然后参考demo完成扫码消费交易。测试过程中请使用我们提供的测试卡进行测试，测试卡信息：https://open.unionpay.com/ajweb/help/faq/list?id=4&amp;level=0&amp;from=0&amp;keyword=%E6%B5%8B%E8%AF%95%E5%8D%A1</code>
  <pre class="java"><code class="language-java"></code></pre>
  <pre><code class="language-java">以下是相关的Demo链接欢迎下载。</code></pre> 
  <p><a href="http://download.csdn.net/download/hanfengzqh/9897119" rel="nofollow">点击打开链接</a></p> 
  <p>github完整项目连接:https://github.com/hanfengzqh/UnionPayQR</p> 
  <p><br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/hanfengzqh/article/details/75043052,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/hanfengzqh/article/details/75043052,&quot;}">阅读更多</a> 
</div> 
<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

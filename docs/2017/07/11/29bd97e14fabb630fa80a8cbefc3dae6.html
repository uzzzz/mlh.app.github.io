<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>geth1.6部署智能合约 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="geth1.6部署智能合约" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="首先我们进去geth平台 root@i-colbyo7v:/home/ubuntu# cd private-geth/ root@i-colbyo7v:/home/ubuntu/private-geth# geth --identity &quot;haha&quot; --datadir ./data/00 --networkid 12345 --rpcapi &quot;db,eth,net,web3&quot; --port 61910 --rpcport 8200 console Welcome to the Geth JavaScript console! instance: Geth/haha/v1.6.6-stable-10a45cb5/linux-amd64/go1.8.1 coinbase: 0x8260b02ac49855f9c00ff4275dc5291300517e30 at block: 48 (Tue, 11 Jul 2017 15:21:41 CST) datadir: /home/ubuntu/private-geth/data/00 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 合约部署流程 一般来说，部署智能合约的步骤为 1启动一个以太坊节点 (例如geth或者testrpc)。 2用solc编译智能合约。 =&gt; 获得二进制代码。 3编译好的合约部署到网络。（这一步会消耗以太币，还需要使用你的节点的默认地址或者指定地址来给合约签名。） =&gt; 获得合约的区块链地址和ABI（合约接口的JSON表示，包括变量，事件和可以调用的方法）。(译注：作者在这里把ABI与合约接口弄混了。ABI是合约接口的二进制表示。) 4 eb3.js提供的JavaScript API来调用合约。（根据调用的类型有可能会消耗以太币。） 部署合约 因为geth1.6版本以后都不支持solidity编译，所以我们在线编译以后再赋值给abi &gt; address = eth.accounts[0] &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot; &gt; personal.unlockAccount(address) Unlock account 0x8260b02ac49855f9c00ff4275dc5291300517e30 Passphrase: true 部署合约就是将编译好的合约字节码通过外部账号发送交易的形式部署到以太坊区块链上。输入以下命令： &gt; abi = [{constant:false,inputs:{name:&#39;a&#39;,type:&#39;uint256&#39;}}] [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }] &gt; MyContract = eth.contract(abi) { abi: [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }], eth: { accounts: [&quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, &quot;0xf7f54ba52d6226c1f3d4417cc0d700616474681d&quot;], blockNumber: 48, coinbase: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } &gt; myContract = MyContract.new({from:address,data:&quot;0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3&quot;}) INFO [07-11|15:30:21] Submitted contract creation fullhash=0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255 contract=0x274bf7547c3e54a7fad23d4d3349e848ffb0a247 { abi: [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }], address: undefined, transactionHash: &quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot; } 这时，我们可以检查一下交易池，查看当前交易的待处理状况： &gt; txpool.status { pending: 1, queued: 0 } 我们可以看到当前的交易池中有一个交易正在等待确认。然后，我们查看待确认交易的详细内容： &gt; eth.getBlock(&quot;pending&quot;,true).transactions [{ blockHash: &quot;0x8889fa3b54432ceda35c280661f41887e37e6a26cfe8ebef4dc2cfe4c17270c4&quot;, blockNumber: 49, from: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot;, input: &quot;0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3&quot;, nonce: 5, r: &quot;0x841832d644c4938e566d7faf18da1d27350421dbd880a1319de7533ad4d0a615&quot;, s: &quot;0x286bcf5d39af77ea7e446abf0e04a445cfacbf7ca103b5870a01bb106c4999e4&quot;, to: null, transactionIndex: 0, v: &quot;0x6096&quot;, value: 0 }] 我们从显示出来的结果可以看出当前交易的一些内容。例如，from数据项就是我们发送交易的地址，input就是合约编译完成的字节码，这些内容均与我们之前的设定相同。而且，我们可以看到新的交易创建在第49区块中。 正在等待矿工的确认。 耐心等待一段时间，等待矿工确认完成后，我们再次使用txpool.status命令查看交易池的状态pending 为0 &gt; miner.start() &gt; miner.stop() 我们发现交易池已经没有待确认的交易了。我们使用eth.getBlock(49令查看第294号区块的信息： &gt; eth.getBlock(49) { difficulty: 131072, extraData: &quot;0xd783010606846765746887676f312e382e31856c696e7578&quot;, gasLimit: 4094191414, gasUsed: 68946, hash: &quot;0x32fa4a3f8e767c90af33b5c70334995df08f973efd36959c212922f42f10eb10&quot;, logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, miner: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, mixHash: &quot;0x19418483843bd02fd570cbfb664fe53f6d3ed4b288f03d9963f933b78d55c315&quot;, nonce: &quot;0x47bed6e2b683c05f&quot;, number: 49, parentHash: &quot;0x677e33fe6760aa95015016b6e57d1fd79d26dec50566354aad3eea851a6e03b7&quot;, receiptsRoot: &quot;0x9bf883aadf4abcf59e3a3cb48f93e179794d71b9889f547ded0fa182180a6b76&quot;, sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, size: 698, stateRoot: &quot;0xa9093658ac11966f4329528efcb41c7a81a933032a9083e475aea2f9bbcd2254&quot;, timestamp: 1499758299, totalDifficulty: 6439680, transactions: [&quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot;], transactionsRoot: &quot;0x61e4bd0c3840957155b91c1a6634f4466fe43d6295ab51481614c7b392adb5e2&quot;, uncles: [] } 我们发现hash值为0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255的交易确实在第49区块中。 与合约交互 首先我们需要使用eth.contract来定义一个合约类，定义的合约类遵从ABI定义2： &gt; abiDefinition=[{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }] [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }] 然后得到合约实例： &gt; Multiply7 = eth.contract(abiDefinition) { abi: [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }], eth: { accounts: [&quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, &quot;0xf7f54ba52d6226c1f3d4417cc0d700616474681d&quot;], blockNumber: 54, coinbase: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 91, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 这里写代码片 &gt; myMultiply7 = Multiply7.at(myContract.address) { abi: [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }], address: &quot;0x274bf7547c3e54a7fad23d4d3349e848ffb0a247&quot;, transactionHash: null, allEvents: function(), multiply: function() } 我们可以看到，在实例中能够调用的函数有两个：allEvents和multiply。multiply显然是一开始我们定义合约的时候写的函数。我们可以使用两种方法来调用multiply函数：sendTransaction(3, {from: address})和call(3)。 &gt; personal.unlockAccount(eth.accounts[0]) Unlock account 0x8260b02ac49855f9c00ff4275dc5291300517e30 Passphrase: true 方法一：使用sendTransaction(3, {from: address})调用： &gt; myMultiply7.multiply.sendTransaction(3, {from:address}) INFO [07-11|15:36:48] Submitted transaction fullhash=0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a recipient=0x274bf7547c3e54a7fad23d4d3349e848ffb0a247 &quot;0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a&quot; 我们可以发现返回的值为一个字符串，这个字符串代表的是发送的交易的hash值。使用这个方法调用合约将会使调用的结果成为全局共识的一部分3。 方法二：使用call(3)调用：按理来说应该返回21，但是却返回为空，不知道是哪里出了问题 &gt; myMultiply7.multiply.call(3) [] 阅读更多" />
<meta property="og:description" content="首先我们进去geth平台 root@i-colbyo7v:/home/ubuntu# cd private-geth/ root@i-colbyo7v:/home/ubuntu/private-geth# geth --identity &quot;haha&quot; --datadir ./data/00 --networkid 12345 --rpcapi &quot;db,eth,net,web3&quot; --port 61910 --rpcport 8200 console Welcome to the Geth JavaScript console! instance: Geth/haha/v1.6.6-stable-10a45cb5/linux-amd64/go1.8.1 coinbase: 0x8260b02ac49855f9c00ff4275dc5291300517e30 at block: 48 (Tue, 11 Jul 2017 15:21:41 CST) datadir: /home/ubuntu/private-geth/data/00 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 合约部署流程 一般来说，部署智能合约的步骤为 1启动一个以太坊节点 (例如geth或者testrpc)。 2用solc编译智能合约。 =&gt; 获得二进制代码。 3编译好的合约部署到网络。（这一步会消耗以太币，还需要使用你的节点的默认地址或者指定地址来给合约签名。） =&gt; 获得合约的区块链地址和ABI（合约接口的JSON表示，包括变量，事件和可以调用的方法）。(译注：作者在这里把ABI与合约接口弄混了。ABI是合约接口的二进制表示。) 4 eb3.js提供的JavaScript API来调用合约。（根据调用的类型有可能会消耗以太币。） 部署合约 因为geth1.6版本以后都不支持solidity编译，所以我们在线编译以后再赋值给abi &gt; address = eth.accounts[0] &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot; &gt; personal.unlockAccount(address) Unlock account 0x8260b02ac49855f9c00ff4275dc5291300517e30 Passphrase: true 部署合约就是将编译好的合约字节码通过外部账号发送交易的形式部署到以太坊区块链上。输入以下命令： &gt; abi = [{constant:false,inputs:{name:&#39;a&#39;,type:&#39;uint256&#39;}}] [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }] &gt; MyContract = eth.contract(abi) { abi: [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }], eth: { accounts: [&quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, &quot;0xf7f54ba52d6226c1f3d4417cc0d700616474681d&quot;], blockNumber: 48, coinbase: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } &gt; myContract = MyContract.new({from:address,data:&quot;0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3&quot;}) INFO [07-11|15:30:21] Submitted contract creation fullhash=0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255 contract=0x274bf7547c3e54a7fad23d4d3349e848ffb0a247 { abi: [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }], address: undefined, transactionHash: &quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot; } 这时，我们可以检查一下交易池，查看当前交易的待处理状况： &gt; txpool.status { pending: 1, queued: 0 } 我们可以看到当前的交易池中有一个交易正在等待确认。然后，我们查看待确认交易的详细内容： &gt; eth.getBlock(&quot;pending&quot;,true).transactions [{ blockHash: &quot;0x8889fa3b54432ceda35c280661f41887e37e6a26cfe8ebef4dc2cfe4c17270c4&quot;, blockNumber: 49, from: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot;, input: &quot;0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3&quot;, nonce: 5, r: &quot;0x841832d644c4938e566d7faf18da1d27350421dbd880a1319de7533ad4d0a615&quot;, s: &quot;0x286bcf5d39af77ea7e446abf0e04a445cfacbf7ca103b5870a01bb106c4999e4&quot;, to: null, transactionIndex: 0, v: &quot;0x6096&quot;, value: 0 }] 我们从显示出来的结果可以看出当前交易的一些内容。例如，from数据项就是我们发送交易的地址，input就是合约编译完成的字节码，这些内容均与我们之前的设定相同。而且，我们可以看到新的交易创建在第49区块中。 正在等待矿工的确认。 耐心等待一段时间，等待矿工确认完成后，我们再次使用txpool.status命令查看交易池的状态pending 为0 &gt; miner.start() &gt; miner.stop() 我们发现交易池已经没有待确认的交易了。我们使用eth.getBlock(49令查看第294号区块的信息： &gt; eth.getBlock(49) { difficulty: 131072, extraData: &quot;0xd783010606846765746887676f312e382e31856c696e7578&quot;, gasLimit: 4094191414, gasUsed: 68946, hash: &quot;0x32fa4a3f8e767c90af33b5c70334995df08f973efd36959c212922f42f10eb10&quot;, logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, miner: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, mixHash: &quot;0x19418483843bd02fd570cbfb664fe53f6d3ed4b288f03d9963f933b78d55c315&quot;, nonce: &quot;0x47bed6e2b683c05f&quot;, number: 49, parentHash: &quot;0x677e33fe6760aa95015016b6e57d1fd79d26dec50566354aad3eea851a6e03b7&quot;, receiptsRoot: &quot;0x9bf883aadf4abcf59e3a3cb48f93e179794d71b9889f547ded0fa182180a6b76&quot;, sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, size: 698, stateRoot: &quot;0xa9093658ac11966f4329528efcb41c7a81a933032a9083e475aea2f9bbcd2254&quot;, timestamp: 1499758299, totalDifficulty: 6439680, transactions: [&quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot;], transactionsRoot: &quot;0x61e4bd0c3840957155b91c1a6634f4466fe43d6295ab51481614c7b392adb5e2&quot;, uncles: [] } 我们发现hash值为0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255的交易确实在第49区块中。 与合约交互 首先我们需要使用eth.contract来定义一个合约类，定义的合约类遵从ABI定义2： &gt; abiDefinition=[{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }] [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }] 然后得到合约实例： &gt; Multiply7 = eth.contract(abiDefinition) { abi: [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }], eth: { accounts: [&quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, &quot;0xf7f54ba52d6226c1f3d4417cc0d700616474681d&quot;], blockNumber: 54, coinbase: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 91, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 这里写代码片 &gt; myMultiply7 = Multiply7.at(myContract.address) { abi: [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }], address: &quot;0x274bf7547c3e54a7fad23d4d3349e848ffb0a247&quot;, transactionHash: null, allEvents: function(), multiply: function() } 我们可以看到，在实例中能够调用的函数有两个：allEvents和multiply。multiply显然是一开始我们定义合约的时候写的函数。我们可以使用两种方法来调用multiply函数：sendTransaction(3, {from: address})和call(3)。 &gt; personal.unlockAccount(eth.accounts[0]) Unlock account 0x8260b02ac49855f9c00ff4275dc5291300517e30 Passphrase: true 方法一：使用sendTransaction(3, {from: address})调用： &gt; myMultiply7.multiply.sendTransaction(3, {from:address}) INFO [07-11|15:36:48] Submitted transaction fullhash=0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a recipient=0x274bf7547c3e54a7fad23d4d3349e848ffb0a247 &quot;0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a&quot; 我们可以发现返回的值为一个字符串，这个字符串代表的是发送的交易的hash值。使用这个方法调用合约将会使调用的结果成为全局共识的一部分3。 方法二：使用call(3)调用：按理来说应该返回21，但是却返回为空，不知道是哪里出了问题 &gt; myMultiply7.multiply.call(3) [] 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/07/11/29bd97e14fabb630fa80a8cbefc3dae6.html" />
<meta property="og:url" content="https://mlh.app/2017/07/11/29bd97e14fabb630fa80a8cbefc3dae6.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-11T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"首先我们进去geth平台 root@i-colbyo7v:/home/ubuntu# cd private-geth/ root@i-colbyo7v:/home/ubuntu/private-geth# geth --identity &quot;haha&quot; --datadir ./data/00 --networkid 12345 --rpcapi &quot;db,eth,net,web3&quot; --port 61910 --rpcport 8200 console Welcome to the Geth JavaScript console! instance: Geth/haha/v1.6.6-stable-10a45cb5/linux-amd64/go1.8.1 coinbase: 0x8260b02ac49855f9c00ff4275dc5291300517e30 at block: 48 (Tue, 11 Jul 2017 15:21:41 CST) datadir: /home/ubuntu/private-geth/data/00 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0 合约部署流程 一般来说，部署智能合约的步骤为 1启动一个以太坊节点 (例如geth或者testrpc)。 2用solc编译智能合约。 =&gt; 获得二进制代码。 3编译好的合约部署到网络。（这一步会消耗以太币，还需要使用你的节点的默认地址或者指定地址来给合约签名。） =&gt; 获得合约的区块链地址和ABI（合约接口的JSON表示，包括变量，事件和可以调用的方法）。(译注：作者在这里把ABI与合约接口弄混了。ABI是合约接口的二进制表示。) 4 eb3.js提供的JavaScript API来调用合约。（根据调用的类型有可能会消耗以太币。） 部署合约 因为geth1.6版本以后都不支持solidity编译，所以我们在线编译以后再赋值给abi &gt; address = eth.accounts[0] &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot; &gt; personal.unlockAccount(address) Unlock account 0x8260b02ac49855f9c00ff4275dc5291300517e30 Passphrase: true 部署合约就是将编译好的合约字节码通过外部账号发送交易的形式部署到以太坊区块链上。输入以下命令： &gt; abi = [{constant:false,inputs:{name:&#39;a&#39;,type:&#39;uint256&#39;}}] [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }] &gt; MyContract = eth.contract(abi) { abi: [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }], eth: { accounts: [&quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, &quot;0xf7f54ba52d6226c1f3d4417cc0d700616474681d&quot;], blockNumber: 48, coinbase: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 0, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } &gt; myContract = MyContract.new({from:address,data:&quot;0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3&quot;}) INFO [07-11|15:30:21] Submitted contract creation fullhash=0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255 contract=0x274bf7547c3e54a7fad23d4d3349e848ffb0a247 { abi: [{ constant: false, inputs: { name: &quot;a&quot;, type: &quot;uint256&quot; } }], address: undefined, transactionHash: &quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot; } 这时，我们可以检查一下交易池，查看当前交易的待处理状况： &gt; txpool.status { pending: 1, queued: 0 } 我们可以看到当前的交易池中有一个交易正在等待确认。然后，我们查看待确认交易的详细内容： &gt; eth.getBlock(&quot;pending&quot;,true).transactions [{ blockHash: &quot;0x8889fa3b54432ceda35c280661f41887e37e6a26cfe8ebef4dc2cfe4c17270c4&quot;, blockNumber: 49, from: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, gas: 90000, gasPrice: 18000000000, hash: &quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot;, input: &quot;0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3&quot;, nonce: 5, r: &quot;0x841832d644c4938e566d7faf18da1d27350421dbd880a1319de7533ad4d0a615&quot;, s: &quot;0x286bcf5d39af77ea7e446abf0e04a445cfacbf7ca103b5870a01bb106c4999e4&quot;, to: null, transactionIndex: 0, v: &quot;0x6096&quot;, value: 0 }] 我们从显示出来的结果可以看出当前交易的一些内容。例如，from数据项就是我们发送交易的地址，input就是合约编译完成的字节码，这些内容均与我们之前的设定相同。而且，我们可以看到新的交易创建在第49区块中。 正在等待矿工的确认。 耐心等待一段时间，等待矿工确认完成后，我们再次使用txpool.status命令查看交易池的状态pending 为0 &gt; miner.start() &gt; miner.stop() 我们发现交易池已经没有待确认的交易了。我们使用eth.getBlock(49令查看第294号区块的信息： &gt; eth.getBlock(49) { difficulty: 131072, extraData: &quot;0xd783010606846765746887676f312e382e31856c696e7578&quot;, gasLimit: 4094191414, gasUsed: 68946, hash: &quot;0x32fa4a3f8e767c90af33b5c70334995df08f973efd36959c212922f42f10eb10&quot;, logsBloom: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;, miner: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, mixHash: &quot;0x19418483843bd02fd570cbfb664fe53f6d3ed4b288f03d9963f933b78d55c315&quot;, nonce: &quot;0x47bed6e2b683c05f&quot;, number: 49, parentHash: &quot;0x677e33fe6760aa95015016b6e57d1fd79d26dec50566354aad3eea851a6e03b7&quot;, receiptsRoot: &quot;0x9bf883aadf4abcf59e3a3cb48f93e179794d71b9889f547ded0fa182180a6b76&quot;, sha3Uncles: &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;, size: 698, stateRoot: &quot;0xa9093658ac11966f4329528efcb41c7a81a933032a9083e475aea2f9bbcd2254&quot;, timestamp: 1499758299, totalDifficulty: 6439680, transactions: [&quot;0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255&quot;], transactionsRoot: &quot;0x61e4bd0c3840957155b91c1a6634f4466fe43d6295ab51481614c7b392adb5e2&quot;, uncles: [] } 我们发现hash值为0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255的交易确实在第49区块中。 与合约交互 首先我们需要使用eth.contract来定义一个合约类，定义的合约类遵从ABI定义2： &gt; abiDefinition=[{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }] [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }] 然后得到合约实例： &gt; Multiply7 = eth.contract(abiDefinition) { abi: [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }], eth: { accounts: [&quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, &quot;0xf7f54ba52d6226c1f3d4417cc0d700616474681d&quot;], blockNumber: 54, coinbase: &quot;0x8260b02ac49855f9c00ff4275dc5291300517e30&quot;, compile: { lll: function(), serpent: function(), solidity: function() }, defaultAccount: undefined, defaultBlock: &quot;latest&quot;, gasPrice: 18000000000, hashrate: 91, mining: false, pendingTransactions: [], protocolVersion: &quot;0x3f&quot;, syncing: false, call: function(), contract: function(abi), estimateGas: function(), filter: function(fil, callback), getAccounts: function(callback), getBalance: function(), getBlock: function(), getBlockNumber: function(callback), getBlockTransactionCount: function(), getBlockUncleCount: function(), getCode: function(), getCoinbase: function(callback), getCompilers: function(), getGasPrice: function(callback), getHashrate: function(callback), getMining: function(callback), getPendingTransactions: function(callback), getProtocolVersion: function(callback), getRawTransaction: function(), getRawTransactionFromBlock: function(), getStorageAt: function(), getSyncing: function(callback), getTransaction: function(), getTransactionCount: function(), getTransactionFromBlock: function(), getTransactionReceipt: function(), getUncle: function(), getWork: function(), iban: function(iban), icapNamereg: function(), isSyncing: function(callback), namereg: function(), resend: function(), sendIBANTransaction: function(), sendRawTransaction: function(), sendTransaction: function(), sign: function(), signTransaction: function(), submitTransaction: function(), submitWork: function() }, at: function(address, callback), getData: function(), new: function() } 这里写代码片 &gt; myMultiply7 = Multiply7.at(myContract.address) { abi: [{ constant: false, inputs: [], name: &quot;multiply&quot;, outputs: [], payable: false, type: &quot;function&quot; }], address: &quot;0x274bf7547c3e54a7fad23d4d3349e848ffb0a247&quot;, transactionHash: null, allEvents: function(), multiply: function() } 我们可以看到，在实例中能够调用的函数有两个：allEvents和multiply。multiply显然是一开始我们定义合约的时候写的函数。我们可以使用两种方法来调用multiply函数：sendTransaction(3, {from: address})和call(3)。 &gt; personal.unlockAccount(eth.accounts[0]) Unlock account 0x8260b02ac49855f9c00ff4275dc5291300517e30 Passphrase: true 方法一：使用sendTransaction(3, {from: address})调用： &gt; myMultiply7.multiply.sendTransaction(3, {from:address}) INFO [07-11|15:36:48] Submitted transaction fullhash=0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a recipient=0x274bf7547c3e54a7fad23d4d3349e848ffb0a247 &quot;0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a&quot; 我们可以发现返回的值为一个字符串，这个字符串代表的是发送的交易的hash值。使用这个方法调用合约将会使调用的结果成为全局共识的一部分3。 方法二：使用call(3)调用：按理来说应该返回21，但是却返回为空，不知道是哪里出了问题 &gt; myMultiply7.multiply.call(3) [] 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/07/11/29bd97e14fabb630fa80a8cbefc3dae6.html","headline":"geth1.6部署智能合约","dateModified":"2017-07-11T00:00:00+08:00","datePublished":"2017-07-11T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/07/11/29bd97e14fabb630fa80a8cbefc3dae6.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>geth1.6部署智能合约</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="markdown_views"> 
  <p>首先我们进去geth平台</p> 
  <pre class="prettyprint"><code class=" hljs http">

<span class="d"> root<span class="hljs-keyword">@i</span>-colbyo7v:/home/ubuntu# cd <span class="hljs-keyword">private</span>-geth/ root<span class="hljs-keyword">@i</span>-colbyo7v:/home/ubuntu/<span class="hljs-keyword">private</span>-geth# geth --identity <span class="hljs-string">"haha"</span> --datadir ./data/<span class="hljs-number">0</span>0 --networkid <span class="hljs-number">12345</span> --rpcapi <span class="hljs-string">"db,eth,net,web3"</span> --port <span class="hljs-number">61910</span> --rpcport <span class="hljs-number">8200</span> console Welcome to the Geth JavaScript console! instance: Geth/haha/v1.6.6-stable-<span class="hljs-number">10</span>a45cb5/linux-amd64/go1.8.1 coinbase: <span class="hljs-number">0</span>x8260b02ac49855f9c00ff4275dc5291300517e30 at block: <span class="hljs-number">48</span> (Tue, <span class="hljs-number">11</span> Jul <span class="hljs-number">2017</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span>:<span class="hljs-number">41</span> CST) datadir: /home/ubuntu/<span class="hljs-keyword">private</span>-geth/data/<span class="hljs-number">0</span>0 modules: admin:<span class="hljs-number">1.0</span> <span class="hljs-keyword">debug</span>:<span class="hljs-number">1.0</span> eth:<span class="hljs-number">1.0</span> miner:<span class="hljs-number">1.0</span> net:<span class="hljs-number">1.0</span> personal:<span class="hljs-number">1.0</span> rpc:<span class="hljs-number">1.0</span> txpool:<span class="hljs-number">1.0</span> web3:<span class="hljs-number">1.0</span></span></code></pre> 
  <p>合约部署流程</p> 
  <p>一般来说，部署智能合约的步骤为 <br> 1启动一个以太坊节点 (例如geth或者testrpc)。 <br> 2用solc编译智能合约。 =&gt; 获得二进制代码。 <br> 3编译好的合约部署到网络。（这一步会消耗以太币，还需要使用你的节点的默认地址或者指定地址来给合约签名。） =&gt; 获得合约的区块链地址和ABI（合约接口的JSON表示，包括变量，事件和可以调用的方法）。(译注：作者在这里把ABI与合约接口弄混了。ABI是合约接口的二进制表示。) <br> 4 eb3.js提供的JavaScript API来调用合约。（根据调用的类型有可能会消耗以太币。）</p> 
  <p><strong>部署合约</strong></p> 
  <pre class="prettyprint"><code class=" hljs http">

<span class="lua"> 因为geth1<span class="hljs-number">.6</span>版本以后都不支持solidity编译，所以我们在线编译以后再赋值给abi &gt; address = eth.accounts[<span class="hljs-number">0</span>] <span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span> &gt; personal.unlockAccount(address) Unlock account <span class="hljs-number">0x8260b02ac49855f9c00ff4275dc5291300517e30</span> Passphrase: <span class="hljs-keyword">true</span> 部署合约就是将编译好的合约字节码通过外部账号发送交易的形式部署到以太坊区块链上。输入以下命令： &gt; abi = [{constant:<span class="hljs-keyword">false</span>,inputs:{name:<span class="hljs-string">'a'</span>,<span class="hljs-built_in">type</span>:<span class="hljs-string">'uint256'</span>}}] [{ constant: <span class="hljs-keyword">false</span>, inputs: { name: <span class="hljs-string">"a"</span>, <span class="hljs-built_in">type</span>: <span class="hljs-string">"uint256"</span> } }] &gt; MyContract = eth.contract(abi) { abi: [{ constant: <span class="hljs-keyword">false</span>, inputs: { name: <span class="hljs-string">"a"</span>, <span class="hljs-built_in">type</span>: <span class="hljs-string">"uint256"</span> } }], eth: { accounts: [<span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span>, <span class="hljs-string">"0xf7f54ba52d6226c1f3d4417cc0d700616474681d"</span>], blockNumber: <span class="hljs-number">48</span>, coinbase: <span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span>, compile: { lll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, serpent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, solidity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> }, defaultAccount: undefined, defaultBlock: <span class="hljs-string">"latest"</span>, gasPrice: <span class="hljs-number">18000000000</span>, hashrate: <span class="hljs-number">0</span>, mining: <span class="hljs-keyword">false</span>, pendingTransactions: [], protocolVersion: <span class="hljs-string">"0x3f"</span>, syncing: <span class="hljs-keyword">false</span>, call: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, contract: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(abi)</span></span>, estimateGas: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, filter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fil, callback)</span></span>, getAccounts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getBalance: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getBlockNumber: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getBlockTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getBlockUncleCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getCode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getCoinbase: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getCompilers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getGasPrice: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getHashrate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getMining: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getPendingTransactions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getProtocolVersion: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getRawTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getStorageAt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, getTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getTransactionReceipt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getUncle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, getWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, iban: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iban)</span></span>, icapNamereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, isSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>, namereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, resend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, sendIBANTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, sendRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, sendTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, sign: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, signTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, submitTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, submitWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> }, at: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(address, callback)</span></span>, getData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>, new: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> } </span></code></pre> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">
&gt; myContract = MyContract.<span class="hljs-built_in">new</span>({<span class="hljs-built_in">from</span>:address,data:<span class="hljs-string">"0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3"</span>})
INFO [<span class="hljs-number">07</span>-<span class="hljs-number">11</span>|<span class="hljs-number">15</span>:<span class="hljs-number">30</span>:<span class="hljs-number">21</span>] Submitted contract creation              fullhash=<span class="hljs-number">0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255</span> contract=<span class="hljs-number">0x274bf7547c3e54a7fad23d4d3349e848ffb0a247</span>
{
  abi: [{
      <span class="hljs-built_in">constant</span>: <span class="hljs-constant">false</span>,
      inputs: {
        name: <span class="hljs-string">"a"</span>,
        type: <span class="hljs-string">"uint256"</span>
      }
  }],
  address: undefined,
  transactionHash: <span class="hljs-string">"0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255"</span>
}
</code></pre> 
  <p>这时，我们可以检查一下交易池，查看当前交易的待处理状况：</p> 
  <pre class="prettyprint"><code class=" hljs css">
&gt;  <span class="hljs-tag">txpool</span><span class="hljs-class">.status</span>
<span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">pending</span>:<span class="hljs-value"> <span class="hljs-number">1</span>, queued: <span class="hljs-number">0</span> </span></span></span>}
</code></pre> 
  <p>我们可以看到当前的交易池中有一个交易正在等待确认。然后，我们查看待确认交易的详细内容：</p> 
  <pre class="prettyprint"><code class=" hljs cs">
&gt; eth.getBlock(<span class="hljs-string">"pending"</span>,<span class="hljs-keyword">true</span>).transactions
[{
    blockHash: <span class="hljs-string">"0x8889fa3b54432ceda35c280661f41887e37e6a26cfe8ebef4dc2cfe4c17270c4"</span>,
    blockNumber: <span class="hljs-number">49</span>,
    <span class="hljs-keyword">from</span>: <span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span>,
    gas: <span class="hljs-number">90000</span>,
    gasPrice: <span class="hljs-number">18000000000</span>,
    hash: <span class="hljs-string">"0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255"</span>,
    input: <span class="hljs-string">"0x606060405260388060106000396000f3606060405260e060020a6000350463c6888fa18114601c575b6002565b3460025760076004350260408051918252519081900360200190f3"</span>,
    nonce: <span class="hljs-number">5</span>,
    r: <span class="hljs-string">"0x841832d644c4938e566d7faf18da1d27350421dbd880a1319de7533ad4d0a615"</span>,
    s: <span class="hljs-string">"0x286bcf5d39af77ea7e446abf0e04a445cfacbf7ca103b5870a01bb106c4999e4"</span>,
    to: <span class="hljs-keyword">null</span>,
    transactionIndex: <span class="hljs-number">0</span>,
    v: <span class="hljs-string">"0x6096"</span>,
    <span class="hljs-keyword">value</span>: <span class="hljs-number">0</span>
}]
</code></pre> 
  <p>我们从显示出来的结果可以看出当前交易的一些内容。例如，from数据项就是我们发送交易的地址，input就是合约编译完成的字节码，这些内容均与我们之前的设定相同。而且，我们可以看到新的交易创建在第49区块中。</p> 
  <p>正在等待矿工的确认。</p> 
  <p>耐心等待一段时间，等待矿工确认完成后，我们再次使用txpool.status命令查看交易池的状态pending 为0</p> 
  <pre class="prettyprint"><code class=" hljs markdown">
<span class="hljs-blockquote">&gt; miner.start()</span>


<span class="hljs-blockquote">&gt; miner.stop()</span>
</code></pre> 
  <p>我们发现交易池已经没有待确认的交易了。我们使用eth.getBlock(49令查看第294号区块的信息：</p> 
  <pre class="prettyprint"><code class=" hljs http">

<span class="css">&gt; <span class="hljs-tag">eth</span><span class="hljs-class">.getBlock</span>(49) <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">difficulty</span>:<span class="hljs-value"> <span class="hljs-number">131072</span>, extraData: <span class="hljs-string">"0xd783010606846765746887676f312e382e31856c696e7578"</span>, gasLimit: <span class="hljs-number">4094191414</span>, gasUsed: <span class="hljs-number">68946</span>, hash: <span class="hljs-string">"0x32fa4a3f8e767c90af33b5c70334995df08f973efd36959c212922f42f10eb10"</span>, logsBloom: <span class="hljs-string">"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>, miner: <span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span>, mixHash: <span class="hljs-string">"0x19418483843bd02fd570cbfb664fe53f6d3ed4b288f03d9963f933b78d55c315"</span>, nonce: <span class="hljs-string">"0x47bed6e2b683c05f"</span>, number: <span class="hljs-number">49</span>, parentHash: <span class="hljs-string">"0x677e33fe6760aa95015016b6e57d1fd79d26dec50566354aad3eea851a6e03b7"</span>, receiptsRoot: <span class="hljs-string">"0x9bf883aadf4abcf59e3a3cb48f93e179794d71b9889f547ded0fa182180a6b76"</span>, sha3Uncles: <span class="hljs-string">"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"</span>, size: <span class="hljs-number">698</span>, stateRoot: <span class="hljs-string">"0xa9093658ac11966f4329528efcb41c7a81a933032a9083e475aea2f9bbcd2254"</span>, timestamp: <span class="hljs-number">1499758299</span>, totalDifficulty: <span class="hljs-number">6439680</span>, transactions: [<span class="hljs-string">"0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255"</span>], transactionsRoot: <span class="hljs-string">"0x61e4bd0c3840957155b91c1a6634f4466fe43d6295ab51481614c7b392adb5e2"</span>, uncles: [] </span></span></span>} </span></code></pre> 
  <p>我们发现hash值为0x20a00305a400a1a49faf48ca3cf3ec4a08d86b71063547ff30d3fa71ff13a255的交易确实在第49区块中。</p> 
  <p><strong>与合约交互</strong></p> 
  <p>首先我们需要使用eth.contract来定义一个合约类，定义的合约类遵从ABI定义2：</p> 
  <pre class="prettyprint"><code class=" hljs http">

<span class="applescript">&gt; abiDefinition=[{ <span class="hljs-type">constant</span>: <span class="hljs-constant">false</span>, inputs: [], <span class="hljs-property">name</span>: <span class="hljs-string">"multiply"</span>, outputs: [], payable: <span class="hljs-constant">false</span>, type: <span class="hljs-string">"function"</span> }] [{ <span class="hljs-type">constant</span>: <span class="hljs-constant">false</span>, inputs: [], <span class="hljs-property">name</span>: <span class="hljs-string">"multiply"</span>, outputs: [], payable: <span class="hljs-constant">false</span>, type: <span class="hljs-string">"function"</span> }] </span></code></pre> 
  <p>然后得到合约实例：</p> 
  <pre class="prettyprint"><code class=" hljs lua">
&gt; Multiply7 = eth.contract(abiDefinition)
{
  abi: [{
      constant: <span class="hljs-keyword">false</span>,
      inputs: [],
      name: <span class="hljs-string">"multiply"</span>,
      outputs: [],
      payable: <span class="hljs-keyword">false</span>,
      <span class="hljs-built_in">type</span>: <span class="hljs-string">"function"</span>
  }],
  eth: {
    accounts: [<span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span>, <span class="hljs-string">"0xf7f54ba52d6226c1f3d4417cc0d700616474681d"</span>],
    blockNumber: <span class="hljs-number">54</span>,
    coinbase: <span class="hljs-string">"0x8260b02ac49855f9c00ff4275dc5291300517e30"</span>,
    compile: {
      lll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
      serpent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
      solidity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    },
    defaultAccount: undefined,
    defaultBlock: <span class="hljs-string">"latest"</span>,
    gasPrice: <span class="hljs-number">18000000000</span>,
    hashrate: <span class="hljs-number">91</span>,
    mining: <span class="hljs-keyword">false</span>,
    pendingTransactions: [],
    protocolVersion: <span class="hljs-string">"0x3f"</span>,
    syncing: <span class="hljs-keyword">false</span>,
    call: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    contract: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(abi)</span></span>,
    estimateGas: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    filter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fil, callback)</span></span>,
    getAccounts: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getBalance: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlockNumber: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getBlockTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getBlockUncleCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getCode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getCoinbase: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getCompilers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getGasPrice: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getHashrate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getMining: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getPendingTransactions: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getProtocolVersion: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getRawTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getStorageAt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    getTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionFromBlock: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getTransactionReceipt: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getUncle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    getWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    iban: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iban)</span></span>,
    icapNamereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    isSyncing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span></span>,
    namereg: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    resend: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendIBANTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendRawTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sendTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    sign: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    signTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    submitTransaction: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
    submitWork: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
  },
  at: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(address, callback)</span></span>,
  getData: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>,
  new: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
}
</code></pre> 
  <p>这里写代码片</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">
&gt; myMultiply7 = Multiply7.<span class="hljs-keyword">at</span>(myContract.address)
{
  abi: [{
      <span class="hljs-built_in">constant</span>: <span class="hljs-constant">false</span>,
      inputs: [],
      name: <span class="hljs-string">"multiply"</span>,
      outputs: [],
      payable: <span class="hljs-constant">false</span>,
      type: <span class="hljs-string">"function"</span>
  }],
  address: <span class="hljs-string">"0x274bf7547c3e54a7fad23d4d3349e848ffb0a247"</span>,
  transactionHash: <span class="hljs-constant">null</span>,
  allEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(),</span>
  <span class="hljs-built_in">multiply</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>()</span>
}
</code></pre> 
  <p>我们可以看到，在实例中能够调用的函数有两个：allEvents和multiply。multiply显然是一开始我们定义合约的时候写的函数。我们可以使用两种方法来调用multiply函数：sendTransaction(3, {from: address})和call(3)。</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">
&gt; personal<span class="hljs-preprocessor">.unlockAccount</span>(eth<span class="hljs-preprocessor">.accounts</span>[<span class="hljs-number">0</span>])
Unlock account <span class="hljs-number">0x8260b02ac49855f9c00ff4275dc5291300517e30</span>
<span class="hljs-label">Passphrase:</span> 
true
</code></pre> 
  <p>方法一：使用sendTransaction(3, {from: address})调用：</p> 
  <pre class="prettyprint"><code class=" hljs livecodeserver">
&gt; myMultiply7.<span class="hljs-built_in">multiply</span>.sendTransaction(<span class="hljs-number">3</span>, {<span class="hljs-built_in">from</span>:address})
INFO [<span class="hljs-number">07</span>-<span class="hljs-number">11</span>|<span class="hljs-number">15</span>:<span class="hljs-number">36</span>:<span class="hljs-number">48</span>] Submitted transaction                    fullhash=<span class="hljs-number">0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a</span> recipient=<span class="hljs-number">0x274bf7547c3e54a7fad23d4d3349e848ffb0a247</span>
<span class="hljs-string">"0x68f1880a83eccdbe3bb1847deaae6a74df59d4ea8855368433e1af2c3d4c7f7a"</span>
</code></pre> 
  <p>我们可以发现返回的值为一个字符串，这个字符串代表的是发送的交易的hash值。使用这个方法调用合约将会使调用的结果成为全局共识的一部分3。</p> 
  <p>方法二：使用call(3)调用：按理来说应该返回21，但是却返回为空，不知道是哪里出了问题</p> 
  <pre class="prettyprint"><code class=" hljs avrasm">
&gt; myMultiply7<span class="hljs-preprocessor">.multiply</span><span class="hljs-preprocessor">.call</span>(<span class="hljs-number">3</span>)
[]
</code></pre> 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/markdown_views-ea0013b516.css"> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/DDFFR/article/details/74979367,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/DDFFR/article/details/74979367,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>社工库 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="社工库" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="环境介绍&nbsp;&nbsp;&nbsp; ①Host：Fedora(English)(server)，win8(中文) ②Fedora安装apache，MySQL&nbsp;Workbench，语言包（Fedora安装时选择）。 ③Database：mysql&nbsp;安装在Fedora, 建库/表统一编码UTF8 ，修改my.cnf中的datadir=单独的一个分区，tmpdir=空间足够大的空间( &gt; 16G)。 ④Win8:安装了notepad++，Navicat。 MySql配置如下： /etc/my.cnf [mysqld] skip-name-resolve #datadir=/var/lib/mysql datadir=/home/data/mysql/ tmpdir=/MysqlTemp/ #socket=/var/lib/mysql/mysql.sock socket=/home/data/mysql/mysql.sock user=mysql default-character-set&nbsp;=&nbsp;utf8 max_allowed_packet&nbsp;=&nbsp;200M net_buffer_length&nbsp;=&nbsp;65536 wait_timeout&nbsp;=&nbsp;2880000 interactive_timeout&nbsp;=&nbsp;2880000 symbolic-links=0 &nbsp; [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid [mysql] socket=/home/data/mysql/mysql.sock [mysqldump] socket=/home/data/mysql/mysql.sock [mysqladmin] socket=/home/data/mysql/mysql.sock 着重修改datadir, tmpdir, socket。 可能有的同学还用txtSearch，我觉得实在是有点慢，还… 准备篇 ① txt体积不超过400M的一律先转化成UTF-8编码格式(8G内存图形化可以使用Notepad++) ② 检查txt中是否有 &quot;（双引号） &#39;（单引号），会导致意外终止。(还有其他原因后面提到) ③ 如果遇见分割成碎小体积的多份带有编码格式的txt，使用Linux下的cat * &gt; 1.txt时会出现编码问题（这也就是为什么先执行第一条），其实windows可用type * &gt; 1.txt搞定。(注: windows下type *源文件和目标文件要保持不同目录，windows下的命令工具确实有点渣。咳~) ④ sql格式的文件，建表时检查是否有索引，删除之，导入后再建，其速度回提高不少。 数据导入篇&nbsp;&nbsp; ①sql文件，删除key `user`&nbsp; (user) ;之类索引后，mysql执行source&nbsp;xxx.sql 导入，不用考虑编码问题，入库后直接使用workbench或nevicat编辑数据库属性转UTF8编码即可，然后再添加索引。 ②txt文件（使用tab间隔，回车换行），select into outfile txt / bcp&nbsp; 可以使用mysql命令load data infile a.txt into table test.a;（默认缺省FIELDS TERMINATED BY &#39;\t&#39; ENCLOSED BY &#39;&#39; ESCAPED BY &#39;\\&#39; ,行缺省LINES TERMINATED BY &#39;\n&#39; STARTING BY &#39;&#39;） ③txt文件（非tab的规律间隔符），可以使用操作简单的Navicat 导入。 ④txt文件（非规律间隔符），使用py处理成有序文本，再使用Navicat 导入。 上图是不规则的空格+tab，下图编写代码处理下。 偶遇几个异常，统计下看看所占比例。 except： &nbsp;&nbsp;&nbsp;&nbsp;count=count +1 来看看处理后的结果。 &nbsp; ⑤关于mssql转mysql ㈠MySQL-Migration-Toolkit㈡Mssql to Access&nbsp;&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp;&nbsp; access to MySQL㈢BCP&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp; Load data local infile txt into table xx; Win(mssql) cmd执行 bcp&nbsp;&quot;select&nbsp;*&nbsp;from&nbsp;dbname.dbo.info&quot;&nbsp;queryout&nbsp;info.txt&nbsp;&nbsp;-c&nbsp;-x&nbsp;-S127.0.0.1&nbsp;-Usa&nbsp;-P123.456&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;或者 bcp&nbsp;dbname.dbo.info&nbsp;out&nbsp;info.txt&nbsp;&nbsp;-c&nbsp;-x&nbsp;-S127.0.0.1&nbsp;-Usa&nbsp;-P123.456 Fedora(MySQL)执行 mysql&nbsp;-u&nbsp;root&nbsp;-p use&nbsp;test; Load&nbsp;data&nbsp;local&nbsp;infile&nbsp;&quot;/home/info.txt&quot;&nbsp;into&nbsp;table&nbsp;xx; ⑥EmpireBak帝国备份王 apache部署EmpireBak，设置目录权限。备份数据复制到bdata目录。登陆主界面，先设置参数，连接数据库，然后选择恢复数据选择要恢复的数据库。 优化篇 ①数据简化 delete&nbsp;from&nbsp;`XXXX`&nbsp;where&nbsp;mail&nbsp;not&nbsp;like&nbsp;&quot;%@%&quot;; 删除不符合邮件格式的记录 &nbsp; delete&nbsp;FROM&nbsp;`XXXX`&nbsp;where&nbsp;mail&nbsp;is&nbsp;null&nbsp;and&nbsp;length(username)&lt;4; 删除邮件为空并且用户名长度小于4的记录 &nbsp; delete&nbsp;FROM&nbsp;`XXXX`&nbsp;where&nbsp;length(password)&lt;4; 删除密码长度小于4的记录 &nbsp; delete&nbsp;from&nbsp;`xxxx`&nbsp;where&nbsp;mail&nbsp;is&nbsp;null&nbsp;and&nbsp;password=username; ...... ②数据去重 方法一 delete&nbsp;from&nbsp;`xxx`&nbsp;where&nbsp;id&nbsp;in&nbsp;(select&nbsp;*&nbsp;from&nbsp;(SELECT&nbsp;&nbsp;min(id)&nbsp;FROM&nbsp;`xxx`&nbsp;group&nbsp;by&nbsp;mail&nbsp;having&nbsp;count(mail)&gt;1)&nbsp;as&nbsp;a); 这是百度文章里 提到的最多的的一条语句。240W的数据处理了3个多小时才删除了19w数据。 方法二 create&nbsp;table&nbsp;tmp_xxx&nbsp;select&nbsp;min(id)&nbsp;as&nbsp;id,mail,password&nbsp;from&nbsp;xxx&nbsp;group&nbsp;by&nbsp;mail,password; 同样的240w数据去重不到两分钟就搞定了。（160w spend 56s ） 注：这条命令最容易出现的一个问题是临时空间不足，如果tmp是单独分区空间太小的话，可以修改my.cnf的tmpdir=/otherdir 。保证otherdir空间充足(&gt;16G)。修改otherdir权限，mysql可以访问修改。重启mysql。 ③关于查询优化 ㈠分清楚精确查询还是模糊查询 ，精确查询例如手机号；模糊查询例如用户名和邮箱。=比like效率高。㈡模糊查询尽量使用&#39;string%&#39; 来代替&#39;%string%&#39; 。㈢sql语句中能使用单引号的尽量使用单引号。㈣如果ID和行数一样，select * from xxx where id=888；可以用select * from xxx limit 887,1；代替(无索引时使用)。 ④添加索引 给常用查询字段添加索引，模糊类用BTREE存储类型，精确类用HASH存储类型。 推荐使用Navicat 选择表打开表讯息，选择DDL选项卡，可以清楚看到该表的sql，有无索引一目了然，然后右击数据库名选择它的console功能，来快速添加索引。 ALTER&nbsp;TABLE&nbsp;`XXX` ADD&nbsp;INDEX&nbsp;`inx_username`&nbsp;(`username`)&nbsp;, ADD&nbsp;INDEX&nbsp;`inx_mail`&nbsp;(`mail`)&nbsp;; ⑤表类型使用MyISAM&nbsp; MyISAM类型的表强调的是性能，其执行数度比InnoDB类型更快，但是不提供事务支持。另外MyISAM的索引和数据是分开的，并且索引是有压缩的，内存使用率也就对应提高了不少。 问题篇 ①关于利用帝国备份王跨平台恢复所见问题 ㈠打开本地页面，显示空白。 帝国备份采用了不是完全标准的PHP格式(&lt;?php&nbsp;… ?&gt;)书写，用了短标记格式&lt;?…?&gt; ，所以针对解决办法就是配置php.ini，启动短标记格式。 short_open_tag&nbsp;=&nbsp;On ㈡恢复数据时，点击开始恢复，提示参数不对 确保要恢复的数据库名和备份名一样（可在备份文件目录下的config.php查看），确保备份的php源文件有读写权限或者 chgrp apache *&nbsp; -R 。 ②PHP 问题㈠Fatal error: Allowed memory size of 134217728 bytes 最大单线程的独立内存使用量超过了128M。修改/etc/php.ini&nbsp;&nbsp;&nbsp; memory_limit=512M ㈡时区错误问题 修改/etc/php.ini&nbsp;&nbsp; &nbsp; date.timezone&nbsp;=&nbsp;Asia/Chongqing ㈢mysql默认位置修改 修改/etc/php.ini&nbsp;&nbsp; &nbsp; mysql.default_socket&nbsp;=&nbsp;/home/data/mysql/mysql.sock ㈣Illegal mix of collations (gbk_chinese_ci,IMPLICIT) and (latin1_general_ci,IMPLICIT) 查询的几个表之间，字符编码不统一，不能在当前页面显示。转UTF8。 ③sql&nbsp;加密，&nbsp;hex ④MySQL 问题 ㈠[Err]Got a packet bigger then &#39;max_allowed_packet&#39; bytes 百度之，max_allowed_packet = 500M 但是错误依然没有解决。 （那些只知道转载的坑货） 来看看错误提示，居然是一个双引号？&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请看准备篇第2条。 ㈡MySQL server has gone away 百度之：一、可能是发送的SQL语句太长，以致超过了max_allowed_packet的大小，如果是这种原因，你只要修改my.cnf，加大max_allowed_packet的值即可。（又是这一套，我#$%&amp;#*~） 二、应用程序（PHP）长时间的执行批量的MYSQL语句，超过了mysql的 wait-timeout时间。 修改/etc/php.ini wait_timeout=2880000&nbsp; interactive_timeout&nbsp;=&nbsp;2880000 但是问题还是没解决。我的实际操作过程中遇到过几次，大部分是这两种情况。 Α使用MySQL Workbench向1700W条数据添加索引时。 Β使用Navicat 去重时。 那么使用Terminal&nbsp;看看。 麻麻再也不用担心MySql离我而去了。&nbsp; ㈢SQL文件带索引导入的，要检查index是否有效。 建议篇 ①基于各种数据库层数不穷的泄露，除了密码算法要各种加强外，我们自己的密码也要既有复杂性，又有迷惑性。例如&nbsp; I1O0&#39;&quot;,|/\r\n;&nbsp; ②数据库和web脚本也要考虑到扩展性，不同来源的表都要单独的建立一个新表。 ③web页面上对于每张表的查询时间可帮助你精确定位。 ④关于数据优化，我建议入库时保留regip，优化时采用如下语句来优化。 select&nbsp;regip,count(*)&nbsp;group&nbsp;by&nbsp;regip&nbsp;order&nbsp;by&nbsp;count(*)&nbsp;desc; 本条语句作用，你懂得，不用谢我。然后怎么做，你也懂。 实例 实例一 以2014-9-11国外某论坛流出来的gmail-5000000.txt文件为例 。 1.检查字符UTF-8，检查单双引号，既有单引号又有双引号还有波浪号。（看来国外有些人的密码意识很强） 2.分隔符是&quot;:&quot; ，统计&quot;:&quot;个数比行数多好几万。明显有部分人密码中带有&quot;:&quot;。（不能简单的用Navicat解决） 3.简单修改py脚本替换gmail.txt第一个出现的冒号为\t。 &nbsp; 嗯，一个都不能少。 实例二 以图为例 1.分隔符采用 &quot;—-&quot;，统计&quot;—-&quot;个数。 （居然还有人用这个当密码？） 2.navicat不能采用2位以上的分隔符。 3.先建表，然后采用load data local infile方法。（别忘了转UTF8 ，当然入库转也可以） Load&nbsp;data&nbsp;local&nbsp;infile&nbsp;`/home/xx/Desktop/b14.txt&#39;&nbsp;into&nbsp;table&nbsp;`tn`&nbsp;fields&nbsp;terminated&nbsp;by&nbsp;&#39;----&#39;; what！这么多警告，来看看是什么鬼。 垃圾邮箱这么多… 数据优化来一套： delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;mail&nbsp;like&nbsp;&#39;aaaaaa%&#39;&nbsp;and&nbsp;password&nbsp;like&nbsp;&#39;111111%&#39;; delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;id&nbsp;in(619665,618512,615362,606705,591547,571497,514328,509353,509349,509345,509342,494415,374357,346237,281087,255543,236556,227425,226934,22391,190644,161981,160870,132437,112240,86570,14403,9667);&nbsp;&nbsp;&nbsp;...... 自己看情况脑补。" />
<meta property="og:description" content="环境介绍&nbsp;&nbsp;&nbsp; ①Host：Fedora(English)(server)，win8(中文) ②Fedora安装apache，MySQL&nbsp;Workbench，语言包（Fedora安装时选择）。 ③Database：mysql&nbsp;安装在Fedora, 建库/表统一编码UTF8 ，修改my.cnf中的datadir=单独的一个分区，tmpdir=空间足够大的空间( &gt; 16G)。 ④Win8:安装了notepad++，Navicat。 MySql配置如下： /etc/my.cnf [mysqld] skip-name-resolve #datadir=/var/lib/mysql datadir=/home/data/mysql/ tmpdir=/MysqlTemp/ #socket=/var/lib/mysql/mysql.sock socket=/home/data/mysql/mysql.sock user=mysql default-character-set&nbsp;=&nbsp;utf8 max_allowed_packet&nbsp;=&nbsp;200M net_buffer_length&nbsp;=&nbsp;65536 wait_timeout&nbsp;=&nbsp;2880000 interactive_timeout&nbsp;=&nbsp;2880000 symbolic-links=0 &nbsp; [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid [mysql] socket=/home/data/mysql/mysql.sock [mysqldump] socket=/home/data/mysql/mysql.sock [mysqladmin] socket=/home/data/mysql/mysql.sock 着重修改datadir, tmpdir, socket。 可能有的同学还用txtSearch，我觉得实在是有点慢，还… 准备篇 ① txt体积不超过400M的一律先转化成UTF-8编码格式(8G内存图形化可以使用Notepad++) ② 检查txt中是否有 &quot;（双引号） &#39;（单引号），会导致意外终止。(还有其他原因后面提到) ③ 如果遇见分割成碎小体积的多份带有编码格式的txt，使用Linux下的cat * &gt; 1.txt时会出现编码问题（这也就是为什么先执行第一条），其实windows可用type * &gt; 1.txt搞定。(注: windows下type *源文件和目标文件要保持不同目录，windows下的命令工具确实有点渣。咳~) ④ sql格式的文件，建表时检查是否有索引，删除之，导入后再建，其速度回提高不少。 数据导入篇&nbsp;&nbsp; ①sql文件，删除key `user`&nbsp; (user) ;之类索引后，mysql执行source&nbsp;xxx.sql 导入，不用考虑编码问题，入库后直接使用workbench或nevicat编辑数据库属性转UTF8编码即可，然后再添加索引。 ②txt文件（使用tab间隔，回车换行），select into outfile txt / bcp&nbsp; 可以使用mysql命令load data infile a.txt into table test.a;（默认缺省FIELDS TERMINATED BY &#39;\t&#39; ENCLOSED BY &#39;&#39; ESCAPED BY &#39;\\&#39; ,行缺省LINES TERMINATED BY &#39;\n&#39; STARTING BY &#39;&#39;） ③txt文件（非tab的规律间隔符），可以使用操作简单的Navicat 导入。 ④txt文件（非规律间隔符），使用py处理成有序文本，再使用Navicat 导入。 上图是不规则的空格+tab，下图编写代码处理下。 偶遇几个异常，统计下看看所占比例。 except： &nbsp;&nbsp;&nbsp;&nbsp;count=count +1 来看看处理后的结果。 &nbsp; ⑤关于mssql转mysql ㈠MySQL-Migration-Toolkit㈡Mssql to Access&nbsp;&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp;&nbsp; access to MySQL㈢BCP&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp; Load data local infile txt into table xx; Win(mssql) cmd执行 bcp&nbsp;&quot;select&nbsp;*&nbsp;from&nbsp;dbname.dbo.info&quot;&nbsp;queryout&nbsp;info.txt&nbsp;&nbsp;-c&nbsp;-x&nbsp;-S127.0.0.1&nbsp;-Usa&nbsp;-P123.456&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;或者 bcp&nbsp;dbname.dbo.info&nbsp;out&nbsp;info.txt&nbsp;&nbsp;-c&nbsp;-x&nbsp;-S127.0.0.1&nbsp;-Usa&nbsp;-P123.456 Fedora(MySQL)执行 mysql&nbsp;-u&nbsp;root&nbsp;-p use&nbsp;test; Load&nbsp;data&nbsp;local&nbsp;infile&nbsp;&quot;/home/info.txt&quot;&nbsp;into&nbsp;table&nbsp;xx; ⑥EmpireBak帝国备份王 apache部署EmpireBak，设置目录权限。备份数据复制到bdata目录。登陆主界面，先设置参数，连接数据库，然后选择恢复数据选择要恢复的数据库。 优化篇 ①数据简化 delete&nbsp;from&nbsp;`XXXX`&nbsp;where&nbsp;mail&nbsp;not&nbsp;like&nbsp;&quot;%@%&quot;; 删除不符合邮件格式的记录 &nbsp; delete&nbsp;FROM&nbsp;`XXXX`&nbsp;where&nbsp;mail&nbsp;is&nbsp;null&nbsp;and&nbsp;length(username)&lt;4; 删除邮件为空并且用户名长度小于4的记录 &nbsp; delete&nbsp;FROM&nbsp;`XXXX`&nbsp;where&nbsp;length(password)&lt;4; 删除密码长度小于4的记录 &nbsp; delete&nbsp;from&nbsp;`xxxx`&nbsp;where&nbsp;mail&nbsp;is&nbsp;null&nbsp;and&nbsp;password=username; ...... ②数据去重 方法一 delete&nbsp;from&nbsp;`xxx`&nbsp;where&nbsp;id&nbsp;in&nbsp;(select&nbsp;*&nbsp;from&nbsp;(SELECT&nbsp;&nbsp;min(id)&nbsp;FROM&nbsp;`xxx`&nbsp;group&nbsp;by&nbsp;mail&nbsp;having&nbsp;count(mail)&gt;1)&nbsp;as&nbsp;a); 这是百度文章里 提到的最多的的一条语句。240W的数据处理了3个多小时才删除了19w数据。 方法二 create&nbsp;table&nbsp;tmp_xxx&nbsp;select&nbsp;min(id)&nbsp;as&nbsp;id,mail,password&nbsp;from&nbsp;xxx&nbsp;group&nbsp;by&nbsp;mail,password; 同样的240w数据去重不到两分钟就搞定了。（160w spend 56s ） 注：这条命令最容易出现的一个问题是临时空间不足，如果tmp是单独分区空间太小的话，可以修改my.cnf的tmpdir=/otherdir 。保证otherdir空间充足(&gt;16G)。修改otherdir权限，mysql可以访问修改。重启mysql。 ③关于查询优化 ㈠分清楚精确查询还是模糊查询 ，精确查询例如手机号；模糊查询例如用户名和邮箱。=比like效率高。㈡模糊查询尽量使用&#39;string%&#39; 来代替&#39;%string%&#39; 。㈢sql语句中能使用单引号的尽量使用单引号。㈣如果ID和行数一样，select * from xxx where id=888；可以用select * from xxx limit 887,1；代替(无索引时使用)。 ④添加索引 给常用查询字段添加索引，模糊类用BTREE存储类型，精确类用HASH存储类型。 推荐使用Navicat 选择表打开表讯息，选择DDL选项卡，可以清楚看到该表的sql，有无索引一目了然，然后右击数据库名选择它的console功能，来快速添加索引。 ALTER&nbsp;TABLE&nbsp;`XXX` ADD&nbsp;INDEX&nbsp;`inx_username`&nbsp;(`username`)&nbsp;, ADD&nbsp;INDEX&nbsp;`inx_mail`&nbsp;(`mail`)&nbsp;; ⑤表类型使用MyISAM&nbsp; MyISAM类型的表强调的是性能，其执行数度比InnoDB类型更快，但是不提供事务支持。另外MyISAM的索引和数据是分开的，并且索引是有压缩的，内存使用率也就对应提高了不少。 问题篇 ①关于利用帝国备份王跨平台恢复所见问题 ㈠打开本地页面，显示空白。 帝国备份采用了不是完全标准的PHP格式(&lt;?php&nbsp;… ?&gt;)书写，用了短标记格式&lt;?…?&gt; ，所以针对解决办法就是配置php.ini，启动短标记格式。 short_open_tag&nbsp;=&nbsp;On ㈡恢复数据时，点击开始恢复，提示参数不对 确保要恢复的数据库名和备份名一样（可在备份文件目录下的config.php查看），确保备份的php源文件有读写权限或者 chgrp apache *&nbsp; -R 。 ②PHP 问题㈠Fatal error: Allowed memory size of 134217728 bytes 最大单线程的独立内存使用量超过了128M。修改/etc/php.ini&nbsp;&nbsp;&nbsp; memory_limit=512M ㈡时区错误问题 修改/etc/php.ini&nbsp;&nbsp; &nbsp; date.timezone&nbsp;=&nbsp;Asia/Chongqing ㈢mysql默认位置修改 修改/etc/php.ini&nbsp;&nbsp; &nbsp; mysql.default_socket&nbsp;=&nbsp;/home/data/mysql/mysql.sock ㈣Illegal mix of collations (gbk_chinese_ci,IMPLICIT) and (latin1_general_ci,IMPLICIT) 查询的几个表之间，字符编码不统一，不能在当前页面显示。转UTF8。 ③sql&nbsp;加密，&nbsp;hex ④MySQL 问题 ㈠[Err]Got a packet bigger then &#39;max_allowed_packet&#39; bytes 百度之，max_allowed_packet = 500M 但是错误依然没有解决。 （那些只知道转载的坑货） 来看看错误提示，居然是一个双引号？&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请看准备篇第2条。 ㈡MySQL server has gone away 百度之：一、可能是发送的SQL语句太长，以致超过了max_allowed_packet的大小，如果是这种原因，你只要修改my.cnf，加大max_allowed_packet的值即可。（又是这一套，我#$%&amp;#*~） 二、应用程序（PHP）长时间的执行批量的MYSQL语句，超过了mysql的 wait-timeout时间。 修改/etc/php.ini wait_timeout=2880000&nbsp; interactive_timeout&nbsp;=&nbsp;2880000 但是问题还是没解决。我的实际操作过程中遇到过几次，大部分是这两种情况。 Α使用MySQL Workbench向1700W条数据添加索引时。 Β使用Navicat 去重时。 那么使用Terminal&nbsp;看看。 麻麻再也不用担心MySql离我而去了。&nbsp; ㈢SQL文件带索引导入的，要检查index是否有效。 建议篇 ①基于各种数据库层数不穷的泄露，除了密码算法要各种加强外，我们自己的密码也要既有复杂性，又有迷惑性。例如&nbsp; I1O0&#39;&quot;,|/\r\n;&nbsp; ②数据库和web脚本也要考虑到扩展性，不同来源的表都要单独的建立一个新表。 ③web页面上对于每张表的查询时间可帮助你精确定位。 ④关于数据优化，我建议入库时保留regip，优化时采用如下语句来优化。 select&nbsp;regip,count(*)&nbsp;group&nbsp;by&nbsp;regip&nbsp;order&nbsp;by&nbsp;count(*)&nbsp;desc; 本条语句作用，你懂得，不用谢我。然后怎么做，你也懂。 实例 实例一 以2014-9-11国外某论坛流出来的gmail-5000000.txt文件为例 。 1.检查字符UTF-8，检查单双引号，既有单引号又有双引号还有波浪号。（看来国外有些人的密码意识很强） 2.分隔符是&quot;:&quot; ，统计&quot;:&quot;个数比行数多好几万。明显有部分人密码中带有&quot;:&quot;。（不能简单的用Navicat解决） 3.简单修改py脚本替换gmail.txt第一个出现的冒号为\t。 &nbsp; 嗯，一个都不能少。 实例二 以图为例 1.分隔符采用 &quot;—-&quot;，统计&quot;—-&quot;个数。 （居然还有人用这个当密码？） 2.navicat不能采用2位以上的分隔符。 3.先建表，然后采用load data local infile方法。（别忘了转UTF8 ，当然入库转也可以） Load&nbsp;data&nbsp;local&nbsp;infile&nbsp;`/home/xx/Desktop/b14.txt&#39;&nbsp;into&nbsp;table&nbsp;`tn`&nbsp;fields&nbsp;terminated&nbsp;by&nbsp;&#39;----&#39;; what！这么多警告，来看看是什么鬼。 垃圾邮箱这么多… 数据优化来一套： delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;mail&nbsp;like&nbsp;&#39;aaaaaa%&#39;&nbsp;and&nbsp;password&nbsp;like&nbsp;&#39;111111%&#39;; delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;id&nbsp;in(619665,618512,615362,606705,591547,571497,514328,509353,509349,509345,509342,494415,374357,346237,281087,255543,236556,227425,226934,22391,190644,161981,160870,132437,112240,86570,14403,9667);&nbsp;&nbsp;&nbsp;...... 自己看情况脑补。" />
<link rel="canonical" href="https://mlh.app/2017/07/16/730199.html" />
<meta property="og:url" content="https://mlh.app/2017/07/16/730199.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-16T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"环境介绍&nbsp;&nbsp;&nbsp; ①Host：Fedora(English)(server)，win8(中文) ②Fedora安装apache，MySQL&nbsp;Workbench，语言包（Fedora安装时选择）。 ③Database：mysql&nbsp;安装在Fedora, 建库/表统一编码UTF8 ，修改my.cnf中的datadir=单独的一个分区，tmpdir=空间足够大的空间( &gt; 16G)。 ④Win8:安装了notepad++，Navicat。 MySql配置如下： /etc/my.cnf [mysqld] skip-name-resolve #datadir=/var/lib/mysql datadir=/home/data/mysql/ tmpdir=/MysqlTemp/ #socket=/var/lib/mysql/mysql.sock socket=/home/data/mysql/mysql.sock user=mysql default-character-set&nbsp;=&nbsp;utf8 max_allowed_packet&nbsp;=&nbsp;200M net_buffer_length&nbsp;=&nbsp;65536 wait_timeout&nbsp;=&nbsp;2880000 interactive_timeout&nbsp;=&nbsp;2880000 symbolic-links=0 &nbsp; [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid [mysql] socket=/home/data/mysql/mysql.sock [mysqldump] socket=/home/data/mysql/mysql.sock [mysqladmin] socket=/home/data/mysql/mysql.sock 着重修改datadir, tmpdir, socket。 可能有的同学还用txtSearch，我觉得实在是有点慢，还… 准备篇 ① txt体积不超过400M的一律先转化成UTF-8编码格式(8G内存图形化可以使用Notepad++) ② 检查txt中是否有 &quot;（双引号） &#39;（单引号），会导致意外终止。(还有其他原因后面提到) ③ 如果遇见分割成碎小体积的多份带有编码格式的txt，使用Linux下的cat * &gt; 1.txt时会出现编码问题（这也就是为什么先执行第一条），其实windows可用type * &gt; 1.txt搞定。(注: windows下type *源文件和目标文件要保持不同目录，windows下的命令工具确实有点渣。咳~) ④ sql格式的文件，建表时检查是否有索引，删除之，导入后再建，其速度回提高不少。 数据导入篇&nbsp;&nbsp; ①sql文件，删除key `user`&nbsp; (user) ;之类索引后，mysql执行source&nbsp;xxx.sql 导入，不用考虑编码问题，入库后直接使用workbench或nevicat编辑数据库属性转UTF8编码即可，然后再添加索引。 ②txt文件（使用tab间隔，回车换行），select into outfile txt / bcp&nbsp; 可以使用mysql命令load data infile a.txt into table test.a;（默认缺省FIELDS TERMINATED BY &#39;\\t&#39; ENCLOSED BY &#39;&#39; ESCAPED BY &#39;\\\\&#39; ,行缺省LINES TERMINATED BY &#39;\\n&#39; STARTING BY &#39;&#39;） ③txt文件（非tab的规律间隔符），可以使用操作简单的Navicat 导入。 ④txt文件（非规律间隔符），使用py处理成有序文本，再使用Navicat 导入。 上图是不规则的空格+tab，下图编写代码处理下。 偶遇几个异常，统计下看看所占比例。 except： &nbsp;&nbsp;&nbsp;&nbsp;count=count +1 来看看处理后的结果。 &nbsp; ⑤关于mssql转mysql ㈠MySQL-Migration-Toolkit㈡Mssql to Access&nbsp;&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp;&nbsp; access to MySQL㈢BCP&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp; Load data local infile txt into table xx; Win(mssql) cmd执行 bcp&nbsp;&quot;select&nbsp;*&nbsp;from&nbsp;dbname.dbo.info&quot;&nbsp;queryout&nbsp;info.txt&nbsp;&nbsp;-c&nbsp;-x&nbsp;-S127.0.0.1&nbsp;-Usa&nbsp;-P123.456&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;或者 bcp&nbsp;dbname.dbo.info&nbsp;out&nbsp;info.txt&nbsp;&nbsp;-c&nbsp;-x&nbsp;-S127.0.0.1&nbsp;-Usa&nbsp;-P123.456 Fedora(MySQL)执行 mysql&nbsp;-u&nbsp;root&nbsp;-p use&nbsp;test; Load&nbsp;data&nbsp;local&nbsp;infile&nbsp;&quot;/home/info.txt&quot;&nbsp;into&nbsp;table&nbsp;xx; ⑥EmpireBak帝国备份王 apache部署EmpireBak，设置目录权限。备份数据复制到bdata目录。登陆主界面，先设置参数，连接数据库，然后选择恢复数据选择要恢复的数据库。 优化篇 ①数据简化 delete&nbsp;from&nbsp;`XXXX`&nbsp;where&nbsp;mail&nbsp;not&nbsp;like&nbsp;&quot;%@%&quot;; 删除不符合邮件格式的记录 &nbsp; delete&nbsp;FROM&nbsp;`XXXX`&nbsp;where&nbsp;mail&nbsp;is&nbsp;null&nbsp;and&nbsp;length(username)&lt;4; 删除邮件为空并且用户名长度小于4的记录 &nbsp; delete&nbsp;FROM&nbsp;`XXXX`&nbsp;where&nbsp;length(password)&lt;4; 删除密码长度小于4的记录 &nbsp; delete&nbsp;from&nbsp;`xxxx`&nbsp;where&nbsp;mail&nbsp;is&nbsp;null&nbsp;and&nbsp;password=username; ...... ②数据去重 方法一 delete&nbsp;from&nbsp;`xxx`&nbsp;where&nbsp;id&nbsp;in&nbsp;(select&nbsp;*&nbsp;from&nbsp;(SELECT&nbsp;&nbsp;min(id)&nbsp;FROM&nbsp;`xxx`&nbsp;group&nbsp;by&nbsp;mail&nbsp;having&nbsp;count(mail)&gt;1)&nbsp;as&nbsp;a); 这是百度文章里 提到的最多的的一条语句。240W的数据处理了3个多小时才删除了19w数据。 方法二 create&nbsp;table&nbsp;tmp_xxx&nbsp;select&nbsp;min(id)&nbsp;as&nbsp;id,mail,password&nbsp;from&nbsp;xxx&nbsp;group&nbsp;by&nbsp;mail,password; 同样的240w数据去重不到两分钟就搞定了。（160w spend 56s ） 注：这条命令最容易出现的一个问题是临时空间不足，如果tmp是单独分区空间太小的话，可以修改my.cnf的tmpdir=/otherdir 。保证otherdir空间充足(&gt;16G)。修改otherdir权限，mysql可以访问修改。重启mysql。 ③关于查询优化 ㈠分清楚精确查询还是模糊查询 ，精确查询例如手机号；模糊查询例如用户名和邮箱。=比like效率高。㈡模糊查询尽量使用&#39;string%&#39; 来代替&#39;%string%&#39; 。㈢sql语句中能使用单引号的尽量使用单引号。㈣如果ID和行数一样，select * from xxx where id=888；可以用select * from xxx limit 887,1；代替(无索引时使用)。 ④添加索引 给常用查询字段添加索引，模糊类用BTREE存储类型，精确类用HASH存储类型。 推荐使用Navicat 选择表打开表讯息，选择DDL选项卡，可以清楚看到该表的sql，有无索引一目了然，然后右击数据库名选择它的console功能，来快速添加索引。 ALTER&nbsp;TABLE&nbsp;`XXX` ADD&nbsp;INDEX&nbsp;`inx_username`&nbsp;(`username`)&nbsp;, ADD&nbsp;INDEX&nbsp;`inx_mail`&nbsp;(`mail`)&nbsp;; ⑤表类型使用MyISAM&nbsp; MyISAM类型的表强调的是性能，其执行数度比InnoDB类型更快，但是不提供事务支持。另外MyISAM的索引和数据是分开的，并且索引是有压缩的，内存使用率也就对应提高了不少。 问题篇 ①关于利用帝国备份王跨平台恢复所见问题 ㈠打开本地页面，显示空白。 帝国备份采用了不是完全标准的PHP格式(&lt;?php&nbsp;… ?&gt;)书写，用了短标记格式&lt;?…?&gt; ，所以针对解决办法就是配置php.ini，启动短标记格式。 short_open_tag&nbsp;=&nbsp;On ㈡恢复数据时，点击开始恢复，提示参数不对 确保要恢复的数据库名和备份名一样（可在备份文件目录下的config.php查看），确保备份的php源文件有读写权限或者 chgrp apache *&nbsp; -R 。 ②PHP 问题㈠Fatal error: Allowed memory size of 134217728 bytes 最大单线程的独立内存使用量超过了128M。修改/etc/php.ini&nbsp;&nbsp;&nbsp; memory_limit=512M ㈡时区错误问题 修改/etc/php.ini&nbsp;&nbsp; &nbsp; date.timezone&nbsp;=&nbsp;Asia/Chongqing ㈢mysql默认位置修改 修改/etc/php.ini&nbsp;&nbsp; &nbsp; mysql.default_socket&nbsp;=&nbsp;/home/data/mysql/mysql.sock ㈣Illegal mix of collations (gbk_chinese_ci,IMPLICIT) and (latin1_general_ci,IMPLICIT) 查询的几个表之间，字符编码不统一，不能在当前页面显示。转UTF8。 ③sql&nbsp;加密，&nbsp;hex ④MySQL 问题 ㈠[Err]Got a packet bigger then &#39;max_allowed_packet&#39; bytes 百度之，max_allowed_packet = 500M 但是错误依然没有解决。 （那些只知道转载的坑货） 来看看错误提示，居然是一个双引号？&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请看准备篇第2条。 ㈡MySQL server has gone away 百度之：一、可能是发送的SQL语句太长，以致超过了max_allowed_packet的大小，如果是这种原因，你只要修改my.cnf，加大max_allowed_packet的值即可。（又是这一套，我#$%&amp;#*~） 二、应用程序（PHP）长时间的执行批量的MYSQL语句，超过了mysql的 wait-timeout时间。 修改/etc/php.ini wait_timeout=2880000&nbsp; interactive_timeout&nbsp;=&nbsp;2880000 但是问题还是没解决。我的实际操作过程中遇到过几次，大部分是这两种情况。 Α使用MySQL Workbench向1700W条数据添加索引时。 Β使用Navicat 去重时。 那么使用Terminal&nbsp;看看。 麻麻再也不用担心MySql离我而去了。&nbsp; ㈢SQL文件带索引导入的，要检查index是否有效。 建议篇 ①基于各种数据库层数不穷的泄露，除了密码算法要各种加强外，我们自己的密码也要既有复杂性，又有迷惑性。例如&nbsp; I1O0&#39;&quot;,|/\\r\\n;&nbsp; ②数据库和web脚本也要考虑到扩展性，不同来源的表都要单独的建立一个新表。 ③web页面上对于每张表的查询时间可帮助你精确定位。 ④关于数据优化，我建议入库时保留regip，优化时采用如下语句来优化。 select&nbsp;regip,count(*)&nbsp;group&nbsp;by&nbsp;regip&nbsp;order&nbsp;by&nbsp;count(*)&nbsp;desc; 本条语句作用，你懂得，不用谢我。然后怎么做，你也懂。 实例 实例一 以2014-9-11国外某论坛流出来的gmail-5000000.txt文件为例 。 1.检查字符UTF-8，检查单双引号，既有单引号又有双引号还有波浪号。（看来国外有些人的密码意识很强） 2.分隔符是&quot;:&quot; ，统计&quot;:&quot;个数比行数多好几万。明显有部分人密码中带有&quot;:&quot;。（不能简单的用Navicat解决） 3.简单修改py脚本替换gmail.txt第一个出现的冒号为\\t。 &nbsp; 嗯，一个都不能少。 实例二 以图为例 1.分隔符采用 &quot;—-&quot;，统计&quot;—-&quot;个数。 （居然还有人用这个当密码？） 2.navicat不能采用2位以上的分隔符。 3.先建表，然后采用load data local infile方法。（别忘了转UTF8 ，当然入库转也可以） Load&nbsp;data&nbsp;local&nbsp;infile&nbsp;`/home/xx/Desktop/b14.txt&#39;&nbsp;into&nbsp;table&nbsp;`tn`&nbsp;fields&nbsp;terminated&nbsp;by&nbsp;&#39;----&#39;; what！这么多警告，来看看是什么鬼。 垃圾邮箱这么多… 数据优化来一套： delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;mail&nbsp;like&nbsp;&#39;aaaaaa%&#39;&nbsp;and&nbsp;password&nbsp;like&nbsp;&#39;111111%&#39;; delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;id&nbsp;in(619665,618512,615362,606705,591547,571497,514328,509353,509349,509345,509342,494415,374357,346237,281087,255543,236556,227425,226934,22391,190644,161981,160870,132437,112240,86570,14403,9667);&nbsp;&nbsp;&nbsp;...... 自己看情况脑补。","@type":"BlogPosting","url":"https://mlh.app/2017/07/16/730199.html","headline":"社工库","dateModified":"2017-07-16T00:00:00+08:00","datePublished":"2017-07-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/07/16/730199.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>社工库</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <p style="font-family:Arial;font-size:14px;"> <span style="font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>环境介绍&nbsp;</strong></span><span style="color:rgb(88,88,88);font-size:10pt;"><strong>&nbsp;&nbsp;</strong></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">①Host：Fedora(English)(server)，win8(中文)<br> ②Fedora安装apache，<a href="http://lib.csdn.net/base/mysql" rel="nofollow" class="replace_word" title="MySQL知识库" style="color:rgb(223,52,52);font-weight:bold;">MySQL</a>&nbsp;Workbench，语言包（Fedora安装时选择）。<br> ③Database：<a href="http://lib.csdn.net/base/mysql" rel="nofollow" class="replace_word" title="MySQL知识库" style="color:rgb(223,52,52);font-weight:bold;">mysql</a>&nbsp;安装在Fedora, 建库/表统一编码UTF8<br> ，修改my.cnf中的datadir=单独的一个分区，tmpdir=空间足够大的空间( &gt; 16G)。<br> ④Win8:安装了notepad++，Navicat。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"><strong>MySql配置如下：</strong></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">/<span style="color:rgb(72,72,76);">etc<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">my<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">cnf<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">[<span style="color:rgb(72,72,76);">mysqld<span style="color:rgb(147,161,161);">]<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">skip<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">name<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">resolve</span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">#datadir=/var/lib/mysql<span style="color:rgb(72,72,76);"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">datadir<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/home/<span style="color:rgb(72,72,76);">data<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">tmpdir<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/MysqlTemp/<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">#socket=/var/lib/mysql/mysql.sock<span style="color:rgb(72,72,76);"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">socket<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/home/<span style="color:rgb(72,72,76);">data<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">sock</span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">user<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">mysql</span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">default<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">character<span style="color:rgb(147,161,161);">-<span style="color:rgb(30,52,123);">set<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;utf8</span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">max_allowed_packet&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(25,95,145);">200M<span style="color:rgb(72,72,76);"></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">net_buffer_length&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(25,95,145);">65536<span style="color:rgb(72,72,76);"></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">wait_timeout&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(25,95,145);">2880000<span style="color:rgb(72,72,76);"></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">interactive_timeout&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(25,95,145);">2880000<span style="color:rgb(72,72,76);"></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">symbolic<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">links<span style="color:rgb(147,161,161);">=<span style="color:rgb(25,95,145);">0<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> &nbsp;</p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">[<span style="color:rgb(72,72,76);">mysqld_safe<span style="color:rgb(147,161,161);">]<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">log<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">error<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/var/<span style="color:rgb(72,72,76);">log<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysqld<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">log</span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">pid<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">file<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/var/<span style="color:rgb(72,72,76);">run<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysqld<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysqld<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">pid</span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">[<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">]<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">socket<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/home/<span style="color:rgb(72,72,76);">data<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">sock</span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">[<span style="color:rgb(72,72,76);">mysqldump<span style="color:rgb(147,161,161);">]<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">socket<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/home/<span style="color:rgb(72,72,76);">data<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">sock</span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">[<span style="color:rgb(72,72,76);">mysqladmin<span style="color:rgb(147,161,161);">]<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">socket<span style="color:rgb(147,161,161);">=<span style="color:rgb(221,17,68);">/home/<span style="color:rgb(72,72,76);">data<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">sock<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">着重修改datadir, tmpdir, socket。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">可能有的同学还用txtSearch，我觉得实在是有点慢，还…</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343564414402.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/XnUKueli1vt_sTWyA9nJQw==/6631420708931064666.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>准备篇</strong></span><span style="color:rgb(88,88,88);font-size:10pt;"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">① txt体积不超过400M的一律先转化成UTF-8编码格式(8G内存图形化可以使用Notepad++)<br> ② 检查txt中是否有 "（双引号） '（单引号），会导致意外终止。(还有其他原因后面提到)<br> ③ 如果遇见分割成碎小体积的多份带有编码格式的txt，使用<a href="http://lib.csdn.net/base/linux" rel="nofollow" class="replace_word" title="Linux知识库" style="color:rgb(223,52,52);font-weight:bold;">Linux</a>下的cat * &gt; 1.txt时会出现编码问题（这也就是为什么先执行第一条），其实windows可用type * &gt; 1.txt搞定。(注: windows下type *源文件和目标文件要保持不同目录，windows下的命令工具确实有点渣。咳~)<br> ④ sql格式的文件，建表时检查是否有索引，删除之，导入后再建，其速度回提高不少。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>数据导入篇</strong></span><span style="font-size:10pt;"><strong>&nbsp;&nbsp;</strong></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">①sql文件，删除key `user`&nbsp; (user) ;之类索引后，mysql执行source&nbsp;xxx.sql 导入，不用考虑编码问题，入库后直接使用workbench或nevicat编辑数据库属性转UTF8编码即可，然后再添加索引。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">②txt文件（使用tab间隔，回车换行），select into outfile txt / bcp&nbsp; 可以使用mysql命令load data infile a.txt into table test.a;（默认缺省FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\' ,行缺省LINES TERMINATED BY '\n' STARTING BY ''）</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343572721974.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img2.ph.126.net/mMUBAdpjJKSitsTuHsPKFw==/6608941193702159243.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">③txt文件（非tab的规律间隔符），可以使用操作简单的Navicat 导入。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343575497577.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/uek5YHQpzWXlHhkroPiWUA==/6619103979677861971.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">④txt文件（非规律间隔符），使用py处理成有序文本，再使用Navicat 导入。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343576924899.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/zpnatww-_jU3ZqDevh9ZVQ==/6631403116745020218.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">上图是不规则的空格+tab，下图编写代码处理下。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343577928581.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/_H9LAyAzjyB-V0YIEYsvog==/6608804854260312168.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">偶遇几个异常，统计下看看所占比例。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/1434358040276.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img2.ph.126.net/ne1a5oIN3CMb4C-moBiGpA==/6608941193702159246.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">except：</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;count=count +1</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343582813967.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/tinn4u53z9W2Auc3zLGAOA==/6630935824304974867.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">来看看处理后的结果。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343585132361.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/aWX8Pynk7TcfN3RD8X88yQ==/6630063911583674244.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> &nbsp;</p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">⑤关于mssql转mysql</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈠</span><span style="font-family:'微软雅黑';">MySQL-Migration-Toolkit<br></span><span style="font-family:'宋体';">㈡</span><span style="font-family:'微软雅黑';">Mssql to Access&nbsp;&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp;&nbsp; access to MySQL<br></span><span style="font-family:'宋体';">㈢</span><span style="font-family:'微软雅黑';">BCP&nbsp;&nbsp;&nbsp; then&nbsp;&nbsp;&nbsp; Load data local infile txt into table xx;</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">Win(mssql) cmd执行</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-size:10pt;"><span style="font-family:Consolas;">bcp&nbsp;<span style="color:rgb(221,17,68);">"select&nbsp;*&nbsp;from&nbsp;dbname.dbo.info"<span style="color:rgb(72,72,76);">&nbsp;queryout&nbsp;info<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">txt&nbsp;&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">c&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">x&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">S127<span style="color:rgb(147,161,161);">.<span style="color:rgb(25,95,145);">0.0<span style="color:rgb(147,161,161);">.<span style="color:rgb(25,95,145);">1<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:#008080;">Usa<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">P123<span style="color:rgb(147,161,161);">.<span style="color:rgb(25,95,145);">456<span style="color:rgb(72,72,76);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="color:rgb(147,161,161);"><span style="font-family:'宋体';">或者</span><span style="color:rgb(72,72,76);font-family:Consolas;"></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">bcp&nbsp;dbname<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">dbo<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">info&nbsp;<span style="color:rgb(30,52,123);">out<span style="color:rgb(72,72,76);">&nbsp;info<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">txt&nbsp;&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">c&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">x&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">S127<span style="color:rgb(147,161,161);">.<span style="color:rgb(25,95,145);">0.0<span style="color:rgb(147,161,161);">.<span style="color:rgb(25,95,145);">1<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:#008080;">Usa<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">P123<span style="color:rgb(147,161,161);">.<span style="color:rgb(25,95,145);">456<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">Fedora(MySQL)执行</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">mysql&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">u&nbsp;root&nbsp;<span style="color:rgb(147,161,161);">-<span style="color:rgb(72,72,76);">p</span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">use<span style="color:rgb(72,72,76);">&nbsp;test<span style="color:rgb(147,161,161);">;<span style="color:rgb(72,72,76);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:#008080;font-family:Consolas;font-size:10pt;">Load<span style="color:rgb(72,72,76);">&nbsp;data&nbsp;<span style="color:rgb(30,52,123);">local<span style="color:rgb(72,72,76);">&nbsp;infile&nbsp;<span style="color:rgb(221,17,68);">"/home/info.txt"<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">into<span style="color:rgb(72,72,76);">&nbsp;table&nbsp;xx<span style="color:rgb(147,161,161);">;<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">⑥EmpireBak帝国备份王</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">apache部署EmpireBak，设置目录权限。备份数据复制到bdata目录。登陆主界面，先设置参数，连接数据库，然后选择恢复数据选择要恢复的数据库。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>优化篇</strong></span><span style="color:rgb(88,88,88);font-size:10pt;"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">①数据简化</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">delete<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">from<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(221,17,68);">`XXXX`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">where<span style="color:rgb(72,72,76);">&nbsp;mail&nbsp;<span style="color:rgb(30,52,123);">not<span style="color:rgb(72,72,76);">&nbsp;like&nbsp;<span style="color:rgb(221,17,68);">"%@%"<span style="color:rgb(147,161,161);">;<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-size:10pt;"><span style="font-family:'宋体';">删除不符合邮件格式的记录</span><span style="color:rgb(72,72,76);font-family:Consolas;"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> &nbsp;</p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">delete<span style="color:rgb(72,72,76);">&nbsp;FROM&nbsp;<span style="color:rgb(221,17,68);">`XXXX`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">where<span style="color:rgb(72,72,76);">&nbsp;mail&nbsp;<span style="color:rgb(30,52,123);">is<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">null<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">and<span style="color:rgb(72,72,76);">&nbsp;length<span style="color:rgb(147,161,161);">(<span style="color:rgb(72,72,76);">username<span style="color:rgb(147,161,161);">)&lt;<span style="color:rgb(25,95,145);">4<span style="color:rgb(147,161,161);">;<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-size:10pt;"><span style="font-family:'宋体';">删除邮件为空并且用户名长度小于</span><span style="color:rgb(25,95,145);"><span style="font-family:Consolas;">4</span><span style="color:rgb(147,161,161);"><span style="font-family:'宋体';">的记录</span><span style="color:rgb(72,72,76);font-family:Consolas;"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> &nbsp;</p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">delete<span style="color:rgb(72,72,76);">&nbsp;FROM&nbsp;<span style="color:rgb(221,17,68);">`XXXX`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">where<span style="color:rgb(72,72,76);">&nbsp;length<span style="color:rgb(147,161,161);">(<span style="color:rgb(72,72,76);">password<span style="color:rgb(147,161,161);">)&lt;<span style="color:rgb(25,95,145);">4<span style="color:rgb(147,161,161);">;<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-size:10pt;"><span style="font-family:'宋体';">删除密码长度小于</span><span style="color:rgb(25,95,145);"><span style="font-family:Consolas;">4</span><span style="color:rgb(147,161,161);"><span style="font-family:'宋体';">的记录</span><span style="color:rgb(72,72,76);font-family:Consolas;"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> &nbsp;</p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">delete<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">from<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(221,17,68);">`xxxx`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">where<span style="color:rgb(72,72,76);">&nbsp;mail&nbsp;<span style="color:rgb(30,52,123);">is<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">null<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">and<span style="color:rgb(72,72,76);">&nbsp;password<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">username<span style="color:rgb(147,161,161);">;<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(147,161,161);font-family:Consolas;font-size:10pt;">......<span style="color:rgb(51,51,51);"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">②数据去重</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">方法一</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">delete<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">from<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(221,17,68);">`xxx`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">where<span style="color:rgb(72,72,76);">&nbsp;id&nbsp;<span style="color:rgb(30,52,123);">in<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">(<span style="color:rgb(30,52,123);">select<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">*<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">from<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">(<span style="color:rgb(72,72,76);">SELECT&nbsp;&nbsp;min<span style="color:rgb(147,161,161);">(<span style="color:rgb(72,72,76);">id<span style="color:rgb(147,161,161);">)<span style="color:rgb(72,72,76);">&nbsp;FROM&nbsp;<span style="color:rgb(221,17,68);">`xxx`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">group<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">by<span style="color:rgb(72,72,76);">&nbsp;mail&nbsp;having&nbsp;count<span style="color:rgb(147,161,161);">(<span style="color:rgb(72,72,76);">mail<span style="color:rgb(147,161,161);">)&gt;<span style="color:rgb(25,95,145);">1<span style="color:rgb(147,161,161);">)<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">as<span style="color:rgb(72,72,76);">&nbsp;a<span style="color:rgb(147,161,161);">);<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">这是百度文章里 提到的最多的的一条语句。240W的数据处理了3个多小时才删除了19w数据。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">方法二</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">create&nbsp;table&nbsp;tmp_xxx&nbsp;<span style="color:rgb(30,52,123);">select<span style="color:rgb(72,72,76);">&nbsp;min<span style="color:rgb(147,161,161);">(<span style="color:rgb(72,72,76);">id<span style="color:rgb(147,161,161);">)<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">as<span style="color:rgb(72,72,76);">&nbsp;id<span style="color:rgb(147,161,161);">,<span style="color:rgb(72,72,76);">mail<span style="color:rgb(147,161,161);">,<span style="color:rgb(72,72,76);">password&nbsp;<span style="color:rgb(30,52,123);">from<span style="color:rgb(72,72,76);">&nbsp;xxx&nbsp;<span style="color:rgb(30,52,123);">group<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">by<span style="color:rgb(72,72,76);">&nbsp;mail<span style="color:rgb(147,161,161);">,<span style="color:rgb(72,72,76);">password<span style="color:rgb(147,161,161);">;<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">同样的240w数据去重不到两分钟就搞定了。（160w spend 56s ）</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(0,176,80);font-family:'微软雅黑';font-size:10pt;">注：这条命令最容易出现的一个问题是临时空间不足，如果tmp是单独分区空间太小的话，可以修改my.cnf的tmpdir=/otherdir 。保证otherdir空间充足(&gt;16G)。修改otherdir权限，mysql可以访问修改。重启mysql。<span style="color:rgb(88,88,88);"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343592581033.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/dOmm_tUzcfRDkaNNA9vYsQ==/644859171662147385.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">③关于查询优化</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈠</span><span style="font-family:'微软雅黑';">分清楚精确查询还是模糊查询 ，精确查询例如手机号；模糊查询例如用户名和邮箱。=比like效率高。<br></span><span style="font-family:'宋体';">㈡</span><span style="font-family:'微软雅黑';">模糊查询尽量使用'string%' 来代替'%string%' 。<br></span><span style="font-family:'宋体';">㈢</span><span style="font-family:'微软雅黑';">sql语句中能使用单引号的尽量使用单引号。<br></span><span style="font-family:'宋体';">㈣</span><span style="font-family:'微软雅黑';">如果ID和行数一样，select * from xxx where id=888；可以用select * from xxx limit 887,1；代替(无索引时使用)。</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">④添加索引</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">给常用查询字段添加索引，模糊类用BTREE存储类型，精确类用HASH存储类型。<br> 推荐使用Navicat 选择表打开表讯息，选择DDL选项卡，可以清楚看到该表的sql，有无索引一目了然，然后右击数据库名选择它的console功能，来快速添加索引。</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">ALTER&nbsp;TABLE&nbsp;<span style="color:rgb(221,17,68);">`XXX`<span style="color:rgb(72,72,76);"></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">ADD&nbsp;INDEX&nbsp;<span style="color:rgb(221,17,68);">`inx_username`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">(<span style="color:rgb(221,17,68);">`username`<span style="color:rgb(147,161,161);">)<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">,<span style="color:rgb(72,72,76);"></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">ADD&nbsp;INDEX&nbsp;<span style="color:rgb(221,17,68);">`inx_mail`<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">(<span style="color:rgb(221,17,68);">`mail`<span style="color:rgb(147,161,161);">)<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(147,161,161);">;<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">⑤表类型使用MyISAM&nbsp;</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">MyISAM类型的表强调的是性能，其执行数度比InnoDB类型更快，但是不提供事务支持。另外MyISAM的索引和数据是分开的，并且索引是有压缩的，内存使用率也就对应提高了不少。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>问题篇</strong></span><span style="color:rgb(88,88,88);font-size:10pt;"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">①关于利用帝国备份王跨平台恢复所见问题</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈠</span><span style="font-family:'微软雅黑';">打开本地页面，显示空白。</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">帝国备份采用了不是完全标准的<a href="http://lib.csdn.net/base/php" rel="nofollow" class="replace_word" title="PHP知识库" style="color:rgb(223,52,52);font-weight:bold;">PHP</a>格式(&lt;?<a href="http://lib.csdn.net/base/php" rel="nofollow" class="replace_word" title="PHP知识库" style="color:rgb(223,52,52);font-weight:bold;">php</a>&nbsp;… ?&gt;)书写，用了短标记格式&lt;?…?&gt; ，所以针对解决办法就是配置php.ini，启动短标记格式。</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">short_open_tag&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:#008080;">On<span style="color:rgb(51,51,51);"></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈡</span><span style="font-family:'微软雅黑';">恢复数据时，点击开始恢复，提示参数不对<br> 确保要恢复的数据库名和备份名一样（可在备份文件目录下的config.php查看），确保备份的php源文件有读写权限或者 chgrp apache *&nbsp; -R 。</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'微软雅黑';">②PHP 问题<br></span><span style="font-family:'宋体';">㈠</span><span style="font-family:'微软雅黑';">Fatal error: Allowed memory size of 134217728 bytes</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">最大单线程的独立内存使用量超过了128M。修改/etc/php.ini&nbsp;&nbsp;&nbsp;</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">memory_limit<span style="color:rgb(147,161,161);">=<span style="color:rgb(25,95,145);">512M<span style="color:rgb(51,51,51);"></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈡</span><span style="font-family:'微软雅黑';">时区错误问题</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">修改/etc/php.ini&nbsp;&nbsp; &nbsp;</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">date<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">timezone&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:#008080;">Asia<span style="color:rgb(147,161,161);">/<span style="color:#008080;">Chongqing<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈢</span><span style="font-family:'微软雅黑';">mysql默认位置修改</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">修改/etc/php.ini&nbsp;&nbsp; &nbsp;</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">mysql<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">default_socket&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(221,17,68);">/home/<span style="color:rgb(72,72,76);">data<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">/<span style="color:rgb(72,72,76);">mysql<span style="color:rgb(147,161,161);">.<span style="color:rgb(72,72,76);">sock<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈣</span><span style="font-family:'微软雅黑';">Illegal mix of collations (gbk_chinese_ci,IMPLICIT) and (latin1_general_ci,IMPLICIT)</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">查询的几个表之间，字符编码不统一，不能在当前页面显示。转UTF8。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">③sql&nbsp;加密，&nbsp;hex</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343600201111.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/sCEYm71KKVgHy0WWbjL0oQ==/6630063911583674248.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343600562534.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/ikZS7zBFQRrnsizYZ4WAzA==/2870200337536920775.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">④MySQL 问题</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈠</span><span style="font-family:'微软雅黑';">[Err]Got a packet bigger then 'max_allowed_packet' bytes<br> 百度之，max_allowed_packet = 500M 但是错误依然没有解决。 （那些只知道转载的坑货）</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">来看看错误提示，居然是一个双引号？&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请看准备篇第2条。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343602498394.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/dhFOYb0Y7aOXZlKGAu3Eyw==/654710795847016987.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈡</span><span style="font-family:'微软雅黑';">MySQL server has gone away</span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">百度之：一、可能是发送的SQL语句太长，以致超过了max_allowed_packet的大小，如果是这种原因，你只要修改my.cnf，加大max_allowed_packet的值即可。（又是这一套，我#$%&amp;#*~）</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">二、应用程序（PHP）长时间的执行批量的MYSQL语句，超过了mysql的 wait-timeout时间。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">修改/etc/php.ini</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">wait_timeout<span style="color:rgb(147,161,161);">=<span style="color:rgb(25,95,145);">2880000<span style="color:rgb(72,72,76);">&nbsp;</span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">interactive_timeout&nbsp;<span style="color:rgb(147,161,161);">=<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(25,95,145);">2880000<span style="color:rgb(51,51,51);"></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">但是问题还是没解决。我的实际操作过程中遇到过几次，大部分是这两种情况。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">Α使用MySQL Workbench向1700W条数据添加索引时。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">Β使用Navicat 去重时。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">那么使用Terminal&nbsp;看看。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343608746263.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/Wr7iwt5kqcabRskDsUN-IQ==/1057782962496841992.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">麻麻再也不用担心MySql离我而去了。&nbsp;</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-size:10pt;"><span style="font-family:'宋体';">㈢</span><span style="font-family:'微软雅黑';">SQL文件带索引导入的，要检查index是否有效。</span></span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343612613475.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/1672FrTnr2otbrp8cLShAg==/656118170730575329.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>建议篇</strong></span><span style="color:rgb(88,88,88);font-size:10pt;"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">①基于各种数据库层数不穷的泄露，除了密码<a href="http://lib.csdn.net/base/datastructure" rel="nofollow" class="replace_word" title="算法与数据结构知识库" style="color:rgb(223,52,52);font-weight:bold;">算法</a>要各种加强外，我们自己的密码也要既有复杂性，又有迷惑性。例如&nbsp; I1O0'",|/\r\n;&nbsp;<br> ②数据库和web脚本也要考虑到扩展性，不同来源的表都要单独的建立一个新表。<br> ③web页面上对于每张表的查询时间可帮助你精确定位。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343615749251.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/3sqP8xzILCD0XVFfo7mIZA==/2585910611058910225.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">④关于数据优化，我建议入库时保留regip，优化时采用如下语句来优化。</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(30,52,123);font-family:Consolas;font-size:10pt;">select<span style="color:rgb(72,72,76);">&nbsp;regip<span style="color:rgb(147,161,161);">,<span style="color:rgb(72,72,76);">count<span style="color:rgb(147,161,161);">(*)<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">group<span style="color:rgb(72,72,76);">&nbsp;<span style="color:rgb(30,52,123);">by<span style="color:rgb(72,72,76);">&nbsp;regip&nbsp;order&nbsp;<span style="color:rgb(30,52,123);">by<span style="color:rgb(72,72,76);">&nbsp;count<span style="color:rgb(147,161,161);">(*)<span style="color:rgb(72,72,76);">&nbsp;desc<span style="color:rgb(147,161,161);">;<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">本条语句作用，你懂得，不用谢我。然后怎么做，你也懂。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="font-family:'微软雅黑';"><span style="font-size:13pt;"><strong>实例</strong></span><span style="color:rgb(88,88,88);font-size:10pt;"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"><strong>实例一</strong></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">以2014-9-11国外某论坛流出来的gmail-5000000.txt文件为例<br> 。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">1.检查字符UTF-8，检查单双引号，既有单引号又有双引号还有波浪号。（看来国外有些人的密码意识很强）<br> 2.分隔符是":" ，统计":"个数比行数多好几万。明显有部分人密码中带有":"。（不能简单的用Navicat解决）<br> 3.简单修改py脚本替换gmail.txt第一个出现的冒号为\t。</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343619341865.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/Qe1U5daAC2nuJUY1RwSs7g==/6630332192420853381.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> &nbsp;</p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">嗯，一个都不能少。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"><strong>实例二</strong></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">以图为例</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">1.分隔符采用 "—-"，统计"—-"个数。 （居然还有人用这个当密码？）<br> 2.navicat不能采用2位以上的分隔符。<br> 3.先建表，然后采用load data local infile方法。（别忘了转UTF8 ，当然入库转也可以）</span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/1434362129295.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img1.ph.126.net/Ic4H2_ZrUtDcIxEKdZRoNw==/6608804854260312175.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:#008080;font-family:Consolas;font-size:10pt;">Load<span style="color:rgb(72,72,76);">&nbsp;data&nbsp;<span style="color:rgb(30,52,123);">local<span style="color:rgb(72,72,76);">&nbsp;infile&nbsp;<span style="color:rgb(221,17,68);">`/home/xx/Desktop/b14.txt'&nbsp;into&nbsp;table&nbsp;`<span style="color:rgb(72,72,76);">tn<span style="color:rgb(221,17,68);">`&nbsp;fields&nbsp;terminated&nbsp;by&nbsp;'----';<span style="color:rgb(51,51,51);"></span></span></span></span></span></span></span></span></p> 
  <p style="font-family:Arial;font-size:14px;text-align:center;"> <a href="http://image.3001.net/images/20150615/14343623227314.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img2.ph.126.net/JQgqLxBCB-u7RZV2r3k3Og==/38280596850844868.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">what！这么多警告，来看看是什么鬼。</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <a href="http://image.3001.net/images/20150615/14343623955427.jpg!small" rel="nofollow" style="color:rgb(202,0,0);"><img title="关于建立社工库的经验总结 - l0ser - l0ser的博客" src="http://img0.ph.126.net/QL-1h31glHu6j4t3zAynfw==/6630746708304982062.jpg" alt="" border="0" style="border:none;"></a><span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;"></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">垃圾邮箱这么多…</span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">数据优化来一套：</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;mail&nbsp;like&nbsp;'aaaaaa%'&nbsp;and&nbsp;password&nbsp;like&nbsp;'111111%';</span></p> 
  <p style="font-family:Arial;font-size:14px;background:rgb(247,247,249);"> <span style="color:rgb(72,72,76);font-family:Consolas;font-size:10pt;">delete&nbsp;from&nbsp;xxx&nbsp;where&nbsp;id&nbsp;in(619665,618512,615362,606705,591547,571497,514328,509353,509349,509345,509342,494415,374357,346237,281087,255543,236556,227425,226934,22391,190644,161981,160870,132437,112240,86570,14403,9667);&nbsp;&nbsp;&nbsp;......<span style="color:rgb(51,51,51);"></span></span></p> 
  <p style="font-family:Arial;font-size:14px;"> <span style="color:rgb(88,88,88);font-family:'微软雅黑';font-size:10pt;">自己看情况脑补。</span></p> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?aee162ba0c05d8e682055e28ff964fa2";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>区块链开发专题(数字货币的数据结构与签名类型) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="区块链开发专题(数字货币的数据结构与签名类型)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="区块链爱好者（QQ：53016353） 交易(Transaction)是数字货币系统的信息载体，最小单元。而块(Block)就是将这些基础单元打包装箱，贴上封条，并串联起来。巨大算力保障了块的安全，也就保障了单个交易的安全。 类型 交易有三种常见类型：产量交易(Generation)，合成地址交易(Script Hash)，通用地址交易(Pubkey Hash)。该分类并非严格意义的，只是根据交易的输入输出做的简单区分。 Generation TX 每个Block都对应一个产量交易(Generation TX)，该类交易是没有输入交易的，挖出的新币是所有币的源头。 Script Hash TX 该类交易目前不是很常见，大部分人可能没有听说过，但是非常有意义。未来应该会在某些场合频繁使用。该类交易的接受地址不是通常意义的地址，而是一个合成地址，以3开头（对，以3开头的也是数字货币地址！）。三对公私钥，可以生成一个合成地址。在生成过程时指定n of 3中的n，n范围是[1, 3]，若n=1，则仅需一个私钥签名即可花费该地址的币，若n=3，则需要三把私钥依次签名才可以。 Pubkey Hash TX 该类是最常见的交易类型，由N个输入、M个输出构成。 数据结构 交易中存放的是货币所有权的流转信息，所有权登记在数字货币地址上(Public Key)。这些信息是全网公开的，以明文形式存储（数字货币系统里的所有数据都是明文的），只有当需要转移货币所有权时，才需要用私钥签名来验证。 字段大小 描述 数据类型 解释 4 version, 版本 uint32_t 交易数据结构的版本号 1+ tx_in count, 输入数量 var_int 输入交易的数量 41+ tx_in tx_in[] 输入交易的数组，每个输入&gt;=41字节 1+ tx_out count, 输出数量 var_int 输出地址的数量 9+ tx_out tx_out[] 输入地址的数组，每个输入&gt;=9字节 4 lock_time, 锁定时间 uint32_t 见下方解释 lock_time是一个多意字段，表示在某个高度的Block之前或某个时间点之前该交易处于锁定态，无法收录进Block。 值 含义 0 立即生效 &lt; 500000000 含义为Block高度，处于该Block之前为锁定（不生效） &gt;= 500000000 含义为Unix时间戳，处于该时刻之前为锁定（不生效） 若该笔交易的所有输入交易的sequence字段，均为INT32最大值(0xffffffff)，则忽略lock_time字段。否则，该交易在未达到Block高度或达到某个时刻之前，是不会被收录进Block中的。 示例 为了演示方便，我们读取稍早期的块数据，以高度116219 Block为例。 # ~ bitcoind getblock 0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611&nbsp; { “hash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 144667, “size” : 1536, “height” : 116219, “version” : 1, “merkleroot” : “587fefd748f899f84d0fa1d8a3876fdb406a4bb8f54a31445cb72564701daea6″, “tx” : [ &quot;be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e&quot;, &quot;a387039eca66297ba51ef2da3dcc8a0fc745bcb511e20ed9505cc6762be037bb&quot;, &quot;2bd83162e264abf59f9124ca517050065f8c8eed2a21fbf85d454ee4e0e4c267&quot;, &quot;028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743&quot;, &quot;3a06b6615756dc3363a8567fbfa8fe978ee0ba06eb33fd844886a0f01149ad62&quot; ], “time” : 1301705313, “nonce” : 1826107553, “bits” : “1b00f339″, “difficulty” : 68977.78463021, “previousblockhash” : “00000000000010d549135eb39bd3bbb1047df8e1512357216e8a85c57a1efbfb”, “nextblockhash” : “000000000000e9fcc59a6850f64a94476a30f5fe35d6d8c4b4ce0b1b04103a77″ } 该Block里面有5笔交易，第一笔为Generation TX，解析出来看一下具体内容： # ~ bitcoind getrawtransaction be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e 1 { “hex” : “01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff070439f3001b0134ffffffff014034152a010000004341045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac00000000″, “txid” : “be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e”, “version” : 1, “locktime” : 0, “vin” : [ { &quot;coinbase&quot; : &quot;0439f3001b0134&quot;, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 50.01000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dce OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;41045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkey&quot;, &quot;addresses&quot; : [ &quot;1LgZTvoTJ6quJNCURmBUaJJkWWQZXkQnDn&quot; ] } } ], “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 145029, “time” : 1301705313, “blocktime” : 1301705313 } Generation TX的输入不是一个交易，而带有coinbase字段的结构。该字段的值由挖出此Block的人填写，这是一种“特权”：可以把信息写入货币系统（大家很喜欢用系统中的数据结构字段名来命名站点，例如blockchain、coinbase等，这些词的各种后缀域名都被抢注一空）。中本聪在数字货币的第一个交易中的写入的coinbase值是： “coinbase”:”04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73″ 将该段16进制转换为ASCII字符，就是那段著名的创世块留言： The Times 03/Jan/2009 Chancellor on brink of second bailout for banks 接下来展示的是一个三个输入、两个输出的普通交易： # ~ bitcoind getrawtransaction 028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743 1 { “hex” : “0100000003c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7000000008a473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbeffffffffc9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffffc98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff0200bd0105000000001976a914634228c26cf40a02a05db93f2f98b768a8e0e61b88acc096c7a6030000001976a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac00000000″, “txid” : “028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe&quot;, &quot;hex&quot; : &quot;473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe&quot; }, &quot;sequence&quot; : 4294967295 }, { &quot;txid&quot; : &quot;b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9&quot;, &quot;vout&quot; : 1, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d01 042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a&quot;, &quot;hex&quot; : &quot;47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a&quot; }, &quot;sequence&quot; : 4294967295 }, { &quot;txid&quot; : &quot;da30b272fb73d78108ff80ddd1ac2f76419533af79ad06a5b3c70fc4a62086c9&quot;, &quot;vout&quot; : 1, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d01 04a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f&quot;, &quot;hex&quot; : &quot;483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.84000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 634228c26cf40a02a05db93f2f98b768a8e0e61b OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914634228c26cf40a02a05db93f2f98b768a8e0e61b88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1A3q9pDtR4h8wpvyb8SVpiNPpT8ZNbHY8h&quot; ] } }, { “value” : 156.83000000, “n” : 1, “scriptPubKey” : { “asm” : “OP_DUP OP_HASH160 7514080ab2fcac0764de3a77d10cb790c71c74c2 OP_EQUALVERIFY OP_CHECKSIG”, “hex” : “76a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac”, “reqSigs” : 1, “type” : “pubkeyhash”, “addresses” : [ &quot;1Bg44FZsoTeYteRykC1XHz8facWYKhGvQ8&quot; ] } } ], “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 147751, “time” : 1301705313, “blocktime” : 1301705313 } 字段hex记录了所有相关信息，后面显示的是hex解析出来的各类字段信息。下面把逐个分解hex内容（hex可以从上面的直接看到）： 01000000 // 版本号，UINT32 03 // Tx输入数量，变长INT。3个输入。 /*** 第一组Input Tx ***/ // Tx Hash，固定32字节 c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7 00000000 // 消费的Tx位于前向交易输出的第0个，UINT32，固定4字节 8a // 签名的长度, 0x8A = 138字节 // 138字节长度的签名，含有两个部分：公钥+签名 47 // 公钥长度，0×47 = 71字节 3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 41 // 签名长度，0×41 = 65字节 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe ffffffff // sequence，0xffffffff = 4294967295， UINT32, 固定4字节 /*** 第二组Input Tx。与上同理，省略分解 ***/ c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffff /*** 第三组Input Tx ***/ c98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff 02 // Tx输出数量，变长INT。两个输出。 /*** 第一组输出 ***/ 00bd010500000000 // 输出的币值，UINT64，8个字节。字节序需翻转，~= 0x000000000501bd00 = 84000000 satoshi 19 // 输出目的地址字节数, 0×19 = 25字节，由一些操作码与数值构成 // 目标地址 // 0×76 -&gt; OP_DUP(stack ops) // 0xa9 -&gt; OP_HASH160(crypto) // 0×14 -&gt; 长度，0×14 = 20字节 76 a9 14 // 地址的HASH160值，20字节 634228c26cf40a02a05db93f2f98b768a8e0e61b // 0×88 -&gt; OP_EQUALVERIFY(bit logic) // 0xac -&gt; OP_CHECKSIG(crypto) 88 ac /*** 第二组输出 ***/ c096c7a603000000 19 76 a9 14 7514080ab2fcac0764de3a77d10cb790c71c74c2 88 ac 00000000 // lock_time，UINT32，固定4字节 Tx Hash，俗称交易ID，由hex得出：Tx Hash = SHA256(SHA256(hex))。由于每个交易只能成为下一个的输入，有且仅有一次，那么不存在输入完全相同的交易，那么就不存在相同的Tx Hash（SHA256碰撞概率极小，所以无需考虑Hash碰撞的问题，就像无需考虑地址私钥被别人撞到一样）。 即便如此，在系统里依然产生了相同的Tx Hash，是某位矿工兄弟挖出Block后，打包Block时忘记修改Generation Tx coinbase字段的值，币量相同且输出至相同的地址，那么就构造了两个完全一模一样的交易，分别位于两个Block的第一个位置。这个对系统不会产生什么问题，但只要花费其中一笔，另一个也被花费了。相同的Generation Tx相当于覆盖了另一个，白白损失了挖出的币。该交易ID为e3bf3d07d4b0375638d5f1db5255fe07ba2c4cb067cd81b84ee974b6585fb468，第一次出现在#91722，第二次出现在#91880。 b01dc7da-3edf-11e3-86eb-d015037e9440 交易签名 签名是对所有权的验证，节点收到交易广播后，会对交易进行验证，通过后则收录进内存、打包进Block，否则，丢弃之。签名就类似传统纸质合同盖章、签字过程，合法转移所有权的保证手段。 签名类型 由于一个交易的输入、输出都可能具有多个，那么签名也具有多种类型，目前共三类：SIGHASH_ALL, SIGHASH_NONE, SIGHASH_SINGLE。 SIGHASH_ALL 该签名类型为默认类型，也是目前绝大部分交易采用的，顾名思义即签名整单交易。首先，组织所有输出、输入，就像上文分解Hex过程一样，每个输入都对应一个签名，暂时留空，其他包括sequence等字段均须填写，这样就形成了一个完整的交易Hex（只缺签名字段）。然后，每一个输入均需使用私钥对该段数据进行签名，签名完成后各自填入相应的位置，N个输入N个签名。简单理解就是：对于该笔单子，认可且只认可的这些输入、输出，并同意花费我的那笔输入。 SIGHASH_NONE 该签名类型是最自由松散的，仅对输入签名，不对输出签名，输出可以任意指定。某人对某笔币签名后交给你，你可以在任意时刻填入任意接受地址，广播出去令其生效。简单理解就是：我同意花费我的那笔钱，至于给谁，我不关心。 SIGHASH_SINGLE 该签名类型其次自由松散，仅对自己的输入、输出签名，并留空sequence字段。其输入的次序对应其输出的次序，比如输入是第3个，那么签名的输出也是第三个。简单理解就是：我同意花费我的那笔钱，且只能花费到我认可的输出，至于单子里的其他输入、输出，我不关心。 交易的构造、签名与广播 上篇介绍了交易结构、签名等，为了更直观的认识数字货币，借助bitcoind演示手动构造并广播交易的完整过程。 普通交易 1. 找出未花费的币（unspent output） 通过命令：listunspent [minconf=1] [maxconf=9999999] [&quot;address&quot;,...]列出某个地址未花费的币(交易)，minconf/maxconf表示该笔收入交易的确认数范围，如果需要列出还未确认的交易，需将minconf设置为0。 执行： bitcoind listunspent 0 100 ‘[&quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot;]‘ 输出： [ { &quot;txid&quot; : &quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;, &quot;vout&quot; : 0, &quot;address&quot; : &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot;, &quot;account&quot; : &quot;&quot;, &quot;scriptPubKey&quot; : &quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;, &quot;amount&quot; : 0.19900000, &quot;confirmations&quot; : 1 } ] 我们找到该地址的一个未花费交易，位于交易296ea7bf981b4499…9f0a41e589132156的第0个位置。 2. 创建待发送交易 创建待发送交易，由命令：createrawtransaction [{&quot;txid&quot;:txid,&quot;vout&quot;:n},...] {address:amount,…}来完成。我们将 0.1 BTC发送至 1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x ，并支付 0.0001 BTC做为矿工费。输入交易的额度为 0.199 ，输出为 0.1 + 0.0001 = 0.1001 ，那么还剩余： 0.199 – 0.1001 = 0.0989 ，将此作为找零发回给自己。 执行： bitcoind createrawtransaction \ ‘[{&quot;txid&quot;:&quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;,&quot;vout&quot;:0}]‘ \ ‘{“1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x”:0.1, “1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3″:0.0989}’ 输出： 010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000 通过命令：decoderawtransaction ，可以将此段十六进制字符串解码。 执行： bitcoind decoderawtransaction ’010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000′ 输出： { “txid” : “54f773a3fdf7cb3292fc76b46c97e536348b3a0715886dbfd2f60e115fb3a8f0″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;&quot;, &quot;hex&quot; : &quot;&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.10000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 fdc7990956642433ea75cabdcc0a9447c5d2b4ee OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x&quot; ] } }, { “value” : 0.09890000, “n” : 1, “scriptPubKey” : { “asm” : “OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG”, “hex” : “76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac”, “reqSigs” : 1, “type” : “pubkeyhash”, “addresses” : [ &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot; ] } } ] } 至此，一个“空白交易”就构造好了，尚未使用私钥对交易进行签名，字段scriptSig是留空的，无签名的交易是无效的。此时的Tx ID并不是最终的Tx ID，填入签名后Tx ID会发生变化。 在手动创建交易时，务必注意输入、输出的值，非常容易犯错的是忘记构造找零输出（如非必要勿手动构造交易）。曾经有人构造交易时忘记找零，发生了支付 200 BTC 的矿工费的人间惨剧，所幸的是收录该笔交易的Block由著名挖矿团队“烤猫（Friedcat）”挖得，该团队非常厚道的退回了多余费用。 3. 签名 交易签名使用命令： signrawtransaction \ [{&quot;txid&quot;:txid,&quot;vout&quot;:n,&quot;scriptPubKey&quot;:hex,&quot;redeemScript&quot;:hex},...] [,...] \ [sighashtype=&quot;ALL&quot;] 第一个参数是创建的待签名交易的十六进制字符串； 第二个参数有点类似创建交易时的参数，不过需要多出一个公钥字段scriptPubKey，其他节点验证交易时是通过公钥和签名来完成的，所以要提供公钥；如果是合成地址，则需要提供redeemScript； 第三个参数是即将花费的币所在地址的私钥，用来对交易进行签名，如果该地址私钥已经导入至bitcoind中，则无需显式提供； 最后一个参数表示签名类型，在上一篇里，介绍了三种交易签名类型； 签名之前需要找到scriptPubKey，提取输入交易信息即可获取(也可以根据其公钥自行计算)，由命令：getrawtransaction [verbose=0]完成。 执行： bitcoind getrawtransaction 296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156 1 输出： { “hex” : “01000000010511331f639e974283d3909496787a660583dc88f41598d177e225b5f352314a000000006c493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4ffffffff0160a62f01000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″, “txid” : “296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;4a3152f3b525e277d19815f488dc8305667a78969490d38342979e631f331105&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d401 03cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4&quot;, &quot;hex&quot; : &quot;493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.19900000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot; ] } } ], “blockhash” : “000000000000000488f18f7659acd85b2bd06a5ed2c4439eea74a8b968d16656″, “confirmations” : 19, “time” : 1383235737, “blocktime” : 1383235737 } scriptPubKey位于”vout”[0]–&gt;“scriptPubKey”–&gt;“hex”，即： 76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac 。 签名使用ECDSA算法，对其，“空白交易”签名之，执行： bitcoind signrawtransaction \ “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ \ ‘[{&quot;txid&quot;:&quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;,&quot;vout&quot;:0,&quot;scriptPubKey&quot;:&quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;}]‘ 输出： { “hex” : “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″, “complete” : true } 签名后，签名值会填入上文所述的空字段中，从而得到一个完整的交易。可通过上文介绍的命令decoderawtransaction 解码查看之。 最后一步，就是将其广播出去，等待网络传播至所有节点，约10~60秒广播至全球节点，取决与你的节点的网络连接状况。稍后一些时刻，就会进入Block中。广播由命令sendrawtransaction 来完成。如果没有运行节点，可以通过公共节点的API进行广播，例如：blockchain.info/pushtx。 执行： bitcoind sendrawtransaction \ “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ 输出： b5f8da1ea9e02ec3cc0765f9600f49945e94ed4b0c88ed0648896bf3e213205d 返回的是Transaction Hash值，即该交易的ID。至此，交易构造、签名、发送的完整过程完成了。 合成地址交易 合成地址以3开头，可以实现多方管理资产，极大提高安全性，也可以轻松实现基于数字货币原生的三方交易担保支付。一个M-of-N的模式： m {pubkey}…{pubkey} n OP_CHECKMULTISIG M和N需满足： 1&lt;=N&lt;=3 1&lt;=M&lt;=N 可以是1 of 1，1 of 2，2 of 3等组合，通常选择N=3： 1 of 3，最大程度私钥冗余。防丢私钥损失，3把私钥中任意一把即可签名发币，即使丢失2把都可以保障不受损失； 2 of 3，提高私钥冗余度的同时解决单点信任问题。3把私钥任意2把私钥可签名发币，三方不完全信任的情形，即中介交易中，非常适用； 3 of 3，最大程度解决资金信任问题，无私钥冗余。必须3把私钥全部签名才能发币，适用多方共同管理重要资产，但任何一方遗失私钥均造成严重损失； 合成地址的交易构造、签名、发送过程与普通交易类似，这里只介绍如何创建一个合成地址。大神Gavin Andresen已经演示过，下面内容摘自其gist. 首先，需要三对公钥、私钥。公钥创建地址、私钥用于签名。 # No.1 0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86 / 5JaTXbAUmfPYZFRwrYaALK48fN6sFJp4rHqq2QSXs8ucfpE4yQU # No.2 04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874 / 5Jb7fCeh1Wtm4yBBg3q3XbT6B525i17kVhy3vMC9AqfR6FH2qGk # No.3 048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213 / 5JFjmGo5Fww9p8gvx48qBYDJNAzR9pmH5S389axMtDyPT8ddqmw 使用命令：createmultisig &lt;’[&quot;key&quot;,&quot;key&quot;]‘&gt;来合成，其中key为公钥，创建地址时仅需公钥。创建类型是2 of 3. 输入： bitcoind createmultisig 2 \ ‘[&quot;0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86&quot;,&quot;04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874&quot;,&quot;048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213&quot;]‘ 输出： { “address” : “3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC”, “redeemScript” : “52410491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f864104865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec687441048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d4621353ae” } 得到的合成地址是：3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC，该地址没有公钥，仅有redeemScript，作用与公钥相同。后续的构造、签名、发送过程与上文普通地址交易类似，略去。 阅读更多" />
<meta property="og:description" content="区块链爱好者（QQ：53016353） 交易(Transaction)是数字货币系统的信息载体，最小单元。而块(Block)就是将这些基础单元打包装箱，贴上封条，并串联起来。巨大算力保障了块的安全，也就保障了单个交易的安全。 类型 交易有三种常见类型：产量交易(Generation)，合成地址交易(Script Hash)，通用地址交易(Pubkey Hash)。该分类并非严格意义的，只是根据交易的输入输出做的简单区分。 Generation TX 每个Block都对应一个产量交易(Generation TX)，该类交易是没有输入交易的，挖出的新币是所有币的源头。 Script Hash TX 该类交易目前不是很常见，大部分人可能没有听说过，但是非常有意义。未来应该会在某些场合频繁使用。该类交易的接受地址不是通常意义的地址，而是一个合成地址，以3开头（对，以3开头的也是数字货币地址！）。三对公私钥，可以生成一个合成地址。在生成过程时指定n of 3中的n，n范围是[1, 3]，若n=1，则仅需一个私钥签名即可花费该地址的币，若n=3，则需要三把私钥依次签名才可以。 Pubkey Hash TX 该类是最常见的交易类型，由N个输入、M个输出构成。 数据结构 交易中存放的是货币所有权的流转信息，所有权登记在数字货币地址上(Public Key)。这些信息是全网公开的，以明文形式存储（数字货币系统里的所有数据都是明文的），只有当需要转移货币所有权时，才需要用私钥签名来验证。 字段大小 描述 数据类型 解释 4 version, 版本 uint32_t 交易数据结构的版本号 1+ tx_in count, 输入数量 var_int 输入交易的数量 41+ tx_in tx_in[] 输入交易的数组，每个输入&gt;=41字节 1+ tx_out count, 输出数量 var_int 输出地址的数量 9+ tx_out tx_out[] 输入地址的数组，每个输入&gt;=9字节 4 lock_time, 锁定时间 uint32_t 见下方解释 lock_time是一个多意字段，表示在某个高度的Block之前或某个时间点之前该交易处于锁定态，无法收录进Block。 值 含义 0 立即生效 &lt; 500000000 含义为Block高度，处于该Block之前为锁定（不生效） &gt;= 500000000 含义为Unix时间戳，处于该时刻之前为锁定（不生效） 若该笔交易的所有输入交易的sequence字段，均为INT32最大值(0xffffffff)，则忽略lock_time字段。否则，该交易在未达到Block高度或达到某个时刻之前，是不会被收录进Block中的。 示例 为了演示方便，我们读取稍早期的块数据，以高度116219 Block为例。 # ~ bitcoind getblock 0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611&nbsp; { “hash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 144667, “size” : 1536, “height” : 116219, “version” : 1, “merkleroot” : “587fefd748f899f84d0fa1d8a3876fdb406a4bb8f54a31445cb72564701daea6″, “tx” : [ &quot;be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e&quot;, &quot;a387039eca66297ba51ef2da3dcc8a0fc745bcb511e20ed9505cc6762be037bb&quot;, &quot;2bd83162e264abf59f9124ca517050065f8c8eed2a21fbf85d454ee4e0e4c267&quot;, &quot;028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743&quot;, &quot;3a06b6615756dc3363a8567fbfa8fe978ee0ba06eb33fd844886a0f01149ad62&quot; ], “time” : 1301705313, “nonce” : 1826107553, “bits” : “1b00f339″, “difficulty” : 68977.78463021, “previousblockhash” : “00000000000010d549135eb39bd3bbb1047df8e1512357216e8a85c57a1efbfb”, “nextblockhash” : “000000000000e9fcc59a6850f64a94476a30f5fe35d6d8c4b4ce0b1b04103a77″ } 该Block里面有5笔交易，第一笔为Generation TX，解析出来看一下具体内容： # ~ bitcoind getrawtransaction be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e 1 { “hex” : “01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff070439f3001b0134ffffffff014034152a010000004341045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac00000000″, “txid” : “be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e”, “version” : 1, “locktime” : 0, “vin” : [ { &quot;coinbase&quot; : &quot;0439f3001b0134&quot;, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 50.01000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dce OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;41045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkey&quot;, &quot;addresses&quot; : [ &quot;1LgZTvoTJ6quJNCURmBUaJJkWWQZXkQnDn&quot; ] } } ], “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 145029, “time” : 1301705313, “blocktime” : 1301705313 } Generation TX的输入不是一个交易，而带有coinbase字段的结构。该字段的值由挖出此Block的人填写，这是一种“特权”：可以把信息写入货币系统（大家很喜欢用系统中的数据结构字段名来命名站点，例如blockchain、coinbase等，这些词的各种后缀域名都被抢注一空）。中本聪在数字货币的第一个交易中的写入的coinbase值是： “coinbase”:”04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73″ 将该段16进制转换为ASCII字符，就是那段著名的创世块留言： The Times 03/Jan/2009 Chancellor on brink of second bailout for banks 接下来展示的是一个三个输入、两个输出的普通交易： # ~ bitcoind getrawtransaction 028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743 1 { “hex” : “0100000003c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7000000008a473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbeffffffffc9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffffc98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff0200bd0105000000001976a914634228c26cf40a02a05db93f2f98b768a8e0e61b88acc096c7a6030000001976a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac00000000″, “txid” : “028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe&quot;, &quot;hex&quot; : &quot;473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe&quot; }, &quot;sequence&quot; : 4294967295 }, { &quot;txid&quot; : &quot;b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9&quot;, &quot;vout&quot; : 1, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d01 042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a&quot;, &quot;hex&quot; : &quot;47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a&quot; }, &quot;sequence&quot; : 4294967295 }, { &quot;txid&quot; : &quot;da30b272fb73d78108ff80ddd1ac2f76419533af79ad06a5b3c70fc4a62086c9&quot;, &quot;vout&quot; : 1, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d01 04a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f&quot;, &quot;hex&quot; : &quot;483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.84000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 634228c26cf40a02a05db93f2f98b768a8e0e61b OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914634228c26cf40a02a05db93f2f98b768a8e0e61b88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1A3q9pDtR4h8wpvyb8SVpiNPpT8ZNbHY8h&quot; ] } }, { “value” : 156.83000000, “n” : 1, “scriptPubKey” : { “asm” : “OP_DUP OP_HASH160 7514080ab2fcac0764de3a77d10cb790c71c74c2 OP_EQUALVERIFY OP_CHECKSIG”, “hex” : “76a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac”, “reqSigs” : 1, “type” : “pubkeyhash”, “addresses” : [ &quot;1Bg44FZsoTeYteRykC1XHz8facWYKhGvQ8&quot; ] } } ], “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 147751, “time” : 1301705313, “blocktime” : 1301705313 } 字段hex记录了所有相关信息，后面显示的是hex解析出来的各类字段信息。下面把逐个分解hex内容（hex可以从上面的直接看到）： 01000000 // 版本号，UINT32 03 // Tx输入数量，变长INT。3个输入。 /*** 第一组Input Tx ***/ // Tx Hash，固定32字节 c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7 00000000 // 消费的Tx位于前向交易输出的第0个，UINT32，固定4字节 8a // 签名的长度, 0x8A = 138字节 // 138字节长度的签名，含有两个部分：公钥+签名 47 // 公钥长度，0×47 = 71字节 3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 41 // 签名长度，0×41 = 65字节 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe ffffffff // sequence，0xffffffff = 4294967295， UINT32, 固定4字节 /*** 第二组Input Tx。与上同理，省略分解 ***/ c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffff /*** 第三组Input Tx ***/ c98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff 02 // Tx输出数量，变长INT。两个输出。 /*** 第一组输出 ***/ 00bd010500000000 // 输出的币值，UINT64，8个字节。字节序需翻转，~= 0x000000000501bd00 = 84000000 satoshi 19 // 输出目的地址字节数, 0×19 = 25字节，由一些操作码与数值构成 // 目标地址 // 0×76 -&gt; OP_DUP(stack ops) // 0xa9 -&gt; OP_HASH160(crypto) // 0×14 -&gt; 长度，0×14 = 20字节 76 a9 14 // 地址的HASH160值，20字节 634228c26cf40a02a05db93f2f98b768a8e0e61b // 0×88 -&gt; OP_EQUALVERIFY(bit logic) // 0xac -&gt; OP_CHECKSIG(crypto) 88 ac /*** 第二组输出 ***/ c096c7a603000000 19 76 a9 14 7514080ab2fcac0764de3a77d10cb790c71c74c2 88 ac 00000000 // lock_time，UINT32，固定4字节 Tx Hash，俗称交易ID，由hex得出：Tx Hash = SHA256(SHA256(hex))。由于每个交易只能成为下一个的输入，有且仅有一次，那么不存在输入完全相同的交易，那么就不存在相同的Tx Hash（SHA256碰撞概率极小，所以无需考虑Hash碰撞的问题，就像无需考虑地址私钥被别人撞到一样）。 即便如此，在系统里依然产生了相同的Tx Hash，是某位矿工兄弟挖出Block后，打包Block时忘记修改Generation Tx coinbase字段的值，币量相同且输出至相同的地址，那么就构造了两个完全一模一样的交易，分别位于两个Block的第一个位置。这个对系统不会产生什么问题，但只要花费其中一笔，另一个也被花费了。相同的Generation Tx相当于覆盖了另一个，白白损失了挖出的币。该交易ID为e3bf3d07d4b0375638d5f1db5255fe07ba2c4cb067cd81b84ee974b6585fb468，第一次出现在#91722，第二次出现在#91880。 b01dc7da-3edf-11e3-86eb-d015037e9440 交易签名 签名是对所有权的验证，节点收到交易广播后，会对交易进行验证，通过后则收录进内存、打包进Block，否则，丢弃之。签名就类似传统纸质合同盖章、签字过程，合法转移所有权的保证手段。 签名类型 由于一个交易的输入、输出都可能具有多个，那么签名也具有多种类型，目前共三类：SIGHASH_ALL, SIGHASH_NONE, SIGHASH_SINGLE。 SIGHASH_ALL 该签名类型为默认类型，也是目前绝大部分交易采用的，顾名思义即签名整单交易。首先，组织所有输出、输入，就像上文分解Hex过程一样，每个输入都对应一个签名，暂时留空，其他包括sequence等字段均须填写，这样就形成了一个完整的交易Hex（只缺签名字段）。然后，每一个输入均需使用私钥对该段数据进行签名，签名完成后各自填入相应的位置，N个输入N个签名。简单理解就是：对于该笔单子，认可且只认可的这些输入、输出，并同意花费我的那笔输入。 SIGHASH_NONE 该签名类型是最自由松散的，仅对输入签名，不对输出签名，输出可以任意指定。某人对某笔币签名后交给你，你可以在任意时刻填入任意接受地址，广播出去令其生效。简单理解就是：我同意花费我的那笔钱，至于给谁，我不关心。 SIGHASH_SINGLE 该签名类型其次自由松散，仅对自己的输入、输出签名，并留空sequence字段。其输入的次序对应其输出的次序，比如输入是第3个，那么签名的输出也是第三个。简单理解就是：我同意花费我的那笔钱，且只能花费到我认可的输出，至于单子里的其他输入、输出，我不关心。 交易的构造、签名与广播 上篇介绍了交易结构、签名等，为了更直观的认识数字货币，借助bitcoind演示手动构造并广播交易的完整过程。 普通交易 1. 找出未花费的币（unspent output） 通过命令：listunspent [minconf=1] [maxconf=9999999] [&quot;address&quot;,...]列出某个地址未花费的币(交易)，minconf/maxconf表示该笔收入交易的确认数范围，如果需要列出还未确认的交易，需将minconf设置为0。 执行： bitcoind listunspent 0 100 ‘[&quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot;]‘ 输出： [ { &quot;txid&quot; : &quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;, &quot;vout&quot; : 0, &quot;address&quot; : &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot;, &quot;account&quot; : &quot;&quot;, &quot;scriptPubKey&quot; : &quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;, &quot;amount&quot; : 0.19900000, &quot;confirmations&quot; : 1 } ] 我们找到该地址的一个未花费交易，位于交易296ea7bf981b4499…9f0a41e589132156的第0个位置。 2. 创建待发送交易 创建待发送交易，由命令：createrawtransaction [{&quot;txid&quot;:txid,&quot;vout&quot;:n},...] {address:amount,…}来完成。我们将 0.1 BTC发送至 1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x ，并支付 0.0001 BTC做为矿工费。输入交易的额度为 0.199 ，输出为 0.1 + 0.0001 = 0.1001 ，那么还剩余： 0.199 – 0.1001 = 0.0989 ，将此作为找零发回给自己。 执行： bitcoind createrawtransaction \ ‘[{&quot;txid&quot;:&quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;,&quot;vout&quot;:0}]‘ \ ‘{“1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x”:0.1, “1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3″:0.0989}’ 输出： 010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000 通过命令：decoderawtransaction ，可以将此段十六进制字符串解码。 执行： bitcoind decoderawtransaction ’010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000′ 输出： { “txid” : “54f773a3fdf7cb3292fc76b46c97e536348b3a0715886dbfd2f60e115fb3a8f0″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;&quot;, &quot;hex&quot; : &quot;&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.10000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 fdc7990956642433ea75cabdcc0a9447c5d2b4ee OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x&quot; ] } }, { “value” : 0.09890000, “n” : 1, “scriptPubKey” : { “asm” : “OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG”, “hex” : “76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac”, “reqSigs” : 1, “type” : “pubkeyhash”, “addresses” : [ &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot; ] } } ] } 至此，一个“空白交易”就构造好了，尚未使用私钥对交易进行签名，字段scriptSig是留空的，无签名的交易是无效的。此时的Tx ID并不是最终的Tx ID，填入签名后Tx ID会发生变化。 在手动创建交易时，务必注意输入、输出的值，非常容易犯错的是忘记构造找零输出（如非必要勿手动构造交易）。曾经有人构造交易时忘记找零，发生了支付 200 BTC 的矿工费的人间惨剧，所幸的是收录该笔交易的Block由著名挖矿团队“烤猫（Friedcat）”挖得，该团队非常厚道的退回了多余费用。 3. 签名 交易签名使用命令： signrawtransaction \ [{&quot;txid&quot;:txid,&quot;vout&quot;:n,&quot;scriptPubKey&quot;:hex,&quot;redeemScript&quot;:hex},...] [,...] \ [sighashtype=&quot;ALL&quot;] 第一个参数是创建的待签名交易的十六进制字符串； 第二个参数有点类似创建交易时的参数，不过需要多出一个公钥字段scriptPubKey，其他节点验证交易时是通过公钥和签名来完成的，所以要提供公钥；如果是合成地址，则需要提供redeemScript； 第三个参数是即将花费的币所在地址的私钥，用来对交易进行签名，如果该地址私钥已经导入至bitcoind中，则无需显式提供； 最后一个参数表示签名类型，在上一篇里，介绍了三种交易签名类型； 签名之前需要找到scriptPubKey，提取输入交易信息即可获取(也可以根据其公钥自行计算)，由命令：getrawtransaction [verbose=0]完成。 执行： bitcoind getrawtransaction 296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156 1 输出： { “hex” : “01000000010511331f639e974283d3909496787a660583dc88f41598d177e225b5f352314a000000006c493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4ffffffff0160a62f01000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″, “txid” : “296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;4a3152f3b525e277d19815f488dc8305667a78969490d38342979e631f331105&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d401 03cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4&quot;, &quot;hex&quot; : &quot;493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.19900000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot; ] } } ], “blockhash” : “000000000000000488f18f7659acd85b2bd06a5ed2c4439eea74a8b968d16656″, “confirmations” : 19, “time” : 1383235737, “blocktime” : 1383235737 } scriptPubKey位于”vout”[0]–&gt;“scriptPubKey”–&gt;“hex”，即： 76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac 。 签名使用ECDSA算法，对其，“空白交易”签名之，执行： bitcoind signrawtransaction \ “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ \ ‘[{&quot;txid&quot;:&quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;,&quot;vout&quot;:0,&quot;scriptPubKey&quot;:&quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;}]‘ 输出： { “hex” : “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″, “complete” : true } 签名后，签名值会填入上文所述的空字段中，从而得到一个完整的交易。可通过上文介绍的命令decoderawtransaction 解码查看之。 最后一步，就是将其广播出去，等待网络传播至所有节点，约10~60秒广播至全球节点，取决与你的节点的网络连接状况。稍后一些时刻，就会进入Block中。广播由命令sendrawtransaction 来完成。如果没有运行节点，可以通过公共节点的API进行广播，例如：blockchain.info/pushtx。 执行： bitcoind sendrawtransaction \ “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ 输出： b5f8da1ea9e02ec3cc0765f9600f49945e94ed4b0c88ed0648896bf3e213205d 返回的是Transaction Hash值，即该交易的ID。至此，交易构造、签名、发送的完整过程完成了。 合成地址交易 合成地址以3开头，可以实现多方管理资产，极大提高安全性，也可以轻松实现基于数字货币原生的三方交易担保支付。一个M-of-N的模式： m {pubkey}…{pubkey} n OP_CHECKMULTISIG M和N需满足： 1&lt;=N&lt;=3 1&lt;=M&lt;=N 可以是1 of 1，1 of 2，2 of 3等组合，通常选择N=3： 1 of 3，最大程度私钥冗余。防丢私钥损失，3把私钥中任意一把即可签名发币，即使丢失2把都可以保障不受损失； 2 of 3，提高私钥冗余度的同时解决单点信任问题。3把私钥任意2把私钥可签名发币，三方不完全信任的情形，即中介交易中，非常适用； 3 of 3，最大程度解决资金信任问题，无私钥冗余。必须3把私钥全部签名才能发币，适用多方共同管理重要资产，但任何一方遗失私钥均造成严重损失； 合成地址的交易构造、签名、发送过程与普通交易类似，这里只介绍如何创建一个合成地址。大神Gavin Andresen已经演示过，下面内容摘自其gist. 首先，需要三对公钥、私钥。公钥创建地址、私钥用于签名。 # No.1 0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86 / 5JaTXbAUmfPYZFRwrYaALK48fN6sFJp4rHqq2QSXs8ucfpE4yQU # No.2 04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874 / 5Jb7fCeh1Wtm4yBBg3q3XbT6B525i17kVhy3vMC9AqfR6FH2qGk # No.3 048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213 / 5JFjmGo5Fww9p8gvx48qBYDJNAzR9pmH5S389axMtDyPT8ddqmw 使用命令：createmultisig &lt;’[&quot;key&quot;,&quot;key&quot;]‘&gt;来合成，其中key为公钥，创建地址时仅需公钥。创建类型是2 of 3. 输入： bitcoind createmultisig 2 \ ‘[&quot;0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86&quot;,&quot;04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874&quot;,&quot;048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213&quot;]‘ 输出： { “address” : “3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC”, “redeemScript” : “52410491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f864104865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec687441048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d4621353ae” } 得到的合成地址是：3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC，该地址没有公钥，仅有redeemScript，作用与公钥相同。后续的构造、签名、发送过程与上文普通地址交易类似，略去。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2017/07/07/d7af7e4ba6bc9682979acfb91d5d2f49.html" />
<meta property="og:url" content="https://mlh.app/2017/07/07/d7af7e4ba6bc9682979acfb91d5d2f49.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-07T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"区块链爱好者（QQ：53016353） 交易(Transaction)是数字货币系统的信息载体，最小单元。而块(Block)就是将这些基础单元打包装箱，贴上封条，并串联起来。巨大算力保障了块的安全，也就保障了单个交易的安全。 类型 交易有三种常见类型：产量交易(Generation)，合成地址交易(Script Hash)，通用地址交易(Pubkey Hash)。该分类并非严格意义的，只是根据交易的输入输出做的简单区分。 Generation TX 每个Block都对应一个产量交易(Generation TX)，该类交易是没有输入交易的，挖出的新币是所有币的源头。 Script Hash TX 该类交易目前不是很常见，大部分人可能没有听说过，但是非常有意义。未来应该会在某些场合频繁使用。该类交易的接受地址不是通常意义的地址，而是一个合成地址，以3开头（对，以3开头的也是数字货币地址！）。三对公私钥，可以生成一个合成地址。在生成过程时指定n of 3中的n，n范围是[1, 3]，若n=1，则仅需一个私钥签名即可花费该地址的币，若n=3，则需要三把私钥依次签名才可以。 Pubkey Hash TX 该类是最常见的交易类型，由N个输入、M个输出构成。 数据结构 交易中存放的是货币所有权的流转信息，所有权登记在数字货币地址上(Public Key)。这些信息是全网公开的，以明文形式存储（数字货币系统里的所有数据都是明文的），只有当需要转移货币所有权时，才需要用私钥签名来验证。 字段大小 描述 数据类型 解释 4 version, 版本 uint32_t 交易数据结构的版本号 1+ tx_in count, 输入数量 var_int 输入交易的数量 41+ tx_in tx_in[] 输入交易的数组，每个输入&gt;=41字节 1+ tx_out count, 输出数量 var_int 输出地址的数量 9+ tx_out tx_out[] 输入地址的数组，每个输入&gt;=9字节 4 lock_time, 锁定时间 uint32_t 见下方解释 lock_time是一个多意字段，表示在某个高度的Block之前或某个时间点之前该交易处于锁定态，无法收录进Block。 值 含义 0 立即生效 &lt; 500000000 含义为Block高度，处于该Block之前为锁定（不生效） &gt;= 500000000 含义为Unix时间戳，处于该时刻之前为锁定（不生效） 若该笔交易的所有输入交易的sequence字段，均为INT32最大值(0xffffffff)，则忽略lock_time字段。否则，该交易在未达到Block高度或达到某个时刻之前，是不会被收录进Block中的。 示例 为了演示方便，我们读取稍早期的块数据，以高度116219 Block为例。 # ~ bitcoind getblock 0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611&nbsp; { “hash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 144667, “size” : 1536, “height” : 116219, “version” : 1, “merkleroot” : “587fefd748f899f84d0fa1d8a3876fdb406a4bb8f54a31445cb72564701daea6″, “tx” : [ &quot;be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e&quot;, &quot;a387039eca66297ba51ef2da3dcc8a0fc745bcb511e20ed9505cc6762be037bb&quot;, &quot;2bd83162e264abf59f9124ca517050065f8c8eed2a21fbf85d454ee4e0e4c267&quot;, &quot;028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743&quot;, &quot;3a06b6615756dc3363a8567fbfa8fe978ee0ba06eb33fd844886a0f01149ad62&quot; ], “time” : 1301705313, “nonce” : 1826107553, “bits” : “1b00f339″, “difficulty” : 68977.78463021, “previousblockhash” : “00000000000010d549135eb39bd3bbb1047df8e1512357216e8a85c57a1efbfb”, “nextblockhash” : “000000000000e9fcc59a6850f64a94476a30f5fe35d6d8c4b4ce0b1b04103a77″ } 该Block里面有5笔交易，第一笔为Generation TX，解析出来看一下具体内容： # ~ bitcoind getrawtransaction be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e 1 { “hex” : “01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff070439f3001b0134ffffffff014034152a010000004341045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac00000000″, “txid” : “be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e”, “version” : 1, “locktime” : 0, “vin” : [ { &quot;coinbase&quot; : &quot;0439f3001b0134&quot;, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 50.01000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dce OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;41045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkey&quot;, &quot;addresses&quot; : [ &quot;1LgZTvoTJ6quJNCURmBUaJJkWWQZXkQnDn&quot; ] } } ], “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 145029, “time” : 1301705313, “blocktime” : 1301705313 } Generation TX的输入不是一个交易，而带有coinbase字段的结构。该字段的值由挖出此Block的人填写，这是一种“特权”：可以把信息写入货币系统（大家很喜欢用系统中的数据结构字段名来命名站点，例如blockchain、coinbase等，这些词的各种后缀域名都被抢注一空）。中本聪在数字货币的第一个交易中的写入的coinbase值是： “coinbase”:”04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73″ 将该段16进制转换为ASCII字符，就是那段著名的创世块留言： The Times 03/Jan/2009 Chancellor on brink of second bailout for banks 接下来展示的是一个三个输入、两个输出的普通交易： # ~ bitcoind getrawtransaction 028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743 1 { “hex” : “0100000003c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7000000008a473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbeffffffffc9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffffc98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff0200bd0105000000001976a914634228c26cf40a02a05db93f2f98b768a8e0e61b88acc096c7a6030000001976a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac00000000″, “txid” : “028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe&quot;, &quot;hex&quot; : &quot;473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe&quot; }, &quot;sequence&quot; : 4294967295 }, { &quot;txid&quot; : &quot;b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9&quot;, &quot;vout&quot; : 1, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d01 042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a&quot;, &quot;hex&quot; : &quot;47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a&quot; }, &quot;sequence&quot; : 4294967295 }, { &quot;txid&quot; : &quot;da30b272fb73d78108ff80ddd1ac2f76419533af79ad06a5b3c70fc4a62086c9&quot;, &quot;vout&quot; : 1, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d01 04a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f&quot;, &quot;hex&quot; : &quot;483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.84000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 634228c26cf40a02a05db93f2f98b768a8e0e61b OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914634228c26cf40a02a05db93f2f98b768a8e0e61b88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1A3q9pDtR4h8wpvyb8SVpiNPpT8ZNbHY8h&quot; ] } }, { “value” : 156.83000000, “n” : 1, “scriptPubKey” : { “asm” : “OP_DUP OP_HASH160 7514080ab2fcac0764de3a77d10cb790c71c74c2 OP_EQUALVERIFY OP_CHECKSIG”, “hex” : “76a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac”, “reqSigs” : 1, “type” : “pubkeyhash”, “addresses” : [ &quot;1Bg44FZsoTeYteRykC1XHz8facWYKhGvQ8&quot; ] } } ], “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″, “confirmations” : 147751, “time” : 1301705313, “blocktime” : 1301705313 } 字段hex记录了所有相关信息，后面显示的是hex解析出来的各类字段信息。下面把逐个分解hex内容（hex可以从上面的直接看到）： 01000000 // 版本号，UINT32 03 // Tx输入数量，变长INT。3个输入。 /*** 第一组Input Tx ***/ // Tx Hash，固定32字节 c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7 00000000 // 消费的Tx位于前向交易输出的第0个，UINT32，固定4字节 8a // 签名的长度, 0x8A = 138字节 // 138字节长度的签名，含有两个部分：公钥+签名 47 // 公钥长度，0×47 = 71字节 3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 41 // 签名长度，0×41 = 65字节 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe ffffffff // sequence，0xffffffff = 4294967295， UINT32, 固定4字节 /*** 第二组Input Tx。与上同理，省略分解 ***/ c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffff /*** 第三组Input Tx ***/ c98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff 02 // Tx输出数量，变长INT。两个输出。 /*** 第一组输出 ***/ 00bd010500000000 // 输出的币值，UINT64，8个字节。字节序需翻转，~= 0x000000000501bd00 = 84000000 satoshi 19 // 输出目的地址字节数, 0×19 = 25字节，由一些操作码与数值构成 // 目标地址 // 0×76 -&gt; OP_DUP(stack ops) // 0xa9 -&gt; OP_HASH160(crypto) // 0×14 -&gt; 长度，0×14 = 20字节 76 a9 14 // 地址的HASH160值，20字节 634228c26cf40a02a05db93f2f98b768a8e0e61b // 0×88 -&gt; OP_EQUALVERIFY(bit logic) // 0xac -&gt; OP_CHECKSIG(crypto) 88 ac /*** 第二组输出 ***/ c096c7a603000000 19 76 a9 14 7514080ab2fcac0764de3a77d10cb790c71c74c2 88 ac 00000000 // lock_time，UINT32，固定4字节 Tx Hash，俗称交易ID，由hex得出：Tx Hash = SHA256(SHA256(hex))。由于每个交易只能成为下一个的输入，有且仅有一次，那么不存在输入完全相同的交易，那么就不存在相同的Tx Hash（SHA256碰撞概率极小，所以无需考虑Hash碰撞的问题，就像无需考虑地址私钥被别人撞到一样）。 即便如此，在系统里依然产生了相同的Tx Hash，是某位矿工兄弟挖出Block后，打包Block时忘记修改Generation Tx coinbase字段的值，币量相同且输出至相同的地址，那么就构造了两个完全一模一样的交易，分别位于两个Block的第一个位置。这个对系统不会产生什么问题，但只要花费其中一笔，另一个也被花费了。相同的Generation Tx相当于覆盖了另一个，白白损失了挖出的币。该交易ID为e3bf3d07d4b0375638d5f1db5255fe07ba2c4cb067cd81b84ee974b6585fb468，第一次出现在#91722，第二次出现在#91880。 b01dc7da-3edf-11e3-86eb-d015037e9440 交易签名 签名是对所有权的验证，节点收到交易广播后，会对交易进行验证，通过后则收录进内存、打包进Block，否则，丢弃之。签名就类似传统纸质合同盖章、签字过程，合法转移所有权的保证手段。 签名类型 由于一个交易的输入、输出都可能具有多个，那么签名也具有多种类型，目前共三类：SIGHASH_ALL, SIGHASH_NONE, SIGHASH_SINGLE。 SIGHASH_ALL 该签名类型为默认类型，也是目前绝大部分交易采用的，顾名思义即签名整单交易。首先，组织所有输出、输入，就像上文分解Hex过程一样，每个输入都对应一个签名，暂时留空，其他包括sequence等字段均须填写，这样就形成了一个完整的交易Hex（只缺签名字段）。然后，每一个输入均需使用私钥对该段数据进行签名，签名完成后各自填入相应的位置，N个输入N个签名。简单理解就是：对于该笔单子，认可且只认可的这些输入、输出，并同意花费我的那笔输入。 SIGHASH_NONE 该签名类型是最自由松散的，仅对输入签名，不对输出签名，输出可以任意指定。某人对某笔币签名后交给你，你可以在任意时刻填入任意接受地址，广播出去令其生效。简单理解就是：我同意花费我的那笔钱，至于给谁，我不关心。 SIGHASH_SINGLE 该签名类型其次自由松散，仅对自己的输入、输出签名，并留空sequence字段。其输入的次序对应其输出的次序，比如输入是第3个，那么签名的输出也是第三个。简单理解就是：我同意花费我的那笔钱，且只能花费到我认可的输出，至于单子里的其他输入、输出，我不关心。 交易的构造、签名与广播 上篇介绍了交易结构、签名等，为了更直观的认识数字货币，借助bitcoind演示手动构造并广播交易的完整过程。 普通交易 1. 找出未花费的币（unspent output） 通过命令：listunspent [minconf=1] [maxconf=9999999] [&quot;address&quot;,...]列出某个地址未花费的币(交易)，minconf/maxconf表示该笔收入交易的确认数范围，如果需要列出还未确认的交易，需将minconf设置为0。 执行： bitcoind listunspent 0 100 ‘[&quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot;]‘ 输出： [ { &quot;txid&quot; : &quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;, &quot;vout&quot; : 0, &quot;address&quot; : &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot;, &quot;account&quot; : &quot;&quot;, &quot;scriptPubKey&quot; : &quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;, &quot;amount&quot; : 0.19900000, &quot;confirmations&quot; : 1 } ] 我们找到该地址的一个未花费交易，位于交易296ea7bf981b4499…9f0a41e589132156的第0个位置。 2. 创建待发送交易 创建待发送交易，由命令：createrawtransaction [{&quot;txid&quot;:txid,&quot;vout&quot;:n},...] {address:amount,…}来完成。我们将 0.1 BTC发送至 1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x ，并支付 0.0001 BTC做为矿工费。输入交易的额度为 0.199 ，输出为 0.1 + 0.0001 = 0.1001 ，那么还剩余： 0.199 – 0.1001 = 0.0989 ，将此作为找零发回给自己。 执行： bitcoind createrawtransaction \\ ‘[{&quot;txid&quot;:&quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;,&quot;vout&quot;:0}]‘ \\ ‘{“1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x”:0.1, “1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3″:0.0989}’ 输出： 010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000 通过命令：decoderawtransaction ，可以将此段十六进制字符串解码。 执行： bitcoind decoderawtransaction ’010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000′ 输出： { “txid” : “54f773a3fdf7cb3292fc76b46c97e536348b3a0715886dbfd2f60e115fb3a8f0″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;&quot;, &quot;hex&quot; : &quot;&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.10000000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 fdc7990956642433ea75cabdcc0a9447c5d2b4ee OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x&quot; ] } }, { “value” : 0.09890000, “n” : 1, “scriptPubKey” : { “asm” : “OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG”, “hex” : “76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac”, “reqSigs” : 1, “type” : “pubkeyhash”, “addresses” : [ &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot; ] } } ] } 至此，一个“空白交易”就构造好了，尚未使用私钥对交易进行签名，字段scriptSig是留空的，无签名的交易是无效的。此时的Tx ID并不是最终的Tx ID，填入签名后Tx ID会发生变化。 在手动创建交易时，务必注意输入、输出的值，非常容易犯错的是忘记构造找零输出（如非必要勿手动构造交易）。曾经有人构造交易时忘记找零，发生了支付 200 BTC 的矿工费的人间惨剧，所幸的是收录该笔交易的Block由著名挖矿团队“烤猫（Friedcat）”挖得，该团队非常厚道的退回了多余费用。 3. 签名 交易签名使用命令： signrawtransaction \\ [{&quot;txid&quot;:txid,&quot;vout&quot;:n,&quot;scriptPubKey&quot;:hex,&quot;redeemScript&quot;:hex},...] [,...] \\ [sighashtype=&quot;ALL&quot;] 第一个参数是创建的待签名交易的十六进制字符串； 第二个参数有点类似创建交易时的参数，不过需要多出一个公钥字段scriptPubKey，其他节点验证交易时是通过公钥和签名来完成的，所以要提供公钥；如果是合成地址，则需要提供redeemScript； 第三个参数是即将花费的币所在地址的私钥，用来对交易进行签名，如果该地址私钥已经导入至bitcoind中，则无需显式提供； 最后一个参数表示签名类型，在上一篇里，介绍了三种交易签名类型； 签名之前需要找到scriptPubKey，提取输入交易信息即可获取(也可以根据其公钥自行计算)，由命令：getrawtransaction [verbose=0]完成。 执行： bitcoind getrawtransaction 296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156 1 输出： { “hex” : “01000000010511331f639e974283d3909496787a660583dc88f41598d177e225b5f352314a000000006c493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4ffffffff0160a62f01000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″, “txid” : “296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156″, “version” : 1, “locktime” : 0, “vin” : [ { &quot;txid&quot; : &quot;4a3152f3b525e277d19815f488dc8305667a78969490d38342979e631f331105&quot;, &quot;vout&quot; : 0, &quot;scriptSig&quot; : { &quot;asm&quot; : &quot;3046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d401 03cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4&quot;, &quot;hex&quot; : &quot;493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4&quot; }, &quot;sequence&quot; : 4294967295 } ], “vout” : [ { &quot;value&quot; : 0.19900000, &quot;n&quot; : 0, &quot;scriptPubKey&quot; : { &quot;asm&quot; : &quot;OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG&quot;, &quot;hex&quot; : &quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;, &quot;reqSigs&quot; : 1, &quot;type&quot; : &quot;pubkeyhash&quot;, &quot;addresses&quot; : [ &quot;1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3&quot; ] } } ], “blockhash” : “000000000000000488f18f7659acd85b2bd06a5ed2c4439eea74a8b968d16656″, “confirmations” : 19, “time” : 1383235737, “blocktime” : 1383235737 } scriptPubKey位于”vout”[0]–&gt;“scriptPubKey”–&gt;“hex”，即： 76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac 。 签名使用ECDSA算法，对其，“空白交易”签名之，执行： bitcoind signrawtransaction \\ “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ \\ ‘[{&quot;txid&quot;:&quot;296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156&quot;,&quot;vout&quot;:0,&quot;scriptPubKey&quot;:&quot;76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac&quot;}]‘ 输出： { “hex” : “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″, “complete” : true } 签名后，签名值会填入上文所述的空字段中，从而得到一个完整的交易。可通过上文介绍的命令decoderawtransaction 解码查看之。 最后一步，就是将其广播出去，等待网络传播至所有节点，约10~60秒广播至全球节点，取决与你的节点的网络连接状况。稍后一些时刻，就会进入Block中。广播由命令sendrawtransaction 来完成。如果没有运行节点，可以通过公共节点的API进行广播，例如：blockchain.info/pushtx。 执行： bitcoind sendrawtransaction \\ “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ 输出： b5f8da1ea9e02ec3cc0765f9600f49945e94ed4b0c88ed0648896bf3e213205d 返回的是Transaction Hash值，即该交易的ID。至此，交易构造、签名、发送的完整过程完成了。 合成地址交易 合成地址以3开头，可以实现多方管理资产，极大提高安全性，也可以轻松实现基于数字货币原生的三方交易担保支付。一个M-of-N的模式： m {pubkey}…{pubkey} n OP_CHECKMULTISIG M和N需满足： 1&lt;=N&lt;=3 1&lt;=M&lt;=N 可以是1 of 1，1 of 2，2 of 3等组合，通常选择N=3： 1 of 3，最大程度私钥冗余。防丢私钥损失，3把私钥中任意一把即可签名发币，即使丢失2把都可以保障不受损失； 2 of 3，提高私钥冗余度的同时解决单点信任问题。3把私钥任意2把私钥可签名发币，三方不完全信任的情形，即中介交易中，非常适用； 3 of 3，最大程度解决资金信任问题，无私钥冗余。必须3把私钥全部签名才能发币，适用多方共同管理重要资产，但任何一方遗失私钥均造成严重损失； 合成地址的交易构造、签名、发送过程与普通交易类似，这里只介绍如何创建一个合成地址。大神Gavin Andresen已经演示过，下面内容摘自其gist. 首先，需要三对公钥、私钥。公钥创建地址、私钥用于签名。 # No.1 0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86 / 5JaTXbAUmfPYZFRwrYaALK48fN6sFJp4rHqq2QSXs8ucfpE4yQU # No.2 04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874 / 5Jb7fCeh1Wtm4yBBg3q3XbT6B525i17kVhy3vMC9AqfR6FH2qGk # No.3 048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213 / 5JFjmGo5Fww9p8gvx48qBYDJNAzR9pmH5S389axMtDyPT8ddqmw 使用命令：createmultisig &lt;’[&quot;key&quot;,&quot;key&quot;]‘&gt;来合成，其中key为公钥，创建地址时仅需公钥。创建类型是2 of 3. 输入： bitcoind createmultisig 2 \\ ‘[&quot;0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86&quot;,&quot;04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874&quot;,&quot;048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213&quot;]‘ 输出： { “address” : “3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC”, “redeemScript” : “52410491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f864104865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec687441048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d4621353ae” } 得到的合成地址是：3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC，该地址没有公钥，仅有redeemScript，作用与公钥相同。后续的构造、签名、发送过程与上文普通地址交易类似，略去。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2017/07/07/d7af7e4ba6bc9682979acfb91d5d2f49.html","headline":"区块链开发专题(数字货币的数据结构与签名类型)","dateModified":"2017-07-07T00:00:00+08:00","datePublished":"2017-07-07T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2017/07/07/d7af7e4ba6bc9682979acfb91d5d2f49.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>区块链开发专题(数字货币的数据结构与签名类型)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p><br></p> 
  <p style="text-align:center;"><span style="color:rgb(102,102,102);font-family:Arial;font-size:14px;line-height:24px;text-indent:28px;">区块链爱好者（QQ：53016353）</span><br></p> 
  <p style="text-align:center;"><br></p> 
  <p><br></p> 交易(Transaction)是数字货币系统的信息载体，最小单元。而块(Block)就是将这些基础单元打包装箱，贴上封条，并串联起来。巨大算力保障了块的安全，也就保障了单个交易的安全。
  <br> 类型
  <br> 交易有三种常见类型：产量交易(Generation)，合成地址交易(Script Hash)，通用地址交易(Pubkey Hash)。该分类并非严格意义的，只是根据交易的输入输出做的简单区分。
  <br> Generation TX
  <br> 每个Block都对应一个产量交易(Generation TX)，该类交易是没有输入交易的，挖出的新币是所有币的源头。
  <br> Script Hash TX
  <br> 该类交易目前不是很常见，大部分人可能没有听说过，但是非常有意义。未来应该会在某些场合频繁使用。该类交易的接受地址不是通常意义的地址，而是一个合成地址，以3开头（对，以3开头的也是数字货币地址！）。三对公私钥，可以生成一个合成地址。在生成过程时指定n of 3中的n，n范围是[1, 3]，若n=1，则仅需一个私钥签名即可花费该地址的币，若n=3，则需要三把私钥依次签名才可以。
  <br> Pubkey Hash TX
  <br> 该类是最常见的交易类型，由N个输入、M个输出构成。
  <br> 数据结构
  <br> 交易中存放的是货币所有权的流转信息，所有权登记在数字货币地址上(Public Key)。这些信息是全网公开的，以明文形式存储（数字货币系统里的所有数据都是明文的），只有当需要转移货币所有权时，才需要用私钥签名来验证。
  <br>
  <br>
  <br>
  <br>
  <br> 字段大小
  <span> </span>描述
  <span> </span> 数据类型
  <span> </span>解释
  <br> 4
  <span> </span>version, 版本
  <span> </span> uint32_t
  <span> </span>交易数据结构的版本号
  <br> 1+
  <span> </span>tx_in count, 输入数量
  <span> </span>var_int
  <span> </span>输入交易的数量
  <br> 41+
  <span> </span>tx_in
  <span> </span> tx_in[]
  <span> </span>输入交易的数组，每个输入&gt;=41字节
  <br> 1+
  <span> </span>tx_out count, 输出数量
  <span> </span>var_int
  <span> </span>输出地址的数量
  <br> 9+
  <span> </span>tx_out
  <span> </span> tx_out[]
  <span> </span>输入地址的数组，每个输入&gt;=9字节
  <br> 4
  <span> </span>lock_time, 锁定时间
  <span> </span>uint32_t
  <span> </span>见下方解释
  <br> lock_time是一个多意字段，表示在某个高度的Block之前或某个时间点之前该交易处于锁定态，无法收录进Block。
  <br> 值
  <span> </span>含义
  <br> 0
  <span> </span>立即生效
  <br> &lt; 500000000
  <span> </span>含义为Block高度，处于该Block之前为锁定（不生效）
  <br> &gt;= 500000000
  <span> </span>含义为Unix时间戳，处于该时刻之前为锁定（不生效）
  <br> 若该笔交易的所有输入交易的sequence字段，均为INT32最大值(0xffffffff)，则忽略lock_time字段。否则，该交易在未达到Block高度或达到某个时刻之前，是不会被收录进Block中的。
  <br> 示例
  <br> 为了演示方便，我们读取稍早期的块数据，以高度116219 Block为例。
  <br> # ~ bitcoind getblock 0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611&nbsp;
  <br> {
  <br> “hash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″,
  <br> “confirmations” : 144667,
  <br> “size” : 1536,
  <br> “height” : 116219,
  <br> “version” : 1,
  <br> “merkleroot” : “587fefd748f899f84d0fa1d8a3876fdb406a4bb8f54a31445cb72564701daea6″,
  <br> “tx” : [
  <br> "be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e",
  <br> "a387039eca66297ba51ef2da3dcc8a0fc745bcb511e20ed9505cc6762be037bb",
  <br> "2bd83162e264abf59f9124ca517050065f8c8eed2a21fbf85d454ee4e0e4c267",
  <br> "028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743",
  <br> "3a06b6615756dc3363a8567fbfa8fe978ee0ba06eb33fd844886a0f01149ad62"
  <br> ],
  <br> “time” : 1301705313,
  <br> “nonce” : 1826107553,
  <br> “bits” : “1b00f339″,
  <br> “difficulty” : 68977.78463021,
  <br> “previousblockhash” : “00000000000010d549135eb39bd3bbb1047df8e1512357216e8a85c57a1efbfb”,
  <br> “nextblockhash” : “000000000000e9fcc59a6850f64a94476a30f5fe35d6d8c4b4ce0b1b04103a77″
  <br> }
  <br> 该Block里面有5笔交易，第一笔为Generation TX，解析出来看一下具体内容：
  <br> # ~ bitcoind getrawtransaction be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e 1
  <br> {
  <br> “hex” : “01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff070439f3001b0134ffffffff014034152a010000004341045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac00000000″,
  <br> “txid” : “be8f08d7f519eb863a68cf292ca51dbab7c9b49f50a96d13f2db32e432db363e”,
  <br> “version” : 1,
  <br> “locktime” : 0,
  <br> “vin” : [
  <br> {
  <br> "coinbase" : "0439f3001b0134",
  <br> "sequence" : 4294967295
  <br> }
  <br> ],
  <br> “vout” : [
  <br> {
  <br> "value" : 50.01000000,
  <br> "n" : 0,
  <br> "scriptPubKey" : {
  <br> "asm" : "045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dce OP_CHECKSIG",
  <br> "hex" : "41045b3aaa284d169c5ae2d20d0b0673468ed3506aa8fea5976eacaf1ff304456f6522fbce1a646a24005b8b8e771a671f564ca6c03e484a1c394bf96e2a4ad01dceac",
  <br> "reqSigs" : 1,
  <br> "type" : "pubkey",
  <br> "addresses" : [
  <br> "1LgZTvoTJ6quJNCURmBUaJJkWWQZXkQnDn"
  <br> ]
  <br> }
  <br> }
  <br> ],
  <br> “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″,
  <br> “confirmations” : 145029,
  <br> “time” : 1301705313,
  <br> “blocktime” : 1301705313
  <br> }
  <br> Generation TX的输入不是一个交易，而带有coinbase字段的结构。该字段的值由挖出此Block的人填写，这是一种“特权”：可以把信息写入货币系统（大家很喜欢用系统中的数据结构字段名来命名站点，例如blockchain、coinbase等，这些词的各种后缀域名都被抢注一空）。中本聪在数字货币的第一个交易中的写入的coinbase值是：
  <br> “coinbase”:”04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73″
  <br> 将该段16进制转换为ASCII字符，就是那段著名的创世块留言：
  <br> The Times 03/Jan/2009 Chancellor on brink of second bailout for banks
  <br> 接下来展示的是一个三个输入、两个输出的普通交易：
  <br> # ~ bitcoind getrawtransaction 028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743 1
  <br> {
  <br> “hex” : “0100000003c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7000000008a473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbeffffffffc9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffffc98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff0200bd0105000000001976a914634228c26cf40a02a05db93f2f98b768a8e0e61b88acc096c7a6030000001976a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac00000000″,
  <br> “txid” : “028cfae228f8a4b0caee9c566bd41aed36bcd237cdc0eb18f0331d1e87111743″,
  <br> “version” : 1,
  <br> “locktime” : 0,
  <br> “vin” : [
  <br> {
  <br> "txid" : "b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9",
  <br> "vout" : 0,
  <br> "scriptSig" : {
  <br> "asm" : "3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe",
  <br> "hex" : "473044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af0141048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe"
  <br> },
  <br> "sequence" : 4294967295
  <br> },
  <br> {
  <br> "txid" : "b79a4803014177ea0139c95f09c6903c01bb8f80d039631afd68cabf7eb0f3c9",
  <br> "vout" : 1,
  <br> "scriptSig" : {
  <br> "asm" : "304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d01 042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a",
  <br> "hex" : "47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026a"
  <br> },
  <br> "sequence" : 4294967295
  <br> },
  <br> {
  <br> "txid" : "da30b272fb73d78108ff80ddd1ac2f76419533af79ad06a5b3c70fc4a62086c9",
  <br> "vout" : 1,
  <br> "scriptSig" : {
  <br> "asm" : "3045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d01 04a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f",
  <br> "hex" : "483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2f"
  <br> },
  <br> "sequence" : 4294967295
  <br> }
  <br> ],
  <br> “vout” : [
  <br> {
  <br> "value" : 0.84000000,
  <br> "n" : 0,
  <br> "scriptPubKey" : {
  <br> "asm" : "OP_DUP OP_HASH160 634228c26cf40a02a05db93f2f98b768a8e0e61b OP_EQUALVERIFY OP_CHECKSIG",
  <br> "hex" : "76a914634228c26cf40a02a05db93f2f98b768a8e0e61b88ac",
  <br> "reqSigs" : 1,
  <br> "type" : "pubkeyhash",
  <br> "addresses" : [
  <br> "1A3q9pDtR4h8wpvyb8SVpiNPpT8ZNbHY8h"
  <br> ]
  <br> }
  <br> },
  <br> {
  <br> “value” : 156.83000000,
  <br> “n” : 1,
  <br> “scriptPubKey” : {
  <br> “asm” : “OP_DUP OP_HASH160 7514080ab2fcac0764de3a77d10cb790c71c74c2 OP_EQUALVERIFY OP_CHECKSIG”,
  <br> “hex” : “76a9147514080ab2fcac0764de3a77d10cb790c71c74c288ac”,
  <br> “reqSigs” : 1,
  <br> “type” : “pubkeyhash”,
  <br> “addresses” : [
  <br> "1Bg44FZsoTeYteRykC1XHz8facWYKhGvQ8"
  <br> ]
  <br> }
  <br> }
  <br> ],
  <br> “blockhash” : “0000000000007c639f2cbb23e4606a1d022fa4206353b9d92e99f5144bd74611″,
  <br> “confirmations” : 147751,
  <br> “time” : 1301705313,
  <br> “blocktime” : 1301705313
  <br> }
  <br> 字段hex记录了所有相关信息，后面显示的是hex解析出来的各类字段信息。下面把逐个分解hex内容（hex可以从上面的直接看到）：
  <br> 01000000 // 版本号，UINT32
  <br> 03 // Tx输入数量，变长INT。3个输入。
  <br> /*** 第一组Input Tx ***/
  <br> // Tx Hash，固定32字节
  <br> c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7
  <br> 00000000 // 消费的Tx位于前向交易输出的第0个，UINT32，固定4字节
  <br> 8a // 签名的长度, 0x8A = 138字节
  <br> // 138字节长度的签名，含有两个部分：公钥+签名
  <br> 47 // 公钥长度，0×47 = 71字节
  <br> 3044022055bac1856ecbc377dd5e869b1a84ed1d5228c987b098c095030c12431a4d5249022055523130a9d0af5fc27828aba43b464ecb1991172ba2a509b5fbd6cac97ff3af01
  <br> 41 // 签名长度，0×41 = 65字节
  <br> 048aefd78bba80e2d1686225b755dacea890c9ca1be10ec98173d7d5f2fefbbf881a6e918f3b051f8aaaa3fcc18bbf65097ce8d30d5a7e5ef8d1005eaafd4b3fbe
  <br> ffffffff // sequence，0xffffffff = 4294967295， UINT32, 固定4字节
  <br> /*** 第二组Input Tx。与上同理，省略分解 ***/
  <br> c9f3b07ebfca68fd1a6339d0808fbb013c90c6095fc93901ea77410103489ab7010000008a47304402206b993231adec55e6085e75f7dc5ca6c19e42e744cd60abaff957b1c352b3ef9a022022a22fec37dfa2c646c78d9a0753d56cb4393e8d0b22dc580ef1aa6cccef208d0141042ff65bd6b3ef04253225405ccc3ab2dd926ff2ee48aac210819698440f35d785ec3cec92a51330eb0c76cf49e9e474fb9159ab41653a9c1725c031449d31026affffffff
  <br> /*** 第三组Input Tx ***/
  <br> c98620a6c40fc7b3a506ad79af339541762facd1dd80ff0881d773fb72b230da010000008b483045022040a5d957e087ed61e80f1110bcaf4901b5317c257711a6cbc54d6b98b6a8563f02210081e3697031fe82774b8f44dd3660901e61ac5a99bff2d0efc83ad261da5b4f1d014104a7d1a57e650613d3414ebd59e3192229dc09d3613e547bdd1f83435cc4ca0a11c679d96456cae75b1f5563728ec7da1c1f42606db15bf554dbe8a829f3a8fe2fffffffff
  <br> 02 // Tx输出数量，变长INT。两个输出。
  <br> /*** 第一组输出 ***/
  <br> 00bd010500000000 // 输出的币值，UINT64，8个字节。字节序需翻转，~= 0x000000000501bd00 = 84000000 satoshi
  <br> 19 // 输出目的地址字节数, 0×19 = 25字节，由一些操作码与数值构成
  <br> // 目标地址
  <br> // 0×76 -&gt; OP_DUP(stack ops)
  <br> // 0xa9 -&gt; OP_HASH160(crypto)
  <br> // 0×14 -&gt; 长度，0×14 = 20字节
  <br> 76 a9 14
  <br> // 地址的HASH160值，20字节
  <br> 634228c26cf40a02a05db93f2f98b768a8e0e61b
  <br> // 0×88 -&gt; OP_EQUALVERIFY(bit logic)
  <br> // 0xac -&gt; OP_CHECKSIG(crypto)
  <br> 88 ac
  <br> /*** 第二组输出 ***/
  <br> c096c7a603000000
  <br> 19
  <br> 76 a9 14 7514080ab2fcac0764de3a77d10cb790c71c74c2 88 ac
  <br> 00000000 // lock_time，UINT32，固定4字节
  <br> Tx Hash，俗称交易ID，由hex得出：Tx Hash = SHA256(SHA256(hex))。由于每个交易只能成为下一个的输入，有且仅有一次，那么不存在输入完全相同的交易，那么就不存在相同的Tx Hash（SHA256碰撞概率极小，所以无需考虑Hash碰撞的问题，就像无需考虑地址私钥被别人撞到一样）。
  <br> 即便如此，在系统里依然产生了相同的Tx Hash，是某位矿工兄弟挖出Block后，打包Block时忘记修改Generation Tx coinbase字段的值，币量相同且输出至相同的地址，那么就构造了两个完全一模一样的交易，分别位于两个Block的第一个位置。这个对系统不会产生什么问题，但只要花费其中一笔，另一个也被花费了。相同的Generation Tx相当于覆盖了另一个，白白损失了挖出的币。该交易ID为e3bf3d07d4b0375638d5f1db5255fe07ba2c4cb067cd81b84ee974b6585fb468，第一次出现在#91722，第二次出现在#91880。
  <br> b01dc7da-3edf-11e3-86eb-d015037e9440
  <br> 交易签名
  <br> 签名是对所有权的验证，节点收到交易广播后，会对交易进行验证，通过后则收录进内存、打包进Block，否则，丢弃之。签名就类似传统纸质合同盖章、签字过程，合法转移所有权的保证手段。
  <br> 签名类型
  <br> 由于一个交易的输入、输出都可能具有多个，那么签名也具有多种类型，目前共三类：SIGHASH_ALL, SIGHASH_NONE, SIGHASH_SINGLE。
  <br> SIGHASH_ALL
  <br> 该签名类型为默认类型，也是目前绝大部分交易采用的，顾名思义即签名整单交易。首先，组织所有输出、输入，就像上文分解Hex过程一样，每个输入都对应一个签名，暂时留空，其他包括sequence等字段均须填写，这样就形成了一个完整的交易Hex（只缺签名字段）。然后，每一个输入均需使用私钥对该段数据进行签名，签名完成后各自填入相应的位置，N个输入N个签名。简单理解就是：对于该笔单子，认可且只认可的这些输入、输出，并同意花费我的那笔输入。
  <br> SIGHASH_NONE
  <br> 该签名类型是最自由松散的，仅对输入签名，不对输出签名，输出可以任意指定。某人对某笔币签名后交给你，你可以在任意时刻填入任意接受地址，广播出去令其生效。简单理解就是：我同意花费我的那笔钱，至于给谁，我不关心。
  <br> SIGHASH_SINGLE
  <br> 该签名类型其次自由松散，仅对自己的输入、输出签名，并留空sequence字段。其输入的次序对应其输出的次序，比如输入是第3个，那么签名的输出也是第三个。简单理解就是：我同意花费我的那笔钱，且只能花费到我认可的输出，至于单子里的其他输入、输出，我不关心。
  <br> 交易的构造、签名与广播
  <br> 上篇介绍了交易结构、签名等，为了更直观的认识数字货币，借助bitcoind演示手动构造并广播交易的完整过程。
  <br> 普通交易
  <br> 1. 找出未花费的币（unspent output）
  <br> 通过命令：listunspent [minconf=1] [maxconf=9999999] ["address",...]列出某个地址未花费的币(交易)，minconf/maxconf表示该笔收入交易的确认数范围，如果需要列出还未确认的交易，需将minconf设置为0。
  <br> 执行：
  <br> bitcoind listunspent 0 100 ‘["1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3"]‘
  <br> 输出：
  <br> [
  <br> {
  <br> "txid" : "296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156",
  <br> "vout" : 0,
  <br> "address" : "1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3",
  <br> "account" : "",
  <br> "scriptPubKey" : "76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac",
  <br> "amount" : 0.19900000,
  <br> "confirmations" : 1
  <br> }
  <br> ]
  <br> 我们找到该地址的一个未花费交易，位于交易296ea7bf981b4499…9f0a41e589132156的第0个位置。
  <br> 2. 创建待发送交易
  <br> 创建待发送交易，由命令：createrawtransaction [{"txid":txid,"vout":n},...] {address:amount,…}来完成。我们将 0.1 BTC发送至 1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x ，并支付 0.0001 BTC做为矿工费。输入交易的额度为 0.199 ，输出为 0.1 + 0.0001 = 0.1001 ，那么还剩余： 0.199 – 0.1001 = 0.0989 ，将此作为找零发回给自己。
  <br> 执行：
  <br> bitcoind createrawtransaction \
  <br> ‘[{"txid":"296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156","vout":0}]‘ \
  <br> ‘{“1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x”:0.1, “1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3″:0.0989}’
  <br> 输出：
  <br> 010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000
  <br> 通过命令：decoderawtransaction ，可以将此段十六进制字符串解码。
  <br> 执行：
  <br> bitcoind decoderawtransaction ’010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000′
  <br> 输出：
  <br> {
  <br> “txid” : “54f773a3fdf7cb3292fc76b46c97e536348b3a0715886dbfd2f60e115fb3a8f0″,
  <br> “version” : 1,
  <br> “locktime” : 0,
  <br> “vin” : [
  <br> {
  <br> "txid" : "296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156",
  <br> "vout" : 0,
  <br> "scriptSig" : {
  <br> "asm" : "",
  <br> "hex" : ""
  <br> },
  <br> "sequence" : 4294967295
  <br> }
  <br> ],
  <br> “vout” : [
  <br> {
  <br> "value" : 0.10000000,
  <br> "n" : 0,
  <br> "scriptPubKey" : {
  <br> "asm" : "OP_DUP OP_HASH160 fdc7990956642433ea75cabdcc0a9447c5d2b4ee OP_EQUALVERIFY OP_CHECKSIG",
  <br> "hex" : "76a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88ac",
  <br> "reqSigs" : 1,
  <br> "type" : "pubkeyhash",
  <br> "addresses" : [
  <br> "1Q8s4qDRbCbFypG5AFNR9tFC57PStkPX1x"
  <br> ]
  <br> }
  <br> },
  <br> {
  <br> “value” : 0.09890000,
  <br> “n” : 1,
  <br> “scriptPubKey” : {
  <br> “asm” : “OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG”,
  <br> “hex” : “76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac”,
  <br> “reqSigs” : 1,
  <br> “type” : “pubkeyhash”,
  <br> “addresses” : [
  <br> "1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3"
  <br> ]
  <br> }
  <br> }
  <br> ]
  <br> }
  <br> 至此，一个“空白交易”就构造好了，尚未使用私钥对交易进行签名，字段scriptSig是留空的，无签名的交易是无效的。此时的Tx ID并不是最终的Tx ID，填入签名后Tx ID会发生变化。
  <br> 在手动创建交易时，务必注意输入、输出的值，非常容易犯错的是忘记构造找零输出（如非必要勿手动构造交易）。曾经有人构造交易时忘记找零，发生了支付 200 BTC 的矿工费的人间惨剧，所幸的是收录该笔交易的Block由著名挖矿团队“烤猫（Friedcat）”挖得，该团队非常厚道的退回了多余费用。
  <br> 3. 签名
  <br> 交易签名使用命令：
  <br> signrawtransaction \
  <br> [{"txid":txid,"vout":n,"scriptPubKey":hex,"redeemScript":hex},...] [,...] \
  <br> [sighashtype="ALL"]
  <br> 第一个参数是创建的待签名交易的十六进制字符串；
  <br> 第二个参数有点类似创建交易时的参数，不过需要多出一个公钥字段scriptPubKey，其他节点验证交易时是通过公钥和签名来完成的，所以要提供公钥；如果是合成地址，则需要提供redeemScript；
  <br> 第三个参数是即将花费的币所在地址的私钥，用来对交易进行签名，如果该地址私钥已经导入至bitcoind中，则无需显式提供；
  <br> 最后一个参数表示签名类型，在上一篇里，介绍了三种交易签名类型；
  <br> 签名之前需要找到scriptPubKey，提取输入交易信息即可获取(也可以根据其公钥自行计算)，由命令：getrawtransaction [verbose=0]完成。
  <br> 执行：
  <br> bitcoind getrawtransaction 296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156 1
  <br> 输出：
  <br> {
  <br> “hex” : “01000000010511331f639e974283d3909496787a660583dc88f41598d177e225b5f352314a000000006c493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4ffffffff0160a62f01000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″,
  <br> “txid” : “296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156″,
  <br> “version” : 1,
  <br> “locktime” : 0,
  <br> “vin” : [
  <br> {
  <br> "txid" : "4a3152f3b525e277d19815f488dc8305667a78969490d38342979e631f331105",
  <br> "vout" : 0,
  <br> "scriptSig" : {
  <br> "asm" : "3046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d401 03cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4",
  <br> "hex" : "493046022100be8c796122ec598295e6dfd6664a20a7e20704a17f76d3d925c9ec421ca60bc1022100cf9f2d7b9f24285f7c119c91f24521e5483f6b141de6ee55658fa70116ee04d4012103cad07f6de0b181891b5291a5bc82b228fe6509699648b0b53556dc0057eeb5a4"
  <br> },
  <br> "sequence" : 4294967295
  <br> }
  <br> ],
  <br> “vout” : [
  <br> {
  <br> "value" : 0.19900000,
  <br> "n" : 0,
  <br> "scriptPubKey" : {
  <br> "asm" : "OP_DUP OP_HASH160 d6c492056f3f99692b56967a42b8ad44ce76b67a OP_EQUALVERIFY OP_CHECKSIG",
  <br> "hex" : "76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac",
  <br> "reqSigs" : 1,
  <br> "type" : "pubkeyhash",
  <br> "addresses" : [
  <br> "1Lab618UuWjLmVA1Q64tHZXcLoc4397ZX3"
  <br> ]
  <br> }
  <br> }
  <br> ],
  <br> “blockhash” : “000000000000000488f18f7659acd85b2bd06a5ed2c4439eea74a8b968d16656″,
  <br> “confirmations” : 19,
  <br> “time” : 1383235737,
  <br> “blocktime” : 1383235737
  <br> }
  <br> scriptPubKey位于”vout”[0]–&gt;“scriptPubKey”–&gt;“hex”，即： 76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac 。
  <br> 签名使用ECDSA算法，对其，“空白交易”签名之，执行：
  <br> bitcoind signrawtransaction \
  <br> “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e290000000000ffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″ \
  <br> ‘[{"txid":"296ea7bf981b44999d689853d17fe0ceb852a8a34e68fcd19f0a41e589132156","vout":0,"scriptPubKey":"76a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac"}]‘
  <br> 输出：
  <br> {
  <br> “hex” : “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″,
  <br> “complete” : true
  <br> }
  <br> 签名后，签名值会填入上文所述的空字段中，从而得到一个完整的交易。可通过上文介绍的命令decoderawtransaction 解码查看之。
  <br> 最后一步，就是将其广播出去，等待网络传播至所有节点，约10~60秒广播至全球节点，取决与你的节点的网络连接状况。稍后一些时刻，就会进入Block中。广播由命令sendrawtransaction 来完成。如果没有运行节点，可以通过公共节点的API进行广播，例如：blockchain.info/pushtx。
  <br> 执行：
  <br> bitcoind sendrawtransaction \
  <br> “010000000156211389e5410a9fd1fc684ea3a852b8cee07fd15398689d99441b98bfa76e29000000008c493046022100f9da4f53a6a4a8317f6e7e9cd9a7b76e0f5e95dcdf70f1b1e2b3548eaa3a6975022100858d48aed79da8873e09b0e41691f7f3e518ce9a88ea3d03f7b32eb818f6068801410477c075474b6798c6e2254d3d06c1ae3b91318ca5cc62d18398697208549f798e28efb6c55971a1de68cca81215dd53686c31ad8155cdc03563bf3f73ce87b4aaffffffff0280969800000000001976a914fdc7990956642433ea75cabdcc0a9447c5d2b4ee88acd0e89600000000001976a914d6c492056f3f99692b56967a42b8ad44ce76b67a88ac00000000″
  <br> 输出：
  <br> b5f8da1ea9e02ec3cc0765f9600f49945e94ed4b0c88ed0648896bf3e213205d
  <br> 返回的是Transaction Hash值，即该交易的ID。至此，交易构造、签名、发送的完整过程完成了。
  <br> 合成地址交易
  <br> 合成地址以3开头，可以实现多方管理资产，极大提高安全性，也可以轻松实现基于数字货币原生的三方交易担保支付。一个M-of-N的模式：
  <br> m {pubkey}…{pubkey} n OP_CHECKMULTISIG
  <br> M和N需满足：
  <br> 1&lt;=N&lt;=3
  <br> 1&lt;=M&lt;=N
  <br> 可以是1 of 1，1 of 2，2 of 3等组合，通常选择N=3：
  <br> 1 of 3，最大程度私钥冗余。防丢私钥损失，3把私钥中任意一把即可签名发币，即使丢失2把都可以保障不受损失；
  <br> 2 of 3，提高私钥冗余度的同时解决单点信任问题。3把私钥任意2把私钥可签名发币，三方不完全信任的情形，即中介交易中，非常适用；
  <br> 3 of 3，最大程度解决资金信任问题，无私钥冗余。必须3把私钥全部签名才能发币，适用多方共同管理重要资产，但任何一方遗失私钥均造成严重损失；
  <br> 合成地址的交易构造、签名、发送过程与普通交易类似，这里只介绍如何创建一个合成地址。大神Gavin Andresen已经演示过，下面内容摘自其gist.
  <br> 首先，需要三对公钥、私钥。公钥创建地址、私钥用于签名。
  <br> # No.1
  <br> 0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86 / 5JaTXbAUmfPYZFRwrYaALK48fN6sFJp4rHqq2QSXs8ucfpE4yQU
  <br> # No.2
  <br> 04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874 / 5Jb7fCeh1Wtm4yBBg3q3XbT6B525i17kVhy3vMC9AqfR6FH2qGk
  <br> # No.3
  <br> 048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213 / 5JFjmGo5Fww9p8gvx48qBYDJNAzR9pmH5S389axMtDyPT8ddqmw
  <br> 使用命令：createmultisig &lt;’["key","key"]‘&gt;来合成，其中key为公钥，创建地址时仅需公钥。创建类型是2 of 3.
  <br> 输入：
  <br> bitcoind createmultisig 2 \
  <br> ‘["0491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f86","04865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec6874","048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d46213"]‘
  <br> 输出：
  <br> {
  <br> “address” : “3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC”,
  <br> “redeemScript” : “52410491bba2510912a5bd37da1fb5b1673010e43d2c6d812c514e91bfa9f2eb129e1c183329db55bd868e209aac2fbc02cb33d98fe74bf23f0c235d6126b1d8334f864104865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac09ef122b1a986818a7cb624532f062c1d1f8722084861c5c3291ccffef4ec687441048d2455d2403e08708fc1f556002f1b6cd83f992d085097f9974ab08a28838f07896fbab08f39495e15fa6fad6edbfb1e754e35fa1c7844c41f322a1863d4621353ae”
  <br> }
  <br> 得到的合成地址是：3QJmV3qfvL9SuYo34YihAf3sRCW3qSinyC，该地址没有公钥，仅有redeemScript，作用与公钥相同。后续的构造、签名、发送过程与上文普通地址交易类似，略去。 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jQQ53016353/article/details/74669215,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/jQQ53016353/article/details/74669215,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用openssl命令剖析RSA私钥文件格式 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用openssl命令剖析RSA私钥文件格式" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Openssl提供了强大证书功能，生成密钥对、证书，颁发证书、生成crl、验证证书、销毁证书等。本文将j介绍如何利用openssl的命令分析RSA私钥文件格式，同时也将简单介绍几种常见的私钥文件格式。 &nbsp; 1 生成私钥文件 openssl有多种方法生成私钥： genrsa生成RSA密钥。 req在生成req证书请求时同时产生密钥。 genpkey除了可以生成RSA密钥外，还可以生成DSA、DH密钥。 &nbsp;这里我使用genpkey命令生成RSA私钥文件，选择DES-EDE3-CBC算法进行加密，口令是1234： [plain] view plain copy openssl&nbsp;genpkey&nbsp;-algorithm&nbsp;RSA&nbsp;-out&nbsp;privatekey.pem&nbsp;-pass&nbsp;pass:1234&nbsp;-des-ede3-cbc&nbsp;&nbsp; 命令执行后输出私钥文件 privatekey.pem，默认输出为 PEM格式，密钥长度为1024，接下来使用文本工具直接打开该文件，可以看到如下内容：&nbsp; [html] view plain copy -----BEGINENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; MIICxjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIhrQ3ApYYe1ACAggA&nbsp;&nbsp; MBQGCCqGSIb3DQMHBAgyM5zYLuXOdQSCAoAFqnCRqkpoHJTY0BpLeekzjsuzdTOq&nbsp;&nbsp; DkgxJMi4WRt1rZNyHqarbhHCZGC9Lug/xbLW5e2ZtjYVJ+ljmFb4lUaAch4nAgoz&nbsp;&nbsp; m0J5YyrbFKppiqlk6vkS5hKfpKbWrx5hkQzMt6OsVEQFj2U+EvOI8SVgI6LkjNmh&nbsp;&nbsp; 7qokYxv9Inx9joM6agEUY9fXdAu53CyfjpneX95vxUHIn7hHmhxH7MYua619N7x+&nbsp;&nbsp; JVA65b3Kj45aH3cnY/kMAQ78EN9aLpqYXzn6j9GRdUd2JMuP0IrYlREw3/z8Qn68&nbsp;&nbsp; CwGXzGtkYnlt0xHdOG/tnmKWqBg1cY9uVx6g6JT1BUabqwxVODaMqaSsFr4o3xJo&nbsp;&nbsp; 3TTh8TswK0V/+3JLkXtasI7V8cRj2dksccGApujmB5eymU3XXTlX3iXs481I4kmz&nbsp;&nbsp; JOZHbqfGOpyzW6WqhMO+LebIkyIGMlCGRiJ3PNSQI9w6bfZ9FoqC6OfFKY1OEmBN&nbsp;&nbsp; 6ALtPc+cYXeO5Msx9mbakIYRbcjlVmelPsLyvAceW/09OG909turflvYaGnM+SKd&nbsp;&nbsp; KzWn2gFr3YwF57WZlX2jifYUUnjHVMZW7s/k6hgOxcEnvBOg4Ug/cKdNPUEB7tJx&nbsp;&nbsp; nvsR+odHypyjgyphLEP8UmEiz3/hnPV8lhLDAPV7fKaK+zDglKqQYF3KBLh55q6h&nbsp;&nbsp; PPe1HqahifK9EKqWOl7m1HhFPIZTex4clLy98rB3gyXnL0qx4+A7WD6uLJbU285j&nbsp;&nbsp; IWMNq3f1c80ZPrpbhT6hd6Z9zUwfYT6gTO9gIIe4d5KVmfjNaFwSls5zaI6x7AJp&nbsp;&nbsp; d/Xl/m1u469+J0rWyeY3D4wtahvZrKMXRrILtJ5OgkWPak2FTyMu/Hs/&nbsp;&nbsp; -----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; 私钥经过PEM编码后在文件头尾都添加了标签，用以说明当前的文件格式。从标签内容也可以看出私钥是加密的，因为有“ ENCRYPTED”。中间的私钥内容是经过BASE64编码的，这样方便私钥的传递，例如在网络上传输，数据复制粘贴。 &nbsp; 例子只是PEM文件格式的其中一种，以下是平时可能会碰到的PEM私钥格式： PKCS#8 私钥加密格式 [html] view plain copy -----BEGIN&nbsp;ENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; PKCS#8 私钥非加密格式 [html] view plain copy -----BEGIN&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----END&nbsp;PRIVATEKEY-----&nbsp;&nbsp; Openssl ASN格式 [html] view plain copy -----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; Proc-Type:&nbsp;4,ENCRYPTED&nbsp;&nbsp; DEK-Info:DES-EDE3-CBC,4D5D1AF13367D726&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; 除了以上几种，还有微软的PVK格式；以及DER编码格式，就是在使用PEM编码前的数据，由于没有密码保护，平时很少直接使用。 &nbsp; Openssl ASN格式在加密私钥数据时只能用MD5算法生成key，而且只迭代计算了1次。 所以从1.0.0开始Openssl把PKCS#8格式作为默认格式，可以为私钥文件提供更好的安全性和扩展性。 我们这里就针对PKCS#8格式的私钥进行讨论。 如果大家想要研究其他格式，可以使用以下命令： &nbsp;genrsa 生成ASN格式 &nbsp;rsa 生成或转换为PVK格式 [html] view plain copy openssl&nbsp;rsa&nbsp;-in&nbsp;privatekey.pem&nbsp;-out&nbsp;privatekey.pvk&nbsp;-outform&nbsp;PVK&nbsp;&nbsp; &nbsp;&nbsp; 2 分析私钥文件&nbsp; 使用asn1parse命令读取私钥ASN.1结构，其中–i表示输出使用缩进格式。 openssl asn1parse -i -in privatekey.pem&nbsp; [html] view plain copy &nbsp;0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;710&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;4:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;6:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBES2&nbsp;&nbsp; 17:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;51&nbsp;cons:&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 19:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;27&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 21:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp; 32:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;14&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 34:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp; 44:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;2&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp; 48:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;20&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 50:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp; 60:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp; 70:d=1&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;640&nbsp;prim:&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:&nbsp;&nbsp; 4F34F0CFF56B3E92D437C49559B1BD632BA2D8B22AF290B0E8EBB7F71C555115CED4DE87E3922A41436A20DA1DB01F1BD88EA3002E8AD4691C0B25F16AF4D196C2A96B99A1D49F704A21D3B81F8CC81C3F09412317B67F453151490D2573E1FD96D13BB55E7FCD4085ED0C4DD75EB1EFFC4ACE5431AFD708E6ECE5077BAB2B03965C6F2873C1DB5F475F861E9C04D61465C72A8A99DCF093190F746DD8959C0B0942E38A013B0FEC2D4A66F600EF75CE0326F3B4904C3128CB389204A1CC4F93EED7C8F2450603A42C6C16FB143FF4C9C01E714A43CC07B1F1B580A6C9DE4DC9B78CA0D5B874C75A0F56F6A55CFE4620F1AC639DCE4A8AF2BCBB69691DAF983BB26F6A6C859C371D1EBA7DA5C27FBDAC86C6529C48B32E3B89317FC7EBF03F9C105EAA1892437E9E789F0E2340979812A53CD1668EC07A45BBEAE088E7E27BB20B16C2D14280970BBF715D57005F194B97A1784E7BC563A0B84909A7EAB6C7E0BC6E2B467AA4009420D190617F93CD32FAEEE50003462DC8B26816040E891523E1375F339A3F05C43C9E90A4533BD4D3F75A2A33E60D91563542355D5ED1F46CF62594460694F459F0EC428BECE015F075895CFEB502EA22ECD9B53BF050B795074BE9A51194789F0B2970C21CCFE16284FB564F720C7899D5840362C48D248A50BAFA2720B0C1F7B417AD6EA183459BBB80679A85D96421C5AE3FA53A2135217F886759187123766914BB0169F6F9C3A36F1C46B6EB9300009A799D0F96C3E1FBE805F17A01FF2F5A9C941399E6130DBEE9825F4EB8937F2B8F0B3DE5F08644F3DC65028F2DE150D03D454AECFF9CAF26A00BB1B6D6D2C5255216E0A6769F14937618E31573811AAA464C3C42246A17DD70B1F77A87948FD5C7526D569BB8&nbsp;&nbsp; ASN.1结构输出格式说明： [html] view plain copy 0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;710&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; 0 表示节点在整个文件中的偏移长度 d=0 表示节点深度 hl=4&nbsp;表示节点头字节长度 l=710&nbsp;表示节点数据字节长度 cons 表示该节点为结构节点，表示包含子节点或者子结构数据 prim 表示该节点为原始节点，包含数据 SEQUENCE、OCTETSTRING等都是ASN.1中定义的数据类型，具体可以参考ASN.1格式说明。 &nbsp;最后一个节点OCTET STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [HEX DUMP]，就是加密后的私钥数据。 为了方便理解，下面给出相关的PKCS定义。 PCKS#8文件格式定义： [html] view plain copy PrivateKeyInfo&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKeyAlgorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKeyAlgorithmIdentifier,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKey,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attributes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0]&nbsp;&nbsp;IMPLICIT&nbsp;Attributes&nbsp;OPTIONAL&nbsp;}&nbsp;&nbsp;&nbsp; privateKey，加密后私钥数据，最后一个OCTET STRING数据块。 privateKeyAlgorithm，使用的私钥算法，详细格式在 PKCS#5&nbsp;2.0中的定义： [html] view plain copy PBES2-params&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyDerivationFunc&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-KDFs}},&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encryptionScheme&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-Encs}}&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}&nbsp;&nbsp; keyDerivationFunc 加密密钥生成函数，现在默认使用的是sha1，还包含了salt，迭代次数iterationCount： [html] view plain copy PBKDF2-params&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;salt&nbsp;CHOICE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specified&nbsp;OCTET&nbsp;STRING,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherSource&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-SaltSources}}&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterationCount&nbsp;INTEGER&nbsp;(1..MAX),&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyLength&nbsp;INTEGER&nbsp;(1..MAX)&nbsp;OPTIONAL,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prf&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-PRFs}}&nbsp;DEFAULT&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algid-hmacWithSHA1&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}&nbsp;&nbsp; [html] view plain copy 对应数据：&nbsp;&nbsp; &nbsp;&nbsp;19:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;27&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;21:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;32:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;14&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;34:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp; &nbsp;&nbsp;44:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;2&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp; encryptionScheme 加密算法，例子中使用的是des-ede3-cbc，该结构中还包含初始化向量iv。 [html] view plain copy 对应数据：&nbsp;&nbsp; &nbsp;&nbsp;48:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;20&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;50:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp; &nbsp;&nbsp;60:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp; 解密流程： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 按PKCS#8和PCKS#5定义从文件中解析出相关参数： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密密钥生成函数（KDF）PBKDF2； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密时使用的salt：7A61B055165A89CA，以及迭代次数iter：0x0800（2048次）； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密算法des-ede3-cbc，以及加密初始向量iv：110E8A184EFEAB9C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 解析出加密的私钥数据data，也就是最后一个OCTET STRING； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 生成加密密钥：key = KDF（pass（1234），salt，iter） &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 解密 des-ede3-cbc（key， iv， data） &nbsp; 这一解密过程可以使用openssl的pkey命令完成，执行完成后得到privatekey.der文件，这个是没有加密的私钥文件，数据是ASN.1格式，并使用DER编码。 Openssl pkey -in privatekey.pem -out privatekey.der-passin pass:1234 &nbsp;&nbsp; 然后再次分析密钥数据，由于输入是der格式，需要使用inform参数说明： openssl asn1parse -in privatekey.der -inform DER &nbsp; [html] view plain copy &nbsp;&nbsp;&nbsp;0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;604&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;1&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:00&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp; &nbsp;139:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;3&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp; &nbsp;144:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 9B2C9B7CD105AC851EC47E8FB0D541088489D59C5E4A8E88F15ADE1C5B953ABFEE154B39870FCD94B23247BBEF805A8C826FF413B239E8469E9F3404B949A643E1E2CCF9753822FD28345B7898148164DA2D858F672B52C7B3041F0A9F6FFFB97759D3C04AE3ED2E372E4ADD3A44202CE004D189566A81F19239649779F30DE9&nbsp;&nbsp; &nbsp;276:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;65&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; CE25257FDE50AFDAF926BDBEFE5A236C130F2714C5FC0C36A07B5AA5618E8F5039E313387C933A86EBDC2DEF8640069CB98B1D04C3E74B46C75F292A768083D5&nbsp;&nbsp; &nbsp;343:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;65&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; C8159573F6C413EAC0BB721B859A4B7920FF9DE151546CA28FDA3F43A0999C835DB9078AF5054CE503C4BC174ECB1F0C4DE033E116A296FD67B4158F869E628F&nbsp;&nbsp; &nbsp;410:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 7329855D7DD10DAD02EB85AD216331CEBA87088A2E60B462001D697262A1C5A647F07758631FCCDE7AFD321C519F8B121B05805C9D24A58510F4348728547B51&nbsp;&nbsp; &nbsp;476:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 53735D203EBDCD28CE35E003C69771FF155A47B92038BC0E993D07C1E70BEA9187D79263CC89E7666549FAC125E5E60F35B3DB2F78475BFE58F06D45AD7A05D5&nbsp;&nbsp; &nbsp;542:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 4F454C491EAE6CD85ED812D8A26AFD5FD0F6D7DD12AD6D20EDA8C2D257943928B2AE66FDE336F40370D9CC30B85EB2F20D3B4FDAB61D168FE7936CB6AB5E8FE2&nbsp;&nbsp; &nbsp;得到的数据与上次导出的格式是相同的，虽然看起来数据多，但是层次结构起始要简单，数据就是一个结构体（cons）SEQUENCE，包含9个整型的原始数据（prim）INTERGER，这个就是私钥结构，该 ASN.1结构在PKCS#1中定义如下： [html] view plain copy RSAPrivateKey&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; versionVersion,&nbsp;&nbsp; modulusINTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; publicExponentINTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp; privateExponentINTEGER,&nbsp;--&nbsp;d&nbsp;&nbsp; prime1INTEGER,&nbsp;--&nbsp;p&nbsp;&nbsp; prime2INTEGER,&nbsp;--&nbsp;q&nbsp;&nbsp; exponent1INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(p-1)&nbsp;&nbsp; exponent2INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(q-1)&nbsp;&nbsp; coefficientINTEGER,&nbsp;--&nbsp;(inverse&nbsp;of&nbsp;q)&nbsp;mod&nbsp;p&nbsp;&nbsp; otherPrimeInfosOtherPrimeInfos&nbsp;OPTIONAL&nbsp;&nbsp; }&nbsp;&nbsp; 最后一个otherPrimeInfos是可选项，例子中没有该数据。 结构中包含了RSA密钥算法中用到的所有信息，每一项的具体定义可以参考PKCS#1。 &nbsp; 3 分析公钥 &nbsp;为了方便获取公钥，在私钥文件数据中起始包含了公钥信息： [html] view plain copy modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; publicExponent&nbsp;INTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp; 公钥的ASN.1结构也在PKCS#1中定义： [html] view plain copy RSAPublicKey&nbsp;::=&nbsp;SEQUENCE&nbsp;&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; &nbsp;&nbsp;publicExponentINTEGER&nbsp;--&nbsp;e&nbsp;&nbsp; &nbsp;}&nbsp;&nbsp; 可以使用openssl命令导出公钥文件pubkey.pem，使用文本工具打开公钥文件，pem头尾格式和私钥类似的标签： openssl pkey -in privatekey.der -inform DER -out pubkey.pem-pubout &nbsp; [html] view plain copy -----BEGIN&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp; MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQChHmaw+WUhWrStdxWBcAR39i2e&nbsp;&nbsp; 3yz+vfLiDALeTpWIH1jKiYtvw4nMg6453pXAJSvPn7mKaiGiC3USIt8qTL4eCPi9&nbsp;&nbsp; yNRDpZ1JRHI8M87VYB4c9KMk6IuVFiYyZ4MBTP87t89yeL9EOrAD0eFgi5fPx3g8&nbsp;&nbsp; b9QrmnyPhMVjP7ct+wIDAQAB&nbsp;&nbsp; -----END&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp; 继续分析公钥文件的ASN.1格式： openssl asn1parse -in pubkey.pem -i &nbsp; [html] view plain copy &nbsp;0:d=0&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;159&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;3:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;13&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;5:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:rsaEncryption&nbsp;&nbsp; 16:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;0&nbsp;prim:&nbsp;&nbsp;NULL&nbsp;&nbsp; 18:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;141&nbsp;prim:&nbsp;&nbsp;BIT&nbsp;STRING&nbsp;&nbsp; 但是这里显示格式和上边给出的PKCS#1格式不一致，其实这是x.509中的定义的格式，在X.509证书文件中就是使用这个格式封装公钥数据，其中BIT STRING的内容就是PKCS#1格式的公钥数据，并说明了使用的公钥算法rsaEncryption。 [html] view plain copy SubjectPublicKeyInfo&nbsp;::=SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;algorithmAlgorithmIdentifier{{SupportedAlgorithms}},&nbsp;&nbsp; &nbsp;&nbsp;subjectPublicKeyBIT&nbsp;STRING&nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; 我们可以进一步使用asn1parse工具解析出BIT STRING内容，首先确定该数据块偏移是18，然后使用参数-strparse指定位置,可以看到输出的数据和私钥文件中的是一样的。 asn1parse -in pubkey.pem -strparse 18 &nbsp;输出公钥ASN.1格式： [html] view plain copy &nbsp;&nbsp;&nbsp;0:d=0&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;137&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;3:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;135:d=1&nbsp;&nbsp;hl=2&nbsp;l=3&nbsp;&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp; &nbsp; 4 公私钥操作 分析完私钥和公钥格式，以及之间的关系。接下来我们将继续使用openssl的rsautl测试它们之间的加解密、签名、验证等操作。 测试文件test，内容“1234567890”。 &nbsp; 4.1加解密 &nbsp;1）公钥加密 openssl rsautl -encrypt -in test -out test.enc -inkey asn1pub.pem -pubin &nbsp;2）私钥解密 openssl rsautl -decrypt -in test.enc -out test.dec -inkey asn1enc.pem &nbsp; 比较test和test.dec两个文件结果相同。 &nbsp; 4.2签名验证 1）私钥签名 openssl rsautl -sign -in test -out test.sig-inkey asn1enc.pem &nbsp; 2）公钥验证 openssl rsautl -verify -in test.sig -out test.vfy -inkey asn1pub.pem -pubin &nbsp; 比较test和test.vfy连个文件应该相同。 阅读更多" />
<meta property="og:description" content="Openssl提供了强大证书功能，生成密钥对、证书，颁发证书、生成crl、验证证书、销毁证书等。本文将j介绍如何利用openssl的命令分析RSA私钥文件格式，同时也将简单介绍几种常见的私钥文件格式。 &nbsp; 1 生成私钥文件 openssl有多种方法生成私钥： genrsa生成RSA密钥。 req在生成req证书请求时同时产生密钥。 genpkey除了可以生成RSA密钥外，还可以生成DSA、DH密钥。 &nbsp;这里我使用genpkey命令生成RSA私钥文件，选择DES-EDE3-CBC算法进行加密，口令是1234： [plain] view plain copy openssl&nbsp;genpkey&nbsp;-algorithm&nbsp;RSA&nbsp;-out&nbsp;privatekey.pem&nbsp;-pass&nbsp;pass:1234&nbsp;-des-ede3-cbc&nbsp;&nbsp; 命令执行后输出私钥文件 privatekey.pem，默认输出为 PEM格式，密钥长度为1024，接下来使用文本工具直接打开该文件，可以看到如下内容：&nbsp; [html] view plain copy -----BEGINENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; MIICxjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIhrQ3ApYYe1ACAggA&nbsp;&nbsp; MBQGCCqGSIb3DQMHBAgyM5zYLuXOdQSCAoAFqnCRqkpoHJTY0BpLeekzjsuzdTOq&nbsp;&nbsp; DkgxJMi4WRt1rZNyHqarbhHCZGC9Lug/xbLW5e2ZtjYVJ+ljmFb4lUaAch4nAgoz&nbsp;&nbsp; m0J5YyrbFKppiqlk6vkS5hKfpKbWrx5hkQzMt6OsVEQFj2U+EvOI8SVgI6LkjNmh&nbsp;&nbsp; 7qokYxv9Inx9joM6agEUY9fXdAu53CyfjpneX95vxUHIn7hHmhxH7MYua619N7x+&nbsp;&nbsp; JVA65b3Kj45aH3cnY/kMAQ78EN9aLpqYXzn6j9GRdUd2JMuP0IrYlREw3/z8Qn68&nbsp;&nbsp; CwGXzGtkYnlt0xHdOG/tnmKWqBg1cY9uVx6g6JT1BUabqwxVODaMqaSsFr4o3xJo&nbsp;&nbsp; 3TTh8TswK0V/+3JLkXtasI7V8cRj2dksccGApujmB5eymU3XXTlX3iXs481I4kmz&nbsp;&nbsp; JOZHbqfGOpyzW6WqhMO+LebIkyIGMlCGRiJ3PNSQI9w6bfZ9FoqC6OfFKY1OEmBN&nbsp;&nbsp; 6ALtPc+cYXeO5Msx9mbakIYRbcjlVmelPsLyvAceW/09OG909turflvYaGnM+SKd&nbsp;&nbsp; KzWn2gFr3YwF57WZlX2jifYUUnjHVMZW7s/k6hgOxcEnvBOg4Ug/cKdNPUEB7tJx&nbsp;&nbsp; nvsR+odHypyjgyphLEP8UmEiz3/hnPV8lhLDAPV7fKaK+zDglKqQYF3KBLh55q6h&nbsp;&nbsp; PPe1HqahifK9EKqWOl7m1HhFPIZTex4clLy98rB3gyXnL0qx4+A7WD6uLJbU285j&nbsp;&nbsp; IWMNq3f1c80ZPrpbhT6hd6Z9zUwfYT6gTO9gIIe4d5KVmfjNaFwSls5zaI6x7AJp&nbsp;&nbsp; d/Xl/m1u469+J0rWyeY3D4wtahvZrKMXRrILtJ5OgkWPak2FTyMu/Hs/&nbsp;&nbsp; -----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; 私钥经过PEM编码后在文件头尾都添加了标签，用以说明当前的文件格式。从标签内容也可以看出私钥是加密的，因为有“ ENCRYPTED”。中间的私钥内容是经过BASE64编码的，这样方便私钥的传递，例如在网络上传输，数据复制粘贴。 &nbsp; 例子只是PEM文件格式的其中一种，以下是平时可能会碰到的PEM私钥格式： PKCS#8 私钥加密格式 [html] view plain copy -----BEGIN&nbsp;ENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; PKCS#8 私钥非加密格式 [html] view plain copy -----BEGIN&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----END&nbsp;PRIVATEKEY-----&nbsp;&nbsp; Openssl ASN格式 [html] view plain copy -----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; Proc-Type:&nbsp;4,ENCRYPTED&nbsp;&nbsp; DEK-Info:DES-EDE3-CBC,4D5D1AF13367D726&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; 除了以上几种，还有微软的PVK格式；以及DER编码格式，就是在使用PEM编码前的数据，由于没有密码保护，平时很少直接使用。 &nbsp; Openssl ASN格式在加密私钥数据时只能用MD5算法生成key，而且只迭代计算了1次。 所以从1.0.0开始Openssl把PKCS#8格式作为默认格式，可以为私钥文件提供更好的安全性和扩展性。 我们这里就针对PKCS#8格式的私钥进行讨论。 如果大家想要研究其他格式，可以使用以下命令： &nbsp;genrsa 生成ASN格式 &nbsp;rsa 生成或转换为PVK格式 [html] view plain copy openssl&nbsp;rsa&nbsp;-in&nbsp;privatekey.pem&nbsp;-out&nbsp;privatekey.pvk&nbsp;-outform&nbsp;PVK&nbsp;&nbsp; &nbsp;&nbsp; 2 分析私钥文件&nbsp; 使用asn1parse命令读取私钥ASN.1结构，其中–i表示输出使用缩进格式。 openssl asn1parse -i -in privatekey.pem&nbsp; [html] view plain copy &nbsp;0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;710&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;4:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;6:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBES2&nbsp;&nbsp; 17:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;51&nbsp;cons:&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 19:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;27&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 21:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp; 32:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;14&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 34:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp; 44:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;2&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp; 48:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;20&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 50:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp; 60:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp; 70:d=1&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;640&nbsp;prim:&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:&nbsp;&nbsp; 4F34F0CFF56B3E92D437C49559B1BD632BA2D8B22AF290B0E8EBB7F71C555115CED4DE87E3922A41436A20DA1DB01F1BD88EA3002E8AD4691C0B25F16AF4D196C2A96B99A1D49F704A21D3B81F8CC81C3F09412317B67F453151490D2573E1FD96D13BB55E7FCD4085ED0C4DD75EB1EFFC4ACE5431AFD708E6ECE5077BAB2B03965C6F2873C1DB5F475F861E9C04D61465C72A8A99DCF093190F746DD8959C0B0942E38A013B0FEC2D4A66F600EF75CE0326F3B4904C3128CB389204A1CC4F93EED7C8F2450603A42C6C16FB143FF4C9C01E714A43CC07B1F1B580A6C9DE4DC9B78CA0D5B874C75A0F56F6A55CFE4620F1AC639DCE4A8AF2BCBB69691DAF983BB26F6A6C859C371D1EBA7DA5C27FBDAC86C6529C48B32E3B89317FC7EBF03F9C105EAA1892437E9E789F0E2340979812A53CD1668EC07A45BBEAE088E7E27BB20B16C2D14280970BBF715D57005F194B97A1784E7BC563A0B84909A7EAB6C7E0BC6E2B467AA4009420D190617F93CD32FAEEE50003462DC8B26816040E891523E1375F339A3F05C43C9E90A4533BD4D3F75A2A33E60D91563542355D5ED1F46CF62594460694F459F0EC428BECE015F075895CFEB502EA22ECD9B53BF050B795074BE9A51194789F0B2970C21CCFE16284FB564F720C7899D5840362C48D248A50BAFA2720B0C1F7B417AD6EA183459BBB80679A85D96421C5AE3FA53A2135217F886759187123766914BB0169F6F9C3A36F1C46B6EB9300009A799D0F96C3E1FBE805F17A01FF2F5A9C941399E6130DBEE9825F4EB8937F2B8F0B3DE5F08644F3DC65028F2DE150D03D454AECFF9CAF26A00BB1B6D6D2C5255216E0A6769F14937618E31573811AAA464C3C42246A17DD70B1F77A87948FD5C7526D569BB8&nbsp;&nbsp; ASN.1结构输出格式说明： [html] view plain copy 0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;710&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; 0 表示节点在整个文件中的偏移长度 d=0 表示节点深度 hl=4&nbsp;表示节点头字节长度 l=710&nbsp;表示节点数据字节长度 cons 表示该节点为结构节点，表示包含子节点或者子结构数据 prim 表示该节点为原始节点，包含数据 SEQUENCE、OCTETSTRING等都是ASN.1中定义的数据类型，具体可以参考ASN.1格式说明。 &nbsp;最后一个节点OCTET STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [HEX DUMP]，就是加密后的私钥数据。 为了方便理解，下面给出相关的PKCS定义。 PCKS#8文件格式定义： [html] view plain copy PrivateKeyInfo&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKeyAlgorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKeyAlgorithmIdentifier,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKey,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attributes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0]&nbsp;&nbsp;IMPLICIT&nbsp;Attributes&nbsp;OPTIONAL&nbsp;}&nbsp;&nbsp;&nbsp; privateKey，加密后私钥数据，最后一个OCTET STRING数据块。 privateKeyAlgorithm，使用的私钥算法，详细格式在 PKCS#5&nbsp;2.0中的定义： [html] view plain copy PBES2-params&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyDerivationFunc&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-KDFs}},&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encryptionScheme&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-Encs}}&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}&nbsp;&nbsp; keyDerivationFunc 加密密钥生成函数，现在默认使用的是sha1，还包含了salt，迭代次数iterationCount： [html] view plain copy PBKDF2-params&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;salt&nbsp;CHOICE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specified&nbsp;OCTET&nbsp;STRING,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherSource&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-SaltSources}}&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterationCount&nbsp;INTEGER&nbsp;(1..MAX),&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyLength&nbsp;INTEGER&nbsp;(1..MAX)&nbsp;OPTIONAL,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prf&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-PRFs}}&nbsp;DEFAULT&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algid-hmacWithSHA1&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}&nbsp;&nbsp; [html] view plain copy 对应数据：&nbsp;&nbsp; &nbsp;&nbsp;19:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;27&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;21:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;32:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;14&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;34:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp; &nbsp;&nbsp;44:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;2&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp; encryptionScheme 加密算法，例子中使用的是des-ede3-cbc，该结构中还包含初始化向量iv。 [html] view plain copy 对应数据：&nbsp;&nbsp; &nbsp;&nbsp;48:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;20&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;50:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp; &nbsp;&nbsp;60:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp; 解密流程： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 按PKCS#8和PCKS#5定义从文件中解析出相关参数： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密密钥生成函数（KDF）PBKDF2； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密时使用的salt：7A61B055165A89CA，以及迭代次数iter：0x0800（2048次）； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密算法des-ede3-cbc，以及加密初始向量iv：110E8A184EFEAB9C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 解析出加密的私钥数据data，也就是最后一个OCTET STRING； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 生成加密密钥：key = KDF（pass（1234），salt，iter） &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 解密 des-ede3-cbc（key， iv， data） &nbsp; 这一解密过程可以使用openssl的pkey命令完成，执行完成后得到privatekey.der文件，这个是没有加密的私钥文件，数据是ASN.1格式，并使用DER编码。 Openssl pkey -in privatekey.pem -out privatekey.der-passin pass:1234 &nbsp;&nbsp; 然后再次分析密钥数据，由于输入是der格式，需要使用inform参数说明： openssl asn1parse -in privatekey.der -inform DER &nbsp; [html] view plain copy &nbsp;&nbsp;&nbsp;0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;604&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;1&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:00&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp; &nbsp;139:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;3&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp; &nbsp;144:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 9B2C9B7CD105AC851EC47E8FB0D541088489D59C5E4A8E88F15ADE1C5B953ABFEE154B39870FCD94B23247BBEF805A8C826FF413B239E8469E9F3404B949A643E1E2CCF9753822FD28345B7898148164DA2D858F672B52C7B3041F0A9F6FFFB97759D3C04AE3ED2E372E4ADD3A44202CE004D189566A81F19239649779F30DE9&nbsp;&nbsp; &nbsp;276:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;65&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; CE25257FDE50AFDAF926BDBEFE5A236C130F2714C5FC0C36A07B5AA5618E8F5039E313387C933A86EBDC2DEF8640069CB98B1D04C3E74B46C75F292A768083D5&nbsp;&nbsp; &nbsp;343:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;65&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; C8159573F6C413EAC0BB721B859A4B7920FF9DE151546CA28FDA3F43A0999C835DB9078AF5054CE503C4BC174ECB1F0C4DE033E116A296FD67B4158F869E628F&nbsp;&nbsp; &nbsp;410:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 7329855D7DD10DAD02EB85AD216331CEBA87088A2E60B462001D697262A1C5A647F07758631FCCDE7AFD321C519F8B121B05805C9D24A58510F4348728547B51&nbsp;&nbsp; &nbsp;476:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 53735D203EBDCD28CE35E003C69771FF155A47B92038BC0E993D07C1E70BEA9187D79263CC89E7666549FAC125E5E60F35B3DB2F78475BFE58F06D45AD7A05D5&nbsp;&nbsp; &nbsp;542:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 4F454C491EAE6CD85ED812D8A26AFD5FD0F6D7DD12AD6D20EDA8C2D257943928B2AE66FDE336F40370D9CC30B85EB2F20D3B4FDAB61D168FE7936CB6AB5E8FE2&nbsp;&nbsp; &nbsp;得到的数据与上次导出的格式是相同的，虽然看起来数据多，但是层次结构起始要简单，数据就是一个结构体（cons）SEQUENCE，包含9个整型的原始数据（prim）INTERGER，这个就是私钥结构，该 ASN.1结构在PKCS#1中定义如下： [html] view plain copy RSAPrivateKey&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; versionVersion,&nbsp;&nbsp; modulusINTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; publicExponentINTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp; privateExponentINTEGER,&nbsp;--&nbsp;d&nbsp;&nbsp; prime1INTEGER,&nbsp;--&nbsp;p&nbsp;&nbsp; prime2INTEGER,&nbsp;--&nbsp;q&nbsp;&nbsp; exponent1INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(p-1)&nbsp;&nbsp; exponent2INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(q-1)&nbsp;&nbsp; coefficientINTEGER,&nbsp;--&nbsp;(inverse&nbsp;of&nbsp;q)&nbsp;mod&nbsp;p&nbsp;&nbsp; otherPrimeInfosOtherPrimeInfos&nbsp;OPTIONAL&nbsp;&nbsp; }&nbsp;&nbsp; 最后一个otherPrimeInfos是可选项，例子中没有该数据。 结构中包含了RSA密钥算法中用到的所有信息，每一项的具体定义可以参考PKCS#1。 &nbsp; 3 分析公钥 &nbsp;为了方便获取公钥，在私钥文件数据中起始包含了公钥信息： [html] view plain copy modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; publicExponent&nbsp;INTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp; 公钥的ASN.1结构也在PKCS#1中定义： [html] view plain copy RSAPublicKey&nbsp;::=&nbsp;SEQUENCE&nbsp;&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; &nbsp;&nbsp;publicExponentINTEGER&nbsp;--&nbsp;e&nbsp;&nbsp; &nbsp;}&nbsp;&nbsp; 可以使用openssl命令导出公钥文件pubkey.pem，使用文本工具打开公钥文件，pem头尾格式和私钥类似的标签： openssl pkey -in privatekey.der -inform DER -out pubkey.pem-pubout &nbsp; [html] view plain copy -----BEGIN&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp; MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQChHmaw+WUhWrStdxWBcAR39i2e&nbsp;&nbsp; 3yz+vfLiDALeTpWIH1jKiYtvw4nMg6453pXAJSvPn7mKaiGiC3USIt8qTL4eCPi9&nbsp;&nbsp; yNRDpZ1JRHI8M87VYB4c9KMk6IuVFiYyZ4MBTP87t89yeL9EOrAD0eFgi5fPx3g8&nbsp;&nbsp; b9QrmnyPhMVjP7ct+wIDAQAB&nbsp;&nbsp; -----END&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp; 继续分析公钥文件的ASN.1格式： openssl asn1parse -in pubkey.pem -i &nbsp; [html] view plain copy &nbsp;0:d=0&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;159&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;3:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;13&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;5:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:rsaEncryption&nbsp;&nbsp; 16:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;0&nbsp;prim:&nbsp;&nbsp;NULL&nbsp;&nbsp; 18:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;141&nbsp;prim:&nbsp;&nbsp;BIT&nbsp;STRING&nbsp;&nbsp; 但是这里显示格式和上边给出的PKCS#1格式不一致，其实这是x.509中的定义的格式，在X.509证书文件中就是使用这个格式封装公钥数据，其中BIT STRING的内容就是PKCS#1格式的公钥数据，并说明了使用的公钥算法rsaEncryption。 [html] view plain copy SubjectPublicKeyInfo&nbsp;::=SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;algorithmAlgorithmIdentifier{{SupportedAlgorithms}},&nbsp;&nbsp; &nbsp;&nbsp;subjectPublicKeyBIT&nbsp;STRING&nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; 我们可以进一步使用asn1parse工具解析出BIT STRING内容，首先确定该数据块偏移是18，然后使用参数-strparse指定位置,可以看到输出的数据和私钥文件中的是一样的。 asn1parse -in pubkey.pem -strparse 18 &nbsp;输出公钥ASN.1格式： [html] view plain copy &nbsp;&nbsp;&nbsp;0:d=0&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;137&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;3:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;135:d=1&nbsp;&nbsp;hl=2&nbsp;l=3&nbsp;&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp; &nbsp; 4 公私钥操作 分析完私钥和公钥格式，以及之间的关系。接下来我们将继续使用openssl的rsautl测试它们之间的加解密、签名、验证等操作。 测试文件test，内容“1234567890”。 &nbsp; 4.1加解密 &nbsp;1）公钥加密 openssl rsautl -encrypt -in test -out test.enc -inkey asn1pub.pem -pubin &nbsp;2）私钥解密 openssl rsautl -decrypt -in test.enc -out test.dec -inkey asn1enc.pem &nbsp; 比较test和test.dec两个文件结果相同。 &nbsp; 4.2签名验证 1）私钥签名 openssl rsautl -sign -in test -out test.sig-inkey asn1enc.pem &nbsp; 2）公钥验证 openssl rsautl -verify -in test.sig -out test.vfy -inkey asn1pub.pem -pubin &nbsp; 比较test和test.vfy连个文件应该相同。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2014/01/17/d05240a652c63326e15064aeb92ee68a.html" />
<meta property="og:url" content="https://mlh.app/2014/01/17/d05240a652c63326e15064aeb92ee68a.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-01-17T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"Openssl提供了强大证书功能，生成密钥对、证书，颁发证书、生成crl、验证证书、销毁证书等。本文将j介绍如何利用openssl的命令分析RSA私钥文件格式，同时也将简单介绍几种常见的私钥文件格式。 &nbsp; 1 生成私钥文件 openssl有多种方法生成私钥： genrsa生成RSA密钥。 req在生成req证书请求时同时产生密钥。 genpkey除了可以生成RSA密钥外，还可以生成DSA、DH密钥。 &nbsp;这里我使用genpkey命令生成RSA私钥文件，选择DES-EDE3-CBC算法进行加密，口令是1234： [plain] view plain copy openssl&nbsp;genpkey&nbsp;-algorithm&nbsp;RSA&nbsp;-out&nbsp;privatekey.pem&nbsp;-pass&nbsp;pass:1234&nbsp;-des-ede3-cbc&nbsp;&nbsp; 命令执行后输出私钥文件 privatekey.pem，默认输出为 PEM格式，密钥长度为1024，接下来使用文本工具直接打开该文件，可以看到如下内容：&nbsp; [html] view plain copy -----BEGINENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; MIICxjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIhrQ3ApYYe1ACAggA&nbsp;&nbsp; MBQGCCqGSIb3DQMHBAgyM5zYLuXOdQSCAoAFqnCRqkpoHJTY0BpLeekzjsuzdTOq&nbsp;&nbsp; DkgxJMi4WRt1rZNyHqarbhHCZGC9Lug/xbLW5e2ZtjYVJ+ljmFb4lUaAch4nAgoz&nbsp;&nbsp; m0J5YyrbFKppiqlk6vkS5hKfpKbWrx5hkQzMt6OsVEQFj2U+EvOI8SVgI6LkjNmh&nbsp;&nbsp; 7qokYxv9Inx9joM6agEUY9fXdAu53CyfjpneX95vxUHIn7hHmhxH7MYua619N7x+&nbsp;&nbsp; JVA65b3Kj45aH3cnY/kMAQ78EN9aLpqYXzn6j9GRdUd2JMuP0IrYlREw3/z8Qn68&nbsp;&nbsp; CwGXzGtkYnlt0xHdOG/tnmKWqBg1cY9uVx6g6JT1BUabqwxVODaMqaSsFr4o3xJo&nbsp;&nbsp; 3TTh8TswK0V/+3JLkXtasI7V8cRj2dksccGApujmB5eymU3XXTlX3iXs481I4kmz&nbsp;&nbsp; JOZHbqfGOpyzW6WqhMO+LebIkyIGMlCGRiJ3PNSQI9w6bfZ9FoqC6OfFKY1OEmBN&nbsp;&nbsp; 6ALtPc+cYXeO5Msx9mbakIYRbcjlVmelPsLyvAceW/09OG909turflvYaGnM+SKd&nbsp;&nbsp; KzWn2gFr3YwF57WZlX2jifYUUnjHVMZW7s/k6hgOxcEnvBOg4Ug/cKdNPUEB7tJx&nbsp;&nbsp; nvsR+odHypyjgyphLEP8UmEiz3/hnPV8lhLDAPV7fKaK+zDglKqQYF3KBLh55q6h&nbsp;&nbsp; PPe1HqahifK9EKqWOl7m1HhFPIZTex4clLy98rB3gyXnL0qx4+A7WD6uLJbU285j&nbsp;&nbsp; IWMNq3f1c80ZPrpbhT6hd6Z9zUwfYT6gTO9gIIe4d5KVmfjNaFwSls5zaI6x7AJp&nbsp;&nbsp; d/Xl/m1u469+J0rWyeY3D4wtahvZrKMXRrILtJ5OgkWPak2FTyMu/Hs/&nbsp;&nbsp; -----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; 私钥经过PEM编码后在文件头尾都添加了标签，用以说明当前的文件格式。从标签内容也可以看出私钥是加密的，因为有“ ENCRYPTED”。中间的私钥内容是经过BASE64编码的，这样方便私钥的传递，例如在网络上传输，数据复制粘贴。 &nbsp; 例子只是PEM文件格式的其中一种，以下是平时可能会碰到的PEM私钥格式： PKCS#8 私钥加密格式 [html] view plain copy -----BEGIN&nbsp;ENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; PKCS#8 私钥非加密格式 [html] view plain copy -----BEGIN&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----END&nbsp;PRIVATEKEY-----&nbsp;&nbsp; Openssl ASN格式 [html] view plain copy -----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; Proc-Type:&nbsp;4,ENCRYPTED&nbsp;&nbsp; DEK-Info:DES-EDE3-CBC,4D5D1AF13367D726&nbsp;&nbsp; BASE64私钥内容&nbsp;&nbsp; -----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp; 除了以上几种，还有微软的PVK格式；以及DER编码格式，就是在使用PEM编码前的数据，由于没有密码保护，平时很少直接使用。 &nbsp; Openssl ASN格式在加密私钥数据时只能用MD5算法生成key，而且只迭代计算了1次。 所以从1.0.0开始Openssl把PKCS#8格式作为默认格式，可以为私钥文件提供更好的安全性和扩展性。 我们这里就针对PKCS#8格式的私钥进行讨论。 如果大家想要研究其他格式，可以使用以下命令： &nbsp;genrsa 生成ASN格式 &nbsp;rsa 生成或转换为PVK格式 [html] view plain copy openssl&nbsp;rsa&nbsp;-in&nbsp;privatekey.pem&nbsp;-out&nbsp;privatekey.pvk&nbsp;-outform&nbsp;PVK&nbsp;&nbsp; &nbsp;&nbsp; 2 分析私钥文件&nbsp; 使用asn1parse命令读取私钥ASN.1结构，其中–i表示输出使用缩进格式。 openssl asn1parse -i -in privatekey.pem&nbsp; [html] view plain copy &nbsp;0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;710&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;4:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;6:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBES2&nbsp;&nbsp; 17:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;51&nbsp;cons:&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 19:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;27&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 21:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp; 32:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;14&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 34:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp; 44:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;2&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp; 48:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;20&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; 50:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp; 60:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp; 70:d=1&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;640&nbsp;prim:&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:&nbsp;&nbsp; 4F34F0CFF56B3E92D437C49559B1BD632BA2D8B22AF290B0E8EBB7F71C555115CED4DE87E3922A41436A20DA1DB01F1BD88EA3002E8AD4691C0B25F16AF4D196C2A96B99A1D49F704A21D3B81F8CC81C3F09412317B67F453151490D2573E1FD96D13BB55E7FCD4085ED0C4DD75EB1EFFC4ACE5431AFD708E6ECE5077BAB2B03965C6F2873C1DB5F475F861E9C04D61465C72A8A99DCF093190F746DD8959C0B0942E38A013B0FEC2D4A66F600EF75CE0326F3B4904C3128CB389204A1CC4F93EED7C8F2450603A42C6C16FB143FF4C9C01E714A43CC07B1F1B580A6C9DE4DC9B78CA0D5B874C75A0F56F6A55CFE4620F1AC639DCE4A8AF2BCBB69691DAF983BB26F6A6C859C371D1EBA7DA5C27FBDAC86C6529C48B32E3B89317FC7EBF03F9C105EAA1892437E9E789F0E2340979812A53CD1668EC07A45BBEAE088E7E27BB20B16C2D14280970BBF715D57005F194B97A1784E7BC563A0B84909A7EAB6C7E0BC6E2B467AA4009420D190617F93CD32FAEEE50003462DC8B26816040E891523E1375F339A3F05C43C9E90A4533BD4D3F75A2A33E60D91563542355D5ED1F46CF62594460694F459F0EC428BECE015F075895CFEB502EA22ECD9B53BF050B795074BE9A51194789F0B2970C21CCFE16284FB564F720C7899D5840362C48D248A50BAFA2720B0C1F7B417AD6EA183459BBB80679A85D96421C5AE3FA53A2135217F886759187123766914BB0169F6F9C3A36F1C46B6EB9300009A799D0F96C3E1FBE805F17A01FF2F5A9C941399E6130DBEE9825F4EB8937F2B8F0B3DE5F08644F3DC65028F2DE150D03D454AECFF9CAF26A00BB1B6D6D2C5255216E0A6769F14937618E31573811AAA464C3C42246A17DD70B1F77A87948FD5C7526D569BB8&nbsp;&nbsp; ASN.1结构输出格式说明： [html] view plain copy 0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;710&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; 0 表示节点在整个文件中的偏移长度 d=0 表示节点深度 hl=4&nbsp;表示节点头字节长度 l=710&nbsp;表示节点数据字节长度 cons 表示该节点为结构节点，表示包含子节点或者子结构数据 prim 表示该节点为原始节点，包含数据 SEQUENCE、OCTETSTRING等都是ASN.1中定义的数据类型，具体可以参考ASN.1格式说明。 &nbsp;最后一个节点OCTET STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [HEX DUMP]，就是加密后的私钥数据。 为了方便理解，下面给出相关的PKCS定义。 PCKS#8文件格式定义： [html] view plain copy PrivateKeyInfo&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKeyAlgorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKeyAlgorithmIdentifier,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKey,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attributes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0]&nbsp;&nbsp;IMPLICIT&nbsp;Attributes&nbsp;OPTIONAL&nbsp;}&nbsp;&nbsp;&nbsp; privateKey，加密后私钥数据，最后一个OCTET STRING数据块。 privateKeyAlgorithm，使用的私钥算法，详细格式在 PKCS#5&nbsp;2.0中的定义： [html] view plain copy PBES2-params&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyDerivationFunc&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-KDFs}},&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encryptionScheme&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-Encs}}&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}&nbsp;&nbsp; keyDerivationFunc 加密密钥生成函数，现在默认使用的是sha1，还包含了salt，迭代次数iterationCount： [html] view plain copy PBKDF2-params&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;salt&nbsp;CHOICE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specified&nbsp;OCTET&nbsp;STRING,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherSource&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-SaltSources}}&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterationCount&nbsp;INTEGER&nbsp;(1..MAX),&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyLength&nbsp;INTEGER&nbsp;(1..MAX)&nbsp;OPTIONAL,&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prf&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-PRFs}}&nbsp;DEFAULT&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algid-hmacWithSHA1&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}&nbsp;&nbsp; [html] view plain copy 对应数据：&nbsp;&nbsp; &nbsp;&nbsp;19:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;27&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;21:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;32:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;14&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;34:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp; &nbsp;&nbsp;44:d=5&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;2&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp; encryptionScheme 加密算法，例子中使用的是des-ede3-cbc，该结构中还包含初始化向量iv。 [html] view plain copy 对应数据：&nbsp;&nbsp; &nbsp;&nbsp;48:d=3&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;20&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;50:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp; &nbsp;&nbsp;60:d=4&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;8&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp; 解密流程： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 按PKCS#8和PCKS#5定义从文件中解析出相关参数： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密密钥生成函数（KDF）PBKDF2； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密时使用的salt：7A61B055165A89CA，以及迭代次数iter：0x0800（2048次）； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密算法des-ede3-cbc，以及加密初始向量iv：110E8A184EFEAB9C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 解析出加密的私钥数据data，也就是最后一个OCTET STRING； &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 生成加密密钥：key = KDF（pass（1234），salt，iter） &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 解密 des-ede3-cbc（key， iv， data） &nbsp; 这一解密过程可以使用openssl的pkey命令完成，执行完成后得到privatekey.der文件，这个是没有加密的私钥文件，数据是ASN.1格式，并使用DER编码。 Openssl pkey -in privatekey.pem -out privatekey.der-passin pass:1234 &nbsp;&nbsp; 然后再次分析密钥数据，由于输入是der格式，需要使用inform参数说明： openssl asn1parse -in privatekey.der -inform DER &nbsp; [html] view plain copy &nbsp;&nbsp;&nbsp;0:d=0&nbsp;&nbsp;hl=4&nbsp;l=&nbsp;604&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;1&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:00&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp; &nbsp;139:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;3&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp; &nbsp;144:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 9B2C9B7CD105AC851EC47E8FB0D541088489D59C5E4A8E88F15ADE1C5B953ABFEE154B39870FCD94B23247BBEF805A8C826FF413B239E8469E9F3404B949A643E1E2CCF9753822FD28345B7898148164DA2D858F672B52C7B3041F0A9F6FFFB97759D3C04AE3ED2E372E4ADD3A44202CE004D189566A81F19239649779F30DE9&nbsp;&nbsp; &nbsp;276:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;65&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; CE25257FDE50AFDAF926BDBEFE5A236C130F2714C5FC0C36A07B5AA5618E8F5039E313387C933A86EBDC2DEF8640069CB98B1D04C3E74B46C75F292A768083D5&nbsp;&nbsp; &nbsp;343:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;65&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; C8159573F6C413EAC0BB721B859A4B7920FF9DE151546CA28FDA3F43A0999C835DB9078AF5054CE503C4BC174ECB1F0C4DE033E116A296FD67B4158F869E628F&nbsp;&nbsp; &nbsp;410:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 7329855D7DD10DAD02EB85AD216331CEBA87088A2E60B462001D697262A1C5A647F07758631FCCDE7AFD321C519F8B121B05805C9D24A58510F4348728547B51&nbsp;&nbsp; &nbsp;476:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 53735D203EBDCD28CE35E003C69771FF155A47B92038BC0E993D07C1E70BEA9187D79263CC89E7666549FAC125E5E60F35B3DB2F78475BFE58F06D45AD7A05D5&nbsp;&nbsp; &nbsp;542:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;64&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; 4F454C491EAE6CD85ED812D8A26AFD5FD0F6D7DD12AD6D20EDA8C2D257943928B2AE66FDE336F40370D9CC30B85EB2F20D3B4FDAB61D168FE7936CB6AB5E8FE2&nbsp;&nbsp; &nbsp;得到的数据与上次导出的格式是相同的，虽然看起来数据多，但是层次结构起始要简单，数据就是一个结构体（cons）SEQUENCE，包含9个整型的原始数据（prim）INTERGER，这个就是私钥结构，该 ASN.1结构在PKCS#1中定义如下： [html] view plain copy RSAPrivateKey&nbsp;::=&nbsp;SEQUENCE&nbsp;{&nbsp;&nbsp; versionVersion,&nbsp;&nbsp; modulusINTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; publicExponentINTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp; privateExponentINTEGER,&nbsp;--&nbsp;d&nbsp;&nbsp; prime1INTEGER,&nbsp;--&nbsp;p&nbsp;&nbsp; prime2INTEGER,&nbsp;--&nbsp;q&nbsp;&nbsp; exponent1INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(p-1)&nbsp;&nbsp; exponent2INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(q-1)&nbsp;&nbsp; coefficientINTEGER,&nbsp;--&nbsp;(inverse&nbsp;of&nbsp;q)&nbsp;mod&nbsp;p&nbsp;&nbsp; otherPrimeInfosOtherPrimeInfos&nbsp;OPTIONAL&nbsp;&nbsp; }&nbsp;&nbsp; 最后一个otherPrimeInfos是可选项，例子中没有该数据。 结构中包含了RSA密钥算法中用到的所有信息，每一项的具体定义可以参考PKCS#1。 &nbsp; 3 分析公钥 &nbsp;为了方便获取公钥，在私钥文件数据中起始包含了公钥信息： [html] view plain copy modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; publicExponent&nbsp;INTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp; 公钥的ASN.1结构也在PKCS#1中定义： [html] view plain copy RSAPublicKey&nbsp;::=&nbsp;SEQUENCE&nbsp;&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp; &nbsp;&nbsp;publicExponentINTEGER&nbsp;--&nbsp;e&nbsp;&nbsp; &nbsp;}&nbsp;&nbsp; 可以使用openssl命令导出公钥文件pubkey.pem，使用文本工具打开公钥文件，pem头尾格式和私钥类似的标签： openssl pkey -in privatekey.der -inform DER -out pubkey.pem-pubout &nbsp; [html] view plain copy -----BEGIN&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp; MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQChHmaw+WUhWrStdxWBcAR39i2e&nbsp;&nbsp; 3yz+vfLiDALeTpWIH1jKiYtvw4nMg6453pXAJSvPn7mKaiGiC3USIt8qTL4eCPi9&nbsp;&nbsp; yNRDpZ1JRHI8M87VYB4c9KMk6IuVFiYyZ4MBTP87t89yeL9EOrAD0eFgi5fPx3g8&nbsp;&nbsp; b9QrmnyPhMVjP7ct+wIDAQAB&nbsp;&nbsp; -----END&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp; 继续分析公钥文件的ASN.1格式： openssl asn1parse -in pubkey.pem -i &nbsp; [html] view plain copy &nbsp;0:d=0&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;159&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;3:d=1&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;13&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;5:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;9&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:rsaEncryption&nbsp;&nbsp; 16:d=2&nbsp;&nbsp;hl=2&nbsp;l=&nbsp;&nbsp;&nbsp;0&nbsp;prim:&nbsp;&nbsp;NULL&nbsp;&nbsp; 18:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;141&nbsp;prim:&nbsp;&nbsp;BIT&nbsp;STRING&nbsp;&nbsp; 但是这里显示格式和上边给出的PKCS#1格式不一致，其实这是x.509中的定义的格式，在X.509证书文件中就是使用这个格式封装公钥数据，其中BIT STRING的内容就是PKCS#1格式的公钥数据，并说明了使用的公钥算法rsaEncryption。 [html] view plain copy SubjectPublicKeyInfo&nbsp;::=SEQUENCE&nbsp;{&nbsp;&nbsp; &nbsp;&nbsp;algorithmAlgorithmIdentifier{{SupportedAlgorithms}},&nbsp;&nbsp; &nbsp;&nbsp;subjectPublicKeyBIT&nbsp;STRING&nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; 我们可以进一步使用asn1parse工具解析出BIT STRING内容，首先确定该数据块偏移是18，然后使用参数-strparse指定位置,可以看到输出的数据和私钥文件中的是一样的。 asn1parse -in pubkey.pem -strparse 18 &nbsp;输出公钥ASN.1格式： [html] view plain copy &nbsp;&nbsp;&nbsp;0:d=0&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;137&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;3:d=1&nbsp;&nbsp;hl=3&nbsp;l=&nbsp;129&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp; A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;135:d=1&nbsp;&nbsp;hl=2&nbsp;l=3&nbsp;&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp; &nbsp; 4 公私钥操作 分析完私钥和公钥格式，以及之间的关系。接下来我们将继续使用openssl的rsautl测试它们之间的加解密、签名、验证等操作。 测试文件test，内容“1234567890”。 &nbsp; 4.1加解密 &nbsp;1）公钥加密 openssl rsautl -encrypt -in test -out test.enc -inkey asn1pub.pem -pubin &nbsp;2）私钥解密 openssl rsautl -decrypt -in test.enc -out test.dec -inkey asn1enc.pem &nbsp; 比较test和test.dec两个文件结果相同。 &nbsp; 4.2签名验证 1）私钥签名 openssl rsautl -sign -in test -out test.sig-inkey asn1enc.pem &nbsp; 2）公钥验证 openssl rsautl -verify -in test.sig -out test.vfy -inkey asn1pub.pem -pubin &nbsp; 比较test和test.vfy连个文件应该相同。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2014/01/17/d05240a652c63326e15064aeb92ee68a.html","headline":"使用openssl命令剖析RSA私钥文件格式","dateModified":"2014-01-17T00:00:00+08:00","datePublished":"2014-01-17T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2014/01/17/d05240a652c63326e15064aeb92ee68a.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用openssl命令剖析RSA私钥文件格式</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views">
   Openssl提供了强大证书功能，生成密钥对、证书，颁发证书、生成crl、验证证书、销毁证书等。本文将j介绍如何利用openssl的命令分析RSA私钥文件格式，同时也将简单介绍几种常见的私钥文件格式。 
  <p>&nbsp;</p> 
  <h2><a name="t0"></a>1 生成私钥文件</h2> 
  <p>openssl有多种方法生成私钥：</p> 
  <ul>
   <li>genrsa生成RSA密钥。</li>
   <li>req在生成req证书请求时同时产生密钥。</li>
   <li>genpkey除了可以生成RSA密钥外，还可以生成DSA、DH密钥。</li>
  </ul>
  <p>&nbsp;这里我使用genpkey命令生成RSA私钥文件，选择DES-EDE3-CBC算法进行加密，口令是1234：</p> 
  <div class="dp-highlighter bg_plain"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[plain]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol start="1">
    <li class="alt"><span><span>openssl&nbsp;genpkey&nbsp;-algorithm&nbsp;RSA&nbsp;-out&nbsp;privatekey.pem&nbsp;-pass&nbsp;pass:1234&nbsp;-des-ede3-cbc&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> 
  <br>
  <br> 命令执行后输出私钥文件
  <strong>privatekey.pem</strong>，默认输出为
  <strong>PEM</strong>格式，密钥长度为1024，接下来使用文本工具直接打开该文件，可以看到如下内容：&nbsp; 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>-----BEGINENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></span></li>
    <li><span>MIICxjBABgkqhkiG9w0BBQ0wMzAbBgkqhkiG9w0BBQwwDgQIhrQ3ApYYe1ACAggA&nbsp;&nbsp;</span></li>
    <li class="alt"><span>MBQGCCqGSIb3DQMHBAgyM5zYLuXOdQSCAoAFqnCRqkpoHJTY0BpLeekzjsuzdTOq&nbsp;&nbsp;</span></li>
    <li><span>DkgxJMi4WRt1rZNyHqarbhHCZGC9Lug/xbLW5e2ZtjYVJ+ljmFb4lUaAch4nAgoz&nbsp;&nbsp;</span></li>
    <li class="alt"><span>m0J5YyrbFKppiqlk6vkS5hKfpKbWrx5hkQzMt6OsVEQFj2U+EvOI8SVgI6LkjNmh&nbsp;&nbsp;</span></li>
    <li><span>7qokYxv9Inx9joM6agEUY9fXdAu53CyfjpneX95vxUHIn7hHmhxH7MYua619N7x+&nbsp;&nbsp;</span></li>
    <li class="alt"><span>JVA65b3Kj45aH3cnY/kMAQ78EN9aLpqYXzn6j9GRdUd2JMuP0IrYlREw3/z8Qn68&nbsp;&nbsp;</span></li>
    <li><span>CwGXzGtkYnlt0xHdOG/tnmKWqBg1cY9uVx6g6JT1BUabqwxVODaMqaSsFr4o3xJo&nbsp;&nbsp;</span></li>
    <li class="alt"><span>3TTh8TswK0V/+3JLkXtasI7V8cRj2dksccGApujmB5eymU3XXTlX3iXs481I4kmz&nbsp;&nbsp;</span></li>
    <li><span>JOZHbqfGOpyzW6WqhMO+LebIkyIGMlCGRiJ3PNSQI9w6bfZ9FoqC6OfFKY1OEmBN&nbsp;&nbsp;</span></li>
    <li class="alt"><span>6ALtPc+cYXeO5Msx9mbakIYRbcjlVmelPsLyvAceW/09OG909turflvYaGnM+SKd&nbsp;&nbsp;</span></li>
    <li><span>KzWn2gFr3YwF57WZlX2jifYUUnjHVMZW7s/k6hgOxcEnvBOg4Ug/cKdNPUEB7tJx&nbsp;&nbsp;</span></li>
    <li class="alt"><span>nvsR+odHypyjgyphLEP8UmEiz3/hnPV8lhLDAPV7fKaK+zDglKqQYF3KBLh55q6h&nbsp;&nbsp;</span></li>
    <li><span>PPe1HqahifK9EKqWOl7m1HhFPIZTex4clLy98rB3gyXnL0qx4+A7WD6uLJbU285j&nbsp;&nbsp;</span></li>
    <li class="alt"><span>IWMNq3f1c80ZPrpbhT6hd6Z9zUwfYT6gTO9gIIe4d5KVmfjNaFwSls5zaI6x7AJp&nbsp;&nbsp;</span></li>
    <li><span>d/Xl/m1u469+J0rWyeY3D4wtahvZrKMXRrILtJ5OgkWPak2FTyMu/Hs/&nbsp;&nbsp;</span></li>
    <li class="alt"><span>-----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br> 私钥经过PEM编码后在文件头尾都添加了标签，用以说明当前的文件格式。从标签内容也可以看出私钥是加密的，因为有“
  <span style="color:#FF0000;">ENCRYPTED</span>”。中间的私钥内容是经过BASE64编码的，这样方便私钥的传递，例如在网络上传输，数据复制粘贴。 
  <p>&nbsp;</p> 
  <p>例子只是PEM文件格式的其中一种，以下是平时可能会碰到的PEM私钥格式：</p> 
  <p><strong>PKCS#8 私钥加密格式</strong></p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>-----BEGIN&nbsp;ENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></span></li>
    <li><span>BASE64私钥内容&nbsp;&nbsp;</span></li>
    <li class="alt"><span>-----ENDENCRYPTED&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br>
  <strong>PKCS#8 私钥非加密格式</strong>
  <br>
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></span></li>
    <li><span>BASE64私钥内容&nbsp;&nbsp;</span></li>
    <li class="alt"><span>-----END&nbsp;PRIVATEKEY-----&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <p><strong>Openssl ASN格式</strong></p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></span></li>
    <li><span>Proc-Type:&nbsp;4,ENCRYPTED&nbsp;&nbsp;</span></li>
    <li class="alt"><span>DEK-Info:DES-EDE3-CBC,4D5D1AF13367D726&nbsp;&nbsp;</span></li>
    <li><span>BASE64私钥内容&nbsp;&nbsp;</span></li>
    <li class="alt"><span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <p><br></p> 
  <p>除了以上几种，还有微软的PVK格式；以及DER编码格式，就是在使用PEM编码前的数据，由于没有密码保护，平时很少直接使用。</p> 
  <p>&nbsp;</p> 
  <p>Openssl ASN格式在加密私钥数据时只能用MD5算法生成key，而且只迭代计算了1次。</p> 
  <p>所以从1.0.0开始Openssl把PKCS#8格式作为默认格式，可以为私钥文件提供更好的安全性和扩展性。</p> 
  <p>我们这里就针对PKCS#8格式的私钥进行讨论。 如果大家想要研究其他格式，可以使用以下命令：</p> 
  <p>&nbsp;<strong>genrsa </strong>生成ASN格式</p> 
  <p>&nbsp;<strong>rsa </strong>生成或转换为PVK格式</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>openssl&nbsp;rsa&nbsp;-in&nbsp;privatekey.pem&nbsp;-out&nbsp;privatekey.pvk&nbsp;-outform&nbsp;PVK&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> &nbsp;&nbsp; 
  <h2><a name="t1"></a>2 分析私钥文件&nbsp;</h2> 
  <p>使用asn1parse命令读取私钥ASN.1结构，其中–i表示输出使用缩进格式。</p> 
  <p><span style="background-color:rgb(192,192,192);"><strong>openssl asn1parse -i -in privatekey.pem&nbsp;</strong></span></p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>&nbsp;</span><span class="attribute">0:d</span><span>=</span><span class="attribute-value">0</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">710</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;<span class="attribute">4:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">64</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>&nbsp;<span class="attribute">6:d</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">9</span><span>&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBES2&nbsp;&nbsp;</span></span></li>
    <li><span><span class="attribute">17:d</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">51</span><span>&nbsp;cons:&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span><span class="attribute">19:d</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">27</span><span>&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li><span><span class="attribute">21:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">9</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span><span class="attribute">32:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">14</span><span>&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li><span><span class="attribute">34:d</span><span>=</span><span class="attribute-value">5</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">8</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span><span class="attribute">44:d</span><span>=</span><span class="attribute-value">5</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">2</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp;</span></span></li>
    <li><span><span class="attribute">48:d</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">20</span><span>&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span><span class="attribute">50:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">8</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp;</span></span></li>
    <li><span><span class="attribute">60:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">8</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span><span class="attribute">70:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">640</span><span>&nbsp;prim:&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:&nbsp;&nbsp;</span></span></li>
    <li><span>4F34F0CFF56B3E92D437C49559B1BD632BA2D8B22AF290B0E8EBB7F71C555115CED4DE87E3922A41436A20DA1DB01F1BD88EA3002E8AD4691C0B25F16AF4D196C2A96B99A1D49F704A21D3B81F8CC81C3F09412317B67F453151490D2573E1FD96D13BB55E7FCD4085ED0C4DD75EB1EFFC4ACE5431AFD708E6ECE5077BAB2B03965C6F2873C1DB5F475F861E9C04D61465C72A8A99DCF093190F746DD8959C0B0942E38A013B0FEC2D4A66F600EF75CE0326F3B4904C3128CB389204A1CC4F93EED7C8F2450603A42C6C16FB143FF4C9C01E714A43CC07B1F1B580A6C9DE4DC9B78CA0D5B874C75A0F56F6A55CFE4620F1AC639DCE4A8AF2BCBB69691DAF983BB26F6A6C859C371D1EBA7DA5C27FBDAC86C6529C48B32E3B89317FC7EBF03F9C105EAA1892437E9E789F0E2340979812A53CD1668EC07A45BBEAE088E7E27BB20B16C2D14280970BBF715D57005F194B97A1784E7BC563A0B84909A7EAB6C7E0BC6E2B467AA4009420D190617F93CD32FAEEE50003462DC8B26816040E891523E1375F339A3F05C43C9E90A4533BD4D3F75A2A33E60D91563542355D5ED1F46CF62594460694F459F0EC428BECE015F075895CFEB502EA22ECD9B53BF050B795074BE9A51194789F0B2970C21CCFE16284FB564F720C7899D5840362C48D248A50BAFA2720B0C1F7B417AD6EA183459BBB80679A85D96421C5AE3FA53A2135217F886759187123766914BB0169F6F9C3A36F1C46B6EB9300009A799D0F96C3E1FBE805F17A01FF2F5A9C941399E6130DBEE9825F4EB8937F2B8F0B3DE5F08644F3DC65028F2DE150D03D454AECFF9CAF26A00BB1B6D6D2C5255216E0A6769F14937618E31573811AAA464C3C42246A17DD70B1F77A87948FD5C7526D569BB8&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br>
  <p>ASN.1结构输出格式说明：</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span class="attribute">0:d</span><span>=</span><span class="attribute-value">0</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">710</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> 
  <br>
  <strong>0 </strong>表示节点在整个文件中的偏移长度
  <br>
  <p><strong>d=0 </strong>表示节点深度</p> 
  <p><strong>hl=4&nbsp;</strong>表示节点头字节长度</p> 
  <p><strong>l=710&nbsp;</strong>表示节点数据字节长度</p> 
  <p><strong>cons </strong>表示该节点为结构节点，表示包含子节点或者子结构数据</p> 
  <p><strong>prim </strong>表示该节点为原始节点，包含数据</p> 
  <p><strong>SEQUENCE</strong>、<strong>OCTETSTRING</strong>等都是ASN.1中定义的数据类型，具体可以参考ASN.1格式说明。</p> 
  <p>&nbsp;最后一个节点OCTET STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [HEX DUMP]，就是加密后的私钥数据。</p> 
  <p><br></p> 
  <p>为了方便理解，下面给出相关的PKCS定义。</p> 
  <p>PCKS#8文件格式定义：</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>PrivateKeyInfo&nbsp;</span><span class="attribute">::</span><span>=&nbsp;</span><span class="attribute-value">SEQUENCE</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Version,&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKeyAlgorithm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKeyAlgorithmIdentifier,&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privateKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKey,&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attributes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0]&nbsp;&nbsp;IMPLICIT&nbsp;Attributes&nbsp;OPTIONAL&nbsp;}&nbsp;&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <p><strong><br></strong></p> 
  <p><strong><span style="font-size:12px;">privateKey</span></strong>，加密后私钥数据，最后一个OCTET STRING数据块。</p> 
  <br>
  <strong><span style="font-size:12px;">privateKeyAlgorithm</span>，</strong>使用的私钥算法，详细格式在
  <strong>PKCS#5&nbsp;2.0</strong>中的定义： 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>PBES2-params&nbsp;</span><span class="attribute">::</span><span>=&nbsp;</span><span class="attribute-value">SEQUENCE</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyDerivationFunc&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-KDFs}},&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encryptionScheme&nbsp;AlgorithmIdentifier&nbsp;{{PBES2-Encs}}&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <p><strong><br></strong></p> 
  <p><strong><span style="font-size:12px;">keyDerivationFunc</span></strong></p> 
  <p>加密密钥生成函数，现在默认使用的是sha1，还包含了salt，迭代次数iterationCount：<br></p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>PBKDF2-params&nbsp;</span><span class="attribute">::</span><span>=&nbsp;</span><span class="attribute-value">SEQUENCE</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;salt&nbsp;CHOICE&nbsp;{&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specified&nbsp;OCTET&nbsp;STRING,&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherSource&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-SaltSources}}&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterationCount&nbsp;INTEGER&nbsp;(1..MAX),&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyLength&nbsp;INTEGER&nbsp;(1..MAX)&nbsp;OPTIONAL,&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prf&nbsp;AlgorithmIdentifier&nbsp;{{PBKDF2-PRFs}}&nbsp;DEFAULT&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algid-hmacWithSHA1&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>对应数据：&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;<span class="attribute">19:d</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">27</span><span>&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>&nbsp;&nbsp;<span class="attribute">21:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">9</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:PBKDF2&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;<span class="attribute">32:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">14</span><span>&nbsp;cons:&nbsp;&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>&nbsp;&nbsp;<span class="attribute">34:d</span><span>=</span><span class="attribute-value">5</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">8</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:7A61B055165A89CA&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;<span class="attribute">44:d</span><span>=</span><span class="attribute-value">5</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">2</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:0800&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> 
  <strong><span style="font-size:12px;">encryptionScheme</span></strong> 
  <p>加密算法，例子中使用的是des-ede3-cbc，该结构中还包含初始化向量iv。</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>对应数据：&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;<span class="attribute">48:d</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">20</span><span>&nbsp;cons:&nbsp;&nbsp;&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>&nbsp;&nbsp;<span class="attribute">50:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">8</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:des-ede3-cbc&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;<span class="attribute">60:d</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">8</span><span>&nbsp;prim:&nbsp;&nbsp;&nbsp;&nbsp;OCTET&nbsp;STRING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[HEX&nbsp;DUMP]:110E8A184EFEAB9C&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> 
  <br>
  <p>解密流程：</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 按PKCS#8和PCKS#5定义从文件中解析出相关参数：</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密密钥生成函数（KDF）PBKDF2；</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密时使用的salt：7A61B055165A89CA，以及迭代次数iter：0x0800（2048次）；</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;加密算法des-ede3-cbc，以及加密初始向量iv：110E8A184EFEAB9C</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 解析出加密的私钥数据data，也就是最后一个OCTET STRING；</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 生成加密密钥：key = KDF（pass（1234），salt，iter）</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 解密 des-ede3-cbc（key， iv， data）</p> 
  <p>&nbsp;</p> 
  <p>这一解密过程可以使用openssl的pkey命令完成，执行完成后得到privatekey.der文件，这个是没有加密的私钥文件，数据是ASN.1格式，并使用DER编码。</p> 
  <p><span style="background-color:rgb(204,204,204);">Openssl pkey -in privatekey.pem -out privatekey.der-passin pass:1234</span></p> 
  <p>&nbsp;&nbsp;</p> 
  <p>然后再次分析密钥数据，由于输入是der格式，需要使用inform参数说明：</p> 
  <p><span style="background-color:rgb(204,204,204);">openssl asn1parse -in privatekey.der -inform DER</span></p> 
  <p>&nbsp;</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>&nbsp;&nbsp;&nbsp;</span><span class="attribute">0:d</span><span>=</span><span class="attribute-value">0</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">4</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">604</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;&nbsp;<span class="attribute">4:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">1</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:00&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>&nbsp;&nbsp;&nbsp;<span class="attribute">7:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">129</span><span>&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li><span>A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;<span class="attribute">139:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">3</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;<span class="attribute">144:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">129</span><span>&nbsp;prim:INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>9B2C9B7CD105AC851EC47E8FB0D541088489D59C5E4A8E88F15ADE1C5B953ABFEE154B39870FCD94B23247BBEF805A8C826FF413B239E8469E9F3404B949A643E1E2CCF9753822FD28345B7898148164DA2D858F672B52C7B3041F0A9F6FFFB97759D3C04AE3ED2E372E4ADD3A44202CE004D189566A81F19239649779F30DE9&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;<span class="attribute">276:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">65</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>CE25257FDE50AFDAF926BDBEFE5A236C130F2714C5FC0C36A07B5AA5618E8F5039E313387C933A86EBDC2DEF8640069CB98B1D04C3E74B46C75F292A768083D5&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;<span class="attribute">343:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">65</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>C8159573F6C413EAC0BB721B859A4B7920FF9DE151546CA28FDA3F43A0999C835DB9078AF5054CE503C4BC174ECB1F0C4DE033E116A296FD67B4158F869E628F&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;<span class="attribute">410:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">64</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>7329855D7DD10DAD02EB85AD216331CEBA87088A2E60B462001D697262A1C5A647F07758631FCCDE7AFD321C519F8B121B05805C9D24A58510F4348728547B51&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;<span class="attribute">476:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">64</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>53735D203EBDCD28CE35E003C69771FF155A47B92038BC0E993D07C1E70BEA9187D79263CC89E7666549FAC125E5E60F35B3DB2F78475BFE58F06D45AD7A05D5&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;<span class="attribute">542:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">64</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>4F454C491EAE6CD85ED812D8A26AFD5FD0F6D7DD12AD6D20EDA8C2D257943928B2AE66FDE336F40370D9CC30B85EB2F20D3B4FDAB61D168FE7936CB6AB5E8FE2&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <p>&nbsp;得到的数据与上次导出的格式是相同的，虽然看起来数据多，但是层次结构起始要简单，数据就是一个结构体（cons）SEQUENCE，包含9个整型的原始数据（prim）INTERGER，这个就是私钥结构，该 ASN.1结构在PKCS#1中定义如下：</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>RSAPrivateKey&nbsp;</span><span class="attribute">::</span><span>=&nbsp;</span><span class="attribute-value">SEQUENCE</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li>
    <li><span>versionVersion,&nbsp;&nbsp;</span></li>
    <li class="alt"><span>modulusINTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp;</span></li>
    <li><span>publicExponentINTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp;</span></li>
    <li class="alt"><span>privateExponentINTEGER,&nbsp;--&nbsp;d&nbsp;&nbsp;</span></li>
    <li><span>prime1INTEGER,&nbsp;--&nbsp;p&nbsp;&nbsp;</span></li>
    <li class="alt"><span>prime2INTEGER,&nbsp;--&nbsp;q&nbsp;&nbsp;</span></li>
    <li><span>exponent1INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(p-1)&nbsp;&nbsp;</span></li>
    <li class="alt"><span>exponent2INTEGER,&nbsp;--&nbsp;d&nbsp;mod&nbsp;(q-1)&nbsp;&nbsp;</span></li>
    <li><span>coefficientINTEGER,&nbsp;--&nbsp;(inverse&nbsp;of&nbsp;q)&nbsp;mod&nbsp;p&nbsp;&nbsp;</span></li>
    <li class="alt"><span>otherPrimeInfosOtherPrimeInfos&nbsp;OPTIONAL&nbsp;&nbsp;</span></li>
    <li><span>}&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br>
  <p>最后一个otherPrimeInfos是可选项，例子中没有该数据。</p> 
  <p>结构中包含了RSA密钥算法中用到的所有信息，每一项的具体定义可以参考PKCS#1。</p> 
  <p>&nbsp;</p> 
  <h2><a name="t2"></a>3 分析公钥</h2> 
  <p>&nbsp;为了方便获取公钥，在私钥文件数据中起始包含了公钥信息：</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp;</span></span></li>
    <li><span>publicExponent&nbsp;INTEGER,&nbsp;--&nbsp;e&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br> 公钥的ASN.1结构也在PKCS#1中定义： 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>RSAPublicKey&nbsp;</span><span class="attribute">::</span><span>=&nbsp;</span><span class="attribute-value">SEQUENCE</span><span>&nbsp;&nbsp;{&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;modulus&nbsp;INTEGER,&nbsp;--&nbsp;n&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;publicExponentINTEGER&nbsp;--&nbsp;e&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;}&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br>
  <p>可以使用openssl命令导出公钥文件pubkey.pem，使用文本工具打开公钥文件，pem头尾格式和私钥类似的标签：</p> 
  <p><span style="background-color:rgb(204,204,204);">openssl pkey -in privatekey.der -inform DER -out pubkey.pem-pubout</span></p> 
  <p>&nbsp;</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>-----BEGIN&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp;</span></span></li>
    <li><span>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQChHmaw+WUhWrStdxWBcAR39i2e&nbsp;&nbsp;</span></li>
    <li class="alt"><span>3yz+vfLiDALeTpWIH1jKiYtvw4nMg6453pXAJSvPn7mKaiGiC3USIt8qTL4eCPi9&nbsp;&nbsp;</span></li>
    <li><span>yNRDpZ1JRHI8M87VYB4c9KMk6IuVFiYyZ4MBTP87t89yeL9EOrAD0eFgi5fPx3g8&nbsp;&nbsp;</span></li>
    <li class="alt"><span>b9QrmnyPhMVjP7ct+wIDAQAB&nbsp;&nbsp;</span></li>
    <li><span>-----END&nbsp;PUBLIC&nbsp;KEY-----&nbsp;&nbsp;</span></li>
   </ol>
  </div> 
  <br>
  <p>继续分析公钥文件的ASN.1格式：</p> 
  <p>openssl asn1parse -in pubkey.pem -i</p> 
  <p>&nbsp;</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>&nbsp;</span><span class="attribute">0:d</span><span>=</span><span class="attribute-value">0</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">159</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;<span class="attribute">3:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;</span><span class="attribute-value">13</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>&nbsp;<span class="attribute">5:d</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">9</span><span>&nbsp;prim:&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:rsaEncryption&nbsp;&nbsp;</span></span></li>
    <li><span><span class="attribute">16:d</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;&nbsp;&nbsp;</span><span class="attribute-value">0</span><span>&nbsp;prim:&nbsp;&nbsp;NULL&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span><span class="attribute">18:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">141</span><span>&nbsp;prim:&nbsp;&nbsp;BIT&nbsp;STRING&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> 
  <p><br></p> 
  <p>但是这里显示格式和上边给出的PKCS#1格式不一致，其实这是x.509中的定义的格式，在X.509证书文件中就是使用这个格式封装公钥数据，其中BIT STRING的内容就是PKCS#1格式的公钥数据，并说明了使用的公钥算法rsaEncryption。</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>SubjectPublicKeyInfo&nbsp;</span><span class="attribute">::</span><span>=</span><span class="attribute-value">SEQUENCE</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;algorithmAlgorithmIdentifier{{SupportedAlgorithms}},&nbsp;&nbsp;</span></li>
    <li class="alt"><span>&nbsp;&nbsp;subjectPublicKeyBIT&nbsp;STRING&nbsp;&nbsp;</span></li>
    <li><span>}&nbsp;&nbsp;</span></li>
   </ol>
  </div> &nbsp; 
  <p>我们可以进一步使用asn1parse工具解析出BIT STRING内容，首先确定该数据块偏移是18，然后使用参数-strparse指定位置,可以看到输出的数据和私钥文件中的是一样的。</p> 
  <p><span style="background-color:rgb(204,204,204);">asn1parse -in pubkey.pem -strparse 18</span></p> 
  <p>&nbsp;输出公钥ASN.1格式：</p> 
  <div class="dp-highlighter bg_html"> 
   <div class="bar"> 
    <div class="tools">
     <strong>[html]</strong> 
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="ViewSource" title="view plain"> view plain</a>
     <a href="http://blog.csdn.net/zhymax/article/details/7683925#" rel="nofollow" class="CopyToClipboard" title="copy">copy</a>
    </div> 
   </div> 
   <ol class="dp-xml" start="1">
    <li class="alt"><span><span>&nbsp;&nbsp;&nbsp;</span><span class="attribute">0:d</span><span>=</span><span class="attribute-value">0</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">137</span><span>&nbsp;cons:&nbsp;SEQUENCE&nbsp;&nbsp;</span></span></li>
    <li><span>&nbsp;&nbsp;&nbsp;<span class="attribute">3:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;</span><span class="attribute">l</span><span>=&nbsp;</span><span class="attribute-value">129</span><span>&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</span></span></li>
    <li class="alt"><span>A11E66B0F965215AB4AD771581700477F62D9EDF2CFEBDF2E20C02DE4E95881F58CA898B6FC389CC83AE39DE95C0252BCF9FB98A6A21A20B751222DF2A4CBE1E08F8BDC8D443A59D4944723C33CED5601E1CF4A324E88B951626326783014CFF3BB7CF7278BF443AB003D1E1608B97CFC7783C6FD42B9A7C8F84C5633FB72DFB&nbsp;&nbsp;</span></li>
    <li><span>&nbsp;&nbsp;&nbsp;<span class="attribute">135:d</span><span>=</span><span class="attribute-value">1</span><span>&nbsp;&nbsp;</span><span class="attribute">hl</span><span>=</span><span class="attribute-value">2</span><span>&nbsp;</span><span class="attribute">l</span><span>=</span><span class="attribute-value">3</span><span>&nbsp;&nbsp;prim:&nbsp;INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:010001&nbsp;&nbsp;</span></span></li>
   </ol>
  </div> &nbsp; 
  <h2><a name="t3"></a>4 公私钥操作</h2> 
  <p>分析完私钥和公钥格式，以及之间的关系。接下来我们将继续使用openssl的rsautl测试它们之间的加解密、签名、验证等操作。</p> 
  <p><br></p> 
  <p>测试文件test，内容“1234567890”。</p> 
  <p>&nbsp;</p> 
  <h3><a name="t4"></a>4.1加解密</h3> 
  <p>&nbsp;1）公钥加密</p> 
  <p><span style="background-color:rgb(204,204,204);">openssl rsautl -encrypt -in test -out test.enc -inkey asn1pub.pem -pubin</span></p> 
  <p><br></p> 
  <p>&nbsp;2）私钥解密</p> 
  <p><span style="background-color:rgb(204,204,204);">openssl rsautl -decrypt -in test.enc -out test.dec -inkey asn1enc.pem</span></p> 
  <p>&nbsp;</p> 
  <p>比较test和test.dec两个文件结果相同。</p> 
  <p>&nbsp;</p> 
  <h3><a name="t5"></a>4.2签名验证</h3> 
  <p>1）私钥签名</p> 
  <p><span style="background-color:rgb(204,204,204);">openssl rsautl -sign -in test -out test.sig-inkey asn1enc.pem</span></p> 
  <p>&nbsp;</p> 
  <p>2）公钥验证</p> 
  <p><span style="background-color:rgb(204,204,204);">openssl rsautl -verify -in test.sig -out test.vfy -inkey asn1pub.pem -pubin</span></p> 
  <p>&nbsp;</p> 
  <p>比较test和test.vfy连个文件应该相同。</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lucien_cc/article/details/18407451,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/lucien_cc/article/details/18407451,&quot;}">阅读更多</a> 
 <!-- <a class="btn" href="https://passport.csdn.net/account/login?utm_source=csdn_blog_pc_more_login" target="_self" id="btn-lobinreadmore" data-track-view='{"mod":"popu_557","con":",https://blog.csdn.net/lucien_cc/article/details/18407451,"}' data-track-click='{"mod":"popu_557","con":",https://blog.csdn.net/lucien_cc/article/details/18407451,"}'>登录后自动展开</a> --> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>模拟银行系统(数据库设计) | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="模拟银行系统(数据库设计)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="--1.创建数据库 --判断数据库db_bank是否存在，如果存在，先删除该数据库 if EXISTS(select * from sysdatabases where name=&#39;db_bank&#39;) DROP DATABASE db_bank go --创建数据库 CREATE DATABASE[db_bank] ON PRIMARY ( NAME=N&#39;db_bank&#39;, FILENAME=N&#39;d:\Bank\Database\db_bank.mdf&#39;, size=10MB, MAXSIZE=100MB, FILEGROWTH=10% ) LOG ON ( NAME=N&#39;db_bank_log&#39;, FILENAME=N&#39;d:\Bank\Database\db_bank_log.ldf&#39;, size=10MB, MAXSIZE=1024MB, FILEGROWTH=10% ) &nbsp; --2.创建表 use db_bank go --创建用户表 CREATE TABLE UserInfo ( ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, --编号 主键 自动编号 UserName NVARCHAR(10) NOT NULL, --用户姓名 PersonID VARCHAR(18) NOT NULL UNIQUE, --身份证号，长度是15或者18，唯一 Telephone VARCHAR(13) NOT NULL, --电话，格式为XXXX-XXXXXXXX或11位手机号 [Address] NVARCHAR(50), --住址 CHECK(LEN(PersonID)=15 OR LEN(PersonID)=18), CHECK(SUBSTRING(Telephone,4,1)=&#39;-&#39; OR SUBSTRING(Telephone,5,1)=&#39;-&#39; OR LEN(Telephone)=11) ) --创建银行卡信息表 CREATE TABLE CardInfo ( CardNumber VARCHAR(15) NOT NULL PRIMARY KEY, --卡号，主键，前4位为9876，后11位自动生成 OpenDate DATE NOT NULL DEFAULT(GETDATE()), --开户日期，默认为当前日期 OpenMoney DECIMAL(18,2) NOT NULL, --开户金额，大于或等于1 Balance DECIMAL(18,2) NOT NULL, --余额，大于或者等于0 [Password] VARCHAR(6) NOT NULL DEFAULT(&#39;888888&#39;), --密码，6位数密码，默认为88888888 IsLock BIT NOT NULL DEFAULT(1), --是否锁定，默认为1 CustomerID INT NOT NULL FOREIGN KEY REFERENCES UserInfo(ID),--客户端编号，用户信息表编号字段的外键，表示该卡对应的客户编号。一位客户允许办理多张卡 CHECK(LEN(CardNumber)=15), CHECK(OpenMoney&gt;=1), CHECK(Balance&gt;=0)) --创建交易记录表 CREATE TABLE TransInfo ( ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, --编号，主键，自动编号 TransDate DATETIME NOT NULL DEFAULT(GETDATE()), --交易日期，默认为系统当前日期 CardNumber VARCHAR(15) NOT NULL FOREIGN KEY REFERENCES CardInfo(CardNumber),--卡号，银行卡信息表外键，可重复索引 TransType NVARCHAR(5) NOT NULL, --交易类型，可选项为：存入，支取，转入，转出 TransMoney DECIMAL(18,2) NOT NULL, --交易金额，大于0 Remark NVARCHAR(200), --备注，可以保存转账对方帐号等附加信息 CHECK(TransType IN(&#39;存入&#39;,&#39;支出&#39;,&#39;转入&#39;,&#39;转出&#39;)), CHECK(TransMoney&gt;0) ) &nbsp; --3.存储过程编写 --生成银行卡号存储过程 ---------------------------------------------------------------------------------------------- use db_bank go --生成银行卡号存储过程 CREATE PROCEDURE Proc_CreateCardNumber @CN VARCHAR(15) OUTPUT AS BEGIN DECLARE @r BIGINT /*生成卡号*/ SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) /*如果银行卡信息表中存在该卡号，重新生成卡号*/ while(EXISTS(select * from CardInfo where CardNumber = @cn)) BEGIN SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) END END --执行开户功能存储过程 ---------------------------------------------------------------------------------------------- --执行开户功能存储过程 /* 该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码 如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。 */ CREATE PROCEDURE Proc_CreateCard @UserName VARCHAR(10), --开户姓名 @PersonID VARCHAR(18), --身份证号 @Telephone VARCHAR(13), --联系电话 @Money DECIMAL(18,2), --开户金额 @Address NVARCHAR(50)=&#39;&#39;, --地址 @Password VARCHAR(6)=&#39;88888888&#39;, --密码 @CN VARCHAR(15)=&#39;&#39;OUTPUT --开户卡号，系统自动生成 AS BEGIN DECLARE @UID INT --判断身份证是否开过账户 IF (EXISTS(select * from UserInfo where PersonID=@PersonID)) select @UID= ID from UserInfo where PersonID=@PersonID ELSE BEGIN --插入 姓名，身份证，电话，地址 INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address) SET @UID=@@IDENTITY PRINT @UID END --执行存储过程生成银行卡号 EXEC Proc_CreateCardNumber @CN OUTPUT SET @CN=&#39;9876&#39;+@CN --插入银行卡信息到银行卡表 INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID) VALUES(@CN,@Money,@Money,@Password,1,@UID) END --存款存储过程 --------------------------------------------------------------------------------------------- --存款存储过程 CREATE PROCEDURE Proc_SaveMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@CN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;存入&#39;,@Money) END --取款存储过程 --------------------------------------------------------------------------------------------- --取款存储过程 CREATE PROCEDURE Proc_GetMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@CN IF(@@ERROR=0) BEGIN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;支出&#39;,@Money) END END --转账存储过程 ----------------------------------------------------------------------------------------------- --转账存储过程 CREATE PROCEDURE Proc_TransFerAccount @OutNumber VARCHAR(15), --源卡号 @InNumer VARCHAR(15), --目的卡号 @Money DECIMAL(18,2) --转账金额 AS BEGIN --事物开始 BEGIN TRANSACTION --源卡号金额扣除 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@OutNumber --目的卡号金额增加 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@InNumer --目的卡号转入记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@InNumer,&#39;转入&#39;,@Money,@OutNumber) --源卡号转出记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@OutNumber,&#39;转出&#39;,@Money,@InNumer) IF(@@ERROR=0) COMMIT TRANSACTION --事物成功 ELSE ROLLBACK TRANSACTION --事物失败，回滚操作 END -------------------------------------------------------------------------------------------------- &nbsp; --3.存储过程编写 --生成银行卡号存储过程 ---------------------------------------------------------------------------------------------- use db_bank go --生成银行卡号存储过程 CREATE PROCEDURE Proc_CreateCardNumber @CN VARCHAR(15) OUTPUT AS BEGIN DECLARE @r BIGINT /*生成卡号*/ SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) /*如果银行卡信息表中存在该卡号，重新生成卡号*/ while(EXISTS(select * from CardInfo where CardNumber = @cn)) BEGIN SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) END END --执行开户功能存储过程 ---------------------------------------------------------------------------------------------- --执行开户功能存储过程 /* 该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码 如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。 */ CREATE PROCEDURE Proc_CreateCard @UserName VARCHAR(10), --开户姓名 @PersonID VARCHAR(18), --身份证号 @Telephone VARCHAR(13), --联系电话 @Money DECIMAL(18,2), --开户金额 @Address NVARCHAR(50)=&#39;&#39;, --地址 @Password VARCHAR(6)=&#39;888888&#39;, --密码 @CN VARCHAR(15)=&#39;&#39;OUTPUT --开户卡号，系统自动生成 AS BEGIN DECLARE @UID INT --判断身份证是否开过账户 IF (EXISTS(select * from UserInfo where PersonID=@PersonID)) select @UID= ID from UserInfo where PersonID=@PersonID ELSE BEGIN --插入 姓名，身份证，电话，地址 INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address) SET @UID=@@IDENTITY PRINT @UID END --执行存储过程生成银行卡号 EXEC Proc_CreateCardNumber @CN OUTPUT SET @CN=&#39;9876&#39;+@CN --插入银行卡信息到银行卡表 INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID) VALUES(@CN,@Money,@Money,@Password,1,@UID) END --存款存储过程 --------------------------------------------------------------------------------------------- --存款存储过程 CREATE PROCEDURE Proc_SaveMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@CN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;存入&#39;,@Money) END --取款存储过程 --------------------------------------------------------------------------------------------- --取款存储过程 CREATE PROCEDURE Proc_GetMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@CN IF(@@ERROR=0) BEGIN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;支出&#39;,@Money) END END --转账存储过程 ----------------------------------------------------------------------------------------------- --转账存储过程 CREATE PROCEDURE Proc_TransFerAccount @OutNumber VARCHAR(15), --源卡号 @InNumer VARCHAR(15), --目的卡号 @Money DECIMAL(18,2) --转账金额 AS BEGIN --事物开始 BEGIN TRANSACTION --源卡号金额扣除 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@OutNumber --目的卡号金额增加 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@InNumer --目的卡号转入记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@InNumer,&#39;转入&#39;,@Money,@OutNumber) --源卡号转出记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@OutNumber,&#39;转出&#39;,@Money,@InNumer) IF(@@ERROR=0) COMMIT TRANSACTION --事物成功 ELSE ROLLBACK TRANSACTION --事物失败，回滚操作 END -------------------------------------------------------------------------------------------------- &nbsp; --插入数据 use db_bank go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;张月关&#39;, @PersonID=&#39;410156190012056548&#39;, @Telephone=&#39;010-32586458&#39;, @Address=&#39;北京海定&#39;, @money=100, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;李四平&#39;, @personID=&#39;120325201206023254&#39;, @Telephone=&#39;12222222222&#39;, @Address=&#39;河南郑州&#39;, @money=1, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;祝涛&#39;, @PersonID=&#39;325156198201253288&#39;, @Telephone=&#39;0371-25863214&#39;, @Address=&#39;河南郑州&#39;, @money=20000, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;刘明&#39;, @PersonID=&#39;658254195511153265&#39;, @Telephone=&#39;0521-32651478&#39;, @Address=&#39;河南郑州&#39;, @money=1000, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go &nbsp; &nbsp; &nbsp; &nbsp; --存款操作 EXEC Proc_SaveMoney &#39;987672650464229&#39;,5000 EXEC Proc_SaveMoney &#39;987672669097200&#39;,1200 EXEC Proc_SaveMoney &#39;987672682140280&#39;,1000 EXEC Proc_SaveMoney &#39;987672700773251&#39;,1500 &nbsp; &nbsp; &nbsp; &nbsp; --取款操作 EXEC Proc_GetMoney &#39;987672650464229&#39;,100 EXEC Proc_GetMoney &#39;987672669097200&#39;,200 EXEC Proc_GetMoney &#39;987672682140280&#39;,300 EXEC Proc_GetMoney &#39;987672700773251&#39;,400 &nbsp; --转账操作 EXEC Proc_TransferAccount &#39;987672650464229&#39;,&#39;987672669097200&#39;,100 &nbsp; --查询交易记录视图 CREATE VIEW View_TransInfo AS select u.UserName,T.* from TransInfo T,UserInfo U,CardInfo C where T.CardNumber=C.CardNumber AND C.CustomerID=U.ID --执行查询交易记录 select * from View_TransInfo where CardNumber=&#39;987672650464229&#39; 阅读更多" />
<meta property="og:description" content="--1.创建数据库 --判断数据库db_bank是否存在，如果存在，先删除该数据库 if EXISTS(select * from sysdatabases where name=&#39;db_bank&#39;) DROP DATABASE db_bank go --创建数据库 CREATE DATABASE[db_bank] ON PRIMARY ( NAME=N&#39;db_bank&#39;, FILENAME=N&#39;d:\Bank\Database\db_bank.mdf&#39;, size=10MB, MAXSIZE=100MB, FILEGROWTH=10% ) LOG ON ( NAME=N&#39;db_bank_log&#39;, FILENAME=N&#39;d:\Bank\Database\db_bank_log.ldf&#39;, size=10MB, MAXSIZE=1024MB, FILEGROWTH=10% ) &nbsp; --2.创建表 use db_bank go --创建用户表 CREATE TABLE UserInfo ( ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, --编号 主键 自动编号 UserName NVARCHAR(10) NOT NULL, --用户姓名 PersonID VARCHAR(18) NOT NULL UNIQUE, --身份证号，长度是15或者18，唯一 Telephone VARCHAR(13) NOT NULL, --电话，格式为XXXX-XXXXXXXX或11位手机号 [Address] NVARCHAR(50), --住址 CHECK(LEN(PersonID)=15 OR LEN(PersonID)=18), CHECK(SUBSTRING(Telephone,4,1)=&#39;-&#39; OR SUBSTRING(Telephone,5,1)=&#39;-&#39; OR LEN(Telephone)=11) ) --创建银行卡信息表 CREATE TABLE CardInfo ( CardNumber VARCHAR(15) NOT NULL PRIMARY KEY, --卡号，主键，前4位为9876，后11位自动生成 OpenDate DATE NOT NULL DEFAULT(GETDATE()), --开户日期，默认为当前日期 OpenMoney DECIMAL(18,2) NOT NULL, --开户金额，大于或等于1 Balance DECIMAL(18,2) NOT NULL, --余额，大于或者等于0 [Password] VARCHAR(6) NOT NULL DEFAULT(&#39;888888&#39;), --密码，6位数密码，默认为88888888 IsLock BIT NOT NULL DEFAULT(1), --是否锁定，默认为1 CustomerID INT NOT NULL FOREIGN KEY REFERENCES UserInfo(ID),--客户端编号，用户信息表编号字段的外键，表示该卡对应的客户编号。一位客户允许办理多张卡 CHECK(LEN(CardNumber)=15), CHECK(OpenMoney&gt;=1), CHECK(Balance&gt;=0)) --创建交易记录表 CREATE TABLE TransInfo ( ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, --编号，主键，自动编号 TransDate DATETIME NOT NULL DEFAULT(GETDATE()), --交易日期，默认为系统当前日期 CardNumber VARCHAR(15) NOT NULL FOREIGN KEY REFERENCES CardInfo(CardNumber),--卡号，银行卡信息表外键，可重复索引 TransType NVARCHAR(5) NOT NULL, --交易类型，可选项为：存入，支取，转入，转出 TransMoney DECIMAL(18,2) NOT NULL, --交易金额，大于0 Remark NVARCHAR(200), --备注，可以保存转账对方帐号等附加信息 CHECK(TransType IN(&#39;存入&#39;,&#39;支出&#39;,&#39;转入&#39;,&#39;转出&#39;)), CHECK(TransMoney&gt;0) ) &nbsp; --3.存储过程编写 --生成银行卡号存储过程 ---------------------------------------------------------------------------------------------- use db_bank go --生成银行卡号存储过程 CREATE PROCEDURE Proc_CreateCardNumber @CN VARCHAR(15) OUTPUT AS BEGIN DECLARE @r BIGINT /*生成卡号*/ SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) /*如果银行卡信息表中存在该卡号，重新生成卡号*/ while(EXISTS(select * from CardInfo where CardNumber = @cn)) BEGIN SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) END END --执行开户功能存储过程 ---------------------------------------------------------------------------------------------- --执行开户功能存储过程 /* 该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码 如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。 */ CREATE PROCEDURE Proc_CreateCard @UserName VARCHAR(10), --开户姓名 @PersonID VARCHAR(18), --身份证号 @Telephone VARCHAR(13), --联系电话 @Money DECIMAL(18,2), --开户金额 @Address NVARCHAR(50)=&#39;&#39;, --地址 @Password VARCHAR(6)=&#39;88888888&#39;, --密码 @CN VARCHAR(15)=&#39;&#39;OUTPUT --开户卡号，系统自动生成 AS BEGIN DECLARE @UID INT --判断身份证是否开过账户 IF (EXISTS(select * from UserInfo where PersonID=@PersonID)) select @UID= ID from UserInfo where PersonID=@PersonID ELSE BEGIN --插入 姓名，身份证，电话，地址 INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address) SET @UID=@@IDENTITY PRINT @UID END --执行存储过程生成银行卡号 EXEC Proc_CreateCardNumber @CN OUTPUT SET @CN=&#39;9876&#39;+@CN --插入银行卡信息到银行卡表 INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID) VALUES(@CN,@Money,@Money,@Password,1,@UID) END --存款存储过程 --------------------------------------------------------------------------------------------- --存款存储过程 CREATE PROCEDURE Proc_SaveMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@CN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;存入&#39;,@Money) END --取款存储过程 --------------------------------------------------------------------------------------------- --取款存储过程 CREATE PROCEDURE Proc_GetMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@CN IF(@@ERROR=0) BEGIN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;支出&#39;,@Money) END END --转账存储过程 ----------------------------------------------------------------------------------------------- --转账存储过程 CREATE PROCEDURE Proc_TransFerAccount @OutNumber VARCHAR(15), --源卡号 @InNumer VARCHAR(15), --目的卡号 @Money DECIMAL(18,2) --转账金额 AS BEGIN --事物开始 BEGIN TRANSACTION --源卡号金额扣除 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@OutNumber --目的卡号金额增加 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@InNumer --目的卡号转入记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@InNumer,&#39;转入&#39;,@Money,@OutNumber) --源卡号转出记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@OutNumber,&#39;转出&#39;,@Money,@InNumer) IF(@@ERROR=0) COMMIT TRANSACTION --事物成功 ELSE ROLLBACK TRANSACTION --事物失败，回滚操作 END -------------------------------------------------------------------------------------------------- &nbsp; --3.存储过程编写 --生成银行卡号存储过程 ---------------------------------------------------------------------------------------------- use db_bank go --生成银行卡号存储过程 CREATE PROCEDURE Proc_CreateCardNumber @CN VARCHAR(15) OUTPUT AS BEGIN DECLARE @r BIGINT /*生成卡号*/ SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) /*如果银行卡信息表中存在该卡号，重新生成卡号*/ while(EXISTS(select * from CardInfo where CardNumber = @cn)) BEGIN SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) END END --执行开户功能存储过程 ---------------------------------------------------------------------------------------------- --执行开户功能存储过程 /* 该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码 如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。 */ CREATE PROCEDURE Proc_CreateCard @UserName VARCHAR(10), --开户姓名 @PersonID VARCHAR(18), --身份证号 @Telephone VARCHAR(13), --联系电话 @Money DECIMAL(18,2), --开户金额 @Address NVARCHAR(50)=&#39;&#39;, --地址 @Password VARCHAR(6)=&#39;888888&#39;, --密码 @CN VARCHAR(15)=&#39;&#39;OUTPUT --开户卡号，系统自动生成 AS BEGIN DECLARE @UID INT --判断身份证是否开过账户 IF (EXISTS(select * from UserInfo where PersonID=@PersonID)) select @UID= ID from UserInfo where PersonID=@PersonID ELSE BEGIN --插入 姓名，身份证，电话，地址 INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address) SET @UID=@@IDENTITY PRINT @UID END --执行存储过程生成银行卡号 EXEC Proc_CreateCardNumber @CN OUTPUT SET @CN=&#39;9876&#39;+@CN --插入银行卡信息到银行卡表 INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID) VALUES(@CN,@Money,@Money,@Password,1,@UID) END --存款存储过程 --------------------------------------------------------------------------------------------- --存款存储过程 CREATE PROCEDURE Proc_SaveMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@CN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;存入&#39;,@Money) END --取款存储过程 --------------------------------------------------------------------------------------------- --取款存储过程 CREATE PROCEDURE Proc_GetMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@CN IF(@@ERROR=0) BEGIN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;支出&#39;,@Money) END END --转账存储过程 ----------------------------------------------------------------------------------------------- --转账存储过程 CREATE PROCEDURE Proc_TransFerAccount @OutNumber VARCHAR(15), --源卡号 @InNumer VARCHAR(15), --目的卡号 @Money DECIMAL(18,2) --转账金额 AS BEGIN --事物开始 BEGIN TRANSACTION --源卡号金额扣除 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@OutNumber --目的卡号金额增加 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@InNumer --目的卡号转入记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@InNumer,&#39;转入&#39;,@Money,@OutNumber) --源卡号转出记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@OutNumber,&#39;转出&#39;,@Money,@InNumer) IF(@@ERROR=0) COMMIT TRANSACTION --事物成功 ELSE ROLLBACK TRANSACTION --事物失败，回滚操作 END -------------------------------------------------------------------------------------------------- &nbsp; --插入数据 use db_bank go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;张月关&#39;, @PersonID=&#39;410156190012056548&#39;, @Telephone=&#39;010-32586458&#39;, @Address=&#39;北京海定&#39;, @money=100, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;李四平&#39;, @personID=&#39;120325201206023254&#39;, @Telephone=&#39;12222222222&#39;, @Address=&#39;河南郑州&#39;, @money=1, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;祝涛&#39;, @PersonID=&#39;325156198201253288&#39;, @Telephone=&#39;0371-25863214&#39;, @Address=&#39;河南郑州&#39;, @money=20000, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;刘明&#39;, @PersonID=&#39;658254195511153265&#39;, @Telephone=&#39;0521-32651478&#39;, @Address=&#39;河南郑州&#39;, @money=1000, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go &nbsp; &nbsp; &nbsp; &nbsp; --存款操作 EXEC Proc_SaveMoney &#39;987672650464229&#39;,5000 EXEC Proc_SaveMoney &#39;987672669097200&#39;,1200 EXEC Proc_SaveMoney &#39;987672682140280&#39;,1000 EXEC Proc_SaveMoney &#39;987672700773251&#39;,1500 &nbsp; &nbsp; &nbsp; &nbsp; --取款操作 EXEC Proc_GetMoney &#39;987672650464229&#39;,100 EXEC Proc_GetMoney &#39;987672669097200&#39;,200 EXEC Proc_GetMoney &#39;987672682140280&#39;,300 EXEC Proc_GetMoney &#39;987672700773251&#39;,400 &nbsp; --转账操作 EXEC Proc_TransferAccount &#39;987672650464229&#39;,&#39;987672669097200&#39;,100 &nbsp; --查询交易记录视图 CREATE VIEW View_TransInfo AS select u.UserName,T.* from TransInfo T,UserInfo U,CardInfo C where T.CardNumber=C.CardNumber AND C.CustomerID=U.ID --执行查询交易记录 select * from View_TransInfo where CardNumber=&#39;987672650464229&#39; 阅读更多" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-07-22T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"--1.创建数据库 --判断数据库db_bank是否存在，如果存在，先删除该数据库 if EXISTS(select * from sysdatabases where name=&#39;db_bank&#39;) DROP DATABASE db_bank go --创建数据库 CREATE DATABASE[db_bank] ON PRIMARY ( NAME=N&#39;db_bank&#39;, FILENAME=N&#39;d:\\Bank\\Database\\db_bank.mdf&#39;, size=10MB, MAXSIZE=100MB, FILEGROWTH=10% ) LOG ON ( NAME=N&#39;db_bank_log&#39;, FILENAME=N&#39;d:\\Bank\\Database\\db_bank_log.ldf&#39;, size=10MB, MAXSIZE=1024MB, FILEGROWTH=10% ) &nbsp; --2.创建表 use db_bank go --创建用户表 CREATE TABLE UserInfo ( ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, --编号 主键 自动编号 UserName NVARCHAR(10) NOT NULL, --用户姓名 PersonID VARCHAR(18) NOT NULL UNIQUE, --身份证号，长度是15或者18，唯一 Telephone VARCHAR(13) NOT NULL, --电话，格式为XXXX-XXXXXXXX或11位手机号 [Address] NVARCHAR(50), --住址 CHECK(LEN(PersonID)=15 OR LEN(PersonID)=18), CHECK(SUBSTRING(Telephone,4,1)=&#39;-&#39; OR SUBSTRING(Telephone,5,1)=&#39;-&#39; OR LEN(Telephone)=11) ) --创建银行卡信息表 CREATE TABLE CardInfo ( CardNumber VARCHAR(15) NOT NULL PRIMARY KEY, --卡号，主键，前4位为9876，后11位自动生成 OpenDate DATE NOT NULL DEFAULT(GETDATE()), --开户日期，默认为当前日期 OpenMoney DECIMAL(18,2) NOT NULL, --开户金额，大于或等于1 Balance DECIMAL(18,2) NOT NULL, --余额，大于或者等于0 [Password] VARCHAR(6) NOT NULL DEFAULT(&#39;888888&#39;), --密码，6位数密码，默认为88888888 IsLock BIT NOT NULL DEFAULT(1), --是否锁定，默认为1 CustomerID INT NOT NULL FOREIGN KEY REFERENCES UserInfo(ID),--客户端编号，用户信息表编号字段的外键，表示该卡对应的客户编号。一位客户允许办理多张卡 CHECK(LEN(CardNumber)=15), CHECK(OpenMoney&gt;=1), CHECK(Balance&gt;=0)) --创建交易记录表 CREATE TABLE TransInfo ( ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY, --编号，主键，自动编号 TransDate DATETIME NOT NULL DEFAULT(GETDATE()), --交易日期，默认为系统当前日期 CardNumber VARCHAR(15) NOT NULL FOREIGN KEY REFERENCES CardInfo(CardNumber),--卡号，银行卡信息表外键，可重复索引 TransType NVARCHAR(5) NOT NULL, --交易类型，可选项为：存入，支取，转入，转出 TransMoney DECIMAL(18,2) NOT NULL, --交易金额，大于0 Remark NVARCHAR(200), --备注，可以保存转账对方帐号等附加信息 CHECK(TransType IN(&#39;存入&#39;,&#39;支出&#39;,&#39;转入&#39;,&#39;转出&#39;)), CHECK(TransMoney&gt;0) ) &nbsp; --3.存储过程编写 --生成银行卡号存储过程 ---------------------------------------------------------------------------------------------- use db_bank go --生成银行卡号存储过程 CREATE PROCEDURE Proc_CreateCardNumber @CN VARCHAR(15) OUTPUT AS BEGIN DECLARE @r BIGINT /*生成卡号*/ SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) /*如果银行卡信息表中存在该卡号，重新生成卡号*/ while(EXISTS(select * from CardInfo where CardNumber = @cn)) BEGIN SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) END END --执行开户功能存储过程 ---------------------------------------------------------------------------------------------- --执行开户功能存储过程 /* 该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码 如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。 */ CREATE PROCEDURE Proc_CreateCard @UserName VARCHAR(10), --开户姓名 @PersonID VARCHAR(18), --身份证号 @Telephone VARCHAR(13), --联系电话 @Money DECIMAL(18,2), --开户金额 @Address NVARCHAR(50)=&#39;&#39;, --地址 @Password VARCHAR(6)=&#39;88888888&#39;, --密码 @CN VARCHAR(15)=&#39;&#39;OUTPUT --开户卡号，系统自动生成 AS BEGIN DECLARE @UID INT --判断身份证是否开过账户 IF (EXISTS(select * from UserInfo where PersonID=@PersonID)) select @UID= ID from UserInfo where PersonID=@PersonID ELSE BEGIN --插入 姓名，身份证，电话，地址 INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address) SET @UID=@@IDENTITY PRINT @UID END --执行存储过程生成银行卡号 EXEC Proc_CreateCardNumber @CN OUTPUT SET @CN=&#39;9876&#39;+@CN --插入银行卡信息到银行卡表 INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID) VALUES(@CN,@Money,@Money,@Password,1,@UID) END --存款存储过程 --------------------------------------------------------------------------------------------- --存款存储过程 CREATE PROCEDURE Proc_SaveMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@CN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;存入&#39;,@Money) END --取款存储过程 --------------------------------------------------------------------------------------------- --取款存储过程 CREATE PROCEDURE Proc_GetMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@CN IF(@@ERROR=0) BEGIN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;支出&#39;,@Money) END END --转账存储过程 ----------------------------------------------------------------------------------------------- --转账存储过程 CREATE PROCEDURE Proc_TransFerAccount @OutNumber VARCHAR(15), --源卡号 @InNumer VARCHAR(15), --目的卡号 @Money DECIMAL(18,2) --转账金额 AS BEGIN --事物开始 BEGIN TRANSACTION --源卡号金额扣除 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@OutNumber --目的卡号金额增加 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@InNumer --目的卡号转入记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@InNumer,&#39;转入&#39;,@Money,@OutNumber) --源卡号转出记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@OutNumber,&#39;转出&#39;,@Money,@InNumer) IF(@@ERROR=0) COMMIT TRANSACTION --事物成功 ELSE ROLLBACK TRANSACTION --事物失败，回滚操作 END -------------------------------------------------------------------------------------------------- &nbsp; --3.存储过程编写 --生成银行卡号存储过程 ---------------------------------------------------------------------------------------------- use db_bank go --生成银行卡号存储过程 CREATE PROCEDURE Proc_CreateCardNumber @CN VARCHAR(15) OUTPUT AS BEGIN DECLARE @r BIGINT /*生成卡号*/ SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) /*如果银行卡信息表中存在该卡号，重新生成卡号*/ while(EXISTS(select * from CardInfo where CardNumber = @cn)) BEGIN SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000 SET @CN=CONVERT(VARCHAR,@r) END END --执行开户功能存储过程 ---------------------------------------------------------------------------------------------- --执行开户功能存储过程 /* 该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码 如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。 */ CREATE PROCEDURE Proc_CreateCard @UserName VARCHAR(10), --开户姓名 @PersonID VARCHAR(18), --身份证号 @Telephone VARCHAR(13), --联系电话 @Money DECIMAL(18,2), --开户金额 @Address NVARCHAR(50)=&#39;&#39;, --地址 @Password VARCHAR(6)=&#39;888888&#39;, --密码 @CN VARCHAR(15)=&#39;&#39;OUTPUT --开户卡号，系统自动生成 AS BEGIN DECLARE @UID INT --判断身份证是否开过账户 IF (EXISTS(select * from UserInfo where PersonID=@PersonID)) select @UID= ID from UserInfo where PersonID=@PersonID ELSE BEGIN --插入 姓名，身份证，电话，地址 INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address) SET @UID=@@IDENTITY PRINT @UID END --执行存储过程生成银行卡号 EXEC Proc_CreateCardNumber @CN OUTPUT SET @CN=&#39;9876&#39;+@CN --插入银行卡信息到银行卡表 INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID) VALUES(@CN,@Money,@Money,@Password,1,@UID) END --存款存储过程 --------------------------------------------------------------------------------------------- --存款存储过程 CREATE PROCEDURE Proc_SaveMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@CN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;存入&#39;,@Money) END --取款存储过程 --------------------------------------------------------------------------------------------- --取款存储过程 CREATE PROCEDURE Proc_GetMoney @CN VARCHAR(15), @Money DECIMAL(18,2) AS BEGIN --对银行卡信息表的卡号更新余额操作 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@CN IF(@@ERROR=0) BEGIN --插入交易记录表，银行卡号，交易金额 INSERT INTO TransInfo(CardNumber,TransType,TransMoney) VALUES(@CN,&#39;支出&#39;,@Money) END END --转账存储过程 ----------------------------------------------------------------------------------------------- --转账存储过程 CREATE PROCEDURE Proc_TransFerAccount @OutNumber VARCHAR(15), --源卡号 @InNumer VARCHAR(15), --目的卡号 @Money DECIMAL(18,2) --转账金额 AS BEGIN --事物开始 BEGIN TRANSACTION --源卡号金额扣除 UPDATE CardInfo SET Balance=Balance-@Money where CardNumber=@OutNumber --目的卡号金额增加 UPDATE CardInfo SET Balance=Balance+@Money where CardNumber=@InNumer --目的卡号转入记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@InNumer,&#39;转入&#39;,@Money,@OutNumber) --源卡号转出记录 INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark) VALUES(@OutNumber,&#39;转出&#39;,@Money,@InNumer) IF(@@ERROR=0) COMMIT TRANSACTION --事物成功 ELSE ROLLBACK TRANSACTION --事物失败，回滚操作 END -------------------------------------------------------------------------------------------------- &nbsp; --插入数据 use db_bank go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;张月关&#39;, @PersonID=&#39;410156190012056548&#39;, @Telephone=&#39;010-32586458&#39;, @Address=&#39;北京海定&#39;, @money=100, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;李四平&#39;, @personID=&#39;120325201206023254&#39;, @Telephone=&#39;12222222222&#39;, @Address=&#39;河南郑州&#39;, @money=1, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;祝涛&#39;, @PersonID=&#39;325156198201253288&#39;, @Telephone=&#39;0371-25863214&#39;, @Address=&#39;河南郑州&#39;, @money=20000, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go DECLARE @cardNumber VARCHAR(15) EXEC Proc_CreateCard @UserName=&#39;刘明&#39;, @PersonID=&#39;658254195511153265&#39;, @Telephone=&#39;0521-32651478&#39;, @Address=&#39;河南郑州&#39;, @money=1000, @cn=@cardNumber OUTPUT PRINT &#39;卡号为:&#39;+@cardNumber go &nbsp; &nbsp; &nbsp; &nbsp; --存款操作 EXEC Proc_SaveMoney &#39;987672650464229&#39;,5000 EXEC Proc_SaveMoney &#39;987672669097200&#39;,1200 EXEC Proc_SaveMoney &#39;987672682140280&#39;,1000 EXEC Proc_SaveMoney &#39;987672700773251&#39;,1500 &nbsp; &nbsp; &nbsp; &nbsp; --取款操作 EXEC Proc_GetMoney &#39;987672650464229&#39;,100 EXEC Proc_GetMoney &#39;987672669097200&#39;,200 EXEC Proc_GetMoney &#39;987672682140280&#39;,300 EXEC Proc_GetMoney &#39;987672700773251&#39;,400 &nbsp; --转账操作 EXEC Proc_TransferAccount &#39;987672650464229&#39;,&#39;987672669097200&#39;,100 &nbsp; --查询交易记录视图 CREATE VIEW View_TransInfo AS select u.UserName,T.* from TransInfo T,UserInfo U,CardInfo C where T.CardNumber=C.CardNumber AND C.CustomerID=U.ID --执行查询交易记录 select * from View_TransInfo where CardNumber=&#39;987672650464229&#39; 阅读更多","@type":"BlogPosting","url":"/2015/07/22/ce61c0d3b36cd952338ae7fb3ee7644d.html","headline":"模拟银行系统(数据库设计)","dateModified":"2015-07-22T00:00:00+08:00","datePublished":"2015-07-22T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2015/07/22/ce61c0d3b36cd952338ae7fb3ee7644d.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>模拟银行系统(数据库设计)</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <pre><code class="language-cpp">--1.创建数据库
--判断数据库db_bank是否存在，如果存在，先删除该数据库
if EXISTS(select * from sysdatabases where name='db_bank')
	DROP DATABASE db_bank
go

--创建数据库
CREATE DATABASE[db_bank]
ON PRIMARY
(
	NAME=N'db_bank',
	FILENAME=N'd:\Bank\Database\db_bank.mdf',
	size=10MB,
	MAXSIZE=100MB,
	FILEGROWTH=10%
)
LOG ON
(
	NAME=N'db_bank_log',
	FILENAME=N'd:\Bank\Database\db_bank_log.ldf',
	size=10MB,
	MAXSIZE=1024MB,
	FILEGROWTH=10%
)</code></pre> 
  <p><br> &nbsp;</p> 
  <pre><code class="language-cpp">--2.创建表
use db_bank
go

--创建用户表
CREATE TABLE UserInfo
(
	ID INT IDENTITY(1,1)  NOT NULL PRIMARY KEY,      	 --编号 主键 自动编号
	UserName NVARCHAR(10) NOT NULL,					 	 --用户姓名
	PersonID VARCHAR(18)  NOT NULL UNIQUE,			 	 --身份证号，长度是15或者18，唯一
	Telephone VARCHAR(13) NOT NULL,					  	 --电话，格式为XXXX-XXXXXXXX或11位手机号
	[Address] NVARCHAR(50),							 	  --住址
	CHECK(LEN(PersonID)=15 OR LEN(PersonID)=18),
	CHECK(SUBSTRING(Telephone,4,1)='-' OR SUBSTRING(Telephone,5,1)='-' OR LEN(Telephone)=11)	
)

--创建银行卡信息表
CREATE TABLE CardInfo
(
	CardNumber VARCHAR(15) NOT NULL PRIMARY KEY,        				--卡号，主键，前4位为9876，后11位自动生成
	OpenDate   DATE NOT NULL DEFAULT(GETDATE()),		 				--开户日期，默认为当前日期
	OpenMoney  DECIMAL(18,2) NOT NULL,					  				--开户金额，大于或等于1
	Balance    DECIMAL(18,2) NOT NULL,					  				--余额，大于或者等于0
	[Password] VARCHAR(6) NOT NULL DEFAULT('888888'),   				--密码，6位数密码，默认为88888888
	IsLock	   BIT        NOT NULL DEFAULT(1),			  				--是否锁定，默认为1
	CustomerID INT        NOT NULL FOREIGN KEY REFERENCES UserInfo(ID),--客户端编号，用户信息表编号字段的外键，表示该卡对应的客户编号。一位客户允许办理多张卡
	CHECK(LEN(CardNumber)=15),
	CHECK(OpenMoney&gt;=1),
	CHECK(Balance&gt;=0))

--创建交易记录表
CREATE TABLE TransInfo
(
	ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,									--编号，主键，自动编号
	TransDate DATETIME NOT NULL DEFAULT(GETDATE()),								--交易日期，默认为系统当前日期
	CardNumber VARCHAR(15) NOT NULL FOREIGN KEY REFERENCES CardInfo(CardNumber),--卡号，银行卡信息表外键，可重复索引
	TransType NVARCHAR(5) NOT NULL,												--交易类型，可选项为：存入，支取，转入，转出
	TransMoney DECIMAL(18,2) NOT NULL,											--交易金额，大于0
	Remark NVARCHAR(200),														--备注，可以保存转账对方帐号等附加信息	
	CHECK(TransType IN('存入','支出','转入','转出')),
	CHECK(TransMoney&gt;0)
)</code></pre> 
  <p>&nbsp;</p> 
  <br>
  <pre><code class="language-cpp">--3.存储过程编写

--生成银行卡号存储过程
----------------------------------------------------------------------------------------------
use db_bank
go

--生成银行卡号存储过程
CREATE PROCEDURE Proc_CreateCardNumber
@CN VARCHAR(15) OUTPUT
AS
BEGIN
	DECLARE @r BIGINT
	/*生成卡号*/
	SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000
	SET @CN=CONVERT(VARCHAR,@r)
	
	/*如果银行卡信息表中存在该卡号，重新生成卡号*/
	while(EXISTS(select * from CardInfo where CardNumber = @cn))
	BEGIN
			SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000
			SET @CN=CONVERT(VARCHAR,@r)	
	END

END


--执行开户功能存储过程
----------------------------------------------------------------------------------------------


--执行开户功能存储过程
/*
该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码
如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。
*/

CREATE PROCEDURE Proc_CreateCard
@UserName  VARCHAR(10),				--开户姓名
@PersonID  VARCHAR(18),				--身份证号
@Telephone VARCHAR(13),				--联系电话
@Money     DECIMAL(18,2),			--开户金额
@Address   NVARCHAR(50)='',			--地址
@Password  VARCHAR(6)='88888888',	--密码
@CN		   VARCHAR(15)=''OUTPUT		--开户卡号，系统自动生成
AS
BEGIN
		DECLARE @UID INT
		--判断身份证是否开过账户
		IF (EXISTS(select * from UserInfo where PersonID=@PersonID))
			select @UID= ID from UserInfo where PersonID=@PersonID
		ELSE
			BEGIN
			--插入 姓名，身份证，电话，地址 
			INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address)
			SET @UID=@@IDENTITY
			PRINT @UID 
			END
		
		--执行存储过程生成银行卡号	
		EXEC Proc_CreateCardNumber @CN OUTPUT
		SET @CN='9876'+@CN
		
		--插入银行卡信息到银行卡表
		INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID)
					VALUES(@CN,@Money,@Money,@Password,1,@UID)	
END


--存款存储过程
---------------------------------------------------------------------------------------------

--存款存储过程
CREATE PROCEDURE Proc_SaveMoney
@CN    VARCHAR(15),
@Money DECIMAL(18,2)
AS

BEGIN
	--对银行卡信息表的卡号更新余额操作
	UPDATE CardInfo
	SET Balance=Balance+@Money
	where CardNumber=@CN
	
	--插入交易记录表，银行卡号，交易金额
	INSERT INTO TransInfo(CardNumber,TransType,TransMoney)
				VALUES(@CN,'存入',@Money)

END



--取款存储过程
---------------------------------------------------------------------------------------------

--取款存储过程
CREATE PROCEDURE Proc_GetMoney
@CN    VARCHAR(15),
@Money DECIMAL(18,2)
AS

BEGIN
	--对银行卡信息表的卡号更新余额操作
	UPDATE CardInfo
	SET Balance=Balance-@Money
	where CardNumber=@CN
	
	IF(@@ERROR=0)
	BEGIN
			--插入交易记录表，银行卡号，交易金额
			INSERT INTO TransInfo(CardNumber,TransType,TransMoney)
					VALUES(@CN,'支出',@Money)
	
	END
END


--转账存储过程
-----------------------------------------------------------------------------------------------


--转账存储过程
CREATE PROCEDURE Proc_TransFerAccount
@OutNumber VARCHAR(15),		--源卡号
@InNumer   VARCHAR(15),		--目的卡号
@Money	   DECIMAL(18,2)    --转账金额

AS
BEGIN
		--事物开始
		BEGIN TRANSACTION
		
		--源卡号金额扣除
		UPDATE CardInfo
		SET Balance=Balance-@Money
		where CardNumber=@OutNumber
		
		--目的卡号金额增加
		UPDATE CardInfo
		SET Balance=Balance+@Money
		where CardNumber=@InNumer
		
		--目的卡号转入记录
		INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark)
					VALUES(@InNumer,'转入',@Money,@OutNumber)
		
		--源卡号转出记录			
		INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark)
					VALUES(@OutNumber,'转出',@Money,@InNumer)
					
		IF(@@ERROR=0)
			COMMIT TRANSACTION			--事物成功
		ELSE
			ROLLBACK TRANSACTION		--事物失败，回滚操作

							
END
--------------------------------------------------------------------------------------------------</code></pre> 
  <p><br> &nbsp;</p> 
  <pre><code class="language-cpp">--3.存储过程编写

--生成银行卡号存储过程
----------------------------------------------------------------------------------------------
use db_bank
go

--生成银行卡号存储过程
CREATE PROCEDURE Proc_CreateCardNumber
@CN VARCHAR(15) OUTPUT
AS
BEGIN
	DECLARE @r BIGINT
	/*生成卡号*/
	SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000
	SET @CN=CONVERT(VARCHAR,@r)
	
	/*如果银行卡信息表中存在该卡号，重新生成卡号*/
	while(EXISTS(select * from CardInfo where CardNumber = @cn))
	BEGIN
			SET @r=RAND((DATEPART(ss,GETDATE())+DATEPART(ms,GETDATE())))*100000000000
			SET @CN=CONVERT(VARCHAR,@r)	
	END

END


--执行开户功能存储过程
----------------------------------------------------------------------------------------------


--执行开户功能存储过程
/*
该存储过程接收用户姓名、身份证号、联系电话、联系地址、开户金额、初始密码
如果UserInfo表中存在指定用户身份证号相同，则不再创建新用户，直接使用原用户信息。
*/

CREATE PROCEDURE Proc_CreateCard
@UserName  VARCHAR(10),				--开户姓名
@PersonID  VARCHAR(18),				--身份证号
@Telephone VARCHAR(13),				--联系电话
@Money     DECIMAL(18,2),			--开户金额
@Address   NVARCHAR(50)='',			--地址
@Password  VARCHAR(6)='888888',	--密码
@CN		   VARCHAR(15)=''OUTPUT		--开户卡号，系统自动生成
AS
BEGIN
		DECLARE @UID INT
		--判断身份证是否开过账户
		IF (EXISTS(select * from UserInfo where PersonID=@PersonID))
			select @UID= ID from UserInfo where PersonID=@PersonID
		ELSE
			BEGIN
			--插入 姓名，身份证，电话，地址 
			INSERT INTO UserInfo VALUES(@UserName,@PersonID,@Telephone,@Address)
			SET @UID=@@IDENTITY
			PRINT @UID 
			END
		
		--执行存储过程生成银行卡号	
		EXEC Proc_CreateCardNumber @CN OUTPUT
		SET @CN='9876'+@CN
		
		--插入银行卡信息到银行卡表
		INSERT INTO CardInfo(CardNumber,OpenMoney,Balance,[Password],IsLock,CustomerID)
					VALUES(@CN,@Money,@Money,@Password,1,@UID)	
END


--存款存储过程
---------------------------------------------------------------------------------------------

--存款存储过程
CREATE PROCEDURE Proc_SaveMoney
@CN    VARCHAR(15),
@Money DECIMAL(18,2)
AS

BEGIN
	--对银行卡信息表的卡号更新余额操作
	UPDATE CardInfo
	SET Balance=Balance+@Money
	where CardNumber=@CN
	
	--插入交易记录表，银行卡号，交易金额
	INSERT INTO TransInfo(CardNumber,TransType,TransMoney)
				VALUES(@CN,'存入',@Money)

END



--取款存储过程
---------------------------------------------------------------------------------------------

--取款存储过程
CREATE PROCEDURE Proc_GetMoney
@CN    VARCHAR(15),
@Money DECIMAL(18,2)
AS

BEGIN
	--对银行卡信息表的卡号更新余额操作
	UPDATE CardInfo
	SET Balance=Balance-@Money
	where CardNumber=@CN
	
	IF(@@ERROR=0)
	BEGIN
			--插入交易记录表，银行卡号，交易金额
			INSERT INTO TransInfo(CardNumber,TransType,TransMoney)
					VALUES(@CN,'支出',@Money)
	
	END
END


--转账存储过程
-----------------------------------------------------------------------------------------------


--转账存储过程
CREATE PROCEDURE Proc_TransFerAccount
@OutNumber VARCHAR(15),		--源卡号
@InNumer   VARCHAR(15),		--目的卡号
@Money	   DECIMAL(18,2)    --转账金额

AS
BEGIN
		--事物开始
		BEGIN TRANSACTION
		
		--源卡号金额扣除
		UPDATE CardInfo
		SET Balance=Balance-@Money
		where CardNumber=@OutNumber
		
		--目的卡号金额增加
		UPDATE CardInfo
		SET Balance=Balance+@Money
		where CardNumber=@InNumer
		
		--目的卡号转入记录
		INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark)
					VALUES(@InNumer,'转入',@Money,@OutNumber)
		
		--源卡号转出记录			
		INSERT INTO TransInfo(CardNumber,TransType,TransMoney,Remark)
					VALUES(@OutNumber,'转出',@Money,@InNumer)
					
		IF(@@ERROR=0)
			COMMIT TRANSACTION			--事物成功
		ELSE
			ROLLBACK TRANSACTION		--事物失败，回滚操作

							
END
--------------------------------------------------------------------------------------------------</code></pre> 
  <p><br> &nbsp;</p> 
  <pre><code class="language-cpp">--插入数据
use db_bank
go

DECLARE @cardNumber VARCHAR(15)
EXEC Proc_CreateCard 
@UserName='张月关',
@PersonID='410156190012056548',
@Telephone='010-32586458',
@Address='北京海定',
@money=100,
@cn=@cardNumber OUTPUT
PRINT '卡号为:'+@cardNumber

go

DECLARE @cardNumber VARCHAR(15)
EXEC Proc_CreateCard 
@UserName='李四平',
@personID='120325201206023254',
@Telephone='12222222222',
@Address='河南郑州',
@money=1,
@cn=@cardNumber OUTPUT
PRINT '卡号为:'+@cardNumber

go
DECLARE @cardNumber VARCHAR(15)
EXEC Proc_CreateCard
@UserName='祝涛',
@PersonID='325156198201253288',
@Telephone='0371-25863214',
@Address='河南郑州',
@money=20000,
@cn=@cardNumber OUTPUT 
PRINT '卡号为:'+@cardNumber

go

DECLARE @cardNumber VARCHAR(15)
EXEC Proc_CreateCard
@UserName='刘明',
@PersonID='658254195511153265',
@Telephone='0521-32651478',
@Address='河南郑州',
@money=1000,
@cn=@cardNumber OUTPUT
PRINT '卡号为:'+@cardNumber

go</code></pre> 
  <p><br><img alt="" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20150722202821327"></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <pre><code class="language-cpp">--存款操作
EXEC Proc_SaveMoney '987672650464229',5000
EXEC Proc_SaveMoney '987672669097200',1200
EXEC Proc_SaveMoney '987672682140280',1000
EXEC Proc_SaveMoney '987672700773251',1500</code></pre> 
  <p><br><img alt="" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20150722202928718"></p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <pre><code class="language-cpp">--取款操作
EXEC Proc_GetMoney '987672650464229',100
EXEC Proc_GetMoney '987672669097200',200
EXEC Proc_GetMoney '987672682140280',300
EXEC Proc_GetMoney '987672700773251',400</code></pre> 
  <p><br><img alt="" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20150722203250494"></p> 
  <p>&nbsp;</p> 
  <pre><code class="language-cpp">--转账操作
EXEC Proc_TransferAccount '987672650464229','987672669097200',100</code></pre> 
  <p><br><img alt="" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20150722203430845"></p> 
  <p>&nbsp;</p> 
  <pre><code class="language-cpp">--查询交易记录视图
CREATE VIEW View_TransInfo
AS
select u.UserName,T.* from TransInfo T,UserInfo U,CardInfo C
where T.CardNumber=C.CardNumber AND C.CustomerID=U.ID

--执行查询交易记录
select * from View_TransInfo where CardNumber='987672650464229'</code></pre> 
  <p><img alt="" src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20150722203618117"><br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq125096885/article/details/47008405,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/qq125096885/article/details/47008405,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

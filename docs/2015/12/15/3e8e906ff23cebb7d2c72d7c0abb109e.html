<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>PBOC3.0 SM2 算法各种证书、数字签名的验证 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="PBOC3.0 SM2 算法各种证书、数字签名的验证" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1、关于SM2 &nbsp; &nbsp; SM2算法是一种非对称算法，与国际算法里中的RSA相对应。 &nbsp;&nbsp;&nbsp; SM2推荐的曲线参数如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp;在验证PBOC卡片中的发卡行公钥证书、IC卡公钥证书、签名的静态应用数据、签名的动态数据之前，先来了解一下PBOC规范中对数字签名的验证过程，如下图： &nbsp; &nbsp;（该图参考PBOC第17部分） &nbsp; &nbsp; 此处的a，b，xG，yG即SM2推荐曲线参数中的a，b，Gx，Gy ；而xA，yA分别为公钥的左半部分和右半部分。可以看出，ENTLA、IDA，a，b，xG，yG都是固定值，而xA，yA则因为公钥的不同而变化。 2、借贷记交易流程，准备阶段 &nbsp; &nbsp; 先按借贷记交易流程，发GPO指令，获取AFL，然后读取相关的记录 PDOL=9F66049F02069F03069F1A0295055F2A029A039C019F3704DF6001DF6901 [GPO] SendAPDU=80A800002583235600000000000001000000000000000001560000000000015615121160010203040001 ReValue=80167C000801020010080A01100707001801010018040600 AFL=0801020010080A01100707001801010018040600 0101=70155713623061571010011182D221122070956101322F 0102=704C9F6128202000000000000000000000000000000000000000000000000000000000000000000000000000009F6201005F201A0000000000000000000000000000000000000000000000000000 0208=7081875F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 0209=704993431362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D9F4A0182 020A=70819C9F46819414623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF9F470103 0207=70045F340101 0301=70105F300202209F420201569F49039F3704 0304=70089F1401009F230100 0305=70819190818E12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D 0306=701A8F01189F3201039F631030343233333331300000000000000000 Tag8F=18 PK_CA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B 说明： PK_CA=CA公钥 PK_Issuer=发卡行公钥 PK_IC=IC卡公钥 3、验证发卡行公钥证书Tag90 &nbsp; &nbsp; 发卡行公钥证书的格式如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; （该图参考PBOC第17部分） &nbsp; &nbsp; 根据“表4”的格式，可以从发卡行公钥证书中得到发卡行公钥、数字签名r||s。 Tag90=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 r||s=114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D （该图参考PBOC第17部分） 根据“表1”可知，发卡行公钥证书中的签名是由CA私钥签名的，所以应该用CA公钥解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程：&nbsp; ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xCA+yCA]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xCA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D28 yCA=0FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B ZA=SM3[ENTLA+IDA+a+b+xG+yG+xCA+yCA] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A037710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B] =320A0ADACC0A5FBC783FEBE18DA52138B82FB66ECA74ED5A556F53600390B5D7 根据“表1”，可以得到待签名的数据，也就是MSG。 MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 h = SM3 [ZA||MSG]； h=7E4EA4C8CE6CC2AC98C32CB55F1AEF8ECC6797C0FE3336D59D33E6CAAEBC39DC S= r || s 现在，PK_CA、h、S都是已知的，就可以用函数Verify (PK_CA) [ h,S ]来验证签名是否正确了。 （结果是签名验证成功） 4、验证签名的静态应用数据Tag93 &nbsp; &nbsp; 签名的静态应用数据（Tag93）格式如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到Tag93的值。 Tag93=1362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D &nbsp; &nbsp; 根据“表5”的格式，获取数字签名r||s。 r||s=7154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D &nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。 PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 根据“表2”可知，静态应用数据是由发卡行私钥签名的，所以要用发卡行公钥来解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xPK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF yPK_Issuer=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345] =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8 &nbsp; &nbsp; “表2”中“需认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。 &nbsp; &nbsp; 根据“表2”，可以得到待签名的数据，也就是MSG。 MSG= 1362305F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 h = SM3 [ZA||MSG]； h= AFB08413485539F74EE7D6C9F5D3199C86185F6579DECA94B65A389FFDF39B10 S= r || s 现在，PK_Issuer、h、S都是已知的，就可以用函数Verify ( PK_Issuer ) [ h, S ]来验证签名是否正确了。 （结果是签名验证成功） 5、验证IC卡公钥证书Tag9F46 &nbsp; &nbsp; IC卡公钥证书格式如下：&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到IC卡公钥证书Tag9F46的值。 Tag9F46=14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF &nbsp; &nbsp; 根据“表8”的格式，可以获取IC卡公钥PK_IC以及数字签名r||s。 PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C r||s=F4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。 PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 根据“表6”可知，IC卡公钥是由发卡行私钥签名的，所以要用发卡行公钥来解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xPK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF yPK_Issuer=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 ZA=SM3[ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345] =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8 “表6”中“参与脱机数据认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。 根据“表2”，可以得到待签名的数据，也就是MSG。 MSG= 14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C5F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 h = SM3 [ZA||MSG]； h= 7FC10B13983FBB801209EB41B62CA38A214313D2C307330A03A16A4F0EBC4A2E S= r || s 现在，PK_Issuer、h、S都是已知的，就可以用函数Verify(&nbsp;PK_Issuer&nbsp;)[h,S]来验证签名是否正确了。 （结果是签名验证成功） 6、验证签名的动态应用数据Tag9F4B（借贷记交易流程） &nbsp; &nbsp; 标准借贷记交易中，9F4B通过内容认证指令产生。 SendAPDU=008800000401020304&nbsp; ReValue=80451503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 根据返回的数据，可知9F4B的内容如下： 9F4B=1503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 签名的动态应用数据9F4B的格式如下： &nbsp; &nbsp; 根据“表11”的格式，可以获取数字签名r||s。 r||s=F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 根据上面第5步，可以得到IC卡行公钥。 PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xIC= E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD yIC= 5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C] =52957BB5894D5AC693F35CBC91D59D12D29041AEFAC408954E303FB77CC3544F 根据“表9”，可以得到待签名的数据，也就是MSG。 MSG=150302006801020304 h = SM3 [ZA||MSG]； h= 133652D963731ABB5513E527B266287F129A0CA89E5D3D23602EE060AF4AA149 S= r || s 现在，PK_IC、h、S都是已知的，就可以用函数Verify(&nbsp;PK_IC&nbsp;&nbsp;)[h,S]来验证签名是否正确了。 （结果是签名验证成功） 阅读更多" />
<meta property="og:description" content="1、关于SM2 &nbsp; &nbsp; SM2算法是一种非对称算法，与国际算法里中的RSA相对应。 &nbsp;&nbsp;&nbsp; SM2推荐的曲线参数如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp;在验证PBOC卡片中的发卡行公钥证书、IC卡公钥证书、签名的静态应用数据、签名的动态数据之前，先来了解一下PBOC规范中对数字签名的验证过程，如下图： &nbsp; &nbsp;（该图参考PBOC第17部分） &nbsp; &nbsp; 此处的a，b，xG，yG即SM2推荐曲线参数中的a，b，Gx，Gy ；而xA，yA分别为公钥的左半部分和右半部分。可以看出，ENTLA、IDA，a，b，xG，yG都是固定值，而xA，yA则因为公钥的不同而变化。 2、借贷记交易流程，准备阶段 &nbsp; &nbsp; 先按借贷记交易流程，发GPO指令，获取AFL，然后读取相关的记录 PDOL=9F66049F02069F03069F1A0295055F2A029A039C019F3704DF6001DF6901 [GPO] SendAPDU=80A800002583235600000000000001000000000000000001560000000000015615121160010203040001 ReValue=80167C000801020010080A01100707001801010018040600 AFL=0801020010080A01100707001801010018040600 0101=70155713623061571010011182D221122070956101322F 0102=704C9F6128202000000000000000000000000000000000000000000000000000000000000000000000000000009F6201005F201A0000000000000000000000000000000000000000000000000000 0208=7081875F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 0209=704993431362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D9F4A0182 020A=70819C9F46819414623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF9F470103 0207=70045F340101 0301=70105F300202209F420201569F49039F3704 0304=70089F1401009F230100 0305=70819190818E12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D 0306=701A8F01189F3201039F631030343233333331300000000000000000 Tag8F=18 PK_CA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B 说明： PK_CA=CA公钥 PK_Issuer=发卡行公钥 PK_IC=IC卡公钥 3、验证发卡行公钥证书Tag90 &nbsp; &nbsp; 发卡行公钥证书的格式如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; （该图参考PBOC第17部分） &nbsp; &nbsp; 根据“表4”的格式，可以从发卡行公钥证书中得到发卡行公钥、数字签名r||s。 Tag90=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 r||s=114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D （该图参考PBOC第17部分） 根据“表1”可知，发卡行公钥证书中的签名是由CA私钥签名的，所以应该用CA公钥解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程：&nbsp; ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xCA+yCA]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xCA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D28 yCA=0FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B ZA=SM3[ENTLA+IDA+a+b+xG+yG+xCA+yCA] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A037710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B] =320A0ADACC0A5FBC783FEBE18DA52138B82FB66ECA74ED5A556F53600390B5D7 根据“表1”，可以得到待签名的数据，也就是MSG。 MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 h = SM3 [ZA||MSG]； h=7E4EA4C8CE6CC2AC98C32CB55F1AEF8ECC6797C0FE3336D59D33E6CAAEBC39DC S= r || s 现在，PK_CA、h、S都是已知的，就可以用函数Verify (PK_CA) [ h,S ]来验证签名是否正确了。 （结果是签名验证成功） 4、验证签名的静态应用数据Tag93 &nbsp; &nbsp; 签名的静态应用数据（Tag93）格式如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到Tag93的值。 Tag93=1362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D &nbsp; &nbsp; 根据“表5”的格式，获取数字签名r||s。 r||s=7154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D &nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。 PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 根据“表2”可知，静态应用数据是由发卡行私钥签名的，所以要用发卡行公钥来解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xPK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF yPK_Issuer=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345] =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8 &nbsp; &nbsp; “表2”中“需认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。 &nbsp; &nbsp; 根据“表2”，可以得到待签名的数据，也就是MSG。 MSG= 1362305F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 h = SM3 [ZA||MSG]； h= AFB08413485539F74EE7D6C9F5D3199C86185F6579DECA94B65A389FFDF39B10 S= r || s 现在，PK_Issuer、h、S都是已知的，就可以用函数Verify ( PK_Issuer ) [ h, S ]来验证签名是否正确了。 （结果是签名验证成功） 5、验证IC卡公钥证书Tag9F46 &nbsp; &nbsp; IC卡公钥证书格式如下：&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到IC卡公钥证书Tag9F46的值。 Tag9F46=14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF &nbsp; &nbsp; 根据“表8”的格式，可以获取IC卡公钥PK_IC以及数字签名r||s。 PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C r||s=F4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。 PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 根据“表6”可知，IC卡公钥是由发卡行私钥签名的，所以要用发卡行公钥来解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xPK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF yPK_Issuer=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 ZA=SM3[ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345] =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8 “表6”中“参与脱机数据认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。 根据“表2”，可以得到待签名的数据，也就是MSG。 MSG= 14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C5F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 h = SM3 [ZA||MSG]； h= 7FC10B13983FBB801209EB41B62CA38A214313D2C307330A03A16A4F0EBC4A2E S= r || s 现在，PK_Issuer、h、S都是已知的，就可以用函数Verify(&nbsp;PK_Issuer&nbsp;)[h,S]来验证签名是否正确了。 （结果是签名验证成功） 6、验证签名的动态应用数据Tag9F4B（借贷记交易流程） &nbsp; &nbsp; 标准借贷记交易中，9F4B通过内容认证指令产生。 SendAPDU=008800000401020304&nbsp; ReValue=80451503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 根据返回的数据，可知9F4B的内容如下： 9F4B=1503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 签名的动态应用数据9F4B的格式如下： &nbsp; &nbsp; 根据“表11”的格式，可以获取数字签名r||s。 r||s=F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 根据上面第5步，可以得到IC卡行公钥。 PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xIC= E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD yIC= 5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C] =52957BB5894D5AC693F35CBC91D59D12D29041AEFAC408954E303FB77CC3544F 根据“表9”，可以得到待签名的数据，也就是MSG。 MSG=150302006801020304 h = SM3 [ZA||MSG]； h= 133652D963731ABB5513E527B266287F129A0CA89E5D3D23602EE060AF4AA149 S= r || s 现在，PK_IC、h、S都是已知的，就可以用函数Verify(&nbsp;PK_IC&nbsp;&nbsp;)[h,S]来验证签名是否正确了。 （结果是签名验证成功） 阅读更多" />
<link rel="canonical" href="https://mlh.app/2015/12/15/3e8e906ff23cebb7d2c72d7c0abb109e.html" />
<meta property="og:url" content="https://mlh.app/2015/12/15/3e8e906ff23cebb7d2c72d7c0abb109e.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-12-15T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"1、关于SM2 &nbsp; &nbsp; SM2算法是一种非对称算法，与国际算法里中的RSA相对应。 &nbsp;&nbsp;&nbsp; SM2推荐的曲线参数如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp;在验证PBOC卡片中的发卡行公钥证书、IC卡公钥证书、签名的静态应用数据、签名的动态数据之前，先来了解一下PBOC规范中对数字签名的验证过程，如下图： &nbsp; &nbsp;（该图参考PBOC第17部分） &nbsp; &nbsp; 此处的a，b，xG，yG即SM2推荐曲线参数中的a，b，Gx，Gy ；而xA，yA分别为公钥的左半部分和右半部分。可以看出，ENTLA、IDA，a，b，xG，yG都是固定值，而xA，yA则因为公钥的不同而变化。 2、借贷记交易流程，准备阶段 &nbsp; &nbsp; 先按借贷记交易流程，发GPO指令，获取AFL，然后读取相关的记录 PDOL=9F66049F02069F03069F1A0295055F2A029A039C019F3704DF6001DF6901 [GPO] SendAPDU=80A800002583235600000000000001000000000000000001560000000000015615121160010203040001 ReValue=80167C000801020010080A01100707001801010018040600 AFL=0801020010080A01100707001801010018040600 0101=70155713623061571010011182D221122070956101322F 0102=704C9F6128202000000000000000000000000000000000000000000000000000000000000000000000000000009F6201005F201A0000000000000000000000000000000000000000000000000000 0208=7081875F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103 0209=704993431362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D9F4A0182 020A=70819C9F46819414623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF9F470103 0207=70045F340101 0301=70105F300202209F420201569F49039F3704 0304=70089F1401009F230100 0305=70819190818E12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D 0306=701A8F01189F3201039F631030343233333331300000000000000000 Tag8F=18 PK_CA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B 说明： PK_CA=CA公钥 PK_Issuer=发卡行公钥 PK_IC=IC卡公钥 3、验证发卡行公钥证书Tag90 &nbsp; &nbsp; 发卡行公钥证书的格式如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; （该图参考PBOC第17部分） &nbsp; &nbsp; 根据“表4”的格式，可以从发卡行公钥证书中得到发卡行公钥、数字签名r||s。 Tag90=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 r||s=114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D （该图参考PBOC第17部分） 根据“表1”可知，发卡行公钥证书中的签名是由CA私钥签名的，所以应该用CA公钥解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程：&nbsp; ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xCA+yCA]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xCA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D28 yCA=0FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B ZA=SM3[ENTLA+IDA+a+b+xG+yG+xCA+yCA] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A037710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B] =320A0ADACC0A5FBC783FEBE18DA52138B82FB66ECA74ED5A556F53600390B5D7 根据“表1”，可以得到待签名的数据，也就是MSG。 MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 h = SM3 [ZA||MSG]； h=7E4EA4C8CE6CC2AC98C32CB55F1AEF8ECC6797C0FE3336D59D33E6CAAEBC39DC S= r || s 现在，PK_CA、h、S都是已知的，就可以用函数Verify (PK_CA) [ h,S ]来验证签名是否正确了。 （结果是签名验证成功） 4、验证签名的静态应用数据Tag93 &nbsp; &nbsp; 签名的静态应用数据（Tag93）格式如下： &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到Tag93的值。 Tag93=1362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D &nbsp; &nbsp; 根据“表5”的格式，获取数字签名r||s。 r||s=7154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D &nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。 PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 根据“表2”可知，静态应用数据是由发卡行私钥签名的，所以要用发卡行公钥来解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xPK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF yPK_Issuer=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345] =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8 &nbsp; &nbsp; “表2”中“需认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。 &nbsp; &nbsp; 根据“表2”，可以得到待签名的数据，也就是MSG。 MSG= 1362305F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 h = SM3 [ZA||MSG]； h= AFB08413485539F74EE7D6C9F5D3199C86185F6579DECA94B65A389FFDF39B10 S= r || s 现在，PK_Issuer、h、S都是已知的，就可以用函数Verify ( PK_Issuer ) [ h, S ]来验证签名是否正确了。 （结果是签名验证成功） 5、验证IC卡公钥证书Tag9F46 &nbsp; &nbsp; IC卡公钥证书格式如下：&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到IC卡公钥证书Tag9F46的值。 Tag9F46=14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF &nbsp; &nbsp; 根据“表8”的格式，可以获取IC卡公钥PK_IC以及数字签名r||s。 PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C r||s=F4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。 PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 根据“表6”可知，IC卡公钥是由发卡行私钥签名的，所以要用发卡行公钥来解签。 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xPK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF yPK_Issuer=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345 ZA=SM3[ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345] =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8 “表6”中“参与脱机数据认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。 根据“表2”，可以得到待签名的数据，也就是MSG。 MSG= 14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C5F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00 h = SM3 [ZA||MSG]； h= 7FC10B13983FBB801209EB41B62CA38A214313D2C307330A03A16A4F0EBC4A2E S= r || s 现在，PK_Issuer、h、S都是已知的，就可以用函数Verify(&nbsp;PK_Issuer&nbsp;)[h,S]来验证签名是否正确了。 （结果是签名验证成功） 6、验证签名的动态应用数据Tag9F4B（借贷记交易流程） &nbsp; &nbsp; 标准借贷记交易中，9F4B通过内容认证指令产生。 SendAPDU=008800000401020304&nbsp; ReValue=80451503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 根据返回的数据，可知9F4B的内容如下： 9F4B=1503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 签名的动态应用数据9F4B的格式如下： &nbsp; &nbsp; 根据“表11”的格式，可以获取数字签名r||s。 r||s=F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107 &nbsp; &nbsp; 根据上面第5步，可以得到IC卡行公钥。 PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C 现在我们来根据公式h = SM3 [ZA||MSG]计算哈希值，根据签名的验证过程： ZA = SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC]； ENTLA=0080 IDA=31323334353637383132333435363738 a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93 xG=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7 yG=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0 xIC= E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD yIC= 5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC] =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C] =52957BB5894D5AC693F35CBC91D59D12D29041AEFAC408954E303FB77CC3544F 根据“表9”，可以得到待签名的数据，也就是MSG。 MSG=150302006801020304 h = SM3 [ZA||MSG]； h= 133652D963731ABB5513E527B266287F129A0CA89E5D3D23602EE060AF4AA149 S= r || s 现在，PK_IC、h、S都是已知的，就可以用函数Verify(&nbsp;PK_IC&nbsp;&nbsp;)[h,S]来验证签名是否正确了。 （结果是签名验证成功） 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2015/12/15/3e8e906ff23cebb7d2c72d7c0abb109e.html","headline":"PBOC3.0 SM2 算法各种证书、数字签名的验证","dateModified":"2015-12-15T00:00:00+08:00","datePublished":"2015-12-15T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2015/12/15/3e8e906ff23cebb7d2c72d7c0abb109e.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>PBOC3.0 SM2 算法各种证书、数字签名的验证</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <h1><strong><span style="color:rgb(255,0,0);"><span style="font-family:'Microsoft YaHei';font-size:24px;">1、关于SM2</span></span></strong></h1> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; SM2算法是一种非对称算法，与国际算法里中的RSA相对应。</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp;&nbsp;&nbsp; SM2推荐的曲线参数如下：</span></p> 
  <p>&nbsp; &nbsp;&nbsp;<img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151215212738543" alt=""></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp;&nbsp;在验证PBOC卡片中的发卡行公钥证书、IC卡公钥证书、签名的静态应用数据、签名的动态数据之前，先来了解一下PBOC规范中对数字签名的验证过程，如下图：</span></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151215212816268" alt=""><br></p> 
  <p></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;background-color:rgb(255,255,255);">&nbsp; &nbsp;</span><span style="font-family:'Microsoft YaHei';font-size:10px;color:#3333ff;background-color:rgb(255,255,255);">（该图参考PBOC第17部分）</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;background-color:rgb(255,255,255);">&nbsp; &nbsp; 此处的a，b，x<sub>G，</sub>y<sub>G</sub>即SM2推荐曲线参数中的a，b，G<sub>x，</sub>G<sub>y ；</sub>而x<sub>A，</sub>y<sub>A</sub>分别为公钥的左半部分和右半部分。可以看出，ENTL<sub>A</sub>、ID<sub>A</sub>，a，b，x<sub>G，</sub>y<sub>G</sub>都是固定值，而x<sub>A，</sub>y<sub>A</sub>则因为公钥的不同而变化。</span></p> 
  <p><br></p> 
  <p></p> 
  <h1><span style="font-family:'Microsoft YaHei';color:#ff0000;">2、借贷记交易流程，准备阶段</span></h1> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;">&nbsp; &nbsp; <span style="color:#3333ff;"> 先按借贷记交易流程，发GPO指令，获取AFL，然后读取相关的记录</span></span></p> 
  <p></p> 
  <pre><code class="language-cpp">PDOL=9F66049F02069F03069F1A0295055F2A029A039C019F3704DF6001DF6901
[GPO]
SendAPDU=80A800002583235600000000000001000000000000000001560000000000015615121160010203040001
ReValue=80167C000801020010080A01100707001801010018040600
AFL=0801020010080A01100707001801010018040600
0101=70155713623061571010011182D221122070956101322F
0102=704C9F6128202000000000000000000000000000000000000000000000000000000000000000000000000000009F6201005F201A0000000000000000000000000000000000000000000000000000
0208=7081875F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F2103
0209=704993431362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D9F4A0182
020A=70819C9F46819414623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF9F470103
0207=70045F340101
0301=70105F300202209F420201569F49039F3704
0304=70089F1401009F230100
0305=70819190818E12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D
0306=701A8F01189F3201039F631030343233333331300000000000000000
</code></pre>
  <br>
  <pre><code class="language-cpp">Tag8F=18
PK_CA=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B
</code></pre> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">说明：</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">PK_CA=CA公钥</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">PK_Issuer=发卡行公钥</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">PK_IC=IC卡公钥</span></p> 
  <br>
  <p></p> 
  <h1><strong><span style="font-family:'Microsoft YaHei';color:#ff0000;">3、验证发卡行公钥证书Tag90</span></strong></h1> 
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 发卡行公钥证书的格式如下：</span></p> &nbsp; &nbsp;&nbsp;
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151215214714383?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">
  <br>
  <p></p> 
  <p></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; </span> <span style="font-family:'Microsoft YaHei';font-size:14px;color:#3333ff;">（该图参考PBOC第17部分）</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 根据“表4”的格式，可以从发卡行公钥证书中得到发卡行公钥、数字签名r||s。</span></p> 
  <br>
  <p></p> 
  <pre><code class="language-cpp">Tag90=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D
PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345
r||s=114EC47C751CC851B36647E9940D9EF725FA0DDC875B3FC466918E5E498162FF981654AC77431C488CD96F129B3412452656A945B78A1C9D5A880EB9278DFE3D
</code></pre>
  <br>
  <img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151215214722894?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="">
  <br>
  <p></p> 
  <p></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:14px;color:#3333ff;">（该图参考PBOC第17部分）</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">根据“表1”可知，发卡行公钥证书中的签名是由CA私钥签名的，所以应该用CA公钥解签。<br></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在我们来根据公式h = SM3 [Z<sub>A</sub>||MSG]计算哈希值，根据签名的验证过程：&nbsp;</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;"></span></p> 
  <p><span style="font-size:18px;"><span style="color:#0000FF;">Z<sub>A</sub></span><span style="color:#3333ff;"> = SM3 [ENTL</span><sub style="color:rgb(51,51,255);">A</sub><span style="color:#3333ff;">+ID</span><sub style="color:rgb(51,51,255);">A</sub><span style="color:#3333ff;">+a+b+x</span><sub style="color:rgb(51,51,255);">G</sub><span style="color:#3333ff;">+y</span><sub style="color:rgb(51,51,255);">G</sub><span style="color:#3333ff;">+</span><span style="color:#ff0000;">x<sub>CA</sub></span><span style="color:#3333ff;">+</span><span style="color:#ff0000;">y<sub>CA</sub></span><span style="color:#3333ff;">]；</span></span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ENTL<sub>A</sub>=0080</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ID<sub>A</sub>=31323334353637383132333435363738</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">x<sub>G</sub>=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">y<sub>G</sub>=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x<sub>CA</sub></span><span style="color:#3333ff;">=37710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D28</span></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">y<sub>CA</sub></span><span style="color:#3333ff;">=0FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B</span></span></p> 
  <p align="left"><br></p> 
  <pre><code class="language-cpp">ZA=SM3[ENTLA+IDA+a+b+xG+yG+xCA+yCA]
  =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A037710FEB7CC3617767874E85509C268E8F931D68773E93A89F39A4247DFE2D280FC5BC838353885B6DAD447C8F90116BD9D314047591989F67F319544D42A48B]
  =320A0ADACC0A5FBC783FEBE18DA52138B82FB66ECA74ED5A556F53600390B5D7</code></pre>
  <br>
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">根据“表1”，可以得到待签名的数据，也就是MSG。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;"></span></p> 
  <pre><code class="language-cpp">MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345</code></pre>
  <br>
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">MSG=12623061FF1230000451040011409B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h = SM3 [Z<sub>A</sub>||MSG]；</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h=7E4EA4C8CE6CC2AC98C32CB55F1AEF8ECC6797C0FE3336D59D33E6CAAEBC39DC</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">S= r || s</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在，PK_CA、h、S都是已知的，就可以用函数Verify (PK_CA) [ h,S ]来验证签名是否正确了。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">（结果是签名验证成功）</span></p> 
  <p><br></p> 
  <p></p> 
  <h1><strong><span style="font-family:'Microsoft YaHei';color:#ff0000;">4、验证签名的静态应用数据Tag93</span></strong></h1> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;background-color:rgb(255,255,255);">&nbsp; &nbsp; 签名的静态应用数据（Tag93）格式如下：</span></p> 
  <p align="left"><span style="color:#0000FF;">&nbsp; &nbsp;&nbsp;<img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151216122643038" alt=""><br></span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到Tag93的值。</span></p> 
  <p></p> 
  <pre><code class="language-cpp">Tag93=1362307154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D</code></pre> 
  <p></p> 
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 根据“表5”的格式，获取数字签名r||s。</span></p> 
  <p></p> 
  <pre><code class="language-cpp">r||s=7154E77EB80F6F446B2D2B232DA33879940012B4AE59B6B01B7974549443F2A1631BE870B1D17E36DB4B0102BAECA504863E2EDCF96251BFA2EB8370F710A41D</code></pre>
  <br>
  <span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。</span> 
  <p></p> 
  <p></p> 
  <pre><code class="language-cpp">PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345
</code></pre>
  <br>
  <br>
  <p></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151216123610869" alt=""><br></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">根据“表2”可知，静态应用数据是由发卡行私钥签名的，所以要用发卡行公钥来解签。</span></p> 
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在我们来根据公式h = SM3 [Z<sub>A</sub>||MSG]计算哈希值，根据签名的验证过程：</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">Z<sub>A</sub> = SM3 [ENTL<sub>A</sub>+ID<sub>A</sub>+a+b+x<sub>G</sub>+y<sub>G</sub>+</span><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x</span><sub style="color:rgb(255,0,0);">PK_Issuer</sub><span style="color:#3333ff;">+</span><span style="color:#ff0000;">y<sub>PK_Issuer</sub></span><span style="color:#3333ff;">]；</span></span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ENTL<sub>A</sub>=0080</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ID<sub>A</sub>=31323334353637383132333435363738</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">x<sub>G</sub>=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">y<sub>G</sub>=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x<sub>PK_Issuer</sub></span><span style="color:#3333ff;">=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF</span></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">y<sub>PK_Issuer</sub></span><span style="color:#3333ff;">=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345</span></span></p> 
  <p></p> 
  <pre><code class="language-cpp">ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]
  =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345]
  =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8
</code></pre>
  <br>
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; “表2”中“需认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 根据“表2”，可以得到待签名的数据，也就是MSG。</span></p> 
  <p align="left"></p> 
  <pre><code class="language-cpp">MSG= 1362305F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00</code></pre>
  <br>
  <br>
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h = SM3 [Z<sub>A</sub>||MSG]；</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h= AFB08413485539F74EE7D6C9F5D3199C86185F6579DECA94B65A389FFDF39B10</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">S= r || s</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在，PK_Issuer、h、S都是已知的，就可以用函数Verify ( </span><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">PK_Issuer</span></span><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;"> ) [ h, S ]来验证签名是否正确了。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">（结果是签名验证成功）</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;"><br></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;"><br></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';"></span></p> 
  <h1><strong><span style="font-size:24px;color:#ff0000;">5、验证IC卡公钥证书Tag9F46</span></strong></h1> 
  <p></p> 
  <p align="left" style="color:rgb(51,51,255);font-size:18px;">&nbsp; &nbsp; IC卡公钥证书<span style="color:#0000FF;">格式如下：&nbsp;</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp;<img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151216124438238" alt=""><br></span></p> 
  <span style="color:rgb(51,51,255);font-family:'Microsoft YaHei';font-size:18px;">&nbsp; &nbsp; 根据上面第2步读取的记录内容，可以得到IC卡公钥证书Tag9F46的值。</span>
  <br>
  <p></p>
  <pre><code class="language-cpp">Tag9F46=14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815CF4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF</code></pre>
  <span style="color:rgb(51,51,255);font-family:'Microsoft YaHei';font-size:18px;">&nbsp; &nbsp; 根据“表8”的格式，可以获取IC卡公钥PK_IC以及数字签名r||s。</span>
  <br>
  <pre><code class="language-cpp">PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C
r||s=F4C2638164896895A5B8A662939A920FEAEFEB0A96D2337A3507F5311293C7E683A83DC15D89ED99C0250D7927A8DBD54265A24FB4DDC4A4B28CE5B8C59DE6EF
</code></pre>&nbsp; &nbsp; &nbsp;
  <br>
  <span style="font-family:'Microsoft YaHei';font-size:18px;color:rgb(51,51,255);">&nbsp; &nbsp; 根据上面第3步，可以得到 发卡行公钥。</span> 
  <p></p> 
  <p></p> 
  <pre><code class="language-cpp">PK_Issuer=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345
</code></pre>
  <br>
  <br>
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151216124442643" alt=""><br></p> 
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">根据“表6”可知，IC卡公钥是由发卡行私钥签名的，所以要用发卡行公钥来解签。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在我们来根据公式h = SM3 [Z<sub>A</sub>||MSG]计算哈希值，根据签名的验证过程：</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">Z<sub>A</sub> = SM3 [ENTL<sub>A</sub>+ID<sub>A</sub>+a+b+x<sub>G</sub>+y<sub>G</sub>+</span><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x<sub>PK_Issuer</sub></span><span style="color:#3333ff;">+</span><span style="color:#ff0000;">y<sub>PK_Issuer</sub></span><span style="color:#3333ff;">]；</span></span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ENTL<sub>A</sub>=0080</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ID<sub>A</sub>=31323334353637383132333435363738</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">x<sub>G</sub>=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">y<sub>G</sub>=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x<sub>PK_Issuer</sub></span><span style="color:#3333ff;">=9B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF</span></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">y<sub>PK_Issuer</sub></span><span style="color:#3333ff;">=8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345</span></span></p> 
  <pre><code class="language-cpp">ZA=SM3[ENTLA+IDA+a+b+xG+yG+xPK_Issuer+yPK_Issuer]
  =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A09B7EE1D2AE302EEEED9B97544A73BEF87A4D0A7B24749A4F065F7FBC5E3A16EF8CA7676DFC7C45D8FFAAC38D13340C70B0FEECEDA7AC8E896DE1A7D1A479B345]
  =7A96CBFCAEF87D8CDF4C5CC58A2F394154028B9067B563034D14A4DF7A67A6D8
</code></pre>
  <br>
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">“表6”中“参与脱机数据认证的静态数据”包括记录0208的内容（除去Tag70和Len）和AIP。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">根据“表2”，可以得到待签名的数据，也就是MSG。</span></p> 
  <p align="left"></p>
  <pre><code class="language-cpp">MSG= 14623061571010011182FF12300001FC04001140E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C5F24032211015F25031507245A096230615710100111829F0702FF008E0E000000000000000042031E031F009F0D05D8609CA8009F0E0500100000009F0F05D8689CF8005F280201569F080200308C1B9F02069F03069F1A0295055F2A029A039C019F37049F21039F4E148D1A8A029F02069F03069F1A0295055F2A029A039C019F37049F21037C00</code></pre>
  <br>
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h = SM3 [Z<sub>A</sub>||MSG]；</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h= 7FC10B13983FBB801209EB41B62CA38A214313D2C307330A03A16A4F0EBC4A2E</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">S= r || s</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在，PK_Issuer、h、S都是已知的，就可以用函数Verify(&nbsp;</span><span style="font-family:'Microsoft YaHei';font-size:18px;color:#ff0000;">PK_Issuer&nbsp;</span><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">)[h,S]来验证签名是否正确了。</span></p> 
  <span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">（结果是签名验证成功）</span>
  <br>
  <p><br></p> 
  <p></p> 
  <h1><strong><span style="font-family:'Microsoft YaHei';font-size:24px;color:#ff0000;">6、验证签名的动态应用数据Tag9F4B（借贷记交易流程）</span></strong></h1> 
  <p></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 标准借贷记交易中，9F4B通过内容认证指令产生。</span></p> 
  <p></p>
  <pre><code class="language-cpp">SendAPDU=008800000401020304&nbsp;</code></pre>
  <pre><code class="language-cpp">ReValue=80451503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107</code></pre>
  <br>
  <span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 根据返回的数据，可知9F4B的内容如下：</span> 
  <p></p>
  <pre><code class="language-cpp">9F4B=1503020068F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107</code></pre>
  <br>
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp; &nbsp; 签名的动态应用数据9F4B的格式如下：</span></p> 
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151216140817508" alt=""><br></p> 
  <p></p> 
  <p><span style="color:rgb(51,51,255);font-family:'Microsoft YaHei';font-size:18px;">&nbsp; &nbsp; 根据“表11”的格式，可以获取数字签名r||s。</span></p> 
  <p></p>
  <pre><code class="language-cpp">r||s=F72C221E2938BE6FD0317BD98C66C2C99713792EDEE66CA25FF97FC905F0F8C608D951777A060C9A498A207BA3B3F611CEAF1E48A6F809C6EC417EAB17851107</code></pre>
  <br>
  <span style="color:rgb(51,51,255);font-family:'Microsoft YaHei';font-size:18px;">&nbsp; &nbsp; 根据上面第5步，可以得到IC卡行公钥。</span> 
  <p align="left"></p>
  <pre><code class="language-cpp">PK_IC=E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C</code></pre>
  <br>
  <p><img src="https://blog.uzzz.org/_p?https://img-blog.csdn.net/20151216140823193" alt=""><br></p> 
  <p><br></p> 
  <p></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在我们来根据公式h = SM3 [Z<sub>A</sub>||MSG]计算哈希值，根据签名的验证过程：</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">Z<sub>A</sub> = SM3 [ENTL<sub>A</sub>+ID<sub>A</sub>+a+b+x<sub>G</sub>+y<sub>G</sub>+</span><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x<sub>IC</sub></span><span style="color:#3333ff;">+</span><span style="color:#ff0000;">y<sub>IC</sub></span><span style="color:#3333ff;">]；</span></span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ENTL<sub>A</sub>=0080</span></p> 
  <p><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">ID<sub>A</sub>=31323334353637383132333435363738</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">a=FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">b=28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">x<sub>G</sub>=32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">y<sub>G</sub>=BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">x<sub>IC</sub></span><span style="color:#3333ff;">= E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD</span></span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;"><span style="color:#ff0000;">y<sub>IC</sub></span><span style="color:#3333ff;">= 5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C</span></span></p> 
  <br>
  <p></p>
  <pre><code class="language-cpp">ZA=SM3 [ENTLA+IDA+a+b+xG+yG+xIC+yIC]
  =SM3[008031323334353637383132333435363738FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9332C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0E841B537350C40A54F0DA3A108D1168FCFB9C3AE354D29F6323D50F067F1CCCD5316F8F8E0D777B8AEAFAE8D4098DBF59B640362F659B83DA82D3D7EE0ED815C]
  =52957BB5894D5AC693F35CBC91D59D12D29041AEFAC408954E303FB77CC3544F
</code></pre>
  <br>
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">根据“表9”，可以得到待签名的数据，也就是MSG。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">MSG=150302006801020304</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h = SM3 [Z<sub>A</sub>||MSG]；</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">h= 133652D963731ABB5513E527B266287F129A0CA89E5D3D23602EE060AF4AA149</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">S= r || s</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">现在，PK_IC、h、S都是已知的，就可以用函数Verify(&nbsp;</span><span style="font-family:'Microsoft YaHei';font-size:18px;color:#ff0000;">PK_IC</span><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">&nbsp;&nbsp;)[h,S]来验证签名是否正确了。</span></p> 
  <p align="left"><span style="font-family:'Microsoft YaHei';font-size:18px;color:#3333ff;">（结果是签名验证成功）</span></p> 
  <br>
  <p><br></p> 
  <p><br></p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wenyangwangw/article/details/50320737,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/wenyangwangw/article/details/50320737,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

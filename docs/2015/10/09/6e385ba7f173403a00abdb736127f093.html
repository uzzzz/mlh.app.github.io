<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>中国银联全渠道系统商户接入 测试指引-银联网关支付产品 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="中国银联全渠道系统商户接入 测试指引-银联网关支付产品" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="直接把银联的联调测试文档贴来了 中国银联股份有限公司规范性文档 中国银联股份有限公司 发布 &nbsp; 中国银联全渠道系统商户接入 测试指引-银联网关支付产品 版本修订信息 版本号 完成日期 发布日期 变更说明 1.0.0 2014-7-03 2014-7-03 初稿 1.0.1 2014-11-04 2014-11-05 修改文档格式，新增测试地址与测试卡号等信息 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 目录 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文档说明... 6 1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;导读... 6 1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;阅读对象... 6 1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业务术语... 7 1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;技术服务... 7 1.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试模式划分... 7 1.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;支持获取途径... 8 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;联调步骤向导... 9 2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易开发... 9 2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试联调... 9 2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;切换上线... 9 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试参数与产品相关交易... 9 3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试与生产地址... 9 3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试卡号... 9 3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;产品相关交易... 10 3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;产品介绍... 11 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易模式说明... 11 4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通讯方式... 12 4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易流程... 12 4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台资金类交易流程... 13 4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台非资金类交易流程... 15 4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询交易流程... 15 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导... 16 5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易开发步骤... 16 5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台类异步交易接口开发步骤... 17 5.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台类同步交易接口开发步骤... 17 5.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单笔查询交易接口开发步骤... 18 5.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件传输类交流开发步骤... 18 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台应答与后台通知说明... 19 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明... 21 7.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易... 21 7.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台资金交易... 21 7.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台非资金交易... 21 7.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询交易... 21 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签名机制... 22 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;加密机制... 22 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明... 23 10.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;概述... 23 10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载及导出流程(ok)23 10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程... 23 10.2.2证书导出流程...27 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用... 32 11.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSP/JAVA.. 32 11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 32 11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明... 35 11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明... 38 11.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHP. 38 11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 38 11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明... 43 11.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASP.NET. 48 11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 49 11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明... 52 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答... 57 &nbsp; &nbsp; &nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 文档说明 1.1&nbsp;&nbsp; 导读 网关产品主要适用于持卡人在商户网站B2C购物支付场景，持卡通过点击银联在线支付logo，并在银联在线支付网关完成支付信息录入，最终完成支付。 从PC端发起的交易为WEB网关支付交易，从移动端发起的交易为WAP网关支付交易以及APP网关交易。 首次接入测试先了解前台交易与后台交易的区别，可参考第1.3章节业务术语描述，随后可从第5章节开发步骤向导开始阅读，了解开发过程中的具体操作步骤，此章节中提到的签名机制请参照第8章节。开发过程中需要用到的测试与生产交易地址请参考第11章节配置文件。交易测试卡号请参考第3.2章节。如开发与测试过程中遇到了解决不了的问题可在第12章节FAQ中查找解决方案，也可通过第1.4.2章节中的方法来获取测试支持。 1.2&nbsp;&nbsp; 阅读对象 《中国银联全渠道系统商户接入测试指引》文档是面向具有一定的网站开发能力的网站开发、维护和管理人员。 具体交易的接口、报文规范、响应码说明，请阅读开发包中接口文档。 参与方描述 &nbsp; 商户 指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》等协议开展银联无卡支付以及行业类应用业务的商户。 收单机构 指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》开展银联无卡支付收单业务的境内成员机构。 &nbsp; 1.3&nbsp;&nbsp; 业务术语 术语 解释 请求 通过 HTTP/HTTPS协议把需要传输的数据发送给接收方的过程。 应答 通过 HTTP/HTTPS协议把需要传输的数据返回给接收方的过程。 后台通知 服务器后台通知。中国银联全渠道系统根据得到的数据处理完成后，全渠道系统主动发起通知给商户的网站，同时携带处理完成的结果信息反馈给商户网站。 前台类交易 主要指用户需要参与交互的支付类交易，包括消费、预授权/担保消费交易。 后台类交易 主要指用户不需要参与交互，由商户后续发起的交易，包括消费撤销、退货、预授权撤销、预授权完成、预授权完成撤销等交易。 全渠道系统/ACP 中国银联全渠道系统，是整合了银联在线和银联移动支付功能的新交易处理系统。 &nbsp; 1.4&nbsp;&nbsp; 技术服务 1.4.1 测试模式划分 接入网关支付产品的商户为选测。 注： 必测是指提交了入网申请表、必须测试通过才能投产上线的，选测是指不需要入网申请表可以直接投产上线的，是否在测试环境测试由商户自己决定。 必测 选测 收单机构接入 商户接入（接入产品为除无跳转支付、后台直接支付、代收和便民缴费以外的其他产品） 商户接入（接入产品为无跳转支付、后台直接支付、代收和便民缴费） 1.4.2 支持获取途径 业务问题详见开发包中《中国银联全渠道系统业务运营服务指引》相关人员联系方式。 测试问题支持人员联系方式详见下表： &nbsp; 必测 选测 收单机构可联系银联服务专员，并且在提交了入网申请后银联服务专员会主动联系商定窗口并提供测试支持服务 商户可发送邮件到acpservice@unionpay.com邮箱（邮件标题为：商户号+商户名称+联系QQ），提供商户号和联系QQ，银联测试服务专员会将商户接口人的联系QQ加入到银联统一服务QQ中提供支持服务（商户也可以通过服务电话021-38929999-2049来提供自己的商户号和联系QQ） 银联市场服务代表在为商户提交了入网申请后，会有银联服务专员主动联系（一般为QQ）商定联调窗口并提供测试支持服务 注： 服务邮箱和服务电话仅供选测类商户联系测试支持人员，并且邮箱和电话不直接反馈支持问题，支持服务均在银联统一服务QQ中提供。 2&nbsp;&nbsp;&nbsp;&nbsp; 联调步骤向导 2.1&nbsp;&nbsp; 交易开发 商户或收单机构全渠道系统开发包和本测试指引进行接入开发。 2.2&nbsp;&nbsp; 测试联调 本步骤可选。开发完成后可通过银联提供的联调测试环境进行联机接口验证测试，测试地址参考测第11章节配置文件说明。 2.3&nbsp;&nbsp; 切换上线 在测试环境完成联调测试后，由银联业务运营人员(联系方式参见《中国银联全渠道系统业务运营服务指引》)引导协助商户完成生产交易证书的申请，商户将接口更新部署到生产环境和银联生产环境完成对接。 3&nbsp;&nbsp;&nbsp;&nbsp; 测试参数与产品相关交易 3.1&nbsp; 测试与生产地址 测试地址详见第11章节配置文件描述。 3.2&nbsp; 测试卡号 测试卡号 平安银行借记卡：6216261000000000018 证件号：341126197709218366 手机号：13552535506 密码：123456 姓名：全渠道 平安银行贷记卡：6221558812340000 姓名：互联网 证件号：341126197709218366 手机号：13552535506 cvn2:123 有效期：1711 3.3&nbsp; 产品相关交易 &nbsp; 序号 接口名称 功能说明 交易模式 1 消费类交易（前台类） 持卡人进支付时，由银联或发卡行展示支付页面，引导持卡人完成后续支付的交易。 前台资金类交易 2 消费撤销类交易 指因人为原因而撤销已完成的消费；消费撤销必须是撤销CUPS当日当批的消费 后台资金类交易 3 退货类交易 对于已结算的消费交易，通过该交易发起退款交易。 后台资金类交易 4 交易状态查询类交易 对未收到应答的或交易状态未知的交易，可通过该交易进行查询。 查询类交易 5 文件传输类交易 联机下载对账文件等文件下载类交易 后台非资金交易 6 预授权类交易 预授权交易用于受理方向持卡人的发卡方确认交易许可。受理方将预估的消费金额作为预授权金额，发送给持卡人的发卡方。 前台或后台资金类交易 7 授权撤销类交易 对已成功的预授权交易，在结算前使用该交易进行取消。 后台资金类交易 8 授权完成类交易 对已批准的预授权交易，用该交易进行支付结算； 后台资金类交易 9 授权完成撤销类交易 预授权完成撤销交易必须是对原始预授权完成交易的全额撤销。预授权完成撤销后的预授权仍然有效。 后台资金类交易 10 余额查询 &nbsp; 后台非资金类交易 11 电子现金非指定账户圈存 &nbsp; 后台资金类交易 12 电子现金指定账户圈存 &nbsp; 后台资金类交易 13 圈存脚本通知 &nbsp; 后台资金类交易 14 IC卡脱机消费通知 &nbsp; 后台资金类交易 3.4&nbsp; 产品介绍 产品介绍详见《网关支付产品入网材料》包中的《银联全渠道系统网关产品.pptx》。 4&nbsp;&nbsp;&nbsp;&nbsp; 交易模式说明 从技术实现方式上交易大致可划分为前台类交易、后台资金类类交易、后台非资金类交易、查询类交易、批量类交易。本节将描述各种交易的大致流程。 4.1&nbsp;&nbsp; 通讯方式 所有报文域以key/value的表单方式通过HTTP Post到银联全渠道系统支付平台。对于前台类需要持卡人交互的交易，交易通过异步跳转的方式完成，对于涉及资金的前台类交易，银联全渠道系统支付平台可通过商户后台通知地址向商户发送后台通知。对于后台类涉及资金清算类无需持卡人交互的交易，交易结果异步响应给商户，商户通过接受后台通知或者发起交易查询获取交易处理结果。对于后台类非资金类无需持卡人交互的交易，交易结果同步响应给商户。对应交易状态查询类交易，交易结果同步响应给商户。 4.2&nbsp;&nbsp;前台交易流程 前台类交易是指交易请求方（如商户、收单机构）与ACP之间的交易信息通过用户浏览器进行传递的交易，是一种异步的、需要持卡人参与完成的交易类型。对于涉及金额的前台类交易（即交易请求中有金额字段）ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。 图 1‑1 注意点： 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考接口文档； 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第8步前台应答返回的URL为请求报文中的“frontUrl”字段指定的URL； 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第7步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL； 4.3&nbsp;&nbsp; 后台资金类交易流程 后台类资金类交易是指交易请求方（如商户、收单机构），将交易信息（涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。是一种异步的、不需要持卡人参与完成的交易类型。因涉及资金的清算，ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。 图 1‑3 注意： 1.&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考开发包中接口规范文档； 2.&nbsp;&nbsp;&nbsp;&nbsp; 图1-3中第4步中的应答仅代表该笔后台请求交易已经受理，不代表全部处理成功；是否处理成功，需通过接受后台通知或者发起“交易状态查询交易”进行查询； 3.&nbsp;&nbsp;&nbsp;&nbsp; 第5步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL。 &nbsp; &nbsp; &nbsp; 4.4&nbsp;&nbsp; 后台非资金类交易流程 后台类非资金类交易是指交易请求方（如商户、收单机构）将交易信息（不涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。后台非资金类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。若通讯超时，则交易请求方可以重复发起交易。 图1‑4 4.5&nbsp;&nbsp; 查询交易流程 查询交易是指交易请求方（如商户、收单机构）将交易查询报文信息直接通过请求方服务器发送至ACP服务器的交易方式。查询类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。，若通讯超时，则交易请求方可以重复发起交易。 图 1‑5 &nbsp; &nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导 5.1&nbsp;&nbsp; 前台交易开发步骤 1. 以表单的方式组装要发送给银联全渠道系统的数据对象（包括IC卡交易信息域，VPC交易信息域，风控信息域等各域）。每个域填写方法可参考文档开发包中接口文档。 2. 将组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”具体签名机制请参照第8章节。可通过调用插件包提供的签名方法来完成签名。 3. 把所有要发送给银联全渠道系统的域包括signature和signMethod，组成表单以POST方式送给银联全渠道系统前台交易的地址。 4. 交易完成后，银联全渠道系统将把交易结果分别返回通知到商户通的前台应答地址和后台应答地址上，商户接收到交易通知后可分别调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.2&nbsp;&nbsp; 后台类异步交易接口开发步骤 1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。 2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。 3. 把所有数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。 4. 接收到返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.3&nbsp;&nbsp; 后台类同步交易接口开发步骤 1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。 2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第8章节。 3. 数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。 4. 返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap (应答报文);”方法进行应答报文解析，和“SDKUtil.validate (应答报文, 报文字符集)”方法进行签名验证。 5.4&nbsp;&nbsp;单笔查询交易接口开发步骤 1.照单笔查询交易的规范组装报文，交易报文请参考开发包中接口文档 2.好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。 3.数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过SDK提供的方法进行发送。 4.返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.5&nbsp;&nbsp;文件传输类交流开发步骤 文件的格式，参照接口文档，文件名，文件头，文件，文件以inputfilepost方式提交到服务器，以文件流的方式获取字节流信息，先需要解压缩文件内容的byte[]数组，用SecureUtil.deflater方法，后BASE64编码，用SecureUtil.base64Encode方法，返回，最终以字符串方式提交到处理服务器，服务器响应报文里有filecontent字段，先用SecureUtil.base64Decode解码，后用SecureUtil.inflater方法解压缩，返回byte[],接下来就可以通过文件输出的方法，生成文件。 文件转字符串 图2‑1 6&nbsp;&nbsp;&nbsp;&nbsp; 前台应答与后台通知说明 前台交易，商户或机构需要提供两个地址frontUrl和backUrl（通过报文域上送），分别接收银联全渠道系统的前台应答和后台通知。前台应答是通过浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联全渠道系统异步把交易状态为成功的交易通知给商户。具体详细关于前台应答和后台通知请参照接口文档。不管收到前台应答还是后台通知，商户都需要验签。 在交易结束后，银联全渠道系统通过后台通知将交易结果发给商户或机构。后台通知以标准的HTTP协议的POST方法向商户的后台通知URL发送，并设置一个超时计时器，通常设置为10s。商户在收到通知，解析后应立即返回应答报文。仅当POST返回码为200时，才认为商户已经成功收到并且能正确解析后台通知，其他返回码则被认为通知失败。如果计时器超时，没有收到应答报文，也被认为通知失败。 第一次通知失败后，会通过退避策略进行通知重发，最多发送五次。由于网络等原因，商户会收到重复的后台通知。 商户或机构在接收到银联全渠道系统的前台应答或后台通知后，首先必须验证该消息的签名，然后根据订单号等信息，更新相应系统中的订单支付状态。前台通知因存在用户支付完毕后直接关闭浏览器的情况，而不能保证每次都送达。后台通知由银联银联全渠道系统通知服务器主动发起，若发送失败，银联全渠道系统会继续发送，一共发送5次，若还是发送失败，也不继续发送。商户在未收到后台应答，建议请求20分钟后主动发起交易查询交易来查询交易状态。 另外，退货等后台类交易（若有开发）是异步过程，银联全渠道系统收到后台类交易请求后会回复一个请求已接受的应答。在交易处理后，银联全渠道系统会发送后台通知给商户，建议商户无论是否收到后台通知，在请求2分钟后主动发起交易查询交易来查询交易状态。 注：银联全渠道系统只针对成功交易会发送后台通知，失败交易不发送后台通知。因此，如未收到后台通知，建议商户主动发起交易查询交易，查询交易状态。 另外后台通知接收需要注意以下几点： 1.后台通知采用POST的方式来发送，POST的地址是商户上送的backUrl域，backUrl域需要保证该地址的正确性。 2.后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。 3.确定通知成功由以下几个要素 a)&nbsp;&nbsp;&nbsp;&nbsp; 通知URL填写正确（商户必须要保证URL的正确性） b)&nbsp;&nbsp;&nbsp;&nbsp; 通信正确（通信失败时必须重发） c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 商户能够正确验签（测试环境要测试通过） 因此，只要生产上能够证明通信是正确的，即可认为通知成功。如果商户端因为某种特殊原因，没有正确处理后台通知，可以通过交易查询接口来纠正交易的状态。 7&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明 7.1&nbsp;&nbsp; 前台交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参考5.4章节。 7.2&nbsp;&nbsp; 后台资金交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参见第4.5章节。 7.3&nbsp;&nbsp; 后台非资金交易 后台交易采用同步机制，交易结果同步返回。 7.4&nbsp;&nbsp; 查询交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已接收到明确的交易结果应答，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 前台交易，若未接收到全渠道系统的明确交易应答时需发起单笔查询交易，查询明确的交易结果。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 后台交易，若出现交易超时的情况则需要发起单笔查询交易，查询明确的交易结果。 8&nbsp;&nbsp;&nbsp;&nbsp;签名机制 对于报文的签名处理机制如下： 首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。 对于报文的验签处理机制如下： 首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用商户入网时银联提供的银联全渠道系统支付通讯RSA公钥证书对摘要和报文中的签名信息做签名验证操作。 9&nbsp;&nbsp;&nbsp;&nbsp; 加密机制 对于持卡人密码银联全渠道系统支付平台使用RSA公钥证书对ANSI X9.8带主帐号格式的PIN加密并做Base64编码后传输，以保障密码的安全性。依据商户可选配置，对于CVN2、有效期、卡号使用RSA公钥证书分别做加密并Base64处理。 对于敏感信息银行卡验证信息及身份信息部分内容，采用Base64编码后传输，以做数据屏蔽。 对于文件内容，使用DEFLATE压缩算法压缩后，Base64编码的方式传输，压缩编码后的内容参与签名摘要运算。 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明 10.1&nbsp;&nbsp;&nbsp;&nbsp; 概述 1. 商户签名证书：商户接入银联支付后会收到两码，通过在CFCA网站下载pfx证书。此证书用于请求报文的签名。测试证书随开发包提供。 2. 商户的密码加密证书：商户会收到一个密码加密的公钥证书，此证书用于对银行卡密码的加密、cvn2、有效期及卡号等的加密。测试证书随开发包提供。 3. 商户的交易报文验证签名证书：验证银联支付返回的报文是否合法。测试证书随开发包提供。 &nbsp; 10.2&nbsp;&nbsp;&nbsp;&nbsp; 证书下载及导出流程(ok) 10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程 1.&nbsp;&nbsp;&nbsp;&nbsp; 登入CFCA官网网址：www.cfca.com.cn，点击“生产系统证书下载”； &nbsp; &nbsp; 2.&nbsp;&nbsp;&nbsp;&nbsp; 在生产证书下载选项中点击 à 证书下载； &nbsp; 3.&nbsp;&nbsp;&nbsp;&nbsp; 首次下载证书,请按照页面提示安装相应程序，以保证证书顺利下载； &nbsp; 4.&nbsp;&nbsp;&nbsp;&nbsp; 点击左侧“用户证书下载”，并点击“接受此协议”； 5.&nbsp;&nbsp;&nbsp;&nbsp; 输入CFCA提供的两码（用户参考号、用户授权码），制证方式默认，软件CSP默认，点击下 &nbsp; 6.&nbsp;&nbsp;&nbsp;&nbsp; 完成下载操作后，页面会出现下载成功的提示。下载的证书自动存放在IE中。 &nbsp; 10.2.2证书导出流程 1. 打开浏览器，点选 工具 à Internet选项 à 内容 à 证书； 2. 以商户号：700000000000001为例说明整个导出流程 在个人证书中找到相对应的证书，点选导出； &nbsp; 3.跳出证书导出向导对话框，点击下一步； &nbsp; 4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 选择导出私钥（如需要在服务网站上传证书公钥，请选择第二个选项以下载公钥证书，后续操作选择默认方式，再选择路径导出），点击下一步； &nbsp; 5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 导出文件格式默认点击下一步； &nbsp; 6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 键入证书私钥，建议不要超过6位； &nbsp; 7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 指定导出证书的文件名，并选择目录存放证书，点击下一步； &nbsp; 8.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 点击完成，证书导出成功。 &nbsp; 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用 插件包只是为了方便商户测试而提供的样例代码，商户可以根据自己网站的需要，按照技术文档编写,并非一定要使用该代码。代码仅供参考 11.1&nbsp;&nbsp;&nbsp;&nbsp; JSP/JAVA 插件以JAR包的形式提供给商户，工程名称为upacp_sdk_java。 11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1.&nbsp; log4j.properties:插件的日志机制使用log4j实现，可将提供的配置文件合并到项目的log4j配置中，并根据环境需要修改日志路径； 2.&nbsp;acp_sdk.properties:测试环境参数配置文件（不含手机控件支付） 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### #SDK 日志目录配置 log.back.rootPath=d://log ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 acpsdk.frontTransUrl=https://101.231.204.80:5000/gateway/api/frontTransReq.do ##&nbsp;app&nbsp;交易请求地址 ##&nbsp;acpsdk.appTransUrl=https://101.231.204.80:5000/gateway/api/appTransReq.do ##后台交易请求地址 acpsdk.backTransUrl=https://101.231.204.80:5000/gateway/api/backTransReq.do ##后台交易请求地址(若为有卡交易配置该地址) #acpsdk.cardTransUrl=https://101.231.204.80:5000/gateway/api/cardTransReq.do ##单笔查询请求地址 acpsdk.singleQueryUrl=https://101.231.204.80:5000/gateway/api/queryTrans.do ##批量交易请求地址 acpsdk.batchTransUrl=https://101.231.204.80:5000/gateway/api/batchTrans.do ##文件传输类交易地址 acpsdk.fileTransUrl=https://101.231.204.80:9080/ ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 acpsdk.signCert.path=d:\\certs\\700000000000001_acp.pfx ##签名证书密码 acpsdk.signCert.pwd=000000 ##签名证书类型 acpsdk.signCert.type=PKCS12 ##########################加密证书配置################################ ##密码加密证书路径 acpsdk.encryptCert.path=d:\\certs\\encrypt.cer 3.acp_sdk.properties:生产环境参数配置文件 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 acpsdk.frontTransUrl=https://gateway.95516.com/gateway/api/frontTransReq.do ##&nbsp;app&nbsp;交易请求地址 ##&nbsp;acpsdk.appTransUrl=https://gateway.95516.com /gateway/api/appTransReq.do ##后台交易请求地址 acpsdk.backTransUrl=https://gateway.95516.com/gateway/api/backTransReq.do ##后台交易请求地址(若为有卡交易配置该地址) #acpsdk.cardTransUrl=https://gateway.95516.com /gateway/api/cardTransReq.do ##单笔查询请求地址 acpsdk.singleQueryUrl=https://gateway.95516.com/gateway/api/queryTrans.do ##批量交易请求地址 acpsdk.batchTransUrl=https://gateway.95516.com/gateway/api/batchTrans.do ##文件传输类交易地址 acpsdk.fileTransUrl=https://filedownload.95516.com/ &nbsp;########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） acpsdk.signCert.path=d:\\certs\\700000000000001_acp.pfx ##签名证书密码 acpsdk.signCert.pwd=123456 ##签名证书类型 acpsdk.signCert.type=PKCS12 ##########################加密证书配置################################ ##密码加密证书路径 acpsdk.encryptCert.path=d:\\certs\\encrypt.cer &nbsp; 11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKConfig.java:负责读取acp_sdk.properties及设置参数。 方法：public void loadPropertiesFromSrc() 从标准CLASS类路径下LOAD配置文件。 &nbsp; 方法：public void loadPropertiesFromPath(String rootPath) 从标准CLASS类路径下LOAD配置文件。 &nbsp; 方法：public void loadProperties(Properties pro) 使用传入的Properties对象LOAD配置。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKUtil.java：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。 方法：publicstatic String send(String url, Map&lt;String, String&gt; data, String encoding,intconnectionTimeout, intreadTimeout) 发送后台交易。 &nbsp; 方法：publicstaticboolean sign(Map&lt;String, String&gt; data, String encoding) 生成签名。 &nbsp; 方法：publicstaticboolean validate(Map&lt;String, String&gt; resData, String encoding) 验证签名。 &nbsp; 方法：publicstatic String coverMap2String(Map&lt;String, String&gt; data) 将Map形式的表单交易数据转换为key1=value1&amp;key2=value2的形式 &nbsp; 方法：publicstatic Map&lt;String, String&gt; coverResultString2Map(String result) 将形如key=value&amp;key=value的字符串转换为相应的Map对象 &nbsp; 方法：publicstatic String encryptPin(String card, String pwd, String encoding) 密码加密，输入参数依次为卡号、密码、字符集。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKConstants.java：常量类。 定义可能用到的各种常量和所有域名。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.CertUtil.java： 证书操作工具类，主要是导入pfx、cer等证书与获取获取私钥、获取公钥操作。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SecureUtil.java主要负责报文的签名、验证签名及加密解密； 提供MD5、SHA-1以及RSA签名的方法类。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.HttpClient.java 是通信类，具体请参考代码的说明。 提供和服务器通信的HTTP客户端类。 方法：publicint send(Map&lt;String, String&gt; data, String encoding) throwsException 将请求参数以HTTP表单的方式进行一次HTTP POST通信。 &nbsp; Sample说明 com.unionpay.acp.sdksample.front：包下为前台交易demo 方法：com.unionpay.acp.sdksample.back：包下为后台交易demo 具体内容见DEMO代码中的注释和说明。 &nbsp; 11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明 配置文件加载说明 1)&nbsp;&nbsp;&nbsp; acp_sdk.properties i.&nbsp;&nbsp;&nbsp;&nbsp; 从classpath加载 SDKConfig.getConfig().loadPropertiesFromSrc(); ii.&nbsp;&nbsp;&nbsp; 从properties对象中加载 SDKConfig.getConfig().loadProperties(pro); iii.&nbsp;&nbsp; 从指定目录下加载rootPath不包含文件名 SDKConfig.getConfig().loadPropertiesFromPath(rootPath); 2)&nbsp;&nbsp;&nbsp; log4j.properties:放在工程的classpath目录下，系统自动加载 &nbsp; 11.2&nbsp;&nbsp;&nbsp;&nbsp; PHP 插件按编码为gbk编写，工程名称为upacp_sdk_php，供系统集成。 openssl证书需下载使用 其中的php_openssl.dll,ssleay32.dll,libeay32.dll3个文件拷到&nbsp; windows/system32/文件夹下，在重启Apache服务 11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1. SDKConfig.php测试环境配置文件：具体配置项和说明如下； 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 const SDK_FRONT_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/frontTransReq.do&#39;; ##后台交易请求地址 const SDK_BACK_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/backTransReq.do&#39;; ##后台交易请求地址(若为有卡交易配置该地址) constSDK_Card_Request_Url = &#39;https://101.231.204.80:5000/gateway/api/cardTransReq.do&#39;; ##单笔查询请求地址 const SDK_SINGLE_QUERY_URL = &#39;https://101.231.204.80:5000/gateway/api/queryTrans.do&#39;; ##批量交易请求地址 const SDK_BATCH_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/batchTrans.do&#39;; ##文件传输类交易地址 const SDK_FILE_QUERY_URL = &#39;https://101.231.204.80:9080/&#39;; ##APP交易地址 constSDK_App_Request_Url = &#39;https://101.231.204.80:5000/gateway/api/appTransReq.do&#39;; ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 const SDK_SIGN_CERT_PATH = &#39;D:/certs/PM_700000000000001_acp.pfx&#39;; ##签名证书密码 const SDK_SIGN_CERT_PWD = &#39;000000&#39;; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/verify_sign_acp.cer&#39;; ##前台通知地址 (商户自行配置通知地址) const SDK_FRONT_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; // 后台通知地址 (商户自行配置通知地址) const SDK_BACK_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; //文件下载目录 const SDK_FILE_DOWN_PATH = &#39;d:/file/&#39;; //日志 目录 const SDK_LOG_FILE_PATH = &#39;D:/logs/&#39;; //日志级别 const SDK_LOG_LEVEL = &#39;INFO&#39;; &nbsp; ##########################加密证书配置################################ ##密码加密证书路径 const SDK_ENCRYPT_CERT_PATH = &#39;D:/certs/encrypt.cer&#39;; &nbsp; 2. SDKConfig.php ，生产测试环境配置文件：具体配置项和说明如下； &nbsp; 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 const SDK_FRONT_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/frontTransReq.do&#39;; ##后台交易请求地址 const SDK_BACK_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/backTransReq.do&#39;; ##后台交易请求地址(若为有卡交易配置该地址) constSDK_Card_Request_Url = &#39;https://gateway.95516.com/gateway/api/cardTransReq.do&#39;; ##单笔查询请求地址 const SDK_SINGLE_QUERY_URL = &#39;https://gateway.95516.com/gateway/api/queryTrans.do&#39;; ##批量交易请求地址 const SDK_BATCH_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/batchTrans.do&#39;; ##文件传输类交易地址 const SDK_FILE_QUERY_URL = &#39;https://filedownload.95516.com/&#39;; ##APP交易地址 constSDK_App_Request_Url = &#39;https://gateway.95516.com/gateway/api/appTransReq.do&#39;; &nbsp; ##前台通知地址 (商户自行配置通知地址) const SDK_FRONT_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; ##后台通知地址 (商户自行配置通知地址) const SDK_BACK_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; ##文件下载目录 const SDK_FILE_DOWN_PATH = &#39;d:/file/&#39;; ##日志 目录 const SDK_LOG_FILE_PATH = &#39;D:/logs/&#39;; ##日志级别 const SDK_LOG_LEVEL = &#39;INFO&#39;; ########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） const SDK_SIGN_CERT_PATH = &#39;D:/certs/PRO_700000000000001_acp.pfx&#39;; ##签名证书密码 const SDK_SIGN_CERT_PWD = &#39;000000&#39;; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/UPOP_VERIFY.cer&#39;; ##验签证书路径 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/&#39;; ##########################加密证书配置################################ ##密码加密证书路径 const SDK_ENCRYPT_CERT_PATH = &#39;D:/certs/RSA2048_PROD_index_22.cer&#39;; &nbsp; 11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明 主要类与方法说明 upacp_sdk_php.gbk.common.php:负责将请求报文排序后转化为字符串、将字符串转为数组 解压、压缩、构建自动提交表单等 function coverParamsToString($params) 功能: 将请求报文排序后转化为字符串 输入: 请求数组 输出: 排序后的 key1=val1&amp;key2=val2&amp;.... function coverStringToArray($str) 功能: 将字符串转为数组 输入: key1=val1&amp;key2=val2&amp;.... 输出: 数组元素 array(key1=&gt;val1,key2=&gt;val2...) &nbsp; function deal_params(&amp;$params) 功能: 处理返回报文 解码客户信息 输入: 客户信息 输出: 将客户信息组装成customerInfo项 &nbsp; function deflate_file(&amp;$params) 功能: 压缩文件 输入: 带有文件上传的请求报文 输出: 将上传文件压缩后组装进报文 &nbsp; function deal_file($params) 功能: 解压缩文件 输入: 带有文件下载的返回报文 输出: 处理文件内容并保存到指定目录下 &nbsp; function create_html($params, $action) 功能: 构造自动提交的表单 输入: 请求数组($params) ,请求的远程url 输出: 自动提交的form表单字符串 &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.httpClient.php:后台交易 客户端通信等 &nbsp; httpClient.php function sendHttpRequest($params, $url) 功能: 后台交易 HttpClient通信 输入: 请数据,及远程通信url 输出: 后台交易响应信息 &nbsp; function getRequestParamString($params) 功能: 请求数据 urlencode处理后转为key=val&amp;...串 输入: 请求数组 输出: urlencode处理后的key=val&amp;...串 &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.secureUtil.php:负责签名，验签，加载证书，取公钥/私钥，加密卡号/cvn2/有效期等方法类 secureUtil.php function sign(&amp;$params) 功能: 请求数据签名 输入: 请求数组 输出: 带签名的请求数组 &nbsp; function verify($params) 功能: 验签 输入: 返回报文 输出: 成功/失败 &nbsp; function getPulbicKeyByCertId($certId) 功能: 根据证书ID 加载 证书 输入: 证书ID 输出: 证书公钥信息 &nbsp; function getCertId($cert_path) 功能: 取私钥证书ID 输入: 私钥证书路径 输出: 证书ID &nbsp; function getCertIdByCerPath($cert_path) 功能: 取公钥证书ID 输入: 公钥证书路径 输出: 证书ID &nbsp; &nbsp; function getSignCertId() 功能: 取签名证书ID 输入: 签名证书路径 输出: 证书ID &nbsp; function getPublicKey($cert_path) 功能: 获取证书公钥 输入: 证书路径 输出: 公钥 &nbsp; function getPrivateKey($cert_path) 功能: 获取证书私钥 输入: 证书路径 输出: 私钥 &nbsp; function encryptPan($pan) 功能: 加密 卡号 输入: 卡号 输出: 加密后卡号 &nbsp; function encryptPin($pan, $pwd) 功能: pin 加密 输入: 卡号,密码 输出: 加密后密码 &nbsp; function encryptCvn2($cvn2) 功能: cvn2 加密 输入: cvn2 输出: 加密后cvn2 &nbsp; function encryptDate($certDate) 功能: 有效期 加密 输入: 有效期 输出: 加密后有效期 &nbsp; &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.PublicEncrypte.php:密码加密 upacp_sdk_php.gbk.PinBlock.php:密码转pin upacp_sdk_php.gbk.log.class.php:日志类 11.3&nbsp;&nbsp;&nbsp;&nbsp; ASP.NET 插件.net Framework4.0环境以上编写，ICSharpCode.SharpZipLib手动添加，引用工程名称为upacp_sdk_php，供系统集成。 11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1.&nbsp; Web.config:入网测试环境参数配置文件 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 &lt;add key=&quot;sdk.frontTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/frontTransReq.do&quot; /&gt; ##后台交易请求地址 &lt;add key=&quot;sdk.backTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/backTransReq.do&quot; /&gt; ##后台交易请求地址(若为有卡交易配置该地址) &lt;add key=&quot;sdk.cardRequestUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/cardTransReq.do&quot; /&gt; ##批量交易请求地址 &lt;add key=&quot;sdk.batTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/batchTrans.do&quot; /&gt; ##查询地址 &lt;add key=&quot;sdk.singleQueryUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/queryTrans.do&quot; /&gt; ##文件传输类交易地址 &lt;add key=&quot;sdk.fileTransUrl&quot; value=&quot;https://101.231.204.80:9080/&quot; /&gt; ##APP交易地址 &lt;add key=&quot;sdk.appRequestUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/appTransReq.do&quot; /&gt; ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 &lt;add key=&quot;sdk.signCert.path&quot; value=&quot;d:\certs\PM_700000000000001_acp.pfx&quot; /&gt; ##签名证书密码 &lt;add key=&quot;sdk.signCert.pwd&quot; value=&quot;000000&quot; /&gt; ##签名证书类型 &lt;add key=&quot;sdk.signCert.type&quot; value=&quot;PKCS12&quot; /&gt; ##验签 &lt;add key=&quot;sdk.validateCert.dir&quot; value=&quot;d:\certs\&quot; /&gt; ##########################加密证书配置################################ ##密码加密证书路径 &lt;add key=&quot;sdk.encryptCert.path&quot; value=&quot;d:\certs\encrypt.cer&quot; /&gt; &nbsp; 2. &nbsp;Web.config: 生产环境参数配置文件 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 &lt;add key=&quot;sdk.frontTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/frontTransReq.do&quot; /&gt; ##后台交易请求地址 &lt;add key=&quot;sdk.backTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/backTransReq.do&quot; /&gt; ##后台交易请求地址(若为有卡交易配置该地址) &lt;add key=&quot;sdk.cardRequestUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/cardTransReq.do&quot; /&gt; ##单笔查询请求地址 &lt;add key=&quot;sdk.singleQueryUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/queryTrans.do&quot; /&gt; ##批量交易请求地址 &lt;add key=&quot;sdk.batTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/batchTrans.do&quot; /&gt; ##文件传输类交易地址 &lt;add key=&quot;sdk.fileTransUrl&quot; value=&quot;https://filedownload.95516.com/&quot; /&gt; ##APP交易地址 &lt;add key=&quot;sdk.appRequestUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/appTransReq.do&quot; /&gt; ########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） &lt;add key=&quot;sdk.signCert.path&quot; value=&quot;d:\certs\PRO_700000000000001_acp.pfx&quot; /&gt; ##签名证书密码 &lt;add key=&quot;sdk.signCert.pwd&quot; value=&quot;000000&quot; /&gt; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 &lt;add key=&quot;sdk.validateCert.dir&quot; value=&quot;d:\certs\&quot; /&gt; ##########################加密证书配置################################ ##密码加密证书路径 &lt;add key=&quot;sdk.encryptCert.path&quot; value=&quot;d:\certs\RSA2048_PROD_index_22.cer&quot; /&gt; &nbsp; 11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明 主要类与方法说明 com.unionpay.acp.sdk.SDKConfig.cs:负责读取web.config //功能：读取配置文件获取签名证书路径 private static string signCertPath = config.AppSettings.Settings[&quot;sdk.signCert.path&quot;].Value; //功能：读取配置文件获取签名证书密码 private static string signCertPwd = config.AppSettings.Settings[&quot;sdk.signCert.pwd&quot;].Value; //功能：读取配置文件获取验签目录 private static string validateCertDir = config.AppSettings.Settings[&quot;sdk.validateCert.dir&quot;].Value; //功能：加密公钥证书路径 private static string encryptCert = config.AppSettings.Settings[&quot;sdk.encryptCert.path&quot;].Value; //功能：有卡交易路径;&nbsp; private static string cardRequestUrl = config.AppSettings.Settings[&quot;sdk.cardRequestUrl&quot;].Value; //功能：app交易路径;&nbsp; private static string appRequestUrl = config.AppSettings.Settings[&quot;sdk.appRequestUrl&quot;].Value; //功能：读取配置文件获取交易查询地址&nbsp; private static string singleQueryUrl = config.AppSettings.Settings[&quot;sdk.singleQueryUrl&quot;].Value; //功能：读取配置文件获取文件传输类交易地址 private static string fileTransUrl = config.AppSettings.Settings[&quot;sdk.fileTransUrl&quot;].Value;&nbsp; 功能：读取配置文件获取前台交易地址 private static string frontTransUrl = config.AppSettings.Settings[&quot;sdk.frontTransUrl&quot;].Value; 功能：读取配置文件获取后台交易地址 private static string backTransUrl = config.AppSettings.Settings[&quot;sdk.backTransUrl&quot;].Value; //功能：读取配批量交易地址 private static string batTransUrl = config.AppSettings.Settings[&quot;sdk.batTransUrl&quot;].Value; &nbsp; &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKUtil.cs：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。 获取签名。 public static bool Sign(Dictionary&lt;string, string&gt; data, Encoding encoder) 验证签名 public static bool Validate(Dictionary&lt;string, string&gt; data, Encoding encoder) 组装报文 public static string CreateAutoSubmitForm(string url, Dictionary&lt;string, string&gt; data, Encoding encoder) 将Dictionary内容排序后输出为键值对字符串,供打印报文使用 &nbsp;public static string PrintDictionaryToString(Dictionary&lt;string, string&gt; data) 将形如key=value&amp;key=value的字符串转换为相应的Dictionary对象 public static Dictionary&lt;string, string&gt; CoverstringToDictionary(string data) pinblock 16进制计算 public static string printHexString(byte[] b) 密码加密，输入参数依次为卡号、密码、字符集 Publicstatic string encryptPin(string card, string pwd, string encoding) 数据加密，输入参数依次为数据、字符集 Publicstatic string encryptData(string data，string encoding) &nbsp; &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.CertUtil.cs： 证书操作工具类，主要是导入pfx证书与获取获取私钥操作。 获取签名证书私钥 public static RSACryptoServiceProvider GetSignProviderFromPfx() 获取签名证书的证书序列号 &nbsp;public static string GetSignCertId() 通过证书id，获取验证签名的证书 public static RSACryptoServiceProvider GetValidateProviderFromPath(string certId) &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SecureUtil.cs主要负责报文的软签名、验证签名、加密； 压缩、解压、Base64编码/解码,pinblock计算等提供SHA-1及RSA的方法类。 摘要计算 &nbsp;public static byte[] Sha1X16(string dataStr, Encoding encoding) 软签名 &nbsp;public static byte[] SignBySoft(RSACryptoServiceProvider provider, byte[] data) 验证签名 &nbsp;public static bool ValidateBySoft(RSACryptoServiceProvider provider, byte[] base64DecodingSignStr, byte[] srcByte) Base64编码 public static string EncodeBase64(Encoding encode, string source) Base64解码 &nbsp;public static string DecodeBase64(Encoding encode, string result) Inflater解压缩 public static byte[] inflater(byte[] inputByte) deflater压缩 &nbsp;public static byte[] deflater(byte[] inputByte) 密码计算 private static byte[] pin2PinBlock(string aPin) 获取卡号密码pinblock计算 public static byte[] pin2PinBlockWithCardNO(string aPin, string aCardNO) &nbsp;卡号计算 private static byte[] formatPan(string aPan) 加密 public static byte[] encryptedData(byte[] encData) &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.HttpClient.cs 是通信类，具体请参考代码的说明。 提供和服务器通信的HTTP客户端类。 将请求参数以HTTP表单的方式进行一次HTTP POST通信。 Publicint Send(Dictionary&lt;string, string&gt;sParaTemp, Encoding encoding) &nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答 Q：如何获取测试商户号与测试证书？ A：测试环境申请测试用户后点击“我的测试&gt;测试参数”中查看商户号，并点击下载测试证书，注册地址：https://open.unionpay.com/ajweb/register，生产环境请联系业务部门，具体联系方式如下： 发送邮件至： operation@unionpay.com进行业务申请和咨询，银联有专门的人员进行处理。 其他专项服务：请见《业务运营服务指引（商户） 》日常业务运营服务。 Q：如何签名？ A：对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。 Q：报文域中frontUrl和backUrl要填什么？ A:frontUrl和backUrl为报文上送要素，银联系统将前台通知报文返回到报文中的frontUrl地址，将后台通知报文返回到报文中的backUrl地址。 Q：如何获取与配置银联入网测试环境地址？ A : 可参见11章节测试环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。具体接入地址如下： 银联入网测试环境地址： 前台交易请求地址 https://101.231.204.80:5000/gateway/api/frontTransReq.do 后台交易请求地址（无卡） https://101.231.204.80:5000/gateway/api/backTransReq.do 后台交易请求地址（有卡） https://101.231.204.80:5000/gateway/api/cardTransReq.do 单笔查询请求地址 https://101.231.204.80:5000/gateway/api/queryTrans.do 批量交易请求地址 https://101.231.204.80:5000/gateway/api/batchTrans.do 文件传输类交易地址 https://101.231.204.80:9080/ APP交易请求地址 https://101.231.204.80:5000/gateway/api/appTransReq.do &nbsp; Q：银联全渠道系统商户接入生产环境地址？ A : 可参见11章节生产环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。将配置文件中测试地址修改为如下地址： 银联入网测试环境地址： 前台交易请求地址 https://gateway.95516.com/gateway/api/frontTransReq.do 后台交易请求地址（无卡） https://gateway.95516.com/gateway/api/backTransReq.do 后台交易请求地址（有卡） https://gateway.95516.com/gateway/api/cardTransReq.do 单笔查询请求地址 https://gateway.95516.com/gateway/api/queryTrans.do 批量交易请求地址 https://gateway.95516.com/gateway/api/batchTrans.do 文件传输类交易地址 https://filedownload.95516.com/ APP交易请求地址 https://gateway.95516.com /gateway/api/appTransReq.do &nbsp; Q：商户接收到银联的前台通知和后台通知，以哪个为准？ A：交易状态请以后台通知结果为准。银联系统会将后台通知结果以post的方式发送到报文中backUrl后台通知地址上，如商户未收到通知，系统会持续发送，如发送成功则不再发送，5次通知失败则不再发送，失败交易则不发送。 后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。具体参见第6章节。 Q：上午做的交易，下午做撤销会报非当日交易不能撤销？ A：测试环境的日切时间在下午1点半，早上的交易会归为前一日，下午的交易才是当日交易。 Q：如果调用数次查询接口后，一直得到处理中状态，该怎么办？ A：对于网银支付模式与非网银支付模式描述如下： 网银支付模式：跳转到银行后，订单状态为正在处理中。查询的结果为正在处理中。等银行有响应的时候，银联全渠道系统会根据银行的应答，修改订单状态为成功或失败。如用户在网银页面直接关闭浏览器，查询的结果则一直为处理中。若超过1小时，查询结果状态仍为处理中，一般可认为是用户关闭了浏览器，可当作失败处理。若产生单边账，可以第二天通过对账退还金额给用户。 非网银支付模式：银联全渠道系统会控制超时时间，一般用户支付2分钟后会有明确的状态，查询的结果不是成功就是失败，失败的交易允许用户重新支付，即如用户1点支付的时候失败，1点05分再次支付成功，则商户如果1点03分查询的时候结果为交易失败，1点06分查询的时候结果为成功。 Q：消费撤销和退货有何不同？ A：当天的交易可以执行消费撤销，消费撤销只能全额。 &nbsp;当天或隔天的交易都可以做退货，退货可以进行多次退货，每次金额小于原始金额，订单退款总金额不能大于此订单原始金额。 Q：标准网关支付跳转银联页面HTTP400报错是什么原因？ A：银联全渠道系统对报文校验较为严格，对未定义的报文域会提示http400报错，请核对产品接口规范文档（https://open.unionpay.com/ajweb/help?id=74&amp;level=0&amp;from=1）中的报文域。 Q：什么是全渠道支付平台？ A：全渠道支付平台是中国银联全渠道接入支付平台的简称，支持移动、互联网等渠道的收单业务，包含互联网支付产品（银联在线支付、预授权支付、B2B对公支付、跨境支付、无跳转支付）、移动终端渠道产品（手机安全支付控件、WAP页面支付、平板电脑（iPad）网关支付、预授权支付、跨境支付、无跳转支付（手机端暂无））、后台模式产品（ 订购、 代收、代付）。 Q：银联全渠道入网测试的账号（卡号）是什么？ A：接入银联全渠道入网测试环境需要使用银联提供的测试卡进行交易，当前仅提供两张可供测试的卡片，一张B2B企业网银的虚拟卡片，具体账号信息如下： 测试卡号 平安银行借记卡：6216261000000000018 证件号：341126197709218366 手机号：13552535506 密码：123456 姓名：全渠道 平安银行贷记卡：6221558812340000 姓名：互联网 证件号：341126197709218366 手机号：13552535506 cvn2:123 有效期：1711 B2B企业网银农行虚拟卡 卡号：123456789001 密码：789001 Q：银联全渠道相关接口文档在哪里获取？ A：由银联提供的全渠道相关文档可在商户服务网站下载（https://merchant.unionpay.com/portal/pages/login/download.jsp?locale=zh_CN），也可以在自助化测试平台首页 &gt; 帮助中心 &gt;下载（https://open.unionpay.com/ajweb/help/file）中获取。 阅读更多" />
<meta property="og:description" content="直接把银联的联调测试文档贴来了 中国银联股份有限公司规范性文档 中国银联股份有限公司 发布 &nbsp; 中国银联全渠道系统商户接入 测试指引-银联网关支付产品 版本修订信息 版本号 完成日期 发布日期 变更说明 1.0.0 2014-7-03 2014-7-03 初稿 1.0.1 2014-11-04 2014-11-05 修改文档格式，新增测试地址与测试卡号等信息 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 目录 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文档说明... 6 1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;导读... 6 1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;阅读对象... 6 1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业务术语... 7 1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;技术服务... 7 1.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试模式划分... 7 1.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;支持获取途径... 8 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;联调步骤向导... 9 2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易开发... 9 2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试联调... 9 2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;切换上线... 9 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试参数与产品相关交易... 9 3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试与生产地址... 9 3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试卡号... 9 3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;产品相关交易... 10 3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;产品介绍... 11 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易模式说明... 11 4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通讯方式... 12 4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易流程... 12 4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台资金类交易流程... 13 4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台非资金类交易流程... 15 4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询交易流程... 15 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导... 16 5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易开发步骤... 16 5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台类异步交易接口开发步骤... 17 5.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台类同步交易接口开发步骤... 17 5.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单笔查询交易接口开发步骤... 18 5.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件传输类交流开发步骤... 18 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台应答与后台通知说明... 19 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明... 21 7.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易... 21 7.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台资金交易... 21 7.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台非资金交易... 21 7.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询交易... 21 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签名机制... 22 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;加密机制... 22 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明... 23 10.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;概述... 23 10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载及导出流程(ok)23 10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程... 23 10.2.2证书导出流程...27 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用... 32 11.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSP/JAVA.. 32 11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 32 11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明... 35 11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明... 38 11.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHP. 38 11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 38 11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明... 43 11.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASP.NET. 48 11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 49 11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明... 52 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答... 57 &nbsp; &nbsp; &nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 文档说明 1.1&nbsp;&nbsp; 导读 网关产品主要适用于持卡人在商户网站B2C购物支付场景，持卡通过点击银联在线支付logo，并在银联在线支付网关完成支付信息录入，最终完成支付。 从PC端发起的交易为WEB网关支付交易，从移动端发起的交易为WAP网关支付交易以及APP网关交易。 首次接入测试先了解前台交易与后台交易的区别，可参考第1.3章节业务术语描述，随后可从第5章节开发步骤向导开始阅读，了解开发过程中的具体操作步骤，此章节中提到的签名机制请参照第8章节。开发过程中需要用到的测试与生产交易地址请参考第11章节配置文件。交易测试卡号请参考第3.2章节。如开发与测试过程中遇到了解决不了的问题可在第12章节FAQ中查找解决方案，也可通过第1.4.2章节中的方法来获取测试支持。 1.2&nbsp;&nbsp; 阅读对象 《中国银联全渠道系统商户接入测试指引》文档是面向具有一定的网站开发能力的网站开发、维护和管理人员。 具体交易的接口、报文规范、响应码说明，请阅读开发包中接口文档。 参与方描述 &nbsp; 商户 指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》等协议开展银联无卡支付以及行业类应用业务的商户。 收单机构 指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》开展银联无卡支付收单业务的境内成员机构。 &nbsp; 1.3&nbsp;&nbsp; 业务术语 术语 解释 请求 通过 HTTP/HTTPS协议把需要传输的数据发送给接收方的过程。 应答 通过 HTTP/HTTPS协议把需要传输的数据返回给接收方的过程。 后台通知 服务器后台通知。中国银联全渠道系统根据得到的数据处理完成后，全渠道系统主动发起通知给商户的网站，同时携带处理完成的结果信息反馈给商户网站。 前台类交易 主要指用户需要参与交互的支付类交易，包括消费、预授权/担保消费交易。 后台类交易 主要指用户不需要参与交互，由商户后续发起的交易，包括消费撤销、退货、预授权撤销、预授权完成、预授权完成撤销等交易。 全渠道系统/ACP 中国银联全渠道系统，是整合了银联在线和银联移动支付功能的新交易处理系统。 &nbsp; 1.4&nbsp;&nbsp; 技术服务 1.4.1 测试模式划分 接入网关支付产品的商户为选测。 注： 必测是指提交了入网申请表、必须测试通过才能投产上线的，选测是指不需要入网申请表可以直接投产上线的，是否在测试环境测试由商户自己决定。 必测 选测 收单机构接入 商户接入（接入产品为除无跳转支付、后台直接支付、代收和便民缴费以外的其他产品） 商户接入（接入产品为无跳转支付、后台直接支付、代收和便民缴费） 1.4.2 支持获取途径 业务问题详见开发包中《中国银联全渠道系统业务运营服务指引》相关人员联系方式。 测试问题支持人员联系方式详见下表： &nbsp; 必测 选测 收单机构可联系银联服务专员，并且在提交了入网申请后银联服务专员会主动联系商定窗口并提供测试支持服务 商户可发送邮件到acpservice@unionpay.com邮箱（邮件标题为：商户号+商户名称+联系QQ），提供商户号和联系QQ，银联测试服务专员会将商户接口人的联系QQ加入到银联统一服务QQ中提供支持服务（商户也可以通过服务电话021-38929999-2049来提供自己的商户号和联系QQ） 银联市场服务代表在为商户提交了入网申请后，会有银联服务专员主动联系（一般为QQ）商定联调窗口并提供测试支持服务 注： 服务邮箱和服务电话仅供选测类商户联系测试支持人员，并且邮箱和电话不直接反馈支持问题，支持服务均在银联统一服务QQ中提供。 2&nbsp;&nbsp;&nbsp;&nbsp; 联调步骤向导 2.1&nbsp;&nbsp; 交易开发 商户或收单机构全渠道系统开发包和本测试指引进行接入开发。 2.2&nbsp;&nbsp; 测试联调 本步骤可选。开发完成后可通过银联提供的联调测试环境进行联机接口验证测试，测试地址参考测第11章节配置文件说明。 2.3&nbsp;&nbsp; 切换上线 在测试环境完成联调测试后，由银联业务运营人员(联系方式参见《中国银联全渠道系统业务运营服务指引》)引导协助商户完成生产交易证书的申请，商户将接口更新部署到生产环境和银联生产环境完成对接。 3&nbsp;&nbsp;&nbsp;&nbsp; 测试参数与产品相关交易 3.1&nbsp; 测试与生产地址 测试地址详见第11章节配置文件描述。 3.2&nbsp; 测试卡号 测试卡号 平安银行借记卡：6216261000000000018 证件号：341126197709218366 手机号：13552535506 密码：123456 姓名：全渠道 平安银行贷记卡：6221558812340000 姓名：互联网 证件号：341126197709218366 手机号：13552535506 cvn2:123 有效期：1711 3.3&nbsp; 产品相关交易 &nbsp; 序号 接口名称 功能说明 交易模式 1 消费类交易（前台类） 持卡人进支付时，由银联或发卡行展示支付页面，引导持卡人完成后续支付的交易。 前台资金类交易 2 消费撤销类交易 指因人为原因而撤销已完成的消费；消费撤销必须是撤销CUPS当日当批的消费 后台资金类交易 3 退货类交易 对于已结算的消费交易，通过该交易发起退款交易。 后台资金类交易 4 交易状态查询类交易 对未收到应答的或交易状态未知的交易，可通过该交易进行查询。 查询类交易 5 文件传输类交易 联机下载对账文件等文件下载类交易 后台非资金交易 6 预授权类交易 预授权交易用于受理方向持卡人的发卡方确认交易许可。受理方将预估的消费金额作为预授权金额，发送给持卡人的发卡方。 前台或后台资金类交易 7 授权撤销类交易 对已成功的预授权交易，在结算前使用该交易进行取消。 后台资金类交易 8 授权完成类交易 对已批准的预授权交易，用该交易进行支付结算； 后台资金类交易 9 授权完成撤销类交易 预授权完成撤销交易必须是对原始预授权完成交易的全额撤销。预授权完成撤销后的预授权仍然有效。 后台资金类交易 10 余额查询 &nbsp; 后台非资金类交易 11 电子现金非指定账户圈存 &nbsp; 后台资金类交易 12 电子现金指定账户圈存 &nbsp; 后台资金类交易 13 圈存脚本通知 &nbsp; 后台资金类交易 14 IC卡脱机消费通知 &nbsp; 后台资金类交易 3.4&nbsp; 产品介绍 产品介绍详见《网关支付产品入网材料》包中的《银联全渠道系统网关产品.pptx》。 4&nbsp;&nbsp;&nbsp;&nbsp; 交易模式说明 从技术实现方式上交易大致可划分为前台类交易、后台资金类类交易、后台非资金类交易、查询类交易、批量类交易。本节将描述各种交易的大致流程。 4.1&nbsp;&nbsp; 通讯方式 所有报文域以key/value的表单方式通过HTTP Post到银联全渠道系统支付平台。对于前台类需要持卡人交互的交易，交易通过异步跳转的方式完成，对于涉及资金的前台类交易，银联全渠道系统支付平台可通过商户后台通知地址向商户发送后台通知。对于后台类涉及资金清算类无需持卡人交互的交易，交易结果异步响应给商户，商户通过接受后台通知或者发起交易查询获取交易处理结果。对于后台类非资金类无需持卡人交互的交易，交易结果同步响应给商户。对应交易状态查询类交易，交易结果同步响应给商户。 4.2&nbsp;&nbsp;前台交易流程 前台类交易是指交易请求方（如商户、收单机构）与ACP之间的交易信息通过用户浏览器进行传递的交易，是一种异步的、需要持卡人参与完成的交易类型。对于涉及金额的前台类交易（即交易请求中有金额字段）ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。 图 1‑1 注意点： 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考接口文档； 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第8步前台应答返回的URL为请求报文中的“frontUrl”字段指定的URL； 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第7步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL； 4.3&nbsp;&nbsp; 后台资金类交易流程 后台类资金类交易是指交易请求方（如商户、收单机构），将交易信息（涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。是一种异步的、不需要持卡人参与完成的交易类型。因涉及资金的清算，ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。 图 1‑3 注意： 1.&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考开发包中接口规范文档； 2.&nbsp;&nbsp;&nbsp;&nbsp; 图1-3中第4步中的应答仅代表该笔后台请求交易已经受理，不代表全部处理成功；是否处理成功，需通过接受后台通知或者发起“交易状态查询交易”进行查询； 3.&nbsp;&nbsp;&nbsp;&nbsp; 第5步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL。 &nbsp; &nbsp; &nbsp; 4.4&nbsp;&nbsp; 后台非资金类交易流程 后台类非资金类交易是指交易请求方（如商户、收单机构）将交易信息（不涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。后台非资金类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。若通讯超时，则交易请求方可以重复发起交易。 图1‑4 4.5&nbsp;&nbsp; 查询交易流程 查询交易是指交易请求方（如商户、收单机构）将交易查询报文信息直接通过请求方服务器发送至ACP服务器的交易方式。查询类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。，若通讯超时，则交易请求方可以重复发起交易。 图 1‑5 &nbsp; &nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导 5.1&nbsp;&nbsp; 前台交易开发步骤 1. 以表单的方式组装要发送给银联全渠道系统的数据对象（包括IC卡交易信息域，VPC交易信息域，风控信息域等各域）。每个域填写方法可参考文档开发包中接口文档。 2. 将组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”具体签名机制请参照第8章节。可通过调用插件包提供的签名方法来完成签名。 3. 把所有要发送给银联全渠道系统的域包括signature和signMethod，组成表单以POST方式送给银联全渠道系统前台交易的地址。 4. 交易完成后，银联全渠道系统将把交易结果分别返回通知到商户通的前台应答地址和后台应答地址上，商户接收到交易通知后可分别调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.2&nbsp;&nbsp; 后台类异步交易接口开发步骤 1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。 2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。 3. 把所有数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。 4. 接收到返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.3&nbsp;&nbsp; 后台类同步交易接口开发步骤 1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。 2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第8章节。 3. 数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。 4. 返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap (应答报文);”方法进行应答报文解析，和“SDKUtil.validate (应答报文, 报文字符集)”方法进行签名验证。 5.4&nbsp;&nbsp;单笔查询交易接口开发步骤 1.照单笔查询交易的规范组装报文，交易报文请参考开发包中接口文档 2.好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。 3.数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过SDK提供的方法进行发送。 4.返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.5&nbsp;&nbsp;文件传输类交流开发步骤 文件的格式，参照接口文档，文件名，文件头，文件，文件以inputfilepost方式提交到服务器，以文件流的方式获取字节流信息，先需要解压缩文件内容的byte[]数组，用SecureUtil.deflater方法，后BASE64编码，用SecureUtil.base64Encode方法，返回，最终以字符串方式提交到处理服务器，服务器响应报文里有filecontent字段，先用SecureUtil.base64Decode解码，后用SecureUtil.inflater方法解压缩，返回byte[],接下来就可以通过文件输出的方法，生成文件。 文件转字符串 图2‑1 6&nbsp;&nbsp;&nbsp;&nbsp; 前台应答与后台通知说明 前台交易，商户或机构需要提供两个地址frontUrl和backUrl（通过报文域上送），分别接收银联全渠道系统的前台应答和后台通知。前台应答是通过浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联全渠道系统异步把交易状态为成功的交易通知给商户。具体详细关于前台应答和后台通知请参照接口文档。不管收到前台应答还是后台通知，商户都需要验签。 在交易结束后，银联全渠道系统通过后台通知将交易结果发给商户或机构。后台通知以标准的HTTP协议的POST方法向商户的后台通知URL发送，并设置一个超时计时器，通常设置为10s。商户在收到通知，解析后应立即返回应答报文。仅当POST返回码为200时，才认为商户已经成功收到并且能正确解析后台通知，其他返回码则被认为通知失败。如果计时器超时，没有收到应答报文，也被认为通知失败。 第一次通知失败后，会通过退避策略进行通知重发，最多发送五次。由于网络等原因，商户会收到重复的后台通知。 商户或机构在接收到银联全渠道系统的前台应答或后台通知后，首先必须验证该消息的签名，然后根据订单号等信息，更新相应系统中的订单支付状态。前台通知因存在用户支付完毕后直接关闭浏览器的情况，而不能保证每次都送达。后台通知由银联银联全渠道系统通知服务器主动发起，若发送失败，银联全渠道系统会继续发送，一共发送5次，若还是发送失败，也不继续发送。商户在未收到后台应答，建议请求20分钟后主动发起交易查询交易来查询交易状态。 另外，退货等后台类交易（若有开发）是异步过程，银联全渠道系统收到后台类交易请求后会回复一个请求已接受的应答。在交易处理后，银联全渠道系统会发送后台通知给商户，建议商户无论是否收到后台通知，在请求2分钟后主动发起交易查询交易来查询交易状态。 注：银联全渠道系统只针对成功交易会发送后台通知，失败交易不发送后台通知。因此，如未收到后台通知，建议商户主动发起交易查询交易，查询交易状态。 另外后台通知接收需要注意以下几点： 1.后台通知采用POST的方式来发送，POST的地址是商户上送的backUrl域，backUrl域需要保证该地址的正确性。 2.后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。 3.确定通知成功由以下几个要素 a)&nbsp;&nbsp;&nbsp;&nbsp; 通知URL填写正确（商户必须要保证URL的正确性） b)&nbsp;&nbsp;&nbsp;&nbsp; 通信正确（通信失败时必须重发） c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 商户能够正确验签（测试环境要测试通过） 因此，只要生产上能够证明通信是正确的，即可认为通知成功。如果商户端因为某种特殊原因，没有正确处理后台通知，可以通过交易查询接口来纠正交易的状态。 7&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明 7.1&nbsp;&nbsp; 前台交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参考5.4章节。 7.2&nbsp;&nbsp; 后台资金交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参见第4.5章节。 7.3&nbsp;&nbsp; 后台非资金交易 后台交易采用同步机制，交易结果同步返回。 7.4&nbsp;&nbsp; 查询交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已接收到明确的交易结果应答，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 前台交易，若未接收到全渠道系统的明确交易应答时需发起单笔查询交易，查询明确的交易结果。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 后台交易，若出现交易超时的情况则需要发起单笔查询交易，查询明确的交易结果。 8&nbsp;&nbsp;&nbsp;&nbsp;签名机制 对于报文的签名处理机制如下： 首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。 对于报文的验签处理机制如下： 首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用商户入网时银联提供的银联全渠道系统支付通讯RSA公钥证书对摘要和报文中的签名信息做签名验证操作。 9&nbsp;&nbsp;&nbsp;&nbsp; 加密机制 对于持卡人密码银联全渠道系统支付平台使用RSA公钥证书对ANSI X9.8带主帐号格式的PIN加密并做Base64编码后传输，以保障密码的安全性。依据商户可选配置，对于CVN2、有效期、卡号使用RSA公钥证书分别做加密并Base64处理。 对于敏感信息银行卡验证信息及身份信息部分内容，采用Base64编码后传输，以做数据屏蔽。 对于文件内容，使用DEFLATE压缩算法压缩后，Base64编码的方式传输，压缩编码后的内容参与签名摘要运算。 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明 10.1&nbsp;&nbsp;&nbsp;&nbsp; 概述 1. 商户签名证书：商户接入银联支付后会收到两码，通过在CFCA网站下载pfx证书。此证书用于请求报文的签名。测试证书随开发包提供。 2. 商户的密码加密证书：商户会收到一个密码加密的公钥证书，此证书用于对银行卡密码的加密、cvn2、有效期及卡号等的加密。测试证书随开发包提供。 3. 商户的交易报文验证签名证书：验证银联支付返回的报文是否合法。测试证书随开发包提供。 &nbsp; 10.2&nbsp;&nbsp;&nbsp;&nbsp; 证书下载及导出流程(ok) 10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程 1.&nbsp;&nbsp;&nbsp;&nbsp; 登入CFCA官网网址：www.cfca.com.cn，点击“生产系统证书下载”； &nbsp; &nbsp; 2.&nbsp;&nbsp;&nbsp;&nbsp; 在生产证书下载选项中点击 à 证书下载； &nbsp; 3.&nbsp;&nbsp;&nbsp;&nbsp; 首次下载证书,请按照页面提示安装相应程序，以保证证书顺利下载； &nbsp; 4.&nbsp;&nbsp;&nbsp;&nbsp; 点击左侧“用户证书下载”，并点击“接受此协议”； 5.&nbsp;&nbsp;&nbsp;&nbsp; 输入CFCA提供的两码（用户参考号、用户授权码），制证方式默认，软件CSP默认，点击下 &nbsp; 6.&nbsp;&nbsp;&nbsp;&nbsp; 完成下载操作后，页面会出现下载成功的提示。下载的证书自动存放在IE中。 &nbsp; 10.2.2证书导出流程 1. 打开浏览器，点选 工具 à Internet选项 à 内容 à 证书； 2. 以商户号：700000000000001为例说明整个导出流程 在个人证书中找到相对应的证书，点选导出； &nbsp; 3.跳出证书导出向导对话框，点击下一步； &nbsp; 4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 选择导出私钥（如需要在服务网站上传证书公钥，请选择第二个选项以下载公钥证书，后续操作选择默认方式，再选择路径导出），点击下一步； &nbsp; 5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 导出文件格式默认点击下一步； &nbsp; 6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 键入证书私钥，建议不要超过6位； &nbsp; 7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 指定导出证书的文件名，并选择目录存放证书，点击下一步； &nbsp; 8.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 点击完成，证书导出成功。 &nbsp; 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用 插件包只是为了方便商户测试而提供的样例代码，商户可以根据自己网站的需要，按照技术文档编写,并非一定要使用该代码。代码仅供参考 11.1&nbsp;&nbsp;&nbsp;&nbsp; JSP/JAVA 插件以JAR包的形式提供给商户，工程名称为upacp_sdk_java。 11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1.&nbsp; log4j.properties:插件的日志机制使用log4j实现，可将提供的配置文件合并到项目的log4j配置中，并根据环境需要修改日志路径； 2.&nbsp;acp_sdk.properties:测试环境参数配置文件（不含手机控件支付） 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### #SDK 日志目录配置 log.back.rootPath=d://log ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 acpsdk.frontTransUrl=https://101.231.204.80:5000/gateway/api/frontTransReq.do ##&nbsp;app&nbsp;交易请求地址 ##&nbsp;acpsdk.appTransUrl=https://101.231.204.80:5000/gateway/api/appTransReq.do ##后台交易请求地址 acpsdk.backTransUrl=https://101.231.204.80:5000/gateway/api/backTransReq.do ##后台交易请求地址(若为有卡交易配置该地址) #acpsdk.cardTransUrl=https://101.231.204.80:5000/gateway/api/cardTransReq.do ##单笔查询请求地址 acpsdk.singleQueryUrl=https://101.231.204.80:5000/gateway/api/queryTrans.do ##批量交易请求地址 acpsdk.batchTransUrl=https://101.231.204.80:5000/gateway/api/batchTrans.do ##文件传输类交易地址 acpsdk.fileTransUrl=https://101.231.204.80:9080/ ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 acpsdk.signCert.path=d:\\certs\\700000000000001_acp.pfx ##签名证书密码 acpsdk.signCert.pwd=000000 ##签名证书类型 acpsdk.signCert.type=PKCS12 ##########################加密证书配置################################ ##密码加密证书路径 acpsdk.encryptCert.path=d:\\certs\\encrypt.cer 3.acp_sdk.properties:生产环境参数配置文件 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 acpsdk.frontTransUrl=https://gateway.95516.com/gateway/api/frontTransReq.do ##&nbsp;app&nbsp;交易请求地址 ##&nbsp;acpsdk.appTransUrl=https://gateway.95516.com /gateway/api/appTransReq.do ##后台交易请求地址 acpsdk.backTransUrl=https://gateway.95516.com/gateway/api/backTransReq.do ##后台交易请求地址(若为有卡交易配置该地址) #acpsdk.cardTransUrl=https://gateway.95516.com /gateway/api/cardTransReq.do ##单笔查询请求地址 acpsdk.singleQueryUrl=https://gateway.95516.com/gateway/api/queryTrans.do ##批量交易请求地址 acpsdk.batchTransUrl=https://gateway.95516.com/gateway/api/batchTrans.do ##文件传输类交易地址 acpsdk.fileTransUrl=https://filedownload.95516.com/ &nbsp;########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） acpsdk.signCert.path=d:\\certs\\700000000000001_acp.pfx ##签名证书密码 acpsdk.signCert.pwd=123456 ##签名证书类型 acpsdk.signCert.type=PKCS12 ##########################加密证书配置################################ ##密码加密证书路径 acpsdk.encryptCert.path=d:\\certs\\encrypt.cer &nbsp; 11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKConfig.java:负责读取acp_sdk.properties及设置参数。 方法：public void loadPropertiesFromSrc() 从标准CLASS类路径下LOAD配置文件。 &nbsp; 方法：public void loadPropertiesFromPath(String rootPath) 从标准CLASS类路径下LOAD配置文件。 &nbsp; 方法：public void loadProperties(Properties pro) 使用传入的Properties对象LOAD配置。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKUtil.java：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。 方法：publicstatic String send(String url, Map&lt;String, String&gt; data, String encoding,intconnectionTimeout, intreadTimeout) 发送后台交易。 &nbsp; 方法：publicstaticboolean sign(Map&lt;String, String&gt; data, String encoding) 生成签名。 &nbsp; 方法：publicstaticboolean validate(Map&lt;String, String&gt; resData, String encoding) 验证签名。 &nbsp; 方法：publicstatic String coverMap2String(Map&lt;String, String&gt; data) 将Map形式的表单交易数据转换为key1=value1&amp;key2=value2的形式 &nbsp; 方法：publicstatic Map&lt;String, String&gt; coverResultString2Map(String result) 将形如key=value&amp;key=value的字符串转换为相应的Map对象 &nbsp; 方法：publicstatic String encryptPin(String card, String pwd, String encoding) 密码加密，输入参数依次为卡号、密码、字符集。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKConstants.java：常量类。 定义可能用到的各种常量和所有域名。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.CertUtil.java： 证书操作工具类，主要是导入pfx、cer等证书与获取获取私钥、获取公钥操作。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SecureUtil.java主要负责报文的签名、验证签名及加密解密； 提供MD5、SHA-1以及RSA签名的方法类。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.HttpClient.java 是通信类，具体请参考代码的说明。 提供和服务器通信的HTTP客户端类。 方法：publicint send(Map&lt;String, String&gt; data, String encoding) throwsException 将请求参数以HTTP表单的方式进行一次HTTP POST通信。 &nbsp; Sample说明 com.unionpay.acp.sdksample.front：包下为前台交易demo 方法：com.unionpay.acp.sdksample.back：包下为后台交易demo 具体内容见DEMO代码中的注释和说明。 &nbsp; 11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明 配置文件加载说明 1)&nbsp;&nbsp;&nbsp; acp_sdk.properties i.&nbsp;&nbsp;&nbsp;&nbsp; 从classpath加载 SDKConfig.getConfig().loadPropertiesFromSrc(); ii.&nbsp;&nbsp;&nbsp; 从properties对象中加载 SDKConfig.getConfig().loadProperties(pro); iii.&nbsp;&nbsp; 从指定目录下加载rootPath不包含文件名 SDKConfig.getConfig().loadPropertiesFromPath(rootPath); 2)&nbsp;&nbsp;&nbsp; log4j.properties:放在工程的classpath目录下，系统自动加载 &nbsp; 11.2&nbsp;&nbsp;&nbsp;&nbsp; PHP 插件按编码为gbk编写，工程名称为upacp_sdk_php，供系统集成。 openssl证书需下载使用 其中的php_openssl.dll,ssleay32.dll,libeay32.dll3个文件拷到&nbsp; windows/system32/文件夹下，在重启Apache服务 11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1. SDKConfig.php测试环境配置文件：具体配置项和说明如下； 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 const SDK_FRONT_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/frontTransReq.do&#39;; ##后台交易请求地址 const SDK_BACK_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/backTransReq.do&#39;; ##后台交易请求地址(若为有卡交易配置该地址) constSDK_Card_Request_Url = &#39;https://101.231.204.80:5000/gateway/api/cardTransReq.do&#39;; ##单笔查询请求地址 const SDK_SINGLE_QUERY_URL = &#39;https://101.231.204.80:5000/gateway/api/queryTrans.do&#39;; ##批量交易请求地址 const SDK_BATCH_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/batchTrans.do&#39;; ##文件传输类交易地址 const SDK_FILE_QUERY_URL = &#39;https://101.231.204.80:9080/&#39;; ##APP交易地址 constSDK_App_Request_Url = &#39;https://101.231.204.80:5000/gateway/api/appTransReq.do&#39;; ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 const SDK_SIGN_CERT_PATH = &#39;D:/certs/PM_700000000000001_acp.pfx&#39;; ##签名证书密码 const SDK_SIGN_CERT_PWD = &#39;000000&#39;; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/verify_sign_acp.cer&#39;; ##前台通知地址 (商户自行配置通知地址) const SDK_FRONT_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; // 后台通知地址 (商户自行配置通知地址) const SDK_BACK_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; //文件下载目录 const SDK_FILE_DOWN_PATH = &#39;d:/file/&#39;; //日志 目录 const SDK_LOG_FILE_PATH = &#39;D:/logs/&#39;; //日志级别 const SDK_LOG_LEVEL = &#39;INFO&#39;; &nbsp; ##########################加密证书配置################################ ##密码加密证书路径 const SDK_ENCRYPT_CERT_PATH = &#39;D:/certs/encrypt.cer&#39;; &nbsp; 2. SDKConfig.php ，生产测试环境配置文件：具体配置项和说明如下； &nbsp; 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 const SDK_FRONT_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/frontTransReq.do&#39;; ##后台交易请求地址 const SDK_BACK_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/backTransReq.do&#39;; ##后台交易请求地址(若为有卡交易配置该地址) constSDK_Card_Request_Url = &#39;https://gateway.95516.com/gateway/api/cardTransReq.do&#39;; ##单笔查询请求地址 const SDK_SINGLE_QUERY_URL = &#39;https://gateway.95516.com/gateway/api/queryTrans.do&#39;; ##批量交易请求地址 const SDK_BATCH_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/batchTrans.do&#39;; ##文件传输类交易地址 const SDK_FILE_QUERY_URL = &#39;https://filedownload.95516.com/&#39;; ##APP交易地址 constSDK_App_Request_Url = &#39;https://gateway.95516.com/gateway/api/appTransReq.do&#39;; &nbsp; ##前台通知地址 (商户自行配置通知地址) const SDK_FRONT_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; ##后台通知地址 (商户自行配置通知地址) const SDK_BACK_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; ##文件下载目录 const SDK_FILE_DOWN_PATH = &#39;d:/file/&#39;; ##日志 目录 const SDK_LOG_FILE_PATH = &#39;D:/logs/&#39;; ##日志级别 const SDK_LOG_LEVEL = &#39;INFO&#39;; ########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） const SDK_SIGN_CERT_PATH = &#39;D:/certs/PRO_700000000000001_acp.pfx&#39;; ##签名证书密码 const SDK_SIGN_CERT_PWD = &#39;000000&#39;; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/UPOP_VERIFY.cer&#39;; ##验签证书路径 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/&#39;; ##########################加密证书配置################################ ##密码加密证书路径 const SDK_ENCRYPT_CERT_PATH = &#39;D:/certs/RSA2048_PROD_index_22.cer&#39;; &nbsp; 11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明 主要类与方法说明 upacp_sdk_php.gbk.common.php:负责将请求报文排序后转化为字符串、将字符串转为数组 解压、压缩、构建自动提交表单等 function coverParamsToString($params) 功能: 将请求报文排序后转化为字符串 输入: 请求数组 输出: 排序后的 key1=val1&amp;key2=val2&amp;.... function coverStringToArray($str) 功能: 将字符串转为数组 输入: key1=val1&amp;key2=val2&amp;.... 输出: 数组元素 array(key1=&gt;val1,key2=&gt;val2...) &nbsp; function deal_params(&amp;$params) 功能: 处理返回报文 解码客户信息 输入: 客户信息 输出: 将客户信息组装成customerInfo项 &nbsp; function deflate_file(&amp;$params) 功能: 压缩文件 输入: 带有文件上传的请求报文 输出: 将上传文件压缩后组装进报文 &nbsp; function deal_file($params) 功能: 解压缩文件 输入: 带有文件下载的返回报文 输出: 处理文件内容并保存到指定目录下 &nbsp; function create_html($params, $action) 功能: 构造自动提交的表单 输入: 请求数组($params) ,请求的远程url 输出: 自动提交的form表单字符串 &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.httpClient.php:后台交易 客户端通信等 &nbsp; httpClient.php function sendHttpRequest($params, $url) 功能: 后台交易 HttpClient通信 输入: 请数据,及远程通信url 输出: 后台交易响应信息 &nbsp; function getRequestParamString($params) 功能: 请求数据 urlencode处理后转为key=val&amp;...串 输入: 请求数组 输出: urlencode处理后的key=val&amp;...串 &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.secureUtil.php:负责签名，验签，加载证书，取公钥/私钥，加密卡号/cvn2/有效期等方法类 secureUtil.php function sign(&amp;$params) 功能: 请求数据签名 输入: 请求数组 输出: 带签名的请求数组 &nbsp; function verify($params) 功能: 验签 输入: 返回报文 输出: 成功/失败 &nbsp; function getPulbicKeyByCertId($certId) 功能: 根据证书ID 加载 证书 输入: 证书ID 输出: 证书公钥信息 &nbsp; function getCertId($cert_path) 功能: 取私钥证书ID 输入: 私钥证书路径 输出: 证书ID &nbsp; function getCertIdByCerPath($cert_path) 功能: 取公钥证书ID 输入: 公钥证书路径 输出: 证书ID &nbsp; &nbsp; function getSignCertId() 功能: 取签名证书ID 输入: 签名证书路径 输出: 证书ID &nbsp; function getPublicKey($cert_path) 功能: 获取证书公钥 输入: 证书路径 输出: 公钥 &nbsp; function getPrivateKey($cert_path) 功能: 获取证书私钥 输入: 证书路径 输出: 私钥 &nbsp; function encryptPan($pan) 功能: 加密 卡号 输入: 卡号 输出: 加密后卡号 &nbsp; function encryptPin($pan, $pwd) 功能: pin 加密 输入: 卡号,密码 输出: 加密后密码 &nbsp; function encryptCvn2($cvn2) 功能: cvn2 加密 输入: cvn2 输出: 加密后cvn2 &nbsp; function encryptDate($certDate) 功能: 有效期 加密 输入: 有效期 输出: 加密后有效期 &nbsp; &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.PublicEncrypte.php:密码加密 upacp_sdk_php.gbk.PinBlock.php:密码转pin upacp_sdk_php.gbk.log.class.php:日志类 11.3&nbsp;&nbsp;&nbsp;&nbsp; ASP.NET 插件.net Framework4.0环境以上编写，ICSharpCode.SharpZipLib手动添加，引用工程名称为upacp_sdk_php，供系统集成。 11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1.&nbsp; Web.config:入网测试环境参数配置文件 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 &lt;add key=&quot;sdk.frontTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/frontTransReq.do&quot; /&gt; ##后台交易请求地址 &lt;add key=&quot;sdk.backTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/backTransReq.do&quot; /&gt; ##后台交易请求地址(若为有卡交易配置该地址) &lt;add key=&quot;sdk.cardRequestUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/cardTransReq.do&quot; /&gt; ##批量交易请求地址 &lt;add key=&quot;sdk.batTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/batchTrans.do&quot; /&gt; ##查询地址 &lt;add key=&quot;sdk.singleQueryUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/queryTrans.do&quot; /&gt; ##文件传输类交易地址 &lt;add key=&quot;sdk.fileTransUrl&quot; value=&quot;https://101.231.204.80:9080/&quot; /&gt; ##APP交易地址 &lt;add key=&quot;sdk.appRequestUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/appTransReq.do&quot; /&gt; ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 &lt;add key=&quot;sdk.signCert.path&quot; value=&quot;d:\certs\PM_700000000000001_acp.pfx&quot; /&gt; ##签名证书密码 &lt;add key=&quot;sdk.signCert.pwd&quot; value=&quot;000000&quot; /&gt; ##签名证书类型 &lt;add key=&quot;sdk.signCert.type&quot; value=&quot;PKCS12&quot; /&gt; ##验签 &lt;add key=&quot;sdk.validateCert.dir&quot; value=&quot;d:\certs\&quot; /&gt; ##########################加密证书配置################################ ##密码加密证书路径 &lt;add key=&quot;sdk.encryptCert.path&quot; value=&quot;d:\certs\encrypt.cer&quot; /&gt; &nbsp; 2. &nbsp;Web.config: 生产环境参数配置文件 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 &lt;add key=&quot;sdk.frontTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/frontTransReq.do&quot; /&gt; ##后台交易请求地址 &lt;add key=&quot;sdk.backTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/backTransReq.do&quot; /&gt; ##后台交易请求地址(若为有卡交易配置该地址) &lt;add key=&quot;sdk.cardRequestUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/cardTransReq.do&quot; /&gt; ##单笔查询请求地址 &lt;add key=&quot;sdk.singleQueryUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/queryTrans.do&quot; /&gt; ##批量交易请求地址 &lt;add key=&quot;sdk.batTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/batchTrans.do&quot; /&gt; ##文件传输类交易地址 &lt;add key=&quot;sdk.fileTransUrl&quot; value=&quot;https://filedownload.95516.com/&quot; /&gt; ##APP交易地址 &lt;add key=&quot;sdk.appRequestUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/appTransReq.do&quot; /&gt; ########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） &lt;add key=&quot;sdk.signCert.path&quot; value=&quot;d:\certs\PRO_700000000000001_acp.pfx&quot; /&gt; ##签名证书密码 &lt;add key=&quot;sdk.signCert.pwd&quot; value=&quot;000000&quot; /&gt; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 &lt;add key=&quot;sdk.validateCert.dir&quot; value=&quot;d:\certs\&quot; /&gt; ##########################加密证书配置################################ ##密码加密证书路径 &lt;add key=&quot;sdk.encryptCert.path&quot; value=&quot;d:\certs\RSA2048_PROD_index_22.cer&quot; /&gt; &nbsp; 11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明 主要类与方法说明 com.unionpay.acp.sdk.SDKConfig.cs:负责读取web.config //功能：读取配置文件获取签名证书路径 private static string signCertPath = config.AppSettings.Settings[&quot;sdk.signCert.path&quot;].Value; //功能：读取配置文件获取签名证书密码 private static string signCertPwd = config.AppSettings.Settings[&quot;sdk.signCert.pwd&quot;].Value; //功能：读取配置文件获取验签目录 private static string validateCertDir = config.AppSettings.Settings[&quot;sdk.validateCert.dir&quot;].Value; //功能：加密公钥证书路径 private static string encryptCert = config.AppSettings.Settings[&quot;sdk.encryptCert.path&quot;].Value; //功能：有卡交易路径;&nbsp; private static string cardRequestUrl = config.AppSettings.Settings[&quot;sdk.cardRequestUrl&quot;].Value; //功能：app交易路径;&nbsp; private static string appRequestUrl = config.AppSettings.Settings[&quot;sdk.appRequestUrl&quot;].Value; //功能：读取配置文件获取交易查询地址&nbsp; private static string singleQueryUrl = config.AppSettings.Settings[&quot;sdk.singleQueryUrl&quot;].Value; //功能：读取配置文件获取文件传输类交易地址 private static string fileTransUrl = config.AppSettings.Settings[&quot;sdk.fileTransUrl&quot;].Value;&nbsp; 功能：读取配置文件获取前台交易地址 private static string frontTransUrl = config.AppSettings.Settings[&quot;sdk.frontTransUrl&quot;].Value; 功能：读取配置文件获取后台交易地址 private static string backTransUrl = config.AppSettings.Settings[&quot;sdk.backTransUrl&quot;].Value; //功能：读取配批量交易地址 private static string batTransUrl = config.AppSettings.Settings[&quot;sdk.batTransUrl&quot;].Value; &nbsp; &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKUtil.cs：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。 获取签名。 public static bool Sign(Dictionary&lt;string, string&gt; data, Encoding encoder) 验证签名 public static bool Validate(Dictionary&lt;string, string&gt; data, Encoding encoder) 组装报文 public static string CreateAutoSubmitForm(string url, Dictionary&lt;string, string&gt; data, Encoding encoder) 将Dictionary内容排序后输出为键值对字符串,供打印报文使用 &nbsp;public static string PrintDictionaryToString(Dictionary&lt;string, string&gt; data) 将形如key=value&amp;key=value的字符串转换为相应的Dictionary对象 public static Dictionary&lt;string, string&gt; CoverstringToDictionary(string data) pinblock 16进制计算 public static string printHexString(byte[] b) 密码加密，输入参数依次为卡号、密码、字符集 Publicstatic string encryptPin(string card, string pwd, string encoding) 数据加密，输入参数依次为数据、字符集 Publicstatic string encryptData(string data，string encoding) &nbsp; &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.CertUtil.cs： 证书操作工具类，主要是导入pfx证书与获取获取私钥操作。 获取签名证书私钥 public static RSACryptoServiceProvider GetSignProviderFromPfx() 获取签名证书的证书序列号 &nbsp;public static string GetSignCertId() 通过证书id，获取验证签名的证书 public static RSACryptoServiceProvider GetValidateProviderFromPath(string certId) &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SecureUtil.cs主要负责报文的软签名、验证签名、加密； 压缩、解压、Base64编码/解码,pinblock计算等提供SHA-1及RSA的方法类。 摘要计算 &nbsp;public static byte[] Sha1X16(string dataStr, Encoding encoding) 软签名 &nbsp;public static byte[] SignBySoft(RSACryptoServiceProvider provider, byte[] data) 验证签名 &nbsp;public static bool ValidateBySoft(RSACryptoServiceProvider provider, byte[] base64DecodingSignStr, byte[] srcByte) Base64编码 public static string EncodeBase64(Encoding encode, string source) Base64解码 &nbsp;public static string DecodeBase64(Encoding encode, string result) Inflater解压缩 public static byte[] inflater(byte[] inputByte) deflater压缩 &nbsp;public static byte[] deflater(byte[] inputByte) 密码计算 private static byte[] pin2PinBlock(string aPin) 获取卡号密码pinblock计算 public static byte[] pin2PinBlockWithCardNO(string aPin, string aCardNO) &nbsp;卡号计算 private static byte[] formatPan(string aPan) 加密 public static byte[] encryptedData(byte[] encData) &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.HttpClient.cs 是通信类，具体请参考代码的说明。 提供和服务器通信的HTTP客户端类。 将请求参数以HTTP表单的方式进行一次HTTP POST通信。 Publicint Send(Dictionary&lt;string, string&gt;sParaTemp, Encoding encoding) &nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答 Q：如何获取测试商户号与测试证书？ A：测试环境申请测试用户后点击“我的测试&gt;测试参数”中查看商户号，并点击下载测试证书，注册地址：https://open.unionpay.com/ajweb/register，生产环境请联系业务部门，具体联系方式如下： 发送邮件至： operation@unionpay.com进行业务申请和咨询，银联有专门的人员进行处理。 其他专项服务：请见《业务运营服务指引（商户） 》日常业务运营服务。 Q：如何签名？ A：对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。 Q：报文域中frontUrl和backUrl要填什么？ A:frontUrl和backUrl为报文上送要素，银联系统将前台通知报文返回到报文中的frontUrl地址，将后台通知报文返回到报文中的backUrl地址。 Q：如何获取与配置银联入网测试环境地址？ A : 可参见11章节测试环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。具体接入地址如下： 银联入网测试环境地址： 前台交易请求地址 https://101.231.204.80:5000/gateway/api/frontTransReq.do 后台交易请求地址（无卡） https://101.231.204.80:5000/gateway/api/backTransReq.do 后台交易请求地址（有卡） https://101.231.204.80:5000/gateway/api/cardTransReq.do 单笔查询请求地址 https://101.231.204.80:5000/gateway/api/queryTrans.do 批量交易请求地址 https://101.231.204.80:5000/gateway/api/batchTrans.do 文件传输类交易地址 https://101.231.204.80:9080/ APP交易请求地址 https://101.231.204.80:5000/gateway/api/appTransReq.do &nbsp; Q：银联全渠道系统商户接入生产环境地址？ A : 可参见11章节生产环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。将配置文件中测试地址修改为如下地址： 银联入网测试环境地址： 前台交易请求地址 https://gateway.95516.com/gateway/api/frontTransReq.do 后台交易请求地址（无卡） https://gateway.95516.com/gateway/api/backTransReq.do 后台交易请求地址（有卡） https://gateway.95516.com/gateway/api/cardTransReq.do 单笔查询请求地址 https://gateway.95516.com/gateway/api/queryTrans.do 批量交易请求地址 https://gateway.95516.com/gateway/api/batchTrans.do 文件传输类交易地址 https://filedownload.95516.com/ APP交易请求地址 https://gateway.95516.com /gateway/api/appTransReq.do &nbsp; Q：商户接收到银联的前台通知和后台通知，以哪个为准？ A：交易状态请以后台通知结果为准。银联系统会将后台通知结果以post的方式发送到报文中backUrl后台通知地址上，如商户未收到通知，系统会持续发送，如发送成功则不再发送，5次通知失败则不再发送，失败交易则不发送。 后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。具体参见第6章节。 Q：上午做的交易，下午做撤销会报非当日交易不能撤销？ A：测试环境的日切时间在下午1点半，早上的交易会归为前一日，下午的交易才是当日交易。 Q：如果调用数次查询接口后，一直得到处理中状态，该怎么办？ A：对于网银支付模式与非网银支付模式描述如下： 网银支付模式：跳转到银行后，订单状态为正在处理中。查询的结果为正在处理中。等银行有响应的时候，银联全渠道系统会根据银行的应答，修改订单状态为成功或失败。如用户在网银页面直接关闭浏览器，查询的结果则一直为处理中。若超过1小时，查询结果状态仍为处理中，一般可认为是用户关闭了浏览器，可当作失败处理。若产生单边账，可以第二天通过对账退还金额给用户。 非网银支付模式：银联全渠道系统会控制超时时间，一般用户支付2分钟后会有明确的状态，查询的结果不是成功就是失败，失败的交易允许用户重新支付，即如用户1点支付的时候失败，1点05分再次支付成功，则商户如果1点03分查询的时候结果为交易失败，1点06分查询的时候结果为成功。 Q：消费撤销和退货有何不同？ A：当天的交易可以执行消费撤销，消费撤销只能全额。 &nbsp;当天或隔天的交易都可以做退货，退货可以进行多次退货，每次金额小于原始金额，订单退款总金额不能大于此订单原始金额。 Q：标准网关支付跳转银联页面HTTP400报错是什么原因？ A：银联全渠道系统对报文校验较为严格，对未定义的报文域会提示http400报错，请核对产品接口规范文档（https://open.unionpay.com/ajweb/help?id=74&amp;level=0&amp;from=1）中的报文域。 Q：什么是全渠道支付平台？ A：全渠道支付平台是中国银联全渠道接入支付平台的简称，支持移动、互联网等渠道的收单业务，包含互联网支付产品（银联在线支付、预授权支付、B2B对公支付、跨境支付、无跳转支付）、移动终端渠道产品（手机安全支付控件、WAP页面支付、平板电脑（iPad）网关支付、预授权支付、跨境支付、无跳转支付（手机端暂无））、后台模式产品（ 订购、 代收、代付）。 Q：银联全渠道入网测试的账号（卡号）是什么？ A：接入银联全渠道入网测试环境需要使用银联提供的测试卡进行交易，当前仅提供两张可供测试的卡片，一张B2B企业网银的虚拟卡片，具体账号信息如下： 测试卡号 平安银行借记卡：6216261000000000018 证件号：341126197709218366 手机号：13552535506 密码：123456 姓名：全渠道 平安银行贷记卡：6221558812340000 姓名：互联网 证件号：341126197709218366 手机号：13552535506 cvn2:123 有效期：1711 B2B企业网银农行虚拟卡 卡号：123456789001 密码：789001 Q：银联全渠道相关接口文档在哪里获取？ A：由银联提供的全渠道相关文档可在商户服务网站下载（https://merchant.unionpay.com/portal/pages/login/download.jsp?locale=zh_CN），也可以在自助化测试平台首页 &gt; 帮助中心 &gt;下载（https://open.unionpay.com/ajweb/help/file）中获取。 阅读更多" />
<link rel="canonical" href="https://mlh.app/2015/10/09/6e385ba7f173403a00abdb736127f093.html" />
<meta property="og:url" content="https://mlh.app/2015/10/09/6e385ba7f173403a00abdb736127f093.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-10-09T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"直接把银联的联调测试文档贴来了 中国银联股份有限公司规范性文档 中国银联股份有限公司 发布 &nbsp; 中国银联全渠道系统商户接入 测试指引-银联网关支付产品 版本修订信息 版本号 完成日期 发布日期 变更说明 1.0.0 2014-7-03 2014-7-03 初稿 1.0.1 2014-11-04 2014-11-05 修改文档格式，新增测试地址与测试卡号等信息 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 目录 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文档说明... 6 1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;导读... 6 1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;阅读对象... 6 1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业务术语... 7 1.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;技术服务... 7 1.4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试模式划分... 7 1.4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;支持获取途径... 8 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;联调步骤向导... 9 2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易开发... 9 2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试联调... 9 2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;切换上线... 9 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试参数与产品相关交易... 9 3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试与生产地址... 9 3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试卡号... 9 3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;产品相关交易... 10 3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;产品介绍... 11 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交易模式说明... 11 4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通讯方式... 12 4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易流程... 12 4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台资金类交易流程... 13 4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台非资金类交易流程... 15 4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询交易流程... 15 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导... 16 5.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易开发步骤... 16 5.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台类异步交易接口开发步骤... 17 5.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台类同步交易接口开发步骤... 17 5.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单笔查询交易接口开发步骤... 18 5.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件传输类交流开发步骤... 18 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台应答与后台通知说明... 19 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明... 21 7.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;前台交易... 21 7.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台资金交易... 21 7.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后台非资金交易... 21 7.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询交易... 21 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签名机制... 22 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;加密机制... 22 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明... 23 10.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;概述... 23 10.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载及导出流程(ok)23 10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程... 23 10.2.2证书导出流程...27 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用... 32 11.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSP/JAVA.. 32 11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 32 11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明... 35 11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明... 38 11.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHP. 38 11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 38 11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明... 43 11.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASP.NET. 48 11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明... 49 11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明... 52 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答... 57 &nbsp; &nbsp; &nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 文档说明 1.1&nbsp;&nbsp; 导读 网关产品主要适用于持卡人在商户网站B2C购物支付场景，持卡通过点击银联在线支付logo，并在银联在线支付网关完成支付信息录入，最终完成支付。 从PC端发起的交易为WEB网关支付交易，从移动端发起的交易为WAP网关支付交易以及APP网关交易。 首次接入测试先了解前台交易与后台交易的区别，可参考第1.3章节业务术语描述，随后可从第5章节开发步骤向导开始阅读，了解开发过程中的具体操作步骤，此章节中提到的签名机制请参照第8章节。开发过程中需要用到的测试与生产交易地址请参考第11章节配置文件。交易测试卡号请参考第3.2章节。如开发与测试过程中遇到了解决不了的问题可在第12章节FAQ中查找解决方案，也可通过第1.4.2章节中的方法来获取测试支持。 1.2&nbsp;&nbsp; 阅读对象 《中国银联全渠道系统商户接入测试指引》文档是面向具有一定的网站开发能力的网站开发、维护和管理人员。 具体交易的接口、报文规范、响应码说明，请阅读开发包中接口文档。 参与方描述 &nbsp; 商户 指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》等协议开展银联无卡支付以及行业类应用业务的商户。 收单机构 指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》开展银联无卡支付收单业务的境内成员机构。 &nbsp; 1.3&nbsp;&nbsp; 业务术语 术语 解释 请求 通过 HTTP/HTTPS协议把需要传输的数据发送给接收方的过程。 应答 通过 HTTP/HTTPS协议把需要传输的数据返回给接收方的过程。 后台通知 服务器后台通知。中国银联全渠道系统根据得到的数据处理完成后，全渠道系统主动发起通知给商户的网站，同时携带处理完成的结果信息反馈给商户网站。 前台类交易 主要指用户需要参与交互的支付类交易，包括消费、预授权/担保消费交易。 后台类交易 主要指用户不需要参与交互，由商户后续发起的交易，包括消费撤销、退货、预授权撤销、预授权完成、预授权完成撤销等交易。 全渠道系统/ACP 中国银联全渠道系统，是整合了银联在线和银联移动支付功能的新交易处理系统。 &nbsp; 1.4&nbsp;&nbsp; 技术服务 1.4.1 测试模式划分 接入网关支付产品的商户为选测。 注： 必测是指提交了入网申请表、必须测试通过才能投产上线的，选测是指不需要入网申请表可以直接投产上线的，是否在测试环境测试由商户自己决定。 必测 选测 收单机构接入 商户接入（接入产品为除无跳转支付、后台直接支付、代收和便民缴费以外的其他产品） 商户接入（接入产品为无跳转支付、后台直接支付、代收和便民缴费） 1.4.2 支持获取途径 业务问题详见开发包中《中国银联全渠道系统业务运营服务指引》相关人员联系方式。 测试问题支持人员联系方式详见下表： &nbsp; 必测 选测 收单机构可联系银联服务专员，并且在提交了入网申请后银联服务专员会主动联系商定窗口并提供测试支持服务 商户可发送邮件到acpservice@unionpay.com邮箱（邮件标题为：商户号+商户名称+联系QQ），提供商户号和联系QQ，银联测试服务专员会将商户接口人的联系QQ加入到银联统一服务QQ中提供支持服务（商户也可以通过服务电话021-38929999-2049来提供自己的商户号和联系QQ） 银联市场服务代表在为商户提交了入网申请后，会有银联服务专员主动联系（一般为QQ）商定联调窗口并提供测试支持服务 注： 服务邮箱和服务电话仅供选测类商户联系测试支持人员，并且邮箱和电话不直接反馈支持问题，支持服务均在银联统一服务QQ中提供。 2&nbsp;&nbsp;&nbsp;&nbsp; 联调步骤向导 2.1&nbsp;&nbsp; 交易开发 商户或收单机构全渠道系统开发包和本测试指引进行接入开发。 2.2&nbsp;&nbsp; 测试联调 本步骤可选。开发完成后可通过银联提供的联调测试环境进行联机接口验证测试，测试地址参考测第11章节配置文件说明。 2.3&nbsp;&nbsp; 切换上线 在测试环境完成联调测试后，由银联业务运营人员(联系方式参见《中国银联全渠道系统业务运营服务指引》)引导协助商户完成生产交易证书的申请，商户将接口更新部署到生产环境和银联生产环境完成对接。 3&nbsp;&nbsp;&nbsp;&nbsp; 测试参数与产品相关交易 3.1&nbsp; 测试与生产地址 测试地址详见第11章节配置文件描述。 3.2&nbsp; 测试卡号 测试卡号 平安银行借记卡：6216261000000000018 证件号：341126197709218366 手机号：13552535506 密码：123456 姓名：全渠道 平安银行贷记卡：6221558812340000 姓名：互联网 证件号：341126197709218366 手机号：13552535506 cvn2:123 有效期：1711 3.3&nbsp; 产品相关交易 &nbsp; 序号 接口名称 功能说明 交易模式 1 消费类交易（前台类） 持卡人进支付时，由银联或发卡行展示支付页面，引导持卡人完成后续支付的交易。 前台资金类交易 2 消费撤销类交易 指因人为原因而撤销已完成的消费；消费撤销必须是撤销CUPS当日当批的消费 后台资金类交易 3 退货类交易 对于已结算的消费交易，通过该交易发起退款交易。 后台资金类交易 4 交易状态查询类交易 对未收到应答的或交易状态未知的交易，可通过该交易进行查询。 查询类交易 5 文件传输类交易 联机下载对账文件等文件下载类交易 后台非资金交易 6 预授权类交易 预授权交易用于受理方向持卡人的发卡方确认交易许可。受理方将预估的消费金额作为预授权金额，发送给持卡人的发卡方。 前台或后台资金类交易 7 授权撤销类交易 对已成功的预授权交易，在结算前使用该交易进行取消。 后台资金类交易 8 授权完成类交易 对已批准的预授权交易，用该交易进行支付结算； 后台资金类交易 9 授权完成撤销类交易 预授权完成撤销交易必须是对原始预授权完成交易的全额撤销。预授权完成撤销后的预授权仍然有效。 后台资金类交易 10 余额查询 &nbsp; 后台非资金类交易 11 电子现金非指定账户圈存 &nbsp; 后台资金类交易 12 电子现金指定账户圈存 &nbsp; 后台资金类交易 13 圈存脚本通知 &nbsp; 后台资金类交易 14 IC卡脱机消费通知 &nbsp; 后台资金类交易 3.4&nbsp; 产品介绍 产品介绍详见《网关支付产品入网材料》包中的《银联全渠道系统网关产品.pptx》。 4&nbsp;&nbsp;&nbsp;&nbsp; 交易模式说明 从技术实现方式上交易大致可划分为前台类交易、后台资金类类交易、后台非资金类交易、查询类交易、批量类交易。本节将描述各种交易的大致流程。 4.1&nbsp;&nbsp; 通讯方式 所有报文域以key/value的表单方式通过HTTP Post到银联全渠道系统支付平台。对于前台类需要持卡人交互的交易，交易通过异步跳转的方式完成，对于涉及资金的前台类交易，银联全渠道系统支付平台可通过商户后台通知地址向商户发送后台通知。对于后台类涉及资金清算类无需持卡人交互的交易，交易结果异步响应给商户，商户通过接受后台通知或者发起交易查询获取交易处理结果。对于后台类非资金类无需持卡人交互的交易，交易结果同步响应给商户。对应交易状态查询类交易，交易结果同步响应给商户。 4.2&nbsp;&nbsp;前台交易流程 前台类交易是指交易请求方（如商户、收单机构）与ACP之间的交易信息通过用户浏览器进行传递的交易，是一种异步的、需要持卡人参与完成的交易类型。对于涉及金额的前台类交易（即交易请求中有金额字段）ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。 图 1‑1 注意点： 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考接口文档； 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第8步前台应答返回的URL为请求报文中的“frontUrl”字段指定的URL； 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第7步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL； 4.3&nbsp;&nbsp; 后台资金类交易流程 后台类资金类交易是指交易请求方（如商户、收单机构），将交易信息（涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。是一种异步的、不需要持卡人参与完成的交易类型。因涉及资金的清算，ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。 图 1‑3 注意： 1.&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考开发包中接口规范文档； 2.&nbsp;&nbsp;&nbsp;&nbsp; 图1-3中第4步中的应答仅代表该笔后台请求交易已经受理，不代表全部处理成功；是否处理成功，需通过接受后台通知或者发起“交易状态查询交易”进行查询； 3.&nbsp;&nbsp;&nbsp;&nbsp; 第5步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL。 &nbsp; &nbsp; &nbsp; 4.4&nbsp;&nbsp; 后台非资金类交易流程 后台类非资金类交易是指交易请求方（如商户、收单机构）将交易信息（不涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。后台非资金类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。若通讯超时，则交易请求方可以重复发起交易。 图1‑4 4.5&nbsp;&nbsp; 查询交易流程 查询交易是指交易请求方（如商户、收单机构）将交易查询报文信息直接通过请求方服务器发送至ACP服务器的交易方式。查询类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。，若通讯超时，则交易请求方可以重复发起交易。 图 1‑5 &nbsp; &nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导 5.1&nbsp;&nbsp; 前台交易开发步骤 1. 以表单的方式组装要发送给银联全渠道系统的数据对象（包括IC卡交易信息域，VPC交易信息域，风控信息域等各域）。每个域填写方法可参考文档开发包中接口文档。 2. 将组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”具体签名机制请参照第8章节。可通过调用插件包提供的签名方法来完成签名。 3. 把所有要发送给银联全渠道系统的域包括signature和signMethod，组成表单以POST方式送给银联全渠道系统前台交易的地址。 4. 交易完成后，银联全渠道系统将把交易结果分别返回通知到商户通的前台应答地址和后台应答地址上，商户接收到交易通知后可分别调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.2&nbsp;&nbsp; 后台类异步交易接口开发步骤 1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。 2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。 3. 把所有数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。 4. 接收到返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.3&nbsp;&nbsp; 后台类同步交易接口开发步骤 1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。 2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第8章节。 3. 数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。 4. 返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap (应答报文);”方法进行应答报文解析，和“SDKUtil.validate (应答报文, 报文字符集)”方法进行签名验证。 5.4&nbsp;&nbsp;单笔查询交易接口开发步骤 1.照单笔查询交易的规范组装报文，交易报文请参考开发包中接口文档 2.好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.sign(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。 3.数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过SDK提供的方法进行发送。 4.返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.convertResultStringToMap(应答报文);”方法进行应答报文解析，和“SDKUtil.validate(应答报文, 报文字符集)”方法进行签名验证。 5.5&nbsp;&nbsp;文件传输类交流开发步骤 文件的格式，参照接口文档，文件名，文件头，文件，文件以inputfilepost方式提交到服务器，以文件流的方式获取字节流信息，先需要解压缩文件内容的byte[]数组，用SecureUtil.deflater方法，后BASE64编码，用SecureUtil.base64Encode方法，返回，最终以字符串方式提交到处理服务器，服务器响应报文里有filecontent字段，先用SecureUtil.base64Decode解码，后用SecureUtil.inflater方法解压缩，返回byte[],接下来就可以通过文件输出的方法，生成文件。 文件转字符串 图2‑1 6&nbsp;&nbsp;&nbsp;&nbsp; 前台应答与后台通知说明 前台交易，商户或机构需要提供两个地址frontUrl和backUrl（通过报文域上送），分别接收银联全渠道系统的前台应答和后台通知。前台应答是通过浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联全渠道系统异步把交易状态为成功的交易通知给商户。具体详细关于前台应答和后台通知请参照接口文档。不管收到前台应答还是后台通知，商户都需要验签。 在交易结束后，银联全渠道系统通过后台通知将交易结果发给商户或机构。后台通知以标准的HTTP协议的POST方法向商户的后台通知URL发送，并设置一个超时计时器，通常设置为10s。商户在收到通知，解析后应立即返回应答报文。仅当POST返回码为200时，才认为商户已经成功收到并且能正确解析后台通知，其他返回码则被认为通知失败。如果计时器超时，没有收到应答报文，也被认为通知失败。 第一次通知失败后，会通过退避策略进行通知重发，最多发送五次。由于网络等原因，商户会收到重复的后台通知。 商户或机构在接收到银联全渠道系统的前台应答或后台通知后，首先必须验证该消息的签名，然后根据订单号等信息，更新相应系统中的订单支付状态。前台通知因存在用户支付完毕后直接关闭浏览器的情况，而不能保证每次都送达。后台通知由银联银联全渠道系统通知服务器主动发起，若发送失败，银联全渠道系统会继续发送，一共发送5次，若还是发送失败，也不继续发送。商户在未收到后台应答，建议请求20分钟后主动发起交易查询交易来查询交易状态。 另外，退货等后台类交易（若有开发）是异步过程，银联全渠道系统收到后台类交易请求后会回复一个请求已接受的应答。在交易处理后，银联全渠道系统会发送后台通知给商户，建议商户无论是否收到后台通知，在请求2分钟后主动发起交易查询交易来查询交易状态。 注：银联全渠道系统只针对成功交易会发送后台通知，失败交易不发送后台通知。因此，如未收到后台通知，建议商户主动发起交易查询交易，查询交易状态。 另外后台通知接收需要注意以下几点： 1.后台通知采用POST的方式来发送，POST的地址是商户上送的backUrl域，backUrl域需要保证该地址的正确性。 2.后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。 3.确定通知成功由以下几个要素 a)&nbsp;&nbsp;&nbsp;&nbsp; 通知URL填写正确（商户必须要保证URL的正确性） b)&nbsp;&nbsp;&nbsp;&nbsp; 通信正确（通信失败时必须重发） c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 商户能够正确验签（测试环境要测试通过） 因此，只要生产上能够证明通信是正确的，即可认为通知成功。如果商户端因为某种特殊原因，没有正确处理后台通知，可以通过交易查询接口来纠正交易的状态。 7&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明 7.1&nbsp;&nbsp; 前台交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参考5.4章节。 7.2&nbsp;&nbsp; 后台资金交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参见第4.5章节。 7.3&nbsp;&nbsp; 后台非资金交易 后台交易采用同步机制，交易结果同步返回。 7.4&nbsp;&nbsp; 查询交易 1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已接收到明确的交易结果应答，则不需要发起查询。 2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 前台交易，若未接收到全渠道系统的明确交易应答时需发起单笔查询交易，查询明确的交易结果。 3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 后台交易，若出现交易超时的情况则需要发起单笔查询交易，查询明确的交易结果。 8&nbsp;&nbsp;&nbsp;&nbsp;签名机制 对于报文的签名处理机制如下： 首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。 对于报文的验签处理机制如下： 首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用商户入网时银联提供的银联全渠道系统支付通讯RSA公钥证书对摘要和报文中的签名信息做签名验证操作。 9&nbsp;&nbsp;&nbsp;&nbsp; 加密机制 对于持卡人密码银联全渠道系统支付平台使用RSA公钥证书对ANSI X9.8带主帐号格式的PIN加密并做Base64编码后传输，以保障密码的安全性。依据商户可选配置，对于CVN2、有效期、卡号使用RSA公钥证书分别做加密并Base64处理。 对于敏感信息银行卡验证信息及身份信息部分内容，采用Base64编码后传输，以做数据屏蔽。 对于文件内容，使用DEFLATE压缩算法压缩后，Base64编码的方式传输，压缩编码后的内容参与签名摘要运算。 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明 10.1&nbsp;&nbsp;&nbsp;&nbsp; 概述 1. 商户签名证书：商户接入银联支付后会收到两码，通过在CFCA网站下载pfx证书。此证书用于请求报文的签名。测试证书随开发包提供。 2. 商户的密码加密证书：商户会收到一个密码加密的公钥证书，此证书用于对银行卡密码的加密、cvn2、有效期及卡号等的加密。测试证书随开发包提供。 3. 商户的交易报文验证签名证书：验证银联支付返回的报文是否合法。测试证书随开发包提供。 &nbsp; 10.2&nbsp;&nbsp;&nbsp;&nbsp; 证书下载及导出流程(ok) 10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程 1.&nbsp;&nbsp;&nbsp;&nbsp; 登入CFCA官网网址：www.cfca.com.cn，点击“生产系统证书下载”； &nbsp; &nbsp; 2.&nbsp;&nbsp;&nbsp;&nbsp; 在生产证书下载选项中点击 à 证书下载； &nbsp; 3.&nbsp;&nbsp;&nbsp;&nbsp; 首次下载证书,请按照页面提示安装相应程序，以保证证书顺利下载； &nbsp; 4.&nbsp;&nbsp;&nbsp;&nbsp; 点击左侧“用户证书下载”，并点击“接受此协议”； 5.&nbsp;&nbsp;&nbsp;&nbsp; 输入CFCA提供的两码（用户参考号、用户授权码），制证方式默认，软件CSP默认，点击下 &nbsp; 6.&nbsp;&nbsp;&nbsp;&nbsp; 完成下载操作后，页面会出现下载成功的提示。下载的证书自动存放在IE中。 &nbsp; 10.2.2证书导出流程 1. 打开浏览器，点选 工具 à Internet选项 à 内容 à 证书； 2. 以商户号：700000000000001为例说明整个导出流程 在个人证书中找到相对应的证书，点选导出； &nbsp; 3.跳出证书导出向导对话框，点击下一步； &nbsp; 4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 选择导出私钥（如需要在服务网站上传证书公钥，请选择第二个选项以下载公钥证书，后续操作选择默认方式，再选择路径导出），点击下一步； &nbsp; 5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 导出文件格式默认点击下一步； &nbsp; 6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 键入证书私钥，建议不要超过6位； &nbsp; 7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 指定导出证书的文件名，并选择目录存放证书，点击下一步； &nbsp; 8.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 点击完成，证书导出成功。 &nbsp; 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用 插件包只是为了方便商户测试而提供的样例代码，商户可以根据自己网站的需要，按照技术文档编写,并非一定要使用该代码。代码仅供参考 11.1&nbsp;&nbsp;&nbsp;&nbsp; JSP/JAVA 插件以JAR包的形式提供给商户，工程名称为upacp_sdk_java。 11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1.&nbsp; log4j.properties:插件的日志机制使用log4j实现，可将提供的配置文件合并到项目的log4j配置中，并根据环境需要修改日志路径； 2.&nbsp;acp_sdk.properties:测试环境参数配置文件（不含手机控件支付） 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### #SDK 日志目录配置 log.back.rootPath=d://log ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 acpsdk.frontTransUrl=https://101.231.204.80:5000/gateway/api/frontTransReq.do ##&nbsp;app&nbsp;交易请求地址 ##&nbsp;acpsdk.appTransUrl=https://101.231.204.80:5000/gateway/api/appTransReq.do ##后台交易请求地址 acpsdk.backTransUrl=https://101.231.204.80:5000/gateway/api/backTransReq.do ##后台交易请求地址(若为有卡交易配置该地址) #acpsdk.cardTransUrl=https://101.231.204.80:5000/gateway/api/cardTransReq.do ##单笔查询请求地址 acpsdk.singleQueryUrl=https://101.231.204.80:5000/gateway/api/queryTrans.do ##批量交易请求地址 acpsdk.batchTransUrl=https://101.231.204.80:5000/gateway/api/batchTrans.do ##文件传输类交易地址 acpsdk.fileTransUrl=https://101.231.204.80:9080/ ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 acpsdk.signCert.path=d:\\\\certs\\\\700000000000001_acp.pfx ##签名证书密码 acpsdk.signCert.pwd=000000 ##签名证书类型 acpsdk.signCert.type=PKCS12 ##########################加密证书配置################################ ##密码加密证书路径 acpsdk.encryptCert.path=d:\\\\certs\\\\encrypt.cer 3.acp_sdk.properties:生产环境参数配置文件 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 acpsdk.frontTransUrl=https://gateway.95516.com/gateway/api/frontTransReq.do ##&nbsp;app&nbsp;交易请求地址 ##&nbsp;acpsdk.appTransUrl=https://gateway.95516.com /gateway/api/appTransReq.do ##后台交易请求地址 acpsdk.backTransUrl=https://gateway.95516.com/gateway/api/backTransReq.do ##后台交易请求地址(若为有卡交易配置该地址) #acpsdk.cardTransUrl=https://gateway.95516.com /gateway/api/cardTransReq.do ##单笔查询请求地址 acpsdk.singleQueryUrl=https://gateway.95516.com/gateway/api/queryTrans.do ##批量交易请求地址 acpsdk.batchTransUrl=https://gateway.95516.com/gateway/api/batchTrans.do ##文件传输类交易地址 acpsdk.fileTransUrl=https://filedownload.95516.com/ &nbsp;########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） acpsdk.signCert.path=d:\\\\certs\\\\700000000000001_acp.pfx ##签名证书密码 acpsdk.signCert.pwd=123456 ##签名证书类型 acpsdk.signCert.type=PKCS12 ##########################加密证书配置################################ ##密码加密证书路径 acpsdk.encryptCert.path=d:\\\\certs\\\\encrypt.cer &nbsp; 11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKConfig.java:负责读取acp_sdk.properties及设置参数。 方法：public void loadPropertiesFromSrc() 从标准CLASS类路径下LOAD配置文件。 &nbsp; 方法：public void loadPropertiesFromPath(String rootPath) 从标准CLASS类路径下LOAD配置文件。 &nbsp; 方法：public void loadProperties(Properties pro) 使用传入的Properties对象LOAD配置。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKUtil.java：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。 方法：publicstatic String send(String url, Map&lt;String, String&gt; data, String encoding,intconnectionTimeout, intreadTimeout) 发送后台交易。 &nbsp; 方法：publicstaticboolean sign(Map&lt;String, String&gt; data, String encoding) 生成签名。 &nbsp; 方法：publicstaticboolean validate(Map&lt;String, String&gt; resData, String encoding) 验证签名。 &nbsp; 方法：publicstatic String coverMap2String(Map&lt;String, String&gt; data) 将Map形式的表单交易数据转换为key1=value1&amp;key2=value2的形式 &nbsp; 方法：publicstatic Map&lt;String, String&gt; coverResultString2Map(String result) 将形如key=value&amp;key=value的字符串转换为相应的Map对象 &nbsp; 方法：publicstatic String encryptPin(String card, String pwd, String encoding) 密码加密，输入参数依次为卡号、密码、字符集。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKConstants.java：常量类。 定义可能用到的各种常量和所有域名。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.CertUtil.java： 证书操作工具类，主要是导入pfx、cer等证书与获取获取私钥、获取公钥操作。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SecureUtil.java主要负责报文的签名、验证签名及加密解密； 提供MD5、SHA-1以及RSA签名的方法类。 &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.HttpClient.java 是通信类，具体请参考代码的说明。 提供和服务器通信的HTTP客户端类。 方法：publicint send(Map&lt;String, String&gt; data, String encoding) throwsException 将请求参数以HTTP表单的方式进行一次HTTP POST通信。 &nbsp; Sample说明 com.unionpay.acp.sdksample.front：包下为前台交易demo 方法：com.unionpay.acp.sdksample.back：包下为后台交易demo 具体内容见DEMO代码中的注释和说明。 &nbsp; 11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明 配置文件加载说明 1)&nbsp;&nbsp;&nbsp; acp_sdk.properties i.&nbsp;&nbsp;&nbsp;&nbsp; 从classpath加载 SDKConfig.getConfig().loadPropertiesFromSrc(); ii.&nbsp;&nbsp;&nbsp; 从properties对象中加载 SDKConfig.getConfig().loadProperties(pro); iii.&nbsp;&nbsp; 从指定目录下加载rootPath不包含文件名 SDKConfig.getConfig().loadPropertiesFromPath(rootPath); 2)&nbsp;&nbsp;&nbsp; log4j.properties:放在工程的classpath目录下，系统自动加载 &nbsp; 11.2&nbsp;&nbsp;&nbsp;&nbsp; PHP 插件按编码为gbk编写，工程名称为upacp_sdk_php，供系统集成。 openssl证书需下载使用 其中的php_openssl.dll,ssleay32.dll,libeay32.dll3个文件拷到&nbsp; windows/system32/文件夹下，在重启Apache服务 11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1. SDKConfig.php测试环境配置文件：具体配置项和说明如下； 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 const SDK_FRONT_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/frontTransReq.do&#39;; ##后台交易请求地址 const SDK_BACK_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/backTransReq.do&#39;; ##后台交易请求地址(若为有卡交易配置该地址) constSDK_Card_Request_Url = &#39;https://101.231.204.80:5000/gateway/api/cardTransReq.do&#39;; ##单笔查询请求地址 const SDK_SINGLE_QUERY_URL = &#39;https://101.231.204.80:5000/gateway/api/queryTrans.do&#39;; ##批量交易请求地址 const SDK_BATCH_TRANS_URL = &#39;https://101.231.204.80:5000/gateway/api/batchTrans.do&#39;; ##文件传输类交易地址 const SDK_FILE_QUERY_URL = &#39;https://101.231.204.80:9080/&#39;; ##APP交易地址 constSDK_App_Request_Url = &#39;https://101.231.204.80:5000/gateway/api/appTransReq.do&#39;; ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 const SDK_SIGN_CERT_PATH = &#39;D:/certs/PM_700000000000001_acp.pfx&#39;; ##签名证书密码 const SDK_SIGN_CERT_PWD = &#39;000000&#39;; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/verify_sign_acp.cer&#39;; ##前台通知地址 (商户自行配置通知地址) const SDK_FRONT_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; // 后台通知地址 (商户自行配置通知地址) const SDK_BACK_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; //文件下载目录 const SDK_FILE_DOWN_PATH = &#39;d:/file/&#39;; //日志 目录 const SDK_LOG_FILE_PATH = &#39;D:/logs/&#39;; //日志级别 const SDK_LOG_LEVEL = &#39;INFO&#39;; &nbsp; ##########################加密证书配置################################ ##密码加密证书路径 const SDK_ENCRYPT_CERT_PATH = &#39;D:/certs/encrypt.cer&#39;; &nbsp; 2. SDKConfig.php ，生产测试环境配置文件：具体配置项和说明如下； &nbsp; 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 const SDK_FRONT_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/frontTransReq.do&#39;; ##后台交易请求地址 const SDK_BACK_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/backTransReq.do&#39;; ##后台交易请求地址(若为有卡交易配置该地址) constSDK_Card_Request_Url = &#39;https://gateway.95516.com/gateway/api/cardTransReq.do&#39;; ##单笔查询请求地址 const SDK_SINGLE_QUERY_URL = &#39;https://gateway.95516.com/gateway/api/queryTrans.do&#39;; ##批量交易请求地址 const SDK_BATCH_TRANS_URL = &#39;https://gateway.95516.com/gateway/api/batchTrans.do&#39;; ##文件传输类交易地址 const SDK_FILE_QUERY_URL = &#39;https://filedownload.95516.com/&#39;; ##APP交易地址 constSDK_App_Request_Url = &#39;https://gateway.95516.com/gateway/api/appTransReq.do&#39;; &nbsp; ##前台通知地址 (商户自行配置通知地址) const SDK_FRONT_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; ##后台通知地址 (商户自行配置通知地址) const SDK_BACK_NOTIFY_URL = &#39;http://127.0.0.1/upacp_sdk_php/demo/response.php&#39;; ##文件下载目录 const SDK_FILE_DOWN_PATH = &#39;d:/file/&#39;; ##日志 目录 const SDK_LOG_FILE_PATH = &#39;D:/logs/&#39;; ##日志级别 const SDK_LOG_LEVEL = &#39;INFO&#39;; ########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） const SDK_SIGN_CERT_PATH = &#39;D:/certs/PRO_700000000000001_acp.pfx&#39;; ##签名证书密码 const SDK_SIGN_CERT_PWD = &#39;000000&#39;; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/UPOP_VERIFY.cer&#39;; ##验签证书路径 const SDK_VERIFY_CERT_PATH = &#39;D:/certs/&#39;; ##########################加密证书配置################################ ##密码加密证书路径 const SDK_ENCRYPT_CERT_PATH = &#39;D:/certs/RSA2048_PROD_index_22.cer&#39;; &nbsp; 11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明 主要类与方法说明 upacp_sdk_php.gbk.common.php:负责将请求报文排序后转化为字符串、将字符串转为数组 解压、压缩、构建自动提交表单等 function coverParamsToString($params) 功能: 将请求报文排序后转化为字符串 输入: 请求数组 输出: 排序后的 key1=val1&amp;key2=val2&amp;.... function coverStringToArray($str) 功能: 将字符串转为数组 输入: key1=val1&amp;key2=val2&amp;.... 输出: 数组元素 array(key1=&gt;val1,key2=&gt;val2...) &nbsp; function deal_params(&amp;$params) 功能: 处理返回报文 解码客户信息 输入: 客户信息 输出: 将客户信息组装成customerInfo项 &nbsp; function deflate_file(&amp;$params) 功能: 压缩文件 输入: 带有文件上传的请求报文 输出: 将上传文件压缩后组装进报文 &nbsp; function deal_file($params) 功能: 解压缩文件 输入: 带有文件下载的返回报文 输出: 处理文件内容并保存到指定目录下 &nbsp; function create_html($params, $action) 功能: 构造自动提交的表单 输入: 请求数组($params) ,请求的远程url 输出: 自动提交的form表单字符串 &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.httpClient.php:后台交易 客户端通信等 &nbsp; httpClient.php function sendHttpRequest($params, $url) 功能: 后台交易 HttpClient通信 输入: 请数据,及远程通信url 输出: 后台交易响应信息 &nbsp; function getRequestParamString($params) 功能: 请求数据 urlencode处理后转为key=val&amp;...串 输入: 请求数组 输出: urlencode处理后的key=val&amp;...串 &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.secureUtil.php:负责签名，验签，加载证书，取公钥/私钥，加密卡号/cvn2/有效期等方法类 secureUtil.php function sign(&amp;$params) 功能: 请求数据签名 输入: 请求数组 输出: 带签名的请求数组 &nbsp; function verify($params) 功能: 验签 输入: 返回报文 输出: 成功/失败 &nbsp; function getPulbicKeyByCertId($certId) 功能: 根据证书ID 加载 证书 输入: 证书ID 输出: 证书公钥信息 &nbsp; function getCertId($cert_path) 功能: 取私钥证书ID 输入: 私钥证书路径 输出: 证书ID &nbsp; function getCertIdByCerPath($cert_path) 功能: 取公钥证书ID 输入: 公钥证书路径 输出: 证书ID &nbsp; &nbsp; function getSignCertId() 功能: 取签名证书ID 输入: 签名证书路径 输出: 证书ID &nbsp; function getPublicKey($cert_path) 功能: 获取证书公钥 输入: 证书路径 输出: 公钥 &nbsp; function getPrivateKey($cert_path) 功能: 获取证书私钥 输入: 证书路径 输出: 私钥 &nbsp; function encryptPan($pan) 功能: 加密 卡号 输入: 卡号 输出: 加密后卡号 &nbsp; function encryptPin($pan, $pwd) 功能: pin 加密 输入: 卡号,密码 输出: 加密后密码 &nbsp; function encryptCvn2($cvn2) 功能: cvn2 加密 输入: cvn2 输出: 加密后cvn2 &nbsp; function encryptDate($certDate) 功能: 有效期 加密 输入: 有效期 输出: 加密后有效期 &nbsp; &nbsp; 主要类与方法说明 upacp_sdk_php.gbk.PublicEncrypte.php:密码加密 upacp_sdk_php.gbk.PinBlock.php:密码转pin upacp_sdk_php.gbk.log.class.php:日志类 11.3&nbsp;&nbsp;&nbsp;&nbsp; ASP.NET 插件.net Framework4.0环境以上编写，ICSharpCode.SharpZipLib手动添加，引用工程名称为upacp_sdk_php，供系统集成。 11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明 1.&nbsp; Web.config:入网测试环境参数配置文件 具体配置： ######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置##### ##########################交易发送地址配############################# ######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)####### ##前台交易请求地址 &lt;add key=&quot;sdk.frontTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/frontTransReq.do&quot; /&gt; ##后台交易请求地址 &lt;add key=&quot;sdk.backTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/backTransReq.do&quot; /&gt; ##后台交易请求地址(若为有卡交易配置该地址) &lt;add key=&quot;sdk.cardRequestUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/cardTransReq.do&quot; /&gt; ##批量交易请求地址 &lt;add key=&quot;sdk.batTransUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/batchTrans.do&quot; /&gt; ##查询地址 &lt;add key=&quot;sdk.singleQueryUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/queryTrans.do&quot; /&gt; ##文件传输类交易地址 &lt;add key=&quot;sdk.fileTransUrl&quot; value=&quot;https://101.231.204.80:9080/&quot; /&gt; ##APP交易地址 &lt;add key=&quot;sdk.appRequestUrl&quot; value=&quot;https://101.231.204.80:5000/gateway/api/appTransReq.do&quot; /&gt; ########################签名证书配置################################ ######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)####### ##签名证书路径 &lt;add key=&quot;sdk.signCert.path&quot; value=&quot;d:\\certs\\PM_700000000000001_acp.pfx&quot; /&gt; ##签名证书密码 &lt;add key=&quot;sdk.signCert.pwd&quot; value=&quot;000000&quot; /&gt; ##签名证书类型 &lt;add key=&quot;sdk.signCert.type&quot; value=&quot;PKCS12&quot; /&gt; ##验签 &lt;add key=&quot;sdk.validateCert.dir&quot; value=&quot;d:\\certs\\&quot; /&gt; ##########################加密证书配置################################ ##密码加密证书路径 &lt;add key=&quot;sdk.encryptCert.path&quot; value=&quot;d:\\certs\\encrypt.cer&quot; /&gt; &nbsp; 2. &nbsp;Web.config: 生产环境参数配置文件 具体配置： ##########################交易发送地址配############################# ######(以下配置为生产环境用)####### ##前台交易请求地址 &lt;add key=&quot;sdk.frontTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/frontTransReq.do&quot; /&gt; ##后台交易请求地址 &lt;add key=&quot;sdk.backTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/backTransReq.do&quot; /&gt; ##后台交易请求地址(若为有卡交易配置该地址) &lt;add key=&quot;sdk.cardRequestUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/cardTransReq.do&quot; /&gt; ##单笔查询请求地址 &lt;add key=&quot;sdk.singleQueryUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/queryTrans.do&quot; /&gt; ##批量交易请求地址 &lt;add key=&quot;sdk.batTransUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/batchTrans.do&quot; /&gt; ##文件传输类交易地址 &lt;add key=&quot;sdk.fileTransUrl&quot; value=&quot;https://filedownload.95516.com/&quot; /&gt; ##APP交易地址 &lt;add key=&quot;sdk.appRequestUrl&quot; value=&quot;https://gateway.95516.com/gateway/api/appTransReq.do&quot; /&gt; ########################签名证书配置################################ ##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码） &lt;add key=&quot;sdk.signCert.path&quot; value=&quot;d:\\certs\\PRO_700000000000001_acp.pfx&quot; /&gt; ##签名证书密码 &lt;add key=&quot;sdk.signCert.pwd&quot; value=&quot;000000&quot; /&gt; ##签名证书类型 acpsdk.signCert.type=PKCS12 ##验签 &lt;add key=&quot;sdk.validateCert.dir&quot; value=&quot;d:\\certs\\&quot; /&gt; ##########################加密证书配置################################ ##密码加密证书路径 &lt;add key=&quot;sdk.encryptCert.path&quot; value=&quot;d:\\certs\\RSA2048_PROD_index_22.cer&quot; /&gt; &nbsp; 11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明 主要类与方法说明 com.unionpay.acp.sdk.SDKConfig.cs:负责读取web.config //功能：读取配置文件获取签名证书路径 private static string signCertPath = config.AppSettings.Settings[&quot;sdk.signCert.path&quot;].Value; //功能：读取配置文件获取签名证书密码 private static string signCertPwd = config.AppSettings.Settings[&quot;sdk.signCert.pwd&quot;].Value; //功能：读取配置文件获取验签目录 private static string validateCertDir = config.AppSettings.Settings[&quot;sdk.validateCert.dir&quot;].Value; //功能：加密公钥证书路径 private static string encryptCert = config.AppSettings.Settings[&quot;sdk.encryptCert.path&quot;].Value; //功能：有卡交易路径;&nbsp; private static string cardRequestUrl = config.AppSettings.Settings[&quot;sdk.cardRequestUrl&quot;].Value; //功能：app交易路径;&nbsp; private static string appRequestUrl = config.AppSettings.Settings[&quot;sdk.appRequestUrl&quot;].Value; //功能：读取配置文件获取交易查询地址&nbsp; private static string singleQueryUrl = config.AppSettings.Settings[&quot;sdk.singleQueryUrl&quot;].Value; //功能：读取配置文件获取文件传输类交易地址 private static string fileTransUrl = config.AppSettings.Settings[&quot;sdk.fileTransUrl&quot;].Value;&nbsp; 功能：读取配置文件获取前台交易地址 private static string frontTransUrl = config.AppSettings.Settings[&quot;sdk.frontTransUrl&quot;].Value; 功能：读取配置文件获取后台交易地址 private static string backTransUrl = config.AppSettings.Settings[&quot;sdk.backTransUrl&quot;].Value; //功能：读取配批量交易地址 private static string batTransUrl = config.AppSettings.Settings[&quot;sdk.batTransUrl&quot;].Value; &nbsp; &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SDKUtil.cs：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。 获取签名。 public static bool Sign(Dictionary&lt;string, string&gt; data, Encoding encoder) 验证签名 public static bool Validate(Dictionary&lt;string, string&gt; data, Encoding encoder) 组装报文 public static string CreateAutoSubmitForm(string url, Dictionary&lt;string, string&gt; data, Encoding encoder) 将Dictionary内容排序后输出为键值对字符串,供打印报文使用 &nbsp;public static string PrintDictionaryToString(Dictionary&lt;string, string&gt; data) 将形如key=value&amp;key=value的字符串转换为相应的Dictionary对象 public static Dictionary&lt;string, string&gt; CoverstringToDictionary(string data) pinblock 16进制计算 public static string printHexString(byte[] b) 密码加密，输入参数依次为卡号、密码、字符集 Publicstatic string encryptPin(string card, string pwd, string encoding) 数据加密，输入参数依次为数据、字符集 Publicstatic string encryptData(string data，string encoding) &nbsp; &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.CertUtil.cs： 证书操作工具类，主要是导入pfx证书与获取获取私钥操作。 获取签名证书私钥 public static RSACryptoServiceProvider GetSignProviderFromPfx() 获取签名证书的证书序列号 &nbsp;public static string GetSignCertId() 通过证书id，获取验证签名的证书 public static RSACryptoServiceProvider GetValidateProviderFromPath(string certId) &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.SecureUtil.cs主要负责报文的软签名、验证签名、加密； 压缩、解压、Base64编码/解码,pinblock计算等提供SHA-1及RSA的方法类。 摘要计算 &nbsp;public static byte[] Sha1X16(string dataStr, Encoding encoding) 软签名 &nbsp;public static byte[] SignBySoft(RSACryptoServiceProvider provider, byte[] data) 验证签名 &nbsp;public static bool ValidateBySoft(RSACryptoServiceProvider provider, byte[] base64DecodingSignStr, byte[] srcByte) Base64编码 public static string EncodeBase64(Encoding encode, string source) Base64解码 &nbsp;public static string DecodeBase64(Encoding encode, string result) Inflater解压缩 public static byte[] inflater(byte[] inputByte) deflater压缩 &nbsp;public static byte[] deflater(byte[] inputByte) 密码计算 private static byte[] pin2PinBlock(string aPin) 获取卡号密码pinblock计算 public static byte[] pin2PinBlockWithCardNO(string aPin, string aCardNO) &nbsp;卡号计算 private static byte[] formatPan(string aPan) 加密 public static byte[] encryptedData(byte[] encData) &nbsp; 主要类与方法说明 com.unionpay.acp.sdk.HttpClient.cs 是通信类，具体请参考代码的说明。 提供和服务器通信的HTTP客户端类。 将请求参数以HTTP表单的方式进行一次HTTP POST通信。 Publicint Send(Dictionary&lt;string, string&gt;sParaTemp, Encoding encoding) &nbsp; 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答 Q：如何获取测试商户号与测试证书？ A：测试环境申请测试用户后点击“我的测试&gt;测试参数”中查看商户号，并点击下载测试证书，注册地址：https://open.unionpay.com/ajweb/register，生产环境请联系业务部门，具体联系方式如下： 发送邮件至： operation@unionpay.com进行业务申请和咨询，银联有专门的人员进行处理。 其他专项服务：请见《业务运营服务指引（商户） 》日常业务运营服务。 Q：如何签名？ A：对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。 Q：报文域中frontUrl和backUrl要填什么？ A:frontUrl和backUrl为报文上送要素，银联系统将前台通知报文返回到报文中的frontUrl地址，将后台通知报文返回到报文中的backUrl地址。 Q：如何获取与配置银联入网测试环境地址？ A : 可参见11章节测试环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。具体接入地址如下： 银联入网测试环境地址： 前台交易请求地址 https://101.231.204.80:5000/gateway/api/frontTransReq.do 后台交易请求地址（无卡） https://101.231.204.80:5000/gateway/api/backTransReq.do 后台交易请求地址（有卡） https://101.231.204.80:5000/gateway/api/cardTransReq.do 单笔查询请求地址 https://101.231.204.80:5000/gateway/api/queryTrans.do 批量交易请求地址 https://101.231.204.80:5000/gateway/api/batchTrans.do 文件传输类交易地址 https://101.231.204.80:9080/ APP交易请求地址 https://101.231.204.80:5000/gateway/api/appTransReq.do &nbsp; Q：银联全渠道系统商户接入生产环境地址？ A : 可参见11章节生产环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。将配置文件中测试地址修改为如下地址： 银联入网测试环境地址： 前台交易请求地址 https://gateway.95516.com/gateway/api/frontTransReq.do 后台交易请求地址（无卡） https://gateway.95516.com/gateway/api/backTransReq.do 后台交易请求地址（有卡） https://gateway.95516.com/gateway/api/cardTransReq.do 单笔查询请求地址 https://gateway.95516.com/gateway/api/queryTrans.do 批量交易请求地址 https://gateway.95516.com/gateway/api/batchTrans.do 文件传输类交易地址 https://filedownload.95516.com/ APP交易请求地址 https://gateway.95516.com /gateway/api/appTransReq.do &nbsp; Q：商户接收到银联的前台通知和后台通知，以哪个为准？ A：交易状态请以后台通知结果为准。银联系统会将后台通知结果以post的方式发送到报文中backUrl后台通知地址上，如商户未收到通知，系统会持续发送，如发送成功则不再发送，5次通知失败则不再发送，失败交易则不发送。 后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。具体参见第6章节。 Q：上午做的交易，下午做撤销会报非当日交易不能撤销？ A：测试环境的日切时间在下午1点半，早上的交易会归为前一日，下午的交易才是当日交易。 Q：如果调用数次查询接口后，一直得到处理中状态，该怎么办？ A：对于网银支付模式与非网银支付模式描述如下： 网银支付模式：跳转到银行后，订单状态为正在处理中。查询的结果为正在处理中。等银行有响应的时候，银联全渠道系统会根据银行的应答，修改订单状态为成功或失败。如用户在网银页面直接关闭浏览器，查询的结果则一直为处理中。若超过1小时，查询结果状态仍为处理中，一般可认为是用户关闭了浏览器，可当作失败处理。若产生单边账，可以第二天通过对账退还金额给用户。 非网银支付模式：银联全渠道系统会控制超时时间，一般用户支付2分钟后会有明确的状态，查询的结果不是成功就是失败，失败的交易允许用户重新支付，即如用户1点支付的时候失败，1点05分再次支付成功，则商户如果1点03分查询的时候结果为交易失败，1点06分查询的时候结果为成功。 Q：消费撤销和退货有何不同？ A：当天的交易可以执行消费撤销，消费撤销只能全额。 &nbsp;当天或隔天的交易都可以做退货，退货可以进行多次退货，每次金额小于原始金额，订单退款总金额不能大于此订单原始金额。 Q：标准网关支付跳转银联页面HTTP400报错是什么原因？ A：银联全渠道系统对报文校验较为严格，对未定义的报文域会提示http400报错，请核对产品接口规范文档（https://open.unionpay.com/ajweb/help?id=74&amp;level=0&amp;from=1）中的报文域。 Q：什么是全渠道支付平台？ A：全渠道支付平台是中国银联全渠道接入支付平台的简称，支持移动、互联网等渠道的收单业务，包含互联网支付产品（银联在线支付、预授权支付、B2B对公支付、跨境支付、无跳转支付）、移动终端渠道产品（手机安全支付控件、WAP页面支付、平板电脑（iPad）网关支付、预授权支付、跨境支付、无跳转支付（手机端暂无））、后台模式产品（ 订购、 代收、代付）。 Q：银联全渠道入网测试的账号（卡号）是什么？ A：接入银联全渠道入网测试环境需要使用银联提供的测试卡进行交易，当前仅提供两张可供测试的卡片，一张B2B企业网银的虚拟卡片，具体账号信息如下： 测试卡号 平安银行借记卡：6216261000000000018 证件号：341126197709218366 手机号：13552535506 密码：123456 姓名：全渠道 平安银行贷记卡：6221558812340000 姓名：互联网 证件号：341126197709218366 手机号：13552535506 cvn2:123 有效期：1711 B2B企业网银农行虚拟卡 卡号：123456789001 密码：789001 Q：银联全渠道相关接口文档在哪里获取？ A：由银联提供的全渠道相关文档可在商户服务网站下载（https://merchant.unionpay.com/portal/pages/login/download.jsp?locale=zh_CN），也可以在自助化测试平台首页 &gt; 帮助中心 &gt;下载（https://open.unionpay.com/ajweb/help/file）中获取。 阅读更多","@type":"BlogPosting","url":"https://mlh.app/2015/10/09/6e385ba7f173403a00abdb736127f093.html","headline":"中国银联全渠道系统商户接入 测试指引-银联网关支付产品","dateModified":"2015-10-09T00:00:00+08:00","datePublished":"2015-10-09T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2015/10/09/6e385ba7f173403a00abdb736127f093.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>中国银联全渠道系统商户接入 测试指引-银联网关支付产品</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <div>
   <span style="font-family:'KaiTi_GB2312';font-size:18px;">直接把银联的联调测试文档贴来了</span>
  </div> 
  <div>
   <br>
  </div> 
  <div>
   <br>
  </div> 
  <div>
   <br>
  </div> 
  <div>
   <br>
   <table cellpadding="0" cellspacing="0">
    <tbody>
     <tr>
      <td> 
       <div> 
        <p>中国银联股份有限公司规范性文档</p> 
       </div> </td> 
     </tr>
    </tbody>
   </table>
   <table cellpadding="0" cellspacing="0">
    <tbody>
     <tr>
      <td> 
       <div> 
        <p>中国银联股份有限公司 发布</p> 
       </div> </td> 
     </tr>
    </tbody>
   </table>
   <table cellpadding="0" cellspacing="0">
    <tbody>
     <tr>
      <td> <p>&nbsp;</p> <p>中国银联全渠道系统商户接入</p> <p>测试指引-银联网关支付产品</p> </td> 
     </tr>
    </tbody>
   </table>
  </div> 
  <br clear="all">
  <p>版本修订信息</p> 
  <div align="center"> 
   <table border="1" cellspacing="0" cellpadding="0">
    <thead>
     <tr>
      <td> <p>版本号</p> </td> 
      <td> <p>完成日期</p> </td> 
      <td> <p>发布日期</p> </td> 
      <td> <p>变更说明</p> </td> 
     </tr>
    </thead>
    <tbody>
     <tr>
      <td> <p>1.0.0</p> </td> 
      <td> <p>2014-7-03</p> </td> 
      <td> <p>2014-7-03</p> </td> 
      <td> <p>初稿</p> </td> 
     </tr>
     <tr>
      <td> <p>1.0.1</p> </td> 
      <td> <p>2014-11-04</p> </td> 
      <td> <p>2014-11-05</p> </td> 
      <td> <p>修改文档格式，新增测试地址与测试卡号等信息</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
     <tr>
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
      <td> <p>&nbsp;</p> </td> 
     </tr>
    </tbody>
   </table>
  </div> 
  <p><br></p> 
  <p>目录</p> 
  <p><a>1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>文档说明<span>... </span><span>6</span></a></p> 
  <p><a>1.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>导读<span>... </span><span>6</span></a></p> 
  <p><a>1.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>阅读对象<span>... </span><span>6</span></a></p> 
  <p><a>1.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>业务术语<span>... </span><span>7</span></a></p> 
  <p><a>1.4<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>技术服务<span>... </span><span>7</span></a></p> 
  <p><a>1.4.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>测试模式划分<span>... </span><span>7</span></a></p> 
  <p><a>1.4.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>支持获取途径<span>... </span><span>8</span></a></p> 
  <p><a>2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>联调步骤向导<span>... </span><span>9</span></a></p> 
  <p><a>2.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>交易开发<span>... </span><span>9</span></a></p> 
  <p><a>2.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>测试联调<span>... </span><span>9</span></a></p> 
  <p><a>2.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>切换上线<span>... </span><span>9</span></a></p> 
  <p><a>3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>测试参数与产品相关交易<span>... </span><span>9</span></a></p> 
  <p><a>3.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>测试与生产地址<span>... </span><span>9</span></a></p> 
  <p><a>3.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>测试卡号<span>... </span><span>9</span></a></p> 
  <p><a>3.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>产品相关交易<span>... </span><span>10</span></a></p> 
  <p><a>3.4<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>产品介绍<span>... </span><span>11</span></a></p> 
  <p><a>4<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>交易模式说明<span>... </span><span>11</span></a></p> 
  <p><a>4.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>通讯方式<span>... </span><span>12</span></a></p> 
  <p><a>4.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>前台交易流程<span>... </span><span>12</span></a></p> 
  <p><a>4.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>后台资金类交易流程<span>... </span><span>13</span></a></p> 
  <p><a>4.4<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>后台非资金类交易流程<span>... </span><span>15</span></a></p> 
  <p><a>4.5<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>查询交易流程<span>... </span><span>15</span></a></p> 
  <p><a>5<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>开发步骤向导<span>... </span><span>16</span></a></p> 
  <p><a>5.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>前台交易开发步骤<span>... </span><span>16</span></a></p> 
  <p><a>5.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>后台类异步交易接口开发步骤<span>... </span><span>17</span></a></p> 
  <p><a>5.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>后台类同步交易接口开发步骤<span>... </span><span>17</span></a></p> 
  <p><a>5.4<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>单笔查询交易接口开发步骤<span>... </span><span>18</span></a></p> 
  <p><a>5.5<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>文件传输类交流开发步骤<span>... </span><span>18</span></a></p> 
  <p><a>6<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>前台应答与后台通知说明<span>... </span><span>19</span></a></p> 
  <p><a>7<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>查询接口说明<span>... </span><span>21</span></a></p> 
  <p><a>7.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>前台交易<span>... </span><span>21</span></a></p> 
  <p><a>7.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>后台资金交易<span>... </span><span>21</span></a></p> 
  <p><a>7.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>后台非资金交易<span>... </span><span>21</span></a></p> 
  <p><a>7.4<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>查询交易<span>... </span><span>21</span></a></p> 
  <p><a>8<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>签名机制<span>... </span><span>22</span></a></p> 
  <p><a>9<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>加密机制<span>... </span><span>22</span></a></p> 
  <p><a>10<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>证书相关说明<span>... </span><span>23</span></a></p> 
  <p><a>10.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>概述<span>... </span><span>23</span></a></p> 
  <p><a>10.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>证书下载及导出流程(ok)<span>23</span></a></p> 
  <p><a>10.2.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>证书下载流程<span>... </span><span>23</span></a></p> 
  <p><a>10.2.2证书导出流程<span>...</span><span>27</span></a></p> 
  <p><a>11<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>开发包插件使用<span>... </span><span>32</span></a></p> 
  <p><a>11.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>JSP/JAVA<span>.. </span><span>32</span></a></p> 
  <p><a>11.1.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>配置文件说明<span>... </span><span>32</span></a></p> 
  <p><a>11.1.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>主要类和方法说明<span>... </span><span>35</span></a></p> 
  <p><a>11.1.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>配置文件加载说明<span>... </span><span>38</span></a></p> 
  <p><a>11.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>PHP<span>. </span><span>38</span></a></p> 
  <p><a>11.2.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>配置文件说明<span>... </span><span>38</span></a></p> 
  <p><a>11.2.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>主要类与方法说明<span>... </span><span>43</span></a></p> 
  <p><a>11.3<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ASP.NET<span>. </span><span>48</span></a></p> 
  <p><a>11.3.1<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>配置文件说明<span>... </span><span>49</span></a></p> 
  <p><a>11.3.2<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>主要类和方法说明<span>... </span><span>52</span></a></p> 
  <p><a>12<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>常见问题问答<span>... </span><span>57</span></a></p> 
  <p>&nbsp;</p> 
  <p><span>&nbsp;</span></p> 
  <p>&nbsp;</p> 
  <p><br></p> 
  <h1><a name="_Toc407708768"></a><a name="_Toc402875105"></a><a name="_Toc394058060"></a><a name="_Ref394049147"></a><a name="_Ref394048870">1&nbsp;&nbsp;&nbsp;&nbsp; 文档说明</a></h1> 
  <h2><a name="_Toc407708769">1.1&nbsp;&nbsp; 导读</a></h2> 
  <p align="left">网关产品主要适用于持卡人在商户网站B2C购物支付场景，持卡通过点击银联在线支付logo，并在银联在线支付网关完成支付信息录入，最终完成支付。</p> 
  <p align="left">从PC端发起的交易为WEB网关支付交易，从移动端发起的交易为WAP网关支付交易以及APP网关交易。</p> 
  <p align="left"><span style="color:#943634;">首次接入测试先了解前台交易与后台交易的区别，可参考</span><a><span style="color:#943634;">第1.3</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">业务术语描述，随后可从</span><a><span style="color:#943634;">第5</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">开发步骤向导开始阅读，了解开发过程中的具体操作步骤，此章节中提到的签名机制请参照</span><a><span style="color:#943634;">第8</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">。开发过程中需要用到的测试与生产交易地址请参考</span><a><span style="color:#943634;">第11</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">配置文件。交易测试卡号请参考</span><a><span style="color:#943634;">第3.2</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">。如开发与测试过程中遇到了解决不了的问题可在</span><a><span style="color:#943634;">第12</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">FAQ</span><span style="color:#943634;">中查找解决方案，也可通过</span><a><span style="color:#943634;">第1.4.2</span><span style="color:#943634;">章节</span></a><span style="color:#943634;">中的方法来获取测试支持。</span></p> 
  <h2><a name="_Toc407708770"></a><a name="_Toc402875107"></a><a name="_Toc394058062">1.2&nbsp;&nbsp; 阅读对象</a></h2> 
  <p align="left">《中国银联全渠道系统商户接入测试指引》文档是面向具有一定的网站开发能力的网站开发、维护和管理人员。</p> 
  <p align="left">具体交易的接口、报文规范、响应码说明，请阅读开发包中接口文档。</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">参与方描述</span></strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">&nbsp;</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p><strong>商户</strong></p> </td> 
     <td valign="top"> <p>指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》等协议开展银联无卡支付以及行业类应用业务的商户。</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p><strong>收单机构</strong></p> </td> 
     <td valign="top"> <p>指加入银联网络，与银联签订《银联卡无卡支付业务合作协议》开展银联无卡支付收单业务的境内成员机构。</p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <h2><a name="_Toc407708771"></a><a name="_Toc402886726"></a><a name="_业务术语"></a>1.3&nbsp;&nbsp; 业务术语</h2> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">术语</span></strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">解释</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p><strong>请求</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>通过 HTTP/HTTPS协议把需要传输的数据发送给接收方的过程。</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p><strong>应答</strong></p> </td> 
     <td valign="top"> <p>通过 HTTP/HTTPS协议把需要传输的数据返回给接收方的过程。</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p><strong>后台通知</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left">服务器后台通知。中国银联全渠道系统根据得到的数据处理完成后，全渠道系统主动发起通知给商户的网站，同时携带处理完成的结果信息反馈给商户网站。</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p><strong>前台类交易</strong></p> </td> 
     <td valign="top"> <p>主要指用户需要参与交互的支付类交易，包括消费、预授权/担保消费交易。</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p><strong>后台类交易</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>主要指用户不需要参与交互，由商户后续发起的交易，包括消费撤销、退货、预授权撤销、预授权完成、预授权完成撤销等交易。</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p><strong>全渠道系统/ACP</strong></p> </td> 
     <td valign="top"> <p>中国银联全渠道系统，是整合了银联在线和银联移动支付功能的新交易处理系统。</p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <h2><a name="_Toc407708772"></a><a name="_Toc402875109"></a><a name="_Toc394058064">1.4&nbsp;&nbsp; 技术服务</a></h2> 
  <h3><a name="_Toc407708773">1.4.1 测试模式划分</a></h3> 
  <p>接入网关支付产品的商户为选测。</p> 
  <p><strong><span style="color:#FF0000;">注：</span></strong></p> 
  <p>必测是指提交了入网申请表、必须测试通过才能投产上线的，选测是指不需要入网申请表可以直接投产上线的，是否在测试环境测试由商户自己决定。</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong><span style="color:#FFFFFF;">必测</span></strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong><span style="color:#FFFFFF;">选测</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p>收单机构接入</p> </td> 
     <td rowspan="2" valign="top"> <p>商户接入（接入产品为除无跳转支付、后台直接支付、代收和便民缴费<strong><span style="color:#FF0000;">以外</span></strong>的其他产品）</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p>商户接入（接入产品为无跳转支付、后台直接支付、代收和便民缴费）</p> </td> 
    </tr>
   </tbody>
  </table>
  <h3><a name="_Toc407708774"></a><a name="_支持获取途径"></a>1.4.2 支持获取途径</h3> 
  <p>业务问题详见开发包中《中国银联全渠道系统业务运营服务指引》相关人员联系方式。</p> 
  <p>测试问题支持人员联系方式详见下表：</p> 
  <p>&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong><span style="color:#FFFFFF;">必测</span></strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong><span style="color:#FFFFFF;">选测</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p>收单机构可联系银联服务专员，并且在提交了入网申请后银联服务专员会主动联系商定窗口并提供测试支持服务</p> </td> 
     <td rowspan="2" valign="top"> <p><a href="mailto:%E5%95%86%E6%88%B7%E5%8F%AF%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E5%88%B0acpservice@unionpay.com" rel="nofollow"><span>商户可发送邮件到acpservice@unionpay.com</span></a>邮箱（邮件标题为：商户号+商户名称+联系QQ），提供商户号和联系QQ，银联测试服务专员会将商户接口人的联系QQ加入到银联统一服务QQ中提供支持服务（商户也可以通过服务电话021-38929999-2049来提供自己的商户号和联系QQ）</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p>银联市场服务代表在为商户提交了入网申请后，会有银联服务专员主动联系（一般为QQ）商定联调窗口并提供测试支持服务</p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong><span style="color:#FF0000;">注：</span></strong></p> 
  <p>服务邮箱和服务电话仅供选测类商户联系测试支持人员，并且邮箱和电话不直接反馈支持问题，支持服务均在银联统一服务QQ中提供。</p> 
  <h1><a name="_Toc407708775"></a><a name="_联调步骤向导"></a>2&nbsp;&nbsp;&nbsp;&nbsp; 联调步骤向导</h1> 
  <h2><a name="_Toc407708776">2.1&nbsp;&nbsp; 交易开发</a></h2> 
  <p>商户或收单机构全渠道系统开发包和本测试指引进行接入开发。</p> 
  <h2><a name="_Toc407708777">2.2&nbsp;&nbsp; 测试联调</a></h2> 
  <p>本步骤可选。开发完成后可通过银联提供的联调测试环境进行联机接口验证测试，测试地址参考测<a>第11章节</a>配置文件说明。</p> 
  <h2><a name="_Toc407708778">2.3&nbsp;&nbsp; 切换上线</a></h2> 
  <p>在测试环境完成联调测试后，由银联业务运营人员(联系方式参见《中国银联全渠道系统业务运营服务指引》)引导协助商户完成生产交易证书的申请，商户将接口更新部署到生产环境和银联生产环境完成对接。</p> 
  <h1><a name="_Toc407708779">3&nbsp;&nbsp;&nbsp;&nbsp; 测试参数与产品相关交易</a></h1> 
  <h2><a name="_Toc407708780">3.1&nbsp; 测试与生产地址</a></h2> 
  <p>测试地址详见<a>第11章节</a>配置文件描述。</p> 
  <h2><a name="_Toc407708781"></a><a name="_测试卡号"></a>3.2&nbsp; 测试卡号</h2> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">测试卡号</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p><strong>平安银行借记卡：6216261000000000018<br> 证件号：341126197709218366<br> 手机号：13552535506<br> 密码：123456</strong></p> <p><strong>姓名：全渠道</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p><strong>平安银行贷记卡：6221558812340000</strong></p> <p><strong>姓名：互联网</strong></p> <p><strong>证件号：341126197709218366<br> 手机号：13552535506<br> cvn2:123</strong></p> <p align="left"><strong>有效期：1711</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <h2><a name="_Toc407708782">3.3&nbsp; 产品相关交易</a></h2> 
  <p>&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong>序号</strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong>接口名称</strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong>功能说明</strong></p> </td> 
     <td valign="top" style="background:#4F81BD;"> <p align="center"><strong>交易模式</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>1</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>消费类交易（前台类）</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>持卡人进支付时，由银联或发卡行展示支付页面，引导持卡人完成后续支付的交易。</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>前台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>2</strong></p> </td> 
     <td valign="top"> <p>消费撤销类交易</p> </td> 
     <td valign="top"> <p>指因人为原因而撤销已完成的消费；消费撤销必须是撤销CUPS当日当批的消费</p> </td> 
     <td valign="top"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>3</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>退货类交易</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>对于已结算的消费交易，通过该交易发起退款交易。</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>4</strong></p> </td> 
     <td valign="top"> <p>交易状态查询类交易</p> </td> 
     <td valign="top"> <p>对未收到应答的或交易状态未知的交易，可通过该交易进行查询。</p> </td> 
     <td valign="top"> <p>查询类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>5</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>文件传输类交易</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>联机下载对账文件等文件下载类交易</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>后台非资金交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>6</strong></p> </td> 
     <td valign="top"> <p>预授权类交易</p> </td> 
     <td valign="top"> <p>预授权交易用于受理方向持卡人的发卡方确认交易许可。受理方将预估的消费金额作为预授权金额，发送给持卡人的发卡方。</p> </td> 
     <td valign="top"> <p>前台或后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>7</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>授权撤销类交易</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>对已成功的预授权交易，在结算前使用该交易进行取消。</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>8</strong></p> </td> 
     <td valign="top"> <p>授权完成类交易</p> </td> 
     <td valign="top"> <p>对已批准的预授权交易，用该交易进行支付结算；</p> </td> 
     <td valign="top"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>9</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>授权完成撤销类交易</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>预授权完成撤销交易必须是对原始预授权完成交易的全额撤销。预授权完成撤销后的预授权仍然有效。</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>10</strong></p> </td> 
     <td valign="top"> <p>余额查询</p> </td> 
     <td valign="top"> <p>&nbsp;</p> </td> 
     <td valign="top"> <p>后台非资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>11</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>电子现金非指定账户圈存</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>&nbsp;</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>12</strong></p> </td> 
     <td valign="top"> <p>电子现金指定账户圈存</p> </td> 
     <td valign="top"> <p>&nbsp;</p> </td> 
     <td valign="top"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>13</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>圈存脚本通知</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>&nbsp;</p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p>后台资金类交易</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>14</strong></p> </td> 
     <td valign="top"> <p>IC卡脱机消费通知</p> </td> 
     <td valign="top"> <p>&nbsp;</p> </td> 
     <td valign="top"> <p>后台资金类交易</p> </td> 
    </tr>
   </tbody>
  </table>
  <h2><a name="_Toc407708783">3.4&nbsp; 产品介绍</a></h2> 
  <p>产品介绍详见《网关支付产品入网材料》包中的《银联全渠道系统网关产品.pptx》。</p> 
  <h1><a name="_Toc407708784"></a><a name="_Toc402875111">4&nbsp;&nbsp;&nbsp;&nbsp; 交易模式说明</a></h1> 
  <p>从技术实现方式上交易大致可划分为前台类交易、后台资金类类交易、后台非资金类交易、查询类交易、批量类交易。本节将描述各种交易的大致流程。</p> 
  <h2><a name="_Toc394058067"></a><a name="_Ref394047459"></a><a name="_Ref394047458"></a><a name="_Ref394047457"></a><a name="_Ref394047456"></a><a name="_Ref394047455"></a><a name="_Ref394047451"></a><a name="_Toc407708785"></a><a name="_Toc402875112"></a><a name="_Toc393199692"></a><a name="_Toc347085107">4.1&nbsp;&nbsp; 通讯方式</a></h2> 
  <p>所有报文域以key/value的表单方式通过HTTP Post到银联全渠道系统支付平台。对于前台类需要持卡人交互的交易，交易通过异步跳转的方式完成，对于涉及资金的前台类交易，银联全渠道系统支付平台可通过商户后台通知地址向商户发送后台通知。对于后台类涉及资金清算类无需持卡人交互的交易，交易结果异步响应给商户，商户通过接受后台通知或者发起交易查询获取交易处理结果。对于后台类非资金类无需持卡人交互的交易，交易结果同步响应给商户。对应交易状态查询类交易，交易结果同步响应给商户。</p> 
  <h2><a name="_Toc407708786"></a><a name="_Toc402875113">4.2&nbsp;&nbsp;前台交易流程</a></h2> 
  <p>前台类交易是指交易请求方（如商户、收单机构）与ACP之间的交易信息通过用户浏览器进行传递的交易，是一种异步的、需要持卡人参与完成的交易类型。对于涉及金额的前台类交易（即交易请求中有金额字段）ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。</p> 
  <p></p> 
  <p><a name="_Ref394064188">图 1‑</a>1</p> 
  <p>注意点：</p> 
  <p>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考接口文档；</p> 
  <p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第8步前台应答返回的URL为请求报文中的“frontUrl”字段指定的URL；</p> 
  <p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 图1‑1中第7步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL；</p> 
  <h2><a name="_Toc407708787"></a><a name="_Toc402875115"></a><a name="_Toc394058068">4.3&nbsp;&nbsp; 后台资金类交易流程</a></h2> 
  <p>后台类资金类交易是指交易请求方（如商户、收单机构），将交易信息（涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。是一种异步的、不需要持卡人参与完成的交易类型。因涉及资金的清算，ACP系统均会给请求方后台通知(后台通知报文要素同前台应答的要素)，请求方也必须实现接收后台通知。对于交易状态未知的交易请求方必须发起交易状态查询交易。</p> 
  <p></p> 
  <p><a name="_Ref394064192"></a><a name="_Ref394060616"></a><a name="_Toc394047503">图 1‑</a>3</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">注意：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">1.&nbsp;&nbsp;&nbsp;&nbsp; 每个交易需要的报文要素是不一样的，具体每个交易需要的要求，请参考开发包中接口规范文档；</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left">2.&nbsp;&nbsp;&nbsp;&nbsp; 图1-3中第4步中的应答仅代表该笔后台请求交易已经受理，不代表全部处理成功；是否处理成功，需通过接受后台通知或者发起“交易状态查询交易”进行查询；</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">3.&nbsp;&nbsp;&nbsp;&nbsp; 第5步后台应答返回的URL为请求报文中的“backUrl”字段指定的URL。</p> </td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h2><a name="_Toc407708788"></a><a name="_Toc402875116"></a><a name="_Toc394058069">4.4&nbsp;&nbsp; 后台非资金类交易流程</a></h2> 
  <p>后台类非资金类交易是指交易请求方（如商户、收单机构）将交易信息（不涉及资金清算的交易）直接通过请求方服务器发送至ACP服务器的交易方式。后台非资金类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。若通讯超时，则交易请求方可以重复发起交易。</p> 
  <p></p> 
  <p>图1‑4</p> 
  <h2><a name="_Toc407708789"></a><a name="_Toc402875117"></a><a name="_Toc394058070">4.5&nbsp;&nbsp; 查询交易流程</a></h2> 
  <p>查询交易是指交易请求方（如商户、收单机构）将交易查询报文信息直接通过请求方服务器发送至ACP服务器的交易方式。查询类交易均为同步短连接方式，不需要持卡人参与完成的交易类型。，若通讯超时，则交易请求方可以重复发起交易。</p> 
  <p></p> 
  <p><a name="_Ref394060611">图 1‑</a>5</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h1><a name="_Toc407708790"></a><a name="_Toc402875120"></a><a name="_Toc394058072"></a><a name="_开发步骤向导"></a>5&nbsp;&nbsp;&nbsp;&nbsp;开发步骤向导</h1> 
  <h2><a name="_Toc407708791"></a><a name="_Toc402875121"></a><a name="_Toc394058073">5.1&nbsp;&nbsp; 前台交易开发步骤</a></h2> 
  <p>1. 以表单的方式组装要发送给银联全渠道系统的数据对象（包括IC卡交易信息域，VPC交易信息域，风控信息域等各域）。每个域填写方法可参考文档开发包中接口文档。</p> 
  <p>2. 将组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.<em>sign</em>(未签名报文, 报文字符集);”具体签名机制请参照第8章节。可通过调用插件包提供的签名方法来完成签名。</p> 
  <p>3. 把所有要发送给银联全渠道系统的域包括signature和signMethod，组成表单以POST方式送给银联全渠道系统前台交易的地址。</p> 
  <p>4. 交易完成后，银联全渠道系统将把交易结果分别返回通知到商户通的前台应答地址和后台应答地址上，商户接收到交易通知后可分别调用“SDKUtil.<em>convertResultStringToMap</em>(应答报文);”方法进行应答报文解析，和“SDKUtil.<em>validate</em>(应答报文, 报文字符集)”方法进行签名验证。</p> 
  <h2><a name="_Toc407708792"></a><a name="_Toc402875122"></a><a name="_Toc394058074">5.2&nbsp;&nbsp; 后台类异步交易接口开发步骤</a></h2> 
  <p>1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。<em></em></p> 
  <p>2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.<em>sign</em>(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。</p> 
  <p>3. 把所有数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。</p> 
  <p>4. 接收到返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.<em>convertResultStringToMap</em>(应答报文);”方法进行应答报文解析，和“SDKUtil.<em>validate</em>(应答报文, 报文字符集)”方法进行签名验证。</p> 
  <h2><a name="_Toc407708793"></a><a name="_Toc402875123"></a><a name="_Toc394058075">5.3&nbsp;&nbsp; 后台类同步交易接口开发步骤</a></h2> 
  <p>1. 商户按照不同的交易组装报文，交易报文请参考开发包中接口规范。<em></em></p> 
  <p>2. 把组装好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.<em>sign</em>(未签名报文, 报文字符集);”，具体签名机制请参照第8章节。</p> 
  <p>3. 数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过插件包提供的方法进行发送。</p> 
  <p>4. 返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.<em>convertResultStringToMap</em> (应答报文);”方法进行应答报文解析，和“SDKUtil.<em>validate</em> (应答报文, 报文字符集)”方法进行签名验证。</p> 
  <h2><a name="_Toc407708794"></a><a name="_Toc402875124"></a><a name="_Toc394058076"></a><a name="_Ref394049554"></a><a name="_Ref394049548"></a><a name="_单笔查询交易接口开发步骤"></a>5.4&nbsp;&nbsp;单笔查询交易接口开发步骤</h2> 
  <p>1.照单笔查询交易的规范组装报文，交易报文请参考开发包中接口文档</p> 
  <p>2.好的数据排序好并用&amp;连接后签名，生成signature字段，可使用插件包提供的方法“SDKUtil.<em>sign</em>(未签名报文, 报文字符集);”，具体签名机制请参照第7章节。</p> 
  <p>3.数据，包括signature和signMethod用key=value并用&amp;符号链接的方式组装成字符串，通过SDK提供的方法进行发送。</p> 
  <p>4.返回报文后，通过插件包提供的方法进行验证签名，调用“SDKUtil.<em>convertResultStringToMap</em>(应答报文);”方法进行应答报文解析，和“SDKUtil.<em>validate</em>(应答报文, 报文字符集)”方法进行签名验证。</p> 
  <h2><a name="_Toc407708795"></a><a name="_Toc402875126"></a><a name="_Toc394058078"></a><a name="_批量交易开发步骤"></a>5.5&nbsp;&nbsp;文件传输类交流开发步骤</h2> 
  <p align="left">文件的格式，参照接口文档，文件名，文件头，文件，文件以inputfilepost方式提交到服务器，以文件流的方式获取字节流信息，先需要解压缩文件内容的byte[]数组，用SecureUtil.deflater方法，后BASE64编码，用SecureUtil.base64Encode方法，返回，最终以字符串方式提交到处理服务器，服务器响应报文里有filecontent字段，先用SecureUtil.base64Decode解码，后用SecureUtil.inflater方法解压缩，返回byte[],接下来就可以通过文件输出的方法，生成文件。</p> 
  <p>文件转字符串</p> 
  <p></p> 
  <p>图2‑1</p> 
  <h1><a name="_Toc407708796"></a><a name="_Toc402875131"></a><a name="_Toc394058083">6&nbsp;&nbsp;&nbsp;&nbsp; 前台应答与后台通知说明</a></h1> 
  <p>前台交易，商户或机构需要提供两个地址frontUrl和backUrl（通过报文域上送），分别接收银联全渠道系统的前台应答和后台通知。前台应答是通过浏览器，用户点击“返回商户”按钮发送给商户的，后台通知是银联全渠道系统异步把交易状态为成功的交易通知给商户。具体详细关于前台应答和后台通知请参照接口文档。不管收到前台应答还是后台通知，商户都需要验签。</p> 
  <p>在交易结束后，银联全渠道系统通过后台通知将交易结果发给商户或机构。后台通知以标准的HTTP协议的POST方法向商户的后台通知URL发送，并设置一个超时计时器，通常设置为10s。商户在收到通知，解析后应立即返回应答报文。仅当POST返回码为200时，才认为商户已经成功收到并且能正确解析后台通知，其他返回码则被认为通知失败。如果计时器超时，没有收到应答报文，也被认为通知失败。<br> 第一次通知失败后，会通过退避策略进行通知重发，最多发送五次。由于网络等原因，商户会收到重复的后台通知。</p> 
  <p>商户或机构在接收到银联全渠道系统的前台应答或后台通知后，首先必须验证该消息的签名，然后根据订单号等信息，更新相应系统中的订单支付状态。前台通知因存在用户支付完毕后直接关闭浏览器的情况，而不能保证每次都送达。后台通知由银联银联全渠道系统通知服务器主动发起，若发送失败，银联全渠道系统会继续发送，一共发送5次，若还是发送失败，也不继续发送。商户在未收到后台应答，建议请求20分钟后主动发起交易查询交易来查询交易状态。</p> 
  <p>另外，退货等后台类交易（若有开发）是异步过程，银联全渠道系统收到后台类交易请求后会回复一个请求已接受的应答。在交易处理后，银联全渠道系统会发送后台通知给商户，建议商户无论是否收到后台通知，在请求2分钟后主动发起交易查询交易来查询交易状态。</p> 
  <p>注：银联全渠道系统只针对成功交易会发送后台通知，失败交易不发送后台通知。因此，如未收到后台通知，建议商户主动发起交易查询交易，查询交易状态。</p> 
  <p>另外后台通知接收需要注意以下几点：</p> 
  <p>1.后台通知采用POST的方式来发送，POST的地址是商户上送的backUrl域，backUrl域需要保证该地址的正确性。</p> 
  <p>2.后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。</p> 
  <p>3.确定通知成功由以下几个要素</p> 
  <p>a)&nbsp;&nbsp;&nbsp;&nbsp; 通知URL填写正确（商户必须要保证URL的正确性）</p> 
  <p>b)&nbsp;&nbsp;&nbsp;&nbsp; 通信正确（通信失败时必须重发）</p> 
  <p>c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 商户能够正确验签（测试环境要测试通过）</p> 
  <p>因此，只要生产上能够证明通信是正确的，即可认为通知成功。如果商户端因为某种特殊原因，没有正确处理后台通知，可以通过交易查询接口来纠正交易的状态。</p> 
  <h1><a name="_Toc407708797"></a><a name="_Toc402875132"></a><a name="_Toc394058084"></a><a name="_Ref394049429"></a><a name="_Ref394049313"></a><a name="_Ref394049277"></a><a name="_Ref394049267"></a><a name="_Ref394049232"></a><a name="_Ref394049101"></a><a name="_Ref394049086"></a><a name="_Ref394049081"></a><a name="_Ref394049071"></a><a name="_Ref394048901"></a><a name="_Ref394048898"></a><a name="_Ref394048894"></a><a name="_Ref394048886"></a><a name="_Ref394048704"></a><a name="_查询接口说明"></a>7&nbsp;&nbsp;&nbsp;&nbsp;查询接口说明</h1> 
  <h2><a name="_Toc407708798"></a><a name="_Toc402875133"></a><a name="_Toc394058085"></a><a name="_Ref394049107">7.1&nbsp;&nbsp; 前台交易</a></h2> 
  <p><a name="OLE_LINK14"></a><a name="OLE_LINK13">1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果</a>已收到后台通知，则不需要发起查询。</p> 
  <p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。</p> 
  <p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可<a>参考5.4章节</a>。</p> 
  <h2><a name="_Toc407708799"></a><a name="_Toc402875134"></a><a name="_Toc394058086">7.2&nbsp;&nbsp; 后台资金交易</a></h2> 
  <p>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已收到后台通知，则不需要发起查询。</p> 
  <p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在订单发起后半小时未收到后台通知，则需要发起查询。</p> 
  <p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的查询交易开发方法可参见第4.5章节。</p> 
  <h2><a name="_Toc407708800"></a><a name="_Toc402875135"></a><a name="_Toc394058087">7.3&nbsp;&nbsp; 后台非资金交易</a></h2> 
  <p>后台交易采用同步机制，交易结果同步返回。</p> 
  <h2><a name="_Toc407708801"></a><a name="_Toc402875136"></a><a name="_Toc394058088"></a><a name="_Ref394048916">7.4&nbsp;&nbsp; 查询交易</a></h2> 
  <p>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果已接收到明确的交易结果应答，则不需要发起查询。</p> 
  <p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 前台交易，若未接收到全渠道系统的明确交易应答时需发起单笔查询交易，查询明确的交易结果。</p> 
  <p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 后台交易，若出现交易超时的情况则需要发起单笔查询交易，查询明确的交易结果。</p> 
  <h1><a name="_Toc407708802"></a><a name="_Toc402875137"></a><a name="_Toc394058089"></a><a name="_签名机制"></a>8&nbsp;&nbsp;&nbsp;&nbsp;签名机制</h1> 
  <p>对于报文的签名处理机制如下：</p> 
  <p>首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。</p> 
  <p>对于报文的验签处理机制如下：</p> 
  <p>首先，对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用商户入网时银联提供的银联全渠道系统支付通讯RSA公钥证书对摘要和报文中的签名信息做签名验证操作。</p> 
  <h1><a name="_Toc407708803"></a><a name="_Toc402875138"></a><a name="_Toc394058090">9&nbsp;&nbsp;&nbsp;&nbsp; 加密机制</a></h1> 
  <p>对于持卡人密码银联全渠道系统支付平台使用RSA公钥证书对ANSI X9.8带主帐号格式的PIN加密并做Base64编码后传输，以保障密码的安全性。依据商户可选配置，对于CVN2、有效期、卡号使用RSA公钥证书分别做加密并Base64处理。</p> 
  <p>对于敏感信息银行卡验证信息及身份信息部分内容，采用Base64编码后传输，以做数据屏蔽。</p> 
  <p>对于文件内容，使用DEFLATE压缩算法压缩后，Base64编码的方式传输，压缩编码后的内容参与签名摘要运算。</p> 
  <h1><a name="_Toc407708804"></a><a name="_Toc402875139"></a><a name="_Toc394058091">10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书相关说明</a></h1> 
  <h2><a name="_Toc407708805"></a><a name="_Toc402875140"></a><a name="_Toc394058092">10.1&nbsp;&nbsp;&nbsp;&nbsp; 概述</a></h2> 
  <p>1. 商户签名证书：商户接入银联支付后会收到两码，通过在CFCA网站下载pfx证书。此证书用于请求报文的签名。测试证书随开发包提供。</p> 
  <p>2. 商户的密码加密证书：商户会收到一个密码加密的公钥证书，此证书用于对银行卡密码的加密、cvn2、有效期及卡号等的加密。测试证书随开发包提供。</p> 
  <p>3. 商户的交易报文验证签名证书：验证银联支付返回的报文是否合法。测试证书随开发包提供。</p> 
  <p>&nbsp;</p> 
  <h2><a name="_Toc407708806"></a><a name="_Toc402875141"></a><a name="_Toc394058093">10.2&nbsp;&nbsp;&nbsp;&nbsp; 证书下载及导出流程(ok)</a></h2> 
  <h3><a name="_Toc407708807"></a><a name="_Toc402875142"></a><a name="_Toc394058094">10.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证书下载流程</a></h3> 
  <p>1.&nbsp;&nbsp;&nbsp;&nbsp; 登入CFCA官网网址：<a href="http://www.cfca.com.cn/" rel="nofollow"><span>www.cfca.com.cn</span></a>，点击“生产系统证书下载”；</p> 
  <p align="left">&nbsp;</p> 
  <p align="left">&nbsp;</p> 
  <p align="left"></p> 
  <p>2.&nbsp;&nbsp;&nbsp;&nbsp; 在生产证书下载选项中点击 à 证书下载；</p> 
  <p align="left">&nbsp;</p> 
  <p align="left"></p> 
  <p align="left">3.&nbsp;&nbsp;&nbsp;&nbsp; 首次下载证书,请按照页面提示安装相应程序，以保证证书顺利下载；</p> 
  <p align="left">&nbsp;</p> 
  <p>4.&nbsp;&nbsp;&nbsp;&nbsp; 点击左侧“用户证书下载”，并点击“接受此协议”；</p> 
  <p align="left"></p> 
  <p align="left"></p> 
  <p align="left"></p> 
  <p align="left">5.&nbsp;&nbsp;&nbsp;&nbsp; 输入CFCA提供的两码（用户参考号、用户授权码），制证方式默认，软件CSP默认，点击下</p> 
  <p align="left"></p> 
  <p align="left">&nbsp;</p> 
  <p align="left">6.&nbsp;&nbsp;&nbsp;&nbsp; 完成下载操作后，页面会出现下载成功的提示。下载的证书自动存放在IE中。</p> 
  <p align="left"></p> 
  <p align="left">&nbsp;</p> 
  <h3><a name="_Toc407708808"></a><a name="_Toc402875143"></a><a name="_Toc394058095">10.2.2</a>证书导出流程</h3> 
  <p align="left">1. 打开浏览器，点选 工具 à Internet选项 à 内容 à 证书； </p> 
  <p align="left">2. 以商户号：700000000000001为例说明整个导出流程</p> 
  <p align="left">在个人证书中找到相对应的证书，点选导出；</p> 
  <p align="left"><strong></strong></p> 
  <p align="left"><strong>&nbsp;</strong></p> 
  <p>3.跳出证书导出向导对话框，点击下一步；</p> 
  <p align="left"><strong></strong></p> 
  <p align="left"><strong>&nbsp;</strong></p> 
  <p align="left">4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 选择导出私钥（如需要在服务网站上传证书公钥，请选择第二个选项以下载公钥证书，后续操作选择默认方式，再选择路径导出），点击下一步；</p> 
  <p align="left"></p> 
  <p align="left">&nbsp;</p> 
  <p align="left">5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 导出文件格式默认点击下一步；</p> 
  <p align="left"></p> 
  <p align="left">&nbsp;</p> 
  <p align="left">6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 键入证书私钥，建议不要超过6位；</p> 
  <p align="left"></p> 
  <p align="left">&nbsp;</p> 
  <p align="left">7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 指定导出证书的文件名，并选择目录存放证书，点击下一步；</p> 
  <p align="left"></p> 
  <p align="left">&nbsp;</p> 
  <p align="left">8.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 点击完成，证书导出成功。</p> 
  <p align="left"></p> 
  <p>&nbsp;</p> 
  <h1><a name="_Toc407708809"></a><a name="_Toc402875144"></a><a name="_Toc394058096"></a><a name="_SDK使用"></a><a name="_开发包插件使用"></a>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;开发包插件使用</h1> 
  <p>插件包只是为了方便商户测试而提供的样例代码，商户可以根据自己网站的需要，按照技术文档编写,并非一定要使用该代码。代码仅供参考</p> 
  <h2><a name="_Toc407708810"></a><a name="_Toc402875145"></a><a name="_Toc394058097">11.1&nbsp;&nbsp;&nbsp;&nbsp; JSP/JAVA</a></h2> 
  <p>插件以JAR包的形式提供给商户，工程名称为upacp_sdk_java。</p> 
  <h3><a name="_Toc402875148"></a><a name="_Toc394058100"></a><a name="_Toc407708811"></a><a name="_Toc407199902">11.1.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明</a></h3> 
  <p>1.&nbsp; log4j.properties:插件的日志机制使用log4j实现，可将提供的配置文件合并到项目的log4j配置中，并根据环境需要修改日志路径；</p> 
  <p>2.&nbsp;acp_sdk.properties:测试环境参数配置文件（不含手机控件支付）</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">具体配置：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据</strong>测试<strong>环境、生产环境配套配置#####</strong></p> <p align="left"><strong>#SDK 日志目录配置</strong></p> <p align="left"><strong><span style="color:#000080;">log.back.rootPath</span><span style="color:#008000;">=</span><span style="color:#800000;">d://log</span></strong></p> <p align="left"><strong>##########################交易发送地址配#############################</strong></p> <p align="left"><strong>######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)#######</strong></p> <p align="left"><strong>##前台交易请求地址</strong></p> <p><strong><span style="color:#000080;">acpsdk.frontTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/frontTransReq.do</span></strong></p> <p align="left"><strong>##&nbsp;app&nbsp;交易请求地址</strong></p> <p align="left"><strong>##<span style="color:#000080;">&nbsp;acpsdk.appTransUrl=</span><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/appTransReq.do</span></strong></p> <p align="left"><strong>##后台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.backTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/backTransReq.do</span></strong></p> <p align="left"><strong>##后台交易请求地址(若为有卡交易配置该地址)</strong></p> <p align="left"><strong>#<span style="color:#000080;">acpsdk.cardTransUrl=</span><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/cardTransReq.do</span></strong></p> <p align="left"><strong>##单笔查询请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.singleQueryUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/queryTrans.do</span></strong></p> <p align="left"><strong>##批量交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.batchTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/batchTrans.do</span></strong></p> <p align="left"><strong>##文件传输类交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.fileTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://101.231.204.80:9080/</span></strong></p> <p align="left"><strong>########################签名证书配置################################</strong></p> <p align="left"><strong>######(以下配置为</strong>测试<strong>环境：入网测试环境用，生产环境配置见下述文档说明)#######</strong></p> <p align="left"><strong>##签名证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.path</span><span style="color:#008000;">=</span><span style="color:#800000;">d:\\certs\\700000000000001_acp.pfx</span></strong></p> <p align="left"><strong>##签名证书密码</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.pwd</span><span style="color:#008000;">=</span><span style="color:#800000;">000000</span></strong></p> <p align="left"><strong>##签名证书类型</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.type</span><span style="color:#008000;">=</span><span style="color:#800000;">PKCS12</span></strong></p> <p align="left"><strong>##########################加密证书配置################################</strong></p> <p align="left"><strong>##密码加密证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.encryptCert.path</span><span style="color:#008000;">=</span><span style="color:#800000;">d:\\certs\\encrypt.cer</span></strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p>3.acp_sdk.properties:生产环境参数配置文件</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">具体配置：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>##########################交易发送地址配#############################</strong></p> <p align="left"><strong>######(以下配置为生产环境用)#######</strong></p> <p align="left"><strong>##前台交易请求地址</strong></p> <p><strong><span style="color:#000080;">acpsdk.frontTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://gateway.95516.com/gateway/api/frontTransReq.do</span></strong></p> <p align="left"><strong>##&nbsp;app&nbsp;交易请求地址</strong></p> <p align="left"><strong>##<span style="color:#000080;">&nbsp;acpsdk.appTransUrl=</span><span style="color:#800000;">https://</span><span style="color:#800000;">gateway.95516.com</span><span style="color:#800000;"> /gateway/api/appTransReq.do</span></strong></p> <p align="left"><strong>##后台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.backTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://gateway.95516.com/gateway/api/backTransReq.do</span></strong></p> <p align="left"><strong>##后台交易请求地址(若为有卡交易配置该地址)</strong></p> <p align="left"><strong>#<span style="color:#000080;">acpsdk.cardTransUrl=</span><span style="color:#800000;">https://</span><span style="color:#800000;">gateway.95516.com</span><span style="color:#800000;"> /gateway/api/cardTransReq.do</span></strong></p> <p align="left"><strong>##单笔查询请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.singleQueryUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://gateway.95516.com/gateway/api/queryTrans.do</span></strong></p> <p align="left"><strong>##批量交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.batchTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://gateway.95516.com/gateway/api/batchTrans.do</span></strong></p> <p align="left"><strong>##文件传输类交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.fileTransUrl</span><span style="color:#008000;">=</span><span style="color:#800000;">https://filedownload.95516.com/</span></strong></p> <p align="left"><strong>&nbsp;########################签名证书配置################################</strong></p> <p align="left"><strong>##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码）</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.path</span><span style="color:#008000;">=</span><span style="color:#800000;">d:\\certs\\700000000000001_acp.pfx</span></strong></p> <p align="left"><strong>##签名证书密码</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.pwd</span><span style="color:#008000;">=</span><span style="color:#800000;">123456</span></strong></p> <p align="left"><strong>##签名证书类型</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.type</span><span style="color:#008000;">=</span><span style="color:#800000;">PKCS12</span></strong></p> <p align="left"><strong>##########################加密证书配置################################</strong></p> <p align="left"><strong>##密码加密证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.encryptCert.path</span><span style="color:#008000;">=</span><span style="color:#800000;">d:\\certs\\encrypt.cer</span></strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <h3><a name="_Toc407708812"></a><a name="_Toc407199903">11.1.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明</a></h3> 
  <p>&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SDKConfig.java:负责读取acp_sdk.properties及设置参数。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>方法：public void loadPropertiesFromSrc()</strong></p> <p align="left"><strong>从标准CLASS类路径下LOAD配置文件。</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：public void loadPropertiesFromPath(String rootPath)</strong></p> <p align="left"><strong>从标准CLASS类路径下LOAD配置文件。</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：public void loadProperties(Properties pro)</strong></p> <p align="left"><strong>使用传入的Properties对象LOAD配置。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SDKUtil.java：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>方法：publicstatic String send(String url, Map&lt;String, String&gt; data, String encoding,intconnectionTimeout, intreadTimeout)</strong></p> <p align="left"><strong>发送后台交易。</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：publicstaticboolean sign(Map&lt;String, String&gt; data, String encoding)</strong></p> <p align="left"><strong>生成签名。</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：publicstaticboolean validate(Map&lt;String, String&gt; resData, String encoding)</strong></p> <p align="left"><strong>验证签名。</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：publicstatic String coverMap2String(Map&lt;String, String&gt; data)</strong></p> <p align="left"><strong>将Map形式的表单交易数据转换为key1=value1&amp;key2=value2的形式</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：publicstatic Map&lt;String, String&gt; coverResultString2Map(String result)</strong></p> <p align="left"><strong>将形如key=value&amp;key=value的字符串转换为相应的Map对象</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>方法：publicstatic String encryptPin(String card, String pwd, String encoding)</strong></p> <p align="left"><strong>密码加密，输入参数依次为卡号、密码、字符集。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SDKConstants.java：常量类。</strong></p> <p align="left"><strong>定义可能用到的各种常量和所有域名。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.CertUtil.java： 证书操作工具类，主要是导入pfx、cer等证书与获取获取私钥、获取公钥操作。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SecureUtil.java主要负责报文的签名、验证签名及加密解密；</strong></p> <p align="left"><strong>提供MD5、SHA-1以及RSA签名的方法类。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.HttpClient.java 是通信类，具体请参考代码的说明。</strong></p> <p align="left"><strong>提供和服务器通信的HTTP客户端类。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>方法：publicint send(Map&lt;String, String&gt; data, String encoding) throwsException</strong></p> <p align="left"><strong>将请求参数以HTTP表单的方式进行一次HTTP POST通信。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">Sample</span><span style="color:#FFFFFF;">说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdksample.front：包下为前台交易demo</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>方法：com.unionpay.acp.sdksample.back：包下为后台交易demo</strong></p> <p align="left"><strong>具体内容见DEMO代码中的注释和说明。</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <h3><a name="_Toc407708813"></a><a name="_Toc407199904">11.1.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件加载说明</a></h3> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">配置文件加载说明 </span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>1)&nbsp;&nbsp;&nbsp; acp_sdk.properties</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>i.&nbsp;&nbsp;&nbsp;&nbsp; 从classpath加载</strong></p> <p align="left"><strong>SDKConfig.getConfig().loadPropertiesFromSrc();</strong></p> <p align="left"><strong>ii.&nbsp;&nbsp;&nbsp; 从properties对象中加载</strong></p> <p align="left"><strong>SDKConfig.getConfig().loadProperties(pro);</strong></p> <p align="left"><strong>iii.&nbsp;&nbsp; 从指定目录下加载rootPath不包含文件名</strong></p> <p align="left"><strong>SDKConfig.getConfig().loadPropertiesFromPath(rootPath);</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>2)&nbsp;&nbsp;&nbsp; log4j.properties:放在工程的classpath目录下，系统自动加载</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <h2><a name="_Toc407708814"></a><a name="_Toc407199905"></a><a name="_Toc407195415">11.2&nbsp;&nbsp;&nbsp;&nbsp; PHP</a></h2> 
  <p>插件按编码为gbk编写，工程名称为upacp_sdk_php，供系统集成。</p> 
  <p align="left">openssl证书需下载使用 其中的php_openssl.dll,ssleay32.dll,libeay32.dll3个文件拷到&nbsp; windows/system32/文件夹下，在重启Apache服务</p> 
  <h3><a name="_Toc407708815"></a><a name="_Toc407199906"></a><a name="_Toc407195416">11.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明</a></h3> 
  <p>1. SDKConfig.php测试环境配置文件：具体配置项和说明如下；</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">具体配置：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置#####</strong></p> <p align="left"><strong>##########################交易发送地址配#############################</strong></p> <p align="left"><strong>######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)#######</strong></p> <p align="left"><strong>##前台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_FRONT_TRANS_URL = 'https://101.231.204.80:5000/gateway/api/frontTransReq.do';</span></strong></p> <p align="left"><strong>##后台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_BACK_TRANS_URL = 'https://101.231.204.80:5000/gateway/api/backTransReq.do';</span></strong></p> <p align="left"><strong>##后台交易请求地址(若为有卡交易配置该地址)</strong></p> <p align="left"><strong>constSDK_Card_Request_Url = 'https://101.231.204.80:5000/gateway/api/cardTransReq.do';</strong></p> <p align="left"><strong>##单笔查询请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_SINGLE_QUERY_URL = 'https://101.231.204.80:5000/gateway/api/queryTrans.do';</span></strong></p> <p align="left"><strong>##批量交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_BATCH_TRANS_URL = 'https://101.231.204.80:5000/gateway/api/batchTrans.do';</span></strong></p> <p align="left"><strong>##文件传输类交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_FILE_QUERY_URL = 'https://101.231.204.80:9080/';</span></strong></p> <p align="left"><strong>##APP交易地址</strong></p> <p align="left"><strong>constSDK_App_Request_Url = 'https://101.231.204.80:5000/gateway/api/appTransReq.do';</strong></p> <p align="left"><strong>########################签名证书配置################################</strong></p> <p align="left"><strong>######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)#######</strong></p> <p align="left"><strong>##签名证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_SIGN_CERT_PATH = 'D:/certs/PM_700000000000001_acp.pfx';</span></strong></p> <p align="left"><strong>##签名证书密码</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_SIGN_CERT_PWD = '000000';</span></strong></p> <p align="left"><strong>##签名证书类型</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.type</span><span style="color:#008000;">=</span><span style="color:#800000;">PKCS12</span></strong></p> <p align="left"><strong>##验签</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_VERIFY_CERT_PATH = 'D:/certs/verify_sign_acp.cer';</span></strong></p> <p align="left"><strong>##<span style="color:#800000;">前台通知地址 (</span>商户自行配置通知地址)</strong></p> <p align="left"><strong><span style="color:#800000;">const SDK_FRONT_NOTIFY_URL = 'http://127.0.0.1/upacp_sdk_php/demo/response.php';</span></strong></p> <p align="left"><strong><span style="color:#800000;">// </span><span style="color:#800000;">后台通知地址 (</span>商户自行配置通知地址)</strong></p> <p align="left"><strong><span style="color:#800000;">const SDK_BACK_NOTIFY_URL = 'http://127.0.0.1/upacp_sdk_php/demo/response.php';</span></strong></p> <p align="left"><strong><span style="color:#800000;">//</span><span style="color:#800000;">文件下载目录</span></strong></p> <p align="left"><strong><span style="color:#800000;">const SDK_FILE_DOWN_PATH = 'd:/file/';</span></strong></p> <p align="left"><strong><span style="color:#800000;">//</span><span style="color:#800000;">日志 目录</span></strong></p> <p align="left"><strong><span style="color:#800000;">const SDK_LOG_FILE_PATH = 'D:/logs/';</span></strong></p> <p align="left"><strong><span style="color:#800000;">//</span><span style="color:#800000;">日志级别</span></strong></p> <p align="left"><strong><span style="color:#800000;">const SDK_LOG_LEVEL = 'INFO';</span></strong></p> <p align="left"><strong><span style="color:#800000;">&nbsp;</span></strong></p> <p align="left"><strong>##########################加密证书配置################################</strong></p> <p align="left"><strong>##密码加密证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_ENCRYPT_CERT_PATH = 'D:/certs/encrypt.cer';</span></strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong>&nbsp;</strong></p> 
  <p>2. SDKConfig.php ，生产测试环境配置文件：具体配置项和说明如下；</p> 
  <p align="left"><strong>&nbsp;</strong></p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">具体配置：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>##########################交易发送地址配#############################</strong></p> <p align="left"><strong>######(以下配置为生产环境用)#######</strong></p> <p align="left"><strong>##前台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_FRONT_TRANS_URL = 'https://gateway.95516.com/gateway/api/frontTransReq.do';</span></strong></p> <p align="left"><strong>##后台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_BACK_TRANS_URL = 'https://gateway.95516.com/gateway/api/backTransReq.do';</span></strong></p> <p align="left"><strong>##后台交易请求地址(若为有卡交易配置该地址)</strong></p> <p align="left"><strong>constSDK_Card_Request_Url = 'https://gateway.95516.com/gateway/api/cardTransReq.do';</strong></p> <p align="left"><strong>##单笔查询请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_SINGLE_QUERY_URL = 'https://gateway.95516.com/gateway/api/queryTrans.do';</span></strong></p> <p align="left"><strong>##批量交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_BATCH_TRANS_URL = 'https://gateway.95516.com/gateway/api/batchTrans.do';</span></strong></p> <p align="left"><strong>##文件传输类交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_FILE_QUERY_URL = 'https://filedownload.95516.com/';</span></strong></p> <p align="left"><strong>##APP交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">constSDK_App_Request_Url = 'https://gateway.95516.com/gateway/api/appTransReq.do';</span></strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>##前台通知地址 (商户自行配置通知地址)</strong></p> <p align="left"><strong>const SDK_FRONT_NOTIFY_URL = 'http://127.0.0.1/upacp_sdk_php/demo/response.php';</strong></p> <p align="left"><strong>##后台通知地址 (商户自行配置通知地址)</strong></p> <p align="left"><strong>const SDK_BACK_NOTIFY_URL = 'http://127.0.0.1/upacp_sdk_php/demo/response.php';</strong></p> <p align="left"><strong>##文件下载目录 </strong></p> <p align="left"><strong>const SDK_FILE_DOWN_PATH = 'd:/file/';</strong></p> <p align="left"><strong>##日志 目录 </strong></p> <p align="left"><strong>const SDK_LOG_FILE_PATH = 'D:/logs/';</strong></p> <p align="left"><strong>##日志级别</strong></p> <p align="left"><strong>const SDK_LOG_LEVEL = 'INFO';</strong></p> <p align="left"><strong>########################签名证书配置################################</strong></p> <p align="left"><strong>##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码）</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_SIGN_CERT_PATH = 'D:/certs/PRO_700000000000001_acp.pfx';</span></strong></p> <p align="left"><strong>##签名证书密码</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_SIGN_CERT_PWD = '000000';</span></strong></p> <p align="left"><strong>##签名证书类型</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.type</span><span style="color:#008000;">=</span><span style="color:#800000;">PKCS12</span></strong></p> <p align="left"><strong>##验签</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_VERIFY_CERT_PATH = 'D:/certs/UPOP_VERIFY.cer';</span></strong></p> <p align="left"><strong>##验签证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_VERIFY_CERT_PATH = 'D:/certs/';</span></strong></p> <p align="left"><strong>##########################加密证书配置################################</strong></p> <p align="left"><strong>##密码加密证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">const SDK_ENCRYPT_CERT_PATH = 'D:/certs/RSA2048_PROD_index_22.cer';</span></strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong>&nbsp;</strong></p> 
  <h3><a name="_Toc407708816"></a><a name="_Toc407199907"></a><a name="_Toc407195417">11.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类与方法说明</a></h3> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>upacp_sdk_php.gbk.common.php:负责将请求报文排序后转化为字符串、将字符串转为数组</strong></p> <p align="left"><strong>解压、压缩、构建自动提交表单等</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>function coverParamsToString($params)</strong></p> <p align="left"><strong>功能: 将请求报文排序后转化为字符串</strong></p> <p align="left"><strong>输入: 请求数组</strong></p> <p align="left"><strong>输出: 排序后的 key1=val1&amp;key2=val2&amp;....</strong></p> <p align="left"><strong>function coverStringToArray($str)</strong></p> <p align="left"><strong>功能: 将字符串转为数组</strong></p> <p align="left"><strong>输入: key1=val1&amp;key2=val2&amp;....</strong></p> <p align="left"><strong>输出: 数组元素 array(key1=&gt;val1,key2=&gt;val2...)</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function deal_params(&amp;$params)</strong></p> <p align="left"><strong>功能: 处理返回报文 解码客户信息</strong></p> <p align="left"><strong>输入: 客户信息</strong></p> <p align="left"><strong>输出: 将客户信息组装成customerInfo项</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function deflate_file(&amp;$params)</strong></p> <p align="left"><strong>功能: 压缩文件</strong></p> <p align="left"><strong>输入: 带有文件上传的请求报文</strong></p> <p align="left"><strong>输出: 将上传文件压缩后组装进报文</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function deal_file($params)</strong></p> <p align="left"><strong>功能: 解压缩文件</strong></p> <p align="left"><strong>输入: 带有文件下载的返回报文</strong></p> <p align="left"><strong>输出: 处理文件内容并保存到指定目录下</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function create_html($params, $action)</strong></p> <p align="left"><strong>功能: 构造自动提交的表单</strong></p> <p align="left"><strong>输入: 请求数组($params) ,请求的远程url</strong></p> <p align="left"><strong>输出: 自动提交的form表单字符串</strong></p> <p align="left">&nbsp;</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>upacp_sdk_php.gbk.httpClient.php:后台交易 客户端通信等</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">&nbsp;</p> <p align="left"><strong>httpClient.php</strong></p> <p align="left"><strong>function sendHttpRequest($params, $url)</strong></p> <p align="left"><strong>功能: 后台交易 HttpClient通信</strong></p> <p align="left"><strong>输入: 请数据,及远程通信url</strong></p> <p align="left"><strong>输出: 后台交易响应信息</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getRequestParamString($params)</strong></p> <p align="left"><strong>功能: 请求数据 urlencode处理后转为key=val&amp;...串</strong></p> <p align="left"><strong>输入: 请求数组</strong></p> <p align="left"><strong>输出: urlencode处理后的key=val&amp;...串</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong>&nbsp;</strong></p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>upacp_sdk_php.gbk.secureUtil.php:负责签名，验签，加载证书，取公钥/私钥，加密卡号/cvn2/有效期等方法类</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>secureUtil.php</strong></p> <p align="left"><strong>function sign(&amp;$params)</strong></p> <p align="left"><strong>功能: 请求数据签名</strong></p> <p align="left"><strong>输入: 请求数组</strong></p> <p align="left"><strong>输出: 带签名的请求数组</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function verify($params)</strong></p> <p align="left"><strong>功能: 验签</strong></p> <p align="left"><strong>输入: 返回报文</strong></p> <p align="left"><strong>输出: 成功/失败</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getPulbicKeyByCertId($certId)</strong></p> <p align="left"><strong>功能: 根据证书ID 加载 证书</strong></p> <p align="left"><strong>输入: 证书ID</strong></p> <p align="left"><strong>输出: 证书公钥信息</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getCertId($cert_path)</strong></p> <p align="left"><strong>功能: 取私钥证书ID</strong></p> <p align="left"><strong>输入: 私钥证书路径</strong></p> <p align="left"><strong>输出: 证书ID</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getCertIdByCerPath($cert_path) </strong></p> <p align="left"><strong>功能: 取公钥证书ID</strong></p> <p align="left"><strong>输入: 公钥证书路径</strong></p> <p align="left"><strong>输出: 证书ID</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getSignCertId()</strong></p> <p align="left"><strong>功能: 取签名证书ID</strong></p> <p align="left"><strong>输入: 签名证书路径</strong></p> <p align="left"><strong>输出: 证书ID</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getPublicKey($cert_path)</strong></p> <p align="left"><strong>功能: 获取证书公钥</strong></p> <p align="left"><strong>输入: 证书路径</strong></p> <p align="left"><strong>输出: 公钥</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function getPrivateKey($cert_path)</strong></p> <p align="left"><strong>功能: 获取证书私钥</strong></p> <p align="left"><strong>输入: 证书路径</strong></p> <p align="left"><strong>输出: 私钥</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function encryptPan($pan)</strong></p> <p align="left"><strong>功能: 加密 卡号</strong></p> <p align="left"><strong>输入: 卡号</strong></p> <p align="left"><strong>输出: 加密后卡号</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function encryptPin($pan, $pwd) </strong></p> <p align="left"><strong>功能: pin 加密</strong></p> <p align="left"><strong>输入: 卡号,密码</strong></p> <p align="left"><strong>输出: 加密后密码</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function encryptCvn2($cvn2)</strong></p> <p align="left"><strong>功能: cvn2 加密</strong></p> <p align="left"><strong>输入: cvn2</strong></p> <p align="left"><strong>输出: 加密后cvn2</strong></p> <p align="left"><strong>&nbsp;</strong></p> <p align="left"><strong>function encryptDate($certDate)</strong></p> <p align="left"><strong>功能: 有效期 加密</strong></p> <p align="left"><strong>输入: 有效期</strong></p> <p align="left"><strong>输出: 加密后有效期</strong></p> <p align="left">&nbsp;</p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong>&nbsp;</strong></p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">upacp_sdk_php.gbk.PublicEncrypte.php:密码加密</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">upacp_sdk_php.gbk.PinBlock.php:密码转pin</p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">upacp_sdk_php.gbk.log.class.php:日志类</p> </td> 
    </tr>
   </tbody>
  </table>
  <h2><a name="_Toc407708817"></a><a name="_Toc407199908"></a><a name="_Toc407195418">11.3&nbsp;&nbsp;&nbsp;&nbsp; ASP.NET</a></h2> 
  <p>插件.net Framework4.0环境以上编写，ICSharpCode.SharpZipLib手动添加，引用工程名称为upacp_sdk_php，供系统集成。</p> 
  <h3><a name="_Toc407708818"></a><a name="_Toc407199909"></a><a name="_Toc407195419">11.3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;配置文件说明</a></h3> 
  <p>1.&nbsp; Web.config:入网测试环境参数配置文件</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">具体配置：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>######&nbsp; SDK 配置文件配置文件中日志和证书的存放路径根据实际情况配置，交易地址和证书根据测试环境、生产环境配套配置#####</strong></p> <p align="left"><strong>##########################交易发送地址配#############################</strong></p> <p align="left"><strong>######(以下配置为认证环境：入网测试环境用，生产环境配置见文档说明)#######</strong></p> <p align="left"><strong>##前台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.frontTransUrl" value="https://101.231.204.80:5000/gateway/api/frontTransReq.do" /&gt;</span></strong></p> <p align="left"><strong>##后台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.backTransUrl" value="https://101.231.204.80:5000/gateway/api/backTransReq.do" /&gt;</span></strong></p> <p align="left"><strong>##后台交易请求地址(若为有卡交易配置该地址)</strong></p> <p align="left"><strong>&lt;add key="sdk.cardRequestUrl" value="https://101.231.204.80:5000/gateway/api/cardTransReq.do" /&gt;</strong></p> <p align="left"><strong>##批量交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.batTransUrl" value="https://101.231.204.80:5000/gateway/api/batchTrans.do" /&gt;</span></strong></p> <p align="left"><strong>##查询地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.singleQueryUrl" value="https://101.231.204.80:5000/gateway/api/queryTrans.do" /&gt;</span></strong></p> <p align="left"><strong>##文件传输类交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.fileTransUrl" value="https://101.231.204.80:9080/" /&gt;</span></strong></p> <p align="left"><strong>##APP交易地址</strong></p> <p align="left"><strong>&lt;add key="sdk.appRequestUrl" value="https://101.231.204.80:5000/gateway/api/appTransReq.do" /&gt;</strong></p> <p align="left"><strong>########################签名证书配置################################</strong></p> <p align="left"><strong>######(以下配置为测试环境：入网测试环境用，生产环境配置见下述文档说明)#######</strong></p> <p align="left"><strong>##签名证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.signCert.path" value="d:\certs\PM_700000000000001_acp.pfx" /&gt;</span></strong></p> <p align="left"><strong>##签名证书密码</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.signCert.pwd" value="000000" /&gt;</span></strong></p> <p align="left"><strong>##签名证书类型</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.signCert.type" value="PKCS12" /&gt;</span></strong></p> <p align="left"><strong>##验签</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.validateCert.dir" value="d:\certs\" /&gt;</span></strong></p> <p align="left"><strong>##########################加密证书配置################################</strong></p> <p align="left"><strong>##密码加密证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.encryptCert.path" value="d:\certs\encrypt.cer" /&gt;</span></strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong>&nbsp;</strong></p> 
  <p><strong>2. </strong>&nbsp;Web.config: 生产环境参数配置文件<strong></strong></p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">具体配置：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>##########################交易发送地址配#############################</strong></p> <p align="left"><strong>######(以下配置为生产环境用)#######</strong></p> <p align="left"><strong>##前台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.frontTransUrl" value="https://gateway.95516.com/gateway/api/frontTransReq.do" /&gt;</span></strong></p> <p align="left"><strong>##后台交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.backTransUrl" value="https://gateway.95516.com/gateway/api/backTransReq.do" /&gt;</span></strong></p> <p align="left"><strong>##后台交易请求地址(若为有卡交易配置该地址)</strong></p> <p align="left"><strong>&lt;add key="sdk.cardRequestUrl" value="https://gateway.95516.com/gateway/api/cardTransReq.do" /&gt;</strong></p> <p align="left"><strong>##单笔查询请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.singleQueryUrl" value="https://gateway.95516.com/gateway/api/queryTrans.do" /&gt;</span></strong></p> <p align="left"><strong>##批量交易请求地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.batTransUrl" value="https://gateway.95516.com/gateway/api/batchTrans.do" /&gt;</span></strong></p> <p align="left"><strong>##文件传输类交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.fileTransUrl" value="https://filedownload.95516.com/" /&gt;</span></strong></p> <p align="left"><strong>##APP交易地址</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.appRequestUrl" value="https://gateway.95516.com/gateway/api/appTransReq.do" /&gt;</span></strong></p> <p align="left"><strong>########################签名证书配置################################</strong></p> <p align="left"><strong>##签名证书路径（请拿到生产环境证书后修改签名路径、证书名称、证书密码）</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.signCert.path" value="d:\certs\PRO_700000000000001_acp.pfx" /&gt;</span></strong></p> <p align="left"><strong>##签名证书密码</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.signCert.pwd" value="000000" /&gt;</span></strong></p> <p align="left"><strong>##签名证书类型</strong></p> <p align="left"><strong><span style="color:#000080;">acpsdk.signCert.type</span><span style="color:#008000;">=</span><span style="color:#800000;">PKCS12</span></strong></p> <p align="left"><strong>##验签</strong></p> <p align="left"><strong><span style="color:#800000;">&lt;add key="sdk.validateCert.dir" value="d:\certs\" /&gt;</span></strong></p> <p align="left"><strong>##########################加密证书配置################################</strong></p> <p align="left"><strong>##密码加密证书路径</strong></p> <p align="left"><strong><span style="color:#000080;">&lt;add key="sdk.encryptCert.path" value="d:\certs\RSA2048_PROD_index_22.cer" /&gt;</span></strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <h3><a name="_Toc407708819"></a><a name="_Toc407199910"></a><a name="_Toc407195420">11.3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主要类和方法说明</a></h3> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SDKConfig.cs:负责读取web.config</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：读取配置文件获取签名证书路径</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string signCertPath = config.AppSettings.Settings["sdk.signCert.path"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：读取配置文件获取签名证书密码</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string signCertPwd = config.AppSettings.Settings["sdk.signCert.pwd"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：读取配置文件获取验签目录</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string validateCertDir = config.AppSettings.Settings["sdk.validateCert.dir"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：加密公钥证书路径</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string encryptCert = config.AppSettings.Settings["sdk.encryptCert.path"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：有卡交易路径;&nbsp;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string cardRequestUrl = config.AppSettings.Settings["sdk.cardRequestUrl"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：app</span>交易路径;&nbsp;</strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string appRequestUrl = config.AppSettings.Settings["sdk.appRequestUrl"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：读取配置文件获取交易查询地址&nbsp;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string singleQueryUrl = config.AppSettings.Settings["sdk.singleQueryUrl"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：读取配置文件获取文件传输类交易地址</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string fileTransUrl = config.AppSettings.Settings["sdk.fileTransUrl"].Value;&nbsp;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">功能：读取配置文件获取前台交易地址</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string frontTransUrl = config.AppSettings.Settings["sdk.frontTransUrl"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">功能：读取配置文件获取后台交易地址</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string backTransUrl = config.AppSettings.Settings["sdk.backTransUrl"].Value;</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">//</span><span style="background:#FFFFFF;">功能：读取配批量交易地址</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">private static string batTransUrl = config.AppSettings.Settings["sdk.batTransUrl"].Value;</span></strong></p> <p align="left">&nbsp;</p> </td> 
    </tr>
   </tbody>
  </table>
  <p>&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SDKUtil.cs：主要负责组装报文、证书签名、发送报文、接收报文、验证签名、加密解密等操作，具体请查看代码。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>获取签名。</strong></p> <p align="left"><strong><span style="background:#FFFFFF;">public static bool Sign(Dictionary&lt;string, string&gt; data, Encoding encoder)</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>验证签名</strong></p> <p align="left"><strong>public static bool Validate(Dictionary&lt;string, string&gt; data, Encoding encoder)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong><span style="background:#FFFFFF;">组装报文</span></strong></p> <p align="left"><strong><span style="background:#FFFFFF;">public static string CreateAutoSubmitForm(string url, Dictionary&lt;string, string&gt; data, Encoding encoder)</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>将Dictionary内容排序后输出为键值对字符串,供打印报文使用</strong></p> <p align="left"><strong>&nbsp;public static string PrintDictionaryToString(Dictionary&lt;string, string&gt; data)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>将形如key=value&amp;key=value的字符串转换为相应的<span style="background:#FFFFFF;">Dictionary</span>对象</strong></p> <p align="left"><strong><span style="background:#FFFFFF;">public static Dictionary&lt;string, string&gt; CoverstringToDictionary(string data)</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>pinblock 16进制计算</strong></p> <p align="left"><strong>public static string printHexString(byte[] b)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>密码加密，输入参数依次为卡号、密码、字符集</strong></p> <p align="left"><strong>Publicstatic string encryptPin(string card, string pwd, string encoding)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>数据加密，输入参数依次为数据、字符集</strong></p> <p align="left"><strong>Publicstatic string encryptData(string data，string encoding)</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.CertUtil.cs： 证书操作工具类，主要是导入pfx证书与获取获取私钥操作。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>获取签名证书私钥</strong></p> <p align="left"><strong>public static RSACryptoServiceProvider GetSignProviderFromPfx()</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>获取签名证书的证书序列号 </strong></p> <p align="left"><strong>&nbsp;public static string GetSignCertId()</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>通过证书id，获取验证签名的证书</strong></p> <p align="left"><strong>public static RSACryptoServiceProvider GetValidateProviderFromPath(string certId)</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.SecureUtil.cs主要负责报文的软签名、验证签名、加密；</strong></p> <p align="left"><strong>压缩、解压、Base64编码/解码,pinblock计算等提供SHA-1及RSA的方法类。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>摘要计算</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>&nbsp;public static byte[] Sha1X16(string dataStr, Encoding encoding)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>软签名</strong></p> <p align="left"><strong>&nbsp;public static byte[] SignBySoft(RSACryptoServiceProvider provider, byte[] data)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>验证签名</strong></p> <p align="left"><strong>&nbsp;public static bool ValidateBySoft(RSACryptoServiceProvider provider, byte[] base64DecodingSignStr, byte[] srcByte)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>Base64编码</strong></p> <p align="left"><strong>public static string EncodeBase64(Encoding encode, string source)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>Base64解码</strong></p> <p align="left"><strong>&nbsp;public static string DecodeBase64(Encoding encode, string result)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>Inflater解压缩</strong></p> <p align="left"><strong>public static byte[] inflater(byte[] inputByte)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>deflater压缩</strong></p> <p align="left"><strong>&nbsp;public static byte[] deflater(byte[] inputByte)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>密码计算</strong></p> <p align="left"><strong>private static byte[] pin2PinBlock(string aPin)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>获取卡号密码pinblock计算</strong></p> <p align="left"><strong>public static byte[] pin2PinBlockWithCardNO(string aPin, string aCardNO)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>&nbsp;卡号计算</strong></p> <p align="left"><strong>private static byte[] formatPan(string aPan)</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>加密</strong></p> <p align="left"><strong>public static byte[] encryptedData(byte[] encData)</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">主要类与方法说明</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>com.unionpay.acp.sdk.HttpClient.cs 是通信类，具体请参考代码的说明。</strong></p> <p align="left"><strong>提供和服务器通信的HTTP客户端类。</strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>将请求参数以HTTP表单的方式进行一次HTTP POST通信。</strong></p> <p align="left"><strong>Publicint Send(Dictionary&lt;string, string&gt;sParaTemp, Encoding encoding)</strong></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <h1><a name="_Toc407708820"></a><a name="_常见问题问答"></a>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见问题问答</h1> 
  <p><strong>Q：如何获取测试商户号与测试证书？</strong></p> 
  <p>A：测试环境申请测试用户后点击“我的测试&gt;测试参数”中查看商户号，并点击下载测试证书，注册地址：<a href="https://open.unionpay.com/ajweb/register" rel="nofollow">https://open.unionpay.com/ajweb/register</a>，生产环境请联系业务部门，具体联系方式如下：</p> 
  <p>发送邮件至： operation@unionpay.com进行业务申请和咨询，银联有专门的人员进行处理。</p> 
  <p>其他专项服务：请见《业务运营服务指引（商户） 》日常业务运营服务。</p> 
  <p><strong>Q：如何签名？</strong></p> 
  <p>A：对报文中出现签名域（signature）之外的所有数据元采用key=value的形式按照名称排序，然后以&amp;作为连接符拼接成待签名串。其次，对待签名串使用SHA-1算法做摘要，并转成16进制，再使用银联颁发给商户的商户RSA私钥证书对摘要做签名操作（签名时算法选择SHA-1）。最后，对签名做Base64编码，将编码后的签名串放在签名（signature）表单域里和其他表单域一起通过HTTP Post的方式传输给银联全渠道系统支付平台。</p> 
  <p><strong>Q：报文域中frontUrl和backUrl要填什么？</strong></p> 
  <p>A:frontUrl和backUrl为报文上送要素<strong>，</strong>银联系统将前台通知报文返回到报文中的frontUrl地址，将后台通知报文返回到报文中的backUrl地址。</p> 
  <p align="left"><strong>Q：如何获取与配置银联入网测试环境地址？</strong></p> 
  <p align="left">A : 可参见11章节测试环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。具体接入地址如下：</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td colspan="2" valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">银联入网测试环境地址：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>前台交易请求地址</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/frontTransReq.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>后台交易请求地址（无卡）</strong></p> </td> 
     <td valign="top"> <p align="left"><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/backTransReq.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>后台交易请求地址（有卡）</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/cardTransReq.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>单笔查询请求地址</strong></p> </td> 
     <td valign="top"> <p align="left"><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/queryTrans.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>批量交易请求地址</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/batchTrans.do</span><strong></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>文件传输类交易地址</strong></p> </td> 
     <td valign="top"> <p align="left"><span style="color:#800000;">https://101.231.204.80:9080/</span></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>APP交易请求地址</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://101.231.204.80:5000/gateway/api/appTransReq.do</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <p align="left"><strong>Q：银联全渠道系统商户接入生产环境地址？</strong></p> 
  <p align="left">A : 可参见11章节生产环境参数配置，配置文件可在开发包中找到（开发包获取地址：https://open.unionpay.com/ajweb/help/file/）。将配置文件中测试地址修改为如下地址：</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td colspan="2" valign="top" style="background:#4F81BD;"> <p align="left"><strong><span style="color:#FFFFFF;">银联入网测试环境地址：</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>前台交易请求地址</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://gateway.95516.com/gateway/api/frontTransReq.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>后台交易请求地址（无卡）</strong></p> </td> 
     <td valign="top"> <p align="left"><span style="color:#800000;">https://gateway.95516.com/gateway/api/backTransReq.do</span><strong></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>后台交易请求地址（有卡）</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://</span><span style="color:#800000;">gateway.95516.com</span><span style="color:#800000;">/gateway/api/cardTransReq.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>单笔查询请求地址</strong></p> </td> 
     <td valign="top"> <p align="left"><span style="color:#800000;">https://gateway.95516.com/gateway/api/queryTrans.do</span></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>批量交易请求地址</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://gateway.95516.com/gateway/api/batchTrans.do</span><strong></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p align="left"><strong>文件传输类交易地址</strong></p> </td> 
     <td valign="top"> <p align="left"><span style="color:#800000;">https://filedownload.95516.com/</span></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><strong>APP交易请求地址</strong></p> </td> 
     <td valign="top" style="background:#D3DFEE;"> <p align="left"><span style="color:#800000;">https://</span><span style="color:#800000;">gateway.95516.com</span><span style="color:#800000;"> /gateway/api/appTransReq.do</span></p> </td> 
    </tr>
   </tbody>
  </table>
  <p align="left">&nbsp;</p> 
  <p><strong>Q：商户接收到银联的前台通知和后台通知，以哪个为准？</strong></p> 
  <p>A：交易状态请以后台通知结果为准。银联系统会将后台通知结果以post的方式发送到报文中backUrl后台通知地址上，如商户未收到通知，系统会持续发送，如发送成功则不再发送，5次通知失败则不再发送，失败交易则不发送。</p> 
  <p>后台通知中，只要是非通信类错误（如通信超时，无法解析域名，没有路由等），都认为商户已经收到，不会进行重发。如果商户因为非通信类问题没有及时收到应答（比如应用切换等情况），或者收到应答时处理失败（处理逻辑的验证应该在测试环境下已经验证通过），商户应该对没有及时收到应答的交易通过查询接口来查询该交易的状态。具体参见第6章节。</p> 
  <p><strong>Q：上午做的交易，下午做撤销会报非当日交易不能撤销？</strong></p> 
  <p>A：测试环境的日切时间在下午1点半，早上的交易会归为前一日，下午的交易才是当日交易。</p> 
  <p><strong>Q：如果调用数次查询接口后，一直得到处理中状态，该怎么办？</strong></p> 
  <p>A：对于网银支付模式与非网银支付模式描述如下：</p> 
  <p>网银支付模式：<a name="OLE_LINK2"></a><a name="OLE_LINK1">跳转到银行后，订单状态为正在处理中。查询的结果为正在处理中。等银行有响应的时候，银联全渠道系统会根据银行的应答，修改订单状态为成功或失败。如用户在网银页面直接关闭浏览器，查询的结果则一直为处理中。</a><a name="OLE_LINK60"></a><a name="OLE_LINK59">若超过1小时，查询结果状态仍为处理中，一般可认为是用户关闭了浏览器，可当作失败处理。若产生单边账，可以第二天通过对账退还金额给用户。</a></p> 
  <p><a name="OLE_LINK9">非网银支付模式：银联全渠道系统会控制超时时间，一般用户支付2分钟后会有明确的状态，查询的结果不是成功就是失败，失败的交易允许用户重新支付，即如用户1点支付的时候失败，1点05分再次支付成功，则商户如果1点03分查询的时候结果为交易失败，1点06分查询的时候结果为成功。</a><a name="OLE_LINK50"></a><a name="OLE_LINK49"></a></p> 
  <p><strong>Q：消费撤销和退货有何不同？</strong></p> 
  <p>A：当天的交易可以执行消费撤销，消费撤销只能全额。</p> 
  <p>&nbsp;当天或隔天的交易都可以做退货，退货可以进行多次退货，每次金额小于原始金额，订单退款总金额不能大于此订单原始金额。</p> 
  <p><strong>Q：标准网关支付跳转银联页面HTTP400报错是什么原因？</strong></p> 
  <p>A：银联全渠道系统对报文校验较为严格，对未定义的报文域会提示http400报错，请核对产品接口规范文档（https://open.unionpay.com/ajweb/help?id=74&amp;level=0&amp;from=1）中的报文域。</p> 
  <p><strong>Q：什么是全渠道支付平台？</strong></p> 
  <p>A：全渠道支付平台是中国银联全渠道接入支付平台的简称，支持移动、互联网等渠道的收单业务，包含互联网支付产品（银联在线支付、预授权支付、B2B对公支付、跨境支付、无跳转支付）、移动终端渠道产品（手机安全支付控件、WAP页面支付、平板电脑（iPad）网关支付、预授权支付、跨境支付、无跳转支付（手机端暂无））、后台模式产品（ 订购、 代收、代付）。</p> 
  <p><strong>Q：银联全渠道入网测试的账号（卡号）是什么？</strong></p> 
  <p>A：接入银联全渠道入网测试环境需要使用银联提供的测试卡进行交易，当前仅提供两张可供测试的卡片，一张B2B企业网银的虚拟卡片，具体账号信息如下：</p> 
  <table border="1" cellspacing="0" cellpadding="0">
   <tbody>
    <tr>
     <td valign="top" style="background:#4F81BD;"> <p><strong><span style="color:#FFFFFF;">测试卡号</span></strong></p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p>平安银行借记卡：6216261000000000018<br> 证件号：341126197709218366<br> 手机号：13552535506<br> 密码：123456</p> <p>姓名：全渠道</p> </td> 
    </tr>
    <tr>
     <td valign="top"> <p>平安银行贷记卡：6221558812340000</p> <p>姓名：互联网</p> <p>证件号：341126197709218366<br> 手机号：13552535506<br> cvn2:123</p> <p>有效期：1711 </p> </td> 
    </tr>
    <tr>
     <td valign="top" style="background:#D3DFEE;"> <p align="left">B2B企业网银农行虚拟卡</p> <p align="left">卡号：123456789001</p> <p align="left">密码：789001</p> </td> 
    </tr>
   </tbody>
  </table>
  <p><strong>Q：银联全渠道相关接口文档在哪里获取？</strong></p> 
  <p>A：由银联提供的全渠道相关文档可在商户服务网站下载（https://merchant.unionpay.com/portal/pages/login/download.jsp?locale=zh_CN），也可以在自助化测试平台首页 &gt; 帮助中心 &gt;下载（https://open.unionpay.com/ajweb/help/file）中获取。</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/yulei_qq/article/details/49002281,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/yulei_qq/article/details/49002281,&quot;}">阅读更多</a> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

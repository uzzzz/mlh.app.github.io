<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Truffle 、Geth、TestRPC 在私有链上搭建智能合约 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Truffle 、Geth、TestRPC 在私有链上搭建智能合约" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：凡原创系列文章，均笔者的辛勤于中，如转载，请文章顶部注明来源。谢谢配合 https://blog.csdn.net/smilejiasmile/article/details/88112909 Truffle 的简介 Truffle 是最流行的开发框架，能够在本地编译、部署智能合约，使命是让开发更容易。 Truffle 需要以太坊客户端支持，需要支持标准的 JSON RPC API。 Truffle 的源代码地址： https://github.com/trufflesuite/truffle 适合 Truffle 开发的客户端 有许多的以太坊客户端可以选择。我们推荐在开发和部署时使用不同客户端 。 通用开发的客户端 EtherumJS TestRPC 通用正式发布的客户端 Geth (go-ethereum) 当开发基于 Truffle 的应用时，推荐使用EthereumJS TestRPC。它是一个完整的在内存中的区块链仅仅存在于你开发的设备上。相对于 Geth，TestRPC 它在执行交易时是实时返回，而不等待默认的出块时间，这样你可以快速验证你新写的代码，当出现错误时，也能即时反馈给你。它同时还是一个支持自动化测试的功能强大的客户端。Truffle 充分利用它的特性，能将测试运行时间提速近90%。 如何安装 接下来的例子，我们会使用 Truffle 分别连接 Geth 和 TestRPC 测试智能合约的部署，首先我们先分别安装Truffle、Geth、TestRPC。 首先安装 Geth。详见前面的文章 安装 Truffle 依赖环境： NodeJS 5.0+ 安装很简单 npm install -g truffle 如果安装 Truffle 后，需要修改 solidity 编译版本 具体升级solidity版本方法如下： 进入到truffle的安装目录。我的安装目录是在/home/chen/.nvm/versions/node/v8.15.0/lib/node_modules/truffle 修改package.json文件中的solc版本,solc是solidity的编译版本，如下代码： &quot;dependencies&quot;: { &quot;mocha&quot;: &quot;^4.1.0&quot;, &quot;original-require&quot;: &quot;1.0.1&quot;, &quot;solc&quot;: &quot;0.5.0&quot; }, 修改成功后，重新安装truffle npm uninstall -g truffle npm install -g truffle 使用 Truffle 进行智能合约的开发 初始化一个 Truffle 项目 通过truffle init命令,可以初始化一个默认的以太坊代币合约项目，后面我们可以通过这个项目来快速学习： $&gt;mkdir test_truffle $&gt;ls mist test_truffle $&gt;cd test_truffle/ $&gt;ls $&gt;truffle init ✔ Preparing to download ✔ Downloading ✔ Cleaning up temporary files ✔ Setting up box Unbox successful. Sweet! Commands: Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test 完成后，会产生下列这些目录： contracts 智能合约目录 migrations 发布脚本目录 test 存放测试文件 truffle.js Truffle的配置文件 编译合约 要编译合约，使用 truffle compile 命令，可以将原始代码编译成以太坊认可的字节码： $&gt;truffle compile Compiling your contracts... ==================== &gt; Compiling ./contracts/Migrations.sol &gt; Artifacts written to /home/chen/chen/ethereum-wallet/test_truffle/build/contracts &gt; Compiled successfully using: - solc: 0.5.0+commit.1d4f565a.Emscripten.clang Truffle仅默认编译自上次编译后被修改过的文件，来减少不必要的编译。如果你想编译全部文件，可以使用–compile-all选项 truffle compile --compile-all Truffle 需要定义的合约名称和文件名准确匹配,这种匹配是区分大小写的，也就是说大小写也要一致。推荐大写每一个开头字母。 文件之间的相互依赖，可以使用 import 进行合约间的引用，Truffle 将会按正确顺序依次编译合约，并在需要的时候自动关联库。例如： import &quot;./AnotherContract.sol&quot;; 创建一个 Hello blake.top 的合约并编译 在 contracts 目录中新建一个Hello_mshk_top.sol 文件，代码如下： pragma solidity ^0.4.17; contract Hello_blake_top { //say hello blake.top function say() public pure returns (string) { return &quot;Hello blake.top&quot;; } // print name function print(string name) public pure returns (string) { return name; } } 代码中有两个方法：say( ) 方法是输出一段文字 Hello blake.top；print(string name)方法是输出传入的内容。 编辑migrations/1_initial_migration.js 部署脚本，将我们刚才创建的Hello_blake_top.sol 文件设置到发布配置文件中，内容如下： const Migrations = artifacts.require(&quot;Migrations&quot;); const Hello_blake_top = artifacts.require(&quot;./Hello_blake_top.sol&quot;); module.exports = function(deployer) { deployer.deploy(Migrations); deploy.deploy(Hello_blake_top); }; 将项目使用truffle compile命令进行编译，编译后的文件都放在了 ./build/contracts 目录下： Hello_blake_top.sol 编译后的文件是 ./build/contracts/Hello_blake_top.json 中，后面在部署到 geth 中，我们会用到。 部署智能合约 编辑 truffle.js 配置文件，设置我们稍后要部署智能合约的位置。 这里要注意的是：Ganache默认运行在7545端口，Ethereumjs-testrpc 默认运行在8545端口，Truffle Develop 默认运行在9545端口。内容如下： module.exports = { networks: { development: { host: &quot;localhost&quot;, port: 8545, network_id: &quot;*&quot; } } }; 接下来，我们会使用上面的智能合约，分别在 testRPC 和 geth 中进行部署测试。 truffle的智能合约项目部署，使用下面的命令：truffle migrate 这个命令会执行所有 migrations 目录下的 js 文件。如果之前执行过 truffle migrate 命令，再次执行，只会部署新的 js 文件，如果没有新的 js 文件，不会起任何作用。如果使用–reset 参数，则会重新的执行所有脚本的部署。 如果要部署到指定的网络，可以使用–network参数，例如： truffle migrate --network live 多个网络的配置格式如下： networks: { development: { host: &quot;localhost&quot;, port: 8545, network_id: &quot;*&quot; // match any network }, live: { host: &quot;178.25.19.88&quot;, // Random IP for example purposes (do not use) port: 80, network_id: 1, // Ethereum public network // optional config values: // gas Gas limit used for deploys. Default is 4712388 // gasPrice Gas price used for deploys. Default is 100000000000 (100 Shannon). // from - default address to use for any transaction Truffle makes during migrations // provider - web3 provider instance Truffle should use to talk to the Ethereum network. // - if specified, host and port are ignored. } } 将智能合约部署到 TestRPC 中测试 启动 TestRPC 直接输入 testrpc 命令，就可以调用起 TestRPC 客户端，启动 testrpc 经后，会默认创建10个帐号，Available Accounts是帐号列表，Private Keys是相对应的帐号密钥： chen@ubuntu:~$ testrpc EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0x14b1cf637d214963cd31c923711930aa7b97fd5b (1) 0x8703ffa009e31e0eebf3aa2dacb32486e06077c0 (2) 0x2237e37056828dfb27e94a3274132a59ae5b4413 (3) 0x1744da91d3eca87fbcf2711740b12e62739965ec (4) 0x3c35f08665a047f90ddce14d0f82b703a240a56f (5) 0x2d4fa09b9f71d7b66a9c36d15eeda7311f49b837 (6) 0xc75df94d9a941cbab2a1297bd5770f0c036e4f89 (7) 0x7aaa5ff5f64970268183e06f56110a30571f753f (8) 0x7c3b0b8193fff996b01bc77154fb91f3b361a646 (9) 0x2a5c667ba684bf0b7db61d7dec17751a6f6e03f8 Private Keys ================== (0) 237fda9ce07f11cff672e58f633b514575613e96cb2653ea9d08ca69e882f042 (1) 50ea263a896e3b4ec3337ede58131e71dfdd71e7afa879b0957f3a3443b14b85 (2) dd251d5192bb0a73c1a9896f394099d646f6c8e2e96b88e7288f4e83d70a7392 (3) 3409d7a67896bbf2e6a8c9e414bb75284cf87fc66b9bb0e222cb8648a494709e (4) e1229c76e7c1e5aad682c8b27da5d1a67171c7b3ad560fdb52cb1ae3855cc31d (5) b627f6f491e8ed270733cd2483287cfa092d0b56b15de0f838ffc06257416c5b (6) b25209ef82d3a44205d72b418b86476ac710afa1dcc582525954bc31db6c6832 (7) 20b540aa45c394306d38c1d37458d9c46d404311f822fc149fcd523c2e34d84d (8) 838e1a99cca13ced482d9af2dbba6911a4ee3b676baa395a1462fd29fec070a5 (9) f586c3fe792d63b7459e399454d1798c21eb191db861aff67d9ec771cc22f83a HD Wallet ================== Mnemonic: virus bamboo couch ankle afraid glide family attend empty bulb stadium cricket Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 通过 truffle migrate 命令，对合约进行部署。 使用 truffle migrate 命令，发布项目 测试部署成功的智能合约 输入以下命令打开 truffle 控制台，测试刚才我们部署的 Hello_blake_top 合约： 在当前合约的目录下，执行 truffle console 打开一个控制台和部署的合约进行交互。 truffle(development)&gt; var contract; undefined truffle(development)&gt; Hello_mshk_top.deployed().then(function(instance){contract= instance;}); undefined truffle(development)&gt; contract.say() &#39;Hello blake&#39; truffle(development)&gt; contract.print(&quot;hello,blake&quot;) &#39;hello,blake&#39; var contract 和 javascript 语法一样，表示声明一个contract变量。Hello_blake_top.deployed().then(function(instance){contract= instance;})表示，将Hello_blake_top合约主体，传递给contract变量。后面我们就可以直接使用变量contract分别调用say()方法和print(’’)，得到我们想要的结果。 如果需要部署有参数的合约 // Deploy a single contract without constructor arguments deployer.deploy(A); // Deploy a single contract with constructor arguments deployer.deploy(A, arg1, arg2, ...); // Don&#39;t deploy this contract if it has already been deployed deployer.deploy(A, {overwrite: false}); // Set a maximum amount of gas and `from` address for the deployment deployer.deploy(A, {gas: 4612388, from: &quot;0x....&quot;}); // Deploy multiple contracts, some with arguments and some without. // This is quicker than writing three `deployer.deploy()` statements as the deployer // can perform the deployment as a single batched request. deployer.deploy([ [A, arg1, arg2, ...], B, [C, arg1] ]); // External dependency example: // // For this example, our dependency provides an address when we&#39;re deploying to the // live network, but not for any other networks like testing and development. // When we&#39;re deploying to the live network we want it to use that address, but in // testing and development we need to deploy a version of our own. Instead of writing // a bunch of conditionals, we can simply use the `overwrite` key. deployer.deploy(SomeDependency, {overwrite: false}); 更多的情况可以参见：https://truffleframework.com/docs/truffle/getting-started/running-migrations 以太坊代币空投方案 https://blog.csdn.net/xq723310/article/details/82904178 https://blog.csdn.net/ITleaks/article/details/82218485 在以太坊测试网上发行代币 https://www.jianshu.com/p/b680b9558b22 Token.sol pragma solidity ^0.4.16; contract Token{ uint256 public totalSupply; function balanceOf(address _owner) public constant returns (uint256 balance); function transfer(address _to, uint256 _value) public returns (bool success); function transferFrom(address _from, address _to, uint256 _value) public returns (bool success); function approve(address _spender, uint256 _value) public returns (bool success); function allowance(address _owner, address _spender) public constant returns (uint256 remaining); event Transfer(address indexed _from, address indexed _to, uint256 _value); event Approval(address indexed _owner, address indexed _spender, uint256 _value); } contract TokenDemo is Token { string public name; uint8 public decimals; string public symbol; mapping (address =&gt; uint256) public balances; mapping (address =&gt; mapping (address =&gt; uint256)) allowed; constructor(uint256 _initialAmount, string _tokenName, uint8 _decimalUnits, string _tokenSymbol) public { totalSupply = _initialAmount * 10 ** uint256(_decimalUnits); balances[msg.sender] = totalSupply; name = _tokenName; decimals = _decimalUnits; symbol = _tokenSymbol; } function transfer(address _to, uint256 _value) public returns (bool success) { require(balances[msg.sender] &gt;= _value &amp;&amp; balances[_to] + _value &gt; balances[_to]); require(_to != 0x0); balances[msg.sender] -= _value;//从消息发送者账户中减去token数量_value balances[_to] += _value;//往接收账户增加token数量_value emit Transfer(msg.sender, _to, _value);//触发转币交易事件 return true; } function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) { require(balances[_from] &gt;= _value &amp;&amp; allowed[_from][msg.sender] &gt;= _value); balances[_to] += _value;//接收账户增加token数量_value balances[_from] -= _value; //支出账户_from减去token数量_value allowed[_from][msg.sender] -= _value;//消息发送者可以从账户_from中转出的数量减少_value emit Transfer(_from, _to, _value);//触发转币交易事件 return true; } function balanceOf(address _owner) public constant returns (uint256 balance) { return balances[_owner]; } function approve(address _spender, uint256 _value) public returns (bool success) { allowed[msg.sender][_spender] = _value; emit Approval(msg.sender, _spender, _value); return true; } function allowance(address _owner, address _spender) public constant returns (uint256 remaining) { return allowed[_owner][_spender];//允许_spender从_owner中转出的token数 } } AirDrop.sol pragma solidity ^0.4.24; contract Ownable { address public owner; constructor() public { owner = msg.sender; } modifier onlyOwner() { require(msg.sender == owner); _; } } interface Token { function balanceOf(address _owner) external constant returns (uint256 ) ; function transfer(address _to, uint256 _value) external ; event Transfer(address indexed _from, address indexed _to, uint256 _value); } contract Airdropper is Ownable { function AirTransfer(address[] _recipients, uint _values, address _tokenAddress) onlyOwner public returns (bool) { require(_recipients.length &gt; 0); Token token = Token(_tokenAddress); for(uint j = 0; j &lt; _recipients.length; j++){ token.transfer(_recipients[j], _values); } return true; } function withdrawalToken(address _tokenAddress) onlyOwner public { Token token = Token(_tokenAddress); token.transfer(owner, token.balanceOf(this)); } }" />
<meta property="og:description" content="版权声明：凡原创系列文章，均笔者的辛勤于中，如转载，请文章顶部注明来源。谢谢配合 https://blog.csdn.net/smilejiasmile/article/details/88112909 Truffle 的简介 Truffle 是最流行的开发框架，能够在本地编译、部署智能合约，使命是让开发更容易。 Truffle 需要以太坊客户端支持，需要支持标准的 JSON RPC API。 Truffle 的源代码地址： https://github.com/trufflesuite/truffle 适合 Truffle 开发的客户端 有许多的以太坊客户端可以选择。我们推荐在开发和部署时使用不同客户端 。 通用开发的客户端 EtherumJS TestRPC 通用正式发布的客户端 Geth (go-ethereum) 当开发基于 Truffle 的应用时，推荐使用EthereumJS TestRPC。它是一个完整的在内存中的区块链仅仅存在于你开发的设备上。相对于 Geth，TestRPC 它在执行交易时是实时返回，而不等待默认的出块时间，这样你可以快速验证你新写的代码，当出现错误时，也能即时反馈给你。它同时还是一个支持自动化测试的功能强大的客户端。Truffle 充分利用它的特性，能将测试运行时间提速近90%。 如何安装 接下来的例子，我们会使用 Truffle 分别连接 Geth 和 TestRPC 测试智能合约的部署，首先我们先分别安装Truffle、Geth、TestRPC。 首先安装 Geth。详见前面的文章 安装 Truffle 依赖环境： NodeJS 5.0+ 安装很简单 npm install -g truffle 如果安装 Truffle 后，需要修改 solidity 编译版本 具体升级solidity版本方法如下： 进入到truffle的安装目录。我的安装目录是在/home/chen/.nvm/versions/node/v8.15.0/lib/node_modules/truffle 修改package.json文件中的solc版本,solc是solidity的编译版本，如下代码： &quot;dependencies&quot;: { &quot;mocha&quot;: &quot;^4.1.0&quot;, &quot;original-require&quot;: &quot;1.0.1&quot;, &quot;solc&quot;: &quot;0.5.0&quot; }, 修改成功后，重新安装truffle npm uninstall -g truffle npm install -g truffle 使用 Truffle 进行智能合约的开发 初始化一个 Truffle 项目 通过truffle init命令,可以初始化一个默认的以太坊代币合约项目，后面我们可以通过这个项目来快速学习： $&gt;mkdir test_truffle $&gt;ls mist test_truffle $&gt;cd test_truffle/ $&gt;ls $&gt;truffle init ✔ Preparing to download ✔ Downloading ✔ Cleaning up temporary files ✔ Setting up box Unbox successful. Sweet! Commands: Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test 完成后，会产生下列这些目录： contracts 智能合约目录 migrations 发布脚本目录 test 存放测试文件 truffle.js Truffle的配置文件 编译合约 要编译合约，使用 truffle compile 命令，可以将原始代码编译成以太坊认可的字节码： $&gt;truffle compile Compiling your contracts... ==================== &gt; Compiling ./contracts/Migrations.sol &gt; Artifacts written to /home/chen/chen/ethereum-wallet/test_truffle/build/contracts &gt; Compiled successfully using: - solc: 0.5.0+commit.1d4f565a.Emscripten.clang Truffle仅默认编译自上次编译后被修改过的文件，来减少不必要的编译。如果你想编译全部文件，可以使用–compile-all选项 truffle compile --compile-all Truffle 需要定义的合约名称和文件名准确匹配,这种匹配是区分大小写的，也就是说大小写也要一致。推荐大写每一个开头字母。 文件之间的相互依赖，可以使用 import 进行合约间的引用，Truffle 将会按正确顺序依次编译合约，并在需要的时候自动关联库。例如： import &quot;./AnotherContract.sol&quot;; 创建一个 Hello blake.top 的合约并编译 在 contracts 目录中新建一个Hello_mshk_top.sol 文件，代码如下： pragma solidity ^0.4.17; contract Hello_blake_top { //say hello blake.top function say() public pure returns (string) { return &quot;Hello blake.top&quot;; } // print name function print(string name) public pure returns (string) { return name; } } 代码中有两个方法：say( ) 方法是输出一段文字 Hello blake.top；print(string name)方法是输出传入的内容。 编辑migrations/1_initial_migration.js 部署脚本，将我们刚才创建的Hello_blake_top.sol 文件设置到发布配置文件中，内容如下： const Migrations = artifacts.require(&quot;Migrations&quot;); const Hello_blake_top = artifacts.require(&quot;./Hello_blake_top.sol&quot;); module.exports = function(deployer) { deployer.deploy(Migrations); deploy.deploy(Hello_blake_top); }; 将项目使用truffle compile命令进行编译，编译后的文件都放在了 ./build/contracts 目录下： Hello_blake_top.sol 编译后的文件是 ./build/contracts/Hello_blake_top.json 中，后面在部署到 geth 中，我们会用到。 部署智能合约 编辑 truffle.js 配置文件，设置我们稍后要部署智能合约的位置。 这里要注意的是：Ganache默认运行在7545端口，Ethereumjs-testrpc 默认运行在8545端口，Truffle Develop 默认运行在9545端口。内容如下： module.exports = { networks: { development: { host: &quot;localhost&quot;, port: 8545, network_id: &quot;*&quot; } } }; 接下来，我们会使用上面的智能合约，分别在 testRPC 和 geth 中进行部署测试。 truffle的智能合约项目部署，使用下面的命令：truffle migrate 这个命令会执行所有 migrations 目录下的 js 文件。如果之前执行过 truffle migrate 命令，再次执行，只会部署新的 js 文件，如果没有新的 js 文件，不会起任何作用。如果使用–reset 参数，则会重新的执行所有脚本的部署。 如果要部署到指定的网络，可以使用–network参数，例如： truffle migrate --network live 多个网络的配置格式如下： networks: { development: { host: &quot;localhost&quot;, port: 8545, network_id: &quot;*&quot; // match any network }, live: { host: &quot;178.25.19.88&quot;, // Random IP for example purposes (do not use) port: 80, network_id: 1, // Ethereum public network // optional config values: // gas Gas limit used for deploys. Default is 4712388 // gasPrice Gas price used for deploys. Default is 100000000000 (100 Shannon). // from - default address to use for any transaction Truffle makes during migrations // provider - web3 provider instance Truffle should use to talk to the Ethereum network. // - if specified, host and port are ignored. } } 将智能合约部署到 TestRPC 中测试 启动 TestRPC 直接输入 testrpc 命令，就可以调用起 TestRPC 客户端，启动 testrpc 经后，会默认创建10个帐号，Available Accounts是帐号列表，Private Keys是相对应的帐号密钥： chen@ubuntu:~$ testrpc EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0x14b1cf637d214963cd31c923711930aa7b97fd5b (1) 0x8703ffa009e31e0eebf3aa2dacb32486e06077c0 (2) 0x2237e37056828dfb27e94a3274132a59ae5b4413 (3) 0x1744da91d3eca87fbcf2711740b12e62739965ec (4) 0x3c35f08665a047f90ddce14d0f82b703a240a56f (5) 0x2d4fa09b9f71d7b66a9c36d15eeda7311f49b837 (6) 0xc75df94d9a941cbab2a1297bd5770f0c036e4f89 (7) 0x7aaa5ff5f64970268183e06f56110a30571f753f (8) 0x7c3b0b8193fff996b01bc77154fb91f3b361a646 (9) 0x2a5c667ba684bf0b7db61d7dec17751a6f6e03f8 Private Keys ================== (0) 237fda9ce07f11cff672e58f633b514575613e96cb2653ea9d08ca69e882f042 (1) 50ea263a896e3b4ec3337ede58131e71dfdd71e7afa879b0957f3a3443b14b85 (2) dd251d5192bb0a73c1a9896f394099d646f6c8e2e96b88e7288f4e83d70a7392 (3) 3409d7a67896bbf2e6a8c9e414bb75284cf87fc66b9bb0e222cb8648a494709e (4) e1229c76e7c1e5aad682c8b27da5d1a67171c7b3ad560fdb52cb1ae3855cc31d (5) b627f6f491e8ed270733cd2483287cfa092d0b56b15de0f838ffc06257416c5b (6) b25209ef82d3a44205d72b418b86476ac710afa1dcc582525954bc31db6c6832 (7) 20b540aa45c394306d38c1d37458d9c46d404311f822fc149fcd523c2e34d84d (8) 838e1a99cca13ced482d9af2dbba6911a4ee3b676baa395a1462fd29fec070a5 (9) f586c3fe792d63b7459e399454d1798c21eb191db861aff67d9ec771cc22f83a HD Wallet ================== Mnemonic: virus bamboo couch ankle afraid glide family attend empty bulb stadium cricket Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 通过 truffle migrate 命令，对合约进行部署。 使用 truffle migrate 命令，发布项目 测试部署成功的智能合约 输入以下命令打开 truffle 控制台，测试刚才我们部署的 Hello_blake_top 合约： 在当前合约的目录下，执行 truffle console 打开一个控制台和部署的合约进行交互。 truffle(development)&gt; var contract; undefined truffle(development)&gt; Hello_mshk_top.deployed().then(function(instance){contract= instance;}); undefined truffle(development)&gt; contract.say() &#39;Hello blake&#39; truffle(development)&gt; contract.print(&quot;hello,blake&quot;) &#39;hello,blake&#39; var contract 和 javascript 语法一样，表示声明一个contract变量。Hello_blake_top.deployed().then(function(instance){contract= instance;})表示，将Hello_blake_top合约主体，传递给contract变量。后面我们就可以直接使用变量contract分别调用say()方法和print(’’)，得到我们想要的结果。 如果需要部署有参数的合约 // Deploy a single contract without constructor arguments deployer.deploy(A); // Deploy a single contract with constructor arguments deployer.deploy(A, arg1, arg2, ...); // Don&#39;t deploy this contract if it has already been deployed deployer.deploy(A, {overwrite: false}); // Set a maximum amount of gas and `from` address for the deployment deployer.deploy(A, {gas: 4612388, from: &quot;0x....&quot;}); // Deploy multiple contracts, some with arguments and some without. // This is quicker than writing three `deployer.deploy()` statements as the deployer // can perform the deployment as a single batched request. deployer.deploy([ [A, arg1, arg2, ...], B, [C, arg1] ]); // External dependency example: // // For this example, our dependency provides an address when we&#39;re deploying to the // live network, but not for any other networks like testing and development. // When we&#39;re deploying to the live network we want it to use that address, but in // testing and development we need to deploy a version of our own. Instead of writing // a bunch of conditionals, we can simply use the `overwrite` key. deployer.deploy(SomeDependency, {overwrite: false}); 更多的情况可以参见：https://truffleframework.com/docs/truffle/getting-started/running-migrations 以太坊代币空投方案 https://blog.csdn.net/xq723310/article/details/82904178 https://blog.csdn.net/ITleaks/article/details/82218485 在以太坊测试网上发行代币 https://www.jianshu.com/p/b680b9558b22 Token.sol pragma solidity ^0.4.16; contract Token{ uint256 public totalSupply; function balanceOf(address _owner) public constant returns (uint256 balance); function transfer(address _to, uint256 _value) public returns (bool success); function transferFrom(address _from, address _to, uint256 _value) public returns (bool success); function approve(address _spender, uint256 _value) public returns (bool success); function allowance(address _owner, address _spender) public constant returns (uint256 remaining); event Transfer(address indexed _from, address indexed _to, uint256 _value); event Approval(address indexed _owner, address indexed _spender, uint256 _value); } contract TokenDemo is Token { string public name; uint8 public decimals; string public symbol; mapping (address =&gt; uint256) public balances; mapping (address =&gt; mapping (address =&gt; uint256)) allowed; constructor(uint256 _initialAmount, string _tokenName, uint8 _decimalUnits, string _tokenSymbol) public { totalSupply = _initialAmount * 10 ** uint256(_decimalUnits); balances[msg.sender] = totalSupply; name = _tokenName; decimals = _decimalUnits; symbol = _tokenSymbol; } function transfer(address _to, uint256 _value) public returns (bool success) { require(balances[msg.sender] &gt;= _value &amp;&amp; balances[_to] + _value &gt; balances[_to]); require(_to != 0x0); balances[msg.sender] -= _value;//从消息发送者账户中减去token数量_value balances[_to] += _value;//往接收账户增加token数量_value emit Transfer(msg.sender, _to, _value);//触发转币交易事件 return true; } function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) { require(balances[_from] &gt;= _value &amp;&amp; allowed[_from][msg.sender] &gt;= _value); balances[_to] += _value;//接收账户增加token数量_value balances[_from] -= _value; //支出账户_from减去token数量_value allowed[_from][msg.sender] -= _value;//消息发送者可以从账户_from中转出的数量减少_value emit Transfer(_from, _to, _value);//触发转币交易事件 return true; } function balanceOf(address _owner) public constant returns (uint256 balance) { return balances[_owner]; } function approve(address _spender, uint256 _value) public returns (bool success) { allowed[msg.sender][_spender] = _value; emit Approval(msg.sender, _spender, _value); return true; } function allowance(address _owner, address _spender) public constant returns (uint256 remaining) { return allowed[_owner][_spender];//允许_spender从_owner中转出的token数 } } AirDrop.sol pragma solidity ^0.4.24; contract Ownable { address public owner; constructor() public { owner = msg.sender; } modifier onlyOwner() { require(msg.sender == owner); _; } } interface Token { function balanceOf(address _owner) external constant returns (uint256 ) ; function transfer(address _to, uint256 _value) external ; event Transfer(address indexed _from, address indexed _to, uint256 _value); } contract Airdropper is Ownable { function AirTransfer(address[] _recipients, uint _values, address _tokenAddress) onlyOwner public returns (bool) { require(_recipients.length &gt; 0); Token token = Token(_tokenAddress); for(uint j = 0; j &lt; _recipients.length; j++){ token.transfer(_recipients[j], _values); } return true; } function withdrawalToken(address _tokenAddress) onlyOwner public { Token token = Token(_tokenAddress); token.transfer(owner, token.balanceOf(this)); } }" />
<link rel="canonical" href="https://mlh.app/2019/03/04/728602.html" />
<meta property="og:url" content="https://mlh.app/2019/03/04/728602.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-04T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：凡原创系列文章，均笔者的辛勤于中，如转载，请文章顶部注明来源。谢谢配合 https://blog.csdn.net/smilejiasmile/article/details/88112909 Truffle 的简介 Truffle 是最流行的开发框架，能够在本地编译、部署智能合约，使命是让开发更容易。 Truffle 需要以太坊客户端支持，需要支持标准的 JSON RPC API。 Truffle 的源代码地址： https://github.com/trufflesuite/truffle 适合 Truffle 开发的客户端 有许多的以太坊客户端可以选择。我们推荐在开发和部署时使用不同客户端 。 通用开发的客户端 EtherumJS TestRPC 通用正式发布的客户端 Geth (go-ethereum) 当开发基于 Truffle 的应用时，推荐使用EthereumJS TestRPC。它是一个完整的在内存中的区块链仅仅存在于你开发的设备上。相对于 Geth，TestRPC 它在执行交易时是实时返回，而不等待默认的出块时间，这样你可以快速验证你新写的代码，当出现错误时，也能即时反馈给你。它同时还是一个支持自动化测试的功能强大的客户端。Truffle 充分利用它的特性，能将测试运行时间提速近90%。 如何安装 接下来的例子，我们会使用 Truffle 分别连接 Geth 和 TestRPC 测试智能合约的部署，首先我们先分别安装Truffle、Geth、TestRPC。 首先安装 Geth。详见前面的文章 安装 Truffle 依赖环境： NodeJS 5.0+ 安装很简单 npm install -g truffle 如果安装 Truffle 后，需要修改 solidity 编译版本 具体升级solidity版本方法如下： 进入到truffle的安装目录。我的安装目录是在/home/chen/.nvm/versions/node/v8.15.0/lib/node_modules/truffle 修改package.json文件中的solc版本,solc是solidity的编译版本，如下代码： &quot;dependencies&quot;: { &quot;mocha&quot;: &quot;^4.1.0&quot;, &quot;original-require&quot;: &quot;1.0.1&quot;, &quot;solc&quot;: &quot;0.5.0&quot; }, 修改成功后，重新安装truffle npm uninstall -g truffle npm install -g truffle 使用 Truffle 进行智能合约的开发 初始化一个 Truffle 项目 通过truffle init命令,可以初始化一个默认的以太坊代币合约项目，后面我们可以通过这个项目来快速学习： $&gt;mkdir test_truffle $&gt;ls mist test_truffle $&gt;cd test_truffle/ $&gt;ls $&gt;truffle init ✔ Preparing to download ✔ Downloading ✔ Cleaning up temporary files ✔ Setting up box Unbox successful. Sweet! Commands: Compile: truffle compile Migrate: truffle migrate Test contracts: truffle test 完成后，会产生下列这些目录： contracts 智能合约目录 migrations 发布脚本目录 test 存放测试文件 truffle.js Truffle的配置文件 编译合约 要编译合约，使用 truffle compile 命令，可以将原始代码编译成以太坊认可的字节码： $&gt;truffle compile Compiling your contracts... ==================== &gt; Compiling ./contracts/Migrations.sol &gt; Artifacts written to /home/chen/chen/ethereum-wallet/test_truffle/build/contracts &gt; Compiled successfully using: - solc: 0.5.0+commit.1d4f565a.Emscripten.clang Truffle仅默认编译自上次编译后被修改过的文件，来减少不必要的编译。如果你想编译全部文件，可以使用–compile-all选项 truffle compile --compile-all Truffle 需要定义的合约名称和文件名准确匹配,这种匹配是区分大小写的，也就是说大小写也要一致。推荐大写每一个开头字母。 文件之间的相互依赖，可以使用 import 进行合约间的引用，Truffle 将会按正确顺序依次编译合约，并在需要的时候自动关联库。例如： import &quot;./AnotherContract.sol&quot;; 创建一个 Hello blake.top 的合约并编译 在 contracts 目录中新建一个Hello_mshk_top.sol 文件，代码如下： pragma solidity ^0.4.17; contract Hello_blake_top { //say hello blake.top function say() public pure returns (string) { return &quot;Hello blake.top&quot;; } // print name function print(string name) public pure returns (string) { return name; } } 代码中有两个方法：say( ) 方法是输出一段文字 Hello blake.top；print(string name)方法是输出传入的内容。 编辑migrations/1_initial_migration.js 部署脚本，将我们刚才创建的Hello_blake_top.sol 文件设置到发布配置文件中，内容如下： const Migrations = artifacts.require(&quot;Migrations&quot;); const Hello_blake_top = artifacts.require(&quot;./Hello_blake_top.sol&quot;); module.exports = function(deployer) { deployer.deploy(Migrations); deploy.deploy(Hello_blake_top); }; 将项目使用truffle compile命令进行编译，编译后的文件都放在了 ./build/contracts 目录下： Hello_blake_top.sol 编译后的文件是 ./build/contracts/Hello_blake_top.json 中，后面在部署到 geth 中，我们会用到。 部署智能合约 编辑 truffle.js 配置文件，设置我们稍后要部署智能合约的位置。 这里要注意的是：Ganache默认运行在7545端口，Ethereumjs-testrpc 默认运行在8545端口，Truffle Develop 默认运行在9545端口。内容如下： module.exports = { networks: { development: { host: &quot;localhost&quot;, port: 8545, network_id: &quot;*&quot; } } }; 接下来，我们会使用上面的智能合约，分别在 testRPC 和 geth 中进行部署测试。 truffle的智能合约项目部署，使用下面的命令：truffle migrate 这个命令会执行所有 migrations 目录下的 js 文件。如果之前执行过 truffle migrate 命令，再次执行，只会部署新的 js 文件，如果没有新的 js 文件，不会起任何作用。如果使用–reset 参数，则会重新的执行所有脚本的部署。 如果要部署到指定的网络，可以使用–network参数，例如： truffle migrate --network live 多个网络的配置格式如下： networks: { development: { host: &quot;localhost&quot;, port: 8545, network_id: &quot;*&quot; // match any network }, live: { host: &quot;178.25.19.88&quot;, // Random IP for example purposes (do not use) port: 80, network_id: 1, // Ethereum public network // optional config values: // gas Gas limit used for deploys. Default is 4712388 // gasPrice Gas price used for deploys. Default is 100000000000 (100 Shannon). // from - default address to use for any transaction Truffle makes during migrations // provider - web3 provider instance Truffle should use to talk to the Ethereum network. // - if specified, host and port are ignored. } } 将智能合约部署到 TestRPC 中测试 启动 TestRPC 直接输入 testrpc 命令，就可以调用起 TestRPC 客户端，启动 testrpc 经后，会默认创建10个帐号，Available Accounts是帐号列表，Private Keys是相对应的帐号密钥： chen@ubuntu:~$ testrpc EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2) Available Accounts ================== (0) 0x14b1cf637d214963cd31c923711930aa7b97fd5b (1) 0x8703ffa009e31e0eebf3aa2dacb32486e06077c0 (2) 0x2237e37056828dfb27e94a3274132a59ae5b4413 (3) 0x1744da91d3eca87fbcf2711740b12e62739965ec (4) 0x3c35f08665a047f90ddce14d0f82b703a240a56f (5) 0x2d4fa09b9f71d7b66a9c36d15eeda7311f49b837 (6) 0xc75df94d9a941cbab2a1297bd5770f0c036e4f89 (7) 0x7aaa5ff5f64970268183e06f56110a30571f753f (8) 0x7c3b0b8193fff996b01bc77154fb91f3b361a646 (9) 0x2a5c667ba684bf0b7db61d7dec17751a6f6e03f8 Private Keys ================== (0) 237fda9ce07f11cff672e58f633b514575613e96cb2653ea9d08ca69e882f042 (1) 50ea263a896e3b4ec3337ede58131e71dfdd71e7afa879b0957f3a3443b14b85 (2) dd251d5192bb0a73c1a9896f394099d646f6c8e2e96b88e7288f4e83d70a7392 (3) 3409d7a67896bbf2e6a8c9e414bb75284cf87fc66b9bb0e222cb8648a494709e (4) e1229c76e7c1e5aad682c8b27da5d1a67171c7b3ad560fdb52cb1ae3855cc31d (5) b627f6f491e8ed270733cd2483287cfa092d0b56b15de0f838ffc06257416c5b (6) b25209ef82d3a44205d72b418b86476ac710afa1dcc582525954bc31db6c6832 (7) 20b540aa45c394306d38c1d37458d9c46d404311f822fc149fcd523c2e34d84d (8) 838e1a99cca13ced482d9af2dbba6911a4ee3b676baa395a1462fd29fec070a5 (9) f586c3fe792d63b7459e399454d1798c21eb191db861aff67d9ec771cc22f83a HD Wallet ================== Mnemonic: virus bamboo couch ankle afraid glide family attend empty bulb stadium cricket Base HD Path: m/44&#39;/60&#39;/0&#39;/0/{account_index} Listening on localhost:8545 通过 truffle migrate 命令，对合约进行部署。 使用 truffle migrate 命令，发布项目 测试部署成功的智能合约 输入以下命令打开 truffle 控制台，测试刚才我们部署的 Hello_blake_top 合约： 在当前合约的目录下，执行 truffle console 打开一个控制台和部署的合约进行交互。 truffle(development)&gt; var contract; undefined truffle(development)&gt; Hello_mshk_top.deployed().then(function(instance){contract= instance;}); undefined truffle(development)&gt; contract.say() &#39;Hello blake&#39; truffle(development)&gt; contract.print(&quot;hello,blake&quot;) &#39;hello,blake&#39; var contract 和 javascript 语法一样，表示声明一个contract变量。Hello_blake_top.deployed().then(function(instance){contract= instance;})表示，将Hello_blake_top合约主体，传递给contract变量。后面我们就可以直接使用变量contract分别调用say()方法和print(’’)，得到我们想要的结果。 如果需要部署有参数的合约 // Deploy a single contract without constructor arguments deployer.deploy(A); // Deploy a single contract with constructor arguments deployer.deploy(A, arg1, arg2, ...); // Don&#39;t deploy this contract if it has already been deployed deployer.deploy(A, {overwrite: false}); // Set a maximum amount of gas and `from` address for the deployment deployer.deploy(A, {gas: 4612388, from: &quot;0x....&quot;}); // Deploy multiple contracts, some with arguments and some without. // This is quicker than writing three `deployer.deploy()` statements as the deployer // can perform the deployment as a single batched request. deployer.deploy([ [A, arg1, arg2, ...], B, [C, arg1] ]); // External dependency example: // // For this example, our dependency provides an address when we&#39;re deploying to the // live network, but not for any other networks like testing and development. // When we&#39;re deploying to the live network we want it to use that address, but in // testing and development we need to deploy a version of our own. Instead of writing // a bunch of conditionals, we can simply use the `overwrite` key. deployer.deploy(SomeDependency, {overwrite: false}); 更多的情况可以参见：https://truffleframework.com/docs/truffle/getting-started/running-migrations 以太坊代币空投方案 https://blog.csdn.net/xq723310/article/details/82904178 https://blog.csdn.net/ITleaks/article/details/82218485 在以太坊测试网上发行代币 https://www.jianshu.com/p/b680b9558b22 Token.sol pragma solidity ^0.4.16; contract Token{ uint256 public totalSupply; function balanceOf(address _owner) public constant returns (uint256 balance); function transfer(address _to, uint256 _value) public returns (bool success); function transferFrom(address _from, address _to, uint256 _value) public returns (bool success); function approve(address _spender, uint256 _value) public returns (bool success); function allowance(address _owner, address _spender) public constant returns (uint256 remaining); event Transfer(address indexed _from, address indexed _to, uint256 _value); event Approval(address indexed _owner, address indexed _spender, uint256 _value); } contract TokenDemo is Token { string public name; uint8 public decimals; string public symbol; mapping (address =&gt; uint256) public balances; mapping (address =&gt; mapping (address =&gt; uint256)) allowed; constructor(uint256 _initialAmount, string _tokenName, uint8 _decimalUnits, string _tokenSymbol) public { totalSupply = _initialAmount * 10 ** uint256(_decimalUnits); balances[msg.sender] = totalSupply; name = _tokenName; decimals = _decimalUnits; symbol = _tokenSymbol; } function transfer(address _to, uint256 _value) public returns (bool success) { require(balances[msg.sender] &gt;= _value &amp;&amp; balances[_to] + _value &gt; balances[_to]); require(_to != 0x0); balances[msg.sender] -= _value;//从消息发送者账户中减去token数量_value balances[_to] += _value;//往接收账户增加token数量_value emit Transfer(msg.sender, _to, _value);//触发转币交易事件 return true; } function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) { require(balances[_from] &gt;= _value &amp;&amp; allowed[_from][msg.sender] &gt;= _value); balances[_to] += _value;//接收账户增加token数量_value balances[_from] -= _value; //支出账户_from减去token数量_value allowed[_from][msg.sender] -= _value;//消息发送者可以从账户_from中转出的数量减少_value emit Transfer(_from, _to, _value);//触发转币交易事件 return true; } function balanceOf(address _owner) public constant returns (uint256 balance) { return balances[_owner]; } function approve(address _spender, uint256 _value) public returns (bool success) { allowed[msg.sender][_spender] = _value; emit Approval(msg.sender, _spender, _value); return true; } function allowance(address _owner, address _spender) public constant returns (uint256 remaining) { return allowed[_owner][_spender];//允许_spender从_owner中转出的token数 } } AirDrop.sol pragma solidity ^0.4.24; contract Ownable { address public owner; constructor() public { owner = msg.sender; } modifier onlyOwner() { require(msg.sender == owner); _; } } interface Token { function balanceOf(address _owner) external constant returns (uint256 ) ; function transfer(address _to, uint256 _value) external ; event Transfer(address indexed _from, address indexed _to, uint256 _value); } contract Airdropper is Ownable { function AirTransfer(address[] _recipients, uint _values, address _tokenAddress) onlyOwner public returns (bool) { require(_recipients.length &gt; 0); Token token = Token(_tokenAddress); for(uint j = 0; j &lt; _recipients.length; j++){ token.transfer(_recipients[j], _values); } return true; } function withdrawalToken(address _tokenAddress) onlyOwner public { Token token = Token(_tokenAddress); token.transfer(owner, token.balanceOf(this)); } }","@type":"BlogPosting","url":"https://mlh.app/2019/03/04/728602.html","headline":"Truffle 、Geth、TestRPC 在私有链上搭建智能合约","dateModified":"2019-03-04T00:00:00+08:00","datePublished":"2019-03-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/03/04/728602.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Truffle 、Geth、TestRPC 在私有链上搭建智能合约</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright"> 
  <svg class="icon" title="CSDN认证原创" aria-hidden="true" style="width:53px; height: 18px; vertical-align: -4px;"> 
   <use xlink:href="#CSDN_Cert"></use> 
  </svg> 版权声明：凡原创系列文章，均笔者的辛勤于中，如转载，请文章顶部注明来源。谢谢配合 https://blog.csdn.net/smilejiasmile/article/details/88112909 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h3><a id="Truffle__0"></a>Truffle 的简介</h3> 
  <ul> 
   <li> <p>Truffle 是最流行的开发框架，能够在本地编译、部署智能合约，使命是让开发更容易。</p> </li> 
   <li> <p>Truffle 需要以太坊客户端支持，需要支持标准的 JSON RPC API。</p> </li> 
   <li> <p>Truffle 的源代码地址：<br> <a href="https://github.com/trufflesuite/truffle" rel="nofollow">https://github.com/trufflesuite/truffle</a></p> </li> 
   <li> <p>适合 Truffle 开发的客户端</p> 
    <ul> 
     <li>有许多的以太坊客户端可以选择。我们推荐在开发和部署时使用不同客户端 。</li> 
     <li>通用开发的客户端</li> 
     <li><a href="https://github.com/trufflesuite/ganache-cli" rel="nofollow">EtherumJS TestRPC</a></li> 
     <li>通用正式发布的客户端</li> 
     <li><a href="https://github.com/ethereum/go-ethereum" rel="nofollow">Geth (go-ethereum)</a></li> 
    </ul> </li> 
  </ul> 
  <p>当开发基于 Truffle 的应用时，推荐使用EthereumJS TestRPC。它是一个完整的在内存中的区块链仅仅存在于你开发的设备上。相对于 Geth，TestRPC 它在执行交易时是实时返回，而不等待默认的出块时间，这样你可以快速验证你新写的代码，当出现错误时，也能即时反馈给你。它同时还是一个支持自动化测试的功能强大的客户端。Truffle 充分利用它的特性，能将测试运行时间提速近90%。</p> 
  <h3><a id="_20"></a>如何安装</h3> 
  <ul> 
   <li> <p>接下来的例子，我们会使用 Truffle 分别连接 Geth 和 TestRPC 测试智能合约的部署，首先我们先分别安装Truffle、Geth、TestRPC。</p> </li> 
   <li> <p>首先安装 Geth。详见前面的文章</p> </li> 
   <li> <p>安装 Truffle</p> 
    <ul> 
     <li>依赖环境：</li> 
     <li>NodeJS 5.0+</li> 
     <li>安装很简单</li> 
     <li><code>npm install -g truffle</code></li> 
    </ul> </li> 
  </ul> 
  <h3><a id="_Truffle__solidity__31"></a>如果安装 Truffle 后，需要修改 solidity 编译版本</h3> 
  <ul> 
   <li>具体升级solidity版本方法如下： 
    <ul> 
     <li>进入到truffle的安装目录。我的安装目录是在/home/chen/.nvm/versions/node/v8.15.0/lib/node_modules/truffle</li> 
     <li>修改package.json文件中的solc版本,solc是solidity的编译版本，如下代码：</li> 
    </ul> </li> 
  </ul> 
  <pre><code class="prism language-js"> <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"mocha"</span><span class="token punctuation">:</span> <span class="token string">"^4.1.0"</span><span class="token punctuation">,</span>
    <span class="token string">"original-require"</span><span class="token punctuation">:</span> <span class="token string">"1.0.1"</span><span class="token punctuation">,</span>
    <span class="token string">"solc"</span><span class="token punctuation">:</span> <span class="token string">"0.5.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
  <ul> 
   <li>修改成功后，重新安装truffle</li> 
  </ul> 
  <pre><code class="prism language-shell"><span class="token function">npm</span> uninstall -g truffle
<span class="token function">npm</span> <span class="token function">install</span> -g truffle
</code></pre> 
  <h3><a id="_Truffle__52"></a>使用 Truffle 进行智能合约的开发</h3> 
  <ul> 
   <li>初始化一个 Truffle 项目 
    <ul> 
     <li>通过truffle init命令,可以初始化一个默认的以太坊代币合约项目，后面我们可以通过这个项目来快速学习：</li> 
    </ul> </li> 
  </ul> 
  <pre><code class="prism language-shell">$<span class="token operator">&gt;</span>mkdir test_truffle
$<span class="token operator">&gt;</span>ls
mist  test_truffle

$<span class="token operator">&gt;</span>cd test_truffle/
$<span class="token operator">&gt;</span>ls
$<span class="token operator">&gt;</span>truffle init

✔ Preparing to download
✔ Downloading
✔ Cleaning up temporary files
✔ Setting up box 

Unbox successful. Sweet<span class="token operator">!</span>

Commands:

  Compile:        truffle compile
  Migrate:        truffle migrate
  Test contracts: truffle <span class="token function">test</span>            
</code></pre> 
  <p>完成后，会产生下列这些目录：</p> 
  <ul> 
   <li>contracts 智能合约目录</li> 
   <li>migrations 发布脚本目录</li> 
   <li>test 存放测试文件</li> 
   <li>truffle.js Truffle的配置文件</li> 
  </ul> 
  <h3><a id="_89"></a>编译合约</h3> 
  <ul> 
   <li>要编译合约，使用 truffle compile 命令，可以将原始代码编译成以太坊认可的字节码：</li> 
  </ul> 
  <pre><code class="prism language-sh">$&gt;truffle compile

Compiling your contracts...
==================== 
&gt; Compiling ./contracts/Migrations.sol
&gt; Artifacts written to /home/chen/chen/ethereum-wallet/test_truffle/build/contracts
&gt; Compiled successfully using:
   - solc: 0.5.0+commit.1d4f565a.Emscripten.clang

</code></pre> 
  <ul> 
   <li>Truffle仅默认编译自上次编译后被修改过的文件，来减少不必要的编译。如果你想编译全部文件，可以使用–compile-all选项</li> 
   <li><code>truffle compile --compile-all</code></li> 
   <li>Truffle 需要定义的合约名称和文件名准确匹配,这种匹配是区分大小写的，也就是说大小写也要一致。推荐大写每一个开头字母。</li> 
   <li>文件之间的相互依赖，可以使用 import 进行合约间的引用，Truffle 将会按正确顺序依次编译合约，并在需要的时候自动关联库。例如：</li> 
   <li><code>import "./AnotherContract.sol";</code></li> 
  </ul> 
  <h3><a id="_Hello_blaketop__111"></a>创建一个 Hello blake.top 的合约并编译</h3> 
  <ul> 
   <li>在 contracts 目录中新建一个Hello_mshk_top.sol 文件，代码如下：</li> 
  </ul> 
  <pre><code class="prism language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.17</span><span class="token punctuation">;</span>

contract Hello_blake_top <span class="token punctuation">{</span>

  <span class="token comment">//say hello blake.top</span>
  <span class="token keyword">function</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> pure <span class="token function">returns</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"Hello blake.top"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// print name</span>
  <span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span>string name<span class="token punctuation">)</span> <span class="token keyword">public</span> pure <span class="token function">returns</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul> 
   <li>代码中有两个方法：say( ) 方法是输出一段文字 Hello blake.top；print(string name)方法是输出传入的内容。</li> 
   <li>编辑<code>migrations/1_initial_migration.js</code> 部署脚本，将我们刚才创建的Hello_blake_top.sol 文件设置到发布配置文件中，内容如下：</li> 
  </ul> 
  <pre><code class="prism language-js"><span class="token keyword">const</span> Migrations <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"Migrations"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Hello_blake_top <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./Hello_blake_top.sol"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>deployer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>Migrations<span class="token punctuation">)</span><span class="token punctuation">;</span>
  deploy<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>Hello_blake_top<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
  <ul> 
   <li> <p>将项目使用truffle compile命令进行编译，编译后的文件都放在了 ./build/contracts 目录下：</p> </li> 
   <li> <p>Hello_blake_top.sol 编译后的文件是 ./build/contracts/Hello_blake_top.json 中，后面在部署到 geth 中，我们会用到。</p> </li> 
  </ul> 
  <h3><a id="_149"></a>部署智能合约</h3> 
  <ul> 
   <li>编辑 truffle.js 配置文件，设置我们稍后要部署智能合约的位置。</li> 
   <li>这里要注意的是：Ganache默认运行在7545端口，Ethereumjs-testrpc 默认运行在8545端口，Truffle Develop 默认运行在9545端口。内容如下：</li> 
  </ul> 
  <pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    networks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          host<span class="token punctuation">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
          port<span class="token punctuation">:</span> <span class="token number">8545</span><span class="token punctuation">,</span>
          network_id<span class="token punctuation">:</span> <span class="token string">"*"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
  <ul> 
   <li> <p>接下来，我们会使用上面的智能合约，分别在 testRPC 和 geth 中进行部署测试。</p> </li> 
   <li> <p>truffle的智能合约项目部署，使用下面的命令：<code>truffle migrate</code></p> </li> 
   <li> <p>这个命令会执行所有 migrations 目录下的 js 文件。如果之前执行过 truffle migrate 命令，再次执行，只会部署新的 js 文件，如果没有新的 js 文件，不会起任何作用。如果使用–reset 参数，则会重新的执行所有脚本的部署。</p> </li> 
   <li> <p>如果要部署到指定的网络，可以使用–network参数，例如：<br> <code>truffle migrate --network live</code></p> </li> 
   <li> <p>多个网络的配置格式如下：</p> </li> 
  </ul> 
  <pre><code class="prism language-js">networks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    host<span class="token punctuation">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
    port<span class="token punctuation">:</span> <span class="token number">8545</span><span class="token punctuation">,</span>
    network_id<span class="token punctuation">:</span> <span class="token string">"*"</span> <span class="token comment">// match any network</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  live<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    host<span class="token punctuation">:</span> <span class="token string">"178.25.19.88"</span><span class="token punctuation">,</span> <span class="token comment">// Random IP for example purposes (do not use)</span>
    port<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
    network_id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token comment">// Ethereum public network</span>
    <span class="token comment">// optional config values:</span>
    <span class="token comment">// gas Gas limit used for deploys. Default is 4712388</span>
    <span class="token comment">// gasPrice Gas price used for deploys. Default is 100000000000 (100 Shannon).</span>
    <span class="token comment">// from - default address to use for any transaction Truffle makes during migrations</span>
    <span class="token comment">// provider - web3 provider instance Truffle should use to talk to the Ethereum network.</span>
    <span class="token comment">// - if specified, host and port are ignored.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
  <h3><a id="_TestRPC__195"></a>将智能合约部署到 TestRPC 中测试</h3> 
  <ul> 
   <li>启动 TestRPC 
    <ul> 
     <li>直接输入 testrpc 命令，就可以调用起 TestRPC 客户端，启动 testrpc 经后，会默认创建10个帐号，Available Accounts是帐号列表，Private Keys是相对应的帐号密钥：</li> 
    </ul> </li> 
  </ul> 
  <pre><code class="prism language-sh">chen@ubuntu:~$ testrpc
EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2)

Available Accounts
==================
(0) 0x14b1cf637d214963cd31c923711930aa7b97fd5b
(1) 0x8703ffa009e31e0eebf3aa2dacb32486e06077c0
(2) 0x2237e37056828dfb27e94a3274132a59ae5b4413
(3) 0x1744da91d3eca87fbcf2711740b12e62739965ec
(4) 0x3c35f08665a047f90ddce14d0f82b703a240a56f
(5) 0x2d4fa09b9f71d7b66a9c36d15eeda7311f49b837
(6) 0xc75df94d9a941cbab2a1297bd5770f0c036e4f89
(7) 0x7aaa5ff5f64970268183e06f56110a30571f753f
(8) 0x7c3b0b8193fff996b01bc77154fb91f3b361a646
(9) 0x2a5c667ba684bf0b7db61d7dec17751a6f6e03f8

Private Keys
==================
(0) 237fda9ce07f11cff672e58f633b514575613e96cb2653ea9d08ca69e882f042
(1) 50ea263a896e3b4ec3337ede58131e71dfdd71e7afa879b0957f3a3443b14b85
(2) dd251d5192bb0a73c1a9896f394099d646f6c8e2e96b88e7288f4e83d70a7392
(3) 3409d7a67896bbf2e6a8c9e414bb75284cf87fc66b9bb0e222cb8648a494709e
(4) e1229c76e7c1e5aad682c8b27da5d1a67171c7b3ad560fdb52cb1ae3855cc31d
(5) b627f6f491e8ed270733cd2483287cfa092d0b56b15de0f838ffc06257416c5b
(6) b25209ef82d3a44205d72b418b86476ac710afa1dcc582525954bc31db6c6832
(7) 20b540aa45c394306d38c1d37458d9c46d404311f822fc149fcd523c2e34d84d
(8) 838e1a99cca13ced482d9af2dbba6911a4ee3b676baa395a1462fd29fec070a5
(9) f586c3fe792d63b7459e399454d1798c21eb191db861aff67d9ec771cc22f83a

HD Wallet
==================
Mnemonic:      virus bamboo couch ankle afraid glide family attend empty bulb stadium cricket
Base HD Path:  m/44'/60'/0'/0/{account_index}

Listening on localhost:8545
</code></pre> 
  <ul> 
   <li> <p>通过 truffle migrate 命令，对合约进行部署。</p> 
    <ul> 
     <li>使用 truffle migrate 命令，发布项目</li> 
    </ul> </li> 
   <li> <p>测试部署成功的智能合约</p> 
    <ul> 
     <li>输入以下命令打开 truffle 控制台，测试刚才我们部署的 Hello_blake_top 合约：</li> 
     <li>在当前合约的目录下，执行 <code>truffle console</code> 打开一个控制台和部署的合约进行交互。</li> 
    </ul> </li> 
  </ul> 
  <pre><code class="prism language-js"><span class="token function">truffle</span><span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token keyword">var</span> contract<span class="token punctuation">;</span> 

undefined 

<span class="token function">truffle</span><span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> Hello_mshk_top<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">{</span>contract<span class="token operator">=</span> instance<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

undefined 

<span class="token function">truffle</span><span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> contract<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token string">'Hello blake'</span> 

<span class="token function">truffle</span><span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> contract<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"hello,blake"</span><span class="token punctuation">)</span> 

<span class="token string">'hello,blake'</span>
</code></pre> 
  <ul> 
   <li>var contract 和 javascript 语法一样，表示声明一个contract变量。Hello_blake_top.deployed().then(function(instance){contract= instance;})表示，将Hello_blake_top合约主体，传递给contract变量。后面我们就可以直接使用变量contract分别调用say()方法和print(’’)，得到我们想要的结果。</li> 
  </ul> 
  <h3><a id="_264"></a>如果需要部署有参数的合约</h3> 
  <pre><code class="prism language-js"><span class="token comment">// Deploy a single contract without constructor arguments</span>
deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy a single contract with constructor arguments</span>
deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Don't deploy this contract if it has already been deployed</span>
deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>overwrite<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set a maximum amount of gas and `from` address for the deployment</span>
deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>gas<span class="token punctuation">:</span> <span class="token number">4612388</span><span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token string">"0x...."</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deploy multiple contracts, some with arguments and some without.</span>
<span class="token comment">// This is quicker than writing three `deployer.deploy()` statements as the deployer</span>
<span class="token comment">// can perform the deployment as a single batched request.</span>
deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token constant">B</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token constant">C</span><span class="token punctuation">,</span> arg1<span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// External dependency example:</span>
<span class="token comment">//</span>
<span class="token comment">// For this example, our dependency provides an address when we're deploying to the</span>
<span class="token comment">// live network, but not for any other networks like testing and development.</span>
<span class="token comment">// When we're deploying to the live network we want it to use that address, but in</span>
<span class="token comment">// testing and development we need to deploy a version of our own. Instead of writing</span>
<span class="token comment">// a bunch of conditionals, we can simply use the `overwrite` key.</span>
deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>SomeDependency<span class="token punctuation">,</span> <span class="token punctuation">{</span>overwrite<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
  <p>更多的情况可以参见：<a href="https://truffleframework.com/docs/truffle/getting-started/running-migrations" rel="nofollow">https://truffleframework.com/docs/truffle/getting-started/running-migrations</a></p> 
  <h3><a id="_299"></a>以太坊代币空投方案</h3> 
  <p><a href="https://blog.csdn.net/xq723310/article/details/82904178" rel="nofollow">https://blog.csdn.net/xq723310/article/details/82904178</a><br> <a href="https://blog.csdn.net/ITleaks/article/details/82218485" rel="nofollow">https://blog.csdn.net/ITleaks/article/details/82218485</a></p> 
  <h3><a id="_304"></a>在以太坊测试网上发行代币</h3> 
  <p><a href="https://www.jianshu.com/p/b680b9558b22" rel="nofollow">https://www.jianshu.com/p/b680b9558b22</a></p> 
  <ul> 
   <li>Token.sol</li> 
  </ul> 
  <pre><code class="prism language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.16</span><span class="token punctuation">;</span>
contract Token<span class="token punctuation">{</span>
    uint256 <span class="token keyword">public</span> totalSupply<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span>address _owner<span class="token punctuation">)</span> <span class="token keyword">public</span> constant <span class="token function">returns</span> <span class="token punctuation">(</span>uint256 balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span>address _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bool success<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span>address _from<span class="token punctuation">,</span> address _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span>   
    <span class="token punctuation">(</span>bool success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">approve</span><span class="token punctuation">(</span>address _spender<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bool success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">allowance</span><span class="token punctuation">(</span>address _owner<span class="token punctuation">,</span> address _spender<span class="token punctuation">)</span> <span class="token keyword">public</span> constant <span class="token function">returns</span> 
    <span class="token punctuation">(</span>uint256 remaining<span class="token punctuation">)</span><span class="token punctuation">;</span>

    event <span class="token function">Transfer</span><span class="token punctuation">(</span>address indexed _from<span class="token punctuation">,</span> address indexed _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    event <span class="token function">Approval</span><span class="token punctuation">(</span>address indexed _owner<span class="token punctuation">,</span> address indexed _spender<span class="token punctuation">,</span> uint256 
    _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

contract TokenDemo is Token <span class="token punctuation">{</span>

    string <span class="token keyword">public</span> name<span class="token punctuation">;</span>                   
    uint8 <span class="token keyword">public</span> decimals<span class="token punctuation">;</span>               
    string <span class="token keyword">public</span> symbol<span class="token punctuation">;</span> 
    <span class="token function">mapping</span> <span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> uint256<span class="token punctuation">)</span> <span class="token keyword">public</span> balances<span class="token punctuation">;</span>
    <span class="token function">mapping</span> <span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> <span class="token function">mapping</span> <span class="token punctuation">(</span>address <span class="token operator">=&gt;</span> uint256<span class="token punctuation">)</span><span class="token punctuation">)</span> allowed<span class="token punctuation">;</span>              

    <span class="token function">constructor</span><span class="token punctuation">(</span>uint256 _initialAmount<span class="token punctuation">,</span> string _tokenName<span class="token punctuation">,</span> uint8 _decimalUnits<span class="token punctuation">,</span> string _tokenSymbol<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        totalSupply <span class="token operator">=</span> _initialAmount <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">**</span> <span class="token function">uint256</span><span class="token punctuation">(</span>_decimalUnits<span class="token punctuation">)</span><span class="token punctuation">;</span>         
        balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> totalSupply<span class="token punctuation">;</span> 

        name <span class="token operator">=</span> _tokenName<span class="token punctuation">;</span>                   
        decimals <span class="token operator">=</span> _decimalUnits<span class="token punctuation">;</span>          
        symbol <span class="token operator">=</span> _tokenSymbol<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span>address _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bool success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> _value <span class="token operator">&amp;&amp;</span> balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+</span> _value <span class="token operator">&gt;</span> balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>_to <span class="token operator">!=</span> <span class="token number">0x0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> _value<span class="token punctuation">;</span><span class="token comment">//从消息发送者账户中减去token数量_value</span>
        balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+=</span> _value<span class="token punctuation">;</span><span class="token comment">//往接收账户增加token数量_value</span>
        emit <span class="token function">Transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//触发转币交易事件</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span>address _from<span class="token punctuation">,</span> address _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span> 
    <span class="token punctuation">(</span>bool success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>balances<span class="token punctuation">[</span>_from<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> _value <span class="token operator">&amp;&amp;</span> allowed<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        balances<span class="token punctuation">[</span>_to<span class="token punctuation">]</span> <span class="token operator">+=</span> _value<span class="token punctuation">;</span><span class="token comment">//接收账户增加token数量_value</span>
        balances<span class="token punctuation">[</span>_from<span class="token punctuation">]</span> <span class="token operator">-=</span> _value<span class="token punctuation">;</span> <span class="token comment">//支出账户_from减去token数量_value</span>
        allowed<span class="token punctuation">[</span>_from<span class="token punctuation">]</span><span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> _value<span class="token punctuation">;</span><span class="token comment">//消息发送者可以从账户_from中转出的数量减少_value</span>
        emit <span class="token function">Transfer</span><span class="token punctuation">(</span>_from<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//触发转币交易事件</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span>address _owner<span class="token punctuation">)</span> <span class="token keyword">public</span> constant <span class="token function">returns</span> <span class="token punctuation">(</span>uint256 balance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> balances<span class="token punctuation">[</span>_owner<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">function</span> <span class="token function">approve</span><span class="token punctuation">(</span>address _spender<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bool success<span class="token punctuation">)</span>   
    <span class="token punctuation">{</span> 
        allowed<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span> <span class="token operator">=</span> _value<span class="token punctuation">;</span>
        emit <span class="token function">Approval</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _spender<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">allowance</span><span class="token punctuation">(</span>address _owner<span class="token punctuation">,</span> address _spender<span class="token punctuation">)</span> <span class="token keyword">public</span> constant <span class="token function">returns</span> <span class="token punctuation">(</span>uint256 remaining<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> allowed<span class="token punctuation">[</span>_owner<span class="token punctuation">]</span><span class="token punctuation">[</span>_spender<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//允许_spender从_owner中转出的token数</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
  <ul> 
   <li>AirDrop.sol</li> 
  </ul> 
  <pre><code class="prism language-js">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.24</span><span class="token punctuation">;</span>
 
contract Ownable <span class="token punctuation">{</span>
  address <span class="token keyword">public</span> owner<span class="token punctuation">;</span>
 
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
    owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  modifier <span class="token function">onlyOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> owner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span>address _owner<span class="token punctuation">)</span> external constant <span class="token function">returns</span> <span class="token punctuation">(</span>uint256 <span class="token punctuation">)</span> <span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span>address _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span> external <span class="token punctuation">;</span>
  event <span class="token function">Transfer</span><span class="token punctuation">(</span>address indexed _from<span class="token punctuation">,</span> address indexed _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

contract Airdropper is Ownable <span class="token punctuation">{</span>
    
    <span class="token keyword">function</span> <span class="token function">AirTransfer</span><span class="token punctuation">(</span>address<span class="token punctuation">[</span><span class="token punctuation">]</span> _recipients<span class="token punctuation">,</span> uint _values<span class="token punctuation">,</span> address _tokenAddress<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>_recipients<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Token token <span class="token operator">=</span> <span class="token function">Token</span><span class="token punctuation">(</span>_tokenAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span><span class="token punctuation">(</span>uint j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> _recipients<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            token<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>_recipients<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> _values<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
     <span class="token keyword">function</span> <span class="token function">withdrawalToken</span><span class="token punctuation">(</span>address _tokenAddress<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token punctuation">{</span> 
        Token token <span class="token operator">=</span> <span class="token function">Token</span><span class="token punctuation">(</span>_tokenAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        token<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>owner<span class="token punctuation">,</span> token<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>滴滴全链路压测解决之道 技术头条 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="滴滴全链路压测解决之道 技术头条" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="戳蓝字“CSDN云计算”关注我们哦！ 技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！ 作者：张晓庆 转自：Java架构沉思录 滴滴出行创立于 2012 年，是全球领先的一站式多元化出行平台。经历过各种烧钱补贴大战、多次合并，滴滴成为继阿里之后，国内第二个日订单量超过千万的公司。 业务飞速增长，IT 系统面临的挑战通常更甚于业务，因为不仅需求规模增加，技术人员数量增加，面临问题的复杂度也增加： 2016 年的滴滴，正在经历这样的阶段，一方面日单量从百万冲到千万，另一方面 IT 系统屡次出现线上故障，稳定性建设成为支撑业务发展的重要保障。在此背景下，滴滴启动了全链路压测项目。 一、压测方案 滴滴的业务与普通电商差别较大，一次典型的用户打车流程是这样的：乘客发单，0-3 分钟内派给附近的司机，司机抢单后，去接乘客，到达目的地。这不但要求司乘的位置相近，而且交易必须是实时的。 基于滴滴业务的特殊性，同时借鉴了业内的经验，我们制定了滴滴的全链路压测方案，一句话描述就是：在线上环境，针对全业务核心链路，以数据隔离的方式进行压测，如下图表示： 线上环境 基于阿里等公司之前的经验，压测在线上环境进行，线上最大的优点就是环境真实，不需要担心配置不一致、结果是否可以同比例放大等问题，压测的结果自然也更为精确。但在线上做压测，需要保证安全性，风险不言而喻：不能搞垮线上系统。压测的时间窗口限定在低峰期；监控必须给力，在系统出现单点故障前，要能够提前预警，万一真的出现故障，必须紧急停止压力，最短时间内进行恢复。 全业务核心链路 支持出租车、专车快车、顺风车等几个主要的业务线，覆盖主要的业务场景，以出租车为例，从乘客打开 App 输入上车点、目的地、发单，到司机出车、抢单、接乘客上车、到达目的地，甚至取消订单等完整流程： 数据隔离 压测方案的核心是数据隔离，压测司乘要与真实司乘区分，压测订单不能与真实订单混淆，绝不能把真实乘客的单派给虚拟司机等问题。下面将专门介绍压测的数据隔离方案。 数据隔离方案 与其谈隔离方案，不如让我们想象几种数据隔离不好的场景： 某真实司机的历史订单突然多了一些假订单，积分、券、余额等出错； 某真实乘客的订单被派给了虚拟司机，乘客一直在等待司机来接； 某城市的 BI 报表出错，莫名其妙的多了一些订单，貌似财务也对不上； 某城市的运力估计及动调出现异常波动； 清理虚拟订单及相关数据时，不小心误删了真实订单和数据...... 虚拟订单方案 隔离不好的场景，光是想想就不寒而栗，可以让我们轻易排除这种看似最简单的方案：使用真实司机乘客，发送虚拟订单。虚拟订单通过 ID 或者标志字段进行区分，派单时做特殊处理。这种方式对业务有较大的侵入性，不仅是修改派单那么简单，还需要从各个维度适时地屏蔽司乘与虚拟订单的关系，如订单历史、通知推送、积分统计等，不但多而且是强依赖，显然不是一种合理的方案。 提升虚拟的层次 每个城市启用一批虚拟的乘客，发送虚拟订单，派发给虚拟司机，司乘及订单上通过 ID 或者标志字段进行区分。这可以解决司乘及订单强依赖的问题。但从城市的角度看，需要隔离真实司乘与虚拟司乘，又会涉及到城市的动态调价、供需预测、BI 统计等各个方面的隔离。 再提升虚拟的层次 与传统电商不同，Uber、滴滴这样的出行平台，都是按城市运营的，通过配置的方式开城，从而实现业务的横向快速扩展。那有没有可能在中国开辟一个甚至多个虚拟的城市呢，压测只在虚拟城市进行呢？开辟虚拟城市，可以避免前面提到的诸多问题，尤其是隔离问题，但需要考虑虚拟乘客发布路线、虚拟司机地图导航的问题，城市的位置、道路怎么模拟？干脆再进一步，虚拟一个完整的中国了，看似比较疯狂，但这就是滴滴全链路压测时的隔离方案： 在某虚拟国家，有很多虚拟的城市，每个虚拟城市都有一群虚拟的司机和乘客，他们使用虚拟的手机号和客户端，进行线上交易，由此产生了虚拟的订单。 仍然要解决位置、道路的问题，我们把中国的坐标全部偏移到太平洋，“太平洋足够大，完全容得下中美两个国家”，那一个中国自然不再话下。虚拟城市的位置、道路，把真实城市偏移一定的经纬度就可以。 压测流量标记方案 考虑这样的场景：在新开辟的虚拟城市，某虚拟的乘客要打车，他打开虚拟的手机端，输入目的地，点击「立即预约」，请求发送到滴滴的后台系统，后台应该怎么样处理？谈论方案之前，不如先了解一下现状： 传说有一种系统叫别人家的系统，有一个语言叫别人家的语言，有一种协议叫别人家的协议，正所谓人比人气死人，回头看看自己家的，虽然与很多前辈不敢相提并论，但已号称四大语言八大框架，这个锅得让历史遗留问题来背，而这段历史，只有短短的几年而已。 也有好消息，与 google 的 dapper、阿里的鹰眼类似，滴滴内部有一套自己的 trace 系统，专门用来跟踪系统之间调用链路，其基本原理如下图所示： 但并不全是好消息，全链路压测启动的时候，Trace 系统在滴滴内部并未完全推广，不少系统不支持。压测流量标记方案面临两重选择： 每个系统使用业务 ID 或标记来判断压测流量，只要能拿到司乘、订单等业务数据，系统就可以正确区分； 扩展 Trace 通路，在通路上添加压测标记，统一使用 Trace 来判断压测流量。 最终我们选择了方案 2，不但与业务完全解耦，还可以避免方案 1 中某些系统或接口无法拿到业务标记的情况。而且这种方式，客观上也可以推进 Trace 通路在公司的应用。 做不到语言和框架收敛，尽量让中间件收敛，为每种语言提供一个基础组件类库，中间件尽量收敛到该类库。 二、工具端方案 链路已通，该考虑工具端的实现方案了，内部我们管工具端叫做虚拟的「司机端」和「乘客端」，可以用来模拟批量甚至大量的用户，而不仅仅是一个用户。 分布式的虚拟司乘端 滴滴的客户端与后台通信，不仅仅有 HTTP 协议，还有 TCP 长连接，甚至还有 Thrift 协议。拿司机来说，接单等消息是通过 TCP 长连接下发的，意味着 TCP 长连接协议是必须的，而且需要为每个司机维护一个长连接。 考虑到需要模拟的司乘数量，虚拟的司机端、乘客端是分布式部署的，每个司乘端从数据中心获取司乘用户，包含基本信息、乘客路线、司机起始位置等信息，并且模拟批量司乘的发单等行为。使用数据中心的目的是，当端需要扩展时，拉取的司乘不能重复，不然重复登录可能导致被踢下线。 可动态调整的业务模型 虚拟端要模拟相对复杂、实时的交易模型，并且需要模拟不同的业务场景，以顺风车举例，平日高峰期的订单多为市内订单，而节假日的跨城订单比率增加很多。如何在不改代码的情况下可以压测不同的业务场景？我们实现了可动态调整的业务模型。 该模型中，司乘基本的交易过程、状态变化可以通过模型编辑完成，通过权重，可以调整用户本地单、跨城单的比例。即使更多的业务场景，只需生成业务模型即可支持。 更多实现细节 当然除了上面提到的，方案上还有很多细节需要考虑。为了与线上实际场景更贴近，我们从线上高峰期截取了一段时间内的乘客路线和司机位置，分阶段压测时，逐渐投放更多的司乘到虚拟城市，但这样有一个问题。 假设 A 城市有 1 万司机，高峰期有 1 万乘客在发单，他们都是随机而均匀分布的，如果把全部司机瞬间投放完成，所有乘客立即发单，绝大多数订单应该是可以派出并完成交易的。 但是考虑分阶段投放的场景：投放 1% 的司乘，上百名司机，上百个订单，虽然司机位置、乘客路线来自线上真实订单的采样，由于位置的随机性，成单量可能很少。即使投放了 10%，上千名司乘，实际成单量也远远达不到 1000个。 而我们分阶段投放要求的 10%，不光是投放数量达到线上 10%，也期望成单量等数据同步达到 10%，这样才能验证工具端方案是否合理、线上压力是否正常。 在这里，我们采用了一个简单的算法：东单是北京的一个热点区域，第一个司机、乘客投放在东单，基本上可以保证成单；前 1000 名司机、乘客投放在东单附近，成单量虽不能上千，但比完全随机要好很多。控制好司乘投放的位置，基本可以保证成单量与投放数量成比例增长。 三、压测实录 2016 年上半年是滴滴 Uber 合并前最后的疯狂，运营活动频繁，业务峰值不断攀升，平台出现的线上事故也较为多些。 从 2016 年中项目启动，经过多次尝试、探索，终于在线上成功进行了全链路压测。为了不影响线上业务，压测的窗口期选择在凌晨，并且严格掌控压测节奏，把压测过程划分成几个不同阶段，逐渐提升压力，边压测边监控后台系统的压力： 几个主要的业务线先后进行了十余次压测，并发现一些线上问题，如某 API 接口耗时明显增长；长连接服务器的参数配置有误；分单服务 codis 访问超时；日志过多导致分单算法超时等。 除了验证线上系统的稳定性，全链路压测项目还带来一些附加的收益： 不同语言下的基础组件类库趋向收敛，Trace 通道覆盖了更多模块。 建立了一套完整隔离的线上环境，未来可以在线上做更多正确性验证。 现在的滴滴，越来越重视平台稳定性，对事故的预警、降级处理和事故处理预案越来越成熟，事故时长也明显缩短，但仍然存在单点故障、鲁棒性不高等潜在风险。展望将来，期望全链路压测能在更多领域发挥作用：线上环境的故障注入和故障演练；线上灰度发布环境的正确性验证；线上系统的容量预估等。 福利 扫描添加小编微信，备注“姓名+公司职位”，加入【云计算学习交流群】，和志同道合的朋友们共同打卡学习！ 推荐阅读： VMware竟然出了一款防火墙 OpenStack网络的下一步原来这么走 | 技术头条 你的 AI 老师已上岗 要成为年薪百万的技术大牛必经历这5个阶段, 收好这份超实用的技术进阶指南 | 技术头条 助力 Android 抗衡 iOS，华为发布方舟编译器！ 程序员的黑砖窑，东南亚博彩骗局详解 售价910元！周志华等人英文新书《演化学习》出炉！ 真香，朕在看了！" />
<meta property="og:description" content="戳蓝字“CSDN云计算”关注我们哦！ 技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！ 作者：张晓庆 转自：Java架构沉思录 滴滴出行创立于 2012 年，是全球领先的一站式多元化出行平台。经历过各种烧钱补贴大战、多次合并，滴滴成为继阿里之后，国内第二个日订单量超过千万的公司。 业务飞速增长，IT 系统面临的挑战通常更甚于业务，因为不仅需求规模增加，技术人员数量增加，面临问题的复杂度也增加： 2016 年的滴滴，正在经历这样的阶段，一方面日单量从百万冲到千万，另一方面 IT 系统屡次出现线上故障，稳定性建设成为支撑业务发展的重要保障。在此背景下，滴滴启动了全链路压测项目。 一、压测方案 滴滴的业务与普通电商差别较大，一次典型的用户打车流程是这样的：乘客发单，0-3 分钟内派给附近的司机，司机抢单后，去接乘客，到达目的地。这不但要求司乘的位置相近，而且交易必须是实时的。 基于滴滴业务的特殊性，同时借鉴了业内的经验，我们制定了滴滴的全链路压测方案，一句话描述就是：在线上环境，针对全业务核心链路，以数据隔离的方式进行压测，如下图表示： 线上环境 基于阿里等公司之前的经验，压测在线上环境进行，线上最大的优点就是环境真实，不需要担心配置不一致、结果是否可以同比例放大等问题，压测的结果自然也更为精确。但在线上做压测，需要保证安全性，风险不言而喻：不能搞垮线上系统。压测的时间窗口限定在低峰期；监控必须给力，在系统出现单点故障前，要能够提前预警，万一真的出现故障，必须紧急停止压力，最短时间内进行恢复。 全业务核心链路 支持出租车、专车快车、顺风车等几个主要的业务线，覆盖主要的业务场景，以出租车为例，从乘客打开 App 输入上车点、目的地、发单，到司机出车、抢单、接乘客上车、到达目的地，甚至取消订单等完整流程： 数据隔离 压测方案的核心是数据隔离，压测司乘要与真实司乘区分，压测订单不能与真实订单混淆，绝不能把真实乘客的单派给虚拟司机等问题。下面将专门介绍压测的数据隔离方案。 数据隔离方案 与其谈隔离方案，不如让我们想象几种数据隔离不好的场景： 某真实司机的历史订单突然多了一些假订单，积分、券、余额等出错； 某真实乘客的订单被派给了虚拟司机，乘客一直在等待司机来接； 某城市的 BI 报表出错，莫名其妙的多了一些订单，貌似财务也对不上； 某城市的运力估计及动调出现异常波动； 清理虚拟订单及相关数据时，不小心误删了真实订单和数据...... 虚拟订单方案 隔离不好的场景，光是想想就不寒而栗，可以让我们轻易排除这种看似最简单的方案：使用真实司机乘客，发送虚拟订单。虚拟订单通过 ID 或者标志字段进行区分，派单时做特殊处理。这种方式对业务有较大的侵入性，不仅是修改派单那么简单，还需要从各个维度适时地屏蔽司乘与虚拟订单的关系，如订单历史、通知推送、积分统计等，不但多而且是强依赖，显然不是一种合理的方案。 提升虚拟的层次 每个城市启用一批虚拟的乘客，发送虚拟订单，派发给虚拟司机，司乘及订单上通过 ID 或者标志字段进行区分。这可以解决司乘及订单强依赖的问题。但从城市的角度看，需要隔离真实司乘与虚拟司乘，又会涉及到城市的动态调价、供需预测、BI 统计等各个方面的隔离。 再提升虚拟的层次 与传统电商不同，Uber、滴滴这样的出行平台，都是按城市运营的，通过配置的方式开城，从而实现业务的横向快速扩展。那有没有可能在中国开辟一个甚至多个虚拟的城市呢，压测只在虚拟城市进行呢？开辟虚拟城市，可以避免前面提到的诸多问题，尤其是隔离问题，但需要考虑虚拟乘客发布路线、虚拟司机地图导航的问题，城市的位置、道路怎么模拟？干脆再进一步，虚拟一个完整的中国了，看似比较疯狂，但这就是滴滴全链路压测时的隔离方案： 在某虚拟国家，有很多虚拟的城市，每个虚拟城市都有一群虚拟的司机和乘客，他们使用虚拟的手机号和客户端，进行线上交易，由此产生了虚拟的订单。 仍然要解决位置、道路的问题，我们把中国的坐标全部偏移到太平洋，“太平洋足够大，完全容得下中美两个国家”，那一个中国自然不再话下。虚拟城市的位置、道路，把真实城市偏移一定的经纬度就可以。 压测流量标记方案 考虑这样的场景：在新开辟的虚拟城市，某虚拟的乘客要打车，他打开虚拟的手机端，输入目的地，点击「立即预约」，请求发送到滴滴的后台系统，后台应该怎么样处理？谈论方案之前，不如先了解一下现状： 传说有一种系统叫别人家的系统，有一个语言叫别人家的语言，有一种协议叫别人家的协议，正所谓人比人气死人，回头看看自己家的，虽然与很多前辈不敢相提并论，但已号称四大语言八大框架，这个锅得让历史遗留问题来背，而这段历史，只有短短的几年而已。 也有好消息，与 google 的 dapper、阿里的鹰眼类似，滴滴内部有一套自己的 trace 系统，专门用来跟踪系统之间调用链路，其基本原理如下图所示： 但并不全是好消息，全链路压测启动的时候，Trace 系统在滴滴内部并未完全推广，不少系统不支持。压测流量标记方案面临两重选择： 每个系统使用业务 ID 或标记来判断压测流量，只要能拿到司乘、订单等业务数据，系统就可以正确区分； 扩展 Trace 通路，在通路上添加压测标记，统一使用 Trace 来判断压测流量。 最终我们选择了方案 2，不但与业务完全解耦，还可以避免方案 1 中某些系统或接口无法拿到业务标记的情况。而且这种方式，客观上也可以推进 Trace 通路在公司的应用。 做不到语言和框架收敛，尽量让中间件收敛，为每种语言提供一个基础组件类库，中间件尽量收敛到该类库。 二、工具端方案 链路已通，该考虑工具端的实现方案了，内部我们管工具端叫做虚拟的「司机端」和「乘客端」，可以用来模拟批量甚至大量的用户，而不仅仅是一个用户。 分布式的虚拟司乘端 滴滴的客户端与后台通信，不仅仅有 HTTP 协议，还有 TCP 长连接，甚至还有 Thrift 协议。拿司机来说，接单等消息是通过 TCP 长连接下发的，意味着 TCP 长连接协议是必须的，而且需要为每个司机维护一个长连接。 考虑到需要模拟的司乘数量，虚拟的司机端、乘客端是分布式部署的，每个司乘端从数据中心获取司乘用户，包含基本信息、乘客路线、司机起始位置等信息，并且模拟批量司乘的发单等行为。使用数据中心的目的是，当端需要扩展时，拉取的司乘不能重复，不然重复登录可能导致被踢下线。 可动态调整的业务模型 虚拟端要模拟相对复杂、实时的交易模型，并且需要模拟不同的业务场景，以顺风车举例，平日高峰期的订单多为市内订单，而节假日的跨城订单比率增加很多。如何在不改代码的情况下可以压测不同的业务场景？我们实现了可动态调整的业务模型。 该模型中，司乘基本的交易过程、状态变化可以通过模型编辑完成，通过权重，可以调整用户本地单、跨城单的比例。即使更多的业务场景，只需生成业务模型即可支持。 更多实现细节 当然除了上面提到的，方案上还有很多细节需要考虑。为了与线上实际场景更贴近，我们从线上高峰期截取了一段时间内的乘客路线和司机位置，分阶段压测时，逐渐投放更多的司乘到虚拟城市，但这样有一个问题。 假设 A 城市有 1 万司机，高峰期有 1 万乘客在发单，他们都是随机而均匀分布的，如果把全部司机瞬间投放完成，所有乘客立即发单，绝大多数订单应该是可以派出并完成交易的。 但是考虑分阶段投放的场景：投放 1% 的司乘，上百名司机，上百个订单，虽然司机位置、乘客路线来自线上真实订单的采样，由于位置的随机性，成单量可能很少。即使投放了 10%，上千名司乘，实际成单量也远远达不到 1000个。 而我们分阶段投放要求的 10%，不光是投放数量达到线上 10%，也期望成单量等数据同步达到 10%，这样才能验证工具端方案是否合理、线上压力是否正常。 在这里，我们采用了一个简单的算法：东单是北京的一个热点区域，第一个司机、乘客投放在东单，基本上可以保证成单；前 1000 名司机、乘客投放在东单附近，成单量虽不能上千，但比完全随机要好很多。控制好司乘投放的位置，基本可以保证成单量与投放数量成比例增长。 三、压测实录 2016 年上半年是滴滴 Uber 合并前最后的疯狂，运营活动频繁，业务峰值不断攀升，平台出现的线上事故也较为多些。 从 2016 年中项目启动，经过多次尝试、探索，终于在线上成功进行了全链路压测。为了不影响线上业务，压测的窗口期选择在凌晨，并且严格掌控压测节奏，把压测过程划分成几个不同阶段，逐渐提升压力，边压测边监控后台系统的压力： 几个主要的业务线先后进行了十余次压测，并发现一些线上问题，如某 API 接口耗时明显增长；长连接服务器的参数配置有误；分单服务 codis 访问超时；日志过多导致分单算法超时等。 除了验证线上系统的稳定性，全链路压测项目还带来一些附加的收益： 不同语言下的基础组件类库趋向收敛，Trace 通道覆盖了更多模块。 建立了一套完整隔离的线上环境，未来可以在线上做更多正确性验证。 现在的滴滴，越来越重视平台稳定性，对事故的预警、降级处理和事故处理预案越来越成熟，事故时长也明显缩短，但仍然存在单点故障、鲁棒性不高等潜在风险。展望将来，期望全链路压测能在更多领域发挥作用：线上环境的故障注入和故障演练；线上灰度发布环境的正确性验证；线上系统的容量预估等。 福利 扫描添加小编微信，备注“姓名+公司职位”，加入【云计算学习交流群】，和志同道合的朋友们共同打卡学习！ 推荐阅读： VMware竟然出了一款防火墙 OpenStack网络的下一步原来这么走 | 技术头条 你的 AI 老师已上岗 要成为年薪百万的技术大牛必经历这5个阶段, 收好这份超实用的技术进阶指南 | 技术头条 助力 Android 抗衡 iOS，华为发布方舟编译器！ 程序员的黑砖窑，东南亚博彩骗局详解 售价910元！周志华等人英文新书《演化学习》出炉！ 真香，朕在看了！" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"戳蓝字“CSDN云计算”关注我们哦！ 技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！ 作者：张晓庆 转自：Java架构沉思录 滴滴出行创立于 2012 年，是全球领先的一站式多元化出行平台。经历过各种烧钱补贴大战、多次合并，滴滴成为继阿里之后，国内第二个日订单量超过千万的公司。 业务飞速增长，IT 系统面临的挑战通常更甚于业务，因为不仅需求规模增加，技术人员数量增加，面临问题的复杂度也增加： 2016 年的滴滴，正在经历这样的阶段，一方面日单量从百万冲到千万，另一方面 IT 系统屡次出现线上故障，稳定性建设成为支撑业务发展的重要保障。在此背景下，滴滴启动了全链路压测项目。 一、压测方案 滴滴的业务与普通电商差别较大，一次典型的用户打车流程是这样的：乘客发单，0-3 分钟内派给附近的司机，司机抢单后，去接乘客，到达目的地。这不但要求司乘的位置相近，而且交易必须是实时的。 基于滴滴业务的特殊性，同时借鉴了业内的经验，我们制定了滴滴的全链路压测方案，一句话描述就是：在线上环境，针对全业务核心链路，以数据隔离的方式进行压测，如下图表示： 线上环境 基于阿里等公司之前的经验，压测在线上环境进行，线上最大的优点就是环境真实，不需要担心配置不一致、结果是否可以同比例放大等问题，压测的结果自然也更为精确。但在线上做压测，需要保证安全性，风险不言而喻：不能搞垮线上系统。压测的时间窗口限定在低峰期；监控必须给力，在系统出现单点故障前，要能够提前预警，万一真的出现故障，必须紧急停止压力，最短时间内进行恢复。 全业务核心链路 支持出租车、专车快车、顺风车等几个主要的业务线，覆盖主要的业务场景，以出租车为例，从乘客打开 App 输入上车点、目的地、发单，到司机出车、抢单、接乘客上车、到达目的地，甚至取消订单等完整流程： 数据隔离 压测方案的核心是数据隔离，压测司乘要与真实司乘区分，压测订单不能与真实订单混淆，绝不能把真实乘客的单派给虚拟司机等问题。下面将专门介绍压测的数据隔离方案。 数据隔离方案 与其谈隔离方案，不如让我们想象几种数据隔离不好的场景： 某真实司机的历史订单突然多了一些假订单，积分、券、余额等出错； 某真实乘客的订单被派给了虚拟司机，乘客一直在等待司机来接； 某城市的 BI 报表出错，莫名其妙的多了一些订单，貌似财务也对不上； 某城市的运力估计及动调出现异常波动； 清理虚拟订单及相关数据时，不小心误删了真实订单和数据...... 虚拟订单方案 隔离不好的场景，光是想想就不寒而栗，可以让我们轻易排除这种看似最简单的方案：使用真实司机乘客，发送虚拟订单。虚拟订单通过 ID 或者标志字段进行区分，派单时做特殊处理。这种方式对业务有较大的侵入性，不仅是修改派单那么简单，还需要从各个维度适时地屏蔽司乘与虚拟订单的关系，如订单历史、通知推送、积分统计等，不但多而且是强依赖，显然不是一种合理的方案。 提升虚拟的层次 每个城市启用一批虚拟的乘客，发送虚拟订单，派发给虚拟司机，司乘及订单上通过 ID 或者标志字段进行区分。这可以解决司乘及订单强依赖的问题。但从城市的角度看，需要隔离真实司乘与虚拟司乘，又会涉及到城市的动态调价、供需预测、BI 统计等各个方面的隔离。 再提升虚拟的层次 与传统电商不同，Uber、滴滴这样的出行平台，都是按城市运营的，通过配置的方式开城，从而实现业务的横向快速扩展。那有没有可能在中国开辟一个甚至多个虚拟的城市呢，压测只在虚拟城市进行呢？开辟虚拟城市，可以避免前面提到的诸多问题，尤其是隔离问题，但需要考虑虚拟乘客发布路线、虚拟司机地图导航的问题，城市的位置、道路怎么模拟？干脆再进一步，虚拟一个完整的中国了，看似比较疯狂，但这就是滴滴全链路压测时的隔离方案： 在某虚拟国家，有很多虚拟的城市，每个虚拟城市都有一群虚拟的司机和乘客，他们使用虚拟的手机号和客户端，进行线上交易，由此产生了虚拟的订单。 仍然要解决位置、道路的问题，我们把中国的坐标全部偏移到太平洋，“太平洋足够大，完全容得下中美两个国家”，那一个中国自然不再话下。虚拟城市的位置、道路，把真实城市偏移一定的经纬度就可以。 压测流量标记方案 考虑这样的场景：在新开辟的虚拟城市，某虚拟的乘客要打车，他打开虚拟的手机端，输入目的地，点击「立即预约」，请求发送到滴滴的后台系统，后台应该怎么样处理？谈论方案之前，不如先了解一下现状： 传说有一种系统叫别人家的系统，有一个语言叫别人家的语言，有一种协议叫别人家的协议，正所谓人比人气死人，回头看看自己家的，虽然与很多前辈不敢相提并论，但已号称四大语言八大框架，这个锅得让历史遗留问题来背，而这段历史，只有短短的几年而已。 也有好消息，与 google 的 dapper、阿里的鹰眼类似，滴滴内部有一套自己的 trace 系统，专门用来跟踪系统之间调用链路，其基本原理如下图所示： 但并不全是好消息，全链路压测启动的时候，Trace 系统在滴滴内部并未完全推广，不少系统不支持。压测流量标记方案面临两重选择： 每个系统使用业务 ID 或标记来判断压测流量，只要能拿到司乘、订单等业务数据，系统就可以正确区分； 扩展 Trace 通路，在通路上添加压测标记，统一使用 Trace 来判断压测流量。 最终我们选择了方案 2，不但与业务完全解耦，还可以避免方案 1 中某些系统或接口无法拿到业务标记的情况。而且这种方式，客观上也可以推进 Trace 通路在公司的应用。 做不到语言和框架收敛，尽量让中间件收敛，为每种语言提供一个基础组件类库，中间件尽量收敛到该类库。 二、工具端方案 链路已通，该考虑工具端的实现方案了，内部我们管工具端叫做虚拟的「司机端」和「乘客端」，可以用来模拟批量甚至大量的用户，而不仅仅是一个用户。 分布式的虚拟司乘端 滴滴的客户端与后台通信，不仅仅有 HTTP 协议，还有 TCP 长连接，甚至还有 Thrift 协议。拿司机来说，接单等消息是通过 TCP 长连接下发的，意味着 TCP 长连接协议是必须的，而且需要为每个司机维护一个长连接。 考虑到需要模拟的司乘数量，虚拟的司机端、乘客端是分布式部署的，每个司乘端从数据中心获取司乘用户，包含基本信息、乘客路线、司机起始位置等信息，并且模拟批量司乘的发单等行为。使用数据中心的目的是，当端需要扩展时，拉取的司乘不能重复，不然重复登录可能导致被踢下线。 可动态调整的业务模型 虚拟端要模拟相对复杂、实时的交易模型，并且需要模拟不同的业务场景，以顺风车举例，平日高峰期的订单多为市内订单，而节假日的跨城订单比率增加很多。如何在不改代码的情况下可以压测不同的业务场景？我们实现了可动态调整的业务模型。 该模型中，司乘基本的交易过程、状态变化可以通过模型编辑完成，通过权重，可以调整用户本地单、跨城单的比例。即使更多的业务场景，只需生成业务模型即可支持。 更多实现细节 当然除了上面提到的，方案上还有很多细节需要考虑。为了与线上实际场景更贴近，我们从线上高峰期截取了一段时间内的乘客路线和司机位置，分阶段压测时，逐渐投放更多的司乘到虚拟城市，但这样有一个问题。 假设 A 城市有 1 万司机，高峰期有 1 万乘客在发单，他们都是随机而均匀分布的，如果把全部司机瞬间投放完成，所有乘客立即发单，绝大多数订单应该是可以派出并完成交易的。 但是考虑分阶段投放的场景：投放 1% 的司乘，上百名司机，上百个订单，虽然司机位置、乘客路线来自线上真实订单的采样，由于位置的随机性，成单量可能很少。即使投放了 10%，上千名司乘，实际成单量也远远达不到 1000个。 而我们分阶段投放要求的 10%，不光是投放数量达到线上 10%，也期望成单量等数据同步达到 10%，这样才能验证工具端方案是否合理、线上压力是否正常。 在这里，我们采用了一个简单的算法：东单是北京的一个热点区域，第一个司机、乘客投放在东单，基本上可以保证成单；前 1000 名司机、乘客投放在东单附近，成单量虽不能上千，但比完全随机要好很多。控制好司乘投放的位置，基本可以保证成单量与投放数量成比例增长。 三、压测实录 2016 年上半年是滴滴 Uber 合并前最后的疯狂，运营活动频繁，业务峰值不断攀升，平台出现的线上事故也较为多些。 从 2016 年中项目启动，经过多次尝试、探索，终于在线上成功进行了全链路压测。为了不影响线上业务，压测的窗口期选择在凌晨，并且严格掌控压测节奏，把压测过程划分成几个不同阶段，逐渐提升压力，边压测边监控后台系统的压力： 几个主要的业务线先后进行了十余次压测，并发现一些线上问题，如某 API 接口耗时明显增长；长连接服务器的参数配置有误；分单服务 codis 访问超时；日志过多导致分单算法超时等。 除了验证线上系统的稳定性，全链路压测项目还带来一些附加的收益： 不同语言下的基础组件类库趋向收敛，Trace 通道覆盖了更多模块。 建立了一套完整隔离的线上环境，未来可以在线上做更多正确性验证。 现在的滴滴，越来越重视平台稳定性，对事故的预警、降级处理和事故处理预案越来越成熟，事故时长也明显缩短，但仍然存在单点故障、鲁棒性不高等潜在风险。展望将来，期望全链路压测能在更多领域发挥作用：线上环境的故障注入和故障演练；线上灰度发布环境的正确性验证；线上系统的容量预估等。 福利 扫描添加小编微信，备注“姓名+公司职位”，加入【云计算学习交流群】，和志同道合的朋友们共同打卡学习！ 推荐阅读： VMware竟然出了一款防火墙 OpenStack网络的下一步原来这么走 | 技术头条 你的 AI 老师已上岗 要成为年薪百万的技术大牛必经历这5个阶段, 收好这份超实用的技术进阶指南 | 技术头条 助力 Android 抗衡 iOS，华为发布方舟编译器！ 程序员的黑砖窑，东南亚博彩骗局详解 售价910元！周志华等人英文新书《演化学习》出炉！ 真香，朕在看了！","@type":"BlogPosting","url":"/2019/04/29/729048.html","headline":"滴滴全链路压测解决之道 技术头条","dateModified":"2019-04-29T00:00:00+08:00","datePublished":"2019-04-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/04/29/729048.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>滴滴全链路压测解决之道 | 技术头条</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <h2 style="max-width: 100%;letter-spacing: 0.544px;text-align: right;box-sizing: border-box !important;word-wrap: break-word !important;" data-mpa-powered-by="yiban.io"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(171, 25, 66);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.544px;color: rgb(121, 121, 121);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">戳蓝字“</span></strong></span><span style="max-width: 100%;color: rgb(0, 128, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.544px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">CSDN云计算</span></strong></span><span style="max-width: 100%;color: rgb(171, 25, 66);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.544px;color: rgb(121, 121, 121);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">”关注我们哦！</span></strong></span></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></h2> 
<p style="max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="rich_pages " data-copyright="0" data-ratio="0.5482233502538071" data-s="300,640" data-type="jpeg" data-w="591" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28TMMjia6HHic2aB1eHxk4pvRhnosrU5V0wlxcJ04KaicfRjMxkIJNEOlM4O51TrEsxDES073zLtMiaPpw/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 591px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28TMMjia6HHic2aB1eHxk4pvRhnosrU5V0wlxcJ04KaicfRjMxkIJNEOlM4O51TrEsxDES073zLtMiaPpw/640?wx_fmt=jpeg"></p> 
<section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box;line-height: 30px;letter-spacing: 0.54px;font-size: 15px;word-wrap: break-word !important;"> 
 <section style="max-width: 100%;box-sizing: border-box;word-wrap: break-word !important;"> 
  <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box;line-height: 30px;letter-spacing: 0.54px;word-wrap: break-word !important;"> 
    <section style="max-width: 100%;box-sizing: border-box;word-wrap: break-word !important;"> 
     <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
      <section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box;line-height: 30px;letter-spacing: 0.54px;word-wrap: break-word !important;"> 
       <section style="max-width: 100%;box-sizing: border-box;word-wrap: break-word !important;"> 
        <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
         <blockquote style="color: rgba(0, 0, 0, 0.498);max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
          <p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.54px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！</span></strong></p> 
         </blockquote> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">作者：张晓庆</span></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">转自：Java架构沉思录</span></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><br></span></p> 
<section class="" data-color="rgb(0, 169, 113)" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">滴滴出行创立于 2012 年，是全球领先的一站式多元化出行平台。经历过各种烧钱补贴大战、多次合并，滴滴成为继阿里之后，国内第二个日订单量超过千万的公司。</span></p> 
   <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
   <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">业务飞速增长，IT 系统面临的挑战通常更甚于业务，因为不仅需求规模增加，技术人员数量增加，面临问题的复杂度也增加：</span></p> 
  </section> 
 </section> 
 <br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
</section> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="png" data-w="614" data-src="https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1x5VZ9WlNT6jicpYgic9A1uiaHMxcUtf84woTjiaibokPrBaSsh6Bhvj3icqzw/640?wx_fmt=png" style="box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1x5VZ9WlNT6jicpYgic9A1uiaHMxcUtf84woTjiaibokPrBaSsh6Bhvj3icqzw/640?wx_fmt=png"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">2016 年的滴滴，正在经历这样的阶段，一方面日单量从百万冲到千万，另一方面 IT 系统屡次出现线上故障，稳定性建设成为支撑业务发展的重要保障。在此背景下，滴滴启动了全链路压测项目。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<section class="" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section data-component-id="3lWPJ84" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <span style="max-width: 100%;color: rgb(61, 167, 66);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">一、压测方案</span></strong></span> 
    </section> 
    <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">滴滴的业务与普通电商差别较大，一次典型的用户打车流程是这样的：乘客发单，0-3 分钟内派给附近的司机，司机抢单后，去接乘客，到达目的地。这不但要求司乘的位置相近，而且交易必须是实时的。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">基于滴滴业务的特殊性，同时借鉴了业内的经验，我们制定了滴滴的全链路压测方案，一句话描述就是：在线上环境，针对全业务核心链路，以数据隔离的方式进行压测，如下图表示：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="png" data-w="1022" data-src="https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xsmopcFTYkXNBk1lpPIW8hbdhKZvHpWaP5B9opIicibGtKguWmkhS5NicQ/640?wx_fmt=png" style="box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xsmopcFTYkXNBk1lpPIW8hbdhKZvHpWaP5B9opIicibGtKguWmkhS5NicQ/640?wx_fmt=png"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">线上环境</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">基于阿里等公司之前的经验，压测在线上环境进行，线上最大的优点就是环境真实，不需要担心配置不一致、结果是否可以同比例放大等问题，压测的结果自然也更为精确。但在线上做压测，需要保证安全性，风险不言而喻：不能搞垮线上系统。压测的时间窗口限定在低峰期；监控必须给力，在系统出现单点故障前，要能够提前预警，万一真的出现故障，必须紧急停止压力，最短时间内进行恢复。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">全业务核心链路</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">支持出租车、专车快车、顺风车等几个主要的业务线，覆盖主要的业务场景，以出租车为例，从乘客打开 App 输入上车点、目的地、发单，到司机出车、抢单、接乘客上车、到达目的地，甚至取消订单等完整流程：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="png" data-w="568" data-src="https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xWiadmVslsGMwoZGHeQ3xyCLW1x2uWSvB0W9fcGw7q6eXZxyhcHPZQIQ/640?wx_fmt=png" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xWiadmVslsGMwoZGHeQ3xyCLW1x2uWSvB0W9fcGw7q6eXZxyhcHPZQIQ/640?wx_fmt=png"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">数据隔离</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">压测方案的核心是数据隔离，压测司乘要与真实司乘区分，压测订单不能与真实订单混淆，绝不能把真实乘客的单派给虚拟司机等问题。下面将专门介绍压测的数据隔离方案。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">数据隔离方案</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">与其谈隔离方案，不如让我们想象几种数据隔离不好的场景：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">某真实司机的历史订单突然多了一些假订单，积分、券、余额等出错；</span></p></li> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">某真实乘客的订单被派给了虚拟司机，乘客一直在等待司机来接；</span></p></li> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">某城市的 BI 报表出错，莫名其妙的多了一些订单，貌似财务也对不上；</span></p></li> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">某城市的运力估计及动调出现异常波动；</span></p></li> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">清理虚拟订单及相关数据时，不小心误删了真实订单和数据......</span></p></li> 
</ul> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">虚拟订单方案</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">隔离不好的场景，光是想想就不寒而栗，可以让我们轻易排除这种看似最简单的方案：使用真实司机乘客，发送虚拟订单。虚拟订单通过 ID 或者标志字段进行区分，派单时做特殊处理。这种方式对业务有较大的侵入性，不仅是修改派单那么简单，还需要从各个维度适时地屏蔽司乘与虚拟订单的关系，如订单历史、通知推送、积分统计等，不但多而且是强依赖，显然不是一种合理的方案。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">提升虚拟的层次</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">每个城市启用一批虚拟的乘客，发送虚拟订单，派发给虚拟司机，司乘及订单上通过 ID 或者标志字段进行区分。这可以解决司乘及订单强依赖的问题。但从城市的角度看，需要隔离真实司乘与虚拟司乘，又会涉及到城市的动态调价、供需预测、BI 统计等各个方面的隔离。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">再提升虚拟的层次</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">与传统电商不同，Uber、滴滴这样的出行平台，都是按城市运营的，通过配置的方式开城，从而实现业务的横向快速扩展。那有没有可能在中国开辟一个甚至多个虚拟的城市呢，压测只在虚拟城市进行呢？开辟虚拟城市，可以避免前面提到的诸多问题，尤其是隔离问题，但需要考虑虚拟乘客发布路线、虚拟司机地图导航的问题，城市的位置、道路怎么模拟？干脆再进一步，虚拟一个完整的中国了，看似比较疯狂，但这就是滴滴全链路压测时的隔离方案：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">在某虚拟国家，有很多虚拟的城市，每个虚拟城市都有一群虚拟的司机和乘客，他们使用虚拟的手机号和客户端，进行线上交易，由此产生了虚拟的订单。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1x9fiaUtmlOe9TgUsnKuuyrPGyqO7icLl7N1xB4odxCic8aXempBk5eB5xA/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1x9fiaUtmlOe9TgUsnKuuyrPGyqO7icLl7N1xB4odxCic8aXempBk5eB5xA/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">仍然要解决位置、道路的问题，我们把中国的坐标全部偏移到太平洋，“太平洋足够大，完全容得下中美两个国家”，那一个中国自然不再话下。虚拟城市的位置、道路，把真实城市偏移一定的经纬度就可以。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">压测流量标记方案</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">考虑这样的场景：在新开辟的虚拟城市，某虚拟的乘客要打车，他打开虚拟的手机端，输入目的地，点击「立即预约」，请求发送到滴滴的后台系统，后台应该怎么样处理？谈论方案之前，不如先了解一下现状：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xUVHA816glY4SxtkcN25HmSZQBDicmQ3KQb2Y6EjZNKb7f5VuK2QLIRw/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xUVHA816glY4SxtkcN25HmSZQBDicmQ3KQb2Y6EjZNKb7f5VuK2QLIRw/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">传说有一种系统叫别人家的系统，有一个语言叫别人家的语言，有一种协议叫别人家的协议，正所谓人比人气死人，回头看看自己家的，虽然与很多前辈不敢相提并论，但已号称四大语言八大框架，这个锅得让历史遗留问题来背，而这段历史，只有短短的几年而已。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">也有好消息，与 google 的 dapper、阿里的鹰眼类似，滴滴内部有一套自己的 trace 系统，专门用来跟踪系统之间调用链路，其基本原理如下图所示：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xNz3KJxa5ILUeLm2wzmQrHmxeFnqyjJS61B3loIv2e40ac57j9JCRdQ/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xNz3KJxa5ILUeLm2wzmQrHmxeFnqyjJS61B3loIv2e40ac57j9JCRdQ/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">但并不全是好消息，全链路压测启动的时候，Trace 系统在滴滴内部并未完全推广，不少系统不支持。压测流量标记方案面临两重选择：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">每个系统使用业务 ID 或标记来判断压测流量，只要能拿到司乘、订单等业务数据，系统就可以正确区分；</span></p></li> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">扩展 Trace 通路，在通路上添加压测标记，统一使用 Trace 来判断压测流量。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></span></p></li> 
</ul> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">最终我们选择了方案 2，不但与业务完全解耦，还可以避免方案 1 中某些系统或接口无法拿到业务标记的情况。而且这种方式，客观上也可以推进 Trace 通路在公司的应用。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">做不到语言和框架收敛，尽量让中间件收敛，为每种语言提供一个基础组件类库，中间件尽量收敛到该类库。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="png" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xBujvxUCNmcyuiaWuuPeuia1mRDJlvSW6iaF9HbyApGsMyx5ARU6VibQWFw/640?wx_fmt=png" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xBujvxUCNmcyuiaWuuPeuia1mRDJlvSW6iaF9HbyApGsMyx5ARU6VibQWFw/640?wx_fmt=png"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<section data-tools="135编辑器" data-id="90150" data-color="rgb(0, 169, 113)" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section data-width="100%" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <section data-component-id="3lWPJ84" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
      <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></section> 
      <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
       <span style="max-width: 100%;color: rgb(61, 167, 66);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">二、工具端方案</span></strong></span> 
      </section> 
      <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">链路已通，该考虑工具端的实现方案了，内部我们管工具端叫做虚拟的「司机端」和「乘客端」，可以用来模拟批量甚至大量的用户，而不仅仅是一个用户。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">分布式的虚拟司乘端</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">滴滴的客户端与后台通信，不仅仅有 HTTP 协议，还有 TCP 长连接，甚至还有 Thrift 协议。拿司机来说，接单等消息是通过 TCP 长连接下发的，意味着 TCP 长连接协议是必须的，而且需要为每个司机维护一个长连接。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">考虑到需要模拟的司乘数量，虚拟的司机端、乘客端是分布式部署的，每个司乘端从数据中心获取司乘用户，包含基本信息、乘客路线、司机起始位置等信息，并且模拟批量司乘的发单等行为。使用数据中心的目的是，当端需要扩展时，拉取的司乘不能重复，不然重复登录可能导致被踢下线。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xiaj6uS2ZXSqDH40wgBl3znbWxCLSBKplvUvrjb9xpEHaiac6WDxghgGQ/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xiaj6uS2ZXSqDH40wgBl3znbWxCLSBKplvUvrjb9xpEHaiac6WDxghgGQ/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">可动态调整的业务模型</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">虚拟端要模拟相对复杂、实时的交易模型，并且需要模拟不同的业务场景，以顺风车举例，平日高峰期的订单多为市内订单，而节假日的跨城订单比率增加很多。如何在不改代码的情况下可以压测不同的业务场景？我们实现了可动态调整的业务模型。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xkiaXWYpoTusqsjUzMN0w9TZXf3HDL0kGGwlk2HnbJLKtJ7pxibJEh1SA/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xkiaXWYpoTusqsjUzMN0w9TZXf3HDL0kGGwlk2HnbJLKtJ7pxibJEh1SA/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">该模型中，司乘基本的交易过程、状态变化可以通过模型编辑完成，通过权重，可以调整用户本地单、跨城单的比例。即使更多的业务场景，只需生成业务模型即可支持。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">更多实现细节</span></strong></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">当然除了上面提到的，方案上还有很多细节需要考虑。为了与线上实际场景更贴近，我们从线上高峰期截取了一段时间内的乘客路线和司机位置，分阶段压测时，逐渐投放更多的司乘到虚拟城市，但这样有一个问题。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">假设 A 城市有 1 万司机，高峰期有 1 万乘客在发单，他们都是随机而均匀分布的，如果把全部司机瞬间投放完成，所有乘客立即发单，绝大多数订单应该是可以派出并完成交易的。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">但是考虑分阶段投放的场景：投放 1% 的司乘，上百名司机，上百个订单，虽然司机位置、乘客路线来自线上真实订单的采样，由于位置的随机性，成单量可能很少。即使投放了 10%，上千名司乘，实际成单量也远远达不到 1000个。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xcVvKaBODa6CGNBFPhRVpnyOkwFxiaicIFwlDAicvW0zPJNhLX8RjECticA/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xcVvKaBODa6CGNBFPhRVpnyOkwFxiaicIFwlDAicvW0zPJNhLX8RjECticA/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">而我们分阶段投放要求的 10%，不光是投放数量达到线上 10%，也期望成单量等数据同步达到 10%，这样才能验证工具端方案是否合理、线上压力是否正常。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">在这里，我们采用了一个简单的算法：东单是北京的一个热点区域，第一个司机、乘客投放在东单，基本上可以保证成单；前 1000 名司机、乘客投放在东单附近，成单量虽不能上千，但比完全随机要好很多。控制好司乘投放的位置，基本可以保证成单量与投放数量成比例增长。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="476" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xD3lRSDITT8hPxW1srEv78TDEZ1oqViaXJv5uqpEHJo5wIzfrqjyS2HQ/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xD3lRSDITT8hPxW1srEv78TDEZ1oqViaXJv5uqpEHJo5wIzfrqjyS2HQ/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<section data-tools="135编辑器" data-id="90150" data-color="rgb(0, 169, 113)" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section data-width="100%" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <section data-component-id="3lWPJ84" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
      <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
       <span style="max-width: 100%;color: rgb(61, 167, 66);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">三、压测实录</span></strong></span> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
  <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
  <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">2016 年上半年是滴滴 Uber 合并前最后的疯狂，运营活动频繁，业务峰值不断攀升，平台出现的线上事故也较为多些。</span></p> 
  <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
 </section> 
</section> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xz5s3tgCDHDBwXVqVGJGN2Tvd2x8icYibjKxz3NUXZSkYKcsSpfyRKkibw/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xz5s3tgCDHDBwXVqVGJGN2Tvd2x8icYibjKxz3NUXZSkYKcsSpfyRKkibw/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">从 2016 年中项目启动，经过多次尝试、探索，终于在线上成功进行了全链路压测。为了不影响线上业务，压测的窗口期选择在凌晨，并且严格掌控压测节奏，把压测过程划分成几个不同阶段，逐渐提升压力，边压测边监控后台系统的压力：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;text-align: center;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.66796875" data-type="jpeg" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xKCzjZ0553Guk1Qm7T46BeVh9hrAxhl2NJx5zqMdoxcZCnHkJ80SASA/640?wx_fmt=jpeg" style="vertical-align: middle;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/hmJJR7OXeU14gOKiasPxHmO4vLIDswib1xKCzjZ0553Guk1Qm7T46BeVh9hrAxhl2NJx5zqMdoxcZCnHkJ80SASA/640?wx_fmt=jpeg"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">几个主要的业务线先后进行了十余次压测，并发现一些线上问题，如某 API 接口耗时明显增长；长连接服务器的参数配置有误；分单服务 codis 访问超时；日志过多导致分单算法超时等。</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">除了验证线上系统的稳定性，全链路压测项目还带来一些附加的收益：</span></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">不同语言下的基础组件类库趋向收敛，Trace 通道覆盖了更多模块。</span></p></li> 
 <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">建立了一套完整隔离的线上环境，未来可以在线上做更多正确性验证。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></span></p></li> 
</ul> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;line-height: 27.2px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">现在的滴滴，越来越重视平台稳定性，对事故的预警、降级处理和事故处理预案越来越成熟，事故时长也明显缩短，但仍然存在单点故障、鲁棒性不高等潜在风险。展望将来，期望全链路压测能在更多领域发挥作用：线上环境的故障注入和故障演练；线上灰度发布环境的正确性验证；线上系统的容量预估等。</span></p> 
<p><br></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 27.2px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 27.2px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-copyright="0" data-ratio="0.04523809523809524" data-s="300,640" data-type="png" data-w="420" data-src="https://mmbiz.qpic.cn/mmbiz_png/1hReHaqafafJYoFH7OAhmUdTjo35vvJTy1lRVjG2CzFP3arfVRDqI7a8PSS6Sx5LialaFTE1HFu2N4OIhL8jP9g/640?wx_fmt=png" style="letter-spacing: 0.544px;line-height: 29.75px;box-sizing: border-box !important;word-wrap: break-word !important;width: 420px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/1hReHaqafafJYoFH7OAhmUdTjo35vvJTy1lRVjG2CzFP3arfVRDqI7a8PSS6Sx5LialaFTE1HFu2N4OIhL8jP9g/640?wx_fmt=png"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 27.2px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 1.4;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="padding: 0.2em 0.5em;max-width: 100%;border-radius: 0.3em;color: white;font-size: 1em;font-family: inherit;font-weight: inherit;text-align: inherit;text-decoration: inherit;background-color: rgb(255, 105, 31);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">福利</span></strong></p> 
<section class="" style="margin-top: -0.7em;max-width: 100%;font-size: 1em;letter-spacing: 0.544px;line-height: 27.2px;border-width: 1px;border-style: solid;border-color: rgb(255, 105, 31);border-radius: 0.4em;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
 <section style="padding: 1.4em 1em 1em;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
  <section style="max-width: 100%;font-size: 1em;font-family: inherit;text-align: inherit;text-decoration: inherit;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
   <p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">扫描添加小编微信，备注“</span></strong><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">姓名+公司职位</span></strong></span><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">”，加入【</span></strong><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">云计算学习交流群</span></strong></span><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">】，和志同道合的朋友们共同打卡学习！</span></strong></p> 
   <p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
   <p style="max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="rich_pages " data-copyright="0" data-ratio="1.005813953488372" data-s="300,640" data-type="jpeg" data-w="516" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28QDZW3ZeMemRs5PPyI20qxP8zicUCD67ia0kT4tk9BTQ6OaiaGTrvMQzl6sfmlRmFhKBcuibvRsxg3ktA/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 155px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28QDZW3ZeMemRs5PPyI20qxP8zicUCD67ia0kT4tk9BTQ6OaiaGTrvMQzl6sfmlRmFhKBcuibvRsxg3ktA/640?wx_fmt=jpeg"></p> 
  </section> 
 </section> 
</section> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;text-indent: 28px;font-family: arial, 宋体, sans-serif;letter-spacing: 1px;overflow-wrap: break-word;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.5px;overflow-wrap: break-word;box-sizing: border-box !important;word-wrap: break-word !important;">推荐阅读：</span></strong></p> 
<ul class=" list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;"> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827174&amp;idx=2&amp;sn=4f88b8e74b46cba88417d428a67240af&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">VMware竟然出了一款防火墙</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827174&amp;idx=1&amp;sn=c9e9045a7d8bfb547ee08424e64ea073&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">OpenStack网络的下一步原来这么走 | 技术头条</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MDA4NDkxMQ==&amp;mid=2247483862&amp;idx=1&amp;sn=17a6e29b14b3a32ee54745ffb1526b4f&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">你的 AI 老师已上岗</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247494382&amp;idx=1&amp;sn=c52199e337caaf1c8d2ac8f6e47ffd40&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">要成为年薪百万的技术大牛必经历这5个阶段, 收好这份超实用的技术进阶指南 | 技术头条</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718298&amp;idx=1&amp;sn=e1d6e4ac62ffb6ba1b3699126ed1114a&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">助力 Android 抗衡 iOS，华为发布方舟编译器！</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzA5MzY4NTQwMA==&amp;mid=2651010270&amp;idx=1&amp;sn=8eaff3374818df60301b9a792579b49b&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">程序员的黑砖窑，东南亚博彩骗局详解</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzI0ODcxODk5OA==&amp;mid=2247504435&amp;idx=1&amp;sn=0786d6ddcaa81d2076217ec6561d32fa&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">售价910元！周志华等人英文新书《演化学习》出炉！</a></span></h2></li> 
</ul> 
<section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;font-size: 15px;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
      <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
       <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
        <section style="max-width: 100%;text-align: right;box-sizing: border-box !important;word-wrap: break-word !important;"> 
         <br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
        </section> 
        <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
         <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
          <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
           <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
            <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
             <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
              <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
               <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                <section style="max-width: 100%;text-align: right;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                 <section style="margin-top: -6.4px;margin-left: -16px;max-width: 197px;font-family: 微软雅黑;font-size: 16px;letter-spacing: 0.544px;line-height: 25.6px;float: right;transform: matrix(1, 0, 0, 1, 0, 0);width: 16px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                  <img class="" data-ratio="1" data-type="png" data-w="23" data-width="100%" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAujO0pvtNCLzZCiaWxGBfq2xaPwze1NRLTSQZYbzWNnTJwDwsReHiam91Wojzvw3RLibjicWkLWJjicgsvw/640?wx_fmt=png" style="max-width: 16px;display: block;box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: 15.99px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAujO0pvtNCLzZCiaWxGBfq2xaPwze1NRLTSQZYbzWNnTJwDwsReHiam91Wojzvw3RLibjicWkLWJjicgsvw/640?wx_fmt=png"> 
                 </section> 
                 <section data-brushtype="text" style="padding: 10px 16px;max-width: 197px;font-family: 微软雅黑;font-size: 16px;line-height: 25.6px;border-radius: 10px;color: rgb(73, 73, 72);display: inline-block;font-weight: 700;letter-spacing: 1.5px;text-align: center;background: none 0% 0% / auto repeat scroll padding-box border-box rgb(253, 245, 13);box-sizing: border-box !important;word-wrap: break-word !important;"> 
                  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">真香，朕在看了！</span> 
                 </section> 
                </section> 
               </section> 
              </section> 
             </section> 
            </section> 
           </section> 
          </section> 
         </section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

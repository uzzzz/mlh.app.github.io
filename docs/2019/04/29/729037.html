<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>深入浅出Docker 镜像   技术头条 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="深入浅出Docker 镜像   技术头条" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="戳蓝字“CSDN云计算”关注我们哦！ 技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！ 作为云计算的当红明星Docker&nbsp;来势汹汹,它就像一场森林大火，烧到了我们中间。因为工作的原因，每天都会和容器云打交道。但是，我发现经常会有些新加入的同事在理解Docker命令方面存在一些问题，尤其是在Docker 镜像底层的工作原理和容器与容器镜像的关系上。 通常情况下一项新的技术诞生时往往会伴随着较多的媒体宣传甚至炒作，且在推广产品的过程中往往会出现一些新的技术名词，让人感觉云里雾里。Docker 的诞生和推广正是在这种情况下进行的。 对于产品本身而言媒体的宣传和炒作可以帮助他们快速的在市场中进行推广，但是这种宣传和炒作也会导致很多用户很难看清被宣传产品的技术的本质，不利于用户对技术的掌握，更加不利于用户对产品的深度使用。 &nbsp; 一般情况下只有真正理解了某门技术的原理才能真正掌握这一门技术，接下来才能去深入的使用这门技术。下面我们会由浅入深出的带大家了解下Docker 镜像及其相关技术的原理和本质。 &nbsp; &nbsp;容器 VS 容器镜像 &nbsp; 在说Docker 镜像的原理知识之前，我们先看下docker 容器和docker 镜像的区别，因为这部分我们后面会涉及到。 &nbsp; 简单说来，我们可以将Docker 镜像看成是Docker 容器的静态时，也可将Docker 容器看成是Docker镜像的运行时。 &nbsp; 从Docker 的官方文档来看，Docker 容器的定义和 Docker 镜像的定义几乎是相同，Docker 容器和Docker 镜像的区别主要在于docker 容器多出了一个可写层。 &nbsp; &nbsp; 容器中的进程就运行在这个可写层，这个可写层有两个状态，即运行态和退出态。当我们docker run 运行容器后，docker 容器就进入了运行态，当我们停止正在运行中的容器时，docker 容器就进入了退出态。 &nbsp; 我们将容器从运行态转为退出态时，期间发生的变更都会写入到容器的文件系统中(需要注意的是，此处不是写入到了docker 镜像中)，这方面的变化下文中我们还会再细说。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Docker 存储简介 &nbsp; 简单说来Docker 镜像就是一组只读的目录，或者叫只读的 Docker 容器模板，镜像中含有一个Docker 容器运行所需要的文件系统，所以我们说Docker 镜像是启动一个Docker 容器的基础。 &nbsp; 如果这样不是很好理解，我们可以通过一个图一起看下： 从图中可以看出除了最上面的一层为读写层之外，下面的其他的层都是只读的镜像层，并且除了最下面的一层外，其他的层都有会有一个指针指向自己下面的一层镜像。 虽然统一文件系统(union file system)技术将不同的镜像层整合成一个统一的文件系统，为构成一个完整容器镜像的层提供了一个统一的视角，隐藏了多个层的复杂性，对用户来说只存在一个文件系统，但图中的这些层并不是不能看到的，如果需要查看的话可以进入运行Docker的机器上进行查看，从这些层中可以看到Docker 内部实现的一些细节，接下来我们一起看下。 &nbsp; 一般刚接触Docker 不久的话可能会不太清楚Docker 的存储方式是怎样的，并且可能也不太清楚Docker 容器的镜像到底存储在什么路径下，比较迷茫。 &nbsp; 有些同学想了解下Docker 的镜像数据存储在什么位置，然后谷歌了下几篇博文，说是在/var/lib/docker 下有个aufs目录，结果在自己机器上进到这个路径后发现没有aufs相关的目录，然后以为是版本的问题，其实不然。 &nbsp; 以Linux服务器为例，其实Docker 的容器镜像和容器本身的数据都存放在服务器的 /var/lib/docker/ 这个路径下。不过不同的linux发行版存储方式上有差别，比如，在ubuntu发行版上存储方式为AUFS，CentOS发行版上的存储方式为device mapper。 &nbsp; /var/lib/docker 路径下的信息在不同的阶段会有变化，从笔者个人经验来看，了解这几个阶段中新增的数据以及容器与镜像的存储结构的变化非常有利于我们对Docker容器以及Docker镜像的理解。 接下来我们一起看下Docker运行后、下载镜像后、运行容器后三个阶段中Docker 存储的变化。 &nbsp; 环境信息： &nbsp; 系统发行版：CentOS7.2。 内核版本：3.10.0-327.36.1.el7.x86_64 Docker 版本：1.8 启动Docker后 &nbsp; 在此我们假设大家已经安装好了Docker环境，具体安装的过程不再赘述。 &nbsp; &nbsp;&nbsp;&nbsp;# 启动Docker 服务 &nbsp;&nbsp;&nbsp;[root@influxdb ~]# systemctl start docker &nbsp; &nbsp;&nbsp;&nbsp;# 查看/var/lib/docker路径下的文件结构 &nbsp; &nbsp;&nbsp;&nbsp;[root@localhost docker]# tree . ├── containers ├── devicemapper │&nbsp;&nbsp; ├── devicemapper │&nbsp;&nbsp; │&nbsp;&nbsp; ├── data │&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata │&nbsp;&nbsp; └── metadata │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── base │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── deviceset-metadata │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;└── transaction-metadata ├── graph ├── linkgraph.db ├── repositories-devicemapper ├── tmp ├── trust └── volumes &nbsp; 8 directories, 7 files &nbsp; 注：必须启动Docker 服务后查看，如果没有启动Docker 进程则路径/var/lib/docker 不存在。 &nbsp; 前文中我们已经提到过，CentOS发行版中Docker 服务使用的存储方式为devicemapper，所以我们从前面tree命令的结果中可以看到出现了目录devicemapper。 &nbsp; 有些同学可能会问什么是devicemapper？ &nbsp; 太阳底下无新鲜事，devicemapper 并不是伴随着Docker 才出现的，早在linux2.6版本的内核时其实就已经引入了devicemapper，且当时是作为一个很重要的技术出现的。 &nbsp; 简单说来devicemapper 就是Docker 服务的一个存储驱动，或者叫Docker 服务的存储后端。Devicemapper 其实是一个基于内核的框架，这个框架中对linux上很多的功能进行了增强，比如对linux上高级卷管理功能的增强。 Devicemapper 存储驱动将我们的每个docker镜像和docker容器都存在在自己的虚拟设备中，devicemapper的这些设备相当于我们常见的一般的写时复制快照设备的超配版本。通过上面的介绍，有些同学可能以为devicemapper 存储驱动是工作在块级别的，但是devicempper 实际是工作在文件级别的，也就是说devicemapper 存储驱动和写时复制操作都是直接操作块，而不是对文件进行操作。 &nbsp; 以上是我们关于Docker 服务的devicemapper 存储驱动的一个简单的介绍，Docker 官方文档中提供了很多的有关Docker 存储驱动的介绍，感兴趣的同学可以自行查阅。 &nbsp; 进一步的查看的话，可以看到路径/var/lib/docker/devicemapper下面有两个目录，分别为devicemapper和data，其中目录devicemapper 下存在两个名为data和metadata的文件，两个文件从名称即可看出一个是镜像数据的存储池，一个为镜像相关的元数据。接下去我们会逐个看下这个路径下的文件。 &nbsp; 进入上面提到的目录metadata下，可以看到这个目录中已经存在三个文件，分别为：base、deviceset-metadata和transction-metadata，这三个文分别用来存放上文中我们提到的元数据的id、大小和uuid等信息。 [root@localhost metadata]# pwd /var/lib/docker/devicemapper/metadata [root@localhost metadata]# ls base &nbsp;deviceset-metadata &nbsp;transaction-metadata 除了上面提到的几个目录，上文中tree的结果中还有几个目录，分别为：containers、devicemapper、graph、linkgraph.db、repositories-devicemapper、tmp、trust和volumes。这几个文件对于docker 的镜像存储来说都很重要，我们以文件repositories-devicemapper为例，看下这个文件对于镜像存储所起到的作用。 &nbsp; [root@localhost docker]# pwd /var/lib/docker [root@localhost docker]# ls containers &nbsp;devicemapper &nbsp;graph &nbsp;linkgraph.db &nbsp;repositories-devicemapper &nbsp;tmp &nbsp;trust &nbsp;volumes &nbsp; 我们可以先看下repositories-devicemapper 这个文件中在当前的阶段中有什么： root@localhost docker]# cat repositories-devicemapper {&quot;Repositories&quot;:{}}[root@localhost docker]# 从上面cat的结果中我们不难看出，文件repositories-devicemapper 中其实记录的就是docker 镜像的属性信息，比如镜像名称、镜像标签、镜像的ID等信息，如果镜像刚好没有标签的话默认会以lastet作为标签。 以上是对Docker 服务运行后pull镜像之前/var/lib/docker 路径下数据的一个简单的解读，相信大家通过上面的描述已经对docker镜像有了一些更深入的认识。下面我们看下在我们pull 自己的第一个docker镜像之后路径/var/lib/docker 之下的数据会发生怎样的变化。 &nbsp; Pull 镜像后 &nbsp; 在此我们以一个nginx镜像为例一起看下这个阶段的变化。 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;# pull 示例镜像 [root@localhost docker]# docker pull nginx Using default tag: latest latest: Pulling from library/nginx 22f3bf58cd09: Pull complete ea2fc476f5f0: Pull complete 81d728438afe: Pull complete 303a6dec1190: Pull complete d43816b44a22: Pull complete dc02db50a25a: Pull complete 6f650a34b308: Pull complete a634e96a9de9: Pull complete 72f3ebe1e4d7: Pull complete c2c9e418b22c: Pull complete Digest: sha256:a82bbaf63c445ee9b854d182254c62e34e6fa92f63d7b4fdf6cea7e76665e06e Status: Downloaded newer image for nginx:latest &nbsp; # 查看镜像是否已经在本地 [root@localhost docker]# docker images REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB [root@localhost docker]# &nbsp; 在此我们没有指定nginx镜像的tag，因此默认拉去了最新的版本。然后我们看下路径/var/lib/docker 下是否有变化： [root@localhost docker]# tree . . ├── containers ├── devicemapper │&nbsp;&nbsp; ├── devicemapper │&nbsp;&nbsp; │&nbsp;&nbsp; ├── data │&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata …… 省略若干数据 …… │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── …… 省略若干数据 …… │&nbsp;&nbsp; ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; └── _tmp ├── linkgraph.db ├── repositories-devicemapper ├── tmp ├── trust └── volumes &nbsp; 30 directories, 67 files [root@localhost docker]# &nbsp; 从结尾的目录数和文件数也可以看出，在我们拉取镜像后/var/lib/docker 下多出了很多的文件(拉取镜像之前，只有8个目录，7个文件)，下面我们一步步的分析。 &nbsp; 如果这个时候看下路径/var/lib/docker下的文件的话，可以很容易的看到发生变化的主要是下面这三个文件：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/graph。我们先看下metadata这个文件： &nbsp; &nbsp;从结果可以看出除了上一个阶段中已经有的base、deviceset-metadata等几个文件外，还多出了一些名字较长的文件，我们挨个看下这几个文件中的数据： [root@localhost metadata]# cat base {&quot;device_id&quot;:1,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:1,&quot;initialized&quot;:true} [root@localhost metadata]# cat 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3 {&quot;device_id&quot;:2,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:2,&quot;initialized&quot;:false} [root@localhost metadata]# cat ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc {&quot;device_id&quot;:3,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:3,&quot;initialized&quot;:false} &nbsp; [root@localhost metadata]# cat 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 {&quot;device_id&quot;:4,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:4,&quot;initialized&quot;:false} [root@localhost metadata]# cat d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c {&quot;device_id&quot;:6,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:6,&quot;initialized&quot;:false} [root@localhost metadata]# cat 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 {&quot;device_id&quot;:5,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:5,&quot;initialized&quot;:false} [root@localhost metadata]# cat a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 {&quot;device_id&quot;:9,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:9,&quot;initialized&quot;:false} [root@localhost metadata]# cat dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7 {&quot;device_id&quot;:7,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:7,&quot;initialized&quot;:false} [root@localhost metadata]# cat 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a {&quot;device_id&quot;:8,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:8,&quot;initialized&quot;:false} [root@localhost metadata]# cat 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 {&quot;device_id&quot;:10,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:10,&quot;initialized&quot;:false} [root@localhost metadata]# cat c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092 {&quot;device_id&quot;:11,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:11,&quot;initialized&quot;:false} &nbsp; 从上面的结果可以看出上面的几个文件中的device_id数值是按照顺序排列下来的，换句话说就是除了上一个阶段中已经存在的base文件，上面结果中其他的几个文件都是nginx镜像的中间镜像层，也就是我们经常执行的命令docker images –a 的结果中看到的构成当前镜像的各个镜像层。 &nbsp; &nbsp; 接下来我们再看一个变化较大的文件/var/lib/docker/graph。 &nbsp; &nbsp;&nbsp;[root@localhost graph]# tree . . ├── 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility └── _tmp &nbsp; 11 directories, 50 files &nbsp; &nbsp;从上面的结果中可以很明显的看到我们的镜像nginx及其每一个nginx镜像的中间层对应的目录下都包含如下几个文件：checksum、json、layerrize、tar-data.json.gz和v1Compatibility。我们任意找一个文件看下这几个文件中存放了什么数据。 &nbsp; (1)&nbsp;Checksum &nbsp; &nbsp;&nbsp;&nbsp; 其实从文件名称即可看出每个镜像层中的checksum文件存放的是当前镜像层的md5值，用于核对当前镜像层的数据是否完整。 &nbsp; (2)&nbsp;json &nbsp; &nbsp; &nbsp; &nbsp;从cat 的结果中可以看出json文件中存放的数据较多，比如Hostname、Domainname、User、Image等信息，而且很多参数和我们经常接触的Dockerfile中的参数相似。相比较前面的checksum文件这个文件中的内容相对较复杂，在此我们也解释下。 &nbsp; &nbsp; &nbsp; &nbsp;此处的json文件中一般主要用于存放镜像中涉及的动态信息，但需要注意的是此处的json文件并不仅仅被用于存储docker镜像的动态信息(很多同学可能会认为此处的json文件只是被用来描述Docker容器的动态信息的)，我们在使用Dockerfile 构建镜像时，Dockerfile 构建过程中涉及到的所有操作基本都被记录到这个json文件中。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;说到这儿，有些同学可能会问这个json是在什么阶段被使用到的，好问题。通过下面这个图我想大家应该就能看明白了： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;从图中我们可以看出每个镜像层的json文件其实是由Docker 守护进程进行解析的。Docker 守护进程通过json文件可以解析出运行容器需要的各种数据，比如环境变量、workdir以及容器启动时需要执行的ENTRYPOINT或者CMD命令等。Docker 守护进程从json文件中获取到这些数据后，接下来就开始进行容器进程的初始化。 &nbsp; (3)&nbsp;layersize &nbsp; &nbsp; &nbsp; &nbsp;从文件名称即可看出，这个文件中存放的为当前镜像层的占用空间大小： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; (4)&nbsp;repositories-devicemapper &nbsp; 上一阶段中我们解释过这个文件中记录的为当前镜像层的属性信息，比如镜像名称信息、镜像标签信息、镜像的ID信息等： &nbsp; &nbsp; 以上是对pull镜像之后运行容器之前镜像存储信息的简单介绍，相信大家在看下之后对docker容器镜像已经有了更加深入的认识。下面我们看下本文中我们要说的最后一个阶段，即运行容器后docker 的存储又发生了哪些变化。 &nbsp; 运行容器后 &nbsp; 我们运行下前面从dockerhub pull的镜像nginx:latest： [root@localhost metadata]# docker images REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB [root@localhost metadata]# [root@localhost metadata]# [root@localhost metadata]# [root@localhost metadata]# docker run --name nginx -d nginx:latest 814ec80839669e235c94978ed3d07eab0e2b2bebd7d7a64fd6488cddca51be41 [root@localhost metadata]# docker ps CONTAINER ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES 814ec8083966 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx:latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;nginx -g &#39;daemon off&quot; &nbsp;&nbsp;3 seconds ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Up 2 seconds &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;80/tcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx &nbsp; 按照惯例，然后我们看下/var/lib/docker路径下的文件结构： &nbsp; &nbsp;和上一阶段不同，这个阶段发生变化的文件主要是：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/container，下面我们逐个看下。 &nbsp; (1)&nbsp;metadata &nbsp; 我们看下metadata这个目录下的文件： &nbsp; &nbsp; 从图中的结果可以看出，相比上一个阶段，当前阶段中metadata目录下多出了两个文件，即以51be4e和51b44e-init结尾的两个文件。 &nbsp; 我们都知道docker 借助容器镜像运行起容器之后，会在当前镜像的最顶层添加一个特殊的层，和其他的层相比这个层不但有可读的权限还有可写的权限。说到这，相信多出的两个文件的功能就不难理解了。 &nbsp; (2)&nbsp;mnt &nbsp; 在查看mnt下的数据之前，我们先看下这个目录下的文件结构： &nbsp; 对比上面说过的metadata目录，发现这两个目录下的文件是一样的，相比前一个阶段的话也是新增了两个文件，即以51be4e和51b44e-init结尾的两个文件。 &nbsp; (3)&nbsp;container &nbsp; 我们先看下当前目录下的文件结构： &nbsp; &nbsp; Container目录为容器本身的目录，此目录中存放了诸如容器的配置文件等文件。如果我们删掉这个目录(docker 进程hang死导致docker rm、docker kill杀不掉容器时常用此种方式处理)的话正在运行的容器就会被删掉，我们看下这几个文件都存放了什么数据。 &nbsp; (1)&nbsp;xxx.json.log、config.json 从文件名称即可看出，这两个文件存放的为当前容器的配置信息及其数据： (2)&nbsp;hosts &nbsp; hosts配置信息，在此不再赘述。 &nbsp; (3)&nbsp;hostname 容器host名称，可以cat查看后再进入容器查看hostname，核对下看是否是一样的。 &nbsp; (4)&nbsp;resolv.conf dns配置信息。 &nbsp; &nbsp;小结 &nbsp; 前面分析了那么多涉及到docker 存储的文件，在查阅各个文件或者目录作用时可能不是很方便，在此我们给大家总结了一下各个文件的作用(每个文件都是在/var/lib/docker路径下)： &nbsp; (1)&nbsp;devicemapper/devicemapper/data 存储存储池相关的数据。 (2)&nbsp;devicemapper/devicemapper/metdata 存储元数据。 (3)&nbsp;devicemapper/metadata/ 存储device_id、layersize等信息。 (4)&nbsp;devicemapper/mnt 存储挂载相关的信息。 (5)&nbsp;container/ 存储容器本身的信息。 (6)&nbsp;graph/ 存储各个镜像层的详细信息。 (7)&nbsp;repositores-devicemapper 存储镜像的一些基本信息。 (8)&nbsp;tmp 存储docker的临时目录。 (9)&nbsp;trust 存储docker的信任目录。 (10)&nbsp;&nbsp;volumes 存储docker的卷目录。 福利 扫描添加小编微信，备注“姓名+公司职位”，加入【云计算学习交流群】，和志同道合的朋友们共同打卡学习！ 推荐阅读： 云计算之基，一文带你速懂虚拟化KVM和XEN OpenStack网络的下一步原来这么走 | 技术头条 用一枚比特币环游世界? 他是不是疯了... 程序员逆袭为美国最佳 CEO，他说因为爱情 斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年 Erlang 之父去世，他留给程序员两点忠告 开什么玩笑？股票价格如何经得起AI的推敲？| 技术头条 真香，朕在看了！" />
<meta property="og:description" content="戳蓝字“CSDN云计算”关注我们哦！ 技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！ 作为云计算的当红明星Docker&nbsp;来势汹汹,它就像一场森林大火，烧到了我们中间。因为工作的原因，每天都会和容器云打交道。但是，我发现经常会有些新加入的同事在理解Docker命令方面存在一些问题，尤其是在Docker 镜像底层的工作原理和容器与容器镜像的关系上。 通常情况下一项新的技术诞生时往往会伴随着较多的媒体宣传甚至炒作，且在推广产品的过程中往往会出现一些新的技术名词，让人感觉云里雾里。Docker 的诞生和推广正是在这种情况下进行的。 对于产品本身而言媒体的宣传和炒作可以帮助他们快速的在市场中进行推广，但是这种宣传和炒作也会导致很多用户很难看清被宣传产品的技术的本质，不利于用户对技术的掌握，更加不利于用户对产品的深度使用。 &nbsp; 一般情况下只有真正理解了某门技术的原理才能真正掌握这一门技术，接下来才能去深入的使用这门技术。下面我们会由浅入深出的带大家了解下Docker 镜像及其相关技术的原理和本质。 &nbsp; &nbsp;容器 VS 容器镜像 &nbsp; 在说Docker 镜像的原理知识之前，我们先看下docker 容器和docker 镜像的区别，因为这部分我们后面会涉及到。 &nbsp; 简单说来，我们可以将Docker 镜像看成是Docker 容器的静态时，也可将Docker 容器看成是Docker镜像的运行时。 &nbsp; 从Docker 的官方文档来看，Docker 容器的定义和 Docker 镜像的定义几乎是相同，Docker 容器和Docker 镜像的区别主要在于docker 容器多出了一个可写层。 &nbsp; &nbsp; 容器中的进程就运行在这个可写层，这个可写层有两个状态，即运行态和退出态。当我们docker run 运行容器后，docker 容器就进入了运行态，当我们停止正在运行中的容器时，docker 容器就进入了退出态。 &nbsp; 我们将容器从运行态转为退出态时，期间发生的变更都会写入到容器的文件系统中(需要注意的是，此处不是写入到了docker 镜像中)，这方面的变化下文中我们还会再细说。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Docker 存储简介 &nbsp; 简单说来Docker 镜像就是一组只读的目录，或者叫只读的 Docker 容器模板，镜像中含有一个Docker 容器运行所需要的文件系统，所以我们说Docker 镜像是启动一个Docker 容器的基础。 &nbsp; 如果这样不是很好理解，我们可以通过一个图一起看下： 从图中可以看出除了最上面的一层为读写层之外，下面的其他的层都是只读的镜像层，并且除了最下面的一层外，其他的层都有会有一个指针指向自己下面的一层镜像。 虽然统一文件系统(union file system)技术将不同的镜像层整合成一个统一的文件系统，为构成一个完整容器镜像的层提供了一个统一的视角，隐藏了多个层的复杂性，对用户来说只存在一个文件系统，但图中的这些层并不是不能看到的，如果需要查看的话可以进入运行Docker的机器上进行查看，从这些层中可以看到Docker 内部实现的一些细节，接下来我们一起看下。 &nbsp; 一般刚接触Docker 不久的话可能会不太清楚Docker 的存储方式是怎样的，并且可能也不太清楚Docker 容器的镜像到底存储在什么路径下，比较迷茫。 &nbsp; 有些同学想了解下Docker 的镜像数据存储在什么位置，然后谷歌了下几篇博文，说是在/var/lib/docker 下有个aufs目录，结果在自己机器上进到这个路径后发现没有aufs相关的目录，然后以为是版本的问题，其实不然。 &nbsp; 以Linux服务器为例，其实Docker 的容器镜像和容器本身的数据都存放在服务器的 /var/lib/docker/ 这个路径下。不过不同的linux发行版存储方式上有差别，比如，在ubuntu发行版上存储方式为AUFS，CentOS发行版上的存储方式为device mapper。 &nbsp; /var/lib/docker 路径下的信息在不同的阶段会有变化，从笔者个人经验来看，了解这几个阶段中新增的数据以及容器与镜像的存储结构的变化非常有利于我们对Docker容器以及Docker镜像的理解。 接下来我们一起看下Docker运行后、下载镜像后、运行容器后三个阶段中Docker 存储的变化。 &nbsp; 环境信息： &nbsp; 系统发行版：CentOS7.2。 内核版本：3.10.0-327.36.1.el7.x86_64 Docker 版本：1.8 启动Docker后 &nbsp; 在此我们假设大家已经安装好了Docker环境，具体安装的过程不再赘述。 &nbsp; &nbsp;&nbsp;&nbsp;# 启动Docker 服务 &nbsp;&nbsp;&nbsp;[root@influxdb ~]# systemctl start docker &nbsp; &nbsp;&nbsp;&nbsp;# 查看/var/lib/docker路径下的文件结构 &nbsp; &nbsp;&nbsp;&nbsp;[root@localhost docker]# tree . ├── containers ├── devicemapper │&nbsp;&nbsp; ├── devicemapper │&nbsp;&nbsp; │&nbsp;&nbsp; ├── data │&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata │&nbsp;&nbsp; └── metadata │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── base │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── deviceset-metadata │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;└── transaction-metadata ├── graph ├── linkgraph.db ├── repositories-devicemapper ├── tmp ├── trust └── volumes &nbsp; 8 directories, 7 files &nbsp; 注：必须启动Docker 服务后查看，如果没有启动Docker 进程则路径/var/lib/docker 不存在。 &nbsp; 前文中我们已经提到过，CentOS发行版中Docker 服务使用的存储方式为devicemapper，所以我们从前面tree命令的结果中可以看到出现了目录devicemapper。 &nbsp; 有些同学可能会问什么是devicemapper？ &nbsp; 太阳底下无新鲜事，devicemapper 并不是伴随着Docker 才出现的，早在linux2.6版本的内核时其实就已经引入了devicemapper，且当时是作为一个很重要的技术出现的。 &nbsp; 简单说来devicemapper 就是Docker 服务的一个存储驱动，或者叫Docker 服务的存储后端。Devicemapper 其实是一个基于内核的框架，这个框架中对linux上很多的功能进行了增强，比如对linux上高级卷管理功能的增强。 Devicemapper 存储驱动将我们的每个docker镜像和docker容器都存在在自己的虚拟设备中，devicemapper的这些设备相当于我们常见的一般的写时复制快照设备的超配版本。通过上面的介绍，有些同学可能以为devicemapper 存储驱动是工作在块级别的，但是devicempper 实际是工作在文件级别的，也就是说devicemapper 存储驱动和写时复制操作都是直接操作块，而不是对文件进行操作。 &nbsp; 以上是我们关于Docker 服务的devicemapper 存储驱动的一个简单的介绍，Docker 官方文档中提供了很多的有关Docker 存储驱动的介绍，感兴趣的同学可以自行查阅。 &nbsp; 进一步的查看的话，可以看到路径/var/lib/docker/devicemapper下面有两个目录，分别为devicemapper和data，其中目录devicemapper 下存在两个名为data和metadata的文件，两个文件从名称即可看出一个是镜像数据的存储池，一个为镜像相关的元数据。接下去我们会逐个看下这个路径下的文件。 &nbsp; 进入上面提到的目录metadata下，可以看到这个目录中已经存在三个文件，分别为：base、deviceset-metadata和transction-metadata，这三个文分别用来存放上文中我们提到的元数据的id、大小和uuid等信息。 [root@localhost metadata]# pwd /var/lib/docker/devicemapper/metadata [root@localhost metadata]# ls base &nbsp;deviceset-metadata &nbsp;transaction-metadata 除了上面提到的几个目录，上文中tree的结果中还有几个目录，分别为：containers、devicemapper、graph、linkgraph.db、repositories-devicemapper、tmp、trust和volumes。这几个文件对于docker 的镜像存储来说都很重要，我们以文件repositories-devicemapper为例，看下这个文件对于镜像存储所起到的作用。 &nbsp; [root@localhost docker]# pwd /var/lib/docker [root@localhost docker]# ls containers &nbsp;devicemapper &nbsp;graph &nbsp;linkgraph.db &nbsp;repositories-devicemapper &nbsp;tmp &nbsp;trust &nbsp;volumes &nbsp; 我们可以先看下repositories-devicemapper 这个文件中在当前的阶段中有什么： root@localhost docker]# cat repositories-devicemapper {&quot;Repositories&quot;:{}}[root@localhost docker]# 从上面cat的结果中我们不难看出，文件repositories-devicemapper 中其实记录的就是docker 镜像的属性信息，比如镜像名称、镜像标签、镜像的ID等信息，如果镜像刚好没有标签的话默认会以lastet作为标签。 以上是对Docker 服务运行后pull镜像之前/var/lib/docker 路径下数据的一个简单的解读，相信大家通过上面的描述已经对docker镜像有了一些更深入的认识。下面我们看下在我们pull 自己的第一个docker镜像之后路径/var/lib/docker 之下的数据会发生怎样的变化。 &nbsp; Pull 镜像后 &nbsp; 在此我们以一个nginx镜像为例一起看下这个阶段的变化。 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;# pull 示例镜像 [root@localhost docker]# docker pull nginx Using default tag: latest latest: Pulling from library/nginx 22f3bf58cd09: Pull complete ea2fc476f5f0: Pull complete 81d728438afe: Pull complete 303a6dec1190: Pull complete d43816b44a22: Pull complete dc02db50a25a: Pull complete 6f650a34b308: Pull complete a634e96a9de9: Pull complete 72f3ebe1e4d7: Pull complete c2c9e418b22c: Pull complete Digest: sha256:a82bbaf63c445ee9b854d182254c62e34e6fa92f63d7b4fdf6cea7e76665e06e Status: Downloaded newer image for nginx:latest &nbsp; # 查看镜像是否已经在本地 [root@localhost docker]# docker images REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB [root@localhost docker]# &nbsp; 在此我们没有指定nginx镜像的tag，因此默认拉去了最新的版本。然后我们看下路径/var/lib/docker 下是否有变化： [root@localhost docker]# tree . . ├── containers ├── devicemapper │&nbsp;&nbsp; ├── devicemapper │&nbsp;&nbsp; │&nbsp;&nbsp; ├── data │&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata …… 省略若干数据 …… │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── …… 省略若干数据 …… │&nbsp;&nbsp; ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; └── _tmp ├── linkgraph.db ├── repositories-devicemapper ├── tmp ├── trust └── volumes &nbsp; 30 directories, 67 files [root@localhost docker]# &nbsp; 从结尾的目录数和文件数也可以看出，在我们拉取镜像后/var/lib/docker 下多出了很多的文件(拉取镜像之前，只有8个目录，7个文件)，下面我们一步步的分析。 &nbsp; 如果这个时候看下路径/var/lib/docker下的文件的话，可以很容易的看到发生变化的主要是下面这三个文件：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/graph。我们先看下metadata这个文件： &nbsp; &nbsp;从结果可以看出除了上一个阶段中已经有的base、deviceset-metadata等几个文件外，还多出了一些名字较长的文件，我们挨个看下这几个文件中的数据： [root@localhost metadata]# cat base {&quot;device_id&quot;:1,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:1,&quot;initialized&quot;:true} [root@localhost metadata]# cat 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3 {&quot;device_id&quot;:2,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:2,&quot;initialized&quot;:false} [root@localhost metadata]# cat ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc {&quot;device_id&quot;:3,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:3,&quot;initialized&quot;:false} &nbsp; [root@localhost metadata]# cat 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 {&quot;device_id&quot;:4,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:4,&quot;initialized&quot;:false} [root@localhost metadata]# cat d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c {&quot;device_id&quot;:6,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:6,&quot;initialized&quot;:false} [root@localhost metadata]# cat 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 {&quot;device_id&quot;:5,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:5,&quot;initialized&quot;:false} [root@localhost metadata]# cat a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 {&quot;device_id&quot;:9,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:9,&quot;initialized&quot;:false} [root@localhost metadata]# cat dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7 {&quot;device_id&quot;:7,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:7,&quot;initialized&quot;:false} [root@localhost metadata]# cat 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a {&quot;device_id&quot;:8,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:8,&quot;initialized&quot;:false} [root@localhost metadata]# cat 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 {&quot;device_id&quot;:10,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:10,&quot;initialized&quot;:false} [root@localhost metadata]# cat c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092 {&quot;device_id&quot;:11,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:11,&quot;initialized&quot;:false} &nbsp; 从上面的结果可以看出上面的几个文件中的device_id数值是按照顺序排列下来的，换句话说就是除了上一个阶段中已经存在的base文件，上面结果中其他的几个文件都是nginx镜像的中间镜像层，也就是我们经常执行的命令docker images –a 的结果中看到的构成当前镜像的各个镜像层。 &nbsp; &nbsp; 接下来我们再看一个变化较大的文件/var/lib/docker/graph。 &nbsp; &nbsp;&nbsp;[root@localhost graph]# tree . . ├── 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility └── _tmp &nbsp; 11 directories, 50 files &nbsp; &nbsp;从上面的结果中可以很明显的看到我们的镜像nginx及其每一个nginx镜像的中间层对应的目录下都包含如下几个文件：checksum、json、layerrize、tar-data.json.gz和v1Compatibility。我们任意找一个文件看下这几个文件中存放了什么数据。 &nbsp; (1)&nbsp;Checksum &nbsp; &nbsp;&nbsp;&nbsp; 其实从文件名称即可看出每个镜像层中的checksum文件存放的是当前镜像层的md5值，用于核对当前镜像层的数据是否完整。 &nbsp; (2)&nbsp;json &nbsp; &nbsp; &nbsp; &nbsp;从cat 的结果中可以看出json文件中存放的数据较多，比如Hostname、Domainname、User、Image等信息，而且很多参数和我们经常接触的Dockerfile中的参数相似。相比较前面的checksum文件这个文件中的内容相对较复杂，在此我们也解释下。 &nbsp; &nbsp; &nbsp; &nbsp;此处的json文件中一般主要用于存放镜像中涉及的动态信息，但需要注意的是此处的json文件并不仅仅被用于存储docker镜像的动态信息(很多同学可能会认为此处的json文件只是被用来描述Docker容器的动态信息的)，我们在使用Dockerfile 构建镜像时，Dockerfile 构建过程中涉及到的所有操作基本都被记录到这个json文件中。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;说到这儿，有些同学可能会问这个json是在什么阶段被使用到的，好问题。通过下面这个图我想大家应该就能看明白了： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;从图中我们可以看出每个镜像层的json文件其实是由Docker 守护进程进行解析的。Docker 守护进程通过json文件可以解析出运行容器需要的各种数据，比如环境变量、workdir以及容器启动时需要执行的ENTRYPOINT或者CMD命令等。Docker 守护进程从json文件中获取到这些数据后，接下来就开始进行容器进程的初始化。 &nbsp; (3)&nbsp;layersize &nbsp; &nbsp; &nbsp; &nbsp;从文件名称即可看出，这个文件中存放的为当前镜像层的占用空间大小： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; (4)&nbsp;repositories-devicemapper &nbsp; 上一阶段中我们解释过这个文件中记录的为当前镜像层的属性信息，比如镜像名称信息、镜像标签信息、镜像的ID信息等： &nbsp; &nbsp; 以上是对pull镜像之后运行容器之前镜像存储信息的简单介绍，相信大家在看下之后对docker容器镜像已经有了更加深入的认识。下面我们看下本文中我们要说的最后一个阶段，即运行容器后docker 的存储又发生了哪些变化。 &nbsp; 运行容器后 &nbsp; 我们运行下前面从dockerhub pull的镜像nginx:latest： [root@localhost metadata]# docker images REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB [root@localhost metadata]# [root@localhost metadata]# [root@localhost metadata]# [root@localhost metadata]# docker run --name nginx -d nginx:latest 814ec80839669e235c94978ed3d07eab0e2b2bebd7d7a64fd6488cddca51be41 [root@localhost metadata]# docker ps CONTAINER ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES 814ec8083966 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx:latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;nginx -g &#39;daemon off&quot; &nbsp;&nbsp;3 seconds ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Up 2 seconds &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;80/tcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx &nbsp; 按照惯例，然后我们看下/var/lib/docker路径下的文件结构： &nbsp; &nbsp;和上一阶段不同，这个阶段发生变化的文件主要是：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/container，下面我们逐个看下。 &nbsp; (1)&nbsp;metadata &nbsp; 我们看下metadata这个目录下的文件： &nbsp; &nbsp; 从图中的结果可以看出，相比上一个阶段，当前阶段中metadata目录下多出了两个文件，即以51be4e和51b44e-init结尾的两个文件。 &nbsp; 我们都知道docker 借助容器镜像运行起容器之后，会在当前镜像的最顶层添加一个特殊的层，和其他的层相比这个层不但有可读的权限还有可写的权限。说到这，相信多出的两个文件的功能就不难理解了。 &nbsp; (2)&nbsp;mnt &nbsp; 在查看mnt下的数据之前，我们先看下这个目录下的文件结构： &nbsp; 对比上面说过的metadata目录，发现这两个目录下的文件是一样的，相比前一个阶段的话也是新增了两个文件，即以51be4e和51b44e-init结尾的两个文件。 &nbsp; (3)&nbsp;container &nbsp; 我们先看下当前目录下的文件结构： &nbsp; &nbsp; Container目录为容器本身的目录，此目录中存放了诸如容器的配置文件等文件。如果我们删掉这个目录(docker 进程hang死导致docker rm、docker kill杀不掉容器时常用此种方式处理)的话正在运行的容器就会被删掉，我们看下这几个文件都存放了什么数据。 &nbsp; (1)&nbsp;xxx.json.log、config.json 从文件名称即可看出，这两个文件存放的为当前容器的配置信息及其数据： (2)&nbsp;hosts &nbsp; hosts配置信息，在此不再赘述。 &nbsp; (3)&nbsp;hostname 容器host名称，可以cat查看后再进入容器查看hostname，核对下看是否是一样的。 &nbsp; (4)&nbsp;resolv.conf dns配置信息。 &nbsp; &nbsp;小结 &nbsp; 前面分析了那么多涉及到docker 存储的文件，在查阅各个文件或者目录作用时可能不是很方便，在此我们给大家总结了一下各个文件的作用(每个文件都是在/var/lib/docker路径下)： &nbsp; (1)&nbsp;devicemapper/devicemapper/data 存储存储池相关的数据。 (2)&nbsp;devicemapper/devicemapper/metdata 存储元数据。 (3)&nbsp;devicemapper/metadata/ 存储device_id、layersize等信息。 (4)&nbsp;devicemapper/mnt 存储挂载相关的信息。 (5)&nbsp;container/ 存储容器本身的信息。 (6)&nbsp;graph/ 存储各个镜像层的详细信息。 (7)&nbsp;repositores-devicemapper 存储镜像的一些基本信息。 (8)&nbsp;tmp 存储docker的临时目录。 (9)&nbsp;trust 存储docker的信任目录。 (10)&nbsp;&nbsp;volumes 存储docker的卷目录。 福利 扫描添加小编微信，备注“姓名+公司职位”，加入【云计算学习交流群】，和志同道合的朋友们共同打卡学习！ 推荐阅读： 云计算之基，一文带你速懂虚拟化KVM和XEN OpenStack网络的下一步原来这么走 | 技术头条 用一枚比特币环游世界? 他是不是疯了... 程序员逆袭为美国最佳 CEO，他说因为爱情 斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年 Erlang 之父去世，他留给程序员两点忠告 开什么玩笑？股票价格如何经得起AI的推敲？| 技术头条 真香，朕在看了！" />
<link rel="canonical" href="https://mlh.app/2019/04/29/729037.html" />
<meta property="og:url" content="https://mlh.app/2019/04/29/729037.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"戳蓝字“CSDN云计算”关注我们哦！ 技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！ 作为云计算的当红明星Docker&nbsp;来势汹汹,它就像一场森林大火，烧到了我们中间。因为工作的原因，每天都会和容器云打交道。但是，我发现经常会有些新加入的同事在理解Docker命令方面存在一些问题，尤其是在Docker 镜像底层的工作原理和容器与容器镜像的关系上。 通常情况下一项新的技术诞生时往往会伴随着较多的媒体宣传甚至炒作，且在推广产品的过程中往往会出现一些新的技术名词，让人感觉云里雾里。Docker 的诞生和推广正是在这种情况下进行的。 对于产品本身而言媒体的宣传和炒作可以帮助他们快速的在市场中进行推广，但是这种宣传和炒作也会导致很多用户很难看清被宣传产品的技术的本质，不利于用户对技术的掌握，更加不利于用户对产品的深度使用。 &nbsp; 一般情况下只有真正理解了某门技术的原理才能真正掌握这一门技术，接下来才能去深入的使用这门技术。下面我们会由浅入深出的带大家了解下Docker 镜像及其相关技术的原理和本质。 &nbsp; &nbsp;容器 VS 容器镜像 &nbsp; 在说Docker 镜像的原理知识之前，我们先看下docker 容器和docker 镜像的区别，因为这部分我们后面会涉及到。 &nbsp; 简单说来，我们可以将Docker 镜像看成是Docker 容器的静态时，也可将Docker 容器看成是Docker镜像的运行时。 &nbsp; 从Docker 的官方文档来看，Docker 容器的定义和 Docker 镜像的定义几乎是相同，Docker 容器和Docker 镜像的区别主要在于docker 容器多出了一个可写层。 &nbsp; &nbsp; 容器中的进程就运行在这个可写层，这个可写层有两个状态，即运行态和退出态。当我们docker run 运行容器后，docker 容器就进入了运行态，当我们停止正在运行中的容器时，docker 容器就进入了退出态。 &nbsp; 我们将容器从运行态转为退出态时，期间发生的变更都会写入到容器的文件系统中(需要注意的是，此处不是写入到了docker 镜像中)，这方面的变化下文中我们还会再细说。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Docker 存储简介 &nbsp; 简单说来Docker 镜像就是一组只读的目录，或者叫只读的 Docker 容器模板，镜像中含有一个Docker 容器运行所需要的文件系统，所以我们说Docker 镜像是启动一个Docker 容器的基础。 &nbsp; 如果这样不是很好理解，我们可以通过一个图一起看下： 从图中可以看出除了最上面的一层为读写层之外，下面的其他的层都是只读的镜像层，并且除了最下面的一层外，其他的层都有会有一个指针指向自己下面的一层镜像。 虽然统一文件系统(union file system)技术将不同的镜像层整合成一个统一的文件系统，为构成一个完整容器镜像的层提供了一个统一的视角，隐藏了多个层的复杂性，对用户来说只存在一个文件系统，但图中的这些层并不是不能看到的，如果需要查看的话可以进入运行Docker的机器上进行查看，从这些层中可以看到Docker 内部实现的一些细节，接下来我们一起看下。 &nbsp; 一般刚接触Docker 不久的话可能会不太清楚Docker 的存储方式是怎样的，并且可能也不太清楚Docker 容器的镜像到底存储在什么路径下，比较迷茫。 &nbsp; 有些同学想了解下Docker 的镜像数据存储在什么位置，然后谷歌了下几篇博文，说是在/var/lib/docker 下有个aufs目录，结果在自己机器上进到这个路径后发现没有aufs相关的目录，然后以为是版本的问题，其实不然。 &nbsp; 以Linux服务器为例，其实Docker 的容器镜像和容器本身的数据都存放在服务器的 /var/lib/docker/ 这个路径下。不过不同的linux发行版存储方式上有差别，比如，在ubuntu发行版上存储方式为AUFS，CentOS发行版上的存储方式为device mapper。 &nbsp; /var/lib/docker 路径下的信息在不同的阶段会有变化，从笔者个人经验来看，了解这几个阶段中新增的数据以及容器与镜像的存储结构的变化非常有利于我们对Docker容器以及Docker镜像的理解。 接下来我们一起看下Docker运行后、下载镜像后、运行容器后三个阶段中Docker 存储的变化。 &nbsp; 环境信息： &nbsp; 系统发行版：CentOS7.2。 内核版本：3.10.0-327.36.1.el7.x86_64 Docker 版本：1.8 启动Docker后 &nbsp; 在此我们假设大家已经安装好了Docker环境，具体安装的过程不再赘述。 &nbsp; &nbsp;&nbsp;&nbsp;# 启动Docker 服务 &nbsp;&nbsp;&nbsp;[root@influxdb ~]# systemctl start docker &nbsp; &nbsp;&nbsp;&nbsp;# 查看/var/lib/docker路径下的文件结构 &nbsp; &nbsp;&nbsp;&nbsp;[root@localhost docker]# tree . ├── containers ├── devicemapper │&nbsp;&nbsp; ├── devicemapper │&nbsp;&nbsp; │&nbsp;&nbsp; ├── data │&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata │&nbsp;&nbsp; └── metadata │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── base │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── deviceset-metadata │&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;└── transaction-metadata ├── graph ├── linkgraph.db ├── repositories-devicemapper ├── tmp ├── trust └── volumes &nbsp; 8 directories, 7 files &nbsp; 注：必须启动Docker 服务后查看，如果没有启动Docker 进程则路径/var/lib/docker 不存在。 &nbsp; 前文中我们已经提到过，CentOS发行版中Docker 服务使用的存储方式为devicemapper，所以我们从前面tree命令的结果中可以看到出现了目录devicemapper。 &nbsp; 有些同学可能会问什么是devicemapper？ &nbsp; 太阳底下无新鲜事，devicemapper 并不是伴随着Docker 才出现的，早在linux2.6版本的内核时其实就已经引入了devicemapper，且当时是作为一个很重要的技术出现的。 &nbsp; 简单说来devicemapper 就是Docker 服务的一个存储驱动，或者叫Docker 服务的存储后端。Devicemapper 其实是一个基于内核的框架，这个框架中对linux上很多的功能进行了增强，比如对linux上高级卷管理功能的增强。 Devicemapper 存储驱动将我们的每个docker镜像和docker容器都存在在自己的虚拟设备中，devicemapper的这些设备相当于我们常见的一般的写时复制快照设备的超配版本。通过上面的介绍，有些同学可能以为devicemapper 存储驱动是工作在块级别的，但是devicempper 实际是工作在文件级别的，也就是说devicemapper 存储驱动和写时复制操作都是直接操作块，而不是对文件进行操作。 &nbsp; 以上是我们关于Docker 服务的devicemapper 存储驱动的一个简单的介绍，Docker 官方文档中提供了很多的有关Docker 存储驱动的介绍，感兴趣的同学可以自行查阅。 &nbsp; 进一步的查看的话，可以看到路径/var/lib/docker/devicemapper下面有两个目录，分别为devicemapper和data，其中目录devicemapper 下存在两个名为data和metadata的文件，两个文件从名称即可看出一个是镜像数据的存储池，一个为镜像相关的元数据。接下去我们会逐个看下这个路径下的文件。 &nbsp; 进入上面提到的目录metadata下，可以看到这个目录中已经存在三个文件，分别为：base、deviceset-metadata和transction-metadata，这三个文分别用来存放上文中我们提到的元数据的id、大小和uuid等信息。 [root@localhost metadata]# pwd /var/lib/docker/devicemapper/metadata [root@localhost metadata]# ls base &nbsp;deviceset-metadata &nbsp;transaction-metadata 除了上面提到的几个目录，上文中tree的结果中还有几个目录，分别为：containers、devicemapper、graph、linkgraph.db、repositories-devicemapper、tmp、trust和volumes。这几个文件对于docker 的镜像存储来说都很重要，我们以文件repositories-devicemapper为例，看下这个文件对于镜像存储所起到的作用。 &nbsp; [root@localhost docker]# pwd /var/lib/docker [root@localhost docker]# ls containers &nbsp;devicemapper &nbsp;graph &nbsp;linkgraph.db &nbsp;repositories-devicemapper &nbsp;tmp &nbsp;trust &nbsp;volumes &nbsp; 我们可以先看下repositories-devicemapper 这个文件中在当前的阶段中有什么： root@localhost docker]# cat repositories-devicemapper {&quot;Repositories&quot;:{}}[root@localhost docker]# 从上面cat的结果中我们不难看出，文件repositories-devicemapper 中其实记录的就是docker 镜像的属性信息，比如镜像名称、镜像标签、镜像的ID等信息，如果镜像刚好没有标签的话默认会以lastet作为标签。 以上是对Docker 服务运行后pull镜像之前/var/lib/docker 路径下数据的一个简单的解读，相信大家通过上面的描述已经对docker镜像有了一些更深入的认识。下面我们看下在我们pull 自己的第一个docker镜像之后路径/var/lib/docker 之下的数据会发生怎样的变化。 &nbsp; Pull 镜像后 &nbsp; 在此我们以一个nginx镜像为例一起看下这个阶段的变化。 &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;# pull 示例镜像 [root@localhost docker]# docker pull nginx Using default tag: latest latest: Pulling from library/nginx 22f3bf58cd09: Pull complete ea2fc476f5f0: Pull complete 81d728438afe: Pull complete 303a6dec1190: Pull complete d43816b44a22: Pull complete dc02db50a25a: Pull complete 6f650a34b308: Pull complete a634e96a9de9: Pull complete 72f3ebe1e4d7: Pull complete c2c9e418b22c: Pull complete Digest: sha256:a82bbaf63c445ee9b854d182254c62e34e6fa92f63d7b4fdf6cea7e76665e06e Status: Downloaded newer image for nginx:latest &nbsp; # 查看镜像是否已经在本地 [root@localhost docker]# docker images REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB [root@localhost docker]# &nbsp; 在此我们没有指定nginx镜像的tag，因此默认拉去了最新的版本。然后我们看下路径/var/lib/docker 下是否有变化： [root@localhost docker]# tree . . ├── containers ├── devicemapper │&nbsp;&nbsp; ├── devicemapper │&nbsp;&nbsp; │&nbsp;&nbsp; ├── data │&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata …… 省略若干数据 …… │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; ├── …… 省略若干数据 …… │&nbsp;&nbsp; ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc │&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility │&nbsp;&nbsp; └── _tmp ├── linkgraph.db ├── repositories-devicemapper ├── tmp ├── trust └── volumes &nbsp; 30 directories, 67 files [root@localhost docker]# &nbsp; 从结尾的目录数和文件数也可以看出，在我们拉取镜像后/var/lib/docker 下多出了很多的文件(拉取镜像之前，只有8个目录，7个文件)，下面我们一步步的分析。 &nbsp; 如果这个时候看下路径/var/lib/docker下的文件的话，可以很容易的看到发生变化的主要是下面这三个文件：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/graph。我们先看下metadata这个文件： &nbsp; &nbsp;从结果可以看出除了上一个阶段中已经有的base、deviceset-metadata等几个文件外，还多出了一些名字较长的文件，我们挨个看下这几个文件中的数据： [root@localhost metadata]# cat base {&quot;device_id&quot;:1,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:1,&quot;initialized&quot;:true} [root@localhost metadata]# cat 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3 {&quot;device_id&quot;:2,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:2,&quot;initialized&quot;:false} [root@localhost metadata]# cat ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc {&quot;device_id&quot;:3,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:3,&quot;initialized&quot;:false} &nbsp; [root@localhost metadata]# cat 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 {&quot;device_id&quot;:4,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:4,&quot;initialized&quot;:false} [root@localhost metadata]# cat d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c {&quot;device_id&quot;:6,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:6,&quot;initialized&quot;:false} [root@localhost metadata]# cat 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 {&quot;device_id&quot;:5,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:5,&quot;initialized&quot;:false} [root@localhost metadata]# cat a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 {&quot;device_id&quot;:9,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:9,&quot;initialized&quot;:false} [root@localhost metadata]# cat dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7 {&quot;device_id&quot;:7,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:7,&quot;initialized&quot;:false} [root@localhost metadata]# cat 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a {&quot;device_id&quot;:8,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:8,&quot;initialized&quot;:false} [root@localhost metadata]# cat 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 {&quot;device_id&quot;:10,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:10,&quot;initialized&quot;:false} [root@localhost metadata]# cat c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092 {&quot;device_id&quot;:11,&quot;size&quot;:107374182400,&quot;transaction_id&quot;:11,&quot;initialized&quot;:false} &nbsp; 从上面的结果可以看出上面的几个文件中的device_id数值是按照顺序排列下来的，换句话说就是除了上一个阶段中已经存在的base文件，上面结果中其他的几个文件都是nginx镜像的中间镜像层，也就是我们经常执行的命令docker images –a 的结果中看到的构成当前镜像的各个镜像层。 &nbsp; &nbsp; 接下来我们再看一个变化较大的文件/var/lib/docker/graph。 &nbsp; &nbsp;&nbsp;[root@localhost graph]# tree . . ├── 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7 │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc │&nbsp;&nbsp; ├── checksum │&nbsp;&nbsp; ├── json │&nbsp;&nbsp; ├── layersize │&nbsp;&nbsp; ├── tar-data.json.gz │&nbsp;&nbsp; └── v1Compatibility └── _tmp &nbsp; 11 directories, 50 files &nbsp; &nbsp;从上面的结果中可以很明显的看到我们的镜像nginx及其每一个nginx镜像的中间层对应的目录下都包含如下几个文件：checksum、json、layerrize、tar-data.json.gz和v1Compatibility。我们任意找一个文件看下这几个文件中存放了什么数据。 &nbsp; (1)&nbsp;Checksum &nbsp; &nbsp;&nbsp;&nbsp; 其实从文件名称即可看出每个镜像层中的checksum文件存放的是当前镜像层的md5值，用于核对当前镜像层的数据是否完整。 &nbsp; (2)&nbsp;json &nbsp; &nbsp; &nbsp; &nbsp;从cat 的结果中可以看出json文件中存放的数据较多，比如Hostname、Domainname、User、Image等信息，而且很多参数和我们经常接触的Dockerfile中的参数相似。相比较前面的checksum文件这个文件中的内容相对较复杂，在此我们也解释下。 &nbsp; &nbsp; &nbsp; &nbsp;此处的json文件中一般主要用于存放镜像中涉及的动态信息，但需要注意的是此处的json文件并不仅仅被用于存储docker镜像的动态信息(很多同学可能会认为此处的json文件只是被用来描述Docker容器的动态信息的)，我们在使用Dockerfile 构建镜像时，Dockerfile 构建过程中涉及到的所有操作基本都被记录到这个json文件中。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;说到这儿，有些同学可能会问这个json是在什么阶段被使用到的，好问题。通过下面这个图我想大家应该就能看明白了： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;从图中我们可以看出每个镜像层的json文件其实是由Docker 守护进程进行解析的。Docker 守护进程通过json文件可以解析出运行容器需要的各种数据，比如环境变量、workdir以及容器启动时需要执行的ENTRYPOINT或者CMD命令等。Docker 守护进程从json文件中获取到这些数据后，接下来就开始进行容器进程的初始化。 &nbsp; (3)&nbsp;layersize &nbsp; &nbsp; &nbsp; &nbsp;从文件名称即可看出，这个文件中存放的为当前镜像层的占用空间大小： &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; (4)&nbsp;repositories-devicemapper &nbsp; 上一阶段中我们解释过这个文件中记录的为当前镜像层的属性信息，比如镜像名称信息、镜像标签信息、镜像的ID信息等： &nbsp; &nbsp; 以上是对pull镜像之后运行容器之前镜像存储信息的简单介绍，相信大家在看下之后对docker容器镜像已经有了更加深入的认识。下面我们看下本文中我们要说的最后一个阶段，即运行容器后docker 的存储又发生了哪些变化。 &nbsp; 运行容器后 &nbsp; 我们运行下前面从dockerhub pull的镜像nginx:latest： [root@localhost metadata]# docker images REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB [root@localhost metadata]# [root@localhost metadata]# [root@localhost metadata]# [root@localhost metadata]# docker run --name nginx -d nginx:latest 814ec80839669e235c94978ed3d07eab0e2b2bebd7d7a64fd6488cddca51be41 [root@localhost metadata]# docker ps CONTAINER ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES 814ec8083966 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx:latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;nginx -g &#39;daemon off&quot; &nbsp;&nbsp;3 seconds ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Up 2 seconds &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;80/tcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx &nbsp; 按照惯例，然后我们看下/var/lib/docker路径下的文件结构： &nbsp; &nbsp;和上一阶段不同，这个阶段发生变化的文件主要是：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/container，下面我们逐个看下。 &nbsp; (1)&nbsp;metadata &nbsp; 我们看下metadata这个目录下的文件： &nbsp; &nbsp; 从图中的结果可以看出，相比上一个阶段，当前阶段中metadata目录下多出了两个文件，即以51be4e和51b44e-init结尾的两个文件。 &nbsp; 我们都知道docker 借助容器镜像运行起容器之后，会在当前镜像的最顶层添加一个特殊的层，和其他的层相比这个层不但有可读的权限还有可写的权限。说到这，相信多出的两个文件的功能就不难理解了。 &nbsp; (2)&nbsp;mnt &nbsp; 在查看mnt下的数据之前，我们先看下这个目录下的文件结构： &nbsp; 对比上面说过的metadata目录，发现这两个目录下的文件是一样的，相比前一个阶段的话也是新增了两个文件，即以51be4e和51b44e-init结尾的两个文件。 &nbsp; (3)&nbsp;container &nbsp; 我们先看下当前目录下的文件结构： &nbsp; &nbsp; Container目录为容器本身的目录，此目录中存放了诸如容器的配置文件等文件。如果我们删掉这个目录(docker 进程hang死导致docker rm、docker kill杀不掉容器时常用此种方式处理)的话正在运行的容器就会被删掉，我们看下这几个文件都存放了什么数据。 &nbsp; (1)&nbsp;xxx.json.log、config.json 从文件名称即可看出，这两个文件存放的为当前容器的配置信息及其数据： (2)&nbsp;hosts &nbsp; hosts配置信息，在此不再赘述。 &nbsp; (3)&nbsp;hostname 容器host名称，可以cat查看后再进入容器查看hostname，核对下看是否是一样的。 &nbsp; (4)&nbsp;resolv.conf dns配置信息。 &nbsp; &nbsp;小结 &nbsp; 前面分析了那么多涉及到docker 存储的文件，在查阅各个文件或者目录作用时可能不是很方便，在此我们给大家总结了一下各个文件的作用(每个文件都是在/var/lib/docker路径下)： &nbsp; (1)&nbsp;devicemapper/devicemapper/data 存储存储池相关的数据。 (2)&nbsp;devicemapper/devicemapper/metdata 存储元数据。 (3)&nbsp;devicemapper/metadata/ 存储device_id、layersize等信息。 (4)&nbsp;devicemapper/mnt 存储挂载相关的信息。 (5)&nbsp;container/ 存储容器本身的信息。 (6)&nbsp;graph/ 存储各个镜像层的详细信息。 (7)&nbsp;repositores-devicemapper 存储镜像的一些基本信息。 (8)&nbsp;tmp 存储docker的临时目录。 (9)&nbsp;trust 存储docker的信任目录。 (10)&nbsp;&nbsp;volumes 存储docker的卷目录。 福利 扫描添加小编微信，备注“姓名+公司职位”，加入【云计算学习交流群】，和志同道合的朋友们共同打卡学习！ 推荐阅读： 云计算之基，一文带你速懂虚拟化KVM和XEN OpenStack网络的下一步原来这么走 | 技术头条 用一枚比特币环游世界? 他是不是疯了... 程序员逆袭为美国最佳 CEO，他说因为爱情 斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年 Erlang 之父去世，他留给程序员两点忠告 开什么玩笑？股票价格如何经得起AI的推敲？| 技术头条 真香，朕在看了！","@type":"BlogPosting","url":"https://mlh.app/2019/04/29/729037.html","headline":"深入浅出Docker 镜像   技术头条","dateModified":"2019-04-29T00:00:00+08:00","datePublished":"2019-04-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/29/729037.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>深入浅出Docker&nbsp;镜像&nbsp;|&nbsp;技术头条</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <section class="xmteditor" style="display:none;" data-tools="新媒体管家" data-label="powered by xmt.cn"></section> 
<p style="text-align: right;"><span style="font-size: 15px;">戳蓝字“</span><span style="color: rgb(0, 82, 255);font-size: 15px;">CSDN云</span><span style="font-size: 15px;color: rgb(0, 82, 255);">计算</span><span style="font-size: 15px;">”关注我们哦！</span></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.56953125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28TL1hNKLW9XeJLHviaGbmBLATHDjib9CTCceJ18oGQyD6lJuia48ezbyzY8kC5XRWwuTJU7JTFEEp2fg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28TL1hNKLW9XeJLHviaGbmBLATHDjib9CTCceJ18oGQyD6lJuia48ezbyzY8kC5XRWwuTJU7JTFEEp2fg/640?wx_fmt=jpeg"></p> 
<section powered-by="xiumi.us" style="white-space: normal;max-width: 100%;box-sizing: border-box;font-size: 15px;letter-spacing: 0.544px;line-height: 30px;widows: 1;background-color: rgb(255, 255, 255);word-wrap: break-word !important;"> 
 <section style="max-width: 100%;box-sizing: border-box;word-wrap: break-word !important;"> 
  <section> 
   <section powered-by="xiumi.us" style="box-sizing: border-box;line-height: 30px;max-width: 100%;letter-spacing: 0.54px;word-wrap: break-word !important;"> 
    <section style="box-sizing: border-box;max-width: 100%;word-wrap: break-word !important;"> 
     <section> 
      <section powered-by="xiumi.us" style="box-sizing: border-box;line-height: 30px;max-width: 100%;letter-spacing: 0.54px;word-wrap: break-word !important;"> 
       <section style="box-sizing: border-box;max-width: 100%;word-wrap: break-word !important;"> 
        <section> 
         <blockquote> 
          <p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;line-height: 1.75em;min-height: 1em;max-width: 100%;letter-spacing: 1px;text-indent: 0em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="letter-spacing: 0.54px;color: rgb(0, 82, 255);"></span><strong style="color: rgb(0, 82, 255);font-size: 15px;letter-spacing: 0.54px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);"><strong style="max-width: 100%;color: rgba(0, 0, 0, 0.5);font-size: 15px;letter-spacing: 1px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.54px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">技术头条：干货、简洁、多维全面。更多云计算精华知识尽在眼前，get要点、solve难题，统统不在话下！</span></strong></strong></p> 
         </blockquote> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p><br></p> 
<p style="text-align: left;margin-left: 8px;margin-right: 8px;text-indent: 0em;"><span style="font-size: 15px;font-family: 微软雅黑;"><span style="font-size: 15px;font-family: 微软雅黑;">作为云计算的当红明星</span>Docker&nbsp;来势汹汹,它就像一场森林大火<span style="font-size: 15px;font-family: 微软雅黑;">，烧到了我们中间。因为工作的原因，每天都会和容器云打交道。但是，我发现经常会有些新加入的同事在理解</span>Docker命令<span style="font-size: 15px;font-family: 微软雅黑;">方面存在一些问题，尤其是在</span>Docker 镜像<span style="font-size: 15px;font-family: 微软雅黑;">底层的工作原理和容器与容器镜像的关系上。</span></span></p> 
<p style="text-align: left;margin-left: 8px;margin-right: 8px;text-indent: 0em;"><span style="font-size: 15px;font-family: 微软雅黑;"><br></span></p> 
<p style="text-align: left;margin-left: 8px;margin-right: 8px;text-indent: 0em;"><span style="font-family: 微软雅黑;font-size: 15px;">通常情况下一项新的技术诞生时往往会伴随着较多的媒体宣传甚至炒作，且在推广产品的过程中往往会出现一些新的技术名词，让人感觉云里雾里。Docker 的诞生和推广正是在这种情况下进行的。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">对于产品本身而言媒体的宣传和炒作可以帮助他们快速的在市场中进行推广，但是这种宣传和炒作也会导致很多用户很难看清被宣传产品的技术的本质，不利于用户对技术的掌握，更加不利于用户对产品的深度使用。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 一般情况下只有真正理解了某门技术的原理才能真正掌握这一门技术，接下来才能去深入的使用这门技术。下面我们会由浅入深出的带大家了解下Docker 镜像及其相关技术的原理和本质。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><strong><span style="color: rgb(217, 33, 66);"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span><strong style="font-size: 15px;"><span style="font-family: 微软雅黑;">容器 VS 容器</span></strong><strong style="font-size: 15px;"><span style="font-family: 微软雅黑;">镜像</span></strong></span></strong></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">在说Docker 镜像的原理知识之前，我们先看下docker 容器和docker 镜像的区别，因为这部分我们后面会涉及到。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">简单说来，我们可以将Docker 镜像看成是Docker 容器的静态时，也可将Docker 容器看成是Docker镜像的运行时。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">从Docker 的官方文档来看，Docker 容器的定义和 Docker 镜像的定义几乎是相同，Docker 容器和Docker 镜像的区别主要在于docker 容器多出了一个可写层。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.3207207207207207" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDWaUxfDU1R1dunaBx5yMR3iabHRP52NfWROtMqF6hvVpf3q0BUYBiaTvg/640?wx_fmt=png" data-type="png" data-w="555" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDWaUxfDU1R1dunaBx5yMR3iabHRP52NfWROtMqF6hvVpf3q0BUYBiaTvg/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;<br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 容器中的进程就运行在这个可写层，这个可写层有两个状态，即运行态和退出态。当我们docker run 运行容器后，docker 容器就进入了运行态，当我们停止正在运行中的容器时，docker 容器就进入了退出态。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 我们将容器从运行态转为退出态时，期间发生的变更都会写入到容器的文件系统中(需要注意的是，此处不是写入到了docker 镜像中)，这方面的变化下文中我们还会再细说。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><strong><span style="color: rgb(217, 33, 66);font-size: 15px;font-family: 微软雅黑;">Docker 存储简介</span><span style="font-family: 微软雅黑;color: rgb(217, 33, 66);font-size: 15px;"></span></strong></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><strong><span style="font-family: 微软雅黑;color: rgb(217, 33, 66);font-size: 15px;"></span></strong></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">简单说来Docker 镜像就是一组只读的目录，或者叫只读的 Docker 容器模板，镜像中含有一个Docker 容器运行所需要的文件系统，所以我们说Docker 镜像是启动一个Docker 容器的基础。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">如果这样不是很好理解，我们可以通过一个图一起看下：</span></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.7474402730375427" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDLUNB9IV0Hjbf3KbYJiaJfoTZcWccexDticvCwPptWSzbp3FhuRiczdRjg/640?wx_fmt=png" data-type="png" data-w="293" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDLUNB9IV0Hjbf3KbYJiaJfoTZcWccexDticvCwPptWSzbp3FhuRiczdRjg/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;"><br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">从图中可以看出除了最上面的一层为读写层之外，下面的其他的层都是只读的镜像层，并且除了最下面的一层外，其他的层都有会有一个指针指向自己下面的一层镜像。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">虽然统一文件系统(union file system)技术将不同的镜像层整合成一个统一的文件系统，为构成一个完整容器镜像的层提供了一个统一的视角，隐藏了多个层的复杂性，对用户来说只存在一个文件系统，但图中的这些层并不是不能看到的，如果需要查看的话可以进入运行Docker的机器上进行查看，从这些层中可以看到Docker 内部实现的一些细节，接下来我们一起看下。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">一般刚接触Docker 不久的话可能会不太清楚Docker 的存储方式是怎样的，并且可能也不太清楚Docker 容器的镜像到底存储在什么路径下，比较迷茫。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">有些同学想了解下Docker 的镜像数据存储在什么位置，然后谷歌了下几篇博文，说是在/var/lib/docker 下有个aufs目录，结果在自己机器上进到这个路径后发现没有aufs相关的目录，然后以为是版本的问题，其实不然。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">以Linux服务器为例，其实Docker 的容器镜像和容器本身的数据都存放在服务器的 /var/lib/docker/ 这个路径下。不过不同的linux发行版存储方式上有差别，比如，在ubuntu发行版上存储方式为AUFS，CentOS发行版上的存储方式为device mapper。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">/var/lib/docker 路径下的信息在不同的阶段会有变化，从笔者个人经验来看，了解这几个阶段中新增的数据以及容器与镜像的存储结构的变化非常有利于我们对Docker容器以及Docker镜像的理解。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">接下来我们一起看下Docker运行后、下载镜像后、运行容器后三个阶段中Docker 存储的变化。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><strong><span style="color: rgb(217, 33, 66);font-size: 15px;font-family: 微软雅黑;">环境信息：</span></strong></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">系统发行版：CentOS7.2。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">内核版本：3.10.0-327.36.1.el7.x86_64</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">Docker 版本：1.8</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><strong><span style="font-family: 微软雅黑;font-size: 15px;color: rgb(217, 33, 66);">启动Docker后<strong style="font-size: 15px;text-indent: 176px;white-space: normal;"></strong></span></strong></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">在此我们假设大家已经安装好了Docker环境，具体安装的过程不再赘述。</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;# 启动Docker 服务</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;&nbsp;&nbsp;[root@influxdb ~]# systemctl start docker</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;# 查看/var/lib/docker路径下的文件结构</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;&nbsp;</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">&nbsp;[root@localhost docker]# tree .</span></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── containers</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── devicemapper</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── devicemapper</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── data</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── metadata</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── base</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;├── deviceset-metadata</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;└── transaction-metadata</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── graph</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── linkgraph.db</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── repositories-devicemapper</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── tmp</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── trust</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">└── volumes</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">8 directories, 7 files</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><strong><span style="font-size: 15px;font-family: 微软雅黑;">注</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">：</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;"></span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">必须</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">启动</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">Docker 服务</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">后查看，</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">如果</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">没有启动</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">Docker 进程</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">则路径</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">/var/li</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">b</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">/docker 不存在</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;">。</span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;"></span></strong></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">前文中我们已经提到过，CentOS发行版中Docker 服务使用的存储方式为devicemapper，所以我们从前面tree命令的结果中可以看到出现了目录devicemapper。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;"><span style="font-size: 15px;font-family: 微软雅黑;">有些同学可能会问什么是</span>devicemapper？</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">太阳底下无新鲜事，devicemapper 并不是伴随着Docker 才出现的，早在linux2.6版本的内核时其实就已经引入了devicemapper，且当时是作为一个很重要的技术出现的。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">简单说来devicemapper 就是Docker 服务的一个存储驱动，或者叫Docker 服务的存储后端。Devicemapper 其实是一个基于内核的框架，这个框架中对linux上很多的功能进行了增强，比如对linux上高级卷管理功能的增强。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">Devicemapper 存储驱动将我们的每个docker镜像和docker容器都存在在自己的虚拟设备中，devicemapper的这些设备相当于我们常见的一般的写时复制快照设备的超配版本。通过上面的介绍，有些同学可能以为devicemapper 存储驱动是工作在块级别的，但是devicempper 实际是工作在文件级别的，也就是说devicemapper 存储驱动和写时复制操作都是直接操作块，而不是对文件进行操作。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">以上是我们关于Docker 服务的devicemapper 存储驱动的一个简单的介绍，Docker 官方文档中提供了很多的有关Docker 存储驱动的介绍，感兴趣的同学可以自行查阅。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">进一步的查看的话，可以看到路径/var/lib/docker/devicemapper下面有两个目录，分别为devicemapper和data，其中目录devicemapper 下存在两个名为data和metadata的文件，两个文件从名称即可看出一个是镜像数据的存储池，一个为镜像相关的元数据。接下去我们会逐个看下这个路径下的文件。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">进入上面提到的目录metadata下，可以看到这个目录中已经存在三个文件，分别为：base、deviceset-metadata和transction-metadata，这三个文分别用来存放上文中我们提到的元数据的id、大小和uuid等信息。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"><br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# pwd</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">/var/lib/docker/devicemapper/metadata</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# ls</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">base &nbsp;deviceset-metadata &nbsp;transaction-metadata</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">除了上面提到的几个目录，上文中tree的结果中还有几个目录，分别为：containers、devicemapper、graph、linkgraph.db、repositories-devicemapper、tmp、trust和volumes。这几个文件对于docker 的镜像存储来说都很重要，我们以文件repositories-devicemapper为例，看下这个文件对于镜像存储所起到的作用。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]# pwd</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">/var/lib/docker</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]# ls</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">containers &nbsp;devicemapper &nbsp;graph &nbsp;linkgraph.db &nbsp;repositories-devicemapper &nbsp;tmp &nbsp;trust &nbsp;volumes</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">我们可以先看下repositories-devicemapper 这个文件中在当前的阶段中有什么：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;"><br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">root@localhost docker]# cat repositories-devicemapper</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">{"Repositories":{}}[root@localhost docker]#</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;text-indent: 14px;">从上面cat的结果中我们不难看出，文件repositories-devicemapper 中其实记录的就是docker 镜像的属性信息，比如镜像名称、镜像标签、镜像的ID等信息，如果镜像刚好没有标签的话默认会以lastet作为标签。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="text-indent: 14px;font-family: 微软雅黑;font-size: 15px;">以上是对Docker 服务运行后pull镜像之前/var/lib/docker 路径下数据的一个简单的解读，相信大家通过上面的描述已经对docker镜像有了一些更深入的认识。下面我们看下在我们pull 自己的第一个docker镜像之后路径/var/lib/docker 之下的数据会发生怎样的变化。</span><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="text-indent: 14px;font-family: 微软雅黑;font-size: 15px;"></span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><strong><span style="font-size: 15px;color: rgb(217, 33, 66);">Pull 镜像后</span></strong></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><strong><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;</span></strong></span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;"><span style="font-size: 15px;font-family: 微软雅黑;">在此我们以一个</span>nginx镜像<span style="font-size: 15px;font-family: 微软雅黑;">为例一起看下这个阶段的变化。</span></span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;# pull 示例镜像</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]# docker pull nginx</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">Using default tag: latest</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">latest: Pulling from library/nginx</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">22f3bf58cd09: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">ea2fc476f5f0: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">81d728438afe: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">303a6dec1190: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">d43816b44a22: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">dc02db50a25a: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">6f650a34b308: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">a634e96a9de9: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">72f3ebe1e4d7: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">c2c9e418b22c: Pull complete</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">Digest: sha256:a82bbaf63c445ee9b854d182254c62e34e6fa92f63d7b4fdf6cea7e76665e06e</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">Status: Downloaded newer image for nginx:latest</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(0, 0, 0);font-size: 15px;"># 查看镜像是否已经在本地</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(0, 0, 0);font-size: 15px;"><br></span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]# docker images</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]#</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">在此我们没有指定nginx镜像的tag，因此默认拉去了最新的版本。然后我们看下路径/var/lib/docker 下是否有变化：</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"><br></span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]# tree .</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">.</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── containers</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── devicemapper</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── devicemapper</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── data</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── metadata</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">……</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">省略若干数据</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">……</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├──</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">……</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(46, 117, 181);font-family: 微软雅黑;font-size: 15px;">省略若干数据</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">……</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; │&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── _tmp</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── linkgraph.db</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── repositories-devicemapper</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── tmp</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── trust</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">└── volumes</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">30 directories, 67 files</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost docker]#</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">从结尾的目录数和文件数也可以看出，在我们拉取镜像后/var/lib/docker 下多出了很多的文件(拉取镜像之前，只有8个目录，7个文件)，下面我们一步步的分析。</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">如果这个时候看下路径/var/lib/docker下的文件的话，可以很容易的看到发生变化的主要是下面这三个文件：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/graph。我们先看下metadata这个文件：</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.13864628820960698" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDGAEkNJY6CreXkAj2N5UUicQpHElJCN5nwvye4KRJVhbFgYoBX93okSQ/640?wx_fmt=png" data-type="png" data-w="916" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDGAEkNJY6CreXkAj2N5UUicQpHElJCN5nwvye4KRJVhbFgYoBX93okSQ/640?wx_fmt=png"></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp;从结果可以看出除了上一个阶段中已经有的base、deviceset-metadata等几个文件外，还多出了一些名字较长的文件，我们挨个看下这几个文件中的数据：</span><br></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"><br></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# cat base</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":1</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":1,"initialized":true} [root@localhost metadata]# cat 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":2</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":2,"initialized":false}</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# cat ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":3</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":3,"initialized":false}</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# cat 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">{"device_id":4</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":4,"initialized":false} [root@localhost metadata]# cat d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":6</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":6,"initialized":false} [root@localhost metadata]# cat 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":5</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":5,"initialized":false} [root@localhost metadata]# cat a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":9</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":9,"initialized":false} [root@localhost metadata]# cat dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":7</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":7,"initialized":false} [root@localhost metadata]# cat 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":8</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":8,"initialized":false} [root@localhost metadata]# cat 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":10</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":10,"initialized":false} [root@localhost metadata]# cat c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">{</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(255, 0, 0);">"device_id":11</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">,"size":107374182400,"transaction_id":11,"initialized":false}</span></span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">从上面的结果可以看出上面的几个文件中的device_id数值是按照顺序排列下来的，换句话说就是除了上一个阶段中已经存在的base文件，上面结果中其他的几个文件都是nginx镜像的中间镜像层，也就是我们经常执行的命令docker images –a 的结果中看到的构成当前镜像的各个镜像层。</span></p> 
<p style="text-indent: 29px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp; 接下来我们再看一个变化较大的文件/var/lib/docker/graph。</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;</span><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(46, 117, 181);">&nbsp;[root@localhost graph]# tree .</span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">.</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── 22f3bf58cd0949b57df2dc161e7026a8cc77699b6a8be7d0e3085e252a5439c3</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── 303a6dec11900c97f5d7555d31adec02d2e5e4eaa1a77537e7a5ebd45bb7fcd2</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── 6f650a34b3083c96cf8b7babc7a391227c0f78e0d07067071c46e31bd834de3a</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── 72f3ebe1e4d793a50836d4e070c94ef7497c80111d178e867014981f64696a39</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── 81d728438afe98602e2e692c20299ecf41b93173fb12351c1b59820b17fb16b9</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── a634e96a9de9f1e280efaecdd43c7273ac43e109a42ab6c76ab2d2261c8cdc50</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── c2c9e418b22ca5a0b02ef0c2bd02c34ad792d1fc271e5580fdb3252979ccc092</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── d43816b44a2280148da8d9b6ce2f357bff9b2e59ef386181f36a4a433a9aad6c</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── dc02db50a25a87ca227492197721e97d19f1822701fe3ec73533a0811a6393a7</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">├── ea2fc476f5f055f9e44963987903ecfe0cb480b7e387d8b5cb64006832110afc</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── checksum</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── json</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── layersize</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; ├── tar-data.json.gz</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">│&nbsp;&nbsp; └── v1Compatibility</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">└── _tmp</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">11 directories, 50 files</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp;从上面的结果中可以很明显的看到我们的镜像nginx及其每一个nginx镜像的中间层对应的目录下都包含如下几个文件：checksum、json、layerrize、tar-data.json.gz和v1Compatibility。我们任意找一个文件看下这几个文件中存放了什么数据。</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(1)&nbsp;Checksum</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.1210762331838565" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDOdK5JJVAG7RoHX1aE20LV8iaatPEWWUVPtNdR1CMJHBaHLujN1v5ZOw/640?wx_fmt=png" data-type="png" data-w="669" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDOdK5JJVAG7RoHX1aE20LV8iaatPEWWUVPtNdR1CMJHBaHLujN1v5ZOw/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 其实从文件名称即可看出每个镜像层中的checksum文件存放的是当前镜像层的md5值，用于核对当前镜像层的数据是否完整。</span><br></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(2)&nbsp;json</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.06238361266294227" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDcyEkXHed29ROZLZCIicYquBAnyrqZia8x16MIMzrvPZSGmcOceZCIONg/640?wx_fmt=png" data-type="png" data-w="1074" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDcyEkXHed29ROZLZCIicYquBAnyrqZia8x16MIMzrvPZSGmcOceZCIONg/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;<br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp; &nbsp;从cat 的结果中可以看出json文件中存放的数据较多，比如Hostname、Domainname、User、Image等信息，而且很多参数和我们经常接触的Dockerfile中的参数相似。相比较前面的checksum文件这个文件中的内容相对较复杂，在此我们也解释下。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp; &nbsp; &nbsp;此处的json文件中一般主要用于存放镜像中涉及的动态信息，但需要注意的是此处的json文件并不仅仅被用于存储docker镜像的动态信息(很多同学可能会认为此处的json文件只是被用来描述Docker容器的动态信息的)，我们在使用Dockerfile 构建镜像时，Dockerfile 构建过程中涉及到的所有操作基本都被记录到这个json文件中。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp; &nbsp; &nbsp;说到这儿，有些同学可能会问这个json是在什么阶段被使用到的，好问题。通过下面这个图我想大家应该就能看明白了：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.4699170124481328" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDTPQ8icHwQXCtFHoicDiaWzjibvSLVkpIToW18OJaoQ7yqzPATWHLQVAr1A/640?wx_fmt=png" data-type="png" data-w="964" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDTPQ8icHwQXCtFHoicDiaWzjibvSLVkpIToW18OJaoQ7yqzPATWHLQVAr1A/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;<br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp; &nbsp; &nbsp;从图中我们可以看出每个镜像层的json文件其实是由Docker 守护进程进行解析的。Docker 守护进程通过json文件可以解析出运行容器需要的各种数据，比如环境变量、workdir以及容器启动时需要执行的ENTRYPOINT或者CMD命令等。Docker 守护进程从json文件中获取到这些数据后，接下来就开始进行容器进程的初始化。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(3)&nbsp;layersize</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp; &nbsp; &nbsp;从文件名称即可看出，这个文件中存放的为当前镜像层的占用空间大小：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.049707602339181284" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDcT9bWHvCrApSyrxkXRFIv1CdJNfbMcCevhHW1Y3OwyjdNR8SiaOw3icw/640?wx_fmt=png" data-type="png" data-w="684" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDcT9bWHvCrApSyrxkXRFIv1CdJNfbMcCevhHW1Y3OwyjdNR8SiaOw3icw/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;<br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(4)&nbsp;repositories-devicemapper</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 15px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">上一阶段中我们解释过这个文件中记录的为当前镜像层的属性信息，比如镜像名称信息、镜像标签信息、镜像的ID信息等：</span></p> 
<p style="text-indent: 15px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.18927789934354486" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDTb6I9l533gWkibibCX3dBpMXXkAkMDlodyLiac7W11E61wTefVe6D7ReQ/640?wx_fmt=png" data-type="png" data-w="914" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDTb6I9l533gWkibibCX3dBpMXXkAkMDlodyLiac7W11E61wTefVe6D7ReQ/640?wx_fmt=png"></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><strong><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;</span></strong><br></span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;"><span style="font-size: 15px;font-family: 微软雅黑;">以上是对</span>pull<span style="font-size: 15px;font-family: 微软雅黑;">镜像之后运行容器之前镜像存储信息的简单介绍，相信大家在看下之后对</span>docker容器<span style="font-size: 15px;font-family: 微软雅黑;">镜像已经有了更加深入的认识。下面我们看下本文中我们要说的最后一个阶段，即运行容器后</span>docker 的<span style="font-size: 15px;font-family: 微软雅黑;">存储又发生了哪些变化。</span></span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 15px;">运行容器后</span></strong></span></p> 
<p><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">我们运行下前面从dockerhub pull的镜像nginx:latest：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# docker images</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">REPOSITORY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAG &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIRTUAL SIZE</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">nginx &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c2c9e418b22c &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 weeks ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;109.3 MB</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]#</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]#</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]#</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# docker run --name nginx -d nginx:latest</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">814ec80839669e235c94978ed3d07eab0e2b2bebd7d7a64fd6488cddca51be41</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">[root@localhost metadata]# docker ps</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">CONTAINER ID &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">814ec8083966 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx:latest &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"nginx -g 'daemon off" &nbsp;&nbsp;3 seconds ago &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Up 2 seconds &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;80/tcp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nginx</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">按照惯例，然后我们看下/var/lib/docker路径下的文件结构：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.9639769452449568" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDA8hcypJux60zdPODMDeBFAviaK3TvdoQ15qKTDkvrjrhQJESp2EumLA/640?wx_fmt=png" data-type="png" data-w="694" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDA8hcypJux60zdPODMDeBFAviaK3TvdoQ15qKTDkvrjrhQJESp2EumLA/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> &nbsp;和上一阶段不同，这个阶段发生变化的文件主要是：/var/lib/docker/devicemapper/metadata、/var/lib/docker/devicemapper/mnt以及/var/lib/docker/container，下面我们逐个看下。</span><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(1)&nbsp;metadata</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">我们看下metadata这个目录下的文件：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.972972972972973" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDOicTY6gia68TJRCvmVM11wXocIHTvWlKsvnk7UicDNaraNoBbcRKH6OIg/640?wx_fmt=png" data-type="png" data-w="592" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDOicTY6gia68TJRCvmVM11wXocIHTvWlKsvnk7UicDNaraNoBbcRKH6OIg/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;<br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">从图中的结果可以看出，相比上一个阶段，当前阶段中metadata目录下多出了两个文件，即以51be4e和51b44e-init结尾的两个文件。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 我们都知道docker 借助容器镜像运行起容器之后，会在当前镜像的最顶层添加一个特殊的层，和其他的层相比这个层不但有可读的权限还有可写的权限。说到这，相信多出的两个文件的功能就不难理解了。</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(2)&nbsp;mnt</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">在查看mnt下的数据之前，我们先看下这个目录下的文件结构：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 对比上面说过的metadata目录，发现这两个目录下的文件是一样的，相比前一个阶段的话也是新增了两个文件，即以51be4e和51b44e-init结尾的两个文件。</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(3)&nbsp;container</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"> 我们先看下当前目录下的文件结构：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.3902097902097902" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDFBxVkpMX3JEhrpLviaEnnCQkpbFQd1zvMyxZKZ2o035Pb7EiaMdc4kibA/640?wx_fmt=png" data-type="png" data-w="715" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDFBxVkpMX3JEhrpLviaEnnCQkpbFQd1zvMyxZKZ2o035Pb7EiaMdc4kibA/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;<br></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">Container目录为容器本身的目录，此目录中存放了诸如容器的配置文件等文件。如果我们删掉这个目录</span><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;">(</span><strong><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(0, 0, 0);">docker </span></strong><strong><span style="font-size: 15px;font-family: 微软雅黑;color: rgb(0, 0, 0);"><span style="font-size: 15px;font-family: 微软雅黑;">进程</span>hang死导致docker rm、docker kill杀不掉</span></strong><strong><span style="font-size: 15px;color: rgb(0, 0, 0);font-family: 微软雅黑;">容器时常用此种方式处理</span></strong><span style="font-size: 15px;font-family: 微软雅黑;">)的<span style="font-size: 15px;font-family: 微软雅黑;">话正在运行的容器就会被删掉，我们看下这几个文件都存放了什么数据。</span></span></span></p> 
<p style="text-indent: 28px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(1)&nbsp;xxx.json.log、config.json</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">从文件名称即可看出，这两个文件存放的为当前容器的配置信息及其数据：</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;"><br></span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.27243928194297784" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDUo6ibYQotHU3zrtRJ8UJgXxXD955KM4rPeU7TpGbTNmibADInubXWy5g/640?wx_fmt=png" data-type="png" data-w="947" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/zxoLaeCI28QeXCJg8rEFydGMqVLxT0qDUo6ibYQotHU3zrtRJ8UJgXxXD955KM4rPeU7TpGbTNmibADInubXWy5g/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(2)&nbsp;hosts</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">hosts配置信息，在此不再赘述。</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(3)&nbsp;hostname</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">容器host名称，可以cat查看后再进入容器查看hostname，核对下看是否是一样的。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">(4)&nbsp;resolv.conf</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">dns配置信息。</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><span style="font-size: 15px;font-family: 微软雅黑;">&nbsp;</span><strong style="font-size: 15px;text-align: left;text-indent: 152px;"><span style="font-size: 15px;font-family: 微软雅黑;">小结</span></strong><strong style="font-size: 15px;text-align: left;text-indent: 152px;"><span style="font-size: 15px;font-family: 微软雅黑;"></span></strong></span></p> 
<p style="text-indent: 152px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><strong><span style="font-size: 15px;font-family: 微软雅黑;"></span></strong></span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">前面分析了那么多涉及到docker 存储的文件，在查阅各个文件或者目录作用时可能不是很方便，在此我们给大家总结了一下各个文件的作用(每个文件都是在/var/lib/docker路径下)：</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">&nbsp;</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(1)&nbsp;devicemapper/devicemapper/data</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储存储池相关的数据。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(2)&nbsp;devicemapper/devicemapper/metdata</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储元数据。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(3)&nbsp;devicemapper/metadata/</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储device_id、layersize等信息。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(4)&nbsp;devicemapper/mnt</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储挂载相关的信息。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(5)&nbsp;container/</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储容器本身的信息。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(6)&nbsp;graph/</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储各个镜像层的详细信息。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(7)&nbsp;repositores-devicemapper</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储镜像的一些基本信息。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(8)&nbsp;tmp</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储docker的临时目录。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(9)&nbsp;trust</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储docker的信任目录。</span></p> 
<p style="text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;color: rgb(46, 117, 181);font-size: 15px;">(10)&nbsp;&nbsp;volumes</span></p> 
<p style="text-indent: 0px;text-align: justify;margin-left: 8px;margin-right: 8px;"><span style="font-family: 微软雅黑;font-size: 15px;">存储docker的卷目录。</span><span style="font-size: 15px;font-family: 微软雅黑;"></span><span style="font-size: 14px;font-family: 微软雅黑;"></span></p> 
<p style="margin-left:24px;text-indent:0;"><br></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-copyright="0" data-ratio="0.04523809523809524" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/1hReHaqafafJYoFH7OAhmUdTjo35vvJTy1lRVjG2CzFP3arfVRDqI7a8PSS6Sx5LialaFTE1HFu2N4OIhL8jP9g/640?wx_fmt=png" data-type="png" data-w="420" style="letter-spacing: 0.544px;line-height: 29.75px;box-sizing: border-box !important;word-wrap: break-word !important;width: 420px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/1hReHaqafafJYoFH7OAhmUdTjo35vvJTy1lRVjG2CzFP3arfVRDqI7a8PSS6Sx5LialaFTE1HFu2N4OIhL8jP9g/640?wx_fmt=png"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="margin-right: 8px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;widows: 1;line-height: 1.4;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="padding: 0.2em 0.5em;max-width: 100%;border-radius: 0.3em;color: white;font-size: 1em;font-family: inherit;font-weight: inherit;text-align: inherit;text-decoration: inherit;background-color: rgb(255, 105, 31);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">福利</span></strong></p> 
<section class="" style="margin-top: -0.7em;font-size: 1em;white-space: normal;max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;widows: 1;border-width: 1px;border-style: solid;border-color: rgb(255, 105, 31);border-radius: 0.4em;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
 <section style="padding: 1.4em 1em 1em;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
  <section style="max-width: 100%;font-size: 1em;font-family: inherit;text-align: inherit;text-decoration: inherit;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
   <p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">扫描添加小编微信，备注“</span></strong><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">姓名+公司职位</span></strong></span><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">”，加入【</span></strong><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">云计算学习交流群</span></strong></span><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">】，和志同道合的朋友们共同打卡学习！</span></strong></p> 
   <p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
   <p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="1.005813953488372" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28QDZW3ZeMemRs5PPyI20qxP8zicUCD67ia0kT4tk9BTQ6OaiaGTrvMQzl6sfmlRmFhKBcuibvRsxg3ktA/640?wx_fmt=jpeg" data-type="jpeg" data-w="516" style="height: 156px;width: 155px;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/zxoLaeCI28QDZW3ZeMemRs5PPyI20qxP8zicUCD67ia0kT4tk9BTQ6OaiaGTrvMQzl6sfmlRmFhKBcuibvRsxg3ktA/640?wx_fmt=jpeg"></p> 
  </section> 
 </section> 
</section> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><br></p> 
<p style="margin-right: 8px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;font-size: 15px;letter-spacing: 0.544px;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;text-indent: 28px;font-family: arial, 宋体, sans-serif;letter-spacing: 1px;overflow-wrap: break-word;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.5px;overflow-wrap: break-word;box-sizing: border-box !important;word-wrap: break-word !important;">推荐阅读：</span></strong></p> 
<ul class=" list-paddingleft-2" style="margin-left: 8px;margin-right: 8px;"> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;text-decoration: underline;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827271&amp;idx=2&amp;sn=fe08c701d4c3b2001132f1411033d936&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">云计算之基，一文带你速懂虚拟化KVM和XEN</a></span></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827174&amp;idx=1&amp;sn=c9e9045a7d8bfb547ee08424e64ea073&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="text-decoration: underline;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">OpenStack网络的下一步原来这么走 | 技术头条</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247494575&amp;idx=1&amp;sn=02aaa7ade69f31b5a5cd6ce629baf0cd&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;" data-linktype="2"><span style="font-size: 15px;">用一枚比特币环游世界? 他是不是疯了...</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzA5MzY4NTQwMA==&amp;mid=2651010412&amp;idx=1&amp;sn=3b4369d5b8b6cb4e2c03dd05271c6378&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;" data-linktype="2"><span style="font-size: 15px;">程序员逆袭为美国最佳 CEO，他说因为爱情</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MDA4NDkxMQ==&amp;mid=2247483883&amp;idx=1&amp;sn=7af3d0e822e979583e9f9a5d515c26ab&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;" data-linktype="2"><span style="font-size: 15px;">斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718646&amp;idx=1&amp;sn=b746dcd84262ded8af201d0e028f885e&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;" data-linktype="2"><span style="font-size: 15px;">Erlang 之父去世，他留给程序员两点忠告</span></a></h2></li> 
 <li><h2 style="max-width: 100%;letter-spacing: 0.54px;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzI0ODcxODk5OA==&amp;mid=2247504538&amp;idx=1&amp;sn=dc672ba34b2203a126def345e48b8168&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 15px;" data-linktype="2">开什么玩笑？股票价格如何经得起AI的推敲？| 技术头条</a><br></h2></li> 
</ul> 
<section data-role="outer" label="Powered by 135editor.com" style="white-space: normal;max-width: 100%;font-size: 15px;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
      <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
       <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
        <section style="max-width: 100%;text-align: right;box-sizing: border-box !important;word-wrap: break-word !important;"> 
         <br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
        </section> 
        <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
         <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
          <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
           <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
            <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
             <section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
              <section class="" data-tools="135编辑器" data-id="94174" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
               <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                <section style="max-width: 100%;text-align: right;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                 <section style="margin-top: -6.4px;margin-left: -16px;max-width: 197px;font-family: 微软雅黑;font-size: 16px;letter-spacing: 0.544px;line-height: 25.6px;float: right;transform: matrix(1, 0, 0, 1, 0, 0);width: 16px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                  <img class="" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAujO0pvtNCLzZCiaWxGBfq2xaPwze1NRLTSQZYbzWNnTJwDwsReHiam91Wojzvw3RLibjicWkLWJjicgsvw/640?wx_fmt=png" data-type="png" data-w="23" data-width="100%" style="max-width: 16px;display: block;box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: 15.99px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAujO0pvtNCLzZCiaWxGBfq2xaPwze1NRLTSQZYbzWNnTJwDwsReHiam91Wojzvw3RLibjicWkLWJjicgsvw/640?wx_fmt=png"> 
                 </section> 
                 <section data-brushtype="text" style="padding: 10px 16px;max-width: 197px;font-family: 微软雅黑;font-size: 16px;line-height: 25.6px;border-radius: 10px;color: rgb(73, 73, 72);display: inline-block;font-weight: 700;letter-spacing: 1.5px;text-align: center;background: none 0% 0% / auto repeat scroll padding-box border-box rgb(253, 245, 13);box-sizing: border-box !important;word-wrap: break-word !important;"> 
                  <span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">真香，朕在看了！</span> 
                 </section> 
                </section> 
               </section> 
              </section> 
             </section> 
            </section> 
           </section> 
          </section> 
         </section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>刚刚，阿里开源 iOS 协程开发框架 coobjc！ | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="刚刚，阿里开源 iOS 协程开发框架 coobjc！" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="阿里妹导读：刚刚，阿里巴巴正式对外开源了基于 Apache 2.0 协议的协程开发框架 coobjc，开发者们可以在&nbsp;Github&nbsp;上自主下载。 coobjc是为iOS平台打造的开源协程开发框架，支持Objective-C和Swift，同时提供了cokit库为Foundation和UIKit中的部分API提供了协程化支持，本文将为大家详细介绍coobjc的设计理念及核心优势。 开源地址 https://github.com/alibaba/coobjc iOS异步编程问题 从2008年第一个iOS版本发布至今的11年时间里，iOS的异步编程方式发展缓慢。 基于 Block 的异步编程回调是目前 iOS 使用最广泛的异步编程方式，iOS 系统提供的 GCD 库让异步开发变得很简单方便，但是基于这种编程方式的缺点也有很多，主要有以下几点： 容易进入&quot;嵌套地狱&quot; 错误处理复杂和冗长 容易忘记调用 completion handler 条件执行变得很困难 从互相独立的调用中组合返回结果变得极其困难 在错误的线程中继续执行（如子线程操作UI） 难以定位原因的多线程崩溃（手淘中多线程crash已占比60%以上） 锁和信号量滥用带来的卡顿、卡死 针对多线程以及尤其引发的各种崩溃和性能问题，我们制定了很多编程规范、进行了各种新人培训，尝试降低问题发生的概率，但是问题依然很严峻，多线程引发的问题占比并没有明显的下降，异步编程本来就是很复杂的事情，单靠规范和培训是难以从根本上解决问题的，需要有更加好的编程方式来解决。 解决方案 上述问题在很多系统和语言开发中都可能会碰到，解决问题的标准方式就是使用协程，C#、Kotlin、Python、Javascript 等热门语言均支持协程极其相关语法，使用这些语言的开发者可以很方便的使用协程及相关功能进行异步编程。 2017 年的 C++ 标准开始支持协程，Swift5 中也包含了协程相关的标准，从现在的发展趋势看基于协程的全新的异步编程方式，是我们解决现有异步编程问题的有效的方式，但是苹果基本已经不会升级 Objective-C 了，因此使用Objective-C的开发者是无法使用官方的协程能力的，而最新 Swift 的发布和推广也还需要时日，为了让广大iOS开发者能快速享受到协程带来的编程方式上的改变，手机淘宝架构团队基于长期对系统底层库和汇编的研究，通过汇编和C语言实现了支持 Objective-C 和 Swift 协程的完美解决方案 —— coobjc。 核心能力 提供了类似C#和Javascript语言中的Async/Await编程方式支持，在协程中通过调用await方法即可同步得到异步方法的执行结果，非常适合IO、网络等异步耗时调用的同步顺序执行改造。 提供了类似Kotlin中的Generator功能，用于懒计算生成序列化数据，非常适合多线程可中断的序列化数据生成和访问。 提供了Actor Model的实现，基于Actor Model，开发者可以开发出更加线程安全的模块，避免由于直接函数调用引发的各种多线程崩溃问题。 提供了元组的支持，通过元组Objective-C开发者可以享受到类似Python语言中多值返回的好处。 内置系统扩展库 提供了对NSArray、NSDictionary等容器库的协程化扩展，用于解决序列化和反序列化过程中的异步调用问题。 提供了对NSData、NSString、UIImage等数据对象的协程化扩展，用于解决读写IO过程中的异步调用问题。 提供了对NSURLConnection和NSURLSession的协程化扩展，用于解决网络异步请求过程中的异步调用问题。 提供了对NSKeyedArchieve、NSJSONSerialization等解析库的扩展，用于解决解析过程中的异步调用问题。 coobjc设计 最底层是协程内核，包含了栈切换的管理、协程调度器的实现、协程间通信channel的实现等。 中间层是基于协程的操作符的包装，目前支持async/await、Generator、Actor等编程模型。 最上层是对系统库的协程化扩展，目前基本上覆盖了Foundation和UIKit的所有IO和耗时方法。 核心实现原理 协程的核心思想是控制调用栈的主动让出和恢复。一般的协程实现都会提供两个重要的操作： Yield：是让出cpu的意思，它会中断当前的执行，回到上一次Resume的地方。 Resume：继续协程的运行。执行Resume后，回到上一次协程Yield的地方。 我们基于线程的代码执行时候，是没法做出暂停操作的，我们现在要做的事情就是要代码执行能够暂停，还能够再恢复。 基本上代码执行都是一种基于调用栈的模型，所以如果我们能把当前调用栈上的状态都保存下来，然后再能从缓存中恢复，那我们就能够实现yield和&nbsp;resume。 实现这样操作有几种方法呢？ 第一种：利用glibc 的 ucontext组件(云风的库)。 第二种：使用汇编代码来切换上下文(实现c协程)，原理同ucontext。 第三种：利用C语言语法switch-case的奇淫技巧来实现（Protothreads)。 第四种：利用了 C 语言的 setjmp 和 longjmp。 第五种：利用编译器支持语法糖。 上述第三种和第四种只是能过做到跳转，但是没法保存调用栈上的状态，看起来基本上不能算是实现了协程，只能算做做demo，第五种除非官方支持，否则自行改写编译器通用性很差。而第一种方案的&nbsp;ucontext&nbsp;在iOS上是废弃了的，不能使用。那么我们使用的是第二种方案，自己用汇编模拟一下&nbsp;ucontext。 模拟ucontext的核心是通过getContext和setContext实现保存和恢复调用栈。需要熟悉不同CPU架构下的调用约定(Calling Convention).&nbsp;&nbsp;汇编实现就是要针对不同cpu实现一套，我们目前实现了 armv7、arm64、i386、x86_64，支持iPhone真机和模拟器。 Show me the code 说了这么多，还是看看代码吧，我们从一个简单的网络请求加载图片功能来看看coobjc到底是如何使用的。 下面是最普通的网络请求的写法： 下面是使用coobjc库协程化改造后的代码： 原本需要20行的代码，通过coobjc协程化改造后，减少了一半，整个代码逻辑和可读性都更加好，这就是coobjc强大的能力，能把原本很复杂的异步代码，通过协程化改造，转变成逻辑简洁的顺序调用。 coobjc还有很多其他强大的能力，本文对于coobjc的实际使用就不过多介绍了，感兴趣的朋友可以去官方github仓库自行下载查看。 性能提升 我们在iPhone7 iOS11.4.1的设备上使用协程和传统多线程方式分别模拟高并发读取数据的场景，下面是两种方式得到的压测数据。 测试机器：iPhone7 iOS11.4.1 数据文件大小：20M 协程最多使用线程数：4 数据测试结果(统计的是所有并发访问结束的总耗时)： 从上面的表格我们可以看到使用在并发量很小的场景，由于多线程可以完全使用设备的计算核心，因此coobjc总耗时要比传统多线程略高，但是由于整体耗时都很小，因此差异并不明显，但是随着并发量的增大，coobjc的优势开始逐渐体现出来，当并发量超过1000以后，传统多线程开始出现线程分配异常，而导致很多并发任务并没有执行，因此在上表中显示的是大于20秒，实际是任务已经无法正常执行了，但是coobjc仍然可以正常运行。 我们在手机淘宝这种超级App中尝试了协程化改造，针对部分性能差的页面，我们发现在滑动过程中存在很多主线程IO调用、数据解析，导致帧率下降严重，通过引入coobjc，在不改变原有业务代码的基础上，通过全局hook部分IO、数据解析方法，即可让原来在主线程中同步执行的IO方法异步执行，并且不影响原有的业务逻辑，通过测试验证，这样的改造在低端机(iPhone6及以下的机器)上的帧率有20%左右的提升。 优势 简明 概念少：只有很少的几个操作符，相比响应式几十个操作符，简直不能再简单了。 原理简单：协程的实现原理很简单，整个协程库只有几千行代码。 易用 使用简单：它的使用方式比GCD还要简单，接口很少。 改造方便：现有代码只需要进行很少的改动就可以协程化，同时我们针对系统库提供了大量协程化接口。 清晰 同步写异步逻辑：同步顺序方式写代码是人类最容易接受的方式，这可以极大的减少出错的概率。 可读性高：使用协程方式编写的代码比block嵌套写出来的代码可读性要高很多。 性能 调度性能更快：协程本身不需要进行内核级线程的切换，调度性能快，即使创建上万个协程也毫无压力。 减少卡顿卡死:&nbsp;协程的使用以帮助开发减少锁、信号量的滥用，通过封装会引起阻塞的IO等协程接口，可以从根源上减少卡顿、卡死，提升应用整体的性能。 总结 程序是写来给人读的，只会偶尔让机器执行一下。——Abelson and Sussman 基于协程实现的编程范式能够帮助开发者编写出更加优美、健壮、可读性更强的代码。 协程可以帮助我们在编写并发代码的过程中减少线程和锁的使用，提升应用的性能和稳定性。 如果您有兴趣加入手淘架构团队，和我们一起投入到移动开发的新浪潮里，欢迎投递简历至&nbsp;junzhan.yzw@taobao.com 你可能还喜欢 点击下方图片即可阅读 为拯救爸妈朋友圈，达摩院造了“谣言粉碎机” 如何成为优秀的技术主管？ 这是工程师最长长长情的表白 关注「阿里技术」 把握前沿技术脉搏" />
<meta property="og:description" content="阿里妹导读：刚刚，阿里巴巴正式对外开源了基于 Apache 2.0 协议的协程开发框架 coobjc，开发者们可以在&nbsp;Github&nbsp;上自主下载。 coobjc是为iOS平台打造的开源协程开发框架，支持Objective-C和Swift，同时提供了cokit库为Foundation和UIKit中的部分API提供了协程化支持，本文将为大家详细介绍coobjc的设计理念及核心优势。 开源地址 https://github.com/alibaba/coobjc iOS异步编程问题 从2008年第一个iOS版本发布至今的11年时间里，iOS的异步编程方式发展缓慢。 基于 Block 的异步编程回调是目前 iOS 使用最广泛的异步编程方式，iOS 系统提供的 GCD 库让异步开发变得很简单方便，但是基于这种编程方式的缺点也有很多，主要有以下几点： 容易进入&quot;嵌套地狱&quot; 错误处理复杂和冗长 容易忘记调用 completion handler 条件执行变得很困难 从互相独立的调用中组合返回结果变得极其困难 在错误的线程中继续执行（如子线程操作UI） 难以定位原因的多线程崩溃（手淘中多线程crash已占比60%以上） 锁和信号量滥用带来的卡顿、卡死 针对多线程以及尤其引发的各种崩溃和性能问题，我们制定了很多编程规范、进行了各种新人培训，尝试降低问题发生的概率，但是问题依然很严峻，多线程引发的问题占比并没有明显的下降，异步编程本来就是很复杂的事情，单靠规范和培训是难以从根本上解决问题的，需要有更加好的编程方式来解决。 解决方案 上述问题在很多系统和语言开发中都可能会碰到，解决问题的标准方式就是使用协程，C#、Kotlin、Python、Javascript 等热门语言均支持协程极其相关语法，使用这些语言的开发者可以很方便的使用协程及相关功能进行异步编程。 2017 年的 C++ 标准开始支持协程，Swift5 中也包含了协程相关的标准，从现在的发展趋势看基于协程的全新的异步编程方式，是我们解决现有异步编程问题的有效的方式，但是苹果基本已经不会升级 Objective-C 了，因此使用Objective-C的开发者是无法使用官方的协程能力的，而最新 Swift 的发布和推广也还需要时日，为了让广大iOS开发者能快速享受到协程带来的编程方式上的改变，手机淘宝架构团队基于长期对系统底层库和汇编的研究，通过汇编和C语言实现了支持 Objective-C 和 Swift 协程的完美解决方案 —— coobjc。 核心能力 提供了类似C#和Javascript语言中的Async/Await编程方式支持，在协程中通过调用await方法即可同步得到异步方法的执行结果，非常适合IO、网络等异步耗时调用的同步顺序执行改造。 提供了类似Kotlin中的Generator功能，用于懒计算生成序列化数据，非常适合多线程可中断的序列化数据生成和访问。 提供了Actor Model的实现，基于Actor Model，开发者可以开发出更加线程安全的模块，避免由于直接函数调用引发的各种多线程崩溃问题。 提供了元组的支持，通过元组Objective-C开发者可以享受到类似Python语言中多值返回的好处。 内置系统扩展库 提供了对NSArray、NSDictionary等容器库的协程化扩展，用于解决序列化和反序列化过程中的异步调用问题。 提供了对NSData、NSString、UIImage等数据对象的协程化扩展，用于解决读写IO过程中的异步调用问题。 提供了对NSURLConnection和NSURLSession的协程化扩展，用于解决网络异步请求过程中的异步调用问题。 提供了对NSKeyedArchieve、NSJSONSerialization等解析库的扩展，用于解决解析过程中的异步调用问题。 coobjc设计 最底层是协程内核，包含了栈切换的管理、协程调度器的实现、协程间通信channel的实现等。 中间层是基于协程的操作符的包装，目前支持async/await、Generator、Actor等编程模型。 最上层是对系统库的协程化扩展，目前基本上覆盖了Foundation和UIKit的所有IO和耗时方法。 核心实现原理 协程的核心思想是控制调用栈的主动让出和恢复。一般的协程实现都会提供两个重要的操作： Yield：是让出cpu的意思，它会中断当前的执行，回到上一次Resume的地方。 Resume：继续协程的运行。执行Resume后，回到上一次协程Yield的地方。 我们基于线程的代码执行时候，是没法做出暂停操作的，我们现在要做的事情就是要代码执行能够暂停，还能够再恢复。 基本上代码执行都是一种基于调用栈的模型，所以如果我们能把当前调用栈上的状态都保存下来，然后再能从缓存中恢复，那我们就能够实现yield和&nbsp;resume。 实现这样操作有几种方法呢？ 第一种：利用glibc 的 ucontext组件(云风的库)。 第二种：使用汇编代码来切换上下文(实现c协程)，原理同ucontext。 第三种：利用C语言语法switch-case的奇淫技巧来实现（Protothreads)。 第四种：利用了 C 语言的 setjmp 和 longjmp。 第五种：利用编译器支持语法糖。 上述第三种和第四种只是能过做到跳转，但是没法保存调用栈上的状态，看起来基本上不能算是实现了协程，只能算做做demo，第五种除非官方支持，否则自行改写编译器通用性很差。而第一种方案的&nbsp;ucontext&nbsp;在iOS上是废弃了的，不能使用。那么我们使用的是第二种方案，自己用汇编模拟一下&nbsp;ucontext。 模拟ucontext的核心是通过getContext和setContext实现保存和恢复调用栈。需要熟悉不同CPU架构下的调用约定(Calling Convention).&nbsp;&nbsp;汇编实现就是要针对不同cpu实现一套，我们目前实现了 armv7、arm64、i386、x86_64，支持iPhone真机和模拟器。 Show me the code 说了这么多，还是看看代码吧，我们从一个简单的网络请求加载图片功能来看看coobjc到底是如何使用的。 下面是最普通的网络请求的写法： 下面是使用coobjc库协程化改造后的代码： 原本需要20行的代码，通过coobjc协程化改造后，减少了一半，整个代码逻辑和可读性都更加好，这就是coobjc强大的能力，能把原本很复杂的异步代码，通过协程化改造，转变成逻辑简洁的顺序调用。 coobjc还有很多其他强大的能力，本文对于coobjc的实际使用就不过多介绍了，感兴趣的朋友可以去官方github仓库自行下载查看。 性能提升 我们在iPhone7 iOS11.4.1的设备上使用协程和传统多线程方式分别模拟高并发读取数据的场景，下面是两种方式得到的压测数据。 测试机器：iPhone7 iOS11.4.1 数据文件大小：20M 协程最多使用线程数：4 数据测试结果(统计的是所有并发访问结束的总耗时)： 从上面的表格我们可以看到使用在并发量很小的场景，由于多线程可以完全使用设备的计算核心，因此coobjc总耗时要比传统多线程略高，但是由于整体耗时都很小，因此差异并不明显，但是随着并发量的增大，coobjc的优势开始逐渐体现出来，当并发量超过1000以后，传统多线程开始出现线程分配异常，而导致很多并发任务并没有执行，因此在上表中显示的是大于20秒，实际是任务已经无法正常执行了，但是coobjc仍然可以正常运行。 我们在手机淘宝这种超级App中尝试了协程化改造，针对部分性能差的页面，我们发现在滑动过程中存在很多主线程IO调用、数据解析，导致帧率下降严重，通过引入coobjc，在不改变原有业务代码的基础上，通过全局hook部分IO、数据解析方法，即可让原来在主线程中同步执行的IO方法异步执行，并且不影响原有的业务逻辑，通过测试验证，这样的改造在低端机(iPhone6及以下的机器)上的帧率有20%左右的提升。 优势 简明 概念少：只有很少的几个操作符，相比响应式几十个操作符，简直不能再简单了。 原理简单：协程的实现原理很简单，整个协程库只有几千行代码。 易用 使用简单：它的使用方式比GCD还要简单，接口很少。 改造方便：现有代码只需要进行很少的改动就可以协程化，同时我们针对系统库提供了大量协程化接口。 清晰 同步写异步逻辑：同步顺序方式写代码是人类最容易接受的方式，这可以极大的减少出错的概率。 可读性高：使用协程方式编写的代码比block嵌套写出来的代码可读性要高很多。 性能 调度性能更快：协程本身不需要进行内核级线程的切换，调度性能快，即使创建上万个协程也毫无压力。 减少卡顿卡死:&nbsp;协程的使用以帮助开发减少锁、信号量的滥用，通过封装会引起阻塞的IO等协程接口，可以从根源上减少卡顿、卡死，提升应用整体的性能。 总结 程序是写来给人读的，只会偶尔让机器执行一下。——Abelson and Sussman 基于协程实现的编程范式能够帮助开发者编写出更加优美、健壮、可读性更强的代码。 协程可以帮助我们在编写并发代码的过程中减少线程和锁的使用，提升应用的性能和稳定性。 如果您有兴趣加入手淘架构团队，和我们一起投入到移动开发的新浪潮里，欢迎投递简历至&nbsp;junzhan.yzw@taobao.com 你可能还喜欢 点击下方图片即可阅读 为拯救爸妈朋友圈，达摩院造了“谣言粉碎机” 如何成为优秀的技术主管？ 这是工程师最长长长情的表白 关注「阿里技术」 把握前沿技术脉搏" />
<link rel="canonical" href="https://mlh.app/2019/04/29/729107.html" />
<meta property="og:url" content="https://mlh.app/2019/04/29/729107.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-29T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"阿里妹导读：刚刚，阿里巴巴正式对外开源了基于 Apache 2.0 协议的协程开发框架 coobjc，开发者们可以在&nbsp;Github&nbsp;上自主下载。 coobjc是为iOS平台打造的开源协程开发框架，支持Objective-C和Swift，同时提供了cokit库为Foundation和UIKit中的部分API提供了协程化支持，本文将为大家详细介绍coobjc的设计理念及核心优势。 开源地址 https://github.com/alibaba/coobjc iOS异步编程问题 从2008年第一个iOS版本发布至今的11年时间里，iOS的异步编程方式发展缓慢。 基于 Block 的异步编程回调是目前 iOS 使用最广泛的异步编程方式，iOS 系统提供的 GCD 库让异步开发变得很简单方便，但是基于这种编程方式的缺点也有很多，主要有以下几点： 容易进入&quot;嵌套地狱&quot; 错误处理复杂和冗长 容易忘记调用 completion handler 条件执行变得很困难 从互相独立的调用中组合返回结果变得极其困难 在错误的线程中继续执行（如子线程操作UI） 难以定位原因的多线程崩溃（手淘中多线程crash已占比60%以上） 锁和信号量滥用带来的卡顿、卡死 针对多线程以及尤其引发的各种崩溃和性能问题，我们制定了很多编程规范、进行了各种新人培训，尝试降低问题发生的概率，但是问题依然很严峻，多线程引发的问题占比并没有明显的下降，异步编程本来就是很复杂的事情，单靠规范和培训是难以从根本上解决问题的，需要有更加好的编程方式来解决。 解决方案 上述问题在很多系统和语言开发中都可能会碰到，解决问题的标准方式就是使用协程，C#、Kotlin、Python、Javascript 等热门语言均支持协程极其相关语法，使用这些语言的开发者可以很方便的使用协程及相关功能进行异步编程。 2017 年的 C++ 标准开始支持协程，Swift5 中也包含了协程相关的标准，从现在的发展趋势看基于协程的全新的异步编程方式，是我们解决现有异步编程问题的有效的方式，但是苹果基本已经不会升级 Objective-C 了，因此使用Objective-C的开发者是无法使用官方的协程能力的，而最新 Swift 的发布和推广也还需要时日，为了让广大iOS开发者能快速享受到协程带来的编程方式上的改变，手机淘宝架构团队基于长期对系统底层库和汇编的研究，通过汇编和C语言实现了支持 Objective-C 和 Swift 协程的完美解决方案 —— coobjc。 核心能力 提供了类似C#和Javascript语言中的Async/Await编程方式支持，在协程中通过调用await方法即可同步得到异步方法的执行结果，非常适合IO、网络等异步耗时调用的同步顺序执行改造。 提供了类似Kotlin中的Generator功能，用于懒计算生成序列化数据，非常适合多线程可中断的序列化数据生成和访问。 提供了Actor Model的实现，基于Actor Model，开发者可以开发出更加线程安全的模块，避免由于直接函数调用引发的各种多线程崩溃问题。 提供了元组的支持，通过元组Objective-C开发者可以享受到类似Python语言中多值返回的好处。 内置系统扩展库 提供了对NSArray、NSDictionary等容器库的协程化扩展，用于解决序列化和反序列化过程中的异步调用问题。 提供了对NSData、NSString、UIImage等数据对象的协程化扩展，用于解决读写IO过程中的异步调用问题。 提供了对NSURLConnection和NSURLSession的协程化扩展，用于解决网络异步请求过程中的异步调用问题。 提供了对NSKeyedArchieve、NSJSONSerialization等解析库的扩展，用于解决解析过程中的异步调用问题。 coobjc设计 最底层是协程内核，包含了栈切换的管理、协程调度器的实现、协程间通信channel的实现等。 中间层是基于协程的操作符的包装，目前支持async/await、Generator、Actor等编程模型。 最上层是对系统库的协程化扩展，目前基本上覆盖了Foundation和UIKit的所有IO和耗时方法。 核心实现原理 协程的核心思想是控制调用栈的主动让出和恢复。一般的协程实现都会提供两个重要的操作： Yield：是让出cpu的意思，它会中断当前的执行，回到上一次Resume的地方。 Resume：继续协程的运行。执行Resume后，回到上一次协程Yield的地方。 我们基于线程的代码执行时候，是没法做出暂停操作的，我们现在要做的事情就是要代码执行能够暂停，还能够再恢复。 基本上代码执行都是一种基于调用栈的模型，所以如果我们能把当前调用栈上的状态都保存下来，然后再能从缓存中恢复，那我们就能够实现yield和&nbsp;resume。 实现这样操作有几种方法呢？ 第一种：利用glibc 的 ucontext组件(云风的库)。 第二种：使用汇编代码来切换上下文(实现c协程)，原理同ucontext。 第三种：利用C语言语法switch-case的奇淫技巧来实现（Protothreads)。 第四种：利用了 C 语言的 setjmp 和 longjmp。 第五种：利用编译器支持语法糖。 上述第三种和第四种只是能过做到跳转，但是没法保存调用栈上的状态，看起来基本上不能算是实现了协程，只能算做做demo，第五种除非官方支持，否则自行改写编译器通用性很差。而第一种方案的&nbsp;ucontext&nbsp;在iOS上是废弃了的，不能使用。那么我们使用的是第二种方案，自己用汇编模拟一下&nbsp;ucontext。 模拟ucontext的核心是通过getContext和setContext实现保存和恢复调用栈。需要熟悉不同CPU架构下的调用约定(Calling Convention).&nbsp;&nbsp;汇编实现就是要针对不同cpu实现一套，我们目前实现了 armv7、arm64、i386、x86_64，支持iPhone真机和模拟器。 Show me the code 说了这么多，还是看看代码吧，我们从一个简单的网络请求加载图片功能来看看coobjc到底是如何使用的。 下面是最普通的网络请求的写法： 下面是使用coobjc库协程化改造后的代码： 原本需要20行的代码，通过coobjc协程化改造后，减少了一半，整个代码逻辑和可读性都更加好，这就是coobjc强大的能力，能把原本很复杂的异步代码，通过协程化改造，转变成逻辑简洁的顺序调用。 coobjc还有很多其他强大的能力，本文对于coobjc的实际使用就不过多介绍了，感兴趣的朋友可以去官方github仓库自行下载查看。 性能提升 我们在iPhone7 iOS11.4.1的设备上使用协程和传统多线程方式分别模拟高并发读取数据的场景，下面是两种方式得到的压测数据。 测试机器：iPhone7 iOS11.4.1 数据文件大小：20M 协程最多使用线程数：4 数据测试结果(统计的是所有并发访问结束的总耗时)： 从上面的表格我们可以看到使用在并发量很小的场景，由于多线程可以完全使用设备的计算核心，因此coobjc总耗时要比传统多线程略高，但是由于整体耗时都很小，因此差异并不明显，但是随着并发量的增大，coobjc的优势开始逐渐体现出来，当并发量超过1000以后，传统多线程开始出现线程分配异常，而导致很多并发任务并没有执行，因此在上表中显示的是大于20秒，实际是任务已经无法正常执行了，但是coobjc仍然可以正常运行。 我们在手机淘宝这种超级App中尝试了协程化改造，针对部分性能差的页面，我们发现在滑动过程中存在很多主线程IO调用、数据解析，导致帧率下降严重，通过引入coobjc，在不改变原有业务代码的基础上，通过全局hook部分IO、数据解析方法，即可让原来在主线程中同步执行的IO方法异步执行，并且不影响原有的业务逻辑，通过测试验证，这样的改造在低端机(iPhone6及以下的机器)上的帧率有20%左右的提升。 优势 简明 概念少：只有很少的几个操作符，相比响应式几十个操作符，简直不能再简单了。 原理简单：协程的实现原理很简单，整个协程库只有几千行代码。 易用 使用简单：它的使用方式比GCD还要简单，接口很少。 改造方便：现有代码只需要进行很少的改动就可以协程化，同时我们针对系统库提供了大量协程化接口。 清晰 同步写异步逻辑：同步顺序方式写代码是人类最容易接受的方式，这可以极大的减少出错的概率。 可读性高：使用协程方式编写的代码比block嵌套写出来的代码可读性要高很多。 性能 调度性能更快：协程本身不需要进行内核级线程的切换，调度性能快，即使创建上万个协程也毫无压力。 减少卡顿卡死:&nbsp;协程的使用以帮助开发减少锁、信号量的滥用，通过封装会引起阻塞的IO等协程接口，可以从根源上减少卡顿、卡死，提升应用整体的性能。 总结 程序是写来给人读的，只会偶尔让机器执行一下。——Abelson and Sussman 基于协程实现的编程范式能够帮助开发者编写出更加优美、健壮、可读性更强的代码。 协程可以帮助我们在编写并发代码的过程中减少线程和锁的使用，提升应用的性能和稳定性。 如果您有兴趣加入手淘架构团队，和我们一起投入到移动开发的新浪潮里，欢迎投递简历至&nbsp;junzhan.yzw@taobao.com 你可能还喜欢 点击下方图片即可阅读 为拯救爸妈朋友圈，达摩院造了“谣言粉碎机” 如何成为优秀的技术主管？ 这是工程师最长长长情的表白 关注「阿里技术」 把握前沿技术脉搏","@type":"BlogPosting","url":"https://mlh.app/2019/04/29/729107.html","headline":"刚刚，阿里开源 iOS 协程开发框架 coobjc！","dateModified":"2019-04-29T00:00:00+08:00","datePublished":"2019-04-29T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/29/729107.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>刚刚，阿里开源 iOS 协程开发框架 coobjc！</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4608695652173913" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naIDWiaTAybrYSaczbicelBU434Nia1avH1lUxic8Cic2TXaHprIGOqw6QcqCWYf8cHwZAibiaSekmscy2tyg/640?wx_fmt=png" data-type="png" data-w="460" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naIDWiaTAybrYSaczbicelBU434Nia1avH1lUxic8Cic2TXaHprIGOqw6QcqCWYf8cHwZAibiaSekmscy2tyg/640?wx_fmt=png"></p> 
<p style="text-align: center;"><br></p> 
<section class="" powered-by="xiumi.us" style="white-space: normal;max-width: 100%;letter-spacing: 0.544px;line-height: 27.2px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section class="" powered-by="xiumi.us" style="max-width: 100%;letter-spacing: 0.544px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <section label="Copyright Reserved by PLAYHUDONG." donone="shifuMouseDownCard('shifu_c_008')" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
      <section class="" powered-by="xiumi.us" style="max-width: 100%;letter-spacing: 0.612px;box-sizing: border-box !important;word-wrap: break-word !important;"> 
       <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
        <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
         <section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
          <section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
           <section label="Copyright Reserved by PLAYHUDONG." donone="shifuMouseDownCard('shifu_c_008')" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
            <section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
             <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
              <section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
               <section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                <section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
                 <section label="Copyright Reserved by PLAYHUDONG." donone="shifuMouseDownCard('shifu_c_008')" style="margin-right: 0em;margin-left: 0em;padding: 0.5em 1em;max-width: 100%;border-style: none;background-color: rgb(235, 235, 235);box-sizing: border-box !important;word-wrap: break-word !important;"> 
                  <p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);font-size: 15px;letter-spacing: 0.612px;box-sizing: border-box !important;word-wrap: break-word !important;">阿里妹导读：刚刚，阿里巴巴正式对外开源了基于 Apache 2.0 协议的协程开发框架 coobjc，开发者们可以在&nbsp;Github&nbsp;上自主下载。</span></p> 
                  <p style="text-align: left;line-height: 1.75em;"><br></p> 
                  <p style="text-align: left;line-height: 1.75em;"><span style="max-width: 100%;color: rgb(136, 136, 136);font-size: 15px;letter-spacing: 0.612px;box-sizing: border-box !important;word-wrap: break-word !important;">coobjc是为iOS平台打造的开源协程开发框架，支持Objective-C和Swift，同时提供了cokit库为Foundation和UIKit中的部分API提供了协程化支持，本文将为大家详细介绍coobjc的设计理念及核心优势。</span></p> 
                 </section> 
                </section> 
               </section> 
              </section> 
             </section> 
            </section> 
           </section> 
          </section> 
         </section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<section style="white-space: normal;letter-spacing: 0.544px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
 <section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
  <section style="margin-top: 10px;margin-bottom: 10px;text-align: center;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
   <section style="padding: 5px;display: inline-block;border-radius: 16px;vertical-align: top;line-height: 1;background-color: rgb(249, 110, 87);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
    <section style="width: 18px;height: 18px;border-width: 4px;border-style: solid;border-color: rgb(255, 255, 255);border-radius: 50%;display: inline-block;vertical-align: top;background-color: rgb(248, 110, 87);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></section> 
    <section style="padding-right: 8px;padding-left: 6px;display: inline-block;vertical-align: top;color: rgb(255, 255, 255);height: 18px;line-height: 18px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"> 
     <p style="min-height: 1em;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size: 15px;">开源地址</span></p> 
     <p style="min-height: 1em;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="white-space: normal;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;text-align: center;"><span style="font-size: 15px;color: rgb(136, 136, 136);">https://github.com/alibaba/coobjc</span></p> 
<p style="white-space: normal;min-height: 1em;letter-spacing: 0.544px;text-align: center;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="white-space: normal;min-height: 1em;letter-spacing: 0.544px;text-align: center;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<h2 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(255, 129, 36);">iOS异步编程问题</span></strong></h2> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">从2008年第一个iOS版本发布至今的11年时间里，iOS的异步编程方式发展缓慢。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<p style="white-space: normal;"><img class="" data-backh="122" data-backw="556" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNnlVicMYq4TvjSv94yrfezCuEbh1r1eibxZicUKribJScMM21gb3ZC93BiaA/0?wx_fmt=png" data-copyright="0" data-ratio="0.21983914209115282" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNnlVicMYq4TvjSv94yrfezCuEbh1r1eibxZicUKribJScMM21gb3ZC93BiaA/640?wx_fmt=png" data-type="png" data-w="1492" style="text-align: center;width: 556px;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNnlVicMYq4TvjSv94yrfezCuEbh1r1eibxZicUKribJScMM21gb3ZC93BiaA/640?wx_fmt=png"></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">基于 Block 的异步编程回调是目前 iOS 使用最广泛的异步编程方式，iOS 系统提供的 GCD 库让异步开发变得很简单方便，但是基于这种编程方式的缺点也有很多，主要有以下几点：</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">容易进入"嵌套地狱"</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">错误处理复杂和冗长</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">容易忘记调用 completion handler</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">条件执行变得很困难</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">从互相独立的调用中组合返回结果变得极其困难</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">在错误的线程中继续执行（如子线程操作UI）</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">难以定位原因的多线程崩溃（手淘中多线程crash已占比60%以上）</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">锁和信号量滥用带来的卡顿、卡死</span></p></li> 
</ul> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">针对多线程以及尤其引发的各种崩溃和性能问题，我们制定了很多编程规范、进行了各种新人培训，尝试降低问题发生的概率，但是问题依然很严峻，多线程引发的问题占比并没有明显的下降，异步编程本来就是很复杂的事情，单靠规范和培训是难以从根本上解决问题的，需要有更加好的编程方式来解决。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<h2 style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="color: rgb(255, 129, 36);"><strong><span style="font-size: 15px;">解决方案</span></strong></span></h2> 
<p style="white-space: normal;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">上述问题在很多系统和语言开发中都可能会碰到，解决问题的标准方式就是使用协程，C#、Kotlin、Python、Javascript 等热门语言均支持协程极其相关语法，使用这些语言的开发者可以很方便的使用协程及相关功能进行异步编程。</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">2017 年的 C++ 标准开始支持协程，Swift5 中也包含了协程相关的标准，从现在的发展趋势看基于协程的全新的异步编程方式，是我们解决现有异步编程问题的有效的方式，但是苹果基本已经不会升级 Objective-C 了，因此使用Objective-C的开发者是无法使用官方的协程能力的，而最新 Swift 的发布和推广也还需要时日，为了让广大iOS开发者能快速享受到协程带来的编程方式上的改变，手机淘宝架构团队基于长期对系统底层库和汇编的研究，通过汇编和C语言实现了支持 Objective-C 和 Swift 协程的完美解决方案 —— coobjc。</span></p> 
<p style="white-space: normal;"><br></p> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">核心能力</span></strong></h5> 
<p style="white-space: normal;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了类似C#和Javascript语言中的Async/Await编程方式支持，在协程中通过调用await方法即可同步得到异步方法的执行结果，非常适合IO、网络等异步耗时调用的同步顺序执行改造。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了类似Kotlin中的Generator功能，用于懒计算生成序列化数据，非常适合多线程可中断的序列化数据生成和访问。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了Actor Model的实现，基于Actor Model，开发者可以开发出更加线程安全的模块，避免由于直接函数调用引发的各种多线程崩溃问题。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了元组的支持，通过元组Objective-C开发者可以享受到类似Python语言中多值返回的好处。</span></p></li> 
</ul> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"></h5> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></strong></h5> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">内置系统扩展库</span></strong></h5> 
<p style="white-space: normal;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了对NSArray、NSDictionary等容器库的协程化扩展，用于解决序列化和反序列化过程中的异步调用问题。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了对NSData、NSString、UIImage等数据对象的协程化扩展，用于解决读写IO过程中的异步调用问题。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了对NSURLConnection和NSURLSession的协程化扩展，用于解决网络异步请求过程中的异步调用问题。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">提供了对NSKeyedArchieve、NSJSONSerialization等解析库的扩展，用于解决解析过程中的异步调用问题。</span></p></li> 
</ul> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"></h5> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></strong></h5> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">coobjc设计</span></strong></h5> 
<p style="white-space: normal;"><br></p> 
<p style="white-space: normal;"><img class="" data-copyright="0" data-ratio="0.7185354691075515" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNgK2lI7jNwbOkLNVcSkZdHMJLATxXcdPFdia5EYXk5pWeicJjFheYvoqA/640?wx_fmt=png" data-type="png" data-w="874" style="text-align: center;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNgK2lI7jNwbOkLNVcSkZdHMJLATxXcdPFdia5EYXk5pWeicJjFheYvoqA/640?wx_fmt=png"></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">最底层是协程内核，包含了栈切换的管理、协程调度器的实现、协程间通信channel的实现等。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">中间层是基于协程的操作符的包装，目前支持async/await、Generator、Actor等编程模型。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">最上层是对系统库的协程化扩展，目前基本上覆盖了Foundation和UIKit的所有IO和耗时方法。</span></p></li> 
</ul> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"></h5> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></strong></h5> 
<h5 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">核心实现原理</span></strong></h5> 
<p style="white-space: normal;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">协程的核心思想是控制调用栈的主动让出和恢复。一般的协程实现都会提供两个重要的操作：</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">Yield：是让出cpu的意思，它会中断当前的执行，回到上一次Resume的地方。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">Resume：继续协程的运行。执行Resume后，回到上一次协程Yield的地方。</span></p></li> 
</ul> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">我们基于线程的代码执行时候，是没法做出暂停操作的，我们现在要做的事情就是要代码执行能够暂停，还能够再恢复。 基本上代码执行都是一种基于调用栈的模型，所以如果我们能把当前调用栈上的状态都保存下来，然后再能从缓存中恢复，那我们就能够实现yield和&nbsp;resume。</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">实现这样操作有几种方法呢？</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style="margin-left: 3px;"> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">第一种：利用glibc 的 ucontext组件(</span><span style="font-size: 15px;color: rgb(62, 62, 62);">云风的库</span><span style="font-size: 15px;color: rgb(62, 62, 62);">)。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">第二种：使用汇编代码来切换上下文(实现c协程)，原理同ucontext。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">第三种：利用C语言语法switch-case的奇淫技巧来实现（Protothreads)。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">第四种：利用了 C 语言的 setjmp 和 longjmp。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">第五种：利用编译器支持语法糖。</span></p></li> 
</ul> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">上述第三种和第四种只是能过做到跳转，但是没法保存调用栈上的状态，看起来基本上不能算是实现了协程，只能算做做demo，第五种除非官方支持，否则自行改写编译器通用性很差。而第一种方案的&nbsp;ucontext&nbsp;在iOS上是废弃了的，不能使用。那么我们使用的是第二种方案，自己用汇编模拟一下&nbsp;ucontext。</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">模拟ucontext的核心是通过getContext和setContext实现保存和恢复调用栈。需要熟悉不同CPU架构下的调用约定(Calling Convention).&nbsp;&nbsp;汇编实现就是要针对不同cpu实现一套，我们目前实现了 armv7、arm64、i386、x86_64，支持iPhone真机和模拟器。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<h2 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(255, 129, 36);">Show me the code</span></strong></h2> 
<p style="white-space: normal;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">说了这么多，还是看看代码吧，我们从一个简单的网络请求加载图片功能来看看coobjc到底是如何使用的。</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">下面是最普通的网络请求的写法：</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<pre class="cm-s-default" style="text-align: left;"><p style="line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.4920212765957447" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNfuyich2u4al2p2V0LLMdX91Yr4QX18x1kA5M8sLClm4wGJL7rh0ZF8Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="752" style="text-align: center;white-space: normal;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNfuyich2u4al2p2V0LLMdX91Yr4QX18x1kA5M8sLClm4wGJL7rh0ZF8Q/640?wx_fmt=jpeg"></p></pre> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">下面是使用coobjc库协程化改造后的代码：</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<pre class="cm-s-default" style="text-align: left;"><p style="line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"><img class="" data-copyright="0" data-ratio="0.24867724867724866" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNe0zv4DsToJticjxwn1RJInLibmS9HbBBAxLviaogykkPD2dMqBL2XHcFw/640?wx_fmt=jpeg" data-type="jpeg" data-w="756" style="text-align: center;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNe0zv4DsToJticjxwn1RJInLibmS9HbBBAxLviaogykkPD2dMqBL2XHcFw/640?wx_fmt=jpeg"></span></p></pre> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">原本需要20行的代码，通过coobjc协程化改造后，减少了一半，整个代码逻辑和可读性都更加好，这就是coobjc强大的能力，能把原本很复杂的异步代码，通过协程化改造，转变成逻辑简洁的顺序调用。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">coobjc还有很多其他强大的能力，本文对于coobjc的实际使用就不过多介绍了，感兴趣的朋友可以去官方github仓库自行下载查看。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<h2 style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(255, 129, 36);">性能提升</span></strong></h2> 
<p style="white-space: normal;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">我们在iPhone7 iOS11.4.1的设备上使用协程和传统多线程方式分别模拟高并发读取数据的场景，下面是两种方式得到的压测数据。</span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">测试机器：iPhone7 iOS11.4.1</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">数据文件大小：20M</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">协程最多使用线程数：4</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">数据测试结果(统计的是所有并发访问结束的总耗时)：</span></p></li> 
</ul> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"><img class="" data-ratio="0.2887537993920973" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNHibO1viblXj6rHKXrhvIwwkMB6he1LlB8nohDr2IRljr6fGrVb3UjIiaQ/640?wx_fmt=png" data-type="png" data-w="658" style="text-align: center;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/LwZPmXjm4Wz1aY0r2opelOby95bQzUUNHibO1viblXj6rHKXrhvIwwkMB6he1LlB8nohDr2IRljr6fGrVb3UjIiaQ/640?wx_fmt=png"></span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">从上面的表格我们可以看到使用在并发量很小的场景，由于多线程可以完全使用设备的计算核心，因此coobjc总耗时要比传统多线程略高，但是由于整体耗时都很小，因此差异并不明显，但是随着并发量的增大，coobjc的优势开始逐渐体现出来，当并发量超过1000以后，传统多线程开始出现线程分配异常，而导致很多并发任务并没有执行，因此在上表中显示的是大于20秒，实际是任务已经无法正常执行了，但是coobjc仍然可以正常运行。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">我们在手机淘宝这种超级App中尝试了协程化改造，针对部分性能差的页面，我们发现在滑动过程中存在很多主线程IO调用、数据解析，导致帧率下降严重，通过引入coobjc，在不改变原有业务代码的基础上，通过全局hook部分IO、数据解析方法，即可让原来在主线程中同步执行的IO方法异步执行，并且不影响原有的业务逻辑，通过测试验证，这样的改造在低端机(iPhone6及以下的机器)上的帧率有20%左右的提升。</span></p> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<h2 style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="color: rgb(255, 129, 36);"><strong><span style="font-size: 15px;">优势</span></strong></span></h2> 
<p style="white-space: normal;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">简明</span></strong></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">概念少：只有很少的几个操作符，相比响应式几十个操作符，简直不能再简单了。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">原理简单：协程的实现原理很简单，整个协程库只有几千行代码。</span></p></li> 
</ul> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">易用</span></strong></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">使用简单：它的使用方式比GCD还要简单，接口很少。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">改造方便：现有代码只需要进行很少的改动就可以协程化，同时我们针对系统库提供了大量协程化接口。</span></p></li> 
</ul> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">清晰</span></strong></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><br></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">同步写异步逻辑：同步顺序方式写代码是人类最容易接受的方式，这可以极大的减少出错的概率。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">可读性高：使用协程方式编写的代码比block嵌套写出来的代码可读性要高很多。</span></p><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"></span></p><p><br></p></li> 
</ul> 
<p style="text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(62, 62, 62);">性能</span></strong></p> 
<p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></p> 
<ul class=" list-paddingleft-2" style=""> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">调度性能更快：协程本身不需要进行内核级线程的切换，调度性能快，即使创建上万个协程也毫无压力。</span></p></li> 
 <li><p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">减少卡顿卡死:&nbsp;协程的使用以帮助开发减少锁、信号量的滥用，通过封装会引起阻塞的IO等协程接口，可以从根源上减少卡顿、卡死，提升应用整体的性能。</span></p></li> 
</ul> 
<p style="white-space: normal;"><br style="box-sizing: border-box;"></p> 
<h2 style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="color: rgb(255, 129, 36);"><strong><span style="font-size: 15px;">总结</span></strong></span></h2> 
<p style="white-space: normal;"><br></p> 
<blockquote style="white-space: normal;"> 
 <p style="text-align: left;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(136, 136, 136);">程序是写来给人读的，只会偶尔让机器执行一下。——Abelson and Sussman</span></p> 
</blockquote> 
<p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></p> 
<p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">基于协程实现的编程范式能够帮助开发者编写出更加优美、健壮、可读性更强的代码。</span></p> 
<p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></p> 
<p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);">协程可以帮助我们在编写并发代码的过程中减少线程和锁的使用，提升应用的性能和稳定性。</span></p> 
<p style="text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(62, 62, 62);"><br></span></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;">如果您有兴趣加入手淘架构团队，和我们一起投入到移动开发的新浪潮里，欢迎投递简历至</span><strong style="font-size: 15px;">&nbsp;junzhan.yzw@taobao.com</strong></p> 
<p style="white-space: normal;text-align: left;line-height: 1.75em;"><strong style="font-size: 15px;"><br></strong></p> 
<p><br></p> 
<p style="min-height: 1em;letter-spacing: 0.5440000295639038px;white-space: normal;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-copyright="0" data-ratio="0.04907481898632341" data-type="gif" data-w="1243" width="auto" data-src="https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naKLzTlj0XiaExO7CCIZrf95viarmPTV7zRp58LaaLlESZlOxNwA4nWbpTXfwnOmRWkeBVWcVU2r2pRg/640?wx_fmt=gif" style="box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Z6bicxIx5naKLzTlj0XiaExO7CCIZrf95viarmPTV7zRp58LaaLlESZlOxNwA4nWbpTXfwnOmRWkeBVWcVU2r2pRg/640?wx_fmt=gif"></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-size: 15px;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">你可能还喜欢</strong></span></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-size: 12px;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">点击下方图片即可阅读</span></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="min-height: 1em;letter-spacing: 0.5440000295639038px;white-space: normal;text-align: center;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247489740&amp;idx=1&amp;sn=f72d222f3bfddeca551850b2e1b046a0&amp;chksm=e92925c3de5eacd518748221c2a7d2aae91ae8472701b610f7288c73eafae785a50c9f8b2d3a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="1" style="color: rgb(87, 107, 149);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="line-height: 0;top: auto;left: auto;right: auto;bottom: auto;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naI754NfnjAt7Sz8stkCZpicNsltSicHT9s1Wyvfe4HDBOT3X4fUmtqiaV8G05lmz3nS8fjU0QyTHjFGA/0?wx_fmt=jpeg" data-cropx1="0" data-cropx2="1072" data-cropy1="32.776978417266186" data-cropy2="495.51079136690646" data-ratio="0.43283582089552236" data-s="300,640" data-type="jpeg" data-w="1072" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIKsOGV4BOoB2LiaOrsPxoe74rSKAyHQqibs0rCVAz4dMFmztBK1P9dsRVJ2B53kc2IR4nEViascg98w/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 556px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIKsOGV4BOoB2LiaOrsPxoe74rSKAyHQqibs0rCVAz4dMFmztBK1P9dsRVJ2B53kc2IR4nEViascg98w/640?wx_fmt=jpeg"></span></a></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247489740&amp;idx=1&amp;sn=f72d222f3bfddeca551850b2e1b046a0&amp;chksm=e92925c3de5eacd518748221c2a7d2aae91ae8472701b610f7288c73eafae785a50c9f8b2d3a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(87, 107, 149);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">为拯救爸妈朋友圈，达摩院造了“谣言粉碎机”</a><br style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="min-height: 1em;letter-spacing: 0.5440000295639038px;white-space: normal;text-align: center;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247489730&amp;idx=1&amp;sn=d7f4dc5ac06ce2c088dcc38b96f0ad36&amp;chksm=e92925cdde5eacdbc61b04d5824caab44b85122e43b259c48d6e4b7d2e950289f460f6bc6824&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="1" style="color: rgb(87, 107, 149);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="line-height: 0;top: auto;left: auto;right: auto;bottom: auto;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naLC0MfuWlLuP4cn86iafZJpa4w3onia3kJb62UZr9cbhZA34SrzfVt8ibv5SHyMgNRc22xicsWcd66Rpw/0?wx_fmt=jpeg" data-cropx1="0" data-cropx2="1024" data-cropy1="51.56834532374101" data-cropy2="495.4244604316547" data-ratio="0.43359375" data-s="300,640" data-type="jpeg" data-w="1024" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naI754NfnjAt7Sz8stkCZpicN7ORkBDFbw2ZjkEKCeYV3tJ8YsQcicjydsgvs15d4XuA3s5oficUTxnvw/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 556px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naI754NfnjAt7Sz8stkCZpicN7ORkBDFbw2ZjkEKCeYV3tJ8YsQcicjydsgvs15d4XuA3s5oficUTxnvw/640?wx_fmt=jpeg"></span></a></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247489730&amp;idx=1&amp;sn=d7f4dc5ac06ce2c088dcc38b96f0ad36&amp;chksm=e92925cdde5eacdbc61b04d5824caab44b85122e43b259c48d6e4b7d2e950289f460f6bc6824&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(87, 107, 149);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">如何成为优秀的技术主管？</a><br style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="min-height: 1em;letter-spacing: 0.5440000295639038px;white-space: normal;text-align: center;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247489603&amp;idx=1&amp;sn=4137ed2f29023c2206d2298df2c6298c&amp;chksm=e929254cde5eac5a345aaa0ac031b5e7487abef515872f9d36960f3774c7d9d7248680499830&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="1" style="color: rgb(87, 107, 149);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="line-height: 0;top: auto;left: auto;right: auto;bottom: auto;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naLLLczYRasW62iclib8bbY4NLKwcUsicOHI5DHKpLgL8wZs0VDb0PqiboribBP24pO5JSmVPI3t6IT8CicA/0?wx_fmt=jpeg" data-cropx1="0" data-cropx2="1000" data-cropy1="246.40287769784172" data-cropy2="667.2661870503597" data-ratio="0.421" data-s="300,640" data-type="jpeg" data-w="1000" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naJibicqgjczUbqnBPkVz1S9cicGjnicDxFRakIh8L334pooGC5F8UHDQA9HpmY0siaK4oEPh9XIxLMSaAA/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 556px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naJibicqgjczUbqnBPkVz1S9cicGjnicDxFRakIh8L334pooGC5F8UHDQA9HpmY0siaK4oEPh9XIxLMSaAA/640?wx_fmt=jpeg"></span></a></p> 
<p style="min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-size: 14px;font-family: monospace;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247489603&amp;idx=1&amp;sn=4137ed2f29023c2206d2298df2c6298c&amp;chksm=e929254cde5eac5a345aaa0ac031b5e7487abef515872f9d36960f3774c7d9d7248680499830&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(87, 107, 149);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">这是工程师最长<span style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">长<span style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">长</span></span>情的表白</a></p> 
<p style="min-height: 1em;letter-spacing: 0.5440000295639038px;white-space: normal;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p> 
<p style="min-height: 1em;letter-spacing: 0.5440000295639038px;white-space: normal;text-align: center;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-copyright="0" data-ratio="1" data-s="300,640" data-type="jpeg" data-w="860" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIa4cxhHckicCd0HcjGLySibIWiblh0tXc9S8Hf1iaTv6w1ibAIGzvyTm9ftDhRy8Tuehjw7OFRZ9b4cKQ/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 214px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIa4cxhHckicCd0HcjGLySibIWiblh0tXc9S8Hf1iaTv6w1ibAIGzvyTm9ftDhRy8Tuehjw7OFRZ9b4cKQ/640?wx_fmt=jpeg"></p> 
<p style="margin-bottom: 0.1px;min-height: 1em;letter-spacing: 0.544px;text-indent: 0em;background-color: rgb(255, 255, 255);font-family: monospace;font-size: 11.9px;white-space: pre;text-align: center;line-height: 1.75em;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size: 15px;max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size: 14px;font-family: 宋体;color: rgb(136, 136, 136);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">关注</span><span style="font-size: 14px;font-family: 宋体;color: rgb(255, 76, 65);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">「阿里技术」</span></span></strong></p> 
<p style="margin-bottom: 0.1px;min-height: 1em;letter-spacing: 0.544px;text-indent: 0em;font-family: monospace;font-size: 11.9px;white-space: pre;text-align: center;line-height: 1.75em;background-color: rgb(255, 255, 255);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size: 14px;font-family: 宋体;color: rgb(136, 136, 136);max-width: 100% !important;box-sizing: border-box !important;word-wrap: break-word !important;">把握前沿技术脉搏</span></strong></p>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

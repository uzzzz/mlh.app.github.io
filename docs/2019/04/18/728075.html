<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>设计抢购业务时，请务必注意这4个要点 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="设计抢购业务时，请务必注意这4个要点" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="91运营社群招募中，勾搭小编微信号：yujielin912入社群 每周91公开课，91风暴，全员参与，实际案例实际分析 问题答疑，你提问题我解答 行业专场，互联网金融，电商，新媒体运营等专场 各地分站交流 资源及人脉共享 其他的。。。。 欢迎各行业互联网运营达人加入我们91运营大家庭，会运营的人都来这里了！ 导读：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？ 正文 ———— / BEGIN / ———— 案例：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？ 页面上面的设计，这里我就不多说了，各大网站上都有很多案例了！ 现在我重点来讲一下需要注意的几点： 一、超卖问题 假如你的库存有10，现在3个用户来购买，a用户购买3个，b用户购买5个，c用户购买3个，合起来就是准备购买11个。 如果三个用户是同时并发购买，会出现怎样的情况呢？ 每个用户进行减库存的时候，数据库都会去修改一下数据，如下：update goods set amount=amount-购买数量 where goods_id=xxx。 mysql会锁定这一行数据（使用innodb存储引擎），数据库加的是排他锁。 根据排他锁的特点：其他线程不能读、不能写此行数据。 排他锁情况下，那么其他用户就是等待状态了。 1. a用户执行update的时候，锁定库存数据。update执行完毕后，减去了3个后，mysql自动释放锁。 2. b用户执行，减去了5个。此时，已经卖掉8个库存了，库存数为2了。 3. 但是c用户接着执行，Update goods set amount=amount-1 where goods_id=xxx。 结果库存数量变成-1了。 思考：把库存数量字段的类型，设计成正数类型，不允许出现负数，会怎么样呢? 测验结果：数据库会直接报错，通不过。 解决办法：只有库存数量，大于或等于购买数量的时候，才能去减库存；其他情况，提示信息，库存不足。 二、并发的问题 为了更好的理解并发和同步，我们需要先明白两个重要的概念：同步和异步。 同步和异步的区别和联系： 所谓同步，可以理解为在执行完一个函数或方法之后，一直等待系统返回值或消息，这时程序是出于阻塞的，只有接收到返回的值或消息后才往下执行其它的命令。 异步，执行完函数或方法后，不必阻塞性地等待返回值或消息，只需要向系统委托一个异步过程，那么当系统接收到返回值或消息时，系统会自动触发委托的异步过程，从而完成一个完整的流程。 同步在一定程度上可以看做是单线程，这个线程请求一个方法后就待这个方法给他回复，否则他不往下执行。异步在一定程度上可以看做是多线程的，请求一个方法后，就不管了，继续执行其他的方法。 如何处理并发和同步？ 首先需要明白，锁机制有两个层面： 一种是代码层次上的，如：java中的同步锁，典型的就是同步关键字synchronized，这里我不在做过多的讲解； 另外一种是数据库层次上的，比较典型的就是悲观锁和乐观锁。这里我们重点讲解的就是悲观锁（传统的物理锁）和乐观锁。 悲观锁（Pessimistic Locking）： 悲观锁，正如其名，它指的是对数据被外界（包括本系统当前的其他事务，以及来自&nbsp;外部系统的事务处理）修改持保守态度，因此，在整个数据处理过程中，将数据处于锁定状态。 悲观锁的实现，往往依靠数据库提供的锁机制（也只有数据库层提供的锁机制才能&nbsp;真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系&nbsp;统不会修改数据）。 第一种问题中描述的超卖现象，其实是并发抢购时出现的情况。用到的是数据库内带的加排他锁方式，阻止了其他线程读取、访问数据，这样等待的时间就比较长。而业界一般的解决是使用乐观锁的办法来解决：使用数据库的乐观锁是通用解决办法。 乐观锁： 相对悲观锁而言，乐观锁机制采取了更加宽松的加锁机制。悲观锁大多数情况下依靠数据库的锁机制实现，以保证操作最大程度的独占性。 但随之而来的就是数据库性能的大量开销，特别是对长事务而言，这样的开销往往无法承受。 如：一个金融系统，当某个操作员读取用户的数据，并在读出的用户数据的基础上进&nbsp;行修改时（如更改用户帐户余额），如果采用悲观锁机制，也就意味着整个操作过程中（从操作员读出数据、开始修改直至提交修改结果的全过程，甚至还包括操作员中途去煮咖啡的时间），数据库记录始终处于加锁状态。 可以想见：如果面对几百上千个并发，这样的情况将导致怎样的后果。 乐观锁机制在一定程度上解决了这个问题。 通俗说就是：修改数据的时候，不给数据加锁。 乐观锁意思是不锁定表的情况下，利用业务的控制来解决并发问题，这样即保证数据的并发可读性又保证保存数据的排他性，保证性能的同时解决了并发带来的脏数据问题。 所以很多情况下都会采用乐观锁来解决业务上的问题。 高并发的解决方法主要有以下几点： （1）前台优化 减少http请求——css文件合并&nbsp; ，js文件合并； 压缩js，css文件； 使用雪碧图； 懒加载（只加载看到的第一屏内容，下拉之后看到其他的内容）； 预加载（只加载默认图）； cdn 加速。 （2）服务端优化： 页面静态化； 负载均衡、集群； 分布式； 使用队列。 （3）MySQL优化： 查询优化，能单表的单表 查询一条数据使用limit 生成查询缓存 使用索引 多表查询使用id进行关联 数据库分表 数据库分区 数据库集群 要查询的字段避免使用*号，指定需要的字段 避免使用%前缀的模糊查询 避免使用负向查询 避免使用or查询 避免使用子查询 避免使用MySQL自带函数 不要是rand 有顺序的读取 设置合适的数据类型 避免使用text类型 避免使用null （4）代码优化： 用单引号代替双引号，双引号会查询变量； 避免使用require_once require_once会判断文件是否加载过； 使用静态方法代替普通方法，静态方法速度比普通方法快4倍； 变量使用完之后需要销毁； 尽量不要使用@； include用绝对路径，不要使用相对路径，相对路径会有查询的过程； 避免使用__SET __GET __AUTOLOAD； 循环的时候先确定循环次数，不要每次循环都要计算； 避免循环查库； 避免多层foreach嵌套； 避免使用递归 ，递归比较浪费资源。 三、下单和减库存要在一个事务中 如果不在一个事务内，可能出现两种现象： 1. 订单入库失败、减库存成功。发现订单入库失败，减库存就不要继续进行下去了。 2. 订单入库成功、减库存失败。实际下了20个订单，库存却没有减。数据不一致了。 四、设计虚拟库存和真实库存两套方案 有些人下单完后，最终并不会去付款。 如果一下单就马上减库存,很多人下单，最终并不会去付款，可能导致库存数最后为0，别的用户无法下单了。 而实际中仓库中却有库存在——这样库存数据是不准确的。 什么时候减库存？ 是下单完成减库存、还是付款完后减库存呢? 付款后，才减库存，可能出现的现象：用户下完单，接着去付款，结果库存不够了，这样用户体验很不好。但是淘宝的设计是3天（大厂就是比较任性哦） 买家拍下商品后，“等待买家付款”的状态下系统会给予买家3天的时间进行付款，此时的付款动作是将钱款支付到支付宝公司。 此付款时间无法延长，若逾期未付款，交易将自动关闭，如您仍想购买，建议重新购买并及时付款。但是如果下完单就减库存，并能够保证用户下单只要付款，就一定能买到这个商品。 这样的用户体验会较好。 具体技术实现办法：下单后，马上减去库存。另外设置一个定时脚本，扫描超过30分未支付的订单，把订单中的商品数量返回到库存中去，订单关闭。 如唯品会的购物下单： 为什么使用虚拟库存和真实库存两套方案？ 假设库存数是50，a订单购买了5个件商品，支付完毕，库存数减去5，库存数变成了45件。 由于还没有发货，实际库存中还有50件商品，这样会出现混淆了。 使用两套库存记录方案是有必要的！ 下单-操作虚拟库存数 商品发货出库-操作真实库存数 五、减少频繁读数据库的压力 用户每次点击一个商品详情页面，都要读取库存，判断：有没有库存。如果读库存走的是数据库判断，很多人来抢购的情况下，数据库的压力会很大。 假设是1万个用户同时访问抢购页面，数据库接受的访问次数是1万个并发。 用户还要进行刷新页面操作，由于每次刷新都会走数据库判断库存。数量会更大，数据库的压力就更大了。所以最好是，把库存总数，缓存在redis中去。 内存中缓存的库存数量，只用来做读判断，这样压力扛住了。而更改数据库的库存总数了，程序马上要把库存总数，同步到缓存中去。 系统抗压力问题： 如何限流？ 如何防止恶意刷数据？ 防止限流就是写代码去阻止部分人进行频繁请求，为了识别是机器还是人工。加一些友好一点的验证码，这样不管是从体验上还是从系统的稳定性方面都是比较好的。 如下图淘宝做的验证： 滑块验证码方案，验证码后台针对用户产生的行为轨迹数据进行机器学习建模，结合访问频率、地理位置、历史记录等多个维度信息，快速、准确的返回人机判定结果。 攻与防技术都是在对抗中不断升级的，无解的验证码还不存在，但防的一方可以不断提升破解成本。 应用选择滑块验证，也有部分因素是因为竞争激烈的互联网很看重用户体验。拖动毕竟是趣味性交互且容易完成，而图形验证码既容易被黑客攻破，对用户也并没有那么友好——肉眼识别无趣（可能还很艰难），键盘手动输入更浪费时间，体验不太好。 总结 本文介绍了产品在设计抢购闪购商品活动中应该注意的几点事项，在设计闪购活动时，会围绕如何处理并发、扣除库存、防止恶意刷数据等问题。 各公司可以先根据自己的业务情况来设计相对应的方案，然后再用成本计算法，反算开发时间与成本，这样既保证了项目进度，性能体验等也不错。 作者：香鱼来源：人人都是产品经理 据说，只有打赏的才是真粉丝哦，8块8请小编喝杯咖啡吧，长按二维码勾搭小编微信（yujielin912)加入91运营社群，全年100多场免费公开课，定期问题答疑等着你，会运营的人都在这里了！" />
<meta property="og:description" content="91运营社群招募中，勾搭小编微信号：yujielin912入社群 每周91公开课，91风暴，全员参与，实际案例实际分析 问题答疑，你提问题我解答 行业专场，互联网金融，电商，新媒体运营等专场 各地分站交流 资源及人脉共享 其他的。。。。 欢迎各行业互联网运营达人加入我们91运营大家庭，会运营的人都来这里了！ 导读：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？ 正文 ———— / BEGIN / ———— 案例：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？ 页面上面的设计，这里我就不多说了，各大网站上都有很多案例了！ 现在我重点来讲一下需要注意的几点： 一、超卖问题 假如你的库存有10，现在3个用户来购买，a用户购买3个，b用户购买5个，c用户购买3个，合起来就是准备购买11个。 如果三个用户是同时并发购买，会出现怎样的情况呢？ 每个用户进行减库存的时候，数据库都会去修改一下数据，如下：update goods set amount=amount-购买数量 where goods_id=xxx。 mysql会锁定这一行数据（使用innodb存储引擎），数据库加的是排他锁。 根据排他锁的特点：其他线程不能读、不能写此行数据。 排他锁情况下，那么其他用户就是等待状态了。 1. a用户执行update的时候，锁定库存数据。update执行完毕后，减去了3个后，mysql自动释放锁。 2. b用户执行，减去了5个。此时，已经卖掉8个库存了，库存数为2了。 3. 但是c用户接着执行，Update goods set amount=amount-1 where goods_id=xxx。 结果库存数量变成-1了。 思考：把库存数量字段的类型，设计成正数类型，不允许出现负数，会怎么样呢? 测验结果：数据库会直接报错，通不过。 解决办法：只有库存数量，大于或等于购买数量的时候，才能去减库存；其他情况，提示信息，库存不足。 二、并发的问题 为了更好的理解并发和同步，我们需要先明白两个重要的概念：同步和异步。 同步和异步的区别和联系： 所谓同步，可以理解为在执行完一个函数或方法之后，一直等待系统返回值或消息，这时程序是出于阻塞的，只有接收到返回的值或消息后才往下执行其它的命令。 异步，执行完函数或方法后，不必阻塞性地等待返回值或消息，只需要向系统委托一个异步过程，那么当系统接收到返回值或消息时，系统会自动触发委托的异步过程，从而完成一个完整的流程。 同步在一定程度上可以看做是单线程，这个线程请求一个方法后就待这个方法给他回复，否则他不往下执行。异步在一定程度上可以看做是多线程的，请求一个方法后，就不管了，继续执行其他的方法。 如何处理并发和同步？ 首先需要明白，锁机制有两个层面： 一种是代码层次上的，如：java中的同步锁，典型的就是同步关键字synchronized，这里我不在做过多的讲解； 另外一种是数据库层次上的，比较典型的就是悲观锁和乐观锁。这里我们重点讲解的就是悲观锁（传统的物理锁）和乐观锁。 悲观锁（Pessimistic Locking）： 悲观锁，正如其名，它指的是对数据被外界（包括本系统当前的其他事务，以及来自&nbsp;外部系统的事务处理）修改持保守态度，因此，在整个数据处理过程中，将数据处于锁定状态。 悲观锁的实现，往往依靠数据库提供的锁机制（也只有数据库层提供的锁机制才能&nbsp;真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系&nbsp;统不会修改数据）。 第一种问题中描述的超卖现象，其实是并发抢购时出现的情况。用到的是数据库内带的加排他锁方式，阻止了其他线程读取、访问数据，这样等待的时间就比较长。而业界一般的解决是使用乐观锁的办法来解决：使用数据库的乐观锁是通用解决办法。 乐观锁： 相对悲观锁而言，乐观锁机制采取了更加宽松的加锁机制。悲观锁大多数情况下依靠数据库的锁机制实现，以保证操作最大程度的独占性。 但随之而来的就是数据库性能的大量开销，特别是对长事务而言，这样的开销往往无法承受。 如：一个金融系统，当某个操作员读取用户的数据，并在读出的用户数据的基础上进&nbsp;行修改时（如更改用户帐户余额），如果采用悲观锁机制，也就意味着整个操作过程中（从操作员读出数据、开始修改直至提交修改结果的全过程，甚至还包括操作员中途去煮咖啡的时间），数据库记录始终处于加锁状态。 可以想见：如果面对几百上千个并发，这样的情况将导致怎样的后果。 乐观锁机制在一定程度上解决了这个问题。 通俗说就是：修改数据的时候，不给数据加锁。 乐观锁意思是不锁定表的情况下，利用业务的控制来解决并发问题，这样即保证数据的并发可读性又保证保存数据的排他性，保证性能的同时解决了并发带来的脏数据问题。 所以很多情况下都会采用乐观锁来解决业务上的问题。 高并发的解决方法主要有以下几点： （1）前台优化 减少http请求——css文件合并&nbsp; ，js文件合并； 压缩js，css文件； 使用雪碧图； 懒加载（只加载看到的第一屏内容，下拉之后看到其他的内容）； 预加载（只加载默认图）； cdn 加速。 （2）服务端优化： 页面静态化； 负载均衡、集群； 分布式； 使用队列。 （3）MySQL优化： 查询优化，能单表的单表 查询一条数据使用limit 生成查询缓存 使用索引 多表查询使用id进行关联 数据库分表 数据库分区 数据库集群 要查询的字段避免使用*号，指定需要的字段 避免使用%前缀的模糊查询 避免使用负向查询 避免使用or查询 避免使用子查询 避免使用MySQL自带函数 不要是rand 有顺序的读取 设置合适的数据类型 避免使用text类型 避免使用null （4）代码优化： 用单引号代替双引号，双引号会查询变量； 避免使用require_once require_once会判断文件是否加载过； 使用静态方法代替普通方法，静态方法速度比普通方法快4倍； 变量使用完之后需要销毁； 尽量不要使用@； include用绝对路径，不要使用相对路径，相对路径会有查询的过程； 避免使用__SET __GET __AUTOLOAD； 循环的时候先确定循环次数，不要每次循环都要计算； 避免循环查库； 避免多层foreach嵌套； 避免使用递归 ，递归比较浪费资源。 三、下单和减库存要在一个事务中 如果不在一个事务内，可能出现两种现象： 1. 订单入库失败、减库存成功。发现订单入库失败，减库存就不要继续进行下去了。 2. 订单入库成功、减库存失败。实际下了20个订单，库存却没有减。数据不一致了。 四、设计虚拟库存和真实库存两套方案 有些人下单完后，最终并不会去付款。 如果一下单就马上减库存,很多人下单，最终并不会去付款，可能导致库存数最后为0，别的用户无法下单了。 而实际中仓库中却有库存在——这样库存数据是不准确的。 什么时候减库存？ 是下单完成减库存、还是付款完后减库存呢? 付款后，才减库存，可能出现的现象：用户下完单，接着去付款，结果库存不够了，这样用户体验很不好。但是淘宝的设计是3天（大厂就是比较任性哦） 买家拍下商品后，“等待买家付款”的状态下系统会给予买家3天的时间进行付款，此时的付款动作是将钱款支付到支付宝公司。 此付款时间无法延长，若逾期未付款，交易将自动关闭，如您仍想购买，建议重新购买并及时付款。但是如果下完单就减库存，并能够保证用户下单只要付款，就一定能买到这个商品。 这样的用户体验会较好。 具体技术实现办法：下单后，马上减去库存。另外设置一个定时脚本，扫描超过30分未支付的订单，把订单中的商品数量返回到库存中去，订单关闭。 如唯品会的购物下单： 为什么使用虚拟库存和真实库存两套方案？ 假设库存数是50，a订单购买了5个件商品，支付完毕，库存数减去5，库存数变成了45件。 由于还没有发货，实际库存中还有50件商品，这样会出现混淆了。 使用两套库存记录方案是有必要的！ 下单-操作虚拟库存数 商品发货出库-操作真实库存数 五、减少频繁读数据库的压力 用户每次点击一个商品详情页面，都要读取库存，判断：有没有库存。如果读库存走的是数据库判断，很多人来抢购的情况下，数据库的压力会很大。 假设是1万个用户同时访问抢购页面，数据库接受的访问次数是1万个并发。 用户还要进行刷新页面操作，由于每次刷新都会走数据库判断库存。数量会更大，数据库的压力就更大了。所以最好是，把库存总数，缓存在redis中去。 内存中缓存的库存数量，只用来做读判断，这样压力扛住了。而更改数据库的库存总数了，程序马上要把库存总数，同步到缓存中去。 系统抗压力问题： 如何限流？ 如何防止恶意刷数据？ 防止限流就是写代码去阻止部分人进行频繁请求，为了识别是机器还是人工。加一些友好一点的验证码，这样不管是从体验上还是从系统的稳定性方面都是比较好的。 如下图淘宝做的验证： 滑块验证码方案，验证码后台针对用户产生的行为轨迹数据进行机器学习建模，结合访问频率、地理位置、历史记录等多个维度信息，快速、准确的返回人机判定结果。 攻与防技术都是在对抗中不断升级的，无解的验证码还不存在，但防的一方可以不断提升破解成本。 应用选择滑块验证，也有部分因素是因为竞争激烈的互联网很看重用户体验。拖动毕竟是趣味性交互且容易完成，而图形验证码既容易被黑客攻破，对用户也并没有那么友好——肉眼识别无趣（可能还很艰难），键盘手动输入更浪费时间，体验不太好。 总结 本文介绍了产品在设计抢购闪购商品活动中应该注意的几点事项，在设计闪购活动时，会围绕如何处理并发、扣除库存、防止恶意刷数据等问题。 各公司可以先根据自己的业务情况来设计相对应的方案，然后再用成本计算法，反算开发时间与成本，这样既保证了项目进度，性能体验等也不错。 作者：香鱼来源：人人都是产品经理 据说，只有打赏的才是真粉丝哦，8块8请小编喝杯咖啡吧，长按二维码勾搭小编微信（yujielin912)加入91运营社群，全年100多场免费公开课，定期问题答疑等着你，会运营的人都在这里了！" />
<link rel="canonical" href="https://mlh.app/2019/04/18/728075.html" />
<meta property="og:url" content="https://mlh.app/2019/04/18/728075.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-18T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"91运营社群招募中，勾搭小编微信号：yujielin912入社群 每周91公开课，91风暴，全员参与，实际案例实际分析 问题答疑，你提问题我解答 行业专场，互联网金融，电商，新媒体运营等专场 各地分站交流 资源及人脉共享 其他的。。。。 欢迎各行业互联网运营达人加入我们91运营大家庭，会运营的人都来这里了！ 导读：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？ 正文 ———— / BEGIN / ———— 案例：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？ 页面上面的设计，这里我就不多说了，各大网站上都有很多案例了！ 现在我重点来讲一下需要注意的几点： 一、超卖问题 假如你的库存有10，现在3个用户来购买，a用户购买3个，b用户购买5个，c用户购买3个，合起来就是准备购买11个。 如果三个用户是同时并发购买，会出现怎样的情况呢？ 每个用户进行减库存的时候，数据库都会去修改一下数据，如下：update goods set amount=amount-购买数量 where goods_id=xxx。 mysql会锁定这一行数据（使用innodb存储引擎），数据库加的是排他锁。 根据排他锁的特点：其他线程不能读、不能写此行数据。 排他锁情况下，那么其他用户就是等待状态了。 1. a用户执行update的时候，锁定库存数据。update执行完毕后，减去了3个后，mysql自动释放锁。 2. b用户执行，减去了5个。此时，已经卖掉8个库存了，库存数为2了。 3. 但是c用户接着执行，Update goods set amount=amount-1 where goods_id=xxx。 结果库存数量变成-1了。 思考：把库存数量字段的类型，设计成正数类型，不允许出现负数，会怎么样呢? 测验结果：数据库会直接报错，通不过。 解决办法：只有库存数量，大于或等于购买数量的时候，才能去减库存；其他情况，提示信息，库存不足。 二、并发的问题 为了更好的理解并发和同步，我们需要先明白两个重要的概念：同步和异步。 同步和异步的区别和联系： 所谓同步，可以理解为在执行完一个函数或方法之后，一直等待系统返回值或消息，这时程序是出于阻塞的，只有接收到返回的值或消息后才往下执行其它的命令。 异步，执行完函数或方法后，不必阻塞性地等待返回值或消息，只需要向系统委托一个异步过程，那么当系统接收到返回值或消息时，系统会自动触发委托的异步过程，从而完成一个完整的流程。 同步在一定程度上可以看做是单线程，这个线程请求一个方法后就待这个方法给他回复，否则他不往下执行。异步在一定程度上可以看做是多线程的，请求一个方法后，就不管了，继续执行其他的方法。 如何处理并发和同步？ 首先需要明白，锁机制有两个层面： 一种是代码层次上的，如：java中的同步锁，典型的就是同步关键字synchronized，这里我不在做过多的讲解； 另外一种是数据库层次上的，比较典型的就是悲观锁和乐观锁。这里我们重点讲解的就是悲观锁（传统的物理锁）和乐观锁。 悲观锁（Pessimistic Locking）： 悲观锁，正如其名，它指的是对数据被外界（包括本系统当前的其他事务，以及来自&nbsp;外部系统的事务处理）修改持保守态度，因此，在整个数据处理过程中，将数据处于锁定状态。 悲观锁的实现，往往依靠数据库提供的锁机制（也只有数据库层提供的锁机制才能&nbsp;真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系&nbsp;统不会修改数据）。 第一种问题中描述的超卖现象，其实是并发抢购时出现的情况。用到的是数据库内带的加排他锁方式，阻止了其他线程读取、访问数据，这样等待的时间就比较长。而业界一般的解决是使用乐观锁的办法来解决：使用数据库的乐观锁是通用解决办法。 乐观锁： 相对悲观锁而言，乐观锁机制采取了更加宽松的加锁机制。悲观锁大多数情况下依靠数据库的锁机制实现，以保证操作最大程度的独占性。 但随之而来的就是数据库性能的大量开销，特别是对长事务而言，这样的开销往往无法承受。 如：一个金融系统，当某个操作员读取用户的数据，并在读出的用户数据的基础上进&nbsp;行修改时（如更改用户帐户余额），如果采用悲观锁机制，也就意味着整个操作过程中（从操作员读出数据、开始修改直至提交修改结果的全过程，甚至还包括操作员中途去煮咖啡的时间），数据库记录始终处于加锁状态。 可以想见：如果面对几百上千个并发，这样的情况将导致怎样的后果。 乐观锁机制在一定程度上解决了这个问题。 通俗说就是：修改数据的时候，不给数据加锁。 乐观锁意思是不锁定表的情况下，利用业务的控制来解决并发问题，这样即保证数据的并发可读性又保证保存数据的排他性，保证性能的同时解决了并发带来的脏数据问题。 所以很多情况下都会采用乐观锁来解决业务上的问题。 高并发的解决方法主要有以下几点： （1）前台优化 减少http请求——css文件合并&nbsp; ，js文件合并； 压缩js，css文件； 使用雪碧图； 懒加载（只加载看到的第一屏内容，下拉之后看到其他的内容）； 预加载（只加载默认图）； cdn 加速。 （2）服务端优化： 页面静态化； 负载均衡、集群； 分布式； 使用队列。 （3）MySQL优化： 查询优化，能单表的单表 查询一条数据使用limit 生成查询缓存 使用索引 多表查询使用id进行关联 数据库分表 数据库分区 数据库集群 要查询的字段避免使用*号，指定需要的字段 避免使用%前缀的模糊查询 避免使用负向查询 避免使用or查询 避免使用子查询 避免使用MySQL自带函数 不要是rand 有顺序的读取 设置合适的数据类型 避免使用text类型 避免使用null （4）代码优化： 用单引号代替双引号，双引号会查询变量； 避免使用require_once require_once会判断文件是否加载过； 使用静态方法代替普通方法，静态方法速度比普通方法快4倍； 变量使用完之后需要销毁； 尽量不要使用@； include用绝对路径，不要使用相对路径，相对路径会有查询的过程； 避免使用__SET __GET __AUTOLOAD； 循环的时候先确定循环次数，不要每次循环都要计算； 避免循环查库； 避免多层foreach嵌套； 避免使用递归 ，递归比较浪费资源。 三、下单和减库存要在一个事务中 如果不在一个事务内，可能出现两种现象： 1. 订单入库失败、减库存成功。发现订单入库失败，减库存就不要继续进行下去了。 2. 订单入库成功、减库存失败。实际下了20个订单，库存却没有减。数据不一致了。 四、设计虚拟库存和真实库存两套方案 有些人下单完后，最终并不会去付款。 如果一下单就马上减库存,很多人下单，最终并不会去付款，可能导致库存数最后为0，别的用户无法下单了。 而实际中仓库中却有库存在——这样库存数据是不准确的。 什么时候减库存？ 是下单完成减库存、还是付款完后减库存呢? 付款后，才减库存，可能出现的现象：用户下完单，接着去付款，结果库存不够了，这样用户体验很不好。但是淘宝的设计是3天（大厂就是比较任性哦） 买家拍下商品后，“等待买家付款”的状态下系统会给予买家3天的时间进行付款，此时的付款动作是将钱款支付到支付宝公司。 此付款时间无法延长，若逾期未付款，交易将自动关闭，如您仍想购买，建议重新购买并及时付款。但是如果下完单就减库存，并能够保证用户下单只要付款，就一定能买到这个商品。 这样的用户体验会较好。 具体技术实现办法：下单后，马上减去库存。另外设置一个定时脚本，扫描超过30分未支付的订单，把订单中的商品数量返回到库存中去，订单关闭。 如唯品会的购物下单： 为什么使用虚拟库存和真实库存两套方案？ 假设库存数是50，a订单购买了5个件商品，支付完毕，库存数减去5，库存数变成了45件。 由于还没有发货，实际库存中还有50件商品，这样会出现混淆了。 使用两套库存记录方案是有必要的！ 下单-操作虚拟库存数 商品发货出库-操作真实库存数 五、减少频繁读数据库的压力 用户每次点击一个商品详情页面，都要读取库存，判断：有没有库存。如果读库存走的是数据库判断，很多人来抢购的情况下，数据库的压力会很大。 假设是1万个用户同时访问抢购页面，数据库接受的访问次数是1万个并发。 用户还要进行刷新页面操作，由于每次刷新都会走数据库判断库存。数量会更大，数据库的压力就更大了。所以最好是，把库存总数，缓存在redis中去。 内存中缓存的库存数量，只用来做读判断，这样压力扛住了。而更改数据库的库存总数了，程序马上要把库存总数，同步到缓存中去。 系统抗压力问题： 如何限流？ 如何防止恶意刷数据？ 防止限流就是写代码去阻止部分人进行频繁请求，为了识别是机器还是人工。加一些友好一点的验证码，这样不管是从体验上还是从系统的稳定性方面都是比较好的。 如下图淘宝做的验证： 滑块验证码方案，验证码后台针对用户产生的行为轨迹数据进行机器学习建模，结合访问频率、地理位置、历史记录等多个维度信息，快速、准确的返回人机判定结果。 攻与防技术都是在对抗中不断升级的，无解的验证码还不存在，但防的一方可以不断提升破解成本。 应用选择滑块验证，也有部分因素是因为竞争激烈的互联网很看重用户体验。拖动毕竟是趣味性交互且容易完成，而图形验证码既容易被黑客攻破，对用户也并没有那么友好——肉眼识别无趣（可能还很艰难），键盘手动输入更浪费时间，体验不太好。 总结 本文介绍了产品在设计抢购闪购商品活动中应该注意的几点事项，在设计闪购活动时，会围绕如何处理并发、扣除库存、防止恶意刷数据等问题。 各公司可以先根据自己的业务情况来设计相对应的方案，然后再用成本计算法，反算开发时间与成本，这样既保证了项目进度，性能体验等也不错。 作者：香鱼来源：人人都是产品经理 据说，只有打赏的才是真粉丝哦，8块8请小编喝杯咖啡吧，长按二维码勾搭小编微信（yujielin912)加入91运营社群，全年100多场免费公开课，定期问题答疑等着你，会运营的人都在这里了！","@type":"BlogPosting","url":"https://mlh.app/2019/04/18/728075.html","headline":"设计抢购业务时，请务必注意这4个要点","dateModified":"2019-04-18T00:00:00+08:00","datePublished":"2019-04-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/18/728075.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>设计抢购业务时，请务必注意这4个要点</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <section class="xmteditor" style="display:none;" data-tools="新媒体管家" data-label="powered by xmt.cn"></section> 
<section data-role="outer" label="Powered by 135editor.com" style="font-size: 16px;" data-mpa-powered-by="yiban.io"> 
 <section data-role="outer" label="Powered by 135editor.com"> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: rgb(63, 63, 63);font-size: 15px;"></span></p> 
  <section style="font-family: 微软雅黑;max-width: 100%;box-sizing: border-box;color: rgb(51, 51, 51);font-size: 16px;letter-spacing: 0.544px;text-align: justify;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;"> 
   <section style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"> 
    <section style="margin-top: 0.5em;margin-bottom: 0.5em;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"> 
     <section style="max-width: 100%;box-sizing: border-box;border-width: 2px 0px;border-style: solid;border-color: rgb(95, 156, 239);overflow-wrap: break-word !important;"> 
      <section style="margin-top: -0.5em;margin-bottom: 0.1em;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"> 
       <section style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"> 
        <section style="max-width: 100%;box-sizing: border-box;text-align: center;overflow-wrap: break-word !important;"> 
         <section style="max-width: 100%;box-sizing: border-box;color: rgb(95, 156, 239);overflow-wrap: break-word !important;"> 
          <p style="max-width: 100%;box-sizing: border-box;min-height: 1em;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 41, 65);box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">91运营社群招募中，勾搭小编微信号：yujielin912入社群</span></strong></p> 
         </section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
  <section style="font-family: 微软雅黑;max-width: 100%;color: rgb(51, 51, 51);font-size: 16px;letter-spacing: 0.544px;text-align: justify;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
   <section style="margin-top: 1.3em;max-width: 100%;display: inline-block;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
    <section style="margin-top: -1.5em;padding: 1em;max-width: 100%;border-radius: 0.5em;border-width: 0.1em;border-style: solid;border-color: rgb(204, 204, 204);width: 638px;box-sizing: border-box !important;overflow-wrap: break-word !important;height: auto !important;"> 
     <section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
      <section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
       <section style="padding-right: 10px;padding-left: 10px;max-width: 100%;font-size: 14px;color: rgba(38, 38, 39, 0.992);box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
        <section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
         <ul class=" list-paddingleft-2" style="list-style-type: circle;"> 
          <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">每周91公开课，91风暴，全员参与，实际案例实际分析</span></p></li> 
          <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">问题答疑，你提问题我解答</span></p></li> 
          <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">行业专场，互联网金融，电商，新媒体运营等专场</span></p></li> 
          <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">各地分站交流</span></p></li> 
          <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 1.6;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">资源及人脉共享</span></p></li> 
          <li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 1.6;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">其他的。。。。</span></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 1.6;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p></li> 
         </ul> 
         <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 1.6;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">欢迎各行业互联网运营达人加入我们91运营大家庭，会运营的人都来这里了！</span></p> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
  <section class="" data-id="86005" style="font-family: 微软雅黑;max-width: 100%;box-sizing: border-box;color: rgb(51, 51, 51);font-size: 16px;letter-spacing: 0.544px;text-align: justify;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;"> 
   <section class="" style="margin-bottom: 16px;padding: 16px;max-width: 100%;box-sizing: border-box;overflow-wrap: normal;overflow: auto;font-size: 15px;line-height: 1.45;border-radius: 3px;background-color: rgb(247, 247, 247);"> 
    <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">导读：</strong></span><span style="max-width: 100%;background-color: rgb(255, 255, 255);color: rgb(63, 63, 63);font-family: 微软雅黑;font-size: 15px;letter-spacing: 1px;text-align: justify;box-sizing: border-box !important;overflow-wrap: break-word !important;">马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？</span></p> 
   </section> 
  </section> 
  <section donone="shifuMouseDown('shifu_t_018')" style="font-family: inherit;margin-top: 2em;padding-top: 0.5em;padding-bottom: 0.5em;max-width: 100%;font-size: 1em;font-weight: inherit;text-align: justify;white-space: normal;text-decoration: inherit;background-color: rgb(255, 255, 255);letter-spacing: 0.476px;line-height: 25.6px;border-style: solid none none;border-top-width: 1px;border-top-color: rgb(204, 204, 204);color: rgb(166, 166, 166);box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
   <p style="margin-top: -1.2em;max-width: 100%;min-height: 1em;text-align: center;border-width: initial;border-style: none;border-color: initial;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="padding: 8px 23px;max-width: 100%;border-radius: 25px;color: rgb(255, 255, 255);font-family: inherit;font-weight: inherit;text-decoration: inherit;border-color: rgb(102, 214, 166);background-color: rgb(102, 214, 166);box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></strong></span></p> 
   <p style="margin-top: -1.2em;max-width: 100%;min-height: 1em;text-align: center;border-width: initial;border-style: none;border-color: initial;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="padding: 8px 23px;max-width: 100%;border-radius: 25px;color: rgb(255, 255, 255);font-family: inherit;font-weight: inherit;text-decoration: inherit;border-color: rgb(102, 214, 166);background-color: rgb(102, 214, 166);box-sizing: border-box !important;overflow-wrap: break-word !important;">正文</span></strong></span></p> 
  </section> 
  <p style="font-family: 微软雅黑;text-align: center;margin-left: 10px;margin-right: 10px;letter-spacing: 0px;"><span style="color: #3F3F3F;font-size: 15px;">———— / BEGIN / ————</span></p> 
  <p style="font-family: 微软雅黑;margin-left: 10px;margin-right: 10px;letter-spacing: 0px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">案例：马上就到双十一了，上级给我安排了一个秒杀抢购的活动，让我设计一个方案，那我应该如何下手呢？</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">页面上面的设计，这里我就不多说了，各大网站上都有很多案例了！</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><img class="aligncenter" data-ratio="0.5265700483091788" data-src="https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2w2ldBiazGnVvAKZSBM2jMdV4n0FkTbML0I7360WxZQicnvfj6bJdxa0Q/640" data-type="png" data-w="621" height="327" style="caret-color: red;border-style: none;margin-left: auto;margin-right: auto;display: block;cursor: pointer;user-select: text !important;" width="621" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2w2ldBiazGnVvAKZSBM2jMdV4n0FkTbML0I7360WxZQicnvfj6bJdxa0Q/640"></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">现在我重点来讲一下需要注意的几点：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #00B0F0;font-size: 20px;"><strong>一、超卖问题</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">假如你的库存有10，现在3个用户来购买，a用户购买3个，b用户购买5个，c用户购买3个，合起来就是准备购买11个。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如果三个用户是同时并发购买，会出现怎样的情况呢？</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">每个用户进行减库存的时候，数据库都会去修改一下数据，如下：update goods set amount=amount-购买数量 where goods_id=xxx。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">mysql会锁定这一行数据（使用innodb存储引擎），数据库加的是排他锁。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">根据排他锁的特点：<strong>其他线程不能读、不能写此行数据。</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">排他锁情况下，那么其他用户就是等待状态了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">1. a用户执行update的时候，锁定库存数据。update执行完毕后，减去了3个后，mysql自动释放锁。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">2. b用户执行，减去了5个。此时，已经卖掉8个库存了，库存数为2了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">3. 但是c用户接着执行，Update goods set amount=amount-1 where goods_id=xxx。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">结果库存数量变成-1了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">思考：把库存数量字段的类型，设计成正数类型，不允许出现负数，会怎么样呢?</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">测验结果：数据库会直接报错，通不过。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">解决办法：只有库存数量，大于或等于购买数量的时候，才能去减库存；其他情况，提示信息，库存不足。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><img class="aligncenter" data-ratio="0.44768439108061747" data-src="https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2Bwpib2B5mFmSwsBAGX03drnicibL58Lu9J7k8Og4OLTniaaEBcBdyZ0icKw/640" data-type="png" data-w="583" height="261" style="caret-color: red;border-style: none;margin-left: auto;margin-right: auto;display: block;cursor: pointer;user-select: text !important;" width="583" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2Bwpib2B5mFmSwsBAGX03drnicibL58Lu9J7k8Og4OLTniaaEBcBdyZ0icKw/640"></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #00B0F0;font-size: 20px;"><strong>二、并发的问题</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">为了更好的理解并发和同步，我们需要先明白两个重要的概念：同步和异步。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">同步和异步的区别和联系：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: circle;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">所谓同步，可以理解为在执行完一个函数或方法之后，一直等待系统返回值或消息，这时程序是出于阻塞的，只有接收到返回的值或消息后才往下执行其它的命令。</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: circle;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">异步，执行完函数或方法后，不必阻塞性地等待返回值或消息，只需要向系统委托一个异步过程，那么当系统接收到返回值或消息时，系统会自动触发委托的异步过程，从而完成一个完整的流程。</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">同步在一定程度上可以看做是单线程，这个线程请求一个方法后就待这个方法给他回复，否则他不往下执行。异步在一定程度上可以看做是多线程的，请求一个方法后，就不管了，继续执行其他的方法。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如何处理并发和同步？</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">首先需要明白，锁机制有两个层面：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: circle;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">一种是代码层次上的，如：java中的同步锁，典型的就是同步关键字synchronized，这里我不在做过多的讲解；</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: circle;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">另外一种是数据库层次上的，比较典型的就是悲观锁和乐观锁。这里我们重点讲解的就是悲观锁（传统的物理锁）和乐观锁。</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">悲观锁</span></strong><span style="color: #3F3F3F;font-size: 15px;">（Pessimistic Locking）：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">悲观锁，正如其名，它指的是对数据被外界（包括本系统当前的其他事务，以及来自&nbsp;外部系统的事务处理）修改持保守态度，因此，在整个数据处理过程中，将数据处于锁定状态。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">悲观锁的实现，往往依靠数据库提供的锁机制（也只有数据库层提供的锁机制才能&nbsp;真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系&nbsp;统不会修改数据）。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">第一种问题中描述的超卖现象，其实是并发抢购时出现的情况。用到的是数据库内带的加排他锁方式，阻止了其他线程读取、访问数据，这样等待的时间就比较长。而业界一般的解决是使用乐观锁的办法来解决：使用数据库的乐观锁是通用解决办法。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">乐观锁：</span></strong></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">相对悲观锁而言，乐观锁机制采取了更加宽松的加锁机制。悲观锁大多数情况下依靠数据库的锁机制实现，以保证操作最大程度的独占性。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">但随之而来的就是数据库性能的大量开销，特别是对长事务而言，这样的开销往往无法承受。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如：一个金融系统，当某个操作员读取用户的数据，并在读出的用户数据的基础上进&nbsp;行修改时（如更改用户帐户余额），如果采用悲观锁机制，也就意味着整个操作过程中（从操作员读出数据、开始修改直至提交修改结果的全过程，甚至还包括操作员中途去煮咖啡的时间），数据库记录始终处于加锁状态。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">可以想见：如果面对几百上千个并发，这样的情况将导致怎样的后果。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">乐观锁机制在一定程度上解决了这个问题。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">通俗说就是：<strong>修改数据的时候，不给数据加锁。</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">乐观锁意思是不锁定表的情况下，利用业务的控制来解决并发问题，这样即保证数据的并发可读性又保证保存数据的排他性，保证性能的同时解决了并发带来的脏数据问题。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">所以很多情况下都会采用乐观锁来解决业务上的问题。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">高并发的解决方法主要有以下几点：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">（1）前台优化</span></strong></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: square;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">减少http请求——css文件合并&nbsp; ，js文件合并；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">压缩js，css文件；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">使用雪碧图；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">懒加载（只加载看到的第一屏内容，下拉之后看到其他的内容）；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">预加载（只加载默认图）；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">cdn 加速。</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">（2）服务端优化：</span></strong></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: square;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">页面静态化；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">负载均衡、集群；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">分布式；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">使用队列。</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">（3）MySQL优化：</span></strong></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: square;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">查询优化，能单表的单表</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">查询一条数据使用limit</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">生成查询缓存</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">使用索引</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">多表查询使用id进行关联</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">数据库分表</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">数据库分区</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">数据库集群</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">要查询的字段避免使用*号，指定需要的字段</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用%前缀的模糊查询</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用负向查询</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用or查询</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用子查询</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用MySQL自带函数</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">不要是rand</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">有顺序的读取</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">设置合适的数据类型</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用text类型</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用null</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">（4）代码优化：</span></strong></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ul class=" list-paddingleft-2" style="list-style-type: square;"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">用单引号代替双引号，双引号会查询变量；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用require_once require_once会判断文件是否加载过；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">使用静态方法代替普通方法，静态方法速度比普通方法快4倍；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">变量使用完之后需要销毁；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">尽量不要使用@；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">include用绝对路径，不要使用相对路径，相对路径会有查询的过程；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用__SET __GET __AUTOLOAD；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">循环的时候先确定循环次数，不要每次循环都要计算；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免循环查库；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免多层foreach嵌套；</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">避免使用递归 ，递归比较浪费资源。</span></p></li> 
  </ul> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #00B0F0;font-size: 20px;"><strong>三、下单和减库存要在一个事务中</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如果不在一个事务内，可能出现两种现象：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">1. 订单入库失败、减库存成功。</span></strong><span style="color: #3F3F3F;font-size: 15px;">发现订单入库失败，减库存就不要继续进行下去了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><strong><span style="color: #3F3F3F;font-size: 15px;">2. 订单入库成功、减库存失败。</span></strong><span style="color: #3F3F3F;font-size: 15px;">实际下了20个订单，库存却没有减。数据不一致了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #00B0F0;font-size: 20px;"><strong>四、设计虚拟库存和真实库存两套方案</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">有些人下单完后，最终并不会去付款。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如果一下单就马上减库存,很多人下单，最终并不会去付款，可能导致库存数最后为0，别的用户无法下单了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">而实际中仓库中却有库存在——这样库存数据是不准确的。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">什么时候减库存？</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">是下单完成减库存、还是付款完后减库存呢?</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">付款后，才减库存，可能出现的现象：用户下完单，接着去付款，结果库存不够了，这样用户体验很不好。但是淘宝的设计是3天（大厂就是比较任性哦）</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">买家拍下商品后，“等待买家付款”的状态下系统会给予买家3天的时间进行付款，此时的付款动作是将钱款支付到支付宝公司。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><img class="aligncenter" data-ratio="0.1601150527325024" data-src="https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2vGkmh3TPfXS2RhySW2JibWLd6Xc2APjULqCK3sRqYqelwYVZT9ensYA/640" data-type="png" data-w="1043" height="116" style="caret-color: red;border-style: none;margin-left: auto;margin-right: auto;display: block;cursor: pointer;user-select: text !important;" width="724" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2vGkmh3TPfXS2RhySW2JibWLd6Xc2APjULqCK3sRqYqelwYVZT9ensYA/640"></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">此付款时间无法延长，若逾期未付款，交易将自动关闭，如您仍想购买，建议重新购买并及时付款。但是如果下完单就减库存，并能够保证用户下单只要付款，就一定能买到这个商品。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">这样的用户体验会较好。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">具体技术实现办法：下单后，马上减去库存。另外设置一个定时脚本，扫描超过30分未支付的订单，把订单中的商品数量返回到库存中去，订单关闭。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如唯品会的购物下单：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><img class="aligncenter" data-ratio="0.5738317757009346" data-src="https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG29mdEGAMpTAbPiasp0SO0pErUnuibqHFj7ScoMS7uxicvpBibfzAAZRliaKQ/640" data-type="png" data-w="1070" height="396" style="caret-color: red;border-style: none;margin-left: auto;margin-right: auto;display: block;cursor: pointer;user-select: text !important;" width="690" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG29mdEGAMpTAbPiasp0SO0pErUnuibqHFj7ScoMS7uxicvpBibfzAAZRliaKQ/640"></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">为什么使用虚拟库存和真实库存两套方案？</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">假设库存数是50，a订单购买了5个件商品，支付完毕，库存数减去5，库存数变成了45件。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">由于还没有发货，实际库存中还有50件商品，这样会出现混淆了。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">使用两套库存记录方案是有必要的！</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ol class=" list-paddingleft-2"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">下单-操作虚拟库存数</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">商品发货出库-操作真实库存数</span></p></li> 
  </ol> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #00B0F0;font-size: 20px;"><strong>五、减少频繁读数据库的压力</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">用户每次点击一个商品详情页面，都要读取库存，判断：有没有库存。如果读库存走的是数据库判断，很多人来抢购的情况下，数据库的压力会很大。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">假设是1万个用户同时访问抢购页面，数据库接受的访问次数是1万个并发。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">用户还要进行刷新页面操作，由于每次刷新都会走数据库判断库存。数量会更大，数据库的压力就更大了。所以最好是，把库存总数，缓存在redis中去。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">内存中缓存的库存数量，只用来做读判断，这样压力扛住了。而更改数据库的库存总数了，程序马上要把库存总数，同步到缓存中去。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">系统抗压力问题：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <ol class=" list-paddingleft-2"> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如何限流？</span></p></li> 
   <li><p style="text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如何防止恶意刷数据？</span></p></li> 
  </ol> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">防止限流就是写代码去阻止部分人进行频繁请求，为了识别是机器还是人工。加一些友好一点的验证码，这样不管是从体验上还是从系统的稳定性方面都是比较好的。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">如下图淘宝做的验证：</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;"><img class="aligncenter" data-ratio="0.7559808612440191" data-src="https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2KVogUQ1picx1jto3UoNMiaUgUZeHFCDhaFcFj4icIr9iayYkLCZPOwZw8g/640" data-type="png" data-w="418" height="287" style="border-style: none;margin-left: auto;margin-right: auto;display: block;cursor: pointer;user-select: text !important;" width="380" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/icHOSb47jqpXriaC62MvFye3l6dLQ3usG2KVogUQ1picx1jto3UoNMiaUgUZeHFCDhaFcFj4icIr9iayYkLCZPOwZw8g/640"></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">滑块验证码方案，验证码后台针对用户产生的行为轨迹数据进行机器学习建模，结合访问频率、地理位置、历史记录等多个维度信息，快速、准确的返回人机判定结果。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">攻与防技术都是在对抗中不断升级的，无解的验证码还不存在，但防的一方可以不断提升破解成本。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">应用选择滑块验证，也有部分因素是因为竞争激烈的互联网很看重用户体验。拖动毕竟是趣味性交互且容易完成，而图形验证码既容易被黑客攻破，对用户也并没有那么友好——肉眼识别无趣（可能还很艰难），键盘手动输入更浪费时间，体验不太好。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #00B0F0;font-size: 20px;"><strong>总结</strong></span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">本文介绍了产品在设计抢购闪购商品活动中应该注意的几点事项，在设计闪购活动时，会围绕如何处理并发、扣除库存、防止恶意刷数据等问题。</span></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><br></p> 
  <p style="font-family: 微软雅黑;text-align: justify;margin-left: 10px;margin-right: 10px;letter-spacing: 1px;"><span style="color: #3F3F3F;font-size: 15px;">各公司可以先根据自己的业务情况来设计相对应的方案，然后再用成本计算法，反算开发时间与成本，这样既保证了项目进度，性能体验等也不错。</span></p> 
  <p style="font-family: 微软雅黑;text-align: center;margin-left: 10px;margin-right: 10px;letter-spacing: 0px;"><br></p> 
  <p style="margin-bottom: 15px;max-width: 100%;min-height: 1em;text-align: justify;white-space: normal;font-size: 17px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-size: 14px;"><span style="color:rgba(0, 0, 0, 0.8);font-family:PingFang SC, Hiragino Sans GB, Microsoft YaHei, STHeiti, WenQuanYi Micro Hei, Helvetica, Arial, sans-serif;"><span style="letter-spacing: 0.544px;">作者：</span></span><span style="max-width: 100%;font-size: 14px;text-align: justify;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color:#3f3f3f;font-family:微软雅黑;"><span style="letter-spacing: 1px;">香鱼<br></span></span></span></span><span style="color: rgba(0, 0, 0, 0.8);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;font-size: 14px;">来源：人人都是产品经理</span></p> 
  <p style="font-family: &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, STHeiti, &quot;WenQuanYi Micro Hei&quot;, Helvetica, Arial, sans-serif;margin-bottom: 15px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;text-align: justify;white-space: normal;font-size: 17px;background-color: rgb(255, 255, 255);color: rgba(0, 0, 0, 0.8);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;font-family: inherit;letter-spacing: 0.544px;color: rgb(62, 62, 62);line-height: 25.6px;font-style: inherit;text-align: center;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;">据说，只有打赏的才是真粉丝哦，8块8请小编喝杯咖啡吧，长按二维码勾搭小编微信（<span style="max-width: 100%;font-size: 14px;color: rgb(61, 167, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">yujielin912</span>)加入91运营社群，全年100多场免费公开课，定期问题答疑等着你，会运营的人都在这里了！</strong></p> 
  <section class="" data-tools="135编辑器" data-id="39" data-color="#00B0F0" style="font-family: 微软雅黑;max-width: 100%;box-sizing: border-box;color: rgb(51, 51, 51);font-size: 16px;letter-spacing: 0.544px;text-align: justify;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;"> 
   <section style="margin-top: 0.8em;margin-bottom: 0.5em;max-width: 100%;overflow: hidden;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
    <section class="" data-tools="135编辑器" data-id="86516" data-color="#00B0F0" style="max-width: 100%;box-sizing: border-box;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"> 
     <section style="margin-right: auto;margin-bottom: 10px;margin-left: auto;max-width: 100%;box-sizing: border-box;border-bottom: 1px solid rgb(221, 221, 221);overflow-wrap: break-word !important;"> 
      <section class="" data-tools="135编辑器" data-id="86516" style="max-width: 100%;box-sizing: border-box;line-height: 25.6px;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"> 
       <section class="" data-tools="135编辑器" data-id="86516" style="max-width: 100%;box-sizing: border-box;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"> 
        <p style="max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img class="" data-copyright="0" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/P2PKAhicicV4HeWEln5GvWLynibE3WL5UqTxcUSDicaFsTTVFSpfgWtBrJnsia1NibVlHWYoViatOyhSErxsN3po8ZeAA/640?wx_fmt=jpeg" data-type="jpeg" data-w="430" style="box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible !important;width: auto !important;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/P2PKAhicicV4HeWEln5GvWLynibE3WL5UqTxcUSDicaFsTTVFSpfgWtBrJnsia1NibVlHWYoViatOyhSErxsN3po8ZeAA/640?wx_fmt=jpeg"></p> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
  <p style="font-family: 微软雅黑;text-align: center;margin-left: 10px;margin-right: 10px;letter-spacing: 0px;"><span style="color: #3F3F3F;font-size: 15px;caret-color: red;"><br></span><br></p> 
 </section> 
</section>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

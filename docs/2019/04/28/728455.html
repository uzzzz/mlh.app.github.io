<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>漫画：如何给女朋友解释什么是单例模式？ 技术头条 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="漫画：如何给女朋友解释什么是单例模式？ 技术头条" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="责编&nbsp;| 伍杏玲 本文经授权转载自漫话编程（ID：mhcoding） 周末了，临近五一劳动节，女朋友还没有想好要去哪里玩，还在看着各种攻略。我则在旁边一边看书默默的心疼着我的钱包。突然女朋友开始发问： 什么是单例 单例模式，也叫单子模式，是一种常用的软件设计模式。在应用这个模式时，单例对象的类必须保证只有一个实例存在。 许多时候整个系统只需要拥有一个的全局对象，这样有利于我们协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息。这种方式简化了在复杂环境下的配置管理。 对于代码开发中，一个类同时只有一个实例对象的情况就叫做单例。那么，如何保证一个类只能有一个对象呢？ 我们知道，在面向对象的思想中，通过类的构造函数可以创建对象，只要内存足够，可以创建任意个对象。 所以，要想限制某一个类只有一个单例对象，就需要在他的构造函数上下功夫。 实现对象单例模式的思路是： 1、一个类能返回对象一个引用(永远是同一个)和一个获得该实例的方法（必须是静态方法，通常使用getInstance这个名称）； 2、当我们调用这个方法时，如果类持有的引用不为空就返回这个引用，如果类保持的引用为空就创建该类的实例并将实例的引用赋予该类保持的引用； 3、同时我们还将该类的构造函数定义为私有方法，这样其他处的代码就无法通过调用该类的构造函数来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例。 public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(instance&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 以上Java代码，就实现了一个简单的单例模式。我们通过将构造方法定义为私有，然后提供一个getInstance方法，该方法中来判断是否已经存在该类的实例，如果存在直接返回。如果不存在则创建一个再返回。 线程安全的单例 在中国，想要拥有一个妻子，需要男女双方带着各自的户口本一起去民政局领证。民政局的工作人员会先在系统中查询双方的婚姻状况，然后再办理登记手续。之所以可以保证一夫一妻登记成功的前提是不会发生并发问题。 假设某男子可以做到在同一时间分别和两个不同的女子来登记，就有一种概率是当工作人员查询的时候他并没有结婚，然后就可能给他登记两次结婚。当然，这种情况在现实生活中是根本不可能发生的。 但是，在程序中，一旦有多线程场景，这种情况就很常见。就像上面的代码。 如果有两个线程同时执行到if(instance==null)这行代码，这是判断都会通过，然后各自会执行instance = new Singleton();并各自返回一个instance，这时候就产生了多个实例，就没有保证单例！ 上面这种单例的实现方式我们通常称之为懒汉模式，所谓懒汉，指的是只有在需要对象的时候才会生成（getInstance方法被调用的时候才会生成）。 上面的这种懒汉模式并不是线程安全的，所以并不建议在日常开发中使用。基于这种模式，我们可以实现一个线程安全的单例的，如下： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;synchronized&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(instance&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 通过在getInstance方法上增加synchronized，通过锁来解决并发问题。这种实现方式就不会发生有多个对象被创建的问题了。 双重校验锁 上面这种线程安全的懒汉写法能够在多线程中很好的工作，但是，遗憾的是，这种做法效率很低，因为只有第一次初始化的时候才需要进行并发控制，大多数情况下是不需要同步的。 我们其实可以把上述代码做一些优化的，因为懒汉模式中使用synchronized定义一个同步方法，我们知道，synchronized还可以用来定义同步代码块，而同步代码块的粒度要比同步方法小一些，从而效率就会高一些。如以下代码： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;static&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getSingleton()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 上面这种形式，只有在singleton == null的情况下再进行加锁创建对象，如果singleton!=null的话，就直接返回就行了，并没有进行并发控制。大大的提升了效率。 从上面的代码中可以看到，其实整个过程中进行了两次singleton == null的判断，所以这种方法被称之为&quot;双重校验锁&quot;。 还有值得注意的是，双重校验锁的实现方式中，静态成员变量singleton必须通过volatile来修饰，保证其初始化的原子性，否则可能被引用到一个未初始化完成的对象。 为什么双重校验锁需要使用volatile来修饰静态成员变量singleton？为什么线程安全的懒汉就不需要呢？关于这个问题，后续文章深入讲解。 饿汉模式 前面提到的懒汉模式，其实是一种Lazy-Loading思想的实践，这种实现有一个比较大的好处，就是只有真正用到的时候才创建，如果没被使用到，就一直不会被创建，这就避免了不必要的开销。 但是这种做法，其实也有一个小缺点，就是第一次使用的时候，需要进行初始化操作，可能会有比较高的耗时。如果是已知某一个对象一定会使用到的话，其实可以采用一种饿汉的实现方式。 所谓饿汉，就是事先准备好，需要的时候直接给你就行了。这就是日常中比较常见的&quot;先买票后上车&quot;，走正常的手续。 如以下代码，饿汉模式： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 或者以下代码，饿汉变种： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 以上两段代码其实没有本质的区别，都是通过static来实例化类对象。饿汉模式中的静态变量是随着类加载时被完成初始化的。饿汉变种中的静态代码块也会随着类的加载一块执行。 以上两个饿汉方法，其实都是通过定义静态的成员变量，以保证instance可以在类初始化的时候被实例化。 因为类的初始化是由ClassLoader完成的，这其实是利用了ClassLoader的线程安全机制。ClassLoader的loadClass方法在加载类的时候使用了synchronized关键字。也正是因为这样， 除非被重写，这个方法默认在整个装载过程中都是同步的（线程安全的） 除了以上两种饿汉方式，还有一种实现方式也是借助了calss的初始化来实现的，那就是通过静态内部类来实现的单例： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;SingletonHolder&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Singleton&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SingletonHolder.INSTANCE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 前面提到的饿汉模式，只要Singleton类被装载了，那么instance就会被实例化。 而这种方式是Singleton类被装载了，instance不一定被初始化。因为SingletonHolder类没有被主动使用，只有显示通过调用getInstance方法时，才会显示装载SingletonHolder类，从而实例化instance。 使用静态内部类，借助了classloader来实现了线程安全，这与饿汉模式有着异曲同工之妙，但是他有兼顾了懒汉模式的Lazy-Loading功能，相比较之下，有很大优势。 单例的破坏 前文介绍过，我们实现的单例，把构造方法设置为私有方法来避免外部调用是很重要的一个前提。但是，私有的构造方法外部真的就完全不能调用了么？ 其实不是的，我们是可以通过反射来调用类中的私有方法的，构造方法也不例外，所以，我们可以通过反射来破坏单例。 除了这种情况，还有一种比较容易被忽视的情况，那就是其实对象的序列化和反序列化也会破坏单例。 如使用ObjectInputStream进行反序列化时，在ObjectInputStream的readObject生成对象的过程中，其实会通过反射的方式调用无参构造方法新建一个对象。 所以，在对单例对象进行序列化以及反序列化的时候，一定要考虑到这种单例可能被破坏的情况。 可以通过在Singleton类中定义readResolve的方式，解决该问题： /**&nbsp;*&nbsp;使用双重校验锁方式实现单例&nbsp;*/public&nbsp;class&nbsp;Singleton&nbsp;implements&nbsp;Serializable{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;static&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getSingleton()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object&nbsp;readResolve()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;}}&nbsp;&nbsp;&nbsp;&nbsp; 枚举实现单例 在StakcOverflow中，有一个关于What is an efficient way to implement a singleton pattern in Java？的讨论： 如上图，得票率最高的回答是：使用枚举。 回答者引用了Joshua Bloch大神在《Effective Java》中明确表达过的观点： 使用枚举实现单例的方法虽然还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。 如果你真的深入理解了单例的用法以及一些可能存在的坑的话，那么你也许也能得到相同的结论，那就是：使用枚举实现单例是一种很好的方法。 枚举实现单例： public&nbsp;enum&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;whateverMethod()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp; 以上，就实现了一个非常简单的单例，从代码行数上看，他比之前介绍过的任何一种都要精简，并且，他还是线程安全的。 这些，其实还不足以说服我们这种方式最优。但是还有个至关重要的原因，那就是：枚举可解决反序列化会破坏单例的问题。 关于这个知识点，大家可以参考《为什么我墙裂建议大家使用枚举来实现单例》这篇文章，里面详细的阐述了关于枚举与单例的所有知识点。 不使用Synchronized实现单例 前面讲过的所有方式，只要是线程安全的，其实都直接或者间接用到了synchronized，那么，如果不能使用synchronized的话，怎么实现单例呢？ 使用Lock？这当然可以了，但是其实根本还是加锁，有没有不用锁的方式呢？ 答案是有的，那就是CAS。CAS是一项乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。 在JDK1.5 中新增java.util.concurrent(J.U.C)就是建立在CAS之上的。相对于对于synchronized这种阻塞算法，CAS是非阻塞算法的一种常见实现。所以J.U.C在性能上有了很大的提升。 借助CAS（AtomicReference）实现单例模式： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;AtomicReference&lt;Singleton&gt;&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;AtomicReference&lt;Singleton&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton()&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(;;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Singleton&nbsp;singleton&nbsp;=&nbsp;INSTANCE.get();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;!=&nbsp;singleton)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(INSTANCE.compareAndSet(null,&nbsp;singleton))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;}}&nbsp; 用CAS的好处在于不需要使用传统的锁机制来保证线程安全,CAS是一种基于忙等待的算法,依赖底层硬件的实现,相对于锁它没有线程切换和阻塞的额外消耗,可以支持较大的并行度。 使用CAS实现单例只是个思路而已，只是拓展一下帮助读者熟练掌握CAS以及单例等知识、千万不要在代码中使用！！！这个代码其实有很大的优化空间。聪明的你，知道以上代码存在哪些隐患吗？ 作为码一代，想教码二代却无从下手： 听说少儿编程很火，可它有哪些好处呢？ 孩子多大开始学习比较好呢？又该如何学习呢？ 最新的编程教育政策又有哪些呢？ 下面给大家介绍CSDN新成员：极客宝宝（ID：geek_baby） 戳他了解更多↓↓↓ &nbsp;热 文&nbsp;推 荐&nbsp; ☞&nbsp;马云：腾讯是阿里的成长伴侣；华为 2 万 CNBG 员工“投奔”余承东；18 岁学生索赔苹果 10 亿美元 | 极客头条 ☞&nbsp;取代 JavaScript！Python 成 Stack Overflow 最受质疑编程语言 ☞&nbsp;流量为王，程序员如何打破 8 秒原则？| 技术头条 ☞ 5G 赋能教育信息化？ ☞ 源码泄露是裁员报复还是程序员反抗 996？ ☞&nbsp;深入浅出Docker 镜像 | 技术头条 ☞ 特斯拉全新自动驾驶芯片最强？英伟达回怼，投资者用脚投票 ☞ 她说：为啥程序员都特想要机械键盘？这答案我服！ ☞ 西安奔驰女车主哭诉维权背后, 区块链究竟能否还消费者以尊严？ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢" />
<meta property="og:description" content="责编&nbsp;| 伍杏玲 本文经授权转载自漫话编程（ID：mhcoding） 周末了，临近五一劳动节，女朋友还没有想好要去哪里玩，还在看着各种攻略。我则在旁边一边看书默默的心疼着我的钱包。突然女朋友开始发问： 什么是单例 单例模式，也叫单子模式，是一种常用的软件设计模式。在应用这个模式时，单例对象的类必须保证只有一个实例存在。 许多时候整个系统只需要拥有一个的全局对象，这样有利于我们协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息。这种方式简化了在复杂环境下的配置管理。 对于代码开发中，一个类同时只有一个实例对象的情况就叫做单例。那么，如何保证一个类只能有一个对象呢？ 我们知道，在面向对象的思想中，通过类的构造函数可以创建对象，只要内存足够，可以创建任意个对象。 所以，要想限制某一个类只有一个单例对象，就需要在他的构造函数上下功夫。 实现对象单例模式的思路是： 1、一个类能返回对象一个引用(永远是同一个)和一个获得该实例的方法（必须是静态方法，通常使用getInstance这个名称）； 2、当我们调用这个方法时，如果类持有的引用不为空就返回这个引用，如果类保持的引用为空就创建该类的实例并将实例的引用赋予该类保持的引用； 3、同时我们还将该类的构造函数定义为私有方法，这样其他处的代码就无法通过调用该类的构造函数来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例。 public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(instance&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 以上Java代码，就实现了一个简单的单例模式。我们通过将构造方法定义为私有，然后提供一个getInstance方法，该方法中来判断是否已经存在该类的实例，如果存在直接返回。如果不存在则创建一个再返回。 线程安全的单例 在中国，想要拥有一个妻子，需要男女双方带着各自的户口本一起去民政局领证。民政局的工作人员会先在系统中查询双方的婚姻状况，然后再办理登记手续。之所以可以保证一夫一妻登记成功的前提是不会发生并发问题。 假设某男子可以做到在同一时间分别和两个不同的女子来登记，就有一种概率是当工作人员查询的时候他并没有结婚，然后就可能给他登记两次结婚。当然，这种情况在现实生活中是根本不可能发生的。 但是，在程序中，一旦有多线程场景，这种情况就很常见。就像上面的代码。 如果有两个线程同时执行到if(instance==null)这行代码，这是判断都会通过，然后各自会执行instance = new Singleton();并各自返回一个instance，这时候就产生了多个实例，就没有保证单例！ 上面这种单例的实现方式我们通常称之为懒汉模式，所谓懒汉，指的是只有在需要对象的时候才会生成（getInstance方法被调用的时候才会生成）。 上面的这种懒汉模式并不是线程安全的，所以并不建议在日常开发中使用。基于这种模式，我们可以实现一个线程安全的单例的，如下： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;synchronized&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(instance&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 通过在getInstance方法上增加synchronized，通过锁来解决并发问题。这种实现方式就不会发生有多个对象被创建的问题了。 双重校验锁 上面这种线程安全的懒汉写法能够在多线程中很好的工作，但是，遗憾的是，这种做法效率很低，因为只有第一次初始化的时候才需要进行并发控制，大多数情况下是不需要同步的。 我们其实可以把上述代码做一些优化的，因为懒汉模式中使用synchronized定义一个同步方法，我们知道，synchronized还可以用来定义同步代码块，而同步代码块的粒度要比同步方法小一些，从而效率就会高一些。如以下代码： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;static&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getSingleton()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 上面这种形式，只有在singleton == null的情况下再进行加锁创建对象，如果singleton!=null的话，就直接返回就行了，并没有进行并发控制。大大的提升了效率。 从上面的代码中可以看到，其实整个过程中进行了两次singleton == null的判断，所以这种方法被称之为&quot;双重校验锁&quot;。 还有值得注意的是，双重校验锁的实现方式中，静态成员变量singleton必须通过volatile来修饰，保证其初始化的原子性，否则可能被引用到一个未初始化完成的对象。 为什么双重校验锁需要使用volatile来修饰静态成员变量singleton？为什么线程安全的懒汉就不需要呢？关于这个问题，后续文章深入讲解。 饿汉模式 前面提到的懒汉模式，其实是一种Lazy-Loading思想的实践，这种实现有一个比较大的好处，就是只有真正用到的时候才创建，如果没被使用到，就一直不会被创建，这就避免了不必要的开销。 但是这种做法，其实也有一个小缺点，就是第一次使用的时候，需要进行初始化操作，可能会有比较高的耗时。如果是已知某一个对象一定会使用到的话，其实可以采用一种饿汉的实现方式。 所谓饿汉，就是事先准备好，需要的时候直接给你就行了。这就是日常中比较常见的&quot;先买票后上车&quot;，走正常的手续。 如以下代码，饿汉模式： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 或者以下代码，饿汉变种： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 以上两段代码其实没有本质的区别，都是通过static来实例化类对象。饿汉模式中的静态变量是随着类加载时被完成初始化的。饿汉变种中的静态代码块也会随着类的加载一块执行。 以上两个饿汉方法，其实都是通过定义静态的成员变量，以保证instance可以在类初始化的时候被实例化。 因为类的初始化是由ClassLoader完成的，这其实是利用了ClassLoader的线程安全机制。ClassLoader的loadClass方法在加载类的时候使用了synchronized关键字。也正是因为这样， 除非被重写，这个方法默认在整个装载过程中都是同步的（线程安全的） 除了以上两种饿汉方式，还有一种实现方式也是借助了calss的初始化来实现的，那就是通过静态内部类来实现的单例： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;SingletonHolder&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Singleton&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SingletonHolder.INSTANCE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 前面提到的饿汉模式，只要Singleton类被装载了，那么instance就会被实例化。 而这种方式是Singleton类被装载了，instance不一定被初始化。因为SingletonHolder类没有被主动使用，只有显示通过调用getInstance方法时，才会显示装载SingletonHolder类，从而实例化instance。 使用静态内部类，借助了classloader来实现了线程安全，这与饿汉模式有着异曲同工之妙，但是他有兼顾了懒汉模式的Lazy-Loading功能，相比较之下，有很大优势。 单例的破坏 前文介绍过，我们实现的单例，把构造方法设置为私有方法来避免外部调用是很重要的一个前提。但是，私有的构造方法外部真的就完全不能调用了么？ 其实不是的，我们是可以通过反射来调用类中的私有方法的，构造方法也不例外，所以，我们可以通过反射来破坏单例。 除了这种情况，还有一种比较容易被忽视的情况，那就是其实对象的序列化和反序列化也会破坏单例。 如使用ObjectInputStream进行反序列化时，在ObjectInputStream的readObject生成对象的过程中，其实会通过反射的方式调用无参构造方法新建一个对象。 所以，在对单例对象进行序列化以及反序列化的时候，一定要考虑到这种单例可能被破坏的情况。 可以通过在Singleton类中定义readResolve的方式，解决该问题： /**&nbsp;*&nbsp;使用双重校验锁方式实现单例&nbsp;*/public&nbsp;class&nbsp;Singleton&nbsp;implements&nbsp;Serializable{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;static&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getSingleton()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object&nbsp;readResolve()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;}}&nbsp;&nbsp;&nbsp;&nbsp; 枚举实现单例 在StakcOverflow中，有一个关于What is an efficient way to implement a singleton pattern in Java？的讨论： 如上图，得票率最高的回答是：使用枚举。 回答者引用了Joshua Bloch大神在《Effective Java》中明确表达过的观点： 使用枚举实现单例的方法虽然还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。 如果你真的深入理解了单例的用法以及一些可能存在的坑的话，那么你也许也能得到相同的结论，那就是：使用枚举实现单例是一种很好的方法。 枚举实现单例： public&nbsp;enum&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;whateverMethod()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp; 以上，就实现了一个非常简单的单例，从代码行数上看，他比之前介绍过的任何一种都要精简，并且，他还是线程安全的。 这些，其实还不足以说服我们这种方式最优。但是还有个至关重要的原因，那就是：枚举可解决反序列化会破坏单例的问题。 关于这个知识点，大家可以参考《为什么我墙裂建议大家使用枚举来实现单例》这篇文章，里面详细的阐述了关于枚举与单例的所有知识点。 不使用Synchronized实现单例 前面讲过的所有方式，只要是线程安全的，其实都直接或者间接用到了synchronized，那么，如果不能使用synchronized的话，怎么实现单例呢？ 使用Lock？这当然可以了，但是其实根本还是加锁，有没有不用锁的方式呢？ 答案是有的，那就是CAS。CAS是一项乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。 在JDK1.5 中新增java.util.concurrent(J.U.C)就是建立在CAS之上的。相对于对于synchronized这种阻塞算法，CAS是非阻塞算法的一种常见实现。所以J.U.C在性能上有了很大的提升。 借助CAS（AtomicReference）实现单例模式： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;AtomicReference&lt;Singleton&gt;&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;AtomicReference&lt;Singleton&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton()&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(;;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Singleton&nbsp;singleton&nbsp;=&nbsp;INSTANCE.get();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;!=&nbsp;singleton)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(INSTANCE.compareAndSet(null,&nbsp;singleton))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;}}&nbsp; 用CAS的好处在于不需要使用传统的锁机制来保证线程安全,CAS是一种基于忙等待的算法,依赖底层硬件的实现,相对于锁它没有线程切换和阻塞的额外消耗,可以支持较大的并行度。 使用CAS实现单例只是个思路而已，只是拓展一下帮助读者熟练掌握CAS以及单例等知识、千万不要在代码中使用！！！这个代码其实有很大的优化空间。聪明的你，知道以上代码存在哪些隐患吗？ 作为码一代，想教码二代却无从下手： 听说少儿编程很火，可它有哪些好处呢？ 孩子多大开始学习比较好呢？又该如何学习呢？ 最新的编程教育政策又有哪些呢？ 下面给大家介绍CSDN新成员：极客宝宝（ID：geek_baby） 戳他了解更多↓↓↓ &nbsp;热 文&nbsp;推 荐&nbsp; ☞&nbsp;马云：腾讯是阿里的成长伴侣；华为 2 万 CNBG 员工“投奔”余承东；18 岁学生索赔苹果 10 亿美元 | 极客头条 ☞&nbsp;取代 JavaScript！Python 成 Stack Overflow 最受质疑编程语言 ☞&nbsp;流量为王，程序员如何打破 8 秒原则？| 技术头条 ☞ 5G 赋能教育信息化？ ☞ 源码泄露是裁员报复还是程序员反抗 996？ ☞&nbsp;深入浅出Docker 镜像 | 技术头条 ☞ 特斯拉全新自动驾驶芯片最强？英伟达回怼，投资者用脚投票 ☞ 她说：为啥程序员都特想要机械键盘？这答案我服！ ☞ 西安奔驰女车主哭诉维权背后, 区块链究竟能否还消费者以尊严？ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢" />
<link rel="canonical" href="https://mlh.app/2019/04/28/728455.html" />
<meta property="og:url" content="https://mlh.app/2019/04/28/728455.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-28T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"责编&nbsp;| 伍杏玲 本文经授权转载自漫话编程（ID：mhcoding） 周末了，临近五一劳动节，女朋友还没有想好要去哪里玩，还在看着各种攻略。我则在旁边一边看书默默的心疼着我的钱包。突然女朋友开始发问： 什么是单例 单例模式，也叫单子模式，是一种常用的软件设计模式。在应用这个模式时，单例对象的类必须保证只有一个实例存在。 许多时候整个系统只需要拥有一个的全局对象，这样有利于我们协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息。这种方式简化了在复杂环境下的配置管理。 对于代码开发中，一个类同时只有一个实例对象的情况就叫做单例。那么，如何保证一个类只能有一个对象呢？ 我们知道，在面向对象的思想中，通过类的构造函数可以创建对象，只要内存足够，可以创建任意个对象。 所以，要想限制某一个类只有一个单例对象，就需要在他的构造函数上下功夫。 实现对象单例模式的思路是： 1、一个类能返回对象一个引用(永远是同一个)和一个获得该实例的方法（必须是静态方法，通常使用getInstance这个名称）； 2、当我们调用这个方法时，如果类持有的引用不为空就返回这个引用，如果类保持的引用为空就创建该类的实例并将实例的引用赋予该类保持的引用； 3、同时我们还将该类的构造函数定义为私有方法，这样其他处的代码就无法通过调用该类的构造函数来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例。 public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(instance&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 以上Java代码，就实现了一个简单的单例模式。我们通过将构造方法定义为私有，然后提供一个getInstance方法，该方法中来判断是否已经存在该类的实例，如果存在直接返回。如果不存在则创建一个再返回。 线程安全的单例 在中国，想要拥有一个妻子，需要男女双方带着各自的户口本一起去民政局领证。民政局的工作人员会先在系统中查询双方的婚姻状况，然后再办理登记手续。之所以可以保证一夫一妻登记成功的前提是不会发生并发问题。 假设某男子可以做到在同一时间分别和两个不同的女子来登记，就有一种概率是当工作人员查询的时候他并没有结婚，然后就可能给他登记两次结婚。当然，这种情况在现实生活中是根本不可能发生的。 但是，在程序中，一旦有多线程场景，这种情况就很常见。就像上面的代码。 如果有两个线程同时执行到if(instance==null)这行代码，这是判断都会通过，然后各自会执行instance = new Singleton();并各自返回一个instance，这时候就产生了多个实例，就没有保证单例！ 上面这种单例的实现方式我们通常称之为懒汉模式，所谓懒汉，指的是只有在需要对象的时候才会生成（getInstance方法被调用的时候才会生成）。 上面的这种懒汉模式并不是线程安全的，所以并不建议在日常开发中使用。基于这种模式，我们可以实现一个线程安全的单例的，如下： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;synchronized&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(instance&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 通过在getInstance方法上增加synchronized，通过锁来解决并发问题。这种实现方式就不会发生有多个对象被创建的问题了。 双重校验锁 上面这种线程安全的懒汉写法能够在多线程中很好的工作，但是，遗憾的是，这种做法效率很低，因为只有第一次初始化的时候才需要进行并发控制，大多数情况下是不需要同步的。 我们其实可以把上述代码做一些优化的，因为懒汉模式中使用synchronized定义一个同步方法，我们知道，synchronized还可以用来定义同步代码块，而同步代码块的粒度要比同步方法小一些，从而效率就会高一些。如以下代码： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;static&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getSingleton()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp; 上面这种形式，只有在singleton == null的情况下再进行加锁创建对象，如果singleton!=null的话，就直接返回就行了，并没有进行并发控制。大大的提升了效率。 从上面的代码中可以看到，其实整个过程中进行了两次singleton == null的判断，所以这种方法被称之为&quot;双重校验锁&quot;。 还有值得注意的是，双重校验锁的实现方式中，静态成员变量singleton必须通过volatile来修饰，保证其初始化的原子性，否则可能被引用到一个未初始化完成的对象。 为什么双重校验锁需要使用volatile来修饰静态成员变量singleton？为什么线程安全的懒汉就不需要呢？关于这个问题，后续文章深入讲解。 饿汉模式 前面提到的懒汉模式，其实是一种Lazy-Loading思想的实践，这种实现有一个比较大的好处，就是只有真正用到的时候才创建，如果没被使用到，就一直不会被创建，这就避免了不必要的开销。 但是这种做法，其实也有一个小缺点，就是第一次使用的时候，需要进行初始化操作，可能会有比较高的耗时。如果是已知某一个对象一定会使用到的话，其实可以采用一种饿汉的实现方式。 所谓饿汉，就是事先准备好，需要的时候直接给你就行了。这就是日常中比较常见的&quot;先买票后上车&quot;，走正常的手续。 如以下代码，饿汉模式： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 或者以下代码，饿汉变种： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;this.instance;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 以上两段代码其实没有本质的区别，都是通过static来实例化类对象。饿汉模式中的静态变量是随着类加载时被完成初始化的。饿汉变种中的静态代码块也会随着类的加载一块执行。 以上两个饿汉方法，其实都是通过定义静态的成员变量，以保证instance可以在类初始化的时候被实例化。 因为类的初始化是由ClassLoader完成的，这其实是利用了ClassLoader的线程安全机制。ClassLoader的loadClass方法在加载类的时候使用了synchronized关键字。也正是因为这样， 除非被重写，这个方法默认在整个装载过程中都是同步的（线程安全的） 除了以上两种饿汉方式，还有一种实现方式也是借助了calss的初始化来实现的，那就是通过静态内部类来实现的单例： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;class&nbsp;SingletonHolder&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Singleton&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SingletonHolder.INSTANCE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp; 前面提到的饿汉模式，只要Singleton类被装载了，那么instance就会被实例化。 而这种方式是Singleton类被装载了，instance不一定被初始化。因为SingletonHolder类没有被主动使用，只有显示通过调用getInstance方法时，才会显示装载SingletonHolder类，从而实例化instance。 使用静态内部类，借助了classloader来实现了线程安全，这与饿汉模式有着异曲同工之妙，但是他有兼顾了懒汉模式的Lazy-Loading功能，相比较之下，有很大优势。 单例的破坏 前文介绍过，我们实现的单例，把构造方法设置为私有方法来避免外部调用是很重要的一个前提。但是，私有的构造方法外部真的就完全不能调用了么？ 其实不是的，我们是可以通过反射来调用类中的私有方法的，构造方法也不例外，所以，我们可以通过反射来破坏单例。 除了这种情况，还有一种比较容易被忽视的情况，那就是其实对象的序列化和反序列化也会破坏单例。 如使用ObjectInputStream进行反序列化时，在ObjectInputStream的readObject生成对象的过程中，其实会通过反射的方式调用无参构造方法新建一个对象。 所以，在对单例对象进行序列化以及反序列化的时候，一定要考虑到这种单例可能被破坏的情况。 可以通过在Singleton类中定义readResolve的方式，解决该问题： /**&nbsp;*&nbsp;使用双重校验锁方式实现单例&nbsp;*/public&nbsp;class&nbsp;Singleton&nbsp;implements&nbsp;Serializable{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;volatile&nbsp;static&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton&nbsp;(){}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getSingleton()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(singleton&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Object&nbsp;readResolve()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;}}&nbsp;&nbsp;&nbsp;&nbsp; 枚举实现单例 在StakcOverflow中，有一个关于What is an efficient way to implement a singleton pattern in Java？的讨论： 如上图，得票率最高的回答是：使用枚举。 回答者引用了Joshua Bloch大神在《Effective Java》中明确表达过的观点： 使用枚举实现单例的方法虽然还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。 如果你真的深入理解了单例的用法以及一些可能存在的坑的话，那么你也许也能得到相同的结论，那就是：使用枚举实现单例是一种很好的方法。 枚举实现单例： public&nbsp;enum&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;whateverMethod()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp; 以上，就实现了一个非常简单的单例，从代码行数上看，他比之前介绍过的任何一种都要精简，并且，他还是线程安全的。 这些，其实还不足以说服我们这种方式最优。但是还有个至关重要的原因，那就是：枚举可解决反序列化会破坏单例的问题。 关于这个知识点，大家可以参考《为什么我墙裂建议大家使用枚举来实现单例》这篇文章，里面详细的阐述了关于枚举与单例的所有知识点。 不使用Synchronized实现单例 前面讲过的所有方式，只要是线程安全的，其实都直接或者间接用到了synchronized，那么，如果不能使用synchronized的话，怎么实现单例呢？ 使用Lock？这当然可以了，但是其实根本还是加锁，有没有不用锁的方式呢？ 答案是有的，那就是CAS。CAS是一项乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。 在JDK1.5 中新增java.util.concurrent(J.U.C)就是建立在CAS之上的。相对于对于synchronized这种阻塞算法，CAS是非阻塞算法的一种常见实现。所以J.U.C在性能上有了很大的提升。 借助CAS（AtomicReference）实现单例模式： public&nbsp;class&nbsp;Singleton&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;AtomicReference&lt;Singleton&gt;&nbsp;INSTANCE&nbsp;=&nbsp;new&nbsp;AtomicReference&lt;Singleton&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Singleton()&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;Singleton&nbsp;getInstance()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(;;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Singleton&nbsp;singleton&nbsp;=&nbsp;INSTANCE.get();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(null&nbsp;!=&nbsp;singleton)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;new&nbsp;Singleton();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(INSTANCE.compareAndSet(null,&nbsp;singleton))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;singleton;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;}}&nbsp; 用CAS的好处在于不需要使用传统的锁机制来保证线程安全,CAS是一种基于忙等待的算法,依赖底层硬件的实现,相对于锁它没有线程切换和阻塞的额外消耗,可以支持较大的并行度。 使用CAS实现单例只是个思路而已，只是拓展一下帮助读者熟练掌握CAS以及单例等知识、千万不要在代码中使用！！！这个代码其实有很大的优化空间。聪明的你，知道以上代码存在哪些隐患吗？ 作为码一代，想教码二代却无从下手： 听说少儿编程很火，可它有哪些好处呢？ 孩子多大开始学习比较好呢？又该如何学习呢？ 最新的编程教育政策又有哪些呢？ 下面给大家介绍CSDN新成员：极客宝宝（ID：geek_baby） 戳他了解更多↓↓↓ &nbsp;热 文&nbsp;推 荐&nbsp; ☞&nbsp;马云：腾讯是阿里的成长伴侣；华为 2 万 CNBG 员工“投奔”余承东；18 岁学生索赔苹果 10 亿美元 | 极客头条 ☞&nbsp;取代 JavaScript！Python 成 Stack Overflow 最受质疑编程语言 ☞&nbsp;流量为王，程序员如何打破 8 秒原则？| 技术头条 ☞ 5G 赋能教育信息化？ ☞ 源码泄露是裁员报复还是程序员反抗 996？ ☞&nbsp;深入浅出Docker 镜像 | 技术头条 ☞ 特斯拉全新自动驾驶芯片最强？英伟达回怼，投资者用脚投票 ☞ 她说：为啥程序员都特想要机械键盘？这答案我服！ ☞ 西安奔驰女车主哭诉维权背后, 区块链究竟能否还消费者以尊严？ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢","@type":"BlogPosting","url":"https://mlh.app/2019/04/28/728455.html","headline":"漫画：如何给女朋友解释什么是单例模式？ 技术头条","dateModified":"2019-04-28T00:00:00+08:00","datePublished":"2019-04-28T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/28/728455.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>漫画：如何给女朋友解释什么是单例模式？| 技术头条</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <section class="xmteditor" style="display:none;" data-tools="新媒体管家" data-label="powered by xmt.cn"></section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><img class="rich_pages" data-copyright="0" data-ratio="0.15644171779141106" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Pn4Sm0RsAujHRSdcX3IznHduusnhVrSgibxlHEaKkBO8A7UcDdDzAnMIA2ZLfuoUKKJrwSA8HPTejcSLotzprZw/640?wx_fmt=gif" data-type="gif" data-w="652" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_gif/Pn4Sm0RsAujHRSdcX3IznHduusnhVrSgibxlHEaKkBO8A7UcDdDzAnMIA2ZLfuoUKKJrwSA8HPTejcSLotzprZw/640?wx_fmt=gif"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;letter-spacing: 1px;line-height: normal;"><img class="rich_pages" data-copyright="0" data-ratio="0.21739130434782608" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/mQlO20PgUDKtONJc69QACFgicXyIDlBh63BR1GkoakiaIeOyqE65A4KP4neMfV1RYqlcXqbxSfEcMSAbDRJ3jXxA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1242" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/mQlO20PgUDKtONJc69QACFgicXyIDlBh63BR1GkoakiaIeOyqE65A4KP4neMfV1RYqlcXqbxSfEcMSAbDRJ3jXxA/640?wx_fmt=jpeg"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;letter-spacing: 1px;text-align: right;line-height: normal;"><span style="color: rgb(136, 136, 136);font-size: 14px;">责编&nbsp;| 伍杏玲</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;letter-spacing: 1px;text-align: right;line-height: normal;"><span style="color: rgb(136, 136, 136);font-size: 14px;">本文经授权转载自漫话编程（ID：</span><span style="color: rgb(136, 136, 136);font-size: 14px;">mhcoding）</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">周末了，临近五一劳动节，女朋友还没有想好要去哪里玩，还在看着各种攻略。</span><span style="font-size: 15px;">我则在旁边一边看书默默的心疼着我的钱包。</span><span style="font-size: 15px;">突然女朋友开始发问：</span><br></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4234375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4H5Nviao3iacvfwQD9mLMz1qtmKphdiaCtrxJlLdJ3iaLelibNzKiaWF2a2mQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4H5Nviao3iacvfwQD9mLMz1qtmKphdiaCtrxJlLdJ3iaLelibNzKiaWF2a2mQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.52265625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4nxLbFTEkm8yPOzHeoIxnJNGys5yZBBAX6JkQpSze7rSAAbdV1SXvjw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4nxLbFTEkm8yPOzHeoIxnJNGys5yZBBAX6JkQpSze7rSAAbdV1SXvjw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.45703125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4HHmw1hFYI3tjwhIMkFTftjVRZ7Z2zhP5jlrwSDsrUc7tNEYA7G4AAQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4HHmw1hFYI3tjwhIMkFTftjVRZ7Z2zhP5jlrwSDsrUc7tNEYA7G4AAQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.515625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4kicYH2iauPLkEcmJF7M5e7rNXPiaHNcRicx9ywHQa6l4VzfA6IQ6nNyadw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4kicYH2iauPLkEcmJF7M5e7rNXPiaHNcRicx9ywHQa6l4VzfA6IQ6nNyadw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.41171875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4uh87VnvQtrdXiasiaGwxJ7icOr5cznKnBibUuMYvveHXQqrx17WFTxKdYQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4uh87VnvQtrdXiasiaGwxJ7icOr5cznKnBibUuMYvveHXQqrx17WFTxKdYQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4QCJPsEefFQtVJoZsYkaajwY9MLkpHrL8WzABtflUrXhrxYELHm3Qaw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4QCJPsEefFQtVJoZsYkaajwY9MLkpHrL8WzABtflUrXhrxYELHm3Qaw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4140625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4zbfxnaUWibja2aXuWE4s2aM846fiaVWWUZrB5xVa653qbz808IVzhfCQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4zbfxnaUWibja2aXuWE4s2aM846fiaVWWUZrB5xVa653qbz808IVzhfCQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><br></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LXSAriayI15u06ibNNlXzIcor2tTtgJBKFxkIicJ8tiaRKRaictbrQEssdSg/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LXSAriayI15u06ibNNlXzIcor2tTtgJBKFxkIicJ8tiaRKRaictbrQEssdSg/640?wx_fmt=png"></strong></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><span style="font-size: 18px;">什么是单例</span></strong><span style="font-size: 15px;"></span></p> 
   <p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;"><br></span></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><span style="font-size: 15px;">单例模式，也叫单子模式，是一种常用的软件设计模式</span></strong><span style="font-size: 15px;">。</span><span style="font-size: 15px;">在应用这个模式时，单例对象的类必须保证只有一个实例存在。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">许多时候整个系统只需要拥有一个的全局对象，这样有利于我们协调系统整体的行为。</span><span style="font-size: 15px;">比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息。</span><span style="font-size: 15px;">这种方式简化了在复杂环境下的配置管理。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">对于代码开发中，一个类同时只有一个实例对象的情况就叫做单例。</span><span style="font-size: 15px;">那么，如何保证一个类只能有一个对象呢？</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">我们知道，在</span><span style="font-size: 15px;">面向对象</span><span style="font-size: 15px;">的思想中，通过类的构造函数可以创建对象，只要内存足够，可以创建任意个对象。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">所以，要想限制某一个类只有一个单例对象，就需要在他的构造函数上下功夫。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">实现对象单例模式的思路是：</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">1、一个类能返回对象一个引用(永远是同一个)和一个获得该实例的方法（必须是静态方法，通常使用getInstance这个名称）；</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">2、当我们调用这个方法时，如果类持有的引用不为空就返回这个引用，如果类保持的引用为空就创建该类的实例并将实例的引用赋予该类保持的引用；</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">3、同时我们还将该类的构造函数定义为私有方法，这样其他处的代码就无法通过调用该类的构造函数来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例。</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;()</span>{}&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getInstance</span>()&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(instance&nbsp;==&nbsp;<span class="hljs-literal" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;instance;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;"><span style="font-size: 15px;">以上Java代码，就实现了一个简单的单例模式。</span><span style="font-size: 15px;">我们通过将构造方法定义为私有，然后提供一个getInstance方法，该方法中来判断是否已经存在该类的实例，如果存在直接返回。</span><span style="font-size: 15px;">如果不存在则创建一个再返回。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4D0KDTHqMYYf9Hj1lHg76BxwjeLcLcFwLyXfoDIQS0icic3DR9pPRrcGQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4D0KDTHqMYYf9Hj1lHg76BxwjeLcLcFwLyXfoDIQS0icic3DR9pPRrcGQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4HZTT1XVORRtYAkURWO4KZqmKrjXhRblsUEgvicoqu2NcYjH75UAjvOw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4HZTT1XVORRtYAkURWO4KZqmKrjXhRblsUEgvicoqu2NcYjH75UAjvOw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.515625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4niaxcADkpnvcRGSLic3PxeXJfjnKMptqmr0tPiardLmZP5TpSibyfT4OIw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4niaxcADkpnvcRGSLic3PxeXJfjnKMptqmr0tPiardLmZP5TpSibyfT4OIw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.51171875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4k5JudicviaTyfN0UeTnEcBfITv5hib0RIhcvLO1g0B7FDib59Gia3MoIBvw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4k5JudicviaTyfN0UeTnEcBfITv5hib0RIhcvLO1g0B7FDib59Gia3MoIBvw/640?wx_fmt=jpeg"></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LwYnW1VvkaHWiaL6W1Mr1yiaNLQpxwhyqice9F1yJzMHticssPX515qyvog/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LwYnW1VvkaHWiaL6W1Mr1yiaNLQpxwhyqice9F1yJzMHticssPX515qyvog/640?wx_fmt=png"></strong></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><span style="font-size: 18px;">线程安全的单例</span></strong><span style="font-size: 15px;"></span></p> 
   <p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><br></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"></span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">在中国，想要拥有一个妻子，需要男女双方带着各自的户口本一起去民政局领证。</span><span style="font-size: 15px;">民政局的工作人员会先在系统中查询双方的婚姻状况，然后再办理登记手续。</span><span style="font-size: 15px;">之所以可以保证一夫一妻登记成功的前提是不会发生并发问题。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">假设某男子可以做到在同一时间分别和两个不同的女子来登记，就有一种概率是当工作人员查询的时候他并没有结婚，然后就可能给他登记两次结婚。</span><span style="font-size: 15px;">当然，这种情况在现实生活中是根本不可能发生的。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">但是，在程序中，一旦有多线程场景，这种情况就很常见。</span><span style="font-size: 15px;">就像上面的代码。</span></p> 
<p><img class="" data-ratio="0.6398176291793313" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4BjkQvDcIvm6xksfGARqcB1FCrHqhI3wH1zxiayCePoIEQYwR90zfsWA/640?wx_fmt=jpeg" data-type="jpeg" data-w="658" style="font-size: inherit;color: inherit;line-height: inherit;display: block;margin-right: auto;margin-left: auto;" title="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4BjkQvDcIvm6xksfGARqcB1FCrHqhI3wH1zxiayCePoIEQYwR90zfsWA/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;"><span style="font-size: 15px;letter-spacing: 1px;">如果有两个线程同时执行到if(instance==null)这行代码，这是判断都会通过，然后各自会执行instance = new Singleton();并各自返回一个instance，这时候就产生了多个实例，就没有保证单例！</span></p> 
<p style="line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;"><strong><span style="font-size: 15px;">上面这种单例的实现方式我们通常称之为懒汉模式，所谓懒汉，指的是只有在需要对象的时候才会生成（getInstance方法被调用的时候才会生成）。</span></strong><span style="font-size: 15px;"></span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">上面的这种懒汉模式并不是线程安全的，所以并不建议在日常开发中使用。</span><span style="font-size: 15px;">基于这种模式，我们可以实现一个线程安全的单例的，如下：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-class" style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;instance;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;<span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span></span>{}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">synchronized</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getInstance</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(instance&nbsp;==&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;instance;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;">通过在getInstance方法上增加synchronized，通过锁来解决并发问题。</span><span style="font-size: 15px;">这种实现方式就不会发生有多个对象被创建的问题了。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4vLU8Mq1VQhfN2RzCABwYe1Vk2s13s5JGAQqh7yzCvdmZgEvTFzsaNw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4vLU8Mq1VQhfN2RzCABwYe1Vk2s13s5JGAQqh7yzCvdmZgEvTFzsaNw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.46875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4fYlgia2PHRCYSTgW6Rfx1XNrtLXHpsVPDiaBnEDFPVu4H3V0ydeq3TlQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4fYlgia2PHRCYSTgW6Rfx1XNrtLXHpsVPDiaBnEDFPVu4H3V0ydeq3TlQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4078125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4t5T8ibYMGsfWMccDayKaSnTwpibIoGzKLTZ8utg8lu1xUJXqiaBhjkTbw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4t5T8ibYMGsfWMccDayKaSnTwpibIoGzKLTZ8utg8lu1xUJXqiaBhjkTbw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"> 
 <mpcpc js_editor_cpcad="" class="js_cpc_area res_iframe cpc_iframe" src="/cgi-bin/readtemplate?t=tmpl/cpc_tmpl#1556086838162" data-category_id_list="1|15|16|17|36|37|41|42|43|48|7|8" data-id="1556086838162"></mpcpc></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4Lb4ybNEVGnaAvEDwENKzW27LUKFDGZPKcBneWwTaTpaJyG2C3em7libQ/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4Lb4ybNEVGnaAvEDwENKzW27LUKFDGZPKcBneWwTaTpaJyG2C3em7libQ/640?wx_fmt=png"></strong></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><span style="font-size: 18px;">双重校验锁</span></strong><span style="font-size: 15px;"></span></p> 
   <p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;"><br></span></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">上面这种线程安全的懒汉写法能够在多线程中很好的工作，但是，遗憾的是，这种做法效率很低，因为只有第一次初始化的时候才需要进行并发控制，大多数情况下是不需要同步的。</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">我们其实可以把上述代码做一些优化的，因为懒汉模式中使用synchronized定义一个同步方法，我们知道，synchronized还可以用来定义同步代码块，而同步代码块的粒度要比同步方法小一些，从而效率就会高一些。</span><span style="font-size: 15px;">如以下代码：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-class" style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">volatile</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;singleton;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;<span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span></span>{}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getSingleton</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(singleton&nbsp;==&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">synchronized</span>&nbsp;(Singleton.class)&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(singleton&nbsp;==&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;singleton;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;">上面这种形式，只有在singleton == null的情况下再进行加锁创建对象，如果singleton!=null的话，就直接返回就行了，并没有进行并发控制。</span><span style="font-size: 15px;">大大的提升了效率。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">从上面的代码中可以看到，其实整个过程中进行了两次singleton == null的判断，所以这种方法被称之为"双重校验锁"。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">还有值得注意的是，双重校验锁的实现方式中，静态成员变量singleton必须通过volatile来修饰，保证其初始化的原子性，否则可能被引用到一个未初始化完成的对象。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4609375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4h9pcUSE3ey0tTvYeM1LNVOBbwNVb3l2Sk47ZvvIOQ5ZOFVgoS5C8ow/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4h9pcUSE3ey0tTvYeM1LNVOBbwNVb3l2Sk47ZvvIOQ5ZOFVgoS5C8ow/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.52265625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic41ibIib8sbrz89KUBaDZq2zJZpF7QzicW6zbC1AM83Jnv4icxtOhfJzGeeQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic41ibIib8sbrz89KUBaDZq2zJZpF7QzicW6zbC1AM83Jnv4icxtOhfJzGeeQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4609375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4W0YHp5N55YgIQXjrY4Yb2CIwyMKChVHeY2aVhZgfRYicLUQNqgiav67w/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4W0YHp5N55YgIQXjrY4Yb2CIwyMKChVHeY2aVhZgfRYicLUQNqgiav67w/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4703125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4AD6LSeY8K5YNtY2VfhOtmCZMflmp8cSAVXb1TUGxbXnIk4C14YfZ3A/640?wx_fmt=png" data-type="png" data-w="1280" height="526" style="" width="1280" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4AD6LSeY8K5YNtY2VfhOtmCZMflmp8cSAVXb1TUGxbXnIk4C14YfZ3A/640?wx_fmt=png"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">为什么双重校验锁需要使用volatile来修饰静态成员变量singleton？</span><span style="font-size: 15px;">为什么线程安全的懒汉就不需要呢？</span><span style="font-size: 15px;">关于这个问题，后续文章深入讲解。</span></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LLqyf6BY4rMfY2LsU81MibFjicKDLjMjib5R23h8uo6GtGDY8OufWJfpEw/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LLqyf6BY4rMfY2LsU81MibFjicKDLjMjib5R23h8uo6GtGDY8OufWJfpEw/640?wx_fmt=png"></strong></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 18px;"><strong>饿汉模式</strong></span><span style="font-size: 15px;"></span></p> 
   <p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;"><br></span></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">前面提到的懒汉模式，其实是一种Lazy-Loading思想的实践，这种实现有一个比较大的好处，就是只有真正用到的时候才创建，如果没被使用到，就一直不会被创建，这就避免了不必要的开销。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">但是这种做法，其实也有一个小缺点，就是第一次使用的时候，需要进行初始化操作，可能会有比较高的耗时。</span><span style="font-size: 15px;">如果是已知某一个对象一定会使用到的话，其实可以采用一种饿汉的实现方式。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">所谓饿汉，就是事先准备好，需要的时候直接给你就行了。</span><span style="font-size: 15px;">这就是日常中比较常见的"先买票后上车"，走正常的手续。</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">如以下代码，饿汉模式：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-class" style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;{</span>&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;<span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span></span>{}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getInstance</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;instance;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">或者以下代码，饿汉变种：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;Singleton&nbsp;instance&nbsp;=&nbsp;<span class="hljs-literal" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;()</span>{}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getInstance</span>()&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">this</span>.instance;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;">以上两段代码其实没有本质的区别，都是通过static来实例化类对象。</span><span style="font-size: 15px;">饿汉模式中的静态变量是随着类加载时被完成初始化的。</span><span style="font-size: 15px;">饿汉变种中的静态代码块也会随着类的加载一块执行。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.59375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4CPpLtvskzXUdxnxxXNPTu7dPax5RicFhIDyttZ3foa39ho817X9ob6w/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4CPpLtvskzXUdxnxxXNPTu7dPax5RicFhIDyttZ3foa39ho817X9ob6w/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4140625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4sBW7zLibYPCgq6Zp8jiaviaxf5ACMIHicKnicUCib8BF1XiaMvtx5bIUVM2CQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4sBW7zLibYPCgq6Zp8jiaviaxf5ACMIHicKnicUCib8BF1XiaMvtx5bIUVM2CQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.515625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4CBwk5OLrHHwOO8gd9QmG6pibtT8HchSQbX3jMxe7VeT9IPCZloLDliag/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4CBwk5OLrHHwOO8gd9QmG6pibtT8HchSQbX3jMxe7VeT9IPCZloLDliag/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.459375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic45rcibPD8tgIKhsnmk2Lpg07NbTm77lkrmpxQRyiaAh6tVh7AJLAAiacWA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic45rcibPD8tgIKhsnmk2Lpg07NbTm77lkrmpxQRyiaAh6tVh7AJLAAiacWA/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">以上两个饿汉方法，其实都是通过定义静态的成员变量，以保证instance可以在类初始化的时候被实例化。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">因为类的初始化是由ClassLoader完成的，这其实是利用了ClassLoader的线程安全机制。</span><span style="font-size: 15px;">ClassLoader的loadClass方法在加载类的时候使用了synchronized关键字。</span><span style="font-size: 15px;">也正是因为这样， 除非被重写，这个方法默认在整个装载过程中都是同步的（线程安全的）</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">除了以上两种饿汉方式，还有一种实现方式也是借助了calss的初始化来实现的，那就是通过静态内部类来实现的单例：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-class" style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;<span class="hljs-class" style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">SingletonHolder</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">final</span>&nbsp;Singleton&nbsp;INSTANCE&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;<span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span></span>{}&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">final</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getInstance</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;SingletonHolder.INSTANCE;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;">前面提到的饿汉模式，只要Singleton类被装载了，那么instance就会被实例化。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">而这种方式是Singleton类被装载了，instance不一定被初始化。</span><span style="font-size: 15px;">因为SingletonHolder类没有被主动使用，只有显示通过调用getInstance方法时，才会显示装载SingletonHolder类，从而实例化instance。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">使用静态内部类，借助了classloader来实现了线程安全，这与饿汉模式有着异曲同工之妙，但是他有兼顾了懒汉模式的Lazy-Loading功能，相比较之下，有很大优势。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.52421875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4N9icYIvnHNT1XlpE4cD7NicZzrsVZqKjD7R7AEQfL0HnpCsRSIm47HIQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4N9icYIvnHNT1XlpE4cD7NicZzrsVZqKjD7R7AEQfL0HnpCsRSIm47HIQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.51171875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic47mrFe6cTiclwjwYkqn0glRiaQicCQibW1dFfuQLO1xwOLgmOiaZLQIxYItA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic47mrFe6cTiclwjwYkqn0glRiaQicCQibW1dFfuQLO1xwOLgmOiaZLQIxYItA/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.46484375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic42qZKPxBbXDhygz9uzy8N2RQ8ic4a9YSuRVkWjrFZ7LtvMJufcVia9Bzg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic42qZKPxBbXDhygz9uzy8N2RQ8ic4a9YSuRVkWjrFZ7LtvMJufcVia9Bzg/640?wx_fmt=jpeg"></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LzUzfol6q1COlZYpeYXqe0aia45DXyhcTQW8voWvibFJvEjfmkhPvCrEg/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LzUzfol6q1COlZYpeYXqe0aia45DXyhcTQW8voWvibFJvEjfmkhPvCrEg/640?wx_fmt=png"></strong></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 18px;"><strong>单例的破坏</strong></span><strong><span style="font-size: 18px;"></span></strong></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><br></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">前文介绍过，我们实现的单例，把构造方法设置为私有方法来避免外部调用是很重要的一个前提。</span><span style="font-size: 15px;">但是，私有的构造方法外部真的就完全不能调用了么？</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">其实不是的，我们是可以通过反射来调用类中的私有方法的，构造方法也不例外，所以，我们可以通过反射来破坏单例。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">除了这种情况，还有一种比较容易被忽视的情况，那就是其实对象的序列化和反序列化也会破坏单例。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">如使用ObjectInputStream进行反序列化时，在ObjectInputStream的readObject生成对象的过程中，其实会通过反射的方式调用无参构造方法新建一个对象。</span></p> 
<p><img class="" data-ratio="0.3111111111111111" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4wBqr1VkbvYk7HYdq6KYvnDIDiaXkb49d6tlHeiadhJL9aNCLWo6jcURw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1080" style="font-size: inherit;color: inherit;line-height: inherit;display: block;margin-right: auto;margin-left: auto;" title="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4wBqr1VkbvYk7HYdq6KYvnDIDiaXkb49d6tlHeiadhJL9aNCLWo6jcURw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;"><span style="font-size: 15px;letter-spacing: 1px;">所以，在对单例对象进行序列化以及反序列化的时候，一定要考虑到这种单例可能被破坏的情况。</span></p> 
<p style="line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">可以通过在Singleton类中定义readResolve的方式，解决该问题：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-comment" style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">/**<br>&nbsp;*&nbsp;使用双重校验锁方式实现单例<br>&nbsp;*/</span><br><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-class" style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">implements</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Serializable</span></span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">volatile</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;singleton;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;<span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span></span>{}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getSingleton</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(singleton&nbsp;==&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">synchronized</span>&nbsp;(Singleton.class)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(singleton&nbsp;==&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;singleton;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;Object&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">readResolve</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;singleton;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}&nbsp;&nbsp;&nbsp;&nbsp;<br></p></pre>
          
  </section><p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><br></p></pre> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.51171875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4yMfNXdZ7OZ16qFE9753VhaibVwIZANvy5J8CCawGnQBv1ruPrAEFDtg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4yMfNXdZ7OZ16qFE9753VhaibVwIZANvy5J8CCawGnQBv1ruPrAEFDtg/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.5171875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic486fCHRyfCFDQFDfu7PSKaDjK1WKyOfSB7ibIAgtib4Fm1POrInIMRibbA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic486fCHRyfCFDQFDfu7PSKaDjK1WKyOfSB7ibIAgtib4Fm1POrInIMRibbA/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4609375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4XicH1xicOmCZjBLqbElT8OvpSKDEQTK4jia4jicK05RHjXOdgpTBkMgVIQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4XicH1xicOmCZjBLqbElT8OvpSKDEQTK4jia4jicK05RHjXOdgpTBkMgVIQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4609375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4wDvrB4Rz7ZUEowuzBayG79LHJZOpEQeFuhkzs0K8icZUukURdiaKpSkA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4wDvrB4Rz7ZUEowuzBayG79LHJZOpEQeFuhkzs0K8icZUukURdiaKpSkA/640?wx_fmt=jpeg"></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4L8DRknQu3FB9eZicibvOSlVrgnllB3XcGnsrw4zCk19ic0QjZkTPoqFMWw/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4L8DRknQu3FB9eZicibvOSlVrgnllB3XcGnsrw4zCk19ic0QjZkTPoqFMWw/640?wx_fmt=png"></strong></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 18px;"><strong>枚举实现单例</strong></span><span style="font-size: 15px;"></span></p> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">在StakcOverflow中，有一个关于What is an efficient way to implement a singleton pattern in Java？的讨论：</span></p> 
<figure> 
 <img class="" data-ratio="0.9016172506738545" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4PO5NCXOibDrwvLp1ib3tgUGJa81f42sNaOETAP1kVKicO3MXpPG5Bf8QQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="742" style="font-size: inherit;color: inherit;line-height: inherit;display: block;margin-right: auto;margin-left: auto;" title="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4PO5NCXOibDrwvLp1ib3tgUGJa81f42sNaOETAP1kVKicO3MXpPG5Bf8QQ/640?wx_fmt=jpeg"> 
</figure> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">如上图，得票率最高的回答是：</span><span style="font-size: 15px;">使用枚举。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">回答者引用了Joshua Bloch大神在《Effective Java》中明确表达过的观点：</span></p> 
<blockquote> 
 <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">使用枚举实现单例的方法虽然还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。</span></p> 
</blockquote> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">如果你真的深入理解了单例的用法以及一些可能存在的坑的话，那么你也许也能得到相同的结论，那就是：</span><span style="font-size: 15px;">使用枚举实现单例是一种很好的方法。</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">枚举实现单例：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">enum</span>&nbsp;Singleton&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">void</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">whateverMethod</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">()</span>&nbsp;</span>{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br>}&nbsp;&nbsp;&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;letter-spacing: 1px;margin-bottom: 15px;"><span style="font-size: 15px;">以上，就实现了一个非常简单的单例，从代码行数上看，他比之前介绍过的任何一种都要精简，并且，他还是线程安全的。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">这些，其实还不足以说服我们这种方式最优。</span><span style="font-size: 15px;">但是还有个至关重要的原因，那就是：</span><span style="font-size: 15px;">枚举可解决反序列化会破坏单例的问题。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">关于这个知识点，大家可以参考</span><a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&amp;mid=2650121482&amp;idx=1&amp;sn=e5b86797244d8879bbe9a69fb72641b5&amp;chksm=f36bb82bc41c313d739f485383d3a868a79020c995ee86daef026a589f4782916c42a8d3f6c7&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="font-size: 15px;text-decoration: underline;"><span style="font-size: 15px;">《为什么我墙裂建议大家使用枚举来实现单例》</span></a><span style="font-size: 15px;">这篇文章，里面详细的阐述了关于枚举与单例的所有知识点。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4Cdk3omvXzgBR2LXBljtIxfHibbMl9Qz9fXJaC5nG7YuArPeOgoX1hgw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4Cdk3omvXzgBR2LXBljtIxfHibbMl9Qz9fXJaC5nG7YuArPeOgoX1hgw/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.46484375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4dqGXSRPAHEwBoUpFmQYoH1OCtR1ic8msyBCHcThic4OT2ypw3lib3JgOQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4dqGXSRPAHEwBoUpFmQYoH1OCtR1ic8msyBCHcThic4OT2ypw3lib3JgOQ/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.56875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4CxWnPevblsUnUicElSDOOOB7dgJmA0XiaPTHbUdBSnYzKN5EWFqMKO9A/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4CxWnPevblsUnUicElSDOOOB7dgJmA0XiaPTHbUdBSnYzKN5EWFqMKO9A/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4vcLecaiauhhdt42R4hmbEhicCHeAzedbyX5Oicep1GJZEYC7tZwjVERGw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4vcLecaiauhhdt42R4hmbEhicCHeAzedbyX5Oicep1GJZEYC7tZwjVERGw/640?wx_fmt=jpeg"></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="RankEditor" mpa-from-tpl="t"> 
  <section mpa-from-tpl="t"> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LFV97HltQYlNPKDzX97K1Ll0EicLrBIuWQtgLtQYdFKkkLcWKGUeMTfg/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LFV97HltQYlNPKDzX97K1Ll0EicLrBIuWQtgLtQYdFKkkLcWKGUeMTfg/640?wx_fmt=png"></strong></p> 
   <p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><strong><span style="font-size: 18px;">不使用Synchronized实现单例<span style="font-size: 15px;"></span></span></strong></p> 
   <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;"><br></span></p> 
  </section> 
 </section> 
</section> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">前面讲过的所有方式，只要是线程安全的，其实都直接或者间接用到了synchronized，那么，如果不能使用synchronized的话，怎么实现单例呢？</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">使用Lock？</span><span style="font-size: 15px;">这当然可以了，但是其实根本还是加锁，有没有不用锁的方式呢？</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">答案是有的，那就是CAS。</span><span style="font-size: 15px;">CAS是一项乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">在JDK1.5 中新增java.util.concurrent(J.U.C)就是建立在CAS之上的。</span><span style="font-size: 15px;">相对于对于synchronized这种阻塞算法，CAS是非阻塞算法的一种常见实现。</span><span style="font-size: 15px;">所以J.U.C在性能上有了很大的提升。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">借助CAS（AtomicReference）实现单例模式：</span></p> 
<section class="output_wrapper"> 
 <pre>
          
  <section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">
           
   <pre style="font-size: inherit;color: inherit;line-height: inherit;"><p style="line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;final&nbsp;AtomicReference&lt;Singleton&gt;&nbsp;INSTANCE&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;AtomicReference&lt;Singleton&gt;();&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">Singleton</span>()&nbsp;</span>{}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">static</span>&nbsp;Singleton&nbsp;<span class="hljs-title" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getInstance</span>()&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">for</span>&nbsp;(;;)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Singleton&nbsp;singleton&nbsp;=&nbsp;INSTANCE.<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">get</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span class="hljs-literal" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>&nbsp;!=&nbsp;singleton)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;singleton;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleton&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Singleton();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(INSTANCE.compareAndSet(<span class="hljs-literal" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>,&nbsp;singleton))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;singleton;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}&nbsp;</p></pre>
          
  </section></pre> 
</section> 
<p style="line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;"><span style="font-size: 15px;">用CAS的好处在于不需要使用传统的锁机制来保证线程安全,CAS是一种基于忙等待的算法,依赖底层硬件的实现,相对于锁它没有线程切换和阻塞的额外消耗,可以支持较大的并行度。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.51875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4IDeGzKkI6JYvkZShfECjP9tPwYaiaS87yReia45CmHexiaLCFT1y5HT1A/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4IDeGzKkI6JYvkZShfECjP9tPwYaiaS87yReia45CmHexiaLCFT1y5HT1A/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.4125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4jZXibxeEQnL0iaKpq7zXD36nNkZoY3fc7qWABibva0bDJZyPXxiajvw20g/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4jZXibxeEQnL0iaKpq7zXD36nNkZoY3fc7qWABibva0bDJZyPXxiajvw20g/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">使用CAS实现单例只是个思路而已，只是拓展一下帮助读者熟练掌握CAS以及单例等知识、千万不要在代码中使用！</span><span style="font-size: 15px;">！</span><span style="font-size: 15px;">！</span><span style="font-size: 15px;">这个代码其实有很大的优化空间。</span><span style="font-size: 15px;">聪明的你，知道以上代码存在哪些隐患吗？</span></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.46484375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4g4ZyDlicyj3pY3yTlhg2PGibs4IOqcl8GuZTmcZwygvS5C6JLqjOBX9Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4g4ZyDlicyj3pY3yTlhg2PGibs4IOqcl8GuZTmcZwygvS5C6JLqjOBX9Q/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;text-align: center;"><img class="" data-copyright="0" data-ratio="0.471875" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4a4Uov5IAXM7Zd8CwJ0AAOYFXRRyibLgXzqG1puS0sBme7JibXCXqeI7g/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/C1uDMDqjn1ibhxM6wtI61C7logmiaPyZic4a4Uov5IAXM7Zd8CwJ0AAOYFXRRyibLgXzqG1puS0sBme7JibXCXqeI7g/640?wx_fmt=jpeg"></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.5482233502538071" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAug39yByOmcISc1L0Exsb7CNugP5wV0jXZJO3A5phGZmodPk0Kic8270crj5QPOpzthxcuiaa8EhX8vg/640?wx_fmt=jpeg" data-type="jpeg" data-w="591" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAug39yByOmcISc1L0Exsb7CNugP5wV0jXZJO3A5phGZmodPk0Kic8270crj5QPOpzthxcuiaa8EhX8vg/640?wx_fmt=jpeg"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">作为码一代，想教码二代却无从下手：</span><br></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">听说少儿编程很火，可它有哪些好处呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">孩子多大开始学习比较好呢？又该如何学习呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">最新的编程教育政策又有哪些呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">下面给大家介绍CSDN新成员：<strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">极客宝宝（ID：</strong><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">geek_baby）</strong></span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">戳他了解更多↓↓↓</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><img class="rich_pages " data-copyright="0" data-cropselx1="180" data-cropselx2="438" data-cropsely1="0" data-cropsely2="258" data-ratio="0.3697916666666667" data-s="300,640" data-type="jpeg" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuh1bcXNq238J3vRKyXya05vbbgCLnCbTPs0mGuVrLHntraYT5MIPrhkqQCmnqobLOf7nkWPh5j6vw/640?wx_fmt=jpeg" style="box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: 618px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuh1bcXNq238J3vRKyXya05vbbgCLnCbTPs0mGuVrLHntraYT5MIPrhkqQCmnqobLOf7nkWPh5j6vw/640?wx_fmt=jpeg"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 255, 255);background-color: rgb(60, 142, 216);font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">&nbsp;热 文</strong>&nbsp;推 荐&nbsp;</strong></span></p> 
<p style="margin-right: 8px;margin-bottom: 10px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 1px;line-height: normal;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718835&amp;idx=3&amp;sn=58fe6c381a51b7072677c44895bff718&amp;chksm=bea6b3a089d13ab66f2f710a6fb5e08de192fe964c10584d448e0c157d5c9cccdd042d49221a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞&nbsp;</a></span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718898&amp;idx=1&amp;sn=49e100cceec9d9deede43afae13f92a2&amp;chksm=bea6b36189d13a7760f16ccaeae4b922a2cd40acadca67194ea0d1acd1acf6f38a88e2136453&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">马云：腾讯是阿里的成长伴侣；华为 2 万 CNBG 员工“投奔”余承东；18 岁学生索赔苹果 10 亿美元 | 极客头条</span></a><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 10px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 1px;line-height: normal;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718835&amp;idx=3&amp;sn=58fe6c381a51b7072677c44895bff718&amp;chksm=bea6b3a089d13ab66f2f710a6fb5e08de192fe964c10584d448e0c157d5c9cccdd042d49221a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞&nbsp;</a></span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718898&amp;idx=2&amp;sn=bb698c2e457e9dae9edca1ffa9b14d52&amp;chksm=bea6b36189d13a773e74d666dea118d42ff5331d1429ef03e6a2969a6521d939b6bd8fe9b93f&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">取代 JavaScript！Python 成 Stack Overflow 最受质疑编程语言</span></a><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 10px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 1px;line-height: normal;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718835&amp;idx=3&amp;sn=58fe6c381a51b7072677c44895bff718&amp;chksm=bea6b3a089d13ab66f2f710a6fb5e08de192fe964c10584d448e0c157d5c9cccdd042d49221a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞&nbsp;</a></span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718898&amp;idx=3&amp;sn=8b5ac0399f38847ca7fd51710b7c1e00&amp;chksm=bea6b36189d13a77e71985eebf346361252678b7f6212a8dd9442877f6fe4c8e68747d0779dd&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">流量为王，程序员如何打破 8 秒原则？| 技术头条</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MDA4NDkxMQ==&amp;mid=2247483892&amp;idx=1&amp;sn=07b2da6a28c48581101bc3b1c680850c&amp;chksm=ce9279b4f9e5f0a29653f9c4330ca561db34383f7b321f6761613814464c8f03e565e7608a3a&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">☞ 5G 赋能教育信息化？</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA5MzY4NTQwMA==&amp;mid=2651010457&amp;idx=1&amp;sn=8d5be8892a5b5b01fa07aa3b4ec4df31&amp;chksm=8bad866ebcda0f78f057158bdc319c32fce1a56e54f30499c699f0f9a2b244669af70c2e66ac&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">☞ 源码泄露是裁员报复还是程序员反抗 996？</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827337&amp;idx=1&amp;sn=5c580f242966f000500251077ebaf9e4&amp;chksm=871e8febb06906fd3453dc2744c0765f5a96da0850e5e9e21bff0ad4fe77085890116bdfcc2d&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">☞&nbsp;深入浅出Docker 镜像 | 技术头条</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI0ODcxODk5OA==&amp;mid=2247504577&amp;idx=1&amp;sn=818e6b4c2b9a05de871d2d7073051307&amp;chksm=e99ee138dee9682ed6c886b7be3536caab8b491ad78a30e7715c3aabc21b08daced50d893917&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">☞ 特斯拉全新自动驾驶芯片最强？英伟达回怼，投资者用脚投票</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA5MjcxNjc2Ng==&amp;mid=2650559816&amp;idx=1&amp;sn=380cfd3d18fb987c0073bf1b8289155a&amp;chksm=88601ef9bf1797ef9e671113fdeed0dac0e1750691de9c6a594dd46706f72aeafa9028b57fe5&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;">☞ 她说：为啥程序员都特想要机械键盘？这答案我服！</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247494624&amp;idx=1&amp;sn=4c4cedcc1e2376ffe10cfe8af33aad88&amp;chksm=fc7fb51dcb083c0b9312a2c4177358a3f64acef22ac8125b6fa5e378ec95a7122a6eca143a96&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);box-sizing: border-box !important;word-wrap: break-word !important;">☞ 西安奔驰女车主哭诉维权背后, 区块链究竟能否还消费者以尊严？</span></a></p> 
<p><br></p> 
<section style="max-width: 100%;letter-spacing: 0.544px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
 <section class="" style="max-width: 100%;font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
  <pre style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;padding: 0.5em;max-width: 100%;min-height: 1em;font-size: 14px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;background: rgb(34, 34, 34);color: rgb(170, 170, 170);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;">System.out.println(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个在看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">console.log(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(50, 170, 238);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">print</span>(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(50, 170, 238);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">printf</span>(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！\n"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">cout&nbsp;&lt;&lt;&nbsp;<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>&nbsp;&lt;&lt;&nbsp;endl;<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">Console.WriteLine(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">Response.Write(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">alert(</span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">)</span><br style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;font-variant-numeric: normal;line-height: inherit;widows: 1;color: rgb(50, 170, 238);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">echo </span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span></p></pre> 
 </section> 
</section> 
<section class="" data-tools="135编辑器" data-id="94250" style="max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;border-width: 0px;border-style: none;border-color: initial;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
 <section class="" data-tools="135编辑器" data-id="91842" style="max-width: 100%;box-sizing: border-box;border-width: 0px;border-style: none;border-color: initial;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
  <section style="max-width: 100%;text-align: right;width: auto;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
   <section style="max-width: 100%;display: inline-block;clear: both;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
    <section class="" data-brushtype="text" style="padding: 18px 15px 20px 10px;max-width: 100%;box-sizing: border-box;color: rgb(86, 146, 214);background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdy66AHd7QqL7A2s5icSBE0aw4iaKOKPnXGYxQPhG7VMpbbYV6VJprSh7w/640?wx_fmt=png&quot;);background-repeat: no-repeat;text-align: center;background-size: 100% 100%;font-size: 16px;letter-spacing: 1.5px;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
     <section style="max-width: 100%;display: flex;justify-content: center;align-items: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
      <section style="margin-left: 2px;max-width: 100%;width: 20px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
       <img class="" data-ratio="0.8936170212765957" data-type="png" data-w="47" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdvAd0o9e1LlUGA2k0Yib222agOxzweXhahA9GuzJcGBg0dA4DzlibxRqw/640?wx_fmt=png" style="margin-bottom: -6px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: 20px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdvAd0o9e1LlUGA2k0Yib222agOxzweXhahA9GuzJcGBg0dA4DzlibxRqw/640?wx_fmt=png"> 
      </section> 
      <section class="" data-brushtype="text" style="max-width: 100%;font-size: 14px;color: rgb(51, 51, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
       <span style="max-width: 100%;font-family: 楷体, 楷体_GB2312, SimKai;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">你点的每个“在看”，我都认真当成了喜欢</span> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

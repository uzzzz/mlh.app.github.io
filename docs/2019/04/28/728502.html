<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>程序员如何借助 AI 开挂股票神预测？ 技术头条 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="程序员如何借助 AI 开挂股票神预测？ 技术头条" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="作者 | Boris B 译者 | Major 编辑 | Jane 出品 | AI科技大本营（id：rgznai100） 【导语】用深度学习预测股票价格不是一个新话题，随着技术的不断发展，大家一直在不断尝试新技术。这次教程中，作者设计了一个强强联合型模型来预测股票价格，为什么这么形容？作者设计了一个 GAN 模型，其生成网络为 LSTM 模型用来预测时间序列数据、CNN 模型作判别网络，用 BERT 模型作为情绪分析模型。带有高斯过程的贝叶斯优化和深度强化学习方法来获得 GAN 的超参数。为什么创建这样的组合？都将在下面的内容中为大家进行一一解答。 这篇教程的篇幅很长，为了让大家能对重要技术内容一目了然，作者在开始加入了层级清晰的目录，主要从【背景】、【数据特征】、【GAN 模型架构】、【超参数优化】等几大方面进行全面讲解。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 下面营长对其中涉及的技术细节进行了编译： 背景 在今天的任务中，预测的是高盛公司（本文中会简称为 GS）的股票变化趋势，使用 2010 年 1 月 1 日至 2018 年 12 月 31 日的日收盘价作为训练（七年）和测试（两年）数据。 成功训练一个 GAN 最棘手的部分是获得正确的超参数。为此，作者使用 Bayesian optimisation（带有高斯过程的贝叶斯优化）和用于决定何时以及如何改变 GAN 的超参数的深层强化学习（DRL），在创建强化学习过程中，将使用一些最新技术，如 RAINBOW 和 PPO。 此外，在模型中还使用许多不同类型的输入数据。随着股票的历史交易数据和技术指标，设计了一些技术方法，如使用 NLP 中的 BERT 来创建情绪分析模型（作为基本面分析的来源），以及用傅立叶变换（Fourier transforms）提取总体趋势方向、识别其他高级特征的栈式自动编码器（ Stacked autoencoder）；采用特征投资组合寻找相关资产；采用 ARIMA 方法进行股票函数近似。实际上，这些技术都是为了尽可能多的获取关于股票的信息、模式、依赖关系等等。 开发环境和框架选择 MXNet 和其高级 API（Gluon）创建所有的神经网络，并在多个 GPU 上进行训练。 &nbsp; &nbsp; &nbsp; &nbsp;图：完整体系结构概览 通过上面的技术背景介绍，相信大家已经感觉到想准确预测股市是一项非常复杂的任务，影响股票变化的事件、条件或因素等实在是太多了。所以，想更好的了解这些先决条件，还需要先做几个重要的假设：（1）市场不是 100% 的随机；（2）历史重复；（3）市场遵循人们的理性行为；（4）市场是“完美的”。 数据 首先，要了解什么因素会影响 GS 的股票价格波动，需要包含尽可能多的信息（从不同的方面和角度）。将使用 1585 天的日数据来训练各种算法（70% 的数据），并预测另外 680 天的结果（测试数据）。然后，将预测结果与测试数据进行比较。每种类型的数据（亦称为特征）将在后面的部分中详细解释。 简而言之，将使用的特征有： a.相关资产：涉及商品、外汇、指数、固定收益证券等各类资产数据；影响高盛公司股票价格趋势的外部因素又有很多，并且很复杂，包括竞争对手、客户、全球经济、地缘政治形势、财政和货币政策等等，这些因素还会相互产生影响。选择合适的相关资产是非常重要的： （1）首先是和 GS 相似的公司，如将摩根大通（JPMorgan Chase）和摩根士丹利（Morgan Stanley）等加入数据集。 （2）作为一家投资银行，高盛依赖于全球经济，需要关注全球经济指数和 libor 利率。 （3）每日波动指数(VIX)。 （4）综合指数，如 NASDAQ 和 NYSE（美国）、FTSE 100（英国）、日经指数 225（日本）、恒生指数和 BSE Sensex（APAC）指数。 （5）货币，全球贸易多次反映在货币流动中，使用一篮子货币（如美元-日元、英镑-美元等）作为特征。 总的来说，在数据集中还有 72 个其他资产（每个资产的每日价格）。 b.技术指标：许多投资人都会关注技术指标，在这里，把最受欢迎的指标作为独立特征，包括 7 天和 21 天波动平均值、指数波动平均、Momentum、MACD 等 12项技术指标。 def get_technical_indicators(dataset): # Create 7 and 21 days Moving Average dataset[&#39;ma7&#39;] = dataset[&#39;price&#39;].rolling(window=7).mean() dataset[&#39;ma21&#39;] = dataset[&#39;price&#39;].rolling(window=21).mean() # Create MACD dataset[&#39;26ema&#39;] = pd.ewma(dataset[&#39;price&#39;], span=26) dataset[&#39;12ema&#39;] = pd.ewma(dataset[&#39;price&#39;], span=12) dataset[&#39;MACD&#39;] = (dataset[&#39;12ema&#39;]-dataset[&#39;26ema&#39;]) # Create Bollinger Bands dataset[&#39;20sd&#39;] = pd.stats.moments.rolling_std(dataset[&#39;price&#39;],20) dataset[&#39;upper_band&#39;] = dataset[&#39;ma21&#39;] + (dataset[&#39;20sd&#39;]*2) dataset[&#39;lower_band&#39;] = dataset[&#39;ma21&#39;] - (dataset[&#39;20sd&#39;]*2) # Create Exponential moving average dataset[&#39;ema&#39;] = dataset[&#39;price&#39;].ewm(com=0.5).mean() # Create Momentum dataset[&#39;momentum&#39;] = dataset[&#39;price&#39;]-1 return datasetdataset_TI_df = get_technical_indicators(dataset_ex_df[[&#39;GS&#39;]])dataset_TI_df.head() &nbsp; &nbsp; &nbsp; &nbsp; c.基本面分析：无论股票涨跌，这都是一个非常重要的数据。分析时会用到两个特征：公司业绩报告和新闻将引导的一些趋势，因此通过分析新闻来准确预测市场的情绪也是一项非常重要的工作，所以这次的方法中，将使用 BERT 来构建情绪分析模型，提取股票新闻中的情绪倾向。最后采用 sigmoid 归一化，结果介于 0 到 1 之间，（0 表示负面情绪，1 表示正面情绪），每一天都会创建一个平均每日分数作为一个特征添加。 使用的是 MXNet 中 Gluon NLP 库中所提供的经过预训练的 BERT 模型，大家可以尝试一下。此前我们也为大家介绍过简单易上手的 Gluon，详情可参考营长亲自上手的教程。 d.傅里叶变换：利用每日收盘价，创建傅立叶变换，以获得几个长期和短期趋势。使用这些变换消除大量的噪声，获得真实股票波动的近似值。有了趋势近似，可以帮助 LSTM 网络更准确地选择其预测趋势。 data_FT = dataset_ex_df[[&#39;Date&#39;, &#39;GS&#39;]]close_fft = np.fft.fft(np.asarray(data_FT[&#39;GS&#39;].tolist()))fft_df = pd.DataFrame({&#39;fft&#39;:close_fft})fft_df[&#39;absolute&#39;] = fft_df[&#39;fft&#39;].apply(lambda x: np.abs(x))fft_df[&#39;angle&#39;] = fft_df[&#39;fft&#39;].apply(lambda x: np.angle(x))plt.figure(figsize=(14, 7), dpi=100)fft_list = np.asarray(fft_df[&#39;fft&#39;].tolist())for num_ in [3, 6, 9, 100]: fft_list_m10= np.copy(fft_list); fft_list_m10[num_:-num_]=0 plt.plot(np.fft.ifft(fft_list_m10), label=&#39;Fourier transform with {} components&#39;.format(num_))plt.plot(data_FT[&#39;GS&#39;], label=&#39;Real&#39;)plt.xlabel(&#39;Days&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 3: Goldman Sachs (close) stock prices &amp; Fourier transforms&#39;)plt.legend()plt.show() &nbsp; &nbsp; &nbsp;&nbsp;图：高盛股票的傅里叶变换 e.ARIMA：这是预测时间序列数据未来值的最流行技术之一。 from&nbsp;pandas&nbsp;import&nbsp;read_csvfrom pandas import datetimefrom statsmodels.tsa.arima_model import ARIMAfrom sklearn.metrics import mean_squared_errorX = series.valuessize = int(len(X) * 0.66)train, test = X[0:size], X[size:len(X)]history = [x for x in train]predictions = list()for t in range(len(test)): model = ARIMA(history, order=(5,1,0)) model_fit = model.fit(disp=0) output = model_fit.forecast() yhat = output[0] predictions.append(yhat) obs = test[t] history.append(obs)error = mean_squared_error(test, predictions)print(&#39;Test MSE: %.3f&#39; % error)Test MSE: 10.151# Plot the predicted (from ARIMA) and real pricesplt.figure(figsize=(12, 6), dpi=100)plt.plot(test, label=&#39;Real&#39;)plt.plot(predictions, color=&#39;red&#39;, label=&#39;Predicted&#39;)plt.xlabel(&#39;Days&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 5: ARIMA model on GS stock&#39;)plt.legend()plt.show &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.Stacked autoencoders （栈式自动编码器）：上面提到的一些特征是研究人员经过几十年的研究发现的，但是还是会忽视一些隐藏的关联特征，由此，Stacked autoencoders  就可以解决这个问题，通过学习每个隐藏层，发现更多新特征（可能有些是我们无法发现，理解的）。这次没有把 RELU 作为激活函数，而是使用了 GELU，也可以用于 BERT 模型中。至于为什么选择 GELU，大家可以在原文中看到作者给出的和 RELU 对比的实例。 g.深度无监督学习：用于期权定价中的异常检测，将再使用一个特征：每天都会增加高盛股票90天看涨期权的价格。期权定价本身结合了很多数据。期权合约的价格取决于股票的未来价值(分析师也试图预测价格，以便为看涨期权得出最准确的价格)。使用深度无监督学习(自组织映射)，尝试发现出现异常的每日价格。异常(如价格的剧烈变化)可能表明出现了一个事件，这有助于LSTM了解整体股票模式。 from utils import *import timeimport numpy as npfrom mxnet import nd, autograd, gluonfrom mxnet.gluon import nn, rnnimport mxnet as mximport datetimeimport&nbsp;seaborn&nbsp;as&nbsp;snsimport matplotlib.pyplot as plt%matplotlib inlinefrom sklearn.decomposition import PCAimport mathfrom sklearn.preprocessing import MinMaxScalerfrom sklearn.metrics import mean_squared_errorfrom sklearn.preprocessing import StandardScalerimport xgboost as xgbfrom sklearn.metrics import accuracy_scoreimport warningswarnings.filterwarnings(&quot;ignore&quot;)context = mx.cpu(); model_ctx=mx.cpu()mx.random.seed(1719)Note: The purpose of this section (3. The Data) is to show the data preprocessing and to give rationale for using different sources of data, hence I will only use a subset of the full data (that is used for training).def parser(x): return datetime.datetime.strptime(x,&#39;%Y-%m-%d&#39;)dataset_ex_df = pd.read_csv(&#39;data/panel_data_close.csv&#39;, header=0, parse_dates=[0], date_parser=parser)dataset_ex_df[[&#39;Date&#39;,&nbsp;&#39;GS&#39;]]. 接下来，有了这么多特征，还需要执行几个重要步骤： h.对数据的“质量”进行统计检查：确保数据质量对模型来说非常重要，因此要执行以下几个简单的检验，如异方差、多重共线性、Serial correlation 等。 i.确定特征重要性：采用 XGBoost 算法。这么多的特征，必须考虑是否所有这些都真正地指示了 GS 股票波动方向。例如，数据集中包括其变化可能意味着经济变化的 LIBOR，而这又可能暗示 GS 股票将会发生波动，因此需要对此预测进行测试，在众多的测试方法中，本教程中选择了 XGBoost，其在分类和回归问题上都提供了很好的结果。 def&nbsp;get_feature_importance_data(data_income): data = data_income.copy() y = data[&#39;price&#39;] X = data.iloc[:, 1:] train_samples = int(X.shape[0] * 0.65) X_train = X.iloc[:train_samples] X_test = X.iloc[train_samples:] y_train = y.iloc[:train_samples] y_test = y.iloc[train_samples:] return (X_train, y_train), (X_test, y_test)# Get training and test data(X_train_FI, y_train_FI), (X_test_FI, y_test_FI) = get_feature_importance_data(dataset_TI_df)regressor = xgb.XGBRegressor(gamma=0.0,n_estimators=150,base_score=0.7,colsample_bytree=1,learning_rate=0.05)xgbModel = regressor.fit(X_train_FI,y_train_FI, \ eval_set = [(X_train_FI, y_train_FI), (X_test_FI, y_test_FI)], \ verbose=False)eval_result = regressor.evals_result()training_rounds&nbsp;=&nbsp;range(len(eval_result[&#39;validation_0&#39;][&#39;rmse&#39;])) 最后一步，使用主成分分析（PCA）创建特征组合，以减少自动编码器生成特征的维数。在自动编码器中创建了 112 个特征，不过高维特征对我们的价值更大，所以在这 112 个特征的基础上通过 PCA 创建高维的特征组合，减少数据维度。不过，这也是我们提出的实验性方法。 plt.figure(figsize=(15, 5))plt.subplots_adjust(left=None, bottom=None, right=None, top=None, wspace=.5, hspace=None)ranges_ = (-10, 3, .25)plt.subplot(1, 2, 1)plt.plot([i for i in np.arange(*ranges_)], [relu(i) for i in np.arange(*ranges_)], label=&#39;ReLU&#39;, marker=&#39;.&#39;)plt.plot([i for i in np.arange(*ranges_)], [gelu(i) for i in np.arange(*ranges_)], label=&#39;GELU&#39;)plt.hlines(0, -10, 3, colors=&#39;gray&#39;, linestyles=&#39;--&#39;, label=&#39;0&#39;)plt.title(&#39;Figure 7: GELU as an activation function for autoencoders&#39;)plt.ylabel(&#39;f(x) for GELU and ReLU&#39;)plt.xlabel(&#39;x&#39;)plt.legend()plt.subplot(1, 2, 2)plt.plot([i for i in np.arange(*ranges_)], [lrelu(i) for i in np.arange(*ranges_)], label=&#39;Leaky ReLU&#39;)plt.hlines(0, -10, 3, colors=&#39;gray&#39;, linestyles=&#39;--&#39;, label=&#39;0&#39;)plt.ylabel(&#39;f(x) for Leaky ReLU&#39;)plt.xlabel(&#39;x&#39;)plt.title(&#39;Figure 8: LeakyReLU&#39;)plt.legend()plt.sho &nbsp; &nbsp; &nbsp; &nbsp; 让我们看一下过去 9 年的股价变化。虚线表示训练数据和测试数据之间的分割线。 plt.figure(figsize=(14, 5), dpi=100)plt.plot(dataset_ex_df[&#39;Date&#39;], dataset_ex_df[&#39;GS&#39;], label=&#39;Goldman Sachs stock&#39;)plt.vlines(datetime.date(2016,4, 20), 0, 270, linestyles=&#39;--&#39;, colors=&#39;gray&#39;, label=&#39;Train/Test data cut-off&#39;)plt.xlabel(&#39;Date&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 2: Goldman Sachs stock price&#39;)plt.legend()plt.show() &nbsp; &nbsp; &nbsp; &nbsp;图：过去9年高盛股价的波动 num_training_days = int(dataset_ex_df.shape[0]*.7)print(&#39;Number of training days: {}. Number of test days: {}.&#39;.format(num_training_days, \ dataset_ex_df.shape[0]-num_training_days))Number&nbsp;of&nbsp;training&nbsp;days:&nbsp;1585.&nbsp;Number&nbsp;of&nbsp;test&nbsp;days:&nbsp;680. 生成对抗性网络(GAN) &nbsp; &nbsp; &nbsp; &nbsp;图：GAN 架构 1、为什么采用GAN进行股市预测？ GAN 最多被应用在创作逼真的图像、画作和视频剪辑等。对预测时间序列数据的应用并不多。但这两者的思想都是类似的。我们希望预测未来的股票价格，GS 的股票波动和行为应该大致相同(除非开始以完全不同的方式运作，或者经济急剧变化)。因此，希望“生成”的数据与已经拥有的历史交易数据分布相似，当然不是完全相同。在这个例子中将使用 LSTM 作为时间序列生成模型，CNN 作为判别模型。 2、Metropolis-Hastings GAN 和 Wasserstein GAN （1）Metropolis-Hastings GAN：与传统的 GAN 相比，Uber 团队最近提出一种新改进的 GAN 模型——Metropolis-Hastings GAN （MHGAN），它有点类似于谷歌和加州大学伯克利分校提出的Discriminator Rejection Sampling。通常情况下，在训练完GAN之后就不再使用 D 了。然而，MHGAN 和 DRS 试图使用 D 来选择由 G 生成的接近真实的样本。 （2）Wasserstein GAN：训练 GAN 是相当困难的。模型可能永远不会收敛，模式崩溃也很容易发生。，通过 Wasserstein GAN 尝试解决这个问题。KL 距离和 JS 距离是两种常用的分布，而 WGAN 使用的是 Wasserstein distanc。 3、生成模型：单层RNN （1）LSTM 还是 GRU？ 关于 RNN、LSTM 等模型的基础介绍这里不多做赘述，主要聚焦在 RNN 在时间序列数据上的应用，因为它们可以跟踪所有以前的数据点，并且可以捕获经过时间发展的模式。可以通过裁剪解 RNN 梯度消失或梯度爆炸问题。 在精度方面，LSTM 和 GRU 的结果相差不多，但是 GRU 使用的训练参数要比 LSTM 少，计算强度也要小。 （2）LSTM 体系结构 LSTM架构非常简单：一个LSTM层，包含112个输入单元(数据集中有112个特征)和500个隐藏单元；一个以每日股价为输出的 Dense 层；采用 Xavier 初始化，使用 L1 损失函数 在下面的代码中，采用adam作为优化器，学习率为 0.01。 gan_num_features = dataset_total_df.shape[1]sequence_length = 17class RNNModel(gluon.Block): def __init__(self, num_embed, num_hidden, num_layers, bidirectional=False, \ sequence_length=sequence_length, **kwargs): super(RNNModel, self).__init__(**kwargs) self.num_hidden = num_hidden with self.name_scope(): self.rnn = rnn.LSTM(num_hidden, num_layers, input_size=num_embed, \ bidirectional=bidirectional, layout=&#39;TNC&#39;) self.decoder = nn.Dense(1, in_units=num_hidden) def forward(self, inputs, hidden): output, hidden = self.rnn(inputs, hidden) decoded = self.decoder(output.reshape((-1, self.num_hidden))) return decoded, hidden def begin_state(self, *args, **kwargs): return self.rnn.begin_state(*args, **kwargs) lstm_model = RNNModel(num_embed=gan_num_features, num_hidden=500, num_layers=1)lstm_model.collect_params().initialize(mx.init.Xavier(), ctx=mx.cpu())trainer = gluon.Trainer(lstm_model.collect_params(), &#39;adam&#39;, {&#39;learning_rate&#39;: .01})loss&nbsp;=&nbsp;glu （3）学习率调度器 学习率是非常重要的参数之一，每个优化器设置学习率，如 SGD、Adam 或 RMSProp 在训练神经网络时至关重要，因为它既控制着网络的收敛速度，又控制着网络的最终性能，接下来就要确定每个阶段的学习率。 class&nbsp;TriangularSchedule(): def __init__(self, min_lr, max_lr, cycle_length, inc_fraction=0.5): self.min_lr = min_lr self.max_lr = max_lr self.cycle_length = cycle_length self.inc_fraction = inc_fraction def __call__(self, iteration): if iteration &lt;= self.cycle_length*self.inc_fraction: unit_cycle = iteration * 1 / (self.cycle_length * self.inc_fraction) elif iteration &lt;= self.cycle_length: unit_cycle = (self.cycle_length - iteration) * 1 / (self.cycle_length * (1 - self.inc_fraction)) else: unit_cycle = 0 adjusted_cycle = (unit_cycle * (self.max_lr - self.min_lr)) + self.min_lr return adjusted_cycleclass CyclicalSchedule(): def __init__(self, schedule_class, cycle_length, cycle_length_decay=1, cycle_magnitude_decay=1, **kwargs): self.schedule_class = schedule_class self.length = cycle_length self.length_decay = cycle_length_decay self.magnitude_decay = cycle_magnitude_decay self.kwargs = kwargs def __call__(self, iteration): cycle_idx = 0 cycle_length = self.length idx = self.length while idx &lt;= iteration: cycle_length = math.ceil(cycle_length * self.length_decay) cycle_idx += 1 idx += cycle_length cycle_offset = iteration - idx + cycle_length schedule = self.schedule_class(cycle_length=cycle_length,**self.kwargs)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;schedule(cycle_offset)&nbsp;*self.magnitude_decay**cycle_idx （4）防止过拟合与偏差-方差权衡 防止过拟合，注意总损失也是要在训练模型中非常重要的一个问题。不仅在生成器中的 LSTM 模型，判别器中的 CNN 模型、自动编码器中都使用了几种防止过拟合的技术： a.确保数据质量 b.正则化，或权重惩罚：最常用的两种正则化技术是L1 和 L2 正则法。L1对离散值更有鲁棒性，当数据稀疏时使用，可得到特征重要性。因此，在股票价格预测这个应用案例中将使用 L1 正则法。 c.Dropout。Dropout层随机删除隐藏层中的节点。 d.Dense-sparse-dense training e.提前停止. （5）权衡偏差-方差 建立复杂神经网络时，另一个重要的考虑因素是偏差-方差权衡。训练网络的误差基本上是偏差、方差和不可约误差 σ(噪声和随机性引起的误差)的函数。 最简单的权衡公式是：误差=偏差^2+方差+σ. a.偏差（Bias）：偏差衡量一个经过训练的（训练数据集）算法对未见数据的概括能力。高偏差(欠拟合)意味着模型在隐藏数据上不能很好地工作。 b.方差（Variance）：方差衡量模型对数据集变化的敏感性。高方差意味着过拟合。 4、 一维 CNN 判别模型 （1）为何采用CNN作为判别模型？ CNN 网络在提取隐藏特征等工作上具有优势，那如何应用于这个任务中？大家不妨尝试一下，数据点行程小趋势，小趋势行程大趋势，趋势反之形成模式，而 CNN 在此用检测特征的能力来提取 GS 股价趋势中的模式信息。 &nbsp; &nbsp; &nbsp; &nbsp;图：本文提出的 CNN 模型的体系结构。 超参数优化 （1）跟踪和优化的超参数是： batch_size：LSTM 和 CNN 的 Batch 大小 cnn_lr：CNN 的学习率 strides：CNN 的跨步卷积数 lrelu_alpha：GAN 中 LeakyReLU 的 Alpha 值 batchnorm_momentum：CNN Batch 正则化的 momentum padding：CNN 中的 Padding kernel_size：1 CNN 的内核大小 dropout：LSTM 中的 Dropout 层 filters：过滤器的初始数目 epoch = 200 （2）超参数优化 经过 200 次 GAN 训练后，将记录 MAE（LSTM、GG 中的误差函数）并作为奖励值传递给强化学习（RL）模型，以决定是否用同一组超参数来改变保持训练的超参数，如果RL决定更新超参数，它将调用 Bayes 优化库。 （3）超参数优化中的强化学习 为什么在超参数优化中使用强化学习？股票市场一直在变化。即使能够训练 &nbsp;GAN 和 LSTM 来创造非常精确的结果，结果也只能在一定的时间内有效。也就是说，我们需要不断优化整个过程。为了优化这一过程，可以添加或删除特征，或改进深度学习模型。改进模型的最重要的方法之一就是通过超参数。一旦找到了一组特定的超参数，就需要决定何时修改它们，以及何时使用已经知道的集合(探索或利用)。此外，股票市场代表了一个依赖于数百万参数的连续空间。 （4）强化学习理论 使用无模型的 RL 算法，原因很明显，我们不知道整个环境，因此没有关于环境如何工作的定义模型（如果存在，就不需要预测股票价格的变化）。使用两个细分的无模型RL：策略优化（Policy Optimization）和 Q-Learning。构建 RL 算法的一个关键方面是精确设置奖励。它必须捕捉环境的所有方面以及代理与环境的交互。 a.Q-Learning：一种基于Q-Learning的非策略深度强化学习算法，它将7种算法结合在一起：DQN、Double Q Learning（双QL）、Prioritized replay、决斗网络(Dueling networks)、多步学习、分布式RL、噪声网络（Noisy Nets）。在Q-Learning中，学习价值从某一状态采取行动。Q 值采取行动后的预期回报。 b.策略优化：这里采用近端策略优化（Proximal Policy Optimization, PPO），在决策优化中，学习从某一状态采取的行动。(如果使用诸如Actor/Critic之类的方法，也会了解处于给定状态的价值。 （5）贝叶斯优化 使用贝叶斯优化，不采用网格搜索，因为可能需要很长时间才能找到超参数的最佳组合。 &nbsp; &nbsp; &nbsp; &nbsp;图：贝叶斯超参数优化的高斯过程 5、结果 最后，使用测试数据作为不同阶段的输入，LSTM 的输出与实际股价进行比较： （1）绘制第一次训练之后的结果 &nbsp; &nbsp; &nbsp; （2）绘制 50 次训练后的结果。 &nbsp; &nbsp; &nbsp; &nbsp; （3）绘制 200 次训练后的结果。 &nbsp; &nbsp; &nbsp; RL 运行了 10 eposide ，本文定义一个 eposide 是 GAN 完整训练 200 次后，下图是得到的最终的结果。 &nbsp; &nbsp; &nbsp; &nbsp; 总结 可见，作者在把各路强模型联合打造的结果还是非常优秀的。不过作者还尝试创建一个 RL 环境，用于测试决定何时以及如何进行交易的交易算法。GAN 的输出将是此环境中的一个参数，虽然这些都不能完全做到预测的作用，但是在实际任务中不断尝试新技术还是很有意义的，期待作者后续工作可以带来更好的结果。完整详细教程还可以访问 Github 项目： https://github.com/borisbanushev/stockpredictionai 作为码一代，想教码二代却无从下手： 听说少儿编程很火，可它有哪些好处呢？ 孩子多大开始学习比较好呢？又该如何学习呢？ 最新的编程教育政策又有哪些呢？ 下面给大家介绍CSDN新成员：极客宝宝（ID：geek_baby） 戳他了解更多↓↓↓ &nbsp;热 文&nbsp;推 荐&nbsp; ☞&nbsp;Erlang 之父去世，他留给程序员两点忠告 ☞&nbsp;中国程序员独闯硅谷，逆袭成美国最佳 CEO，公司市值 160 亿美元！ ☞&nbsp;我逛了下 JDK 一条街，发现了不少好东西！ ☞&nbsp;斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年 ☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码 ☞ 微服务落地，我们在考虑什么？| 技术头条 ☞ 爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪? ☞ 程序员被骗&quot;黑砖窑&quot;：监禁、恐吓、996无休编程！ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢" />
<meta property="og:description" content="作者 | Boris B 译者 | Major 编辑 | Jane 出品 | AI科技大本营（id：rgznai100） 【导语】用深度学习预测股票价格不是一个新话题，随着技术的不断发展，大家一直在不断尝试新技术。这次教程中，作者设计了一个强强联合型模型来预测股票价格，为什么这么形容？作者设计了一个 GAN 模型，其生成网络为 LSTM 模型用来预测时间序列数据、CNN 模型作判别网络，用 BERT 模型作为情绪分析模型。带有高斯过程的贝叶斯优化和深度强化学习方法来获得 GAN 的超参数。为什么创建这样的组合？都将在下面的内容中为大家进行一一解答。 这篇教程的篇幅很长，为了让大家能对重要技术内容一目了然，作者在开始加入了层级清晰的目录，主要从【背景】、【数据特征】、【GAN 模型架构】、【超参数优化】等几大方面进行全面讲解。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 下面营长对其中涉及的技术细节进行了编译： 背景 在今天的任务中，预测的是高盛公司（本文中会简称为 GS）的股票变化趋势，使用 2010 年 1 月 1 日至 2018 年 12 月 31 日的日收盘价作为训练（七年）和测试（两年）数据。 成功训练一个 GAN 最棘手的部分是获得正确的超参数。为此，作者使用 Bayesian optimisation（带有高斯过程的贝叶斯优化）和用于决定何时以及如何改变 GAN 的超参数的深层强化学习（DRL），在创建强化学习过程中，将使用一些最新技术，如 RAINBOW 和 PPO。 此外，在模型中还使用许多不同类型的输入数据。随着股票的历史交易数据和技术指标，设计了一些技术方法，如使用 NLP 中的 BERT 来创建情绪分析模型（作为基本面分析的来源），以及用傅立叶变换（Fourier transforms）提取总体趋势方向、识别其他高级特征的栈式自动编码器（ Stacked autoencoder）；采用特征投资组合寻找相关资产；采用 ARIMA 方法进行股票函数近似。实际上，这些技术都是为了尽可能多的获取关于股票的信息、模式、依赖关系等等。 开发环境和框架选择 MXNet 和其高级 API（Gluon）创建所有的神经网络，并在多个 GPU 上进行训练。 &nbsp; &nbsp; &nbsp; &nbsp;图：完整体系结构概览 通过上面的技术背景介绍，相信大家已经感觉到想准确预测股市是一项非常复杂的任务，影响股票变化的事件、条件或因素等实在是太多了。所以，想更好的了解这些先决条件，还需要先做几个重要的假设：（1）市场不是 100% 的随机；（2）历史重复；（3）市场遵循人们的理性行为；（4）市场是“完美的”。 数据 首先，要了解什么因素会影响 GS 的股票价格波动，需要包含尽可能多的信息（从不同的方面和角度）。将使用 1585 天的日数据来训练各种算法（70% 的数据），并预测另外 680 天的结果（测试数据）。然后，将预测结果与测试数据进行比较。每种类型的数据（亦称为特征）将在后面的部分中详细解释。 简而言之，将使用的特征有： a.相关资产：涉及商品、外汇、指数、固定收益证券等各类资产数据；影响高盛公司股票价格趋势的外部因素又有很多，并且很复杂，包括竞争对手、客户、全球经济、地缘政治形势、财政和货币政策等等，这些因素还会相互产生影响。选择合适的相关资产是非常重要的： （1）首先是和 GS 相似的公司，如将摩根大通（JPMorgan Chase）和摩根士丹利（Morgan Stanley）等加入数据集。 （2）作为一家投资银行，高盛依赖于全球经济，需要关注全球经济指数和 libor 利率。 （3）每日波动指数(VIX)。 （4）综合指数，如 NASDAQ 和 NYSE（美国）、FTSE 100（英国）、日经指数 225（日本）、恒生指数和 BSE Sensex（APAC）指数。 （5）货币，全球贸易多次反映在货币流动中，使用一篮子货币（如美元-日元、英镑-美元等）作为特征。 总的来说，在数据集中还有 72 个其他资产（每个资产的每日价格）。 b.技术指标：许多投资人都会关注技术指标，在这里，把最受欢迎的指标作为独立特征，包括 7 天和 21 天波动平均值、指数波动平均、Momentum、MACD 等 12项技术指标。 def get_technical_indicators(dataset): # Create 7 and 21 days Moving Average dataset[&#39;ma7&#39;] = dataset[&#39;price&#39;].rolling(window=7).mean() dataset[&#39;ma21&#39;] = dataset[&#39;price&#39;].rolling(window=21).mean() # Create MACD dataset[&#39;26ema&#39;] = pd.ewma(dataset[&#39;price&#39;], span=26) dataset[&#39;12ema&#39;] = pd.ewma(dataset[&#39;price&#39;], span=12) dataset[&#39;MACD&#39;] = (dataset[&#39;12ema&#39;]-dataset[&#39;26ema&#39;]) # Create Bollinger Bands dataset[&#39;20sd&#39;] = pd.stats.moments.rolling_std(dataset[&#39;price&#39;],20) dataset[&#39;upper_band&#39;] = dataset[&#39;ma21&#39;] + (dataset[&#39;20sd&#39;]*2) dataset[&#39;lower_band&#39;] = dataset[&#39;ma21&#39;] - (dataset[&#39;20sd&#39;]*2) # Create Exponential moving average dataset[&#39;ema&#39;] = dataset[&#39;price&#39;].ewm(com=0.5).mean() # Create Momentum dataset[&#39;momentum&#39;] = dataset[&#39;price&#39;]-1 return datasetdataset_TI_df = get_technical_indicators(dataset_ex_df[[&#39;GS&#39;]])dataset_TI_df.head() &nbsp; &nbsp; &nbsp; &nbsp; c.基本面分析：无论股票涨跌，这都是一个非常重要的数据。分析时会用到两个特征：公司业绩报告和新闻将引导的一些趋势，因此通过分析新闻来准确预测市场的情绪也是一项非常重要的工作，所以这次的方法中，将使用 BERT 来构建情绪分析模型，提取股票新闻中的情绪倾向。最后采用 sigmoid 归一化，结果介于 0 到 1 之间，（0 表示负面情绪，1 表示正面情绪），每一天都会创建一个平均每日分数作为一个特征添加。 使用的是 MXNet 中 Gluon NLP 库中所提供的经过预训练的 BERT 模型，大家可以尝试一下。此前我们也为大家介绍过简单易上手的 Gluon，详情可参考营长亲自上手的教程。 d.傅里叶变换：利用每日收盘价，创建傅立叶变换，以获得几个长期和短期趋势。使用这些变换消除大量的噪声，获得真实股票波动的近似值。有了趋势近似，可以帮助 LSTM 网络更准确地选择其预测趋势。 data_FT = dataset_ex_df[[&#39;Date&#39;, &#39;GS&#39;]]close_fft = np.fft.fft(np.asarray(data_FT[&#39;GS&#39;].tolist()))fft_df = pd.DataFrame({&#39;fft&#39;:close_fft})fft_df[&#39;absolute&#39;] = fft_df[&#39;fft&#39;].apply(lambda x: np.abs(x))fft_df[&#39;angle&#39;] = fft_df[&#39;fft&#39;].apply(lambda x: np.angle(x))plt.figure(figsize=(14, 7), dpi=100)fft_list = np.asarray(fft_df[&#39;fft&#39;].tolist())for num_ in [3, 6, 9, 100]: fft_list_m10= np.copy(fft_list); fft_list_m10[num_:-num_]=0 plt.plot(np.fft.ifft(fft_list_m10), label=&#39;Fourier transform with {} components&#39;.format(num_))plt.plot(data_FT[&#39;GS&#39;], label=&#39;Real&#39;)plt.xlabel(&#39;Days&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 3: Goldman Sachs (close) stock prices &amp; Fourier transforms&#39;)plt.legend()plt.show() &nbsp; &nbsp; &nbsp;&nbsp;图：高盛股票的傅里叶变换 e.ARIMA：这是预测时间序列数据未来值的最流行技术之一。 from&nbsp;pandas&nbsp;import&nbsp;read_csvfrom pandas import datetimefrom statsmodels.tsa.arima_model import ARIMAfrom sklearn.metrics import mean_squared_errorX = series.valuessize = int(len(X) * 0.66)train, test = X[0:size], X[size:len(X)]history = [x for x in train]predictions = list()for t in range(len(test)): model = ARIMA(history, order=(5,1,0)) model_fit = model.fit(disp=0) output = model_fit.forecast() yhat = output[0] predictions.append(yhat) obs = test[t] history.append(obs)error = mean_squared_error(test, predictions)print(&#39;Test MSE: %.3f&#39; % error)Test MSE: 10.151# Plot the predicted (from ARIMA) and real pricesplt.figure(figsize=(12, 6), dpi=100)plt.plot(test, label=&#39;Real&#39;)plt.plot(predictions, color=&#39;red&#39;, label=&#39;Predicted&#39;)plt.xlabel(&#39;Days&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 5: ARIMA model on GS stock&#39;)plt.legend()plt.show &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.Stacked autoencoders （栈式自动编码器）：上面提到的一些特征是研究人员经过几十年的研究发现的，但是还是会忽视一些隐藏的关联特征，由此，Stacked autoencoders  就可以解决这个问题，通过学习每个隐藏层，发现更多新特征（可能有些是我们无法发现，理解的）。这次没有把 RELU 作为激活函数，而是使用了 GELU，也可以用于 BERT 模型中。至于为什么选择 GELU，大家可以在原文中看到作者给出的和 RELU 对比的实例。 g.深度无监督学习：用于期权定价中的异常检测，将再使用一个特征：每天都会增加高盛股票90天看涨期权的价格。期权定价本身结合了很多数据。期权合约的价格取决于股票的未来价值(分析师也试图预测价格，以便为看涨期权得出最准确的价格)。使用深度无监督学习(自组织映射)，尝试发现出现异常的每日价格。异常(如价格的剧烈变化)可能表明出现了一个事件，这有助于LSTM了解整体股票模式。 from utils import *import timeimport numpy as npfrom mxnet import nd, autograd, gluonfrom mxnet.gluon import nn, rnnimport mxnet as mximport datetimeimport&nbsp;seaborn&nbsp;as&nbsp;snsimport matplotlib.pyplot as plt%matplotlib inlinefrom sklearn.decomposition import PCAimport mathfrom sklearn.preprocessing import MinMaxScalerfrom sklearn.metrics import mean_squared_errorfrom sklearn.preprocessing import StandardScalerimport xgboost as xgbfrom sklearn.metrics import accuracy_scoreimport warningswarnings.filterwarnings(&quot;ignore&quot;)context = mx.cpu(); model_ctx=mx.cpu()mx.random.seed(1719)Note: The purpose of this section (3. The Data) is to show the data preprocessing and to give rationale for using different sources of data, hence I will only use a subset of the full data (that is used for training).def parser(x): return datetime.datetime.strptime(x,&#39;%Y-%m-%d&#39;)dataset_ex_df = pd.read_csv(&#39;data/panel_data_close.csv&#39;, header=0, parse_dates=[0], date_parser=parser)dataset_ex_df[[&#39;Date&#39;,&nbsp;&#39;GS&#39;]]. 接下来，有了这么多特征，还需要执行几个重要步骤： h.对数据的“质量”进行统计检查：确保数据质量对模型来说非常重要，因此要执行以下几个简单的检验，如异方差、多重共线性、Serial correlation 等。 i.确定特征重要性：采用 XGBoost 算法。这么多的特征，必须考虑是否所有这些都真正地指示了 GS 股票波动方向。例如，数据集中包括其变化可能意味着经济变化的 LIBOR，而这又可能暗示 GS 股票将会发生波动，因此需要对此预测进行测试，在众多的测试方法中，本教程中选择了 XGBoost，其在分类和回归问题上都提供了很好的结果。 def&nbsp;get_feature_importance_data(data_income): data = data_income.copy() y = data[&#39;price&#39;] X = data.iloc[:, 1:] train_samples = int(X.shape[0] * 0.65) X_train = X.iloc[:train_samples] X_test = X.iloc[train_samples:] y_train = y.iloc[:train_samples] y_test = y.iloc[train_samples:] return (X_train, y_train), (X_test, y_test)# Get training and test data(X_train_FI, y_train_FI), (X_test_FI, y_test_FI) = get_feature_importance_data(dataset_TI_df)regressor = xgb.XGBRegressor(gamma=0.0,n_estimators=150,base_score=0.7,colsample_bytree=1,learning_rate=0.05)xgbModel = regressor.fit(X_train_FI,y_train_FI, \ eval_set = [(X_train_FI, y_train_FI), (X_test_FI, y_test_FI)], \ verbose=False)eval_result = regressor.evals_result()training_rounds&nbsp;=&nbsp;range(len(eval_result[&#39;validation_0&#39;][&#39;rmse&#39;])) 最后一步，使用主成分分析（PCA）创建特征组合，以减少自动编码器生成特征的维数。在自动编码器中创建了 112 个特征，不过高维特征对我们的价值更大，所以在这 112 个特征的基础上通过 PCA 创建高维的特征组合，减少数据维度。不过，这也是我们提出的实验性方法。 plt.figure(figsize=(15, 5))plt.subplots_adjust(left=None, bottom=None, right=None, top=None, wspace=.5, hspace=None)ranges_ = (-10, 3, .25)plt.subplot(1, 2, 1)plt.plot([i for i in np.arange(*ranges_)], [relu(i) for i in np.arange(*ranges_)], label=&#39;ReLU&#39;, marker=&#39;.&#39;)plt.plot([i for i in np.arange(*ranges_)], [gelu(i) for i in np.arange(*ranges_)], label=&#39;GELU&#39;)plt.hlines(0, -10, 3, colors=&#39;gray&#39;, linestyles=&#39;--&#39;, label=&#39;0&#39;)plt.title(&#39;Figure 7: GELU as an activation function for autoencoders&#39;)plt.ylabel(&#39;f(x) for GELU and ReLU&#39;)plt.xlabel(&#39;x&#39;)plt.legend()plt.subplot(1, 2, 2)plt.plot([i for i in np.arange(*ranges_)], [lrelu(i) for i in np.arange(*ranges_)], label=&#39;Leaky ReLU&#39;)plt.hlines(0, -10, 3, colors=&#39;gray&#39;, linestyles=&#39;--&#39;, label=&#39;0&#39;)plt.ylabel(&#39;f(x) for Leaky ReLU&#39;)plt.xlabel(&#39;x&#39;)plt.title(&#39;Figure 8: LeakyReLU&#39;)plt.legend()plt.sho &nbsp; &nbsp; &nbsp; &nbsp; 让我们看一下过去 9 年的股价变化。虚线表示训练数据和测试数据之间的分割线。 plt.figure(figsize=(14, 5), dpi=100)plt.plot(dataset_ex_df[&#39;Date&#39;], dataset_ex_df[&#39;GS&#39;], label=&#39;Goldman Sachs stock&#39;)plt.vlines(datetime.date(2016,4, 20), 0, 270, linestyles=&#39;--&#39;, colors=&#39;gray&#39;, label=&#39;Train/Test data cut-off&#39;)plt.xlabel(&#39;Date&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 2: Goldman Sachs stock price&#39;)plt.legend()plt.show() &nbsp; &nbsp; &nbsp; &nbsp;图：过去9年高盛股价的波动 num_training_days = int(dataset_ex_df.shape[0]*.7)print(&#39;Number of training days: {}. Number of test days: {}.&#39;.format(num_training_days, \ dataset_ex_df.shape[0]-num_training_days))Number&nbsp;of&nbsp;training&nbsp;days:&nbsp;1585.&nbsp;Number&nbsp;of&nbsp;test&nbsp;days:&nbsp;680. 生成对抗性网络(GAN) &nbsp; &nbsp; &nbsp; &nbsp;图：GAN 架构 1、为什么采用GAN进行股市预测？ GAN 最多被应用在创作逼真的图像、画作和视频剪辑等。对预测时间序列数据的应用并不多。但这两者的思想都是类似的。我们希望预测未来的股票价格，GS 的股票波动和行为应该大致相同(除非开始以完全不同的方式运作，或者经济急剧变化)。因此，希望“生成”的数据与已经拥有的历史交易数据分布相似，当然不是完全相同。在这个例子中将使用 LSTM 作为时间序列生成模型，CNN 作为判别模型。 2、Metropolis-Hastings GAN 和 Wasserstein GAN （1）Metropolis-Hastings GAN：与传统的 GAN 相比，Uber 团队最近提出一种新改进的 GAN 模型——Metropolis-Hastings GAN （MHGAN），它有点类似于谷歌和加州大学伯克利分校提出的Discriminator Rejection Sampling。通常情况下，在训练完GAN之后就不再使用 D 了。然而，MHGAN 和 DRS 试图使用 D 来选择由 G 生成的接近真实的样本。 （2）Wasserstein GAN：训练 GAN 是相当困难的。模型可能永远不会收敛，模式崩溃也很容易发生。，通过 Wasserstein GAN 尝试解决这个问题。KL 距离和 JS 距离是两种常用的分布，而 WGAN 使用的是 Wasserstein distanc。 3、生成模型：单层RNN （1）LSTM 还是 GRU？ 关于 RNN、LSTM 等模型的基础介绍这里不多做赘述，主要聚焦在 RNN 在时间序列数据上的应用，因为它们可以跟踪所有以前的数据点，并且可以捕获经过时间发展的模式。可以通过裁剪解 RNN 梯度消失或梯度爆炸问题。 在精度方面，LSTM 和 GRU 的结果相差不多，但是 GRU 使用的训练参数要比 LSTM 少，计算强度也要小。 （2）LSTM 体系结构 LSTM架构非常简单：一个LSTM层，包含112个输入单元(数据集中有112个特征)和500个隐藏单元；一个以每日股价为输出的 Dense 层；采用 Xavier 初始化，使用 L1 损失函数 在下面的代码中，采用adam作为优化器，学习率为 0.01。 gan_num_features = dataset_total_df.shape[1]sequence_length = 17class RNNModel(gluon.Block): def __init__(self, num_embed, num_hidden, num_layers, bidirectional=False, \ sequence_length=sequence_length, **kwargs): super(RNNModel, self).__init__(**kwargs) self.num_hidden = num_hidden with self.name_scope(): self.rnn = rnn.LSTM(num_hidden, num_layers, input_size=num_embed, \ bidirectional=bidirectional, layout=&#39;TNC&#39;) self.decoder = nn.Dense(1, in_units=num_hidden) def forward(self, inputs, hidden): output, hidden = self.rnn(inputs, hidden) decoded = self.decoder(output.reshape((-1, self.num_hidden))) return decoded, hidden def begin_state(self, *args, **kwargs): return self.rnn.begin_state(*args, **kwargs) lstm_model = RNNModel(num_embed=gan_num_features, num_hidden=500, num_layers=1)lstm_model.collect_params().initialize(mx.init.Xavier(), ctx=mx.cpu())trainer = gluon.Trainer(lstm_model.collect_params(), &#39;adam&#39;, {&#39;learning_rate&#39;: .01})loss&nbsp;=&nbsp;glu （3）学习率调度器 学习率是非常重要的参数之一，每个优化器设置学习率，如 SGD、Adam 或 RMSProp 在训练神经网络时至关重要，因为它既控制着网络的收敛速度，又控制着网络的最终性能，接下来就要确定每个阶段的学习率。 class&nbsp;TriangularSchedule(): def __init__(self, min_lr, max_lr, cycle_length, inc_fraction=0.5): self.min_lr = min_lr self.max_lr = max_lr self.cycle_length = cycle_length self.inc_fraction = inc_fraction def __call__(self, iteration): if iteration &lt;= self.cycle_length*self.inc_fraction: unit_cycle = iteration * 1 / (self.cycle_length * self.inc_fraction) elif iteration &lt;= self.cycle_length: unit_cycle = (self.cycle_length - iteration) * 1 / (self.cycle_length * (1 - self.inc_fraction)) else: unit_cycle = 0 adjusted_cycle = (unit_cycle * (self.max_lr - self.min_lr)) + self.min_lr return adjusted_cycleclass CyclicalSchedule(): def __init__(self, schedule_class, cycle_length, cycle_length_decay=1, cycle_magnitude_decay=1, **kwargs): self.schedule_class = schedule_class self.length = cycle_length self.length_decay = cycle_length_decay self.magnitude_decay = cycle_magnitude_decay self.kwargs = kwargs def __call__(self, iteration): cycle_idx = 0 cycle_length = self.length idx = self.length while idx &lt;= iteration: cycle_length = math.ceil(cycle_length * self.length_decay) cycle_idx += 1 idx += cycle_length cycle_offset = iteration - idx + cycle_length schedule = self.schedule_class(cycle_length=cycle_length,**self.kwargs)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;schedule(cycle_offset)&nbsp;*self.magnitude_decay**cycle_idx （4）防止过拟合与偏差-方差权衡 防止过拟合，注意总损失也是要在训练模型中非常重要的一个问题。不仅在生成器中的 LSTM 模型，判别器中的 CNN 模型、自动编码器中都使用了几种防止过拟合的技术： a.确保数据质量 b.正则化，或权重惩罚：最常用的两种正则化技术是L1 和 L2 正则法。L1对离散值更有鲁棒性，当数据稀疏时使用，可得到特征重要性。因此，在股票价格预测这个应用案例中将使用 L1 正则法。 c.Dropout。Dropout层随机删除隐藏层中的节点。 d.Dense-sparse-dense training e.提前停止. （5）权衡偏差-方差 建立复杂神经网络时，另一个重要的考虑因素是偏差-方差权衡。训练网络的误差基本上是偏差、方差和不可约误差 σ(噪声和随机性引起的误差)的函数。 最简单的权衡公式是：误差=偏差^2+方差+σ. a.偏差（Bias）：偏差衡量一个经过训练的（训练数据集）算法对未见数据的概括能力。高偏差(欠拟合)意味着模型在隐藏数据上不能很好地工作。 b.方差（Variance）：方差衡量模型对数据集变化的敏感性。高方差意味着过拟合。 4、 一维 CNN 判别模型 （1）为何采用CNN作为判别模型？ CNN 网络在提取隐藏特征等工作上具有优势，那如何应用于这个任务中？大家不妨尝试一下，数据点行程小趋势，小趋势行程大趋势，趋势反之形成模式，而 CNN 在此用检测特征的能力来提取 GS 股价趋势中的模式信息。 &nbsp; &nbsp; &nbsp; &nbsp;图：本文提出的 CNN 模型的体系结构。 超参数优化 （1）跟踪和优化的超参数是： batch_size：LSTM 和 CNN 的 Batch 大小 cnn_lr：CNN 的学习率 strides：CNN 的跨步卷积数 lrelu_alpha：GAN 中 LeakyReLU 的 Alpha 值 batchnorm_momentum：CNN Batch 正则化的 momentum padding：CNN 中的 Padding kernel_size：1 CNN 的内核大小 dropout：LSTM 中的 Dropout 层 filters：过滤器的初始数目 epoch = 200 （2）超参数优化 经过 200 次 GAN 训练后，将记录 MAE（LSTM、GG 中的误差函数）并作为奖励值传递给强化学习（RL）模型，以决定是否用同一组超参数来改变保持训练的超参数，如果RL决定更新超参数，它将调用 Bayes 优化库。 （3）超参数优化中的强化学习 为什么在超参数优化中使用强化学习？股票市场一直在变化。即使能够训练 &nbsp;GAN 和 LSTM 来创造非常精确的结果，结果也只能在一定的时间内有效。也就是说，我们需要不断优化整个过程。为了优化这一过程，可以添加或删除特征，或改进深度学习模型。改进模型的最重要的方法之一就是通过超参数。一旦找到了一组特定的超参数，就需要决定何时修改它们，以及何时使用已经知道的集合(探索或利用)。此外，股票市场代表了一个依赖于数百万参数的连续空间。 （4）强化学习理论 使用无模型的 RL 算法，原因很明显，我们不知道整个环境，因此没有关于环境如何工作的定义模型（如果存在，就不需要预测股票价格的变化）。使用两个细分的无模型RL：策略优化（Policy Optimization）和 Q-Learning。构建 RL 算法的一个关键方面是精确设置奖励。它必须捕捉环境的所有方面以及代理与环境的交互。 a.Q-Learning：一种基于Q-Learning的非策略深度强化学习算法，它将7种算法结合在一起：DQN、Double Q Learning（双QL）、Prioritized replay、决斗网络(Dueling networks)、多步学习、分布式RL、噪声网络（Noisy Nets）。在Q-Learning中，学习价值从某一状态采取行动。Q 值采取行动后的预期回报。 b.策略优化：这里采用近端策略优化（Proximal Policy Optimization, PPO），在决策优化中，学习从某一状态采取的行动。(如果使用诸如Actor/Critic之类的方法，也会了解处于给定状态的价值。 （5）贝叶斯优化 使用贝叶斯优化，不采用网格搜索，因为可能需要很长时间才能找到超参数的最佳组合。 &nbsp; &nbsp; &nbsp; &nbsp;图：贝叶斯超参数优化的高斯过程 5、结果 最后，使用测试数据作为不同阶段的输入，LSTM 的输出与实际股价进行比较： （1）绘制第一次训练之后的结果 &nbsp; &nbsp; &nbsp; （2）绘制 50 次训练后的结果。 &nbsp; &nbsp; &nbsp; &nbsp; （3）绘制 200 次训练后的结果。 &nbsp; &nbsp; &nbsp; RL 运行了 10 eposide ，本文定义一个 eposide 是 GAN 完整训练 200 次后，下图是得到的最终的结果。 &nbsp; &nbsp; &nbsp; &nbsp; 总结 可见，作者在把各路强模型联合打造的结果还是非常优秀的。不过作者还尝试创建一个 RL 环境，用于测试决定何时以及如何进行交易的交易算法。GAN 的输出将是此环境中的一个参数，虽然这些都不能完全做到预测的作用，但是在实际任务中不断尝试新技术还是很有意义的，期待作者后续工作可以带来更好的结果。完整详细教程还可以访问 Github 项目： https://github.com/borisbanushev/stockpredictionai 作为码一代，想教码二代却无从下手： 听说少儿编程很火，可它有哪些好处呢？ 孩子多大开始学习比较好呢？又该如何学习呢？ 最新的编程教育政策又有哪些呢？ 下面给大家介绍CSDN新成员：极客宝宝（ID：geek_baby） 戳他了解更多↓↓↓ &nbsp;热 文&nbsp;推 荐&nbsp; ☞&nbsp;Erlang 之父去世，他留给程序员两点忠告 ☞&nbsp;中国程序员独闯硅谷，逆袭成美国最佳 CEO，公司市值 160 亿美元！ ☞&nbsp;我逛了下 JDK 一条街，发现了不少好东西！ ☞&nbsp;斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年 ☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码 ☞ 微服务落地，我们在考虑什么？| 技术头条 ☞ 爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪? ☞ 程序员被骗&quot;黑砖窑&quot;：监禁、恐吓、996无休编程！ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢" />
<link rel="canonical" href="https://mlh.app/2019/04/28/728502.html" />
<meta property="og:url" content="https://mlh.app/2019/04/28/728502.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-28T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"作者 | Boris B 译者 | Major 编辑 | Jane 出品 | AI科技大本营（id：rgznai100） 【导语】用深度学习预测股票价格不是一个新话题，随着技术的不断发展，大家一直在不断尝试新技术。这次教程中，作者设计了一个强强联合型模型来预测股票价格，为什么这么形容？作者设计了一个 GAN 模型，其生成网络为 LSTM 模型用来预测时间序列数据、CNN 模型作判别网络，用 BERT 模型作为情绪分析模型。带有高斯过程的贝叶斯优化和深度强化学习方法来获得 GAN 的超参数。为什么创建这样的组合？都将在下面的内容中为大家进行一一解答。 这篇教程的篇幅很长，为了让大家能对重要技术内容一目了然，作者在开始加入了层级清晰的目录，主要从【背景】、【数据特征】、【GAN 模型架构】、【超参数优化】等几大方面进行全面讲解。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 下面营长对其中涉及的技术细节进行了编译： 背景 在今天的任务中，预测的是高盛公司（本文中会简称为 GS）的股票变化趋势，使用 2010 年 1 月 1 日至 2018 年 12 月 31 日的日收盘价作为训练（七年）和测试（两年）数据。 成功训练一个 GAN 最棘手的部分是获得正确的超参数。为此，作者使用 Bayesian optimisation（带有高斯过程的贝叶斯优化）和用于决定何时以及如何改变 GAN 的超参数的深层强化学习（DRL），在创建强化学习过程中，将使用一些最新技术，如 RAINBOW 和 PPO。 此外，在模型中还使用许多不同类型的输入数据。随着股票的历史交易数据和技术指标，设计了一些技术方法，如使用 NLP 中的 BERT 来创建情绪分析模型（作为基本面分析的来源），以及用傅立叶变换（Fourier transforms）提取总体趋势方向、识别其他高级特征的栈式自动编码器（ Stacked autoencoder）；采用特征投资组合寻找相关资产；采用 ARIMA 方法进行股票函数近似。实际上，这些技术都是为了尽可能多的获取关于股票的信息、模式、依赖关系等等。 开发环境和框架选择 MXNet 和其高级 API（Gluon）创建所有的神经网络，并在多个 GPU 上进行训练。 &nbsp; &nbsp; &nbsp; &nbsp;图：完整体系结构概览 通过上面的技术背景介绍，相信大家已经感觉到想准确预测股市是一项非常复杂的任务，影响股票变化的事件、条件或因素等实在是太多了。所以，想更好的了解这些先决条件，还需要先做几个重要的假设：（1）市场不是 100% 的随机；（2）历史重复；（3）市场遵循人们的理性行为；（4）市场是“完美的”。 数据 首先，要了解什么因素会影响 GS 的股票价格波动，需要包含尽可能多的信息（从不同的方面和角度）。将使用 1585 天的日数据来训练各种算法（70% 的数据），并预测另外 680 天的结果（测试数据）。然后，将预测结果与测试数据进行比较。每种类型的数据（亦称为特征）将在后面的部分中详细解释。 简而言之，将使用的特征有： a.相关资产：涉及商品、外汇、指数、固定收益证券等各类资产数据；影响高盛公司股票价格趋势的外部因素又有很多，并且很复杂，包括竞争对手、客户、全球经济、地缘政治形势、财政和货币政策等等，这些因素还会相互产生影响。选择合适的相关资产是非常重要的： （1）首先是和 GS 相似的公司，如将摩根大通（JPMorgan Chase）和摩根士丹利（Morgan Stanley）等加入数据集。 （2）作为一家投资银行，高盛依赖于全球经济，需要关注全球经济指数和 libor 利率。 （3）每日波动指数(VIX)。 （4）综合指数，如 NASDAQ 和 NYSE（美国）、FTSE 100（英国）、日经指数 225（日本）、恒生指数和 BSE Sensex（APAC）指数。 （5）货币，全球贸易多次反映在货币流动中，使用一篮子货币（如美元-日元、英镑-美元等）作为特征。 总的来说，在数据集中还有 72 个其他资产（每个资产的每日价格）。 b.技术指标：许多投资人都会关注技术指标，在这里，把最受欢迎的指标作为独立特征，包括 7 天和 21 天波动平均值、指数波动平均、Momentum、MACD 等 12项技术指标。 def get_technical_indicators(dataset): # Create 7 and 21 days Moving Average dataset[&#39;ma7&#39;] = dataset[&#39;price&#39;].rolling(window=7).mean() dataset[&#39;ma21&#39;] = dataset[&#39;price&#39;].rolling(window=21).mean() # Create MACD dataset[&#39;26ema&#39;] = pd.ewma(dataset[&#39;price&#39;], span=26) dataset[&#39;12ema&#39;] = pd.ewma(dataset[&#39;price&#39;], span=12) dataset[&#39;MACD&#39;] = (dataset[&#39;12ema&#39;]-dataset[&#39;26ema&#39;]) # Create Bollinger Bands dataset[&#39;20sd&#39;] = pd.stats.moments.rolling_std(dataset[&#39;price&#39;],20) dataset[&#39;upper_band&#39;] = dataset[&#39;ma21&#39;] + (dataset[&#39;20sd&#39;]*2) dataset[&#39;lower_band&#39;] = dataset[&#39;ma21&#39;] - (dataset[&#39;20sd&#39;]*2) # Create Exponential moving average dataset[&#39;ema&#39;] = dataset[&#39;price&#39;].ewm(com=0.5).mean() # Create Momentum dataset[&#39;momentum&#39;] = dataset[&#39;price&#39;]-1 return datasetdataset_TI_df = get_technical_indicators(dataset_ex_df[[&#39;GS&#39;]])dataset_TI_df.head() &nbsp; &nbsp; &nbsp; &nbsp; c.基本面分析：无论股票涨跌，这都是一个非常重要的数据。分析时会用到两个特征：公司业绩报告和新闻将引导的一些趋势，因此通过分析新闻来准确预测市场的情绪也是一项非常重要的工作，所以这次的方法中，将使用 BERT 来构建情绪分析模型，提取股票新闻中的情绪倾向。最后采用 sigmoid 归一化，结果介于 0 到 1 之间，（0 表示负面情绪，1 表示正面情绪），每一天都会创建一个平均每日分数作为一个特征添加。 使用的是 MXNet 中 Gluon NLP 库中所提供的经过预训练的 BERT 模型，大家可以尝试一下。此前我们也为大家介绍过简单易上手的 Gluon，详情可参考营长亲自上手的教程。 d.傅里叶变换：利用每日收盘价，创建傅立叶变换，以获得几个长期和短期趋势。使用这些变换消除大量的噪声，获得真实股票波动的近似值。有了趋势近似，可以帮助 LSTM 网络更准确地选择其预测趋势。 data_FT = dataset_ex_df[[&#39;Date&#39;, &#39;GS&#39;]]close_fft = np.fft.fft(np.asarray(data_FT[&#39;GS&#39;].tolist()))fft_df = pd.DataFrame({&#39;fft&#39;:close_fft})fft_df[&#39;absolute&#39;] = fft_df[&#39;fft&#39;].apply(lambda x: np.abs(x))fft_df[&#39;angle&#39;] = fft_df[&#39;fft&#39;].apply(lambda x: np.angle(x))plt.figure(figsize=(14, 7), dpi=100)fft_list = np.asarray(fft_df[&#39;fft&#39;].tolist())for num_ in [3, 6, 9, 100]: fft_list_m10= np.copy(fft_list); fft_list_m10[num_:-num_]=0 plt.plot(np.fft.ifft(fft_list_m10), label=&#39;Fourier transform with {} components&#39;.format(num_))plt.plot(data_FT[&#39;GS&#39;], label=&#39;Real&#39;)plt.xlabel(&#39;Days&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 3: Goldman Sachs (close) stock prices &amp; Fourier transforms&#39;)plt.legend()plt.show() &nbsp; &nbsp; &nbsp;&nbsp;图：高盛股票的傅里叶变换 e.ARIMA：这是预测时间序列数据未来值的最流行技术之一。 from&nbsp;pandas&nbsp;import&nbsp;read_csvfrom pandas import datetimefrom statsmodels.tsa.arima_model import ARIMAfrom sklearn.metrics import mean_squared_errorX = series.valuessize = int(len(X) * 0.66)train, test = X[0:size], X[size:len(X)]history = [x for x in train]predictions = list()for t in range(len(test)): model = ARIMA(history, order=(5,1,0)) model_fit = model.fit(disp=0) output = model_fit.forecast() yhat = output[0] predictions.append(yhat) obs = test[t] history.append(obs)error = mean_squared_error(test, predictions)print(&#39;Test MSE: %.3f&#39; % error)Test MSE: 10.151# Plot the predicted (from ARIMA) and real pricesplt.figure(figsize=(12, 6), dpi=100)plt.plot(test, label=&#39;Real&#39;)plt.plot(predictions, color=&#39;red&#39;, label=&#39;Predicted&#39;)plt.xlabel(&#39;Days&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 5: ARIMA model on GS stock&#39;)plt.legend()plt.show &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.Stacked autoencoders （栈式自动编码器）：上面提到的一些特征是研究人员经过几十年的研究发现的，但是还是会忽视一些隐藏的关联特征，由此，Stacked autoencoders  就可以解决这个问题，通过学习每个隐藏层，发现更多新特征（可能有些是我们无法发现，理解的）。这次没有把 RELU 作为激活函数，而是使用了 GELU，也可以用于 BERT 模型中。至于为什么选择 GELU，大家可以在原文中看到作者给出的和 RELU 对比的实例。 g.深度无监督学习：用于期权定价中的异常检测，将再使用一个特征：每天都会增加高盛股票90天看涨期权的价格。期权定价本身结合了很多数据。期权合约的价格取决于股票的未来价值(分析师也试图预测价格，以便为看涨期权得出最准确的价格)。使用深度无监督学习(自组织映射)，尝试发现出现异常的每日价格。异常(如价格的剧烈变化)可能表明出现了一个事件，这有助于LSTM了解整体股票模式。 from utils import *import timeimport numpy as npfrom mxnet import nd, autograd, gluonfrom mxnet.gluon import nn, rnnimport mxnet as mximport datetimeimport&nbsp;seaborn&nbsp;as&nbsp;snsimport matplotlib.pyplot as plt%matplotlib inlinefrom sklearn.decomposition import PCAimport mathfrom sklearn.preprocessing import MinMaxScalerfrom sklearn.metrics import mean_squared_errorfrom sklearn.preprocessing import StandardScalerimport xgboost as xgbfrom sklearn.metrics import accuracy_scoreimport warningswarnings.filterwarnings(&quot;ignore&quot;)context = mx.cpu(); model_ctx=mx.cpu()mx.random.seed(1719)Note: The purpose of this section (3. The Data) is to show the data preprocessing and to give rationale for using different sources of data, hence I will only use a subset of the full data (that is used for training).def parser(x): return datetime.datetime.strptime(x,&#39;%Y-%m-%d&#39;)dataset_ex_df = pd.read_csv(&#39;data/panel_data_close.csv&#39;, header=0, parse_dates=[0], date_parser=parser)dataset_ex_df[[&#39;Date&#39;,&nbsp;&#39;GS&#39;]]. 接下来，有了这么多特征，还需要执行几个重要步骤： h.对数据的“质量”进行统计检查：确保数据质量对模型来说非常重要，因此要执行以下几个简单的检验，如异方差、多重共线性、Serial correlation 等。 i.确定特征重要性：采用 XGBoost 算法。这么多的特征，必须考虑是否所有这些都真正地指示了 GS 股票波动方向。例如，数据集中包括其变化可能意味着经济变化的 LIBOR，而这又可能暗示 GS 股票将会发生波动，因此需要对此预测进行测试，在众多的测试方法中，本教程中选择了 XGBoost，其在分类和回归问题上都提供了很好的结果。 def&nbsp;get_feature_importance_data(data_income): data = data_income.copy() y = data[&#39;price&#39;] X = data.iloc[:, 1:] train_samples = int(X.shape[0] * 0.65) X_train = X.iloc[:train_samples] X_test = X.iloc[train_samples:] y_train = y.iloc[:train_samples] y_test = y.iloc[train_samples:] return (X_train, y_train), (X_test, y_test)# Get training and test data(X_train_FI, y_train_FI), (X_test_FI, y_test_FI) = get_feature_importance_data(dataset_TI_df)regressor = xgb.XGBRegressor(gamma=0.0,n_estimators=150,base_score=0.7,colsample_bytree=1,learning_rate=0.05)xgbModel = regressor.fit(X_train_FI,y_train_FI, \\ eval_set = [(X_train_FI, y_train_FI), (X_test_FI, y_test_FI)], \\ verbose=False)eval_result = regressor.evals_result()training_rounds&nbsp;=&nbsp;range(len(eval_result[&#39;validation_0&#39;][&#39;rmse&#39;])) 最后一步，使用主成分分析（PCA）创建特征组合，以减少自动编码器生成特征的维数。在自动编码器中创建了 112 个特征，不过高维特征对我们的价值更大，所以在这 112 个特征的基础上通过 PCA 创建高维的特征组合，减少数据维度。不过，这也是我们提出的实验性方法。 plt.figure(figsize=(15, 5))plt.subplots_adjust(left=None, bottom=None, right=None, top=None, wspace=.5, hspace=None)ranges_ = (-10, 3, .25)plt.subplot(1, 2, 1)plt.plot([i for i in np.arange(*ranges_)], [relu(i) for i in np.arange(*ranges_)], label=&#39;ReLU&#39;, marker=&#39;.&#39;)plt.plot([i for i in np.arange(*ranges_)], [gelu(i) for i in np.arange(*ranges_)], label=&#39;GELU&#39;)plt.hlines(0, -10, 3, colors=&#39;gray&#39;, linestyles=&#39;--&#39;, label=&#39;0&#39;)plt.title(&#39;Figure 7: GELU as an activation function for autoencoders&#39;)plt.ylabel(&#39;f(x) for GELU and ReLU&#39;)plt.xlabel(&#39;x&#39;)plt.legend()plt.subplot(1, 2, 2)plt.plot([i for i in np.arange(*ranges_)], [lrelu(i) for i in np.arange(*ranges_)], label=&#39;Leaky ReLU&#39;)plt.hlines(0, -10, 3, colors=&#39;gray&#39;, linestyles=&#39;--&#39;, label=&#39;0&#39;)plt.ylabel(&#39;f(x) for Leaky ReLU&#39;)plt.xlabel(&#39;x&#39;)plt.title(&#39;Figure 8: LeakyReLU&#39;)plt.legend()plt.sho &nbsp; &nbsp; &nbsp; &nbsp; 让我们看一下过去 9 年的股价变化。虚线表示训练数据和测试数据之间的分割线。 plt.figure(figsize=(14, 5), dpi=100)plt.plot(dataset_ex_df[&#39;Date&#39;], dataset_ex_df[&#39;GS&#39;], label=&#39;Goldman Sachs stock&#39;)plt.vlines(datetime.date(2016,4, 20), 0, 270, linestyles=&#39;--&#39;, colors=&#39;gray&#39;, label=&#39;Train/Test data cut-off&#39;)plt.xlabel(&#39;Date&#39;)plt.ylabel(&#39;USD&#39;)plt.title(&#39;Figure 2: Goldman Sachs stock price&#39;)plt.legend()plt.show() &nbsp; &nbsp; &nbsp; &nbsp;图：过去9年高盛股价的波动 num_training_days = int(dataset_ex_df.shape[0]*.7)print(&#39;Number of training days: {}. Number of test days: {}.&#39;.format(num_training_days, \\ dataset_ex_df.shape[0]-num_training_days))Number&nbsp;of&nbsp;training&nbsp;days:&nbsp;1585.&nbsp;Number&nbsp;of&nbsp;test&nbsp;days:&nbsp;680. 生成对抗性网络(GAN) &nbsp; &nbsp; &nbsp; &nbsp;图：GAN 架构 1、为什么采用GAN进行股市预测？ GAN 最多被应用在创作逼真的图像、画作和视频剪辑等。对预测时间序列数据的应用并不多。但这两者的思想都是类似的。我们希望预测未来的股票价格，GS 的股票波动和行为应该大致相同(除非开始以完全不同的方式运作，或者经济急剧变化)。因此，希望“生成”的数据与已经拥有的历史交易数据分布相似，当然不是完全相同。在这个例子中将使用 LSTM 作为时间序列生成模型，CNN 作为判别模型。 2、Metropolis-Hastings GAN 和 Wasserstein GAN （1）Metropolis-Hastings GAN：与传统的 GAN 相比，Uber 团队最近提出一种新改进的 GAN 模型——Metropolis-Hastings GAN （MHGAN），它有点类似于谷歌和加州大学伯克利分校提出的Discriminator Rejection Sampling。通常情况下，在训练完GAN之后就不再使用 D 了。然而，MHGAN 和 DRS 试图使用 D 来选择由 G 生成的接近真实的样本。 （2）Wasserstein GAN：训练 GAN 是相当困难的。模型可能永远不会收敛，模式崩溃也很容易发生。，通过 Wasserstein GAN 尝试解决这个问题。KL 距离和 JS 距离是两种常用的分布，而 WGAN 使用的是 Wasserstein distanc。 3、生成模型：单层RNN （1）LSTM 还是 GRU？ 关于 RNN、LSTM 等模型的基础介绍这里不多做赘述，主要聚焦在 RNN 在时间序列数据上的应用，因为它们可以跟踪所有以前的数据点，并且可以捕获经过时间发展的模式。可以通过裁剪解 RNN 梯度消失或梯度爆炸问题。 在精度方面，LSTM 和 GRU 的结果相差不多，但是 GRU 使用的训练参数要比 LSTM 少，计算强度也要小。 （2）LSTM 体系结构 LSTM架构非常简单：一个LSTM层，包含112个输入单元(数据集中有112个特征)和500个隐藏单元；一个以每日股价为输出的 Dense 层；采用 Xavier 初始化，使用 L1 损失函数 在下面的代码中，采用adam作为优化器，学习率为 0.01。 gan_num_features = dataset_total_df.shape[1]sequence_length = 17class RNNModel(gluon.Block): def __init__(self, num_embed, num_hidden, num_layers, bidirectional=False, \\ sequence_length=sequence_length, **kwargs): super(RNNModel, self).__init__(**kwargs) self.num_hidden = num_hidden with self.name_scope(): self.rnn = rnn.LSTM(num_hidden, num_layers, input_size=num_embed, \\ bidirectional=bidirectional, layout=&#39;TNC&#39;) self.decoder = nn.Dense(1, in_units=num_hidden) def forward(self, inputs, hidden): output, hidden = self.rnn(inputs, hidden) decoded = self.decoder(output.reshape((-1, self.num_hidden))) return decoded, hidden def begin_state(self, *args, **kwargs): return self.rnn.begin_state(*args, **kwargs) lstm_model = RNNModel(num_embed=gan_num_features, num_hidden=500, num_layers=1)lstm_model.collect_params().initialize(mx.init.Xavier(), ctx=mx.cpu())trainer = gluon.Trainer(lstm_model.collect_params(), &#39;adam&#39;, {&#39;learning_rate&#39;: .01})loss&nbsp;=&nbsp;glu （3）学习率调度器 学习率是非常重要的参数之一，每个优化器设置学习率，如 SGD、Adam 或 RMSProp 在训练神经网络时至关重要，因为它既控制着网络的收敛速度，又控制着网络的最终性能，接下来就要确定每个阶段的学习率。 class&nbsp;TriangularSchedule(): def __init__(self, min_lr, max_lr, cycle_length, inc_fraction=0.5): self.min_lr = min_lr self.max_lr = max_lr self.cycle_length = cycle_length self.inc_fraction = inc_fraction def __call__(self, iteration): if iteration &lt;= self.cycle_length*self.inc_fraction: unit_cycle = iteration * 1 / (self.cycle_length * self.inc_fraction) elif iteration &lt;= self.cycle_length: unit_cycle = (self.cycle_length - iteration) * 1 / (self.cycle_length * (1 - self.inc_fraction)) else: unit_cycle = 0 adjusted_cycle = (unit_cycle * (self.max_lr - self.min_lr)) + self.min_lr return adjusted_cycleclass CyclicalSchedule(): def __init__(self, schedule_class, cycle_length, cycle_length_decay=1, cycle_magnitude_decay=1, **kwargs): self.schedule_class = schedule_class self.length = cycle_length self.length_decay = cycle_length_decay self.magnitude_decay = cycle_magnitude_decay self.kwargs = kwargs def __call__(self, iteration): cycle_idx = 0 cycle_length = self.length idx = self.length while idx &lt;= iteration: cycle_length = math.ceil(cycle_length * self.length_decay) cycle_idx += 1 idx += cycle_length cycle_offset = iteration - idx + cycle_length schedule = self.schedule_class(cycle_length=cycle_length,**self.kwargs)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;schedule(cycle_offset)&nbsp;*self.magnitude_decay**cycle_idx （4）防止过拟合与偏差-方差权衡 防止过拟合，注意总损失也是要在训练模型中非常重要的一个问题。不仅在生成器中的 LSTM 模型，判别器中的 CNN 模型、自动编码器中都使用了几种防止过拟合的技术： a.确保数据质量 b.正则化，或权重惩罚：最常用的两种正则化技术是L1 和 L2 正则法。L1对离散值更有鲁棒性，当数据稀疏时使用，可得到特征重要性。因此，在股票价格预测这个应用案例中将使用 L1 正则法。 c.Dropout。Dropout层随机删除隐藏层中的节点。 d.Dense-sparse-dense training e.提前停止. （5）权衡偏差-方差 建立复杂神经网络时，另一个重要的考虑因素是偏差-方差权衡。训练网络的误差基本上是偏差、方差和不可约误差 σ(噪声和随机性引起的误差)的函数。 最简单的权衡公式是：误差=偏差^2+方差+σ. a.偏差（Bias）：偏差衡量一个经过训练的（训练数据集）算法对未见数据的概括能力。高偏差(欠拟合)意味着模型在隐藏数据上不能很好地工作。 b.方差（Variance）：方差衡量模型对数据集变化的敏感性。高方差意味着过拟合。 4、 一维 CNN 判别模型 （1）为何采用CNN作为判别模型？ CNN 网络在提取隐藏特征等工作上具有优势，那如何应用于这个任务中？大家不妨尝试一下，数据点行程小趋势，小趋势行程大趋势，趋势反之形成模式，而 CNN 在此用检测特征的能力来提取 GS 股价趋势中的模式信息。 &nbsp; &nbsp; &nbsp; &nbsp;图：本文提出的 CNN 模型的体系结构。 超参数优化 （1）跟踪和优化的超参数是： batch_size：LSTM 和 CNN 的 Batch 大小 cnn_lr：CNN 的学习率 strides：CNN 的跨步卷积数 lrelu_alpha：GAN 中 LeakyReLU 的 Alpha 值 batchnorm_momentum：CNN Batch 正则化的 momentum padding：CNN 中的 Padding kernel_size：1 CNN 的内核大小 dropout：LSTM 中的 Dropout 层 filters：过滤器的初始数目 epoch = 200 （2）超参数优化 经过 200 次 GAN 训练后，将记录 MAE（LSTM、GG 中的误差函数）并作为奖励值传递给强化学习（RL）模型，以决定是否用同一组超参数来改变保持训练的超参数，如果RL决定更新超参数，它将调用 Bayes 优化库。 （3）超参数优化中的强化学习 为什么在超参数优化中使用强化学习？股票市场一直在变化。即使能够训练 &nbsp;GAN 和 LSTM 来创造非常精确的结果，结果也只能在一定的时间内有效。也就是说，我们需要不断优化整个过程。为了优化这一过程，可以添加或删除特征，或改进深度学习模型。改进模型的最重要的方法之一就是通过超参数。一旦找到了一组特定的超参数，就需要决定何时修改它们，以及何时使用已经知道的集合(探索或利用)。此外，股票市场代表了一个依赖于数百万参数的连续空间。 （4）强化学习理论 使用无模型的 RL 算法，原因很明显，我们不知道整个环境，因此没有关于环境如何工作的定义模型（如果存在，就不需要预测股票价格的变化）。使用两个细分的无模型RL：策略优化（Policy Optimization）和 Q-Learning。构建 RL 算法的一个关键方面是精确设置奖励。它必须捕捉环境的所有方面以及代理与环境的交互。 a.Q-Learning：一种基于Q-Learning的非策略深度强化学习算法，它将7种算法结合在一起：DQN、Double Q Learning（双QL）、Prioritized replay、决斗网络(Dueling networks)、多步学习、分布式RL、噪声网络（Noisy Nets）。在Q-Learning中，学习价值从某一状态采取行动。Q 值采取行动后的预期回报。 b.策略优化：这里采用近端策略优化（Proximal Policy Optimization, PPO），在决策优化中，学习从某一状态采取的行动。(如果使用诸如Actor/Critic之类的方法，也会了解处于给定状态的价值。 （5）贝叶斯优化 使用贝叶斯优化，不采用网格搜索，因为可能需要很长时间才能找到超参数的最佳组合。 &nbsp; &nbsp; &nbsp; &nbsp;图：贝叶斯超参数优化的高斯过程 5、结果 最后，使用测试数据作为不同阶段的输入，LSTM 的输出与实际股价进行比较： （1）绘制第一次训练之后的结果 &nbsp; &nbsp; &nbsp; （2）绘制 50 次训练后的结果。 &nbsp; &nbsp; &nbsp; &nbsp; （3）绘制 200 次训练后的结果。 &nbsp; &nbsp; &nbsp; RL 运行了 10 eposide ，本文定义一个 eposide 是 GAN 完整训练 200 次后，下图是得到的最终的结果。 &nbsp; &nbsp; &nbsp; &nbsp; 总结 可见，作者在把各路强模型联合打造的结果还是非常优秀的。不过作者还尝试创建一个 RL 环境，用于测试决定何时以及如何进行交易的交易算法。GAN 的输出将是此环境中的一个参数，虽然这些都不能完全做到预测的作用，但是在实际任务中不断尝试新技术还是很有意义的，期待作者后续工作可以带来更好的结果。完整详细教程还可以访问 Github 项目： https://github.com/borisbanushev/stockpredictionai 作为码一代，想教码二代却无从下手： 听说少儿编程很火，可它有哪些好处呢？ 孩子多大开始学习比较好呢？又该如何学习呢？ 最新的编程教育政策又有哪些呢？ 下面给大家介绍CSDN新成员：极客宝宝（ID：geek_baby） 戳他了解更多↓↓↓ &nbsp;热 文&nbsp;推 荐&nbsp; ☞&nbsp;Erlang 之父去世，他留给程序员两点忠告 ☞&nbsp;中国程序员独闯硅谷，逆袭成美国最佳 CEO，公司市值 160 亿美元！ ☞&nbsp;我逛了下 JDK 一条街，发现了不少好东西！ ☞&nbsp;斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年 ☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码 ☞ 微服务落地，我们在考虑什么？| 技术头条 ☞ 爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪? ☞ 程序员被骗&quot;黑砖窑&quot;：监禁、恐吓、996无休编程！ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢","@type":"BlogPosting","url":"https://mlh.app/2019/04/28/728502.html","headline":"程序员如何借助 AI 开挂股票神预测？ 技术头条","dateModified":"2019-04-28T00:00:00+08:00","datePublished":"2019-04-28T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/28/728502.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>程序员如何借助 AI 开挂股票神预测？| 技术头条</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><img class=" __bg_gif" data-copyright="0" data-ratio="0.15644171779141106" data-type="gif" data-w="652" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Pn4Sm0RsAug5zOzy32A3RIVhRwowK5ogg1hJ631uGyu9zOMKfTddDnSrsxicbCQNm59Qeo3lDYCvF70I9ibGvA9g/640?wx_fmt=gif" style="text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;width: 652px !important;visibility: visible !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_gif/Pn4Sm0RsAug5zOzy32A3RIVhRwowK5ogg1hJ631uGyu9zOMKfTddDnSrsxicbCQNm59Qeo3lDYCvF70I9ibGvA9g/640?wx_fmt=gif"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="rich_pages" data-copyright="0" data-ratio="0.63984375" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuhfQpjmjhwiaicFQ5sCQeLxSoz21SO4sYnKHGJWX5dFkXR1lGcQnhHD1siaxiak0Eb2uyQalAzNGibrvOA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuhfQpjmjhwiaicFQ5sCQeLxSoz21SO4sYnKHGJWX5dFkXR1lGcQnhHD1siaxiak0Eb2uyQalAzNGibrvOA/640?wx_fmt=jpeg"></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.5em;"><span style="font-size: 15px;color: rgb(136, 136, 136);letter-spacing: 0.5px;"></span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.5em;"><span style="font-size: 15px;color: rgb(136, 136, 136);letter-spacing: 0.5px;">作者 | Boris B</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.5em;"><span style="font-size: 15px;color: rgb(136, 136, 136);letter-spacing: 0.5px;">译者 | Major</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.5em;"><span style="font-size: 15px;color: rgb(136, 136, 136);letter-spacing: 0.5px;">编辑 | Jane</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.5em;"><span style="font-size: 15px;color: rgb(136, 136, 136);letter-spacing: 0.5px;">出品 | AI科技大本营（id：rgznai100）</span></p> 
<p line="140b"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(136, 136, 136);">【导语】用深度学习预测股票价格不是一个新话题，随着技术的不断发展，大家一直在不断尝试新技术。这次教程中，作者设计了一个强强联合型模型来预测股票价格，为什么这么形容？作者设计了一个 GAN 模型，其生成网络为 LSTM 模型用来预测时间序列数据、CNN 模型作判别网络，用 BERT 模型作为情绪分析模型。带有高斯过程的贝叶斯优化和深度强化学习方法来获得 GAN 的超参数。为什么创建这样的组合？都将在下面的内容中为大家进行一一解答。</span></p> 
<p line="YqWD"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">这篇教程的篇幅很长，为了让大家能对重要技术内容一目了然，作者在开始加入了层级清晰的目录，主要从【背景】、【数据特征】、【GAN 模型架构】、【超参数优化】等几大方面进行全面讲解。</span></p> 
<p line="DW6Z"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img class="" data-ratio="0.13677811550151975" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakQQ6zuarcSzp0aiavDY3fIW6raxY7ica1yyPFcfZzHb4W5a54UMLT9WpA/640?wx_fmt=png" data-type="png" data-w="1316" height="auto" width="1316" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakQQ6zuarcSzp0aiavDY3fIW6raxY7ica1yyPFcfZzHb4W5a54UMLT9WpA/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><img class="" data-ratio="0.4552352048558422" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakJibMzIICGrx7Rk3Qu6bprvsZ0uC7alUcjHhLz1lb89icExbbnZ1m3gIg/640?wx_fmt=png" data-type="png" data-w="1318" height="auto" width="1318" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakJibMzIICGrx7Rk3Qu6bprvsZ0uC7alUcjHhLz1lb89icExbbnZ1m3gIg/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><img class="" data-ratio="0.3981762917933131" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakbKPrEWLWITd341qo7cibia3UwTXGpBlyhbLoiaO4BJd7YZJrxx5xFhyJg/640?wx_fmt=png" data-type="png" data-w="1316" height="auto" width="1316" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakbKPrEWLWITd341qo7cibia3UwTXGpBlyhbLoiaO4BJd7YZJrxx5xFhyJg/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><img class="" data-ratio="0.2420091324200913" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakavR44QQlndvZsbib8VDNKPQnxITfVjVX83faicWCxibUnRh4j2V2Ta9rA/640?wx_fmt=png" data-type="png" data-w="1314" height="auto" width="1314" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakavR44QQlndvZsbib8VDNKPQnxITfVjVX83faicWCxibUnRh4j2V2Ta9rA/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><img class="" data-ratio="0.11246200607902736" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakmBicuclXRM7fW01xo16QLEvicledKrvCWIExxckT5VrNcR84gPnzaiccQ/640?wx_fmt=png" data-type="png" data-w="1316" height="auto" width="1316" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakmBicuclXRM7fW01xo16QLEvicledKrvCWIExxckT5VrNcR84gPnzaiccQ/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">下面营长对其中涉及的技术细节进行了编译：</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"><br></span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"><br></span></p> 
<h1 class="ql-long-11990707"><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LXSAriayI15u06ibNNlXzIcor2tTtgJBKFxkIicJ8tiaRKRaictbrQEssdSg/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LXSAriayI15u06ibNNlXzIcor2tTtgJBKFxkIicJ8tiaRKRaictbrQEssdSg/640?wx_fmt=png"></p><p style="text-align: center;"><strong style="color: rgb(0, 0, 0);font-size: 18px;"><span style="letter-spacing: 1px;">背景</span></strong></p></h1> 
<p line="MrIN"><br></p> 
<p line="MrIN"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">在今天的任务中，预测的是高盛公司（本文中会简称为 GS）的股票变化趋势，使用 2010 年 1 月 1 日至 2018 年 12 月 31 日的日收盘价作为训练（七年）和测试（两年）数据。</span></p> 
<p line="U7vf"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">成功训练一个 GAN 最棘手的部分是获得正确的超参数。为此，作者使用 Bayesian optimisation（带有高斯过程的贝叶斯优化）和用于决定何时以及如何改变 GAN 的超参数的<span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 1px;">深层强化学习（DRL），</span>在创建强化学习过程中，将使用一些最新技术，如 RAINBOW 和 PPO。</span></p> 
<p line="G0UC"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">此外，在模型中还使用许多不同类型的输入数据。随着股票的历史交易数据和技术指标，设计了一些技术方法，如使用 NLP 中的 BERT 来创建情绪分析模型（作为基本面分析的来源），以及用傅立叶变换（Fourier transforms）提取总体趋势方向、识别其他高级特征的栈式自动编码器（ Stacked autoencoder）；采用特征投资组合寻找相关资产；采用 ARIMA 方法进行股票函数近似。实际上，这些技术都是为了尽可能多的获取关于股票的信息、模式、依赖关系等等。</span></p> 
<p><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">开发环境和框架选择 MXNet 和其高级 API（Gluon）创建所有的神经网络，并在多个 GPU 上进行训练。</span></p> 
<p line="8Gjq"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: center;"><img class="" data-backh="314" data-backw="540" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakSibDaUUjWrwgUSUtxib9pOYs9OaKmQvTJICWt4vUKKYT79Ac5YOibpbNQ/0?wx_fmt=png" data-ratio="0.5837004405286343" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakSibDaUUjWrwgUSUtxib9pOYs9OaKmQvTJICWt4vUKKYT79Ac5YOibpbNQ/640?wx_fmt=png" data-type="png" data-w="908" height="auto" style="width: 100%;height: auto;" width="auto" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakSibDaUUjWrwgUSUtxib9pOYs9OaKmQvTJICWt4vUKKYT79Ac5YOibpbNQ/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp;</span><span style="color: rgb(136, 136, 136);font-size: 12px;"><span style="color: rgb(136, 136, 136);letter-spacing: 1px;"> &nbsp; &nbsp;</span><span style="color: rgb(136, 136, 136);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;letter-spacing: 1px;">图：</span></span><span style="font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;letter-spacing: 1px;color: rgb(136, 136, 136);font-size: 12px;">完整体系结构概览</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">通过上面的技术背景介绍，相信大家已经感觉到想准确预测股市是一项非常复杂的任务，影响股票变化的事件、条件或因素等实在是太多了。所以，想更好的了解这些先决条件，还需要先做几个重要的假设：（1）市场不是 100% 的随机；（2）历史重复；（3）市场遵循人们的理性行为；（4）市场是“完美的”。</span></p> 
<p line="E2i5"><br></p> 
<p line="E2i5"><br></p> 
<h1 class="ql-long-11990707"><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LwYnW1VvkaHWiaL6W1Mr1yiaNLQpxwhyqice9F1yJzMHticssPX515qyvog/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LwYnW1VvkaHWiaL6W1Mr1yiaNLQpxwhyqice9F1yJzMHticssPX515qyvog/640?wx_fmt=png"></p><p style="text-align: center;"><span style="color: rgb(0, 0, 0);"><strong style="color: rgb(70, 118, 217);font-size: 18px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;">数据</span></strong></span></p></h1> 
<p line="86DF"><br></p> 
<p line="86DF"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">首先，要了解什么因素会影响 GS 的股票价格波动，需要包含尽可能多的信息（从不同的方面和角度）。将使用 1585 天的日数据来训练各种算法（70% 的数据），并预测另外 680 天的结果（测试数据）。然后，将预测结果与测试数据进行比较。每种类型的数据（亦称为特征）将在后面的部分中详细解释。</span></p> 
<p line="S08T"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">简而言之，将使用的特征有：</span></strong></p> 
<p line="FLWP"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">a.相关资产：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">涉及商品、外汇、指数、固定收益证券等各类资产数据；影响高盛公司股票价格趋势的外部因素又有很多，并且很复杂，包括竞争对手、客户、全球经济、地缘政治形势、财政和货币政策等等，这些因素还会相互产生影响。选择合适的相关资产是非常重要的：</span></p> 
<p line="caqf"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（1）首先是和 GS 相似的公司，如将摩根大通（JPMorgan Chase）和摩根士丹利（Morgan Stanley）等加入数据集。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（2）作为一家投资银行，高盛依赖于全球经济，需要关注全球经济指数和 libor 利率。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（3）每日波动指数(VIX)。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（4）综合指数，如 NASDAQ 和 NYSE（美国）、FTSE 100（英国）、日经指数 225（日本）、恒生指数和 BSE Sensex（APAC）指数。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（5）货币，全球贸易多次反映在货币流动中，使用一篮子货币（如美元-日元、英镑-美元等）作为特征。</span></p> 
<p line="xHo6"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">总的来说，在数据集中还有 72 个其他资产（每个资产的每日价格）。</span></p> 
<p line="hkRT"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">b.技术指标：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">许多投资人都会关注技术指标，在这里，把最受欢迎的指标作为独立特征，包括 7 天和 21 天波动平均值、指数波动平均、Momentum、MACD 等 12项技术指标。</span></p> 
<p line="iCqK"><br></p> 
<pre>
         
 <section class="code-snippet__fix code-snippet__js">
          
  <ul class="code-snippet__line-index code-snippet__js"> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
  </ul>
          
  <pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer" style=""><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">get_technical_indicators(dataset)</span>:</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__comment"># Create 7 and 21 days Moving Average</span></span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'ma7'</span>] = dataset[<span class="code-snippet__string">'price'</span>].rolling(window=<span class="code-snippet__number">7</span>).mean()</span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'ma21'</span>] = dataset[<span class="code-snippet__string">'price'</span>].rolling(window=<span class="code-snippet__number">21</span>).mean()</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__comment"># Create MACD</span></span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'26ema'</span>] = pd.ewma(dataset[<span class="code-snippet__string">'price'</span>], span=<span class="code-snippet__number">26</span>)</span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'12ema'</span>] = pd.ewma(dataset[<span class="code-snippet__string">'price'</span>], span=<span class="code-snippet__number">12</span>)</span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'MACD'</span>] = (dataset[<span class="code-snippet__string">'12ema'</span>]-dataset[<span class="code-snippet__string">'26ema'</span>])</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__comment"># Create Bollinger Bands</span></span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'20sd'</span>] = pd.stats.moments.rolling_std(dataset[<span class="code-snippet__string">'price'</span>],<span class="code-snippet__number">20</span>)</span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'upper_band'</span>] = dataset[<span class="code-snippet__string">'ma21'</span>] + (dataset[<span class="code-snippet__string">'20sd'</span>]*<span class="code-snippet__number">2</span>)</span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'lower_band'</span>] = dataset[<span class="code-snippet__string">'ma21'</span>] - (dataset[<span class="code-snippet__string">'20sd'</span>]*<span class="code-snippet__number">2</span>)</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__comment"># Create Exponential moving average</span></span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'ema'</span>] = dataset[<span class="code-snippet__string">'price'</span>].ewm(com=<span class="code-snippet__number">0.5</span>).mean()</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__comment"># Create Momentum</span></span></code><code><span class="code-snippet_outer"> dataset[<span class="code-snippet__string">'momentum'</span>] = dataset[<span class="code-snippet__string">'price'</span>]<span class="code-snippet__number">-1</span></span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">return</span> dataset</span></code><code><span class="code-snippet_outer">dataset_TI_df = get_technical_indicators(dataset_ex_df[[<span class="code-snippet__string">'GS'</span>]])</span></code><code><span class="code-snippet_outer">dataset_TI_df.head()</span></code></pre>
         
 </section><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"></span></p></pre> 
<p style="line-height: 1.75em;margin-left: 8px;margin-right: 8px;"><img class="" data-backh="333" data-backw="540" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakTibrNRFogbmYkchLTCOKx5o2iaLiaicnTLibROjOJnZ98YHjxJcPicfS388Q/0?wx_fmt=png" data-ratio="0.6181556195965417" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakTibrNRFogbmYkchLTCOKx5o2iaLiaicnTLibROjOJnZ98YHjxJcPicfS388Q/640?wx_fmt=png" data-type="png" data-w="1388" height="auto" style="width: 100%;height: auto;" width="1388" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakTibrNRFogbmYkchLTCOKx5o2iaLiaicnTLibROjOJnZ98YHjxJcPicfS388Q/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">c.基本面分析：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">无论股票涨跌，这都是一个非常重要的数据。分析时会用到两个特征：公司业绩报告和新闻将引导的一些趋势，因此通过分析新闻来准确预测市场的情绪也是一项非常重要的工作，所以这次的方法中，将使用 BERT 来构建情绪分析模型，提取股票新闻中的情绪倾向。最后采用 sigmoid 归一化，结果介于 0 到 1 之间，（0 表示负面情绪，1 表示正面情绪），每一天都会创建一个平均每日分数作为一个特征添加。</span></p> 
<p line="AKFN"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">使用的是 MXNet 中 Gluon NLP 库中所提供的<span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 1px;">经过预训练的 BERT 模型</span>，大家可以尝试一下。<a href="https://mp.weixin.qq.com/s?__biz=MzI0ODcxODk5OA==&amp;mid=2247503762&amp;idx=1&amp;sn=6574646dd3a937f0d3dc447a91174d84&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2">此前我们也为大家介绍过简单易上手的 Gluon，详情可参考营长亲自上手的教程。</a></span></p> 
<p line="e868"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">d.傅里叶变换：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">利用每日收盘价，创建傅立叶变换，以获得几个长期和短期趋势。使用这些变换消除大量的噪声，获得真实股票波动的近似值。有了趋势近似，可以帮助 LSTM 网络更准确地选择其预测趋势。</span></p> 
<p line="1axX"><br></p> 
<pre>
         
 <section class="code-snippet__fix code-snippet__js">
          
  <ul class="code-snippet__line-index code-snippet__js"> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
  </ul>
          
  <pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer">data_FT = dataset_ex_df[[<span class="code-snippet__string">'Date'</span>, <span class="code-snippet__string">'GS'</span>]]</span></code><code><span class="code-snippet_outer">close_fft = np.fft.fft(np.asarray(data_FT[<span class="code-snippet__string">'GS'</span>].tolist()))</span></code><code><span class="code-snippet_outer">fft_df = pd.DataFrame({<span class="code-snippet__string">'fft'</span>:close_fft})</span></code><code><span class="code-snippet_outer">fft_df[<span class="code-snippet__string">'absolute'</span>] = fft_df[<span class="code-snippet__string">'fft'</span>].apply(<span class="code-snippet__keyword">lambda</span> x: np.abs(x))</span></code><code><span class="code-snippet_outer">fft_df[<span class="code-snippet__string">'angle'</span>] = fft_df[<span class="code-snippet__string">'fft'</span>].apply(<span class="code-snippet__keyword">lambda</span> x: np.angle(x))</span></code><code><span class="code-snippet_outer">plt.figure(figsize=(<span class="code-snippet__number">14</span>, <span class="code-snippet__number">7</span>), dpi=<span class="code-snippet__number">100</span>)</span></code><code><span class="code-snippet_outer">fft_list = np.asarray(fft_df[<span class="code-snippet__string">'fft'</span>].tolist())</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">for</span> num_ <span class="code-snippet__keyword">in</span> [<span class="code-snippet__number">3</span>, <span class="code-snippet__number">6</span>, <span class="code-snippet__number">9</span>, <span class="code-snippet__number">100</span>]:</span></code><code><span class="code-snippet_outer"> fft_list_m10= np.copy(fft_list); fft_list_m10[num_:-num_]=<span class="code-snippet__number">0</span></span></code><code><span class="code-snippet_outer"> plt.plot(np.fft.ifft(fft_list_m10), label=<span class="code-snippet__string">'Fourier transform with {} components'</span>.format(num_))</span></code><code><span class="code-snippet_outer">plt.plot(data_FT[<span class="code-snippet__string">'GS'</span>], label=<span class="code-snippet__string">'Real'</span>)</span></code><code><span class="code-snippet_outer">plt.xlabel(<span class="code-snippet__string">'Days'</span>)</span></code><code><span class="code-snippet_outer">plt.ylabel(<span class="code-snippet__string">'USD'</span>)</span></code><code><span class="code-snippet_outer">plt.title(<span class="code-snippet__string">'Figure 3: Goldman Sachs (close) stock prices &amp; Fourier transforms'</span>)</span></code><code><span class="code-snippet_outer">plt.legend()</span></code><code><span class="code-snippet_outer">plt.show()</span></code></pre>
         
 </section><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></p></pre> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: center;"><img class="" data-ratio="0.5395927601809954" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakjPmRrMyuIPv8NQEiaMoDlWicyYb0PgJY9oslTtWJ7icElmQOSiaMbxqQRA/640?wx_fmt=png" data-type="png" data-w="884" height="auto" width="884" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakjPmRrMyuIPv8NQEiaMoDlWicyYb0PgJY9oslTtWJ7icElmQOSiaMbxqQRA/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp;</span><span style="color: rgb(136, 136, 136);font-size: 12px;"><span style="color: rgb(136, 136, 136);letter-spacing: 1px;">&nbsp;</span><span style="color: rgb(136, 136, 136);letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;">图：</span></span><span style="letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;color: rgb(136, 136, 136);font-size: 12px;">高盛股票的傅里叶变换</span><span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;"></span></p> 
<p line="QeGb"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">e.ARIMA：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">这是预测时间序列数据未来值的最流行技术之一。</span></p> 
<section class="code-snippet__fix code-snippet__js"> 
 <ul class="code-snippet__line-index code-snippet__js"> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
 </ul> 
 <pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span>&nbsp;pandas&nbsp;<span class="code-snippet__keyword">import</span>&nbsp;read_csv</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> pandas <span class="code-snippet__keyword">import</span> datetime</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> statsmodels.tsa.arima_model <span class="code-snippet__keyword">import</span> ARIMA</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> sklearn.metrics <span class="code-snippet__keyword">import</span> mean_squared_error</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">X = series.values</span></code><code><span class="code-snippet_outer">size = int(len(X) * <span class="code-snippet__number">0.66</span>)</span></code><code><span class="code-snippet_outer">train, test = X[<span class="code-snippet__number">0</span>:size], X[size:len(X)]</span></code><code><span class="code-snippet_outer">history = [x <span class="code-snippet__keyword">for</span> x <span class="code-snippet__keyword">in</span> train]</span></code><code><span class="code-snippet_outer">predictions = list()</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">for</span> t <span class="code-snippet__keyword">in</span> range(len(test)):</span></code><code><span class="code-snippet_outer"> model = ARIMA(history, order=(<span class="code-snippet__number">5</span>,<span class="code-snippet__number">1</span>,<span class="code-snippet__number">0</span>))</span></code><code><span class="code-snippet_outer"> model_fit = model.fit(disp=<span class="code-snippet__number">0</span>)</span></code><code><span class="code-snippet_outer"> output = model_fit.forecast()</span></code><code><span class="code-snippet_outer"> yhat = output[<span class="code-snippet__number">0</span>]</span></code><code><span class="code-snippet_outer"> predictions.append(yhat)</span></code><code><span class="code-snippet_outer"> obs = test[t]</span></code><code><span class="code-snippet_outer"> history.append(obs)</span></code><code><span class="code-snippet_outer">error = mean_squared_error(test, predictions)</span></code><code><span class="code-snippet_outer">print(<span class="code-snippet__string">'Test MSE: %.3f'</span> % error)</span></code><code><span class="code-snippet_outer">Test MSE: <span class="code-snippet__number">10.151</span></span></code><code><span class="code-snippet_outer" style=""># Plot the predicted (from ARIMA) and real prices</span></code><code><span class="code-snippet_outer">plt.figure(figsize=(<span class="code-snippet__number">12</span>, <span class="code-snippet__number">6</span>), dpi=<span class="code-snippet__number">100</span>)</span></code><code><span class="code-snippet_outer">plt.plot(test, label=<span class="code-snippet__string">'Real'</span>)</span></code><code><span class="code-snippet_outer">plt.plot(predictions, color=<span class="code-snippet__string">'red'</span>, label=<span class="code-snippet__string">'Predicted'</span>)</span></code><code><span class="code-snippet_outer">plt.xlabel(<span class="code-snippet__string">'Days'</span>)</span></code><code><span class="code-snippet_outer">plt.ylabel(<span class="code-snippet__string">'USD'</span>)</span></code><code><span class="code-snippet_outer">plt.title(<span class="code-snippet__string">'Figure 5: ARIMA model on GS stock'</span>)</span></code><code><span class="code-snippet_outer">plt.legend()</span></code><code><span class="code-snippet_outer">plt.show</span></code></pre> 
</section> 
<pre><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"></span></p></pre> 
<p line="9pOB"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: center;"><img class="" data-ratio="0.5312190287413281" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakz30XplIlXualebr1KBZLOyv7N9RNBLaTeDqVXsibve31AftDLFXojew/640?wx_fmt=png" data-type="png" data-w="1009" height="auto" width="1009" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakz30XplIlXualebr1KBZLOyv7N9RNBLaTeDqVXsibve31AftDLFXojew/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: center;"><img class="" data-ratio="0.8257956448911222" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakUMn8hokXcmud43awqib7WgjMXz9CibnGPORkaqaiccc9aMVezgFPvhk9w/640?wx_fmt=png" data-type="png" data-w="1194" height="auto" width="1194" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakUMn8hokXcmud43awqib7WgjMXz9CibnGPORkaqaiccc9aMVezgFPvhk9w/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">f.Stacked autoencoders （栈式自动编码器）：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">上面提到的一些特征是研究人员经过几十年的研究发现的，但是还是会忽视一些隐藏的关联特征，由此，Stacked autoencoders  就可以解决这个问题，通过学习每个隐藏层，发现更多新特征（可能有些是我们无法发现，理解的）。这次没有把 RELU 作为激活函数，而是使用了 GELU，也可以用于 BERT 模型中。至于为什么选择 GELU，大家可以在原文中看到作者给出的和 RELU 对比的实例。</span></p> 
<p line="cKMO"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">g.深度无监督学习：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">用于期权定价中的异常检测，将再使用一个特征：每天都会增加高盛股票90天看涨期权的价格。期权定价本身结合了很多数据。期权合约的价格取决于股票的未来价值(分析师也试图预测价格，以便为看涨期权得出最准确的价格)。使用深度无监督学习(自组织映射)，尝试发现出现异常的每日价格。异常(如价格的剧烈变化)可能表明出现了一个事件，这有助于LSTM了解整体股票模式。</span></p> 
<p line="8465"><br></p> 
<section class="code-snippet__fix code-snippet__js"> 
 <ul class="code-snippet__line-index code-snippet__js"> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
 </ul> 
 <pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> utils <span class="code-snippet__keyword">import</span> *</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> time</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> numpy <span class="code-snippet__keyword">as</span> np</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> mxnet <span class="code-snippet__keyword">import</span> nd, autograd, gluon</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> mxnet.gluon <span class="code-snippet__keyword">import</span> nn, rnn</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> mxnet <span class="code-snippet__keyword">as</span> mx</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> datetime</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span>&nbsp;seaborn&nbsp;<span class="code-snippet__keyword">as</span>&nbsp;sns</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> matplotlib.pyplot <span class="code-snippet__keyword">as</span> plt</span></code><code><span class="code-snippet_outer">%matplotlib inline</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> sklearn.decomposition <span class="code-snippet__keyword">import</span> PCA</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> math</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> sklearn.preprocessing <span class="code-snippet__keyword">import</span> MinMaxScaler</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> sklearn.metrics <span class="code-snippet__keyword">import</span> mean_squared_error</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> sklearn.preprocessing <span class="code-snippet__keyword">import</span> StandardScaler</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> xgboost <span class="code-snippet__keyword">as</span> xgb</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">from</span> sklearn.metrics <span class="code-snippet__keyword">import</span> accuracy_score</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> warnings</span></code><code><span class="code-snippet_outer">warnings.filterwarnings(<span class="code-snippet__string">"ignore"</span>)</span></code><code><span class="code-snippet_outer">context = mx.cpu(); model_ctx=mx.cpu()</span></code><code><span class="code-snippet_outer">mx.random.seed(<span class="code-snippet__number">1719</span>)</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">Note: The purpose of this section (<span class="code-snippet__number">3.</span> The Data) <span class="code-snippet__keyword">is</span> to show the data preprocessing <span class="code-snippet__keyword">and</span> to give rationale <span class="code-snippet__keyword">for</span> using different sources of data, hence I will only use a subset of the full data (that <span class="code-snippet__keyword">is</span> used <span class="code-snippet__keyword">for</span> training).</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer" style=""><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">parser(x)</span>:</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">return</span> datetime.datetime.strptime(x,<span class="code-snippet__string">'%Y-%m-%d'</span>)</span></code><code><span class="code-snippet_outer">dataset_ex_df = pd.read_csv(<span class="code-snippet__string">'data/panel_data_close.csv'</span>, header=<span class="code-snippet__number">0</span>, parse_dates=[<span class="code-snippet__number">0</span>], date_parser=parser)</span></code><code><span class="code-snippet_outer">dataset_ex_df[[<span class="code-snippet__string">'Date'</span>,&nbsp;<span class="code-snippet__string">'GS'</span>]].</span></code></pre> 
</section> 
<pre><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></p><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">接下来，有了这么多特征，还需要执行几个重要步骤：</span><br></p></pre> 
<p line="BwMU"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">h.对数据的“质量”进行统计检查：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">确保数据质量对模型来说非常重要，因此要执行以下几个简单的检验，如异方差、多重共线性、Serial correlation 等。</span></p> 
<p line="bff7"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">i.确定特征重要性：</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">采用 XGBoost 算法。这么多的特征，必须考虑是否所有这些都真正地指示了 GS 股票波动方向。例如，数据集中包括其变化可能意味着经济变化的 LIBOR，而这又可能暗示 GS 股票将会发生波动，因此需要对此预测进行测试，在众多的测试方法中，本教程中选择了 XGBoost，其在分类和回归问题上都提供了很好的结果。</span></p> 
<p line="i246"><br></p> 
<section class="code-snippet__fix code-snippet__js"> 
 <ul class="code-snippet__line-index code-snippet__js"> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
 </ul> 
 <pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__meta">def&nbsp;get_feature_importance_data(data_income)</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">data</span> = <span class="code-snippet__string">data_income.copy()</span></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">y</span> = <span class="code-snippet__string">data['price']</span></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">X</span> = <span class="code-snippet__string">data.iloc[:, 1:]</span></span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">train_samples</span> = <span class="code-snippet__string">int(X.shape[0] * 0.65)</span></span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">X_train</span> = <span class="code-snippet__string">X.iloc[:train_samples]</span></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">X_test</span> = <span class="code-snippet__string">X.iloc[train_samples:]</span></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">y_train</span> = <span class="code-snippet__string">y.iloc[:train_samples]</span></span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">y_test</span> = <span class="code-snippet__string">y.iloc[train_samples:]</span></span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__attr">return</span> <span class="code-snippet__string">(X_train, y_train), (X_test, y_test)</span></span></code><code><span class="code-snippet_outer" style=""># Get training and test data</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">(X_train_FI,</span> <span class="code-snippet__string">y_train_FI), (X_test_FI, y_test_FI) = get_feature_importance_data(dataset_TI_df)</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">regressor</span> = <span class="code-snippet__string">xgb.XGBRegressor(gamma=0.0,n_estimators=150,base_score=0.7,colsample_bytree=1,learning_rate=0.05)</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">xgbModel</span> = <span class="code-snippet__string">regressor.fit(X_train_FI,y_train_FI, \</span></span></code><code><span class="code-snippet_outer"> eval_set = [(X_train_FI, y_train_FI), (X_test_FI, y_test_FI)], \</span></code><code><span class="code-snippet_outer"> verbose=False)</span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">eval_result</span> = <span class="code-snippet__string">regressor.evals_result()</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">training_rounds&nbsp;</span>=<span class="code-snippet__string">&nbsp;range(len(eval_result['validation_0']['rmse']))</span></span></code></pre> 
</section> 
<p line="i246"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">最后一步，使用主成分分析（PCA）创建特征组合，以减少自动编码器生成特征的维数。在自动编码器中创建了 112 个特征，不过高维特征对我们的价值更大，所以在这 112 个特征的基础上通过 PCA 创建高维的特征组合，减少数据维度。不过，这也是我们提出的实验性方法。</span></p> 
<p line="6Lgd"><br></p> 
<pre>
         
 <section class="code-snippet__fix code-snippet__js">
          
  <ul class="code-snippet__line-index code-snippet__js"> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
  </ul>
          
  <pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer">plt.figure(figsize=(<span class="code-snippet__number">15</span>, <span class="code-snippet__number">5</span>))</span></code><code><span class="code-snippet_outer">plt.subplots_adjust(left=<span class="code-snippet__keyword">None</span>, bottom=<span class="code-snippet__keyword">None</span>, right=<span class="code-snippet__keyword">None</span>, top=<span class="code-snippet__keyword">None</span>, wspace=<span class="code-snippet__number">.5</span>, hspace=<span class="code-snippet__keyword">None</span>)</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">ranges_ = (<span class="code-snippet__number">-10</span>, <span class="code-snippet__number">3</span>, <span class="code-snippet__number">.25</span>)</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">plt.subplot(<span class="code-snippet__number">1</span>, <span class="code-snippet__number">2</span>, <span class="code-snippet__number">1</span>)</span></code><code><span class="code-snippet_outer">plt.plot([i <span class="code-snippet__keyword">for</span> i <span class="code-snippet__keyword">in</span> np.arange(*ranges_)], [relu(i) <span class="code-snippet__keyword">for</span> i <span class="code-snippet__keyword">in</span> np.arange(*ranges_)], label=<span class="code-snippet__string">'ReLU'</span>, marker=<span class="code-snippet__string">'.'</span>)</span></code><code><span class="code-snippet_outer">plt.plot([i <span class="code-snippet__keyword">for</span> i <span class="code-snippet__keyword">in</span> np.arange(*ranges_)], [gelu(i) <span class="code-snippet__keyword">for</span> i <span class="code-snippet__keyword">in</span> np.arange(*ranges_)], label=<span class="code-snippet__string">'GELU'</span>)</span></code><code><span class="code-snippet_outer">plt.hlines(<span class="code-snippet__number">0</span>, <span class="code-snippet__number">-10</span>, <span class="code-snippet__number">3</span>, colors=<span class="code-snippet__string">'gray'</span>, linestyles=<span class="code-snippet__string">'--'</span>, label=<span class="code-snippet__string">'0'</span>)</span></code><code><span class="code-snippet_outer">plt.title(<span class="code-snippet__string">'Figure 7: GELU as an activation function for autoencoders'</span>)</span></code><code><span class="code-snippet_outer">plt.ylabel(<span class="code-snippet__string">'f(x) for GELU and ReLU'</span>)</span></code><code><span class="code-snippet_outer">plt.xlabel(<span class="code-snippet__string">'x'</span>)</span></code><code><span class="code-snippet_outer">plt.legend()</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">plt.subplot(<span class="code-snippet__number">1</span>, <span class="code-snippet__number">2</span>, <span class="code-snippet__number">2</span>)</span></code><code><span class="code-snippet_outer">plt.plot([i <span class="code-snippet__keyword">for</span> i <span class="code-snippet__keyword">in</span> np.arange(*ranges_)], [lrelu(i) <span class="code-snippet__keyword">for</span> i <span class="code-snippet__keyword">in</span> np.arange(*ranges_)], label=<span class="code-snippet__string">'Leaky ReLU'</span>)</span></code><code><span class="code-snippet_outer">plt.hlines(<span class="code-snippet__number">0</span>, <span class="code-snippet__number">-10</span>, <span class="code-snippet__number">3</span>, colors=<span class="code-snippet__string">'gray'</span>, linestyles=<span class="code-snippet__string">'--'</span>, label=<span class="code-snippet__string">'0'</span>)</span></code><code><span class="code-snippet_outer">plt.ylabel(<span class="code-snippet__string">'f(x) for Leaky ReLU'</span>)</span></code><code><span class="code-snippet_outer">plt.xlabel(<span class="code-snippet__string">'x'</span>)</span></code><code><span class="code-snippet_outer">plt.title(<span class="code-snippet__string">'Figure 8: LeakyReLU'</span>)</span></code><code><span class="code-snippet_outer">plt.legend()</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">plt.sho</span></code></pre>
         
 </section></pre> 
<p line="7e15"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: center;"><img class="" data-backh="203" data-backw="540" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakDz9nGSNMY1F2kpsgoCVNkp5Ha80RCzLgtuHgjrkq3M4nic0vWicnZ7LQ/0?wx_fmt=png" data-ratio="0.3774145616641902" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakDz9nGSNMY1F2kpsgoCVNkp5Ha80RCzLgtuHgjrkq3M4nic0vWicnZ7LQ/640?wx_fmt=png" data-type="png" data-w="1346" height="auto" style="width: 100%;height: auto;" width="1346" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakDz9nGSNMY1F2kpsgoCVNkp5Ha80RCzLgtuHgjrkq3M4nic0vWicnZ7LQ/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">让我们看一下过去 9 年的股价变化。虚线表示训练数据和测试数据之间的分割线。</span></p> 
<p line="xxwp"><br></p> 
<pre>
         
 <section class="code-snippet__fix code-snippet__js">
          
  <ul class="code-snippet__line-index code-snippet__js"> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
  </ul>
          
  <pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">plt.figure(figsize=(<span class="code-snippet__number">14</span>, <span class="code-snippet__number">5</span>), dpi=<span class="code-snippet__number">100</span>)</span></code><code><span class="code-snippet_outer">plt.plot(dataset_ex_df[<span class="code-snippet__string">'Date'</span>], dataset_ex_df[<span class="code-snippet__string">'GS'</span>], label=<span class="code-snippet__string">'Goldman Sachs stock'</span>)</span></code><code><span class="code-snippet_outer">plt.vlines(datetime.date(<span class="code-snippet__number">2016</span>,<span class="code-snippet__number">4</span>, <span class="code-snippet__number">20</span>), <span class="code-snippet__number">0</span>, <span class="code-snippet__number">270</span>, linestyles=<span class="code-snippet__string">'--'</span>, colors=<span class="code-snippet__string">'gray'</span>, label=<span class="code-snippet__string">'Train/Test data cut-off'</span>)</span></code><code><span class="code-snippet_outer">plt.xlabel(<span class="code-snippet__string">'Date'</span>)</span></code><code><span class="code-snippet_outer">plt.ylabel(<span class="code-snippet__string">'USD'</span>)</span></code><code><span class="code-snippet_outer">plt.title(<span class="code-snippet__string">'Figure 2: Goldman Sachs stock price'</span>)</span></code><code><span class="code-snippet_outer">plt.legend()</span></code><code><span class="code-snippet_outer">plt.show()</span></code></pre>
         
 </section><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"></span><br></p></pre> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-backh="167" data-backw="416" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakmaIicf7gRaSkWiaMSxNsatHkSWpEVXSd8wAFv2zBWsGHIPQT0MM441cg/0?wx_fmt=png" data-ratio="0.4004400440044004" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakmaIicf7gRaSkWiaMSxNsatHkSWpEVXSd8wAFv2zBWsGHIPQT0MM441cg/640?wx_fmt=png" data-type="png" data-w="909" height="166px" style="width: 100%;height: auto;" width="415px" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakmaIicf7gRaSkWiaMSxNsatHkSWpEVXSd8wAFv2zBWsGHIPQT0MM441cg/640?wx_fmt=png"><span style="color: rgb(136, 136, 136);font-size: 12px;"><span style="color: rgb(136, 136, 136);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: rgb(136, 136, 136);letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;">图：过去9年高盛股价的波动</span></span></p> 
<section class="code-snippet__fix code-snippet__js"> 
 <ul class="code-snippet__line-index code-snippet__js"> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
 </ul> 
 <pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">num_training_days = int(dataset_ex_df.shape[<span class="code-snippet__number">0</span>]*<span class="code-snippet__number">.7</span>)</span></code><code><span class="code-snippet_outer">print(<span class="code-snippet__string">'Number of training days: {}. Number of test days: {}.'</span>.format(num_training_days, \</span></code><code><span class="code-snippet_outer"> dataset_ex_df.shape[<span class="code-snippet__number">0</span>]-num_training_days))</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">Number</span>&nbsp;<span class="code-snippet__keyword">of</span>&nbsp;training&nbsp;days:&nbsp;<span class="code-snippet__number">1585.</span>&nbsp;<span class="code-snippet__built_in">Number</span>&nbsp;<span class="code-snippet__keyword">of</span>&nbsp;test&nbsp;days:&nbsp;<span class="code-snippet__number">680.</span></span></code></pre> 
</section> 
<pre><p style="text-align: center;"><br></p></pre> 
<p line="e36b"><br></p> 
<p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4Lb4ybNEVGnaAvEDwENKzW27LUKFDGZPKcBneWwTaTpaJyG2C3em7libQ/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4Lb4ybNEVGnaAvEDwENKzW27LUKFDGZPKcBneWwTaTpaJyG2C3em7libQ/640?wx_fmt=png"></p> 
<p line="e36b" style="text-align: center;"><strong><span style="font-size: 18px;">生成对抗性网络(GAN)</span></strong></p> 
<p line="e36b" style="text-align: center;"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: center;"><img class="" data-backh="161" data-backw="416" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakUOy7rzNic2Cdt4wBmRCsSibzVduiatmo3hzLzFnRzZFAxHgw5etQvYv9g/0?wx_fmt=png" data-ratio="0.3875545851528384" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakUOy7rzNic2Cdt4wBmRCsSibzVduiatmo3hzLzFnRzZFAxHgw5etQvYv9g/640?wx_fmt=png" data-type="png" data-w="916" height="160px" style="width: 100%;height: auto;" width="415px" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakUOy7rzNic2Cdt4wBmRCsSibzVduiatmo3hzLzFnRzZFAxHgw5etQvYv9g/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: rgb(136, 136, 136);letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;font-size: 12px;">图：GAN 架构</span></p> 
<p line="2145"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">1、为什么采用GAN进行股市预测？</span></strong></p> 
<p line="3uR6"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">GAN 最多被应用在创作逼真的图像、画作和视频剪辑等。对预测时间序列数据的应用并不多。但这两者的思想都是类似的。我们希望预测未来的股票价格，GS 的股票波动和行为应该大致相同(除非开始以完全不同的方式运作，或者经济急剧变化)。因此，希望“生成”的数据与已经拥有的历史交易数据分布相似，当然不是完全相同。在这个例子中将使用 LSTM 作为时间序列生成模型，CNN 作为判别模型。</span></p> 
<p line="RrIt"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">2、Metropolis-Hastings GAN 和 Wasserstein GAN</span></strong></p> 
<p line="569d"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（1）Metropolis-Hastings GAN：与传统的 GAN 相比，Uber 团队最近提出一种新改进的 GAN 模型——Metropolis-Hastings GAN （MHGAN），它有点类似于谷歌和加州大学伯克利分校提出的Discriminator Rejection Sampling。通常情况下，在训练完GAN之后就不再使用 D 了。然而，MHGAN 和 DRS 试图使用 D 来选择由 G 生成的接近真实的样本。</span></p> 
<p line="ZxRr"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（2）Wasserstein GAN：训练 GAN 是相当困难的。模型可能永远不会收敛，模式崩溃也很容易发生。，通过 Wasserstein GAN 尝试解决这个问题。KL 距离和 JS 距离是两种常用的分布，而 WGAN 使用的是 Wasserstein distanc。</span></p> 
<p line="d6b9"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">3、生成模型：单层RNN</span></strong></p> 
<p><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（1）LSTM 还是 GRU？</span></p> 
<p line="29CG"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">关于 RNN、LSTM 等模型的基础介绍这里不多做赘述，主要聚焦在 RNN 在时间序列数据上的应用，因为它们可以跟踪所有以前的数据点，并且可以捕获经过时间发展的模式。可以通过裁剪解 RNN 梯度消失或梯度爆炸问题。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">在精度方面，LSTM 和 GRU 的结果相差不多，但是 GRU 使用的训练参数要比 LSTM 少，计算强度也要小。</span></p> 
<p line="jsSw"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（2）LSTM 体系结构</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">LSTM架构非常简单：一个LSTM层，包含112个输入单元(数据集中有112个特征)和500个隐藏单元；一个以每日股价为输出的 Dense 层；采用 Xavier 初始化，使用 L1 损失函数</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">在下面的代码中，采用adam作为优化器，学习率为 0.01。</span></p> 
<p line="PDhF"><br></p> 
<pre>
         
 <section class="code-snippet__fix code-snippet__js">
          
  <ul class="code-snippet__line-index code-snippet__js"> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
   <li></li> 
  </ul>
          
  <pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer">gan_num_features = dataset_total_df.shape[<span class="code-snippet__number">1</span>]</span></code><code><span class="code-snippet_outer">sequence_length = <span class="code-snippet__number">17</span></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer" style=""><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">RNNModel</span>(<span class="code-snippet__title">gluon</span>.<span class="code-snippet__title">Block</span>):</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">__init__(<span class="code-snippet__keyword">self</span>, num_embed, num_hidden, num_layers, bidirectional=False, \</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer"> sequence_length=sequence_length, **kwargs)</span>:</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">super</span>(RNNModel, <span class="code-snippet__keyword">self</span>).__init_<span class="code-snippet__number">_</span>(**kwargs)</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.num_hidden = num_hidden</span></code><code><span class="code-snippet_outer"> with <span class="code-snippet__keyword">self</span>.name_scope():</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.rnn = rnn.LSTM(num_hidden, num_layers, input_size=num_embed, \</span></code><code><span class="code-snippet_outer"> bidirectional=bidirectional, layout=<span class="code-snippet__string">'TNC'</span>)</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.decoder = nn.Dense(<span class="code-snippet__number">1</span>, in_units=num_hidden)</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">forward(<span class="code-snippet__keyword">self</span>, inputs, hidden)</span></span>:</span></code><code><span class="code-snippet_outer"> output, hidden = <span class="code-snippet__keyword">self</span>.rnn(inputs, hidden)</span></code><code><span class="code-snippet_outer"> decoded = <span class="code-snippet__keyword">self</span>.decoder(output.reshape((-<span class="code-snippet__number">1</span>, <span class="code-snippet__keyword">self</span>.num_hidden)))</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">return</span> decoded, hidden</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">begin_state(<span class="code-snippet__keyword">self</span>, *args, **kwargs)</span></span>:</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">return</span> <span class="code-snippet__keyword">self</span>.rnn.begin_state(*args, **kwargs)</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer">lstm_model = RNNModel(num_embed=gan_num_features, num_hidden=<span class="code-snippet__number">500</span>, num_layers=<span class="code-snippet__number">1</span>)</span></code><code><span class="code-snippet_outer">lstm_model.collect_params().initialize(mx.init.Xavier(), ctx=mx.cpu())</span></code><code><span class="code-snippet_outer">trainer = gluon.Trainer(lstm_model.collect_params(), <span class="code-snippet__string">'adam'</span>, {<span class="code-snippet__string">'learning_rate'</span>: .<span class="code-snippet__number">01</span>})</span></code><code><span class="code-snippet_outer">loss&nbsp;=&nbsp;glu</span></code></pre>
         
 </section><p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></p></pre> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（3）学习率调度器</span></p> 
<p line="2LRZ"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">学习率是非常重要的参数之一，每个优化器设置学习率，如 SGD、Adam 或 RMSProp 在训练神经网络时至关重要，因为它既控制着网络的收敛速度，又控制着网络的最终性能，接下来就要确定每个阶段的学习率。</span></p> 
<p line="CEla"><br></p> 
<section class="code-snippet__fix code-snippet__js"> 
 <ul class="code-snippet__line-index code-snippet__js"> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
  <li></li> 
 </ul> 
 <pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer" style=""><span class="code-snippet__keyword">class</span>&nbsp;<span class="code-snippet__title">TriangularSchedule</span>():</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">__init__(<span class="code-snippet__keyword">self</span>, min_lr, max_lr, cycle_length, inc_fraction=<span class="code-snippet__number">0</span>.<span class="code-snippet__number">5</span>)</span></span>: </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.min_lr = min_lr</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.max_lr = max_lr</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.cycle_length = cycle_length</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.inc_fraction = inc_fraction</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">__call__(<span class="code-snippet__keyword">self</span>, iteration)</span></span>:</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">if</span> iteration &lt;= <span class="code-snippet__keyword">self</span>.cycle_length*<span class="code-snippet__keyword">self</span>.<span class="code-snippet__symbol">inc_fraction:</span></span></code><code><span class="code-snippet_outer"> unit_cycle = iteration * <span class="code-snippet__number">1</span> / (<span class="code-snippet__keyword">self</span>.cycle_length * <span class="code-snippet__keyword">self</span>.inc_fraction)</span></code><code><span class="code-snippet_outer"> elif iteration &lt;= <span class="code-snippet__keyword">self</span>.<span class="code-snippet__symbol">cycle_length:</span></span></code><code><span class="code-snippet_outer"> unit_cycle = (<span class="code-snippet__keyword">self</span>.cycle_length - iteration) * <span class="code-snippet__number">1</span> / (<span class="code-snippet__keyword">self</span>.cycle_length * (<span class="code-snippet__number">1</span> - <span class="code-snippet__keyword">self</span>.inc_fraction))</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__symbol">else:</span></span></code><code><span class="code-snippet_outer"> unit_cycle = <span class="code-snippet__number">0</span></span></code><code><span class="code-snippet_outer"> adjusted_cycle = (unit_cycle * (<span class="code-snippet__keyword">self</span>.max_lr - <span class="code-snippet__keyword">self</span>.min_lr)) + <span class="code-snippet__keyword">self</span>.min_lr</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">return</span> adjusted_cycle</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer" style=""><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">CyclicalSchedule</span>():</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">__init__(<span class="code-snippet__keyword">self</span>, schedule_class, cycle_length, cycle_length_decay=<span class="code-snippet__number">1</span>, cycle_magnitude_decay=<span class="code-snippet__number">1</span>, **kwargs)</span></span>:</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.schedule_class = schedule_class</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.length = cycle_length</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.length_decay = cycle_length_decay</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.magnitude_decay = cycle_magnitude_decay</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">self</span>.kwargs = kwargs</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> <span class="code-snippet__function"><span class="code-snippet__keyword">def</span> <span class="code-snippet__title">__call__(<span class="code-snippet__keyword">self</span>, iteration)</span></span>:</span></code><code><span class="code-snippet_outer"> cycle_idx = <span class="code-snippet__number">0</span></span></code><code><span class="code-snippet_outer"> cycle_length = <span class="code-snippet__keyword">self</span>.length</span></code><code><span class="code-snippet_outer"> idx = <span class="code-snippet__keyword">self</span>.length</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__keyword">while</span> idx &lt;= <span class="code-snippet__symbol">iteration:</span></span></code><code><span class="code-snippet_outer"> cycle_length = math.ceil(cycle_length * <span class="code-snippet__keyword">self</span>.length_decay)</span></code><code><span class="code-snippet_outer"> cycle_idx += <span class="code-snippet__number">1</span></span></code><code><span class="code-snippet_outer"> idx += cycle_length</span></code><code><span class="code-snippet_outer"> cycle_offset = iteration - idx + cycle_length</span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer"> schedule = <span class="code-snippet__keyword">self</span>.schedule_class(cycle_length=cycle_length,**<span class="code-snippet__keyword">self</span>.kwargs)</span></code><code><span class="code-snippet_outer">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-snippet__keyword">return</span>&nbsp;schedule(cycle_offset)&nbsp;*<span class="code-snippet__keyword">self</span>.magnitude_decay**cycle_idx</span></code></pre> 
</section> 
<p line="CEla"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（4）防止过拟合与偏差-方差权衡</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"><br></span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">防止过拟合，注意总损失也是要在训练模型中非常重要的一个问题。不仅在生成器中的 LSTM 模型，判别器中的 CNN 模型、自动编码器中都使用了几种防止过拟合的技术：</span></p> 
<p line="ddf2"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">a.确保数据质量</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">b.正则化，或权重惩罚：最常用的两种正则化技术是L1 和 L2 正则法。L1对离散值更有鲁棒性，当数据稀疏时使用，可得到特征重要性。因此，在股票价格预测这个应用案例中将使用 L1 正则法。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">c.Dropout。Dropout层随机删除隐藏层中的节点。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">d.Dense-sparse-dense training</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">e.提前停止.</span></p> 
<p line="5264"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（5）权衡偏差-方差</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"><br></span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">建立复杂神经网络时，另一个重要的考虑因素是偏差-方差权衡。训练网络的误差基本上是偏差、方差和不可约误差 σ(噪声和随机性引起的误差)的函数。</span></p> 
<p line="ruU1"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">最简单的权衡公式是：误差=偏差^2+方差+σ.</span></p> 
<p line="BYl8"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">a.偏差（Bias）：偏差衡量一个经过训练的（训练数据集）算法对未见数据的概括能力。高偏差(欠拟合)意味着模型在隐藏数据上不能很好地工作。</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">b.方差（Variance）：方差衡量模型对数据集变化的敏感性。高方差意味着过拟合。</span></p> 
<p line="5242"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">4、 一维 CNN 判别模型</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"></span></p> 
<p line="315P"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（1）为何采用CNN作为判别模型？</span></p> 
<p line="zeCp"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">CNN 网络在提取隐藏特征等工作上具有优势，那如何应用于这个任务中？大家不妨尝试一下，数据点行程小趋势，小趋势行程大趋势，趋势反之形成模式，而 CNN 在此用检测特征的能力来提取 GS 股价趋势中的模式信息。</span></p> 
<p line="c479"><br></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-backh="228" data-backw="416" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHako4CfWcQibctqjcMUueKPICZ7036B79nRVO6V5FpXcLibflknibZSDfQ5Q/0?wx_fmt=png" data-ratio="0.5491071428571429" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHako4CfWcQibctqjcMUueKPICZ7036B79nRVO6V5FpXcLibflknibZSDfQ5Q/640?wx_fmt=png" data-type="png" data-w="896" height="228px" style="width: 100%;height: auto;" width="415px" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHako4CfWcQibctqjcMUueKPICZ7036B79nRVO6V5FpXcLibflknibZSDfQ5Q/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; </span><span style="color: rgb(136, 136, 136);font-size: 12px;"><span style="color: rgb(136, 136, 136);letter-spacing: 1px;">&nbsp;</span><span style="color: rgb(136, 136, 136);letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;">图：</span></span><span style="letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;color: rgb(136, 136, 136);font-size: 12px;">本文提出的 CNN 模型的体系结构。</span><span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;"></span></p> 
<p line="ca21"><br></p> 
<p line="ca21"><br></p> 
<h1 class="ql-long-11990707"><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LLqyf6BY4rMfY2LsU81MibFjicKDLjMjib5R23h8uo6GtGDY8OufWJfpEw/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LLqyf6BY4rMfY2LsU81MibFjicKDLjMjib5R23h8uo6GtGDY8OufWJfpEw/640?wx_fmt=png"></p><p style="text-align: center;"><span style="color: rgb(0, 0, 0);"><strong style="color: rgb(70, 118, 217);font-size: 18px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;">超参数优化</span></strong></span></p></h1> 
<p line="S9FM"><br></p> 
<p line="S9FM"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（1）跟踪和优化的超参数是：</span></p> 
<p line="SyZM"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">batch_size：LSTM 和 CNN 的 Batch 大小</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">cnn_lr：CNN 的学习率</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">strides：CNN 的跨步卷积数</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">lrelu_alpha：GAN 中 LeakyReLU 的 Alpha 值</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">batchnorm_momentum：CNN Batch 正则化的 momentum</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">padding：CNN 中的 Padding</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">kernel_size：1 CNN 的内核大小</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">dropout：LSTM 中的 Dropout 层</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">filters：过滤器的初始数目</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">epoch = 200</span></p> 
<p line="228d"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（2）超参数优化</span></p> 
<p line="1e3e"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">经过 200 次 GAN 训练后，将记录 MAE（LSTM、GG 中的误差函数）并作为奖励值传递给强化学习（RL）模型，以决定是否用同一组超参数来改变保持训练的超参数，如果RL决定更新超参数，它将调用 Bayes 优化库。</span></p> 
<p line="c213"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（3）超参数优化中的强化学习</span></p> 
<p line="502e"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">为什么在超参数优化中使用强化学习？股票市场一直在变化。即使能够训练 &nbsp;GAN 和 LSTM 来创造非常精确的结果，结果也只能在一定的时间内有效。也就是说，我们需要不断优化整个过程。为了优化这一过程，可以添加或删除特征，或改进深度学习模型。改进模型的最重要的方法之一就是通过超参数。一旦找到了一组特定的超参数，就需要决定何时修改它们，以及何时使用已经知道的集合(探索或利用)。此外，股票市场代表了一个依赖于数百万参数的连续空间。</span></p> 
<p line="c5af"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（4）强化学习理论</span></p> 
<p line="0d97"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">使用无模型的 RL 算法，原因很明显，我们不知道整个环境，因此没有关于环境如何工作的定义模型（如果存在，就不需要预测股票价格的变化）。使用两个细分的无模型RL：策略优化（Policy Optimization）和 Q-Learning。构建 RL 算法的一个关键方面是精确设置奖励。它必须捕捉环境的所有方面以及代理与环境的交互。</span></p> 
<p line="3fqx"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">a.Q-Learning：一种基于Q-Learning的非策略深度强化学习算法，它将7种算法结合在一起：DQN、Double Q Learning（双QL）、Prioritized replay、决斗网络(Dueling networks)、多步学习、分布式RL、噪声网络（Noisy Nets）。在Q-Learning中，学习价值从某一状态采取行动。Q 值采取行动后的预期回报。</span></p> 
<p><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">b.策略优化：这里采用近端策略优化（Proximal Policy Optimization, PPO），在决策优化中，学习从某一状态采取的行动。(如果使用诸如Actor/Critic之类的方法，也会了解处于给定状态的价值。</span></p> 
<p line="6d7c"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（5）贝叶斯优化</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"><br></span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">使用贝叶斯优化，不采用网格搜索，因为可能需要很长时间才能找到超参数的最佳组合。</span></p> 
<p line="a3c8"><br></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-ratio="0.5662460567823344" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHak8cvKXwphPRZgQibwxbxHtYVmAweYETdmNdGljaehoRic2btxptJ3EWVw/640?wx_fmt=png" data-type="png" data-w="634" height="undefined" width="undefined" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHak8cvKXwphPRZgQibwxbxHtYVmAweYETdmNdGljaehoRic2btxptJ3EWVw/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;color: rgb(136, 136, 136);font-size: 12px;">图：贝叶斯超参数优化的高斯过程</span><span style="color: rgb(63, 63, 63);font-size: 15px;letter-spacing: 1px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: justify;"></span></p> 
<p line="781f"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">5、结果</span></strong><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"></span></p> 
<p line="83be"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">最后，使用测试数据作为不同阶段的输入，LSTM 的输出与实际股价进行比较：</span></p> 
<p line="d9oJ"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（1）绘制第一次训练之后的结果</span></p> 
<p line="reM6"><br></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-backh="256" data-backw="540" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHak0pGwL7kwNus1ntr69lh0DEPSfsJoHpH9MLyGlr5sEIcv1arWeWGs6Q/0?wx_fmt=png" data-ratio="0.4738562091503268" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHak0pGwL7kwNus1ntr69lh0DEPSfsJoHpH9MLyGlr5sEIcv1arWeWGs6Q/640?wx_fmt=png" data-type="png" data-w="918" height="undefined" style="width: 100%;height: auto;" width="undefined" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHak0pGwL7kwNus1ntr69lh0DEPSfsJoHpH9MLyGlr5sEIcv1arWeWGs6Q/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（2）绘制 50 次训练后的结果。</span></p> 
<p line="fe75"><br></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-ratio="0.4726477024070022" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakEwuNLSyHCLyHpOkwOP6H2tkRtzXjjL6Yxg6TzOBXBxJ43l0HuA2IBw/640?wx_fmt=png" data-type="png" data-w="914" height="undefined" width="undefined" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakEwuNLSyHCLyHpOkwOP6H2tkRtzXjjL6Yxg6TzOBXBxJ43l0HuA2IBw/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">（3）绘制 200 次训练后的结果。</span></p> 
<p line="1510"><br></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-ratio="0.4860956618464961" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakcmQZH06OTicEJRrR3vH5odZTNBesicuUf3YX7K889fCMqArWvL9JaGWQ/640?wx_fmt=png" data-type="png" data-w="899" height="undefined" width="undefined" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakcmQZH06OTicEJRrR3vH5odZTNBesicuUf3YX7K889fCMqArWvL9JaGWQ/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"> &nbsp; &nbsp; &nbsp;</span></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">RL 运行了 10 eposide ，本文定义一个 eposide 是 GAN 完整训练 200 次后，下图是得到的最终的结果。</span></p> 
<p><br></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><img class="" data-ratio="0.4683684794672586" data-src="https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakIR4dwBKBdarUz4z0PAbZSAbC7rjVlu08V2tAbGia5HOibGvq6gaBA5zA/640?wx_fmt=png" data-type="png" data-w="901" height="undefined" width="undefined" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/BnSNEaficFAaHfRMaMicdkBCTcgg34VHakIR4dwBKBdarUz4z0PAbZSAbC7rjVlu08V2tAbGia5HOibGvq6gaBA5zA/640?wx_fmt=png"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp;</span></p> 
<p style="line-height: 1.75em;text-align: center;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp;</span></p> 
<h1 class="ql-long-8780985"><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LzUzfol6q1COlZYpeYXqe0aia45DXyhcTQW8voWvibFJvEjfmkhPvCrEg/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LzUzfol6q1COlZYpeYXqe0aia45DXyhcTQW8voWvibFJvEjfmkhPvCrEg/640?wx_fmt=png"></p><p style="text-align: center;"><span style="color: rgb(0, 0, 0);"><strong style="color: rgb(70, 118, 217);font-size: 18px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;">总结</span></strong></span></p></h1> 
<p line="myQu"><br></p> 
<p line="myQu"><br></p> 
<p style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;">可见，作者在把各路强模型联合打造的结果还是非常优秀的。不过作者还尝试创建一个 RL 环境，用于测试决定何时以及如何进行交易的交易算法。GAN 的输出将是此环境中的一个参数，虽然这些都不能完全做到预测的作用，但是在实际任务中不断尝试新技术还是很有意义的，期待作者后续工作可以带来更好的结果。完整详细教程还可以访问 Github 项目：</span></p> 
<p line="8YOb"><br></p> 
<blockquote class="js_blockquote_wrap" data-type="2" data-url="" data-author-name="" data-content-utf8-length="50" data-source-title=""> 
 <section class="js_blockquote_digest"> 
  <section> 
   <span style="letter-spacing: 1px;color: rgb(136, 136, 136);font-size: 14px;">https://github.com/borisbanushev/stockpredictionai</span> 
  </section> 
 </section> 
</blockquote> 
<hr style="border-style: solid;border-width: 1px 0 0;border-color: rgba(0,0,0,0.1);-webkit-transform-origin: 0 0;-webkit-transform: scale(1, 0.5);transform-origin: 0 0;transform: scale(1, 0.5);"> 
<p style="margin-right: 8px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(255, 76, 0);font-size: 14px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;letter-spacing: 0.544px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;text-align: left;color: rgb(136, 136, 136);box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></span></strong></span></strong><br></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;"><img class="rich_pages" data-copyright="0" data-ratio="0.5482233502538071" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuhP02SJUMCa77A0VXqFBLfNzl0TbVWBFU50jz2YLJ6UKQwQfjPM131eQjfxMTQibDtOf17yqXUPCrQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="591" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuhP02SJUMCa77A0VXqFBLfNzl0TbVWBFU50jz2YLJ6UKQwQfjPM131eQjfxMTQibDtOf17yqXUPCrQ/640?wx_fmt=jpeg"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;">作为码一代，想教码二代却无从下手：</span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">听说少儿编程很火，可它有哪些好处呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">孩子多大开始学习比较好呢？又该如何学习呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">最新的编程教育政策又有哪些呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">下面给大家介绍CSDN新成员：<strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">极客宝宝（ID：</strong><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">geek_baby）</strong></span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">戳他了解更多↓↓↓</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="rich_pages " data-copyright="0" data-cropselx1="180" data-cropselx2="438" data-cropsely1="0" data-cropsely2="258" data-ratio="0.3697916666666667" data-s="300,640" data-type="jpeg" data-w="960" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuh1bcXNq238J3vRKyXya05vbbgCLnCbTPs0mGuVrLHntraYT5MIPrhkqQCmnqobLOf7nkWPh5j6vw/640?wx_fmt=jpeg" style="background-position: 50% 50%;border-width: 1px;border-style: solid;border-color: rgb(238, 237, 235);background-repeat: no-repeat;background-size: 22px;background-color: rgb(238, 237, 235);box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: 576px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuh1bcXNq238J3vRKyXya05vbbgCLnCbTPs0mGuVrLHntraYT5MIPrhkqQCmnqobLOf7nkWPh5j6vw/640?wx_fmt=jpeg"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 255, 255);background-color: rgb(60, 142, 216);font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">&nbsp;热 文</strong>&nbsp;推 荐&nbsp;</strong></span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718551&amp;idx=1&amp;sn=ed82b331f64af29cdcec6ee2596c1f7e&amp;chksm=bea6b08489d13992d2035a5c3a4b01f5121cbcf1d20a9a54e498841b70a26351a37c5be2c49d&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞</a></span><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718646&amp;idx=1&amp;sn=b746dcd84262ded8af201d0e028f885e&amp;chksm=bea6b06589d1397304affc0ae25355aaae1ce35af3eb325bef7efd1e48bdc55d3f860bc08fd6&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">Erlang 之父去世，他留给程序员两点忠告</span></a><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718551&amp;idx=1&amp;sn=ed82b331f64af29cdcec6ee2596c1f7e&amp;chksm=bea6b08489d13992d2035a5c3a4b01f5121cbcf1d20a9a54e498841b70a26351a37c5be2c49d&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞</a></span><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718646&amp;idx=2&amp;sn=141a38f2bd574f7aae84016de4867f3b&amp;chksm=bea6b06589d139730780c77d49bd8619e2ae487d0b60aebf3784c87e3cae29ce5b7344f1fa22&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">中国程序员独闯硅谷，逆袭成美国最佳 CEO，公司市值 160 亿美元！</span></a><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718551&amp;idx=1&amp;sn=ed82b331f64af29cdcec6ee2596c1f7e&amp;chksm=bea6b08489d13992d2035a5c3a4b01f5121cbcf1d20a9a54e498841b70a26351a37c5be2c49d&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞</a></span><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718646&amp;idx=3&amp;sn=07f1037118e009f16e305ace226e5ee2&amp;chksm=bea6b06589d139730bbef883deb77bbdca7ab2d858c45be2a6a88ce3b1681d7c7da095f3f9aa&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">我逛了下 JDK 一条街，发现了不少好东西！</span></a><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MDA4NDkxMQ==&amp;mid=2247483866&amp;idx=1&amp;sn=c61e53808100986007f9798ef29e4960&amp;chksm=ce92799af9e5f08c0b4a77d1a5f522627da14e8cb5c46f83ef4afa45a102ba517daee8bc1453&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞&nbsp;</span></a><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MDA4NDkxMQ==&amp;mid=2247483883&amp;idx=1&amp;sn=7af3d0e822e979583e9f9a5d515c26ab&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="color: rgb(0, 82, 255);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">斯坦福区块链匪帮传奇，那些睡地毯、没日没夜写代码的编程少年</a><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI0ODcxODk5OA==&amp;mid=2247504463&amp;idx=1&amp;sn=ef40cf8abd754de861823a3943b689c7&amp;chksm=e99ee1b6dee968a0788a7909be5f313e039871fe56132266740d9f61e6fb19d9c0d8c093bebe&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827209&amp;idx=1&amp;sn=c7dd99053f8bb7091c3dc87943a0751a&amp;chksm=871e806bb069097d06406a39b33820c8b4b075b6a56199aa139a1ae58daaa8a079fce80fcc85&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞ 微服务落地，我们在考虑什么？| 技术头条</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247494442&amp;idx=1&amp;sn=76439d40b659cfae06572333232cbbe7&amp;chksm=fc7fb5d7cb083cc1331fa903b5ce0737714628bb0b8ae3a28c509b4a8fcea6512a08c8dc258f&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞ 爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪?</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA5MjcxNjc2Ng==&amp;mid=2650559766&amp;idx=1&amp;sn=fb6e44a97e108113a772c6c2bba25289&amp;chksm=88601ea7bf1797b117aa0625a3efa316fa660eb90654a96013c14a03c4eb3a71bb75b6bab646&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">☞ 程序员被骗"黑砖窑"：监禁、恐吓、996无休编程！</span></a></p> 
<section style="max-width: 100%;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
 <section class="" style="max-width: 100%;font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
  <pre style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;padding: 0.5em;max-width: 100%;min-height: 1em;font-size: 14px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;background: rgb(34, 34, 34);color: rgb(170, 170, 170);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;">System.out.println(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个在看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">console.log(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(50, 170, 238);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">print</span>(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(50, 170, 238);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">printf</span>(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！\n"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">cout&nbsp;&lt;&lt;&nbsp;<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>&nbsp;&lt;&lt;&nbsp;endl;<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">Console.WriteLine(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">Response.Write(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">alert(</span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">)</span><br style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;font-variant-numeric: normal;line-height: inherit;widows: 1;color: rgb(50, 170, 238);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: inherit !important;word-break: inherit !important;">echo </span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;color: rgb(255, 204, 51);box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">在</span>看吧！"</span></p></pre> 
 </section> 
</section> 
<section class="" data-tools="135编辑器" data-id="94250" style="max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);border-width: 0px;border-style: none;border-color: initial;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
 <section class="" data-tools="135编辑器" data-id="91842" style="max-width: 100%;box-sizing: border-box;border-width: 0px;border-style: none;border-color: initial;text-align: right;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
  <section style="max-width: 100%;display: inline-block;clear: both;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
   <section class="" data-brushtype="text" style="padding: 18px 15px 20px 10px;max-width: 100%;box-sizing: border-box;color: rgb(86, 146, 214);background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdy66AHd7QqL7A2s5icSBE0aw4iaKOKPnXGYxQPhG7VMpbbYV6VJprSh7w/640?wx_fmt=png&quot;);background-repeat: no-repeat;text-align: center;background-size: 100% 100%;font-size: 16px;letter-spacing: 1.5px;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
    <section style="max-width: 100%;display: flex;justify-content: center;align-items: center;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
     <section style="margin-left: 2px;max-width: 100%;width: 20px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
      <img class="" data-ratio="0.8936170212765957" data-type="png" data-w="47" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdvAd0o9e1LlUGA2k0Yib222agOxzweXhahA9GuzJcGBg0dA4DzlibxRqw/640?wx_fmt=png" style="margin-bottom: -6px;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;visibility: visible !important;width: 20px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdvAd0o9e1LlUGA2k0Yib222agOxzweXhahA9GuzJcGBg0dA4DzlibxRqw/640?wx_fmt=png"> 
     </section> 
     <section class="" data-brushtype="text" style="max-width: 100%;font-size: 14px;color: rgb(51, 51, 51);text-align: right;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;"> 
      <span style="max-width: 100%;font-family: 楷体, 楷体_GB2312, SimKai;box-sizing: border-box !important;word-wrap: break-word !important;overflow-wrap: break-word !important;">你点的每个“在看”，我都认真当成了喜欢</span> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

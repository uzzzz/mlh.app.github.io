<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>为什么阿里巴巴建议集合初始化时，指定集合容量大小？ | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="为什么阿里巴巴建议集合初始化时，指定集合容量大小？" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="作者 |&nbsp;Hollis 本文经授权转载自Hollis（ID：hollischuang） 关于集合类，《阿里巴巴Java开发手册》中有一个规定： 本文就来分析一下为什么会有如此建议？如果一定要设置初始容量的话，设置多少比较合适？ 为什么要设置初始容量 我们先来写一段代码在JDK 1.7 （jdk1.7.0_79）下面来分别测试下，在不指定初始化容量和指定初始化容量的情况下性能情况如何。（jdk 8 结果会有所不同，我会在后面的文章中分析） public static void main(String[] args) { int aHundredMillion = 10000000; Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); long s1 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map.put(i, i); } long s2 = System.currentTimeMillis(); System.out.println(&quot;未初始化容量，耗时 ：&quot;+ (s2 - s1)); Map&lt;Integer, Integer&gt; map1 = new HashMap&lt;&gt;(aHundredMillion / 2); long s5 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map1.put(i, i); } long s6 = System.currentTimeMillis(); System.out.println(&quot;初始化容量5000000，耗时 ：&quot;+ (s6 - s5)); Map&lt;Integer, Integer&gt; map2 = new HashMap&lt;&gt;(aHundredMillion); long s3 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map2.put(i, i); } long s4 = System.currentTimeMillis(); System.out.println(&quot;初始化容量为10000000，耗时 ：&quot;+ (s4 - s3)); } 以上代码不难理解，我们创建了3个HashMap，分别使用默认的容量（16）、使用元素个数的一半（5千万）作为初始容量、使用元素个数（一亿）作为初始容量进行初始化。然后分别向其中put一亿个KV。 输出结果： 未初始化容量，耗时 ：14419 初始化容量5000000，耗时 ：11916 初始化容量为10000000，耗时 ：7984 从结果中，我们可以知道，在已知HashMap中将要存放的KV个数的时候，设置一个合理的初始化容量可以有效的提高性能。 当然，以上结论也是有理论支撑的。我们HashMap中傻傻分不清楚的那些概念文章介绍过，HashMap有扩容机制，就是当达到扩容条件时会进行扩容。HashMap的扩容条件就是当HashMap中的元素个数（size）超过临界值（threshold）时就会自动扩容。在HashMap中， threshold = loadFactor * capacity。 所以，如果我们没有设置初始容量大小，随着元素的不断增加，HashMap会发生多次扩容，而HashMap中的扩容机制决定了每次扩容都需要重建hash表，是非常影响性能的。 从上面的代码示例中，我们还发现，同样是设置初始化容量，设置的数值不同也会影响性能，那么当我们已知HashMap中即将存放的KV个数的时候，容量设置成多少为好呢？ HashMap中容量的初始化 默认情况下，当我们设置HashMap的初始化容量时，实际上HashMap会采用第一个大于该数值的2的幂作为初始化容量。 如以下示例代码： Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(1);map.put(&quot;hahaha&quot;, &quot;hollischuang&quot;); Class&lt;?&gt; mapType = map.getClass(); Method capacity = mapType.getDeclaredMethod(&quot;capacity&quot;);capacity.setAccessible(true); System.out.println(&quot;capacity&nbsp;:&nbsp;&quot;+ capacity.invoke(map)); 在jdk1.7中，初始化容量设置成1的时候，输出结果是2。在jdk1.8中，如果我们传入的初始化容量为1，实际上设置的结果也为1，上面代码输出结果为2的原因是代码中map.put(“hahaha”, “hollischuang”);导致了扩容，容量从1扩容到2。 那么，话题再说回来，当我们通过HashMap(int initialCapacity)设置初始容量的时候，HashMap并不一定会直接采用我们传入的数值，而是经过计算，得到一个新值，目的是提高hash的效率。(1-&gt;1、3-&gt;4、7-&gt;8、9-&gt;16) 在Jdk 1.7和Jdk 1.8中，HashMap初始化这个容量的时机不同。jdk1.8中，在调用HashMap的构造函数定义HashMap的时候，就会进行容量的设定。而在Jdk 1.7中，要等到第一次put操作时才进行这一操作。 不管是Jdk 1.7还是Jdk 1.8，计算初始化容量的算法其实是如出一辙的，主要代码如下： int n = cap - 1;n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; 上面的代码挺有意思的，一个简单的容量初始化，Java的工程师也有很多考虑在里面。 上面的算法目的挺简单，就是：根据用户传入的容量值（代码中的cap），通过计算，得到第一个比他大的2的幂并返回。 聪明的读者们，如果让你设计这个算法你准备如何计算？如果你想到二进制的话，那就很简单了。举几个例子看一下： 请关注上面的几个例子中，蓝色字体部分的变化情况，或许你会发现些规律。5-&gt;8、9-&gt;16、19-&gt;32、37-&gt;64都是主要经过了两个阶段。 Step 1，5-&gt;7 Step 2，7-&gt;8 Step 1，9-&gt;15 Step 2，15-&gt;16 Step 1，19-&gt;31 Step 2，31-&gt;32 Step 1，37-&gt;63 Step 2，63-&gt;65 对应到以上代码中，Step 1： n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16; 对应到以上代码中，Step2： return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; Step 2 比较简单，就是做一下极限值的判断，然后把Step 1得到的数值+1。 Step 1 怎么理解呢？其实是对一个二进制数依次向右移位，然后与原值取或。其目的对于一个数字的二进制，从第一个不为0的位开始，把后面的所有位都设置成1。 随便拿一个二进制数，套一遍上面的公式就发现其目的了： 1100 1100 1100 &gt;&gt;&gt;1 = 0110 0110 0110 1100 1100 1100 | 0110 0110 0110 = 1110 1110 1110 1110 1110 1110 &gt;&gt;&gt;2 = 0011 1011 1011 1110 1110 1110 | 0011 1011 1011 = 1111 1111 1111 1111 1111 1111 &gt;&gt;&gt;4 = 1111 1111 1111 1111 1111 1111 | 1111 1111 1111 = 1111 1111 1111 通过几次无符号右移和按位或运算，我们把1100 1100 1100转换成了1111 1111 1111 ，再把1111 1111 1111加1，就得到了1 0000 0000 0000，这就是大于1100 1100 1100的第一个2的幂。 好了，我们现在解释清楚了Step 1和Step 2的代码。就是可以把一个数转化成第一个比他自身大的2的幂。（可以开始佩服Java的工程师们了，使用无符号右移和按位或运算大大提升了效率。） 但是还有一种特殊情况套用以上公式不行，这些数字就是2的幂自身。如果数字4 套用公式的话。得到的会是 8 ： Step 1: 0100 &gt;&gt;&gt;1 = 0010 0100 | 0010 = 0110 0110 &gt;&gt;&gt;1 = 0011 0110 | 0011 = 0111 Step 2: 0111 + 0001 = 1000 为了解决这个问题，JDK的工程师把所有用户传进来的数在进行计算之前先-1，就是源码中的第一行： int n = cap - 1; 至此，再来回过头看看这个设置初始容量的代码，目的是不是一目了然了： int n = cap - 1;n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; HashMap初始容量的合理值 当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。 那么，是不是我们只需要把已知的HashMap中即将存放的元素个数直接传给initialCapacity就可以了呢？ 关于这个值的设置，在《阿里巴巴Java开发手册》有以下建议： 这个值，并不是阿里巴巴的工程师原创的，在guava（21.0版本）中也使用的是这个值。 public static &lt;K, V&gt; HashMap&lt;K, V&gt; newHashMapWithExpectedSize(int expectedSize) { return new HashMap&lt;K, V&gt;(capacity(expectedSize)); } /*** Returns a capacity that is sufficient to keep the map from being resized as long as it grows no* larger than expectedSize and the load factor is ≥ its default (0.75).*/ static int capacity(int expectedSize) { if (expectedSize &lt; 3) { checkNonnegative(expectedSize, &quot;expectedSize&quot;); return expectedSize + 1; } if (expectedSize &lt; Ints.MAX_POWER_OF_TWO) { // This is the calculation used in JDK8 to resize when a putAll // happens; it seems to be the most conservative calculation we // can make. 0.75 is the default load factor. return (int) ((float) expectedSize / 0.75F + 1.0F); } return Integer.MAX_VALUE; // any large value } 在return (int) ((float) expectedSize / 0.75F + 1.0F);上面有一行注释，说明了这个公式也不是guava原创，参考的是JDK8中putAll方法中的实现的。 感兴趣的读者可以去看下putAll方法的实现，也是以上的这个公式。 虽然，当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。但是这个值并没有参考loadFactor的值。 也就是说，如果我们设置的默认值是7，经过Jdk处理之后，会被设置成8，但是，这个HashMap在元素个数达到 8*0.75 = 6的时候就会进行一次扩容，这明显是我们不希望见到的。 如果我们通过 expectedSize / 0.75F + 1.0F 计算，7/0.75 + 1 = 10 ,10经过Jdk处理之后，会被设置成16，这就大大的减少了扩容的几率。 当HashMap内部维护的哈希表的容量达到75%时（默认情况下），会触发rehash，而rehash的过程是比较耗费时间的。 所以初始化容量要设置成expectedSize/0.75 + 1的话，可以有效的减少冲突也可以减小误差。 所以，我可以认为，当我们明确知道HashMap中元素的个数的时候，把默认容量设置成 expectedSize / 0.75F + 1.0F 是一个在性能上相对好的选择，但是，同时也会牺牲些内存。 总结 当我们想要在代码中创建一个HashMap的时候，如果我们已知这个Map中即将存放的元素个数，给HashMap设置初始容量可以在一定程度上提升效率。 但是，JDK并不会直接拿用户传进来的数字当做默认容量，而是会进行一番运算，最终得到一个2的幂。 原因在《全网把Map中的hash()分析的最透彻的文章，别无二家》介绍过，得到这个数字的算法其实是使用了使用无符号右移和按位或运算来提升效率。 但是，为了最大程度的避免扩容带来的性能消耗，我们建议可以把默认容量的数字设置成expectedSize / 0.75F + 1.0F 。在日常开发中，可以使用 Map&lt;String, String&gt; map = Maps.newHashMapWithExpectedSize(10); 来创建一个HashMap，计算的过程guava会帮我们完成。 但是，以上的操作是一种用内存换性能的做法，真正使用的时候，要考虑到内存的影响。 最后，留一个思考题：为什么JDK 8中，putAll方法采用了这个expectedSize / 0.75F + 1.0F公式，而put、构造函数等并没有默认使用这个公式呢？ 作者简介：Hollis，知名技术博主，个人博客文章阅读量数百万，CSDN博客专家。工作地点杭州，主要从事金融，支付领域的Java开发，热衷于技术分享。 本文转载自Hollis公众号，专注原创技术文章，主要以Java相关技术为主，覆盖基础知识、底层原理、技术成长等话题。 【End】 &nbsp;热 文&nbsp;推 荐&nbsp; ☞刘强东案关键证人曝光；周鸿祎 diss 贾跃亭；苹果回收 100 万部旧手机 | 极客头条 ☞三星折叠屏手机出事！才用两天就“挂了” ☞50 多岁的他笑谈码农真相，看完清醒了！| 人物志 ☞零编程基础、大龄全职妈妈是如何写出两个商业网站的？ ☞下过富士康工厂、做过华为外包，这位程序员是如何花 6 年逆袭成为技术大佬的？ ☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码 ☞微服务落地，我们在考虑什么？| 技术头条 ☞爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪? ☞程序员被骗&quot;黑砖窑&quot;：监禁、恐吓、996无休编程！ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢" />
<meta property="og:description" content="作者 |&nbsp;Hollis 本文经授权转载自Hollis（ID：hollischuang） 关于集合类，《阿里巴巴Java开发手册》中有一个规定： 本文就来分析一下为什么会有如此建议？如果一定要设置初始容量的话，设置多少比较合适？ 为什么要设置初始容量 我们先来写一段代码在JDK 1.7 （jdk1.7.0_79）下面来分别测试下，在不指定初始化容量和指定初始化容量的情况下性能情况如何。（jdk 8 结果会有所不同，我会在后面的文章中分析） public static void main(String[] args) { int aHundredMillion = 10000000; Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); long s1 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map.put(i, i); } long s2 = System.currentTimeMillis(); System.out.println(&quot;未初始化容量，耗时 ：&quot;+ (s2 - s1)); Map&lt;Integer, Integer&gt; map1 = new HashMap&lt;&gt;(aHundredMillion / 2); long s5 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map1.put(i, i); } long s6 = System.currentTimeMillis(); System.out.println(&quot;初始化容量5000000，耗时 ：&quot;+ (s6 - s5)); Map&lt;Integer, Integer&gt; map2 = new HashMap&lt;&gt;(aHundredMillion); long s3 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map2.put(i, i); } long s4 = System.currentTimeMillis(); System.out.println(&quot;初始化容量为10000000，耗时 ：&quot;+ (s4 - s3)); } 以上代码不难理解，我们创建了3个HashMap，分别使用默认的容量（16）、使用元素个数的一半（5千万）作为初始容量、使用元素个数（一亿）作为初始容量进行初始化。然后分别向其中put一亿个KV。 输出结果： 未初始化容量，耗时 ：14419 初始化容量5000000，耗时 ：11916 初始化容量为10000000，耗时 ：7984 从结果中，我们可以知道，在已知HashMap中将要存放的KV个数的时候，设置一个合理的初始化容量可以有效的提高性能。 当然，以上结论也是有理论支撑的。我们HashMap中傻傻分不清楚的那些概念文章介绍过，HashMap有扩容机制，就是当达到扩容条件时会进行扩容。HashMap的扩容条件就是当HashMap中的元素个数（size）超过临界值（threshold）时就会自动扩容。在HashMap中， threshold = loadFactor * capacity。 所以，如果我们没有设置初始容量大小，随着元素的不断增加，HashMap会发生多次扩容，而HashMap中的扩容机制决定了每次扩容都需要重建hash表，是非常影响性能的。 从上面的代码示例中，我们还发现，同样是设置初始化容量，设置的数值不同也会影响性能，那么当我们已知HashMap中即将存放的KV个数的时候，容量设置成多少为好呢？ HashMap中容量的初始化 默认情况下，当我们设置HashMap的初始化容量时，实际上HashMap会采用第一个大于该数值的2的幂作为初始化容量。 如以下示例代码： Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(1);map.put(&quot;hahaha&quot;, &quot;hollischuang&quot;); Class&lt;?&gt; mapType = map.getClass(); Method capacity = mapType.getDeclaredMethod(&quot;capacity&quot;);capacity.setAccessible(true); System.out.println(&quot;capacity&nbsp;:&nbsp;&quot;+ capacity.invoke(map)); 在jdk1.7中，初始化容量设置成1的时候，输出结果是2。在jdk1.8中，如果我们传入的初始化容量为1，实际上设置的结果也为1，上面代码输出结果为2的原因是代码中map.put(“hahaha”, “hollischuang”);导致了扩容，容量从1扩容到2。 那么，话题再说回来，当我们通过HashMap(int initialCapacity)设置初始容量的时候，HashMap并不一定会直接采用我们传入的数值，而是经过计算，得到一个新值，目的是提高hash的效率。(1-&gt;1、3-&gt;4、7-&gt;8、9-&gt;16) 在Jdk 1.7和Jdk 1.8中，HashMap初始化这个容量的时机不同。jdk1.8中，在调用HashMap的构造函数定义HashMap的时候，就会进行容量的设定。而在Jdk 1.7中，要等到第一次put操作时才进行这一操作。 不管是Jdk 1.7还是Jdk 1.8，计算初始化容量的算法其实是如出一辙的，主要代码如下： int n = cap - 1;n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; 上面的代码挺有意思的，一个简单的容量初始化，Java的工程师也有很多考虑在里面。 上面的算法目的挺简单，就是：根据用户传入的容量值（代码中的cap），通过计算，得到第一个比他大的2的幂并返回。 聪明的读者们，如果让你设计这个算法你准备如何计算？如果你想到二进制的话，那就很简单了。举几个例子看一下： 请关注上面的几个例子中，蓝色字体部分的变化情况，或许你会发现些规律。5-&gt;8、9-&gt;16、19-&gt;32、37-&gt;64都是主要经过了两个阶段。 Step 1，5-&gt;7 Step 2，7-&gt;8 Step 1，9-&gt;15 Step 2，15-&gt;16 Step 1，19-&gt;31 Step 2，31-&gt;32 Step 1，37-&gt;63 Step 2，63-&gt;65 对应到以上代码中，Step 1： n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16; 对应到以上代码中，Step2： return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; Step 2 比较简单，就是做一下极限值的判断，然后把Step 1得到的数值+1。 Step 1 怎么理解呢？其实是对一个二进制数依次向右移位，然后与原值取或。其目的对于一个数字的二进制，从第一个不为0的位开始，把后面的所有位都设置成1。 随便拿一个二进制数，套一遍上面的公式就发现其目的了： 1100 1100 1100 &gt;&gt;&gt;1 = 0110 0110 0110 1100 1100 1100 | 0110 0110 0110 = 1110 1110 1110 1110 1110 1110 &gt;&gt;&gt;2 = 0011 1011 1011 1110 1110 1110 | 0011 1011 1011 = 1111 1111 1111 1111 1111 1111 &gt;&gt;&gt;4 = 1111 1111 1111 1111 1111 1111 | 1111 1111 1111 = 1111 1111 1111 通过几次无符号右移和按位或运算，我们把1100 1100 1100转换成了1111 1111 1111 ，再把1111 1111 1111加1，就得到了1 0000 0000 0000，这就是大于1100 1100 1100的第一个2的幂。 好了，我们现在解释清楚了Step 1和Step 2的代码。就是可以把一个数转化成第一个比他自身大的2的幂。（可以开始佩服Java的工程师们了，使用无符号右移和按位或运算大大提升了效率。） 但是还有一种特殊情况套用以上公式不行，这些数字就是2的幂自身。如果数字4 套用公式的话。得到的会是 8 ： Step 1: 0100 &gt;&gt;&gt;1 = 0010 0100 | 0010 = 0110 0110 &gt;&gt;&gt;1 = 0011 0110 | 0011 = 0111 Step 2: 0111 + 0001 = 1000 为了解决这个问题，JDK的工程师把所有用户传进来的数在进行计算之前先-1，就是源码中的第一行： int n = cap - 1; 至此，再来回过头看看这个设置初始容量的代码，目的是不是一目了然了： int n = cap - 1;n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; HashMap初始容量的合理值 当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。 那么，是不是我们只需要把已知的HashMap中即将存放的元素个数直接传给initialCapacity就可以了呢？ 关于这个值的设置，在《阿里巴巴Java开发手册》有以下建议： 这个值，并不是阿里巴巴的工程师原创的，在guava（21.0版本）中也使用的是这个值。 public static &lt;K, V&gt; HashMap&lt;K, V&gt; newHashMapWithExpectedSize(int expectedSize) { return new HashMap&lt;K, V&gt;(capacity(expectedSize)); } /*** Returns a capacity that is sufficient to keep the map from being resized as long as it grows no* larger than expectedSize and the load factor is ≥ its default (0.75).*/ static int capacity(int expectedSize) { if (expectedSize &lt; 3) { checkNonnegative(expectedSize, &quot;expectedSize&quot;); return expectedSize + 1; } if (expectedSize &lt; Ints.MAX_POWER_OF_TWO) { // This is the calculation used in JDK8 to resize when a putAll // happens; it seems to be the most conservative calculation we // can make. 0.75 is the default load factor. return (int) ((float) expectedSize / 0.75F + 1.0F); } return Integer.MAX_VALUE; // any large value } 在return (int) ((float) expectedSize / 0.75F + 1.0F);上面有一行注释，说明了这个公式也不是guava原创，参考的是JDK8中putAll方法中的实现的。 感兴趣的读者可以去看下putAll方法的实现，也是以上的这个公式。 虽然，当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。但是这个值并没有参考loadFactor的值。 也就是说，如果我们设置的默认值是7，经过Jdk处理之后，会被设置成8，但是，这个HashMap在元素个数达到 8*0.75 = 6的时候就会进行一次扩容，这明显是我们不希望见到的。 如果我们通过 expectedSize / 0.75F + 1.0F 计算，7/0.75 + 1 = 10 ,10经过Jdk处理之后，会被设置成16，这就大大的减少了扩容的几率。 当HashMap内部维护的哈希表的容量达到75%时（默认情况下），会触发rehash，而rehash的过程是比较耗费时间的。 所以初始化容量要设置成expectedSize/0.75 + 1的话，可以有效的减少冲突也可以减小误差。 所以，我可以认为，当我们明确知道HashMap中元素的个数的时候，把默认容量设置成 expectedSize / 0.75F + 1.0F 是一个在性能上相对好的选择，但是，同时也会牺牲些内存。 总结 当我们想要在代码中创建一个HashMap的时候，如果我们已知这个Map中即将存放的元素个数，给HashMap设置初始容量可以在一定程度上提升效率。 但是，JDK并不会直接拿用户传进来的数字当做默认容量，而是会进行一番运算，最终得到一个2的幂。 原因在《全网把Map中的hash()分析的最透彻的文章，别无二家》介绍过，得到这个数字的算法其实是使用了使用无符号右移和按位或运算来提升效率。 但是，为了最大程度的避免扩容带来的性能消耗，我们建议可以把默认容量的数字设置成expectedSize / 0.75F + 1.0F 。在日常开发中，可以使用 Map&lt;String, String&gt; map = Maps.newHashMapWithExpectedSize(10); 来创建一个HashMap，计算的过程guava会帮我们完成。 但是，以上的操作是一种用内存换性能的做法，真正使用的时候，要考虑到内存的影响。 最后，留一个思考题：为什么JDK 8中，putAll方法采用了这个expectedSize / 0.75F + 1.0F公式，而put、构造函数等并没有默认使用这个公式呢？ 作者简介：Hollis，知名技术博主，个人博客文章阅读量数百万，CSDN博客专家。工作地点杭州，主要从事金融，支付领域的Java开发，热衷于技术分享。 本文转载自Hollis公众号，专注原创技术文章，主要以Java相关技术为主，覆盖基础知识、底层原理、技术成长等话题。 【End】 &nbsp;热 文&nbsp;推 荐&nbsp; ☞刘强东案关键证人曝光；周鸿祎 diss 贾跃亭；苹果回收 100 万部旧手机 | 极客头条 ☞三星折叠屏手机出事！才用两天就“挂了” ☞50 多岁的他笑谈码农真相，看完清醒了！| 人物志 ☞零编程基础、大龄全职妈妈是如何写出两个商业网站的？ ☞下过富士康工厂、做过华为外包，这位程序员是如何花 6 年逆袭成为技术大佬的？ ☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码 ☞微服务落地，我们在考虑什么？| 技术头条 ☞爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪? ☞程序员被骗&quot;黑砖窑&quot;：监禁、恐吓、996无休编程！ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢" />
<link rel="canonical" href="https://mlh.app/2019/04/28/728462.html" />
<meta property="og:url" content="https://mlh.app/2019/04/28/728462.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-28T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"作者 |&nbsp;Hollis 本文经授权转载自Hollis（ID：hollischuang） 关于集合类，《阿里巴巴Java开发手册》中有一个规定： 本文就来分析一下为什么会有如此建议？如果一定要设置初始容量的话，设置多少比较合适？ 为什么要设置初始容量 我们先来写一段代码在JDK 1.7 （jdk1.7.0_79）下面来分别测试下，在不指定初始化容量和指定初始化容量的情况下性能情况如何。（jdk 8 结果会有所不同，我会在后面的文章中分析） public static void main(String[] args) { int aHundredMillion = 10000000; Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); long s1 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map.put(i, i); } long s2 = System.currentTimeMillis(); System.out.println(&quot;未初始化容量，耗时 ：&quot;+ (s2 - s1)); Map&lt;Integer, Integer&gt; map1 = new HashMap&lt;&gt;(aHundredMillion / 2); long s5 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map1.put(i, i); } long s6 = System.currentTimeMillis(); System.out.println(&quot;初始化容量5000000，耗时 ：&quot;+ (s6 - s5)); Map&lt;Integer, Integer&gt; map2 = new HashMap&lt;&gt;(aHundredMillion); long s3 = System.currentTimeMillis(); for (int i = 0; i &lt; aHundredMillion; i++) { map2.put(i, i); } long s4 = System.currentTimeMillis(); System.out.println(&quot;初始化容量为10000000，耗时 ：&quot;+ (s4 - s3)); } 以上代码不难理解，我们创建了3个HashMap，分别使用默认的容量（16）、使用元素个数的一半（5千万）作为初始容量、使用元素个数（一亿）作为初始容量进行初始化。然后分别向其中put一亿个KV。 输出结果： 未初始化容量，耗时 ：14419 初始化容量5000000，耗时 ：11916 初始化容量为10000000，耗时 ：7984 从结果中，我们可以知道，在已知HashMap中将要存放的KV个数的时候，设置一个合理的初始化容量可以有效的提高性能。 当然，以上结论也是有理论支撑的。我们HashMap中傻傻分不清楚的那些概念文章介绍过，HashMap有扩容机制，就是当达到扩容条件时会进行扩容。HashMap的扩容条件就是当HashMap中的元素个数（size）超过临界值（threshold）时就会自动扩容。在HashMap中， threshold = loadFactor * capacity。 所以，如果我们没有设置初始容量大小，随着元素的不断增加，HashMap会发生多次扩容，而HashMap中的扩容机制决定了每次扩容都需要重建hash表，是非常影响性能的。 从上面的代码示例中，我们还发现，同样是设置初始化容量，设置的数值不同也会影响性能，那么当我们已知HashMap中即将存放的KV个数的时候，容量设置成多少为好呢？ HashMap中容量的初始化 默认情况下，当我们设置HashMap的初始化容量时，实际上HashMap会采用第一个大于该数值的2的幂作为初始化容量。 如以下示例代码： Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(1);map.put(&quot;hahaha&quot;, &quot;hollischuang&quot;); Class&lt;?&gt; mapType = map.getClass(); Method capacity = mapType.getDeclaredMethod(&quot;capacity&quot;);capacity.setAccessible(true); System.out.println(&quot;capacity&nbsp;:&nbsp;&quot;+ capacity.invoke(map)); 在jdk1.7中，初始化容量设置成1的时候，输出结果是2。在jdk1.8中，如果我们传入的初始化容量为1，实际上设置的结果也为1，上面代码输出结果为2的原因是代码中map.put(“hahaha”, “hollischuang”);导致了扩容，容量从1扩容到2。 那么，话题再说回来，当我们通过HashMap(int initialCapacity)设置初始容量的时候，HashMap并不一定会直接采用我们传入的数值，而是经过计算，得到一个新值，目的是提高hash的效率。(1-&gt;1、3-&gt;4、7-&gt;8、9-&gt;16) 在Jdk 1.7和Jdk 1.8中，HashMap初始化这个容量的时机不同。jdk1.8中，在调用HashMap的构造函数定义HashMap的时候，就会进行容量的设定。而在Jdk 1.7中，要等到第一次put操作时才进行这一操作。 不管是Jdk 1.7还是Jdk 1.8，计算初始化容量的算法其实是如出一辙的，主要代码如下： int n = cap - 1;n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; 上面的代码挺有意思的，一个简单的容量初始化，Java的工程师也有很多考虑在里面。 上面的算法目的挺简单，就是：根据用户传入的容量值（代码中的cap），通过计算，得到第一个比他大的2的幂并返回。 聪明的读者们，如果让你设计这个算法你准备如何计算？如果你想到二进制的话，那就很简单了。举几个例子看一下： 请关注上面的几个例子中，蓝色字体部分的变化情况，或许你会发现些规律。5-&gt;8、9-&gt;16、19-&gt;32、37-&gt;64都是主要经过了两个阶段。 Step 1，5-&gt;7 Step 2，7-&gt;8 Step 1，9-&gt;15 Step 2，15-&gt;16 Step 1，19-&gt;31 Step 2，31-&gt;32 Step 1，37-&gt;63 Step 2，63-&gt;65 对应到以上代码中，Step 1： n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16; 对应到以上代码中，Step2： return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; Step 2 比较简单，就是做一下极限值的判断，然后把Step 1得到的数值+1。 Step 1 怎么理解呢？其实是对一个二进制数依次向右移位，然后与原值取或。其目的对于一个数字的二进制，从第一个不为0的位开始，把后面的所有位都设置成1。 随便拿一个二进制数，套一遍上面的公式就发现其目的了： 1100 1100 1100 &gt;&gt;&gt;1 = 0110 0110 0110 1100 1100 1100 | 0110 0110 0110 = 1110 1110 1110 1110 1110 1110 &gt;&gt;&gt;2 = 0011 1011 1011 1110 1110 1110 | 0011 1011 1011 = 1111 1111 1111 1111 1111 1111 &gt;&gt;&gt;4 = 1111 1111 1111 1111 1111 1111 | 1111 1111 1111 = 1111 1111 1111 通过几次无符号右移和按位或运算，我们把1100 1100 1100转换成了1111 1111 1111 ，再把1111 1111 1111加1，就得到了1 0000 0000 0000，这就是大于1100 1100 1100的第一个2的幂。 好了，我们现在解释清楚了Step 1和Step 2的代码。就是可以把一个数转化成第一个比他自身大的2的幂。（可以开始佩服Java的工程师们了，使用无符号右移和按位或运算大大提升了效率。） 但是还有一种特殊情况套用以上公式不行，这些数字就是2的幂自身。如果数字4 套用公式的话。得到的会是 8 ： Step 1: 0100 &gt;&gt;&gt;1 = 0010 0100 | 0010 = 0110 0110 &gt;&gt;&gt;1 = 0011 0110 | 0011 = 0111 Step 2: 0111 + 0001 = 1000 为了解决这个问题，JDK的工程师把所有用户传进来的数在进行计算之前先-1，就是源码中的第一行： int n = cap - 1; 至此，再来回过头看看这个设置初始容量的代码，目的是不是一目了然了： int n = cap - 1;n |= n &gt;&gt;&gt; 1;n |= n &gt;&gt;&gt; 2;n |= n &gt;&gt;&gt; 4;n |= n &gt;&gt;&gt; 8;n |= n &gt;&gt;&gt; 16;return (n &lt; 0) ?1 :(n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; HashMap初始容量的合理值 当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。 那么，是不是我们只需要把已知的HashMap中即将存放的元素个数直接传给initialCapacity就可以了呢？ 关于这个值的设置，在《阿里巴巴Java开发手册》有以下建议： 这个值，并不是阿里巴巴的工程师原创的，在guava（21.0版本）中也使用的是这个值。 public static &lt;K, V&gt; HashMap&lt;K, V&gt; newHashMapWithExpectedSize(int expectedSize) { return new HashMap&lt;K, V&gt;(capacity(expectedSize)); } /*** Returns a capacity that is sufficient to keep the map from being resized as long as it grows no* larger than expectedSize and the load factor is ≥ its default (0.75).*/ static int capacity(int expectedSize) { if (expectedSize &lt; 3) { checkNonnegative(expectedSize, &quot;expectedSize&quot;); return expectedSize + 1; } if (expectedSize &lt; Ints.MAX_POWER_OF_TWO) { // This is the calculation used in JDK8 to resize when a putAll // happens; it seems to be the most conservative calculation we // can make. 0.75 is the default load factor. return (int) ((float) expectedSize / 0.75F + 1.0F); } return Integer.MAX_VALUE; // any large value } 在return (int) ((float) expectedSize / 0.75F + 1.0F);上面有一行注释，说明了这个公式也不是guava原创，参考的是JDK8中putAll方法中的实现的。 感兴趣的读者可以去看下putAll方法的实现，也是以上的这个公式。 虽然，当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。但是这个值并没有参考loadFactor的值。 也就是说，如果我们设置的默认值是7，经过Jdk处理之后，会被设置成8，但是，这个HashMap在元素个数达到 8*0.75 = 6的时候就会进行一次扩容，这明显是我们不希望见到的。 如果我们通过 expectedSize / 0.75F + 1.0F 计算，7/0.75 + 1 = 10 ,10经过Jdk处理之后，会被设置成16，这就大大的减少了扩容的几率。 当HashMap内部维护的哈希表的容量达到75%时（默认情况下），会触发rehash，而rehash的过程是比较耗费时间的。 所以初始化容量要设置成expectedSize/0.75 + 1的话，可以有效的减少冲突也可以减小误差。 所以，我可以认为，当我们明确知道HashMap中元素的个数的时候，把默认容量设置成 expectedSize / 0.75F + 1.0F 是一个在性能上相对好的选择，但是，同时也会牺牲些内存。 总结 当我们想要在代码中创建一个HashMap的时候，如果我们已知这个Map中即将存放的元素个数，给HashMap设置初始容量可以在一定程度上提升效率。 但是，JDK并不会直接拿用户传进来的数字当做默认容量，而是会进行一番运算，最终得到一个2的幂。 原因在《全网把Map中的hash()分析的最透彻的文章，别无二家》介绍过，得到这个数字的算法其实是使用了使用无符号右移和按位或运算来提升效率。 但是，为了最大程度的避免扩容带来的性能消耗，我们建议可以把默认容量的数字设置成expectedSize / 0.75F + 1.0F 。在日常开发中，可以使用 Map&lt;String, String&gt; map = Maps.newHashMapWithExpectedSize(10); 来创建一个HashMap，计算的过程guava会帮我们完成。 但是，以上的操作是一种用内存换性能的做法，真正使用的时候，要考虑到内存的影响。 最后，留一个思考题：为什么JDK 8中，putAll方法采用了这个expectedSize / 0.75F + 1.0F公式，而put、构造函数等并没有默认使用这个公式呢？ 作者简介：Hollis，知名技术博主，个人博客文章阅读量数百万，CSDN博客专家。工作地点杭州，主要从事金融，支付领域的Java开发，热衷于技术分享。 本文转载自Hollis公众号，专注原创技术文章，主要以Java相关技术为主，覆盖基础知识、底层原理、技术成长等话题。 【End】 &nbsp;热 文&nbsp;推 荐&nbsp; ☞刘强东案关键证人曝光；周鸿祎 diss 贾跃亭；苹果回收 100 万部旧手机 | 极客头条 ☞三星折叠屏手机出事！才用两天就“挂了” ☞50 多岁的他笑谈码农真相，看完清醒了！| 人物志 ☞零编程基础、大龄全职妈妈是如何写出两个商业网站的？ ☞下过富士康工厂、做过华为外包，这位程序员是如何花 6 年逆袭成为技术大佬的？ ☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码 ☞微服务落地，我们在考虑什么？| 技术头条 ☞爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪? ☞程序员被骗&quot;黑砖窑&quot;：监禁、恐吓、996无休编程！ System.out.println(&quot;点个在看吧！&quot;);console.log(&quot;点个在看吧！&quot;);print(&quot;点个在看吧！&quot;);printf(&quot;点个在看吧！\\n&quot;);cout&nbsp;&lt;&lt;&nbsp;&quot;点个在看吧！&quot;&nbsp;&lt;&lt;&nbsp;endl;Console.WriteLine(&quot;点个在看吧！&quot;);Response.Write(&quot;点个在看吧！&quot;);alert(&quot;点个在看吧！&quot;)echo &quot;点个在看吧！&quot; 你点的每个“在看”，我都认真当成了喜欢","@type":"BlogPosting","url":"https://mlh.app/2019/04/28/728462.html","headline":"为什么阿里巴巴建议集合初始化时，指定集合容量大小？","dateModified":"2019-04-28T00:00:00+08:00","datePublished":"2019-04-28T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/28/728462.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>为什么阿里巴巴建议集合初始化时，指定集合容量大小？</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(0, 0, 0);letter-spacing: 0.5px;"></span></p> 
<p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><img class="" data-copyright="0" data-ratio="0.15644171779141106" data-src="https://mmbiz.qpic.cn/mmbiz_gif/Pn4Sm0RsAug5zOzy32A3RIVhRwowK5ogg1hJ631uGyu9zOMKfTddDnSrsxicbCQNm59Qeo3lDYCvF70I9ibGvA9g/640?wx_fmt=gif" data-type="gif" data-w="652" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_gif/Pn4Sm0RsAug5zOzy32A3RIVhRwowK5ogg1hJ631uGyu9zOMKfTddDnSrsxicbCQNm59Qeo3lDYCvF70I9ibGvA9g/640?wx_fmt=gif"></p> 
<p style="text-align: center;margin-bottom: 15px;letter-spacing: 1px;line-height: normal;margin-left: 8px;margin-right: 8px;"><img class="" data-copyright="0" data-ratio="0.665625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAujxiccBEpdNHwos6U6AgtKYDHegReM8jlYKEybrG9OG3oZxhPjPEpz4qByiaYvO5CGP83bPeiblg25Iw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAujxiccBEpdNHwos6U6AgtKYDHegReM8jlYKEybrG9OG3oZxhPjPEpz4qByiaYvO5CGP83bPeiblg25Iw/640?wx_fmt=jpeg"></p> 
<p style="text-align: justify;margin-bottom: 15px;letter-spacing: 1px;line-height: normal;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(136, 136, 136);font-size: 14px;">作者 |&nbsp;Hollis</span></p> 
<p style="text-align: justify;margin-bottom: 15px;letter-spacing: 1px;line-height: normal;margin-left: 8px;margin-right: 8px;"><span style="color: rgb(136, 136, 136);font-size: 14px;">本文经授权转载自Hollis（ID：</span><span style="color: rgb(136, 136, 136);font-size: 14px;">hollischuang）</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">关于集合类，《阿里巴巴Java开发手册》中有一个规定：</span></p> 
<p><img class="" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_jpg/6fuT3emWI5Iz6iad1WHu7m1CpofFHXr0FB8giaYRGbCd8YfSjHHCoqadZibgGPs1ItrIg8fpsKyCTKAz2lDHhjILQ/?wx_fmt=jpeg" data-cropx1="56.293577981651374" data-cropx2="1416" data-cropy1="0" data-cropy2="359.4128440366972" data-ratio="0.26328125" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAujxcqKxmqdFOQOrbSCDbu38jXIMiaIMktal6Kj26iczGIH8uEGBD8p3vkicu9QXNjfeicg1TPbQ9NZP6Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style="border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;margin-top: 5px;margin-bottom: 5px;display: block;width: 628px;height: 166px;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAujxcqKxmqdFOQOrbSCDbu38jXIMiaIMktal6Kj26iczGIH8uEGBD8p3vkicu9QXNjfeicg1TPbQ9NZP6Q/640?wx_fmt=jpeg"></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">本文就来分析一下为什么会有如此建议？</span><span style="font-size: 15px;">如果一定要设置初始容量的话，设置多少比较合适？</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LXSAriayI15u06ibNNlXzIcor2tTtgJBKFxkIicJ8tiaRKRaictbrQEssdSg/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LXSAriayI15u06ibNNlXzIcor2tTtgJBKFxkIicJ8tiaRKRaictbrQEssdSg/640?wx_fmt=png"></strong></span></p> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong>为什么要设置初始容量</strong></span><span style="font-size: 15px;"></span><br></p> 
 <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><br></p> 
</section> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">我们先来写一段代码在JDK 1.7 （jdk1.7.0_79）下面来分别测试下，在不指定初始化容量和指定初始化容量的情况下性能情况如何。</span><span style="font-size: 15px;">（jdk 8 结果会有所不同，我会在后面的文章中分析）</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span><span style="letter-spacing: 0.5px;"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">public</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">static</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">void</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> main</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">[]</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> args</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> aHundredMillion </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">10000000</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> map </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">new</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">HashMap</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;&gt;();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">long</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s1 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">currentTimeMillis</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">for</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> aHundredMillion</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">++)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">put</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">long</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s2 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">currentTimeMillis</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">out</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">println</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"未初始化容量，耗时 ："</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">s2 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">-</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">));</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br><br> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> map1 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">new</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">HashMap</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;&gt;(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">aHundredMillion </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">/</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">2</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">long</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s5 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">currentTimeMillis</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">for</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> aHundredMillion</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">++)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> map1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">put</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">long</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s6 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">currentTimeMillis</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">out</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">println</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"初始化容量5000000，耗时 ："</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">s6 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">-</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s5</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">));</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br><br> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> map2 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">new</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">HashMap</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;&gt;(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">aHundredMillion</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">long</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s3 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">currentTimeMillis</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">for</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> aHundredMillion</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">++)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> map2</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">put</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> i</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">long</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s4 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">currentTimeMillis</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br><br> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">out</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">println</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"初始化容量为10000000，耗时 ："</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">s4 </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">-</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> s3</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">));</span></span></code></p>
 <p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span></code></p>
</div> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;">以上代码不难理解，我们创建了3个HashMap，分别使用默认的容量（16）、使用元素个数的一半（5千万）作为初始容量、使用元素个数（一亿）作为初始容量进行初始化。然后分别向其中put一亿个KV。</span></p> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;">输出结果：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">未初始化容量，耗时</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">：</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">14419</span></span></code></p>
 <p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">初始化容量</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">5000000</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">，耗时</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">：</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">11916</span></span></code></p>
 <p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">初始化容量为</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">10000000</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">，耗时</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">：</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">7984</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">从结果中，我们可以知道，在已知HashMap中将要存放的KV个数的时候，设置一个合理的初始化容量可以有效的提高性能。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">当然，以上结论也是有理论支撑的。我们HashMap中傻傻分不清楚的那些概念文章介绍过，HashMap有扩容机制，就是当达到扩容条件时会进行扩容。HashMap的扩容条件就是当HashMap中的元素个数（size）超过临界值（threshold）时就会自动扩容。在HashMap中， threshold = loadFactor * capacity。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">所以，如果我们没有设置初始容量大小，随着元素的不断增加，HashMap会发生多次扩容，而HashMap中的扩容机制决定了每次扩容都需要重建hash表，是非常影响性能的。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">从上面的代码示例中，我们还发现，同样是设置初始化容量，设置的数值不同也会影响性能，那么当我们已知HashMap中即将存放的KV个数的时候，容量设置成多少为好呢？</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LwYnW1VvkaHWiaL6W1Mr1yiaNLQpxwhyqice9F1yJzMHticssPX515qyvog/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LwYnW1VvkaHWiaL6W1Mr1yiaNLQpxwhyqice9F1yJzMHticssPX515qyvog/640?wx_fmt=png"></strong></span></p> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong>HashMap中容量的初始化</strong></span></p> 
 <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><br></p> 
</section> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">默认情况下，当我们设置HashMap的初始化容量时，实际上HashMap会采用第一个大于该数值的2的幂作为初始化容量。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">如以下示例代码：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span><span style="letter-spacing: 0.5px;"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> map </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">new</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">HashMap</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;(</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">put</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"hahaha"</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"hollischuang"</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;color: rgb(166, 226, 46);"><br></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Class</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;?&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> mapType </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">getClass</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">();</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Method</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> capacity </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> mapType</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">getDeclaredMethod</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"capacity"</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>capacity</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">setAccessible</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">true</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">System</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">out</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">println</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"capacity&nbsp;:&nbsp;"</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> capacity</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">invoke</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">));</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">在jdk1.7中，初始化容量设置成1的时候，输出结果是2。</span><span style="font-size: 15px;">在jdk1.8中，如果我们传入的初始化容量为1，实际上设置的结果也为1，上面代码输出结果为2的原因是代码中map.put(“hahaha”, “hollischuang”);导致了扩容，容量从1扩容到2。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">那么，话题再说回来，当我们通过HashMap(int initialCapacity)设置初始容量的时候，HashMap并不一定会直接采用我们传入的数值，而是经过计算，得到一个新值，目的是提高hash的效率。</span><span style="font-size: 15px;">(1-&gt;1、3-&gt;4、7-&gt;8、9-&gt;16)</span></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="" label="powered by 135editor.com" mpa-from-tpl="t"> 
  <section class="" mpa-from-tpl="t"> 
   <section mpa-from-tpl="t"> 
    <p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">在Jdk 1.7和Jdk 1.8中，HashMap初始化这个容量的时机不同。</span><span style="font-size: 15px;">jdk1.8中，在调用HashMap的构造函数定义HashMap的时候，就会进行容量的设定。</span><span style="font-size: 15px;">而在Jdk 1.7中，要等到第一次put操作时才进行这一操作。</span></p> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">不管是Jdk 1.7还是Jdk 1.8，计算初始化容量的算法其实是如出一辙的，主要代码如下：</span><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 0.5px;"></span><br></p> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> cap </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">-</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">2</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">4</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">8</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">16</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br></span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">?</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> MAXIMUM_CAPACITY</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">?</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> MAXIMUM_CAPACITY </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span></span></code></p>
</div> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">上面的代码挺有意思的，一个简单的容量初始化，Java的工程师也有很多考虑在里面。</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">上面的算法目的挺简单，就是：</span><span style="font-size: 15px;">根据用户传入的容量值（代码中的cap），通过计算，得到第一个比他大的2的幂并返回。</span></p> 
<p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">聪明的读者们，如果让你设计这个算法你准备如何计算？</span><span style="font-size: 15px;">如果你想到二进制的话，那就很简单了。</span><span style="font-size: 15px;">举几个例子看一下：</span></p> 
<p><img class="aligncenter size-full wp-image-2449" data-ratio="0.4676470588235294" data-src="https://mmbiz.qpic.cn/mmbiz_png/6fuT3emWI5Iz6iad1WHu7m1CpofFHXr0FI37FDqpK4z5RCPSZufCjOq1icLvUJo0lsEticIjgibhTNFGibKRKebhd7w/640?wx_fmt=png" data-type="png" data-w="680" height="318" sizes="(max-width: 680px) 100vw, 680px" style="border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;margin-right: auto;margin-left: auto;display: block;text-align: center;" width="680" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/6fuT3emWI5Iz6iad1WHu7m1CpofFHXr0FI37FDqpK4z5RCPSZufCjOq1icLvUJo0lsEticIjgibhTNFGibKRKebhd7w/640?wx_fmt=png"></p> 
<p style="margin: 15px 8px;line-height: 1.75em;letter-spacing: 1px;"><span style="font-size: 15px;">请关注上面的几个例子中，蓝色字体部分的变化情况，或许你会发现些规律。</span><span style="font-size: 15px;">5-&gt;8、9-&gt;16、19-&gt;32、37-&gt;64都是主要经过了两个阶段。</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <section class="" label="powered by 135editor.com" style="white-space: normal;max-width: 100%;font-family: 微软雅黑;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;" mpa-from-tpl="t"> 
  <section class="" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;" mpa-from-tpl="t"> 
   <section style="padding: 10px;max-width: 100%;border-width: 1px;border-style: solid;border-color: rgb(240, 242, 246);font-family: inherit;text-decoration: inherit;background-color: rgb(240, 242, 246);box-sizing: border-box !important;word-wrap: break-word !important;" mpa-from-tpl="t"> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 1，5-&gt;7</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 2，7-&gt;8</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;"><br></span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 1，9-&gt;15</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 2，15-&gt;16</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;"><br></span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 1，19-&gt;31</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 2，31-&gt;32</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;"><br></span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 1，37-&gt;63</span></p> 
    <p style="margin: 5px 8px 15px;color: rgb(62, 62, 62);max-width: 100%;min-height: 1em;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color: rgb(136, 136, 136);font-family: inherit;font-size: 14px;text-decoration: inherit;">Step 2，63-&gt;65</span></p> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">对应到以上代码中，Step 1：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span><span style="letter-spacing: 0.5px;"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">2</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">4</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">8</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">16</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">对应到以上代码中，Step2：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">?</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> MAXIMUM_CAPACITY</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">?</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> MAXIMUM_CAPACITY </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+ </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">Step 2 比较简单，就是做一下极限值的判断，然后把Step 1得到的数值+1。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">Step 1 怎么理解呢？</span><span style="font-size: 15px;">其实是对一个二进制数依次向右移位，然后与原值取或。</span><span style="font-size: 15px;">其目的对于一个数字的二进制，从第一个不为0的位开始，把后面的所有位都设置成1。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">随便拿一个二进制数，套一遍上面的公式就发现其目的了：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">2</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0011</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1011</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1011</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0011</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1011</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1011</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">4</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1111</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">通过几次无符号右移和按位或运算，我们把1100 1100 1100转换成了1111 1111 1111 ，再把1111 1111 1111加1，就得到了1 0000 0000 0000，这就是大于1100 1100 1100的第一个2的幂。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">好了，我们现在解释清楚了Step 1和Step 2的代码。</span><span style="font-size: 15px;">就是可以把一个数转化成第一个比他自身大的2的幂。</span><span style="font-size: 15px;">（可以开始佩服Java的工程师们了，使用无符号右移和按位或运算大大提升了效率。</span><span style="font-size: 15px;">）</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">但是还有一种特殊情况套用以上公式不行，这些数字就是2的幂自身。</span><span style="font-size: 15px;">如果数字4 套用公式的话。</span><span style="font-size: 15px;">得到的会是 8 ：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Step</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> <br></span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0010</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0100</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0010</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0011</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0110</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0011</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0111</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Step</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">2</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);"></span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0111</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0001</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1000</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">为了解决这个问题，JDK的工程师把所有用户传进来的数在进行计算之前先-1，就是源码中的第一行：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> cap </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">-</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span></span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">至此，再来回过头看看这个设置初始容量的代码，目的是不是一目了然了：</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> cap </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">-</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">2</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">4</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">8</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br>n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">|=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;&gt;&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">16</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br></span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">?</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> MAXIMUM_CAPACITY</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">?</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> MAXIMUM_CAPACITY </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">:</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> n </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span></span></code></p>
</div> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><br></p> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4Lb4ybNEVGnaAvEDwENKzW27LUKFDGZPKcBneWwTaTpaJyG2C3em7libQ/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4Lb4ybNEVGnaAvEDwENKzW27LUKFDGZPKcBneWwTaTpaJyG2C3em7libQ/640?wx_fmt=png"></strong></span></p> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong>HashMap初始容量的合理值</strong></span><br></p> 
 <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;"><br></p> 
</section> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">那么，是不是我们只需要把已知的HashMap中即将存放的元素个数直接传给initialCapacity就可以了呢？</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">关于这个值的设置，在《阿里巴巴Java开发手册》有以下建议：</span></p> 
<p><img class="aligncenter size-full wp-image-2440" data-ratio="0.08666666666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/6fuT3emWI5Iz6iad1WHu7m1CpofFHXr0FT82UrahGmuNZWvvqyVDPDDq4YjwuXOA95uQ6eyeOtjEjiaGn7Y5SuLA/640?wx_fmt=png" data-type="png" data-w="900" height="78" sizes="(max-width: 900px) 100vw, 900px" style="border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;margin-right: auto;margin-left: auto;display: block;text-align: center;" width="900" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/6fuT3emWI5Iz6iad1WHu7m1CpofFHXr0FT82UrahGmuNZWvvqyVDPDDq4YjwuXOA95uQ6eyeOtjEjiaGn7Y5SuLA/640?wx_fmt=png"></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">这个值，并不是阿里巴巴的工程师原创的，在guava（21.0版本）中也使用的是这个值。</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">public</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">static</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">K</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> V</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">HashMap</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">K</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> V</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> newHashMapWithExpectedSize</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> expectedSize</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">new</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">HashMap</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">K</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> V</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">capacity</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">expectedSize</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">));</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;color: rgb(147, 161, 161);">/**<br>* Returns a capacity that is sufficient to keep the map from being resized as long as it grows no<br>* larger than expectedSize and the load factor is ≥ its default (0.75).<br>*/</span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">static</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> capacity</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> expectedSize</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">if</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">expectedSize </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">3</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> checkNonnegative</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">expectedSize</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="str" style="letter-spacing: 0.5px;color: rgb(230, 219, 116);">"expectedSize"</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> expectedSize </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">if</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">expectedSize </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Ints</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">MAX_POWER_OF_TWO</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">{</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="com" style="letter-spacing: 0.5px;color: rgb(147, 161, 161);">// This is the calculation used in JDK8 to resize when a putAll</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="com" style="letter-spacing: 0.5px;color: rgb(147, 161, 161);">// happens; it seems to be the most conservative calculation we</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="com" style="letter-spacing: 0.5px;color: rgb(147, 161, 161);">// can make. 0.75 is the default load factor.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">int</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">((</span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">float</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">)</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> expectedSize </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">/</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">0.75F</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">+</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">1.0F</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"><br> </span><span class="kwd" style="letter-spacing: 0.5px;color: rgb(249, 38, 89);">return</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Integer</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">MAX_VALUE</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="com" style="letter-spacing: 0.5px;color: rgb(147, 161, 161);">// any large value</span></span></code></p>
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">}</span></code></p>
</div> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">在return (int) ((float) expectedSize / 0.75F + 1.0F);上面有一行注释，说明了这个公式也不是guava原创，参考的是JDK8中putAll方法中的实现的。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">感兴趣的读者可以去看下putAll方法的实现，也是以上的这个公式。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">虽然，当我们使用 HashMap(int initialCapacity) 来初始化容量的时候，jdk会默认帮我们计算一个相对合理的值当做初始容量。但是这个值并没有参考loadFactor的值。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">也就是说，如果我们设置的默认值是7，经过Jdk处理之后，会被设置成8，但是，这个HashMap在元素个数达到 8*0.75 = 6的时候就会进行一次扩容，这明显是我们不希望见到的。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">如果我们通过 expectedSize / 0.75F + 1.0F 计算，7/0.75 + 1 = 10 ,10经过Jdk处理之后，会被设置成16，这就大大的减少了扩容的几率。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">当HashMap内部维护的哈希表的容量达到75%时（默认情况下），会触发rehash，而rehash的过程是比较耗费时间的。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">所以初始化容量要设置成expectedSize/0.75 + 1的话，可以有效的减少冲突也可以减小误差。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">所以，我可以认为，当我们明确知道HashMap中元素的个数的时候，把默认容量设置成 expectedSize / 0.75F + 1.0F 是一个在性能上相对好的选择，但是，同时也会牺牲些内存。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;"><br></span></p> 
<section class="mpa-template" mpa-from-tpl="t"> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong><img class="rich_pages" data-copyright="0" data-ratio="0.1625" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LLqyf6BY4rMfY2LsU81MibFjicKDLjMjib5R23h8uo6GtGDY8OufWJfpEw/640?wx_fmt=png" data-type="png" data-w="160" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhSvZMAt2zKcxGQN3l1NV4LLqyf6BY4rMfY2LsU81MibFjicKDLjMjib5R23h8uo6GtGDY8OufWJfpEw/640?wx_fmt=png"></strong></span></p> 
 <p style="text-align: center;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 18px;"><strong>总结</strong></span><span style="font-size: 15px;"></span><br></p> 
 <p style="margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;"><br></p> 
</section> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">当我们想要在代码中创建一个HashMap的时候，如果我们已知这个Map中即将存放的元素个数，给HashMap设置初始容量可以在一定程度上提升效率。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">但是，JDK并不会直接拿用户传进来的数字当做默认容量，而是会进行一番运算，最终得到一个2的幂。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">原因在《全网把Map中的hash()分析的最透彻的文章，别无二家》介绍过，得到这个数字的算法其实是使用了使用无符号右移和按位或运算来提升效率。</span></p> 
<p style="text-align: justify;margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;">但是，为了最大程度的避免扩容带来的性能消耗，我们建议可以把默认容量的数字设置成expectedSize / 0.75F + 1.0F 。在日常开发中，可以使用</span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;"></span><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);"></span></p> 
<div class="prettyprint prettyprinted" style="overflow: auto;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12px;line-height: 20px;margin-top: 20px;margin-bottom: 20px;color: rgb(248, 248, 212);word-break: break-all;background: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;max-height: 637px;">
 <p style="margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><code style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size: inherit;color: inherit;background-color: transparent;border-radius: 0px;white-space: pre-wrap;"><span style="letter-spacing: 0.5px;"><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Map</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&lt;</span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">,</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">String</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">&gt;</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> map </span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">=</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);"> </span><span class="typ" style="letter-spacing: 0.5px;color: rgb(166, 226, 46);">Maps</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">.</span><span class="pln" style="letter-spacing: 0.5px;color: rgb(102, 217, 239);">newHashMapWithExpectedSize</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">(</span><span class="lit" style="letter-spacing: 0.5px;color: rgb(174, 129, 255);">10</span><span class="pun" style="letter-spacing: 0.5px;color: rgb(248, 248, 242);">);</span></span></code></p>
</div> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;">来创建一个HashMap，计算的过程guava会帮我们完成。</span></p> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;">但是，以上的操作是一种用内存换性能的做法，真正使用的时候，要考虑到内存的影响。</span></p> 
<p style="color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 15px;line-height: 1.75em;letter-spacing: 1px;margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: 0.5px;color: rgb(0, 0, 0);font-size: 15px;">最后，留一个思考题：为什么JDK 8中，putAll方法采用了这个expectedSize / 0.75F + 1.0F公式，而put、构造函数等并没有默认使用这个公式呢？</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgba(0, 0, 0, 0.5);font-size: 15px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);box-sizing: border-box !important;overflow-wrap: break-word !important;">作者简介：Hollis，知名技术博主，个人博客文章阅读量数百万，CSDN博客专家。工作地点杭州，主要从事金融，支付领域的Java开发，热衷于技术分享。</span></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgba(0, 0, 0, 0.5);font-size: 15px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);box-sizing: border-box !important;overflow-wrap: break-word !important;">本文转载自Hollis公众号，专注原创技术文章，主要以Java相关技术为主，覆盖基础知识、底层原理、技术成长等话题。</span></p> 
<p style="margin: 15px 8px;white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 14px;color: rgb(136, 136, 136);box-sizing: border-box !important;overflow-wrap: break-word !important;">【End】</span></p> 
<p style="text-align: center;margin-left: 8px;margin-right: 8px;margin-bottom: 15px;line-height: 1.75em;"><img class="rich_pages" data-copyright="0" data-ratio="0.5482233502538071" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuhUdTAica5phfXw2KUETyn15MGYmQXmhb4kEShy4eGI6ag9vWpO2xYcFdPuTBI79Y2LgulsMgfPBRw/640?wx_fmt=jpeg" data-type="jpeg" data-w="591" style="" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_jpg/Pn4Sm0RsAuhUdTAica5phfXw2KUETyn15MGYmQXmhb4kEShy4eGI6ag9vWpO2xYcFdPuTBI79Y2LgulsMgfPBRw/640?wx_fmt=jpeg"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 255, 255);background-color: rgb(60, 142, 216);font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;热 文</strong>&nbsp;推 荐&nbsp;</strong></span><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718575&amp;idx=1&amp;sn=a7ba4cec0eb33f67c315d3f965a5d2a7&amp;chksm=bea6b0bc89d139aa44af0a702f3da5b2a131054c3b6fac82e5155217efcb85bad4695261d13c&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞刘强东案关键证人曝光；周鸿祎 diss 贾跃亭；苹果回收 100 万部旧手机 | 极客头条</span></a><br></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718560&amp;idx=1&amp;sn=e015801fe23708e1e2c41d6f754af8b5&amp;chksm=bea6b0b389d139a59b232280e3dd8c4f5d714d65318f7de5ccc0d8c7b91fa49cd3e6beb2d21c&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞三星折叠屏手机出事！才用两天就“挂了”</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650718551&amp;idx=1&amp;sn=ed82b331f64af29cdcec6ee2596c1f7e&amp;chksm=bea6b08489d13992d2035a5c3a4b01f5121cbcf1d20a9a54e498841b70a26351a37c5be2c49d&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;">☞</span><span style="font-size: 14px;color: rgb(0, 82, 255);">50 多岁的他笑谈码农真相，看完清醒了！| 人物志</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=Mzg3MDA4NDkxMQ==&amp;mid=2247483866&amp;idx=1&amp;sn=c61e53808100986007f9798ef29e4960&amp;chksm=ce92799af9e5f08c0b4a77d1a5f522627da14e8cb5c46f83ef4afa45a102ba517daee8bc1453&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞零编程基础、大龄全职妈妈是如何写出两个商业网站的？</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA5MzY4NTQwMA==&amp;mid=2651010298&amp;idx=1&amp;sn=655f418a8e1ac2feaf9f52f655c3d7f2&amp;chksm=8bad870dbcda0e1bb2dca72f09be158651d9de5bd9f97ce686166072bf661f18481083a694c1&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="11" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞下过富士康工厂、做过华为外包，这位程序员是如何花 6 年逆袭成为技术大佬的？</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI0ODcxODk5OA==&amp;mid=2247504463&amp;idx=1&amp;sn=ef40cf8abd754de861823a3943b689c7&amp;chksm=e99ee1b6dee968a0788a7909be5f313e039871fe56132266740d9f61e6fb19d9c0d8c093bebe&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞《权力的游戏》最终季上线！谁是你最喜爱的演员？这里有一份Python教程 | 附源码</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA3MjY1MTQwNQ==&amp;mid=2649827209&amp;idx=1&amp;sn=c7dd99053f8bb7091c3dc87943a0751a&amp;chksm=871e806bb069097d06406a39b33820c8b4b075b6a56199aa139a1ae58daaa8a079fce80fcc85&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞微服务落地，我们在考虑什么？| 技术头条</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzU2MTE1NDk2Mg==&amp;mid=2247494442&amp;idx=1&amp;sn=76439d40b659cfae06572333232cbbe7&amp;chksm=fc7fb5d7cb083cc1331fa903b5ce0737714628bb0b8ae3a28c509b4a8fcea6512a08c8dc258f&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);color: rgb(0, 82, 255);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">☞爆料! 18张图、55个链接, 证据都在这了, 你还说自己是中本聪?</span></a></p> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;background-color: rgb(255, 255, 255);line-height: normal;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzA5MjcxNjc2Ng==&amp;mid=2650559766&amp;idx=1&amp;sn=fb6e44a97e108113a772c6c2bba25289&amp;chksm=88601ea7bf1797b117aa0625a3efa316fa660eb90654a96013c14a03c4eb3a71bb75b6bab646&amp;scene=21#wechat_redirect" target="_blank" data-itemshowtype="0" data-linktype="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);font-size: 14px;color: rgb(0, 82, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;">☞程序员被骗"黑砖窑"：监禁、恐吓、996无休编程！</span></a></p> 
<section style="white-space: normal;max-width: 100%;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
 <section class="" style="max-width: 100%;font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
  <pre style="max-width: 100%;font-size: inherit;color: inherit;line-height: inherit;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;padding: 0.5em;max-width: 100%;min-height: 1em;font-size: 14px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;background: rgb(34, 34, 34);color: rgb(170, 170, 170);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;">System.out.println(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个在看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">console.log(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(50, 170, 238);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">print</span>(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(50, 170, 238);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">printf</span>(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！\n"</span>);<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">cout&nbsp;&lt;&lt;&nbsp;<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span>&nbsp;&lt;&lt;&nbsp;endl;<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">Console.WriteLine(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">Response.Write(<span class="" style="max-width: 100%;font-size: inherit;line-height: inherit;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span>);<br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">alert(</span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: break-word !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">)</span><br style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span class="" style="max-width: 100%;font-size: inherit;font-variant-numeric: normal;line-height: inherit;widows: 1;color: rgb(50, 170, 238);box-sizing: border-box !important;overflow-wrap: inherit !important;word-break: inherit !important;">echo </span><span style="max-width: 100%;font-variant-numeric: normal;line-height: 24.5px;widows: 1;color: rgb(255, 204, 51);box-sizing: border-box !important;overflow-wrap: break-word !important;">"点个<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>看吧！"</span></p></pre> 
 </section> 
</section> 
<section class="" data-tools="135编辑器" data-id="94250" style="white-space: normal;max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"> 
 <section class="" data-tools="135编辑器" data-id="91842" style="max-width: 100%;box-sizing: border-box;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"> 
  <section style="max-width: 100%;text-align: right;width: auto;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
   <section style="max-width: 100%;display: inline-block;clear: both;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
    <section class="" data-brushtype="text" style="padding: 18px 15px 20px 10px;max-width: 100%;box-sizing: border-box;color: rgb(86, 146, 214);background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdy66AHd7QqL7A2s5icSBE0aw4iaKOKPnXGYxQPhG7VMpbbYV6VJprSh7w/640?wx_fmt=png&quot;);background-repeat: no-repeat;text-align: center;background-size: 100% 100%;font-size: 16px;letter-spacing: 1.5px;overflow-wrap: break-word !important;"> 
     <section style="max-width: 100%;display: flex;justify-content: center;align-items: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
      <section style="margin-left: 2px;max-width: 100%;width: 20px;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
       <img class="" data-ratio="0.8936170212765957" data-src="https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdvAd0o9e1LlUGA2k0Yib222agOxzweXhahA9GuzJcGBg0dA4DzlibxRqw/640?wx_fmt=png" data-type="png" data-w="47" style="margin-bottom: -6px;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible !important;width: 20px !important;" src="https://uzshare.com/_p?https://mmbiz.qpic.cn/mmbiz_png/Pn4Sm0RsAuhpplm16ibb8iaib7RoGQ5iaHEdvAd0o9e1LlUGA2k0Yib222agOxzweXhahA9GuzJcGBg0dA4DzlibxRqw/640?wx_fmt=png"> 
      </section> 
      <section class="" data-brushtype="text" style="max-width: 100%;font-size: 14px;color: rgb(51, 51, 51);box-sizing: border-box !important;overflow-wrap: break-word !important;"> 
       <span style="max-width: 100%;font-family: 楷体, 楷体_GB2312, SimKai;box-sizing: border-box !important;overflow-wrap: break-word !important;">你点的每个“在看”，我都认真当成了喜欢</span> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-right: 8px;margin-bottom: 15px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgba(0, 0, 0, 0.5);font-size: 15px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></p>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

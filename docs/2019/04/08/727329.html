<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>R语言 线性混合效应模型实战案例 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="R语言 线性混合效应模型实战案例" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。咨询链接：http://y0.cn/teradat 博文链接： https://blog.csdn.net/qq_19600291/article/details/89093936 &nbsp; 介绍 处理分组数据和复杂层次结构的分析师，从嵌入在参与者中的测量，嵌套在州内的县或嵌套在教室内的学生，经常发现他们需要建模工具来反映他们数据的这种结构。在R中，有两种主要的方法来拟合多级模型，这些模型考虑了数据中的这种结构。这些教程将向用户展示如何使用lme4R中的包来拟合线性和非线性混合效果模型，以及如何使用rstan以完全适合贝叶斯多级模型。这里的重点是如何使模型适合R而不是模型背后的理论。有关多级建模的背景知识，请参阅参考资料。&nbsp; 本教程将介绍如何lme4&nbsp; 设置和运行一些基本模型，其中包括： 在R中构造变化的截距，变化的斜率以及变化的斜率和截距模型 从混合效应模型中生成预测和解释参数 广义和非线性多层次模型 完全贝叶斯多级模型适合rstan或其他MCMC方法 设置 环境 在R中开始多级建模很简单。lme4是在R中实现多级模型的规范包，尽管有许多包依赖并增强其功能集，包括贝叶斯扩展。lme4&nbsp;最近已被重写以提高速度并整合C ++代码库，因此封装的功能有些不断变化。&nbsp; 要安装lme4，我们只需运行： # Main version install.packages(&quot;lme4&quot;) # Or to install the dev version library(devtools) install_github(&quot;lme4&quot;, user = &quot;lme4&quot;) 读入数据 多级模型适用于特定类型的数据结构，其中单元嵌套在组内（通常为5个以上组），并且我们希望对数据的组结构进行建模。对于我们的介绍性示例，我们将从lme4文档中的一个简单示例开始，并解释模型正在执行的操作。&nbsp; library(lme4) # load library library(arm) # convenience functions for regression in R # summary(lmm.data) head(lmm.data) ## id extro open agree social class school ## 1 1 63.69 43.43 38.03 75.06 d IV ## 2 2 69.48 46.87 31.49 98.13 a VI ## 3 3 79.74 32.27 40.21 116.34 d VI ## 4 4 62.97 44.41 30.51 90.47 c IV ## 5 5 64.25 36.86 37.44 98.52 d IV ## 6 6 50.97 46.26 38.83 75.22 d I &nbsp;模型 让我们首先拟合一个简单的OLS回归 。&nbsp; OLSexamp &lt;- lm(extro ~ open + agree + social, data = lmm.data) display(OLSexamp) ## lm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual sd = 9.34, R-Squared = 0.00 &nbsp;R模型接口非常简单，首先指定因变量，然后是&nbsp;~符号。右手边，预测变量，每个都被命名。加法符号表明这些被建模为加性效应。最后，我们指定要计算模型的数据帧。这里我们使用该lm函数执行OLS回归，但R中还有许多其他选项。 如果我们想要提取诸如AIC之类的度量 。 MLexamp &lt;- glm(extro ~ open + agree + social, data = lmm.data) display(MLexamp) ## glm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual deviance = 104378.2, null deviance = 104432.7 (difference = 54.5) ## overdispersion parameter = 87.3 ## residual sd is sqrt(overdispersion) = 9.34 AIC(MLexamp) ## [1] 8774 这导致模型拟合较差。现在让我们看一个简单的变化 模型。 适合不同的 模型 根据学科规范，我们的下一步可能是使用分组变量（如学校或班级）来拟合不同的 模型。&nbsp; MLexamp.2 &lt;- glm(extro ~ open + agree + social + class, data = lmm.data) display(MLexamp.2) ## glm(formula = extro ~ open + agree + social + class, data = lmm.data) ## coef.est coef.se ## (Intercept) 56.05 3.09 ## open 0.03 0.05 ## agree -0.01 0.05 ## social 0.01 0.02 ## classb 2.06 0.75 ## classc 3.70 0.75 ## classd 5.67 0.75 ## --- ## n = 1200, k = 7 ## residual deviance = 99187.7, null deviance = 104432.7 (difference = 5245.0) ## overdispersion parameter = 83.1 ## residual sd is sqrt(overdispersion) = 9.12 AIC(MLexamp.2) ## [1] 8719 anova(MLexamp, MLexamp.2, test = &quot;F&quot;) ## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + class ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1193 99188 3 5190 20.8 3.8e-13 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 这通常被称为固定效应规范。&nbsp; MLexamp.3 &lt;- glm(extro ~ open + agree + social + school, data = lmm.data) display(MLexamp.3) ## glm(formula = extro ~ open + agree + social + school, data = lmm.data) ## coef.est coef.se ## (Intercept) 45.02 0.92 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## schoolII 7.91 0.27 ## schoolIII 12.12 0.27 ## schoolIV 16.06 0.27 ## schoolV 20.43 0.27 ## schoolVI 28.05 0.27 ## --- ## n = 1200, k = 9 ## residual deviance = 8496.2, null deviance = 104432.7 (difference = 95936.5) ## overdispersion parameter = 7.1 ## residual sd is sqrt(overdispersion) = 2.67 AIC(MLexamp.3) ## [1] 5774 anova(MLexamp, MLexamp.3, test = &quot;F&quot;) ## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + school ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1191 8496 5 95882 2688 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 学校效果大大提高了我们的模型拟合度。但是，我们如何解释这些影响呢？ table(lmm.data$school, lmm.data$class) ## ## a b c d ## I 50 50 50 50 ## II 50 50 50 50 ## III 50 50 50 50 ## IV 50 50 50 50 ## V 50 50 50 50 ## VI 50 50 50 50 在这里，我们可以看到我们有一个完美平衡的设计，在课堂和学校的每个组合中有50个观察结果（ 。 让我们尝试对这些独特的细胞进行建模。&nbsp; MLexamp.4 &lt;- glm(extro ~ open + agree + social + school:class, data = lmm.data) display(MLexamp.4) ## glm(formula = extro ~ open + agree + social + school:class, data = lmm.data) ## coef.est coef.se ## (Intercept) 80.36 0.37 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI:classa -40.39 0.20 ## schoolII:classa -28.15 0.20 ## schoolIII:classa -23.58 0.20 ## schoolIV:classa -19.76 0.20 ## schoolV:classa -15.50 0.20 ## schoolVI:classa -10.46 0.20 ## schoolI:classb -34.60 0.20 ## schoolII:classb -26.76 0.20 ## schoolIII:classb -22.59 0.20 ## schoolIV:classb -18.71 0.20 ## schoolV:classb -14.31 0.20 ## schoolVI:classb -8.54 0.20 ## schoolI:classc -31.86 0.20 ## schoolII:classc -25.64 0.20 ## schoolIII:classc -21.58 0.20 ## schoolIV:classc -17.58 0.20 ## schoolV:classc -13.38 0.20 ## schoolVI:classc -5.58 0.20 ## schoolI:classd -30.00 0.20 ## schoolII:classd -24.57 0.20 ## schoolIII:classd -20.64 0.20 ## schoolIV:classd -16.60 0.20 ## schoolV:classd -12.04 0.20 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 104432.7 (difference = 103296.8) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 AIC(MLexamp.4) ## [1] 3396 这非常有用，但如果我们想了解学校的影响和课堂的影响，以及学校和班级的影响，该怎么办？&nbsp; MLexamp.5 &lt;- glm(extro ~ open + agree + social + school * class - 1, data = lmm.data) display(MLexamp.5) ## glm(formula = extro ~ open + agree + social + school * class - ## 1, data = lmm.data) ## coef.est coef.se ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI 39.96 0.36 ## schoolII 52.21 0.36 ## schoolIII 56.78 0.36 ## schoolIV 60.60 0.36 ## schoolV 64.86 0.36 ## schoolVI 69.90 0.36 ## classb 5.79 0.20 ## classc 8.53 0.20 ## classd 10.39 0.20 ## schoolII:classb -4.40 0.28 ## schoolIII:classb -4.80 0.28 ## schoolIV:classb -4.74 0.28 ## schoolV:classb -4.60 0.28 ## schoolVI:classb -3.87 0.28 ## schoolII:classc -6.02 0.28 ## schoolIII:classc -6.54 0.28 ## schoolIV:classc -6.36 0.28 ## schoolV:classc -6.41 0.28 ## schoolVI:classc -3.65 0.28 ## schoolII:classd -6.81 0.28 ## schoolIII:classd -7.45 0.28 ## schoolIV:classd -7.24 0.28 ## schoolV:classd -6.93 0.28 ## schoolVI:classd 0.06 0.28 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 4463029.9 (difference = 4461894.0) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 AIC(MLexamp.5) ## [1] 3396 探索随机斜率 另一种选择是为每个学校和班级组合安装一个单独的模型。如果我们认为我们的变量之间的关系可能高度依赖于学校和班级组合，我们可以简单地拟合一系列模型并探索它们之间的参数变化： require(plyr) display(modellist[[1]]) ## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 35.87 5.90 ## open 0.05 0.09 ## agree 0.02 0.10 ## social 0.01 0.03 ## --- ## n = 50, k = 4 ## residual deviance = 500.2, null deviance = 506.2 (difference = 5.9) ## overdispersion parameter = 10.9 ## residual sd is sqrt(overdispersion) = 3.30 display(modellist[[2]]) ## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 47.96 2.16 ## open -0.01 0.03 ## agree -0.03 0.03 ## social -0.01 0.01 ## --- ## n = 50, k = 4 ## residual deviance = 47.9, null deviance = 49.1 (difference = 1.2) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 1.02 我们将在未来的教程中更深入地讨论此策略，包括如何在此命令中生成的模型列表中进行性能推断。 使用lmer安装不同的斜率模型 输入lme4。虽然上述所有技术都是解决这一问题的有效方法，但当我们明确感兴趣的是群体之间的变化时，它们并不一定是最好的方法。这是混合效果建模框架有用的地方。现在我们使用lmer具有熟悉的公式接口的函数，但现在使用特殊语法指定组级变量：(1|school)&nbsp;tell&nbsp;使用变量lmer拟合具有变量截距组效果的线性模型school。 display(MLexamp.6) ## lmer(formula = extro ~ open + agree + social + (1 | school), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 59.12 4.10 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## Residual 2.67 ## --- ## number of obs: 1200, groups: school, 6 ## AIC = 5836.1, DIC = 5789 ## deviance = 5806.5 我们可以使用多个组效果术语来适应多个组效果。 display(MLexamp.7) ## lmer(formula = extro ~ open + agree + social + (1 | school) + ## (1 | class), data = lmm.data) ## coef.est coef.se ## (Intercept) 60.20 4.21 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## class (Intercept) 2.41 ## Residual 1.67 ## --- ## number of obs: 1200, groups: school, 6; class, 4 ## AIC = 4737.9, DIC = 4683 ## deviance = 4703.6 最后，我们可以通过以下语法拟合嵌套的组效果术语： display(MLexamp.8) ## lmer(formula = extro ~ open + agree + social + (1 | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.24 4.01 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## class:school (Intercept) 2.86 ## school (Intercept) 9.69 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3568.6, DIC = 3508 ## deviance = 3531.1 在这里(1|school/class)，我们想要为1|学校和学校内嵌的课程设置不同截取的混合效应术语。 用lmer拟合变化的斜率模型 但是，如果我们想要探索不同学生水平指标的影响，因为它们因教室而异。我们可以适应不同的坡度模型，而不是按学校（或学校/班级）拟合独特的模型。在这里，我们修改我们的随机效应项，以在分组术语之前包含变量：(1 + open|school/class)告诉R适合变化的斜率和不同的学校和学校类别的拦截模型，并允许open变量的斜率因学校而异。 display(MLexamp.9) ## lmer(formula = extro ~ open + agree + social + (1 + open | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.26 3.93 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. Corr ## class:school (Intercept) 2.62 ## open 0.01 1.00 ## school (Intercept) 9.51 ## open 0.00 1.00 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3574.7, DIC = 3506 ## deviance = 3529.3 结论 在R语言和生态系统中，拟合混合效应模型和探索组级变异非常容易。在以后的教程中，我们将探索跨模型的比较，使用混合效果模型进行推理，以及创建混合效果模型的图形表示以了解它们的效果。 附录 ## R version 3.0.1 (2013-05-16) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] plyr_1.8 arm_1.6-10 MASS_7.3-29 lme4_1.0-5 ## [5] Matrix_1.1-0 lattice_0.20-24 knitr_1.5 ## ## loaded via a namespace (and not attached): ## [1] abind_1.4-0 coda_0.16-1 evaluate_0.5.1 formatR_0.10 ## [5] grid_3.0.1 minqa_1.2.1 nlme_3.1-113 splines_3.0.1 ## [9] stringr_0.6.2 tools_3.0.1 &nbsp; &nbsp; 还有问题吗？联系我们！ &nbsp; 大数据部落 -中国专业的第三方数据服务提供商，提供定制化的一站式数据挖掘和统计分析咨询服务 统计分析和数据挖掘咨询服务：y0.cn/teradat（咨询服务请联系官网客服） QQ：3025393450 【服务场景】&nbsp;&nbsp; 科研项目; 公司项目外包;线上线下一对一培训;数据采集;学术研究;报告撰写;市场调查。 【大数据部落】提供定制化的一站式数据挖掘和统计分析咨询服务" />
<meta property="og:description" content="版权声明：本文为博主原创文章，未经博主允许不得转载。咨询链接：http://y0.cn/teradat 博文链接： https://blog.csdn.net/qq_19600291/article/details/89093936 &nbsp; 介绍 处理分组数据和复杂层次结构的分析师，从嵌入在参与者中的测量，嵌套在州内的县或嵌套在教室内的学生，经常发现他们需要建模工具来反映他们数据的这种结构。在R中，有两种主要的方法来拟合多级模型，这些模型考虑了数据中的这种结构。这些教程将向用户展示如何使用lme4R中的包来拟合线性和非线性混合效果模型，以及如何使用rstan以完全适合贝叶斯多级模型。这里的重点是如何使模型适合R而不是模型背后的理论。有关多级建模的背景知识，请参阅参考资料。&nbsp; 本教程将介绍如何lme4&nbsp; 设置和运行一些基本模型，其中包括： 在R中构造变化的截距，变化的斜率以及变化的斜率和截距模型 从混合效应模型中生成预测和解释参数 广义和非线性多层次模型 完全贝叶斯多级模型适合rstan或其他MCMC方法 设置 环境 在R中开始多级建模很简单。lme4是在R中实现多级模型的规范包，尽管有许多包依赖并增强其功能集，包括贝叶斯扩展。lme4&nbsp;最近已被重写以提高速度并整合C ++代码库，因此封装的功能有些不断变化。&nbsp; 要安装lme4，我们只需运行： # Main version install.packages(&quot;lme4&quot;) # Or to install the dev version library(devtools) install_github(&quot;lme4&quot;, user = &quot;lme4&quot;) 读入数据 多级模型适用于特定类型的数据结构，其中单元嵌套在组内（通常为5个以上组），并且我们希望对数据的组结构进行建模。对于我们的介绍性示例，我们将从lme4文档中的一个简单示例开始，并解释模型正在执行的操作。&nbsp; library(lme4) # load library library(arm) # convenience functions for regression in R # summary(lmm.data) head(lmm.data) ## id extro open agree social class school ## 1 1 63.69 43.43 38.03 75.06 d IV ## 2 2 69.48 46.87 31.49 98.13 a VI ## 3 3 79.74 32.27 40.21 116.34 d VI ## 4 4 62.97 44.41 30.51 90.47 c IV ## 5 5 64.25 36.86 37.44 98.52 d IV ## 6 6 50.97 46.26 38.83 75.22 d I &nbsp;模型 让我们首先拟合一个简单的OLS回归 。&nbsp; OLSexamp &lt;- lm(extro ~ open + agree + social, data = lmm.data) display(OLSexamp) ## lm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual sd = 9.34, R-Squared = 0.00 &nbsp;R模型接口非常简单，首先指定因变量，然后是&nbsp;~符号。右手边，预测变量，每个都被命名。加法符号表明这些被建模为加性效应。最后，我们指定要计算模型的数据帧。这里我们使用该lm函数执行OLS回归，但R中还有许多其他选项。 如果我们想要提取诸如AIC之类的度量 。 MLexamp &lt;- glm(extro ~ open + agree + social, data = lmm.data) display(MLexamp) ## glm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual deviance = 104378.2, null deviance = 104432.7 (difference = 54.5) ## overdispersion parameter = 87.3 ## residual sd is sqrt(overdispersion) = 9.34 AIC(MLexamp) ## [1] 8774 这导致模型拟合较差。现在让我们看一个简单的变化 模型。 适合不同的 模型 根据学科规范，我们的下一步可能是使用分组变量（如学校或班级）来拟合不同的 模型。&nbsp; MLexamp.2 &lt;- glm(extro ~ open + agree + social + class, data = lmm.data) display(MLexamp.2) ## glm(formula = extro ~ open + agree + social + class, data = lmm.data) ## coef.est coef.se ## (Intercept) 56.05 3.09 ## open 0.03 0.05 ## agree -0.01 0.05 ## social 0.01 0.02 ## classb 2.06 0.75 ## classc 3.70 0.75 ## classd 5.67 0.75 ## --- ## n = 1200, k = 7 ## residual deviance = 99187.7, null deviance = 104432.7 (difference = 5245.0) ## overdispersion parameter = 83.1 ## residual sd is sqrt(overdispersion) = 9.12 AIC(MLexamp.2) ## [1] 8719 anova(MLexamp, MLexamp.2, test = &quot;F&quot;) ## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + class ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1193 99188 3 5190 20.8 3.8e-13 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 这通常被称为固定效应规范。&nbsp; MLexamp.3 &lt;- glm(extro ~ open + agree + social + school, data = lmm.data) display(MLexamp.3) ## glm(formula = extro ~ open + agree + social + school, data = lmm.data) ## coef.est coef.se ## (Intercept) 45.02 0.92 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## schoolII 7.91 0.27 ## schoolIII 12.12 0.27 ## schoolIV 16.06 0.27 ## schoolV 20.43 0.27 ## schoolVI 28.05 0.27 ## --- ## n = 1200, k = 9 ## residual deviance = 8496.2, null deviance = 104432.7 (difference = 95936.5) ## overdispersion parameter = 7.1 ## residual sd is sqrt(overdispersion) = 2.67 AIC(MLexamp.3) ## [1] 5774 anova(MLexamp, MLexamp.3, test = &quot;F&quot;) ## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + school ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1191 8496 5 95882 2688 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 学校效果大大提高了我们的模型拟合度。但是，我们如何解释这些影响呢？ table(lmm.data$school, lmm.data$class) ## ## a b c d ## I 50 50 50 50 ## II 50 50 50 50 ## III 50 50 50 50 ## IV 50 50 50 50 ## V 50 50 50 50 ## VI 50 50 50 50 在这里，我们可以看到我们有一个完美平衡的设计，在课堂和学校的每个组合中有50个观察结果（ 。 让我们尝试对这些独特的细胞进行建模。&nbsp; MLexamp.4 &lt;- glm(extro ~ open + agree + social + school:class, data = lmm.data) display(MLexamp.4) ## glm(formula = extro ~ open + agree + social + school:class, data = lmm.data) ## coef.est coef.se ## (Intercept) 80.36 0.37 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI:classa -40.39 0.20 ## schoolII:classa -28.15 0.20 ## schoolIII:classa -23.58 0.20 ## schoolIV:classa -19.76 0.20 ## schoolV:classa -15.50 0.20 ## schoolVI:classa -10.46 0.20 ## schoolI:classb -34.60 0.20 ## schoolII:classb -26.76 0.20 ## schoolIII:classb -22.59 0.20 ## schoolIV:classb -18.71 0.20 ## schoolV:classb -14.31 0.20 ## schoolVI:classb -8.54 0.20 ## schoolI:classc -31.86 0.20 ## schoolII:classc -25.64 0.20 ## schoolIII:classc -21.58 0.20 ## schoolIV:classc -17.58 0.20 ## schoolV:classc -13.38 0.20 ## schoolVI:classc -5.58 0.20 ## schoolI:classd -30.00 0.20 ## schoolII:classd -24.57 0.20 ## schoolIII:classd -20.64 0.20 ## schoolIV:classd -16.60 0.20 ## schoolV:classd -12.04 0.20 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 104432.7 (difference = 103296.8) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 AIC(MLexamp.4) ## [1] 3396 这非常有用，但如果我们想了解学校的影响和课堂的影响，以及学校和班级的影响，该怎么办？&nbsp; MLexamp.5 &lt;- glm(extro ~ open + agree + social + school * class - 1, data = lmm.data) display(MLexamp.5) ## glm(formula = extro ~ open + agree + social + school * class - ## 1, data = lmm.data) ## coef.est coef.se ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI 39.96 0.36 ## schoolII 52.21 0.36 ## schoolIII 56.78 0.36 ## schoolIV 60.60 0.36 ## schoolV 64.86 0.36 ## schoolVI 69.90 0.36 ## classb 5.79 0.20 ## classc 8.53 0.20 ## classd 10.39 0.20 ## schoolII:classb -4.40 0.28 ## schoolIII:classb -4.80 0.28 ## schoolIV:classb -4.74 0.28 ## schoolV:classb -4.60 0.28 ## schoolVI:classb -3.87 0.28 ## schoolII:classc -6.02 0.28 ## schoolIII:classc -6.54 0.28 ## schoolIV:classc -6.36 0.28 ## schoolV:classc -6.41 0.28 ## schoolVI:classc -3.65 0.28 ## schoolII:classd -6.81 0.28 ## schoolIII:classd -7.45 0.28 ## schoolIV:classd -7.24 0.28 ## schoolV:classd -6.93 0.28 ## schoolVI:classd 0.06 0.28 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 4463029.9 (difference = 4461894.0) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 AIC(MLexamp.5) ## [1] 3396 探索随机斜率 另一种选择是为每个学校和班级组合安装一个单独的模型。如果我们认为我们的变量之间的关系可能高度依赖于学校和班级组合，我们可以简单地拟合一系列模型并探索它们之间的参数变化： require(plyr) display(modellist[[1]]) ## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 35.87 5.90 ## open 0.05 0.09 ## agree 0.02 0.10 ## social 0.01 0.03 ## --- ## n = 50, k = 4 ## residual deviance = 500.2, null deviance = 506.2 (difference = 5.9) ## overdispersion parameter = 10.9 ## residual sd is sqrt(overdispersion) = 3.30 display(modellist[[2]]) ## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 47.96 2.16 ## open -0.01 0.03 ## agree -0.03 0.03 ## social -0.01 0.01 ## --- ## n = 50, k = 4 ## residual deviance = 47.9, null deviance = 49.1 (difference = 1.2) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 1.02 我们将在未来的教程中更深入地讨论此策略，包括如何在此命令中生成的模型列表中进行性能推断。 使用lmer安装不同的斜率模型 输入lme4。虽然上述所有技术都是解决这一问题的有效方法，但当我们明确感兴趣的是群体之间的变化时，它们并不一定是最好的方法。这是混合效果建模框架有用的地方。现在我们使用lmer具有熟悉的公式接口的函数，但现在使用特殊语法指定组级变量：(1|school)&nbsp;tell&nbsp;使用变量lmer拟合具有变量截距组效果的线性模型school。 display(MLexamp.6) ## lmer(formula = extro ~ open + agree + social + (1 | school), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 59.12 4.10 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## Residual 2.67 ## --- ## number of obs: 1200, groups: school, 6 ## AIC = 5836.1, DIC = 5789 ## deviance = 5806.5 我们可以使用多个组效果术语来适应多个组效果。 display(MLexamp.7) ## lmer(formula = extro ~ open + agree + social + (1 | school) + ## (1 | class), data = lmm.data) ## coef.est coef.se ## (Intercept) 60.20 4.21 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## class (Intercept) 2.41 ## Residual 1.67 ## --- ## number of obs: 1200, groups: school, 6; class, 4 ## AIC = 4737.9, DIC = 4683 ## deviance = 4703.6 最后，我们可以通过以下语法拟合嵌套的组效果术语： display(MLexamp.8) ## lmer(formula = extro ~ open + agree + social + (1 | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.24 4.01 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## class:school (Intercept) 2.86 ## school (Intercept) 9.69 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3568.6, DIC = 3508 ## deviance = 3531.1 在这里(1|school/class)，我们想要为1|学校和学校内嵌的课程设置不同截取的混合效应术语。 用lmer拟合变化的斜率模型 但是，如果我们想要探索不同学生水平指标的影响，因为它们因教室而异。我们可以适应不同的坡度模型，而不是按学校（或学校/班级）拟合独特的模型。在这里，我们修改我们的随机效应项，以在分组术语之前包含变量：(1 + open|school/class)告诉R适合变化的斜率和不同的学校和学校类别的拦截模型，并允许open变量的斜率因学校而异。 display(MLexamp.9) ## lmer(formula = extro ~ open + agree + social + (1 + open | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.26 3.93 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. Corr ## class:school (Intercept) 2.62 ## open 0.01 1.00 ## school (Intercept) 9.51 ## open 0.00 1.00 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3574.7, DIC = 3506 ## deviance = 3529.3 结论 在R语言和生态系统中，拟合混合效应模型和探索组级变异非常容易。在以后的教程中，我们将探索跨模型的比较，使用混合效果模型进行推理，以及创建混合效果模型的图形表示以了解它们的效果。 附录 ## R version 3.0.1 (2013-05-16) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] plyr_1.8 arm_1.6-10 MASS_7.3-29 lme4_1.0-5 ## [5] Matrix_1.1-0 lattice_0.20-24 knitr_1.5 ## ## loaded via a namespace (and not attached): ## [1] abind_1.4-0 coda_0.16-1 evaluate_0.5.1 formatR_0.10 ## [5] grid_3.0.1 minqa_1.2.1 nlme_3.1-113 splines_3.0.1 ## [9] stringr_0.6.2 tools_3.0.1 &nbsp; &nbsp; 还有问题吗？联系我们！ &nbsp; 大数据部落 -中国专业的第三方数据服务提供商，提供定制化的一站式数据挖掘和统计分析咨询服务 统计分析和数据挖掘咨询服务：y0.cn/teradat（咨询服务请联系官网客服） QQ：3025393450 【服务场景】&nbsp;&nbsp; 科研项目; 公司项目外包;线上线下一对一培训;数据采集;学术研究;报告撰写;市场调查。 【大数据部落】提供定制化的一站式数据挖掘和统计分析咨询服务" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-08T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，未经博主允许不得转载。咨询链接：http://y0.cn/teradat 博文链接： https://blog.csdn.net/qq_19600291/article/details/89093936 &nbsp; 介绍 处理分组数据和复杂层次结构的分析师，从嵌入在参与者中的测量，嵌套在州内的县或嵌套在教室内的学生，经常发现他们需要建模工具来反映他们数据的这种结构。在R中，有两种主要的方法来拟合多级模型，这些模型考虑了数据中的这种结构。这些教程将向用户展示如何使用lme4R中的包来拟合线性和非线性混合效果模型，以及如何使用rstan以完全适合贝叶斯多级模型。这里的重点是如何使模型适合R而不是模型背后的理论。有关多级建模的背景知识，请参阅参考资料。&nbsp; 本教程将介绍如何lme4&nbsp; 设置和运行一些基本模型，其中包括： 在R中构造变化的截距，变化的斜率以及变化的斜率和截距模型 从混合效应模型中生成预测和解释参数 广义和非线性多层次模型 完全贝叶斯多级模型适合rstan或其他MCMC方法 设置 环境 在R中开始多级建模很简单。lme4是在R中实现多级模型的规范包，尽管有许多包依赖并增强其功能集，包括贝叶斯扩展。lme4&nbsp;最近已被重写以提高速度并整合C ++代码库，因此封装的功能有些不断变化。&nbsp; 要安装lme4，我们只需运行： # Main version install.packages(&quot;lme4&quot;) # Or to install the dev version library(devtools) install_github(&quot;lme4&quot;, user = &quot;lme4&quot;) 读入数据 多级模型适用于特定类型的数据结构，其中单元嵌套在组内（通常为5个以上组），并且我们希望对数据的组结构进行建模。对于我们的介绍性示例，我们将从lme4文档中的一个简单示例开始，并解释模型正在执行的操作。&nbsp; library(lme4) # load library library(arm) # convenience functions for regression in R # summary(lmm.data) head(lmm.data) ## id extro open agree social class school ## 1 1 63.69 43.43 38.03 75.06 d IV ## 2 2 69.48 46.87 31.49 98.13 a VI ## 3 3 79.74 32.27 40.21 116.34 d VI ## 4 4 62.97 44.41 30.51 90.47 c IV ## 5 5 64.25 36.86 37.44 98.52 d IV ## 6 6 50.97 46.26 38.83 75.22 d I &nbsp;模型 让我们首先拟合一个简单的OLS回归 。&nbsp; OLSexamp &lt;- lm(extro ~ open + agree + social, data = lmm.data) display(OLSexamp) ## lm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual sd = 9.34, R-Squared = 0.00 &nbsp;R模型接口非常简单，首先指定因变量，然后是&nbsp;~符号。右手边，预测变量，每个都被命名。加法符号表明这些被建模为加性效应。最后，我们指定要计算模型的数据帧。这里我们使用该lm函数执行OLS回归，但R中还有许多其他选项。 如果我们想要提取诸如AIC之类的度量 。 MLexamp &lt;- glm(extro ~ open + agree + social, data = lmm.data) display(MLexamp) ## glm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual deviance = 104378.2, null deviance = 104432.7 (difference = 54.5) ## overdispersion parameter = 87.3 ## residual sd is sqrt(overdispersion) = 9.34 AIC(MLexamp) ## [1] 8774 这导致模型拟合较差。现在让我们看一个简单的变化 模型。 适合不同的 模型 根据学科规范，我们的下一步可能是使用分组变量（如学校或班级）来拟合不同的 模型。&nbsp; MLexamp.2 &lt;- glm(extro ~ open + agree + social + class, data = lmm.data) display(MLexamp.2) ## glm(formula = extro ~ open + agree + social + class, data = lmm.data) ## coef.est coef.se ## (Intercept) 56.05 3.09 ## open 0.03 0.05 ## agree -0.01 0.05 ## social 0.01 0.02 ## classb 2.06 0.75 ## classc 3.70 0.75 ## classd 5.67 0.75 ## --- ## n = 1200, k = 7 ## residual deviance = 99187.7, null deviance = 104432.7 (difference = 5245.0) ## overdispersion parameter = 83.1 ## residual sd is sqrt(overdispersion) = 9.12 AIC(MLexamp.2) ## [1] 8719 anova(MLexamp, MLexamp.2, test = &quot;F&quot;) ## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + class ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1193 99188 3 5190 20.8 3.8e-13 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 这通常被称为固定效应规范。&nbsp; MLexamp.3 &lt;- glm(extro ~ open + agree + social + school, data = lmm.data) display(MLexamp.3) ## glm(formula = extro ~ open + agree + social + school, data = lmm.data) ## coef.est coef.se ## (Intercept) 45.02 0.92 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## schoolII 7.91 0.27 ## schoolIII 12.12 0.27 ## schoolIV 16.06 0.27 ## schoolV 20.43 0.27 ## schoolVI 28.05 0.27 ## --- ## n = 1200, k = 9 ## residual deviance = 8496.2, null deviance = 104432.7 (difference = 95936.5) ## overdispersion parameter = 7.1 ## residual sd is sqrt(overdispersion) = 2.67 AIC(MLexamp.3) ## [1] 5774 anova(MLexamp, MLexamp.3, test = &quot;F&quot;) ## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + school ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1191 8496 5 95882 2688 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 学校效果大大提高了我们的模型拟合度。但是，我们如何解释这些影响呢？ table(lmm.data$school, lmm.data$class) ## ## a b c d ## I 50 50 50 50 ## II 50 50 50 50 ## III 50 50 50 50 ## IV 50 50 50 50 ## V 50 50 50 50 ## VI 50 50 50 50 在这里，我们可以看到我们有一个完美平衡的设计，在课堂和学校的每个组合中有50个观察结果（ 。 让我们尝试对这些独特的细胞进行建模。&nbsp; MLexamp.4 &lt;- glm(extro ~ open + agree + social + school:class, data = lmm.data) display(MLexamp.4) ## glm(formula = extro ~ open + agree + social + school:class, data = lmm.data) ## coef.est coef.se ## (Intercept) 80.36 0.37 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI:classa -40.39 0.20 ## schoolII:classa -28.15 0.20 ## schoolIII:classa -23.58 0.20 ## schoolIV:classa -19.76 0.20 ## schoolV:classa -15.50 0.20 ## schoolVI:classa -10.46 0.20 ## schoolI:classb -34.60 0.20 ## schoolII:classb -26.76 0.20 ## schoolIII:classb -22.59 0.20 ## schoolIV:classb -18.71 0.20 ## schoolV:classb -14.31 0.20 ## schoolVI:classb -8.54 0.20 ## schoolI:classc -31.86 0.20 ## schoolII:classc -25.64 0.20 ## schoolIII:classc -21.58 0.20 ## schoolIV:classc -17.58 0.20 ## schoolV:classc -13.38 0.20 ## schoolVI:classc -5.58 0.20 ## schoolI:classd -30.00 0.20 ## schoolII:classd -24.57 0.20 ## schoolIII:classd -20.64 0.20 ## schoolIV:classd -16.60 0.20 ## schoolV:classd -12.04 0.20 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 104432.7 (difference = 103296.8) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 AIC(MLexamp.4) ## [1] 3396 这非常有用，但如果我们想了解学校的影响和课堂的影响，以及学校和班级的影响，该怎么办？&nbsp; MLexamp.5 &lt;- glm(extro ~ open + agree + social + school * class - 1, data = lmm.data) display(MLexamp.5) ## glm(formula = extro ~ open + agree + social + school * class - ## 1, data = lmm.data) ## coef.est coef.se ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI 39.96 0.36 ## schoolII 52.21 0.36 ## schoolIII 56.78 0.36 ## schoolIV 60.60 0.36 ## schoolV 64.86 0.36 ## schoolVI 69.90 0.36 ## classb 5.79 0.20 ## classc 8.53 0.20 ## classd 10.39 0.20 ## schoolII:classb -4.40 0.28 ## schoolIII:classb -4.80 0.28 ## schoolIV:classb -4.74 0.28 ## schoolV:classb -4.60 0.28 ## schoolVI:classb -3.87 0.28 ## schoolII:classc -6.02 0.28 ## schoolIII:classc -6.54 0.28 ## schoolIV:classc -6.36 0.28 ## schoolV:classc -6.41 0.28 ## schoolVI:classc -3.65 0.28 ## schoolII:classd -6.81 0.28 ## schoolIII:classd -7.45 0.28 ## schoolIV:classd -7.24 0.28 ## schoolV:classd -6.93 0.28 ## schoolVI:classd 0.06 0.28 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 4463029.9 (difference = 4461894.0) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 AIC(MLexamp.5) ## [1] 3396 探索随机斜率 另一种选择是为每个学校和班级组合安装一个单独的模型。如果我们认为我们的变量之间的关系可能高度依赖于学校和班级组合，我们可以简单地拟合一系列模型并探索它们之间的参数变化： require(plyr) display(modellist[[1]]) ## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 35.87 5.90 ## open 0.05 0.09 ## agree 0.02 0.10 ## social 0.01 0.03 ## --- ## n = 50, k = 4 ## residual deviance = 500.2, null deviance = 506.2 (difference = 5.9) ## overdispersion parameter = 10.9 ## residual sd is sqrt(overdispersion) = 3.30 display(modellist[[2]]) ## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 47.96 2.16 ## open -0.01 0.03 ## agree -0.03 0.03 ## social -0.01 0.01 ## --- ## n = 50, k = 4 ## residual deviance = 47.9, null deviance = 49.1 (difference = 1.2) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 1.02 我们将在未来的教程中更深入地讨论此策略，包括如何在此命令中生成的模型列表中进行性能推断。 使用lmer安装不同的斜率模型 输入lme4。虽然上述所有技术都是解决这一问题的有效方法，但当我们明确感兴趣的是群体之间的变化时，它们并不一定是最好的方法。这是混合效果建模框架有用的地方。现在我们使用lmer具有熟悉的公式接口的函数，但现在使用特殊语法指定组级变量：(1|school)&nbsp;tell&nbsp;使用变量lmer拟合具有变量截距组效果的线性模型school。 display(MLexamp.6) ## lmer(formula = extro ~ open + agree + social + (1 | school), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 59.12 4.10 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## Residual 2.67 ## --- ## number of obs: 1200, groups: school, 6 ## AIC = 5836.1, DIC = 5789 ## deviance = 5806.5 我们可以使用多个组效果术语来适应多个组效果。 display(MLexamp.7) ## lmer(formula = extro ~ open + agree + social + (1 | school) + ## (1 | class), data = lmm.data) ## coef.est coef.se ## (Intercept) 60.20 4.21 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## class (Intercept) 2.41 ## Residual 1.67 ## --- ## number of obs: 1200, groups: school, 6; class, 4 ## AIC = 4737.9, DIC = 4683 ## deviance = 4703.6 最后，我们可以通过以下语法拟合嵌套的组效果术语： display(MLexamp.8) ## lmer(formula = extro ~ open + agree + social + (1 | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.24 4.01 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## class:school (Intercept) 2.86 ## school (Intercept) 9.69 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3568.6, DIC = 3508 ## deviance = 3531.1 在这里(1|school/class)，我们想要为1|学校和学校内嵌的课程设置不同截取的混合效应术语。 用lmer拟合变化的斜率模型 但是，如果我们想要探索不同学生水平指标的影响，因为它们因教室而异。我们可以适应不同的坡度模型，而不是按学校（或学校/班级）拟合独特的模型。在这里，我们修改我们的随机效应项，以在分组术语之前包含变量：(1 + open|school/class)告诉R适合变化的斜率和不同的学校和学校类别的拦截模型，并允许open变量的斜率因学校而异。 display(MLexamp.9) ## lmer(formula = extro ~ open + agree + social + (1 + open | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.26 3.93 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. Corr ## class:school (Intercept) 2.62 ## open 0.01 1.00 ## school (Intercept) 9.51 ## open 0.00 1.00 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3574.7, DIC = 3506 ## deviance = 3529.3 结论 在R语言和生态系统中，拟合混合效应模型和探索组级变异非常容易。在以后的教程中，我们将探索跨模型的比较，使用混合效果模型进行推理，以及创建混合效果模型的图形表示以了解它们的效果。 附录 ## R version 3.0.1 (2013-05-16) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] plyr_1.8 arm_1.6-10 MASS_7.3-29 lme4_1.0-5 ## [5] Matrix_1.1-0 lattice_0.20-24 knitr_1.5 ## ## loaded via a namespace (and not attached): ## [1] abind_1.4-0 coda_0.16-1 evaluate_0.5.1 formatR_0.10 ## [5] grid_3.0.1 minqa_1.2.1 nlme_3.1-113 splines_3.0.1 ## [9] stringr_0.6.2 tools_3.0.1 &nbsp; &nbsp; 还有问题吗？联系我们！ &nbsp; 大数据部落 -中国专业的第三方数据服务提供商，提供定制化的一站式数据挖掘和统计分析咨询服务 统计分析和数据挖掘咨询服务：y0.cn/teradat（咨询服务请联系官网客服） QQ：3025393450 【服务场景】&nbsp;&nbsp; 科研项目; 公司项目外包;线上线下一对一培训;数据采集;学术研究;报告撰写;市场调查。 【大数据部落】提供定制化的一站式数据挖掘和统计分析咨询服务","@type":"BlogPosting","url":"/2019/04/08/727329.html","headline":"R语言 线性混合效应模型实战案例","dateModified":"2019-04-08T00:00:00+08:00","datePublished":"2019-04-08T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/04/08/727329.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>R语言 线性混合效应模型实战案例</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，未经博主允许不得转载。咨询链接：http://y0.cn/teradat 博文链接： https://blog.csdn.net/qq_19600291/article/details/89093936 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <p id="yui_3_17_2_1_1554710638779_459" style="margin-left:0px;"><span style="color:#5c5c5c;"><strong>&nbsp;</strong></span></p> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">介绍</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">处理分组数据和复杂层次结构的分析师，从嵌入在参与者中的测量，嵌套在州内的县或嵌套在教室内的学生，经常发现他们需要建模工具来反映他们数据的这种结构。在R中，有两种主要的方法来拟合多级模型，这些模型考虑了数据中的这种结构。这些教程将向用户展示如何使用<code>lme4</code>R中的包来拟合线性和非线性混合效果模型，以及如何使用<code>rstan</code>以完全适合贝叶斯多级模型。这里的重点是如何使模型适合R而不是模型背后的理论。有关多级建模的背景知识，请参阅参考资料。&nbsp;</span></p> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">本教程将介绍如何<code>lme4</code>&nbsp; 设置和运行一些基本模型，其中包括：</span></p> 
  <ul style="margin-left:0px;">
   <li><span style="color:#5c5c5c;">在R中构造变化的截距，变化的斜率以及变化的斜率和截距模型</span></li> 
   <li><span style="color:#5c5c5c;">从混合效应模型中生成预测和解释参数</span></li> 
   <li><span style="color:#5c5c5c;">广义和非线性多层次模型</span></li> 
   <li><span style="color:#5c5c5c;">完全贝叶斯多级模型适合<code>rstan</code>或其他MCMC方法</span></li> 
  </ul>
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">设置 环境</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">在R中开始多级建模很简单。<code>lme4</code>是在R中实现多级模型的规范包，尽管有许多包依赖并增强其功能集，包括贝叶斯扩展。<code>lme4</code>&nbsp;最近已被重写以提高速度并整合C ++代码库，因此封装的功能有些不断变化。&nbsp;</span></p> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">要安装<code>lme4</code>，我们只需运行：</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#4c886b;"># Main version</span> <span style="color:#000000;">install.packages</span><span style="color:#687687;">(</span><span style="color:#036a07;">"lme4"</span><span style="color:#687687;">)</span> <span style="color:#4c886b;"># Or to install the dev version</span> <span style="color:#0000ff;">library</span><span style="color:#687687;">(</span><span style="color:#000000;">devtools</span><span style="color:#687687;">)</span> <span style="color:#000000;">install_github</span><span style="color:#687687;">(</span><span style="color:#036a07;">"lme4"</span>, <span style="color:#000000;">user</span> <span style="color:#687687;">=</span> <span style="color:#036a07;">"lme4"</span><span style="color:#687687;">)</span> </code></span></pre> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">读入数据</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">多级模型适用于特定类型的数据结构，其中单元嵌套在组内（通常为5个以上组），并且我们希望对数据的组结构进行建模。对于我们的介绍性示例，我们将从<code>lme4</code>文档中的一个简单示例开始，并解释模型正在执行的操作。&nbsp;</span></p> 
  <pre>
<code><span style="color:#0000ff;">library</span><span style="color:#687687;">(</span><span style="color:#000000;">lme4</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span><span style="color:#4c886b;"># load library</span><span style="color:#5c5c5c;"> </span><span style="color:#0000ff;">library</span><span style="color:#687687;">(</span><span style="color:#000000;">arm</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span><span style="color:#4c886b;"># convenience functions for regression in R</span><span style="color:#5c5c5c;"> </span> <span style="color:#5c5c5c;"> </span><span style="color:#4c886b;"># summary(lmm.data)</span><span style="color:#5c5c5c;"> </span><span style="color:#000000;">head</span><span style="color:#687687;">(</span><span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span></code></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## id extro open agree social class school ## 1 1 63.69 43.43 38.03 75.06 d IV ## 2 2 69.48 46.87 31.49 98.13 a VI ## 3 3 79.74 32.27 40.21 116.34 d VI ## 4 4 62.97 44.41 30.51 90.47 c IV ## 5 5 64.25 36.86 37.44 98.52 d IV ## 6 6 50.97 46.26 38.83 75.22 d I </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">&nbsp;</span><strong style="color:#222222;font-size:28px;font-weight:700;">模型</strong></p> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">让我们首先拟合一个简单的OLS回归 。&nbsp;</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">OLSexamp</span> <span style="color:#687687;">&lt;-</span> <span style="color:#000000;">lm</span><span style="color:#687687;">(</span><span style="color:#000000;">extro</span> <span style="color:#687687;">~</span> <span style="color:#000000;">open</span> <span style="color:#687687;">+</span> <span style="color:#000000;">agree</span> <span style="color:#687687;">+</span> <span style="color:#000000;">social</span>, <span style="color:#000000;">data</span> <span style="color:#687687;">=</span> <span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span> <span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">OLSexamp</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## lm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual sd = 9.34, R-Squared = 0.00 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">&nbsp;R模型接口非常简单，首先指定因变量，然后是&nbsp;<code>~</code>符号。右手边，预测变量，每个都被命名。加法符号表明这些被建模为加性效应。最后，我们指定要计算模型的数据帧。这里我们使用该<code>lm</code>函数执行OLS回归，但R中还有许多其他选项。</span></p> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">如果我们想要提取诸如AIC之类的度量 。</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">MLexamp</span> <span style="color:#687687;">&lt;-</span> <span style="color:#000000;">glm</span><span style="color:#687687;">(</span><span style="color:#000000;">extro</span> <span style="color:#687687;">~</span> <span style="color:#000000;">open</span> <span style="color:#687687;">+</span> <span style="color:#000000;">agree</span> <span style="color:#687687;">+</span> <span style="color:#000000;">social</span>, <span style="color:#000000;">data</span> <span style="color:#687687;">=</span> <span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span> <span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social, data = lmm.data) ## coef.est coef.se ## (Intercept) 57.84 3.15 ## open 0.02 0.05 ## agree 0.03 0.05 ## social 0.01 0.02 ## --- ## n = 1200, k = 4 ## residual deviance = 104378.2, null deviance = 104432.7 (difference = 54.5) ## overdispersion parameter = 87.3 ## residual sd is sqrt(overdispersion) = 9.34 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">AIC</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## [1] 8774 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">这导致模型拟合较差。现在让我们看一个简单的变化 模型。</span></p> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">适合不同的 模型</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">根据学科规范，我们的下一步可能是使用分组变量（如学校或班级）来拟合不同的 模型。&nbsp;</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">MLexamp.2</span> <span style="color:#687687;">&lt;-</span> <span style="color:#000000;">glm</span><span style="color:#687687;">(</span><span style="color:#000000;">extro</span> <span style="color:#687687;">~</span> <span style="color:#000000;">open</span> <span style="color:#687687;">+</span> <span style="color:#000000;">agree</span> <span style="color:#687687;">+</span> <span style="color:#000000;">social</span> <span style="color:#687687;">+</span> <span style="color:#000000;">class</span>, <span style="color:#000000;">data</span> <span style="color:#687687;">=</span> <span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span> <span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.2</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social + class, data = lmm.data) ## coef.est coef.se ## (Intercept) 56.05 3.09 ## open 0.03 0.05 ## agree -0.01 0.05 ## social 0.01 0.02 ## classb 2.06 0.75 ## classc 3.70 0.75 ## classd 5.67 0.75 ## --- ## n = 1200, k = 7 ## residual deviance = 99187.7, null deviance = 104432.7 (difference = 5245.0) ## overdispersion parameter = 83.1 ## residual sd is sqrt(overdispersion) = 9.12 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">AIC</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.2</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## [1] 8719 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">anova</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp</span>, <span style="color:#000000;">MLexamp.2</span>, <span style="color:#000000;">test</span> <span style="color:#687687;">=</span> <span style="color:#036a07;">"F"</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + class ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1193 99188 3 5190 20.8 3.8e-13 *** ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">这通常被称为固定效应规范。&nbsp;</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">MLexamp.3</span> <span style="color:#687687;">&lt;-</span> <span style="color:#000000;">glm</span><span style="color:#687687;">(</span><span style="color:#000000;">extro</span> <span style="color:#687687;">~</span> <span style="color:#000000;">open</span> <span style="color:#687687;">+</span> <span style="color:#000000;">agree</span> <span style="color:#687687;">+</span> <span style="color:#000000;">social</span> <span style="color:#687687;">+</span> <span style="color:#000000;">school</span>, <span style="color:#000000;">data</span> <span style="color:#687687;">=</span> <span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span> <span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.3</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social + school, data = lmm.data) ## coef.est coef.se ## (Intercept) 45.02 0.92 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## schoolII 7.91 0.27 ## schoolIII 12.12 0.27 ## schoolIV 16.06 0.27 ## schoolV 20.43 0.27 ## schoolVI 28.05 0.27 ## --- ## n = 1200, k = 9 ## residual deviance = 8496.2, null deviance = 104432.7 (difference = 95936.5) ## overdispersion parameter = 7.1 ## residual sd is sqrt(overdispersion) = 2.67 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">AIC</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.3</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## [1] 5774 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">anova</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp</span>, <span style="color:#000000;">MLexamp.3</span>, <span style="color:#000000;">test</span> <span style="color:#687687;">=</span> <span style="color:#036a07;">"F"</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## Analysis of Deviance Table ## ## Model 1: extro ~ open + agree + social ## Model 2: extro ~ open + agree + social + school ## Resid. Df Resid. Dev Df Deviance F Pr(&gt;F) ## 1 1196 104378 ## 2 1191 8496 5 95882 2688 &lt;2e-16 *** ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">学校效果大大提高了我们的模型拟合度。但是，我们如何解释这些影响呢？</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">table</span><span style="color:#687687;">(</span><span style="color:#000000;">lmm.data</span><span style="color:#687687;">$</span><span style="color:#000000;">school</span>, <span style="color:#000000;">lmm.data</span><span style="color:#687687;">$</span><span style="color:#000000;">class</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## ## a b c d ## I 50 50 50 50 ## II 50 50 50 50 ## III 50 50 50 50 ## IV 50 50 50 50 ## V 50 50 50 50 ## VI 50 50 50 50 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">在这里，我们可以看到我们有一个完美平衡的设计，在课堂和学校的每个组合中有50个观察结果（ 。</span></p> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">让我们尝试对这些独特的细胞进行建模。&nbsp;</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">MLexamp.4</span> <span style="color:#687687;">&lt;-</span> <span style="color:#000000;">glm</span><span style="color:#687687;">(</span><span style="color:#000000;">extro</span> <span style="color:#687687;">~</span> <span style="color:#000000;">open</span> <span style="color:#687687;">+</span> <span style="color:#000000;">agree</span> <span style="color:#687687;">+</span> <span style="color:#000000;">social</span> <span style="color:#687687;">+</span> <span style="color:#000000;">school</span><span style="color:#687687;">:</span><span style="color:#000000;">class</span>, <span style="color:#000000;">data</span> <span style="color:#687687;">=</span> <span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span> <span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.4</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social + school:class, data = lmm.data) ## coef.est coef.se ## (Intercept) 80.36 0.37 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI:classa -40.39 0.20 ## schoolII:classa -28.15 0.20 ## schoolIII:classa -23.58 0.20 ## schoolIV:classa -19.76 0.20 ## schoolV:classa -15.50 0.20 ## schoolVI:classa -10.46 0.20 ## schoolI:classb -34.60 0.20 ## schoolII:classb -26.76 0.20 ## schoolIII:classb -22.59 0.20 ## schoolIV:classb -18.71 0.20 ## schoolV:classb -14.31 0.20 ## schoolVI:classb -8.54 0.20 ## schoolI:classc -31.86 0.20 ## schoolII:classc -25.64 0.20 ## schoolIII:classc -21.58 0.20 ## schoolIV:classc -17.58 0.20 ## schoolV:classc -13.38 0.20 ## schoolVI:classc -5.58 0.20 ## schoolI:classd -30.00 0.20 ## schoolII:classd -24.57 0.20 ## schoolIII:classd -20.64 0.20 ## schoolIV:classd -16.60 0.20 ## schoolV:classd -12.04 0.20 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 104432.7 (difference = 103296.8) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">AIC</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.4</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## [1] 3396 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">这非常有用，但如果我们想了解学校的影响和课堂的影响，以及学校和班级的影响，该怎么办？&nbsp;</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">MLexamp.5</span> <span style="color:#687687;">&lt;-</span> <span style="color:#000000;">glm</span><span style="color:#687687;">(</span><span style="color:#000000;">extro</span> <span style="color:#687687;">~</span> <span style="color:#000000;">open</span> <span style="color:#687687;">+</span> <span style="color:#000000;">agree</span> <span style="color:#687687;">+</span> <span style="color:#000000;">social</span> <span style="color:#687687;">+</span> <span style="color:#000000;">school</span> <span style="color:#687687;">*</span> <span style="color:#000000;">class</span> <span style="color:#687687;">-</span> <span style="color:#0000cd;">1</span>, <span style="color:#000000;">data</span> <span style="color:#687687;">=</span> <span style="color:#000000;">lmm.data</span><span style="color:#687687;">)</span> <span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.5</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social + school * class - ## 1, data = lmm.data) ## coef.est coef.se ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## schoolI 39.96 0.36 ## schoolII 52.21 0.36 ## schoolIII 56.78 0.36 ## schoolIV 60.60 0.36 ## schoolV 64.86 0.36 ## schoolVI 69.90 0.36 ## classb 5.79 0.20 ## classc 8.53 0.20 ## classd 10.39 0.20 ## schoolII:classb -4.40 0.28 ## schoolIII:classb -4.80 0.28 ## schoolIV:classb -4.74 0.28 ## schoolV:classb -4.60 0.28 ## schoolVI:classb -3.87 0.28 ## schoolII:classc -6.02 0.28 ## schoolIII:classc -6.54 0.28 ## schoolIV:classc -6.36 0.28 ## schoolV:classc -6.41 0.28 ## schoolVI:classc -3.65 0.28 ## schoolII:classd -6.81 0.28 ## schoolIII:classd -7.45 0.28 ## schoolIV:classd -7.24 0.28 ## schoolV:classd -6.93 0.28 ## schoolVI:classd 0.06 0.28 ## --- ## n = 1200, k = 27 ## residual deviance = 1135.9, null deviance = 4463029.9 (difference = 4461894.0) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 0.98 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">AIC</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.5</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## [1] 3396 </code></span></pre> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">探索随机斜率</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">另一种选择是为每个学校和班级组合安装一个单独的模型。如果我们认为我们的变量之间的关系可能高度依赖于学校和班级组合，我们可以简单地拟合一系列模型并探索它们之间的参数变化：</span></p> 
  <pre>
<code><span style="color:#0000ff;">require</span><span style="color:#687687;">(</span><span style="color:#000000;">plyr</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span> <span style="color:#5c5c5c;"> </span><span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">modellist</span><span style="color:#687687;">[</span><span style="color:#687687;">[</span><span style="color:#0000cd;">1</span><span style="color:#687687;">]</span><span style="color:#687687;">]</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span></code></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 35.87 5.90 ## open 0.05 0.09 ## agree 0.02 0.10 ## social 0.01 0.03 ## --- ## n = 50, k = 4 ## residual deviance = 500.2, null deviance = 506.2 (difference = 5.9) ## overdispersion parameter = 10.9 ## residual sd is sqrt(overdispersion) = 3.30 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">modellist</span><span style="color:#687687;">[</span><span style="color:#687687;">[</span><span style="color:#0000cd;">2</span><span style="color:#687687;">]</span><span style="color:#687687;">]</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## glm(formula = extro ~ open + agree + social, data = x) ## coef.est coef.se ## (Intercept) 47.96 2.16 ## open -0.01 0.03 ## agree -0.03 0.03 ## social -0.01 0.01 ## --- ## n = 50, k = 4 ## residual deviance = 47.9, null deviance = 49.1 (difference = 1.2) ## overdispersion parameter = 1.0 ## residual sd is sqrt(overdispersion) = 1.02 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">我们将在未来的教程中更深入地讨论此策略，包括如何在此命令中生成的模型列表中进行性能推断。</span></p> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">使用lmer安装不同的斜率模型</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">输入<code>lme4</code>。虽然上述所有技术都是解决这一问题的有效方法，但当我们明确感兴趣的是群体之间的变化时，它们并不一定是最好的方法。这是混合效果建模框架有用的地方。现在我们使用<code>lmer</code>具有熟悉的公式接口的函数，但现在使用特殊语法指定组级变量：<code>(1|school)</code>&nbsp;tell&nbsp;使用变量<code>lmer</code>拟合具有变量截距组效果的线性模型<code>school</code>。</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;"> display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.6</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## lmer(formula = extro ~ open + agree + social + (1 | school), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 59.12 4.10 ## open 0.01 0.01 ## agree 0.03 0.02 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## Residual 2.67 ## --- ## number of obs: 1200, groups: school, 6 ## AIC = 5836.1, DIC = 5789 ## deviance = 5806.5 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">我们可以使用多个组效果术语来适应多个组效果。</span></p> 
  <pre>
<code><span style="color:#000000;"> display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.7</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span></code></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## lmer(formula = extro ~ open + agree + social + (1 | school) + ## (1 | class), data = lmm.data) ## coef.est coef.se ## (Intercept) 60.20 4.21 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## school (Intercept) 9.79 ## class (Intercept) 2.41 ## Residual 1.67 ## --- ## number of obs: 1200, groups: school, 6; class, 4 ## AIC = 4737.9, DIC = 4683 ## deviance = 4703.6 </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">最后，我们可以通过以下语法拟合嵌套的组效果术语：</span></p> 
  <pre>
<span style="color:#5c5c5c;"><code><span style="color:#000000;"> display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.8</span><span style="color:#687687;">)</span> </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## lmer(formula = extro ~ open + agree + social + (1 | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.24 4.01 ## open 0.01 0.00 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. ## class:school (Intercept) 2.86 ## school (Intercept) 9.69 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3568.6, DIC = 3508 ## deviance = 3531.1 </code></span></pre> 
  <pre>
<span style="color:#5c5c5c;"><code> </code></span></pre> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">在这里<code>(1|school/class)</code>，我们想要为<code>1|</code>学校和学校内嵌的课程设置不同截取的混合效应术语。</span></p> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">用lmer拟合变化的斜率模型</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">但是，如果我们想要探索不同学生水平指标的影响，因为它们因教室而异。我们可以适应不同的坡度模型，而不是按学校（或学校/班级）拟合独特的模型。在这里，我们修改我们的随机效应项，以在分组术语之前包含变量：<code>(1 + open|school/class)</code>告诉R适合变化的斜率和不同的学校和学校类别的拦截模型，并允许<code>open</code>变量的斜率因学校而异。</span></p> 
  <pre>
<code> <span style="color:#5c5c5c;"> </span><span style="color:#000000;">display</span><span style="color:#687687;">(</span><span style="color:#000000;">MLexamp.9</span><span style="color:#687687;">)</span><span style="color:#5c5c5c;"> </span></code></pre> 
  <pre>
<span style="color:#5c5c5c;"><code>## lmer(formula = extro ~ open + agree + social + (1 + open | school/class), ## data = lmm.data) ## coef.est coef.se ## (Intercept) 60.26 3.93 ## open 0.01 0.01 ## agree -0.01 0.01 ## social 0.00 0.00 ## ## Error terms: ## Groups Name Std.Dev. Corr ## class:school (Intercept) 2.62 ## open 0.01 1.00 ## school (Intercept) 9.51 ## open 0.00 1.00 ## Residual 0.98 ## --- ## number of obs: 1200, groups: class:school, 24; school, 6 ## AIC = 3574.7, DIC = 3506 ## deviance = 3529.3 </code></span></pre> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">结论</span></span></h1> 
  <p style="margin-left:0px;"><span style="color:#5c5c5c;">在R语言和生态系统中，拟合混合效应模型和探索组级变异非常容易。在以后的教程中，我们将探索跨模型的比较，使用混合效果模型进行推理，以及创建混合效果模型的图形表示以了解它们的效果。</span></p> 
  <h1 style="margin-left:0px;"><span style="color:#5c5c5c;"><span style="color:#222222;">附录</span></span></h1> 
  <pre>
<code> <span style="color:#5c5c5c;">## R version 3.0.1 (2013-05-16) </span></code></pre> 
  <pre id="yui_3_17_2_1_1554710638779_467">
<span style="color:#5c5c5c;"><code id="yui_3_17_2_1_1554710638779_466">## Platform: x86_64-w64-mingw32/x64 (64-bit) ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] plyr_1.8 arm_1.6-10 MASS_7.3-29 lme4_1.0-5 ## [5] Matrix_1.1-0 lattice_0.20-24 knitr_1.5 ## ## loaded via a namespace (and not attached): ## [1] abind_1.4-0 coda_0.16-1 evaluate_0.5.1 formatR_0.10 ## [5] grid_3.0.1 minqa_1.2.1 nlme_3.1-113 splines_3.0.1 ## [9] stringr_0.6.2 tools_3.0.1</code></span></pre> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <h2>还有问题吗？联系我们！</h2> 
  <h1>&nbsp;</h1> 
  <p><a href="http://y0.cn/teradat" rel="nofollow">大数据部落</a> -中国专业的第三方数据服务提供商，提供定制化的一站式数据挖掘和统计分析咨询服务</p> 
  <p>统计分析和数据挖掘咨询服务：<a href="http://y0.cn/teradat" rel="nofollow">y0.cn/teradat</a>（咨询服务请联系<a href="http://dwz.cn/YntAj" rel="nofollow">官网客服</a>）</p> 
  <p><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=3025393450&amp;site=qq&amp;menu=yes" rel="nofollow"><img alt="点击这里给我发消息" class="has" src="https://blog.uzzz.org.cn/_p?https://img-blog.csdnimg.cn/20181218152712945"></a>QQ：3025393450</p> 
  <p><img alt="" class="has" height="154" src="https://blog.uzzz.org.cn/_p?https://img-blog.csdnimg.cn/2019031315051532.png" width="128"></p> 
  <p><strong>【服务场景】&nbsp;&nbsp;</strong></p> 
  <p>科研项目; 公司项目外包;线上线下一对一培训;数据采集;学术研究;报告撰写;市场调查。</p> 
  <p><strong>【大数据部落】</strong>提供定制化的一站式数据挖掘和统计分析咨询服务</p> 
  <p><a href="http://y0.cn/teradat" rel="nofollow"><img alt="【大数据部落】大数据部落提供定制化的一站式数据挖掘和统计分析咨询服务" class="has" src="https://blog.uzzz.org.cn/_p?https://img-blog.csdnimg.cn/20181218152712961"></a></p> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>æ•°æ®ç»“æ„ç®—æ³• - ConcurrentHashMap æºç è§£æ | æœ‰ç»„ç»‡åœ¨ï¼</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="æ•°æ®ç»“æ„ç®—æ³• - ConcurrentHashMap æºç è§£æ" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Linuxç¼–ç¨‹ ç‚¹å‡»å³ä¾§å…³æ³¨ï¼Œå…è´¹å…¥é—¨åˆ°ç²¾é€šï¼ ä½œè€…ä¸¨çº¢æ©™Darrenhttps://www.jianshu.com/p/0b452a6e4f4e äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ConcurrentHashMap æ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ åœ¨åˆ†æ HashMap æºç æ—¶è¿˜é—ç•™è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬ç«™åœ¨ Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹å’Œ synchronized çš„å®ç°åŸç†ï¼Œè¿™ä¸¤ä¸ªè§’åº¦æ¥å½»åº•åˆ†æä¸€ä¸‹ã€‚è‡³äº JDK 1.8 çš„çº¢é»‘æ ‘ä¸æ˜¯æœ¬æ–‡æ¢è®¨çš„å†…å®¹ã€‚ 1. Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‡ºç°ä¸¤ç§ç°è±¡ï¼Œå¤§æ¦‚ç‡ä¼šå‡ºç°æ•°æ®ä¸¢å¤±ï¼Œå°æ¦‚ç‡ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæˆ‘ä»¬ä¸å¦¨å†™ä¸ªæµ‹è¯•ä»£ç è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚é‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸¤ç§ç°è±¡ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ã€‚è¯·çœ‹å›¾ï¼š Javaå†…å­˜æ¨¡å‹ä¸­è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡åˆ°ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦åœ¨ä¸»å†…å­˜æ¥å®Œæˆï¼Œçº¿ç¨‹ã€ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’å…³ç³»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ ç°åœ¨æˆ‘ä»¬æ¥æƒ³è±¡ä¸€ä¸‹ï¼Œå‡è®¾çº¿ç¨‹ 1 æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå€˜è‹¥è¿™æ—¶è¿˜æ²¡æ¥å¾—åŠå°†æ–°å¢çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…ä¸­ã€‚æ¥ç€çº¿ç¨‹ 2 å°±æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ã€‚æ¥ç€çº¿ç¨‹ 1 æŠŠæ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ 2 ä¹ŸæŠŠæ•°æ®æ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œé‚£ä¹ˆçº¿ç¨‹ 2 å°±ä¼šè¦†ç›–çº¿ç¨‹ 1 çš„æ–°å¢æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚ 2. synchronized çš„åº•å±‚å®ç°åŸç† å…³äº HashMap çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼ŒJava ç»™æˆ‘ä»¬æä¾›äº†ä¸‰ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯ HashTable ï¼Œç¬¬äºŒç§æ˜¯ Collections.synchronizedMap() ï¼Œç¬¬ä¸‰ç§æ˜¯ ConcurrentHashMap ã€‚è€Œç¬¬ä¸€ç§å’Œç¬¬äºŒç§éƒ½æ˜¯é€šè¿‡ç”¨ synchronized åŒæ­¥æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½ä¸Šæœ‰æ‰€æ¬ ç¼ºä¸æ¨èå¤§å®¶ä½¿ç”¨ã€‚ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment åˆ†æ®µé”æ¥å®ç°çš„ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ã€‚ HashTable é€šè¿‡é”ä½æ•´ä¸ª put å’Œ get æ–¹æ³•æ¥å®ç°çº¿ç¨‹å®‰å…¨å¹¶ä¸æ˜¯å¾ˆåˆç†ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹åœ¨ put çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½å† put å’Œ get å¿…é¡»è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åŒç†ä¸€ä¸ªçº¿ç¨‹åœ¨ get çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿä¸èƒ½å† get å’Œ put ã€‚ä¸Šé¢é€šè¿‡åˆ†æåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚å› æ­¤ä¹Ÿæ²¡å¿…è¦é”ä½æ•´ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦é”ä½æ¯ä¸ª tab çš„ index é“¾å³å¯ã€‚ ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment ç»§æ‰¿è‡ª ReentrantLock æ¥é”ä½ tab çš„ index é“¾ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized æ¥å®ç°ï¼Œè¿™ä¸¤è€…åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ synchronized çš„åº•å±‚æ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨çš„ã€‚Javaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚å…·ä½“è¡¨ç°æœ‰ä»¥ä¸‹3ç§å½¢å¼ã€‚ //&nbsp;1.å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚thispublic&nbsp;synchronized&nbsp;void&nbsp;method(){}//&nbsp;2.å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚this.classpublic&nbsp;static&nbsp;synchronized&nbsp;void&nbsp;method(){}//&nbsp;3.å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚objectpublic&nbsp;static&nbsp;synchronized&nbsp;void&nbsp;method(){&nbsp;&nbsp;synchronized(object){&nbsp;&nbsp;}} æˆ‘ä»¬å¯èƒ½ä¼šæƒ³é”åˆ°åº•å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿé”é‡Œé¢ä¼šå­˜å‚¨ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿå…¶å® synchronized åŒæ­¥çš„ä»£ç å—ï¼Œè™šæ‹Ÿæœºåœ¨åŒæ­¥ä»£ç å—å¼€å§‹å‰ä¼šæ’å…¥ä¸€æ¡ monitorenter æŒ‡ä»¤ï¼Œåœ¨ä»£ç å—çš„æœ«å°¾ä¼šæ’å…¥ä¸€æ¡ monitorexit æŒ‡ä»¤ã€‚è€Œæ¯ä¸ªå¯¹è±¡çš„ Mark Word å¤´ä¿¡æ¯é‡Œéƒ½ä¼šå­˜å‚¨ Monitor ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å½“å‰å¯¹è±¡çš„é”ä¿¡æ¯ï¼Œå½“ç„¶ Mark Word å¤´ä¿¡æ¯è¿˜åŒ…å«å¯¹è±¡çš„ hashCode å’Œ GC çš„åˆ†ä»£å¹´é¾„ï¼Œå…·ä½“è¯·çœ‹ä¸‹è¡¨ï¼š Lock çš„å®ç°åŸç†å’Œ synchronized æœ‰äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡çº¿ç¨‹çš„åŸå­æ€§æ¥ä¿è¯çº¿ç¨‹åŒæ­¥ï¼Œå…·ä½“çš„å®ç°çš„æ–¹å¼å¤§å®¶å¯ä»¥å»çœ‹ä¸‹ ReentrantLock çš„æºç å®ç°ã€‚é‚£ä¸ºä»€ä¹ˆåœ¨ JDK 1.8 ä¹‹åè¦é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ï¼Ÿåœ¨ JDK 1.6 ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œè¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚è¿™ç§é”å‡çº§å´ä¸èƒ½é™çº§çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚å½“çº¿ç¨‹ 1 è¿›å…¥åŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 0 ï¼Œé‡‡ç”¨ CAS å°†é”çš„çŠ¶æ€è®¾ç½®ä¸º 1ï¼Œåå‘é”è®¾ç½®ä¸º 1ï¼Œé”çš„æ ‡è‡´ä½è®¾ç½®ä¸º 1 ï¼Œç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç å—é‡Œé¢çš„æŒ‡ä»¤ã€‚è¿™æ˜¯è‹¥çº¿ç¨‹ 2 ä¹Ÿæ¥åˆ°äº†åŒæ­¥ä»£ç å—ï¼Œä¹Ÿä¼šé‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 1 è¿›å…¥ç­‰å¾…ä¸­ï¼Œç­‰çº¿ç¨‹ 1 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆä¼šæ¸…ç©ºé”çš„çŠ¶æ€ç„¶åå”¤é†’çº¿ç¨‹ 2 ã€‚å¦‚æ­¤åå¤å³å¯ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ åå‘é” å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹ IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„ Mark Word é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ã€‚å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹ Mark Word ä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ˜¯åå‘é”ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ CAS ç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚ è½»é‡çº§é” çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVM ä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨ CAS å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚ é‡é‡çº§é” è½»é‡çº§é”é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼ä¸æ–­çš„å°è¯•è·å–é”ï¼Œå¦‚æœé•¿æ—¶é—´è·å–ä¸åˆ°é”åŠ¿å¿…ä¼šä¸æ–­æ¶ˆè€— CPU çš„èµ„æºã€‚æ‰€ä»¥å½“çº¿ç¨‹ç«äº‰æ¯”è¾ƒæ¿€çƒˆæˆ–è€…çº¿ç¨‹è¿Ÿè¿Ÿè·å–ä¸åˆ°é”ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§çš„é”çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¸”å“åº”æ—¶é—´ç¼“æ…¢ã€‚ 3. ConcurrentHashMap æºç åˆ†æ //&nbsp;volatile&nbsp;ä¿è¯å¯è§æ€§transient&nbsp;volatile&nbsp;Node&lt;K,V&gt;[]&nbsp;table;//&nbsp;æ–°å¢å…ƒç´ çš„æ–¹æ³•final&nbsp;V&nbsp;putVal(K&nbsp;key,&nbsp;V&nbsp;value,&nbsp;boolean&nbsp;onlyIfAbsent)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(key&nbsp;==&nbsp;null&nbsp;||&nbsp;value&nbsp;==&nbsp;null)&nbsp;throw&nbsp;new&nbsp;NullPointerException();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;äºŒæ¬¡&nbsp;hash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;hash&nbsp;=&nbsp;spread(key.hashCode());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;binCount&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Node&lt;K,V&gt;[]&nbsp;tab&nbsp;=&nbsp;table;;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;&nbsp;f;&nbsp;int&nbsp;n,&nbsp;i,&nbsp;fh;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¦‚æœ&nbsp;tab&nbsp;ä¸ºç©ºï¼Œåˆå§‹åŒ–&nbsp;tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tab&nbsp;==&nbsp;null&nbsp;||&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;==&nbsp;0){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;initTable();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ä¸º&nbsp;null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((f&nbsp;=&nbsp;tabAt(tab,&nbsp;i&nbsp;=&nbsp;(n&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;hash))&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(casTabAt(tab,&nbsp;i,&nbsp;null,&nbsp;new&nbsp;Node&lt;K,V&gt;(hash,&nbsp;key,&nbsp;value,&nbsp;null)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;no&nbsp;lock&nbsp;when&nbsp;adding&nbsp;to&nbsp;empty&nbsp;bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((fh&nbsp;=&nbsp;f.hash)&nbsp;==&nbsp;MOVED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;helpTransfer(tab,&nbsp;f);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;oldVal&nbsp;=&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;é”ä½å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ï¼ˆåˆ†æ®µé”ï¼‰&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(f)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tabAt(tab,&nbsp;i)&nbsp;==&nbsp;f)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fh&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binCount&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;......public&nbsp;V&nbsp;get(Object&nbsp;key)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;[]&nbsp;tab;&nbsp;Node&lt;K,V&gt;&nbsp;e,&nbsp;p;&nbsp;int&nbsp;n,&nbsp;eh;&nbsp;K&nbsp;ek;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;h&nbsp;=&nbsp;spread(key.hashCode());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((tab&nbsp;=&nbsp;table)&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;&gt;&nbsp;0&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CAS&nbsp;æ“ä½œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e&nbsp;=&nbsp;tabAt(tab,&nbsp;(n&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;h))&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((eh&nbsp;=&nbsp;e.hash)&nbsp;==&nbsp;h)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;key.equals(ek)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(eh&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(p&nbsp;=&nbsp;e.find(h,&nbsp;key))&nbsp;!=&nbsp;null&nbsp;?&nbsp;p.val&nbsp;:&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;éå†å½“å‰åˆ—è¡¨&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((e&nbsp;=&nbsp;e.next)&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(e.hash&nbsp;==&nbsp;h&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;key.equals(ek))))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;} æœ€åå€¼å¾—ä¸€æçš„æ˜¯ table å’Œ Node å¯¹è±¡ä¸­çš„ next å’Œ val éƒ½æ˜¯é‡‡ç”¨ volatile æ¥ä¿®é¥°çš„ã€‚ &nbsp;æ¨èâ†“â†“â†“&nbsp; é•¿ æŒ‰ å…³ æ³¨ ğŸ‘‰ã€16ä¸ªæŠ€æœ¯å…¬ä¼—å·ã€‘éƒ½åœ¨è¿™é‡Œï¼ æ¶µç›–ï¼šç¨‹åºå‘˜å¤§å’–ã€æºç å…±è¯»ã€ç¨‹åºå‘˜å…±è¯»ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€é»‘å®¢æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ã€å¤§æ•°æ®ç§‘æŠ€ã€ç¼–ç¨‹å‰ç«¯ã€Javaã€Pythonã€Webç¼–ç¨‹å¼€å‘ã€Androidã€iOSå¼€å‘ã€Linuxã€æ•°æ®åº“ç ”å‘ã€å¹½é»˜ç¨‹åºå‘˜ç­‰ã€‚ ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç‚¹ä¸ª â€œ å¥½çœ‹â€ è¡Œä¸è¡Œ" />
<meta property="og:description" content="Linuxç¼–ç¨‹ ç‚¹å‡»å³ä¾§å…³æ³¨ï¼Œå…è´¹å…¥é—¨åˆ°ç²¾é€šï¼ ä½œè€…ä¸¨çº¢æ©™Darrenhttps://www.jianshu.com/p/0b452a6e4f4e äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ConcurrentHashMap æ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ åœ¨åˆ†æ HashMap æºç æ—¶è¿˜é—ç•™è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬ç«™åœ¨ Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹å’Œ synchronized çš„å®ç°åŸç†ï¼Œè¿™ä¸¤ä¸ªè§’åº¦æ¥å½»åº•åˆ†æä¸€ä¸‹ã€‚è‡³äº JDK 1.8 çš„çº¢é»‘æ ‘ä¸æ˜¯æœ¬æ–‡æ¢è®¨çš„å†…å®¹ã€‚ 1. Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‡ºç°ä¸¤ç§ç°è±¡ï¼Œå¤§æ¦‚ç‡ä¼šå‡ºç°æ•°æ®ä¸¢å¤±ï¼Œå°æ¦‚ç‡ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæˆ‘ä»¬ä¸å¦¨å†™ä¸ªæµ‹è¯•ä»£ç è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚é‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸¤ç§ç°è±¡ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ã€‚è¯·çœ‹å›¾ï¼š Javaå†…å­˜æ¨¡å‹ä¸­è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡åˆ°ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦åœ¨ä¸»å†…å­˜æ¥å®Œæˆï¼Œçº¿ç¨‹ã€ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’å…³ç³»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ ç°åœ¨æˆ‘ä»¬æ¥æƒ³è±¡ä¸€ä¸‹ï¼Œå‡è®¾çº¿ç¨‹ 1 æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå€˜è‹¥è¿™æ—¶è¿˜æ²¡æ¥å¾—åŠå°†æ–°å¢çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…ä¸­ã€‚æ¥ç€çº¿ç¨‹ 2 å°±æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ã€‚æ¥ç€çº¿ç¨‹ 1 æŠŠæ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ 2 ä¹ŸæŠŠæ•°æ®æ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œé‚£ä¹ˆçº¿ç¨‹ 2 å°±ä¼šè¦†ç›–çº¿ç¨‹ 1 çš„æ–°å¢æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚ 2. synchronized çš„åº•å±‚å®ç°åŸç† å…³äº HashMap çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼ŒJava ç»™æˆ‘ä»¬æä¾›äº†ä¸‰ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯ HashTable ï¼Œç¬¬äºŒç§æ˜¯ Collections.synchronizedMap() ï¼Œç¬¬ä¸‰ç§æ˜¯ ConcurrentHashMap ã€‚è€Œç¬¬ä¸€ç§å’Œç¬¬äºŒç§éƒ½æ˜¯é€šè¿‡ç”¨ synchronized åŒæ­¥æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½ä¸Šæœ‰æ‰€æ¬ ç¼ºä¸æ¨èå¤§å®¶ä½¿ç”¨ã€‚ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment åˆ†æ®µé”æ¥å®ç°çš„ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ã€‚ HashTable é€šè¿‡é”ä½æ•´ä¸ª put å’Œ get æ–¹æ³•æ¥å®ç°çº¿ç¨‹å®‰å…¨å¹¶ä¸æ˜¯å¾ˆåˆç†ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹åœ¨ put çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½å† put å’Œ get å¿…é¡»è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åŒç†ä¸€ä¸ªçº¿ç¨‹åœ¨ get çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿä¸èƒ½å† get å’Œ put ã€‚ä¸Šé¢é€šè¿‡åˆ†æåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚å› æ­¤ä¹Ÿæ²¡å¿…è¦é”ä½æ•´ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦é”ä½æ¯ä¸ª tab çš„ index é“¾å³å¯ã€‚ ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment ç»§æ‰¿è‡ª ReentrantLock æ¥é”ä½ tab çš„ index é“¾ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized æ¥å®ç°ï¼Œè¿™ä¸¤è€…åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ synchronized çš„åº•å±‚æ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨çš„ã€‚Javaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚å…·ä½“è¡¨ç°æœ‰ä»¥ä¸‹3ç§å½¢å¼ã€‚ //&nbsp;1.å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚thispublic&nbsp;synchronized&nbsp;void&nbsp;method(){}//&nbsp;2.å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚this.classpublic&nbsp;static&nbsp;synchronized&nbsp;void&nbsp;method(){}//&nbsp;3.å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚objectpublic&nbsp;static&nbsp;synchronized&nbsp;void&nbsp;method(){&nbsp;&nbsp;synchronized(object){&nbsp;&nbsp;}} æˆ‘ä»¬å¯èƒ½ä¼šæƒ³é”åˆ°åº•å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿé”é‡Œé¢ä¼šå­˜å‚¨ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿå…¶å® synchronized åŒæ­¥çš„ä»£ç å—ï¼Œè™šæ‹Ÿæœºåœ¨åŒæ­¥ä»£ç å—å¼€å§‹å‰ä¼šæ’å…¥ä¸€æ¡ monitorenter æŒ‡ä»¤ï¼Œåœ¨ä»£ç å—çš„æœ«å°¾ä¼šæ’å…¥ä¸€æ¡ monitorexit æŒ‡ä»¤ã€‚è€Œæ¯ä¸ªå¯¹è±¡çš„ Mark Word å¤´ä¿¡æ¯é‡Œéƒ½ä¼šå­˜å‚¨ Monitor ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å½“å‰å¯¹è±¡çš„é”ä¿¡æ¯ï¼Œå½“ç„¶ Mark Word å¤´ä¿¡æ¯è¿˜åŒ…å«å¯¹è±¡çš„ hashCode å’Œ GC çš„åˆ†ä»£å¹´é¾„ï¼Œå…·ä½“è¯·çœ‹ä¸‹è¡¨ï¼š Lock çš„å®ç°åŸç†å’Œ synchronized æœ‰äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡çº¿ç¨‹çš„åŸå­æ€§æ¥ä¿è¯çº¿ç¨‹åŒæ­¥ï¼Œå…·ä½“çš„å®ç°çš„æ–¹å¼å¤§å®¶å¯ä»¥å»çœ‹ä¸‹ ReentrantLock çš„æºç å®ç°ã€‚é‚£ä¸ºä»€ä¹ˆåœ¨ JDK 1.8 ä¹‹åè¦é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ï¼Ÿåœ¨ JDK 1.6 ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œè¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚è¿™ç§é”å‡çº§å´ä¸èƒ½é™çº§çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚å½“çº¿ç¨‹ 1 è¿›å…¥åŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 0 ï¼Œé‡‡ç”¨ CAS å°†é”çš„çŠ¶æ€è®¾ç½®ä¸º 1ï¼Œåå‘é”è®¾ç½®ä¸º 1ï¼Œé”çš„æ ‡è‡´ä½è®¾ç½®ä¸º 1 ï¼Œç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç å—é‡Œé¢çš„æŒ‡ä»¤ã€‚è¿™æ˜¯è‹¥çº¿ç¨‹ 2 ä¹Ÿæ¥åˆ°äº†åŒæ­¥ä»£ç å—ï¼Œä¹Ÿä¼šé‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 1 è¿›å…¥ç­‰å¾…ä¸­ï¼Œç­‰çº¿ç¨‹ 1 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆä¼šæ¸…ç©ºé”çš„çŠ¶æ€ç„¶åå”¤é†’çº¿ç¨‹ 2 ã€‚å¦‚æ­¤åå¤å³å¯ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ åå‘é” å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹ IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„ Mark Word é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ã€‚å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹ Mark Word ä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ˜¯åå‘é”ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ CAS ç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚ è½»é‡çº§é” çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVM ä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨ CAS å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚ é‡é‡çº§é” è½»é‡çº§é”é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼ä¸æ–­çš„å°è¯•è·å–é”ï¼Œå¦‚æœé•¿æ—¶é—´è·å–ä¸åˆ°é”åŠ¿å¿…ä¼šä¸æ–­æ¶ˆè€— CPU çš„èµ„æºã€‚æ‰€ä»¥å½“çº¿ç¨‹ç«äº‰æ¯”è¾ƒæ¿€çƒˆæˆ–è€…çº¿ç¨‹è¿Ÿè¿Ÿè·å–ä¸åˆ°é”ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§çš„é”çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¸”å“åº”æ—¶é—´ç¼“æ…¢ã€‚ 3. ConcurrentHashMap æºç åˆ†æ //&nbsp;volatile&nbsp;ä¿è¯å¯è§æ€§transient&nbsp;volatile&nbsp;Node&lt;K,V&gt;[]&nbsp;table;//&nbsp;æ–°å¢å…ƒç´ çš„æ–¹æ³•final&nbsp;V&nbsp;putVal(K&nbsp;key,&nbsp;V&nbsp;value,&nbsp;boolean&nbsp;onlyIfAbsent)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(key&nbsp;==&nbsp;null&nbsp;||&nbsp;value&nbsp;==&nbsp;null)&nbsp;throw&nbsp;new&nbsp;NullPointerException();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;äºŒæ¬¡&nbsp;hash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;hash&nbsp;=&nbsp;spread(key.hashCode());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;binCount&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Node&lt;K,V&gt;[]&nbsp;tab&nbsp;=&nbsp;table;;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;&nbsp;f;&nbsp;int&nbsp;n,&nbsp;i,&nbsp;fh;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¦‚æœ&nbsp;tab&nbsp;ä¸ºç©ºï¼Œåˆå§‹åŒ–&nbsp;tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tab&nbsp;==&nbsp;null&nbsp;||&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;==&nbsp;0){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;initTable();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ä¸º&nbsp;null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((f&nbsp;=&nbsp;tabAt(tab,&nbsp;i&nbsp;=&nbsp;(n&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;hash))&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(casTabAt(tab,&nbsp;i,&nbsp;null,&nbsp;new&nbsp;Node&lt;K,V&gt;(hash,&nbsp;key,&nbsp;value,&nbsp;null)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;no&nbsp;lock&nbsp;when&nbsp;adding&nbsp;to&nbsp;empty&nbsp;bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((fh&nbsp;=&nbsp;f.hash)&nbsp;==&nbsp;MOVED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;helpTransfer(tab,&nbsp;f);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;oldVal&nbsp;=&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;é”ä½å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ï¼ˆåˆ†æ®µé”ï¼‰&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(f)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tabAt(tab,&nbsp;i)&nbsp;==&nbsp;f)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fh&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binCount&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;......public&nbsp;V&nbsp;get(Object&nbsp;key)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;[]&nbsp;tab;&nbsp;Node&lt;K,V&gt;&nbsp;e,&nbsp;p;&nbsp;int&nbsp;n,&nbsp;eh;&nbsp;K&nbsp;ek;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;h&nbsp;=&nbsp;spread(key.hashCode());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((tab&nbsp;=&nbsp;table)&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;&gt;&nbsp;0&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CAS&nbsp;æ“ä½œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e&nbsp;=&nbsp;tabAt(tab,&nbsp;(n&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;h))&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((eh&nbsp;=&nbsp;e.hash)&nbsp;==&nbsp;h)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;key.equals(ek)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(eh&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(p&nbsp;=&nbsp;e.find(h,&nbsp;key))&nbsp;!=&nbsp;null&nbsp;?&nbsp;p.val&nbsp;:&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;éå†å½“å‰åˆ—è¡¨&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((e&nbsp;=&nbsp;e.next)&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(e.hash&nbsp;==&nbsp;h&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;key.equals(ek))))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;} æœ€åå€¼å¾—ä¸€æçš„æ˜¯ table å’Œ Node å¯¹è±¡ä¸­çš„ next å’Œ val éƒ½æ˜¯é‡‡ç”¨ volatile æ¥ä¿®é¥°çš„ã€‚ &nbsp;æ¨èâ†“â†“â†“&nbsp; é•¿ æŒ‰ å…³ æ³¨ ğŸ‘‰ã€16ä¸ªæŠ€æœ¯å…¬ä¼—å·ã€‘éƒ½åœ¨è¿™é‡Œï¼ æ¶µç›–ï¼šç¨‹åºå‘˜å¤§å’–ã€æºç å…±è¯»ã€ç¨‹åºå‘˜å…±è¯»ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€é»‘å®¢æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ã€å¤§æ•°æ®ç§‘æŠ€ã€ç¼–ç¨‹å‰ç«¯ã€Javaã€Pythonã€Webç¼–ç¨‹å¼€å‘ã€Androidã€iOSå¼€å‘ã€Linuxã€æ•°æ®åº“ç ”å‘ã€å¹½é»˜ç¨‹åºå‘˜ç­‰ã€‚ ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç‚¹ä¸ª â€œ å¥½çœ‹â€ è¡Œä¸è¡Œ" />
<meta property="og:site_name" content="æœ‰ç»„ç»‡åœ¨ï¼" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-08T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"Linuxç¼–ç¨‹ ç‚¹å‡»å³ä¾§å…³æ³¨ï¼Œå…è´¹å…¥é—¨åˆ°ç²¾é€šï¼ ä½œè€…ä¸¨çº¢æ©™Darrenhttps://www.jianshu.com/p/0b452a6e4f4e äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ConcurrentHashMap æ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ åœ¨åˆ†æ HashMap æºç æ—¶è¿˜é—ç•™è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬ç«™åœ¨ Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹å’Œ synchronized çš„å®ç°åŸç†ï¼Œè¿™ä¸¤ä¸ªè§’åº¦æ¥å½»åº•åˆ†æä¸€ä¸‹ã€‚è‡³äº JDK 1.8 çš„çº¢é»‘æ ‘ä¸æ˜¯æœ¬æ–‡æ¢è®¨çš„å†…å®¹ã€‚ 1. Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‡ºç°ä¸¤ç§ç°è±¡ï¼Œå¤§æ¦‚ç‡ä¼šå‡ºç°æ•°æ®ä¸¢å¤±ï¼Œå°æ¦‚ç‡ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæˆ‘ä»¬ä¸å¦¨å†™ä¸ªæµ‹è¯•ä»£ç è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚é‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸¤ç§ç°è±¡ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ã€‚è¯·çœ‹å›¾ï¼š Javaå†…å­˜æ¨¡å‹ä¸­è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡åˆ°ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦åœ¨ä¸»å†…å­˜æ¥å®Œæˆï¼Œçº¿ç¨‹ã€ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’å…³ç³»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ ç°åœ¨æˆ‘ä»¬æ¥æƒ³è±¡ä¸€ä¸‹ï¼Œå‡è®¾çº¿ç¨‹ 1 æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå€˜è‹¥è¿™æ—¶è¿˜æ²¡æ¥å¾—åŠå°†æ–°å¢çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…ä¸­ã€‚æ¥ç€çº¿ç¨‹ 2 å°±æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ã€‚æ¥ç€çº¿ç¨‹ 1 æŠŠæ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ 2 ä¹ŸæŠŠæ•°æ®æ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œé‚£ä¹ˆçº¿ç¨‹ 2 å°±ä¼šè¦†ç›–çº¿ç¨‹ 1 çš„æ–°å¢æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚ 2. synchronized çš„åº•å±‚å®ç°åŸç† å…³äº HashMap çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼ŒJava ç»™æˆ‘ä»¬æä¾›äº†ä¸‰ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯ HashTable ï¼Œç¬¬äºŒç§æ˜¯ Collections.synchronizedMap() ï¼Œç¬¬ä¸‰ç§æ˜¯ ConcurrentHashMap ã€‚è€Œç¬¬ä¸€ç§å’Œç¬¬äºŒç§éƒ½æ˜¯é€šè¿‡ç”¨ synchronized åŒæ­¥æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½ä¸Šæœ‰æ‰€æ¬ ç¼ºä¸æ¨èå¤§å®¶ä½¿ç”¨ã€‚ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment åˆ†æ®µé”æ¥å®ç°çš„ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ã€‚ HashTable é€šè¿‡é”ä½æ•´ä¸ª put å’Œ get æ–¹æ³•æ¥å®ç°çº¿ç¨‹å®‰å…¨å¹¶ä¸æ˜¯å¾ˆåˆç†ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹åœ¨ put çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½å† put å’Œ get å¿…é¡»è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åŒç†ä¸€ä¸ªçº¿ç¨‹åœ¨ get çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿä¸èƒ½å† get å’Œ put ã€‚ä¸Šé¢é€šè¿‡åˆ†æåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚å› æ­¤ä¹Ÿæ²¡å¿…è¦é”ä½æ•´ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦é”ä½æ¯ä¸ª tab çš„ index é“¾å³å¯ã€‚ ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment ç»§æ‰¿è‡ª ReentrantLock æ¥é”ä½ tab çš„ index é“¾ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized æ¥å®ç°ï¼Œè¿™ä¸¤è€…åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ synchronized çš„åº•å±‚æ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨çš„ã€‚Javaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚å…·ä½“è¡¨ç°æœ‰ä»¥ä¸‹3ç§å½¢å¼ã€‚ //&nbsp;1.å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚thispublic&nbsp;synchronized&nbsp;void&nbsp;method(){}//&nbsp;2.å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚this.classpublic&nbsp;static&nbsp;synchronized&nbsp;void&nbsp;method(){}//&nbsp;3.å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚objectpublic&nbsp;static&nbsp;synchronized&nbsp;void&nbsp;method(){&nbsp;&nbsp;synchronized(object){&nbsp;&nbsp;}} æˆ‘ä»¬å¯èƒ½ä¼šæƒ³é”åˆ°åº•å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿé”é‡Œé¢ä¼šå­˜å‚¨ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿå…¶å® synchronized åŒæ­¥çš„ä»£ç å—ï¼Œè™šæ‹Ÿæœºåœ¨åŒæ­¥ä»£ç å—å¼€å§‹å‰ä¼šæ’å…¥ä¸€æ¡ monitorenter æŒ‡ä»¤ï¼Œåœ¨ä»£ç å—çš„æœ«å°¾ä¼šæ’å…¥ä¸€æ¡ monitorexit æŒ‡ä»¤ã€‚è€Œæ¯ä¸ªå¯¹è±¡çš„ Mark Word å¤´ä¿¡æ¯é‡Œéƒ½ä¼šå­˜å‚¨ Monitor ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å½“å‰å¯¹è±¡çš„é”ä¿¡æ¯ï¼Œå½“ç„¶ Mark Word å¤´ä¿¡æ¯è¿˜åŒ…å«å¯¹è±¡çš„ hashCode å’Œ GC çš„åˆ†ä»£å¹´é¾„ï¼Œå…·ä½“è¯·çœ‹ä¸‹è¡¨ï¼š Lock çš„å®ç°åŸç†å’Œ synchronized æœ‰äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡çº¿ç¨‹çš„åŸå­æ€§æ¥ä¿è¯çº¿ç¨‹åŒæ­¥ï¼Œå…·ä½“çš„å®ç°çš„æ–¹å¼å¤§å®¶å¯ä»¥å»çœ‹ä¸‹ ReentrantLock çš„æºç å®ç°ã€‚é‚£ä¸ºä»€ä¹ˆåœ¨ JDK 1.8 ä¹‹åè¦é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ï¼Ÿåœ¨ JDK 1.6 ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œè¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚è¿™ç§é”å‡çº§å´ä¸èƒ½é™çº§çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚å½“çº¿ç¨‹ 1 è¿›å…¥åŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 0 ï¼Œé‡‡ç”¨ CAS å°†é”çš„çŠ¶æ€è®¾ç½®ä¸º 1ï¼Œåå‘é”è®¾ç½®ä¸º 1ï¼Œé”çš„æ ‡è‡´ä½è®¾ç½®ä¸º 1 ï¼Œç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç å—é‡Œé¢çš„æŒ‡ä»¤ã€‚è¿™æ˜¯è‹¥çº¿ç¨‹ 2 ä¹Ÿæ¥åˆ°äº†åŒæ­¥ä»£ç å—ï¼Œä¹Ÿä¼šé‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 1 è¿›å…¥ç­‰å¾…ä¸­ï¼Œç­‰çº¿ç¨‹ 1 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆä¼šæ¸…ç©ºé”çš„çŠ¶æ€ç„¶åå”¤é†’çº¿ç¨‹ 2 ã€‚å¦‚æ­¤åå¤å³å¯ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ åå‘é” å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹ IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„ Mark Word é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ã€‚å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹ Mark Word ä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ˜¯åå‘é”ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ CAS ç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚ è½»é‡çº§é” çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVM ä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨ CAS å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚ é‡é‡çº§é” è½»é‡çº§é”é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼ä¸æ–­çš„å°è¯•è·å–é”ï¼Œå¦‚æœé•¿æ—¶é—´è·å–ä¸åˆ°é”åŠ¿å¿…ä¼šä¸æ–­æ¶ˆè€— CPU çš„èµ„æºã€‚æ‰€ä»¥å½“çº¿ç¨‹ç«äº‰æ¯”è¾ƒæ¿€çƒˆæˆ–è€…çº¿ç¨‹è¿Ÿè¿Ÿè·å–ä¸åˆ°é”ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§çš„é”çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¸”å“åº”æ—¶é—´ç¼“æ…¢ã€‚ 3. ConcurrentHashMap æºç åˆ†æ //&nbsp;volatile&nbsp;ä¿è¯å¯è§æ€§transient&nbsp;volatile&nbsp;Node&lt;K,V&gt;[]&nbsp;table;//&nbsp;æ–°å¢å…ƒç´ çš„æ–¹æ³•final&nbsp;V&nbsp;putVal(K&nbsp;key,&nbsp;V&nbsp;value,&nbsp;boolean&nbsp;onlyIfAbsent)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(key&nbsp;==&nbsp;null&nbsp;||&nbsp;value&nbsp;==&nbsp;null)&nbsp;throw&nbsp;new&nbsp;NullPointerException();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;äºŒæ¬¡&nbsp;hash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;hash&nbsp;=&nbsp;spread(key.hashCode());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;binCount&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Node&lt;K,V&gt;[]&nbsp;tab&nbsp;=&nbsp;table;;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;&nbsp;f;&nbsp;int&nbsp;n,&nbsp;i,&nbsp;fh;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¦‚æœ&nbsp;tab&nbsp;ä¸ºç©ºï¼Œåˆå§‹åŒ–&nbsp;tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tab&nbsp;==&nbsp;null&nbsp;||&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;==&nbsp;0){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;initTable();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ä¸º&nbsp;null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((f&nbsp;=&nbsp;tabAt(tab,&nbsp;i&nbsp;=&nbsp;(n&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;hash))&nbsp;==&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(casTabAt(tab,&nbsp;i,&nbsp;null,&nbsp;new&nbsp;Node&lt;K,V&gt;(hash,&nbsp;key,&nbsp;value,&nbsp;null)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;no&nbsp;lock&nbsp;when&nbsp;adding&nbsp;to&nbsp;empty&nbsp;bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((fh&nbsp;=&nbsp;f.hash)&nbsp;==&nbsp;MOVED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;helpTransfer(tab,&nbsp;f);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;oldVal&nbsp;=&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;é”ä½å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ï¼ˆåˆ†æ®µé”ï¼‰&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(f)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(tabAt(tab,&nbsp;i)&nbsp;==&nbsp;f)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fh&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binCount&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;......public&nbsp;V&nbsp;get(Object&nbsp;key)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;[]&nbsp;tab;&nbsp;Node&lt;K,V&gt;&nbsp;e,&nbsp;p;&nbsp;int&nbsp;n,&nbsp;eh;&nbsp;K&nbsp;ek;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;h&nbsp;=&nbsp;spread(key.hashCode());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((tab&nbsp;=&nbsp;table)&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;&gt;&nbsp;0&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;CAS&nbsp;æ“ä½œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e&nbsp;=&nbsp;tabAt(tab,&nbsp;(n&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;h))&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((eh&nbsp;=&nbsp;e.hash)&nbsp;==&nbsp;h)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;key.equals(ek)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(eh&nbsp;&lt;&nbsp;0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(p&nbsp;=&nbsp;e.find(h,&nbsp;key))&nbsp;!=&nbsp;null&nbsp;?&nbsp;p.val&nbsp;:&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;éå†å½“å‰åˆ—è¡¨&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((e&nbsp;=&nbsp;e.next)&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(e.hash&nbsp;==&nbsp;h&nbsp;&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;key.equals(ek))))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;&nbsp;&nbsp;&nbsp;&nbsp;} æœ€åå€¼å¾—ä¸€æçš„æ˜¯ table å’Œ Node å¯¹è±¡ä¸­çš„ next å’Œ val éƒ½æ˜¯é‡‡ç”¨ volatile æ¥ä¿®é¥°çš„ã€‚ &nbsp;æ¨èâ†“â†“â†“&nbsp; é•¿ æŒ‰ å…³ æ³¨ ğŸ‘‰ã€16ä¸ªæŠ€æœ¯å…¬ä¼—å·ã€‘éƒ½åœ¨è¿™é‡Œï¼ æ¶µç›–ï¼šç¨‹åºå‘˜å¤§å’–ã€æºç å…±è¯»ã€ç¨‹åºå‘˜å…±è¯»ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€é»‘å®¢æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ã€å¤§æ•°æ®ç§‘æŠ€ã€ç¼–ç¨‹å‰ç«¯ã€Javaã€Pythonã€Webç¼–ç¨‹å¼€å‘ã€Androidã€iOSå¼€å‘ã€Linuxã€æ•°æ®åº“ç ”å‘ã€å¹½é»˜ç¨‹åºå‘˜ç­‰ã€‚ ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç‚¹ä¸ª â€œ å¥½çœ‹â€ è¡Œä¸è¡Œ","@type":"BlogPosting","url":"/2019/04/08/728203.html","headline":"æ•°æ®ç»“æ„ç®—æ³• - ConcurrentHashMap æºç è§£æ","dateModified":"2019-04-08T00:00:00+08:00","datePublished":"2019-04-08T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/04/08/728203.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>æ•°æ®ç»“æ„ç®—æ³• - ConcurrentHashMap æºç è§£æ</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>æŸšå­ç¤¾åŒº</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="text-align:center;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/XUfq62QbuNhyG8Y9IxZUNMLyjv7k7dsq3bia9CRMmdkOM1WyLYEHlib4MFfrqRE97iaUqJ7NwhZEoHu0U8NCXWzsA/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
   <p style="min-height:1em;text-align:center;"><a href="https://mp.weixin.qq.com/s?__biz=MzU2MzcxNzgwMg==&amp;mid=2247483650&amp;idx=3&amp;sn=7d8d32410010e2f58a8b0e9b15fa23ec&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img style="letter-spacing:.544px;text-align:justify;color:rgb(62,62,62);width:76px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/XUfq62QbuNiaFZIbV1icByYIGKRlUcFt6IBMGhWJcyxibORgs6MEmSnJlA3ibibR7ibpudwZAbFZdqISttPaQTBkPPtQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a></p>
   <a href="https://mp.weixin.qq.com/s?__biz=MzU2MzcxNzgwMg==&amp;mid=2247483650&amp;idx=3&amp;sn=7d8d32410010e2f58a8b0e9b15fa23ec&amp;scene=21#wechat_redirect" rel="nofollow"><span style="font-family:'å®‹ä½“', SimSun;"><strong><span style="letter-spacing:.544px;color:rgb(31,73,125);"><strong>Linuxç¼–ç¨‹</strong></span></strong></span></a>
   <span style="font-family:'é»‘ä½“', SimHei;"><strong><span style="letter-spacing:.544px;color:rgb(31,73,125);"></span></strong><strong><span style="letter-spacing:.544px;color:rgb(31,73,125);"></span></strong><strong><span style="letter-spacing:.544px;color:rgb(31,73,125);"></span></strong></span>
   <a href="https://mp.weixin.qq.com/s?__biz=MzU2MzcxNzgwMg==&amp;mid=2247483650&amp;idx=3&amp;sn=7d8d32410010e2f58a8b0e9b15fa23ec&amp;scene=21#wechat_redirect" rel="nofollow"><span style="letter-spacing:.544px;color:rgb(165,165,165);font-family:'é»‘ä½“', SimHei;"><span>ç‚¹å‡»å³ä¾§å…³æ³¨ï¼Œå…è´¹å…¥é—¨åˆ°ç²¾é€šï¼</span></span></a>
   <a href="https://mp.weixin.qq.com/s?__biz=MzU2MzcxNzgwMg==&amp;mid=2247483650&amp;idx=3&amp;sn=7d8d32410010e2f58a8b0e9b15fa23ec&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link"><img style="width:56px;" title="1081255447.jpg" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/XUfq62QbuNiaFZIbV1icByYIGKRlUcFt6IldAicZsKdD8KXBZkWQz1eHWULt7Sy2XUdKWbFt8oY6f6nL5deCuF9yg/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></span></a>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:14px;color:rgb(136,136,136);">ä½œè€…ä¸¨çº¢æ©™Darren<br style="color:rgb(74,74,74);font-size:16px;">https://www.jianshu.com/p/0b452a6e4f4e</span></p>
   <p><br></p>
   <ul class="list-paddingleft-2">
    <li><p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span></p></li>
    <li><p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">ConcurrentHashMap æ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</span></p></li>
   </ul>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">åœ¨åˆ†æ HashMap æºç æ—¶è¿˜é—ç•™è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ¬¡æˆ‘ä»¬ç«™åœ¨ Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹å’Œ synchronized çš„å®ç°åŸç†ï¼Œè¿™ä¸¤ä¸ªè§’åº¦æ¥å½»åº•åˆ†æä¸€ä¸‹ã€‚è‡³äº JDK 1.8 çš„çº¢é»‘æ ‘ä¸æ˜¯æœ¬æ–‡æ¢è®¨çš„å†…å®¹ã€‚</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><img class="__bg_gif" style="font-size:8px;color:rgb(0,128,255);font-family:'å®‹ä½“';text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif"><span style="color:rgb(0,82,255);font-size:16px;letter-spacing:1px;">1. Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">äº”ä¸ªçº¿ç¨‹åŒæ—¶å¾€ HashMap ä¸­ put æ•°æ®ä¼šå‡ºç°ä¸¤ç§ç°è±¡ï¼Œå¤§æ¦‚ç‡ä¼šå‡ºç°æ•°æ®ä¸¢å¤±ï¼Œå°æ¦‚ç‡ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæˆ‘ä»¬ä¸å¦¨å†™ä¸ªæµ‹è¯•ä»£ç è‡ªå·±éªŒè¯ä¸€ä¸‹ã€‚é‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸¤ç§ç°è±¡ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„Java å¤šçº¿ç¨‹å†…å­˜æ¨¡å‹ã€‚è¯·çœ‹å›¾ï¼š</span></p>
   <p><br></p>
   <p style="letter-spacing:1px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz/LZqrxYJzgib0sSB360rsvAHmbQmmS37j5oO32Oicmy4xMiaibLibfJK9dvrM1qYIIXB4Nu13z0p4ADeQPRXZSI5dgjQ/640?wx_fmt=other" alt="640?wx_fmt=other"></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">Javaå†…å­˜æ¨¡å‹ä¸­è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡åˆ°ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦åœ¨ä¸»å†…å­˜æ¥å®Œæˆï¼Œçº¿ç¨‹ã€ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’å…³ç³»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">ç°åœ¨æˆ‘ä»¬æ¥æƒ³è±¡ä¸€ä¸‹ï¼Œå‡è®¾çº¿ç¨‹ 1 æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå€˜è‹¥è¿™æ—¶è¿˜æ²¡æ¥å¾—åŠå°†æ–°å¢çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…ä¸­ã€‚æ¥ç€çº¿ç¨‹ 2 å°±æŠŠæ•°æ®è¯»åˆ°äº†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåœ¨ tab è§’æ ‡ä¸º 1 çš„é“¾è¡¨å¤´æ’å…¥äº†ä¸€æ¡æ–°çš„æ•°æ®ã€‚æ¥ç€çº¿ç¨‹ 1 æŠŠæ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ 2 ä¹ŸæŠŠæ•°æ®æ–°å¢æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œé‚£ä¹ˆçº¿ç¨‹ 2 å°±ä¼šè¦†ç›–çº¿ç¨‹ 1 çš„æ–°å¢æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <h4 style="letter-spacing:1px;"><span style="color:rgb(74,74,74);"><img class="__bg_gif" style="font-size:8px;color:rgb(0,128,255);font-family:'å®‹ä½“';text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif"></span><span style="color:rgb(0,82,255);">2. synchronized çš„åº•å±‚å®ç°åŸç†</span></h4>
   <p style="letter-spacing:1px;"><span style="color:rgb(0,82,255);"><br></span></p>
   <p style="letter-spacing:1px;"><span style="color:rgb(74,74,74);font-size:16px;letter-spacing:1px;">å…³äº HashMap çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼ŒJava ç»™æˆ‘ä»¬æä¾›äº†ä¸‰ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯ HashTable ï¼Œç¬¬äºŒç§æ˜¯ Collections.synchronizedMap() ï¼Œç¬¬ä¸‰ç§æ˜¯ ConcurrentHashMap ã€‚è€Œç¬¬ä¸€ç§å’Œç¬¬äºŒç§éƒ½æ˜¯é€šè¿‡ç”¨ synchronized åŒæ­¥æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½ä¸Šæœ‰æ‰€æ¬ ç¼ºä¸æ¨èå¤§å®¶ä½¿ç”¨ã€‚ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment åˆ†æ®µé”æ¥å®ç°çš„ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ã€‚</span><br></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">HashTable é€šè¿‡é”ä½æ•´ä¸ª put å’Œ get æ–¹æ³•æ¥å®ç°çº¿ç¨‹å®‰å…¨å¹¶ä¸æ˜¯å¾ˆåˆç†ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹åœ¨ put çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½å† put å’Œ get å¿…é¡»è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åŒç†ä¸€ä¸ªçº¿ç¨‹åœ¨ get çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿä¸èƒ½å† get å’Œ put ã€‚ä¸Šé¢é€šè¿‡åˆ†æåªæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œ tab çš„åŒä¸€ä¸ª index é“¾è¡¨æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ª index é“¾è¡¨å°±ä¸ä¼šæœ‰è¦†ç›–å’Œä¸¢å¤±è¿™ä¸€è¯´ã€‚å› æ­¤ä¹Ÿæ²¡å¿…è¦é”ä½æ•´ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦é”ä½æ¯ä¸ª tab çš„ index é“¾å³å¯ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">ConcurrentHashMap åœ¨ JDK 1.8 ä¹‹å‰é‡‡ç”¨çš„æ˜¯ Segment ç»§æ‰¿è‡ª ReentrantLock æ¥é”ä½ tab çš„ index é“¾ï¼Œè€Œ JDK 1.8 ä¹‹ååˆ™é‡‡ç”¨ synchronized æ¥å®ç°ï¼Œè¿™ä¸¤è€…åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹ synchronized çš„åº•å±‚æ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨çš„ã€‚Javaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚å…·ä½“è¡¨ç°æœ‰ä»¥ä¸‹3ç§å½¢å¼ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <pre><code class="language-java"></code></pre>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);letter-spacing:1px;"><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;1.å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚this</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">public</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">synchronized</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">void</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">method</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span></span>{<br><br>}<br><br><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;2.å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚this.class</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">public</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">static</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">synchronized</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">void</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">method</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span></span>{<br><br>}<br><br><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;3.å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚object</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">public</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">static</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">synchronized</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">void</span>&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">method</span><span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">()</span></span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">synchronized</span>(object){<br><br>&nbsp;&nbsp;}<br>}<br></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">æˆ‘ä»¬å¯èƒ½ä¼šæƒ³é”åˆ°åº•å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿé”é‡Œé¢ä¼šå­˜å‚¨ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿå…¶å® synchronized åŒæ­¥çš„ä»£ç å—ï¼Œè™šæ‹Ÿæœºåœ¨åŒæ­¥ä»£ç å—å¼€å§‹å‰ä¼šæ’å…¥ä¸€æ¡ monitorenter æŒ‡ä»¤ï¼Œåœ¨ä»£ç å—çš„æœ«å°¾ä¼šæ’å…¥ä¸€æ¡ monitorexit æŒ‡ä»¤ã€‚è€Œæ¯ä¸ªå¯¹è±¡çš„ Mark Word å¤´ä¿¡æ¯é‡Œéƒ½ä¼šå­˜å‚¨ Monitor ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å½“å‰å¯¹è±¡çš„é”ä¿¡æ¯ï¼Œå½“ç„¶ Mark Word å¤´ä¿¡æ¯è¿˜åŒ…å«å¯¹è±¡çš„ hashCode å’Œ GC çš„åˆ†ä»£å¹´é¾„ï¼Œå…·ä½“è¯·çœ‹ä¸‹è¡¨ï¼š</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="text-align:center;letter-spacing:1px;"><img class="rich_pages" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/LZqrxYJzgib0sSB360rsvAHmbQmmS37j5T5Fra50sOxabicWwpyggkW3hicich1GCRr9lpps6UQzOCdmTW29Ckextg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="color:rgb(74,74,74);font-size:16px;">Lock çš„å®ç°åŸç†å’Œ synchronized æœ‰äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡çº¿ç¨‹çš„åŸå­æ€§æ¥ä¿è¯çº¿ç¨‹åŒæ­¥ï¼Œå…·ä½“çš„å®ç°çš„æ–¹å¼å¤§å®¶å¯ä»¥å»çœ‹ä¸‹ ReentrantLock çš„æºç å®ç°ã€‚é‚£ä¸ºä»€ä¹ˆåœ¨ JDK 1.8 ä¹‹åè¦é‡‡ç”¨ synchronized å’Œ CAS æ¥å®ç°ï¼Ÿåœ¨ JDK 1.6 ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œè¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚è¿™ç§é”å‡çº§å´ä¸èƒ½é™çº§çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</span><span style="font-size:16px;color:rgb(74,74,74);">å½“çº¿ç¨‹ 1 è¿›å…¥åŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 0 ï¼Œé‡‡ç”¨ CAS å°†é”çš„çŠ¶æ€è®¾ç½®ä¸º 1ï¼Œåå‘é”è®¾ç½®ä¸º 1ï¼Œé”çš„æ ‡è‡´ä½è®¾ç½®ä¸º 1 ï¼Œç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç å—é‡Œé¢çš„æŒ‡ä»¤ã€‚è¿™æ˜¯è‹¥çº¿ç¨‹ 2 ä¹Ÿæ¥åˆ°äº†åŒæ­¥ä»£ç å—ï¼Œä¹Ÿä¼šé‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€å‘ç°æ˜¯ 1 è¿›å…¥ç­‰å¾…ä¸­ï¼Œç­‰çº¿ç¨‹ 1 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—é‡åˆ° monitorenter æŒ‡ä»¤ï¼Œé¦–å…ˆä¼šæ¸…ç©ºé”çš„çŠ¶æ€ç„¶åå”¤é†’çº¿ç¨‹ 2 ã€‚å¦‚æ­¤åå¤å³å¯ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><strong><span style="font-size:16px;color:rgb(74,74,74);">åå‘é”</span></strong></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹ IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„ Mark Word é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ã€‚å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹ Mark Word ä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ˜¯åå‘é”ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ CAS ç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><strong><span style="font-size:16px;color:rgb(74,74,74);">è½»é‡çº§é”</span></strong></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVM ä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨ CAS å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><strong><span style="font-size:16px;color:rgb(74,74,74);">é‡é‡çº§é”</span></strong></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">è½»é‡çº§é”é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼ä¸æ–­çš„å°è¯•è·å–é”ï¼Œå¦‚æœé•¿æ—¶é—´è·å–ä¸åˆ°é”åŠ¿å¿…ä¼šä¸æ–­æ¶ˆè€— CPU çš„èµ„æºã€‚æ‰€ä»¥å½“çº¿ç¨‹ç«äº‰æ¯”è¾ƒæ¿€çƒˆæˆ–è€…çº¿ç¨‹è¿Ÿè¿Ÿè·å–ä¸åˆ°é”ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§çš„é”çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¸”å“åº”æ—¶é—´ç¼“æ…¢ã€‚</span></p>
   <p style="letter-spacing:1px;"><br></p>
   <h4 style="letter-spacing:1px;"><span style="color:rgb(74,74,74);"><img class="__bg_gif" style="font-size:8px;color:rgb(0,128,255);font-family:'å®‹ä½“';text-align:center;vertical-align:middle;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/IwiaNBuWUDUw4OUxv50sClowAsFgibBOT8DicW3x9nlUu6buibjSVPyf3vst4EuG4dZOZcB2P62icZnyEMeP8eqoYog/640?wx_fmt=gif" alt="640?wx_fmt=gif"></span><span style="color:rgb(0,82,255);">3. ConcurrentHashMap æºç åˆ†æ</span></h4>
   <p style="letter-spacing:1px;"><br></p>
   <pre><code class="language-java"></code></pre>
   <pre style="font-size:inherit;color:inherit;line-height:inherit;"></pre>
   <p style="margin-left:2px;line-height:18px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;color:rgb(169,183,198);background:rgb(40,43,46);letter-spacing:1px;"><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;volatile&nbsp;ä¿è¯å¯è§æ€§</span><br>transient&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">volatile</span>&nbsp;Node&lt;K,V&gt;[]&nbsp;table;<br><br><span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;æ–°å¢å…ƒç´ çš„æ–¹æ³•</span><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">final&nbsp;V&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">putVal</span>(<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">K&nbsp;key,&nbsp;V&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">value</span>,&nbsp;boolean&nbsp;onlyIfAbsent</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(key&nbsp;==&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>&nbsp;||&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">value</span>&nbsp;==&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>)&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">throw</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">new</span>&nbsp;NullPointerException();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;äºŒæ¬¡&nbsp;hash&nbsp;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">int</span>&nbsp;hash&nbsp;=&nbsp;spread(key.hashCode());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">int</span>&nbsp;binCount&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">for</span>&nbsp;(Node&lt;K,V&gt;[]&nbsp;tab&nbsp;=&nbsp;table;;)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;&nbsp;f;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">int</span>&nbsp;n,&nbsp;i,&nbsp;fh;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;å¦‚æœ&nbsp;tab&nbsp;ä¸ºç©ºï¼Œåˆå§‹åŒ–&nbsp;tab</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(tab&nbsp;==&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>&nbsp;||&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;==&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;initTable();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ä¸º&nbsp;null</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">else</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;((f&nbsp;=&nbsp;tabAt(tab,&nbsp;i&nbsp;=&nbsp;(n&nbsp;-&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>)&nbsp;&amp;&nbsp;hash))&nbsp;==&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(casTabAt(tab,&nbsp;i,&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>,&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">new</span>&nbsp;Node&lt;K,V&gt;(hash,&nbsp;key,&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">value</span>,&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">break</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;no&nbsp;lock&nbsp;when&nbsp;adding&nbsp;to&nbsp;empty&nbsp;bin</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">else</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;((fh&nbsp;=&nbsp;f.hash)&nbsp;==&nbsp;MOVED)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab&nbsp;=&nbsp;helpTransfer(tab,&nbsp;f);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;oldVal&nbsp;=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;é”ä½å½“å‰&nbsp;tab&nbsp;çš„&nbsp;index&nbsp;é“¾è¡¨ï¼ˆåˆ†æ®µé”ï¼‰</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized&nbsp;(f)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(tabAt(tab,&nbsp;i)&nbsp;==&nbsp;f)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(fh&nbsp;&gt;=&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binCount&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;......</span><br><br><span class="hljs-function" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);"><span class="hljs-keyword" style="font-size:inherit;line-height:inherit;">public</span>&nbsp;V&nbsp;<span class="hljs-title" style="font-size:inherit;line-height:inherit;color:rgb(165,218,45);">get</span>(<span class="hljs-params" style="font-size:inherit;line-height:inherit;color:rgb(255,152,35);">Object&nbsp;key</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Node&lt;K,V&gt;[]&nbsp;tab;&nbsp;Node&lt;K,V&gt;&nbsp;e,&nbsp;p;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">int</span>&nbsp;n,&nbsp;eh;&nbsp;K&nbsp;ek;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">int</span>&nbsp;h&nbsp;=&nbsp;spread(key.hashCode());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;((tab&nbsp;=&nbsp;table)&nbsp;!=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>&nbsp;&amp;&amp;&nbsp;(n&nbsp;=&nbsp;tab.length)&nbsp;&gt;&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>&nbsp;&amp;&amp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;CAS&nbsp;æ“ä½œ</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e&nbsp;=&nbsp;tabAt(tab,&nbsp;(n&nbsp;-&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">1</span>)&nbsp;&amp;&nbsp;h))&nbsp;!=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;((eh&nbsp;=&nbsp;e.hash)&nbsp;==&nbsp;h)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>&nbsp;&amp;&amp;&nbsp;key.<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">equals</span>(ek)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;e.val;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">else</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(eh&nbsp;&lt;&nbsp;<span class="hljs-number" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;(p&nbsp;=&nbsp;e.find(h,&nbsp;key))&nbsp;!=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>&nbsp;?&nbsp;p.val&nbsp;:&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;line-height:inherit;color:rgb(128,128,128);">//&nbsp;éå†å½“å‰åˆ—è¡¨</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">while</span>&nbsp;((e&nbsp;=&nbsp;e.next)&nbsp;!=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">if</span>&nbsp;(e.hash&nbsp;==&nbsp;h&nbsp;&amp;&amp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ek&nbsp;=&nbsp;e.key)&nbsp;==&nbsp;key&nbsp;||&nbsp;(ek&nbsp;!=&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>&nbsp;&amp;&amp;&nbsp;key.<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">equals</span>(ek))))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;e.val;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;line-height:inherit;color:rgb(248,35,117);">return</span>&nbsp;<span class="hljs-literal" style="font-size:inherit;line-height:inherit;color:rgb(174,135,250);">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></p>
   <p style="letter-spacing:1px;"><br></p>
   <p style="letter-spacing:1px;"><span style="font-size:16px;color:rgb(74,74,74);">æœ€åå€¼å¾—ä¸€æçš„æ˜¯ table å’Œ Node å¯¹è±¡ä¸­çš„ next å’Œ val éƒ½æ˜¯é‡‡ç”¨ volatile æ¥ä¿®é¥°çš„ã€‚</span></p>
   <p><br></p>
   <p style="text-align:center;letter-spacing:1.5px;"><span style="color:rgb(255,255,255);"><strong><span style="font-size:20px;">&nbsp;æ¨èâ†“â†“â†“&nbsp;</span></strong></span></p>
   <img style="vertical-align:middle;width:313px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/IwiaNBuWUDUzX3vMCt57DzWD1FUkicYK3C3VObzhyt4YU3rXujLwMXHoHqpB6B72h44DNib9J9jbQHk3giaxAeABWg/640?wx_fmt=png" alt="640?wx_fmt=png">
   <p><strong>é•¿</strong></p>
   <p><strong>æŒ‰</strong></p>
   <p><strong>å…³</strong></p>
   <p><strong>æ³¨</strong></p>
   <p style="letter-spacing:0px;"><strong><span style="font-size:18px;">ğŸ‘‰</span></strong><span style="font-size:17px;"><strong>ã€</strong></span><a href="https://mp.weixin.qq.com/s?__biz=MzUzMDc0NzU4Nw==&amp;mid=2247483768&amp;idx=1&amp;sn=4ef4f1510616baa395c507e32bb439d7&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;color:rgb(255,79,121);font-size:17px;"><span style="color:rgb(255,79,121);font-size:17px;"><strong>16ä¸ªæŠ€æœ¯å…¬ä¼—å·</strong></span></a><span style="font-size:17px;"><strong>ã€‘éƒ½åœ¨è¿™é‡Œï¼</strong></span></p>
   <p><span style="color:rgb(136,136,136);font-size:15px;">æ¶µç›–ï¼šç¨‹åºå‘˜å¤§å’–ã€æºç å…±è¯»ã€ç¨‹åºå‘˜å…±è¯»ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€é»‘å®¢æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ã€å¤§æ•°æ®ç§‘æŠ€ã€ç¼–ç¨‹å‰ç«¯ã€Javaã€Pythonã€Webç¼–ç¨‹å¼€å‘ã€Androidã€iOSå¼€å‘ã€Linuxã€æ•°æ®åº“ç ”å‘ã€å¹½é»˜ç¨‹åºå‘˜ç­‰ã€‚</span></p>
   <img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/ol72Wnba7fLkfGhCjKwHfZOmHMkVTIomtmHARHGo86u52ZIGicxfPPFBQ85dBUWf3trqDHPUuN7E2e26DpvfJdQ/640?wx_fmt=png" alt="640?wx_fmt=png">ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œç‚¹ä¸ª â€œ
   <strong><span style="color:rgb(0,112,192);">å¥½çœ‹</span></strong>â€ è¡Œä¸è¡Œ
  </div> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- è‡ªå®šä¹‰å¹¿å‘Š -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">æ›´å¤šç²¾å½©å†…å®¹</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">å›é¦–é¡µ</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ee64533f3c6a7a284cd39a37ee732c8b";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

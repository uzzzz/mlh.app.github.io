<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>深度学习：马尔可夫随机场 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="深度学习：马尔可夫随机场" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="版权声明：本文为博主原创文章，如若转载请注明出处 https://blog.csdn.net/tonydz0523/article/details/89074358 马尔可夫网络 我们根据图的边是否有向将概率图模型大致分为两类，有向的称为贝叶斯网络，无向的称为马尔可夫网络。马尔可夫网络是关于一组有马尔可夫性质随机变量X的全联合概率分布模型。马尔可夫网络与贝叶斯网络类似，可用于表示依赖关系。但也有不同之处，一方面它可以表示贝叶斯网络无法表示的一些依赖。如循环依赖；另一方面，它不能表示贝叶斯网络能够表示的某些关系，如推导关系。 这里重点介绍一种常见的模型，即马尔可夫随机场（MRF）。 马尔可夫随机场 在概率图模型中，一个很重要的任务就是分解概率联合函数，而函数分解通常利用随机变量的独立性或条件独立性。当然利用概率图，还可以把这种独立性可视化。 在马尔可夫随机场中我们借助“分离”的概念，如果从节点X中的节点到Y点中的节点都必须经过节点集Z中的节点，则称节点集X和Y节点被节点集Z分离，其中Z又称为分离集。 1.全局马尔可夫独立性 给定两个变量子集的分离集，则这两个变量子集条件独立。在上图中，集合X=（X1， X2， X3）和集合Y=（Y1，Y2，Y3）被集合Z=（Z1，Z2）所分离，则X和Y在给定Z的条件下独立，记为 X ⊥ Y ∣ Z X\perp{}Y|Z X⊥Y∣Z，用概率表示为： P ( X , Y ∣ Z ) = P ( X ∣ Z ) P ( Y ∣ Z ) P(X,Y\rvert{}Z) = P(X|Z)P(Y|Z) P(X,Y∣Z)=P(X∣Z)P(Y∣Z) 由全局马尔可夫独立性，可以推广到两个全局的独立性质。 2.局部马尔可夫独立性 如下图所示，X1是无向图中的一个节点，W={X2, X3}是与X1相连的所有节点，O是X1、W外的所有节点，O={X4, X5}。则有： P ( X 1 , O ∣ W ) = P ( X 1 ∣ W ) P ( O ∣ W ) P(X_1,O|W)=P(X_1|W)P(O|W) P(X1​,O∣W)=P(X1​∣W)P(O∣W) 3.成对马尔可夫独立性 如下图， X 4 X_4 X4​、 X 5 X_5 X5​是无向图中任意两个不相邻的节点，其他所有节点是O={X1, X2, X3}，则有： P ( X 4 , X 5 ∣ O ) = P ( X 4 ∣ O ) P ( X 5 ∣ O ) P(X_4,X_5|O)=P(X_4|O)P(X_5|O) P(X4​,X5​∣O)=P(X4​∣O)P(X5​∣O) 实际上，成对马尔可夫性、局部马尔可夫性、全局马尔可夫性是等价的。 条件随机场 条件随机场（Conditional Random Field, CRF）是条件概率分布模型P(Y|X)，表示的是在给定一组输入随机变量X的条件下另一组输出随机变量Y的马尔可夫随机场，也就是说CRF的特点是假设输出随机变量构成马尔可夫随机场。这时，在条件概率模型P(Y|X)中，Y是输出变量，表示标记序列；X是输入变量，表示需要标注的观测序列。也可以把标记序列称为状态序列。学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型 p ^ ( Y ∣ X ) \hat{p}(Y|X) p^​(Y∣X)；预测时，对于给定的输入序列X求出条件概率 p ^ ( Y ∣ X ) \hat{p}(Y|X) p^​(Y∣X)最大的输出序列Y。 1.条件随机场的定义 设X与Y是随机变量，P（Y|X）是在给定X的条件下Y的条件概率分布。弱随机变量Y构成一个由无向图G=（V，E）表示的马尔可夫随机场，即： P ( Y v ∣ X , Y w , w ̸ = v ) = P ( Y v ∣ X , Y w , w ∼ v ) P(Y_v|X,Y_w,w\not =v)=P(Y_v|X,Y_w,w\thicksim{v}) P(Yv​∣X,Yw​,w̸​=v)=P(Yv​∣X,Yw​,w∼v) 对任意节点v成立，则称条件概率分布 P ( Y ∣ X ) P(Y|X) P(Y∣X)为条件随机场。 式中 w ∼ v w\thicksim{v} w∼v表示在图 G = ( V , E ) G=(V,E) G=(V,E)中与节点v有边连接的所有节点 w , w ! = v w,w!=v w,w!=v表示节点v以外的所有节点， Y v Y_v Yv​、 Y w Y_w Yw​为节点v、w对应的随机变量。 一般假设X和Y有相同的图结构。线性链条件随机场的情况为： G = ( V = { 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n } , E = { ( i , i + 1 ) } ) , i = 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n − 1 G=(V=\{{1,2,\dotsi,n\}},E=\{(i,i+1)\}),i=1,2,\dotsi,n-1 G=(V={1,2,⋯,n},E={(i,i+1)}),i=1,2,⋯,n−1 在此情况下， X = ( X 1 , X 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , X n ) , Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) X=(X_1,X_2,\dotsi,X_n), Y=(Y_1,Y_2,\dotsi,Y_n) X=(X1​,X2​,⋯,Xn​),Y=(Y1​,Y2​,⋯,Yn​)，最大团是相邻两个节点的集合。如下图所示： 2.线性链条件随机场 设 X = ( X 1 , X 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , X n ) , Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) X=(X_1,X_2,\dotsi,X_n), Y=(Y_1,Y_2,\dotsi,Y_n) X=(X1​,X2​,⋯,Xn​),Y=(Y1​,Y2​,⋯,Yn​)为线性链表示的随机变量序列，若在给定随机变量序列X的条件下，随机变量序列Y的条件概率分布 P ( Y ∣ X ) P(Y|X) P(Y∣X)构成条件随机场，即满足马尔可夫性： P ( Y i ∣ X , Y i , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y i − 1 , Y i + 1 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) = P ( Y i ∣ X , Y i − 1 , Y i + 1 , i = 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n ) P(Y_i|X,Y_i,\dotsi,Y_{i-1},Y_{i+1},\dotsi,Y_n)=P(Y_i|X,Y_{i-1},Y_{i+1}, i=1,2,\dotsi,n) P(Yi​∣X,Yi​,⋯,Yi−1​,Yi+1​,⋯,Yn​)=P(Yi​∣X,Yi−1​,Yi+1​,i=1,2,⋯,n) 其中i=1或n时，只考虑单边。则称 P ( Y ∣ X ) P(Y|X) P(Y∣X)为线性链条件随机场。 实例：使用条件随机场做词性标注 条件随机场在词性标注中发挥重要作用，首先我们简单介绍和为词性标注，然后通过一个实例来实现一个具体的词性标注。 为了更好的理解词性标注这个概念，我们还是通过实例来说明。词性标注就是给一个句子中的每个单词注明词性。比如这句话：“He drank coffee at Starbucks”， 注明每个单词的词性后是这样的：“He（代词）drank（动词）coffee（名词）at（介词）Starbucks（名词）”。 这句话共有5个单词，我们将：（代词，动词，名词，介词，名词）作为一个标注序列，称为Y。可选的标注序列有很多种，比如Y还可以是这样：（名词，动词，动词，介词，名词），我们要在这么多的可选标注序列中，挑选出一个最靠谱的作为我们对这句话的标注。 那么我们要处理的问题是如何量化标注靠谱不，就我们上面展示的两个标注序列来说，第二个显然不如第一个靠谱，因为它把第二、第三个单词都标注成了动词，动词后面接动词，这在一个句子中通常是说不通的。 我们可以给每一个标注序列打分，分数越高代表这个标注序列越靠谱，我们至少可以说，凡是标注中出现了动词后面还是动词的标注序列，就要给他负分。 上面所说的动词后面还是动词就是一个特征函数，我们可以定义一个特征函数集合，这个特征函数集合来为一个标注序列打分，并据此选出最靠谱的标注序列。也就是说，每一个特征函数都可以用来为一个标注序列评分，把集合中所有同特证函数对同一个标注序列的评分综合起来，就是这个标注序列最终的评分值。 我们需要定义一下CRF中的特征函数。所谓特征函数，就是这样的函数，它接收四个参数： 句子X:就是我们要标注词性的句子。 i：用来表示句子X中第i个单词 y i y_i yi​：表示要评分的标注序列给第i个单词标注的词性。 y i − 1 y_{i-1} yi−1​：表示要评分的标注序列给第i-1个单词标注的词性 它的输出值是0或是1,0表示要评分的标注序列不符合这个特征，1表示要评分的标注序列符合这个特征，1表示要评分的标注序列符合这个特征。这里，我们的特征函数仅仅依靠当前单词的标签和它前面的单词的标签对标注序列进行评判，这样建立的CRF也叫做线性连CRF，这是CRF中的一种简单情况。 定义好一组特征函数后，我们要给每个特征函数 f j f_j fj​赋予一个权重 λ j \lambda_j λj​。现在，只要有一个句子X，有一个标注序列Y，我们就可以利用前面定义的特征函数集来对1评分。 s c o r e ( Y ∣ X ) = ∑ j = 1 m ∑ j = 1 n λ j f j ( X , i , y j , y j − 1 ) score(Y|X)=\textstyle\sum_{j=1}^m\textstyle\sum_{j=1}^n\lambda_jf_j(X,i,y_j,y_{j-1}) score(Y∣X)=∑j=1m​∑j=1n​λj​fj​(X,i,yj​,yj−1​) 上式中有两个求和，外面的求和用来求每一个特征函数 f j f_j fj​评分值的和，里面的求和用来求句子中每个位置的单词的特征值的和。 对这个分数进行指数化和标准化，我们就可以得到标注序列l的概率值 P ( Y ∣ X ) P(Y|X) P(Y∣X)，如下所示： P ( Y ∣ X ) = e x p [ s c o r e ( Y ∣ X ) ] ∑ Y ′ e x p [ s c o r e ( Y ′ ∣ X ) ] P(Y|X)=\frac{exp[score(Y|X)]}{\sum_{Y^{\prime}}exp[score(Y^{\prime}|X)]} P(Y∣X)=∑Y′​exp[score(Y′∣X)]exp[score(Y∣X)]​ CRF与LSM等模型不同，能够考虑长远的上下文信息，它更多考虑的是整个句子局部特征的线性加权组合（通过特征模板去扫描整个句子）。关键的一点是，CRF的模型为P(Y|X)，注意这里Y和X都是序列，优化的是一个序列 Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) Y=(Y_1,Y_2,\dotsi,Y_n) Y=(Y1​,Y2​,⋯,Yn​)，而不是某个时刻的 y t y_t yt​,即找到一个概率最高的序列 Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) Y=(Y_1,Y_2,\dotsi,Y_n) Y=(Y1​,Y2​,⋯,Yn​)使得 P ( Y ∣ X ) P(Y|X) P(Y∣X)最高，它计算的是一种联合概率，优化的是整个序列（最终目标），而不是将每个时刻的最优拼接起来，这一点上CRF优于LSTM。 使用Tensorflow实现CRF tf.contrib.crf.crf_log_likelihood 在一个条件随机场里面计算标签序列的log-likelihood。 tf.contrib.crf.viterbi_decode 其作用就是返回最好的标签序列。这个函数只能够在测试时使用，在Tensorflow外部解码。 tf.contrib.crf.crf_decode 在tensorflow内解码。 用TensorFlow实现CRF的主要步骤包括参数设置、构建随机特征、随机场tag、训练及评估模型，以下为详细代码。 1.导入库 import numpy as np import tensorflow as tf 2.构建数据 # 参数设置 num_examples = 10 num_words = 20 num_features = 100 num_tags = 5 # 随机构建数据，10个句子，每个句子20个词，每个词的有100个特征值（为了便于训练设置100个特征） x = np.random.rand(num_examples, num_words, num_features).astype(np.float32) # 构建随机5个tag y = np.random.randint(num_tags, size=[num_examples, num_words]).astype(np.int32) # 获取样本句长向量（因为每一个样本可能包含不一样多的词），在这里统一设为 num_words - 1，真实情况下根据需要设置 sequence_lengths = np.full(num_examples, num_words - 1, dtype=np.int32) 3.训练、评估模型 # 训练，评估模型 with tf.Graph().as_default(): with tf.Session() as session: x_t = tf.constant(x) y_t = tf.constant(y) sequence_lengths_t = tf.constant(sequence_lengths) # 在这里设置一个无偏置的线性层 weights = tf.get_variable(&quot;weights&quot;, [num_features, num_tags]) matricized_x_t = tf.reshape(x_t, [-1, num_features]) matricized_unary_scores = tf.matmul(matricized_x_t, weights) unary_scores = tf.reshape(matricized_unary_scores, [num_examples, num_words, num_tags]) # 计算log-likelihood并获得transition_params log_likelihood, transition_params = tf.contrib.crf.crf_log_likelihood( unary_scores, y_t, sequence_lengths_t) # 进行解码（维特比算法），获得解码之后的序列viterbi_sequence和分数viterbi_score viterbi_sequence, viterbi_score = tf.contrib.crf.crf_decode( unary_scores, transition_params, sequence_lengths_t) loss = tf.reduce_mean(-log_likelihood) train_op = tf.train.GradientDescentOptimizer(0.01).minimize(loss) session.run(tf.global_variables_initializer()) mask = (np.expand_dims(np.arange(num_words), axis=0) &lt; # np.arange()创建等差数组 np.expand_dims(sequence_lengths, axis=1)) # np.expand_dims()扩张维度 # 得到一个num_examples＊num_words的二维数组，数据类型为布尔型，目的是对句长进行截断 # 将每个样本的sequence_lengths加起来，得到标签的总数 total_labels = np.sum(sequence_lengths) # 进行训练 for i in range(1, 1001): tf_viterbi_sequence, _ = session.run([viterbi_sequence, train_op]) if i % 100 == 0: correct_labels = np.sum((y == tf_viterbi_sequence) * mask) accuracy = 100.0 * correct_labels / float(total_labels) print(&quot;[{:4}/{}] Accuracy: {:.2f}%&quot;.format(i, 1000, accuracy)) 4.结果 [ 100/1000] Accuracy: 61.58% [ 200/1000] Accuracy: 72.11% [ 300/1000] Accuracy: 80.00% [ 400/1000] Accuracy: 83.68% [ 500/1000] Accuracy: 85.79% [ 600/1000] Accuracy: 89.47% [ 700/1000] Accuracy: 91.58% [ 800/1000] Accuracy: 93.16% [ 900/1000] Accuracy: 94.74% [1000/1000] Accuracy: 94.74%" />
<meta property="og:description" content="版权声明：本文为博主原创文章，如若转载请注明出处 https://blog.csdn.net/tonydz0523/article/details/89074358 马尔可夫网络 我们根据图的边是否有向将概率图模型大致分为两类，有向的称为贝叶斯网络，无向的称为马尔可夫网络。马尔可夫网络是关于一组有马尔可夫性质随机变量X的全联合概率分布模型。马尔可夫网络与贝叶斯网络类似，可用于表示依赖关系。但也有不同之处，一方面它可以表示贝叶斯网络无法表示的一些依赖。如循环依赖；另一方面，它不能表示贝叶斯网络能够表示的某些关系，如推导关系。 这里重点介绍一种常见的模型，即马尔可夫随机场（MRF）。 马尔可夫随机场 在概率图模型中，一个很重要的任务就是分解概率联合函数，而函数分解通常利用随机变量的独立性或条件独立性。当然利用概率图，还可以把这种独立性可视化。 在马尔可夫随机场中我们借助“分离”的概念，如果从节点X中的节点到Y点中的节点都必须经过节点集Z中的节点，则称节点集X和Y节点被节点集Z分离，其中Z又称为分离集。 1.全局马尔可夫独立性 给定两个变量子集的分离集，则这两个变量子集条件独立。在上图中，集合X=（X1， X2， X3）和集合Y=（Y1，Y2，Y3）被集合Z=（Z1，Z2）所分离，则X和Y在给定Z的条件下独立，记为 X ⊥ Y ∣ Z X\perp{}Y|Z X⊥Y∣Z，用概率表示为： P ( X , Y ∣ Z ) = P ( X ∣ Z ) P ( Y ∣ Z ) P(X,Y\rvert{}Z) = P(X|Z)P(Y|Z) P(X,Y∣Z)=P(X∣Z)P(Y∣Z) 由全局马尔可夫独立性，可以推广到两个全局的独立性质。 2.局部马尔可夫独立性 如下图所示，X1是无向图中的一个节点，W={X2, X3}是与X1相连的所有节点，O是X1、W外的所有节点，O={X4, X5}。则有： P ( X 1 , O ∣ W ) = P ( X 1 ∣ W ) P ( O ∣ W ) P(X_1,O|W)=P(X_1|W)P(O|W) P(X1​,O∣W)=P(X1​∣W)P(O∣W) 3.成对马尔可夫独立性 如下图， X 4 X_4 X4​、 X 5 X_5 X5​是无向图中任意两个不相邻的节点，其他所有节点是O={X1, X2, X3}，则有： P ( X 4 , X 5 ∣ O ) = P ( X 4 ∣ O ) P ( X 5 ∣ O ) P(X_4,X_5|O)=P(X_4|O)P(X_5|O) P(X4​,X5​∣O)=P(X4​∣O)P(X5​∣O) 实际上，成对马尔可夫性、局部马尔可夫性、全局马尔可夫性是等价的。 条件随机场 条件随机场（Conditional Random Field, CRF）是条件概率分布模型P(Y|X)，表示的是在给定一组输入随机变量X的条件下另一组输出随机变量Y的马尔可夫随机场，也就是说CRF的特点是假设输出随机变量构成马尔可夫随机场。这时，在条件概率模型P(Y|X)中，Y是输出变量，表示标记序列；X是输入变量，表示需要标注的观测序列。也可以把标记序列称为状态序列。学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型 p ^ ( Y ∣ X ) \hat{p}(Y|X) p^​(Y∣X)；预测时，对于给定的输入序列X求出条件概率 p ^ ( Y ∣ X ) \hat{p}(Y|X) p^​(Y∣X)最大的输出序列Y。 1.条件随机场的定义 设X与Y是随机变量，P（Y|X）是在给定X的条件下Y的条件概率分布。弱随机变量Y构成一个由无向图G=（V，E）表示的马尔可夫随机场，即： P ( Y v ∣ X , Y w , w ̸ = v ) = P ( Y v ∣ X , Y w , w ∼ v ) P(Y_v|X,Y_w,w\not =v)=P(Y_v|X,Y_w,w\thicksim{v}) P(Yv​∣X,Yw​,w̸​=v)=P(Yv​∣X,Yw​,w∼v) 对任意节点v成立，则称条件概率分布 P ( Y ∣ X ) P(Y|X) P(Y∣X)为条件随机场。 式中 w ∼ v w\thicksim{v} w∼v表示在图 G = ( V , E ) G=(V,E) G=(V,E)中与节点v有边连接的所有节点 w , w ! = v w,w!=v w,w!=v表示节点v以外的所有节点， Y v Y_v Yv​、 Y w Y_w Yw​为节点v、w对应的随机变量。 一般假设X和Y有相同的图结构。线性链条件随机场的情况为： G = ( V = { 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n } , E = { ( i , i + 1 ) } ) , i = 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n − 1 G=(V=\{{1,2,\dotsi,n\}},E=\{(i,i+1)\}),i=1,2,\dotsi,n-1 G=(V={1,2,⋯,n},E={(i,i+1)}),i=1,2,⋯,n−1 在此情况下， X = ( X 1 , X 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , X n ) , Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) X=(X_1,X_2,\dotsi,X_n), Y=(Y_1,Y_2,\dotsi,Y_n) X=(X1​,X2​,⋯,Xn​),Y=(Y1​,Y2​,⋯,Yn​)，最大团是相邻两个节点的集合。如下图所示： 2.线性链条件随机场 设 X = ( X 1 , X 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , X n ) , Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) X=(X_1,X_2,\dotsi,X_n), Y=(Y_1,Y_2,\dotsi,Y_n) X=(X1​,X2​,⋯,Xn​),Y=(Y1​,Y2​,⋯,Yn​)为线性链表示的随机变量序列，若在给定随机变量序列X的条件下，随机变量序列Y的条件概率分布 P ( Y ∣ X ) P(Y|X) P(Y∣X)构成条件随机场，即满足马尔可夫性： P ( Y i ∣ X , Y i , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y i − 1 , Y i + 1 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) = P ( Y i ∣ X , Y i − 1 , Y i + 1 , i = 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n ) P(Y_i|X,Y_i,\dotsi,Y_{i-1},Y_{i+1},\dotsi,Y_n)=P(Y_i|X,Y_{i-1},Y_{i+1}, i=1,2,\dotsi,n) P(Yi​∣X,Yi​,⋯,Yi−1​,Yi+1​,⋯,Yn​)=P(Yi​∣X,Yi−1​,Yi+1​,i=1,2,⋯,n) 其中i=1或n时，只考虑单边。则称 P ( Y ∣ X ) P(Y|X) P(Y∣X)为线性链条件随机场。 实例：使用条件随机场做词性标注 条件随机场在词性标注中发挥重要作用，首先我们简单介绍和为词性标注，然后通过一个实例来实现一个具体的词性标注。 为了更好的理解词性标注这个概念，我们还是通过实例来说明。词性标注就是给一个句子中的每个单词注明词性。比如这句话：“He drank coffee at Starbucks”， 注明每个单词的词性后是这样的：“He（代词）drank（动词）coffee（名词）at（介词）Starbucks（名词）”。 这句话共有5个单词，我们将：（代词，动词，名词，介词，名词）作为一个标注序列，称为Y。可选的标注序列有很多种，比如Y还可以是这样：（名词，动词，动词，介词，名词），我们要在这么多的可选标注序列中，挑选出一个最靠谱的作为我们对这句话的标注。 那么我们要处理的问题是如何量化标注靠谱不，就我们上面展示的两个标注序列来说，第二个显然不如第一个靠谱，因为它把第二、第三个单词都标注成了动词，动词后面接动词，这在一个句子中通常是说不通的。 我们可以给每一个标注序列打分，分数越高代表这个标注序列越靠谱，我们至少可以说，凡是标注中出现了动词后面还是动词的标注序列，就要给他负分。 上面所说的动词后面还是动词就是一个特征函数，我们可以定义一个特征函数集合，这个特征函数集合来为一个标注序列打分，并据此选出最靠谱的标注序列。也就是说，每一个特征函数都可以用来为一个标注序列评分，把集合中所有同特证函数对同一个标注序列的评分综合起来，就是这个标注序列最终的评分值。 我们需要定义一下CRF中的特征函数。所谓特征函数，就是这样的函数，它接收四个参数： 句子X:就是我们要标注词性的句子。 i：用来表示句子X中第i个单词 y i y_i yi​：表示要评分的标注序列给第i个单词标注的词性。 y i − 1 y_{i-1} yi−1​：表示要评分的标注序列给第i-1个单词标注的词性 它的输出值是0或是1,0表示要评分的标注序列不符合这个特征，1表示要评分的标注序列符合这个特征，1表示要评分的标注序列符合这个特征。这里，我们的特征函数仅仅依靠当前单词的标签和它前面的单词的标签对标注序列进行评判，这样建立的CRF也叫做线性连CRF，这是CRF中的一种简单情况。 定义好一组特征函数后，我们要给每个特征函数 f j f_j fj​赋予一个权重 λ j \lambda_j λj​。现在，只要有一个句子X，有一个标注序列Y，我们就可以利用前面定义的特征函数集来对1评分。 s c o r e ( Y ∣ X ) = ∑ j = 1 m ∑ j = 1 n λ j f j ( X , i , y j , y j − 1 ) score(Y|X)=\textstyle\sum_{j=1}^m\textstyle\sum_{j=1}^n\lambda_jf_j(X,i,y_j,y_{j-1}) score(Y∣X)=∑j=1m​∑j=1n​λj​fj​(X,i,yj​,yj−1​) 上式中有两个求和，外面的求和用来求每一个特征函数 f j f_j fj​评分值的和，里面的求和用来求句子中每个位置的单词的特征值的和。 对这个分数进行指数化和标准化，我们就可以得到标注序列l的概率值 P ( Y ∣ X ) P(Y|X) P(Y∣X)，如下所示： P ( Y ∣ X ) = e x p [ s c o r e ( Y ∣ X ) ] ∑ Y ′ e x p [ s c o r e ( Y ′ ∣ X ) ] P(Y|X)=\frac{exp[score(Y|X)]}{\sum_{Y^{\prime}}exp[score(Y^{\prime}|X)]} P(Y∣X)=∑Y′​exp[score(Y′∣X)]exp[score(Y∣X)]​ CRF与LSM等模型不同，能够考虑长远的上下文信息，它更多考虑的是整个句子局部特征的线性加权组合（通过特征模板去扫描整个句子）。关键的一点是，CRF的模型为P(Y|X)，注意这里Y和X都是序列，优化的是一个序列 Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) Y=(Y_1,Y_2,\dotsi,Y_n) Y=(Y1​,Y2​,⋯,Yn​)，而不是某个时刻的 y t y_t yt​,即找到一个概率最高的序列 Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) Y=(Y_1,Y_2,\dotsi,Y_n) Y=(Y1​,Y2​,⋯,Yn​)使得 P ( Y ∣ X ) P(Y|X) P(Y∣X)最高，它计算的是一种联合概率，优化的是整个序列（最终目标），而不是将每个时刻的最优拼接起来，这一点上CRF优于LSTM。 使用Tensorflow实现CRF tf.contrib.crf.crf_log_likelihood 在一个条件随机场里面计算标签序列的log-likelihood。 tf.contrib.crf.viterbi_decode 其作用就是返回最好的标签序列。这个函数只能够在测试时使用，在Tensorflow外部解码。 tf.contrib.crf.crf_decode 在tensorflow内解码。 用TensorFlow实现CRF的主要步骤包括参数设置、构建随机特征、随机场tag、训练及评估模型，以下为详细代码。 1.导入库 import numpy as np import tensorflow as tf 2.构建数据 # 参数设置 num_examples = 10 num_words = 20 num_features = 100 num_tags = 5 # 随机构建数据，10个句子，每个句子20个词，每个词的有100个特征值（为了便于训练设置100个特征） x = np.random.rand(num_examples, num_words, num_features).astype(np.float32) # 构建随机5个tag y = np.random.randint(num_tags, size=[num_examples, num_words]).astype(np.int32) # 获取样本句长向量（因为每一个样本可能包含不一样多的词），在这里统一设为 num_words - 1，真实情况下根据需要设置 sequence_lengths = np.full(num_examples, num_words - 1, dtype=np.int32) 3.训练、评估模型 # 训练，评估模型 with tf.Graph().as_default(): with tf.Session() as session: x_t = tf.constant(x) y_t = tf.constant(y) sequence_lengths_t = tf.constant(sequence_lengths) # 在这里设置一个无偏置的线性层 weights = tf.get_variable(&quot;weights&quot;, [num_features, num_tags]) matricized_x_t = tf.reshape(x_t, [-1, num_features]) matricized_unary_scores = tf.matmul(matricized_x_t, weights) unary_scores = tf.reshape(matricized_unary_scores, [num_examples, num_words, num_tags]) # 计算log-likelihood并获得transition_params log_likelihood, transition_params = tf.contrib.crf.crf_log_likelihood( unary_scores, y_t, sequence_lengths_t) # 进行解码（维特比算法），获得解码之后的序列viterbi_sequence和分数viterbi_score viterbi_sequence, viterbi_score = tf.contrib.crf.crf_decode( unary_scores, transition_params, sequence_lengths_t) loss = tf.reduce_mean(-log_likelihood) train_op = tf.train.GradientDescentOptimizer(0.01).minimize(loss) session.run(tf.global_variables_initializer()) mask = (np.expand_dims(np.arange(num_words), axis=0) &lt; # np.arange()创建等差数组 np.expand_dims(sequence_lengths, axis=1)) # np.expand_dims()扩张维度 # 得到一个num_examples＊num_words的二维数组，数据类型为布尔型，目的是对句长进行截断 # 将每个样本的sequence_lengths加起来，得到标签的总数 total_labels = np.sum(sequence_lengths) # 进行训练 for i in range(1, 1001): tf_viterbi_sequence, _ = session.run([viterbi_sequence, train_op]) if i % 100 == 0: correct_labels = np.sum((y == tf_viterbi_sequence) * mask) accuracy = 100.0 * correct_labels / float(total_labels) print(&quot;[{:4}/{}] Accuracy: {:.2f}%&quot;.format(i, 1000, accuracy)) 4.结果 [ 100/1000] Accuracy: 61.58% [ 200/1000] Accuracy: 72.11% [ 300/1000] Accuracy: 80.00% [ 400/1000] Accuracy: 83.68% [ 500/1000] Accuracy: 85.79% [ 600/1000] Accuracy: 89.47% [ 700/1000] Accuracy: 91.58% [ 800/1000] Accuracy: 93.16% [ 900/1000] Accuracy: 94.74% [1000/1000] Accuracy: 94.74%" />
<link rel="canonical" href="https://mlh.app/2019/04/07/727262.html" />
<meta property="og:url" content="https://mlh.app/2019/04/07/727262.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-07T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"版权声明：本文为博主原创文章，如若转载请注明出处 https://blog.csdn.net/tonydz0523/article/details/89074358 马尔可夫网络 我们根据图的边是否有向将概率图模型大致分为两类，有向的称为贝叶斯网络，无向的称为马尔可夫网络。马尔可夫网络是关于一组有马尔可夫性质随机变量X的全联合概率分布模型。马尔可夫网络与贝叶斯网络类似，可用于表示依赖关系。但也有不同之处，一方面它可以表示贝叶斯网络无法表示的一些依赖。如循环依赖；另一方面，它不能表示贝叶斯网络能够表示的某些关系，如推导关系。 这里重点介绍一种常见的模型，即马尔可夫随机场（MRF）。 马尔可夫随机场 在概率图模型中，一个很重要的任务就是分解概率联合函数，而函数分解通常利用随机变量的独立性或条件独立性。当然利用概率图，还可以把这种独立性可视化。 在马尔可夫随机场中我们借助“分离”的概念，如果从节点X中的节点到Y点中的节点都必须经过节点集Z中的节点，则称节点集X和Y节点被节点集Z分离，其中Z又称为分离集。 1.全局马尔可夫独立性 给定两个变量子集的分离集，则这两个变量子集条件独立。在上图中，集合X=（X1， X2， X3）和集合Y=（Y1，Y2，Y3）被集合Z=（Z1，Z2）所分离，则X和Y在给定Z的条件下独立，记为 X ⊥ Y ∣ Z X\\perp{}Y|Z X⊥Y∣Z，用概率表示为： P ( X , Y ∣ Z ) = P ( X ∣ Z ) P ( Y ∣ Z ) P(X,Y\\rvert{}Z) = P(X|Z)P(Y|Z) P(X,Y∣Z)=P(X∣Z)P(Y∣Z) 由全局马尔可夫独立性，可以推广到两个全局的独立性质。 2.局部马尔可夫独立性 如下图所示，X1是无向图中的一个节点，W={X2, X3}是与X1相连的所有节点，O是X1、W外的所有节点，O={X4, X5}。则有： P ( X 1 , O ∣ W ) = P ( X 1 ∣ W ) P ( O ∣ W ) P(X_1,O|W)=P(X_1|W)P(O|W) P(X1​,O∣W)=P(X1​∣W)P(O∣W) 3.成对马尔可夫独立性 如下图， X 4 X_4 X4​、 X 5 X_5 X5​是无向图中任意两个不相邻的节点，其他所有节点是O={X1, X2, X3}，则有： P ( X 4 , X 5 ∣ O ) = P ( X 4 ∣ O ) P ( X 5 ∣ O ) P(X_4,X_5|O)=P(X_4|O)P(X_5|O) P(X4​,X5​∣O)=P(X4​∣O)P(X5​∣O) 实际上，成对马尔可夫性、局部马尔可夫性、全局马尔可夫性是等价的。 条件随机场 条件随机场（Conditional Random Field, CRF）是条件概率分布模型P(Y|X)，表示的是在给定一组输入随机变量X的条件下另一组输出随机变量Y的马尔可夫随机场，也就是说CRF的特点是假设输出随机变量构成马尔可夫随机场。这时，在条件概率模型P(Y|X)中，Y是输出变量，表示标记序列；X是输入变量，表示需要标注的观测序列。也可以把标记序列称为状态序列。学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型 p ^ ( Y ∣ X ) \\hat{p}(Y|X) p^​(Y∣X)；预测时，对于给定的输入序列X求出条件概率 p ^ ( Y ∣ X ) \\hat{p}(Y|X) p^​(Y∣X)最大的输出序列Y。 1.条件随机场的定义 设X与Y是随机变量，P（Y|X）是在给定X的条件下Y的条件概率分布。弱随机变量Y构成一个由无向图G=（V，E）表示的马尔可夫随机场，即： P ( Y v ∣ X , Y w , w ̸ = v ) = P ( Y v ∣ X , Y w , w ∼ v ) P(Y_v|X,Y_w,w\\not =v)=P(Y_v|X,Y_w,w\\thicksim{v}) P(Yv​∣X,Yw​,w̸​=v)=P(Yv​∣X,Yw​,w∼v) 对任意节点v成立，则称条件概率分布 P ( Y ∣ X ) P(Y|X) P(Y∣X)为条件随机场。 式中 w ∼ v w\\thicksim{v} w∼v表示在图 G = ( V , E ) G=(V,E) G=(V,E)中与节点v有边连接的所有节点 w , w ! = v w,w!=v w,w!=v表示节点v以外的所有节点， Y v Y_v Yv​、 Y w Y_w Yw​为节点v、w对应的随机变量。 一般假设X和Y有相同的图结构。线性链条件随机场的情况为： G = ( V = { 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n } , E = { ( i , i + 1 ) } ) , i = 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n − 1 G=(V=\\{{1,2,\\dotsi,n\\}},E=\\{(i,i+1)\\}),i=1,2,\\dotsi,n-1 G=(V={1,2,⋯,n},E={(i,i+1)}),i=1,2,⋯,n−1 在此情况下， X = ( X 1 , X 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , X n ) , Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) X=(X_1,X_2,\\dotsi,X_n), Y=(Y_1,Y_2,\\dotsi,Y_n) X=(X1​,X2​,⋯,Xn​),Y=(Y1​,Y2​,⋯,Yn​)，最大团是相邻两个节点的集合。如下图所示： 2.线性链条件随机场 设 X = ( X 1 , X 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , X n ) , Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) X=(X_1,X_2,\\dotsi,X_n), Y=(Y_1,Y_2,\\dotsi,Y_n) X=(X1​,X2​,⋯,Xn​),Y=(Y1​,Y2​,⋯,Yn​)为线性链表示的随机变量序列，若在给定随机变量序列X的条件下，随机变量序列Y的条件概率分布 P ( Y ∣ X ) P(Y|X) P(Y∣X)构成条件随机场，即满足马尔可夫性： P ( Y i ∣ X , Y i , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y i − 1 , Y i + 1 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) = P ( Y i ∣ X , Y i − 1 , Y i + 1 , i = 1 , 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , n ) P(Y_i|X,Y_i,\\dotsi,Y_{i-1},Y_{i+1},\\dotsi,Y_n)=P(Y_i|X,Y_{i-1},Y_{i+1}, i=1,2,\\dotsi,n) P(Yi​∣X,Yi​,⋯,Yi−1​,Yi+1​,⋯,Yn​)=P(Yi​∣X,Yi−1​,Yi+1​,i=1,2,⋯,n) 其中i=1或n时，只考虑单边。则称 P ( Y ∣ X ) P(Y|X) P(Y∣X)为线性链条件随机场。 实例：使用条件随机场做词性标注 条件随机场在词性标注中发挥重要作用，首先我们简单介绍和为词性标注，然后通过一个实例来实现一个具体的词性标注。 为了更好的理解词性标注这个概念，我们还是通过实例来说明。词性标注就是给一个句子中的每个单词注明词性。比如这句话：“He drank coffee at Starbucks”， 注明每个单词的词性后是这样的：“He（代词）drank（动词）coffee（名词）at（介词）Starbucks（名词）”。 这句话共有5个单词，我们将：（代词，动词，名词，介词，名词）作为一个标注序列，称为Y。可选的标注序列有很多种，比如Y还可以是这样：（名词，动词，动词，介词，名词），我们要在这么多的可选标注序列中，挑选出一个最靠谱的作为我们对这句话的标注。 那么我们要处理的问题是如何量化标注靠谱不，就我们上面展示的两个标注序列来说，第二个显然不如第一个靠谱，因为它把第二、第三个单词都标注成了动词，动词后面接动词，这在一个句子中通常是说不通的。 我们可以给每一个标注序列打分，分数越高代表这个标注序列越靠谱，我们至少可以说，凡是标注中出现了动词后面还是动词的标注序列，就要给他负分。 上面所说的动词后面还是动词就是一个特征函数，我们可以定义一个特征函数集合，这个特征函数集合来为一个标注序列打分，并据此选出最靠谱的标注序列。也就是说，每一个特征函数都可以用来为一个标注序列评分，把集合中所有同特证函数对同一个标注序列的评分综合起来，就是这个标注序列最终的评分值。 我们需要定义一下CRF中的特征函数。所谓特征函数，就是这样的函数，它接收四个参数： 句子X:就是我们要标注词性的句子。 i：用来表示句子X中第i个单词 y i y_i yi​：表示要评分的标注序列给第i个单词标注的词性。 y i − 1 y_{i-1} yi−1​：表示要评分的标注序列给第i-1个单词标注的词性 它的输出值是0或是1,0表示要评分的标注序列不符合这个特征，1表示要评分的标注序列符合这个特征，1表示要评分的标注序列符合这个特征。这里，我们的特征函数仅仅依靠当前单词的标签和它前面的单词的标签对标注序列进行评判，这样建立的CRF也叫做线性连CRF，这是CRF中的一种简单情况。 定义好一组特征函数后，我们要给每个特征函数 f j f_j fj​赋予一个权重 λ j \\lambda_j λj​。现在，只要有一个句子X，有一个标注序列Y，我们就可以利用前面定义的特征函数集来对1评分。 s c o r e ( Y ∣ X ) = ∑ j = 1 m ∑ j = 1 n λ j f j ( X , i , y j , y j − 1 ) score(Y|X)=\\textstyle\\sum_{j=1}^m\\textstyle\\sum_{j=1}^n\\lambda_jf_j(X,i,y_j,y_{j-1}) score(Y∣X)=∑j=1m​∑j=1n​λj​fj​(X,i,yj​,yj−1​) 上式中有两个求和，外面的求和用来求每一个特征函数 f j f_j fj​评分值的和，里面的求和用来求句子中每个位置的单词的特征值的和。 对这个分数进行指数化和标准化，我们就可以得到标注序列l的概率值 P ( Y ∣ X ) P(Y|X) P(Y∣X)，如下所示： P ( Y ∣ X ) = e x p [ s c o r e ( Y ∣ X ) ] ∑ Y ′ e x p [ s c o r e ( Y ′ ∣ X ) ] P(Y|X)=\\frac{exp[score(Y|X)]}{\\sum_{Y^{\\prime}}exp[score(Y^{\\prime}|X)]} P(Y∣X)=∑Y′​exp[score(Y′∣X)]exp[score(Y∣X)]​ CRF与LSM等模型不同，能够考虑长远的上下文信息，它更多考虑的是整个句子局部特征的线性加权组合（通过特征模板去扫描整个句子）。关键的一点是，CRF的模型为P(Y|X)，注意这里Y和X都是序列，优化的是一个序列 Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) Y=(Y_1,Y_2,\\dotsi,Y_n) Y=(Y1​,Y2​,⋯,Yn​)，而不是某个时刻的 y t y_t yt​,即找到一个概率最高的序列 Y = ( Y 1 , Y 2 , &amp;NegativeThinSpace; ⋯ &amp;ThinSpace; , Y n ) Y=(Y_1,Y_2,\\dotsi,Y_n) Y=(Y1​,Y2​,⋯,Yn​)使得 P ( Y ∣ X ) P(Y|X) P(Y∣X)最高，它计算的是一种联合概率，优化的是整个序列（最终目标），而不是将每个时刻的最优拼接起来，这一点上CRF优于LSTM。 使用Tensorflow实现CRF tf.contrib.crf.crf_log_likelihood 在一个条件随机场里面计算标签序列的log-likelihood。 tf.contrib.crf.viterbi_decode 其作用就是返回最好的标签序列。这个函数只能够在测试时使用，在Tensorflow外部解码。 tf.contrib.crf.crf_decode 在tensorflow内解码。 用TensorFlow实现CRF的主要步骤包括参数设置、构建随机特征、随机场tag、训练及评估模型，以下为详细代码。 1.导入库 import numpy as np import tensorflow as tf 2.构建数据 # 参数设置 num_examples = 10 num_words = 20 num_features = 100 num_tags = 5 # 随机构建数据，10个句子，每个句子20个词，每个词的有100个特征值（为了便于训练设置100个特征） x = np.random.rand(num_examples, num_words, num_features).astype(np.float32) # 构建随机5个tag y = np.random.randint(num_tags, size=[num_examples, num_words]).astype(np.int32) # 获取样本句长向量（因为每一个样本可能包含不一样多的词），在这里统一设为 num_words - 1，真实情况下根据需要设置 sequence_lengths = np.full(num_examples, num_words - 1, dtype=np.int32) 3.训练、评估模型 # 训练，评估模型 with tf.Graph().as_default(): with tf.Session() as session: x_t = tf.constant(x) y_t = tf.constant(y) sequence_lengths_t = tf.constant(sequence_lengths) # 在这里设置一个无偏置的线性层 weights = tf.get_variable(&quot;weights&quot;, [num_features, num_tags]) matricized_x_t = tf.reshape(x_t, [-1, num_features]) matricized_unary_scores = tf.matmul(matricized_x_t, weights) unary_scores = tf.reshape(matricized_unary_scores, [num_examples, num_words, num_tags]) # 计算log-likelihood并获得transition_params log_likelihood, transition_params = tf.contrib.crf.crf_log_likelihood( unary_scores, y_t, sequence_lengths_t) # 进行解码（维特比算法），获得解码之后的序列viterbi_sequence和分数viterbi_score viterbi_sequence, viterbi_score = tf.contrib.crf.crf_decode( unary_scores, transition_params, sequence_lengths_t) loss = tf.reduce_mean(-log_likelihood) train_op = tf.train.GradientDescentOptimizer(0.01).minimize(loss) session.run(tf.global_variables_initializer()) mask = (np.expand_dims(np.arange(num_words), axis=0) &lt; # np.arange()创建等差数组 np.expand_dims(sequence_lengths, axis=1)) # np.expand_dims()扩张维度 # 得到一个num_examples＊num_words的二维数组，数据类型为布尔型，目的是对句长进行截断 # 将每个样本的sequence_lengths加起来，得到标签的总数 total_labels = np.sum(sequence_lengths) # 进行训练 for i in range(1, 1001): tf_viterbi_sequence, _ = session.run([viterbi_sequence, train_op]) if i % 100 == 0: correct_labels = np.sum((y == tf_viterbi_sequence) * mask) accuracy = 100.0 * correct_labels / float(total_labels) print(&quot;[{:4}/{}] Accuracy: {:.2f}%&quot;.format(i, 1000, accuracy)) 4.结果 [ 100/1000] Accuracy: 61.58% [ 200/1000] Accuracy: 72.11% [ 300/1000] Accuracy: 80.00% [ 400/1000] Accuracy: 83.68% [ 500/1000] Accuracy: 85.79% [ 600/1000] Accuracy: 89.47% [ 700/1000] Accuracy: 91.58% [ 800/1000] Accuracy: 93.16% [ 900/1000] Accuracy: 94.74% [1000/1000] Accuracy: 94.74%","@type":"BlogPosting","url":"https://mlh.app/2019/04/07/727262.html","headline":"深度学习：马尔可夫随机场","dateModified":"2019-04-07T00:00:00+08:00","datePublished":"2019-04-07T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/04/07/727262.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>深度学习：马尔可夫随机场</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div class="article-copyright">
   版权声明：本文为博主原创文章，如若转载请注明出处 https://blog.csdn.net/tonydz0523/article/details/89074358 
 </div> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <h1><a id="_0"></a>马尔可夫网络</h1> 
  <p>我们根据图的边是否有向将概率图模型大致分为两类，有向的称为贝叶斯网络，无向的称为马尔可夫网络。马尔可夫网络是关于一组有马尔可夫性质随机变量X的全联合概率分布模型。马尔可夫网络与贝叶斯网络类似，可用于表示依赖关系。但也有不同之处，一方面它可以表示贝叶斯网络无法表示的一些依赖。如循环依赖；另一方面，它不能表示贝叶斯网络能够表示的某些关系，如推导关系。<br> 这里重点介绍一种常见的模型，即马尔可夫随机场（MRF）。</p> 
  <h2><a id="_4"></a>马尔可夫随机场</h2> 
  <p>在概率图模型中，一个很重要的任务就是分解概率联合函数，而函数分解通常利用随机变量的独立性或条件独立性。当然利用概率图，还可以把这种独立性可视化。<br> 在马尔可夫随机场中我们借助“分离”的概念，如果从节点X中的节点到Y点中的节点都必须经过节点集Z中的节点，则称节点集X和Y节点被节点集Z分离，其中Z又称为分离集。<img src="https://app.yinxiang.com/shard/s40/res/f3fdd5d8-5647-4cac-b959-a3a659423814/Screenshot_2019-04-06-15-06-46.png#pic_center" alt="" width="600" height="230"></p> 
  <h3><a id="1_9"></a>1.全局马尔可夫独立性</h3> 
  <p>给定两个变量子集的分离集，则这两个变量子集条件独立。在上图中，集合X=（X1， X2， X3）和集合Y=（Y1，Y2，Y3）被集合Z=（Z1，Z2）所分离，则X和Y在给定Z的条件下独立，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          X
         </mi>
         <mo>
          ⊥
         </mo>
         <mrow></mrow>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          Z
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         X\perp{}Y|Z
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">⊥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"></span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07153em;">Z</span></span></span></span></span>，用概率表示为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <mi>
           X
          </mi>
          <mo separator="true">
           ,
          </mo>
          <mi>
           Y
          </mi>
          <mo>
           ∣
          </mo>
          <mrow></mrow>
          <mi>
           Z
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <mi>
           X
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           Z
          </mi>
          <mo>
           )
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <mi>
           Y
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           Z
          </mi>
          <mo>
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          P(X,Y\rvert{}Z) = P(X|Z)P(Y|Z)
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mclose">∣</span><span class="mord"></span><span class="mord mathit" style="margin-right: 0.07153em;">Z</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07153em;">Z</span><span class="mclose">)</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07153em;">Z</span><span class="mclose">)</span></span></span></span></span></span><br> 由全局马尔可夫独立性，可以推广到两个全局的独立性质。</p> 
  <h3><a id="2_14"></a>2.局部马尔可夫独立性</h3> 
  <p>如下图所示，X1是无向图中的一个节点，W={X2, X3}是与X1相连的所有节点，O是X1、W外的所有节点，O={X4, X5}。则有：</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            X
           </mi>
           <mn>
            1
           </mn>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <mi>
           O
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           W
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            X
           </mi>
           <mn>
            1
           </mn>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           W
          </mi>
          <mo>
           )
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <mi>
           O
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           W
          </mi>
          <mo>
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
           P(X_1,O|W)=P(X_1|W)P(O|W)
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.13889em;">W</span><span class="mclose">)</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.13889em;">W</span><span class="mclose">)</span></span></span></span></span></span><br> <img src="https://app.yinxiang.com/shard/s40/res/2333d14c-2eb8-4fa1-a038-1617516479ae/Screenshot_2019-04-06-16-17-54.png#pic_center" alt="" width="600" height="380"></p> 
  <h3><a id="3_20"></a>3.成对马尔可夫独立性</h3> 
  <p>如下图，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           X
          </mi>
          <mn>
           4
          </mn>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         X_4
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>、<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           X
          </mi>
          <mn>
           5
          </mn>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         X_5
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是无向图中任意两个不相邻的节点，其他所有节点是O={X1, X2, X3}，则有：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            X
           </mi>
           <mn>
            4
           </mn>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            X
           </mi>
           <mn>
            5
           </mn>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           O
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            X
           </mi>
           <mn>
            4
           </mn>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           O
          </mi>
          <mo>
           )
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            X
           </mi>
           <mn>
            5
           </mn>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           O
          </mi>
          <mo>
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          P(X_4,X_5|O)=P(X_4|O)P(X_5|O)
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mclose">)</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mclose">)</span></span></span></span></span></span></p> 
  <p><img src="https://app.yinxiang.com/shard/s40/res/ea8a9ba7-967d-4ef0-ac0f-f5a61e6d5e10/Screenshot_2019-04-06-16-46-27.png#pic_center" alt="" width="600" height="380"></p> 
  <p>实际上，成对马尔可夫性、局部马尔可夫性、全局马尔可夫性是等价的。</p> 
  <h2><a id="_30"></a>条件随机场</h2> 
  <p>条件随机场（Conditional Random Field, CRF）是条件概率分布模型P(Y|X)，表示的是在给定一组输入随机变量X的条件下另一组输出随机变量Y的马尔可夫随机场，也就是说CRF的特点是假设输出随机变量构成马尔可夫随机场。这时，在条件概率模型P(Y|X)中，Y是输出变量，表示标记序列；X是输入变量，表示需要标注的观测序列。也可以把标记序列称为状态序列。学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mover accent="true">
          <mi>
           p
          </mi>
          <mo>
           ^
          </mo>
         </mover>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         \hat{p}(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">p</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>；预测时，对于给定的输入序列X求出条件概率<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mover accent="true">
          <mi>
           p
          </mi>
          <mo>
           ^
          </mo>
         </mover>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         \hat{p}(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">p</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.16666em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>最大的输出序列Y。</p> 
  <h3><a id="1_34"></a>1.条件随机场的定义</h3> 
  <p>设X与Y是随机变量，P（Y|X）是在给定X的条件下Y的条件概率分布。弱随机变量Y构成一个由无向图G=（V，E）表示的马尔可夫随机场，即：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            v
           </mi>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           X
          </mi>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            w
           </mi>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <mi>
           w
          </mi>
          <mpadded width="0px">
           <mo>
            ̸
           </mo>
          </mpadded>
          <mo>
           =
          </mo>
          <mi>
           v
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            v
           </mi>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           X
          </mi>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            w
           </mi>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <mi>
           w
          </mi>
          <mo>
           ∼
          </mo>
          <mi>
           v
          </mi>
          <mo>
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          P(Y_v|X,Y_w,w\not =v)=P(Y_v|X,Y_w,w\thicksim{v})
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="rlap"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="inner"><span class="mrel latin_fallback"≯</span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel amsrm">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">v</span></span><span class="mclose">)</span></span></span></span></span></span><br> 对任意节点v成立，则称条件概率分布<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          P
         </mi>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         P(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>为条件随机场。<br> 式中<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          w
         </mi>
         <mo>
          ∼
         </mo>
         <mi>
          v
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         w\thicksim{v}
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel amsrm">∼</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">v</span></span></span></span></span></span>表示在图<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          G
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <mi>
          V
         </mi>
         <mo separator="true">
          ,
         </mo>
         <mi>
          E
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         G=(V,E)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit">G</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.05764em;">E</span><span class="mclose">)</span></span></span></span></span>中与节点v有边连接的所有节点<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          w
         </mi>
         <mo separator="true">
          ,
         </mo>
         <mi>
          w
         </mi>
         <mo>
          !
         </mo>
         <mo>
          =
         </mo>
         <mi>
          v
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         w,w!=v
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.02691em;">w</span><span class="mclose">!</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">v</span></span></span></span></span>表示节点v以外的所有节点，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           Y
          </mi>
          <mi>
           v
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         Y_v
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>、<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           Y
          </mi>
          <mi>
           w
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         Y_w
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为节点v、w对应的随机变量。<br> 一般假设X和Y有相同的图结构。线性链条件随机场的情况为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           G
          </mi>
          <mo>
           =
          </mo>
          <mo>
           (
          </mo>
          <mi>
           V
          </mi>
          <mo>
           =
          </mo>
          <mo>
           {
          </mo>
          <mrow>
           <mn>
            1
           </mn>
           <mo separator="true">
            ,
           </mo>
           <mn>
            2
           </mn>
           <mo separator="true">
            ,
           </mo>&amp;NegativeThinSpace;
           <mo>
            ⋯
           </mo>&amp;ThinSpace;
           <mo separator="true">
            ,
           </mo>
           <mi>
            n
           </mi>
           <mo>
            }
           </mo>
          </mrow>
          <mo separator="true">
           ,
          </mo>
          <mi>
           E
          </mi>
          <mo>
           =
          </mo>
          <mo>
           {
          </mo>
          <mo>
           (
          </mo>
          <mi>
           i
          </mi>
          <mo separator="true">
           ,
          </mo>
          <mi>
           i
          </mi>
          <mo>
           +
          </mo>
          <mn>
           1
          </mn>
          <mo>
           )
          </mo>
          <mo>
           }
          </mo>
          <mo>
           )
          </mo>
          <mo separator="true">
           ,
          </mo>
          <mi>
           i
          </mi>
          <mo>
           =
          </mo>
          <mn>
           1
          </mn>
          <mo separator="true">
           ,
          </mo>
          <mn>
           2
          </mn>
          <mo separator="true">
           ,
          </mo>&amp;NegativeThinSpace;
          <mo>
           ⋯
          </mo>&amp;ThinSpace;
          <mo separator="true">
           ,
          </mo>
          <mi>
           n
          </mi>
          <mo>
           −
          </mo>
          <mn>
           1
          </mn>
         </mrow>
         <annotation encoding="application/x-tex">
          G=(V=\{{1,2,\dotsi,n\}},E=\{(i,i+1)\}),i=1,2,\dotsi,n-1
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit">G</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">V</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">n</span><span class="mclose">}</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.05764em;">E</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">}</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83888em; vertical-align: -0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span></span></p> 
  <p>在此情况下，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          X
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <msub>
          <mi>
           X
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           X
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>&amp;NegativeThinSpace;
         <mo>
          ⋯
         </mo>&amp;ThinSpace;
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           X
          </mi>
          <mi>
           n
          </mi>
         </msub>
         <mo>
          )
         </mo>
         <mo separator="true">
          ,
         </mo>
         <mi>
          Y
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>&amp;NegativeThinSpace;
         <mo>
          ⋯
         </mo>&amp;ThinSpace;
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mi>
           n
          </mi>
         </msub>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         X=(X_1,X_2,\dotsi,X_n), Y=(Y_1,Y_2,\dotsi,Y_n)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，最大团是相邻两个节点的集合。如下图所示：</p> 
  <p><img src="https://app.yinxiang.com/shard/s40/res/9c81e162-20e2-487d-a6d3-d1fbc967a64b/Screenshot_2019-04-06-19-27-35.png#pic_center" alt="" width="600" height="280"></p> 
  <h3><a id="2_46"></a>2.线性链条件随机场</h3> 
  <p>设<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          X
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <msub>
          <mi>
           X
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           X
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>&amp;NegativeThinSpace;
         <mo>
          ⋯
         </mo>&amp;ThinSpace;
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           X
          </mi>
          <mi>
           n
          </mi>
         </msub>
         <mo>
          )
         </mo>
         <mo separator="true">
          ,
         </mo>
         <mi>
          Y
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>&amp;NegativeThinSpace;
         <mo>
          ⋯
         </mo>&amp;ThinSpace;
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mi>
           n
          </mi>
         </msub>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         X=(X_1,X_2,\dotsi,X_n), Y=(Y_1,Y_2,\dotsi,Y_n)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>为线性链表示的随机变量序列，若在给定随机变量序列X的条件下，随机变量序列Y的条件概率分布<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          P
         </mi>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         P(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>构成条件随机场，即满足马尔可夫性：</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            i
           </mi>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           X
          </mi>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            i
           </mi>
          </msub>
          <mo separator="true">
           ,
          </mo>&amp;NegativeThinSpace;
          <mo>
           ⋯
          </mo>&amp;ThinSpace;
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mrow>
            <mi>
             i
            </mi>
            <mo>
             −
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mrow>
            <mi>
             i
            </mi>
            <mo>
             +
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
          <mo separator="true">
           ,
          </mo>&amp;NegativeThinSpace;
          <mo>
           ⋯
          </mo>&amp;ThinSpace;
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            n
           </mi>
          </msub>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mi>
            i
           </mi>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           X
          </mi>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mrow>
            <mi>
             i
            </mi>
            <mo>
             −
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <msub>
           <mi>
            Y
           </mi>
           <mrow>
            <mi>
             i
            </mi>
            <mo>
             +
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
          <mo separator="true">
           ,
          </mo>
          <mi>
           i
          </mi>
          <mo>
           =
          </mo>
          <mn>
           1
          </mn>
          <mo separator="true">
           ,
          </mo>
          <mn>
           2
          </mn>
          <mo separator="true">
           ,
          </mo>&amp;NegativeThinSpace;
          <mo>
           ⋯
          </mo>&amp;ThinSpace;
          <mo separator="true">
           ,
          </mo>
          <mi>
           n
          </mi>
          <mo>
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          P(Y_i|X,Y_i,\dotsi,Y_{i-1},Y_{i+1},\dotsi,Y_n)=P(Y_i|X,Y_{i-1},Y_{i+1}, i=1,2,\dotsi,n)
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span></span></p> 
  <p>其中i=1或n时，只考虑单边。则称<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          P
         </mi>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         P(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>为线性链条件随机场。</p> 
  <h2><a id="_53"></a>实例：使用条件随机场做词性标注</h2> 
  <p>条件随机场在词性标注中发挥重要作用，首先我们简单介绍和为词性标注，然后通过一个实例来实现一个具体的词性标注。<br> 为了更好的理解词性标注这个概念，我们还是通过实例来说明。词性标注就是给一个句子中的每个单词注明词性。比如这句话：“He drank coffee at Starbucks”， 注明每个单词的词性后是这样的：“He（代词）drank（动词）coffee（名词）at（介词）Starbucks（名词）”。</p> 
  <p>这句话共有5个单词，我们将：（代词，动词，名词，介词，名词）作为一个标注序列，称为Y。可选的标注序列有很多种，比如Y还可以是这样：（名词，动词，动词，介词，名词），我们要在这么多的可选标注序列中，挑选出一个最靠谱的作为我们对这句话的标注。<br> 那么我们要处理的问题是如何量化标注靠谱不，就我们上面展示的两个标注序列来说，第二个显然不如第一个靠谱，因为它把第二、第三个单词都标注成了动词，动词后面接动词，这在一个句子中通常是说不通的。<br> 我们可以给每一个标注序列打分，分数越高代表这个标注序列越靠谱，我们至少可以说，凡是标注中出现了动词后面还是动词的标注序列，就要给他负分。</p> 
  <p>上面所说的动词后面还是动词就是一个特征函数，我们可以定义一个特征函数集合，这个特征函数集合来为一个标注序列打分，并据此选出最靠谱的标注序列。也就是说，每一个特征函数都可以用来为一个标注序列评分，把集合中所有同特证函数对同一个标注序列的评分综合起来，就是这个标注序列最终的评分值。<br> 我们需要定义一下CRF中的特征函数。所谓特征函数，就是这样的函数，它接收四个参数：</p> 
  <ul> 
   <li>句子X:就是我们要标注词性的句子。</li> 
   <li>i：用来表示句子X中第i个单词</li> 
   <li><span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            y
           </mi>
           <mi>
            i
           </mi>
          </msub>
         </mrow>
         <annotation encoding="application/x-tex">
          y_i
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>：表示要评分的标注序列给第i个单词标注的词性。</li> 
   <li><span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            y
           </mi>
           <mrow>
            <mi>
             i
            </mi>
            <mo>
             −
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
         </mrow>
         <annotation encoding="application/x-tex">
          y_{i-1}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.638891em; vertical-align: -0.208331em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span></span></span></span></span>：表示要评分的标注序列给第i-1个单词标注的词性</li> 
  </ul> 
  <p>它的输出值是0或是1,0表示要评分的标注序列不符合这个特征，1表示要评分的标注序列符合这个特征，1表示要评分的标注序列符合这个特征。这里，我们的特征函数仅仅依靠当前单词的标签和它前面的单词的标签对标注序列进行评判，这样建立的CRF也叫做线性连CRF，这是CRF中的一种简单情况。<br> 定义好一组特征函数后，我们要给每个特征函数<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           f
          </mi>
          <mi>
           j
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         f_j
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>赋予一个权重<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           λ
          </mi>
          <mi>
           j
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         \lambda_j
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathit">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>。现在，只要有一个句子X，有一个标注序列Y，我们就可以利用前面定义的特征函数集来对1评分。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           s
          </mi>
          <mi>
           c
          </mi>
          <mi>
           o
          </mi>
          <mi>
           r
          </mi>
          <mi>
           e
          </mi>
          <mo>
           (
          </mo>
          <mi>
           Y
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           X
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mstyle scriptlevel="0" displaystyle="false">
           <msubsup>
            <mo>
             ∑
            </mo>
            <mrow>
             <mi>
              j
             </mi>
             <mo>
              =
             </mo>
             <mn>
              1
             </mn>
            </mrow>
            <mi>
             m
            </mi>
           </msubsup>
           <mstyle scriptlevel="0" displaystyle="false">
            <msubsup>
             <mo>
              ∑
             </mo>
             <mrow>
              <mi>
               j
              </mi>
              <mo>
               =
              </mo>
              <mn>
               1
              </mn>
             </mrow>
             <mi>
              n
             </mi>
            </msubsup>
            <msub>
             <mi>
              λ
             </mi>
             <mi>
              j
             </mi>
            </msub>
            <msub>
             <mi>
              f
             </mi>
             <mi>
              j
             </mi>
            </msub>
            <mo>
             (
            </mo>
            <mi>
             X
            </mi>
            <mo separator="true">
             ,
            </mo>
            <mi>
             i
            </mi>
            <mo separator="true">
             ,
            </mo>
            <msub>
             <mi>
              y
             </mi>
             <mi>
              j
             </mi>
            </msub>
            <mo separator="true">
             ,
            </mo>
            <msub>
             <mi>
              y
             </mi>
             <mrow>
              <mi>
               j
              </mi>
              <mo>
               −
              </mo>
              <mn>
               1
              </mn>
             </mrow>
            </msub>
            <mo>
             )
            </mo>
           </mstyle>
          </mstyle>
         </mrow>
         <annotation encoding="application/x-tex">
          score(Y|X)=\textstyle\sum_{j=1}^m\textstyle\sum_{j=1}^n\lambda_jf_j(X,i,y_j,y_{j-1})
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">s</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.24011em; vertical-align: -0.435818em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.435818em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.435818em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span><br> 上式中有两个求和，外面的求和用来求每一个特征函数<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           f
          </mi>
          <mi>
           j
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         f_j
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>评分值的和，里面的求和用来求句子中每个位置的单词的特征值的和。<br> 对这个分数进行指数化和标准化，我们就可以得到标注序列l的概率值<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          P
         </mi>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         P(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>，如下所示：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           P
          </mi>
          <mo>
           (
          </mo>
          <mi>
           Y
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi>
           X
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             e
            </mi>
            <mi>
             x
            </mi>
            <mi>
             p
            </mi>
            <mo>
             [
            </mo>
            <mi>
             s
            </mi>
            <mi>
             c
            </mi>
            <mi>
             o
            </mi>
            <mi>
             r
            </mi>
            <mi>
             e
            </mi>
            <mo>
             (
            </mo>
            <mi>
             Y
            </mi>
            <mi mathvariant="normal">
             ∣
            </mi>
            <mi>
             X
            </mi>
            <mo>
             )
            </mo>
            <mo>
             ]
            </mo>
           </mrow>
           <mrow>
            <munder>
             <mo>
              ∑
             </mo>
             <msup>
              <mi>
               Y
              </mi>
              <mo mathvariant="normal">
               ′
              </mo>
             </msup>
            </munder>
            <mi>
             e
            </mi>
            <mi>
             x
            </mi>
            <mi>
             p
            </mi>
            <mo>
             [
            </mo>
            <mi>
             s
            </mi>
            <mi>
             c
            </mi>
            <mi>
             o
            </mi>
            <mi>
             r
            </mi>
            <mi>
             e
            </mi>
            <mo>
             (
            </mo>
            <msup>
             <mi>
              Y
             </mi>
             <mo mathvariant="normal">
              ′
             </mo>
            </msup>
            <mi mathvariant="normal">
             ∣
            </mi>
            <mi>
             X
            </mi>
            <mo>
             )
            </mo>
            <mo>
             ]
            </mo>
           </mrow>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
          P(Y|X)=\frac{exp[score(Y|X)]}{\sum_{Y^{\prime}}exp[score(Y^{\prime}|X)]}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.41271em; vertical-align: -0.98571em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.178621em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">e</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">s</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.677892em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mclose">]</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">e</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mopen">[</span><span class="mord mathit">s</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">e</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.98571em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>CRF与LSM等模型不同，能够考虑长远的上下文信息，它更多考虑的是整个句子局部特征的线性加权组合（通过特征模板去扫描整个句子）。关键的一点是，CRF的模型为P(Y|X)，注意这里Y和X都是序列，优化的是一个序列<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          Y
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>&amp;NegativeThinSpace;
         <mo>
          ⋯
         </mo>&amp;ThinSpace;
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mi>
           n
          </mi>
         </msub>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         Y=(Y_1,Y_2,\dotsi,Y_n)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，而不是某个时刻的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           y
          </mi>
          <mi>
           t
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         y_t
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>,即找到一个概率最高的序列<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          Y
         </mi>
         <mo>
          =
         </mo>
         <mo>
          (
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo separator="true">
          ,
         </mo>&amp;NegativeThinSpace;
         <mo>
          ⋯
         </mo>&amp;ThinSpace;
         <mo separator="true">
          ,
         </mo>
         <msub>
          <mi>
           Y
          </mi>
          <mi>
           n
          </mi>
         </msub>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         Y=(Y_1,Y_2,\dotsi,Y_n)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: -0.166667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.22222em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>使得<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          P
         </mi>
         <mo>
          (
         </mo>
         <mi>
          Y
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          X
         </mi>
         <mo>
          )
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         P(Y|X)
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>最高，它计算的是一种联合概率，优化的是整个序列（最终目标），而不是将每个时刻的最优拼接起来，这一点上CRF优于LSTM。</p> 
  <h3><a id="TensorflowCRF_78"></a>使用Tensorflow实现CRF</h3> 
  <ul> 
   <li>tf.contrib.crf.crf_log_likelihood 在一个条件随机场里面计算标签序列的log-likelihood。</li> 
   <li>tf.contrib.crf.viterbi_decode 其作用就是返回最好的标签序列。这个函数只能够在测试时使用，在Tensorflow外部解码。</li> 
   <li>tf.contrib.crf.crf_decode 在tensorflow内解码。</li> 
  </ul> 
  <p>用TensorFlow实现CRF的主要步骤包括参数设置、构建随机特征、随机场tag、训练及评估模型，以下为详细代码。</p> 
  <h4><a id="1_85"></a>1.导入库</h4> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np   
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
</code></pre> 
  <h4><a id="2_92"></a>2.构建数据</h4> 
  <pre><code class="prism language-python"><span class="token comment"># 参数设置</span>
num_examples <span class="token operator">=</span> <span class="token number">10</span>
num_words <span class="token operator">=</span> <span class="token number">20</span>
num_features <span class="token operator">=</span> <span class="token number">100</span>
num_tags <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment"># 随机构建数据，10个句子，每个句子20个词，每个词的有100个特征值（为了便于训练设置100个特征）</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>num_examples<span class="token punctuation">,</span> num_words<span class="token punctuation">,</span> num_features<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
<span class="token comment"># 构建随机5个tag</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>num_tags<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">[</span>num_examples<span class="token punctuation">,</span> num_words<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
<span class="token comment"># 获取样本句长向量（因为每一个样本可能包含不一样多的词），在这里统一设为 num_words - 1，真实情况下根据需要设置</span>
sequence_lengths <span class="token operator">=</span> np<span class="token punctuation">.</span>full<span class="token punctuation">(</span>num_examples<span class="token punctuation">,</span> num_words <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
</code></pre> 
  <h4><a id="3_108"></a>3.训练、评估模型</h4> 
  <pre><code class="prism language-python"><span class="token comment"># 训练，评估模型</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_default<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
        x_t <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        y_t <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        sequence_lengths_t <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span>sequence_lengths<span class="token punctuation">)</span>
        <span class="token comment"># 在这里设置一个无偏置的线性层</span>
        weights <span class="token operator">=</span> tf<span class="token punctuation">.</span>get_variable<span class="token punctuation">(</span><span class="token string">"weights"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>num_features<span class="token punctuation">,</span> num_tags<span class="token punctuation">]</span><span class="token punctuation">)</span>
        matricized_x_t <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x_t<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> num_features<span class="token punctuation">]</span><span class="token punctuation">)</span>
        matricized_unary_scores <span class="token operator">=</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>matricized_x_t<span class="token punctuation">,</span> weights<span class="token punctuation">)</span>
        unary_scores <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>matricized_unary_scores<span class="token punctuation">,</span>
                                    <span class="token punctuation">[</span>num_examples<span class="token punctuation">,</span> num_words<span class="token punctuation">,</span> num_tags<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 计算log-likelihood并获得transition_params</span>
        log_likelihood<span class="token punctuation">,</span> transition_params <span class="token operator">=</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>crf<span class="token punctuation">.</span>crf_log_likelihood<span class="token punctuation">(</span>
            unary_scores<span class="token punctuation">,</span> y_t<span class="token punctuation">,</span> sequence_lengths_t<span class="token punctuation">)</span>
        <span class="token comment"># 进行解码（维特比算法），获得解码之后的序列viterbi_sequence和分数viterbi_score</span>
        viterbi_sequence<span class="token punctuation">,</span> viterbi_score <span class="token operator">=</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>crf<span class="token punctuation">.</span>crf_decode<span class="token punctuation">(</span>
            unary_scores<span class="token punctuation">,</span> transition_params<span class="token punctuation">,</span> sequence_lengths_t<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span><span class="token operator">-</span>log_likelihood<span class="token punctuation">)</span>
        train_op <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>
        session<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mask <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>num_words<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span>      <span class="token comment"># np.arange()创建等差数组</span>
                np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>sequence_lengths<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment"># np.expand_dims()扩张维度</span>
        <span class="token comment"># 得到一个num_examples＊num_words的二维数组，数据类型为布尔型，目的是对句长进行截断</span>
        <span class="token comment"># 将每个样本的sequence_lengths加起来，得到标签的总数</span>
        total_labels <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>sequence_lengths<span class="token punctuation">)</span>
        <span class="token comment"># 进行训练</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tf_viterbi_sequence<span class="token punctuation">,</span> _ <span class="token operator">=</span> session<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>viterbi_sequence<span class="token punctuation">,</span> train_op<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                correct_labels <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">==</span> tf_viterbi_sequence<span class="token punctuation">)</span> <span class="token operator">*</span> mask<span class="token punctuation">)</span>
                accuracy <span class="token operator">=</span> <span class="token number">100.0</span> <span class="token operator">*</span> correct_labels <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>total_labels<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[{:4}/{}] Accuracy: {:.2f}%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> accuracy<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <h4><a id="4_145"></a>4.结果</h4> 
  <pre><code class="prism language-py"><span class="token punctuation">[</span> <span class="token number">100</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">61.58</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">200</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">72.11</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">300</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">80.00</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">400</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">83.68</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">500</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">85.79</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">600</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">89.47</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">700</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">91.58</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">800</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">93.16</span><span class="token operator">%</span>
<span class="token punctuation">[</span> <span class="token number">900</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">94.74</span><span class="token operator">%</span>
<span class="token punctuation">[</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">]</span>  Accuracy<span class="token punctuation">:</span> <span class="token number">94.74</span><span class="token operator">%</span>
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>DataWhale一周算法进阶3—模型融合 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="DataWhale一周算法进阶3—模型融合" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="文章目录 一 任务 二 代码 问题 一 任务 用你目前评分最高的模型作为基准模型，和其他模型进行stacking融合，得到最终模型及评分果。 二 代码 import pandas as pd import numpy as np import sys from sklearn.preprocessing import StandardScaler from sklearn.linear_model import LogisticRegression from sklearn.svm import SVC from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import RandomForestClassifier from sklearn.ensemble import GradientBoostingClassifier import xgboost as xgb from xgboost import XGBClassifier import lightgbm as lgb from lightgbm import LGBMClassifier from sklearn import metrics import matplotlib.pyplot as plt from sklearn.model_selection import KFold from sklearn.model_selection import GridSearchCV from sklearn.model_selection import cross_val_score from sklearn.metrics import make_scorer from sklearn.model_selection import cross_validate from mlxtend.classifier import StackingClassifier # 读取数据 data_all = pd.read_csv(&#39;./data_all.csv&#39;, encoding=&#39;gbk&#39;) data_all.head() # 划分数据集 from sklearn.model_selection import train_test_split features = [x for x in data_all.columns if x not in [&#39;status&#39;]] # 特征 X = data_all[features] # 特征向量 y = data_all[&#39;status&#39;] # labels X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3,random_state=2018) # 对数据进行归一化处理 scaler = StandardScaler() scaler.fit(X_train) X_train_stand = scaler.transform(X_train) X_test_stand = scaler.transform(X_test) # scaler.fit(X) # X_stand = scaler.transform(X) X_test_stand lr = LogisticRegression(random_state=2018,C=0.1) lgb = LGBMClassifier(boosting_type=&#39;GBDT&#39;,random_state=2018,silent=0) gbdt = GradientBoostingClassifier(random_state=2018,max_depth=3,n_estimators=50) xgbc = XGBClassifier(random_state=2018,max_depth=3,eta=0.1,subsample=0.6) rf = RandomForestClassifier(n_estimators=500,oob_score=True, random_state=2018) svm = SVC(random_state=2018,tol=0.01) sclf = StackingClassifier(classifiers=[lr, gbdt, xgbc,rf,svm], meta_classifier=lgb) sclf1 = StackingClassifier(classifiers=[gbdt, xgbc,svm], meta_classifier=lgb) sclf2 = StackingClassifier(classifiers=[gbdt, xgbc,svm], meta_classifier=lr) sclf3 = StackingClassifier(classifiers=[svm], meta_classifier=lr) def get_scores(model, X_train, X_test, y_train, y_test): model.fit(X_train, y_train) y_train_pred = model.predict(X_train) y_test_pred = model.predict(X_test) if hasattr(model, &quot;decision_function&quot;): y_train_proba = model.decision_function(X_train) y_test_proba = model.decision_function(X_test) else: y_train_proba = (model.predict_proba(X_train))[:, 1] y_test_proba = (model.predict_proba(X_test))[:, 1] # accuracy train_accuracy = metrics.accuracy_score(y_train, y_train_predict) test_accuracy = metrics.accuracy_score(y_test, y_test_predict) # recision train_precision = metrics.precision_score(y_train, y_train_predict) test_precision = metrics.precision_score(y_test, y_test_predict) # recall train_recall = metrics.recall_score(y_train, y_train_predict) test_recall = metrics.recall_score(y_test, y_test_predict) # f1-score train_f1 = metrics.f1_score(y_train, y_train_predict) test_f1 = metrics.f1_score(y_test, y_test_predict) # auc train_auc = metrics.roc_auc_score(y_train, y_train_proba) test_auc = metrics.roc_auc_score(y_test, y_test_proba) # roc 曲线 train_fprs,train_tprs,train_thresholds = metrics.roc_curve(y_train, y_train_proba) test_fprs,test_tprs,test_thresholds = metrics.roc_curve(y_test, y_test_proba) plt.plot(train_fprs, train_tprs) plt.plot(test_fprs, test_tprs) plt.plot([0,1], [0,1],&quot;--&quot;) plt.title(&quot;ROC curve&quot;) plt.xlabel(&quot;FPR&quot;) plt.ylabel(&quot;TPR&quot;) plt.legend(labels=[&quot;Train AUC:&quot;+str(round(train_auc, 5)),&quot;Test AUC:&quot;+str(round(test_auc,5))], loc=&quot;lower right&quot;) plt.show() #输出各种得分 print(&quot;训练集准确率：&quot;, train_accuracy) print(&quot;测试集准确率：&quot;, test_accuracy) print(&quot;==================================&quot;) print(&quot;训练集精准率：&quot;, train_precision) print(&quot;测试集精准率：&quot;, test_precision) print(&quot;==================================&quot;) print(&quot;训练集召回率：&quot;, train_recall) print(&quot;测试集召回率：&quot;, test_recall) print(&quot;==================================&quot;) print(&quot;训练集F1-score：&quot;, train_f1) print(&quot;测试集F1-score：&quot;, test_f1) print(&quot;==================================&quot;) print(&quot;训练集AUC：&quot;, train_auc) print(&quot;测试集AUC：&quot;, test_auc) get_scores(sclf, X_train, X_test, y_train, y_test) 问题 1.hhhhh代码没问题但是都kernel dead了 下次用 google colab试一下" />
<meta property="og:description" content="文章目录 一 任务 二 代码 问题 一 任务 用你目前评分最高的模型作为基准模型，和其他模型进行stacking融合，得到最终模型及评分果。 二 代码 import pandas as pd import numpy as np import sys from sklearn.preprocessing import StandardScaler from sklearn.linear_model import LogisticRegression from sklearn.svm import SVC from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import RandomForestClassifier from sklearn.ensemble import GradientBoostingClassifier import xgboost as xgb from xgboost import XGBClassifier import lightgbm as lgb from lightgbm import LGBMClassifier from sklearn import metrics import matplotlib.pyplot as plt from sklearn.model_selection import KFold from sklearn.model_selection import GridSearchCV from sklearn.model_selection import cross_val_score from sklearn.metrics import make_scorer from sklearn.model_selection import cross_validate from mlxtend.classifier import StackingClassifier # 读取数据 data_all = pd.read_csv(&#39;./data_all.csv&#39;, encoding=&#39;gbk&#39;) data_all.head() # 划分数据集 from sklearn.model_selection import train_test_split features = [x for x in data_all.columns if x not in [&#39;status&#39;]] # 特征 X = data_all[features] # 特征向量 y = data_all[&#39;status&#39;] # labels X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3,random_state=2018) # 对数据进行归一化处理 scaler = StandardScaler() scaler.fit(X_train) X_train_stand = scaler.transform(X_train) X_test_stand = scaler.transform(X_test) # scaler.fit(X) # X_stand = scaler.transform(X) X_test_stand lr = LogisticRegression(random_state=2018,C=0.1) lgb = LGBMClassifier(boosting_type=&#39;GBDT&#39;,random_state=2018,silent=0) gbdt = GradientBoostingClassifier(random_state=2018,max_depth=3,n_estimators=50) xgbc = XGBClassifier(random_state=2018,max_depth=3,eta=0.1,subsample=0.6) rf = RandomForestClassifier(n_estimators=500,oob_score=True, random_state=2018) svm = SVC(random_state=2018,tol=0.01) sclf = StackingClassifier(classifiers=[lr, gbdt, xgbc,rf,svm], meta_classifier=lgb) sclf1 = StackingClassifier(classifiers=[gbdt, xgbc,svm], meta_classifier=lgb) sclf2 = StackingClassifier(classifiers=[gbdt, xgbc,svm], meta_classifier=lr) sclf3 = StackingClassifier(classifiers=[svm], meta_classifier=lr) def get_scores(model, X_train, X_test, y_train, y_test): model.fit(X_train, y_train) y_train_pred = model.predict(X_train) y_test_pred = model.predict(X_test) if hasattr(model, &quot;decision_function&quot;): y_train_proba = model.decision_function(X_train) y_test_proba = model.decision_function(X_test) else: y_train_proba = (model.predict_proba(X_train))[:, 1] y_test_proba = (model.predict_proba(X_test))[:, 1] # accuracy train_accuracy = metrics.accuracy_score(y_train, y_train_predict) test_accuracy = metrics.accuracy_score(y_test, y_test_predict) # recision train_precision = metrics.precision_score(y_train, y_train_predict) test_precision = metrics.precision_score(y_test, y_test_predict) # recall train_recall = metrics.recall_score(y_train, y_train_predict) test_recall = metrics.recall_score(y_test, y_test_predict) # f1-score train_f1 = metrics.f1_score(y_train, y_train_predict) test_f1 = metrics.f1_score(y_test, y_test_predict) # auc train_auc = metrics.roc_auc_score(y_train, y_train_proba) test_auc = metrics.roc_auc_score(y_test, y_test_proba) # roc 曲线 train_fprs,train_tprs,train_thresholds = metrics.roc_curve(y_train, y_train_proba) test_fprs,test_tprs,test_thresholds = metrics.roc_curve(y_test, y_test_proba) plt.plot(train_fprs, train_tprs) plt.plot(test_fprs, test_tprs) plt.plot([0,1], [0,1],&quot;--&quot;) plt.title(&quot;ROC curve&quot;) plt.xlabel(&quot;FPR&quot;) plt.ylabel(&quot;TPR&quot;) plt.legend(labels=[&quot;Train AUC:&quot;+str(round(train_auc, 5)),&quot;Test AUC:&quot;+str(round(test_auc,5))], loc=&quot;lower right&quot;) plt.show() #输出各种得分 print(&quot;训练集准确率：&quot;, train_accuracy) print(&quot;测试集准确率：&quot;, test_accuracy) print(&quot;==================================&quot;) print(&quot;训练集精准率：&quot;, train_precision) print(&quot;测试集精准率：&quot;, test_precision) print(&quot;==================================&quot;) print(&quot;训练集召回率：&quot;, train_recall) print(&quot;测试集召回率：&quot;, test_recall) print(&quot;==================================&quot;) print(&quot;训练集F1-score：&quot;, train_f1) print(&quot;测试集F1-score：&quot;, test_f1) print(&quot;==================================&quot;) print(&quot;训练集AUC：&quot;, train_auc) print(&quot;测试集AUC：&quot;, test_auc) get_scores(sclf, X_train, X_test, y_train, y_test) 问题 1.hhhhh代码没问题但是都kernel dead了 下次用 google colab试一下" />
<link rel="canonical" href="https://mlh.app/2019/01/09/3f0ea0ef618117749643862025388a18.html" />
<meta property="og:url" content="https://mlh.app/2019/01/09/3f0ea0ef618117749643862025388a18.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-09T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"文章目录 一 任务 二 代码 问题 一 任务 用你目前评分最高的模型作为基准模型，和其他模型进行stacking融合，得到最终模型及评分果。 二 代码 import pandas as pd import numpy as np import sys from sklearn.preprocessing import StandardScaler from sklearn.linear_model import LogisticRegression from sklearn.svm import SVC from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import RandomForestClassifier from sklearn.ensemble import GradientBoostingClassifier import xgboost as xgb from xgboost import XGBClassifier import lightgbm as lgb from lightgbm import LGBMClassifier from sklearn import metrics import matplotlib.pyplot as plt from sklearn.model_selection import KFold from sklearn.model_selection import GridSearchCV from sklearn.model_selection import cross_val_score from sklearn.metrics import make_scorer from sklearn.model_selection import cross_validate from mlxtend.classifier import StackingClassifier # 读取数据 data_all = pd.read_csv(&#39;./data_all.csv&#39;, encoding=&#39;gbk&#39;) data_all.head() # 划分数据集 from sklearn.model_selection import train_test_split features = [x for x in data_all.columns if x not in [&#39;status&#39;]] # 特征 X = data_all[features] # 特征向量 y = data_all[&#39;status&#39;] # labels X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3,random_state=2018) # 对数据进行归一化处理 scaler = StandardScaler() scaler.fit(X_train) X_train_stand = scaler.transform(X_train) X_test_stand = scaler.transform(X_test) # scaler.fit(X) # X_stand = scaler.transform(X) X_test_stand lr = LogisticRegression(random_state=2018,C=0.1) lgb = LGBMClassifier(boosting_type=&#39;GBDT&#39;,random_state=2018,silent=0) gbdt = GradientBoostingClassifier(random_state=2018,max_depth=3,n_estimators=50) xgbc = XGBClassifier(random_state=2018,max_depth=3,eta=0.1,subsample=0.6) rf = RandomForestClassifier(n_estimators=500,oob_score=True, random_state=2018) svm = SVC(random_state=2018,tol=0.01) sclf = StackingClassifier(classifiers=[lr, gbdt, xgbc,rf,svm], meta_classifier=lgb) sclf1 = StackingClassifier(classifiers=[gbdt, xgbc,svm], meta_classifier=lgb) sclf2 = StackingClassifier(classifiers=[gbdt, xgbc,svm], meta_classifier=lr) sclf3 = StackingClassifier(classifiers=[svm], meta_classifier=lr) def get_scores(model, X_train, X_test, y_train, y_test): model.fit(X_train, y_train) y_train_pred = model.predict(X_train) y_test_pred = model.predict(X_test) if hasattr(model, &quot;decision_function&quot;): y_train_proba = model.decision_function(X_train) y_test_proba = model.decision_function(X_test) else: y_train_proba = (model.predict_proba(X_train))[:, 1] y_test_proba = (model.predict_proba(X_test))[:, 1] # accuracy train_accuracy = metrics.accuracy_score(y_train, y_train_predict) test_accuracy = metrics.accuracy_score(y_test, y_test_predict) # recision train_precision = metrics.precision_score(y_train, y_train_predict) test_precision = metrics.precision_score(y_test, y_test_predict) # recall train_recall = metrics.recall_score(y_train, y_train_predict) test_recall = metrics.recall_score(y_test, y_test_predict) # f1-score train_f1 = metrics.f1_score(y_train, y_train_predict) test_f1 = metrics.f1_score(y_test, y_test_predict) # auc train_auc = metrics.roc_auc_score(y_train, y_train_proba) test_auc = metrics.roc_auc_score(y_test, y_test_proba) # roc 曲线 train_fprs,train_tprs,train_thresholds = metrics.roc_curve(y_train, y_train_proba) test_fprs,test_tprs,test_thresholds = metrics.roc_curve(y_test, y_test_proba) plt.plot(train_fprs, train_tprs) plt.plot(test_fprs, test_tprs) plt.plot([0,1], [0,1],&quot;--&quot;) plt.title(&quot;ROC curve&quot;) plt.xlabel(&quot;FPR&quot;) plt.ylabel(&quot;TPR&quot;) plt.legend(labels=[&quot;Train AUC:&quot;+str(round(train_auc, 5)),&quot;Test AUC:&quot;+str(round(test_auc,5))], loc=&quot;lower right&quot;) plt.show() #输出各种得分 print(&quot;训练集准确率：&quot;, train_accuracy) print(&quot;测试集准确率：&quot;, test_accuracy) print(&quot;==================================&quot;) print(&quot;训练集精准率：&quot;, train_precision) print(&quot;测试集精准率：&quot;, test_precision) print(&quot;==================================&quot;) print(&quot;训练集召回率：&quot;, train_recall) print(&quot;测试集召回率：&quot;, test_recall) print(&quot;==================================&quot;) print(&quot;训练集F1-score：&quot;, train_f1) print(&quot;测试集F1-score：&quot;, test_f1) print(&quot;==================================&quot;) print(&quot;训练集AUC：&quot;, train_auc) print(&quot;测试集AUC：&quot;, test_auc) get_scores(sclf, X_train, X_test, y_train, y_test) 问题 1.hhhhh代码没问题但是都kernel dead了 下次用 google colab试一下","@type":"BlogPosting","url":"https://mlh.app/2019/01/09/3f0ea0ef618117749643862025388a18.html","headline":"DataWhale一周算法进阶3—模型融合","dateModified":"2019-01-09T00:00:00+08:00","datePublished":"2019-01-09T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/01/09/3f0ea0ef618117749643862025388a18.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>DataWhale一周算法进阶3---模型融合</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p></p>
  <div class="toc">
   <h3>文章目录</h3>
   <ul>
    <ul>
     <ul>
      <li><a href="#__1" rel="nofollow">一 任务</a></li>
      <li><a href="#__3" rel="nofollow">二 代码</a></li>
      <li><a href="#_123" rel="nofollow">问题</a></li>
     </ul>
    </ul>
   </ul>
  </div>
  <p></p> 
  <h3><a id="__1"></a>一 任务</h3> 
  <p>用你目前评分最高的模型作为基准模型，和其他模型进行stacking融合，得到最终模型及评分果。</p> 
  <h3><a id="__3"></a>二 代码</h3> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd 
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> GradientBoostingClassifier
<span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb
<span class="token keyword">from</span> xgboost <span class="token keyword">import</span> XGBClassifier
<span class="token keyword">import</span> lightgbm <span class="token keyword">as</span> lgb
<span class="token keyword">from</span> lightgbm <span class="token keyword">import</span> LGBMClassifier

<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> KFold 
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> make_scorer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_validate
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>classifier <span class="token keyword">import</span> StackingClassifier
</code></pre> 
  <pre><code class="prism language-python"><span class="token comment"># 读取数据</span>
data_all <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./data_all.csv'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">)</span>
data_all<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 划分数据集</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
features <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> data_all<span class="token punctuation">.</span>columns <span class="token keyword">if</span> x <span class="token operator">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 特征</span>
X <span class="token operator">=</span> data_all<span class="token punctuation">[</span>features<span class="token punctuation">]</span> <span class="token comment"># 特征向量</span>
y <span class="token operator">=</span> data_all<span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">]</span> <span class="token comment"># labels</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">)</span>

<span class="token comment"># 对数据进行归一化处理</span>
scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
scaler<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
X_train_stand <span class="token operator">=</span> scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
X_test_stand <span class="token operator">=</span> scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token comment"># scaler.fit(X)</span>
<span class="token comment"># X_stand = scaler.transform(X)</span>
X_test_stand
</code></pre> 
  <pre><code class="prism language-python">lr <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">,</span>C<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
lgb <span class="token operator">=</span> LGBMClassifier<span class="token punctuation">(</span>boosting_type<span class="token operator">=</span><span class="token string">'GBDT'</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">,</span>silent<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
gbdt <span class="token operator">=</span> GradientBoostingClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">,</span>max_depth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>n_estimators<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
xgbc <span class="token operator">=</span> XGBClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">,</span>max_depth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>eta<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>subsample<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>
rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>oob_score<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">)</span>
svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">2018</span><span class="token punctuation">,</span>tol<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
sclf <span class="token operator">=</span> StackingClassifier<span class="token punctuation">(</span>classifiers<span class="token operator">=</span><span class="token punctuation">[</span>lr<span class="token punctuation">,</span> gbdt<span class="token punctuation">,</span> xgbc<span class="token punctuation">,</span>rf<span class="token punctuation">,</span>svm<span class="token punctuation">]</span><span class="token punctuation">,</span> meta_classifier<span class="token operator">=</span>lgb<span class="token punctuation">)</span>
sclf1 <span class="token operator">=</span> StackingClassifier<span class="token punctuation">(</span>classifiers<span class="token operator">=</span><span class="token punctuation">[</span>gbdt<span class="token punctuation">,</span> xgbc<span class="token punctuation">,</span>svm<span class="token punctuation">]</span><span class="token punctuation">,</span> meta_classifier<span class="token operator">=</span>lgb<span class="token punctuation">)</span>
sclf2 <span class="token operator">=</span> StackingClassifier<span class="token punctuation">(</span>classifiers<span class="token operator">=</span><span class="token punctuation">[</span>gbdt<span class="token punctuation">,</span> xgbc<span class="token punctuation">,</span>svm<span class="token punctuation">]</span><span class="token punctuation">,</span> meta_classifier<span class="token operator">=</span>lr<span class="token punctuation">)</span>
sclf3 <span class="token operator">=</span> StackingClassifier<span class="token punctuation">(</span>classifiers<span class="token operator">=</span><span class="token punctuation">[</span>svm<span class="token punctuation">]</span><span class="token punctuation">,</span> meta_classifier<span class="token operator">=</span>lr<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_scores</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>   
    y_train_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
    y_test_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">"decision_function"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_train_proba <span class="token operator">=</span> model<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
        y_test_proba <span class="token operator">=</span> model<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        y_train_proba <span class="token operator">=</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        y_test_proba <span class="token operator">=</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># accuracy</span>
    train_accuracy <span class="token operator">=</span> metrics<span class="token punctuation">.</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> y_train_predict<span class="token punctuation">)</span>
    test_accuracy <span class="token operator">=</span> metrics<span class="token punctuation">.</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_predict<span class="token punctuation">)</span>
    <span class="token comment"># recision</span>
    train_precision <span class="token operator">=</span> metrics<span class="token punctuation">.</span>precision_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> y_train_predict<span class="token punctuation">)</span>
    test_precision <span class="token operator">=</span> metrics<span class="token punctuation">.</span>precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_predict<span class="token punctuation">)</span>
    <span class="token comment"># recall</span>
    train_recall <span class="token operator">=</span> metrics<span class="token punctuation">.</span>recall_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> y_train_predict<span class="token punctuation">)</span>
    test_recall <span class="token operator">=</span> metrics<span class="token punctuation">.</span>recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_predict<span class="token punctuation">)</span>
    <span class="token comment"># f1-score</span>
    train_f1 <span class="token operator">=</span> metrics<span class="token punctuation">.</span>f1_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> y_train_predict<span class="token punctuation">)</span>
    test_f1 <span class="token operator">=</span> metrics<span class="token punctuation">.</span>f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_predict<span class="token punctuation">)</span>
    <span class="token comment"># auc</span>
    train_auc <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_auc_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> y_train_proba<span class="token punctuation">)</span>
    test_auc <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_proba<span class="token punctuation">)</span>
    <span class="token comment"># roc 曲线</span>
    train_fprs<span class="token punctuation">,</span>train_tprs<span class="token punctuation">,</span>train_thresholds <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_curve<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> y_train_proba<span class="token punctuation">)</span>
    test_fprs<span class="token punctuation">,</span>test_tprs<span class="token punctuation">,</span>test_thresholds <span class="token operator">=</span> metrics<span class="token punctuation">.</span>roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_proba<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_fprs<span class="token punctuation">,</span> train_tprs<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>test_fprs<span class="token punctuation">,</span> test_tprs<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"--"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"ROC curve"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"FPR"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"TPR"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Train AUC:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>train_auc<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"Test AUC:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>test_auc<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">"lower right"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#输出各种得分</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集准确率："</span><span class="token punctuation">,</span> train_accuracy<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集准确率："</span><span class="token punctuation">,</span> test_accuracy<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=================================="</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集精准率："</span><span class="token punctuation">,</span> train_precision<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集精准率："</span><span class="token punctuation">,</span> test_precision<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=================================="</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集召回率："</span><span class="token punctuation">,</span> train_recall<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集召回率："</span><span class="token punctuation">,</span> test_recall<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=================================="</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集F1-score："</span><span class="token punctuation">,</span> train_f1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集F1-score："</span><span class="token punctuation">,</span> test_f1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=================================="</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集AUC："</span><span class="token punctuation">,</span> train_auc<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集AUC："</span><span class="token punctuation">,</span> test_auc<span class="token punctuation">)</span>
</code></pre> 
  <pre><code class="prism language-python">get_scores<span class="token punctuation">(</span>sclf<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>
</code></pre> 
  <h3><a id="_123"></a>问题</h3> 
  <blockquote> 
   <p>1.hhhhh代码没问题但是都kernel dead了 下次用 google colab试一下</p> 
  </blockquote> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-7b4cdcb592.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>AdaBoost代码实现与代码详解 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="AdaBoost代码实现与代码详解" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一、手动操作模式 1、创建数据集及分类结果 import numpy as np import matplotlib.pyplot as plt import pandas as pd xMat=np.matrix([[1. ,2.1], #数据集 [2. ,1.1], [1.3,1. ], [1. ,1. ], [2. ,1. ]]) yMat=np.mat([[ 1.], #预设分类结果，用于模型预测结果的校对 [ 1.], [-1.], [-1.], [ 1.]] 2、描点 plt.rcParams[&#39;font.sans-serif&#39;]=[&#39;Simhei&#39;] def showPlot(xMat,yMat): x=np.array(xMat[:,0]) y=np.array(xMat[:,1]) lable=np.array(yMat) plt.scatter(x,y,c=lable) plt.title(&#39;决策树桩测试数据&#39;) plt.show() showPlot(xMat,yMat) 部分代码说明 lable=np.array(yMat) plt.scatter(x,y,c=lable) #scatter()的c即为color，yMat的内容只为1和-1，所以c=lable表示两种不同的颜色 3、构建决策树桩(二分类的基学习器) &#39;&#39;&#39; 决策树桩分类函数： xMat:数据矩阵 i:第i列，也就是第几个特征 Q:阈值 S:标志 re:分类结果 &#39;&#39;&#39; def Classify0(xMat,i,Q,S): re=np.ones((xMat.shape[0],1)) #初始化re为一堆1 if(S==&#39;lt&#39;): #lt:less than re[xMat[:,i]&lt;=Q]=-1 #如果是less且小于阈值，则赋值为-1 elif(S==&#39;gt&#39;): #gt:greater than re[xMat[:,i]&gt;Q]=-1 #如果是greater且大于阈值，则赋值为-1 return re 上方代码理解 对之后的def get_Stump(xMat,yMat,D)进行截断： re=Classify0(xMat,i,Q,S) print(&#39;Q:&#39;,Q,&#39;\n&#39;,&#39;S:&#39;,S,&#39;\n&#39;,&#39;re:\n&#39;,re,&#39;\n&#39;) 对Q(阈值)的理解(举例)： 数据集和预设分类结果： 决策树桩(基学习器)： 其中的2.5就表示阈值Q啦，但并非所有的基学习器都是这个，因为阈值Q会发生移动： (参考get_Stump(xMat,yMat,D)中的Q=(Min+j*stepSize)) 截断示意图： 先初始化m和D后才能运行上方截断部分： m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) 截断运行结果： 由此可知，对于每一个阈值Q，大于阈值和小于阈值的两个方向都遍历 (因为两个标签’lt’和’gt’都要遍历，参考def get_Stump(xMat,yMat,D)的for S in [‘lt’,‘gt’]) 4、寻找最佳决策树桩 &#39;&#39;&#39; 找到数据集上最佳的决策树桩： xMat:特征矩阵 yMat:标签矩阵 D:样本权重 bestStump:最佳决策树桩信息 minE:最小误差 bestClas:最佳的分类结果 &#39;&#39;&#39; def get_Stump(xMat,yMat,D): m,n=xMat.shape #m为样本个数5，n为特征数2 Steps=10 #初始化步数 bestStump={} #用字典形式来储存树桩信息 bestClas=np.mat(np.zeros((m,1))) #初始化分类结果为1，5行1列 minE=np.inf #最小误差初始化为正无穷大 for i in range(n): #遍历所有特征 Min=xMat[:,i].min() #找到特征中最小值 Max=xMat[:,i].max() #找到特征中最大值 stepSize=(Max-Min)/Steps #计算总步长，用以移动阈值 for j in range(-1,int(Steps)+1): for S in [&#39;lt&#39;,&#39;gt&#39;]: #大于和小于的情况，两种方法均遍历；lt:less than, gt:greater than Q=(Min+j*stepSize) #计算阈值 re=Classify0(xMat,i,Q,S) #决策树桩分类方法，得分类结果 err=np.mat(np.ones((m,1))) #初始化误差矩阵，一堆1 err[re==yMat]=0 #分类正确的，赋值为0，若分类错误，则为原数1 eca=D.T*err #计算误差 #print(f&#39;切分特征:{i},阈值:{np.round(Q,2)},标志:{S},权重误差:{np.round(eca,3)}&#39;) if(eca&lt;minE): #找到误差最小的分类方式 minE=eca bestClas=re.copy() bestStump[&#39;特征列&#39;]=i bestStump[&#39;阈值&#39;]=Q bestStump[&#39;标志&#39;]=S return bestStump,minE,bestClas 部分代码理解 minE=np.inf &#39;&#39;&#39; 这个函数的目的是通过寻找最小误差率得到对应的决策树桩，即为最佳的决策树桩， 因此不妨将误差率初始化为无穷大，在AdaBoost的迭代误差率会被更小的覆盖 (误差率会不断下降) &#39;&#39;&#39; Steps=10 for i in range(n): Min=xMat[:,i].min() Max=xMat[:,i].max() stepSize=(Max-Min)/Steps &#39;&#39;&#39;stepSize为阈值Q的移动小步&#39;&#39;&#39; 5、基于决策树桩的AdaBoost训练过程 &#39;&#39;&#39; 基于决策树桩的AdaBoost训练过程，训练出基学习器和最终训练结果 xMat:特征矩阵(数据集) yMat:标签矩阵(预设的分类结果，用于模型预测结果的校对) maxC:最大迭代次数 weakClass:基分类器 aggClass:最终类别估计值(即西瓜书P174的伪代码中H(x)中的累加量) &#39;&#39;&#39; def Ada_train(xMat,yMat,maxC): weakClass=[] #基学习器 m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) #初始化样本权重(每个样本权重相等) aggClass=np.mat(np.zeros((m,1))) #最终结果的初始化 for i in range(maxC): Stump,error,bestClas=get_Stump(xMat,yMat,D) #构建决策树桩 alpha=float(0.5*np.log((1-error)/max(error,1e-16))) #计算弱分类器权重alpha，即西瓜书P174伪代码的第6行 Stump[&#39;alpha&#39;]=np.round(alpha,2) #存储弱学习算法权重，保留两位小数 weakClass.append(Stump) #存储决策树桩 #以下3行为西瓜书的P174伪代码第7行的最终公式 expon=np.exp(np.multiply(-1*alpha*yMat,bestClas)) #计算e的指数项 D=np.multiply(D,expon) D=D/D.sum() #根据样本权重公式，更新样本权重 #以下2行为西瓜书的P174伪代码的输出公式 aggClass+=alpha*bestClas #更新累计类别估计值 Hx=np.sign(aggClass) #最终分类结果 aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) #计算误差 errRate=aggErr.sum()/m print(&#39;分类错误率:&#39;,errRate) if(errRate==0): break #当误差为0时，达到最优，退出循环 return weakClass,aggClass weakClass,aggClass=Ada_train(xMat,yMat,40) print(&#39;最佳基学习器：\n&#39;,weakClass,&#39;\nH(x)中的累加量：\n&#39;,aggClass) 运行结果： 分类错误率: 0.2 分类错误率: 0.2 分类错误率: 0.0 最佳基学习器： [{&#39;特征列&#39;: 0, &#39;阈值&#39;: 1.3, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.69}, {&#39;特征列&#39;: 1, &#39;阈值&#39;: 1.0, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.97}, {&#39;特征列&#39;: 0, &#39;阈值&#39;: 0.9, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.9 }] H(x)中的累加量： [[ 1.17568763] [ 2.56198199] [-0.77022252] [-0.77022252] [ 0.61607184]] 有好心人能在评论区帮我详细讲解一下下面这段代码怎么理解吗：) aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) #计算误差 errRate=aggErr.sum()/m 6、测试 def AdaClassify(data,weakClass): #这里的weakClass为训练得到的最佳基学习器 dataMat=np.mat(data) m=dataMat.shape[0] aggClass=np.mat(np.zeros((m,1))) #用上方训练出来的最佳基学习器进行测试: for i in range(len(weakClass)): #遍历所有分类器，进行分类 classEst=Classify0(dataMat, weakClass[i][&#39;特征列&#39;], weakClass[i][&#39;阈值&#39;], weakClass[i][&#39;标志&#39;]) aggClass+=weakClass[i][&#39;alpha&#39;]*classEst return np.sign(aggClass) print(AdaClassify([0,0],weakClass)) #最终分类为-1 7、上实例(病马数据集) 我不知道怎么把数据放上去… def calAcc(maxC): dataSetTrain=pd.read_table(&#39;E:/AdaBoost/horseColicTraining2.txt&#39;,header=None) train_xMat=np.mat(dataSetTrain.iloc[:,:-1].values) #数据集 train_yMat=np.mat(dataSetTrain.iloc[:,-1].values).T #预设分类结果 weakClass,aggClass=Ada_train(train_xMat,train_yMat,maxC) #训练出最佳基学习器们 yhat=AdaClassify(train_xMat,weakClass) #用训练出来的最佳基学习器们测试出H(x)即yHat(预测得的分类结果) trainCorCount=0 #初始化准确个数为0 m=train_xMat.shape[0] for i in range(m): if(yhat[i]==train_yMat[i]): trainCorCount+=1 #若某一预测结果正确累计+1 trainAcc=trainCorCount/m print(&#39;训练集准确率为:&#39;,trainAcc) testCorCount=0 dataSetTest=pd.read_table(&#39;E:/AdaBoost/horseColicTest2.txt&#39;,header=None) test_xMat=np.mat(dataSetTest.iloc[:,:-1].values) test_yMat=np.mat(dataSetTest.iloc[:,-1].values).T yhat=AdaClassify(test_xMat,weakClass) #weakClass在上方已训练出来了 n=test_xMat.shape[0] for i in range(n): if(yhat[i]==test_yMat[i]): testCorCount+=1 testAcc=testCorCount/n print(&#39;测试集准确率为:&#39;,testAcc) return trainAcc,testAcc print(calAcc(40)) #迭代40次 运行结果： 分类错误率: 0.2842809364548495 分类错误率: 0.2842809364548495 分类错误率: 0.24749163879598662 分类错误率: 0.24749163879598662 分类错误率: 0.25418060200668896 分类错误率: 0.2408026755852843 分类错误率: 0.2408026755852843 分类错误率: 0.22073578595317725 分类错误率: 0.24749163879598662 分类错误率: 0.23076923076923078 分类错误率: 0.2408026755852843 分类错误率: 0.2140468227424749 分类错误率: 0.22742474916387959 分类错误率: 0.21739130434782608 分类错误率: 0.22073578595317725 分类错误率: 0.21739130434782608 分类错误率: 0.22408026755852842 分类错误率: 0.22408026755852842 分类错误率: 0.23076923076923078 分类错误率: 0.22408026755852842 分类错误率: 0.2140468227424749 分类错误率: 0.20735785953177258 分类错误率: 0.22408026755852842 分类错误率: 0.22408026755852842 分类错误率: 0.2140468227424749 分类错误率: 0.22073578595317725 分类错误率: 0.2040133779264214 分类错误率: 0.20735785953177258 分类错误率: 0.21070234113712374 分类错误率: 0.21739130434782608 分类错误率: 0.21070234113712374 分类错误率: 0.21739130434782608 分类错误率: 0.20735785953177258 分类错误率: 0.21070234113712374 分类错误率: 0.20735785953177258 分类错误率: 0.20735785953177258 分类错误率: 0.19732441471571907 分类错误率: 0.19063545150501673 分类错误率: 0.20066889632107024 分类错误率: 0.19732441471571907 训练集准确率为: 0.802675585284281 测试集准确率为: 0.8059701492537313 (0.802675585284281, 0.8059701492537313) 8、代码整合 import numpy as np import matplotlib.pyplot as plt import pandas as pd xMat=np.matrix([[1. ,2.1], [2. ,1.1], [1.3,1. ], [1. ,1. ], [2. ,1. ]]) yMat=np.mat([[ 1.], [ 1.], [-1.], [-1.], [ 1.]]) plt.rcParams[&#39;font.sans-serif&#39;]=[&#39;Simhei&#39;] def showPlot(xMat,yMat): x=np.array(xMat[:,0]) y=np.array(xMat[:,1]) lable=np.array(yMat) plt.scatter(x,y,c=lable) plt.title(&#39;决策树桩测试数据&#39;) plt.show() showPlot(xMat,yMat) def Classify0(xMat,i,Q,S): re=np.ones((xMat.shape[0],1)) if(S==&#39;lt&#39;): re[xMat[:,i]&lt;=Q]=-1 elif(S==&#39;gt&#39;): re[xMat[:,i]&gt;Q]=-1 return re def get_Stump(xMat,yMat,D): m,n=xMat.shape Steps=10 bestStump={} bestClas=np.mat(np.zeros((m,1))) minE=np.inf for i in range(n): Min=xMat[:,i].min() Max=xMat[:,i].max() stepSize=(Max-Min)/Steps for j in range(-1,int(Steps)+1): for S in [&#39;lt&#39;,&#39;gt&#39;]: Q=(Min+j*stepSize) re=Classify0(xMat,i,Q,S) err=np.mat(np.ones((m,1))) err[re==yMat]=0 eca=D.T*err if(eca&lt;minE): minE=eca bestClas=re.copy() bestStump[&#39;特征列&#39;]=i bestStump[&#39;阈值&#39;]=Q bestStump[&#39;标志&#39;]=S return bestStump,minE,bestClas def Ada_train(xMat,yMat,maxC): weakClass=[] m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) aggClass=np.mat(np.zeros((m,1))) for i in range(maxC): Stump,error,bestClas=get_Stump(xMat,yMat,D) alpha=float(0.5*np.log((1-error)/max(error,1e-16))) Stump[&#39;alpha&#39;]=np.round(alpha,2) weakClass.append(Stump) expon=np.exp(np.multiply(-1*alpha*yMat,bestClas)) D=np.multiply(D,expon) D=D/D.sum() aggClass+=alpha*bestClas Hx=np.sign(aggClass) aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) errRate=aggErr.sum()/m print(&#39;分类错误率:&#39;,errRate) if(errRate==0): break return weakClass,aggClass weakClass,aggClass=Ada_train(xMat,yMat,40) print(&#39;最佳基学习器：\n&#39;,weakClass,&#39;\nH(x)中的累加量：\n&#39;,aggClass) def AdaClassify(data,weakClass): dataMat=np.mat(data) m=dataMat.shape[0] aggClass=np.mat(np.zeros((m,1))) for i in range(len(weakClass)): classEst=Classify0(dataMat,weakClass[i][&#39;特征列&#39;], weakClass[i][&#39;阈值&#39;], weakClass[i][&#39;标志&#39;]) aggClass+=weakClass[i][&#39;alpha&#39;]*classEst return np.sign(aggClass) print(AdaClassify([0,0],weakClass)) def calAcc(maxC): dataSetTrain=pd.read_table(&#39;E:/AdaBoost/horseColicTraining2.txt&#39;,header=None) train_xMat=np.mat(dataSetTrain.iloc[:,:-1].values) train_yMat=np.mat(dataSetTrain.iloc[:,-1].values).T weakClass,aggClass=Ada_train(train_xMat,train_yMat,maxC) yhat=AdaClassify(train_xMat,weakClass) trainCorCount=0 m=train_xMat.shape[0] for i in range(m): if(yhat[i]==train_yMat[i]): trainCorCount+=1 trainAcc=trainCorCount/m print(&#39;训练集准确率为:&#39;,trainAcc) testCorCount=0 dataSetTest=pd.read_table(&#39;E:/AdaBoost/horseColicTest2.txt&#39;,header=None) test_xMat=np.mat(dataSetTest.iloc[:,:-1].values) test_yMat=np.mat(dataSetTest.iloc[:,-1].values).T yhat=AdaClassify(test_xMat,weakClass) n=test_xMat.shape[0] for i in range(n): if(yhat[i]==test_yMat[i]): testCorCount+=1 testAcc=testCorCount/n print(&#39;测试集准确率为:&#39;,testAcc) return trainAcc,testAcc print(calAcc(40)) 二、内置函数模式 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_gaussian_quantiles from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import AdaBoostClassifier 1、创建数据集 x1,y1=make_gaussian_quantiles(cov=2.,n_samples=200,n_features=2,n_classes=2,random_state=1) #为了增加样本分布的复杂度，再生成一个数据分布 x2,y2=make_gaussian_quantiles(mean=(3,3),cov=1.5,n_samples=300, #两样本特征均值为3和3 n_features=2,n_classes=2,random_state=1) x=np.concatenate((x1,x2)); y=np.concatenate((y1,-y2+1)) #np.concatenate:默认垂直合并 #x:数据; y:数据集所属类别(两类:0或1) print(&#39;数据集：\n&#39;,x,&#39;\n&#39;,&#39;分类标签：\n&#39;,y) 部分代码说明 &#39;&#39;&#39;make_gaussian_quantiles:生成分组多维正态分布的数据； mean:特征均值(上方默认为(0,0))；cov:样本协方差的系数；n_samples:样本个数； n_features:正态分布的维数；n_classe:输出的类别数； n_classe=2：生成的数据按分位数分成2组&#39;&#39;&#39; 运行结果 数据集： [[ 7.00334571e-01 -2.47067578e-01] [-3.95001869e+00 2.74007953e+00] [ 1.50221617e-01 -2.15763780e+00] [-1.67205033e+00 -9.41519069e-01] ... ... [ 8.94180435e-01 3.06995865e+00] [ 8.49439078e-01 3.87543489e+00] [ 5.21744335e+00 1.40081765e+00]] 分类标签： [0 1 1 1 1 1 1 0 1 1 0 1 1 0 1 1 1 1 1 1 1 0 1 0 0 1 0 0 1 1 0 1 0 1 1 1 ... 1 1 0 0 1 0 0 1 0 0 0 1 0 1 0 0 0 0 1 0 0 0 0 0 0 1 0 0 1 1 0 0 0] 2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合 weakClassifier=DecisionTreeClassifier(max_depth=1) bdt=AdaBoostClassifier(weakClassifier,algorithm=&quot;SAMME&quot;,n_estimators=200) #选择SAMME算法，最多200个弱分类器 bdt.fit(x,y) #fit():训练算法，设置内部参数 3、描绘决策边缘 plt.figure(figsize=(10,5)) #生成10(in)*5(in)=50(in^2)大的空画布 plt.subplot(121) x_min,x_max=x[:,0].min()-1,x[:,0].max()+1 y_min,y_max=x[:,1].min()-1,x[:,1].max()+1 #上述两行为下面画网格图做准备(控制范围，使数据合理坐落在图中) plot_step=0.02 xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) Z=Z.reshape(xx.shape) #以上2行，将xx、yy展开，然后预测每个点的类别，将结果大小调整到和坐标数据相同的矩阵大小 cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) plt.axis(&#39;tight&#39;) #使坐标轴适应数据量，即有一个范围合理的坐标轴 plt.show() 部分代码说明 plt.subplot(121) &#39;&#39;&#39; 将画布大小分成几个部分，参数&#39;121&#39;表示1(row)x2(col)，即将画布分成1x2，一行两列的 2块区域，第三个数1表示选择图形输出的区域在第一块，图形输出区域参数必须在&quot;行×列&quot;范 围内，此处必须在1和2之间选择 &#39;&#39;&#39; xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) &#39;&#39;&#39; 生成网格点坐标矩阵，在x、y方向上以plot_step逐渐生成 (以0.02的步伐在X坐标上取点,以0.02的步伐在Y坐标上取点) 基本取满坐标中的画布 &#39;&#39;&#39; Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) &#39;&#39;&#39; np.c_[]:多维数组水平合并，对一维数组放竖再水平合并 np.ravel():将多行的多维数组铺平成一维数组(一行) predict():返回的是一个大小为n的一维数组，用训练好的分类器去预测出()内数据的标签， 一维数组中的第i个值为模型预测第i个预测样本的标签，即在y中的对应值 如： x_train=np.array([[1,2,3],[1,3,4],[2,1,2],[4,5,6],[3,5,3],[1,7,2]]) y_train=np.array([0,0,0,1,1,1]) x_test=np.array([[2,2,2],[3,2,6],[1,7,4]]) clf=LogisticRegression() clf.fit(x_train,y_train) clf.predict(x_test) &gt;&gt;&gt;array([1,0,1]) &#39;&#39;&#39; cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) &#39;&#39;&#39; plt.contourf(X,Y,f(X,Y))，其中X、Y为shape相同的一维数组 plt.cm中cm全称表示colormap，paired表示两个两个相近色彩输出， 比如浅蓝、深蓝；浅红、深红；浅绿，深绿 &#39;&#39;&#39; 运行结果 4、描点 plot_colors=&#39;br&#39;;class_names=&#39;AB&#39; for i,n,c in zip(range(2),class_names,plot_colors): idx=np.where(y==i) plt.scatter(x[idx,0],x[idx,1],color=c,cmap=plt.cm.Paired, s=20,edgecolor=&#39;k&#39;,label=&#39;Class %s&#39;%n) plt.xlim(x_min,x_max);plt.ylim(y_min,y_max) plt.legend(loc=&#39;upper right&#39;) plt.xlabel(&#39;x&#39;),plt.ylabel(&#39;y&#39;) plt.title(&#39;Decision Boundary&#39;) plt.show() 部分代码说明 idx=np.where(y==i) &#39;&#39;&#39; np.where(condition,x,y)，满足条件(condition)，输出x，不满足输出y； 若只有条件(condition)，没有x和y，则输出满足条件(即非0)元素的坐标，这里的坐标以tuple的形式给出 如： a=np.array([2,4,6,8,10]) np.where(a&gt;5) &gt;&gt;&gt;(array([2,3,4]),) &#39;&#39;&#39; for i,n,c in zip(range(2),class_names,plot_colors): print(i,n,c) &#39;&#39;&#39; &gt;&gt;&gt; 0 A b 1 B r &#39;&#39;&#39; 运行结果 5、描绘两类别(1和0)得分 twoclass_output=bdt.decision_function(x) #decision_function(x):计算输入x的决策函数值 plot_range=(twoclass_output.min(),twoclass_output.max()) plt.subplot(122) for i,n,c in zip(range(2),class_names,plot_colors): plt.hist(twoclass_output[y==i],bins=10,range=plot_range,facecolor=c, label=&#39;Class %s&#39;%n,alpha=0.5,edgecolor=&#39;k&#39;) #bins指定箱子的个数，即总共有几条条状图 x1,x2,y1,y2=plt.axis() plt.axis((x1,x2,y1,y2*1.2)) #plt.axis([-1,10,0,6]):x轴起始于-1，终止于10，y轴起始于0，终止于6 plt.legend(loc=&#39;upper right&#39;) plt.ylabel(&#39;Samples&#39;);plt.xlabel(&#39;Score&#39;) plt.title(&#39;Decision Scores&#39;) plt.tight_layout() #tight_layout会自动调整子图参数，使之填充整个图像区域 plt.subplots_adjust(wspace=0.35) #以上2行都为调整图像边缘及图像间的空白间隔 plt.show() 运行结果 6、代码整合 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_gaussian_quantiles from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import AdaBoostClassifier #1、创建数据集 x1,y1=make_gaussian_quantiles(cov=2.,n_samples=200,n_features=2,n_classes=2,random_state=1) x2,y2=make_gaussian_quantiles(mean=(3,3),cov=1.5,n_samples=300, n_features=2,n_classes=2,random_state=1) x=np.concatenate((x1,x2)); y=np.concatenate((y1,-y2+1)) #2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合 weakClassifier=DecisionTreeClassifier(max_depth=1) bdt=AdaBoostClassifier(weakClassifier,algorithm=&quot;SAMME&quot;,n_estimators=200) bdt.fit(x,y) #3、描绘决策边缘 plt.figure(figsize=(10,5)) plt.subplot(121) x_min,x_max=x[:,0].min()-1,x[:,0].max()+1 y_min,y_max=x[:,1].min()-1,x[:,1].max()+1 plot_step=0.02 xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) Z=Z.reshape(xx.shape) cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) plt.axis(&#39;tight&#39;) #4、描点 plot_colors=&#39;br&#39;;class_names=&#39;AB&#39; for i,n,c in zip(range(2),class_names,plot_colors): idx=np.where(y==i) plt.scatter(x[idx,0],x[idx,1],color=c,cmap=plt.cm.Paired, s=20,edgecolor=&#39;k&#39;,label=&#39;Class %s&#39;%n) plt.xlim(x_min,x_max);plt.ylim(y_min,y_max) plt.legend(loc=&#39;upper right&#39;) plt.xlabel(&#39;x&#39;),plt.ylabel(&#39;y&#39;) plt.title(&#39;Decision Boundary&#39;) #5、描绘两类别得分 twoclass_output=bdt.decision_function(x) plot_range=(twoclass_output.min(),twoclass_output.max()) plt.subplot(122) for i,n,c in zip(range(2),class_names,plot_colors): plt.hist(twoclass_output[y==i],bins=10,range=plot_range,facecolor=c, label=&#39;Class %s&#39;%n,alpha=0.5,edgecolor=&#39;k&#39;) x1,x2,y1,y2=plt.axis() plt.axis((x1,x2,y1,y2*1.2)) plt.legend(loc=&#39;upper right&#39;) plt.ylabel(&#39;Samples&#39;);plt.xlabel(&#39;Score&#39;) plt.title(&#39;Decision Scores&#39;) plt.tight_layout() plt.subplots_adjust(wspace=0.35) plt.show()" />
<meta property="og:description" content="一、手动操作模式 1、创建数据集及分类结果 import numpy as np import matplotlib.pyplot as plt import pandas as pd xMat=np.matrix([[1. ,2.1], #数据集 [2. ,1.1], [1.3,1. ], [1. ,1. ], [2. ,1. ]]) yMat=np.mat([[ 1.], #预设分类结果，用于模型预测结果的校对 [ 1.], [-1.], [-1.], [ 1.]] 2、描点 plt.rcParams[&#39;font.sans-serif&#39;]=[&#39;Simhei&#39;] def showPlot(xMat,yMat): x=np.array(xMat[:,0]) y=np.array(xMat[:,1]) lable=np.array(yMat) plt.scatter(x,y,c=lable) plt.title(&#39;决策树桩测试数据&#39;) plt.show() showPlot(xMat,yMat) 部分代码说明 lable=np.array(yMat) plt.scatter(x,y,c=lable) #scatter()的c即为color，yMat的内容只为1和-1，所以c=lable表示两种不同的颜色 3、构建决策树桩(二分类的基学习器) &#39;&#39;&#39; 决策树桩分类函数： xMat:数据矩阵 i:第i列，也就是第几个特征 Q:阈值 S:标志 re:分类结果 &#39;&#39;&#39; def Classify0(xMat,i,Q,S): re=np.ones((xMat.shape[0],1)) #初始化re为一堆1 if(S==&#39;lt&#39;): #lt:less than re[xMat[:,i]&lt;=Q]=-1 #如果是less且小于阈值，则赋值为-1 elif(S==&#39;gt&#39;): #gt:greater than re[xMat[:,i]&gt;Q]=-1 #如果是greater且大于阈值，则赋值为-1 return re 上方代码理解 对之后的def get_Stump(xMat,yMat,D)进行截断： re=Classify0(xMat,i,Q,S) print(&#39;Q:&#39;,Q,&#39;\n&#39;,&#39;S:&#39;,S,&#39;\n&#39;,&#39;re:\n&#39;,re,&#39;\n&#39;) 对Q(阈值)的理解(举例)： 数据集和预设分类结果： 决策树桩(基学习器)： 其中的2.5就表示阈值Q啦，但并非所有的基学习器都是这个，因为阈值Q会发生移动： (参考get_Stump(xMat,yMat,D)中的Q=(Min+j*stepSize)) 截断示意图： 先初始化m和D后才能运行上方截断部分： m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) 截断运行结果： 由此可知，对于每一个阈值Q，大于阈值和小于阈值的两个方向都遍历 (因为两个标签’lt’和’gt’都要遍历，参考def get_Stump(xMat,yMat,D)的for S in [‘lt’,‘gt’]) 4、寻找最佳决策树桩 &#39;&#39;&#39; 找到数据集上最佳的决策树桩： xMat:特征矩阵 yMat:标签矩阵 D:样本权重 bestStump:最佳决策树桩信息 minE:最小误差 bestClas:最佳的分类结果 &#39;&#39;&#39; def get_Stump(xMat,yMat,D): m,n=xMat.shape #m为样本个数5，n为特征数2 Steps=10 #初始化步数 bestStump={} #用字典形式来储存树桩信息 bestClas=np.mat(np.zeros((m,1))) #初始化分类结果为1，5行1列 minE=np.inf #最小误差初始化为正无穷大 for i in range(n): #遍历所有特征 Min=xMat[:,i].min() #找到特征中最小值 Max=xMat[:,i].max() #找到特征中最大值 stepSize=(Max-Min)/Steps #计算总步长，用以移动阈值 for j in range(-1,int(Steps)+1): for S in [&#39;lt&#39;,&#39;gt&#39;]: #大于和小于的情况，两种方法均遍历；lt:less than, gt:greater than Q=(Min+j*stepSize) #计算阈值 re=Classify0(xMat,i,Q,S) #决策树桩分类方法，得分类结果 err=np.mat(np.ones((m,1))) #初始化误差矩阵，一堆1 err[re==yMat]=0 #分类正确的，赋值为0，若分类错误，则为原数1 eca=D.T*err #计算误差 #print(f&#39;切分特征:{i},阈值:{np.round(Q,2)},标志:{S},权重误差:{np.round(eca,3)}&#39;) if(eca&lt;minE): #找到误差最小的分类方式 minE=eca bestClas=re.copy() bestStump[&#39;特征列&#39;]=i bestStump[&#39;阈值&#39;]=Q bestStump[&#39;标志&#39;]=S return bestStump,minE,bestClas 部分代码理解 minE=np.inf &#39;&#39;&#39; 这个函数的目的是通过寻找最小误差率得到对应的决策树桩，即为最佳的决策树桩， 因此不妨将误差率初始化为无穷大，在AdaBoost的迭代误差率会被更小的覆盖 (误差率会不断下降) &#39;&#39;&#39; Steps=10 for i in range(n): Min=xMat[:,i].min() Max=xMat[:,i].max() stepSize=(Max-Min)/Steps &#39;&#39;&#39;stepSize为阈值Q的移动小步&#39;&#39;&#39; 5、基于决策树桩的AdaBoost训练过程 &#39;&#39;&#39; 基于决策树桩的AdaBoost训练过程，训练出基学习器和最终训练结果 xMat:特征矩阵(数据集) yMat:标签矩阵(预设的分类结果，用于模型预测结果的校对) maxC:最大迭代次数 weakClass:基分类器 aggClass:最终类别估计值(即西瓜书P174的伪代码中H(x)中的累加量) &#39;&#39;&#39; def Ada_train(xMat,yMat,maxC): weakClass=[] #基学习器 m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) #初始化样本权重(每个样本权重相等) aggClass=np.mat(np.zeros((m,1))) #最终结果的初始化 for i in range(maxC): Stump,error,bestClas=get_Stump(xMat,yMat,D) #构建决策树桩 alpha=float(0.5*np.log((1-error)/max(error,1e-16))) #计算弱分类器权重alpha，即西瓜书P174伪代码的第6行 Stump[&#39;alpha&#39;]=np.round(alpha,2) #存储弱学习算法权重，保留两位小数 weakClass.append(Stump) #存储决策树桩 #以下3行为西瓜书的P174伪代码第7行的最终公式 expon=np.exp(np.multiply(-1*alpha*yMat,bestClas)) #计算e的指数项 D=np.multiply(D,expon) D=D/D.sum() #根据样本权重公式，更新样本权重 #以下2行为西瓜书的P174伪代码的输出公式 aggClass+=alpha*bestClas #更新累计类别估计值 Hx=np.sign(aggClass) #最终分类结果 aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) #计算误差 errRate=aggErr.sum()/m print(&#39;分类错误率:&#39;,errRate) if(errRate==0): break #当误差为0时，达到最优，退出循环 return weakClass,aggClass weakClass,aggClass=Ada_train(xMat,yMat,40) print(&#39;最佳基学习器：\n&#39;,weakClass,&#39;\nH(x)中的累加量：\n&#39;,aggClass) 运行结果： 分类错误率: 0.2 分类错误率: 0.2 分类错误率: 0.0 最佳基学习器： [{&#39;特征列&#39;: 0, &#39;阈值&#39;: 1.3, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.69}, {&#39;特征列&#39;: 1, &#39;阈值&#39;: 1.0, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.97}, {&#39;特征列&#39;: 0, &#39;阈值&#39;: 0.9, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.9 }] H(x)中的累加量： [[ 1.17568763] [ 2.56198199] [-0.77022252] [-0.77022252] [ 0.61607184]] 有好心人能在评论区帮我详细讲解一下下面这段代码怎么理解吗：) aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) #计算误差 errRate=aggErr.sum()/m 6、测试 def AdaClassify(data,weakClass): #这里的weakClass为训练得到的最佳基学习器 dataMat=np.mat(data) m=dataMat.shape[0] aggClass=np.mat(np.zeros((m,1))) #用上方训练出来的最佳基学习器进行测试: for i in range(len(weakClass)): #遍历所有分类器，进行分类 classEst=Classify0(dataMat, weakClass[i][&#39;特征列&#39;], weakClass[i][&#39;阈值&#39;], weakClass[i][&#39;标志&#39;]) aggClass+=weakClass[i][&#39;alpha&#39;]*classEst return np.sign(aggClass) print(AdaClassify([0,0],weakClass)) #最终分类为-1 7、上实例(病马数据集) 我不知道怎么把数据放上去… def calAcc(maxC): dataSetTrain=pd.read_table(&#39;E:/AdaBoost/horseColicTraining2.txt&#39;,header=None) train_xMat=np.mat(dataSetTrain.iloc[:,:-1].values) #数据集 train_yMat=np.mat(dataSetTrain.iloc[:,-1].values).T #预设分类结果 weakClass,aggClass=Ada_train(train_xMat,train_yMat,maxC) #训练出最佳基学习器们 yhat=AdaClassify(train_xMat,weakClass) #用训练出来的最佳基学习器们测试出H(x)即yHat(预测得的分类结果) trainCorCount=0 #初始化准确个数为0 m=train_xMat.shape[0] for i in range(m): if(yhat[i]==train_yMat[i]): trainCorCount+=1 #若某一预测结果正确累计+1 trainAcc=trainCorCount/m print(&#39;训练集准确率为:&#39;,trainAcc) testCorCount=0 dataSetTest=pd.read_table(&#39;E:/AdaBoost/horseColicTest2.txt&#39;,header=None) test_xMat=np.mat(dataSetTest.iloc[:,:-1].values) test_yMat=np.mat(dataSetTest.iloc[:,-1].values).T yhat=AdaClassify(test_xMat,weakClass) #weakClass在上方已训练出来了 n=test_xMat.shape[0] for i in range(n): if(yhat[i]==test_yMat[i]): testCorCount+=1 testAcc=testCorCount/n print(&#39;测试集准确率为:&#39;,testAcc) return trainAcc,testAcc print(calAcc(40)) #迭代40次 运行结果： 分类错误率: 0.2842809364548495 分类错误率: 0.2842809364548495 分类错误率: 0.24749163879598662 分类错误率: 0.24749163879598662 分类错误率: 0.25418060200668896 分类错误率: 0.2408026755852843 分类错误率: 0.2408026755852843 分类错误率: 0.22073578595317725 分类错误率: 0.24749163879598662 分类错误率: 0.23076923076923078 分类错误率: 0.2408026755852843 分类错误率: 0.2140468227424749 分类错误率: 0.22742474916387959 分类错误率: 0.21739130434782608 分类错误率: 0.22073578595317725 分类错误率: 0.21739130434782608 分类错误率: 0.22408026755852842 分类错误率: 0.22408026755852842 分类错误率: 0.23076923076923078 分类错误率: 0.22408026755852842 分类错误率: 0.2140468227424749 分类错误率: 0.20735785953177258 分类错误率: 0.22408026755852842 分类错误率: 0.22408026755852842 分类错误率: 0.2140468227424749 分类错误率: 0.22073578595317725 分类错误率: 0.2040133779264214 分类错误率: 0.20735785953177258 分类错误率: 0.21070234113712374 分类错误率: 0.21739130434782608 分类错误率: 0.21070234113712374 分类错误率: 0.21739130434782608 分类错误率: 0.20735785953177258 分类错误率: 0.21070234113712374 分类错误率: 0.20735785953177258 分类错误率: 0.20735785953177258 分类错误率: 0.19732441471571907 分类错误率: 0.19063545150501673 分类错误率: 0.20066889632107024 分类错误率: 0.19732441471571907 训练集准确率为: 0.802675585284281 测试集准确率为: 0.8059701492537313 (0.802675585284281, 0.8059701492537313) 8、代码整合 import numpy as np import matplotlib.pyplot as plt import pandas as pd xMat=np.matrix([[1. ,2.1], [2. ,1.1], [1.3,1. ], [1. ,1. ], [2. ,1. ]]) yMat=np.mat([[ 1.], [ 1.], [-1.], [-1.], [ 1.]]) plt.rcParams[&#39;font.sans-serif&#39;]=[&#39;Simhei&#39;] def showPlot(xMat,yMat): x=np.array(xMat[:,0]) y=np.array(xMat[:,1]) lable=np.array(yMat) plt.scatter(x,y,c=lable) plt.title(&#39;决策树桩测试数据&#39;) plt.show() showPlot(xMat,yMat) def Classify0(xMat,i,Q,S): re=np.ones((xMat.shape[0],1)) if(S==&#39;lt&#39;): re[xMat[:,i]&lt;=Q]=-1 elif(S==&#39;gt&#39;): re[xMat[:,i]&gt;Q]=-1 return re def get_Stump(xMat,yMat,D): m,n=xMat.shape Steps=10 bestStump={} bestClas=np.mat(np.zeros((m,1))) minE=np.inf for i in range(n): Min=xMat[:,i].min() Max=xMat[:,i].max() stepSize=(Max-Min)/Steps for j in range(-1,int(Steps)+1): for S in [&#39;lt&#39;,&#39;gt&#39;]: Q=(Min+j*stepSize) re=Classify0(xMat,i,Q,S) err=np.mat(np.ones((m,1))) err[re==yMat]=0 eca=D.T*err if(eca&lt;minE): minE=eca bestClas=re.copy() bestStump[&#39;特征列&#39;]=i bestStump[&#39;阈值&#39;]=Q bestStump[&#39;标志&#39;]=S return bestStump,minE,bestClas def Ada_train(xMat,yMat,maxC): weakClass=[] m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) aggClass=np.mat(np.zeros((m,1))) for i in range(maxC): Stump,error,bestClas=get_Stump(xMat,yMat,D) alpha=float(0.5*np.log((1-error)/max(error,1e-16))) Stump[&#39;alpha&#39;]=np.round(alpha,2) weakClass.append(Stump) expon=np.exp(np.multiply(-1*alpha*yMat,bestClas)) D=np.multiply(D,expon) D=D/D.sum() aggClass+=alpha*bestClas Hx=np.sign(aggClass) aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) errRate=aggErr.sum()/m print(&#39;分类错误率:&#39;,errRate) if(errRate==0): break return weakClass,aggClass weakClass,aggClass=Ada_train(xMat,yMat,40) print(&#39;最佳基学习器：\n&#39;,weakClass,&#39;\nH(x)中的累加量：\n&#39;,aggClass) def AdaClassify(data,weakClass): dataMat=np.mat(data) m=dataMat.shape[0] aggClass=np.mat(np.zeros((m,1))) for i in range(len(weakClass)): classEst=Classify0(dataMat,weakClass[i][&#39;特征列&#39;], weakClass[i][&#39;阈值&#39;], weakClass[i][&#39;标志&#39;]) aggClass+=weakClass[i][&#39;alpha&#39;]*classEst return np.sign(aggClass) print(AdaClassify([0,0],weakClass)) def calAcc(maxC): dataSetTrain=pd.read_table(&#39;E:/AdaBoost/horseColicTraining2.txt&#39;,header=None) train_xMat=np.mat(dataSetTrain.iloc[:,:-1].values) train_yMat=np.mat(dataSetTrain.iloc[:,-1].values).T weakClass,aggClass=Ada_train(train_xMat,train_yMat,maxC) yhat=AdaClassify(train_xMat,weakClass) trainCorCount=0 m=train_xMat.shape[0] for i in range(m): if(yhat[i]==train_yMat[i]): trainCorCount+=1 trainAcc=trainCorCount/m print(&#39;训练集准确率为:&#39;,trainAcc) testCorCount=0 dataSetTest=pd.read_table(&#39;E:/AdaBoost/horseColicTest2.txt&#39;,header=None) test_xMat=np.mat(dataSetTest.iloc[:,:-1].values) test_yMat=np.mat(dataSetTest.iloc[:,-1].values).T yhat=AdaClassify(test_xMat,weakClass) n=test_xMat.shape[0] for i in range(n): if(yhat[i]==test_yMat[i]): testCorCount+=1 testAcc=testCorCount/n print(&#39;测试集准确率为:&#39;,testAcc) return trainAcc,testAcc print(calAcc(40)) 二、内置函数模式 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_gaussian_quantiles from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import AdaBoostClassifier 1、创建数据集 x1,y1=make_gaussian_quantiles(cov=2.,n_samples=200,n_features=2,n_classes=2,random_state=1) #为了增加样本分布的复杂度，再生成一个数据分布 x2,y2=make_gaussian_quantiles(mean=(3,3),cov=1.5,n_samples=300, #两样本特征均值为3和3 n_features=2,n_classes=2,random_state=1) x=np.concatenate((x1,x2)); y=np.concatenate((y1,-y2+1)) #np.concatenate:默认垂直合并 #x:数据; y:数据集所属类别(两类:0或1) print(&#39;数据集：\n&#39;,x,&#39;\n&#39;,&#39;分类标签：\n&#39;,y) 部分代码说明 &#39;&#39;&#39;make_gaussian_quantiles:生成分组多维正态分布的数据； mean:特征均值(上方默认为(0,0))；cov:样本协方差的系数；n_samples:样本个数； n_features:正态分布的维数；n_classe:输出的类别数； n_classe=2：生成的数据按分位数分成2组&#39;&#39;&#39; 运行结果 数据集： [[ 7.00334571e-01 -2.47067578e-01] [-3.95001869e+00 2.74007953e+00] [ 1.50221617e-01 -2.15763780e+00] [-1.67205033e+00 -9.41519069e-01] ... ... [ 8.94180435e-01 3.06995865e+00] [ 8.49439078e-01 3.87543489e+00] [ 5.21744335e+00 1.40081765e+00]] 分类标签： [0 1 1 1 1 1 1 0 1 1 0 1 1 0 1 1 1 1 1 1 1 0 1 0 0 1 0 0 1 1 0 1 0 1 1 1 ... 1 1 0 0 1 0 0 1 0 0 0 1 0 1 0 0 0 0 1 0 0 0 0 0 0 1 0 0 1 1 0 0 0] 2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合 weakClassifier=DecisionTreeClassifier(max_depth=1) bdt=AdaBoostClassifier(weakClassifier,algorithm=&quot;SAMME&quot;,n_estimators=200) #选择SAMME算法，最多200个弱分类器 bdt.fit(x,y) #fit():训练算法，设置内部参数 3、描绘决策边缘 plt.figure(figsize=(10,5)) #生成10(in)*5(in)=50(in^2)大的空画布 plt.subplot(121) x_min,x_max=x[:,0].min()-1,x[:,0].max()+1 y_min,y_max=x[:,1].min()-1,x[:,1].max()+1 #上述两行为下面画网格图做准备(控制范围，使数据合理坐落在图中) plot_step=0.02 xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) Z=Z.reshape(xx.shape) #以上2行，将xx、yy展开，然后预测每个点的类别，将结果大小调整到和坐标数据相同的矩阵大小 cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) plt.axis(&#39;tight&#39;) #使坐标轴适应数据量，即有一个范围合理的坐标轴 plt.show() 部分代码说明 plt.subplot(121) &#39;&#39;&#39; 将画布大小分成几个部分，参数&#39;121&#39;表示1(row)x2(col)，即将画布分成1x2，一行两列的 2块区域，第三个数1表示选择图形输出的区域在第一块，图形输出区域参数必须在&quot;行×列&quot;范 围内，此处必须在1和2之间选择 &#39;&#39;&#39; xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) &#39;&#39;&#39; 生成网格点坐标矩阵，在x、y方向上以plot_step逐渐生成 (以0.02的步伐在X坐标上取点,以0.02的步伐在Y坐标上取点) 基本取满坐标中的画布 &#39;&#39;&#39; Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) &#39;&#39;&#39; np.c_[]:多维数组水平合并，对一维数组放竖再水平合并 np.ravel():将多行的多维数组铺平成一维数组(一行) predict():返回的是一个大小为n的一维数组，用训练好的分类器去预测出()内数据的标签， 一维数组中的第i个值为模型预测第i个预测样本的标签，即在y中的对应值 如： x_train=np.array([[1,2,3],[1,3,4],[2,1,2],[4,5,6],[3,5,3],[1,7,2]]) y_train=np.array([0,0,0,1,1,1]) x_test=np.array([[2,2,2],[3,2,6],[1,7,4]]) clf=LogisticRegression() clf.fit(x_train,y_train) clf.predict(x_test) &gt;&gt;&gt;array([1,0,1]) &#39;&#39;&#39; cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) &#39;&#39;&#39; plt.contourf(X,Y,f(X,Y))，其中X、Y为shape相同的一维数组 plt.cm中cm全称表示colormap，paired表示两个两个相近色彩输出， 比如浅蓝、深蓝；浅红、深红；浅绿，深绿 &#39;&#39;&#39; 运行结果 4、描点 plot_colors=&#39;br&#39;;class_names=&#39;AB&#39; for i,n,c in zip(range(2),class_names,plot_colors): idx=np.where(y==i) plt.scatter(x[idx,0],x[idx,1],color=c,cmap=plt.cm.Paired, s=20,edgecolor=&#39;k&#39;,label=&#39;Class %s&#39;%n) plt.xlim(x_min,x_max);plt.ylim(y_min,y_max) plt.legend(loc=&#39;upper right&#39;) plt.xlabel(&#39;x&#39;),plt.ylabel(&#39;y&#39;) plt.title(&#39;Decision Boundary&#39;) plt.show() 部分代码说明 idx=np.where(y==i) &#39;&#39;&#39; np.where(condition,x,y)，满足条件(condition)，输出x，不满足输出y； 若只有条件(condition)，没有x和y，则输出满足条件(即非0)元素的坐标，这里的坐标以tuple的形式给出 如： a=np.array([2,4,6,8,10]) np.where(a&gt;5) &gt;&gt;&gt;(array([2,3,4]),) &#39;&#39;&#39; for i,n,c in zip(range(2),class_names,plot_colors): print(i,n,c) &#39;&#39;&#39; &gt;&gt;&gt; 0 A b 1 B r &#39;&#39;&#39; 运行结果 5、描绘两类别(1和0)得分 twoclass_output=bdt.decision_function(x) #decision_function(x):计算输入x的决策函数值 plot_range=(twoclass_output.min(),twoclass_output.max()) plt.subplot(122) for i,n,c in zip(range(2),class_names,plot_colors): plt.hist(twoclass_output[y==i],bins=10,range=plot_range,facecolor=c, label=&#39;Class %s&#39;%n,alpha=0.5,edgecolor=&#39;k&#39;) #bins指定箱子的个数，即总共有几条条状图 x1,x2,y1,y2=plt.axis() plt.axis((x1,x2,y1,y2*1.2)) #plt.axis([-1,10,0,6]):x轴起始于-1，终止于10，y轴起始于0，终止于6 plt.legend(loc=&#39;upper right&#39;) plt.ylabel(&#39;Samples&#39;);plt.xlabel(&#39;Score&#39;) plt.title(&#39;Decision Scores&#39;) plt.tight_layout() #tight_layout会自动调整子图参数，使之填充整个图像区域 plt.subplots_adjust(wspace=0.35) #以上2行都为调整图像边缘及图像间的空白间隔 plt.show() 运行结果 6、代码整合 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_gaussian_quantiles from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import AdaBoostClassifier #1、创建数据集 x1,y1=make_gaussian_quantiles(cov=2.,n_samples=200,n_features=2,n_classes=2,random_state=1) x2,y2=make_gaussian_quantiles(mean=(3,3),cov=1.5,n_samples=300, n_features=2,n_classes=2,random_state=1) x=np.concatenate((x1,x2)); y=np.concatenate((y1,-y2+1)) #2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合 weakClassifier=DecisionTreeClassifier(max_depth=1) bdt=AdaBoostClassifier(weakClassifier,algorithm=&quot;SAMME&quot;,n_estimators=200) bdt.fit(x,y) #3、描绘决策边缘 plt.figure(figsize=(10,5)) plt.subplot(121) x_min,x_max=x[:,0].min()-1,x[:,0].max()+1 y_min,y_max=x[:,1].min()-1,x[:,1].max()+1 plot_step=0.02 xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) Z=Z.reshape(xx.shape) cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) plt.axis(&#39;tight&#39;) #4、描点 plot_colors=&#39;br&#39;;class_names=&#39;AB&#39; for i,n,c in zip(range(2),class_names,plot_colors): idx=np.where(y==i) plt.scatter(x[idx,0],x[idx,1],color=c,cmap=plt.cm.Paired, s=20,edgecolor=&#39;k&#39;,label=&#39;Class %s&#39;%n) plt.xlim(x_min,x_max);plt.ylim(y_min,y_max) plt.legend(loc=&#39;upper right&#39;) plt.xlabel(&#39;x&#39;),plt.ylabel(&#39;y&#39;) plt.title(&#39;Decision Boundary&#39;) #5、描绘两类别得分 twoclass_output=bdt.decision_function(x) plot_range=(twoclass_output.min(),twoclass_output.max()) plt.subplot(122) for i,n,c in zip(range(2),class_names,plot_colors): plt.hist(twoclass_output[y==i],bins=10,range=plot_range,facecolor=c, label=&#39;Class %s&#39;%n,alpha=0.5,edgecolor=&#39;k&#39;) x1,x2,y1,y2=plt.axis() plt.axis((x1,x2,y1,y2*1.2)) plt.legend(loc=&#39;upper right&#39;) plt.ylabel(&#39;Samples&#39;);plt.xlabel(&#39;Score&#39;) plt.title(&#39;Decision Scores&#39;) plt.tight_layout() plt.subplots_adjust(wspace=0.35) plt.show()" />
<link rel="canonical" href="https://mlh.app/2019/05/19/787159.html" />
<meta property="og:url" content="https://mlh.app/2019/05/19/787159.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-19T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"一、手动操作模式 1、创建数据集及分类结果 import numpy as np import matplotlib.pyplot as plt import pandas as pd xMat=np.matrix([[1. ,2.1], #数据集 [2. ,1.1], [1.3,1. ], [1. ,1. ], [2. ,1. ]]) yMat=np.mat([[ 1.], #预设分类结果，用于模型预测结果的校对 [ 1.], [-1.], [-1.], [ 1.]] 2、描点 plt.rcParams[&#39;font.sans-serif&#39;]=[&#39;Simhei&#39;] def showPlot(xMat,yMat): x=np.array(xMat[:,0]) y=np.array(xMat[:,1]) lable=np.array(yMat) plt.scatter(x,y,c=lable) plt.title(&#39;决策树桩测试数据&#39;) plt.show() showPlot(xMat,yMat) 部分代码说明 lable=np.array(yMat) plt.scatter(x,y,c=lable) #scatter()的c即为color，yMat的内容只为1和-1，所以c=lable表示两种不同的颜色 3、构建决策树桩(二分类的基学习器) &#39;&#39;&#39; 决策树桩分类函数： xMat:数据矩阵 i:第i列，也就是第几个特征 Q:阈值 S:标志 re:分类结果 &#39;&#39;&#39; def Classify0(xMat,i,Q,S): re=np.ones((xMat.shape[0],1)) #初始化re为一堆1 if(S==&#39;lt&#39;): #lt:less than re[xMat[:,i]&lt;=Q]=-1 #如果是less且小于阈值，则赋值为-1 elif(S==&#39;gt&#39;): #gt:greater than re[xMat[:,i]&gt;Q]=-1 #如果是greater且大于阈值，则赋值为-1 return re 上方代码理解 对之后的def get_Stump(xMat,yMat,D)进行截断： re=Classify0(xMat,i,Q,S) print(&#39;Q:&#39;,Q,&#39;\\n&#39;,&#39;S:&#39;,S,&#39;\\n&#39;,&#39;re:\\n&#39;,re,&#39;\\n&#39;) 对Q(阈值)的理解(举例)： 数据集和预设分类结果： 决策树桩(基学习器)： 其中的2.5就表示阈值Q啦，但并非所有的基学习器都是这个，因为阈值Q会发生移动： (参考get_Stump(xMat,yMat,D)中的Q=(Min+j*stepSize)) 截断示意图： 先初始化m和D后才能运行上方截断部分： m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) 截断运行结果： 由此可知，对于每一个阈值Q，大于阈值和小于阈值的两个方向都遍历 (因为两个标签’lt’和’gt’都要遍历，参考def get_Stump(xMat,yMat,D)的for S in [‘lt’,‘gt’]) 4、寻找最佳决策树桩 &#39;&#39;&#39; 找到数据集上最佳的决策树桩： xMat:特征矩阵 yMat:标签矩阵 D:样本权重 bestStump:最佳决策树桩信息 minE:最小误差 bestClas:最佳的分类结果 &#39;&#39;&#39; def get_Stump(xMat,yMat,D): m,n=xMat.shape #m为样本个数5，n为特征数2 Steps=10 #初始化步数 bestStump={} #用字典形式来储存树桩信息 bestClas=np.mat(np.zeros((m,1))) #初始化分类结果为1，5行1列 minE=np.inf #最小误差初始化为正无穷大 for i in range(n): #遍历所有特征 Min=xMat[:,i].min() #找到特征中最小值 Max=xMat[:,i].max() #找到特征中最大值 stepSize=(Max-Min)/Steps #计算总步长，用以移动阈值 for j in range(-1,int(Steps)+1): for S in [&#39;lt&#39;,&#39;gt&#39;]: #大于和小于的情况，两种方法均遍历；lt:less than, gt:greater than Q=(Min+j*stepSize) #计算阈值 re=Classify0(xMat,i,Q,S) #决策树桩分类方法，得分类结果 err=np.mat(np.ones((m,1))) #初始化误差矩阵，一堆1 err[re==yMat]=0 #分类正确的，赋值为0，若分类错误，则为原数1 eca=D.T*err #计算误差 #print(f&#39;切分特征:{i},阈值:{np.round(Q,2)},标志:{S},权重误差:{np.round(eca,3)}&#39;) if(eca&lt;minE): #找到误差最小的分类方式 minE=eca bestClas=re.copy() bestStump[&#39;特征列&#39;]=i bestStump[&#39;阈值&#39;]=Q bestStump[&#39;标志&#39;]=S return bestStump,minE,bestClas 部分代码理解 minE=np.inf &#39;&#39;&#39; 这个函数的目的是通过寻找最小误差率得到对应的决策树桩，即为最佳的决策树桩， 因此不妨将误差率初始化为无穷大，在AdaBoost的迭代误差率会被更小的覆盖 (误差率会不断下降) &#39;&#39;&#39; Steps=10 for i in range(n): Min=xMat[:,i].min() Max=xMat[:,i].max() stepSize=(Max-Min)/Steps &#39;&#39;&#39;stepSize为阈值Q的移动小步&#39;&#39;&#39; 5、基于决策树桩的AdaBoost训练过程 &#39;&#39;&#39; 基于决策树桩的AdaBoost训练过程，训练出基学习器和最终训练结果 xMat:特征矩阵(数据集) yMat:标签矩阵(预设的分类结果，用于模型预测结果的校对) maxC:最大迭代次数 weakClass:基分类器 aggClass:最终类别估计值(即西瓜书P174的伪代码中H(x)中的累加量) &#39;&#39;&#39; def Ada_train(xMat,yMat,maxC): weakClass=[] #基学习器 m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) #初始化样本权重(每个样本权重相等) aggClass=np.mat(np.zeros((m,1))) #最终结果的初始化 for i in range(maxC): Stump,error,bestClas=get_Stump(xMat,yMat,D) #构建决策树桩 alpha=float(0.5*np.log((1-error)/max(error,1e-16))) #计算弱分类器权重alpha，即西瓜书P174伪代码的第6行 Stump[&#39;alpha&#39;]=np.round(alpha,2) #存储弱学习算法权重，保留两位小数 weakClass.append(Stump) #存储决策树桩 #以下3行为西瓜书的P174伪代码第7行的最终公式 expon=np.exp(np.multiply(-1*alpha*yMat,bestClas)) #计算e的指数项 D=np.multiply(D,expon) D=D/D.sum() #根据样本权重公式，更新样本权重 #以下2行为西瓜书的P174伪代码的输出公式 aggClass+=alpha*bestClas #更新累计类别估计值 Hx=np.sign(aggClass) #最终分类结果 aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) #计算误差 errRate=aggErr.sum()/m print(&#39;分类错误率:&#39;,errRate) if(errRate==0): break #当误差为0时，达到最优，退出循环 return weakClass,aggClass weakClass,aggClass=Ada_train(xMat,yMat,40) print(&#39;最佳基学习器：\\n&#39;,weakClass,&#39;\\nH(x)中的累加量：\\n&#39;,aggClass) 运行结果： 分类错误率: 0.2 分类错误率: 0.2 分类错误率: 0.0 最佳基学习器： [{&#39;特征列&#39;: 0, &#39;阈值&#39;: 1.3, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.69}, {&#39;特征列&#39;: 1, &#39;阈值&#39;: 1.0, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.97}, {&#39;特征列&#39;: 0, &#39;阈值&#39;: 0.9, &#39;标志&#39;: &#39;lt&#39;, &#39;alpha&#39;: 0.9 }] H(x)中的累加量： [[ 1.17568763] [ 2.56198199] [-0.77022252] [-0.77022252] [ 0.61607184]] 有好心人能在评论区帮我详细讲解一下下面这段代码怎么理解吗：) aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) #计算误差 errRate=aggErr.sum()/m 6、测试 def AdaClassify(data,weakClass): #这里的weakClass为训练得到的最佳基学习器 dataMat=np.mat(data) m=dataMat.shape[0] aggClass=np.mat(np.zeros((m,1))) #用上方训练出来的最佳基学习器进行测试: for i in range(len(weakClass)): #遍历所有分类器，进行分类 classEst=Classify0(dataMat, weakClass[i][&#39;特征列&#39;], weakClass[i][&#39;阈值&#39;], weakClass[i][&#39;标志&#39;]) aggClass+=weakClass[i][&#39;alpha&#39;]*classEst return np.sign(aggClass) print(AdaClassify([0,0],weakClass)) #最终分类为-1 7、上实例(病马数据集) 我不知道怎么把数据放上去… def calAcc(maxC): dataSetTrain=pd.read_table(&#39;E:/AdaBoost/horseColicTraining2.txt&#39;,header=None) train_xMat=np.mat(dataSetTrain.iloc[:,:-1].values) #数据集 train_yMat=np.mat(dataSetTrain.iloc[:,-1].values).T #预设分类结果 weakClass,aggClass=Ada_train(train_xMat,train_yMat,maxC) #训练出最佳基学习器们 yhat=AdaClassify(train_xMat,weakClass) #用训练出来的最佳基学习器们测试出H(x)即yHat(预测得的分类结果) trainCorCount=0 #初始化准确个数为0 m=train_xMat.shape[0] for i in range(m): if(yhat[i]==train_yMat[i]): trainCorCount+=1 #若某一预测结果正确累计+1 trainAcc=trainCorCount/m print(&#39;训练集准确率为:&#39;,trainAcc) testCorCount=0 dataSetTest=pd.read_table(&#39;E:/AdaBoost/horseColicTest2.txt&#39;,header=None) test_xMat=np.mat(dataSetTest.iloc[:,:-1].values) test_yMat=np.mat(dataSetTest.iloc[:,-1].values).T yhat=AdaClassify(test_xMat,weakClass) #weakClass在上方已训练出来了 n=test_xMat.shape[0] for i in range(n): if(yhat[i]==test_yMat[i]): testCorCount+=1 testAcc=testCorCount/n print(&#39;测试集准确率为:&#39;,testAcc) return trainAcc,testAcc print(calAcc(40)) #迭代40次 运行结果： 分类错误率: 0.2842809364548495 分类错误率: 0.2842809364548495 分类错误率: 0.24749163879598662 分类错误率: 0.24749163879598662 分类错误率: 0.25418060200668896 分类错误率: 0.2408026755852843 分类错误率: 0.2408026755852843 分类错误率: 0.22073578595317725 分类错误率: 0.24749163879598662 分类错误率: 0.23076923076923078 分类错误率: 0.2408026755852843 分类错误率: 0.2140468227424749 分类错误率: 0.22742474916387959 分类错误率: 0.21739130434782608 分类错误率: 0.22073578595317725 分类错误率: 0.21739130434782608 分类错误率: 0.22408026755852842 分类错误率: 0.22408026755852842 分类错误率: 0.23076923076923078 分类错误率: 0.22408026755852842 分类错误率: 0.2140468227424749 分类错误率: 0.20735785953177258 分类错误率: 0.22408026755852842 分类错误率: 0.22408026755852842 分类错误率: 0.2140468227424749 分类错误率: 0.22073578595317725 分类错误率: 0.2040133779264214 分类错误率: 0.20735785953177258 分类错误率: 0.21070234113712374 分类错误率: 0.21739130434782608 分类错误率: 0.21070234113712374 分类错误率: 0.21739130434782608 分类错误率: 0.20735785953177258 分类错误率: 0.21070234113712374 分类错误率: 0.20735785953177258 分类错误率: 0.20735785953177258 分类错误率: 0.19732441471571907 分类错误率: 0.19063545150501673 分类错误率: 0.20066889632107024 分类错误率: 0.19732441471571907 训练集准确率为: 0.802675585284281 测试集准确率为: 0.8059701492537313 (0.802675585284281, 0.8059701492537313) 8、代码整合 import numpy as np import matplotlib.pyplot as plt import pandas as pd xMat=np.matrix([[1. ,2.1], [2. ,1.1], [1.3,1. ], [1. ,1. ], [2. ,1. ]]) yMat=np.mat([[ 1.], [ 1.], [-1.], [-1.], [ 1.]]) plt.rcParams[&#39;font.sans-serif&#39;]=[&#39;Simhei&#39;] def showPlot(xMat,yMat): x=np.array(xMat[:,0]) y=np.array(xMat[:,1]) lable=np.array(yMat) plt.scatter(x,y,c=lable) plt.title(&#39;决策树桩测试数据&#39;) plt.show() showPlot(xMat,yMat) def Classify0(xMat,i,Q,S): re=np.ones((xMat.shape[0],1)) if(S==&#39;lt&#39;): re[xMat[:,i]&lt;=Q]=-1 elif(S==&#39;gt&#39;): re[xMat[:,i]&gt;Q]=-1 return re def get_Stump(xMat,yMat,D): m,n=xMat.shape Steps=10 bestStump={} bestClas=np.mat(np.zeros((m,1))) minE=np.inf for i in range(n): Min=xMat[:,i].min() Max=xMat[:,i].max() stepSize=(Max-Min)/Steps for j in range(-1,int(Steps)+1): for S in [&#39;lt&#39;,&#39;gt&#39;]: Q=(Min+j*stepSize) re=Classify0(xMat,i,Q,S) err=np.mat(np.ones((m,1))) err[re==yMat]=0 eca=D.T*err if(eca&lt;minE): minE=eca bestClas=re.copy() bestStump[&#39;特征列&#39;]=i bestStump[&#39;阈值&#39;]=Q bestStump[&#39;标志&#39;]=S return bestStump,minE,bestClas def Ada_train(xMat,yMat,maxC): weakClass=[] m=xMat.shape[0] D=np.mat(np.ones((m,1))/m) aggClass=np.mat(np.zeros((m,1))) for i in range(maxC): Stump,error,bestClas=get_Stump(xMat,yMat,D) alpha=float(0.5*np.log((1-error)/max(error,1e-16))) Stump[&#39;alpha&#39;]=np.round(alpha,2) weakClass.append(Stump) expon=np.exp(np.multiply(-1*alpha*yMat,bestClas)) D=np.multiply(D,expon) D=D/D.sum() aggClass+=alpha*bestClas Hx=np.sign(aggClass) aggErr=np.multiply(Hx!=yMat,np.ones((m,1))) errRate=aggErr.sum()/m print(&#39;分类错误率:&#39;,errRate) if(errRate==0): break return weakClass,aggClass weakClass,aggClass=Ada_train(xMat,yMat,40) print(&#39;最佳基学习器：\\n&#39;,weakClass,&#39;\\nH(x)中的累加量：\\n&#39;,aggClass) def AdaClassify(data,weakClass): dataMat=np.mat(data) m=dataMat.shape[0] aggClass=np.mat(np.zeros((m,1))) for i in range(len(weakClass)): classEst=Classify0(dataMat,weakClass[i][&#39;特征列&#39;], weakClass[i][&#39;阈值&#39;], weakClass[i][&#39;标志&#39;]) aggClass+=weakClass[i][&#39;alpha&#39;]*classEst return np.sign(aggClass) print(AdaClassify([0,0],weakClass)) def calAcc(maxC): dataSetTrain=pd.read_table(&#39;E:/AdaBoost/horseColicTraining2.txt&#39;,header=None) train_xMat=np.mat(dataSetTrain.iloc[:,:-1].values) train_yMat=np.mat(dataSetTrain.iloc[:,-1].values).T weakClass,aggClass=Ada_train(train_xMat,train_yMat,maxC) yhat=AdaClassify(train_xMat,weakClass) trainCorCount=0 m=train_xMat.shape[0] for i in range(m): if(yhat[i]==train_yMat[i]): trainCorCount+=1 trainAcc=trainCorCount/m print(&#39;训练集准确率为:&#39;,trainAcc) testCorCount=0 dataSetTest=pd.read_table(&#39;E:/AdaBoost/horseColicTest2.txt&#39;,header=None) test_xMat=np.mat(dataSetTest.iloc[:,:-1].values) test_yMat=np.mat(dataSetTest.iloc[:,-1].values).T yhat=AdaClassify(test_xMat,weakClass) n=test_xMat.shape[0] for i in range(n): if(yhat[i]==test_yMat[i]): testCorCount+=1 testAcc=testCorCount/n print(&#39;测试集准确率为:&#39;,testAcc) return trainAcc,testAcc print(calAcc(40)) 二、内置函数模式 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_gaussian_quantiles from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import AdaBoostClassifier 1、创建数据集 x1,y1=make_gaussian_quantiles(cov=2.,n_samples=200,n_features=2,n_classes=2,random_state=1) #为了增加样本分布的复杂度，再生成一个数据分布 x2,y2=make_gaussian_quantiles(mean=(3,3),cov=1.5,n_samples=300, #两样本特征均值为3和3 n_features=2,n_classes=2,random_state=1) x=np.concatenate((x1,x2)); y=np.concatenate((y1,-y2+1)) #np.concatenate:默认垂直合并 #x:数据; y:数据集所属类别(两类:0或1) print(&#39;数据集：\\n&#39;,x,&#39;\\n&#39;,&#39;分类标签：\\n&#39;,y) 部分代码说明 &#39;&#39;&#39;make_gaussian_quantiles:生成分组多维正态分布的数据； mean:特征均值(上方默认为(0,0))；cov:样本协方差的系数；n_samples:样本个数； n_features:正态分布的维数；n_classe:输出的类别数； n_classe=2：生成的数据按分位数分成2组&#39;&#39;&#39; 运行结果 数据集： [[ 7.00334571e-01 -2.47067578e-01] [-3.95001869e+00 2.74007953e+00] [ 1.50221617e-01 -2.15763780e+00] [-1.67205033e+00 -9.41519069e-01] ... ... [ 8.94180435e-01 3.06995865e+00] [ 8.49439078e-01 3.87543489e+00] [ 5.21744335e+00 1.40081765e+00]] 分类标签： [0 1 1 1 1 1 1 0 1 1 0 1 1 0 1 1 1 1 1 1 1 0 1 0 0 1 0 0 1 1 0 1 0 1 1 1 ... 1 1 0 0 1 0 0 1 0 0 0 1 0 1 0 0 0 0 1 0 0 0 0 0 0 1 0 0 1 1 0 0 0] 2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合 weakClassifier=DecisionTreeClassifier(max_depth=1) bdt=AdaBoostClassifier(weakClassifier,algorithm=&quot;SAMME&quot;,n_estimators=200) #选择SAMME算法，最多200个弱分类器 bdt.fit(x,y) #fit():训练算法，设置内部参数 3、描绘决策边缘 plt.figure(figsize=(10,5)) #生成10(in)*5(in)=50(in^2)大的空画布 plt.subplot(121) x_min,x_max=x[:,0].min()-1,x[:,0].max()+1 y_min,y_max=x[:,1].min()-1,x[:,1].max()+1 #上述两行为下面画网格图做准备(控制范围，使数据合理坐落在图中) plot_step=0.02 xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) Z=Z.reshape(xx.shape) #以上2行，将xx、yy展开，然后预测每个点的类别，将结果大小调整到和坐标数据相同的矩阵大小 cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) plt.axis(&#39;tight&#39;) #使坐标轴适应数据量，即有一个范围合理的坐标轴 plt.show() 部分代码说明 plt.subplot(121) &#39;&#39;&#39; 将画布大小分成几个部分，参数&#39;121&#39;表示1(row)x2(col)，即将画布分成1x2，一行两列的 2块区域，第三个数1表示选择图形输出的区域在第一块，图形输出区域参数必须在&quot;行×列&quot;范 围内，此处必须在1和2之间选择 &#39;&#39;&#39; xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) &#39;&#39;&#39; 生成网格点坐标矩阵，在x、y方向上以plot_step逐渐生成 (以0.02的步伐在X坐标上取点,以0.02的步伐在Y坐标上取点) 基本取满坐标中的画布 &#39;&#39;&#39; Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) &#39;&#39;&#39; np.c_[]:多维数组水平合并，对一维数组放竖再水平合并 np.ravel():将多行的多维数组铺平成一维数组(一行) predict():返回的是一个大小为n的一维数组，用训练好的分类器去预测出()内数据的标签， 一维数组中的第i个值为模型预测第i个预测样本的标签，即在y中的对应值 如： x_train=np.array([[1,2,3],[1,3,4],[2,1,2],[4,5,6],[3,5,3],[1,7,2]]) y_train=np.array([0,0,0,1,1,1]) x_test=np.array([[2,2,2],[3,2,6],[1,7,4]]) clf=LogisticRegression() clf.fit(x_train,y_train) clf.predict(x_test) &gt;&gt;&gt;array([1,0,1]) &#39;&#39;&#39; cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) &#39;&#39;&#39; plt.contourf(X,Y,f(X,Y))，其中X、Y为shape相同的一维数组 plt.cm中cm全称表示colormap，paired表示两个两个相近色彩输出， 比如浅蓝、深蓝；浅红、深红；浅绿，深绿 &#39;&#39;&#39; 运行结果 4、描点 plot_colors=&#39;br&#39;;class_names=&#39;AB&#39; for i,n,c in zip(range(2),class_names,plot_colors): idx=np.where(y==i) plt.scatter(x[idx,0],x[idx,1],color=c,cmap=plt.cm.Paired, s=20,edgecolor=&#39;k&#39;,label=&#39;Class %s&#39;%n) plt.xlim(x_min,x_max);plt.ylim(y_min,y_max) plt.legend(loc=&#39;upper right&#39;) plt.xlabel(&#39;x&#39;),plt.ylabel(&#39;y&#39;) plt.title(&#39;Decision Boundary&#39;) plt.show() 部分代码说明 idx=np.where(y==i) &#39;&#39;&#39; np.where(condition,x,y)，满足条件(condition)，输出x，不满足输出y； 若只有条件(condition)，没有x和y，则输出满足条件(即非0)元素的坐标，这里的坐标以tuple的形式给出 如： a=np.array([2,4,6,8,10]) np.where(a&gt;5) &gt;&gt;&gt;(array([2,3,4]),) &#39;&#39;&#39; for i,n,c in zip(range(2),class_names,plot_colors): print(i,n,c) &#39;&#39;&#39; &gt;&gt;&gt; 0 A b 1 B r &#39;&#39;&#39; 运行结果 5、描绘两类别(1和0)得分 twoclass_output=bdt.decision_function(x) #decision_function(x):计算输入x的决策函数值 plot_range=(twoclass_output.min(),twoclass_output.max()) plt.subplot(122) for i,n,c in zip(range(2),class_names,plot_colors): plt.hist(twoclass_output[y==i],bins=10,range=plot_range,facecolor=c, label=&#39;Class %s&#39;%n,alpha=0.5,edgecolor=&#39;k&#39;) #bins指定箱子的个数，即总共有几条条状图 x1,x2,y1,y2=plt.axis() plt.axis((x1,x2,y1,y2*1.2)) #plt.axis([-1,10,0,6]):x轴起始于-1，终止于10，y轴起始于0，终止于6 plt.legend(loc=&#39;upper right&#39;) plt.ylabel(&#39;Samples&#39;);plt.xlabel(&#39;Score&#39;) plt.title(&#39;Decision Scores&#39;) plt.tight_layout() #tight_layout会自动调整子图参数，使之填充整个图像区域 plt.subplots_adjust(wspace=0.35) #以上2行都为调整图像边缘及图像间的空白间隔 plt.show() 运行结果 6、代码整合 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_gaussian_quantiles from sklearn.tree import DecisionTreeClassifier from sklearn.ensemble import AdaBoostClassifier #1、创建数据集 x1,y1=make_gaussian_quantiles(cov=2.,n_samples=200,n_features=2,n_classes=2,random_state=1) x2,y2=make_gaussian_quantiles(mean=(3,3),cov=1.5,n_samples=300, n_features=2,n_classes=2,random_state=1) x=np.concatenate((x1,x2)); y=np.concatenate((y1,-y2+1)) #2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合 weakClassifier=DecisionTreeClassifier(max_depth=1) bdt=AdaBoostClassifier(weakClassifier,algorithm=&quot;SAMME&quot;,n_estimators=200) bdt.fit(x,y) #3、描绘决策边缘 plt.figure(figsize=(10,5)) plt.subplot(121) x_min,x_max=x[:,0].min()-1,x[:,0].max()+1 y_min,y_max=x[:,1].min()-1,x[:,1].max()+1 plot_step=0.02 xx,yy=np.meshgrid(np.arange(x_min,x_max,plot_step),np.arange(y_min,y_max,plot_step)) Z=bdt.predict(np.c_[xx.ravel(),yy.ravel()]) Z=Z.reshape(xx.shape) cs=plt.contourf(xx,yy,Z,cmap=plt.cm.Paired) plt.axis(&#39;tight&#39;) #4、描点 plot_colors=&#39;br&#39;;class_names=&#39;AB&#39; for i,n,c in zip(range(2),class_names,plot_colors): idx=np.where(y==i) plt.scatter(x[idx,0],x[idx,1],color=c,cmap=plt.cm.Paired, s=20,edgecolor=&#39;k&#39;,label=&#39;Class %s&#39;%n) plt.xlim(x_min,x_max);plt.ylim(y_min,y_max) plt.legend(loc=&#39;upper right&#39;) plt.xlabel(&#39;x&#39;),plt.ylabel(&#39;y&#39;) plt.title(&#39;Decision Boundary&#39;) #5、描绘两类别得分 twoclass_output=bdt.decision_function(x) plot_range=(twoclass_output.min(),twoclass_output.max()) plt.subplot(122) for i,n,c in zip(range(2),class_names,plot_colors): plt.hist(twoclass_output[y==i],bins=10,range=plot_range,facecolor=c, label=&#39;Class %s&#39;%n,alpha=0.5,edgecolor=&#39;k&#39;) x1,x2,y1,y2=plt.axis() plt.axis((x1,x2,y1,y2*1.2)) plt.legend(loc=&#39;upper right&#39;) plt.ylabel(&#39;Samples&#39;);plt.xlabel(&#39;Score&#39;) plt.title(&#39;Decision Scores&#39;) plt.tight_layout() plt.subplots_adjust(wspace=0.35) plt.show()","@type":"BlogPosting","url":"https://mlh.app/2019/05/19/787159.html","headline":"AdaBoost代码实现与代码详解","dateModified":"2019-05-19T00:00:00+08:00","datePublished":"2019-05-19T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/05/19/787159.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>AdaBoost代码实现与代码详解</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-light"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <h3><a id="_0"></a>一、手动操作模式</h3> 
  <h4><a id="1_1"></a>1、创建数据集及分类结果</h4> 
  <pre><code class="prism language-py"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

xMat<span class="token operator">=</span>np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">2.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#数据集</span>
                <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
yMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">#预设分类结果，用于模型预测结果的校对</span>
             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
  <h4><a id="2_18"></a>2、描点</h4> 
  <pre><code class="prism language-py">plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Simhei'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">showPlot</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    lable<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>yMat<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>c<span class="token operator">=</span>lable<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'决策树桩测试数据'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
showPlot<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">)</span>
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519095226662.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMjAyMjUz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h5><a id="_31"></a>部分代码说明</h5> 
  <pre><code class="prism language-py">lable<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>yMat<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>c<span class="token operator">=</span>lable<span class="token punctuation">)</span>
<span class="token comment">#scatter()的c即为color，yMat的内容只为1和-1，所以c=lable表示两种不同的颜色</span>
</code></pre> 
  <h4><a id="3_37"></a>3、构建决策树桩(二分类的基学习器)</h4> 
  <pre><code class="prism language-py"><span class="token triple-quoted-string string">''' 决策树桩分类函数： xMat:数据矩阵 i:第i列，也就是第几个特征 Q:阈值 S:标志 re:分类结果 '''</span>
<span class="token keyword">def</span> <span class="token function">Classify0</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>i<span class="token punctuation">,</span>Q<span class="token punctuation">,</span>S<span class="token punctuation">)</span><span class="token punctuation">:</span>
    re<span class="token operator">=</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#初始化re为一堆1</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>S<span class="token operator">==</span><span class="token string">'lt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                  <span class="token comment">#lt:less than</span>
        re<span class="token punctuation">[</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>Q<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>       <span class="token comment">#如果是less且小于阈值，则赋值为-1</span>
    <span class="token keyword">elif</span><span class="token punctuation">(</span>S<span class="token operator">==</span><span class="token string">'gt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment">#gt:greater than</span>
        re<span class="token punctuation">[</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>Q<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>        <span class="token comment">#如果是greater且大于阈值，则赋值为-1</span>
    <span class="token keyword">return</span> re
</code></pre> 
  <h5><a id="_55"></a>上方代码理解</h5> 
  <p>对之后的def get_Stump(xMat,yMat,D)进行截断：</p> 
  <pre><code class="prism language-py">re<span class="token operator">=</span>Classify0<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>i<span class="token punctuation">,</span>Q<span class="token punctuation">,</span>S<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Q:'</span><span class="token punctuation">,</span>Q<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'S:'</span><span class="token punctuation">,</span>S<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'re:\n'</span><span class="token punctuation">,</span>re<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre> 
  <p>对Q(阈值)的理解(举例)：<br> 数据集和预设分类结果：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519100546828.png" alt="在这里插入图片描述"><br> 决策树桩(基学习器)：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519100645883.png" alt="在这里插入图片描述"><br> 其中的2.5就表示阈值Q啦，但并非所有的基学习器都是这个，因为阈值Q会发生移动：<br> (参考get_Stump(xMat,yMat,D)中的Q=(Min+j*stepSize))</p> 
  <p>截断示意图：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519101945482.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMjAyMjUz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 先初始化m和D后才能运行上方截断部分：</p> 
  <pre><code class="prism language-py">m<span class="token operator">=</span>xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
D<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>m<span class="token punctuation">)</span>
</code></pre> 
  <p>截断运行结果：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519101226484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMjAyMjUz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 由此可知，对于每一个阈值Q，大于阈值和小于阈值的两个方向都遍历<br> (因为两个标签’lt’和’gt’都要遍历，参考def get_Stump(xMat,yMat,D)的for S in [‘lt’,‘gt’])</p> 
  <h4><a id="4_80"></a>4、寻找最佳决策树桩</h4> 
  <pre><code class="prism language-py"><span class="token triple-quoted-string string">''' 找到数据集上最佳的决策树桩： xMat:特征矩阵 yMat:标签矩阵 D:样本权重 bestStump:最佳决策树桩信息 minE:最小误差 bestClas:最佳的分类结果 '''</span>
<span class="token keyword">def</span> <span class="token function">get_Stump</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span>D<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">,</span>n<span class="token operator">=</span>xMat<span class="token punctuation">.</span>shape <span class="token comment">#m为样本个数5，n为特征数2 </span>
    Steps<span class="token operator">=</span><span class="token number">10</span>       <span class="token comment">#初始化步数</span>
    bestStump<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">#用字典形式来储存树桩信息</span>
    bestClas<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#初始化分类结果为1，5行1列</span>
    minE<span class="token operator">=</span>np<span class="token punctuation">.</span>inf    <span class="token comment">#最小误差初始化为正无穷大</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>           <span class="token comment">#遍历所有特征</span>
        Min<span class="token operator">=</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">#找到特征中最小值</span>
        Max<span class="token operator">=</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">#找到特征中最大值</span>
        stepSize<span class="token operator">=</span><span class="token punctuation">(</span>Max<span class="token operator">-</span>Min<span class="token punctuation">)</span><span class="token operator">/</span>Steps <span class="token comment">#计算总步长，用以移动阈值</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>Steps<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> S <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'lt'</span><span class="token punctuation">,</span><span class="token string">'gt'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment">#大于和小于的情况，两种方法均遍历；lt:less than, gt:greater than</span>
                Q<span class="token operator">=</span><span class="token punctuation">(</span>Min<span class="token operator">+</span>j<span class="token operator">*</span>stepSize<span class="token punctuation">)</span> <span class="token comment">#计算阈值</span>
                re<span class="token operator">=</span>Classify0<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>i<span class="token punctuation">,</span>Q<span class="token punctuation">,</span>S<span class="token punctuation">)</span>   <span class="token comment">#决策树桩分类方法，得分类结果</span>

                err<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#初始化误差矩阵，一堆1</span>
                err<span class="token punctuation">[</span>re<span class="token operator">==</span>yMat<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span> <span class="token comment">#分类正确的，赋值为0，若分类错误，则为原数1</span>
                eca<span class="token operator">=</span>D<span class="token punctuation">.</span>T<span class="token operator">*</span>err     <span class="token comment">#计算误差</span>
                <span class="token comment">#print(f'切分特征:{i},阈值:{np.round(Q,2)},标志:{S},权重误差:{np.round(eca,3)}')</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>eca<span class="token operator">&lt;</span>minE<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment">#找到误差最小的分类方式</span>
                    minE<span class="token operator">=</span>eca
                    bestClas<span class="token operator">=</span>re<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    bestStump<span class="token punctuation">[</span><span class="token string">'特征列'</span><span class="token punctuation">]</span><span class="token operator">=</span>i
                    bestStump<span class="token punctuation">[</span><span class="token string">'阈值'</span><span class="token punctuation">]</span><span class="token operator">=</span>Q
                    bestStump<span class="token punctuation">[</span><span class="token string">'标志'</span><span class="token punctuation">]</span><span class="token operator">=</span>S
    <span class="token keyword">return</span> bestStump<span class="token punctuation">,</span>minE<span class="token punctuation">,</span>bestClas
</code></pre> 
  <h5><a id="_118"></a>部分代码理解</h5> 
  <pre><code class="prism language-py">minE<span class="token operator">=</span>np<span class="token punctuation">.</span>inf
<span class="token triple-quoted-string string">''' 这个函数的目的是通过寻找最小误差率得到对应的决策树桩，即为最佳的决策树桩， 因此不妨将误差率初始化为无穷大，在AdaBoost的迭代误差率会被更小的覆盖 (误差率会不断下降) '''</span>
Steps<span class="token operator">=</span><span class="token number">10</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Min<span class="token operator">=</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    Max<span class="token operator">=</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    stepSize<span class="token operator">=</span><span class="token punctuation">(</span>Max<span class="token operator">-</span>Min<span class="token punctuation">)</span><span class="token operator">/</span>Steps
<span class="token triple-quoted-string string">'''stepSize为阈值Q的移动小步'''</span>
</code></pre> 
  <h4><a id="5AdaBoost_133"></a>5、基于决策树桩的AdaBoost训练过程</h4> 
  <pre><code class="prism language-py"><span class="token triple-quoted-string string">''' 基于决策树桩的AdaBoost训练过程，训练出基学习器和最终训练结果 xMat:特征矩阵(数据集) yMat:标签矩阵(预设的分类结果，用于模型预测结果的校对) maxC:最大迭代次数 weakClass:基分类器 aggClass:最终类别估计值(即西瓜书P174的伪代码中H(x)中的累加量) '''</span>
<span class="token keyword">def</span> <span class="token function">Ada_train</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span>maxC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    weakClass<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#基学习器</span>
    m<span class="token operator">=</span>xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    D<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>m<span class="token punctuation">)</span> <span class="token comment">#初始化样本权重(每个样本权重相等)</span>
    aggClass<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#最终结果的初始化</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>maxC<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Stump<span class="token punctuation">,</span>error<span class="token punctuation">,</span>bestClas<span class="token operator">=</span>get_Stump<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span>D<span class="token punctuation">)</span>         <span class="token comment">#构建决策树桩</span>
        alpha<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>error<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">max</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#计算弱分类器权重alpha，即西瓜书P174伪代码的第6行</span>
        Stump<span class="token punctuation">[</span><span class="token string">'alpha'</span><span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span>alpha<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>                    <span class="token comment">#存储弱学习算法权重，保留两位小数</span>
        weakClass<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Stump<span class="token punctuation">)</span>                             <span class="token comment">#存储决策树桩</span>
        
        <span class="token comment">#以下3行为西瓜书的P174伪代码第7行的最终公式</span>
        expon<span class="token operator">=</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">*</span>alpha<span class="token operator">*</span>yMat<span class="token punctuation">,</span>bestClas<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#计算e的指数项</span>
        D<span class="token operator">=</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>D<span class="token punctuation">,</span>expon<span class="token punctuation">)</span>
        D<span class="token operator">=</span>D<span class="token operator">/</span>D<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment">#根据样本权重公式，更新样本权重</span>
        <span class="token comment">#以下2行为西瓜书的P174伪代码的输出公式</span>
        aggClass<span class="token operator">+=</span>alpha<span class="token operator">*</span>bestClas                  <span class="token comment">#更新累计类别估计值</span>
        Hx<span class="token operator">=</span>np<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>aggClass<span class="token punctuation">)</span>                      <span class="token comment">#最终分类结果</span>

        aggErr<span class="token operator">=</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>Hx<span class="token operator">!=</span>yMat<span class="token punctuation">,</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#计算误差</span>
        errRate<span class="token operator">=</span>aggErr<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>m
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'分类错误率:'</span><span class="token punctuation">,</span>errRate<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>errRate<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">break</span> <span class="token comment">#当误差为0时，达到最优，退出循环</span>
    <span class="token keyword">return</span> weakClass<span class="token punctuation">,</span>aggClass

weakClass<span class="token punctuation">,</span>aggClass<span class="token operator">=</span>Ada_train<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最佳基学习器：\n'</span><span class="token punctuation">,</span>weakClass<span class="token punctuation">,</span><span class="token string">'\nH(x)中的累加量：\n'</span><span class="token punctuation">,</span>aggClass<span class="token punctuation">)</span>
</code></pre> 
  <p>运行结果：</p> 
  <pre><code class="prism language-py">分类错误率<span class="token punctuation">:</span> <span class="token number">0.2</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.0</span>
最佳基学习器：
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'特征列'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'阈值'</span><span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token string">'标志'</span><span class="token punctuation">:</span> <span class="token string">'lt'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.69</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span><span class="token string">'特征列'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'阈值'</span><span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token string">'标志'</span><span class="token punctuation">:</span> <span class="token string">'lt'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.97</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
 <span class="token punctuation">{</span><span class="token string">'特征列'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'阈值'</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token string">'标志'</span><span class="token punctuation">:</span> <span class="token string">'lt'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.9</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> 
 H<span class="token punctuation">(</span>x<span class="token punctuation">)</span>中的累加量：
 <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.17568763</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">2.56198199</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.77022252</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.77022252</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">0.61607184</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
  <p>有好心人能在评论区帮我详细讲解一下下面这段代码怎么理解吗：)</p> 
  <pre><code class="prism language-py">aggErr<span class="token operator">=</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>Hx<span class="token operator">!=</span>yMat<span class="token punctuation">,</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#计算误差</span>
errRate<span class="token operator">=</span>aggErr<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>m
</code></pre> 
  <h4><a id="6_193"></a>6、测试</h4> 
  <pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">AdaClassify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#这里的weakClass为训练得到的最佳基学习器</span>
    dataMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    m<span class="token operator">=</span>dataMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    aggClass<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#用上方训练出来的最佳基学习器进行测试:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>weakClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#遍历所有分类器，进行分类</span>
        classEst<span class="token operator">=</span>Classify0<span class="token punctuation">(</span>dataMat<span class="token punctuation">,</span>
                           weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'特征列'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                           weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'阈值'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'标志'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        aggClass<span class="token operator">+=</span>weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'alpha'</span><span class="token punctuation">]</span><span class="token operator">*</span>classEst
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>aggClass<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>AdaClassify<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#最终分类为-1</span>
</code></pre> 
  <h4><a id="7_210"></a>7、上实例(病马数据集)</h4> 
  <p>我不知道怎么把数据放上去…</p> 
  <pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">calAcc</span><span class="token punctuation">(</span>maxC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataSetTrain<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span><span class="token string">'E:/AdaBoost/horseColicTraining2.txt'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
    train_xMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTrain<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>  <span class="token comment">#数据集</span>
    train_yMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTrain<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span>T <span class="token comment">#预设分类结果</span>

    weakClass<span class="token punctuation">,</span>aggClass<span class="token operator">=</span>Ada_train<span class="token punctuation">(</span>train_xMat<span class="token punctuation">,</span>train_yMat<span class="token punctuation">,</span>maxC<span class="token punctuation">)</span> <span class="token comment">#训练出最佳基学习器们</span>
    yhat<span class="token operator">=</span>AdaClassify<span class="token punctuation">(</span>train_xMat<span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span>
    <span class="token comment">#用训练出来的最佳基学习器们测试出H(x)即yHat(预测得的分类结果)</span>
    trainCorCount<span class="token operator">=</span><span class="token number">0</span> <span class="token comment">#初始化准确个数为0</span>
    m<span class="token operator">=</span>train_xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>yhat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>train_yMat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            trainCorCount<span class="token operator">+=</span><span class="token number">1</span> <span class="token comment">#若某一预测结果正确累计+1</span>
    trainAcc<span class="token operator">=</span>trainCorCount<span class="token operator">/</span>m
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集准确率为:'</span><span class="token punctuation">,</span>trainAcc<span class="token punctuation">)</span>

    testCorCount<span class="token operator">=</span><span class="token number">0</span>
    dataSetTest<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span><span class="token string">'E:/AdaBoost/horseColicTest2.txt'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
    test_xMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTest<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>
    test_yMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTest<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span>T

    yhat<span class="token operator">=</span>AdaClassify<span class="token punctuation">(</span>test_xMat<span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span> <span class="token comment">#weakClass在上方已训练出来了</span>
    n<span class="token operator">=</span>test_xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>yhat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_yMat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            testCorCount<span class="token operator">+=</span><span class="token number">1</span>
    testAcc<span class="token operator">=</span>testCorCount<span class="token operator">/</span>n
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集准确率为:'</span><span class="token punctuation">,</span>testAcc<span class="token punctuation">)</span>
    <span class="token keyword">return</span> trainAcc<span class="token punctuation">,</span>testAcc

<span class="token keyword">print</span><span class="token punctuation">(</span>calAcc<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#迭代40次</span>
</code></pre> 
  <p>运行结果：</p> 
  <pre><code class="prism language-py">分类错误率<span class="token punctuation">:</span> <span class="token number">0.2842809364548495</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2842809364548495</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.24749163879598662</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.24749163879598662</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.25418060200668896</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2408026755852843</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2408026755852843</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22073578595317725</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.24749163879598662</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.23076923076923078</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2408026755852843</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2140468227424749</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22742474916387959</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21739130434782608</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22073578595317725</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21739130434782608</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22408026755852842</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22408026755852842</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.23076923076923078</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22408026755852842</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2140468227424749</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.20735785953177258</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22408026755852842</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22408026755852842</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2140468227424749</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.22073578595317725</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.2040133779264214</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.20735785953177258</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21070234113712374</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21739130434782608</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21070234113712374</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21739130434782608</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.20735785953177258</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.21070234113712374</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.20735785953177258</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.20735785953177258</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.19732441471571907</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.19063545150501673</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.20066889632107024</span>
分类错误率<span class="token punctuation">:</span> <span class="token number">0.19732441471571907</span>
训练集准确率为<span class="token punctuation">:</span> <span class="token number">0.802675585284281</span>
测试集准确率为<span class="token punctuation">:</span> <span class="token number">0.8059701492537313</span>
<span class="token punctuation">(</span><span class="token number">0.802675585284281</span><span class="token punctuation">,</span> <span class="token number">0.8059701492537313</span><span class="token punctuation">)</span>
</code></pre> 
  <h4><a id="8_291"></a>8、代码整合</h4> 
  <pre><code class="prism language-py"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

xMat<span class="token operator">=</span>np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">2.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span> <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
yMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Simhei'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">showPlot</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    lable<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>yMat<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>c<span class="token operator">=</span>lable<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'决策树桩测试数据'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
showPlot<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">Classify0</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>i<span class="token punctuation">,</span>Q<span class="token punctuation">,</span>S<span class="token punctuation">)</span><span class="token punctuation">:</span>
    re<span class="token operator">=</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>S<span class="token operator">==</span><span class="token string">'lt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        re<span class="token punctuation">[</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>Q<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">elif</span><span class="token punctuation">(</span>S<span class="token operator">==</span><span class="token string">'gt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        re<span class="token punctuation">[</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>Q<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">return</span> re

<span class="token keyword">def</span> <span class="token function">get_Stump</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span>D<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">,</span>n<span class="token operator">=</span>xMat<span class="token punctuation">.</span>shape  
    Steps<span class="token operator">=</span><span class="token number">10</span>
    bestStump<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    bestClas<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    minE<span class="token operator">=</span>np<span class="token punctuation">.</span>inf
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Min<span class="token operator">=</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Max<span class="token operator">=</span>xMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        stepSize<span class="token operator">=</span><span class="token punctuation">(</span>Max<span class="token operator">-</span>Min<span class="token punctuation">)</span><span class="token operator">/</span>Steps
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>Steps<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> S <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'lt'</span><span class="token punctuation">,</span><span class="token string">'gt'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                Q<span class="token operator">=</span><span class="token punctuation">(</span>Min<span class="token operator">+</span>j<span class="token operator">*</span>stepSize<span class="token punctuation">)</span>
                re<span class="token operator">=</span>Classify0<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>i<span class="token punctuation">,</span>Q<span class="token punctuation">,</span>S<span class="token punctuation">)</span>

                err<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                err<span class="token punctuation">[</span>re<span class="token operator">==</span>yMat<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
                eca<span class="token operator">=</span>D<span class="token punctuation">.</span>T<span class="token operator">*</span>err
                <span class="token keyword">if</span><span class="token punctuation">(</span>eca<span class="token operator">&lt;</span>minE<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    minE<span class="token operator">=</span>eca
                    bestClas<span class="token operator">=</span>re<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    bestStump<span class="token punctuation">[</span><span class="token string">'特征列'</span><span class="token punctuation">]</span><span class="token operator">=</span>i
                    bestStump<span class="token punctuation">[</span><span class="token string">'阈值'</span><span class="token punctuation">]</span><span class="token operator">=</span>Q
                    bestStump<span class="token punctuation">[</span><span class="token string">'标志'</span><span class="token punctuation">]</span><span class="token operator">=</span>S
    <span class="token keyword">return</span> bestStump<span class="token punctuation">,</span>minE<span class="token punctuation">,</span>bestClas

<span class="token keyword">def</span> <span class="token function">Ada_train</span><span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span>maxC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    weakClass<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    m<span class="token operator">=</span>xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    D<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>m<span class="token punctuation">)</span>
    aggClass<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>maxC<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Stump<span class="token punctuation">,</span>error<span class="token punctuation">,</span>bestClas<span class="token operator">=</span>get_Stump<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span>D<span class="token punctuation">)</span>
        alpha<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>error<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">max</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        Stump<span class="token punctuation">[</span><span class="token string">'alpha'</span><span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span>alpha<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
        weakClass<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Stump<span class="token punctuation">)</span>
        
        expon<span class="token operator">=</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">*</span>alpha<span class="token operator">*</span>yMat<span class="token punctuation">,</span>bestClas<span class="token punctuation">)</span><span class="token punctuation">)</span>
        D<span class="token operator">=</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>D<span class="token punctuation">,</span>expon<span class="token punctuation">)</span>
        D<span class="token operator">=</span>D<span class="token operator">/</span>D<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        aggClass<span class="token operator">+=</span>alpha<span class="token operator">*</span>bestClas
        Hx<span class="token operator">=</span>np<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>aggClass<span class="token punctuation">)</span>
        aggErr<span class="token operator">=</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>Hx<span class="token operator">!=</span>yMat<span class="token punctuation">,</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        errRate<span class="token operator">=</span>aggErr<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>m
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'分类错误率:'</span><span class="token punctuation">,</span>errRate<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>errRate<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">break</span>
    <span class="token keyword">return</span> weakClass<span class="token punctuation">,</span>aggClass

weakClass<span class="token punctuation">,</span>aggClass<span class="token operator">=</span>Ada_train<span class="token punctuation">(</span>xMat<span class="token punctuation">,</span>yMat<span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最佳基学习器：\n'</span><span class="token punctuation">,</span>weakClass<span class="token punctuation">,</span><span class="token string">'\nH(x)中的累加量：\n'</span><span class="token punctuation">,</span>aggClass<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">AdaClassify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    m<span class="token operator">=</span>dataMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    aggClass<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>weakClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        classEst<span class="token operator">=</span>Classify0<span class="token punctuation">(</span>dataMat<span class="token punctuation">,</span>weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'特征列'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'阈值'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'标志'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        aggClass<span class="token operator">+=</span>weakClass<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'alpha'</span><span class="token punctuation">]</span><span class="token operator">*</span>classEst
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>aggClass<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>AdaClassify<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">calAcc</span><span class="token punctuation">(</span>maxC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataSetTrain<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span><span class="token string">'E:/AdaBoost/horseColicTraining2.txt'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
    train_xMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTrain<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>
    train_yMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTrain<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span>T

    weakClass<span class="token punctuation">,</span>aggClass<span class="token operator">=</span>Ada_train<span class="token punctuation">(</span>train_xMat<span class="token punctuation">,</span>train_yMat<span class="token punctuation">,</span>maxC<span class="token punctuation">)</span>
    yhat<span class="token operator">=</span>AdaClassify<span class="token punctuation">(</span>train_xMat<span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span>
    trainCorCount<span class="token operator">=</span><span class="token number">0</span>
    m<span class="token operator">=</span>train_xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>yhat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>train_yMat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            trainCorCount<span class="token operator">+=</span><span class="token number">1</span>
    trainAcc<span class="token operator">=</span>trainCorCount<span class="token operator">/</span>m
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集准确率为:'</span><span class="token punctuation">,</span>trainAcc<span class="token punctuation">)</span>

    testCorCount<span class="token operator">=</span><span class="token number">0</span>
    dataSetTest<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span><span class="token string">'E:/AdaBoost/horseColicTest2.txt'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
    test_xMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTest<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>
    test_yMat<span class="token operator">=</span>np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>dataSetTest<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span>T

    yhat<span class="token operator">=</span>AdaClassify<span class="token punctuation">(</span>test_xMat<span class="token punctuation">,</span>weakClass<span class="token punctuation">)</span>
    n<span class="token operator">=</span>test_xMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>yhat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_yMat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            testCorCount<span class="token operator">+=</span><span class="token number">1</span>
    testAcc<span class="token operator">=</span>testCorCount<span class="token operator">/</span>n
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集准确率为:'</span><span class="token punctuation">,</span>testAcc<span class="token punctuation">)</span>
    <span class="token keyword">return</span> trainAcc<span class="token punctuation">,</span>testAcc

<span class="token keyword">print</span><span class="token punctuation">(</span>calAcc<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <h3><a id="_421"></a>二、内置函数模式</h3> 
  <pre><code class="prism language-py"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_gaussian_quantiles
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> AdaBoostClassifier
</code></pre> 
  <h4><a id="1_429"></a>1、创建数据集</h4> 
  <pre><code class="prism language-py">x1<span class="token punctuation">,</span>y1<span class="token operator">=</span>make_gaussian_quantiles<span class="token punctuation">(</span>cov<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>n_samples<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>n_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#为了增加样本分布的复杂度，再生成一个数据分布</span>
x2<span class="token punctuation">,</span>y2<span class="token operator">=</span>make_gaussian_quantiles<span class="token punctuation">(</span>mean<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cov<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span>n_samples<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment">#两样本特征均值为3和3</span>
                              n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>n_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">=</span>np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span><span class="token operator">-</span>y2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#np.concatenate:默认垂直合并</span>
<span class="token comment">#x:数据; y:数据集所属类别(两类:0或1)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据集：\n'</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'分类标签：\n'</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> 
  <h5><a id="_440"></a>部分代码说明</h5> 
  <pre><code class="prism language-py"><span class="token triple-quoted-string string">'''make_gaussian_quantiles:生成分组多维正态分布的数据； mean:特征均值(上方默认为(0,0))；cov:样本协方差的系数；n_samples:样本个数； n_features:正态分布的维数；n_classe:输出的类别数； n_classe=2：生成的数据按分位数分成2组'''</span>
</code></pre> 
  <p>运行结果</p> 
  <pre><code class="prism language-py">数据集：
 <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">7.00334571e-01</span> <span class="token operator">-</span><span class="token number">2.47067578e-01</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3.95001869e+00</span>  <span class="token number">2.74007953e+00</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">1.50221617e-01</span> <span class="token operator">-</span><span class="token number">2.15763780e+00</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.67205033e+00</span> <span class="token operator">-</span><span class="token number">9.41519069e-01</span><span class="token punctuation">]</span>
  		 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>			  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">[</span> <span class="token number">8.94180435e-01</span>  <span class="token number">3.06995865e+00</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">8.49439078e-01</span>  <span class="token number">3.87543489e+00</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">5.21744335e+00</span>  <span class="token number">1.40081765e+00</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
 分类标签：
 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
  <h4><a id="2AdaBoost_462"></a>2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合</h4> 
  <pre><code class="prism language-py">weakClassifier<span class="token operator">=</span>DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
bdt<span class="token operator">=</span>AdaBoostClassifier<span class="token punctuation">(</span>weakClassifier<span class="token punctuation">,</span>algorithm<span class="token operator">=</span><span class="token string">"SAMME"</span><span class="token punctuation">,</span>n_estimators<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token comment">#选择SAMME算法，最多200个弱分类器</span>
bdt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token comment">#fit():训练算法，设置内部参数</span>
</code></pre> 
  <h4><a id="3_469"></a>3、描绘决策边缘</h4> 
  <pre><code class="prism language-py">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#生成10(in)*5(in)=50(in^2)大的空画布</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>

x_min<span class="token punctuation">,</span>x_max<span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
y_min<span class="token punctuation">,</span>y_max<span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token comment">#上述两行为下面画网格图做准备(控制范围，使数据合理坐落在图中)</span>
plot_step<span class="token operator">=</span><span class="token number">0.02</span>
xx<span class="token punctuation">,</span>yy<span class="token operator">=</span>np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>x_min<span class="token punctuation">,</span>x_max<span class="token punctuation">,</span>plot_step<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>y_min<span class="token punctuation">,</span>y_max<span class="token punctuation">,</span>plot_step<span class="token punctuation">)</span><span class="token punctuation">)</span>
Z<span class="token operator">=</span>bdt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>xx<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>yy<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Z<span class="token operator">=</span>Z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>xx<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment">#以上2行，将xx、yy展开，然后预测每个点的类别，将结果大小调整到和坐标数据相同的矩阵大小</span>
cs<span class="token operator">=</span>plt<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Paired<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'tight'</span><span class="token punctuation">)</span> <span class="token comment">#使坐标轴适应数据量，即有一个范围合理的坐标轴</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <h5><a id="_486"></a>部分代码说明</h5> 
  <pre><code class="prism language-py">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">''' 将画布大小分成几个部分，参数'121'表示1(row)x2(col)，即将画布分成1x2，一行两列的 2块区域，第三个数1表示选择图形输出的区域在第一块，图形输出区域参数必须在"行×列"范 围内，此处必须在1和2之间选择 '''</span>
xx<span class="token punctuation">,</span>yy<span class="token operator">=</span>np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>x_min<span class="token punctuation">,</span>x_max<span class="token punctuation">,</span>plot_step<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>y_min<span class="token punctuation">,</span>y_max<span class="token punctuation">,</span>plot_step<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">''' 生成网格点坐标矩阵，在x、y方向上以plot_step逐渐生成 (以0.02的步伐在X坐标上取点,以0.02的步伐在Y坐标上取点) 基本取满坐标中的画布 '''</span>
Z<span class="token operator">=</span>bdt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>xx<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>yy<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">''' np.c_[]:多维数组水平合并，对一维数组放竖再水平合并 np.ravel():将多行的多维数组铺平成一维数组(一行) predict():返回的是一个大小为n的一维数组，用训练好的分类器去预测出()内数据的标签， 一维数组中的第i个值为模型预测第i个预测样本的标签，即在y中的对应值 如： x_train=np.array([[1,2,3],[1,3,4],[2,1,2],[4,5,6],[3,5,3],[1,7,2]]) y_train=np.array([0,0,0,1,1,1]) x_test=np.array([[2,2,2],[3,2,6],[1,7,4]]) clf=LogisticRegression() clf.fit(x_train,y_train) clf.predict(x_test) &gt;&gt;&gt;array([1,0,1]) '''</span>
cs<span class="token operator">=</span>plt<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Paired<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">''' plt.contourf(X,Y,f(X,Y))，其中X、Y为shape相同的一维数组 plt.cm中cm全称表示colormap，paired表示两个两个相近色彩输出， 比如浅蓝、深蓝；浅红、深红；浅绿，深绿 '''</span>
</code></pre> 
  <p>运行结果<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519112920518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMjAyMjUz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h4><a id="4_526"></a>4、描点</h4> 
  <pre><code class="prism language-py">plot_colors<span class="token operator">=</span><span class="token string">'br'</span><span class="token punctuation">;</span>class_names<span class="token operator">=</span><span class="token string">'AB'</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>class_names<span class="token punctuation">,</span>plot_colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    idx<span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>y<span class="token operator">==</span>i<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span>c<span class="token punctuation">,</span>cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Paired<span class="token punctuation">,</span>
            s<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'Class %s'</span><span class="token operator">%</span>n<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span>x_min<span class="token punctuation">,</span>x_max<span class="token punctuation">)</span><span class="token punctuation">;</span>plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span>y_min<span class="token punctuation">,</span>y_max<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'upper right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Boundary'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <h5><a id="_540"></a>部分代码说明</h5> 
  <pre><code class="prism language-py">idx<span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>y<span class="token operator">==</span>i<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">''' np.where(condition,x,y)，满足条件(condition)，输出x，不满足输出y； 若只有条件(condition)，没有x和y，则输出满足条件(即非0)元素的坐标，这里的坐标以tuple的形式给出 如： a=np.array([2,4,6,8,10]) np.where(a&gt;5) &gt;&gt;&gt;(array([2,3,4]),) '''</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>class_names<span class="token punctuation">,</span>plot_colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">''' &gt;&gt;&gt; 0 A b 1 B r '''</span>
</code></pre> 
  <p>运行结果<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519113621595.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMjAyMjUz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h4><a id="510_561"></a>5、描绘两类别(1和0)得分</h4> 
  <pre><code class="prism language-py">twoclass_output<span class="token operator">=</span>bdt<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment">#decision_function(x):计算输入x的决策函数值</span>
plot_range<span class="token operator">=</span><span class="token punctuation">(</span>twoclass_output<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>twoclass_output<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>class_names<span class="token punctuation">,</span>plot_colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>twoclass_output<span class="token punctuation">[</span>y<span class="token operator">==</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token builtin">range</span><span class="token operator">=</span>plot_range<span class="token punctuation">,</span>facecolor<span class="token operator">=</span>c<span class="token punctuation">,</span>
             label<span class="token operator">=</span><span class="token string">'Class %s'</span><span class="token operator">%</span>n<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span>
             <span class="token comment">#bins指定箱子的个数，即总共有几条条状图</span>
x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>y2<span class="token operator">=</span>plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>y2<span class="token operator">*</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#plt.axis([-1,10,0,6]):x轴起始于-1，终止于10，y轴起始于0，终止于6</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'upper right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Samples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Scores'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#tight_layout会自动调整子图参数，使之填充整个图像区域</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>wspace<span class="token operator">=</span><span class="token number">0.35</span><span class="token punctuation">)</span>
<span class="token comment">#以上2行都为调整图像边缘及图像间的空白间隔</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
  <p>运行结果<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190519113913698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMjAyMjUz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <h4><a id="6_585"></a>6、代码整合</h4> 
  <pre><code class="prism language-py"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_gaussian_quantiles
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> AdaBoostClassifier

<span class="token comment">#1、创建数据集</span>
x1<span class="token punctuation">,</span>y1<span class="token operator">=</span>make_gaussian_quantiles<span class="token punctuation">(</span>cov<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>n_samples<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>n_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

x2<span class="token punctuation">,</span>y2<span class="token operator">=</span>make_gaussian_quantiles<span class="token punctuation">(</span>mean<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cov<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span>n_samples<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> 
                              n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>n_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">=</span>np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span><span class="token operator">-</span>y2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#2、创建模型，选择决策树桩为基学习器，并以AdaBoost拟合</span>
weakClassifier<span class="token operator">=</span>DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
bdt<span class="token operator">=</span>AdaBoostClassifier<span class="token punctuation">(</span>weakClassifier<span class="token punctuation">,</span>algorithm<span class="token operator">=</span><span class="token string">"SAMME"</span><span class="token punctuation">,</span>n_estimators<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
bdt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token comment">#3、描绘决策边缘</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>

x_min<span class="token punctuation">,</span>x_max<span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
y_min<span class="token punctuation">,</span>y_max<span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>

plot_step<span class="token operator">=</span><span class="token number">0.02</span>
xx<span class="token punctuation">,</span>yy<span class="token operator">=</span>np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>x_min<span class="token punctuation">,</span>x_max<span class="token punctuation">,</span>plot_step<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>y_min<span class="token punctuation">,</span>y_max<span class="token punctuation">,</span>plot_step<span class="token punctuation">)</span><span class="token punctuation">)</span>

Z<span class="token operator">=</span>bdt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>xx<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>yy<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Z<span class="token operator">=</span>Z<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>xx<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
cs<span class="token operator">=</span>plt<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Paired<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'tight'</span><span class="token punctuation">)</span>

<span class="token comment">#4、描点</span>
plot_colors<span class="token operator">=</span><span class="token string">'br'</span><span class="token punctuation">;</span>class_names<span class="token operator">=</span><span class="token string">'AB'</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>class_names<span class="token punctuation">,</span>plot_colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    idx<span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>y<span class="token operator">==</span>i<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span>idx<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span>c<span class="token punctuation">,</span>cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Paired<span class="token punctuation">,</span>
                s<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'Class %s'</span><span class="token operator">%</span>n<span class="token punctuation">)</span>
                
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span>x_min<span class="token punctuation">,</span>x_max<span class="token punctuation">)</span><span class="token punctuation">;</span>plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span>y_min<span class="token punctuation">,</span>y_max<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'upper right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Boundary'</span><span class="token punctuation">)</span>

<span class="token comment">#5、描绘两类别得分</span>
twoclass_output<span class="token operator">=</span>bdt<span class="token punctuation">.</span>decision_function<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
plot_range<span class="token operator">=</span><span class="token punctuation">(</span>twoclass_output<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>twoclass_output<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>class_names<span class="token punctuation">,</span>plot_colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>twoclass_output<span class="token punctuation">[</span>y<span class="token operator">==</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token builtin">range</span><span class="token operator">=</span>plot_range<span class="token punctuation">,</span>facecolor<span class="token operator">=</span>c<span class="token punctuation">,</span>
             label<span class="token operator">=</span><span class="token string">'Class %s'</span><span class="token operator">%</span>n<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span>
x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>y2<span class="token operator">=</span>plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>y2<span class="token operator">*</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'upper right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Samples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Scores'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>wspace<span class="token operator">=</span><span class="token number">0.35</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Pytorch中的自动求导函数backward()所需参数的含义 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Pytorch中的自动求导函数backward()所需参数的含义" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="正常来说backward( )函数是要传入参数的，一直没弄明白backward需要传入的参数具体含义，但是没关系，生命在与折腾，咱们来折腾一下，嘿嘿。 对标量自动求导 首先，如果out.backward()中的out是一个标量的话（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有一个输出）那么此时我的backward函数是不需要输入任何参数的。 import torch from torch.autograd import Variable a = Variable(torch.Tensor([2,3]),requires_grad=True) b = a + 3 c = b * 3 out = c.mean() out.backward() print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data.item()) print(&#39;input gradients are:&#39;) print(a.grad) 运行结果： 不难看出，我们构建了这样的一个函数： o u t = 3 [ ( a 1 + 3 ) + ( a 2 + 3 ) ] 2 out={3[(a_1+3)+(a_2+3)]\over2} out=23[(a1​+3)+(a2​+3)]​ 所以其求导也很容易看出： ∂ o u t ∂ a 1 = ∂ o u t ∂ a 2 = 3 2 {\partial out \over \partial a_1}={\partial out \over \partial a_2 }={3\over2} ∂a1​∂out​=∂a2​∂out​=23​ 这是对其进行标量自动求导的结果. 对向量自动求导 如果out.backward()中的out是一个向量（或者理解成1xN的矩阵）的话，我们对向量进行自动求导，看看会发生什么？ 先构建这样的一个模型（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有两个输出）： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 b[0,1] = a[0,1] ** 3 out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,1.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 模型也很简单，不难看出out求导出来的雅克比应该是： ( ∂ o u t 1 ∂ a 1 = 4 a 1 ∂ o u t 1 ∂ a 2 = 0 ∂ o u t 2 ∂ a 1 = 0 ∂ o u t 2 ∂ a 2 = 6 a 2 2 ) \begin{pmatrix} {\partial out_1 \over \partial a_1}=4a_1&amp;amp;{\partial out_1 \over \partial a_2}=0\\\\ {\partial out_2 \over \partial a_1}=0&amp;amp;{\partial out_2 \over \partial a_2}=6a_2^2\\\\ \end{pmatrix} ⎝⎜⎜⎛​∂a1​∂out1​​=4a1​∂a1​∂out2​​=0​∂a2​∂out1​​=0∂a2​∂out2​​=6a22​​⎠⎟⎟⎞​ 因为a1 = 2，a2 = 4，所以上面的矩阵应该是: ( 8 0 0 96 ) \begin{pmatrix} 8&amp;amp;0\\ 0&amp;amp;96\\ \end{pmatrix} (80​096​) 运行的结果： 嗯，的确是8和96，但是仔细想一想，和咱们想要的雅克比矩阵的形式也不一样啊。难道是backward自动把0给省略了？ 咱们继续试试，这次在上一个模型的基础上进行小修改，如下： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,1.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 可以看出这个模型的雅克比应该是： ( ∂ o u t 1 ∂ a 1 = 4 a 1 ∂ o u t 1 ∂ a 2 = 2 ∂ o u t 2 ∂ a 1 = 2 ∂ o u t 2 ∂ a 2 = 6 a 2 2 ) \begin{pmatrix} {\partial out_1 \over \partial a_1}=4a_1&amp;amp;{\partial out_1 \over \partial a_2}=2\\ \\ {\partial out_2 \over \partial a_1}=2&amp;amp;{\partial out_2 \over \partial a_2}=6a_2^2\\ \end{pmatrix} ⎝⎛​∂a1​∂out1​​=4a1​∂a1​∂out2​​=2​∂a2​∂out1​​=2∂a2​∂out2​​=6a22​​⎠⎞​ 运行一下： 等等，什么鬼？正常来说不应该是 ( 8 2 2 96 ) \begin{pmatrix} 8&amp;amp;2\\ 2&amp;amp;96\\ \end{pmatrix} (82​296​)么？ 我是谁？我再哪？为什么就给我2个数，而且是 8 + 2 = 10 ，96 + 2 = 98 。难道都是加的 2 ？ 想一想，刚才咱们backward中传的参数是 [ [ 1 , 1 ] ]，难道安装这个关系对应求和了？ 咱们换个参数来试一试，程序中只更改传入的参数为[ [ 1 , 2 ] ]： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,2.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 嗯，这回可以理解了，我们传入的参数，是对原来模型正常求导出来的雅克比矩阵进行线性操作，可以把我们传进的参数（设为arg）看成一个列向量，那么我们得到的结果就是: ( M J a c o b o M a r g ) T {({M_{Jacobo}}{M_{arg}})}^T (MJacobo​Marg​)T 在这个题目中，我们得到的实际是： { 1 ∗ ∂ o u t 1 ∂ a 1 + 2 ∗ ∂ o u t 1 ∂ a 2 = 12 1 ∗ ∂ o u t 2 ∂ a 1 + 2 ∗ ∂ o u t 2 ∂ a 2 = 12 \begin{cases} {1*{\partial out_1 \over \partial a_1}}+{2*{\partial out_1 \over \partial a_2}}=12\\\\ {1*{\partial out_2 \over \partial a_1}}+{2*{\partial out_2 \over \partial a_2}}=12\\ \end{cases} ⎩⎪⎨⎪⎧​1∗∂a1​∂out1​​+2∗∂a2​∂out1​​=121∗∂a1​∂out2​​+2∗∂a2​∂out2​​=12​ 看起来一切完美的解释了，但是就在我刚刚打字的一刻，我意识到官方文档中说k.backward()传入的参数应该和k具有相同的维度，所以如果按上述去解释是解释不通的。 哪里出问题了呢？ 仔细看了一下，原来是这样的：在对雅克比矩阵进行线性操作的时候，应该把我们传进的参数（设为arg）看成一个行向量（不是列向量），那么我们得到的结果就是: ( M a r g M J a c o b o ) T {({M_{arg}}{M_{Jacobo}})}^T (Marg​MJacobo​)T 也就是： { 1 ∗ ∂ o u t 1 ∂ a 1 + 2 ∗ ∂ o u t 2 ∂ a 1 = 12 1 ∗ ∂ o u t 1 ∂ a 2 + 2 ∗ ∂ o u t 2 ∂ a 2 = 12 \begin{cases} {1*{\partial out_1 \over \partial a_1}}+{2*{\partial out_2 \over \partial a_1}}=12\\\\ {1*{\partial out_1 \over \partial a_2}}+{2*{\partial out_2 \over \partial a_2}}=12\\ \end{cases} ⎩⎪⎨⎪⎧​1∗∂a1​∂out1​​+2∗∂a1​∂out2​​=121∗∂a2​∂out1​​+2∗∂a2​∂out2​​=12​ 这回我们就解释的通了。 现在我们来输出一下雅克比矩阵吧，为了不引起歧义，我们让雅克比矩阵的每个数值都不一样（一开始分析错了就是因为雅克比矩阵中有相同的数据），所以模型小改动如下： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] * 2 out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1,0]]),retain_graph=True) A_temp = copy.deepcopy(a.grad) a.grad.zero_() out.backward(torch.FloatTensor([[0,1]])) B_temp = a.grad print(&#39;jacobian matrix is:&#39;) print(torch.cat( (A_temp,B_temp),0 )) 如果没问题的话咱们的雅克比矩阵应该是 [ [ 8 , 2 ] , [ 4 , 96 ] ] 好了，下面是见证奇迹的时刻了,不要眨眼睛奥，千万不要眨眼睛… 3 2 1 砰… 好了，现在总结一下：因为经过了复杂的神经网络之后，out中每个数值都是由很多输入样本的属性（也就是输入数据）线性或者非线性组合而成的，那么out中的每个数值和输入数据的每个数值都有关联，也就是说【out】中的每个数都可以对【a】中每个数求导，那么我们backward（）的参数[k1,k2,k3…kn]的含义就是： { ∂ o u t ∂ a 1 = k 1 ∗ ∂ o u t 1 ∂ a 1 + k 2 ∗ ∂ o u t 2 ∂ a 1 + k 3 ∗ ∂ o u t 3 ∂ a 1 + . . . + k n ∗ ∂ o u t n ∂ a 1 ∂ o u t ∂ a 2 = k 1 ∗ ∂ o u t 1 ∂ a 2 + k 2 ∗ ∂ o u t 2 ∂ a 2 + k 3 ∗ ∂ o u t 3 ∂ a 2 + . . . + k n ∗ ∂ o u t n ∂ a 2 . . . ∂ o u t ∂ a n = k 1 ∗ ∂ o u t 1 ∂ a n + k 2 ∗ ∂ o u t 2 ∂ a n + k 3 ∗ ∂ o u t 3 ∂ a n + . . . + k n ∗ ∂ o u t n ∂ a n \begin{cases} {\partial out \over \partial a_1}={k_1*{\partial out_1 \over \partial a_1}}+{k_2*{\partial out_2 \over \partial a_1}}+{k_3*{\partial out_3 \over \partial a_1}}+...+{k_n*{\partial out_n \over \partial a_1}}\\ {\partial out \over \partial a_2}={k_1*{\partial out_1 \over \partial a_2}}+{k_2*{\partial out_2 \over \partial a_2}}+{k_3*{\partial out_3 \over \partial a_2}}+...+{k_n*{\partial out_n \over \partial a_2}}\\ ...\\ {\partial out \over \partial a_n}={k_1*{\partial out_1 \over \partial a_n}}+{k_2*{\partial out_2 \over \partial a_n}}+{k_3*{\partial out_3 \over \partial a_n}}+...+{k_n*{\partial out_n \over \partial a_n}}\\ \end{cases} ⎩⎪⎪⎪⎨⎪⎪⎪⎧​∂a1​∂out​=k1​∗∂a1​∂out1​​+k2​∗∂a1​∂out2​​+k3​∗∂a1​∂out3​​+...+kn​∗∂a1​∂outn​​∂a2​∂out​=k1​∗∂a2​∂out1​​+k2​∗∂a2​∂out2​​+k3​∗∂a2​∂out3​​+...+kn​∗∂a2​∂outn​​...∂an​∂out​=k1​∗∂an​∂out1​​+k2​∗∂an​∂out2​​+k3​∗∂an​∂out3​​+...+kn​∗∂an​∂outn​​​ 也可以理解成每个out分量对an求导时的权重。 对矩阵自动求导 现在，如果out是一个矩阵呢？ 下面的例子也可以理解为：相当于一个神经网络有两个样本，每个样本有两个属性，神经网络有两个输出。 import torch from torch.autograd import Variable from torch import nn a = Variable(torch.FloatTensor([[2,3],[1,2]]),requires_grad=True) w = Variable( torch.zeros(2,1),requires_grad=True ) out = torch.mm(a,w) out.backward(torch.FloatTensor([[1.],[1.]]),retain_graph=True) print(&quot;gradients are:{}&quot;.format(w.grad.data)) 如果前面的例子理解了，那么这个也很好理解，backward输入的参数k是一个2x1的矩阵，2代表的就是样本数量，就是在前面的基础上，再对每个样本进行加权求和。 结果是： 如果有兴趣，也可以拓展一下多个样本的多分类问题，猜一下k的维度应该是【输入样本的个数 * 分类的个数】 好啦，纠结我好久的pytorch自动求导原理算是彻底搞懂啦~~~" />
<meta property="og:description" content="正常来说backward( )函数是要传入参数的，一直没弄明白backward需要传入的参数具体含义，但是没关系，生命在与折腾，咱们来折腾一下，嘿嘿。 对标量自动求导 首先，如果out.backward()中的out是一个标量的话（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有一个输出）那么此时我的backward函数是不需要输入任何参数的。 import torch from torch.autograd import Variable a = Variable(torch.Tensor([2,3]),requires_grad=True) b = a + 3 c = b * 3 out = c.mean() out.backward() print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data.item()) print(&#39;input gradients are:&#39;) print(a.grad) 运行结果： 不难看出，我们构建了这样的一个函数： o u t = 3 [ ( a 1 + 3 ) + ( a 2 + 3 ) ] 2 out={3[(a_1+3)+(a_2+3)]\over2} out=23[(a1​+3)+(a2​+3)]​ 所以其求导也很容易看出： ∂ o u t ∂ a 1 = ∂ o u t ∂ a 2 = 3 2 {\partial out \over \partial a_1}={\partial out \over \partial a_2 }={3\over2} ∂a1​∂out​=∂a2​∂out​=23​ 这是对其进行标量自动求导的结果. 对向量自动求导 如果out.backward()中的out是一个向量（或者理解成1xN的矩阵）的话，我们对向量进行自动求导，看看会发生什么？ 先构建这样的一个模型（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有两个输出）： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 b[0,1] = a[0,1] ** 3 out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,1.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 模型也很简单，不难看出out求导出来的雅克比应该是： ( ∂ o u t 1 ∂ a 1 = 4 a 1 ∂ o u t 1 ∂ a 2 = 0 ∂ o u t 2 ∂ a 1 = 0 ∂ o u t 2 ∂ a 2 = 6 a 2 2 ) \begin{pmatrix} {\partial out_1 \over \partial a_1}=4a_1&amp;amp;{\partial out_1 \over \partial a_2}=0\\\\ {\partial out_2 \over \partial a_1}=0&amp;amp;{\partial out_2 \over \partial a_2}=6a_2^2\\\\ \end{pmatrix} ⎝⎜⎜⎛​∂a1​∂out1​​=4a1​∂a1​∂out2​​=0​∂a2​∂out1​​=0∂a2​∂out2​​=6a22​​⎠⎟⎟⎞​ 因为a1 = 2，a2 = 4，所以上面的矩阵应该是: ( 8 0 0 96 ) \begin{pmatrix} 8&amp;amp;0\\ 0&amp;amp;96\\ \end{pmatrix} (80​096​) 运行的结果： 嗯，的确是8和96，但是仔细想一想，和咱们想要的雅克比矩阵的形式也不一样啊。难道是backward自动把0给省略了？ 咱们继续试试，这次在上一个模型的基础上进行小修改，如下： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,1.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 可以看出这个模型的雅克比应该是： ( ∂ o u t 1 ∂ a 1 = 4 a 1 ∂ o u t 1 ∂ a 2 = 2 ∂ o u t 2 ∂ a 1 = 2 ∂ o u t 2 ∂ a 2 = 6 a 2 2 ) \begin{pmatrix} {\partial out_1 \over \partial a_1}=4a_1&amp;amp;{\partial out_1 \over \partial a_2}=2\\ \\ {\partial out_2 \over \partial a_1}=2&amp;amp;{\partial out_2 \over \partial a_2}=6a_2^2\\ \end{pmatrix} ⎝⎛​∂a1​∂out1​​=4a1​∂a1​∂out2​​=2​∂a2​∂out1​​=2∂a2​∂out2​​=6a22​​⎠⎞​ 运行一下： 等等，什么鬼？正常来说不应该是 ( 8 2 2 96 ) \begin{pmatrix} 8&amp;amp;2\\ 2&amp;amp;96\\ \end{pmatrix} (82​296​)么？ 我是谁？我再哪？为什么就给我2个数，而且是 8 + 2 = 10 ，96 + 2 = 98 。难道都是加的 2 ？ 想一想，刚才咱们backward中传的参数是 [ [ 1 , 1 ] ]，难道安装这个关系对应求和了？ 咱们换个参数来试一试，程序中只更改传入的参数为[ [ 1 , 2 ] ]： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,2.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 嗯，这回可以理解了，我们传入的参数，是对原来模型正常求导出来的雅克比矩阵进行线性操作，可以把我们传进的参数（设为arg）看成一个列向量，那么我们得到的结果就是: ( M J a c o b o M a r g ) T {({M_{Jacobo}}{M_{arg}})}^T (MJacobo​Marg​)T 在这个题目中，我们得到的实际是： { 1 ∗ ∂ o u t 1 ∂ a 1 + 2 ∗ ∂ o u t 1 ∂ a 2 = 12 1 ∗ ∂ o u t 2 ∂ a 1 + 2 ∗ ∂ o u t 2 ∂ a 2 = 12 \begin{cases} {1*{\partial out_1 \over \partial a_1}}+{2*{\partial out_1 \over \partial a_2}}=12\\\\ {1*{\partial out_2 \over \partial a_1}}+{2*{\partial out_2 \over \partial a_2}}=12\\ \end{cases} ⎩⎪⎨⎪⎧​1∗∂a1​∂out1​​+2∗∂a2​∂out1​​=121∗∂a1​∂out2​​+2∗∂a2​∂out2​​=12​ 看起来一切完美的解释了，但是就在我刚刚打字的一刻，我意识到官方文档中说k.backward()传入的参数应该和k具有相同的维度，所以如果按上述去解释是解释不通的。 哪里出问题了呢？ 仔细看了一下，原来是这样的：在对雅克比矩阵进行线性操作的时候，应该把我们传进的参数（设为arg）看成一个行向量（不是列向量），那么我们得到的结果就是: ( M a r g M J a c o b o ) T {({M_{arg}}{M_{Jacobo}})}^T (Marg​MJacobo​)T 也就是： { 1 ∗ ∂ o u t 1 ∂ a 1 + 2 ∗ ∂ o u t 2 ∂ a 1 = 12 1 ∗ ∂ o u t 1 ∂ a 2 + 2 ∗ ∂ o u t 2 ∂ a 2 = 12 \begin{cases} {1*{\partial out_1 \over \partial a_1}}+{2*{\partial out_2 \over \partial a_1}}=12\\\\ {1*{\partial out_1 \over \partial a_2}}+{2*{\partial out_2 \over \partial a_2}}=12\\ \end{cases} ⎩⎪⎨⎪⎧​1∗∂a1​∂out1​​+2∗∂a1​∂out2​​=121∗∂a2​∂out1​​+2∗∂a2​∂out2​​=12​ 这回我们就解释的通了。 现在我们来输出一下雅克比矩阵吧，为了不引起歧义，我们让雅克比矩阵的每个数值都不一样（一开始分析错了就是因为雅克比矩阵中有相同的数据），所以模型小改动如下： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] * 2 out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1,0]]),retain_graph=True) A_temp = copy.deepcopy(a.grad) a.grad.zero_() out.backward(torch.FloatTensor([[0,1]])) B_temp = a.grad print(&#39;jacobian matrix is:&#39;) print(torch.cat( (A_temp,B_temp),0 )) 如果没问题的话咱们的雅克比矩阵应该是 [ [ 8 , 2 ] , [ 4 , 96 ] ] 好了，下面是见证奇迹的时刻了,不要眨眼睛奥，千万不要眨眼睛… 3 2 1 砰… 好了，现在总结一下：因为经过了复杂的神经网络之后，out中每个数值都是由很多输入样本的属性（也就是输入数据）线性或者非线性组合而成的，那么out中的每个数值和输入数据的每个数值都有关联，也就是说【out】中的每个数都可以对【a】中每个数求导，那么我们backward（）的参数[k1,k2,k3…kn]的含义就是： { ∂ o u t ∂ a 1 = k 1 ∗ ∂ o u t 1 ∂ a 1 + k 2 ∗ ∂ o u t 2 ∂ a 1 + k 3 ∗ ∂ o u t 3 ∂ a 1 + . . . + k n ∗ ∂ o u t n ∂ a 1 ∂ o u t ∂ a 2 = k 1 ∗ ∂ o u t 1 ∂ a 2 + k 2 ∗ ∂ o u t 2 ∂ a 2 + k 3 ∗ ∂ o u t 3 ∂ a 2 + . . . + k n ∗ ∂ o u t n ∂ a 2 . . . ∂ o u t ∂ a n = k 1 ∗ ∂ o u t 1 ∂ a n + k 2 ∗ ∂ o u t 2 ∂ a n + k 3 ∗ ∂ o u t 3 ∂ a n + . . . + k n ∗ ∂ o u t n ∂ a n \begin{cases} {\partial out \over \partial a_1}={k_1*{\partial out_1 \over \partial a_1}}+{k_2*{\partial out_2 \over \partial a_1}}+{k_3*{\partial out_3 \over \partial a_1}}+...+{k_n*{\partial out_n \over \partial a_1}}\\ {\partial out \over \partial a_2}={k_1*{\partial out_1 \over \partial a_2}}+{k_2*{\partial out_2 \over \partial a_2}}+{k_3*{\partial out_3 \over \partial a_2}}+...+{k_n*{\partial out_n \over \partial a_2}}\\ ...\\ {\partial out \over \partial a_n}={k_1*{\partial out_1 \over \partial a_n}}+{k_2*{\partial out_2 \over \partial a_n}}+{k_3*{\partial out_3 \over \partial a_n}}+...+{k_n*{\partial out_n \over \partial a_n}}\\ \end{cases} ⎩⎪⎪⎪⎨⎪⎪⎪⎧​∂a1​∂out​=k1​∗∂a1​∂out1​​+k2​∗∂a1​∂out2​​+k3​∗∂a1​∂out3​​+...+kn​∗∂a1​∂outn​​∂a2​∂out​=k1​∗∂a2​∂out1​​+k2​∗∂a2​∂out2​​+k3​∗∂a2​∂out3​​+...+kn​∗∂a2​∂outn​​...∂an​∂out​=k1​∗∂an​∂out1​​+k2​∗∂an​∂out2​​+k3​∗∂an​∂out3​​+...+kn​∗∂an​∂outn​​​ 也可以理解成每个out分量对an求导时的权重。 对矩阵自动求导 现在，如果out是一个矩阵呢？ 下面的例子也可以理解为：相当于一个神经网络有两个样本，每个样本有两个属性，神经网络有两个输出。 import torch from torch.autograd import Variable from torch import nn a = Variable(torch.FloatTensor([[2,3],[1,2]]),requires_grad=True) w = Variable( torch.zeros(2,1),requires_grad=True ) out = torch.mm(a,w) out.backward(torch.FloatTensor([[1.],[1.]]),retain_graph=True) print(&quot;gradients are:{}&quot;.format(w.grad.data)) 如果前面的例子理解了，那么这个也很好理解，backward输入的参数k是一个2x1的矩阵，2代表的就是样本数量，就是在前面的基础上，再对每个样本进行加权求和。 结果是： 如果有兴趣，也可以拓展一下多个样本的多分类问题，猜一下k的维度应该是【输入样本的个数 * 分类的个数】 好啦，纠结我好久的pytorch自动求导原理算是彻底搞懂啦~~~" />
<link rel="canonical" href="https://mlh.app/2019/05/04/729850.html" />
<meta property="og:url" content="https://mlh.app/2019/05/04/729850.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-04T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"正常来说backward( )函数是要传入参数的，一直没弄明白backward需要传入的参数具体含义，但是没关系，生命在与折腾，咱们来折腾一下，嘿嘿。 对标量自动求导 首先，如果out.backward()中的out是一个标量的话（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有一个输出）那么此时我的backward函数是不需要输入任何参数的。 import torch from torch.autograd import Variable a = Variable(torch.Tensor([2,3]),requires_grad=True) b = a + 3 c = b * 3 out = c.mean() out.backward() print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data.item()) print(&#39;input gradients are:&#39;) print(a.grad) 运行结果： 不难看出，我们构建了这样的一个函数： o u t = 3 [ ( a 1 + 3 ) + ( a 2 + 3 ) ] 2 out={3[(a_1+3)+(a_2+3)]\\over2} out=23[(a1​+3)+(a2​+3)]​ 所以其求导也很容易看出： ∂ o u t ∂ a 1 = ∂ o u t ∂ a 2 = 3 2 {\\partial out \\over \\partial a_1}={\\partial out \\over \\partial a_2 }={3\\over2} ∂a1​∂out​=∂a2​∂out​=23​ 这是对其进行标量自动求导的结果. 对向量自动求导 如果out.backward()中的out是一个向量（或者理解成1xN的矩阵）的话，我们对向量进行自动求导，看看会发生什么？ 先构建这样的一个模型（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有两个输出）： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 b[0,1] = a[0,1] ** 3 out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,1.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 模型也很简单，不难看出out求导出来的雅克比应该是： ( ∂ o u t 1 ∂ a 1 = 4 a 1 ∂ o u t 1 ∂ a 2 = 0 ∂ o u t 2 ∂ a 1 = 0 ∂ o u t 2 ∂ a 2 = 6 a 2 2 ) \\begin{pmatrix} {\\partial out_1 \\over \\partial a_1}=4a_1&amp;amp;{\\partial out_1 \\over \\partial a_2}=0\\\\\\\\ {\\partial out_2 \\over \\partial a_1}=0&amp;amp;{\\partial out_2 \\over \\partial a_2}=6a_2^2\\\\\\\\ \\end{pmatrix} ⎝⎜⎜⎛​∂a1​∂out1​​=4a1​∂a1​∂out2​​=0​∂a2​∂out1​​=0∂a2​∂out2​​=6a22​​⎠⎟⎟⎞​ 因为a1 = 2，a2 = 4，所以上面的矩阵应该是: ( 8 0 0 96 ) \\begin{pmatrix} 8&amp;amp;0\\\\ 0&amp;amp;96\\\\ \\end{pmatrix} (80​096​) 运行的结果： 嗯，的确是8和96，但是仔细想一想，和咱们想要的雅克比矩阵的形式也不一样啊。难道是backward自动把0给省略了？ 咱们继续试试，这次在上一个模型的基础上进行小修改，如下： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,1.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 可以看出这个模型的雅克比应该是： ( ∂ o u t 1 ∂ a 1 = 4 a 1 ∂ o u t 1 ∂ a 2 = 2 ∂ o u t 2 ∂ a 1 = 2 ∂ o u t 2 ∂ a 2 = 6 a 2 2 ) \\begin{pmatrix} {\\partial out_1 \\over \\partial a_1}=4a_1&amp;amp;{\\partial out_1 \\over \\partial a_2}=2\\\\ \\\\ {\\partial out_2 \\over \\partial a_1}=2&amp;amp;{\\partial out_2 \\over \\partial a_2}=6a_2^2\\\\ \\end{pmatrix} ⎝⎛​∂a1​∂out1​​=4a1​∂a1​∂out2​​=2​∂a2​∂out1​​=2∂a2​∂out2​​=6a22​​⎠⎞​ 运行一下： 等等，什么鬼？正常来说不应该是 ( 8 2 2 96 ) \\begin{pmatrix} 8&amp;amp;2\\\\ 2&amp;amp;96\\\\ \\end{pmatrix} (82​296​)么？ 我是谁？我再哪？为什么就给我2个数，而且是 8 + 2 = 10 ，96 + 2 = 98 。难道都是加的 2 ？ 想一想，刚才咱们backward中传的参数是 [ [ 1 , 1 ] ]，难道安装这个关系对应求和了？ 咱们换个参数来试一试，程序中只更改传入的参数为[ [ 1 , 2 ] ]： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1.,2.]])) print(&#39;input:&#39;) print(a.data) print(&#39;output:&#39;) print(out.data) print(&#39;input gradients are:&#39;) print(a.grad) 嗯，这回可以理解了，我们传入的参数，是对原来模型正常求导出来的雅克比矩阵进行线性操作，可以把我们传进的参数（设为arg）看成一个列向量，那么我们得到的结果就是: ( M J a c o b o M a r g ) T {({M_{Jacobo}}{M_{arg}})}^T (MJacobo​Marg​)T 在这个题目中，我们得到的实际是： { 1 ∗ ∂ o u t 1 ∂ a 1 + 2 ∗ ∂ o u t 1 ∂ a 2 = 12 1 ∗ ∂ o u t 2 ∂ a 1 + 2 ∗ ∂ o u t 2 ∂ a 2 = 12 \\begin{cases} {1*{\\partial out_1 \\over \\partial a_1}}+{2*{\\partial out_1 \\over \\partial a_2}}=12\\\\\\\\ {1*{\\partial out_2 \\over \\partial a_1}}+{2*{\\partial out_2 \\over \\partial a_2}}=12\\\\ \\end{cases} ⎩⎪⎨⎪⎧​1∗∂a1​∂out1​​+2∗∂a2​∂out1​​=121∗∂a1​∂out2​​+2∗∂a2​∂out2​​=12​ 看起来一切完美的解释了，但是就在我刚刚打字的一刻，我意识到官方文档中说k.backward()传入的参数应该和k具有相同的维度，所以如果按上述去解释是解释不通的。 哪里出问题了呢？ 仔细看了一下，原来是这样的：在对雅克比矩阵进行线性操作的时候，应该把我们传进的参数（设为arg）看成一个行向量（不是列向量），那么我们得到的结果就是: ( M a r g M J a c o b o ) T {({M_{arg}}{M_{Jacobo}})}^T (Marg​MJacobo​)T 也就是： { 1 ∗ ∂ o u t 1 ∂ a 1 + 2 ∗ ∂ o u t 2 ∂ a 1 = 12 1 ∗ ∂ o u t 1 ∂ a 2 + 2 ∗ ∂ o u t 2 ∂ a 2 = 12 \\begin{cases} {1*{\\partial out_1 \\over \\partial a_1}}+{2*{\\partial out_2 \\over \\partial a_1}}=12\\\\\\\\ {1*{\\partial out_1 \\over \\partial a_2}}+{2*{\\partial out_2 \\over \\partial a_2}}=12\\\\ \\end{cases} ⎩⎪⎨⎪⎧​1∗∂a1​∂out1​​+2∗∂a1​∂out2​​=121∗∂a2​∂out1​​+2∗∂a2​∂out2​​=12​ 这回我们就解释的通了。 现在我们来输出一下雅克比矩阵吧，为了不引起歧义，我们让雅克比矩阵的每个数值都不一样（一开始分析错了就是因为雅克比矩阵中有相同的数据），所以模型小改动如下： import torch from torch.autograd import Variable a = Variable(torch.Tensor([[2.,4.]]),requires_grad=True) b = torch.zeros(1,2) b[0,0] = a[0,0] ** 2 + a[0,1] b[0,1] = a[0,1] ** 3 + a[0,0] * 2 out = 2 * b #其参数要传入和out维度一样的矩阵 out.backward(torch.FloatTensor([[1,0]]),retain_graph=True) A_temp = copy.deepcopy(a.grad) a.grad.zero_() out.backward(torch.FloatTensor([[0,1]])) B_temp = a.grad print(&#39;jacobian matrix is:&#39;) print(torch.cat( (A_temp,B_temp),0 )) 如果没问题的话咱们的雅克比矩阵应该是 [ [ 8 , 2 ] , [ 4 , 96 ] ] 好了，下面是见证奇迹的时刻了,不要眨眼睛奥，千万不要眨眼睛… 3 2 1 砰… 好了，现在总结一下：因为经过了复杂的神经网络之后，out中每个数值都是由很多输入样本的属性（也就是输入数据）线性或者非线性组合而成的，那么out中的每个数值和输入数据的每个数值都有关联，也就是说【out】中的每个数都可以对【a】中每个数求导，那么我们backward（）的参数[k1,k2,k3…kn]的含义就是： { ∂ o u t ∂ a 1 = k 1 ∗ ∂ o u t 1 ∂ a 1 + k 2 ∗ ∂ o u t 2 ∂ a 1 + k 3 ∗ ∂ o u t 3 ∂ a 1 + . . . + k n ∗ ∂ o u t n ∂ a 1 ∂ o u t ∂ a 2 = k 1 ∗ ∂ o u t 1 ∂ a 2 + k 2 ∗ ∂ o u t 2 ∂ a 2 + k 3 ∗ ∂ o u t 3 ∂ a 2 + . . . + k n ∗ ∂ o u t n ∂ a 2 . . . ∂ o u t ∂ a n = k 1 ∗ ∂ o u t 1 ∂ a n + k 2 ∗ ∂ o u t 2 ∂ a n + k 3 ∗ ∂ o u t 3 ∂ a n + . . . + k n ∗ ∂ o u t n ∂ a n \\begin{cases} {\\partial out \\over \\partial a_1}={k_1*{\\partial out_1 \\over \\partial a_1}}+{k_2*{\\partial out_2 \\over \\partial a_1}}+{k_3*{\\partial out_3 \\over \\partial a_1}}+...+{k_n*{\\partial out_n \\over \\partial a_1}}\\\\ {\\partial out \\over \\partial a_2}={k_1*{\\partial out_1 \\over \\partial a_2}}+{k_2*{\\partial out_2 \\over \\partial a_2}}+{k_3*{\\partial out_3 \\over \\partial a_2}}+...+{k_n*{\\partial out_n \\over \\partial a_2}}\\\\ ...\\\\ {\\partial out \\over \\partial a_n}={k_1*{\\partial out_1 \\over \\partial a_n}}+{k_2*{\\partial out_2 \\over \\partial a_n}}+{k_3*{\\partial out_3 \\over \\partial a_n}}+...+{k_n*{\\partial out_n \\over \\partial a_n}}\\\\ \\end{cases} ⎩⎪⎪⎪⎨⎪⎪⎪⎧​∂a1​∂out​=k1​∗∂a1​∂out1​​+k2​∗∂a1​∂out2​​+k3​∗∂a1​∂out3​​+...+kn​∗∂a1​∂outn​​∂a2​∂out​=k1​∗∂a2​∂out1​​+k2​∗∂a2​∂out2​​+k3​∗∂a2​∂out3​​+...+kn​∗∂a2​∂outn​​...∂an​∂out​=k1​∗∂an​∂out1​​+k2​∗∂an​∂out2​​+k3​∗∂an​∂out3​​+...+kn​∗∂an​∂outn​​​ 也可以理解成每个out分量对an求导时的权重。 对矩阵自动求导 现在，如果out是一个矩阵呢？ 下面的例子也可以理解为：相当于一个神经网络有两个样本，每个样本有两个属性，神经网络有两个输出。 import torch from torch.autograd import Variable from torch import nn a = Variable(torch.FloatTensor([[2,3],[1,2]]),requires_grad=True) w = Variable( torch.zeros(2,1),requires_grad=True ) out = torch.mm(a,w) out.backward(torch.FloatTensor([[1.],[1.]]),retain_graph=True) print(&quot;gradients are:{}&quot;.format(w.grad.data)) 如果前面的例子理解了，那么这个也很好理解，backward输入的参数k是一个2x1的矩阵，2代表的就是样本数量，就是在前面的基础上，再对每个样本进行加权求和。 结果是： 如果有兴趣，也可以拓展一下多个样本的多分类问题，猜一下k的维度应该是【输入样本的个数 * 分类的个数】 好啦，纠结我好久的pytorch自动求导原理算是彻底搞懂啦~~~","@type":"BlogPosting","url":"https://mlh.app/2019/05/04/729850.html","headline":"Pytorch中的自动求导函数backward()所需参数的含义","dateModified":"2019-05-04T00:00:00+08:00","datePublished":"2019-05-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/05/04/729850.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>Pytorch中的自动求导函数backward()所需参数的含义</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
  </svg> 
  <p>正常来说backward( )函数是要传入参数的，一直没弄明白backward需要传入的参数具体含义，但是没关系，生命在与折腾，咱们来折腾一下，嘿嘿。</p> 
  <h1><a id="_2"></a>对标量自动求导</h1> 
  <p>首先，如果out.backward()中的out是一个标量的话（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有一个输出）那么此时我的backward函数是不需要输入任何参数的。</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
    
a <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">3</span>
c <span class="token operator">=</span> b <span class="token operator">*</span> <span class="token number">3</span>
out <span class="token operator">=</span> c<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'output:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>data<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input gradients are:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
</code></pre> 
  <p>运行结果：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190504232107948.png" width="50%"><br> 不难看出，我们构建了这样的一个函数：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           o
          </mi>
          <mi>
           u
          </mi>
          <mi>
           t
          </mi>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mn>
             3
            </mn>
            <mo>
             [
            </mo>
            <mo>
             (
            </mo>
            <msub>
             <mi>
              a
             </mi>
             <mn>
              1
             </mn>
            </msub>
            <mo>
             +
            </mo>
            <mn>
             3
            </mn>
            <mo>
             )
            </mo>
            <mo>
             +
            </mo>
            <mo>
             (
            </mo>
            <msub>
             <mi>
              a
             </mi>
             <mn>
              2
             </mn>
            </msub>
            <mo>
             +
            </mo>
            <mn>
             3
            </mn>
            <mo>
             )
            </mo>
            <mo>
             ]
            </mo>
           </mrow>
           <mn>
            2
           </mn>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
          out={3[(a_1+3)+(a_2+3)]\over2}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">t</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.113em; vertical-align: -0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">3</span><span class="mopen">[</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></span><br> 所以其求导也很容易看出：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mfrac>
           <mrow>
            <mi mathvariant="normal">
             ∂
            </mi>
            <mi>
             o
            </mi>
            <mi>
             u
            </mi>
            <mi>
             t
            </mi>
           </mrow>
           <mrow>
            <mi mathvariant="normal">
             ∂
            </mi>
            <msub>
             <mi>
              a
             </mi>
             <mn>
              1
             </mn>
            </msub>
           </mrow>
          </mfrac>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi mathvariant="normal">
             ∂
            </mi>
            <mi>
             o
            </mi>
            <mi>
             u
            </mi>
            <mi>
             t
            </mi>
           </mrow>
           <mrow>
            <mi mathvariant="normal">
             ∂
            </mi>
            <msub>
             <mi>
              a
             </mi>
             <mn>
              2
             </mn>
            </msub>
           </mrow>
          </mfrac>
          <mo>
           =
          </mo>
          <mfrac>
           <mn>
            3
           </mn>
           <mn>
            2
           </mn>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
          {\partial out \over \partial a_1}={\partial out \over \partial a_2 }={3\over2} 
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.20744em; vertical-align: -0.836em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="margin-right: 0.05556em;">∂</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="margin-right: 0.05556em;">∂</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.20744em; vertical-align: -0.836em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="margin-right: 0.05556em;">∂</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="margin-right: 0.05556em;">∂</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.00744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></span><br> 这是对其进行标量自动求导的结果.</p> 
  <h1><a id="_28"></a>对向量自动求导</h1> 
  <p>如果out.backward()中的out是一个向量（或者理解成1xN的矩阵）的话，我们对向量进行自动求导，看看会发生什么？</p> 
  <p>先构建这样的一个模型（相当于一个神经网络有一个样本，这个样本有两个属性，神经网络有两个输出）：</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
    
a <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> 
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">3</span> 
out <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> b
<span class="token comment">#其参数要传入和out维度一样的矩阵</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'output:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input gradients are:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
</code></pre> 
  <p>模型也很简单，不难看出out求导出来的雅克比应该是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           (
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                4
               </mn>
               <msub>
                <mi>
                 a
                </mi>
                <mn>
                 1
                </mn>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                0
               </mn>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow></mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                0
               </mn>
              </mrow>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                6
               </mn>
               <msubsup>
                <mi>
                 a
                </mi>
                <mn>
                 2
                </mn>
                <mn>
                 2
                </mn>
               </msubsup>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow></mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
          <mo fence="true">
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{pmatrix} {\partial out_1 \over \partial a_1}=4a_1&amp;amp;{\partial out_1 \over \partial a_2}=0\\\\ {\partial out_2 \over \partial a_1}=0&amp;amp;{\partial out_2 \over \partial a_2}=6a_2^2\\\\ \end{pmatrix}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 5.08262em; vertical-align: -2.29131em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65003em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎝</span></span></span><span class="" style="top: -2.805em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎜</span></span></span><span class="" style="top: -3.40501em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎜</span></span></span><span class="" style="top: -4.65003em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.79131em;"><span class="" style="top: -4.8951em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">4</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"></span></span><span class="" style="top: -2.35379em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span></span></span><span class="" style="top: -1.06869em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.29131em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.79131em;"><span class="" style="top: -4.8951em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">0</span></span></span><span class="" style="top: -2.35379em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">6</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.45189em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.248108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.09131em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65003em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎠</span></span></span><span class="" style="top: -2.805em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎟</span></span></span><span class="" style="top: -3.40501em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎟</span></span></span><span class="" style="top: -4.65003em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p>因为a1 = 2，a2 = 4，所以上面的矩阵应该是:<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           (
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               8
              </mn>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               0
              </mn>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               0
              </mn>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               96
              </mn>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
          <mo fence="true">
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{pmatrix} 8&amp;amp;0\\ 0&amp;amp;96\\ \end{pmatrix}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">8</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">9</span><span class="mord">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></span><br> 运行的结果：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190504232542503.png" width="50%"><br> 嗯，的确是8和96，但是仔细想一想，和咱们想要的雅克比矩阵的形式也不一样啊。难道是backward自动把0给省略了？</p> 
  <p>咱们继续试试，这次在上一个模型的基础上进行小修改，如下：</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
    
a <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> 
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">3</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
out <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> b
<span class="token comment">#其参数要传入和out维度一样的矩阵</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'output:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input gradients are:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
</code></pre> 
  <p>可以看出这个模型的雅克比应该是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           (
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                4
               </mn>
               <msub>
                <mi>
                 a
                </mi>
                <mn>
                 1
                </mn>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                2
               </mn>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow></mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                2
               </mn>
              </mrow>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <msub>
                  <mi>
                   t
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mn>
                6
               </mn>
               <msubsup>
                <mi>
                 a
                </mi>
                <mn>
                 2
                </mn>
                <mn>
                 2
                </mn>
               </msubsup>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
          <mo fence="true">
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{pmatrix} {\partial out_1 \over \partial a_1}=4a_1&amp;amp;{\partial out_1 \over \partial a_2}=2\\ \\ {\partial out_2 \over \partial a_1}=2&amp;amp;{\partial out_2 \over \partial a_2}=6a_2^2\\ \end{pmatrix}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.88262em; vertical-align: -1.69131em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎝</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.19131em;"><span class="" style="top: -4.2951em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">4</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"></span></span><span class="" style="top: -1.75379em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.69131em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.19131em;"><span class="" style="top: -4.2951em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">2</span></span></span><span class="" style="top: -1.75379em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">6</span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.45189em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.248108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.69131em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎠</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br> 运行一下：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190504233917595.png" width="50%"><br> 等等，什么鬼？正常来说不应该是<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           (
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               8
              </mn>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               2
              </mn>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               2
              </mn>
             </mstyle>
            </mtd>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mn>
               96
              </mn>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
          <mo fence="true">
           )
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{pmatrix} 8&amp;amp;2\\ 2&amp;amp;96\\ \end{pmatrix} 
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">8</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">9</span><span class="mord">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></span>么？<br> 我是谁？我再哪？为什么就给我2个数，而且是 8 + 2 = 10 ，96 + 2 = 98 。难道都是加的 2 ？<br> 想一想，刚才咱们backward中传的参数是 [ [ 1 , 1 ] ]，难道安装这个关系对应求和了？<br> 咱们换个参数来试一试，程序中只更改传入的参数为[ [ 1 , 2 ] ]：</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
    
a <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> 
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">3</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
out <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> b
<span class="token comment">#其参数要传入和out维度一样的矩阵</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'output:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input gradients are:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
</code></pre> 
  <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190504234049744.png" width="50%"> 
  <p>嗯，这回可以理解了，我们传入的参数，是对原来模型正常求导出来的雅克比矩阵进行线性操作，可以把我们传进的参数（设为arg）看成一个列向量，那么我们得到的结果就是:<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msup>
          <mrow>
           <mo>
            (
           </mo>
           <msub>
            <mi>
             M
            </mi>
            <mrow>
             <mi>
              J
             </mi>
             <mi>
              a
             </mi>
             <mi>
              c
             </mi>
             <mi>
              o
             </mi>
             <mi>
              b
             </mi>
             <mi>
              o
             </mi>
            </mrow>
           </msub>
           <msub>
            <mi>
             M
            </mi>
            <mrow>
             <mi>
              a
             </mi>
             <mi>
              r
             </mi>
             <mi>
              g
             </mi>
            </mrow>
           </msub>
           <mo>
            )
           </mo>
          </mrow>
          <mi>
           T
          </mi>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         {({M_{Jacobo}}{M_{arg}})}^T
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.26734em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.09618em;">J</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">c</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">b</span><span class="mord mathit mtight">o</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathit mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.981231em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><br> 在这个题目中，我们得到的实际是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           {
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mrow>
                <mn>
                 1
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <mn>
                 2
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                =
               </mo>
               <mn>
                12
               </mn>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow></mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mrow>
                <mn>
                 1
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <mn>
                 2
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                =
               </mo>
               <mn>
                12
               </mn>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{cases} {1*{\partial out_1 \over \partial a_1}}+{2*{\partial out_1 \over \partial a_2}}=12\\\\ {1*{\partial out_2 \over \partial a_1}}+{2*{\partial out_2 \over \partial a_2}}=12\\ \end{cases} 
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 4.3462em; vertical-align: -1.9231em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.35002em;"><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.85002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.4231em;"><span class="" style="top: -4.4231em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mord">2</span></span></span><span class="" style="top: -2.97em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"></span></span><span class="" style="top: -1.53em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.9231em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 看起来一切完美的解释了，但是就在我刚刚打字的一刻，我意识到官方文档中说k.backward()传入的参数应该和k具有相同的维度，所以如果按上述去解释是解释不通的。<br> 哪里出问题了呢？</p> 
  <p>仔细看了一下，原来是这样的：在对雅克比矩阵进行线性操作的时候，应该把我们传进的参数（设为arg）看成一个行向量（不是列向量），那么我们得到的结果就是:<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msup>
          <mrow>
           <mo>
            (
           </mo>
           <msub>
            <mi>
             M
            </mi>
            <mrow>
             <mi>
              a
             </mi>
             <mi>
              r
             </mi>
             <mi>
              g
             </mi>
            </mrow>
           </msub>
           <msub>
            <mi>
             M
            </mi>
            <mrow>
             <mi>
              J
             </mi>
             <mi>
              a
             </mi>
             <mi>
              c
             </mi>
             <mi>
              o
             </mi>
             <mi>
              b
             </mi>
             <mi>
              o
             </mi>
            </mrow>
           </msub>
           <mo>
            )
           </mo>
          </mrow>
          <mi>
           T
          </mi>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         {({M_{arg}}{M_{Jacobo}})}^T
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.26734em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="mord mathit mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathit mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.09618em;">J</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">c</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">b</span><span class="mord mathit mtight">o</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.981231em;"><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><br> 也就是：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           {
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mrow>
                <mn>
                 1
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <mn>
                 2
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                =
               </mo>
               <mn>
                12
               </mn>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow></mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mrow>
                <mn>
                 1
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <mn>
                 2
                </mn>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                =
               </mo>
               <mn>
                12
               </mn>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{cases} {1*{\partial out_1 \over \partial a_1}}+{2*{\partial out_2 \over \partial a_1}}=12\\\\ {1*{\partial out_1 \over \partial a_2}}+{2*{\partial out_2 \over \partial a_2}}=12\\ \end{cases} 
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 4.3462em; vertical-align: -1.9231em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.35002em;"><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.85002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.4231em;"><span class="" style="top: -4.4231em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mord">2</span></span></span><span class="" style="top: -2.97em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"></span></span><span class="" style="top: -1.53em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.9231em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 这回我们就解释的通了。</p> 
  <p>现在我们来输出一下雅克比矩阵吧，为了不引起歧义，我们让雅克比矩阵的每个数值都不一样（一开始分析错了就是因为雅克比矩阵中有相同的数据），所以模型小改动如下：</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
    
a <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> 
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">3</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span>
out <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> b
<span class="token comment">#其参数要传入和out维度一样的矩阵</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>retain_graph<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
A_temp <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>a<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
B_temp <span class="token operator">=</span> a<span class="token punctuation">.</span>grad
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'jacobian matrix is:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span> <span class="token punctuation">(</span>A_temp<span class="token punctuation">,</span>B_temp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <p>如果没问题的话咱们的雅克比矩阵应该是 [ [ 8 , 2 ] , [ 4 , 96 ] ]</p> 
  <p>好了，下面是见证奇迹的时刻了,不要眨眼睛奥，千万不要眨眼睛…<br> 3<br> 2<br> 1<br> 砰…</p> 
  <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190504235043751.png" width="50%"> 
  <p>好了，现在总结一下：因为经过了复杂的神经网络之后，out中每个数值都是由很多输入样本的属性（也就是输入数据）线性或者非线性组合而成的，那么out中的每个数值和输入数据的每个数值都有关联，也就是说【out】中的每个数都可以对【a】中每个数求导，那么我们backward（）的参数[k1,k2,k3…kn]的含义就是：</p> 
  <p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           {
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <mi>
                  t
                 </mi>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   1
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  1
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  2
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  3
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    3
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mi>
                  n
                 </mi>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <mi>
                  t
                 </mi>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mn>
                   2
                  </mn>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  1
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  2
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  3
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    3
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mi>
                  n
                 </mi>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle scriptlevel="0" displaystyle="false">
              <mrow>
               <mfrac>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <mi>
                  o
                 </mi>
                 <mi>
                  u
                 </mi>
                 <mi>
                  t
                 </mi>
                </mrow>
                <mrow>
                 <mi mathvariant="normal">
                  ∂
                 </mi>
                 <msub>
                  <mi>
                   a
                  </mi>
                  <mi>
                   n
                  </mi>
                 </msub>
                </mrow>
               </mfrac>
               <mo>
                =
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  1
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  2
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    2
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mn>
                  3
                 </mn>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mn>
                    3
                   </mn>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
               <mo>
                +
               </mo>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mi mathvariant="normal">
                .
               </mi>
               <mo>
                +
               </mo>
               <mrow>
                <msub>
                 <mi>
                  k
                 </mi>
                 <mi>
                  n
                 </mi>
                </msub>
                <mo>
                 ∗
                </mo>
                <mfrac>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <mi>
                   o
                  </mi>
                  <mi>
                   u
                  </mi>
                  <msub>
                   <mi>
                    t
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                 <mrow>
                  <mi mathvariant="normal">
                   ∂
                  </mi>
                  <msub>
                   <mi>
                    a
                   </mi>
                   <mi>
                    n
                   </mi>
                  </msub>
                 </mrow>
                </mfrac>
               </mrow>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{cases} {\partial out \over \partial a_1}={k_1*{\partial out_1 \over \partial a_1}}+{k_2*{\partial out_2 \over \partial a_1}}+{k_3*{\partial out_3 \over \partial a_1}}+...+{k_n*{\partial out_n \over \partial a_1}}\\ {\partial out \over \partial a_2}={k_1*{\partial out_1 \over \partial a_2}}+{k_2*{\partial out_2 \over \partial a_2}}+{k_3*{\partial out_3 \over \partial a_2}}+...+{k_n*{\partial out_n \over \partial a_2}}\\ ...\\ {\partial out \over \partial a_n}={k_1*{\partial out_1 \over \partial a_n}}+{k_2*{\partial out_2 \over \partial a_n}}+{k_3*{\partial out_3 \over \partial a_n}}+...+{k_n*{\partial out_n \over \partial a_n}}\\ \end{cases} 
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 5.7993em; vertical-align: -2.64965em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.95002em;"><span class="" style="top: -1.59999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -1.59999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -1.89999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -2.19999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.60001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -4.90001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎪</span></span></span><span class="" style="top: -5.20002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.45002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.14965em;"><span class="" style="top: -5.14965em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span class="" style="top: -3.69655em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span class="" style="top: -2.24345em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span><span class="" style="top: -0.80345em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mathit mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03148em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.896208em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathit mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">u</span><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.64965em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 也可以理解成每个out分量对an求导时的权重。</p> 
  <h1><a id="_180"></a>对矩阵自动求导</h1> 
  <p>现在，如果out是一个矩阵呢？<br> 下面的例子也可以理解为：相当于一个神经网络有两个样本，每个样本有两个属性，神经网络有两个输出。</p> 
  <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn

a <span class="token operator">=</span> Variable<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
w <span class="token operator">=</span> Variable<span class="token punctuation">(</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">)</span>
out <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>a<span class="token punctuation">,</span>w<span class="token punctuation">)</span>
out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>retain_graph<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"gradients are:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <p>如果前面的例子理解了，那么这个也很好理解，backward输入的参数k是一个2x1的矩阵，2代表的就是样本数量，就是在前面的基础上，再对每个样本进行加权求和。<br> 结果是：</p> 
  <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190504235237319.png" width="50%"> 
  <p>如果有兴趣，也可以拓展一下多个样本的多分类问题，猜一下k的维度应该是【输入样本的个数 * 分类的个数】</p> 
  <p>好啦，纠结我好久的pytorch自动求导原理算是彻底搞懂啦~~~</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-258a4616f7.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

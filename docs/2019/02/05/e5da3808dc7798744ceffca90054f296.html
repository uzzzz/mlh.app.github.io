<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用Python和Mask R-CNN自动寻找停车位，这是什么神操作？ | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用Python和Mask R-CNN自动寻找停车位，这是什么神操作？" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="机器之心编译 作者想用深度学习来解决一个小麻烦，于是用 Python 和 Mask R-CNN 设计了一个模型。该模型可以自动检测停车位并在发现可用车位后向他发送短信。这是什么神仙（sao）操作？ 我居住在一个大城市。但是和在很多大城市一样，找个停车位总没那么容易。车位很快就被抢占一空，即使你有一个属于自己的专用车位，朋友们顺路来访也很难，因为他们找不到车位。 我的解决方案就是将一个摄像头伸出窗外，再用深度学习让我的计算机在有车位空出来的时候给我发短信： 这听起来也许很复杂，但是借助深度学习构建一个实用的版本实际上又简单又快。所有的工具都是可用的——你只要知道去哪儿找到工具并把它们组合在一起就行。 那么，我们花点时间用 python 和深度学习构建一个高准确率的停车位通知系统吧！ 问题分解 当我们面临想要用机器学习解决的复杂问题时，第一步就是将问题分解成若干简单问题。然后，使用详细分解作为指导，我们可以从机器学习工具箱中使用不同的工具来解决这些小问题。通过将几个不同的解决方案链接到一个流程中，我们就得到了能够做一些复杂事情的系统。 下面是我分解的空车位检测流程： 机器学习流程的输入是来自一个伸出窗外的普通网络摄像头的视频流： 从摄像头中截取的示例视频 我们将通过工作流程传送每一帧视频，一次一帧。 这个流程的第一步就是检测一帧视频中所有可能的停车位。显然，在我们能够检测哪个是没有被占用的停车位之前，我们需要知道图像中的哪些部分是停车位。 第二步就是检测每帧视频中的所有车辆。这样我们可以逐帧跟踪每辆车的运动。 第三步就是确定哪些车位目前是被占用的，哪些没有。这需要结合前两步的结果。 最后一步就是出现新车位时通知我。这需要基于视频中两帧之间车辆位置的变化。 这里的每一步，我们都可以使用多种技术用很多种方式实现。构建这个流程并没有唯一正确或者错误的方式，但不同的方法会有优劣之分。 第一步：检测一幅图像中的停车位 摄像头的视野是这样的： 我们需要扫描这幅图，然后返回一个有效停车区域列表，就像这样： 这个城市街道上的有效停车位。 一种比较懒的方法就是手动把每个停车位的位置硬编码到程序中，而不是自动检测停车位。但是如果我们移动了摄像头或者想要检测另一条街道上的车位时，就必须再一次手动硬编码车位的位置。这样很麻烦，还是找一种自动检测车位的方法吧。 一个思路是寻找停车计时器并假设每个计时器旁边都有一个停车位： 检测每幅图像中的停车计时器。 但这种方法有些复杂。首先，并非每个停车位都有停车计时器——实际上，我们最喜欢找的是无需付费的车位！其次，只知道停车计时器的位置并不能确切地告诉我们停车位的确切位置。它只是让我们更加接近停车位罢了。 另一个思路就是构建目标检测模型，让它寻找道路上绘制的停车位标志，就像这样： 请注意这些黄色的小标志——它们就是画在道路上的每个车位的边界。 但是这种方法也很令人痛苦。首先，我所在城市的停车位标志线特别小，在这么远的距离很难看见，所以很难用计算机检测到它们。其次，道路上有各种无关的线和标志。很难区分哪些线是停车位标志，哪些是车道分离线或者人行道线。 当你遇到似乎很困难的问题时，花几分钟时间想一想，你是否可以采用不同的方法来解决这个问题，避开一些技术性挑战。到底什么是停车位？停车位不就是车辆可以停放很长时间的地方吗。所以，也许我们根本就没必要去检测停车位。为何不能仅仅检测长时间没有移动的车辆并且假设它们就停在停车位呢？ 换句话说，有效停车位就是包含非移动车辆的地方。 这里，每辆车的边界框实际上就是一个停车位！如果我们能够检测静态的车辆，就没必要检测停车位。 所以，如果我们能够检测车辆，并且可以判断哪些车辆在视频帧中是没有移动的，那我们就能够推测出停车位的位置。够简单了——让我们来检测车辆吧！ 检测图像中的车辆 检测视频帧里的车辆就是目标检测中的一道练习题。我们可以用很多机器学习方法来检测图像中的目标。下面是我列出的几种最常用的目标检测算法： 训练一个 HOG(方向梯度直方图) 目标检测器，并用它滑过我们的图像以寻找所有的车辆。这个古老的非深度学习方法运行起来相当快，但是它并不能很好地处理向不同方向移动的车辆。 训练一个 CNN(卷积神经网络) 目标检测器，用它滑过我们的图像直到找到所有的车辆。这种方法很准确，但并不是很高效，因为我们必须多次扫描同一张图像来寻找所有的车辆。并且，虽然它可以轻易找到向不同方向移动的车辆，但它需要的训练数据要比 HOG 目标检测器多得多。 使用更新的深度学习方法，如 Mask R-CNN、Faster R-CNN 或者 YOLO。它们将灵活的设计和高效的技巧与 CNN 的准确性结合在了一起，能够极大地加速检测过程。只要我们有足够多的数据来训练模型，它能在 GPU 上运行地相对快一些。 通常情况下，我们希望选择最简单的方法来解决问题，使用最少的训练数据，并不认为需要最新、最流行的算法。但是在这个特殊的情况下，*Mask R-CNN*是一个比较合理的选择，虽然它是一个比较新、比较流行的算法。 Mask R-CNN 架构在不使用滑动窗口的情况下以一种高效的计算方式在整幅图像中检测目标。换句话说，它运行得相当快。在具有比较先进的 GPU 时，我们应该能够以数帧每秒的速度检测到高分辨率视频中的目标。所以它应该比较适合这个项目。 此外，Mask R-CNN 给我们提供了很多关于每个检测对象的信息。绝大多数目标检测算法仅仅返回了每个对象的边界框。但是 Mask R-CNN 并不会仅仅给我们提供每个对象的位置，它还会给出每个对象的轮廓 (掩模)，就像这样： 为了训练 Mask R-CNN，我们需要大量关于需要检测的目标的图像。我们可以拍一些车辆的图像，然后将这些图像中的汽车标注出来，但是这可能会花费几天的工作。幸运的是，汽车是很常见的检测目标，很多人都想检测，因此早就有了几个公开的汽车数据集。 有一个很流行的数据集叫做 COCO，它里面的图像都用目标掩膜标注过。在这个数据集中，已经有超过 12000 张汽车图像做好了轮廓标注。下面就是 COCO 数据集中的一张图像。 COCO 数据集中已标注轮廓的图像。 这个数据集非常适合用来训练 Mask R-CNN 模型。 使用 COCO 数据集来构建目标检测数据集是很常见的一件事情，所以好多人已经做过并且分享了他们的结果。因此，我们可以用一个训练好的模型作为开始，而不用从头去训练自己的模型。针对这个项目，我们可以使用很棒的开源 Mask R-CNN，它是由 Matterport 公司实现的，还提供了训练好的模型。 地址：https://github.com/matterport/Mask_RCNN 旁注：你不必为训练定制化的 Mask R-CNN 而担心！标注数据是很耗时间的，但是并不困难。如果你想使用自己的数据完整地训练 Mask R-CNN 模型，可以参考这本书： https://www.machinelearningisfun.com/get-the-book 如果在我自己的相机图像上运行预训练模型，以下是检测结果： 经过 COCO 默认目标识别的图像——车辆、人、交通信号灯和树。 我们不仅识别了车辆，还识别出了交通信号灯和人。而且比较滑稽的是，它将其中的一棵树识别成了「盆栽植物」。 对于图像中被检测到的每一个目标，我们从 Mask R-CNN 模型中得到了下面四个结果： 被检测到的目标（作为整数）类型。预训练的 COCO 模型知道如何检测 80 种不同的常见目标，例如汽车和卡车。 目标检测的置信得分。这个数字越大，越说明模型准确识别了目标。 中目标的边界框，以 X/Y 像素位置地形式给了出来。 位图「掩模」，能够分辨出边界框里哪些像素是目标的一部分，哪些不是。有了掩模数据，我们也可以标注目标的轮廓。 下面是 python 代码，用于根据 Matterport』s Mask R-CNN 实现和 OpneCV 预训练的模型来检测汽车边界框： import&nbsp;osimport&nbsp;numpy&nbsp;as&nbsp;npimport&nbsp;cv2import&nbsp;mrcnn.configimport&nbsp;mrcnn.utilsfrom&nbsp;mrcnn.model&nbsp;import&nbsp;MaskRCNNfrom&nbsp;pathlib&nbsp;import&nbsp;Path#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;libraryclass&nbsp;MaskRCNNConfig(mrcnn.config.Config):&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;&quot;coco_pretrained_model_config&quot;&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;1&nbsp;+&nbsp;80&nbsp;&nbsp;#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;0.6#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucksdef&nbsp;get_car_boxes(boxes,&nbsp;class_ids):&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;box&nbsp;in&nbsp;enumerate(boxes):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_ids[i]&nbsp;in&nbsp;[3,&nbsp;8,&nbsp;6]:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array(car_boxes)#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;projectROOT_DIR&nbsp;=&nbsp;Path(&quot;.&quot;)#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;modelMODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;logs&quot;)#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;fileCOCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;mask_rcnn_coco.h5&quot;)#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;neededif&nbsp;not&nbsp;os.path.exists(COCO_MODEL_PATH):&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;onIMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;images&quot;)#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;fileVIDEO_SOURCE&nbsp;=&nbsp;&quot;test_images/parking.mp4&quot;#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;modemodel&nbsp;=&nbsp;MaskRCNN(mode=&quot;inference&quot;,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())#&nbsp;Load&nbsp;pre-trained&nbsp;modelmodel.load_weights(COCO_MODEL_PATH,&nbsp;by_name=True)#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spacesparked_car_boxes&nbsp;=&nbsp;None#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;onvideo_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;videowhile&nbsp;video_capture.isOpened():&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::-1]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=0)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[0]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:&quot;)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Draw&nbsp;each&nbsp;box&nbsp;on&nbsp;the&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;box&nbsp;in&nbsp;car_boxes:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Car:&nbsp;&quot;,&nbsp;box)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Draw&nbsp;the&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow( Video ,&nbsp;frame)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;cv2.waitKey(1)&nbsp;&amp;&nbsp;0xFF&nbsp;==&nbsp;ord( q ):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finishedvideo_capture.release()cv2.destroyAllWindows() 当你运行这段脚本时，会在屏幕上得到一幅图，每辆检测到的汽车都有一个边界框，像这样： 每辆检测到的汽车都有一个绿色的边界框。 你还会看到被检测到的汽车坐标被打印在了控制台上，就像这样： Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:Car:&nbsp;&nbsp;[492&nbsp;871&nbsp;551&nbsp;961]Car:&nbsp;&nbsp;[450&nbsp;819&nbsp;509&nbsp;913]Car:&nbsp;&nbsp;[411&nbsp;774&nbsp;470&nbsp;856] 经过以上这些步骤，我们已经成功地检测到了图像中的汽车。 检测空置的停车位 我们知道了每张图像中每辆车的像素位置。通过查看视频中按顺序出现的多帧，我们可以轻易知道哪些车没有动，并且假设它们所在的位置就是车位。但是，当一辆车离开车位的时候，我们如何检测得到呢？ 问题在于我们图像中的边界框是部分重叠的。 即使是在不同车位中的车辆，每辆车的边界框都会有一小部分的重叠。 所以，如果我们假设每个边界框代表一个车位，那么，即使车位是空的，也有可能显示为被部分占用。我们需要一个方法来测量两个对象的重叠度，以便检查「大部分是空的」边界框。 我们将要使用的测量方法为交并比（IoU）。IoU 通过两个对象重叠的像素数量除以两个对象覆盖的像素数量计算得到。像这样： 这将为我们提供汽车边界框与停车位边界框重叠的程度。有了这个，我们可以轻易确定汽车是否在停车位。如果 IoU 测量值很低，如 0.15，那意味着汽车并没有真正占用大部分停车位。但如果指标很高，如 0.6，这意味着汽车占据了大部分停车位区域，因此我们可以确定该空间被占用。 由于 IoU 是计算机视觉中常见的测量方法，因此你在使用的库通常已经实现了它的计算。事实上，Matterport Mask R-CNN 库将它作为一个名为 mrcnn.utils.compute_overlaps（）的函数包含在内，因此我们可以直接使用该函数。 假设我们有一个表示图像中停车区域的边界框列表，查看检测到的车辆是否在这些边界框内就像添加一行或两行代码一样简单： #&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;how&nbsp;much&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(car_boxes,&nbsp;parking_areas)&nbsp;&nbsp;&nbsp;&nbsp;print(overlaps) 结果是这样子的： [&nbsp;[1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.07040032&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.]&nbsp;[0.07040032&nbsp;1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.07673165&nbsp;0.]&nbsp;[0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.02332112&nbsp;0.]]In&nbsp;that&nbsp;2D&nbsp;array,&nbsp;each 在这个二维数组中，每一行代表一个停车位的边界框。同样，每一列代表着这个停车位被检测到的汽车占用了多少。1.0 分表示完全被占用，较低的分，如 0.02 则表示这辆汽车接触到了车位的空间，但是并没有占据大部分区域。 要寻找未被占用的停车位，我们只需要检查此阵列中的每一行。如果所有数字都为零或非常小，那意味着没有任何东西占据那个空间，它就是空着的！ 但请记住，目标检测并非总是与实时视频完美配合。即使 Mask R-CNN 非常准确，偶尔也会在单帧视频中错过一两辆车。因此，在将停车位标记为空闲之前，我们应该确保它在一段时间内保持空闲 - 可能是 5 或 10 个连续的视频帧。这将防止系统仅仅因为目标检测在一帧视频上有短暂的停顿就错误地检测到空闲的停车位。但是，只要我们看到至少有一个空闲停车位出现在连续几帧视频中，我们就可以发送短信了！ 发送短信 这个项目的最后一步就是当检测到一个空闲停车位出现在视频的连续几帧中时就发送短信提醒。 使用 Twilio 从 Python 中发送短信很简单。Twilio 是一个很流行的 API，它可以让你用任何编程语言只需几行代码就可以发送短信。当然，如果你更喜欢使用其它短信服务提供商，也可以。我和 Twilio 并没有利益关系。它只是我想到的第一个工具而已。 要使用 Twilio，你需要注册一个试用账户，创建两个 Twilio 电话号码，然后认证账户。然后，你需要安装 Twilio Python 客户端。 pip3&nbsp;install&nbsp;twilio 安装完成后，这是用 Python 发送短信的完整代码（只需用你自己的帐户详细信息替换这些值即可）： from&nbsp;twilio.rest&nbsp;import&nbsp;Client#&nbsp;Twilio&nbsp;account&nbsp;detailstwilio_account_sid&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;SID&nbsp;here twilio_auth_token&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;Auth&nbsp;Token&nbsp;here twilio_source_phone_number&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;phone&nbsp;number&nbsp;here #&nbsp;Create&nbsp;a&nbsp;Twilio&nbsp;client&nbsp;object&nbsp;instanceclient&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)#&nbsp;Send&nbsp;an&nbsp;SMSmessage&nbsp;=&nbsp;client.messages.create(&nbsp;&nbsp;&nbsp;&nbsp;body=&quot;This&nbsp;is&nbsp;my&nbsp;SMS&nbsp;message!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_source_phone_number,&nbsp;&nbsp;&nbsp;&nbsp;to=&quot;Destination&nbsp;phone&nbsp;number&nbsp;here&quot;) 为了在脚本中添加短信发送功能，我们可以把这些代码丢进去。但需要注意的是，我们并不需要在每一个有空闲车位的新视频帧中发送短信。所以我们需要一个标志来跟踪是否已经发过短信了，这是为了保证不会在短期内再次发送或者在新车位空出来之前再次发送。 总结 将以上流程中的所有步骤整合在一起，构成一个独立的 Python 脚本，完整代码如下所示： import&nbsp;osimport&nbsp;numpy&nbsp;as&nbsp;npimport&nbsp;cv2import&nbsp;mrcnn.configimport&nbsp;mrcnn.utilsfrom&nbsp;mrcnn.model&nbsp;import&nbsp;MaskRCNNfrom&nbsp;pathlib&nbsp;import&nbsp;Pathfrom&nbsp;twilio.rest&nbsp;import&nbsp;Client#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;libraryclass&nbsp;MaskRCNNConfig(mrcnn.config.Config):&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;&quot;coco_pretrained_model_config&quot;&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;1&nbsp;+&nbsp;80&nbsp;&nbsp;#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;0.6#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucksdef&nbsp;get_car_boxes(boxes,&nbsp;class_ids):&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;box&nbsp;in&nbsp;enumerate(boxes):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_ids[i]&nbsp;in&nbsp;[3,&nbsp;8,&nbsp;6]:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array(car_boxes)#&nbsp;Twilio&nbsp;configtwilio_account_sid&nbsp;=&nbsp; YOUR_TWILIO_SID twilio_auth_token&nbsp;=&nbsp; YOUR_TWILIO_AUTH_TOKEN twilio_phone_number&nbsp;=&nbsp; YOUR_TWILIO_SOURCE_PHONE_NUMBER destination_phone_number&nbsp;=&nbsp; THE_PHONE_NUMBER_TO_TEXT client&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;projectROOT_DIR&nbsp;=&nbsp;Path(&quot;.&quot;)#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;modelMODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;logs&quot;)#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;fileCOCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;mask_rcnn_coco.h5&quot;)#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;neededif&nbsp;not&nbsp;os.path.exists(COCO_MODEL_PATH):&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;onIMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;images&quot;)#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;fileVIDEO_SOURCE&nbsp;=&nbsp;&quot;test_images/parking.mp4&quot;#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;modemodel&nbsp;=&nbsp;MaskRCNN(mode=&quot;inference&quot;,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())#&nbsp;Load&nbsp;pre-trained&nbsp;modelmodel.load_weights(COCO_MODEL_PATH,&nbsp;by_name=True)#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spacesparked_car_boxes&nbsp;=&nbsp;None#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;onvideo_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)#&nbsp;How&nbsp;many&nbsp;frames&nbsp;of&nbsp;video&nbsp;we ve&nbsp;seen&nbsp;in&nbsp;a&nbsp;row&nbsp;with&nbsp;a&nbsp;parking&nbsp;space&nbsp;openfree_space_frames&nbsp;=&nbsp;0#&nbsp;Have&nbsp;we&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;alert&nbsp;yet?sms_sent&nbsp;=&nbsp;False#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;videowhile&nbsp;video_capture.isOpened():&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::-1]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=0)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[0]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;parked_car_boxes&nbsp;is&nbsp;None:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;the&nbsp;first&nbsp;frame&nbsp;of&nbsp;video&nbsp;-&nbsp;assume&nbsp;all&nbsp;the&nbsp;cars&nbsp;detected&nbsp;are&nbsp;in&nbsp;parking&nbsp;spaces.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Save&nbsp;the&nbsp;location&nbsp;of&nbsp;each&nbsp;car&nbsp;as&nbsp;a&nbsp;parking&nbsp;space&nbsp;box&nbsp;and&nbsp;go&nbsp;to&nbsp;the&nbsp;next&nbsp;frame&nbsp;of&nbsp;video.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parked_car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;already&nbsp;know&nbsp;where&nbsp;the&nbsp;parking&nbsp;spaces&nbsp;are.&nbsp;Check&nbsp;if&nbsp;any&nbsp;are&nbsp;currently&nbsp;unoccupied.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;where&nbsp;cars&nbsp;are&nbsp;currently&nbsp;located&nbsp;in&nbsp;the&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;how&nbsp;much&nbsp;those&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(parked_car_boxes,&nbsp;car_boxes)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Assume&nbsp;no&nbsp;spaces&nbsp;are&nbsp;free&nbsp;until&nbsp;we&nbsp;find&nbsp;one&nbsp;that&nbsp;is&nbsp;free&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;False&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Loop&nbsp;through&nbsp;each&nbsp;known&nbsp;parking&nbsp;space&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;parking_area,&nbsp;overlap_areas&nbsp;in&nbsp;zip(parked_car_boxes,&nbsp;overlaps):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;For&nbsp;this&nbsp;parking&nbsp;space,&nbsp;find&nbsp;the&nbsp;max&nbsp;amount&nbsp;it&nbsp;was&nbsp;covered&nbsp;by&nbsp;any&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;car&nbsp;that&nbsp;was&nbsp;detected&nbsp;in&nbsp;our&nbsp;image&nbsp;(doesn t&nbsp;really&nbsp;matter&nbsp;which&nbsp;car)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_IoU_overlap&nbsp;=&nbsp;np.max(overlap_areas)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;the&nbsp;top-left&nbsp;and&nbsp;bottom-right&nbsp;coordinates&nbsp;of&nbsp;the&nbsp;parking&nbsp;area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;parking_area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;if&nbsp;the&nbsp;parking&nbsp;space&nbsp;is&nbsp;occupied&nbsp;by&nbsp;seeing&nbsp;if&nbsp;any&nbsp;car&nbsp;overlaps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;it&nbsp;by&nbsp;more&nbsp;than&nbsp;0.15&nbsp;using&nbsp;IoU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;max_IoU_overlap&nbsp;&lt;&nbsp;0.15:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parking&nbsp;space&nbsp;not&nbsp;occupied!&nbsp;Draw&nbsp;a&nbsp;green&nbsp;box&nbsp;around&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Flag&nbsp;that&nbsp;we&nbsp;have&nbsp;seen&nbsp;at&nbsp;least&nbsp;one&nbsp;open&nbsp;space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parking&nbsp;space&nbsp;is&nbsp;still&nbsp;occupied&nbsp;-&nbsp;draw&nbsp;a&nbsp;red&nbsp;box&nbsp;around&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;0,&nbsp;255),&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Write&nbsp;the&nbsp;IoU&nbsp;measurement&nbsp;inside&nbsp;the&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;f&quot;{max_IoU_overlap:0.2}&quot;,&nbsp;(x1&nbsp;+&nbsp;6,&nbsp;y2&nbsp;-&nbsp;6),&nbsp;font,&nbsp;0.3,&nbsp;(255,&nbsp;255,&nbsp;255))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;at&nbsp;least&nbsp;one&nbsp;space&nbsp;was&nbsp;free,&nbsp;start&nbsp;counting&nbsp;frames&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;so&nbsp;we&nbsp;don t&nbsp;alert&nbsp;based&nbsp;on&nbsp;one&nbsp;frame&nbsp;of&nbsp;a&nbsp;spot&nbsp;being&nbsp;open.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;helps&nbsp;prevent&nbsp;the&nbsp;script&nbsp;triggered&nbsp;on&nbsp;one&nbsp;bad&nbsp;detection.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;free_space:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;+=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;no&nbsp;spots&nbsp;are&nbsp;free,&nbsp;reset&nbsp;the&nbsp;count&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;=&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;a&nbsp;space&nbsp;has&nbsp;been&nbsp;free&nbsp;for&nbsp;several&nbsp;frames,&nbsp;we&nbsp;are&nbsp;pretty&nbsp;sure&nbsp;it&nbsp;is&nbsp;really&nbsp;free!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;free_space_frames&nbsp;&gt;&nbsp;10:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Write&nbsp;SPACE&nbsp;AVAILABLE!!&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;f&quot;SPACE&nbsp;AVAILABLE!&quot;,&nbsp;(10,&nbsp;150),&nbsp;font,&nbsp;3.0,&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;2,&nbsp;cv2.FILLED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;we&nbsp;haven t&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;yet,&nbsp;sent&nbsp;it!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;sms_sent:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;SENDING&nbsp;SMS!!!&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;client.messages.create(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body=&quot;Parking&nbsp;space&nbsp;open&nbsp;-&nbsp;go&nbsp;go&nbsp;go!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_phone_number,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to=destination_phone_number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sms_sent&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow( Video ,&nbsp;frame)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;cv2.waitKey(1)&nbsp;&amp;&nbsp;0xFF&nbsp;==&nbsp;ord( q ):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finishedvideo_capture.release()cv2.destroyAllWindows() 要运行这份代码，你首先需要安装 python 3.6+，Matterport Mask R-CNN 以及 OpenCV。 我特意保留了比较简单的代码。例如，它只是假设第一帧视频中出现的任何车辆都是停放的汽车。试用一下，看看你是否能够提升它的可用性。 不必担心为了在其它场景中使用而修改代码。仅仅改变模型寻找的目标 ID，你就能够将这份代码完全转换成另一个东西。例如，假设你在滑雪场工作。经过一些调整，你就可以将这份脚本转换为一个系统，它可以自动检测滑雪板从斜坡上跳越，并创建出很酷的滑雪板跳越路线。或者如果你在野生动物保护区工作，你可以将这份代码转换成一个统计野生斑马数量的系统。唯一的限制只是你的想象力。祝你玩得开心！ 推荐阅读 人大、华中科大、西安交大等四所高校成立AI学院，国内高校AI学院已达38所 《AI世界生存指南》 「击败星际争霸II职业玩家」的 AlphaStar是在作弊？ 7 步快速入门 Python3 “一人单挑&amp;nbsp;BAT”，黑客张福：我要的东西，比钱更贵 同一天这是巧合吗？吴恩达、谷歌、Facebook纷纷开源数据集 21个GIF动图让你了解各种数学概念 微信真要做操作系统了？ 下载最新教程《ArtificalNeuralNetworks》" />
<meta property="og:description" content="机器之心编译 作者想用深度学习来解决一个小麻烦，于是用 Python 和 Mask R-CNN 设计了一个模型。该模型可以自动检测停车位并在发现可用车位后向他发送短信。这是什么神仙（sao）操作？ 我居住在一个大城市。但是和在很多大城市一样，找个停车位总没那么容易。车位很快就被抢占一空，即使你有一个属于自己的专用车位，朋友们顺路来访也很难，因为他们找不到车位。 我的解决方案就是将一个摄像头伸出窗外，再用深度学习让我的计算机在有车位空出来的时候给我发短信： 这听起来也许很复杂，但是借助深度学习构建一个实用的版本实际上又简单又快。所有的工具都是可用的——你只要知道去哪儿找到工具并把它们组合在一起就行。 那么，我们花点时间用 python 和深度学习构建一个高准确率的停车位通知系统吧！ 问题分解 当我们面临想要用机器学习解决的复杂问题时，第一步就是将问题分解成若干简单问题。然后，使用详细分解作为指导，我们可以从机器学习工具箱中使用不同的工具来解决这些小问题。通过将几个不同的解决方案链接到一个流程中，我们就得到了能够做一些复杂事情的系统。 下面是我分解的空车位检测流程： 机器学习流程的输入是来自一个伸出窗外的普通网络摄像头的视频流： 从摄像头中截取的示例视频 我们将通过工作流程传送每一帧视频，一次一帧。 这个流程的第一步就是检测一帧视频中所有可能的停车位。显然，在我们能够检测哪个是没有被占用的停车位之前，我们需要知道图像中的哪些部分是停车位。 第二步就是检测每帧视频中的所有车辆。这样我们可以逐帧跟踪每辆车的运动。 第三步就是确定哪些车位目前是被占用的，哪些没有。这需要结合前两步的结果。 最后一步就是出现新车位时通知我。这需要基于视频中两帧之间车辆位置的变化。 这里的每一步，我们都可以使用多种技术用很多种方式实现。构建这个流程并没有唯一正确或者错误的方式，但不同的方法会有优劣之分。 第一步：检测一幅图像中的停车位 摄像头的视野是这样的： 我们需要扫描这幅图，然后返回一个有效停车区域列表，就像这样： 这个城市街道上的有效停车位。 一种比较懒的方法就是手动把每个停车位的位置硬编码到程序中，而不是自动检测停车位。但是如果我们移动了摄像头或者想要检测另一条街道上的车位时，就必须再一次手动硬编码车位的位置。这样很麻烦，还是找一种自动检测车位的方法吧。 一个思路是寻找停车计时器并假设每个计时器旁边都有一个停车位： 检测每幅图像中的停车计时器。 但这种方法有些复杂。首先，并非每个停车位都有停车计时器——实际上，我们最喜欢找的是无需付费的车位！其次，只知道停车计时器的位置并不能确切地告诉我们停车位的确切位置。它只是让我们更加接近停车位罢了。 另一个思路就是构建目标检测模型，让它寻找道路上绘制的停车位标志，就像这样： 请注意这些黄色的小标志——它们就是画在道路上的每个车位的边界。 但是这种方法也很令人痛苦。首先，我所在城市的停车位标志线特别小，在这么远的距离很难看见，所以很难用计算机检测到它们。其次，道路上有各种无关的线和标志。很难区分哪些线是停车位标志，哪些是车道分离线或者人行道线。 当你遇到似乎很困难的问题时，花几分钟时间想一想，你是否可以采用不同的方法来解决这个问题，避开一些技术性挑战。到底什么是停车位？停车位不就是车辆可以停放很长时间的地方吗。所以，也许我们根本就没必要去检测停车位。为何不能仅仅检测长时间没有移动的车辆并且假设它们就停在停车位呢？ 换句话说，有效停车位就是包含非移动车辆的地方。 这里，每辆车的边界框实际上就是一个停车位！如果我们能够检测静态的车辆，就没必要检测停车位。 所以，如果我们能够检测车辆，并且可以判断哪些车辆在视频帧中是没有移动的，那我们就能够推测出停车位的位置。够简单了——让我们来检测车辆吧！ 检测图像中的车辆 检测视频帧里的车辆就是目标检测中的一道练习题。我们可以用很多机器学习方法来检测图像中的目标。下面是我列出的几种最常用的目标检测算法： 训练一个 HOG(方向梯度直方图) 目标检测器，并用它滑过我们的图像以寻找所有的车辆。这个古老的非深度学习方法运行起来相当快，但是它并不能很好地处理向不同方向移动的车辆。 训练一个 CNN(卷积神经网络) 目标检测器，用它滑过我们的图像直到找到所有的车辆。这种方法很准确，但并不是很高效，因为我们必须多次扫描同一张图像来寻找所有的车辆。并且，虽然它可以轻易找到向不同方向移动的车辆，但它需要的训练数据要比 HOG 目标检测器多得多。 使用更新的深度学习方法，如 Mask R-CNN、Faster R-CNN 或者 YOLO。它们将灵活的设计和高效的技巧与 CNN 的准确性结合在了一起，能够极大地加速检测过程。只要我们有足够多的数据来训练模型，它能在 GPU 上运行地相对快一些。 通常情况下，我们希望选择最简单的方法来解决问题，使用最少的训练数据，并不认为需要最新、最流行的算法。但是在这个特殊的情况下，*Mask R-CNN*是一个比较合理的选择，虽然它是一个比较新、比较流行的算法。 Mask R-CNN 架构在不使用滑动窗口的情况下以一种高效的计算方式在整幅图像中检测目标。换句话说，它运行得相当快。在具有比较先进的 GPU 时，我们应该能够以数帧每秒的速度检测到高分辨率视频中的目标。所以它应该比较适合这个项目。 此外，Mask R-CNN 给我们提供了很多关于每个检测对象的信息。绝大多数目标检测算法仅仅返回了每个对象的边界框。但是 Mask R-CNN 并不会仅仅给我们提供每个对象的位置，它还会给出每个对象的轮廓 (掩模)，就像这样： 为了训练 Mask R-CNN，我们需要大量关于需要检测的目标的图像。我们可以拍一些车辆的图像，然后将这些图像中的汽车标注出来，但是这可能会花费几天的工作。幸运的是，汽车是很常见的检测目标，很多人都想检测，因此早就有了几个公开的汽车数据集。 有一个很流行的数据集叫做 COCO，它里面的图像都用目标掩膜标注过。在这个数据集中，已经有超过 12000 张汽车图像做好了轮廓标注。下面就是 COCO 数据集中的一张图像。 COCO 数据集中已标注轮廓的图像。 这个数据集非常适合用来训练 Mask R-CNN 模型。 使用 COCO 数据集来构建目标检测数据集是很常见的一件事情，所以好多人已经做过并且分享了他们的结果。因此，我们可以用一个训练好的模型作为开始，而不用从头去训练自己的模型。针对这个项目，我们可以使用很棒的开源 Mask R-CNN，它是由 Matterport 公司实现的，还提供了训练好的模型。 地址：https://github.com/matterport/Mask_RCNN 旁注：你不必为训练定制化的 Mask R-CNN 而担心！标注数据是很耗时间的，但是并不困难。如果你想使用自己的数据完整地训练 Mask R-CNN 模型，可以参考这本书： https://www.machinelearningisfun.com/get-the-book 如果在我自己的相机图像上运行预训练模型，以下是检测结果： 经过 COCO 默认目标识别的图像——车辆、人、交通信号灯和树。 我们不仅识别了车辆，还识别出了交通信号灯和人。而且比较滑稽的是，它将其中的一棵树识别成了「盆栽植物」。 对于图像中被检测到的每一个目标，我们从 Mask R-CNN 模型中得到了下面四个结果： 被检测到的目标（作为整数）类型。预训练的 COCO 模型知道如何检测 80 种不同的常见目标，例如汽车和卡车。 目标检测的置信得分。这个数字越大，越说明模型准确识别了目标。 中目标的边界框，以 X/Y 像素位置地形式给了出来。 位图「掩模」，能够分辨出边界框里哪些像素是目标的一部分，哪些不是。有了掩模数据，我们也可以标注目标的轮廓。 下面是 python 代码，用于根据 Matterport』s Mask R-CNN 实现和 OpneCV 预训练的模型来检测汽车边界框： import&nbsp;osimport&nbsp;numpy&nbsp;as&nbsp;npimport&nbsp;cv2import&nbsp;mrcnn.configimport&nbsp;mrcnn.utilsfrom&nbsp;mrcnn.model&nbsp;import&nbsp;MaskRCNNfrom&nbsp;pathlib&nbsp;import&nbsp;Path#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;libraryclass&nbsp;MaskRCNNConfig(mrcnn.config.Config):&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;&quot;coco_pretrained_model_config&quot;&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;1&nbsp;+&nbsp;80&nbsp;&nbsp;#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;0.6#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucksdef&nbsp;get_car_boxes(boxes,&nbsp;class_ids):&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;box&nbsp;in&nbsp;enumerate(boxes):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_ids[i]&nbsp;in&nbsp;[3,&nbsp;8,&nbsp;6]:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array(car_boxes)#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;projectROOT_DIR&nbsp;=&nbsp;Path(&quot;.&quot;)#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;modelMODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;logs&quot;)#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;fileCOCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;mask_rcnn_coco.h5&quot;)#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;neededif&nbsp;not&nbsp;os.path.exists(COCO_MODEL_PATH):&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;onIMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;images&quot;)#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;fileVIDEO_SOURCE&nbsp;=&nbsp;&quot;test_images/parking.mp4&quot;#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;modemodel&nbsp;=&nbsp;MaskRCNN(mode=&quot;inference&quot;,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())#&nbsp;Load&nbsp;pre-trained&nbsp;modelmodel.load_weights(COCO_MODEL_PATH,&nbsp;by_name=True)#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spacesparked_car_boxes&nbsp;=&nbsp;None#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;onvideo_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;videowhile&nbsp;video_capture.isOpened():&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::-1]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=0)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[0]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:&quot;)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Draw&nbsp;each&nbsp;box&nbsp;on&nbsp;the&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;box&nbsp;in&nbsp;car_boxes:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Car:&nbsp;&quot;,&nbsp;box)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Draw&nbsp;the&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow( Video ,&nbsp;frame)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;cv2.waitKey(1)&nbsp;&amp;&nbsp;0xFF&nbsp;==&nbsp;ord( q ):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finishedvideo_capture.release()cv2.destroyAllWindows() 当你运行这段脚本时，会在屏幕上得到一幅图，每辆检测到的汽车都有一个边界框，像这样： 每辆检测到的汽车都有一个绿色的边界框。 你还会看到被检测到的汽车坐标被打印在了控制台上，就像这样： Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:Car:&nbsp;&nbsp;[492&nbsp;871&nbsp;551&nbsp;961]Car:&nbsp;&nbsp;[450&nbsp;819&nbsp;509&nbsp;913]Car:&nbsp;&nbsp;[411&nbsp;774&nbsp;470&nbsp;856] 经过以上这些步骤，我们已经成功地检测到了图像中的汽车。 检测空置的停车位 我们知道了每张图像中每辆车的像素位置。通过查看视频中按顺序出现的多帧，我们可以轻易知道哪些车没有动，并且假设它们所在的位置就是车位。但是，当一辆车离开车位的时候，我们如何检测得到呢？ 问题在于我们图像中的边界框是部分重叠的。 即使是在不同车位中的车辆，每辆车的边界框都会有一小部分的重叠。 所以，如果我们假设每个边界框代表一个车位，那么，即使车位是空的，也有可能显示为被部分占用。我们需要一个方法来测量两个对象的重叠度，以便检查「大部分是空的」边界框。 我们将要使用的测量方法为交并比（IoU）。IoU 通过两个对象重叠的像素数量除以两个对象覆盖的像素数量计算得到。像这样： 这将为我们提供汽车边界框与停车位边界框重叠的程度。有了这个，我们可以轻易确定汽车是否在停车位。如果 IoU 测量值很低，如 0.15，那意味着汽车并没有真正占用大部分停车位。但如果指标很高，如 0.6，这意味着汽车占据了大部分停车位区域，因此我们可以确定该空间被占用。 由于 IoU 是计算机视觉中常见的测量方法，因此你在使用的库通常已经实现了它的计算。事实上，Matterport Mask R-CNN 库将它作为一个名为 mrcnn.utils.compute_overlaps（）的函数包含在内，因此我们可以直接使用该函数。 假设我们有一个表示图像中停车区域的边界框列表，查看检测到的车辆是否在这些边界框内就像添加一行或两行代码一样简单： #&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;how&nbsp;much&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(car_boxes,&nbsp;parking_areas)&nbsp;&nbsp;&nbsp;&nbsp;print(overlaps) 结果是这样子的： [&nbsp;[1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.07040032&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.]&nbsp;[0.07040032&nbsp;1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.07673165&nbsp;0.]&nbsp;[0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.02332112&nbsp;0.]]In&nbsp;that&nbsp;2D&nbsp;array,&nbsp;each 在这个二维数组中，每一行代表一个停车位的边界框。同样，每一列代表着这个停车位被检测到的汽车占用了多少。1.0 分表示完全被占用，较低的分，如 0.02 则表示这辆汽车接触到了车位的空间，但是并没有占据大部分区域。 要寻找未被占用的停车位，我们只需要检查此阵列中的每一行。如果所有数字都为零或非常小，那意味着没有任何东西占据那个空间，它就是空着的！ 但请记住，目标检测并非总是与实时视频完美配合。即使 Mask R-CNN 非常准确，偶尔也会在单帧视频中错过一两辆车。因此，在将停车位标记为空闲之前，我们应该确保它在一段时间内保持空闲 - 可能是 5 或 10 个连续的视频帧。这将防止系统仅仅因为目标检测在一帧视频上有短暂的停顿就错误地检测到空闲的停车位。但是，只要我们看到至少有一个空闲停车位出现在连续几帧视频中，我们就可以发送短信了！ 发送短信 这个项目的最后一步就是当检测到一个空闲停车位出现在视频的连续几帧中时就发送短信提醒。 使用 Twilio 从 Python 中发送短信很简单。Twilio 是一个很流行的 API，它可以让你用任何编程语言只需几行代码就可以发送短信。当然，如果你更喜欢使用其它短信服务提供商，也可以。我和 Twilio 并没有利益关系。它只是我想到的第一个工具而已。 要使用 Twilio，你需要注册一个试用账户，创建两个 Twilio 电话号码，然后认证账户。然后，你需要安装 Twilio Python 客户端。 pip3&nbsp;install&nbsp;twilio 安装完成后，这是用 Python 发送短信的完整代码（只需用你自己的帐户详细信息替换这些值即可）： from&nbsp;twilio.rest&nbsp;import&nbsp;Client#&nbsp;Twilio&nbsp;account&nbsp;detailstwilio_account_sid&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;SID&nbsp;here twilio_auth_token&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;Auth&nbsp;Token&nbsp;here twilio_source_phone_number&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;phone&nbsp;number&nbsp;here #&nbsp;Create&nbsp;a&nbsp;Twilio&nbsp;client&nbsp;object&nbsp;instanceclient&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)#&nbsp;Send&nbsp;an&nbsp;SMSmessage&nbsp;=&nbsp;client.messages.create(&nbsp;&nbsp;&nbsp;&nbsp;body=&quot;This&nbsp;is&nbsp;my&nbsp;SMS&nbsp;message!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_source_phone_number,&nbsp;&nbsp;&nbsp;&nbsp;to=&quot;Destination&nbsp;phone&nbsp;number&nbsp;here&quot;) 为了在脚本中添加短信发送功能，我们可以把这些代码丢进去。但需要注意的是，我们并不需要在每一个有空闲车位的新视频帧中发送短信。所以我们需要一个标志来跟踪是否已经发过短信了，这是为了保证不会在短期内再次发送或者在新车位空出来之前再次发送。 总结 将以上流程中的所有步骤整合在一起，构成一个独立的 Python 脚本，完整代码如下所示： import&nbsp;osimport&nbsp;numpy&nbsp;as&nbsp;npimport&nbsp;cv2import&nbsp;mrcnn.configimport&nbsp;mrcnn.utilsfrom&nbsp;mrcnn.model&nbsp;import&nbsp;MaskRCNNfrom&nbsp;pathlib&nbsp;import&nbsp;Pathfrom&nbsp;twilio.rest&nbsp;import&nbsp;Client#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;libraryclass&nbsp;MaskRCNNConfig(mrcnn.config.Config):&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;&quot;coco_pretrained_model_config&quot;&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;1&nbsp;+&nbsp;80&nbsp;&nbsp;#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;0.6#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucksdef&nbsp;get_car_boxes(boxes,&nbsp;class_ids):&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;box&nbsp;in&nbsp;enumerate(boxes):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_ids[i]&nbsp;in&nbsp;[3,&nbsp;8,&nbsp;6]:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array(car_boxes)#&nbsp;Twilio&nbsp;configtwilio_account_sid&nbsp;=&nbsp; YOUR_TWILIO_SID twilio_auth_token&nbsp;=&nbsp; YOUR_TWILIO_AUTH_TOKEN twilio_phone_number&nbsp;=&nbsp; YOUR_TWILIO_SOURCE_PHONE_NUMBER destination_phone_number&nbsp;=&nbsp; THE_PHONE_NUMBER_TO_TEXT client&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;projectROOT_DIR&nbsp;=&nbsp;Path(&quot;.&quot;)#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;modelMODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;logs&quot;)#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;fileCOCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;mask_rcnn_coco.h5&quot;)#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;neededif&nbsp;not&nbsp;os.path.exists(COCO_MODEL_PATH):&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;onIMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;images&quot;)#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;fileVIDEO_SOURCE&nbsp;=&nbsp;&quot;test_images/parking.mp4&quot;#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;modemodel&nbsp;=&nbsp;MaskRCNN(mode=&quot;inference&quot;,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())#&nbsp;Load&nbsp;pre-trained&nbsp;modelmodel.load_weights(COCO_MODEL_PATH,&nbsp;by_name=True)#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spacesparked_car_boxes&nbsp;=&nbsp;None#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;onvideo_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)#&nbsp;How&nbsp;many&nbsp;frames&nbsp;of&nbsp;video&nbsp;we ve&nbsp;seen&nbsp;in&nbsp;a&nbsp;row&nbsp;with&nbsp;a&nbsp;parking&nbsp;space&nbsp;openfree_space_frames&nbsp;=&nbsp;0#&nbsp;Have&nbsp;we&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;alert&nbsp;yet?sms_sent&nbsp;=&nbsp;False#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;videowhile&nbsp;video_capture.isOpened():&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::-1]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=0)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[0]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;parked_car_boxes&nbsp;is&nbsp;None:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;the&nbsp;first&nbsp;frame&nbsp;of&nbsp;video&nbsp;-&nbsp;assume&nbsp;all&nbsp;the&nbsp;cars&nbsp;detected&nbsp;are&nbsp;in&nbsp;parking&nbsp;spaces.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Save&nbsp;the&nbsp;location&nbsp;of&nbsp;each&nbsp;car&nbsp;as&nbsp;a&nbsp;parking&nbsp;space&nbsp;box&nbsp;and&nbsp;go&nbsp;to&nbsp;the&nbsp;next&nbsp;frame&nbsp;of&nbsp;video.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parked_car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;already&nbsp;know&nbsp;where&nbsp;the&nbsp;parking&nbsp;spaces&nbsp;are.&nbsp;Check&nbsp;if&nbsp;any&nbsp;are&nbsp;currently&nbsp;unoccupied.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;where&nbsp;cars&nbsp;are&nbsp;currently&nbsp;located&nbsp;in&nbsp;the&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;how&nbsp;much&nbsp;those&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(parked_car_boxes,&nbsp;car_boxes)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Assume&nbsp;no&nbsp;spaces&nbsp;are&nbsp;free&nbsp;until&nbsp;we&nbsp;find&nbsp;one&nbsp;that&nbsp;is&nbsp;free&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;False&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Loop&nbsp;through&nbsp;each&nbsp;known&nbsp;parking&nbsp;space&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;parking_area,&nbsp;overlap_areas&nbsp;in&nbsp;zip(parked_car_boxes,&nbsp;overlaps):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;For&nbsp;this&nbsp;parking&nbsp;space,&nbsp;find&nbsp;the&nbsp;max&nbsp;amount&nbsp;it&nbsp;was&nbsp;covered&nbsp;by&nbsp;any&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;car&nbsp;that&nbsp;was&nbsp;detected&nbsp;in&nbsp;our&nbsp;image&nbsp;(doesn t&nbsp;really&nbsp;matter&nbsp;which&nbsp;car)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_IoU_overlap&nbsp;=&nbsp;np.max(overlap_areas)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;the&nbsp;top-left&nbsp;and&nbsp;bottom-right&nbsp;coordinates&nbsp;of&nbsp;the&nbsp;parking&nbsp;area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;parking_area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;if&nbsp;the&nbsp;parking&nbsp;space&nbsp;is&nbsp;occupied&nbsp;by&nbsp;seeing&nbsp;if&nbsp;any&nbsp;car&nbsp;overlaps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;it&nbsp;by&nbsp;more&nbsp;than&nbsp;0.15&nbsp;using&nbsp;IoU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;max_IoU_overlap&nbsp;&lt;&nbsp;0.15:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parking&nbsp;space&nbsp;not&nbsp;occupied!&nbsp;Draw&nbsp;a&nbsp;green&nbsp;box&nbsp;around&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Flag&nbsp;that&nbsp;we&nbsp;have&nbsp;seen&nbsp;at&nbsp;least&nbsp;one&nbsp;open&nbsp;space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parking&nbsp;space&nbsp;is&nbsp;still&nbsp;occupied&nbsp;-&nbsp;draw&nbsp;a&nbsp;red&nbsp;box&nbsp;around&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;0,&nbsp;255),&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Write&nbsp;the&nbsp;IoU&nbsp;measurement&nbsp;inside&nbsp;the&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;f&quot;{max_IoU_overlap:0.2}&quot;,&nbsp;(x1&nbsp;+&nbsp;6,&nbsp;y2&nbsp;-&nbsp;6),&nbsp;font,&nbsp;0.3,&nbsp;(255,&nbsp;255,&nbsp;255))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;at&nbsp;least&nbsp;one&nbsp;space&nbsp;was&nbsp;free,&nbsp;start&nbsp;counting&nbsp;frames&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;so&nbsp;we&nbsp;don t&nbsp;alert&nbsp;based&nbsp;on&nbsp;one&nbsp;frame&nbsp;of&nbsp;a&nbsp;spot&nbsp;being&nbsp;open.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;helps&nbsp;prevent&nbsp;the&nbsp;script&nbsp;triggered&nbsp;on&nbsp;one&nbsp;bad&nbsp;detection.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;free_space:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;+=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;no&nbsp;spots&nbsp;are&nbsp;free,&nbsp;reset&nbsp;the&nbsp;count&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;=&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;a&nbsp;space&nbsp;has&nbsp;been&nbsp;free&nbsp;for&nbsp;several&nbsp;frames,&nbsp;we&nbsp;are&nbsp;pretty&nbsp;sure&nbsp;it&nbsp;is&nbsp;really&nbsp;free!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;free_space_frames&nbsp;&gt;&nbsp;10:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Write&nbsp;SPACE&nbsp;AVAILABLE!!&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;f&quot;SPACE&nbsp;AVAILABLE!&quot;,&nbsp;(10,&nbsp;150),&nbsp;font,&nbsp;3.0,&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;2,&nbsp;cv2.FILLED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;we&nbsp;haven t&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;yet,&nbsp;sent&nbsp;it!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;sms_sent:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;SENDING&nbsp;SMS!!!&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;client.messages.create(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body=&quot;Parking&nbsp;space&nbsp;open&nbsp;-&nbsp;go&nbsp;go&nbsp;go!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_phone_number,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to=destination_phone_number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sms_sent&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow( Video ,&nbsp;frame)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;cv2.waitKey(1)&nbsp;&amp;&nbsp;0xFF&nbsp;==&nbsp;ord( q ):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finishedvideo_capture.release()cv2.destroyAllWindows() 要运行这份代码，你首先需要安装 python 3.6+，Matterport Mask R-CNN 以及 OpenCV。 我特意保留了比较简单的代码。例如，它只是假设第一帧视频中出现的任何车辆都是停放的汽车。试用一下，看看你是否能够提升它的可用性。 不必担心为了在其它场景中使用而修改代码。仅仅改变模型寻找的目标 ID，你就能够将这份代码完全转换成另一个东西。例如，假设你在滑雪场工作。经过一些调整，你就可以将这份脚本转换为一个系统，它可以自动检测滑雪板从斜坡上跳越，并创建出很酷的滑雪板跳越路线。或者如果你在野生动物保护区工作，你可以将这份代码转换成一个统计野生斑马数量的系统。唯一的限制只是你的想象力。祝你玩得开心！ 推荐阅读 人大、华中科大、西安交大等四所高校成立AI学院，国内高校AI学院已达38所 《AI世界生存指南》 「击败星际争霸II职业玩家」的 AlphaStar是在作弊？ 7 步快速入门 Python3 “一人单挑&amp;nbsp;BAT”，黑客张福：我要的东西，比钱更贵 同一天这是巧合吗？吴恩达、谷歌、Facebook纷纷开源数据集 21个GIF动图让你了解各种数学概念 微信真要做操作系统了？ 下载最新教程《ArtificalNeuralNetworks》" />
<link rel="canonical" href="https://mlh.app/2019/02/05/e5da3808dc7798744ceffca90054f296.html" />
<meta property="og:url" content="https://mlh.app/2019/02/05/e5da3808dc7798744ceffca90054f296.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"机器之心编译 作者想用深度学习来解决一个小麻烦，于是用 Python 和 Mask R-CNN 设计了一个模型。该模型可以自动检测停车位并在发现可用车位后向他发送短信。这是什么神仙（sao）操作？ 我居住在一个大城市。但是和在很多大城市一样，找个停车位总没那么容易。车位很快就被抢占一空，即使你有一个属于自己的专用车位，朋友们顺路来访也很难，因为他们找不到车位。 我的解决方案就是将一个摄像头伸出窗外，再用深度学习让我的计算机在有车位空出来的时候给我发短信： 这听起来也许很复杂，但是借助深度学习构建一个实用的版本实际上又简单又快。所有的工具都是可用的——你只要知道去哪儿找到工具并把它们组合在一起就行。 那么，我们花点时间用 python 和深度学习构建一个高准确率的停车位通知系统吧！ 问题分解 当我们面临想要用机器学习解决的复杂问题时，第一步就是将问题分解成若干简单问题。然后，使用详细分解作为指导，我们可以从机器学习工具箱中使用不同的工具来解决这些小问题。通过将几个不同的解决方案链接到一个流程中，我们就得到了能够做一些复杂事情的系统。 下面是我分解的空车位检测流程： 机器学习流程的输入是来自一个伸出窗外的普通网络摄像头的视频流： 从摄像头中截取的示例视频 我们将通过工作流程传送每一帧视频，一次一帧。 这个流程的第一步就是检测一帧视频中所有可能的停车位。显然，在我们能够检测哪个是没有被占用的停车位之前，我们需要知道图像中的哪些部分是停车位。 第二步就是检测每帧视频中的所有车辆。这样我们可以逐帧跟踪每辆车的运动。 第三步就是确定哪些车位目前是被占用的，哪些没有。这需要结合前两步的结果。 最后一步就是出现新车位时通知我。这需要基于视频中两帧之间车辆位置的变化。 这里的每一步，我们都可以使用多种技术用很多种方式实现。构建这个流程并没有唯一正确或者错误的方式，但不同的方法会有优劣之分。 第一步：检测一幅图像中的停车位 摄像头的视野是这样的： 我们需要扫描这幅图，然后返回一个有效停车区域列表，就像这样： 这个城市街道上的有效停车位。 一种比较懒的方法就是手动把每个停车位的位置硬编码到程序中，而不是自动检测停车位。但是如果我们移动了摄像头或者想要检测另一条街道上的车位时，就必须再一次手动硬编码车位的位置。这样很麻烦，还是找一种自动检测车位的方法吧。 一个思路是寻找停车计时器并假设每个计时器旁边都有一个停车位： 检测每幅图像中的停车计时器。 但这种方法有些复杂。首先，并非每个停车位都有停车计时器——实际上，我们最喜欢找的是无需付费的车位！其次，只知道停车计时器的位置并不能确切地告诉我们停车位的确切位置。它只是让我们更加接近停车位罢了。 另一个思路就是构建目标检测模型，让它寻找道路上绘制的停车位标志，就像这样： 请注意这些黄色的小标志——它们就是画在道路上的每个车位的边界。 但是这种方法也很令人痛苦。首先，我所在城市的停车位标志线特别小，在这么远的距离很难看见，所以很难用计算机检测到它们。其次，道路上有各种无关的线和标志。很难区分哪些线是停车位标志，哪些是车道分离线或者人行道线。 当你遇到似乎很困难的问题时，花几分钟时间想一想，你是否可以采用不同的方法来解决这个问题，避开一些技术性挑战。到底什么是停车位？停车位不就是车辆可以停放很长时间的地方吗。所以，也许我们根本就没必要去检测停车位。为何不能仅仅检测长时间没有移动的车辆并且假设它们就停在停车位呢？ 换句话说，有效停车位就是包含非移动车辆的地方。 这里，每辆车的边界框实际上就是一个停车位！如果我们能够检测静态的车辆，就没必要检测停车位。 所以，如果我们能够检测车辆，并且可以判断哪些车辆在视频帧中是没有移动的，那我们就能够推测出停车位的位置。够简单了——让我们来检测车辆吧！ 检测图像中的车辆 检测视频帧里的车辆就是目标检测中的一道练习题。我们可以用很多机器学习方法来检测图像中的目标。下面是我列出的几种最常用的目标检测算法： 训练一个 HOG(方向梯度直方图) 目标检测器，并用它滑过我们的图像以寻找所有的车辆。这个古老的非深度学习方法运行起来相当快，但是它并不能很好地处理向不同方向移动的车辆。 训练一个 CNN(卷积神经网络) 目标检测器，用它滑过我们的图像直到找到所有的车辆。这种方法很准确，但并不是很高效，因为我们必须多次扫描同一张图像来寻找所有的车辆。并且，虽然它可以轻易找到向不同方向移动的车辆，但它需要的训练数据要比 HOG 目标检测器多得多。 使用更新的深度学习方法，如 Mask R-CNN、Faster R-CNN 或者 YOLO。它们将灵活的设计和高效的技巧与 CNN 的准确性结合在了一起，能够极大地加速检测过程。只要我们有足够多的数据来训练模型，它能在 GPU 上运行地相对快一些。 通常情况下，我们希望选择最简单的方法来解决问题，使用最少的训练数据，并不认为需要最新、最流行的算法。但是在这个特殊的情况下，*Mask R-CNN*是一个比较合理的选择，虽然它是一个比较新、比较流行的算法。 Mask R-CNN 架构在不使用滑动窗口的情况下以一种高效的计算方式在整幅图像中检测目标。换句话说，它运行得相当快。在具有比较先进的 GPU 时，我们应该能够以数帧每秒的速度检测到高分辨率视频中的目标。所以它应该比较适合这个项目。 此外，Mask R-CNN 给我们提供了很多关于每个检测对象的信息。绝大多数目标检测算法仅仅返回了每个对象的边界框。但是 Mask R-CNN 并不会仅仅给我们提供每个对象的位置，它还会给出每个对象的轮廓 (掩模)，就像这样： 为了训练 Mask R-CNN，我们需要大量关于需要检测的目标的图像。我们可以拍一些车辆的图像，然后将这些图像中的汽车标注出来，但是这可能会花费几天的工作。幸运的是，汽车是很常见的检测目标，很多人都想检测，因此早就有了几个公开的汽车数据集。 有一个很流行的数据集叫做 COCO，它里面的图像都用目标掩膜标注过。在这个数据集中，已经有超过 12000 张汽车图像做好了轮廓标注。下面就是 COCO 数据集中的一张图像。 COCO 数据集中已标注轮廓的图像。 这个数据集非常适合用来训练 Mask R-CNN 模型。 使用 COCO 数据集来构建目标检测数据集是很常见的一件事情，所以好多人已经做过并且分享了他们的结果。因此，我们可以用一个训练好的模型作为开始，而不用从头去训练自己的模型。针对这个项目，我们可以使用很棒的开源 Mask R-CNN，它是由 Matterport 公司实现的，还提供了训练好的模型。 地址：https://github.com/matterport/Mask_RCNN 旁注：你不必为训练定制化的 Mask R-CNN 而担心！标注数据是很耗时间的，但是并不困难。如果你想使用自己的数据完整地训练 Mask R-CNN 模型，可以参考这本书： https://www.machinelearningisfun.com/get-the-book 如果在我自己的相机图像上运行预训练模型，以下是检测结果： 经过 COCO 默认目标识别的图像——车辆、人、交通信号灯和树。 我们不仅识别了车辆，还识别出了交通信号灯和人。而且比较滑稽的是，它将其中的一棵树识别成了「盆栽植物」。 对于图像中被检测到的每一个目标，我们从 Mask R-CNN 模型中得到了下面四个结果： 被检测到的目标（作为整数）类型。预训练的 COCO 模型知道如何检测 80 种不同的常见目标，例如汽车和卡车。 目标检测的置信得分。这个数字越大，越说明模型准确识别了目标。 中目标的边界框，以 X/Y 像素位置地形式给了出来。 位图「掩模」，能够分辨出边界框里哪些像素是目标的一部分，哪些不是。有了掩模数据，我们也可以标注目标的轮廓。 下面是 python 代码，用于根据 Matterport』s Mask R-CNN 实现和 OpneCV 预训练的模型来检测汽车边界框： import&nbsp;osimport&nbsp;numpy&nbsp;as&nbsp;npimport&nbsp;cv2import&nbsp;mrcnn.configimport&nbsp;mrcnn.utilsfrom&nbsp;mrcnn.model&nbsp;import&nbsp;MaskRCNNfrom&nbsp;pathlib&nbsp;import&nbsp;Path#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;libraryclass&nbsp;MaskRCNNConfig(mrcnn.config.Config):&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;&quot;coco_pretrained_model_config&quot;&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;1&nbsp;+&nbsp;80&nbsp;&nbsp;#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;0.6#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucksdef&nbsp;get_car_boxes(boxes,&nbsp;class_ids):&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;box&nbsp;in&nbsp;enumerate(boxes):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_ids[i]&nbsp;in&nbsp;[3,&nbsp;8,&nbsp;6]:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array(car_boxes)#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;projectROOT_DIR&nbsp;=&nbsp;Path(&quot;.&quot;)#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;modelMODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;logs&quot;)#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;fileCOCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;mask_rcnn_coco.h5&quot;)#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;neededif&nbsp;not&nbsp;os.path.exists(COCO_MODEL_PATH):&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;onIMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;images&quot;)#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;fileVIDEO_SOURCE&nbsp;=&nbsp;&quot;test_images/parking.mp4&quot;#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;modemodel&nbsp;=&nbsp;MaskRCNN(mode=&quot;inference&quot;,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())#&nbsp;Load&nbsp;pre-trained&nbsp;modelmodel.load_weights(COCO_MODEL_PATH,&nbsp;by_name=True)#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spacesparked_car_boxes&nbsp;=&nbsp;None#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;onvideo_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;videowhile&nbsp;video_capture.isOpened():&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::-1]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=0)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[0]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:&quot;)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Draw&nbsp;each&nbsp;box&nbsp;on&nbsp;the&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;box&nbsp;in&nbsp;car_boxes:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Car:&nbsp;&quot;,&nbsp;box)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Draw&nbsp;the&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow( Video ,&nbsp;frame)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;cv2.waitKey(1)&nbsp;&amp;&nbsp;0xFF&nbsp;==&nbsp;ord( q ):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finishedvideo_capture.release()cv2.destroyAllWindows() 当你运行这段脚本时，会在屏幕上得到一幅图，每辆检测到的汽车都有一个边界框，像这样： 每辆检测到的汽车都有一个绿色的边界框。 你还会看到被检测到的汽车坐标被打印在了控制台上，就像这样： Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:Car:&nbsp;&nbsp;[492&nbsp;871&nbsp;551&nbsp;961]Car:&nbsp;&nbsp;[450&nbsp;819&nbsp;509&nbsp;913]Car:&nbsp;&nbsp;[411&nbsp;774&nbsp;470&nbsp;856] 经过以上这些步骤，我们已经成功地检测到了图像中的汽车。 检测空置的停车位 我们知道了每张图像中每辆车的像素位置。通过查看视频中按顺序出现的多帧，我们可以轻易知道哪些车没有动，并且假设它们所在的位置就是车位。但是，当一辆车离开车位的时候，我们如何检测得到呢？ 问题在于我们图像中的边界框是部分重叠的。 即使是在不同车位中的车辆，每辆车的边界框都会有一小部分的重叠。 所以，如果我们假设每个边界框代表一个车位，那么，即使车位是空的，也有可能显示为被部分占用。我们需要一个方法来测量两个对象的重叠度，以便检查「大部分是空的」边界框。 我们将要使用的测量方法为交并比（IoU）。IoU 通过两个对象重叠的像素数量除以两个对象覆盖的像素数量计算得到。像这样： 这将为我们提供汽车边界框与停车位边界框重叠的程度。有了这个，我们可以轻易确定汽车是否在停车位。如果 IoU 测量值很低，如 0.15，那意味着汽车并没有真正占用大部分停车位。但如果指标很高，如 0.6，这意味着汽车占据了大部分停车位区域，因此我们可以确定该空间被占用。 由于 IoU 是计算机视觉中常见的测量方法，因此你在使用的库通常已经实现了它的计算。事实上，Matterport Mask R-CNN 库将它作为一个名为 mrcnn.utils.compute_overlaps（）的函数包含在内，因此我们可以直接使用该函数。 假设我们有一个表示图像中停车区域的边界框列表，查看检测到的车辆是否在这些边界框内就像添加一行或两行代码一样简单： #&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;how&nbsp;much&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(car_boxes,&nbsp;parking_areas)&nbsp;&nbsp;&nbsp;&nbsp;print(overlaps) 结果是这样子的： [&nbsp;[1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.07040032&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.]&nbsp;[0.07040032&nbsp;1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.07673165&nbsp;0.]&nbsp;[0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.02332112&nbsp;0.]]In&nbsp;that&nbsp;2D&nbsp;array,&nbsp;each 在这个二维数组中，每一行代表一个停车位的边界框。同样，每一列代表着这个停车位被检测到的汽车占用了多少。1.0 分表示完全被占用，较低的分，如 0.02 则表示这辆汽车接触到了车位的空间，但是并没有占据大部分区域。 要寻找未被占用的停车位，我们只需要检查此阵列中的每一行。如果所有数字都为零或非常小，那意味着没有任何东西占据那个空间，它就是空着的！ 但请记住，目标检测并非总是与实时视频完美配合。即使 Mask R-CNN 非常准确，偶尔也会在单帧视频中错过一两辆车。因此，在将停车位标记为空闲之前，我们应该确保它在一段时间内保持空闲 - 可能是 5 或 10 个连续的视频帧。这将防止系统仅仅因为目标检测在一帧视频上有短暂的停顿就错误地检测到空闲的停车位。但是，只要我们看到至少有一个空闲停车位出现在连续几帧视频中，我们就可以发送短信了！ 发送短信 这个项目的最后一步就是当检测到一个空闲停车位出现在视频的连续几帧中时就发送短信提醒。 使用 Twilio 从 Python 中发送短信很简单。Twilio 是一个很流行的 API，它可以让你用任何编程语言只需几行代码就可以发送短信。当然，如果你更喜欢使用其它短信服务提供商，也可以。我和 Twilio 并没有利益关系。它只是我想到的第一个工具而已。 要使用 Twilio，你需要注册一个试用账户，创建两个 Twilio 电话号码，然后认证账户。然后，你需要安装 Twilio Python 客户端。 pip3&nbsp;install&nbsp;twilio 安装完成后，这是用 Python 发送短信的完整代码（只需用你自己的帐户详细信息替换这些值即可）： from&nbsp;twilio.rest&nbsp;import&nbsp;Client#&nbsp;Twilio&nbsp;account&nbsp;detailstwilio_account_sid&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;SID&nbsp;here twilio_auth_token&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;Auth&nbsp;Token&nbsp;here twilio_source_phone_number&nbsp;=&nbsp; Your&nbsp;Twilio&nbsp;phone&nbsp;number&nbsp;here #&nbsp;Create&nbsp;a&nbsp;Twilio&nbsp;client&nbsp;object&nbsp;instanceclient&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)#&nbsp;Send&nbsp;an&nbsp;SMSmessage&nbsp;=&nbsp;client.messages.create(&nbsp;&nbsp;&nbsp;&nbsp;body=&quot;This&nbsp;is&nbsp;my&nbsp;SMS&nbsp;message!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_source_phone_number,&nbsp;&nbsp;&nbsp;&nbsp;to=&quot;Destination&nbsp;phone&nbsp;number&nbsp;here&quot;) 为了在脚本中添加短信发送功能，我们可以把这些代码丢进去。但需要注意的是，我们并不需要在每一个有空闲车位的新视频帧中发送短信。所以我们需要一个标志来跟踪是否已经发过短信了，这是为了保证不会在短期内再次发送或者在新车位空出来之前再次发送。 总结 将以上流程中的所有步骤整合在一起，构成一个独立的 Python 脚本，完整代码如下所示： import&nbsp;osimport&nbsp;numpy&nbsp;as&nbsp;npimport&nbsp;cv2import&nbsp;mrcnn.configimport&nbsp;mrcnn.utilsfrom&nbsp;mrcnn.model&nbsp;import&nbsp;MaskRCNNfrom&nbsp;pathlib&nbsp;import&nbsp;Pathfrom&nbsp;twilio.rest&nbsp;import&nbsp;Client#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;libraryclass&nbsp;MaskRCNNConfig(mrcnn.config.Config):&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;&quot;coco_pretrained_model_config&quot;&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;1&nbsp;+&nbsp;80&nbsp;&nbsp;#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;0.6#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucksdef&nbsp;get_car_boxes(boxes,&nbsp;class_ids):&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;box&nbsp;in&nbsp;enumerate(boxes):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_ids[i]&nbsp;in&nbsp;[3,&nbsp;8,&nbsp;6]:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array(car_boxes)#&nbsp;Twilio&nbsp;configtwilio_account_sid&nbsp;=&nbsp; YOUR_TWILIO_SID twilio_auth_token&nbsp;=&nbsp; YOUR_TWILIO_AUTH_TOKEN twilio_phone_number&nbsp;=&nbsp; YOUR_TWILIO_SOURCE_PHONE_NUMBER destination_phone_number&nbsp;=&nbsp; THE_PHONE_NUMBER_TO_TEXT client&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;projectROOT_DIR&nbsp;=&nbsp;Path(&quot;.&quot;)#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;modelMODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;logs&quot;)#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;fileCOCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;mask_rcnn_coco.h5&quot;)#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;neededif&nbsp;not&nbsp;os.path.exists(COCO_MODEL_PATH):&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;onIMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;&quot;images&quot;)#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;fileVIDEO_SOURCE&nbsp;=&nbsp;&quot;test_images/parking.mp4&quot;#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;modemodel&nbsp;=&nbsp;MaskRCNN(mode=&quot;inference&quot;,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())#&nbsp;Load&nbsp;pre-trained&nbsp;modelmodel.load_weights(COCO_MODEL_PATH,&nbsp;by_name=True)#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spacesparked_car_boxes&nbsp;=&nbsp;None#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;onvideo_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)#&nbsp;How&nbsp;many&nbsp;frames&nbsp;of&nbsp;video&nbsp;we ve&nbsp;seen&nbsp;in&nbsp;a&nbsp;row&nbsp;with&nbsp;a&nbsp;parking&nbsp;space&nbsp;openfree_space_frames&nbsp;=&nbsp;0#&nbsp;Have&nbsp;we&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;alert&nbsp;yet?sms_sent&nbsp;=&nbsp;False#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;videowhile&nbsp;video_capture.isOpened():&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::-1]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=0)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[0]&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;parked_car_boxes&nbsp;is&nbsp;None:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;the&nbsp;first&nbsp;frame&nbsp;of&nbsp;video&nbsp;-&nbsp;assume&nbsp;all&nbsp;the&nbsp;cars&nbsp;detected&nbsp;are&nbsp;in&nbsp;parking&nbsp;spaces.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Save&nbsp;the&nbsp;location&nbsp;of&nbsp;each&nbsp;car&nbsp;as&nbsp;a&nbsp;parking&nbsp;space&nbsp;box&nbsp;and&nbsp;go&nbsp;to&nbsp;the&nbsp;next&nbsp;frame&nbsp;of&nbsp;video.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parked_car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;already&nbsp;know&nbsp;where&nbsp;the&nbsp;parking&nbsp;spaces&nbsp;are.&nbsp;Check&nbsp;if&nbsp;any&nbsp;are&nbsp;currently&nbsp;unoccupied.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;where&nbsp;cars&nbsp;are&nbsp;currently&nbsp;located&nbsp;in&nbsp;the&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[ rois ],&nbsp;r[ class_ids ])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;how&nbsp;much&nbsp;those&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(parked_car_boxes,&nbsp;car_boxes)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Assume&nbsp;no&nbsp;spaces&nbsp;are&nbsp;free&nbsp;until&nbsp;we&nbsp;find&nbsp;one&nbsp;that&nbsp;is&nbsp;free&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;False&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Loop&nbsp;through&nbsp;each&nbsp;known&nbsp;parking&nbsp;space&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;parking_area,&nbsp;overlap_areas&nbsp;in&nbsp;zip(parked_car_boxes,&nbsp;overlaps):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;For&nbsp;this&nbsp;parking&nbsp;space,&nbsp;find&nbsp;the&nbsp;max&nbsp;amount&nbsp;it&nbsp;was&nbsp;covered&nbsp;by&nbsp;any&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;car&nbsp;that&nbsp;was&nbsp;detected&nbsp;in&nbsp;our&nbsp;image&nbsp;(doesn t&nbsp;really&nbsp;matter&nbsp;which&nbsp;car)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_IoU_overlap&nbsp;=&nbsp;np.max(overlap_areas)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;the&nbsp;top-left&nbsp;and&nbsp;bottom-right&nbsp;coordinates&nbsp;of&nbsp;the&nbsp;parking&nbsp;area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;parking_area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;if&nbsp;the&nbsp;parking&nbsp;space&nbsp;is&nbsp;occupied&nbsp;by&nbsp;seeing&nbsp;if&nbsp;any&nbsp;car&nbsp;overlaps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;it&nbsp;by&nbsp;more&nbsp;than&nbsp;0.15&nbsp;using&nbsp;IoU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;max_IoU_overlap&nbsp;&lt;&nbsp;0.15:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parking&nbsp;space&nbsp;not&nbsp;occupied!&nbsp;Draw&nbsp;a&nbsp;green&nbsp;box&nbsp;around&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Flag&nbsp;that&nbsp;we&nbsp;have&nbsp;seen&nbsp;at&nbsp;least&nbsp;one&nbsp;open&nbsp;space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parking&nbsp;space&nbsp;is&nbsp;still&nbsp;occupied&nbsp;-&nbsp;draw&nbsp;a&nbsp;red&nbsp;box&nbsp;around&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(0,&nbsp;0,&nbsp;255),&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Write&nbsp;the&nbsp;IoU&nbsp;measurement&nbsp;inside&nbsp;the&nbsp;box&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;f&quot;{max_IoU_overlap:0.2}&quot;,&nbsp;(x1&nbsp;+&nbsp;6,&nbsp;y2&nbsp;-&nbsp;6),&nbsp;font,&nbsp;0.3,&nbsp;(255,&nbsp;255,&nbsp;255))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;at&nbsp;least&nbsp;one&nbsp;space&nbsp;was&nbsp;free,&nbsp;start&nbsp;counting&nbsp;frames&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;so&nbsp;we&nbsp;don t&nbsp;alert&nbsp;based&nbsp;on&nbsp;one&nbsp;frame&nbsp;of&nbsp;a&nbsp;spot&nbsp;being&nbsp;open.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;helps&nbsp;prevent&nbsp;the&nbsp;script&nbsp;triggered&nbsp;on&nbsp;one&nbsp;bad&nbsp;detection.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;free_space:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;+=&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;no&nbsp;spots&nbsp;are&nbsp;free,&nbsp;reset&nbsp;the&nbsp;count&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;=&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;a&nbsp;space&nbsp;has&nbsp;been&nbsp;free&nbsp;for&nbsp;several&nbsp;frames,&nbsp;we&nbsp;are&nbsp;pretty&nbsp;sure&nbsp;it&nbsp;is&nbsp;really&nbsp;free!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;free_space_frames&nbsp;&gt;&nbsp;10:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Write&nbsp;SPACE&nbsp;AVAILABLE!!&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;f&quot;SPACE&nbsp;AVAILABLE!&quot;,&nbsp;(10,&nbsp;150),&nbsp;font,&nbsp;3.0,&nbsp;(0,&nbsp;255,&nbsp;0),&nbsp;2,&nbsp;cv2.FILLED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;we&nbsp;haven t&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;yet,&nbsp;sent&nbsp;it!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;sms_sent:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;SENDING&nbsp;SMS!!!&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;client.messages.create(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body=&quot;Parking&nbsp;space&nbsp;open&nbsp;-&nbsp;go&nbsp;go&nbsp;go!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_phone_number,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to=destination_phone_number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sms_sent&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow( Video ,&nbsp;frame)&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;cv2.waitKey(1)&nbsp;&amp;&nbsp;0xFF&nbsp;==&nbsp;ord( q ):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finishedvideo_capture.release()cv2.destroyAllWindows() 要运行这份代码，你首先需要安装 python 3.6+，Matterport Mask R-CNN 以及 OpenCV。 我特意保留了比较简单的代码。例如，它只是假设第一帧视频中出现的任何车辆都是停放的汽车。试用一下，看看你是否能够提升它的可用性。 不必担心为了在其它场景中使用而修改代码。仅仅改变模型寻找的目标 ID，你就能够将这份代码完全转换成另一个东西。例如，假设你在滑雪场工作。经过一些调整，你就可以将这份脚本转换为一个系统，它可以自动检测滑雪板从斜坡上跳越，并创建出很酷的滑雪板跳越路线。或者如果你在野生动物保护区工作，你可以将这份代码转换成一个统计野生斑马数量的系统。唯一的限制只是你的想象力。祝你玩得开心！ 推荐阅读 人大、华中科大、西安交大等四所高校成立AI学院，国内高校AI学院已达38所 《AI世界生存指南》 「击败星际争霸II职业玩家」的 AlphaStar是在作弊？ 7 步快速入门 Python3 “一人单挑&amp;nbsp;BAT”，黑客张福：我要的东西，比钱更贵 同一天这是巧合吗？吴恩达、谷歌、Facebook纷纷开源数据集 21个GIF动图让你了解各种数学概念 微信真要做操作系统了？ 下载最新教程《ArtificalNeuralNetworks》","@type":"BlogPosting","url":"https://mlh.app/2019/02/05/e5da3808dc7798744ceffca90054f296.html","headline":"使用Python和Mask R-CNN自动寻找停车位，这是什么神操作？","dateModified":"2019-02-05T00:00:00+08:00","datePublished":"2019-02-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlh.app/2019/02/05/e5da3808dc7798744ceffca90054f296.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-3');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用Python和Mask R-CNN自动寻找停车位，这是什么神操作？</h1>
        
        
        <ul>
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
        </ul>
        
        
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
	

        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="text-align:center;margin-left:16px;"><span style="font-size:14px;"><strong style="color:rgb(136,136,136);font-size:12px;text-align:center;">机器之心编译</strong></span></p>
   <p style="min-height:1em;margin-left:16px;"><span style="color:rgb(136,136,136);font-size:15px;">作者想用深度学习来解决一个小麻烦，于是用 Python 和 Mask R-CNN 设计了一个模型。该模型可以自动检测停车位并在发现可用车位后向他发送短信。这是什么神仙（sao）操作？</span></p>
   <p style="text-align:justify;line-height:1.75em;"><br></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REn7IHDEDPJyRUB45PCvSDEpTDKDXwyQSv9TuayqojZJJeucmJnJsYibg/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我居住在一个大城市。但是和在很多大城市一样，找个停车位总没那么容易。车位很快就被抢占一空，即使你有一个属于自己的专用车位，朋友们顺路来访也很难，因为他们找不到车位。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我的解决方案就是将一个摄像头伸出窗外，再用深度学习让我的计算机在有车位空出来的时候给我发短信：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REn2yVojsoVYhiaUCVEIjCzFibD99tq24c9G5RutiaR0W9nXuNqEeU29dnw/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"></span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">这听起来也许很复杂，但是借助深度学习构建一个实用的版本实际上又简单又快。所有的工具都是可用的——你只要知道去哪儿找到工具并把它们组合在一起就行。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">那么，我们花点时间用 python 和深度学习构建一个高准确率的停车位通知系统吧！</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><strong><span style="font-size:15px;">问题分解</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">当我们面临想要用机器学习解决的复杂问题时，第一步就是将问题分解成若干简单问题。然后，使用详细分解作为指导，我们可以从机器学习工具箱中使用不同的工具来解决这些小问题。通过将几个不同的解决方案链接到一个流程中，我们就得到了能够做一些复杂事情的系统。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">下面是我分解的空车位检测流程：</span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REp0icKevHtqdA8N5hdNonica0bn97VtxXwPxhsmVS3h4IexW2swsDERPQ/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">机器学习流程的输入是来自一个伸出窗外的普通网络摄像头的视频流：</span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REjQeuhMjYNsGU6ygoOvA1pmcmibtcJFy1HlYkobnChY50CWibBUuKpJgA/640?wx_fmt=gif" alt="640?wx_fmt=gif"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">从摄像头中截取的示例视频</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我们将通过工作流程传送每一帧视频，一次一帧。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">这个流程的第一步就是检测一帧视频中所有可能的停车位。显然，在我们能够检测哪个是没有被占用的停车位之前，我们需要知道图像中的哪些部分是停车位。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">第二步就是检测每帧视频中的所有车辆。这样我们可以逐帧跟踪每辆车的运动。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">第三步就是确定哪些车位目前是被占用的，哪些没有。这需要结合前两步的结果。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">最后一步就是出现新车位时通知我。这需要基于视频中两帧之间车辆位置的变化。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">这里的每一步，我们都可以使用多种技术用很多种方式实现。构建这个流程并没有唯一正确或者错误的方式，但不同的方法会有优劣之分。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">第一步：检测一幅图像中的停车位</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">摄像头的视野是这样的：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REzqqgT6RWPgI5MAnUDu1VnUMsnf0HG0tC9rzc7JjJgRzV7LwNBbVlAg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;line-height:1.75em;"><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我们需要扫描这幅图，然后返回一个有效停车区域列表，就像这样：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REYuo5LRNXa71c4jQuj7FjcmKet8SZFMbl6dIyqBcSU5xrCibt7pacPLA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">这个城市街道上的有效停车位。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">一种比较懒的方法就是手动把每个停车位的位置硬编码到程序中，而不是自动检测停车位。但是如果我们移动了摄像头或者想要检测另一条街道上的车位时，就必须再一次手动硬编码车位的位置。这样很麻烦，还是找一种自动检测车位的方法吧。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">一个思路是寻找停车计时器并假设每个计时器旁边都有一个停车位：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REEC2zibHUSn8XlVHAxpuGxgC0btvylSUgWPa4yQI2CVicmqQsbicmF3P8Q/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">检测每幅图像中的停车计时器。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">但这种方法有些复杂。首先，并非每个停车位都有停车计时器——实际上，我们最喜欢找的是无需付费的车位！其次，只知道停车计时器的位置并不能确切地告诉我们停车位的确切位置。它只是让我们更加接近停车位罢了。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">另一个思路就是构建目标检测模型，让它寻找道路上绘制的停车位标志，就像这样：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REzRkObyTcQOIAjx5nWdlibkGa7czN9QgeYgyspFwWVoubTyl67G2PZdA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">请注意这些黄色的小标志——它们就是画在道路上的每个车位的边界。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">但是这种方法也很令人痛苦。首先，我所在城市的停车位标志线特别小，在这么远的距离很难看见，所以很难用计算机检测到它们。其次，道路上有各种无关的线和标志。很难区分哪些线是停车位标志，哪些是车道分离线或者人行道线。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">当你遇到似乎很困难的问题时，花几分钟时间想一想，你是否可以采用不同的方法来解决这个问题，避开一些技术性挑战。到底什么是停车位？停车位不就是车辆可以停放很长时间的地方吗。所以，也许我们根本就没必要去检测停车位。为何不能仅仅检测长时间没有移动的车辆并且假设它们就停在停车位呢？</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">换句话说，有效停车位就是包含非移动车辆的地方。</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REWGm3KHmM0rrRpoNOiacy1KV07z1Cdb5SKQv3gJCjM81lcTRAXuTS7mA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">这里，每辆车的边界框实际上就是一个停车位！如果我们能够检测静态的车辆，就没必要检测停车位。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">所以，如果我们能够检测车辆，并且可以判断哪些车辆在视频帧中是没有移动的，那我们就能够推测出停车位的位置。够简单了——让我们来检测车辆吧！</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><strong><span style="font-size:15px;">检测图像中的车辆</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">检测视频帧里的车辆就是目标检测中的一道练习题。我们可以用很多机器学习方法来检测图像中的目标。下面是我列出的几种最常用的目标检测算法：</span></p>
   <p><br></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:16px;">
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">训练一个 HOG(方向梯度直方图) 目标检测器，并用它滑过我们的图像以寻找所有的车辆。这个古老的非深度学习方法运行起来相当快，但是它并不能很好地处理向不同方向移动的车辆。</span></p></li>
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">训练一个 CNN(卷积神经网络) 目标检测器，用它滑过我们的图像直到找到所有的车辆。这种方法很准确，但并不是很高效，因为我们必须多次扫描同一张图像来寻找所有的车辆。并且，虽然它可以轻易找到向不同方向移动的车辆，但它需要的训练数据要比 HOG 目标检测器多得多。</span></p></li>
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">使用更新的深度学习方法，如 Mask R-CNN、Faster R-CNN 或者 YOLO。它们将灵活的设计和高效的技巧与 CNN 的准确性结合在了一起，能够极大地加速检测过程。只要我们有足够多的数据来训练模型，它能在 GPU 上运行地相对快一些。</span></p></li>
   </ul>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">通常情况下，我们希望选择最简单的方法来解决问题，使用最少的训练数据，并不认为需要最新、最流行的算法。但是在这个特殊的情况下，*Mask R-CNN*是一个比较合理的选择，虽然它是一个比较新、比较流行的算法。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">Mask R-CNN 架构在不使用滑动窗口的情况下以一种高效的计算方式在整幅图像中检测目标。换句话说，它运行得相当快。在具有比较先进的 GPU 时，我们应该能够以数帧每秒的速度检测到高分辨率视频中的目标。所以它应该比较适合这个项目。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">此外，Mask R-CNN 给我们提供了很多关于每个检测对象的信息。绝大多数目标检测算法仅仅返回了每个对象的边界框。但是 Mask R-CNN 并不会仅仅给我们提供每个对象的位置，它还会给出每个对象的轮廓 (掩模)，就像这样：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4RES1yTOQnPicUB9Rrpo9p1VP7lDb7ZBJp3c4KhMZ38KGFkBqnq8DckDFA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">为了训练 Mask R-CNN，我们需要大量关于需要检测的目标的图像。我们可以拍一些车辆的图像，然后将这些图像中的汽车标注出来，但是这可能会花费几天的工作。幸运的是，汽车是很常见的检测目标，很多人都想检测，因此早就有了几个公开的汽车数据集。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">有一个很流行的数据集叫做 COCO，它里面的图像都用目标掩膜标注过。在这个数据集中，已经有超过 12000 张汽车图像做好了轮廓标注。下面就是 COCO 数据集中的一张图像。</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW930YLfSsvgrxLQ4PEcK4RERpN7TKI8mAYdyvmKqOkVecEEgF1HjrGX029wI97nU4uF7wPibvJbxQA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">COCO 数据集中已标注轮廓的图像。<br></span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">这个数据集非常适合用来训练 Mask R-CNN 模型。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">使用 COCO 数据集来构建目标检测数据集是很常见的一件事情，所以好多人已经做过并且分享了他们的结果。因此，我们可以用一个训练好的模型作为开始，而不用从头去训练自己的模型。针对这个项目，我们可以使用很棒的开源 Mask R-CNN，它是由 Matterport 公司实现的，还提供了训练好的模型。</span></p>
   <p style="text-align:left;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;color:rgb(123,12,0);">地址：https://github.com/matterport/Mask_RCNN</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">旁注：你不必为训练定制化的 Mask R-CNN 而担心！标注数据是很耗时间的，但是并不困难。如果你想使用自己的数据完整地训练 Mask R-CNN 模型，可以参考这本书：</span></p>
   <p style="text-align:left;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;color:rgb(123,12,0);">https://www.machinelearningisfun.com/get-the-book</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">如果在我自己的相机图像上运行预训练模型，以下是检测结果：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REECeAibZUgFwFVb6J51aXUvjyOjDTEBMaEibV0wElWKF3VSbocSibFGtibA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">经过 COCO 默认目标识别的图像——车辆、人、交通信号灯和树。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我们不仅识别了车辆，还识别出了交通信号灯和人。而且比较滑稽的是，它将其中的一棵树识别成了「盆栽植物」。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">对于图像中被检测到的每一个目标，我们从 Mask R-CNN 模型中得到了下面四个结果：</span></p>
   <p><br></p>
   <ol class="list-paddingleft-2" style="list-style-type:decimal;margin-left:16px;">
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">被检测到的目标（作为整数）类型。预训练的 COCO 模型知道如何检测 80 种不同的常见目标，例如汽车和卡车。</span></p></li>
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">目标检测的置信得分。这个数字越大，越说明模型准确识别了目标。</span></p></li>
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">中目标的边界框，以 X/Y 像素位置地形式给了出来。</span></p></li>
    <li><p style="text-align:justify;line-height:1.75em;"><span style="font-size:15px;">位图「掩模」，能够分辨出边界框里哪些像素是目标的一部分，哪些不是。有了掩模数据，我们也可以标注目标的轮廓。</span></p></li>
   </ol>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">下面是 python 代码，用于根据 Matterport』s Mask R-CNN 实现和 OpneCV 预训练的模型来检测汽车边界框：</span></p>
   <p><br></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;os<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;numpy&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">as</span>&nbsp;np<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;cv2<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;mrcnn.config<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;mrcnn.utils<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">from</span>&nbsp;mrcnn.model&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;MaskRCNN<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">from</span>&nbsp;pathlib&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;Path<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;library</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="line-height:inherit;">class</span>&nbsp;<span class="hljs-title" style="line-height:inherit;">MaskRCNNConfig(mrcnn.config.Config)</span>:</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"coco_pretrained_model_config"</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span>&nbsp;+&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">80</span>&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.6</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucks</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-function" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;"><span class="hljs-keyword">def</span>&nbsp;<span class="hljs-title" style="line-height:inherit;">get_car_boxes(boxes,&nbsp;class_ids)</span>:</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">for</span>&nbsp;i,&nbsp;box&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;enumerate(boxes):<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;class_ids[i]&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">3</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">8</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">6</span>]:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">return</span>&nbsp;np.array(car_boxes)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;project</span><br style="font-size:inherit;color:inherit;line-height:inherit;">ROOT_DIR&nbsp;=&nbsp;Path(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"."</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;model</span><br style="font-size:inherit;color:inherit;line-height:inherit;">MODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"logs"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;file</span><br style="font-size:inherit;color:inherit;line-height:inherit;">COCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"mask_rcnn_coco.h5"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;needed</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">not</span>&nbsp;os.path.exists(COCO_MODEL_PATH):<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;on</span><br style="font-size:inherit;color:inherit;line-height:inherit;">IMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"images"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;file</span><br style="font-size:inherit;color:inherit;line-height:inherit;">VIDEO_SOURCE&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"test_images/parking.mp4"</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;mode</span><br style="font-size:inherit;color:inherit;line-height:inherit;">model&nbsp;=&nbsp;MaskRCNN(mode=<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"inference"</span>,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Load&nbsp;pre-trained&nbsp;model</span><br style="font-size:inherit;color:inherit;line-height:inherit;">model.load_weights(COCO_MODEL_PATH,&nbsp;by_name=<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">True</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spaces</span><br style="font-size:inherit;color:inherit;line-height:inherit;">parked_car_boxes&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">None</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;on</span><br style="font-size:inherit;color:inherit;line-height:inherit;">video_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;video</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">while</span>&nbsp;video_capture.isOpened():<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">not</span>&nbsp;success:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">break</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">-1</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> rois </span>],&nbsp;r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> class_ids </span>])<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"Cars&nbsp;found&nbsp;in&nbsp;frame&nbsp;of&nbsp;video:"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Draw&nbsp;each&nbsp;box&nbsp;on&nbsp;the&nbsp;frame</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">for</span>&nbsp;box&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;car_boxes:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"Car:&nbsp;"</span>,&nbsp;box)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;box<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Draw&nbsp;the&nbsp;box</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>),&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> Video </span>,&nbsp;frame)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;cv2.waitKey(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span>)&nbsp;&amp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0xFF</span>&nbsp;==&nbsp;ord(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> q </span>):<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">break</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finished</span><br style="font-size:inherit;color:inherit;line-height:inherit;">video_capture.release()<br style="font-size:inherit;color:inherit;line-height:inherit;">cv2.destroyAllWindows()</p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">当你运行这段脚本时，会在屏幕上得到一幅图，每辆检测到的汽车都有一个边界框，像这样：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REI8UicbYRd5gWQmM74nojTOiaiaSZaKOnYlzPdia7YY4gcWPJJScysDWKZw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="text-align:center;line-height:1.75em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">每辆检测到的汽车都有一个绿色的边界框。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">你还会看到被检测到的汽车坐标被打印在了控制台上，就像这样：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;">Cars&nbsp;found&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;frame&nbsp;of&nbsp;video:<br style="font-size:inherit;color:inherit;line-height:inherit;">Car:&nbsp;&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">492</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">871</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">551</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">961</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;">Car:&nbsp;&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">450</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">819</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">509</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">913</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;">Car:&nbsp;&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">411</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">774</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">470</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">856</span>]</p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">经过以上这些步骤，我们已经成功地检测到了图像中的汽车。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><strong><span style="font-size:15px;">检测空置的停车位</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我们知道了每张图像中每辆车的像素位置。通过查看视频中按顺序出现的多帧，我们可以轻易知道哪些车没有动，并且假设它们所在的位置就是车位。但是，当一辆车离开车位的时候，我们如何检测得到呢？</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">问题在于我们图像中的边界框是部分重叠的。</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW930YLfSsvgrxLQ4PEcK4REz916efSIHQaEZls1ibnoib7fNZkHiawduxpFVkBW3oE4xiaeMrs1HjqdFw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="text-align:center;line-height:1.5em;margin-left:16px;"><span style="color:rgb(136,136,136);"><em><span style="font-size:12px;">即使是在不同车位中的车辆，每辆车的边界框都会有一小部分的重叠。</span></em></span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">所以，如果我们假设每个边界框代表一个车位，那么，即使车位是空的，也有可能显示为被部分占用。我们需要一个方法来测量两个对象的重叠度，以便检查「大部分是空的」边界框。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我们将要使用的测量方法为交并比（IoU）。IoU 通过两个对象重叠的像素数量除以两个对象覆盖的像素数量计算得到。像这样：</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:center;margin-left:16px;"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW930YLfSsvgrxLQ4PEcK4RE7ExtaJicctIaglibYZpM5b5RQ0P837wyG2xicLYjnjOWS06RuPicoWDVDw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">这将为我们提供汽车边界框与停车位边界框重叠的程度。有了这个，我们可以轻易确定汽车是否在停车位。如果 IoU 测量值很低，如 0.15，那意味着汽车并没有真正占用大部分停车位。但如果指标很高，如 0.6，这意味着汽车占据了大部分停车位区域，因此我们可以确定该空间被占用。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">由于 IoU 是计算机视觉中常见的测量方法，因此你在使用的库通常已经实现了它的计算。事实上，Matterport Mask R-CNN 库将它作为一个名为 mrcnn.utils.compute_overlaps（）的函数包含在内，因此我们可以直接使用该函数。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">假设我们有一个表示图像中停车区域的边界框列表，查看检测到的车辆是否在这些边界框内就像添加一行或两行代码一样简单：</span></p>
   <p><br></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Filter&nbsp;the&nbsp;results&nbsp;to&nbsp;only&nbsp;grab&nbsp;the&nbsp;car&nbsp;/&nbsp;truck&nbsp;bounding&nbsp;boxes</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> rois </span>],&nbsp;r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> class_ids </span>])<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;See&nbsp;how&nbsp;much&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(car_boxes,&nbsp;parking_areas)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;print(overlaps)</p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">结果是这样子的：</span></p>
   <p><br></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;">[<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.07040032</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.07040032</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.07673165</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.02332112</span>&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;">]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">In&nbsp;that&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">2</span>D&nbsp;array,&nbsp;each</p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"></span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">在这个二维数组中，每一行代表一个停车位的边界框。同样，每一列代表着这个停车位被检测到的汽车占用了多少。1.0 分表示完全被占用，较低的分，如 0.02 则表示这辆汽车接触到了车位的空间，但是并没有占据大部分区域。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">要寻找未被占用的停车位，我们只需要检查此阵列中的每一行。如果所有数字都为零或非常小，那意味着没有任何东西占据那个空间，它就是空着的！</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">但请记住，目标检测并非总是与实时视频完美配合。即使 Mask R-CNN 非常准确，偶尔也会在单帧视频中错过一两辆车。因此，在将停车位标记为空闲之前，我们应该确保它在一段时间内保持空闲 - 可能是 5 或 10 个连续的视频帧。这将防止系统仅仅因为目标检测在一帧视频上有短暂的停顿就错误地检测到空闲的停车位。但是，只要我们看到至少有一个空闲停车位出现在连续几帧视频中，我们就可以发送短信了！</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><strong><span style="font-size:15px;">发送短信</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">这个项目的最后一步就是当检测到一个空闲停车位出现在视频的连续几帧中时就发送短信提醒。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">使用 Twilio 从 Python 中发送短信很简单。Twilio 是一个很流行的 API，它可以让你用任何编程语言只需几行代码就可以发送短信。当然，如果你更喜欢使用其它短信服务提供商，也可以。我和 Twilio 并没有利益关系。它只是我想到的第一个工具而已。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">要使用 Twilio，你需要注册一个试用账户，创建两个 Twilio 电话号码，然后认证账户。然后，你需要安装 Twilio Python 客户端。</span></p>
   <p><br></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;">pip3&nbsp;install&nbsp;twilio</p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">安装完成后，这是用 Python 发送短信的完整代码（只需用你自己的帐户详细信息替换这些值即可）：</span></p>
   <p><br></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">from</span>&nbsp;twilio.rest&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;Client<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Twilio&nbsp;account&nbsp;details</span><br style="font-size:inherit;color:inherit;line-height:inherit;">twilio_account_sid&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> Your&nbsp;Twilio&nbsp;SID&nbsp;here </span><br style="font-size:inherit;color:inherit;line-height:inherit;">twilio_auth_token&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> Your&nbsp;Twilio&nbsp;Auth&nbsp;Token&nbsp;here </span><br style="font-size:inherit;color:inherit;line-height:inherit;">twilio_source_phone_number&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> Your&nbsp;Twilio&nbsp;phone&nbsp;number&nbsp;here </span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Create&nbsp;a&nbsp;Twilio&nbsp;client&nbsp;object&nbsp;instance</span><br style="font-size:inherit;color:inherit;line-height:inherit;">client&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Send&nbsp;an&nbsp;SMS</span><br style="font-size:inherit;color:inherit;line-height:inherit;">message&nbsp;=&nbsp;client.messages.create(<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;body=<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"This&nbsp;is&nbsp;my&nbsp;SMS&nbsp;message!"</span>,<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_source_phone_number,<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;to=<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"Destination&nbsp;phone&nbsp;number&nbsp;here"</span><br style="font-size:inherit;color:inherit;line-height:inherit;">)</p>
   <p style="text-align:justify;line-height:1.75em;"><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">为了在脚本中添加短信发送功能，我们可以把这些代码丢进去。但需要注意的是，我们并不需要在每一个有空闲车位的新视频帧中发送短信。所以我们需要一个标志来跟踪是否已经发过短信了，这是为了保证不会在短期内再次发送或者在新车位空出来之前再次发送。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><strong><span style="font-size:15px;">总结</span></strong></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">将以上流程中的所有步骤整合在一起，构成一个独立的 Python 脚本，完整代码如下所示：</span></p>
   <p><br></p>
   <pre style="font-size:16px;color:rgb(62,62,62);line-height:inherit;"></pre>
   <p style="font-size:14px;color:rgb(169,183,198);line-height:18px;background:rgb(40,43,46);font-family:Consolas, Inconsolata, Courier, monospace;letter-spacing:0px;margin-left:16px;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;os<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;numpy&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">as</span>&nbsp;np<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;cv2<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;mrcnn.config<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;mrcnn.utils<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">from</span>&nbsp;mrcnn.model&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;MaskRCNN<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">from</span>&nbsp;pathlib&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;Path<br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">from</span>&nbsp;twilio.rest&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">import</span>&nbsp;Client<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Configuration&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;Mask-RCNN&nbsp;library</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-class" style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="line-height:inherit;">class</span>&nbsp;<span class="hljs-title" style="line-height:inherit;">MaskRCNNConfig(mrcnn.config.Config)</span>:</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NAME&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"coco_pretrained_model_config"</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;IMAGES_PER_GPU&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;GPU_COUNT&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NUM_CLASSES&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span>&nbsp;+&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">80</span>&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;COCO&nbsp;dataset&nbsp;has&nbsp;80&nbsp;classes&nbsp;+&nbsp;one&nbsp;background&nbsp;class</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;DETECTION_MIN_CONFIDENCE&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.6</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Filter&nbsp;a&nbsp;list&nbsp;of&nbsp;Mask&nbsp;R-CNN&nbsp;detection&nbsp;results&nbsp;to&nbsp;get&nbsp;only&nbsp;the&nbsp;detected&nbsp;cars&nbsp;/&nbsp;trucks</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-function" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;"><span class="hljs-keyword">def</span>&nbsp;<span class="hljs-title" style="line-height:inherit;">get_car_boxes(boxes,&nbsp;class_ids)</span>:</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;[]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">for</span>&nbsp;i,&nbsp;box&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;enumerate(boxes):<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;If&nbsp;the&nbsp;detected&nbsp;object&nbsp;isn t&nbsp;a&nbsp;car&nbsp;/&nbsp;truck,&nbsp;skip&nbsp;it</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;class_ids[i]&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">3</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">8</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">6</span>]:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes.append(box)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">return</span>&nbsp;np.array(car_boxes)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Twilio&nbsp;config</span><br style="font-size:inherit;color:inherit;line-height:inherit;">twilio_account_sid&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> YOUR_TWILIO_SID </span><br style="font-size:inherit;color:inherit;line-height:inherit;">twilio_auth_token&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> YOUR_TWILIO_AUTH_TOKEN </span><br style="font-size:inherit;color:inherit;line-height:inherit;">twilio_phone_number&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> YOUR_TWILIO_SOURCE_PHONE_NUMBER </span><br style="font-size:inherit;color:inherit;line-height:inherit;">destination_phone_number&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> THE_PHONE_NUMBER_TO_TEXT </span><br style="font-size:inherit;color:inherit;line-height:inherit;">client&nbsp;=&nbsp;Client(twilio_account_sid,&nbsp;twilio_auth_token)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Root&nbsp;directory&nbsp;of&nbsp;the&nbsp;project</span><br style="font-size:inherit;color:inherit;line-height:inherit;">ROOT_DIR&nbsp;=&nbsp;Path(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"."</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Directory&nbsp;to&nbsp;save&nbsp;logs&nbsp;and&nbsp;trained&nbsp;model</span><br style="font-size:inherit;color:inherit;line-height:inherit;">MODEL_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"logs"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Local&nbsp;path&nbsp;to&nbsp;trained&nbsp;weights&nbsp;file</span><br style="font-size:inherit;color:inherit;line-height:inherit;">COCO_MODEL_PATH&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"mask_rcnn_coco.h5"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Download&nbsp;COCO&nbsp;trained&nbsp;weights&nbsp;from&nbsp;Releases&nbsp;if&nbsp;needed</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">not</span>&nbsp;os.path.exists(COCO_MODEL_PATH):<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;mrcnn.utils.download_trained_weights(COCO_MODEL_PATH)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Directory&nbsp;of&nbsp;images&nbsp;to&nbsp;run&nbsp;detection&nbsp;on</span><br style="font-size:inherit;color:inherit;line-height:inherit;">IMAGE_DIR&nbsp;=&nbsp;os.path.join(ROOT_DIR,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"images"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Video&nbsp;file&nbsp;or&nbsp;camera&nbsp;to&nbsp;process&nbsp;-&nbsp;set&nbsp;this&nbsp;to&nbsp;0&nbsp;to&nbsp;use&nbsp;your&nbsp;webcam&nbsp;instead&nbsp;of&nbsp;a&nbsp;video&nbsp;file</span><br style="font-size:inherit;color:inherit;line-height:inherit;">VIDEO_SOURCE&nbsp;=&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"test_images/parking.mp4"</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Create&nbsp;a&nbsp;Mask-RCNN&nbsp;model&nbsp;in&nbsp;inference&nbsp;mode</span><br style="font-size:inherit;color:inherit;line-height:inherit;">model&nbsp;=&nbsp;MaskRCNN(mode=<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"inference"</span>,&nbsp;model_dir=MODEL_DIR,&nbsp;config=MaskRCNNConfig())<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Load&nbsp;pre-trained&nbsp;model</span><br style="font-size:inherit;color:inherit;line-height:inherit;">model.load_weights(COCO_MODEL_PATH,&nbsp;by_name=<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">True</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Location&nbsp;of&nbsp;parking&nbsp;spaces</span><br style="font-size:inherit;color:inherit;line-height:inherit;">parked_car_boxes&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">None</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Load&nbsp;the&nbsp;video&nbsp;file&nbsp;we&nbsp;want&nbsp;to&nbsp;run&nbsp;detection&nbsp;on</span><br style="font-size:inherit;color:inherit;line-height:inherit;">video_capture&nbsp;=&nbsp;cv2.VideoCapture(VIDEO_SOURCE)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;How&nbsp;many&nbsp;frames&nbsp;of&nbsp;video&nbsp;we ve&nbsp;seen&nbsp;in&nbsp;a&nbsp;row&nbsp;with&nbsp;a&nbsp;parking&nbsp;space&nbsp;open</span><br style="font-size:inherit;color:inherit;line-height:inherit;">free_space_frames&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Have&nbsp;we&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;alert&nbsp;yet?</span><br style="font-size:inherit;color:inherit;line-height:inherit;">sms_sent&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">False</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Loop&nbsp;over&nbsp;each&nbsp;frame&nbsp;of&nbsp;video</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">while</span>&nbsp;video_capture.isOpened():<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;success,&nbsp;frame&nbsp;=&nbsp;video_capture.read()<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">not</span>&nbsp;success:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">break</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Convert&nbsp;the&nbsp;image&nbsp;from&nbsp;BGR&nbsp;color&nbsp;(which&nbsp;OpenCV&nbsp;uses)&nbsp;to&nbsp;RGB&nbsp;color</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;rgb_image&nbsp;=&nbsp;frame[:,&nbsp;:,&nbsp;::<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">-1</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Run&nbsp;the&nbsp;image&nbsp;through&nbsp;the&nbsp;Mask&nbsp;R-CNN&nbsp;model&nbsp;to&nbsp;get&nbsp;results.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;results&nbsp;=&nbsp;model.detect([rgb_image],&nbsp;verbose=<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Mask&nbsp;R-CNN&nbsp;assumes&nbsp;we&nbsp;are&nbsp;running&nbsp;detection&nbsp;on&nbsp;multiple&nbsp;images.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;We&nbsp;only&nbsp;passed&nbsp;in&nbsp;one&nbsp;image&nbsp;to&nbsp;detect,&nbsp;so&nbsp;only&nbsp;grab&nbsp;the&nbsp;first&nbsp;result.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;results[<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>]<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;The&nbsp;r&nbsp;variable&nbsp;will&nbsp;now&nbsp;have&nbsp;the&nbsp;results&nbsp;of&nbsp;detection:</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ rois ]&nbsp;are&nbsp;the&nbsp;bounding&nbsp;box&nbsp;of&nbsp;each&nbsp;detected&nbsp;object</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ class_ids ]&nbsp;are&nbsp;the&nbsp;class&nbsp;id&nbsp;(type)&nbsp;of&nbsp;each&nbsp;detected&nbsp;object</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ scores ]&nbsp;are&nbsp;the&nbsp;confidence&nbsp;scores&nbsp;for&nbsp;each&nbsp;detection</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;-&nbsp;r[ masks ]&nbsp;are&nbsp;the&nbsp;object&nbsp;masks&nbsp;for&nbsp;each&nbsp;detected&nbsp;object&nbsp;(which&nbsp;gives&nbsp;you&nbsp;the&nbsp;object&nbsp;outline)</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;parked_car_boxes&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">is</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">None</span>:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;This&nbsp;is&nbsp;the&nbsp;first&nbsp;frame&nbsp;of&nbsp;video&nbsp;-&nbsp;assume&nbsp;all&nbsp;the&nbsp;cars&nbsp;detected&nbsp;are&nbsp;in&nbsp;parking&nbsp;spaces.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Save&nbsp;the&nbsp;location&nbsp;of&nbsp;each&nbsp;car&nbsp;as&nbsp;a&nbsp;parking&nbsp;space&nbsp;box&nbsp;and&nbsp;go&nbsp;to&nbsp;the&nbsp;next&nbsp;frame&nbsp;of&nbsp;video.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parked_car_boxes&nbsp;=&nbsp;get_car_boxes(r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> rois </span>],&nbsp;r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> class_ids </span>])<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">else</span>:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;We&nbsp;already&nbsp;know&nbsp;where&nbsp;the&nbsp;parking&nbsp;spaces&nbsp;are.&nbsp;Check&nbsp;if&nbsp;any&nbsp;are&nbsp;currently&nbsp;unoccupied.</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Get&nbsp;where&nbsp;cars&nbsp;are&nbsp;currently&nbsp;located&nbsp;in&nbsp;the&nbsp;frame</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;car_boxes&nbsp;=&nbsp;get_car_boxes(r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> rois </span>],&nbsp;r[<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> class_ids </span>])<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;See&nbsp;how&nbsp;much&nbsp;those&nbsp;cars&nbsp;overlap&nbsp;with&nbsp;the&nbsp;known&nbsp;parking&nbsp;spaces</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overlaps&nbsp;=&nbsp;mrcnn.utils.compute_overlaps(parked_car_boxes,&nbsp;car_boxes)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Assume&nbsp;no&nbsp;spaces&nbsp;are&nbsp;free&nbsp;until&nbsp;we&nbsp;find&nbsp;one&nbsp;that&nbsp;is&nbsp;free</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">False</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Loop&nbsp;through&nbsp;each&nbsp;known&nbsp;parking&nbsp;space&nbsp;box</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">for</span>&nbsp;parking_area,&nbsp;overlap_areas&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">in</span>&nbsp;zip(parked_car_boxes,&nbsp;overlaps):<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;For&nbsp;this&nbsp;parking&nbsp;space,&nbsp;find&nbsp;the&nbsp;max&nbsp;amount&nbsp;it&nbsp;was&nbsp;covered&nbsp;by&nbsp;any</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;car&nbsp;that&nbsp;was&nbsp;detected&nbsp;in&nbsp;our&nbsp;image&nbsp;(doesn t&nbsp;really&nbsp;matter&nbsp;which&nbsp;car)</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_IoU_overlap&nbsp;=&nbsp;np.max(overlap_areas)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Get&nbsp;the&nbsp;top-left&nbsp;and&nbsp;bottom-right&nbsp;coordinates&nbsp;of&nbsp;the&nbsp;parking&nbsp;area</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1,&nbsp;x1,&nbsp;y2,&nbsp;x2&nbsp;=&nbsp;parking_area<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Check&nbsp;if&nbsp;the&nbsp;parking&nbsp;space&nbsp;is&nbsp;occupied&nbsp;by&nbsp;seeing&nbsp;if&nbsp;any&nbsp;car&nbsp;overlaps</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;it&nbsp;by&nbsp;more&nbsp;than&nbsp;0.15&nbsp;using&nbsp;IoU</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;max_IoU_overlap&nbsp;&lt;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.15</span>:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Parking&nbsp;space&nbsp;not&nbsp;occupied!&nbsp;Draw&nbsp;a&nbsp;green&nbsp;box&nbsp;around&nbsp;it</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>),&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">3</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Flag&nbsp;that&nbsp;we&nbsp;have&nbsp;seen&nbsp;at&nbsp;least&nbsp;one&nbsp;open&nbsp;space</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">True</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">else</span>:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Parking&nbsp;space&nbsp;is&nbsp;still&nbsp;occupied&nbsp;-&nbsp;draw&nbsp;a&nbsp;red&nbsp;box&nbsp;around&nbsp;it</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.rectangle(frame,&nbsp;(x1,&nbsp;y1),&nbsp;(x2,&nbsp;y2),&nbsp;(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>),&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Write&nbsp;the&nbsp;IoU&nbsp;measurement&nbsp;inside&nbsp;the&nbsp;box</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">f"<span class="hljs-subst" style="line-height:inherit;">{max_IoU_overlap:<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.2</span>}</span>"</span>,&nbsp;(x1&nbsp;+&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">6</span>,&nbsp;y2&nbsp;-&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">6</span>),&nbsp;font,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0.3</span>,&nbsp;(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>))<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;If&nbsp;at&nbsp;least&nbsp;one&nbsp;space&nbsp;was&nbsp;free,&nbsp;start&nbsp;counting&nbsp;frames</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;This&nbsp;is&nbsp;so&nbsp;we&nbsp;don t&nbsp;alert&nbsp;based&nbsp;on&nbsp;one&nbsp;frame&nbsp;of&nbsp;a&nbsp;spot&nbsp;being&nbsp;open.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;This&nbsp;helps&nbsp;prevent&nbsp;the&nbsp;script&nbsp;triggered&nbsp;on&nbsp;one&nbsp;bad&nbsp;detection.</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;free_space:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;+=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">else</span>:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;If&nbsp;no&nbsp;spots&nbsp;are&nbsp;free,&nbsp;reset&nbsp;the&nbsp;count</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_space_frames&nbsp;=&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;If&nbsp;a&nbsp;space&nbsp;has&nbsp;been&nbsp;free&nbsp;for&nbsp;several&nbsp;frames,&nbsp;we&nbsp;are&nbsp;pretty&nbsp;sure&nbsp;it&nbsp;is&nbsp;really&nbsp;free!</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;free_space_frames&nbsp;&gt;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">10</span>:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Write&nbsp;SPACE&nbsp;AVAILABLE!!&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;screen</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font&nbsp;=&nbsp;cv2.FONT_HERSHEY_DUPLEX<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.putText(frame,&nbsp;<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">f"SPACE&nbsp;AVAILABLE!"</span>,&nbsp;(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">10</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">150</span>),&nbsp;font,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">3.0</span>,&nbsp;(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">255</span>,&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0</span>),&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">2</span>,&nbsp;cv2.FILLED)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;If&nbsp;we&nbsp;haven t&nbsp;sent&nbsp;an&nbsp;SMS&nbsp;yet,&nbsp;sent&nbsp;it!</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">not</span>&nbsp;sms_sent:<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"SENDING&nbsp;SMS!!!"</span>)<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;=&nbsp;client.messages.create(<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body=<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;">"Parking&nbsp;space&nbsp;open&nbsp;-&nbsp;go&nbsp;go&nbsp;go!"</span>,<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_=twilio_phone_number,<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to=destination_phone_number<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sms_sent&nbsp;=&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">True</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Show&nbsp;the&nbsp;frame&nbsp;of&nbsp;video&nbsp;on&nbsp;the&nbsp;screen</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv2.imshow(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> Video </span>,&nbsp;frame)<br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Hit&nbsp; q &nbsp;to&nbsp;quit</span><br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">if</span>&nbsp;cv2.waitKey(<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">1</span>)&nbsp;&amp;&nbsp;<span class="hljs-number" style="font-size:inherit;color:rgb(174,135,250);line-height:inherit;">0xFF</span>&nbsp;==&nbsp;ord(<span class="hljs-string" style="font-size:inherit;color:rgb(238,220,112);line-height:inherit;"> q </span>):<br style="font-size:inherit;color:inherit;line-height:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="font-size:inherit;color:rgb(248,35,117);line-height:inherit;">break</span><br style="font-size:inherit;color:inherit;line-height:inherit;"><br style="font-size:inherit;color:inherit;line-height:inherit;"><span class="hljs-comment" style="font-size:inherit;color:rgb(128,128,128);line-height:inherit;">#&nbsp;Clean&nbsp;up&nbsp;everything&nbsp;when&nbsp;finished</span><br style="font-size:inherit;color:inherit;line-height:inherit;">video_capture.release()<br style="font-size:inherit;color:inherit;line-height:inherit;">cv2.destroyAllWindows()</p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">要运行这份代码，你首先需要安装 python 3.6+，Matterport Mask R-CNN 以及 OpenCV。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">我特意保留了比较简单的代码。例如，它只是假设第一帧视频中出现的任何车辆都是停放的汽车。试用一下，看看你是否能够提升它的可用性。</span></p>
   <p><br></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;">不必担心为了在其它场景中使用而修改代码。仅仅改变模型寻找的目标 ID，你就能够将这份代码完全转换成另一个东西。例如，假设你在滑雪场工作。经过一些调整，你就可以将这份脚本转换为一个系统，它可以自动检测滑雪板从斜坡上跳越，并创建出很酷的滑雪板跳越路线。或者如果你在野生动物保护区工作，你可以将这份代码转换成一个统计野生斑马数量的系统。唯一的限制只是你的想象力。祝你玩得开心！</span></p>
   <p style="text-align:justify;line-height:1.75em;margin-left:16px;"><span style="font-size:15px;"><br></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><span style="text-decoration:underline;color:rgb(0,0,0);"><strong>推荐阅读</strong></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><strong><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488301&amp;idx=1&amp;sn=a89b4916a5f377afe8349c6db76436c9&amp;chksm=97ea3948a09db05e664d60ab8226149761b65892c8f073a025111abd0d2b12809fa952c4b536&amp;scene=21#wechat_redirect" rel="nofollow">人大、华中科大、西安交大等四所高校成立AI学院，国内高校AI学院已达38所</a></strong></span><span style="text-decoration:underline;color:rgb(0,0,0);"><strong><br></strong></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><strong><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488297&amp;idx=1&amp;sn=d570b364e4328db87b1d4d910d370c1e&amp;chksm=97ea394ca09db05a8a8d8a11953c6f014175e598c3c329c4b59ab9cd87870c3d476e30973e67&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">《AI世界生存指南》</a></strong></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><strong><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488293&amp;idx=1&amp;sn=b2f4f6c43125f77cde916f1fa4db3533&amp;chksm=97ea3940a09db05607bdd67c3cbf236874d47d713deb03514648ffce68f10a26f5a1c108f70c&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">「击败星际争霸II职业玩家」的 AlphaStar是在作弊？</a></strong></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><strong><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488289&amp;idx=1&amp;sn=21861daf6e15bde5a5dcc19be1c6157d&amp;chksm=97ea3944a09db052528ff69d16b4bf34d07a6f39744e1c85370decb9730dcb124d6742772ed1&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">7 步快速入门 Python3</a></strong></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><strong><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488285&amp;idx=1&amp;sn=efd58c661a10381c2d1d4d671dfd4de1&amp;chksm=97ea3978a09db06e04defa640685872f987fa5fbec57d4a5edbd785c3e54997d64a240cf9e98&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">“一人单挑&amp;nbsp;BAT”，黑客张福：我要的东西，比钱更贵</a></strong></span></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><strong><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488281&amp;idx=1&amp;sn=55c4a7ff029336b143aeb561d02e13ed&amp;chksm=97ea397ca09db06a35e3b5e696eabf8535d51a5481e7b7103150bc25d4594b545030a210105b&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">同一天这是巧合吗？吴恩达、谷歌、Facebook纷纷开源数据集</a><br></span></strong></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><strong><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488281&amp;idx=2&amp;sn=6a1497c854748f0d59c2db8ed5f9ef20&amp;chksm=97ea397ca09db06af53f0a07a0aa2997617176c9fac47bf9510beb83eed07155af54db3a14c0&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">21个GIF动图让你了解各种数学概念</a></span></strong></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><strong><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><a href="https://blog.csdn.net/dQCFKyQDXYm3F8rB0/article/details/86619640" rel="nofollow">微信真要做操作系统了？</a><br></span></strong></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><strong><span style="text-decoration:underline;color:rgb(0,0,0);font-size:14px;"><a href="http://mp.weixin.qq.com/s?__biz=MzIxODM4MjA5MA==&amp;mid=2247488275&amp;idx=3&amp;sn=80d61bd721d5b7da6cfca1eab9b26f5c&amp;chksm=97ea3976a09db060fac9e82a48f0cb510fde3e53f1cfe5e14866b31f1cacdc92b59af7d0db01&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);">下载最新教程《ArtificalNeuralNetworks》</a></span></strong></p>
   <p style="min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><br></p>
   <p style="margin-left:16px;min-height:1em;letter-spacing:.544px;color:rgb(63,63,63);font-size:16px;font-family:'微软雅黑';text-align:center;"><img style="border-width:0px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/KdayOo3PqHDIurOfIatYehahcqXDLC7d51EsSdVb7Ulu1bOWmfhtfDYxESJ9uwtcwibicicKicZem0uDo3cFnSRKow/640?wx_fmt=png" alt="640?wx_fmt=png"></p> 
  </div> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0d1dbe5a3e5863242418b768d1601633";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>

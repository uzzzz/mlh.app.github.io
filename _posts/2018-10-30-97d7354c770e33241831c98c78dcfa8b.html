---
layout: default
title: 以太坊源码解读（3）以太坊启动流程简析
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-2c6a5211c9.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Cp%3E%3Cstrong%3E%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%EF%BC%9A%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cblockquote%3E+%0A+++%3Cp%3Egeth+--identity+%22TestNode1%22+--datadir+%22data0%22+--rpc+--rpcapi+%22db%2Ceth%2Cnet%2Cweb3%22+--port+%2230303%22+--networkid+%2229382%22+--ws+--wsorigins%3D%22*%22+--rpccorsdomain%3D%22*%22+console%3C%2Fp%3E+%0A++%3C%2Fblockquote%3E+%0A++%3Cp%3E%E5%90%AF%E5%8A%A8%E5%90%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BB%8E%E6%97%A5%E5%BF%97%E6%9D%A5%E5%88%86%E6%9E%90%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E7%9A%84%E6%B5%81%E7%A8%8B%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-javascript%22%3EINFO+%5B10-29%7C12%3A27%3A11.737%5D+Maximum+peer+count%0AINFO+%5B10-29%7C12%3A27%3A11.747%5D+Starting+peer-to-peer+node++%2F%2F+node%2Fnode.go%0AINFO+%5B10-29%7C12%3A27%3A11.747%5D+Allocated+cache+and+file+handles++%2F%2F+%0AINFO+%5B10-29%7C12%3A27%3A11.763%5D+Initialised+chain+configuration+++%2F%2F+eth%2Fbackend.go%0AINFO+%5B10-29%7C12%3A27%3A11.763%5D+Disk+storage+enabled+for+ethash+caches+%2F%2F+consensus%2Fethash%2Fethash.go%0AINFO+%5B10-29%7C12%3A27%3A11.763%5D+Disk+storage+enabled+for+ethash+DAGs+%0AINFO+%5B10-29%7C12%3A27%3A11.763%5D+Initialising+Ethereum+protocol%0AWARN+%5B10-29%7C12%3A27%3A11.765%5D+Head+state+missing%2C+repairing+chain+%0AINFO+%5B10-29%7C12%3A27%3A11.775%5D+Rewound+blockchain+to+past+state%0AINFO+%5B10-29%7C12%3A27%3A11.776%5D+Loaded+most+recent+local+header%0AINFO+%5B10-29%7C12%3A27%3A11.776%5D+Loaded+most+recent+local+full+block%0AINFO+%5B10-29%7C12%3A27%3A11.776%5D+Loaded+most+recent+local+fast+block%0AINFO+%5B10-29%7C12%3A27%3A11.776%5D+Loaded+local+transaction+journal%0AINFO+%5B10-29%7C12%3A27%3A11.777%5D+Regenerated+local+transaction+journal%0AWARN+%5B10-29%7C12%3A27%3A11.777%5D+Blockchain+not+empty%2C+fast+sync+disabled%0AINFO+%5B10-29%7C12%3A27%3A11.777%5D+Starting+P2P+networking%0AINFO+%5B10-29%7C12%3A27%3A13.928%5D+Mapped+network+port+%0AINFO+%5B10-29%7C12%3A27%3A13.990%5D+UDP+listener+up+++++++++++++++++++++++++%0AINFO+%5B10-29%7C12%3A27%3A13.991%5D+RLPx+listener+up++++++++++++++++++++++++%0AINFO+%5B10-29%7C12%3A27%3A13.995%5D+IPC+endpoint+opened++++++++++++++%0AINFO+%5B10-29%7C12%3A27%3A13.995%5D+HTTP+endpoint+opened+%0AINFO+%5B10-29%7C12%3A27%3A13.996%5D+WebSocket+endpoint+opened+++++%0AINFO+%5B10-29%7C12%3A27%3A14.001%5D+Mapped+network+port++++%0AWelcome+to+the+Geth+JavaScript+console%21%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch3%3E%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%9B%BE%3C%2Fh3%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F20181116100237468.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xqOTAwOTEx%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22%3E%3C%2Fp%3E+%0A++%3Ch3%3E%3Cstrong%3E%E4%B8%80%E3%80%81%E5%90%AF%E5%8A%A8%E7%9A%84main%E5%87%BD%E6%95%B0+cmd%2Fgeth%2Fmain.go%3C%2Fstrong%3E%3C%2Fh3%3E+%0A++%3Cp%3EGo%E9%87%8C%E9%9D%A2%E6%9C%89%E4%B8%A4%E4%B8%AA%E4%BF%9D%E7%95%99%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%9Ainit%E5%87%BD%E6%95%B0%EF%BC%88%E8%83%BD%E5%A4%9F%E5%BA%94%E7%94%A8%E4%BA%8E%E6%89%80%E6%9C%89%E7%9A%84package%EF%BC%89%E5%92%8Cmain%E5%87%BD%E6%95%B0%EF%BC%88%E5%8F%AA%E8%83%BD%E5%BA%94%E7%94%A8%E4%BA%8Epackage+main%EF%BC%89%E3%80%82%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%87%BD%E6%95%B0%E5%9C%A8%E5%AE%9A%E4%B9%89%E6%97%B6%E4%B8%8D%E8%83%BD%E6%9C%89%E4%BB%BB%E4%BD%95%E7%9A%84%E5%8F%82%E6%95%B0%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E5%9C%A8cmd%2Fgeth%2Fmain.go%E4%B8%AD%EF%BC%8C%E9%A6%96%E5%85%88%E5%AE%9A%E4%B9%89app%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Ecmd%2Fgeth%2Fmain.go%0A%0Avar+%28%0A++++%2F%2F+Git+SHA1+commit+hash+of+the+release+%28set+via+linker+flags%29%0A++++gitCommit+%3D+%22%22%0A++++%2F%2F+The+app+that+holds+all+commands+and+flags.%0A++++app+%3D+utils.NewApp%28gitCommit%2C+%22the+go-ethereum+command+line+interface%22%29%0A++++%2F%2F+flags%0A++++nodeFlags+%3D+%5B%5Dcli.Flag%7B%0A%09utils.IdentityFlag%2C++++%2F%2F+%E6%89%80%E6%9C%89%E8%BF%99%E4%BA%9Bflag%E9%83%BD%E6%9D%A5%E8%87%AAcmd%2Futils%E6%A8%A1%E5%9D%97%E4%B8%AD%0A%09...%0A++++%7D%0A++++rpcFlags+%3D+%5B%5Dcli.Flag%7B...%7D%0A++++consoleFlags+%3D+%5B%5Dcli.Flag%7B...%7D++%2F%2F+%E6%9D%A5%E8%87%AAcmd%2Fgeth%2Fconsolecmd.go%0A++++whisperFlags+%3D+%5B%5Dcli.Flag%7B...%7D%0A++++metricsFlafs+%3D+%5B%5Dcli.Flag%7B...%7D%0A%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E7%84%B6%E5%90%8E%E9%80%9A%E8%BF%87init%EF%BC%88%EF%BC%89%E5%87%BD%E6%95%B0%E6%9D%A5%E5%88%9D%E5%A7%8B%E5%8C%96app%EF%BC%8C%E5%85%B6%E4%B8%ADapp.Action%E8%A1%A8%E7%A4%BA%E5%A6%82%E6%9E%9C%E7%94%A8%E6%88%B7%E6%B2%A1%E6%9C%89%E8%BE%93%E5%85%A5%E5%85%B6%E4%BB%96%E7%9A%84%E5%AD%90%E5%91%BD%E4%BB%A4%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E4%BC%9A%E8%B0%83%E7%94%A8%E8%BF%99%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%8C%87%E5%90%91%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E5%8D%B3geth%28%29%E3%80%82%3C%2Fp%3E+%0A++%3Cblockquote%3E+%0A+++%3Cp%3Egeth%E7%9A%84%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E4%BA%86urfave%2Fcli%E8%BF%99%E4%B8%AA%E5%BA%93%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%BA%93%E6%98%AFgo%E8%AF%AD%E8%A8%80%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F%E5%B8%B8%E7%94%A8%E7%9A%84%E5%BA%93%EF%BC%8C%E5%AE%83%E6%8A%8A%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90%E7%9A%84%E8%BF%87%E7%A8%8B%E5%81%9A%E4%BA%86%E4%B8%80%E4%B8%8B%E5%B0%81%E8%A3%85%EF%BC%8C%E6%8A%BD%E8%B1%A1%E5%87%BAflag%2Fcommand%2Fsubcommand%E8%BF%99%E4%BA%9B%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E6%88%B7%E5%8F%AA%E9%9C%80%E8%A6%81%E6%8F%90%E4%BE%9B%E4%B8%80%E4%BA%9B%E6%A8%A1%E5%9D%97%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8F%82%E6%95%B0%E7%9A%84%E8%A7%A3%E6%9E%90%E5%92%8C%E5%85%B3%E8%81%94%E5%9C%A8%E5%BA%93%E5%86%85%E9%83%A8%E5%AE%8C%E6%88%90%EF%BC%8C%E5%B8%AE%E5%8A%A9%E4%BF%A1%E6%81%AF%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E3%80%82%3C%2Fp%3E+%0A++%3C%2Fblockquote%3E+%0A++%3Cp%3Eapp.Flags%E5%92%8Capp.Commands%E5%88%86%E5%88%AB%E8%AE%BE%E7%BD%AE%E4%BA%86%E6%94%AF%E6%8C%81%E7%9A%84%5Boption%5D%E5%92%8C%5Bcommand%5D%EF%BC%8C%E6%98%AF%E5%BD%93%E4%BB%8E%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A7%A3%E6%9E%90%E5%87%BA%E7%9B%B8%E5%BA%94%E7%9A%84%E5%8F%82%E6%95%B0%E5%90%8E%E6%8C%87%E5%90%91%E7%89%B9%E5%AE%9A%E7%9A%84%E5%87%BD%E6%95%B0%E5%B9%B6%E6%89%A7%E8%A1%8C%E3%80%82%E8%BF%99%E9%87%8C%E5%85%88%E4%B8%8D%E5%81%9A%E4%BB%8B%E7%BB%8D%EF%BC%8C%E5%90%8E%E9%9D%A2%E4%BB%A5console%E7%9A%84%E5%90%AF%E5%8A%A8%E4%B8%BA%E4%BE%8B%E4%BB%8B%E7%BB%8D%E8%BF%99%E4%B8%80%E9%83%A8%E5%88%86%E7%9A%84%E5%8E%9F%E7%90%86%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+init%28%29+%7B%0A%09%2F%2F+Initialize+the+CLI+app+and+start+Geth%0A%09app.Action+%3D+geth%0A%09app.HideVersion+%3D+true+%2F%2F+we+have+a+command+to+print+the+version%0A%09app.Copyright+%3D+%22Copyright+2013-2018+The+go-ethereum+Authors%22%0A++++++++%2F%2F+%E6%89%80%E6%9C%89%E8%83%BD%E5%A4%9F%E6%94%AF%E6%8C%81%E7%9A%84%E5%AD%90%E5%91%BD%E4%BB%A4%0A%09app.Commands+%3D+%5B%5Dcli.Command%7B%0A%09%09%2F%2F+See+chaincmd.go%3A%0A%09%09initCommand%2C%0A++++++++++++++++...%0A%09%09%2F%2F+See+monitorcmd.go%3A%0A%09%09%2F%2F+See+accountcmd.go%3A%0A%09%09%2F%2F+See+consolecmd.go%3A%0A%09%09%2F%2F+See+misccmd.go%3A%0A%09%09%2F%2F+See+config.go%0A%09%7D%0A%09sort.Sort%28cli.CommandsByName%28app.Commands%29%29%0A++++%0A++++++++%2F%2F+%E6%89%80%E6%9C%89%E8%83%BD%E5%A4%9F%E8%A7%A3%E6%9E%90%E7%9A%84Options%0A%09app.Flags+%3D+append%28app.Flags%2C+nodeFlags...%29%0A%09app.Flags+%3D+append%28app.Flags%2C+rpcFlags...%29%0A%09app.Flags+%3D+append%28app.Flags%2C+consoleFlags...%29%0A%09app.Flags+%3D+append%28app.Flags%2C+debug.Flags...%29%0A%09app.Flags+%3D+append%28app.Flags%2C+whisperFlags...%29%0A%09app.Flags+%3D+append%28app.Flags%2C+metricsFlags...%29%0A%0A%09app.Before+%3D+func%28ctx+*cli.Context%29+error+%7B%0A+++++++++++...%0A%09%7D%0A%0A%09app.After+%3D+func%28ctx+*cli.Context%29+error+%7B%0A%09%09debug.Exit%28%29%0A%09%09console.Stdin.Close%28%29+%2F%2F+Resets+terminal+mode.%0A%09%09return+nil%0A%09%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E9%80%9A%E8%BF%87%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E5%B0%B1%E6%8A%8A%E6%88%91%E4%BB%AC%E8%A7%A3%E6%9E%90%E7%94%A8%E6%88%B7%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%AE%BE%E7%BD%AE%E5%AE%8C%E6%88%90%E4%BA%86%EF%BC%8C%E4%B8%8B%E4%B8%80%E6%AD%A5%E5%B0%B1%E6%98%AF%E6%89%A7%E8%A1%8Capp.Run%28%29%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3E%0Afunc+main%28%29+%7B%0A++++if+err+%3A%3D+app.Run%28os.Args%29%3B+err+%21%3D+nil+%7B%0A++++++++fmt.Fprintln%28os.Stderr%2C+err%29%0A++++++++os.Exit%281%29%0A++++%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%AE%A2%E6%88%B7%E7%AB%AFgeth%E4%B8%AD%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BB%80%E4%B9%88%E5%91%BD%E4%BB%A4%E9%83%BD%E4%B8%8D%E8%BE%93%E5%85%A5%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8Cgeth%EF%BC%8C+%E5%B0%B1%E4%BC%9A%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E5%85%A8%E8%8A%82%E7%82%B9%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%8A%82%E7%82%B9%EF%BC%8C%E8%BF%9E%E6%8E%A5%E5%88%B0%E4%B8%BB%E7%BD%91%E7%BB%9C%E3%80%82%E8%BF%99%E6%97%B6%E5%80%99%E5%B0%B1%E6%98%AF%E6%8C%89%E7%85%A7%E4%B8%8A%E9%9D%A2%E6%89%80%E8%AF%B4%E7%9A%84%EF%BC%8C%E5%90%AF%E5%8A%A8%E4%BA%86geth%28%29%E5%87%BD%E6%95%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Ecmd%2Fgeth%2Fmain.go%0A%0Afunc+geth%28ctx+*cli.Context%29+error+%7B%0A++++if+args+%3A%3D+ctx.Args%28%29%3B+len%28args%29+%26gt%3B+0+%7B%0A%09return+fmt.Errorf%28%22invalid+command%3A+%25q%22%2C+args%5B0%5D%29%0A++++%7D%0A++++node+%3A%3D+makeFullNode%28ctx%29++%2F%2F+%E5%AE%9A%E4%B9%89%E5%85%A8%E8%8A%82%E7%82%B9%E5%AF%B9%E8%B1%A1%0A++++startNode%28ctx%2C+node%29+++++++%2F%2F+%E5%90%AF%E5%8A%A8%E5%85%A8%E8%8A%82%E7%82%B9%0A++++node.Wait%28%29%0A++++return+nil%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch3%3E%3Cstrong%3E%E4%BA%8C%E3%80%81%E5%85%A8%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE%3C%2Fstrong%3E%3C%2Fh3%3E+%0A++%3Cp%3E%E5%9C%A8cmd%2Fgeth%2Fmain.go%E4%B8%AD%E6%9C%89%E4%B8%80%E4%B8%AAstartNode%28%29%E5%87%BD%E6%95%B0%E7%94%A8%E6%9D%A5%E5%90%AF%E5%8A%A8%E5%85%A8%E8%8A%82%E7%82%B9%EF%BC%8C%E9%A6%96%E5%85%88%E8%B0%83%E7%94%A8cmd%2Fgeth%2Fconfig.go%E4%B8%AD%E7%9A%84makeFullNode%28%29%E5%87%BD%E6%95%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+makeFullNode%28ctx+*cli.Context%29+*node.Node+%7B%0A%09stack%2C+cfg+%3A%3D+makeConfigNode%28ctx%29+%2F%2F+%E8%BF%9B%E8%A1%8C%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE%0A%0A%09utils.RegisterEthService%28stack%2C+%26amp%3Bcfg.Eth%29++%2F%2F+%E6%B3%A8%E5%86%8Ceth%E6%9C%8D%E5%8A%A1%0A%0A%09if+ctx.GlobalBool%28utils.DashboardEnabledFlag.Name%29+%7B%0A%09%09utils.RegisterDashboardService%28stack%2C+%26amp%3Bcfg.Dashboard%2C+gitCommit%29%0A%09%7D%0A%09%2F%2F+Whisper+must+be+explicitly+enabled+by+specifying+at+least+1+whisper+flag+or+in+dev+mode%0A%09shhEnabled+%3A%3D+enableWhisper%28ctx%29%0A%09shhAutoEnabled+%3A%3D+%21ctx.GlobalIsSet%28utils.WhisperEnabledFlag.Name%29+%26amp%3B%26amp%3B+ctx.GlobalIsSet%28utils.DeveloperFlag.Name%29%0A%09if+shhEnabled+%7C%7C+shhAutoEnabled+%7B%0A%09%09if+ctx.GlobalIsSet%28utils.WhisperMaxMessageSizeFlag.Name%29+%7B%0A%09%09%09cfg.Shh.MaxMessageSize+%3D+uint32%28ctx.Int%28utils.WhisperMaxMessageSizeFlag.Name%29%29%0A%09%09%7D%0A%09%09if+ctx.GlobalIsSet%28utils.WhisperMinPOWFlag.Name%29+%7B%0A%09%09%09cfg.Shh.MinimumAcceptedPOW+%3D+ctx.Float64%28utils.WhisperMinPOWFlag.Name%29%0A%09%09%7D%0A%09%09utils.RegisterShhService%28stack%2C+%26amp%3Bcfg.Shh%29%0A%09%7D%0A%0A%09%2F%2F+Add+the+Ethereum+Stats+daemon+if+requested.%0A%09if+cfg.Ethstats.URL+%21%3D+%22%22+%7B%0A%09%09utils.RegisterEthStatsService%28stack%2C+cfg.Ethstats.URL%29%0A%09%7D%0A%09return+stack%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%EF%BC%8CmakeFullNode%E9%A6%96%E5%85%88%E9%80%9A%E8%BF%87%3Cstrong%3EmakeConfigNode%28ctx%29+%3C%2Fstrong%3E%E5%AF%B9%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%3Cstrong%3E%EF%BC%8C%3C%2Fstrong%3E%E5%8C%85%E6%8B%ACEth%E3%80%81Shh%E3%80%81Node%E3%80%81Dashboard%EF%BC%8C%E8%BF%94%E5%9B%9ENode%E5%92%8Cgeth%E9%85%8D%E7%BD%AE%EF%BC%8C%E7%84%B6%E5%90%8E%E5%BC%80%E5%90%AF%E4%B8%A4%E6%9D%A1%E8%B7%AF%E7%BA%BF%EF%BC%9A1%E3%80%81%E9%80%9A%E8%BF%87Node.Start%28%29%E2%80%94%E2%80%94%26gt%3BServer.Start%28%29%E5%90%AF%E5%8A%A8p2p%E6%9C%8D%E5%8A%A1%EF%BC%9B2%E3%80%81%E9%80%9A%E8%BF%87RegisterEthService%E5%B0%86Ethereum%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%88%B0Node%E7%9A%84services+map%5Breflect.Type%5DService%E4%B8%AD%EF%BC%8C%E9%80%9A%E8%BF%87Node.Start%28%29%E6%9D%A5%E5%90%AF%E5%8A%A8Ethereum%E6%9C%8D%E5%8A%A1%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+makeConfigNode%28ctx+*cli.Context%29+%28*node.Node%2C+gethConfig%29+%7B%0A%09%2F%2F+Load+defaults.%0A%09cfg+%3A%3D+gethConfig%7B%0A%09%09Eth%3A+++++++eth.DefaultConfig%2C%0A%09%09Shh%3A+++++++whisper.DefaultConfig%2C%0A%09%09Node%3A++++++defaultNodeConfig%28%29%2C%0A%09%09Dashboard%3A+dashboard.DefaultConfig%2C%0A%09%7D%0A%0A%09%2F%2F+Load+config+file.%0A%09if+file+%3A%3D+ctx.GlobalString%28configFileFlag.Name%29%3B+file+%21%3D+%22%22+%7B%0A%09%09if+err+%3A%3D+loadConfig%28file%2C+%26amp%3Bcfg%29%3B+err+%21%3D+nil+%7B%0A%09%09%09utils.Fatalf%28%22%25v%22%2C+err%29%0A%09%09%7D%0A%09%7D%0A%0A%09%2F%2F+Apply+flags.%0A%09utils.SetNodeConfig%28ctx%2C+%26amp%3Bcfg.Node%29%0A%09stack%2C+err+%3A%3D+node.New%28%26amp%3Bcfg.Node%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09utils.Fatalf%28%22Failed+to+create+the+protocol+stack%3A+%25v%22%2C+err%29%0A%09%7D%0A%09utils.SetEthConfig%28ctx%2C+stack%2C+%26amp%3Bcfg.Eth%29%0A%09if+ctx.GlobalIsSet%28utils.EthStatsURLFlag.Name%29+%7B%0A%09%09cfg.Ethstats.URL+%3D+ctx.GlobalString%28utils.EthStatsURLFlag.Name%29%0A%09%7D%0A%0A%09utils.SetShhConfig%28ctx%2C+stack%2C+%26amp%3Bcfg.Shh%29%0A%09utils.SetDashboardConfig%28ctx%2C+%26amp%3Bcfg.Dashboard%29%0A%0A%09return+stack%2C+cfg%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch3%3E%E4%B8%89%E3%80%81%E6%B3%A8%E5%86%8CETH%E6%9C%8D%E5%8A%A1%3C%2Fh3%3E+%0A++%3Cp%3EmakeFullNode%28%29%E5%87%BD%E6%95%B0%E9%87%8C%E5%9C%A8%E5%81%9A%E5%A5%BD%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%86%8D%E8%B0%83%E7%94%A8cmd%2Futils%2Fflag.go%E9%87%8CRegisterEthService%28%29%E5%87%BD%E6%95%B0%E6%B3%A8%E5%86%8Ceth%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%80%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%98%AF%E8%B0%83%E7%94%A8%E4%BA%86node%2Fnode.go%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84Register%28%29%E6%96%B9%E6%B3%95+%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%82%E6%95%B0%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%EF%BC%88constructor%EF%BC%89%EF%BC%8C%E6%AD%A3%E5%A6%82%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%80%E7%A4%BA%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Ecmd%2Futils%2Fflag.go%0A%0Afunc+RegisterEthService%28stack+*node.Node%2C+cfg+*eth.Config%29+%7B%0A%09var+err+error%0A%09if+cfg.SyncMode+%3D%3D+downloader.LightSync+%7B%0A%09%09err+%3D+stack.Register%28func%28ctx+*node.ServiceContext%29+%28node.Service%2C+error%29+%7B%0A%09%09%09return+les.New%28ctx%2C+cfg%29%0A%09%09%7D%29%0A%09%7D+else+%7B%0A%09%09err+%3D+stack.Register%28func%28ctx+*node.ServiceContext%29+%28node.Service%2C+error%29+%7B%0A%09%09%09fullNode%2C+err+%3A%3D+eth.New%28ctx%2C+cfg%29%0A%09%09%09if+fullNode+%21%3D+nil+%26amp%3B%26amp%3B+cfg.LightServ+%26gt%3B+0+%7B%0A%09%09%09%09ls%2C+_+%3A%3D+les.NewLesServer%28fullNode%2C+cfg%29%0A%09%09%09%09fullNode.AddLesServer%28ls%29%0A%09%09%09%7D%0A%09%09%09return+fullNode%2C+err%0A%09%09%7D%29%0A%09%7D%0A%09if+err+%21%3D+nil+%7B%0A%09%09Fatalf%28%22Failed+to+register+the+Ethereum+service%3A+%25v%22%2C+err%29%0A%09%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E9%87%8C%E4%BC%9A%E5%88%A4%E6%96%AD%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8F+%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%98%AFLightSync%E5%88%99%E4%BC%9A%E4%BD%BF%E7%94%A8les.New%28%29%E5%88%9B%E5%BB%BA%E8%BD%BB%E8%8A%82%E7%82%B9%EF%BC%8C%E5%90%A6%E5%88%99%E5%B0%B1%E4%BD%BF%E7%94%A8eth.New%28%29%E5%88%9B%E5%BB%BA%E5%85%A8%E8%8A%82%E7%82%B9%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E8%BF%98%E6%98%AF%E5%BB%BA%E7%AB%8B%E5%85%A8%E8%8A%82%E7%82%B9%EF%BC%8C%E5%8D%B3%E8%B0%83%E7%94%A8eth.New%28%29%E6%96%B9%E6%B3%95%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Eeth%2Fbackend.go%0A%0Afunc+New%28ctx+*node.ServiceContext%2C+config+*Config%29+%28*Ethereum%2C+error%29+%7B%0A++++...%0A++++chainDb%2C+err+%3A%3D+CreateDB%28ctx%2C+config%2C+%22chaindata%22%29%0A++++...%0A++++chainConfig%2C+genesisHash%2C+genesisErr+%3A%3D+core.SetupGenesisBlock%28chainDb%2C+config.Genesis%29%0A++++if+_%2C+ok+%3A%3D+genesisErr.%28*params.ConfigCompatError%29%3B+genesisErr+%21%3D+nil+%26amp%3B%26amp%3B+%21ok+%7B%0A%09return+nil%2C+genesisErr%0A++++%7D%0A++++log.Info%28%22Initialised+chain+configuration%22%2C+%22config%22%2C+chainConfig%29%0A%0A++++eth+%3A%3D+%26amp%3BEthereum%7B%0A%09%09config%3A+++++++++config%2C%0A%09%09chainDb%3A++++++++chainDb%2C%0A%09%09chainConfig%3A++++chainConfig%2C%0A%09%09eventMux%3A+++++++ctx.EventMux%2C%0A%09%09accountManager%3A+ctx.AccountManager%2C%0A%09%09engine%3A+++++++++CreateConsensusEngine%28ctx%2C+chainConfig%2C+%26amp%3Bconfig.Ethash%2C+config.MinerNotify%2C+chainDb%29%2C%0A%09%09shutdownChan%3A+++make%28chan+bool%29%2C%0A%09%09networkID%3A++++++config.NetworkId%2C%0A%09%09gasPrice%3A+++++++config.GasPrice%2C%0A%09%09etherbase%3A++++++config.Etherbase%2C%0A%09%09bloomRequests%3A++make%28chan+chan+*bloombits.Retrieval%29%2C%0A%09%09bloomIndexer%3A+++NewBloomIndexer%28chainDb%2C+params.BloomBitsBlocks%2C+bloomConfirms%29%2C%0A++++%7D%0A%0A++++log.Info%28%22Initialising+Ethereum+protocol%22%2C+%22versions%22%2C+ProtocolVersions%2C+%22network%22%2C+config.NetworkId%29%0A++++...%0A++++var+%28%0A%09vmConfig++++%3D+vm.Config%7BEnablePreimageRecording%3A+config.EnablePreimageRecording%7D%0A%09cacheConfig+%3D+%26amp%3Bcore.CacheConfig%7BDisabled%3A+config.NoPruning%2C+TrieNodeLimit%3A+config.TrieCache%2C+TrieTimeLimit%3A+config.TrieTimeout%7D%0A++++%29%0A++++eth.blockchain%2C+err+%3D+core.NewBlockChain%28chainDb%2C+cacheConfig%2C+eth.chainConfig%2C+eth.engine%2C+vmConfig%29%0A++++if+err+%21%3D+nil+%7B%0A%09return+nil%2C+err%0A++++%7D%0A++++%2F%2F+Rewind+the+chain+in+case+of+an+incompatible+config+upgrade.%0A++++if+compat%2C+ok+%3A%3D+genesisErr.%28*params.ConfigCompatError%29%3B+ok+%7B%0A%09log.Warn%28%22Rewinding+chain+to+upgrade+configuration%22%2C+%22err%22%2C+compat%29%0A%09eth.blockchain.SetHead%28compat.RewindTo%29%0A%09rawdb.WriteChainConfig%28chainDb%2C+genesisHash%2C+chainConfig%29%0A++++%7D%0A++++eth.bloomIndexer.Start%28eth.blockchain%29%0A%0A++++if+config.TxPool.Journal+%21%3D+%22%22+%7B%0A%09config.TxPool.Journal+%3D+ctx.ResolvePath%28config.TxPool.Journal%29%0A++++%7D%0A++++eth.txPool+%3D+core.NewTxPool%28config.TxPool%2C+eth.chainConfig%2C+eth.blockchain%29%0A%0A++++if+eth.protocolManager%2C+err+%3D+NewProtocolManager%28eth.chainConfig%2C+config.SyncMode%2C+config.NetworkId%2C+eth.eventMux%2C+eth.txPool%2C+eth.engine%2C+eth.blockchain%2C+chainDb%29%3B+err+%21%3D+nil+%7B%0A%09return+nil%2C+err%0A++++%7D%0A%0A++++eth.miner+%3D+miner.New%28eth%2C+eth.chainConfig%2C+eth.EventMux%28%29%2C+eth.engine%29%0A++++eth.miner.SetExtra%28makeExtraData%28config.ExtraData%29%29%0A%0A++++eth.APIBackend+%3D+%26amp%3BEthAPIBackend%7Beth%2C+nil%7D%0A++++gpoParams+%3A%3D+config.GPO%0A++++if+gpoParams.Default+%3D%3D+nil+%7B%0A%09gpoParams.Default+%3D+config.GasPrice%0A++++%7D%0A++++eth.APIBackend.gpo+%3D+gasprice.NewOracle%28eth.APIBackend%2C+gpoParams%29%0A%0A++++return+eth%2C+nil%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%80%BB%E4%BD%93%E4%B8%8A%E7%9C%8B%E6%9D%A5%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%BB%E8%A6%81%E6%98%AF%E6%89%A7%E8%A1%8C%E4%BA%86%E4%BB%A5%E4%B8%8B%E5%87%A0%E6%AD%A5%EF%BC%9A%3Cbr%3E+1%E3%80%81%E5%8A%A0%E8%BD%BD%E5%88%9B%E5%A7%8B%E5%8C%BA%E5%9D%97%3Cbr%3E+2%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%B1%BB%3Cbr%3E+3%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96BlookChain%3Cbr%3E+4%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%A4%E6%98%93%E6%B1%A0%3Cbr%3E+5%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%E5%99%A8%3Cbr%3E+6%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8C%96%E7%9F%BF%E6%A8%A1%E5%BC%8F%3C%2Fp%3E+%0A++%3Ch3%3E%E5%9B%9B%E3%80%81%E5%90%AF%E5%8A%A8P2P%E7%BD%91%E7%BB%9C%3C%2Fh3%3E+%0A++%3Cp%3E%E5%9B%9E%E5%88%B0cmd%2Fgeth%2Fmain.go%EF%BC%8C%E5%9C%A8%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90%E5%90%8E%E6%89%A7%E8%A1%8CstartNode%28%29%E5%87%BD%E6%95%B0%E3%80%82startNode%28%29%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E6%9C%89%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E1%E3%80%81%E5%90%AF%E5%8A%A8node%EF%BC%9B%3Cbr%3E+2%E3%80%81%E8%A7%A3%E9%94%81%E8%B4%A6%E6%88%B7%EF%BC%9B%3Cbr%3E+3%E3%80%81%E5%BC%80%E5%90%AF%E9%92%B1%E5%8C%85%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%EF%BC%9B%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+startNode%28ctx+*cli.Context%2C+stack+*node.Node%29+%7B%0A%09debug.Memsize.Add%28%22node%22%2C+stack%29%0A%0A%09%2F%2F+Start+up+the+node+itself%0A%09utils.StartNode%28stack%29%0A%0A%09%2F%2F+Unlock+any+account+specifically+requested%0A%09ks+%3A%3D+stack.AccountManager%28%29.Backends%28keystore.KeyStoreType%29%5B0%5D.%28*keystore.KeyStore%29%0A%0A%09passwords+%3A%3D+utils.MakePasswordList%28ctx%29%0A%09unlocks+%3A%3D+strings.Split%28ctx.GlobalString%28utils.UnlockedAccountFlag.Name%29%2C+%22%2C%22%29%0A%09for+i%2C+account+%3A%3D+range+unlocks+%7B%0A%09%09if+trimmed+%3A%3D+strings.TrimSpace%28account%29%3B+trimmed+%21%3D+%22%22+%7B%0A%09%09%09unlockAccount%28ctx%2C+ks%2C+trimmed%2C+i%2C+passwords%29%0A%09%09%7D%0A%09%7D%0A%09%2F%2F+Register+wallet+event+handlers+to+open+and+auto-derive+wallets%0A%09events+%3A%3D+make%28chan+accounts.WalletEvent%2C+16%29%0A%09stack.AccountManager%28%29.Subscribe%28events%29%0A%0A%09go+func%28%29+%7B%0A%09%09%2F%2F+Create+a+chain+state+reader+for+self-derivation%0A%09%09rpcClient%2C+err+%3A%3D+stack.Attach%28%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09utils.Fatalf%28%22Failed+to+attach+to+self%3A+%25v%22%2C+err%29%0A%09%09%7D%0A%09%09stateReader+%3A%3D+ethclient.NewClient%28rpcClient%29%0A%0A%09%09%2F%2F+Open+any+wallets+already+attached%0A%09%09for+_%2C+wallet+%3A%3D+range+stack.AccountManager%28%29.Wallets%28%29+%7B%0A%09%09%09if+err+%3A%3D+wallet.Open%28%22%22%29%3B+err+%21%3D+nil+%7B%0A%09%09%09%09log.Warn%28%22Failed+to+open+wallet%22%2C+%22url%22%2C+wallet.URL%28%29%2C+%22err%22%2C+err%29%0A%09%09%09%7D%0A%09%09%7D%0A%09%09%2F%2F+Listen+for+wallet+event+till+termination%0A%09%09for+event+%3A%3D+range+events+%7B%0A%09%09%09switch+event.Kind+%7B%0A%09%09%09case+accounts.WalletArrived%3A%0A%09%09%09%09if+err+%3A%3D+event.Wallet.Open%28%22%22%29%3B+err+%21%3D+nil+%7B%0A%09%09%09%09%09log.Warn%28%22New+wallet+appeared%2C+failed+to+open%22%2C+%22url%22%2C+event.Wallet.URL%28%29%2C+%22err%22%2C+err%29%0A%09%09%09%09%7D%0A%09%09%09case+accounts.WalletOpened%3A%0A%09%09%09%09status%2C+_+%3A%3D+event.Wallet.Status%28%29%0A%09%09%09%09log.Info%28%22New+wallet+appeared%22%2C+%22url%22%2C+event.Wallet.URL%28%29%2C+%22status%22%2C+status%29%0A%0A%09%09%09%09derivationPath+%3A%3D+accounts.DefaultBaseDerivationPath%0A%09%09%09%09if+event.Wallet.URL%28%29.Scheme+%3D%3D+%22ledger%22+%7B%0A%09%09%09%09%09derivationPath+%3D+accounts.DefaultLedgerBaseDerivationPath%0A%09%09%09%09%7D%0A%09%09%09%09event.Wallet.SelfDerive%28derivationPath%2C+stateReader%29%0A%0A%09%09%09case+accounts.WalletDropped%3A%0A%09%09%09%09log.Info%28%22Old+wallet+dropped%22%2C+%22url%22%2C+event.Wallet.URL%28%29%29%0A%09%09%09%09event.Wallet.Close%28%29%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%28%29%0A%09%2F%2F+Start+auxiliary+services+if+enabled%0A%09if+ctx.GlobalBool%28utils.MiningEnabledFlag.Name%29+%7C%7C+ctx.GlobalBool%28utils.DeveloperFlag.Name%29+%7B%0A%09%09%2F%2F+Mining+only+makes+sense+if+a+full+Ethereum+node+is+running%0A%09%09if+ctx.GlobalString%28utils.SyncModeFlag.Name%29+%3D%3D+%22light%22+%7B%0A%09%09%09utils.Fatalf%28%22Light+clients+do+not+support+mining%22%29%0A%09%09%7D%0A%09%09var+ethereum+*eth.Ethereum%0A%09%09if+err+%3A%3D+stack.Service%28%26amp%3Bethereum%29%3B+err+%21%3D+nil+%7B%0A%09%09%09utils.Fatalf%28%22Ethereum+service+not+running%3A+%25v%22%2C+err%29%0A%09%09%7D%0A%09%09%2F%2F+Use+a+reduced+number+of+threads+if+requested%0A%09%09threads+%3A%3D+ctx.GlobalInt%28utils.MinerLegacyThreadsFlag.Name%29%0A%09%09if+ctx.GlobalIsSet%28utils.MinerThreadsFlag.Name%29+%7B%0A%09%09%09threads+%3D+ctx.GlobalInt%28utils.MinerThreadsFlag.Name%29%0A%09%09%7D%0A%09%09if+threads+%26gt%3B+0+%7B%0A%09%09%09type+threaded+interface+%7B%0A%09%09%09%09SetThreads%28threads+int%29%0A%09%09%09%7D%0A%09%09%09if+th%2C+ok+%3A%3D+ethereum.Engine%28%29.%28threaded%29%3B+ok+%7B%0A%09%09%09%09th.SetThreads%28threads%29%0A%09%09%09%7D%0A%09%09%7D%0A%09%09%2F%2F+Set+the+gas+price+to+the+limits+from+the+CLI+and+start+mining%0A%09%09gasprice+%3A%3D+utils.GlobalBig%28ctx%2C+utils.MinerLegacyGasPriceFlag.Name%29%0A%09%09if+ctx.IsSet%28utils.MinerGasPriceFlag.Name%29+%7B%0A%09%09%09gasprice+%3D+utils.GlobalBig%28ctx%2C+utils.MinerGasPriceFlag.Name%29%0A%09%09%7D%0A%09%09ethereum.TxPool%28%29.SetGasPrice%28gasprice%29%0A%09%09if+err+%3A%3D+ethereum.StartMining%28true%29%3B+err+%21%3D+nil+%7B%0A%09%09%09utils.Fatalf%28%22Failed+to+start+mining%3A+%25v%22%2C+err%29%0A%09%09%7D%0A%09%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%E9%80%9A%E8%BF%87cmd%2Futils%2Fcmd.go%E4%B8%AD%E7%9A%84StartNode%28%29%E5%87%BD%E6%95%B0%EF%BC%8C%E8%B0%83%E7%94%A8node%2Fnode.go%E4%B8%AD%E7%9A%84Start%28%29%E6%96%B9%E6%B3%95%EF%BC%8C%E5%90%AF%E5%8A%A8%E8%8A%82%E7%82%B9%E3%80%82%E5%9C%A8%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E9%A6%96%E5%85%88%E5%88%A4%E6%96%AD%E8%8A%82%E7%82%B9%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%9C%A8%E8%BF%90%E8%A1%8C%EF%BC%8C%E7%84%B6%E5%90%8E%E8%A6%81%E5%AF%B9p2p%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E6%9C%80%E5%90%8E%E6%9E%84%E5%BB%BAp2p.Server%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%89%A7%E8%A1%8C%E8%AF%A5%E5%AF%B9%E8%B1%A1%E7%9A%84Start%28%29%E6%96%B9%E6%B3%95%EF%BC%8C%E4%BD%BFp2p%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E8%B5%B7%E6%9D%A5%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+%28n+*Node%29+Start%28%29+error+%7B%0A%09n.lock.Lock%28%29%0A%09defer+n.lock.Unlock%28%29%0A%0A%09%2F%2F+Short+circuit+if+the+node%27s+already+running%0A%09if+n.server+%21%3D+nil+%7B%0A%09%09return+ErrNodeRunning%0A%09%7D%0A%09if+err+%3A%3D+n.openDataDir%28%29%3B+err+%21%3D+nil+%7B%0A%09%09return+err%0A%09%7D%0A%0A%09%2F%2F+%E5%88%9D%E5%A7%8B%E5%8C%96p2p%E6%9C%8D%E5%8A%A1%EF%BC%8C%E9%85%8D%E7%BD%AEserverConfig%EF%BC%8C%E5%B9%B6%E4%BB%A5%E6%AD%A4%E7%A9%BF%E4%BB%B6p2p.Server%E5%AE%9E%E4%BE%8B%0A%09n.serverConfig+%3D+n.config.P2P%0A%09n.serverConfig.PrivateKey+%3D+n.config.NodeKey%28%29%0A%09n.serverConfig.Name+%3D+n.config.NodeName%28%29%0A%09n.serverConfig.Logger+%3D+n.log%0A%09if+n.serverConfig.StaticNodes+%3D%3D+nil+%7B%0A%09%09n.serverConfig.StaticNodes+%3D+n.config.StaticNodes%28%29%0A%09%7D%0A%09if+n.serverConfig.TrustedNodes+%3D%3D+nil+%7B%0A%09%09n.serverConfig.TrustedNodes+%3D+n.config.TrustedNodes%28%29%0A%09%7D%0A%09if+n.serverConfig.NodeDatabase+%3D%3D+%22%22+%7B%0A%09%09n.serverConfig.NodeDatabase+%3D+n.config.NodeDB%28%29%0A%09%7D%0A%09running+%3A%3D+%26amp%3Bp2p.Server%7BConfig%3A+n.serverConfig%7D%0A%09n.log.Info%28%22Starting+peer-to-peer+node%22%2C+%22instance%22%2C+n.serverConfig.Name%29%0A%0A%09%2F%2F+Otherwise+copy+and+specialize+the+P2P+configuration%0A%09services+%3A%3D+make%28map%5Breflect.Type%5DService%29%0A%09for+_%2C+constructor+%3A%3D+range+n.serviceFuncs+%7B%0A%09%09%2F%2F+Create+a+new+context+for+the+particular+service%0A%09%09ctx+%3A%3D+%26amp%3BServiceContext%7B%0A%09%09%09config%3A+++++++++n.config%2C%0A%09%09%09services%3A+++++++make%28map%5Breflect.Type%5DService%29%2C%0A%09%09%09EventMux%3A+++++++n.eventmux%2C%0A%09%09%09AccountManager%3A+n.accman%2C%0A%09%09%7D%0A%09%09for+kind%2C+s+%3A%3D+range+services+%7B+%2F%2F+copy+needed+for+threaded+access%0A%09%09%09ctx.services%5Bkind%5D+%3D+s%0A%09%09%7D%0A%09%09%2F%2F+Construct+and+save+the+service%0A%09%09service%2C+err+%3A%3D+constructor%28ctx%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09return+err%0A%09%09%7D%0A%09%09kind+%3A%3D+reflect.TypeOf%28service%29%0A%09%09if+_%2C+exists+%3A%3D+services%5Bkind%5D%3B+exists+%7B%0A%09%09%09return+%26amp%3BDuplicateServiceError%7BKind%3A+kind%7D%0A%09%09%7D%0A%09%09services%5Bkind%5D+%3D+service%0A%09%7D%0A%09%2F%2F+Gather+the+protocols+and+start+the+freshly+assembled+P2P+server%0A%09for+_%2C+service+%3A%3D+range+services+%7B%0A%09%09running.Protocols+%3D+append%28running.Protocols%2C+service.Protocols%28%29...%29%0A%09%7D%0A%09if+err+%3A%3D+running.Start%28%29%3B+err+%21%3D+nil+%7B%0A%09%09return+convertFileLockError%28err%29%0A%09%7D%0A%09%2F%2F+Start+each+of+the+services%0A%09started+%3A%3D+%5B%5Dreflect.Type%7B%7D%0A%09for+kind%2C+service+%3A%3D+range+services+%7B%0A%09%09%2F%2F+Start+the+next+service%2C+stopping+all+previous+upon+failure%0A%09%09if+err+%3A%3D+service.Start%28running%29%3B+err+%21%3D+nil+%7B%0A%09%09%09for+_%2C+kind+%3A%3D+range+started+%7B%0A%09%09%09%09services%5Bkind%5D.Stop%28%29%0A%09%09%09%7D%0A%09%09%09running.Stop%28%29%0A%0A%09%09%09return+err%0A%09%09%7D%0A%09%09%2F%2F+Mark+the+service+started+for+potential+cleanup%0A%09%09started+%3D+append%28started%2C+kind%29%0A%09%7D%0A%09%2F%2F+Lastly+start+the+configured+RPC+interfaces%0A%09if+err+%3A%3D+n.startRPC%28services%29%3B+err+%21%3D+nil+%7B%0A%09%09for+_%2C+service+%3A%3D+range+services+%7B%0A%09%09%09service.Stop%28%29%0A%09%09%7D%0A%09%09running.Stop%28%29%0A%09%09return+err%0A%09%7D%0A%09%2F%2F+Finish+initializing+the+startup%0A%09n.services+%3D+services%0A%09n.server+%3D+running%0A%09n.stop+%3D+make%28chan+struct%7B%7D%29%0A%0A%09return+nil%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%87%B3%E6%AD%A4%EF%BC%8C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%B0%B1%E5%AE%8C%E6%88%90%E4%BA%86%E3%80%82%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Flj900911%2Farticle%2Fdetails%2F83504253%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Flj900911%2Farticle%2Fdetails%2F83504253%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E+%0A%3Cscript%3E%0A%09%09%09%09%09%09%28function%28%29%7B%0A%09%09%09%09%09%09%09function+setArticleH%28btnReadmore%2Cposi%29%7B%0A%09%09%09%09%09%09%09%09var+winH+%3D+%24%28window%29.height%28%29%3B%0A%09%09%09%09%09%09%09%09var+articleBox+%3D+%24%28%22div.article_content%22%29%3B%0A%09%09%09%09%09%09%09%09var+artH+%3D+articleBox.height%28%29%3B%0A%09%09%09%09%09%09%09%09if%28artH+%3E+winH*posi%29%7B%0A%09%09%09%09%09%09%09%09%09articleBox.css%28%7B%0A%09%09%09%09%09%09%09%09%09%09%27height%27%3AwinH*posi%2B%27px%27%2C%0A%09%09%09%09%09%09%09%09%09%09%27overflow%27%3A%27hidden%27%0A%09%09%09%09%09%09%09%09%09%7D%29%0A%09%09%09%09%09%09%09%09%09btnReadmore.click%28function%28%29%7B%0A%09%09%09%09%09%09%09%09%09%09articleBox.removeAttr%28%22style%22%29%3B%0A%09%09%09%09%09%09%09%09%09%09%24%28this%29.parent%28%29.remove%28%29%3B%0A%09%09%09%09%09%09%09%09%09%7D%29%0A%09%09%09%09%09%09%09%09%7Delse%7B%0A%09%09%09%09%09%09%09%09%09btnReadmore.parent%28%29.remove%28%29%3B%0A%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09var+btnReadmore+%3D+%24%28%22%23btn-readmore%22%29%3B%0A%09%09%09%09%09%09%09if%28btnReadmore.length%3E0%29%7B%0A%09%09%09%09%09%09%09%09if%28currentUserName%29%7B%0A%09%09%09%09%09%09%09%09%09setArticleH%28btnReadmore%2C3%29%3B%0A%09%09%09%09%09%09%09%09%7Delse%7B%0A%09%09%09%09%09%09%09%09%09setArticleH%28btnReadmore%2C1.2%29%3B%0A%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%7D%29%28%29%0A%09%09%09%09%09%3C%2Fscript%3E" | url_decode}}
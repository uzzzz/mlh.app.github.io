---
layout: default
title: 深度学习方法实现车道线分割之二(自动驾驶车道线分割)
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22article-copyright%22%3E%0A+++%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E%EF%BC%9A%E6%9C%AC%E6%96%87%E4%B8%BA%E5%8D%9A%E4%B8%BB%E5%8E%9F%E5%88%9B%E6%96%87%E7%AB%A0%EF%BC%8C%E6%9C%AA%E7%BB%8F%E5%8D%9A%E4%B8%BB%E5%85%81%E8%AE%B8%E4%B8%8D%E5%BE%97%E8%BD%AC%E8%BD%BD%E3%80%82+https%3A%2F%2Fblog.csdn.net%2Fxiao__run%2Farticle%2Fdetails%2F86497957+%0A+%3C%2Fdiv%3E+%0A+%3Cdiv+id%3D%22content_views%22+class%3D%22markdown_views+prism-atom-one-dark%22%3E+%0A++%3C%21--+flowchart+%E7%AE%AD%E5%A4%B4%E5%9B%BE%E6%A0%87+%E5%8B%BF%E5%88%A0+--%3E+%0A++%3Csvg+xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22+style%3D%22display%3A+none%3B%22%3E%0A+++%3Cpath+stroke-linecap%3D%22round%22+d%3D%22M5%2C0+0%2C2.5+5%2C5z%22+id%3D%22raphael-marker-block%22+style%3D%22-webkit-tap-highlight-color%3A+rgba%280%2C+0%2C+0%2C+0%29%3B%22%3E%3C%2Fpath%3E%0A++%3C%2Fsvg%3E+%0A++%3Cp%3E%E7%9C%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E9%9C%80%E8%A6%81%E5%A4%A7%E5%AE%B6%E5%85%88%E4%BA%86%E8%A7%A3%E4%B8%8B%3Cbr%3E+%3Cstrong%3E%E5%8D%B7%E7%A7%AF%E3%80%81%E8%BD%AC%E7%BD%AE%E5%8D%B7%E7%A7%AF%E4%B8%8E%E7%A9%BA%E6%B4%9E%E5%8D%B7%E7%A7%AF%E7%9A%84%E5%8C%BA%E5%88%AB%2C%E6%9B%B4%E6%9C%89%E5%8A%A9%E4%BA%8E%E7%90%86%E8%A7%A3%E6%96%87%E4%B8%AD%E4%BB%A3%E7%A0%81%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BD%95%E6%88%91%E4%BC%9A%E8%BF%99%E4%B9%88%E5%8E%BB%E5%AE%9E%E6%96%BD%E6%88%91%E7%9A%84project%3C%2Fstrong%3E%3Cbr%3E+%3Cstrong%3E1+%E5%8E%9F%E7%90%86%3C%2Fstrong%3E%3Cbr%3E+%E4%B9%8B%E5%89%8D%E6%88%91%E6%9B%BE%E9%87%87%E7%94%A8%E4%BC%A0%E7%BB%9F%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E4%BA%86%E4%B8%80%E4%B8%8B%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%2C%3Cbr%3E+%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fxiao__run%2Farticle%2Fdetails%2F82746319%22+rel%3D%22nofollow%22%3Ehttps%3A%2F%2Fblog.csdn.net%2Fxiao__run%2Farticle%2Fdetails%2F82746319%3C%2Fa%3E%3Cbr%3E+%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%E6%98%AF%E6%97%A0%E4%BA%BA%E8%BD%A6%E7%B3%BB%E7%BB%9F%E9%87%8C%E6%84%9F%E7%9F%A5%E6%A8%A1%E5%9D%97%E7%9A%84%E9%87%8D%E8%A6%81%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86%E3%80%82%E5%88%A9%E7%94%A8%E8%A7%86%E8%A7%89%E7%AE%97%E6%B3%95%E7%9A%84%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%98%AF%E4%B8%80%E7%A7%8D%E8%BE%83%E4%B8%BA%E5%B8%B8%E8%A7%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E3%80%82%E8%A7%86%E8%A7%89%E6%A3%80%E6%B5%8B%E6%96%B9%E6%A1%88%E4%B8%BB%E8%A6%81%E5%9F%BA%E4%BA%8E%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%2C%E6%A3%80%E6%B5%8B%E5%87%BA%E5%9B%BE%E7%89%87%E4%B8%AD%E8%A1%8C%E8%BD%A6%E9%81%93%E8%B7%AF%E7%9A%84%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A0%87%E5%BF%97%E5%8C%BA%E5%9F%9F%E3%80%82%3Cbr%3E+%E9%AB%98%E9%80%9F%E5%85%AC%E8%B7%AF%E4%B8%8A%E7%9A%84%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%E6%98%AF%E4%B8%80%E9%A1%B9%E5%85%B7%E6%9C%89%E6%8C%91%E6%88%98%E6%80%A7%E7%9A%84%E4%BB%BB%E5%8A%A1%2C%E7%94%B1%E4%BA%8E%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A0%87%E5%BF%97%E7%9A%84%E7%A7%8D%E7%B1%BB%E7%B9%81%E5%A4%9A%2C%E8%BD%A6%E8%BE%86%E6%8B%A5%E6%8C%A4%E9%80%A0%E6%88%90%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A0%87%E5%BF%97%E5%8C%BA%E5%9F%9F%E8%A2%AB%E9%81%AE%E6%8C%A1%2C%E8%BD%A6%E9%81%93%E7%BA%BF%E5%8F%AF%E8%83%BD%E6%9C%89%E8%85%90%E8%9A%80%E7%A3%A8%E6%8D%9F%E7%9A%84%E6%83%85%E5%86%B5%2C%E4%BB%A5%E5%8F%8A%E5%A4%A9%E6%B0%94%E7%AD%89%E5%9B%A0%E7%B4%A0%E9%83%BD%E8%83%BD%E7%BB%99%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%E4%BB%BB%E5%8A%A1%E5%B8%A6%E6%9D%A5%E4%B8%8D%E5%B0%8F%E7%9A%84%E6%8C%91%E6%88%98%E3%80%82%E8%BF%87%E5%8E%BB%2C%E5%A4%A7%E9%83%A8%E5%88%86%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E5%9F%BA%E6%9C%AC%E6%98%AF%E9%80%9A%E8%BF%87%E5%8D%B7%E7%A7%AF%E6%BB%A4%E6%B3%A2%E6%96%B9%E6%B3%95%2C%E8%AF%86%E5%88%AB%E5%88%86%E5%89%B2%E5%87%BA%E8%BD%A6%E9%81%93%E7%BA%BF%E5%8C%BA%E5%9F%9F%2C%E7%84%B6%E5%90%8E%E7%BB%93%E5%90%88%E9%9C%8D%E5%A4%AB%E5%8F%98%E6%8D%A2%E3%80%81RANSAC%E7%AD%89%E7%AE%97%E6%B3%95%E8%BF%9B%E8%A1%8C%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%2C%E8%BF%99%E7%B1%BB%E7%AE%97%E6%B3%95%E9%9C%80%E8%A6%81%E4%BA%BA%E5%B7%A5%E6%89%8B%E5%8A%A8%E5%8E%BB%E8%B0%83%E6%BB%A4%E6%B3%A2%E7%AE%97%E5%AD%90%2C%E6%A0%B9%E6%8D%AE%E7%AE%97%E6%B3%95%E6%89%80%E9%92%88%E5%AF%B9%E7%9A%84%E8%A1%97%E9%81%93%E5%9C%BA%E6%99%AF%E7%89%B9%E7%82%B9%E6%89%8B%E5%8A%A8%E8%B0%83%E8%8A%82%E5%8F%82%E6%95%B0%2C%E5%B7%A5%E4%BD%9C%E9%87%8F%E5%A4%A7%E4%B8%94%E9%B2%81%E6%A3%92%E6%80%A7%E8%BE%83%E5%B7%AE%2C%E5%BD%93%E8%A1%8C%E8%BD%A6%E7%8E%AF%E5%A2%83%E5%87%BA%E7%8E%B0%E6%98%8E%E6%98%BE%E5%8F%98%E5%8C%96%E6%97%B6%2C%E8%BD%A6%E9%81%93%E7%BA%BF%E7%9A%84%E6%A3%80%E6%B5%8B%E6%95%88%E6%9E%9C%E4%B8%8D%E4%BD%B3%E3%80%82%E5%8F%82%E8%80%83%E6%88%91%E7%9A%84%E4%B8%8A%E4%B8%80%E7%AF%87%E5%8D%9A%E6%96%87%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode%3E+https%3A%2F%2Fblog.csdn.net%2Fxiao__run%2Farticle%2Fdetails%2F82746319%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E5%9F%BA%E4%BA%8E%E4%BC%A0%E7%BB%9F%E8%BD%A6%E9%81%93%E7%BA%BF%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%2C%E7%BB%93%E5%90%88%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8A%80%E6%9C%AF%2C%E6%8F%90%E5%87%BA%E4%BA%86%E4%B8%80%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%2C%E4%BB%A3%E6%9B%BF%E4%BC%A0%E7%BB%9F%E7%AE%97%E6%B3%95%E4%B8%AD%E6%89%8B%E5%8A%A8%E8%B0%83%E6%BB%A4%E6%B3%A2%E7%AE%97%E5%AD%90%2C%E5%AF%B9%E9%AB%98%E9%80%9F%E5%85%AC%E8%B7%AF%E4%B8%8A%E7%9A%84%E8%BD%A6%E9%81%93%E7%BA%BF%E8%BF%9B%E8%A1%8C%E8%AF%AD%E4%B9%89%E5%88%86%E5%89%B2.%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%B0%B1%E6%98%AF%E9%87%87%E7%94%A8segnet%E7%B1%BB%E4%BC%BC%E7%BB%93%E6%9E%84%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%88%86%E5%89%B2%E8%BD%A6%E9%81%93%E7%BA%BF%E5%8C%BA%E9%97%B4%2C%E5%9F%BA%E4%BA%8Efcn%2C+segnet%2C+Unet%E8%AF%AD%E4%B9%89%E5%88%86%E5%89%B2%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E9%83%BD%E6%98%AFencoding%2Cdecoding%E7%BB%93%E6%9E%84%2C%E5%B0%8F%E7%BC%96%E5%9C%A8%E7%89%B9%E5%BE%81%E9%80%89%E5%8F%96%E4%B8%8A%E5%81%9A%E4%BA%86%E5%9F%BA%E6%9C%AC%E6%94%B9%E8%BF%9B%2C%E6%95%88%E6%9E%9C%E8%BF%98%E8%83%BD%E7%9C%8B.%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F20190115191439210.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9fX3J1bg%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+alt%3D%22%E5%9C%A8%E8%BF%99%E9%87%8C%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22%3E%3C%2Fp%3E+%0A++%3Cp%3E1+%E6%9C%80%E5%90%8E%E4%B8%80%E5%B1%82%E9%87%87%E7%94%A81%E4%B8%AA3x3%E7%9A%84%E5%8D%B7%E7%A7%AF%E6%A0%B8%E5%8E%BB%E5%9B%9E%E5%BD%92.%3Cbr%3E+2+%E9%87%87%E7%94%A8adam%E5%8E%BB%E4%BC%98%E5%8C%96%2C%3Cbr%3E+3+loss%E9%87%87%E7%94%A8loss%3D%E2%80%98mean_squared_error%E2%80%99%3C%2Fp%3E+%0A++%3Cp%3E%3Cstrong%3E2+%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%B7%E6%9C%AC%3C%2Fstrong%3E%3Cbr%3E+%E6%95%B0%E6%8D%AE%E9%9B%86%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F2019011519091494.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9fX3J1bg%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+alt%3D%22%E5%9C%A8%E8%BF%99%E9%87%8C%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22%3E%E5%88%86%E5%89%B2%E5%9B%BE%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F20190115190936795.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9fX3J1bg%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+alt%3D%22%E5%9C%A8%E8%BF%99%E9%87%8C%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22%3E%3Cbr%3E+%E7%BD%91%E7%BB%9Cmodel%E5%A6%82%E4%B8%8B%3A%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode%3E%22%22%22+This+file+contains+code+for+a+fully+convolutional%0A%28i.e.+contains+zero+fully+connected+layers%29+neural+network%0Afor+detecting+lanes.+This+version+assumes+the+inputs%0Ato+be+road+images+in+the+shape+of+80+x+160+x+3+%28RGB%29+with%0Athe+labels+as+80+x+160+x+1+%28just+the+G+channel+with+a%0Are-drawn+lane%29.+Note+that+in+order+to+view+a+returned+image%2C%0Athe+predictions+is+later+stacked+with+zero%27ed+R+and+B+layers%0Aand+added+back+to+the+initial+road+image.%0A%22%22%22python%0A%0Aimport+numpy+as+np%0Aimport+pickle%0Aimport+cv2%0Afrom+sklearn.utils+import+shuffle%0Afrom+sklearn.model_selection+import+train_test_split%0A%0A%23+Import+necessary+items+from+Keras%0Afrom+keras.models+import+Model%0Afrom+keras.layers+import+Activation%2C+Dropout%2C+UpSampling2D%2C+concatenate%2C+Input%0Afrom+keras.layers+import+Conv2DTranspose%2C+Conv2D%2C+MaxPooling2D%0Afrom+keras.layers.normalization+import+BatchNormalization%0Afrom+keras.preprocessing.image+import+ImageDataGenerator%0Afrom+keras.utils+import+plot_model%0Afrom+keras+import+regularizers%0A%0A%23+Load+training+images%0Atrain_images+%3D+pickle.load%28open%28%22full_CNN_train.p%22%2C+%22rb%22+%29%29%0A%0A%23+Load+image+labels%0Alabels+%3D+pickle.load%28open%28%22full_CNN_labels.p%22%2C+%22rb%22+%29%29%0A%0A%23+Make+into+arrays+as+the+neural+network+wants+these%0Atrain_images+%3D+np.array%28train_images%29%0Alabels+%3D+np.array%28labels%29%0A%0A%0A%0A%23+Normalize+labels+-+training+images+get+normalized+to+start+in+the+network%0Alabels+%3D+labels+%2F+255%0A%0A%23+Shuffle+images+along+with+their+labels%2C+then+split+into+training%2Fvalidation+sets%0Atrain_images%2C+labels+%3D+shuffle%28train_images%2C+labels%29%0A%23+Test+size+may+be+10%25+or+20%25%0AX_train%2C+X_val%2C+y_train%2C+y_val+%3D+train_test_split%28train_images%2C+labels%2C+test_size%3D0.1%29%0A%0A%23+Batch+size%2C+epochs+and+pool+size+below+are+all+paramaters+to+fiddle+with+for+optimization%0Abatch_size+%3D+16%0Aepochs+%3D+10%0Apool_size+%3D+%282%2C+2%29%0A%23input_shape+%3D+X_train.shape%5B1%3A%5D%0A%0A%23%23%23+Here+is+the+actual+neural+network+%23%23%23%0A%23+Normalizes+incoming+inputs.+First+layer+needs+the+input+shape+to+work%0A%23BatchNormalization%28input_shape%3Dinput_shape%29%0AInputs+%3D+Input%28batch_shape%3D%28None%2C+80%2C+160%2C+3%29%29%0A%0A%23+Below+layers+were+re-named+for+easier+reading+of+model+summary%3B+this+not+necessary%0A%23+Conv+Layer+1%0AConv1+%3D+Conv2D%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Inputs%29%0ABat1+%3D+BatchNormalization%28%29%28Conv1%29%0A%0A%23+Conv+Layer+2%0AConv2+%3D+Conv2D%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Conv1%29%0ABat2+%3D+BatchNormalization%28%29%28Conv2%29%0A%0A%23+Pooling+1%0APool1+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Conv2%29%0A%0A%23+Conv+Layer+3%0AConv3+%3D+Conv2D%2832%2C+%283%2C+3%29%2C+padding+%3D+%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Pool1%29%0A%23Drop3+%3D+Dropout%280.2%29%28Conv3%29%0ABat3+%3D+BatchNormalization%28%29%28Conv3%29%0A%0A%23+Conv+Layer+4%0AConv4+%3D+Conv2D%2832%2C+%283%2C+3%29%2C+padding+%3D+%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat3%29%0A%23Drop4+%3D+Dropout%280.5%29%28Conv4%29%0ABat4+%3D+BatchNormalization%28%29%28Conv4%29%0A%0A%23+Conv+Layer+5%0AConv5+%3D+Conv2D%2832%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat4%29%0A%23Drop5+%3D+Dropout%280.2%29%28Conv5%29%0ABat5+%3D+BatchNormalization%28%29%28Conv5%29%0A%0A%23+Pooling+2%0APool2+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Bat5%29%0A%0A%23+Conv+Layer+6%0AConv6+%3D+Conv2D%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Pool2%29%0A%23Drop6+%3D+Dropout%280.2%29%28Conv6%29%0ABat6+%3D+BatchNormalization%28%29%28Conv6%29%0A%0A%23+Conv+Layer+7%0AConv7+%3D+Conv2D%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat6%29%0A%23Drop7+%3D+Dropout%280.2%29%28Conv7%29%0ABat7+%3D+BatchNormalization%28%29%28Conv7%29%0A%0A%23+Pooling+3%0APool3+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Bat7%29%0A%0A%23+Conv+Layer+8%0AConv8+%3D+Conv2D%28128%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Pool3%29%0A%23Drop8+%3D+Dropout%280.2%29%28Conv8%29%0ABat8+%3D+BatchNormalization%28%29%28Conv8%29%0A%0A%23+Conv+Layer+9%0AConv9+%3D+Conv2D%28128%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat8%29%0A%23Drop9+%3D+Dropout%280.2%29%28Conv9%29%0ABat9+%3D+BatchNormalization%28%29%28Conv9%29%0A%0A%23+Pooling+4%0APool4+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Bat9%29%0A%0A%0A%23+Upsample+1%0AUp1+%3D+UpSampling2D%28size%3Dpool_size%29%28Pool4%29%0AMer1+%3D+concatenate%28%5BUp1%2C+Bat9%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+1%0ADeconv1+%3D+Conv2DTranspose%28128%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer1%29%0A%23DDrop1+%3D+Dropout%280.2%29%28Deconv1%29%0ADBat1+%3D+BatchNormalization%28%29%28Deconv1%29%0A%0A%23+Deconv+2%0ADeconv2+%3D+Conv2DTranspose%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat1%29%0A%23DDrop2+%3D+Dropout%280.2%29%28Deconv2%29%0ADBat2+%3D+BatchNormalization%28%29%28Deconv2%29%0A%0A%23+Upsample+2%0AUp2+%3D+UpSampling2D%28size%3Dpool_size%29%28DBat2%29%0AMer2+%3D+concatenate%28%5BUp2%2C+Bat7%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+3%0ADeconv3+%3D+Conv2DTranspose%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer2%29%0A%23DDrop3+%3D+Dropout%280.2%29%28Deconv3%29%0ADBat3+%3D+BatchNormalization%28%29%28Deconv3%29%0A%0A%23+Deconv+4%0ADeconv4+%3D+Conv2DTranspose%2832%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat3%29%0A%23DDrop4+%3D+Dropout%280.2%29%28Deconv4%29%0ADBat4+%3D+BatchNormalization%28%29%28Deconv4%29%0A%0A%23+Upsample+3%0AUp3+%3D+UpSampling2D%28size%3Dpool_size%29%28DBat4%29%0AMer3+%3D+concatenate%28%5BUp3%2C+Bat5%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+5%0ADeconv5+%3D+Conv2DTranspose%2832%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer3%29%0A%23DDrop5+%3D+Dropout%280.2%29%28Deconv5%29%0ADBat5+%3D+BatchNormalization%28%29%28Deconv5%29%0A%0A%23+Deconv+6%0ADeconv6+%3D+Conv2DTranspose%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat5%29%0A%23DDrop6+%3D+Dropout%280.2%29%28Deconv6%29%0ADBat6+%3D+BatchNormalization%28%29%28Deconv6%29%0A%0A%23+Deconv+7%0ADeconv7+%3D+Conv2DTranspose%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat6%29%0A%23DDrop7+%3D+Dropout%280.2%29%28Deconv7%29%0ADBat7+%3D+BatchNormalization%28%29%28Deconv7%29%0A%0A%23+Upsample+4%0AUp4+%3D+UpSampling2D%28size%3Dpool_size%29%28DBat7%29%0AMer4+%3D+concatenate%28%5BUp4%2C+Bat2%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+8%0ADeconv8+%3D+Conv2DTranspose%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer4%29%0A%23DDrop8+%3D+Dropout%280.2%29%28Deconv8%29%0ADBat8+%3D+BatchNormalization%28%29%28Deconv8%29%0A%0A%23+Deconv+9%0ADeconv9+%3D+Conv2DTranspose%288%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat8%29%0A%23DDrop9+%3D+Dropout%280.2%29%28Deconv9%29%0ADBat9+%3D+BatchNormalization%28%29%28Deconv9%29%0A%0A%23+Final+layer+-+only+including+one+channel+so+1+filter%0AFinal+%3D+Conv2DTranspose%281%2C+%283%2C+3%29%2C+padding%3D%27same%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat9%29%0A%0A%23%23%23+End+of+network+%23%23%23%0Amodel+%3D+Model%28inputs%3DInputs%2C+outputs%3DFinal%29%0A%0A%0A%23+Using+a+generator+to+help+the+model+use+less+data%0A%23+Channel+shifts+help+with+shadows+slightly%0Adatagen+%3D+ImageDataGenerator%28channel_shift_range%3D0.2%29%0Adatagen.fit%28X_train%29%0A%0A%23+Compiling+and+training+the+model%0Amodel.compile%28optimizer%3D%27Adam%27%2C+loss%3D%27mean_squared_error%27%29%0Amodel.fit_generator%28datagen.flow%28X_train%2C+y_train%2C+batch_size%3Dbatch_size%29%2C+steps_per_epoch%3Dlen%28X_train%29%2Fbatch_size%2C%0Aepochs%3Depochs%2C+verbose%3D1%2C+validation_data%3D%28X_val%2C+y_val%29%29%0A%0A%23+Freeze+layers+since+training+is+done%0Amodel.trainable+%3D+False%0Amodel.compile%28optimizer%3D%27Adam%27%2C+loss%3D%27mean_squared_error%27%29%0A%0A%23+Save+model+architecture+and+weights%0Amodel.save%28%27full_CNN_model.h5%27%29%0A%0A%23+Show+summary+of+model%0Amodel.summary%28%29%0Aplot_model%28model%2C+to_file%3D%27model.png%27%29%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cstrong%3E%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%94%B9%E8%BF%9B%3C%2Fstrong%3E%3Cbr%3E+%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%B8%8D%E6%98%AF%E7%9B%B4%E6%8E%A5%E9%87%87%E7%94%A8unsample%2C%E9%87%87%E7%94%A8%E8%BD%AC%E7%BD%AE%E5%8D%B7%E7%A7%AF%E8%BF%9B%E8%A1%8C%E4%B8%8A%E9%87%87%E6%A0%B7%2C%E5%90%8C%E6%A0%B7%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%B8%AA%E5%A4%9A%E5%B0%BA%E5%BA%A6%E7%89%B9%E5%BE%81%E8%9E%8D%E5%90%88%3Cbr%3E+%2C%E8%AE%AD%E7%BB%83%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%3A%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode%3E%22%22%22+This+file+contains+code+for+a+fully+convolutional%0A%28i.e.+contains+zero+fully+connected+layers%29+neural+network%0Afor+detecting+lanes.+This+version+assumes+the+inputs%0Ato+be+road+images+in+the+shape+of+80+x+160+x+3+%28RGB%29+with%0Athe+labels+as+80+x+160+x+1+%28just+the+G+channel+with+a%0Are-drawn+lane%29.+Note+that+in+order+to+view+a+returned+image%2C%0Athe+predictions+is+later+stacked+with+zero%27ed+R+and+B+layers%0Aand+added+back+to+the+initial+road+image.%0A%22%22%22%0A%0Aimport+numpy+as+np%0Aimport+pickle%0A%23import+cv2%0Afrom+sklearn.utils+import+shuffle%0Afrom+sklearn.model_selection+import+train_test_split%0A%0A%23+Import+necessary+items+from+Keras%0Afrom+keras.models+import+Model%0Afrom+keras.layers+import+Activation%2C+Dropout%2C+UpSampling2D%2C+concatenate%2C+Input%0Afrom+keras.layers+import+Conv2DTranspose%2C+Conv2D%2C+MaxPooling2D%0Afrom+keras.layers.normalization+import+BatchNormalization%0Afrom+keras.preprocessing.image+import+ImageDataGenerator%0Afrom+keras.utils+import+plot_model%0Afrom+keras+import+regularizers%0A%0A%23+Load+training+images%0Atrain_images+%3D+pickle.load%28open%28%22full_CNN_train.p%22%2C+%22rb%22+%29%29%0A%0A%23+Load+image+labels%0Alabels+%3D+pickle.load%28open%28%22full_CNN_labels.p%22%2C+%22rb%22+%29%29%0A%0A%23+Make+into+arrays+as+the+neural+network+wants+these%0Atrain_images+%3D+np.array%28train_images%29%0Alabels+%3D+np.array%28labels%29%0A%0A%0A%0A%23+Normalize+labels+-+training+images+get+normalized+to+start+in+the+network%0Alabels+%3D+labels+%2F+255%0A%0A%23+Shuffle+images+along+with+their+labels%2C+then+split+into+training%2Fvalidation+sets%0Atrain_images%2C+labels+%3D+shuffle%28train_images%2C+labels%29%0A%23+Test+size+may+be+10%25+or+20%25%0AX_train%2C+X_val%2C+y_train%2C+y_val+%3D+train_test_split%28train_images%2C+labels%2C+test_size%3D0.1%29%0A%0A%23+Batch+size%2C+epochs+and+pool+size+below+are+all+paramaters+to+fiddle+with+for+optimization%0Abatch_size+%3D+16%0Aepochs+%3D+10%0Apool_size+%3D+%282%2C+2%29%0A%23input_shape+%3D+X_train.shape%5B1%3A%5D%0A%0A%23%23%23+Here+is+the+actual+neural+network+%23%23%23%0A%23+Normalizes+incoming+inputs.+First+layer+needs+the+input+shape+to+work%0A%23BatchNormalization%28input_shape%3Dinput_shape%29%0AInputs+%3D+Input%28batch_shape%3D%28None%2C+80%2C+160%2C+3%29%29%0A%0A%23+Below+layers+were+re-named+for+easier+reading+of+model+summary%3B+this+not+necessary%0A%23+Conv+Layer+1%0AConv1+%3D+Conv2D%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Inputs%29%0ABat1+%3D+BatchNormalization%28%29%28Conv1%29%0A%0A%23+Conv+Layer+2%0AConv2+%3D+Conv2D%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Conv1%29%0ABat2+%3D+BatchNormalization%28%29%28Conv2%29%0A%0A%23+Pooling+1%0APool1+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Conv2%29%0A%0A%23+Conv+Layer+3%0AConv3+%3D+Conv2D%2832%2C+%283%2C+3%29%2C+padding+%3D+%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Pool1%29%0A%23Drop3+%3D+Dropout%280.2%29%28Conv3%29%0ABat3+%3D+BatchNormalization%28%29%28Conv3%29%0A%0A%23+Conv+Layer+4%0AConv4+%3D+Conv2D%2832%2C+%283%2C+3%29%2C+padding+%3D+%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat3%29%0A%23Drop4+%3D+Dropout%280.5%29%28Conv4%29%0ABat4+%3D+BatchNormalization%28%29%28Conv4%29%0A%0A%23+Conv+Layer+5%0AConv5+%3D+Conv2D%2832%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat4%29%0A%23Drop5+%3D+Dropout%280.2%29%28Conv5%29%0ABat5+%3D+BatchNormalization%28%29%28Conv5%29%0A%0A%23+Pooling+2%0APool2+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Bat5%29%0A%0A%23+Conv+Layer+6%0AConv6+%3D+Conv2D%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Pool2%29%0A%23Drop6+%3D+Dropout%280.2%29%28Conv6%29%0ABat6+%3D+BatchNormalization%28%29%28Conv6%29%0A%0A%23+Conv+Layer+7%0AConv7+%3D+Conv2D%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat6%29%0A%23Drop7+%3D+Dropout%280.2%29%28Conv7%29%0ABat7+%3D+BatchNormalization%28%29%28Conv7%29%0A%0A%23+Pooling+3%0APool3+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Bat7%29%0A%0A%23+Conv+Layer+8%0AConv8+%3D+Conv2D%28128%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Pool3%29%0A%23Drop8+%3D+Dropout%280.2%29%28Conv8%29%0ABat8+%3D+BatchNormalization%28%29%28Conv8%29%0A%0A%23+Conv+Layer+9%0AConv9+%3D+Conv2D%28128%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Bat8%29%0A%23Drop9+%3D+Dropout%280.2%29%28Conv9%29%0ABat9+%3D+BatchNormalization%28%29%28Conv9%29%0A%0A%23+Pooling+4%0APool4+%3D+MaxPooling2D%28pool_size%3Dpool_size%29%28Bat9%29%0A%0A%0A%23+Upsample+1+to+Deconv+1%0ADeconv1+%3D+Conv2DTranspose%28128%2C+%282%2C+2%29%2C+padding%3D%27valid%27%2C+strides%3D%282%2C2%29%2C+activation+%3D+%27relu%27%29%28Pool4%29%0A%23Up1+%3D+UpSampling2D%28size%3Dpool_size%29%28Pool4%29%0AMer1+%3D+concatenate%28%5BDeconv1%2C+Bat9%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+2%0ADeconv2+%3D+Conv2DTranspose%28128%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer1%29%0ADBat2+%3D+BatchNormalization%28%29%28Deconv2%29%0A%0A%23+Deconv+3%0ADeconv3+%3D+Conv2DTranspose%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat2%29%0ADBat3+%3D+BatchNormalization%28%29%28Deconv3%29%0A%0A%23+Upsample+2+to+Deconv+4%0ADeconv4+%3D+Conv2DTranspose%2864%2C+%282%2C+2%29%2C+padding%3D%27valid%27%2C+strides%3D%282%2C2%29%2C+activation+%3D+%27relu%27%29%28DBat3%29%0A%23Up2+%3D+UpSampling2D%28size%3Dpool_size%29%28DBat2%29%0AMer2+%3D+concatenate%28%5BDeconv4%2C+Bat7%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+5%0ADeconv5+%3D+Conv2DTranspose%2864%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer2%29%0ADBat5+%3D+BatchNormalization%28%29%28Deconv5%29%0A%0A%23+Deconv+6%0ADeconv6+%3D+Conv2DTranspose%2832%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat5%29%0ADBat6+%3D+BatchNormalization%28%29%28Deconv6%29%0A%0A%23+Upsample+3+to+Deconv+7%0ADeconv7+%3D+Conv2DTranspose%2832%2C+%282%2C+2%29%2C+padding%3D%27valid%27%2C+strides%3D%282%2C2%29%2C+activation+%3D+%27relu%27%29%28DBat6%29%0A%23Up3+%3D+UpSampling2D%28size%3Dpool_size%29%28DBat4%29%0AMer3+%3D+concatenate%28%5BDeconv7%2C+Bat5%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+8%0ADeconv8+%3D+Conv2DTranspose%2832%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer3%29%0ADBat8+%3D+BatchNormalization%28%29%28Deconv8%29%0A%0A%23+Deconv+9%0ADeconv9+%3D+Conv2DTranspose%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat8%29%0ADBat9+%3D+BatchNormalization%28%29%28Deconv9%29%0A%0A%23+Deconv+10%0ADeconv10+%3D+Conv2DTranspose%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat9%29%0ADBat10+%3D+BatchNormalization%28%29%28Deconv10%29%0A%0A%23+Upsample+4+to+Deconv+11%0ADeconv11+%3D+Conv2DTranspose%2816%2C+%282%2C+2%29%2C+padding%3D%27valid%27%2C+strides%3D%282%2C2%29%2C+activation+%3D+%27relu%27%29%28DBat10%29%0A%23Up4+%3D+UpSampling2D%28size%3Dpool_size%29%28DBat7%29%0AMer4+%3D+concatenate%28%5BDeconv11%2C+Bat2%5D%2C+axis%3D-1%29%0A%0A%23+Deconv+12%0ADeconv12+%3D+Conv2DTranspose%2816%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28Mer4%29%0ADBat12+%3D+BatchNormalization%28%29%28Deconv12%29%0A%0A%23+Deconv+13%0ADeconv13+%3D+Conv2DTranspose%288%2C+%283%2C+3%29%2C+padding%3D%27valid%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat12%29%0ADBat13+%3D+BatchNormalization%28%29%28Deconv13%29%0A%0A%23+Final+layer+-+only+including+one+channel+so+1+filter%0AFinal+%3D+Conv2DTranspose%281%2C+%283%2C+3%29%2C+padding%3D%27same%27%2C+strides%3D%281%2C1%29%2C+activation+%3D+%27relu%27%29%28DBat13%29%0A%0A%23%23%23+End+of+network+%23%23%23%0Amodel+%3D+Model%28inputs%3DInputs%2C+outputs%3DFinal%29%0A%0A%0A%23+Using+a+generator+to+help+the+model+use+less+data%0A%23+Channel+shifts+help+with+shadows+slightly%0Adatagen+%3D+ImageDataGenerator%28channel_shift_range%3D0.2%29%0Adatagen.fit%28X_train%29%0A%0A%23+Compiling+and+training+the+model%0Amodel.compile%28optimizer%3D%27Adam%27%2C+loss%3D%27mean_squared_error%27%29%0Amodel.fit_generator%28datagen.flow%28X_train%2C+y_train%2C+batch_size%3Dbatch_size%29%2C+steps_per_epoch%3Dlen%28X_train%29%2Fbatch_size%2C%0Aepochs%3Depochs%2C+verbose%3D1%2C+validation_data%3D%28X_val%2C+y_val%29%29%0A%0A%23+Freeze+layers+since+training+is+done%0Amodel.trainable+%3D+False%0Amodel.compile%28optimizer%3D%27Adam%27%2C+loss%3D%27mean_squared_error%27%29%0A%0A%23+Save+model+architecture+and+weights%0Amodel.save%28%27full_CNN_model.h5%27%29%0A%0A%23+Show+summary+of+model%0Amodel.summary%28%29%0Aplot_model%28model%2C+to_file%3D%27model.png%27%29%0A%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cstrong%3E%E6%B5%8B%E8%AF%95%3C%2Fstrong%3E+%3Cbr%3E+%E8%AE%AD%E7%BB%83%E5%BE%97%E5%88%B0model%E4%B9%8B%E5%90%8E%2C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%BB%AC%E7%94%A8%E8%A7%86%E9%A2%91%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B%3A%3Cbr%3E+%E6%B5%8B%E8%AF%95%E6%97%B6%E9%87%87%E7%94%A8%E8%BF%9E%E7%BB%AD5%E5%B8%A7%E5%81%9A%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B9%B3%E5%9D%87%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode%3Eimport+numpy+as+np%0Aimport+cv2%0Afrom+scipy.misc+import+imresize%0Afrom+moviepy.editor+import+VideoFileClip%0Afrom+IPython.display+import+HTML%0Afrom+keras.models+import+load_model%0Aimport+matplotlib.pyplot+as+plt%0A%0A%23+Load+Keras+model%0Amodel+%3D+load_model%28%27full_CNN_model.h5%27%29%0A%0A%23+Class+to+average+lanes+with%0Aclass+Lanes%28%29%3A%0A++++def+__init__%28self%29%3A%0A++++++++self.recent_fit+%3D+%5B%5D%0A++++++++self.avg_fit+%3D+%5B%5D%0A%0Adef+road_lines%28image%29%3A%0A++++%22%22%22+Takes+in+a+road+image%2C+re-sizes+for+the+model%2C%0A++++predicts+the+lane+to+be+drawn+from+the+model+in+G+color%2C%0A++++recreates+an+RGB+image+of+a+lane+and+merges+with+the%0A++++original+road+image.%0A++++%22%22%22%0A%0A++++%23+Get+image+ready+for+feeding+into+model%0A++++small_img+%3D+imresize%28image%2C+%2880%2C+160%2C+3%29%29%0A++++small_img+%3D+np.array%28small_img%29%0A++++small_img+%3D+small_img%5BNone%2C%3A%2C%3A%2C%3A%5D%0A%0A++++%23+Make+prediction+with+neural+network+%28un-normalize+value+by+multiplying+by+255%29%0A++++prediction+%3D+model.predict%28small_img%29%5B0%5D+*+255%0A++++%23+Add+lane+prediction+to+list+for+averaging%0A++++lanes.recent_fit.append%28prediction%29%0A%0A++++%23+Only+using+last+five+for+average%0A++++if+len%28lanes.recent_fit%29+%26gt%3B+5%3A%0A++++++++lanes.recent_fit+%3D+lanes.recent_fit%5B1%3A%5D%0A%0A++++%23+Calculate+average+detection%0A++++lanes.avg_fit+%3D+np.mean%28np.array%28%5Bi+for+i+in+lanes.recent_fit%5D%29%2C+axis+%3D+0%29%0A%0A++++%23+Generate+fake+R+%26amp%3B+B+color+dimensions%2C+stack+with+G%0A++++blanks+%3D+np.zeros_like%28lanes.avg_fit%29.astype%28np.uint8%29%0A%0A++++lane_drawn+%3D+np.dstack%28%28blanks%2C+lanes.avg_fit%2C+blanks%29%29%0A%0A++++%23+Re-size+to+match+the+original+image%0A++++lane_image+%3D+imresize%28lane_drawn%2C+%28720%2C+1280%2C+3%29%29%0A%0A++++%23plt.imshow%28lane_image%29%0A++++%23plt.show%28%29%0A%0A%0A++++%23+Merge+the+lane+drawing+onto+the+original+image%0A++++result+%3D+cv2.addWeighted%28image%2C+1%2C+lane_image%2C+1%2C+0%29%0A%0A++++return+result%0A%0Alanes+%3D+Lanes%28%29%0A%0A%23+Where+to+save+the+output+video%0Avid_output+%3D+%27harder_challenge.mp4%27%0A%0Aclip1+%3D+VideoFileClip%28%22project_video.mp4%22%29%0A%0Avid_clip+%3D+clip1.fl_image%28road_lines%29%0Avid_clip.write_videofile%28vid_output%2C+audio%3DFalse%29%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cstrong%3E%E7%BB%93%E6%9E%9C%3C%2Fstrong%3E%3Cbr%3E+%E7%BB%93%E6%9E%9C%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%3A%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F20190115192020175.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9fX3J1bg%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+alt%3D%22%E5%9C%A8%E8%BF%99%E9%87%8C%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F20190115192033124.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9fX3J1bg%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+alt%3D%22%E5%9C%A8%E8%BF%99%E9%87%8C%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22%3E%3Cbr%3E+%E6%95%88%E6%9E%9C%E5%8B%89%E5%BC%BA%E8%BF%98%E8%83%BD%E7%9C%8B%2C%E5%90%8E%E7%BB%AD%E6%88%91%E5%B0%86%E4%BC%9A%E5%81%9A%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%94%B9%E8%BF%9B%2C%E4%BE%8B%E5%A6%82%E4%BD%BF%E7%94%A8E-Net%E7%BD%91%E7%BB%9C%E5%8A%A0%E9%80%9F%2C%E9%87%87%E7%94%A8lanenet%E5%AE%9E%E4%BE%8B%E5%88%86%E5%89%B2%2C%E8%81%9A%E7%B1%BB%E7%AD%89%E7%AE%97%E6%B3%95%E8%AE%AD%E7%BB%83%E5%9B%BE%E6%A3%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86%2C%E5%BE%97%E5%88%B0%E6%9B%B4%E5%8A%A0%E5%A5%BD%E7%9A%84%E6%95%88%E6%9E%9C%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Fmdeditor%2Fmarkdown_views-7b4cdcb592.css%22+rel%3D%22stylesheet%22%3E+%0A%3C%2Fdiv%3E" | url_decode}}